---
title: Диагностика
description: Информация о устранении неполадок для удаленного рендеринга Azure
author: florianborn71
ms.author: flborn
ms.date: 02/25/2020
ms.topic: troubleshooting
ms.openlocfilehash: b86af2ff8fad3793fc47cec9399fd499c1cabba7
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81681857"
---
# <a name="troubleshoot"></a>Диагностика

На этой странице перечислены общие проблемы, мешающие удаленному рендерингу Azure, и способы их устранения.

## <a name="client-cant-connect-to-server"></a>Клиент не может подключиться к серверу

Убедитесь, что брандмауэры (на устройстве, внутри маршрутизаторов и т.д.) не блокируют следующие порты:

* **50051 (TCP)** - требуется для первоначального соединения (HTTP рукопожатие)
* **8266 (ТКПЗ-УДП)** - требуется для передачи данных
* **5000 (TCP)**, **5433 (TCP)**, **8443 (TCP)** - требуется для [ArrInspector](tools/arr-inspector.md)

## <a name="error-disconnected-videoformatnotavailable"></a>Ошибка 'Отключено: VideoFormatNotAvailable'

Убедитесь, что графический процессор поддерживает декодирование аппаратного видео. Смотрите [разработка ПК](../overview/system-requirements.md#development-pc).

Если вы работаете на ноутбуке с двумя графическими процессорами, возможно, что графический процессор, на который вы работаете по умолчанию, не предоставляет функцию декодирования аппаратного оборудования. Если это так, попробуйте заставить приложение использовать другой графический процессор. Это часто возможно в настройках драйвера Графического процессора.

## <a name="h265-codec-not-available"></a>Кодек H265 недоступен

Существует две причины, по которым сервер может отказаться от подключения с **кодеком, недоступной** ошибкой.

**Кодек H265 не установлен:**

Во-первых, убедитесь, что установить **HEVC видео расширения,** как упоминалось в разделе [программного обеспечения](../overview/system-requirements.md#software) системных требований.

Если вы все еще сталкиваетесь с проблемами, убедитесь, что ваша видеокарта поддерживает H265 и у вас есть последний графический драйвер установлен. Ознакомьтесь с разделом [разработки ПК](../overview/system-requirements.md#development-pc) системных требований к информации, конкретной для поставщиков.

**Кодек установлен, но не может быть использован:**

Причиной этой проблемы является неправильная настройка безопасности на DLL. Эта проблема не проявляется при попытке смотреть видео, закодированные с H265. Переустановка кодека также не исправит проблему. Вместо этого выполните следующие действия:

1. Откройте **PowerShell с правами на админ** и запустите

    ```PowerShell
    Get-AppxPackage -Name Microsoft.HEVCVideoExtension
    ```
  
    Эта команда должна `InstallLocation` выдвить кодек, что-то вроде:
  
    ```cmd
    InstallLocation   : C:\Program Files\WindowsApps\Microsoft.HEVCVideoExtension_1.0.23254.0_x64__5wasdgertewe
    ```

1. Откройте эту папку в Windows Explorer
1. Там должно быть **x86** и **x64** subfolder. Нажмите правой кнопкой мыши на одной из папок и выберите **Свойства**
    1. Выберите вкладку **безопасности** и нажмите кнопку **Расширенные** настройки
    1. Нажмите **Изменение** для **владельца**
    1. Введите **администраторов** в текстовое поле
    1. Нажмите **Проверить имена** и **OK**
1. Повторите вышеприведенные шаги для другой папки
1. Также повторите выше шаги на каждом файле DLL внутри обеих папок. Там должно быть четыре DLLs в целом.

Чтобы убедиться, что настройки теперь верны, сделайте это для каждого из четырех DLLs:

1. Выберите **свойства > > безопасности**
1. Пройдите через список всех **групп / пользователей** и убедитесь, что каждый из них имеет **Читать & Выполнить** правильный набор (галочка в столбце **позволяют** галочкой)

## <a name="low-video-quality"></a>Низкое качество видео

Качество видео может быть скомпрометировано либо качеством сети, либо недостающим видеокодеком H265.

* Ознакомьтесь с шагами по [выявлению проблем сети.](#unstable-holograms)
* Ознакомьтесь с [системными требованиями](../overview/system-requirements.md#development-pc) к установке последнего графического драйвера.

## <a name="video-recorded-with-mrc-does-not-reflect-the-quality-of-the-live-experience"></a>Видео, записанное с ПОМОЩЬю MRC, не отражает качество живого опыта

Видео может быть записано на Hololens через [Смешанная реальность захвата (MRC)](https://docs.microsoft.com/windows/mixed-reality/mixed-reality-capture-for-developers). Однако в результате видео имеет худшее качество, чем живой опыт по двум причинам:
* Видео кадра ограничен на 30 Гц, в отличие от 60 Гц.
* Видеоизображения не проходят через [поздний этап репроекции](../overview/features/late-stage-reprojection.md) обработки шаг, так что видео, как представляется, choppier.

Оба являются присущими ограничениям техники записи.

## <a name="black-screen-after-successful-model-loading"></a>Черный экран после успешной загрузки модели

Если вы подключены к времени выполнения рендеринга и загружены модели успешно, но увидеть только черный экран потом, то это может иметь несколько различных причин.

Мы рекомендуем проверить следующие вещи, прежде чем делать более углубленный анализ:

* Установлен ли кодек H265? Хотя должен быть запас нойец кодека H264, мы видели случаи, когда этот запас не работал должным образом. Ознакомьтесь с [системными требованиями](../overview/system-requirements.md#development-pc) к установке последнего графического драйвера.
* При использовании проекта Unity закройте Unity, удалите временную *библиотеку* и папки *obj* в каталоге проекта и загрузите/постройте проект снова. В некоторых случаях кэшированные данные привели к тому, что образец не функционировал должным образом без каких-либо очевидных причин.

Если эти два шага не помогли, необходимо выяснить, получены ли видеокадры клиентом или нет. Это может быть запрошено программно, как это объясняется в главе [запросов производительности сервера.](../overview/features/performance-queries.md) Имеет `FrameStatistics struct` член, который указывает, сколько видеокадров было получено. Если это число больше 0 и увеличивается с течением времени, клиент получает фактические видео кадры с сервера. Следовательно, это должно быть проблемой со стороны клиента.

### <a name="common-client-side-issues"></a>Общие проблемы на стороне клиента

**Модель не находится внутри представления frustum:**

Во многих случаях модель отображается правильно, но находится за пределами фрусткамеры. Распространенная причина заключается в том, что модель была экспортирована с далекой вне центра поворота, поэтому он обрезается дальней плоскости отсечения камеры. Это помогает программировать ящик ограничивающегося модели и визуализировать коробку с Unity в качестве линейной коробки или печатать ее значения для журнала отладки.

Кроме того, процесс преобразования генерирует [выводной файл json](../how-tos/conversion/get-information.md) вместе с преобразованной моделью. Чтобы отладить вопросы позиционирования моделей, стоит посмотреть на `boundingBox` запись в разделе [outputStatistics:](../how-tos/conversion/get-information.md#the-outputstatistics-section)

```JSON
{
    ...
    "outputStatistics": {
        ...
        "boundingBox": {
            "min": [
                -43.52,
                -61.775,
                -79.6416
            ],
            "max": [
                43.52,
                61.775,
                79.6416
            ]
        }
    }
}
```

Коробка границ описывается как `min` `max` и положение в 3D пространстве, в метрах. Таким образом, координата 1000.0 означает, что она находится в 1 километре от места происхождения.

Там может быть две проблемы с этой ограничивающей поле, которые приводят к невидимой геометрии:
* **Коробка может быть далеко от центра,** поэтому объект обрезан вообще из-за далекой плоскости отсечения. Значения `boundingBox` в этом случае будет выглядеть следующим образом: `min = [-2000, -5,-5], max = [-1990, 5,5]`, используя большое смещение на оси X в качестве примера здесь. Чтобы решить этот тип проблемы, включите опцию `recenterToOrigin` в [конфигурации преобразования модели.](../how-tos/conversion/configure-model-conversion.md)
* **Коробка может быть по центру, но быть порядка величины слишком велика.** Это означает, что, хотя камера запускается в центре модели, ее геометрия обрезана во всех направлениях. Типичные `boundingBox` значения в этом случае `min = [-1000,-1000,-1000], max = [1000,1000,1000]`будут выглядеть следующим образом: . Причиной такого рода проблемы, как правило, несоответствие масштаба единицы. Чтобы компенсировать это значение [масштабирования во время преобразования](../how-tos/conversion/configure-model-conversion.md#geometry-parameters) или наметьте исходную модель правильными единицами. Масштабирование также может быть применено к корневому узлам при загрузке модели во время выполнения.

**Конвейер визуализации Unity не включает в себя крючки рендера:**

Azure Remote Rendering подключается к конвейеру визуализации Unity, чтобы сделать композицию кадра с видео и сделать репроекцию. Чтобы убедиться, что эти крючки существуют, откройте окно > анализа меню *> кадра.* Включите его и убедитесь, `HolographicRemotingCallbackPass` что есть две записи для конвейера:

![Отладка кадра Unity](./media/troubleshoot-unity-pipeline.png)

## <a name="unity-code-using-the-remote-rendering-api-doesnt-compile"></a>Код unity с помощью API удаленного рендеринга не компилируется

Переключите *тип сборки* решения Unity на **debug.** При тестировании ARR в `UNITY_EDITOR` редакторе Unity определение доступно только в сборках 'Debug'. Обратите внимание, что это не связано с типом сборки, используемым для [развернутых приложений,](../quickstarts/deploy-to-hololens.md)где следует предпочесть сборки 'Release'.

## <a name="unstable-holograms"></a>Нестабильные голограммы

В случае, если отображенные объекты, кажется, движутся вместе с движениями головы, вы можете столкнуться с проблемами с *поздней стадией репроекции* (LSR). Обратитесь к разделу о [поздней стадии репроекции](../overview/features/late-stage-reprojection.md) для получения рекомендаций о том, как подойти к такой ситуации.

Еще одной причиной нестабильных голограмм (колеблющихся, деформационных, дрожащих или прыгающих голограмм) может быть плохое подключение к сети, в частности недостаточная пропускная способность сети или слишком высокая задержка. Хорошим показателем качества сетевого соединения является значение `ARRServiceStats.VideoFramesReused` [статистики производительности.](../overview/features/performance-queries.md) Повторно используемые кадры указывают на ситуации, когда старый видеокадр необходимо повторно использовать на стороне клиента, потому что не было доступно нового видео- - например, из-за потери пакета или из-за изменений в задержке сети. Если `ARRServiceStats.VideoFramesReused` часто больше нуля, это указывает на сетевую проблему.

Еще одно значение, `ARRServiceStats.LatencyPoseToReceiveAvg`чтобы посмотреть на это . Она должна постоянно быть ниже 100 мс. Если вы видите более высокие значения, это означает, что вы подключены к центру обработки данных, который находится слишком далеко.

Список потенциальных мер по смягчению последствий можно узнать в [руководстве по подключению к сети.](../reference/network-requirements.md#guidelines-for-network-connectivity)

## <a name="next-steps"></a>Дальнейшие действия

* [Требования к системе](../overview/system-requirements.md)
* [Требования к сети](../reference/network-requirements.md)
