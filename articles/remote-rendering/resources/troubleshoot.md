---
title: Устранение неполадок
description: Сведения об устранении неполадок для удаленной подготовки к просмотру Azure
author: florianborn71
ms.author: flborn
ms.date: 02/25/2020
ms.topic: troubleshooting
ms.openlocfilehash: b86af2ff8fad3793fc47cec9399fd499c1cabba7
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81681857"
---
# <a name="troubleshoot"></a>Устранение неполадок

На этой странице перечислены распространенные проблемы, мешающие удаленному отображению Azure, и способы их устранения.

## <a name="client-cant-connect-to-server"></a>Клиенту не удается подключиться к серверу

Убедитесь, что брандмауэры (на устройстве, в маршрутизаторах и т. д.) не блокируют следующие порты:

* **50051 (TCP)** — требуется для начального подключения (подтверждение HTTP)
* **8266 (TCP + UDP)** — требуется для обмена данными
* **5000 (TCP)**, **5433 (tcp)**, **8443 (TCP)** — требуется для [арринспектор](tools/arr-inspector.md)

## <a name="error-disconnected-videoformatnotavailable"></a>Ошибка "disconnected: Видеоформатнотаваилабле"

Убедитесь, что GPU поддерживает аппаратное декодирование видео. См. раздел [Разработка ПК](../overview/system-requirements.md#development-pc).

Если вы работаете на ноутбуке с двумя графическими процессорами, возможно, что GPU, который вы используете по умолчанию, не предоставляет функции декодирования аппаратного видео. Если это так, попробуйте заставить приложение использовать другой GPU. Это часто возможно в параметрах драйвера GPU.

## <a name="h265-codec-not-available"></a>Кодек H265 недоступен

Существует две причины, по которым сервер может отказать в подключении с помощью **кодека, недоступного** для ошибки.

**Кодек H265 не установлен:**

Сначала убедитесь, что установлены **расширения видео HEVC** , как упоминалось в разделе [программное обеспечение](../overview/system-requirements.md#software) требований к системе.

Если проблемы продолжают возникать, убедитесь, что ваша графическая плата поддерживает H265 и у вас установлена последняя версия драйвера графики. Сведения о конкретных поставщиках см. в разделе [Разработка ПК](../overview/system-requirements.md#development-pc) статьи требования к системе.

**Кодек установлен, но его нельзя использовать:**

Причиной этой проблемы является неправильная настройка безопасности для библиотек DLL. Эта проблема не проявляется при попытке просмотра видео, закодированных с помощью H265. Переустановка кодека не решает проблему. Вместо этого выполните следующие действия.

1. Откройте **PowerShell с правами администратора** и выполните команду.

    ```PowerShell
    Get-AppxPackage -Name Microsoft.HEVCVideoExtension
    ```
  
    Эта команда должна выводить `InstallLocation` в коде кодек, что примерно так:
  
    ```cmd
    InstallLocation   : C:\Program Files\WindowsApps\Microsoft.HEVCVideoExtension_1.0.23254.0_x64__5wasdgertewe
    ```

1. Открыть эту папку в проводнике Windows
1. Должна быть вложенная папка **x86** и **x64** . Щелкните правой кнопкой мыши одну из папок и выберите пункт **Свойства** .
    1. Перейдите на вкладку **Безопасность** и нажмите кнопку **Дополнительные** параметры.
    1. Нажмите кнопку **изменить** для **владельца** .
    1. Введите **Администраторы** в текстовое поле.
    1. Нажмите кнопку **Проверить имена** и **ОК** .
1. Повторите описанные выше действия для другой папки.
1. Кроме того, повторите описанные выше действия для каждого файла DLL в обеих папках. Должны быть все четыре библиотеки DLL.

Чтобы убедиться, что параметры теперь верны, сделайте это для каждой из четырех библиотек DLL:

1. Выберите **свойства > безопасность > изменить** .
1. Просмотрите список всех **групп и пользователей** и убедитесь, что у каждого из них есть набор прав на **Чтение & выполнения** (флажок в столбце **Разрешить** должен быть тактовым).

## <a name="low-video-quality"></a>Низкое качество видео

Качество видео может быть скомпрометировано либо по качеству сети, либо по отсутствующему видеокодеку H265.

* См. инструкции по [выявлению сетевых проблем](#unstable-holograms).
* См. [требования к системе](../overview/system-requirements.md#development-pc) для установки последней версии графического драйвера.

## <a name="video-recorded-with-mrc-does-not-reflect-the-quality-of-the-live-experience"></a>Видео, записанное в соответствии с нормативным материалом, не отражает качество интерактивной работы

Видео можно записать в Hololens с помощью [записи смешанной реальности (нормативная ситуация)](https://docs.microsoft.com/windows/mixed-reality/mixed-reality-capture-for-developers). Однако полученное видео имеет хуже качество по сравнению с интерактивным интерфейсом по двум причинам:
* Частота видеочастотного видео ограничена 30 Гц, а не 60 Гц.
* Видеоизображения не проходят шаг по обработке с [поздним этапом](../overview/features/late-stage-reprojection.md) , поэтому видео кажется чоппиер.

Оба являются ограничениями метода записи.

## <a name="black-screen-after-successful-model-loading"></a>Черный экран после успешной загрузки модели

Если вы подключаетесь к среде выполнения отрисовки и успешно загрузили модель, но потом видите только черный экран, это может привести к некоторым незначительным причинам.

Перед выполнением более подробного анализа рекомендуется протестировать следующие вещи:

* Установлен ли кодек H265? Хотя в кодеке H264 Single bitrate должен быть резервный вариант, мы видели случаи, когда эта резервная стратегия работала неправильно. См. [требования к системе](../overview/system-requirements.md#development-pc) для установки последней версии графического драйвера.
* При использовании проекта Unity закройте Unity, удалите временную *библиотеку* и папки *obj* в каталоге проекта, а затем загрузите или повторите сборку проекта. В некоторых случаях кэшированные данные вызвали неправильное функционирование примера.

Если эти два действия не помогли, необходимо выяснить, получены ли видеоматериалы клиентом. Это можно запросить программно, как описано в главе [запросы производительности на стороне сервера](../overview/features/performance-queries.md) . `FrameStatistics struct` Содержит элемент, указывающий количество полученных видеокадров. Если это число больше 0 и со временем увеличивается, клиент получает фактические видеоматериалы с сервера. Следовательно, на стороне клиента это должно быть проблемой.

### <a name="common-client-side-issues"></a>Распространенные проблемы на стороне клиента

**Модель не находится внутри представления фрустум:**

Во многих случаях модель отображается правильно, но находится за пределами камеры фрустум. Распространенной причиной является то, что модель была экспортирована с помощью далекого от центра сводной таблицы, поэтому она обрезается с помощью дальней плоскости. Он позволяет программно запрашивать ограничивающий прямоугольник модели и визуализировать поле с помощью Unity в виде строки или распечатывать его значения в журнале отладки.

Кроме того, процесс преобразования создает [выходной JSON файл](../how-tos/conversion/get-information.md) вместе с преобразованной моделью. Чтобы отладить проблемы позиционирования модели, стоит взглянуть на `boundingBox` запись в [разделе аутпутстатистикс](../how-tos/conversion/get-information.md#the-outputstatistics-section):

```JSON
{
    ...
    "outputStatistics": {
        ...
        "boundingBox": {
            "min": [
                -43.52,
                -61.775,
                -79.6416
            ],
            "max": [
                43.52,
                61.775,
                79.6416
            ]
        }
    }
}
```

Ограничивающий прямоугольник описывается как `min` и `max` позицией в трехмерном пространстве в метрах. Таким образом, координата 1000,0 означает, что она находится на расстоянии 1 километра от источника.

Возможны две проблемы с этим ограничивающим прямоугольником, приводящие к невидимой геометрии:
* **Поле может находиться далеко от центра**, поэтому объект полностью обрезается из-за дальней обрезки. `boundingBox` Значения в этом случае будут выглядеть следующим образом: `min = [-2000, -5,-5], max = [-1990, 5,5]`, используя большое смещение на оси x в качестве примера. Чтобы устранить проблему такого типа, включите `recenterToOrigin` параметр в [конфигурации преобразования модели](../how-tos/conversion/configure-model-conversion.md).
* **Поле может быть центрировано, но заказы слишком велики**. Это означает, что хотя Камера запускается в центре модели, ее геометрия обрезается во всех направлениях. Типичные `boundingBox` значения в этом случае будут выглядеть следующим образом `min = [-1000,-1000,-1000], max = [1000,1000,1000]`:. Причиной такого типа проблемы обычно является несоответствие масштабирования единиц. Чтобы компенсировать, укажите [значение масштабирования во время преобразования](../how-tos/conversion/configure-model-conversion.md#geometry-parameters) или пометьте исходную модель правильными единицами. Масштабирование можно также применить к корневому узлу при загрузке модели во время выполнения.

**Конвейер прорисовки Unity не включает обработчики прорисовки:**

Модуль удаленной подготовки отчетов Azure переводится в конвейер прорисовки Unity, чтобы выполнить композицию кадров с помощью видео и выполнить репроекцию. Чтобы убедиться, что эти ловушки существуют, откройте *окно меню > анализ > кадров отладчик*. Включите его и убедитесь, что `HolographicRemotingCallbackPass` в конвейере есть две записи:

![Отладчик фреймов Unity](./media/troubleshoot-unity-pipeline.png)

## <a name="unity-code-using-the-remote-rendering-api-doesnt-compile"></a>Код Unity, использующий API удаленной отрисовки, не компилируется

Переключить *тип сборки* решения Unity на **отладку**. При тестировании ARR в редакторе Unity определение `UNITY_EDITOR` доступно только в сборках "Отладка". Обратите внимание, что это не связано с типом сборки, используемым для [развернутых приложений](../quickstarts/deploy-to-hololens.md), где предпочтительнее использовать сборки Release.

## <a name="unstable-holograms"></a>Нестабильная голограмма

Если визуализированные объекты перемещаются вместе с перемещениями головок, могут возникнуть проблемы с *поздним этапом РЕПРОЕКЦИИ* (ЛСР). Дополнительные сведения о том, как подходить к такой ситуации, см. в разделе о перепланировании [последних этапов](../overview/features/late-stage-reprojection.md) .

Другой причиной нестабильной голограммы (Вобблинг, искривление, колебание или голограммы) может быть плохое сетевое подключение, в частности недостаточную пропускную способность сети или слишком высокую задержку. Хорошим индикатором для качества сетевого подключения является значение `ARRServiceStats.VideoFramesReused` [статистики производительности](../overview/features/performance-queries.md) . Повторно используемые кадры указывают на ситуации, когда старый видеокадр необходимо повторно использовать на стороне клиента, поскольку новый видеокадр был недоступен, например из-за потери пакетов или из-за вариаций задержки сети. Если `ARRServiceStats.VideoFramesReused` значение чаще всего больше нуля, это указывает на проблему в сети.

Другое значение для просмотра: `ARRServiceStats.LatencyPoseToReceiveAvg`. Он должен быть постоянно ниже 100 мс. Если вы видите более высокие значения, это означает, что вы подключены к центру обработки данных, который находится слишком далеко.

Список возможных мер по устранению неполадок см. в разделе [рекомендации по подключению к сети](../reference/network-requirements.md#guidelines-for-network-connectivity).

## <a name="next-steps"></a>Дальнейшие действия

* [Требования к системе](../overview/system-requirements.md)
* [Сетевые требования](../reference/network-requirements.md)
