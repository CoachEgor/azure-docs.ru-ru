---
title: Отображение материалов для форматов моделей
description: Описывает преобразование по умолчанию из форматов исходного кода модели в материал PBR
author: jakrams
ms.author: jakras
ms.date: 02/11/2020
ms.topic: reference
ms.openlocfilehash: ce287ed94066aac4b900d2ddb02579a54b8550f6
ms.sourcegitcommit: 642a297b1c279454df792ca21fdaa9513b5c2f8b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80680392"
---
# <a name="material-mapping-for-model-formats"></a>Отображение материалов для форматов моделей

Когда исходный актив [преобразуется в модель,](../how-tos/conversion/model-conversion.md)конвертер создает [материалы](../concepts/materials.md) для каждой [сетки.](../concepts/meshes.md) Способ создания материалов может быть [перекрыт.](../how-tos/conversion/override-materials.md) Однако по умолчанию конверсия создаст [материалы PBR.](../overview/features/pbr-materials.md) Поскольку каждый формат исходного файла, как FBX, использует свои собственные конвенции для определения материалов, эти конвенции должны быть отображены в материальных параметрах PBR удаленного рендеринга Azure. 

В этой статье перечислены точные отображения, используемые для преобразования материалов из исходных ресурсов в материалы времени выполнения.

## <a name="gltf"></a>glTF

Почти все, от glTF 2.0 спецификации поддерживается в Azure удаленного рендеринга, за исключением *EmissiveFactor* и *EmissiveTexture*.

Сопоставление показано в следующей таблице.

| glTF | Удаленная отрисовка Azure |
|:-------------------|:--------------------------|
|   базовыйColorFactor   |   альбедоКолор              |
|   baseColorTexture  |   альбедоМап                |
|   metallicFactor    |   металлоконструкции                |
|   металлическаятекстура   |   металлоконструкцийКарта             |
|   шероховатостиФактор   |   Шероховатости                |
|   шероховатостьТекстура  |   шероховатостиКарта             |
|   occlusionFactor   |   Окклюзии                |
|   окклюзияТекстура  |   occlusionMap             |
|   нормальнаяТекстура     |   normalMap                |
|   alphaCutoff       |   alphaClipThreshold       |
|   alphaMode.ОПЕРЕЗУ  |   alphaClipEnabled - ложный, прозрачный - ложный |
|   alphaMode.MASK    |   alphaClipEnabled - правда, являетсяПрозрачным и ложным  |
|   alphaMode.BLEND   |   являетсяПрозрачным и верно     |
|   doubleSided       |   isDoubleSided            |
|   emissiveFactor    |   -                        |
|   эмиссивнаятекстура   |   -                        |

Каждая текстура в glTF может иметь `texCoord` значение, которое также поддерживается в материалах удаленного отжима Azure.

### <a name="embedded-textures"></a>Встроенные текстуры

Текстуры, * \** встроенные в файлы .bin или * \*.glb,* поддерживаются.

### <a name="supported-gltf-extension"></a>Поддерживаемое расширение glTF

Подополнение к базовому набору функций, удаленное отображаемее Azure поддерживает следующие расширения glTF:

* [MSFT_packing_occlusionRoughnessMetallic](https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Vendor/MSFT_packing_occlusionRoughnessMetallic/README.md)
* [MSFT_texture_dds](https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Vendor/MSFT_texture_dds/README.md)
* [KHR_materials_unlit](https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_materials_unlit/README.md): Соответствует [цветным материалам.](../overview/features/color-materials.md) Для *эмиссионных* материалов рекомендуется использовать это расширение.
* [KHR_materials_pbrSpecularGlossiness](https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/README.md): Вместо текстур металлической грубости, вы можете обеспечить диффузно-спекулятивно-глянцевость текстур. Реализация удаленного рендеринга Azure непосредственно следует формулам преобразования из расширения.

## <a name="fbx"></a>Fbx

Формат FBX имеет закрытый исходный исход, а материалы FBX не совместимы с материалами PBR в целом. FBX использует сложное описание поверхностей со многими уникальными параметрами и свойствами, и **не все из них используются конвейером удаленного рендеринга Azure.**

> [!IMPORTANT]
> Конвейер преобразования модели удаленного рендеринга Azure поддерживает только **FBX 2011 и выше.**

Формат FBX определяет консервативный подход к материалам, в официальной спецификации FBX есть только два типа:

* *Ламберт* - Не обычно используется в течение довольно продолжительного времени уже, но он по-прежнему поддерживается путем преобразования в Phong во время преобразования.
* *Phong* - Почти все материалы и большинство инструментов содержания используют этот тип.

Модель Phong является более точной и используется в качестве *единственной* модели для материалов FBX. Ниже он будет называться *FBX Материал*.

> Maya использует два пользовательских расширения для FBX, определяя пользовательские свойства для типов PBR и Stingray материала. Эти сведения не включены в спецификацию FBX, поэтому в настоящее время они не поддерживаются удаленной визуализацией Azure.

FBX Materials используют концепцию Diffuse-Specular-SpecularLevel, поэтому для преобразования из диффузной текстуры в карту альбедо нам необходимо вычислить другие параметры, чтобы вычесть их из диффузной.

> Все цвета и текстуры в FBX находятся в пространстве sRGB (также известном как Гамма-пространство), но Azure Remote Rendering работает с линейным пространством во время визуализации и в конце кадра преобразует все обратно в пространство sRGB. Конвейер удаленного рендеринга Azure преобразует все в линее пространство, чтобы отправить его в качестве подготовленных данных рендеру.

В этой таблице показано, как текстуры отображаются из материалов FBX в материалы удаленного отображения Azure. Некоторые из них используются напрямую не только в сочетании с другими текстурами, участвующими в формулах (например, диффузная текстура):

| Fbx | Удаленная отрисовка Azure |
|:-----|:----|
| АмбиентКолор | Карта окклюзии   |
| ДиффузныйЦвет | *используется для Альбедо, Металлисс* |
| ПрозрачныйЦвет | *используется для альфа-канала Альбедо* |
| ПрозрачностьФактор | *используется для альфа-канала Альбедо* |
| Непрозрачность | *используется для альфа-канала Альбедо* |
| SpecularColor | *используется для Альбедо, Металлизность, Грубость* |
| SpecularFactor| *используется для Альбедо, Металлизность, Грубость* |
| ShininessЭкспонент | *используется для Альбедо, Металлизность, Грубость* |
| NormalMap | NormalMap |
| Удар | *преобразованный в NormalMap* |
| EmissiveColor | - |
| Эмисивативнойфактор | - |
| ОтражениеЦвет | - |
| ПеремещениеЦвет | - |

Приведенное выше отображение является наиболее сложной частью преобразования материала, из-за многих предположений, которые должны быть сделаны. Мы обсуждаем эти предположения ниже.

Некоторые определения, используемые ниже:

* `Specular` =  `SpecularColor` * `SpecularFactor`
* `SpecularIntensity` = `Specular`. Красный цвет 0,2125 евро `Specular`. Зеленый цвет 0,7154 евро `Specular`. Синий цвет 0,0721
* `DiffuseBrightness`0,299 евро `Diffuse`. Красный<sup>2</sup> ю 0,587 . `Diffuse` Зеленый<sup>цвет 2</sup> и `Diffuse`0,114 . Синий<sup>2</sup>
* `SpecularBrightness`0,299 евро `Specular`. Красный<sup>2</sup> ю 0,587 . `Specular` Зеленый<sup>цвет 2</sup> и `Specular`0,114 . Синий<sup>2</sup>
* `SpecularStrength`Макс(.`Specular` Красный, `Specular`. Зеленый, `Specular`. Синий)

Формула SpecularIntensity получена [отсюда](https://en.wikipedia.org/wiki/Luma_(video)).
Формула яркости описана в этой [спецификации.](http://www.itu.int/dms_pubrec/itu-r/rec/bt/R-REC-BT.601-7-201103-I!!PDF-E.pdf)

### <a name="roughness"></a>Шероховатости

`Roughness`рассчитывается `Specular` из `ShininessExponent` и с использованием [этой формулы.](https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf) Формула представляет собой приближение шероховатостей от спектрального экспонента Фонга:

```Cpp
Roughness = sqrt(2 / (ShininessExponent * SpecularIntensity + 2))
```

### <a name="metalness"></a>Металлизность

`Metalness`рассчитывается `Diffuse` из `Specular` и с использованием этой [формулы из спецификации glTF.](https://github.com/bghgary/glTF/blob/gh-pages/convert-between-workflows-bjs/js/babylon.pbrUtilities.js)

Идея здесь заключается в том, что мы решаем уравнение: Ax<sup>2</sup> и Bx и C 0.
В основном, диэлектрические поверхности отражают около 4% света в зеркальном смысле, а остальное диффузное. Металлические поверхности не отражают света в диффузном пути, но все в зеркальном смысле.
Эта формула имеет несколько недостатков, потому что нет никакого способа отличить глянцевый пластик от глянцевых металлических поверхностей. Мы предполагаем, большую часть времени поверхность имеет металлические свойства, и, следовательно, глянцевые пластиковые / резиновые поверхности не может выглядеть как ожидалось.
```cpp
dielectricSpecularReflectance = 0.04
oneMinusSpecularStrength = 1 - SpecularStrength

A = dielectricSpecularReflectance
B = (DiffuseBrightness * (oneMinusSpecularStrength / (1 - A)) + SpecularBrightness) - 2 * A
C = A - SpecularBrightness
squareRoot = sqrt(max(0.0, B * B - 4 * A * C))
value = (-B + squareRoot) / (2 * A)
Metalness = clamp(value, 0.0, 1.0);
```

### <a name="albedo"></a>Альбедо

`Albedo`вычисляется `Diffuse` `Specular`из, `Metalness`и .

Как описано в разделе Metalness, диэлектрические поверхности отражают около 4% света.  
Идея здесь заключается в линейном интерполировании между `Dielectric` цветами, `Metal` используя `Metalness` значение в качестве фактора. Если `0.0`металлность, то в зависимости от спекулятивного это будет либо темный цвет (если зеркальный высокий) или диффузный не изменится (если нет зеркального присутствует). Если металлолин является большим значением, то диффузный цвет исчезнет в пользу зеркального цвета.

```Cpp
dielectricSpecularReflectance = 0.04
oneMinusSpecularStrength = 1 - SpecularStrength

dielectricColor = diffuseColor * (oneMinusSpecularStrength / (1.0f - dielectricSpecularReflectance) / max(1e-4, 1.0 - metalness))
metalColor = (Specular - dielectricSpecularReflectance * (1.0 - metalness)) * (1.0 / max(1e-4, metalness))
albedoRawColor = lerpColors(dielectricColor, metalColor, metalness * metalness)
AlbedoRGB = clamp(albedoRawColor, 0.0, 1.0);
```

`AlbedoRGB`была вычислена по формуле выше, но альфа-канал требует дополнительных вычислений. Формат FBX является расплывчатым о прозрачности и имеет много способов определить его. Различные инструменты содержания используют различные методы. Идея здесь состоит в том, чтобы объединить их в одну формулу. Это делает некоторые активы неправильно показаны как прозрачные, хотя, если они не созданы общим способом.

Это вычисляется `TransparencyFactor` `Opacity`из `TransparentColor`, :

если `Opacity` определяется, а затем `AlbedoAlpha`  =  `Opacity` использовать его непосредственно: другие  
если `TransparencyColor` определяется, `AlbedoAlpha` то 1,0`TransparentColor`- ((( . Красный `TransparentColor`й . Зеленый `TransparentColor`цвет . Синий) / 3.0) еще  
если, `TransparencyFactor` `AlbedoAlpha` то 1,0 -`TransparencyFactor`

Окончательный `Albedo` цвет имеет четыре `AlbedoRGB` канала, `AlbedoAlpha`сочетая с .

### <a name="summary"></a>Сводка

Подводя `Albedo` итог здесь, `Diffuse`будет `Specular` очень близко к оригиналу, если близко к нулю. В противном случае поверхность будет выглядеть как металлическая поверхность и теряет диффузный цвет. Поверхность будет выглядеть более полированной и отражающей, если `ShininessExponent` достаточно велика и `Specular` яркая. В противном случае поверхность будет выглядеть грубо и едва отражает окружающую среду.

### <a name="known-issues"></a>Известные проблемы

* Текущая формула не работает хорошо для простой цветной геометрии. Если `Specular` достаточно яркий, то все геометрии становятся отражающими металлическими поверхностями без какого-либо цвета. Обходной путь здесь `Specular` заключается в том, чтобы снизить до 30% от оригинала или использовать настройки преобразования [fbxAssumeMetallic](../how-tos/conversion/configure-model-conversion.md#converting-from-older-fbx-formats-with-a-phong-material-model).
* Недавно к инструментам `Maya` создания `3DS Max` контента были добавлены материалы PBR и инструменты создания контента. Они используют пользовательские свойства черного ящика с пользовательским пользователем, чтобы передать их FBX. Удаленное рендеринг Azure не считывает эти дополнительные свойства, поскольку они не документированы, а формат закрыт.

## <a name="next-steps"></a>Дальнейшие действия

* [Преобразование модели](../how-tos/conversion/model-conversion.md)
* [Переопределение материалов при преобразовании модели](../how-tos/conversion/override-materials.md)
