---
title: Используйте управляемые идентификаторы в службе Azure Kubernetes
description: Узнайте, как использовать управляемые идентификаторы в службе Azure Kubernetes (AKS)
services: container-service
author: saudas
manager: saudas
ms.topic: article
ms.date: 03/10/2019
ms.author: saudas
ms.openlocfilehash: 85efc6d9d203ca06c5f7566376993b4c13950788
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80369972"
---
# <a name="use-managed-identities-in-azure-kubernetes-service"></a>Используйте управляемые идентификаторы в службе Azure Kubernetes

В настоящее время кластер Azure Kubernetes Service (AKS) (в частности, поставщик облачных услуг Kubernetes) требует *создания дополнительных* ресурсов, таких как балансеры нагрузки и управляемые диски в Azure. Либо вы должны предоставить услугу основной или AKS создает один от вашего имени. Принципы обслуживания обычно имеют срок годности. Кластеры в конечном итоге достигают состояния, в котором основной службы должен быть обновлен, чтобы сохранить работу кластера. Управление принципами обслуживания добавляет сложности.

*Управляемые идентификаторы* по существу являются оберткой вокруг директоров служб и упрощают их управление. Чтобы узнать больше, прочитайте об [управляемых идентификаторах для ресурсов Azure.](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)

AKS создает две управляемые идентификаторы:

- **Управляемая система :** Идентификация, которую поставщик облачных услуг Kubernetes использует для создания ресурсов Azure от имени пользователя. Жизненный цикл установленного системы связан с циклом кластера. Идентификация удаляется при удалении кластера.
- **Назначенный пользователем управляемый иственный:** Идентификация, используемая для авторизации в кластере. Например, назначенная пользователем идентификация используется для разрешения AKS использовать реестры контейнеров Azure (ACRs) или для разрешения кубелета получать метаданные из Azure.

Дополнения также аутентифицируются с помощью управляемой идентификации. Для каждого дополнения управляемая идентификация создается AKS и длится всю жизнь надстройки. Для создания и использования собственного VNet, статического IP-адреса или присоединенного диска Azure, на котором ресурсы находятся за пределами группы ресурсов MC_, используйте PrincipalID кластера для выполнения ролевой задачи. Для получения дополнительной информации [Delegate access to other Azure resources](kubernetes-service-principal.md#delegate-access-to-other-azure-resources)о назначении ролей см.

## <a name="before-you-begin"></a>Перед началом

Необходимо установить следующий ресурс:

- Azure CLI, версия 2.2.0 или позже

## <a name="create-an-aks-cluster-with-managed-identities"></a>Создание кластера AKS с управляемыми идентификаторами

Теперь можно создать кластер AKS с управляемыми идентификаторами, используя следующие команды CLI.

Во-первых, создайте группу ресурсов Azure:

```azurecli-interactive
# Create an Azure resource group
az group create --name myResourceGroup --location westus2
```

Затем создайте кластер AKS:

```azurecli-interactive
az aks create -g MyResourceGroup -n MyManagedCluster --enable-managed-identity
```

Успешное создание кластера с использованием управляемых идентификаторов содержит основную информацию профиля службы:

```json
"servicePrincipalProfile": {
    "clientId": "msi",
    "secret": null
  }
```

Наконец, получите учетные данные для доступа к кластеру:

```azurecli-interactive
az aks get-credentials --resource-group myResourceGroup --name MyManagedCluster
```

Кластер будет создан в течение нескольких минут. Затем можно развернуть рабочие нагрузки приложения в новый кластер и взаимодействовать с ним так же, как это было с кластерами AKS, основанными на основных службах.

> [!IMPORTANT]
>
> - Кластеры AKS с управляемыми идентификаторами могут быть включены только при создании кластера.
> - Существующие кластеры AKS не могут быть обновлены или обновлены для включения управляемых идентификаторов.
