---
title: Использование управляемых удостоверений в службе Kubernetes Azure
description: Узнайте, как использовать управляемые удостоверения в службе Kubernetes Azure (AKS).
services: container-service
author: saudas
manager: saudas
ms.topic: article
ms.date: 04/02/2020
ms.author: saudas
ms.openlocfilehash: 00ecc077ba55ab9f91fc58f8a47fcdf7440deea6
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82112972"
---
# <a name="use-managed-identities-in-azure-kubernetes-service"></a>Использование управляемых удостоверений в службе Kubernetes Azure

В настоящее время в кластере Azure Kubernetes Service (AKS) (в частности, поставщике Kubernetes Cloud) требуется удостоверение для создания дополнительных ресурсов, таких как подсистемы балансировки нагрузки и управляемые диски в Azure. это удостоверение может быть *управляемым удостоверением* или *субъектом-службой*. При использовании [субъекта-службы](kubernetes-service-principal.md)необходимо предоставить один или AKS от вашего имени. Если вы используете управляемое удостоверение, оно будет создано автоматически AKS. Кластеры, использующие субъекты-службы, в конечном итоге достигают состояния, в котором необходимо обновить субъект-службу, чтобы обеспечить работу кластера. Управление субъектами-службами повышает сложность, поэтому вместо этого проще использовать управляемые удостоверения. Те же требования к разрешениям применяются и к субъектам-службам, и к управляемым удостоверениям.

*Управляемые удостоверения* по сути являются оболочкой для субъектов-служб и упрощают их управление. Дополнительные сведения см. в статье об [управляемых удостоверениях для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview).

AKS создает два управляемых удостоверения:

- **Управляемое удостоверение, назначенное системой**: удостоверение, которое поставщик облачных служб Kubernetes использует для создания ресурсов Azure от имени пользователя. Жизненный цикл удостоверения, назначенного системой, привязан к кластеру. Удостоверение удаляется при удалении кластера.
- **Управляемое пользователем удостоверение**: удостоверение, используемое для авторизации в кластере. Например, назначенное пользователем удостоверение используется для авторизации AKS для использования реестров контейнеров Azure (записи контроля доступа) или для авторизации kubelet получения метаданных из Azure.

Надстройки также проходят проверку подлинности с помощью управляемого удостоверения. Для каждой надстройки управляемое удостоверение создается AKS и продолжается в течение жизненного цикла надстройки. 

## <a name="before-you-begin"></a>Подготовка к работе

Необходимо установить следующий ресурс:

- Azure CLI версии 2.2.0 или более поздней.

## <a name="create-an-aks-cluster-with-managed-identities"></a>Создание кластера AKS с управляемыми удостоверениями

Теперь можно создать кластер AKS с управляемыми удостоверениями с помощью следующих команд интерфейса командной строки.

Сначала создайте группу ресурсов Azure:

```azurecli-interactive
# Create an Azure resource group
az group create --name myResourceGroup --location westus2
```

Затем создайте кластер AKS:

```azurecli-interactive
az aks create -g MyResourceGroup -n MyManagedCluster --enable-managed-identity
```

Успешное создание кластера с помощью управляемых удостоверений содержит следующие сведения о профиле субъекта-службы:

```json
"servicePrincipalProfile": {
    "clientId": "msi",
    "secret": null
  }
```

> [!NOTE]
> Чтобы создать и использовать собственную виртуальную сеть, статический IP-адрес или подключенный диск Azure, где ресурсы выходят за пределы группы ресурсов MC_ *, используйте PrincipalID назначенной системой кластера управляемого удостоверения для выполнения назначения ролей. Дополнительные сведения о назначении ролей см. в статье [Делегирование доступа к другим ресурсам Azure](kubernetes-service-principal.md#delegate-access-to-other-azure-resources).
>
> Предоставление разрешений на управляемое удостоверение кластера, используемое поставщиком облачных служб Azure, может занять 60 минут для заполнения.

Наконец, получите учетные данные для доступа к кластеру:

```azurecli-interactive
az aks get-credentials --resource-group myResourceGroup --name MyManagedCluster
```

Кластер будет создан через несколько минут. Затем можно развернуть рабочие нагрузки приложений в новом кластере и взаимодействовать с ним так же, как и с кластерами AKS на основе субъектов-служб.

> [!IMPORTANT]
>
> - Кластеры AKS с управляемыми удостоверениями могут быть включены только во время создания кластера.
> - Существующие кластеры AKS не могут быть обновлены или обновлены для включения управляемых удостоверений.
