---
title: Использование управляемых удостоверений в службе Kubernetes Azure
description: Узнайте, как использовать управляемые удостоверения в службе Kubernetes Azure (AKS).
services: container-service
author: saudas
manager: saudas
ms.service: container-service
ms.topic: article
ms.date: 09/11/2019
ms.author: saudas
ms.openlocfilehash: 16a1f3b8f9ef036bcdc9af122243d313186f99f1
ms.sourcegitcommit: cf36df8406d94c7b7b78a3aabc8c0b163226e1bc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2019
ms.locfileid: "73885338"
---
# <a name="preview---use-managed-identities-in-azure-kubernetes-service"></a>Предварительный просмотр — использование управляемых удостоверений в службе Kubernetes Azure

В настоящее время кластер Azure Kubernetes Service (AKS) (в частности, поставщик облачных служб Kubernetes) требует наличия *субъекта-службы* для создания дополнительных ресурсов, таких как подсистемы балансировки нагрузки и управляемые диски в Azure. Либо необходимо предоставить субъект-службу, либо AKS создать его от вашего имени. Субъекты-службы обычно имеют дату окончания срока действия. Кластеры в конечном итоге достигают состояния, в котором необходимо обновить субъект-службу, чтобы обеспечить работу кластера. Управление субъектами-службами повышает сложность.

*Управляемые удостоверения* по сути являются оболочкой для субъектов-служб и упрощают их управление. Дополнительные сведения см. в статье об [управляемых удостоверениях для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview).

AKS создает два управляемых удостоверения:

- **Управляемое удостоверение, назначенное системой**: удостоверение, которое поставщик облачных служб Kubernetes использует для создания ресурсов Azure от имени пользователя. Жизненный цикл удостоверения, назначенного системой, привязан к кластеру. Удостоверение удаляется при удалении кластера.
- **Управляемое пользователем удостоверение**: удостоверение, используемое для авторизации в кластере. Например, назначенное пользователем удостоверение используется для авторизации AKS для использования записей контроля доступа (записи контроля доступа) или для авторизации kubelet получения метаданных из Azure.

В этом периоде предварительной версии субъект-служба все еще является обязательным. Он используется для авторизации таких надстроек, как мониторинг, виртуальные узлы, политика Azure и маршрутизация приложений HTTP. Работа выполняется для удаления зависимостей надстроек в имени участника-службы (SPN). В конечном итоге требование имени участника-службы в AKS будет полностью удалено.

> [!IMPORTANT]
> Функции предварительной версии AKS доступны на уровне самообслуживания. Предварительные версии предоставляются "как есть" и "как есть" и исключаются из соглашений об уровне обслуживания и ограниченной гарантии. Предварительные версии AKS частично охвачены службой поддержки клиентов. Таким образом, эти функции не предназначены для использования в рабочей среде. Дополнительные сведения см. в следующих статьях поддержки:
>
> - [Политики поддержки AKS](support-policies.md)
> - [Часто задаваемые вопросы о поддержке Azure](faq.md)

## <a name="before-you-begin"></a>Перед началом работы

Необходимо установить следующие ресурсы:

- Azure CLI версии 2.0.70 или более поздней.
- Расширение AKS-Preview 0.4.14

Чтобы установить расширение AKS-Preview 0.4.14 или более позднюю версию, используйте следующие Azure CLI команды:

```azurecli
az extension update --name aks-preview
az extension list
```

> [!CAUTION]
> После регистрации функции в подписке в данный момент отмена регистрации этой функции будет невозможна. При включении некоторых функций предварительной версии значения по умолчанию могут использоваться для всех кластеров AKS, созданных позже в подписке. Не включайте предварительные версии функций в производственных подписках. Вместо этого используйте отдельную подписку для тестирования функций предварительной версии и сбора отзывов.

```azurecli-interactive
az feature register --name MSIPreview --namespace Microsoft.ContainerService
```

Чтобы состояние отображалось как **зарегистрированное**, может потребоваться несколько минут. Проверить состояние регистрации можно с помощью команды [AZ Feature List](https://docs.microsoft.com/cli/azure/feature?view=azure-cli-latest#az-feature-list) .

```azurecli-interactive
az feature list -o table --query "[?contains(name, 'Microsoft.ContainerService/MSIPreview')].{Name:name,State:properties.state}"
```

Когда состояние отображается как зарегистрированное, обновите регистрацию поставщика ресурсов `Microsoft.ContainerService` с помощью команды [AZ Provider Register](https://docs.microsoft.com/cli/azure/provider?view=azure-cli-latest#az-provider-register) :

```azurecli-interactive
az provider register --namespace Microsoft.ContainerService
```

## <a name="create-an-aks-cluster-with-managed-identities"></a>Создание кластера AKS с управляемыми удостоверениями

Теперь можно создать кластер AKS с управляемыми удостоверениями с помощью следующих команд интерфейса командной строки.

Сначала создайте группу ресурсов Azure:

```azurecli-interactive
# Create an Azure resource group
az group create --name myResourceGroup --location westus2
```

Затем создайте кластер AKS:

```azurecli-interactive
az aks create -g MyResourceGroup -n MyManagedCluster --enable-managed-identity
```

Наконец, получите учетные данные для доступа к кластеру:

```azurecli-interactive
az aks get-credentials --resource-group myResourceGroup --name MyManagedCluster
```

Кластер будет создан через несколько минут. Затем можно развернуть рабочие нагрузки приложений в новом кластере и взаимодействовать с ним так же, как и с кластерами AKS на основе субъектов-служб.

> [!IMPORTANT]
>
> - Кластеры AKS с управляемыми удостоверениями могут быть включены только во время создания кластера.
> - Существующие кластеры AKS не могут быть обновлены или обновлены для включения управляемых удостоверений.
