---
title: Использование управляемых удостоверений в службе Kubernetes Azure
description: Узнайте, как использовать управляемые удостоверения в службе Kubernetes Azure (AKS).
services: container-service
author: saudas
manager: saudas
ms.service: container-service
ms.topic: article
ms.date: 09/11/2019
ms.author: saudas
ms.openlocfilehash: a5717d8ee44e4d2e086a6e7bc1b7c3d0deb614c8
ms.sourcegitcommit: 7c2dba9bd9ef700b1ea4799260f0ad7ee919ff3b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2019
ms.locfileid: "71827543"
---
# <a name="preview---use-managed-identities-in-azure-kubernetes-service"></a>Предварительный просмотр — использование управляемых удостоверений в службе Kubernetes Azure

Сейчас пользователи должны предоставить субъект-службу или AKS создать его от вашего имени, чтобы кластер AKS (в частности, поставщик облачных служб Kubernetes) мог создавать дополнительные ресурсы, такие как подсистемы балансировки нагрузки и управляемые диски в Azure. Субъекты-службы обычно создаются с датой окончания срока действия. Кластеры в конечном итоге будут обращаться к состоянию, в котором необходимо обновить субъект-службу, иначе кластер не будет работать. Управление субъектами-службами повышает сложность. Управляемые удостоверения — это по сути оболочка для субъектов-служб и упрощения их управления. Дополнительные сведения см. в статье об [управляемых удостоверениях](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview) .

AKS создает два управляемых удостоверения, назначенных системой управляемого удостоверения, и другой пользователь, которому назначено удостоверение. Управляемое удостоверение, назначенное системой, используется поставщиком облачных услуг kubernetes для создания ресурсов Azure от имени пользователя. Жизненный цикл этого назначенного системой управляемого удостоверения привязан к кластеру и удаляется при удалении кластера. AKS также создает управляемое пользователем удостоверение, которое используется в кластере для авторизации AKS для доступа к записи контроля доступа, kubelet для получения метаданных из Azure и т. д.

В этом периоде предварительной версии субъект-служба все еще является обязательным. Он будет использоваться для авторизации таких надстроек, как мониторинг, виртуальный узел, политика Azure и маршрутизация приложений HTTP. Существует работа, позволяющая удалить зависимость от надстроек имени субъекта-службы и в конечном итоге требование имени SPN в AKS будет полностью удалено.

> [!IMPORTANT]
> Функции предварительной версии AKS — это самостоятельная служба. Предварительные версии предоставляются "как есть" и "как есть" и исключаются из соглашений об уровне обслуживания и ограниченной гарантии. Предварительные версии AKS частично покрываются службой поддержки клиентов на основе лучших усилий. Таким образом, эти функции не предназначены для использования в рабочей среде. Дополнительные сведения об отсутствии см. в следующих статьях поддержки:
>
> * [Политики поддержки AKS](support-policies.md)
> * [Часто задаваемые вопросы о поддержке Azure](faq.md)

## <a name="before-you-begin"></a>Перед началом работы

Необходимо следующее:

* Кроме того, требуется Azure CLI версии 2.0.70 или более поздней, а также расширение AKS-Preview 0.4.14

## <a name="install-latest-aks-cli-preview-extension"></a>Установка последнего расширения AKS CLI Preview

Требуется расширение **AKS-Preview 0.4.14** или более поздняя версия.

```azurecli
az extension update --name aks-preview 
az extension list
```

> [!CAUTION]
> Регистрация компонента в подписке в данный момент невозможна. После включения функций предварительной версии можно использовать значения по умолчанию для всех кластеров AKS, созданных в подписке. Не включайте предварительные версии функций в производственных подписках. Используйте отдельную подписку для тестирования функций предварительной версии и сбора отзывов.

```azurecli-interactive
az feature register --name MSIPreview --namespace Microsoft.ContainerService
```

Для отображения *зарегистрированного*состояния может потребоваться несколько минут. Проверить состояние регистрации можно с помощью команды [AZ список_компонентов list] [AZ-Feature-List].

```azurecli-interactive
az feature list -o table --query "[?contains(name, 'Microsoft.ContainerService/MSIPreview')].{Name:name,State:properties.state}"
```

После регистрации состояния обновите регистрацию поставщика ресурсов *Microsoft. ContainerService* с помощью команды [AZ Provider Register] [AZ-регистратор-Register]:

```azurecli-interactive
az provider register --namespace Microsoft.ContainerService
```

## <a name="create-an-aks-cluster-with-managed-identity"></a>Создание кластера AKS с управляемым удостоверением

Теперь можно создать кластер AKS с управляемыми удостоверениями с помощью следующей команды CLI.
```azurecli-interactive
# Create an Azure resource group
az group create --name myResourceGroup --location westus2
```

## <a name="create-an-aks-cluster"></a>Создание кластера AKS
```azurecli-interactive
az aks create -g MyResourceGroup -n MyManagedCluster --enable-managed-identity
```

## <a name="get-credentials-to-access-the-cluster"></a>Получение учетных данных для доступа к кластеру
```azurecli-interactive
az aks get-credentials --resource-group myResourceGroup --name MyManagedCluster
```
После создания кластера в течение нескольких минут можно развернуть рабочие нагрузки приложения и взаимодействовать с ним так же, как и с AKS кластерами на основе субъекта-службы. 

> [!IMPORTANT]
> * Кластеры AKS с управляемыми удостоверениями могут быть включены только во время создания кластера.
> * Существующие кластеры AKS не могут быть обновлены или обновлены для включения управляемых удостоверений