---
title: Основные понятия безопасности в Службе Azure Kubernetes (AKS)
description: Узнайте о безопасности в Службе Azure Kubernetes (AKS), включая взаимодействие главных компонентов и узлов, политики сети и секреты Kubernetes.
services: container-service
author: mlearned
ms.service: container-service
ms.topic: conceptual
ms.date: 03/01/2019
ms.author: mlearned
ms.openlocfilehash: 1d100f17130594ace6169f5840915c88435cb9a8
ms.sourcegitcommit: 6a42dd4b746f3e6de69f7ad0107cc7ad654e39ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/07/2019
ms.locfileid: "67615772"
---
# <a name="security-concepts-for-applications-and-clusters-in-azure-kubernetes-service-aks"></a>Основные понятия безопасности приложений и кластеров в Службе Azure Kubernetes (AKS)

Чтобы защитить данные клиентов при выполнении рабочих нагрузок приложений в Службе Azure Kubernetes (AKS), в первую очередь следует обеспечить безопасность кластера. Kubernetes включает в себя компоненты системы безопасности, такие как *политики сети* и *секреты*. Azure добавляет такие компоненты, как группы безопасности сети и управляемые обновления кластера. Эти компоненты системы безопасности используются совместно, чтобы обеспечить работу кластера AKS с использованием последних обновлений безопасности операционной системы и выпусков Kubernetes, а также защитить трафик pod и доступ к конфиденциальным учетным данным.

В этой статье приводится обзор ключевых понятий безопасности приложений в AKS:

- [безопасность главных компонентов](#master-security);
- [безопасность узлов](#node-security);
- [Обновления кластера](#cluster-upgrades)
- [Безопасность сети](#network-security)
- [секреты Kubernetes](#kubernetes-secrets).

## <a name="master-security"></a>Безопасность главных компонентов

В AKS главные компоненты Kubernetes являются частью управляемой службы, предоставляемой корпорацией Майкрософт. У каждого кластера AKS имеется выделенный главный экземпляр Kubernetes с одним клиентом, обеспечивающий работу сервера API, планировщика и т. д. Этот образец управляемый и поддерживается корпорацией Майкрософт.

По умолчанию сервер API Kubernetes использует общедоступный IP-адрес и полное доменное имя (FQDN). Вы можете управлять доступом к серверу API с помощью управления доступом на основе ролей Kubernetes и Azure Active Directory. Дополнительные сведения см. в разделе [интеграцию Azure AD с AKS][aks-aad].

## <a name="node-security"></a>Безопасность узлов

Узлы AKS — это виртуальные машины Azure, которыми вы управляете и которые вы обслуживаете. Узлы Linux запустите дистрибутивом Ubuntu оптимизированного, используя среду выполнения контейнера Кита. Узлы Windows Server (в настоящее время в предварительной версии в AKS) запустите оптимизированного 2019 Windows Server выпуска, а также использовать среду выполнения контейнера Кита. При создании или масштабировании кластера AKS узлы автоматически развертываются с последними обновлениями и конфигурациями безопасности операционной системы.

Платформа Azure автоматически применяет исправления системы безопасности операционной системы к узлам Linux по ночам. Если обновление для системы безопасности ОС Linux требуется перезагрузка узла, что перезагрузка не выполняется автоматически. Можно вручную перезагрузить узлы Linux или распространенным подходом является использование [Kured][kured] , an open-source reboot daemon for Kubernetes. Kured runs as a [DaemonSet][aks-daemonsets] и проверяет каждый узел на наличие файла, указывающее, требуется перезагрузка. Для управления перезагрузками в кластере используется тот же [процесс блокировки и остановки](#cordon-and-drain), что и при обновлении кластера.

Для узлов Windows Server (в настоящее время в предварительной версии в AKS) обновление Windows автоматически запустить и применить последние обновления. По регулярному расписанию вокруг цикла выпуска обновления Windows, а также процесс проверки следует выполнить обновление на пулы узлов Windows Server в кластере AKS. В этом процессе создаются узлы под управлением последней версии образа Windows Server и исправления, а затем удаляет старые узлы. Дополнительные сведения об этом процессе см. в разделе [обновить пуле узел в AKS][nodepool-upgrade].

Узлы развертываются в подсети частной виртуальной сети без назначения общедоступных IP-адресов. В целях устранения неполадок и управления по умолчанию включен протокол SSH. Этот протокол обеспечивает доступ только при использовании внутреннего IP-адреса.

Для хранения данных узлы используют Управляемые диски Azure. Для большинства размеров узлов виртуальных машин используются высокоскоростные диски SSD ценовой категории "Премиум". Неактивные данные, хранящиеся на управляемых дисках, автоматически шифруются платформой Azure. Для повышения избыточности эти диски также безопасно реплицируются в центре обработки данных Azure.

Среды Kubernetes в AKS или в другой службе сейчас не полностью безопасны для использования в неблагоприятных мультитенантных средах. Дополнительные функциональные возможности безопасности, такие как *политики безопасности pod* или более точные элементы управления доступом на основе ролей (RBAC) для узлов усложняют эксплойты. Однако для обеспечения полноценной безопасности при выполнении неблагоприятных мультитенантных рабочих нагрузок гипервизор является единственным уровнем безопасности, которому следует доверять. Домен безопасности для Kubernetes становится целым кластером, а не отдельным узлом. Для таких типов неблагоприятных мультитенантных рабочих нагрузок следует использовать физически изолированные кластеры. Дополнительные сведения о том, для изоляции рабочих нагрузок см. в разделе [советы и рекомендации для изоляции кластеров в AKS][cluster-isolation],

## <a name="cluster-upgrades"></a>Обновления кластера

Чтобы обеспечить безопасность и соответствие или использование последних компонентов, платформа Azure предоставляет инструменты для оркестрации обновления кластера AKS и его компонентов. Эта оркестрация охватывает главные компоненты и компоненты агента Kubernetes. Вы можете просмотреть [список доступных версий Kubernetes](supported-kubernetes-versions.md) для кластера AKS. Чтобы начать обновление, следует указать одну из этих доступных версий. Затем Azure безопасно заблокирует и остановит каждый узел AKS и выполнит обновление.

### <a name="cordon-and-drain"></a>Блокировка и остановка

В процессе обновления узлы AKS по отдельности блокируются из кластера, новых модулей POD не запланированы на них. Затем узлы останавливаются и обновляются, как показано ниже.

- Новый узел развертывается в узле пула. Этот узел запускает последний образ операционной системы и исправления.
- Один из имеющихся узлов определяется для обновления. Модулей на данном узле завершаются корректно и запланировано на других узлах в пуле узлов.
- Этот существующий узел удаляется из кластера AKS.
- Следующий узел в кластере блокируются и останавливаются, используя тот же процесс, пока все узлы заменяются успешно как часть процесса обновления.

Дополнительные сведения см. в разделе [обновление кластера AKS][aks-upgrade-cluster].

## <a name="network-security"></a>Безопасность сети

Для подключения к локальным сетям и обеспечения безопасности можно развернуть кластер AKS в имеющейся подсети виртуальной сети Azure. Эти виртуальные сети могут использовать VPN-подключение Azure типа "сеть – сеть" или подключение ExpressRoute к локальной сети. Для контроллеров входящего трафика Kubernetes можно определить частные внутренние IP-адреса, чтобы службы были доступны только через это подключение к внутренней сети.

### <a name="azure-network-security-groups"></a>Группы безопасности сети Azure

Чтобы фильтровать поток трафика в виртуальных сетях, платформа Azure использует правила групп безопасности сети. Эти правила определяют диапазоны IP-адресов источника и назначения, порты и протоколы, использование которых разрешено или запрещено для доступа к ресурсам. Чтобы разрешить трафик TLS для сервера Kubernetes API создаются правила по умолчанию. При создании служб с подсистемами балансировки нагрузки, сопоставлением портов или входящими маршрутами AKS автоматически изменяет группу безопасности сети, чтобы трафик передавался соответствующим образом.

## <a name="kubernetes-secrets"></a>Секреты Kubernetes

*Секрет* Kubernetes используется для внедрения в элементы pod конфиденциальных данных, например учетных данных или ключей доступа. Сначала создается секрет с помощью API Kubernetes. При определении pod или развертывания можно запросить определенный Secret. Secret предоставляются только узлам, на которых запланирован запуск элемента pod, требующего этот Secret. Secret сохраняется в *tmpfs*, а не записывается на диск. При удалении с узла последнего pod, которому нужен секрет, данный Secret удаляется из tmpfs. Секреты хранятся в указанном пространстве имен и доступны только элементам pod в этом пространстве имен.

Использование секретов уменьшает объем конфиденциальных сведений, определяемых в pod или YAML-файле манифеста службы. Вместо этого запрашивается секрет, хранимый на сервере API Kubernetes в YAML-файле манифеста. Это позволяет предоставлять секрет только определенным элементам pod. Обратите внимание: необработанные файлы секрета манифеста содержит секретные данные в формате base64 (см. в разделе [официальной документации][secret-risks] подробности). Таким образом, этот файл должен быть конфиденциальными и не зафиксированы в систему управления версиями.

## <a name="next-steps"></a>Следующие шаги

Чтобы приступить к работе с защитой ваших кластерах AKS, см. в разделе [обновление кластера AKS][aks-upgrade-cluster].

Связанные практические рекомендации, см. в разделе [советы и рекомендации для обеспечения безопасности кластера и обновления в AKS][operator-best-practices-cluster-security].

Дополнительные сведения о ключевых концепциях Kubernetes и AKS вы получите в следующих статьях:

- [Kubernetes / AKS clusters и рабочих нагрузок][aks-concepts-clusters-workloads]
- [Kubernetes / удостоверению AKS][aks-concepts-identity]
- [Kubernetes / AKS виртуальных сетей][aks-concepts-network]
- [Kubernetes / AKS хранилища][aks-concepts-storage]
- [Kubernetes / масштабирование AKS][aks-concepts-scale]

<!-- LINKS - External -->
[kured]: https://github.com/weaveworks/kured
[kubernetes-network-policies]: https://kubernetes.io/docs/concepts/services-networking/network-policies/
[secret-risks]: https://kubernetes.io/docs/concepts/configuration/secret/#risks

<!-- LINKS - Internal -->
[aks-daemonsets]: concepts-clusters-workloads.md#daemonsets
[aks-upgrade-cluster]: upgrade-cluster.md
[aks-aad]: azure-ad-integration.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-scale]: concepts-scale.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-network]: concepts-network.md
[cluster-isolation]: operator-best-practices-cluster-isolation.md
[operator-best-practices-cluster-security]: operator-best-practices-cluster-security.md
[nodepool-upgrade]: use-multiple-node-pools.md#upgrade-a-node-pool
