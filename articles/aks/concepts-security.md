---
title: Основные понятия безопасности в Службе Azure Kubernetes (AKS)
description: Узнайте о безопасности в Службе Azure Kubernetes (AKS), включая взаимодействие главных компонентов и узлов, политики сети и секреты Kubernetes.
services: container-service
ms.topic: conceptual
ms.date: 03/01/2019
ms.openlocfilehash: 7238e6cd7ab3625e2953a4408c82802d43372256
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77595949"
---
# <a name="security-concepts-for-applications-and-clusters-in-azure-kubernetes-service-aks"></a>Основные понятия безопасности приложений и кластеров в Службе Azure Kubernetes (AKS)

Чтобы защитить данные клиентов при выполнении рабочих нагрузок приложений в Службе Azure Kubernetes (AKS), в первую очередь следует обеспечить безопасность кластера. Kubernetes включает в себя компоненты системы безопасности, такие как *политики сети* и *секреты*. Azure добавляет такие компоненты, как группы безопасности сети и управляемые обновления кластера. Эти компоненты системы безопасности используются совместно, чтобы обеспечить работу кластера AKS с использованием последних обновлений безопасности операционной системы и выпусков Kubernetes, а также защитить трафик pod и доступ к конфиденциальным учетным данным.

В этой статье приводится обзор ключевых понятий безопасности приложений в AKS:

- [безопасность главных компонентов](#master-security);
- [Безопасность узлов](#node-security)
- [Обновления кластеров](#cluster-upgrades)
- [Сетевая безопасность](#network-security)
- [секреты Kubernetes](#kubernetes-secrets).

## <a name="master-security"></a>Безопасность главных компонентов

В AKS главные компоненты Kubernetes являются частью управляемой службы, предоставляемой корпорацией Майкрософт. Каждый кластер AKS имеет свой собственный одноквартирный, посвященный мастеру Kubernetes, чтобы предоставить API Server, Scheduler и т.д. Этот мастер управляется и обслуживается корпорацией Майкрософт.

По умолчанию сервер Kubernetes API использует общедоступный IP-адрес и полностью квалифицированное доменное имя (F-DN). Вы можете управлять доступом к серверу API с помощью управления доступом на основе ролей Kubernetes и Azure Active Directory. Дополнительные сведения см. в разделе [Интеграция Azure AD с AKS][aks-aad].

## <a name="node-security"></a>Безопасность узлов

Узлы AKS — это виртуальные машины Azure, которыми вы управляете и которые вы обслуживаете. Узлы Linux используют оптимизированное распределение Ubuntu с помощью времени выполнения контейнера Moby. Узлы Windows Server (в настоящее время в предварительном просмотре в AKS) запускают оптимизированный выпуск Windows Server 2019, а также используют время выполнения контейнера Moby. При создании или масштабировании кластера AKS узлы автоматически развертываются с последними обновлениями и конфигурациями безопасности операционной системы.

Платформа Azure автоматически применяет патчи безопасности ОС в узлах Linux на ночной основе. Если обновление безопасности Linux OS требует перезагрузки хоста, эта перезагрузка не выполняется автоматически. Вы можете вручную перезагрузить узлы Linux, или общий подход заключается в использовании [Kured][kured], с открытым исходным кодом перезагрузки daemon для Kubernetes. Kured работает в виде [DaemonSet][aks-daemonsets] и проверяет каждый узел на наличие файла, указывающего на необходимость перезагрузки. Для управления перезагрузками в кластере используется тот же [процесс блокировки и остановки](#cordon-and-drain), что и при обновлении кластера.

Для узлов Windows Server (в настоящее время в предварительном просмотре в AKS) обновление Windows не запускается автоматически и не применяет последние обновления. В обычном графике вокруг цикла выпуска обновления Windows и собственного процесса проверки следует выполнить обновление в пуле узлов Windows Server (ы) в кластере AKS. Этот процесс обновления создает узлы, которые работают последние изображения Windows Server и патчи, а затем удаляет старые узлы. Для получения дополнительной информации об этом процессе [см.][nodepool-upgrade]

Узлы развертываются в подсети частной виртуальной сети без назначения общедоступных IP-адресов. В целях устранения неполадок и управления по умолчанию включен протокол SSH. Этот протокол обеспечивает доступ только при использовании внутреннего IP-адреса.

Для хранения данных узлы используют Управляемые диски Azure. Для большинства размеров узлов виртуальных машин используются высокоскоростные диски SSD ценовой категории "Премиум". Неактивные данные, хранящиеся на управляемых дисках, автоматически шифруются платформой Azure. Для повышения избыточности эти диски также безопасно реплицируются в центре обработки данных Azure.

Среды Kubernetes в AKS или в другой службе сейчас не полностью безопасны для использования в неблагоприятных мультитенантных средах. Дополнительные функциональные возможности безопасности, такие как *политики безопасности pod* или более точные элементы управления доступом на основе ролей (RBAC) для узлов усложняют эксплойты. Однако для обеспечения полноценной безопасности при выполнении неблагоприятных мультитенантных рабочих нагрузок гипервизор является единственным уровнем безопасности, которому следует доверять. Домен безопасности для Kubernetes становится целым кластером, а не отдельным узлом. Для таких типов неблагоприятных мультитенантных рабочих нагрузок следует использовать физически изолированные кластеры. Дополнительные сведения о том, как изолировать рабочие нагрузки, см. в разделе статьи [Рекомендации по изоляции кластера в службах Azure Kubernetes (AKS)][cluster-isolation].

## <a name="cluster-upgrades"></a>Обновления кластера

Чтобы обеспечить безопасность и соответствие или использование последних компонентов, платформа Azure предоставляет инструменты для оркестрации обновления кластера AKS и его компонентов. Эта оркестрация охватывает главные компоненты и компоненты агента Kubernetes. Вы можете просмотреть [список доступных версий Kubernetes](supported-kubernetes-versions.md) для кластера AKS. Чтобы начать обновление, следует указать одну из этих доступных версий. Затем Azure безопасно заблокирует и остановит каждый узел AKS и выполнит обновление.

### <a name="cordon-and-drain"></a>Блокировка и остановка

Во время процесса обновления узлы AKS индивидуально оцеплены из кластера, поэтому новые стручки на них не запланированы. Затем узлы останавливаются и обновляются, как показано ниже.

- Новый узлы развертывается в пуле узлов. Этот узла выполняет новейшие изображения ИТ-изображения и патчи.
- Один из существующих узлов идентифицируется для обновления. Стручки на этом уде изящно прекращаются и запланированы на других узлах в пуле узлов.
- Существующий узлы удаляется из кластера AKS.
- Следующий узел в кластере оцеплен и осушён с помощью одного и того же процесса до тех пор, пока все узлы не будут успешно заменены в процессе обновления.

Дополнительные сведения см. в статье [Обновление кластера службы Azure Kubernetes (AKS)][aks-upgrade-cluster].

## <a name="network-security"></a>Безопасность сети

Для подключения к локальным сетям и обеспечения безопасности можно развернуть кластер AKS в имеющейся подсети виртуальной сети Azure. Эти виртуальные сети могут использовать VPN-подключение Azure типа "сеть – сеть" или подключение ExpressRoute к локальной сети. Для контроллеров входящего трафика Kubernetes можно определить частные внутренние IP-адреса, чтобы службы были доступны только через это подключение к внутренней сети.

### <a name="azure-network-security-groups"></a>Группы безопасности сети Azure

Чтобы фильтровать поток трафика в виртуальных сетях, платформа Azure использует правила групп безопасности сети. Эти правила определяют диапазоны IP-адресов источника и назначения, порты и протоколы, использование которых разрешено или запрещено для доступа к ресурсам. Правила по умолчанию создаются для того, чтобы разрешить трафик TLS на сервер API Kubernetes. При создании служб с подсистемами балансировки нагрузки, сопоставлением портов или входящими маршрутами AKS автоматически изменяет группу безопасности сети, чтобы трафик передавался соответствующим образом.

## <a name="kubernetes-secrets"></a>Секреты Kubernetes

*Секрет* Kubernetes используется для внедрения в элементы pod конфиденциальных данных, например учетных данных или ключей доступа. Сначала создается Secret с помощью API Kubernetes. При определении pod или развертывания можно запросить определенный Secret. Secret предоставляются только узлам, на которых запланирован запуск элемента pod, требующего этот Secret. Secret сохраняется в *tmpfs*, а не записывается на диск. При удалении с узла последнего pod, которому нужен секрет, данный Secret удаляется из tmpfs. Тома Secret хранятся в указанном пространстве имен и доступны только элементам pod в этом пространстве имен.

Использование секретов уменьшает объем конфиденциальных сведений, определяемых в pod или YAML-файле манифеста службы. Вместо этого запрашивается секрет, хранимый на сервере API Kubernetes в YAML-файле манифеста. Это позволяет предоставлять секрет только определенным элементам pod. Пожалуйста, обратите внимание: необработанные секретные файлы содержат секретные данные в формате base64 (подробнее см. [официальную документацию).][secret-risks] Таким образом, этот файл должен рассматриваться как конфиденциальная информация, и никогда не обязуться элемента управления исходным источником.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы приступить к защите кластеров AKS, ознакомьтесь с разделом [Обновление кластера AKS][aks-upgrade-cluster].

Для связанных с этим рекомендаций см. [Лучшие практики кластерной безопасности и обновления в AKS][operator-best-practices-cluster-security] и [рекомендации по безопасности стручков в AKS.][developer-best-practices-pod-security]

Дополнительные сведения о ключевых концепциях Kubernetes и AKS вы получите в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes и AKS][aks-concepts-clusters-workloads]
- [Идентификация в Kubernetes и AKS][aks-concepts-identity]
- [Виртуальные сети Kubernetes и AKS][aks-concepts-network]
- [Хранилище Kubernetes и AKS][aks-concepts-storage]
- [Масштабирование Kubernetes и AKS][aks-concepts-scale]

<!-- LINKS - External -->
[kured]: https://github.com/weaveworks/kured
[kubernetes-network-policies]: https://kubernetes.io/docs/concepts/services-networking/network-policies/
[secret-risks]: https://kubernetes.io/docs/concepts/configuration/secret/#risks

<!-- LINKS - Internal -->
[aks-daemonsets]: concepts-clusters-workloads.md#daemonsets
[aks-upgrade-cluster]: upgrade-cluster.md
[aks-aad]: azure-ad-integration.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-scale]: concepts-scale.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-network]: concepts-network.md
[cluster-isolation]: operator-best-practices-cluster-isolation.md
[operator-best-practices-cluster-security]: operator-best-practices-cluster-security.md
[developer-best-practices-pod-security]:developer-best-practices-pod-security.md
[nodepool-upgrade]: use-multiple-node-pools.md#upgrade-a-node-pool
