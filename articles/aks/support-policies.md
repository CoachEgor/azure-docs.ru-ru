---
title: Политики поддержки для службы Azure Kubernetes (AKS)
description: Узнайте о политиках поддержки Azure Kubernetes Service (AKS), общей ответственности и функциях, доступных в предварительной версии (альфа- или бета-версии).
services: container-service
author: jnoller
ms.topic: article
ms.date: 01/24/2020
ms.author: jenoller
ms.openlocfilehash: ce014fc338ebfad18b91ba65b614ca0a380a3f7c
ms.sourcegitcommit: dabd9eb9925308d3c2404c3957e5c921408089da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2020
ms.locfileid: "86243857"
---
# <a name="support-policies-for-azure-kubernetes-service"></a>Политики поддержки для службы Azure Kubernetes

В этой статье описаны политики технической поддержки и ограничения для Службы Azure Kubernetes (AKS). В ней также подробно описывается управление рабочими узлами, управляемые компоненты уровня управления, сторонние компоненты с открытым кодом, а также управление безопасностью и установкой исправлений.

## <a name="service-updates-and-releases"></a>Обновления и выпуски службы

* Сведения о выпусках см. в [заметках о выпуске AKS](https://github.com/Azure/AKS/releases).
* Сведения о функциях в предварительной версии см. в разделе [Функции предварительной версии AKS и связанные проекты](https://github.com/Azure/AKS/blob/master/previews.md).

## <a name="managed-features-in-aks"></a>Управляемые функции в AKS

Облачные компоненты базовой инфраструктуры как услуги (IaaS), такие как компоненты вычислений или сети, предоставляют пользователям доступ к элементам управления и параметрам настройки на низком уровне. Напротив, AKS обеспечивает готовое развертывание Kubernetes, которое предоставляет клиентам общий набор конфигураций и необходимых возможностей. Клиенты AKS получают ограниченные возможности настройки, развертывания и пр. Этим клиентам не нужно беспокоиться о кластерах Kubernetes и управлять ими напрямую.

С помощью AKS клиент получает полностью управляемый *уровень управления*. Уровень управления содержит все компоненты и службы, необходимые клиенту для работы, и предоставляет кластеры Kubernetes пользователям. Корпорация Майкрософт обслуживает все компоненты Kubernetes и управляет ими.

Корпорация Майкрософт осуществляет управление и мониторинг приведенных ниже компонентов с помощью панели управления.

* Серверы kubelet или API Kubernetes.
* Etcd или совместимое хранилище пар "ключ-значение", обеспечивающее качество обслуживания, масштабируемость и время работы.
* Службы DNS (например, kube-dns или CoreDNS).
* Прокси-сервер или сеть Kubernetes.

AKS не является полностью управляемым кластерным решением. Некоторые компоненты, например рабочие узлы, имеют *общую ответственность*, то есть пользователи должны помогать обслуживать кластер AKS. Ввод данных пользователем требуется, например, для установки обновления системы безопасности операционной системы рабочего узла.

Службы являются *управляемыми* в том смысле, что корпорация Майкрософт и группа AKS развертывают и обслуживают их, а также отвечают за доступность и функциональность этих служб. Клиенты не могут изменять эти управляемые компоненты. Корпорация Майкрософт ограничивает возможности настройки, обеспечивая согласованное и масштабируемое взаимодействие с пользователями. Сведения о полностью настраиваемом решении см. в разделе [Обработчик AKS](https://github.com/Azure/aks-engine).

## <a name="shared-responsibility"></a>Общая ответственность

При создании кластера клиент определяет рабочие узлы Kubernetes, которые создает AKS. На этих узлах выполняются клиентские рабочие нагрузки. Клиенты являются владельцами рабочих узлов, то есть могут просматривать и изменять их.

Так как клиентские узлы кластера выполняют частный код и хранят конфиденциальные данные, служба поддержки Майкрософт получает к ним лишь ограниченный доступ. Служба поддержки Майкрософт не может входить на узлы, выполнять команды или просматривать журналы на них без явного разрешения или содействия клиента.

Так как рабочие узлы являются конфиденциальными, корпорация Майкрософт принимает значительные меры по ограничению управления ими в фоновом режиме. Во многих случаях рабочая нагрузка продолжит выполняться, даже если произошел сбой главных узлов Kubernetes, etcd и других компонентов, управляемых корпорацией Майкрософт. Непродуманные изменения рабочих узлов могут привести к потере данных и рабочих нагрузок или даже к неработоспособности кластера.

## <a name="aks-support-coverage"></a>Право на поддержку AKS

Корпорация Майкрософт предоставляет техническую поддержку по следующим аспектам:

> [!NOTE]
> Любые действия кластера, выполняемые Microsoft/AKS, выполняются с согласия пользователя во встроенной роли Kubernetes `aks-service` и встроенной привязке ролей `aks-service-rolebinding` . Эта роль позволяет AKS устранять неполадки в работе кластера и диагностировать их, но не может изменять разрешения и создавать роли или привязки ролей, а также другие действия с высоким уровнем привилегий. Доступ к роли доступен только в рамках активных запросов в службу поддержки с JIT-доступом.

* Подключение ко всем компонентам Kubernetes, предоставляемым и поддерживаемым службой Kubernetes, таким как сервер API.
* Управление, время доступности, качество обслуживания и операции служб уровня управления Kubernetes (главные узлы Kubernetes, сервер API, etcd, KUBE-DNS и т. д.).
* Etcd. Поддержка включает в себя автоматизированное прозрачное резервное копирование всех данных etcd каждые 30 минут для планирования аварийного восстановления и восстановления состояния кластера. Сохраняемые резервные копии не доступны клиентам и пользователям напрямую. Они гарантируют надежность и согласованность данных. Etcd. откат или восстановление по требованию не поддерживается в качестве функции.
* Любые точки интеграции в драйвере поставщика облачных служб Azure для Kubernetes. К ним относятся интеграции с другими службами Azure, такими как подсистемы балансировки нагрузки, постоянные тома или сети (Kubernetes и Azure CNI).
* Вопросы или проблемы, касающиеся настройки компонентов уровня управления, таких как сервер API Kubernetes, etcd и KUBE-DNS.
* Проблемы с сетью, например Azure CNI, kubenet или другие проблемы доступа и функциональности сети. Эти проблемы могут быть связаны с разрешением DNS, потерей пакетов, маршрутизацией и т. д. Корпорация Майкрософт поддерживает различные конфигурации сети.
  * Сети kubenet (простые) и расширенные сети (Azure CNI) в кластере и связанных компонентах.
  * Подключение к другим службам и приложениям Azure.
  * Конфигурации контроллеров входящего трафика и подсистем балансировки нагрузки или входящего трафика.
  * Производительность и задержка сетей.

Корпорация Майкрософт не предоставляет техническую поддержку в следующих областях.

* Вопросы об использовании Kubernetes. Например, служба поддержки Майкрософт не предоставляет рекомендаций о том, как создавать пользовательские контроллеры входящего трафика, использовать рабочие нагрузки приложений или применять программные пакеты или средства сторонних разработчиков или с открытым кодом.
  > [!NOTE]
  > Служба поддержки Майкрософт может рекомендовать функции, конфигурацию и настройки кластера AKS (например, в случае проблем в работе Kubernetes).
* Проекты сторонних разработчиков с открытым кодом, которые не входят в уровень управления Kubernetes или не развернуты вместе с кластерами AKS. Это могут быть проекты Istio, Helm, Envoy и пр.
  > [!NOTE]
  > Корпорация Майкрософт может предоставить оптимальную поддержку для сторонних проектов с открытым кодом, таких как Helm и Kured. В случае проблем со сторонним инструментом с открытым кодом, интегрированным с поставщиком облачных служб Azure Kubernetes, или других проблем, связанных с AKS, корпорация Майкрософт предоставляет примеры и приложения из своей документации.
* Стороннее программное обеспечение с закрытым кодом. Это могут быть средства проверки безопасности, устройства или программное обеспечение для сетевого взаимодействия.
* Проблемы с системами, объединяющими несколько облаков и несколько поставщиков. Например, корпорация Майкрософт не поддерживает решение проблем с запуском федеративного решения на основе нескольких общедоступных облаков.
* Индивидуальные настройки сети, кроме перечисленных в [документации по AKS](./index.yml).
  > [!NOTE]
  > Корпорация Майкрософт не занимается проблемами и ошибками, связанными с группами безопасности сети (NSG). Например, служба поддержки Майкрософт может ответить на вопросы об ошибке обновления NSG или непредвиденном поведении NSG либо подсистемы балансировки нагрузки.

## <a name="aks-support-coverage-for-worker-nodes"></a>Право на поддержку AKS для рабочих узлов

### <a name="microsoft-responsibilities-for-aks-worker-nodes"></a>Обязательства корпорации Майкрософт в отношении рабочих узлов AKS

Корпорация Майкрософт и ее клиенты разделяют ответственность за рабочие узлы Kubernetes при соблюдении следующих условий.

* Базовый образ ОС содержит необходимые дополнения (например, агенты мониторинга и сетевые агенты).
* Исправления ОС устанавливаются на рабочие узлы автоматически.
* Проблемы с компонентами уровня управления Kubernetes, которые выполняются на рабочих узлах, исправляются автоматически. К этим компонентам относятся:
  * Kube-proxy;
  * сетевые туннели, предоставляющие пути взаимодействия с главными компонентами Kubernetes;
  * kubelet;
  * управляющая программа Docker или Moby.

> [!NOTE]
> Если компонент уровня управления не работает на рабочем узле, группе AKS может потребоваться перезагрузить отдельные компоненты или весь рабочий узел. Эти операции перезагрузки автоматизированы и обеспечивают автоматическое исправление распространенных проблем. Эти перезагрузки происходят только на уровне _узла_, а не кластера, кроме случаев аварийного обслуживания или сбоя.

### <a name="customer-responsibilities-for-aks-worker-nodes"></a>Обязательства клиентов в отношении рабочих узлов AKS

Корпорация Майкрософт не выполняет автоматическую перезагрузку рабочих узлов, чтобы установить исправления уровня ОС. Хотя обновления ОС передаются на рабочие узлы, *клиент* ответственен за перезагрузку рабочих узлов для применения изменений. Исправления для общих библиотек, управляющих программ (например, SSHD) и других компонентов уровня системы или ОС устанавливаются автоматически.

Клиенты несут ответственность за установку обновлений Kubernetes. Они могут устанавливать обновления с помощью панели управления Azure или Azure CLI. Это относится к обновлениям, которые содержат улучшения системы безопасности или функциональности Kubernetes.

#### <a name="user-customization-of-worker-nodes"></a>Пользовательская настройка рабочих узлов
> [!NOTE]
> Рабочие узлы AKS отображаются на портале Azure как обычные ресурсы IaaS Azure. Однако эти виртуальные машины развертываются в настраиваемой группе ресурсов Azure (с префиксом MC\\*). Можно расширить возможности рабочих узлов AKS, изменив их базовые конфигурации. Например, можно использовать Secure Shell (SSH) для изменения рабочих узлов AKS точно так же, как вы изменяете обычные виртуальные машины. Однако невозможно изменить базовый образ ОС. Любые пользовательские изменения могут не сохраниться при модернизации, масштабировании, обновлении или перезагрузке. **Однако** внесение изменений *вне области применения API AKS* приводит к лишению права на поддержку кластера AKS. Старайтесь не изменять рабочие узлы, если только эти изменения не предложены службой поддержки Майкрософт.

Выполнение неподдерживаемых операций, как описано выше, в том числе выделение неподдерживаемых внешних ресурсов для всех узлов агентов, приводит к отмене права на поддержку кластера. AKS сохраняет право на архивацию уровней управления, которые были настроены в соответствии с указаниями службы поддержки, на период до 30 дней. AKS обслуживает резервные копии метаданных etcd кластера и может быстро повторно выделить кластер. Это повторное выделение может быть инициировано любой операцией PUT, которая возвращает возможность поддержки кластера, например обновлением или масштабированием до активных узлов агентов.

AKS управляет жизненным циклом и операциями рабочих узлов от имени клиентов. Изменение ресурсов IaaS, связанных с рабочими узлами, **не поддерживается**. Примером неподдерживаемой операции является настройка масштабируемого набора виртуальных машин пула узлов путем ручного изменения конфигураций в VMSS на портале VMSS или с помощью API VMSS.
 
Для конфигураций или пакетов, связанных с рабочей нагрузкой, AKS рекомендует использовать наборы [Kubernetes daemonset](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/).

Использование привилегированных наборов daemonset и контейнеров init Kubernetes позволяет клиентам настраивать, изменять или устанавливать сторонние программы на рабочих узлах кластера. Например, это позволяет добавить пользовательское программное обеспечение для проверки безопасности или обновить параметры sysctl.

Хотя этот способ является рекомендуемым, если применяются вышеуказанные требования, специалисты по разработке и поддержке AKS не смогут помочь в устранении неполадок или диагностике изменений, нарушивших или заблокировавших работу, а также изменений, которые привели к недоступности узла после развертывания клиентом набора daemonset.

> [!NOTE]
> Так как AKS — *управляемая служба*, ее конечными целями является избавление от ответственности за установку исправлений, установку обновлений и сбор журналов, чтобы сделать управление службой более полным и автоматизированным. По мере увеличения емкости службы для комплексного управления в будущих выпусках могут быть опущены некоторые функции (например, перезагрузка узлов и автоматическая установка исправлений).

### <a name="security-issues-and-patching"></a>Проблемы с безопасностью и установка исправлений

Если в одном или нескольких компонентах AKS обнаружен изъян в системе безопасности, группа AKS установит исправление на все затронутые кластеры, чтобы устранить эту проблему. Возможно, группа поддержки предоставит пользователям инструкции по обновлению.

Если для рабочих узлов, на которые влияет изъян в системе безопасности, доступно исправление с нулевым простоем, группа AKS применит это исправление и уведомит пользователей об изменении.

Если для установки исправления системы безопасности требуется перезагрузка рабочих узлов, корпорация Майкрософт уведомит клиентов об этом. Клиент несет ответственность за перезагрузку или обновление для установки исправления кластера. Если пользователи не установят исправления в соответствии с рекомендациями AKS, кластер останется уязвимым к обнаруженной проблеме безопасности.

### <a name="node-maintenance-and-access"></a>Обслуживание узлов и доступ к ним

Ответственность за рабочие узлы является общей, и принадлежат они клиентам. По этой причине клиенты могут входить на свои рабочие узлы и вносить потенциально опасные изменения, такие как обновление ядра и установка или удаление пакетов.

Если клиенты внесут нарушающие работу изменения или приведут к отключению от сети или выходу из строя компонентов уровня управления, AKS обнаружит этот сбой и автоматически восстановит рабочий узел до предыдущего рабочего состояния.

Хотя клиенты могут входить на рабочие узлы и изменять их, делать это не рекомендуется, так как изменения могут привести к потере права на поддержку кластера.

## <a name="network-ports-access-and-nsgs"></a>Сетевые порты, доступ и группы безопасности сети

Являясь управляемой службой, AKS предъявляет определенные требования к сети и подключению. Эти требования менее гибкие, чем требования для обычных компонентов IaaS. В AKS такие операции, как настройка правил NSG, блокировка определенного порта (например, использование правил брандмауэра, блокирующих исходящий порт 443) и добавление URL-адреса в список разрешений, могут привести к потере права на поддержку кластера.

> [!NOTE]
> Сейчас AKS не позволяет полностью блокировать исходящий трафик кластера. Чтобы управлять списком URL-адресов и портов, которые кластер может использовать для исходящего трафика, ознакомьтесь с [ограничением исходящего трафика](limit-egress-traffic.md).

## <a name="unsupported-alpha-and-beta-kubernetes-features"></a>Неподдерживаемые альфа- и бета-версии функций Kubernetes

AKS поддерживает только стабильные функции в вышестоящем проекте Kubernetes. Если не указано иное, AKS не поддерживает альфа и бета-версии функций, доступные в вышестоящем проекте Kubernetes.

В двух случаях возможно развертывание альфа и бета-версий компонентов, прежде чем будут выпущены их общедоступные версии.

* Клиенты обратились к группе по продуктам, группе поддержки или группе разработчиков AKS с просьбой дать возможность ознакомиться с этими новыми функциями.
* Эти функции были [включены с помощью флага компонента](https://github.com/Azure/AKS/blob/master/previews.md). Клиенты должны явно дать согласие на использование этих функций.

## <a name="preview-features-or-feature-flags"></a>Предварительные версии компонентов или флаги компонентов

Функции и компоненты, для которых требуется длительное тестирование и сбор отзывов пользователей, корпорация Майкрософт выпускает сначала в режиме предварительной версии, и их нужно отдельно включать соответствующим флагом компонента. Такие функции можно рассматривать как предварительные или бета-версии.

Функции предварительной версии (с флагом компонента) не предназначены для рабочей среды. Регулярные изменения интерфейсов API и поведения компонентов, исправления ошибок и другие изменения могут привести к нестабильной работе и простоям кластеров.

Для функций в общедоступной предварительной версии действует принцип "оптимальной поддержки", так как эти функции не предназначены для рабочей среды. Их поддержку осуществляют группы технической поддержки AKS только в рабочее время. Дополнительные сведения:

* [Часто задаваемые вопросы о поддержке Azure](https://azure.microsoft.com/support/faq/)

> [!NOTE]
> Предварительные версии функций действуют на уровне *подписки* Azure. Не устанавливайте предварительные версии функций в рабочей подписке. В рабочей подписке предварительные версии функций могут изменить поведение API по умолчанию и повлиять на обычные операции.

## <a name="upstream-bugs-and-issues"></a>Вышестоящие ошибки и проблемы

Учитывая скорость разработки в вышестоящем проекте Kubernetes, ошибки неизбежны. Некоторые из этих ошибок невозможно исправить или обойти в системе AKS. Вместо этого для исправления ошибок требуются более крупные исправления для вышестоящего проекта (например, для обработчиков или операционных систем Kubernetes, узлов или рабочих узлов). Для компонентов, принадлежащих корпорации Майкрософт (например, поставщика облачных служб Azure), сотрудники AKS и Azure обязуются устранять проблемы, о которых сообщается в сообществе.

Если возникла ошибка, о которой извещена служба технической поддержки, причиной которой является одна или нескольких вышестоящих ошибок, группы поддержки и разработки AKS сделают следующее.

* Выявят и сопоставят вышестоящие ошибки с любыми дополнительными сведениями, которые помогут объяснить, почему эта проблема влияет на кластер или рабочую нагрузку. Клиенты получат ссылки на необходимые репозитории, чтобы они могли просмотреть проблемы и узнать, когда в новом выпуске будут предоставлены исправления.
* Предложат возможные временные решения или исправления. Если проблему можно устранить, то эта [известная проблема](https://github.com/Azure/AKS/issues?q=is%3Aissue+is%3Aopen+label%3Aknown-issue) будет сохранена в репозитории AKS. Описание известной проблемы содержит:
  * суть проблемы, включая ссылки на вышестоящее ошибки;
  * обходное решение и сведения об обновлении или другом действенном решении;
  * приблизительные сроки устранения проблемы в соответствии с графиком выпуска вышестоящего проекта.
