---
title: Рекомендации по управлению ресурсами
titleSuffix: Azure Kubernetes Service
description: Ознакомьтесь с рекомендациями для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)
services: container-service
author: zr-msft
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zarhoads
ms.openlocfilehash: 0052657c947f8a9ff9c9d6aef86ff16d9a22adae
ms.sourcegitcommit: 6397c1774a1358c79138976071989287f4a81a83
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/07/2020
ms.locfileid: "80803489"
---
# <a name="best-practices-for-application-developers-to-manage-resources-in-azure-kubernetes-service-aks"></a>Рекомендации для разработчиков приложений по управлению ресурсами в службе Azure Kubernetes (AKS)

В процессе разработки и запуска приложений в службе Azure Kubernetes (AKS) следует учитывать несколько важных моментов. То, как вы управляете развертываниями приложений, может негативно повлиять на восприятие предоставляемых услуг конечными пользователями. Чтобы добиться успеха, следуйте нашим рекомендациям по разработке и запуску приложений в AKS.

В этой статье с рекомендациями рассматривается запуск кластера и рабочих нагрузок с точки зрения разработчика приложения. Рекомендации для администраторов см. в [этой статье][operator-best-practices-isolation]. В этой статье раскрываются следующие темы.

> [!div class="checklist"]
> * Что такое запросы и ограничения ресурсов pod
> * Способы разработки и развертывания приложений с помощью Dev Spaces и Visual Studio Code
> * Как использовать средство `kube-advisor` для проверки развертываний на наличие проблем

## <a name="define-pod-resource-requests-and-limits"></a>Определение запросов и ограничений ресурсов pod

**Рекомендация**. Установите запросы и ограничения для всех контейнеров pod в манифестах YAML. При использовании *квот ресурсов* в кластере AKS развертывание может быть отклонено, если вы не определите эти значения.

Основной способ управлять вычислительными ресурсами в кластере AKS — использовать запросы и ограничения pod. Из этих запросов и ограничений планировщик Kubernetes узнает, какие вычислительные ресурсы необходимо назначить контейнерам pod.

* **Запросы Накидк-процессор/память** определяют определенное количество процессора и памяти, которые необходимы стручок на регулярной основе.
    * Когда планировщик Kubernetes пытается разместить стручок на узлах, запросы стручка используются для определения того, какой узла имеет достаточные ресурсы для планирования.
    * Не устанавливая запрос стручка будет по умолчанию его до предела, определенного.
    * Очень важно следить за производительностью приложения, чтобы настроить эти запросы. При недостаточном запросе приложение может получить ухудшить производительность из-за чрезмерного планирования узлов. Если запросы завышены, у приложения может возникнуть повышенная сложность в получении запланированного срока.
* **Ограничения процессора Pod/Memory** - это максимальное количество процессора и памяти, которую может использовать стручок. Эти ограничения помогают определить, какие стручки должны быть убиты в случае нестабильности узлов из-за нехватки ресурсов. Без надлежащих ограничений набор стручки будут убиты до тех пор, пока давление ресурсов будет снято.
    * Ограничения стручка помогают определить, когда стручок потерял контроль над потреблением ресурсов. Когда предел превышен, стручок приоритетдля убийства для поддержания здоровья узлов и минимизации воздействия на стручки, разделяющие узла.
    * Не устанавливая ограничение стручка по умолчанию его до самого высокого доступного значения на данном узеле.
    * Не разрешайте контейнерам pod использовать больше ресурсов ЦП и памяти, чем могут обеспечить ваши узлы. Каждый узел AKS резервирует определенный объем ресурсов ЦП и памяти для основных компонентов Kubernetes. Использование слишком большого количества ресурсов на узле будет мешать успешному выполнению других контейнеров pod.
    * Опять же, очень важно следить за производительностью приложения в разное время в течение дня или недели. Определите, когда пиковый спрос, и согласовать ограничения стручка с ресурсами, необходимыми для удовлетворения максимальных потребностей приложения.

В ваших спецификациях стручка, это **лучшая практика и очень важно** определить эти запросы и ограничения на основе вышеуказанной информации. Если вы не включаете эти значения, планировщик Kubernetes не может принимать во внимание ресурсы, необходимые вашим приложениям для оказания помощи в принятии решений по планированию.

Если планировщик помещает стручок на узла с недостаточными ресурсами, производительность приложения будет ухудшаться. Администраторам кластеров настоятельно рекомендуется устанавливать *квоты ресурсов* в пространстве имен, которое требует установить запросы и ограничения ресурсов. Дополнительную информацию см. в разделе [Квоты ресурсов в кластерах AKS][resource-quotas].

Когда вы определяете запрос или ограничение по ресурсам ЦП, значение измеряется в единицах ЦП. 
* *1.0* ЦП соответствует одному базовому виртуальному ядру ЦП на узле. 
* Для графических процессоров используется та же единица измерения.
* Можно определить фракции, измеренные в милликорах. Например, *100м* — это *0,1* от базового ядра vCPU.

В следующем примере pod NGINX запрашивает *100m* времени ЦП и *128Mi* памяти. Ограничения ресурсов для контейнеров pod составляют *250m* ЦП и *256Mi* памяти:

```yaml
kind: Pod
apiVersion: v1
metadata:
  name: mypod
spec:
  containers:
  - name: mypod
    image: nginx:1.15.5
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 250m
        memory: 256Mi
```

Дополнительную информацию об измерениях и назначениях ресурсов см. в разделе [Управление вычислительными ресурсами для контейнеров][k8s-resource-limits].

## <a name="develop-and-debug-applications-against-an-aks-cluster"></a>Разработка и отладка приложений в кластере AKS

**Рекомендация**. Команды разработчиков должны развертывать и отлаживать приложения в кластере AKS, используя Dev Spaces. Эта модель разработки гарантирует реализацию требований к элементам управления доступом на основе ролей, сети или хранилищу перед развертыванием приложения в рабочей среде.

Azure Dev Spaces позволяет разрабатывать, отлаживать и тестировать приложения непосредственно в кластере AKS. Разработчики в команде работают вместе над созданием и тестированием на протяжении всего жизненного цикла приложения. Вы можете использовать существующие средства, такие как Visual Studio или Visual Studio Code. Установив расширение Dev Spaces, вы сможете выполнять и отлаживать приложение в кластере AKS:

![Отладка приложений в кластере AKS с помощью Dev Spaces](media/developer-best-practices-resource-management/dev-spaces-debug.png)

Этот интегрированный процесс разработки и тестирования с помощью Dev Spaces избавляет от необходимости использовать локальные среды тестирования, такие как [minikube][minikube]. Вы разрабатываете и тестируете приложение в кластере AKS. Этот кластер можно защитить и изолировать, как отмечалось в предыдущем разделе об использовании пространств имен для логической изоляции кластера. Когда ваши приложения будут готовы к развертыванию в рабочей среде, можете уверенно их развертывать, так как разработка выполнялась в реальном кластере AKS.

Пространства Azure Dev предназначен для использования с приложениями, которые работают на стручках linux и узлах.

## <a name="use-the-visual-studio-code-extension-for-kubernetes"></a>Использование расширения Visual Studio Code для Kubernetes

**Рекомендация**. Установите и используйте расширение VS Code для Kubernetes при написании манифестов YAML. Вы также можете использовать расширение для интегрированного решения по развертыванию, которое поможет владельцам приложений, которые редко взаимодействуют с кластером AKS.

[Расширение Visual Studio Code для Kubernetes][vscode-kubernetes] помогает разрабатывать и развертывать приложения в AKS. Расширение предоставляет intellisense для ресурсов Kubernetes, а также диаграммы и шаблоны Helm. Вы также можете просматривать, развертывать и редактировать ресурсы Kubernetes из VS Code. Intellisense также проверяет запросы или ограничения ресурсов, заданные в спецификациях pod:

![Предупреждение расширения VS Code для Kubernetes об отсутствии ограничений памяти](media/developer-best-practices-resource-management/vs-code-kubernetes-extension.png)

## <a name="regularly-check-for-application-issues-with-kube-advisor"></a>Регулярная проверка наличия проблем в приложении с помощью kube-advisor

**Рекомендации по наилучшей практике** `kube-advisor` - Регулярно запускайте последнюю версию инструмента с открытым исходным кодом для обнаружения проблем в кластере. Если вы применяете квоты ресурсов в существующем кластере AKS, сначала запустите `kube-advisor`, чтобы найти контейнеры pod без запросов и ограничений ресурсов.

Инструмент [kube-advisor][kube-advisor] является связанным с ним проектом с открытым исходным кодом AKS, который сканирует кластер Kubernetes и сообщает о проблемах, которые он находит. Полезная проверка — поиск контейнеров pod без установленных запросов и ограничений ресурсов.

Инструмент kube-advisor может сообщать о запросе ресурсов и ограничениях, отсутствующих в PodSpecs для windows-приложений, а также Linux-приложений, но сам инструмент kube-advisor должен быть запланирован на подг-коде Linux. Можно запланировать стручок для запуска в пуле узлов с определенной ОС с помощью [селектора узлов][k8s-node-selector] в конфигурации стручка.

В кластере AKS с большим количеством групп разработчиков и приложений может быть сложно отслеживать контейнеры pod без установленных запросов и ограничений ресурсов. Рекомендуем регулярно запускать `kube-advisor` в кластерах AKS.

## <a name="next-steps"></a>Дальнейшие действия

В этой статье с рекомендациями мы рассмотрели запуск кластера и рабочих нагрузок с точки зрения оператора кластера. Рекомендации для администраторов см. в [этой статье][operator-best-practices-isolation].

Чтобы реализовать некоторые из этих рекомендаций, ознакомьтесь со следующими статьями:

* [Разработка с помощью Dev Spaces][dev-spaces]
* [Проверка наличия проблем с помощью kube-advisor][aks-kubeadvisor]

<!-- EXTERNAL LINKS -->
[k8s-resource-limits]: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/
[vscode-kubernetes]: https://github.com/Azure/vscode-kubernetes-tools
[kube-advisor]: https://github.com/Azure/kube-advisor
[minikube]: https://kubernetes.io/docs/setup/minikube/

<!-- INTERNAL LINKS -->
[aks-kubeadvisor]: kube-advisor-tool.md
[dev-spaces]: ../dev-spaces/get-started-netcore.md
[operator-best-practices-isolation]: operator-best-practices-cluster-isolation.md
[resource-quotas]: operator-best-practices-scheduler.md#enforce-resource-quotas
[k8s-node-selector]: concepts-clusters-workloads.md#node-selectors
