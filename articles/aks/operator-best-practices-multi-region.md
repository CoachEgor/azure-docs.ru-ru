---
title: Высокий уровень доступности и аварийное восстановление в службе Azure Kubernetes (AKS)
description: Ознакомьтесь с рекомендациями оператор кластера для достижения максимального времени работы для ваших приложений, обеспечивая высокую доступность и Подготовка к аварийному восстановлению в службе Azure Kubernetes (AKS).
services: container-service
author: lastcoolnameleft
ms.service: container-service
ms.topic: conceptual
ms.date: 11/28/2018
ms.author: thfalgou
ms.openlocfilehash: 4d4535af1814ab1250bbd56c989b4849013adff6
ms.sourcegitcommit: 6a42dd4b746f3e6de69f7ad0107cc7ad654e39ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/07/2019
ms.locfileid: "67614838"
---
# <a name="best-practices-for-business-continuity-and-disaster-recovery-in-azure-kubernetes-service-aks"></a>Рекомендации по обеспечению непрерывности бизнес-процессов и аварийного восстановления в Службе Azure Kubernetes (AKS)

При управлении кластерами в Службе Azure Kubernetes (AKS) время бесперебойной работы приложений является важным аспектом. AKS обеспечивает высокий уровень доступности, объединяя несколько узлов в одну группу доступности. Но эти несколько узлов не защиты вашего компьютера от регионального сбоя. Чтобы максимально увеличить время работы, планируйте для поддержания непрерывности бизнес-процессов и Подготовка к аварийному восстановлению.

В этой статье описано, как для планирования непрерывности бизнес-процессов и аварийное восстановление в AKS. Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Планирование кластерах AKS в нескольких регионах.
> * Маршрутизация трафика между несколькими кластерами с помощью диспетчера трафика Azure.
> * Используйте георепликацию для вашей реестры образов контейнера.
> * План состоянием приложения между несколькими кластерами.
> * Репликации хранилища в нескольких регионах.

## <a name="plan-for-multiregion-deployment"></a>Планирование развертывания в нескольких регионах

**Рекомендация**. При развертывании нескольких кластерах AKS, выберите регионы, где доступна служба AKS и используйте пары регионов.

Кластер AKS развертывается в одном регионе. Чтобы защитить систему от регионального сбоя, развернете приложение в нескольких кластерах AKS в различных регионах. При планировании места для развертывания кластера AKS, необходимо учитывайте.

* [**Доступность по регионам AKS**](https://docs.microsoft.com/azure/aks/quotas-skus-regions#region-availability): выбирайте регионы, расположенные недалеко от пользователей. AKS постоянно расширяется в новые регионы.
* [**Сопряженные регионы Azure**](https://docs.microsoft.com/azure/best-practices-availability-paired-regions): Выберите в своей географической области два региона, которые составляют пару. Пары регионов координации обновлений платформы и расставлять приоритеты восстановления при необходимости.
* **Доступность службы**: Решите, следует ли ваш регионов "Горячий" или "Горячий", "Горячий" или "горячего" резервирования или холодные и горячие. Вы действительно хотите запустить оба региона, в то же время, с помощью одного региона *готовы* к обслуживанию трафика? Или вы один регион, для которых время для подготовки к использованию для обслуживания трафика?

Доступность по регионам AKS и парах регионов учитываются соединения. Развертывайте кластеры AKS в парах регионах, для которых настроено совместное управление аварийным восстановлением при региональных сбоях. К примеру AKS станет доступно в восточной части США и Западная часть США. Эти регионы используются парно. Выберите эти два региона, при создании стратегии AKS BC/DR.

При развертывании приложения, добавьте еще один шаг в ваш конвейер CI/CD для развертывания этих нескольких кластеров в AKS. Если вы не обновите конвейеров развертывания, приложения может быть развернут в только один из регионов и кластерах AKS. Трафик клиента, который направляется в дополнительный регион не будут получать последние обновления кода.

## <a name="use-azure-traffic-manager-to-route-traffic"></a>Использование диспетчера трафика Azure для маршрутизации трафика

**Рекомендация**. Диспетчер трафика Azure можно направить клиенты их ближайшей экземпляр кластера и приложений AKS. Для оптимальной производительности и избыточности направлять весь трафик приложений через диспетчер трафика, затем перейдет к кластеру AKS.

При наличии нескольких кластеров в AKS в разных регионах, используйте диспетчер трафика, чтобы управлять потоком трафика для приложений, запускаемых в каждом кластере. [Диспетчер трафика Azure](https://docs.microsoft.com/azure/traffic-manager/) — это подсистема балансировки нагрузки на основе DNS, которая может распределять сетевой трафик между регионами. Используйте диспетчер трафика для маршрутизации пользователей на основе времени отклика для кластера или зависимости от географического расположения.

![AKS с помощью диспетчера трафика](media/operator-best-practices-bc-dr/aks-azure-traffic-manager.png)

Клиенты, у которых один кластер AKS, обычно подключиться к IP-адрес или DNS-имя службы данного приложения. При развертывании multicluster клиентам потребуется соединиться с имя DNS диспетчера трафика, которое указывает на служб на каждый кластер AKS. Определите эти службы с помощью конечных точек диспетчера трафика. Каждая конечная точка является *службы IP-адреса подсистемы балансировки нагрузки*. Используйте эту конфигурацию для направления сетевого трафика от конечной точки диспетчера трафика в одном регионе, в конечную точку в другом регионе.

![Географической маршрутизации через диспетчер трафика](media/operator-best-practices-bc-dr/traffic-manager-geographic-routing.png)

Диспетчер трафика выполняет уточняющие запросы DNS и возвращает пользователя наиболее подходящей конечной точке. Вложенные профили можно определять их приоритеты первичного расположения. Например пользователи обычно должны подключаться их более близком географическом регионе. Если возникает проблема с этого региона диспетчер трафика вместо этого направляет пользователей в дополнительный регион. Такой подход гарантирует, что клиенты могут подключить к экземпляру приложения, даже если их ближайший географический регион недоступен.

Сведения о том, как настроить конечные точки и маршрутизации, см. в разделе [настроить метод маршрутизации трафика по географическому расположению с помощью диспетчера трафика](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-configure-geographic-routing-method).

### <a name="layer-7-application-routing-with-azure-front-door-service"></a>Маршрутизация уровня 7 приложения с помощью службы Azure передовой линии

Диспетчер трафика использует DNS (уровень 3) для трафика фигуры. [Служба Azure двери](https://docs.microsoft.com/azure/frontdoor/front-door-overview) предоставляет возможность маршрутизации HTTP/HTTPS (уровень 7). Дополнительные возможности службы Azure двери включают SSL завершения, личного домена, брандмауэр веб-приложения, переопределения URL-адресов и сходство сеансов. Оцените требования к трафику для приложения, чтобы выбрать оптимальное решение.

## <a name="enable-geo-replication-for-container-images"></a>Включение георепликации для образов контейнеров

**Рекомендация**. Store образов контейнера в реестр контейнеров Azure и георепликация реестра для каждой области AKS.

Чтобы развернуть и выполнить приложения в AKS, вам нужен определенный способ хранить и извлекать образы контейнеров. Реестр контейнеров интегрируется с AKS, поэтому можно безопасно хранить ваши образы контейнеров или диаграмм Helm. Реестр контейнеров поддерживает с несколькими хозяевами географическая репликация автоматически реплицировать свои образы в регионах Azure по всему миру. 

Для повышения производительности и доступности, используйте георепликацию для реестра контейнеров Создание реестра в каждом регионе, где, что у вас есть кластер AKS. Каждый кластер AKS, затем извлекает образы контейнеров из реестра локального контейнера, в том же регионе:

![Контейнер георепликация реестра для образов контейнеров](media/operator-best-practices-bc-dr/acr-geo-replication.png)

При использовании георепликации реестра контейнеров для получения образов в том же регионе, такие результаты:

* **Быстрее**: Получать образы от подключений высокоскоростной сети с низкой задержкой в одном регионе Azure.
* **Более надежным**: В случае недоступности регион кластера AKS извлекает изображения из реестр доступных контейнеров.
* **Дешевле**: Плата за исходящий сетевой трафик между центрами обработки данных не взимается.

Георепликация — это функция *уровня "премиум"* реестры контейнеров SKU. Сведения о том, как настроить георепликацию, см. в разделе [георепликации реестра контейнеров](https://docs.microsoft.com/azure/container-registry/container-registry-geo-replication).

## <a name="remove-service-state-from-inside-containers"></a>Удаление состояния службы из контейнеров

**Рекомендация**. Если это возможно, не храните состояние службы внутри контейнера. Вместо этого используйте платформу Azure как услуга (PaaS), которая поддерживает репликация в нескольких регионах.

*Состояние службы* ссылается на данные в памяти или на диске, службе для функционирования. Сюда входят структуры данных и переменные-члены, которые считываются и записываются службой. В зависимости от того, как архитектуры службы состояние может также включать файлы или другие ресурсы, которые хранятся на диске. Например состояние может включать файлы, которые использует базу данных для хранения данных и журналов транзакций.

Состояние можно переместить или совместного размещения с кодом, который манипулирует этим состоянием. Как правило можно прикрепить состояние с помощью базы данных или другом хранилище данных, работающего на разных компьютерах в сети или запускается вне процесса на одном компьютере.

Контейнеры и микрослужбы являются наиболее устойчивыми, когда процессы, выполняющиеся внутри них, не сохраняют состояние. Поскольку приложений почти всегда содержит некоторое состояние, используйте это решение PaaS, таких как база данных Azure для MySQL, база данных Azure для PostgreSQL или базы данных SQL Azure.

Чтобы создать переносимые приложения, см. следующие рекомендации:

* [Методология 12-факторных приложений](https://12factor.net/)
* [Запуск веб-приложения в нескольких регионах Azure](https://docs.microsoft.com/azure/architecture/reference-architectures/app-service-web-app/multi-region)

## <a name="create-a-storage-migration-plan"></a>Создание плана миграции хранилища

**Рекомендация**. Если вы используете службу хранилища Azure, Подготовка и тестирование как перенести хранилище из основного региона в резервном регионе.

Ваши приложения могут использовать службу хранилища Azure для своих данных. Так как приложения распределены между несколькими кластерами AKS в разных регионах, необходимо сохранить синхронизации хранилища. Ниже приведены два распространенных способа репликации хранилища:

* Асинхронная репликация на основе инфраструктуры
* асинхронная репликация на основе приложений;

### <a name="infrastructure-based-asynchronous-replication"></a>Асинхронная репликация на основе инфраструктуры

Ваши приложения могут требовать постоянное хранилище, даже после удаления pod. В Kubernetes постоянные тома можно использовать для сохранения данных хранилища. Постоянные тома подключенные к виртуальной Машине узла и получить доступ к POD, содержащихся. Постоянные тома выполните модулей, даже если модулей POD перемещаются на другой узел, в том же кластере.

Разработка стратегии репликации, используемого зависит от решения для хранения. Распространенные решения хранилища, такие как [Gluster](https://docs.gluster.org/en/latest/Administrator%20Guide/Geo%20Replication/), [Ceph](http://docs.ceph.com/docs/master/cephfs/disaster-recovery/), [ладья](https://rook.io/docs/rook/master/disaster-recovery.html), и [Portworx](https://docs.portworx.com/scheduler/kubernetes/going-production-with-k8s.html#disaster-recovery-with-cloudsnaps) свои собственные советы об аварийном восстановлении и репликация.

Обычно используется для предоставления точку общего хранилища, где приложения могут записывать данные. Затем эти данные реплицируются в другие регионы и предоставляются для локального доступа.

![Асинхронная репликация на основе инфраструктуры](media/operator-best-practices-bc-dr/aks-infra-based-async-repl.png)

Если вы используете управляемые диски Azure, вы можете репликации и подобного рода решения аварийного восстановления:

* [Velero в Azure](https://github.com/heptio/velero/blob/master/site/docs/master/azure-config.md)
* [Azure Site Recovery](https://azure.microsoft.com/blog/asr-managed-disks-between-azure-regions/)

### <a name="application-based-asynchronous-replication"></a>асинхронная репликация на основе приложений;

Kubernetes в настоящее время не предоставляет собственные реализации для асинхронной репликации на основе приложения. Так как контейнеры и Kubernetes слабо связаны, должны работать любой традиционный подход приложения или языка. Как правило сами приложения репликации хранилища запросов, которые затем записываются в хранилище базовых данных для каждого кластера.

![асинхронная репликация на основе приложений;](media/operator-best-practices-bc-dr/aks-app-based-async-repl.png)

## <a name="next-steps"></a>Следующие шаги

Эта статья посвящена непрерывности бизнес-процессов и аварийного восстановления для кластеров в AKS. Дополнительные сведения об операциях кластера в AKS см. в статьях, советы и рекомендации:

* [Изоляция мультитенантности и кластера][aks-best-practices-cluster-isolation]
* [Основные возможности планировщик Kubernetes][aks-best-practices-scheduler]

<!-- INTERNAL LINKS -->
[aks-best-practices-scheduler]: operator-best-practices-scheduler.md
[aks-best-practices-cluster-isolation]: operator-best-practices-cluster-isolation.md
