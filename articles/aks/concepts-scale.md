---
title: Основные понятия масштабирования приложений в Службе Azure Kubernetes (AKS)
description: Изучите масштабирование в Службе Azure Kubernetes (AKS), включая средство горизонтального автомасштабирования pod, средство автомасштабирования кластера и соединитель Экземпляров контейнеров Azure.
services: container-service
author: zr-msft
ms.service: container-service
ms.topic: conceptual
ms.date: 02/28/2019
ms.author: zarhoads
ms.openlocfilehash: 26cd2ffc12dfb93f07c2e1755a0dc41cc90da252
ms.sourcegitcommit: 39da2d9675c3a2ac54ddc164da4568cf341ddecf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73961634"
---
# <a name="scaling-options-for-applications-in-azure-kubernetes-service-aks"></a>Возможности масштабирования приложений в Службе Azure Kubernetes (AKS)

При работе приложений в Службе Azure Kubernetes (AKS) может потребоваться увеличить или уменьшить количество вычислительных ресурсов. При изменении числа экземпляров приложения может потребоваться изменить и число базовых узлов Kubernetes. Кроме того, может потребоваться быстро подготавливать большое количество дополнительных экземпляров приложений.

В этой статье рассматриваются основные понятия, которые помогут вам масштабировать приложения в AKS:

- [масштабирование вручную](#manually-scale-pods-or-nodes);
- [средство горизонтального автомасштабирования pod (HPA)](#horizontal-pod-autoscaler);
- [средство автомасштабирования кластера](#cluster-autoscaler);
- [интеграция Экземпляров контейнеров Azure (ACI) с AKS](#burst-to-azure-container-instances).

## <a name="manually-scale-pods-or-nodes"></a>Масштабирование элементов pod или узлов вручную

Можно вручную масштабировать реплики (элементы pod) и узлы, чтобы проверить, как приложение реагирует на изменение доступных ресурсов и состояния. Масштабирование ресурсов вручную также позволяет задать объем используемых ресурсов (например, количество узлов), чтобы обеспечить фиксированные расходы. Чтобы вручную масштабировать, необходимо определить реплику или число узлов. Затем API Kubernetes планирует создание дополнительных модулей Pod или сток узлов на основе этой реплики или числа узлов.

Чтобы приступить к масштабированию модулей Pod и узлов вручную, см. раздел [масштабирование приложений в AKS][aks-scale].

## <a name="horizontal-pod-autoscaler"></a>Средство горизонтального автомасштабирования pod

Kubernetes использует средство горизонтального автомасштабирования pod (HPA) для отслеживания потребности в ресурсах и автоматического масштабирования числа реплик. По умолчанию средство горизонтального автомасштабирования pod проверяет API метрик каждые 30 секунд на наличие изменений, которые необходимо внести в число реплик. При необходимости изменения число реплик увеличивается или уменьшается соответствующим образом. Средство горизонтального автомасштабирования pod с кластерами AKS, на которых развернут сервер метрик для Kubernetes 1.8 или более поздней версии.

![Горизонтальное автомасштабирование pod в Kubernetes](media/concepts-scale/horizontal-pod-autoscaling.png)

При настройке средства горизонтального автомасштабирования pod для конкретного развертывания можно определить минимальное и максимальное число запускаемых реплик. Можно также определить метрики для мониторинга и принятия решений о масштабировании, например метрику использования ЦП.

Чтобы приступить к работе с горизонтальным автомасштабированием Pod в AKS, см. раздел [Автомасштабирование модулей AKS][aks-hpa].

### <a name="cooldown-of-scaling-events"></a>Время ожидания событий масштабирования

Когда средство горизонтального автомасштабирования pod проверяет API метрик раз в 30 секунд, предыдущие события масштабирования могут оказаться незавершенными к началу следующей проверки. Такое поведение может привести к тому, что модуль автомасштабирования по горизонтали Pod изменит количество реплик, прежде чем предыдущее событие масштабирования сможет получить рабочую нагрузку приложения, а ресурс требует соответствующим образом скорректировать.

Чтобы избежать этих событий гонки, задаются значения cooldown или Delay. Эти значения определяют, сколько средству горизонтального автомасштабирования pod необходимо ждать после события масштабирования, прежде можно будет активировать другое событие масштабирования. Такое поведение позволяет применить новое число реплик, а API метрик — для отражения распределенной рабочей нагрузки. По умолчанию задержка событий увеличения масштаба составляет 3 минуты, а задержка событий уменьшения масштаба составляет 5 минут.

Сейчас вы не можете настроить эти значения cooldown по умолчанию.

## <a name="cluster-autoscaler"></a>Средство автомасштабирования кластера

Чтобы реагировать на изменение требований к Pod, Kubernetes имеет автомасштабируемый кластер кластера, который в настоящее время находится на этапе предварительной версии в AKS, который корректирует количество узлов на основе запрошенных ресурсов вычислений в пуле узлов. По умолчанию Автомасштабирование кластера проверяет сервер API метрик каждые 10 секунд для любых необходимых изменений в количестве узлов. Если средство автомасштабирования кластера определяет, что требуется внести изменение, количество узлов в кластере AKS увеличивается или уменьшается соответствующим образом. Средство автомасштабирования кластера работает кластерами AKS с поддержкой RBAC под управлением Kubernetes 1.10.x или более поздней версии.

![Средство автомасштабирования кластера Kubernetes](media/concepts-scale/cluster-autoscaler.png)

Средство автомасштабирования кластера обычно используется вместе со средством горизонтального автомасштабирования pod. В этом случае средство горизонтального автомасштабирования pod увеличивает или уменьшает количество элементов pod на основе потребностей приложения, а средство автомасштабирования кластера соответствующем образом изменяет количество узлов, необходимых для выполнения этих дополнительных pod.

Чтобы приступить к работе с автомасштабированием кластера в AKS, см. раздел [Автомасштабирование кластера в AKS][aks-cluster-autoscaler].

### <a name="scale-up-events"></a>События увеличения масштаба

Если у узла нет достаточных ресурсов вычислений для выполнения запрошенного Pod, этот модуль не сможет пройти процесс планирования. Модуль невозможно запустить, если в пуле узлов не доступны дополнительные ресурсы вычислений.

Когда Автомасштабирование кластера обнаруживает модули Pod, которые не могут быть запланированы из-за ограничений ресурсов пула узлов, количество узлов в пуле узлов увеличивается для предоставления дополнительных ресурсов вычислений. Когда эти дополнительные узлы успешно развертываются и становятся доступны для использования в пуле узлов, элементы pod добавляются в расписание для запуска на них.

Если приложению требуется быстрое масштабирование, некоторые элементы pod могут оставаться в состоянии ожидания планирования, пока дополнительные узлы, развернутые средством автомасштабирования кластера, не смогут принять запланированные pod. Для приложений со скачкообразными потребностями в ресурсах можно использовать масштабирование с помощью виртуальных узлов и Экземпляров контейнеров Azure.

### <a name="scale-down-events"></a>События уменьшения масштаба

Модуль автомасштабирования кластера также отслеживает состояние расписания Pod для узлов, которые недавно не получали новые запросы на планирование. Этот сценарий указывает, что пул узлов имеет больше ресурсов вычислений, чем требуется, и количество узлов может быть уменьшено.

Если узел не используется дольше 10 минут (порог по умолчанию), планируется его удаление. При возникновении такой ситуации запуск элементов pod планируются на других узлах в пуле узлов, и средство автомасштабирования кластера уменьшает число узлов.

Работа приложений может ненадолго прерваться при переносе запуска элементов pod на другие узлы, когда средство автомасштабирования кластера уменьшает число узлов. Чтобы свести к минимуму нарушение работы, избегайте приложений, использующих отдельный экземпляр pod.

## <a name="burst-to-azure-container-instances"></a>Пакетное масштабирование в Экземпляры контейнеров Azure

Чтобы быстро масштабировать кластер AKS, можно интегрировать его с Экземплярами контейнеров Azure (ACI). В Kubernetes есть встроенные компоненты, которые позволяют масштабировать число реплик и узлов. Тем не менее, если приложению требуется быстрое масштабирование, средство горизонтального автомасштабирования pod может запланировать больше элементов pod, чем доступно в соответствии с имеющимися вычислительными ресурсами в пуле узлов. Подобная конфигурация приведет к тому, что средство автомасштабирования кластера развернет дополнительные узлы в пуле узлов, но может потребоваться несколько минут, чтобы эти узлы были успешно подготовлены и планировщик Kubernetes смог запускать на них элементы pod.

![Пакетное масштабирование Kubernetes в ACI](media/concepts-scale/burst-scaling.png)

ACI позволяет быстро развернуть экземпляры контейнеров без дополнительных затрат на инфраструктуру. При подключении к AKS служба ACI становится защищенным логическим расширением кластера AKS. Компонент [виртуальных узлов][virtual-nodes-cli] , основанный на [виртуальной Kubelet][virtual-kubelet], устанавливается в кластер AKS, который представляет ACI в качестве виртуального Kubernetes узла. После этого Kubernetes может планировать запуск элементов pod в качестве экземпляров ACI на виртуальных узлах, а не в качестве элементов pod на узлах виртуальных машин непосредственно в кластере AKS. Сейчас виртуальные узлы доступны в предварительной версии в AKS.

Приложение не требует изменений для использования виртуальных узлов. Развертывания можно масштабировать в AKS и ACI без задержек по мере того, как средство автомасштабирования кластера развертывает новые узлы в кластере AKS.

Виртуальные узлы развертываются в дополнительную подсеть в той же виртуальной сети, что и кластер AKS. Эта конфигурация виртуальной сети обеспечивает защиту трафика, передаваемого между ACI и AKS. Как и кластер AKS, экземпляр ACI является безопасным логическим вычислительным ресурсом, который изолирован от других пользователей.

## <a name="next-steps"></a>Дополнительная информация

Чтобы приступить к масштабированию приложений, сначала выполните инструкции из [краткого руководства по созданию кластера AKS с Azure CLI][aks-quickstart]. Затем вы можете вручную или автоматически масштабировать приложения в кластере AKS:

- Ручное масштабирование [модулей][aks-manually-scale-pods] Pod или [узлов][aks-manually-scale-nodes]
- Использование [горизонтального автомасштабирования Pod][aks-hpa]
- Использование [автомасштабирования кластера][aks-cluster-autoscaler]

Дополнительные сведения о ключевых понятиях Kubernetes и AKS приведены в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes/AKS][aks-concepts-clusters-workloads]
- [Доступ и идентификация Kubernetes/AKS][aks-concepts-identity]
- [Безопасность Kubernetes и AKS][aks-concepts-security]
- [Виртуальные сети Kubernetes/AKS][aks-concepts-network]
- [Хранилище Kubernetes/AKS][aks-concepts-storage]

<!-- LINKS - external -->
[virtual-kubelet]: https://virtual-kubelet.io/

<!-- LINKS - internal -->
[aks-quickstart]: kubernetes-walkthrough.md
[aks-hpa]: tutorial-kubernetes-scale.md#autoscale-pods
[aks-scale]: tutorial-kubernetes-scale.md
[aks-manually-scale-pods]: tutorial-kubernetes-scale.md#manually-scale-pods
[aks-manually-scale-nodes]: tutorial-kubernetes-scale.md#manually-scale-aks-nodes
[aks-cluster-autoscaler]: autoscaler.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-security]: concepts-security.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-network]: concepts-network.md
[virtual-nodes-cli]: virtual-nodes-cli.md