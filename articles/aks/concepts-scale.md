---
title: Основные понятия масштабирования приложений в Службе Azure Kubernetes (AKS)
description: Изучите масштабирование в Службе Azure Kubernetes (AKS), включая средство горизонтального автомасштабирования pod, средство автомасштабирования кластера и соединитель Экземпляров контейнеров Azure.
services: container-service
author: zr-msft
ms.service: container-service
ms.topic: conceptual
ms.date: 02/28/2019
ms.author: zarhoads
ms.openlocfilehash: 3230d85dfcf57bfd4e2e1684f4f5620600ec4e3a
ms.sourcegitcommit: 198c3a585dd2d6f6809a1a25b9a732c0ad4a704f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2019
ms.locfileid: "68424203"
---
# <a name="scaling-options-for-applications-in-azure-kubernetes-service-aks"></a>Возможности масштабирования приложений в Службе Azure Kubernetes (AKS)

При работе приложений в Службе Azure Kubernetes (AKS) может потребоваться увеличить или уменьшить количество вычислительных ресурсов. При изменении числа экземпляров приложения может потребоваться изменить и число базовых узлов Kubernetes. Кроме того, может потребоваться быстро подготовить большое количество дополнительных экземпляров приложения.

В этой статье рассматриваются основные понятия, которые помогут вам масштабировать приложения в AKS:

- [масштабирование вручную](#manually-scale-pods-or-nodes);
- [средство горизонтального автомасштабирования pod (HPA)](#horizontal-pod-autoscaler);
- [средство автомасштабирования кластера](#cluster-autoscaler);
- [интеграция Экземпляров контейнеров Azure (ACI) с AKS](#burst-to-azure-container-instances).

## <a name="manually-scale-pods-or-nodes"></a>Масштабирование элементов pod или узлов вручную

Можно вручную масштабировать реплики (элементы pod) и узлы, чтобы проверить, как приложение реагирует на изменение доступных ресурсов и состояния. Масштабирование ресурсов вручную также позволяет задать объем используемых ресурсов (например, количество узлов), чтобы обеспечить фиксированные расходы. Чтобы масштабировать ресурсы вручную, определите число реплик или узлов, и API Kubernetes запланирует создание дополнительных элементов pod или освобождение узлов.

Чтобы приступить к масштабированию модулей Pod и узлов вручную, см. раздел [масштабирование приложений в AKS][aks-scale].

## <a name="horizontal-pod-autoscaler"></a>Средство горизонтального автомасштабирования pod

Kubernetes использует средство горизонтального автомасштабирования pod (HPA) для отслеживания потребности в ресурсах и автоматического масштабирования числа реплик. По умолчанию средство горизонтального автомасштабирования pod проверяет API метрик каждые 30 секунд на наличие изменений, которые необходимо внести в число реплик. При необходимости изменения число реплик увеличивается или уменьшается соответствующим образом. Средство горизонтального автомасштабирования pod с кластерами AKS, на которых развернут сервер метрик для Kubernetes 1.8 или более поздней версии.

![Горизонтальное автомасштабирование pod в Kubernetes](media/concepts-scale/horizontal-pod-autoscaling.png)

При настройке средства горизонтального автомасштабирования pod для конкретного развертывания можно определить минимальное и максимальное число запускаемых реплик. Можно также определить метрики для мониторинга и принятия решений о масштабировании, например метрику использования ЦП.

Чтобы приступить к работе с горизонтальным автомасштабированием Pod в AKS, см. раздел Автомасштабирование [модулей AKS][aks-hpa].

### <a name="cooldown-of-scaling-events"></a>Время ожидания событий масштабирования

Когда средство горизонтального автомасштабирования pod проверяет API метрик раз в 30 секунд, предыдущие события масштабирования могут оказаться незавершенными к началу следующей проверки. Это может привести к тому, что средство горизонтального автомасштабирования pod изменит число реплик прежде, чем предыдущее событие масштабирования сможет получить сведения о рабочей нагрузке приложений и потребностях в ресурсах, чтобы настроить их соответствующим образом.

Чтобы свести к минимуму эту гонку событий, можно задать значения задержки или времени ожидания. Эти значения определяют, сколько средству горизонтального автомасштабирования pod необходимо ждать после события масштабирования, прежде можно будет активировать другое событие масштабирования. Такое поведение позволит применять новое число реплик, и API метрик будет отражать распределенную рабочую нагрузку. По умолчанию задержка событий увеличения масштаба составляет 3 минуты, а задержка событий уменьшения масштаба составляет 5 минут.

Вам может потребоваться настроить эти значения времени ожидания. Значения времени ожидания по умолчанию могут создать впечатление, что средство горизонтального автомасштабирования pod недостаточно быстро масштабирует число реплик. Например, чтобы быстрее увеличивать число используемых реплик, уменьшите значение `--horizontal-pod-autoscaler-upscale-delay` при создании определений средства горизонтального автомасштабирования pod с помощью `kubectl`.

## <a name="cluster-autoscaler"></a>Средство автомасштабирования кластера

Чтобы реагировать на изменение требований к Pod, Kubernetes имеет автомасштабируемый кластер (в настоящее время в AKS), который корректирует количество узлов на основе запрошенных ресурсов вычислений в пуле узлов. По умолчанию средство автомасштабирования кластера проверяет сервер API каждые 10 секунд на наличие изменений, которые нужно внести в число узлов. Если средство автомасштабирования кластера определяет, что требуется внести изменение, количество узлов в кластере AKS увеличивается или уменьшается соответствующим образом. Средство автомасштабирования кластера работает кластерами AKS с поддержкой RBAC под управлением Kubernetes 1.10.x или более поздней версии.

![Средство автомасштабирования кластера Kubernetes](media/concepts-scale/cluster-autoscaler.png)

Средство автомасштабирования кластера обычно используется вместе со средством горизонтального автомасштабирования pod. В этом случае средство горизонтального автомасштабирования pod увеличивает или уменьшает количество элементов pod на основе потребностей приложения, а средство автомасштабирования кластера соответствующем образом изменяет количество узлов, необходимых для выполнения этих дополнительных pod.

Автомасштабирование кластера следует тестировать только в предварительной версии кластеров AKS.

Чтобы приступить к работе с автомасштабированием кластера в AKS, см. раздел Автомасштабирование [кластера в AKS][aks-cluster-autoscaler].

### <a name="scale-up-events"></a>События увеличения масштаба

Если на узле недостаточно вычислительных ресурсов для выполнения запрошенного pod, этот pod не сможет участвовать в процессе планирования. Pod не удастся запустить, пока в пуле узлов не появятся дополнительные вычислительные ресурсы.

Когда средство автомасштабирования кластера обнаруживает элементы pod, запуск которых невозможно запланировать из-за ограничения ресурсов пула узлов, количество узлов в пуле увеличивается, чтобы обеспечить дополнительные вычислительные ресурсы. Когда эти дополнительные узлы успешно развертываются и становятся доступны для использования в пуле узлов, элементы pod добавляются в расписание для запуска на них.

Если приложению требуется быстрое масштабирование, некоторые элементы pod могут оставаться в состоянии ожидания планирования, пока дополнительные узлы, развернутые средством автомасштабирования кластера, не смогут принять запланированные pod. Для приложений со скачкообразными потребностями в ресурсах можно использовать масштабирование с помощью виртуальных узлов и Экземпляров контейнеров Azure.

### <a name="scale-down-events"></a>События уменьшения масштаба

Средство автомасштабирования кластера также отслеживает состояние планирования pod для узлов, которые не получали новые запросы на планирование в недавнем времени. Этот означает, что пул узлов содержит больше вычислительных ресурсов, чем требуется, и число узлов может быть уменьшено.

Если узел не используется дольше 10 минут (порог по умолчанию), планируется его удаление. При возникновении такой ситуации запуск элементов pod планируются на других узлах в пуле узлов, и средство автомасштабирования кластера уменьшает число узлов.

Работа приложений может ненадолго прерваться при переносе запуска элементов pod на другие узлы, когда средство автомасштабирования кластера уменьшает число узлов. Чтобы свести к минимуму нарушение работы, избегайте приложений, использующих отдельный экземпляр pod.

## <a name="burst-to-azure-container-instances"></a>Пакетное масштабирование в Экземпляры контейнеров Azure

Чтобы быстро масштабировать кластер AKS, можно интегрировать его с Экземплярами контейнеров Azure (ACI). В Kubernetes есть встроенные компоненты, которые позволяют масштабировать число реплик и узлов. Тем не менее, если приложению требуется быстрое масштабирование, средство горизонтального автомасштабирования pod может запланировать больше элементов pod, чем доступно в соответствии с имеющимися вычислительными ресурсами в пуле узлов. Подобная конфигурация приведет к тому, что средство автомасштабирования кластера развернет дополнительные узлы в пуле узлов, но может потребоваться несколько минут, чтобы эти узлы были успешно подготовлены и планировщик Kubernetes смог запускать на них элементы pod.

![Пакетное масштабирование Kubernetes в ACI](media/concepts-scale/burst-scaling.png)

ACI позволяет быстро развернуть экземпляры контейнеров без дополнительных затрат на инфраструктуру. При подключении к AKS служба ACI становится защищенным логическим расширением кластера AKS. В кластере AKS устанавливается компонент Virtual Kubelet, который представляет ACI как виртуальный узел Kubernetes. После этого Kubernetes может планировать запуск элементов pod в качестве экземпляров ACI на виртуальных узлах, а не в качестве элементов pod на узлах виртуальных машин непосредственно в кластере AKS. Сейчас виртуальные узлы доступны в предварительной версии в AKS.

Приложение не требует изменений для использования виртуальных узлов. Развертывания можно масштабировать в AKS и ACI без задержек по мере того, как средство автомасштабирования кластера развертывает новые узлы в кластере AKS.

Виртуальные узлы развертываются в дополнительную подсеть в той же виртуальной сети, что и кластер AKS. Эта конфигурация виртуальной сети обеспечивает защиту трафика, передаваемого между ACI и AKS. Как и кластер AKS, экземпляр ACI является безопасным логическим вычислительным ресурсом, который изолирован от других пользователей.

## <a name="next-steps"></a>Следующие шаги

Чтобы приступить к масштабированию приложений, сначала выполните инструкции из [краткого руководства по созданию кластера AKS с Azure CLI][aks-quickstart]. Затем вы можете вручную или автоматически масштабировать приложения в кластере AKS:

- Ручное масштабирование [модулей][aks-manually-scale-pods] Pod or [nodes][aks-manually-scale-nodes]
- Использование [горизонтального автомасштабирования Pod][aks-hpa]
- Использование [автомасштабирования кластера][aks-cluster-autoscaler]

Дополнительные сведения о ключевых понятиях Kubernetes и AKS приведены в следующих статьях:

- [Кластеры и рабочие нагрузки Kubernetes/AKS][aks-concepts-clusters-workloads]
- [Доступ и идентификация Kubernetes/AKS][aks-concepts-identity]
- [Безопасность Kubernetes и AKS][aks-concepts-security]
- [Виртуальные сети Kubernetes/AKS][aks-concepts-network]
- [Хранилище Kubernetes/AKS][aks-concepts-storage]

<!-- LINKS - external -->

<!-- LINKS - internal -->
[aks-quickstart]: kubernetes-walkthrough.md
[aks-hpa]: tutorial-kubernetes-scale.md#autoscale-pods
[aks-scale]: tutorial-kubernetes-scale.md
[aks-manually-scale-pods]: tutorial-kubernetes-scale.md#manually-scale-pods
[aks-manually-scale-nodes]: tutorial-kubernetes-scale.md#manually-scale-aks-nodes
[aks-cluster-autoscaler]: autoscaler.md
[aks-concepts-clusters-workloads]: concepts-clusters-workloads.md
[aks-concepts-security]: concepts-security.md
[aks-concepts-storage]: concepts-storage.md
[aks-concepts-identity]: concepts-identity.md
[aks-concepts-network]: concepts-network.md
