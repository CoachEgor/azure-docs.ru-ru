---
title: Устранение распространенных проблем со Службой Azure Kubernetes
description: Узнайте, как устранить распространенные проблемы при использовании Службы Azure Kubernetes (AKS).
services: container-service
author: sauryadas
ms.service: container-service
ms.topic: troubleshooting
ms.date: 08/13/2018
ms.author: saudas
ms.openlocfilehash: f0b0ff3ff4ac742a7e850798c736eb31098f66e8
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65966379"
---
# <a name="aks-troubleshooting"></a>Устранение неполадок с AKS

При создании кластеров Azure Kubernetes Service (AKS) или управлении ими иногда вы можете сталкиваться с проблемами. В этой статье описаны некоторые распространенные проблемы и действия по устранению неполадок.

## <a name="in-general-where-do-i-find-information-about-debugging-kubernetes-problems"></a>Где найти общие сведения об отладке проблем Kubernetes?

[Вот официальное руководство по устранению неполадок с кластерами Kubernetes](https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/).
[Это руководство по устранению неполадок](https://github.com/feiskyer/kubernetes-handbook/blob/master/en/troubleshooting/index.md) модулей pod, узлов, кластеров и т. д., опубликованное инженером Майкрософт.

## <a name="im-getting-a-quota-exceeded-error-during-creation-or-upgrade-what-should-i-do"></a>Я получаю ошибку превышения квоты во время создания или обновления. Что делать? 

Вам необходимо [запросить ядра](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request).

## <a name="what-is-the-maximum-pods-per-node-setting-for-aks"></a>Каково максимальное число модулей pod на узел, установленное для AKS?

Если вы развертываете кластер AKS на портале Azure, максимальное число модулей pod на узел по умолчанию составляет 30.
Если вы развертываете кластер AKS в Azure CLI, максимальное число модулей pod на узел по умолчанию составляет 110. Убедитесь, что используется последняя версия Azure CLI. Этот параметр по умолчанию можно изменить с помощью флага `–-max-pods` в команде `az aks create`.

## <a name="im-getting-an-insufficientsubnetsize-error-while-deploying-an-aks-cluster-with-advanced-networking-what-should-i-do"></a>Я получаю ошибку insufficientSubnetSize при развертывании кластера AKS с использованием расширенного сетевого взаимодействия. Что делать?

Если используется Azure CNI (расширенная сеть), AKS предварительно выделяет IP-адреса на основе настроенного максимального числа pod для каждого узла. В кластере AKS может быть любое число узлов в диапазоне от 1 до 110. На основе настроенного максимального числа модулей pod для каждого узла, размер подсети должен быть больше "произведения количества узлов и максимального числа модулей pod на узел". Следующее основное выражение описывает:

Размер подсети > количество узлов в кластере (с учетом требований к масштабированию в будущем) * максимальное число модулей pod на узел.

Дополнительные сведения см. в разделе [Планирование назначения IP-адресов для кластера](configure-azure-cni.md#plan-ip-addressing-for-your-cluster).

## <a name="my-pod-is-stuck-in-crashloopbackoff-mode-what-should-i-do"></a>Мой модуль pod завис в режиме CrashLoopBackOff. Что делать?

Модуль pod может зависнуть в этом режиме по различным причинам. Вы можете просмотреть:

* сведения о самом модуле pod с помощью команды `kubectl describe pod <pod-name>`;
* сведения в журналах с помощью команды `kubectl log <pod-name>`.

Дополнительные сведения об устранении неполадок модуля pod см. в статье об [отладке приложений](https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/#debugging-pods).

## <a name="im-trying-to-enable-rbac-on-an-existing-cluster-how-can-i-do-that"></a>Я пытаюсь включить RBAC в существующем кластере. Как это сделать?

К сожалению, включение RBAC в существующих кластерах в настоящее время не поддерживается. Необходимо явно создать кластеры. Если вы используете CLI, RBAC включается по умолчанию. Если вы используете портал AKS, в рабочем процессе создания будет доступен переключатель для включения RBAC.

## <a name="i-created-a-cluster-with-rbac-enabled-by-using-either-the-azure-cli-with-defaults-or-the-azure-portal-and-now-i-see-many-warnings-on-the-kubernetes-dashboard-the-dashboard-used-to-work-without-any-warnings-what-should-i-do"></a>Кластер создан с поддержкой RBAC помощью Azure CLI со значениями по умолчанию или на портале Azure, при этом на панели мониторинга Kubernetes появились многочисленные предупреждения. Ранее на панели мониторинга не возникало никаких предупреждений. Что делать?

Причина отображения предупреждений на панели мониторинга заключается в том, что теперь в кластере включена функция RBAC, в которой доступ к этой панели отключен по умолчанию. В целом этот подход является рекомендуемым, так как раскрытие панели мониторинга по умолчанию для всех пользователей кластера может привести к угрозам безопасности. Если вы по-прежнему хотите включить панель мониторинга, следуйте указаниям в этом [блоге](https://pascalnaber.wordpress.com/2018/06/17/access-dashboard-on-aks-with-rbac-enabled/).

## <a name="i-cant-connect-to-the-dashboard-what-should-i-do"></a>Мне не удается подключиться к панели мониторинга. Что делать?

Самый простой способ получить доступ к службе за пределами кластера — запустить `kubectl proxy`, который будет запрашивать ваш локальный порт 8001 для подключения к серверу API Kubernetes. После этого сервер API может установить прокси-подключение к вашей службе: `http://localhost:8001/api/v1/namespaces/kube-system/services/kubernetes-dashboard/proxy/#!/node?namespace=default`.

Если вы не видите панель мониторинга Kubernetes, проверьте, запущен ли модуль pod `kube-proxy` в пространстве имен `kube-system`. Если модуль pod находится в нерабочем состоянии, удалите его, и он перезапустится.

## <a name="i-cant-get-logs-by-using-kubectl-logs-or-i-cant-connect-to-the-api-server-im-getting-error-from-server-error-dialing-backend-dial-tcp-what-should-i-do"></a>Мне не удается получить журналы kubectl, или подключение к серверу API завершается сбоем. Я получаю «на сервере возникла ошибка: Ошибка вызова серверной части: набрать tcp...». Что делать?

Убедитесь, что группы безопасности сети по умолчанию не изменены, и что порт 22 открыт для соединения с сервером API. Проверьте ли `tunnelfront` pod выполняется в *kube-system* пространства имен с помощью `kubectl get pods --namespace kube-system` команды. Если он не запущен, принудительно удалите его, и он перезапустится.

## <a name="im-trying-to-upgrade-or-scale-and-am-getting-a-message-changing-property-imagereference-is-not-allowed-error-how-do-i-fix-this-problem"></a>При попытке обновления или масштабирования я получаю подобное сообщение: Changing property 'imageReference' is not allowed (Не разрешено изменять свойство imageReference). Как устранить эту проблему?

Возможно, вы получаете эту ошибку, потому что изменили теги в узлах агента внутри кластера AKS. Изменение и удаление тегов и других свойств ресурсов в группе ресурсов MC_* может привести к непредвиденным результатам. Изменение ресурсов в группе MC_* в кластере AKS нарушает цель уровня обслуживания (SLO).

## <a name="im-receiving-errors-that-my-cluster-is-in-failed-state-and-upgrading-or-scaling-will-not-work-until-it-is-fixed"></a>Я получаю ошибки, Мой кластер находится в состоянии сбоя и обновления или масштабирования не будут работать до его устранения

*Помощь в устранении неполадок направляется из https://aka.ms/aks-cluster-failed*

Эта ошибка возникает, когда кластеры введите состоянии сбоя по нескольким причинам. Выполните следующие действия, чтобы разрешить состояние кластера не удалось перед повторной попыткой ранее неудавшуюся операцию.

1. Пока кластер находится вне `failed` состояние, `upgrade` и `scale` операций не будет успешным. Корень проблемы и способы их устранения:
    * Масштабирование с помощью **квоты недостаточно вычислений (CRP)** . Чтобы устранить проблему, сначала масштабируйте кластер в состояние стабильной цели в пределах квоты. Затем выполните следующие [действия, чтобы запросить квоту вычислений увеличение](../azure-supportability/resource-manager-core-quotas-request.md) перед попыткой для увеличения масштаба еще раз за его пределами первоначальной квоту.
    * Масштабирование кластера с усовершенствованной организации сети и **ресурсов недостаточно подсети (сеть)** . Чтобы устранить проблему, сначала масштабируйте кластер в состояние стабильной цели в пределах квоты. Следуйте [эти действия, чтобы запросить квоту ресурсов увеличение](../azure-resource-manager/resource-manager-quota-errors.md#solution) перед попыткой для увеличения масштаба еще раз за его пределами первоначальной квоту.
2. После устранения основную причину сбоя обновления, кластер должен быть в состоянии успешного выполнения. После проверки состоянии успешного выполнения повторите исходную операцию.

## <a name="im-receiving-errors-when-trying-to-upgrade-or-scale-that-state-my-cluster-is-being-currently-being-upgraded-or-has-failed-upgrade"></a>Я получаю ошибки при попытке обновления или масштабирования этому состоянию Мой кластер, в настоящее время он обновляется или произошел сбой обновления

*Помощь в устранении неполадок направляется из https://aka.ms/aks-pending-upgrade*

Операции с кластером ограничены, когда происходят активные операции обновления или обновления была предпринята, но впоследствии не удалось. Чтобы диагностировать проблему, выполните `az aks show -g myResourceGroup -n myAKSCluster -o table` для получения подробных сведений о состоянии в кластере. На основе результата:

* Если кластер активно обновляете, подождите до завершения операции. Если выполнено успешно, повторите завершившуюся неудачей операцию.
* Если кластера произошел сбой обновления, выполните действия, описанные выше

## <a name="can-i-move-my-cluster-to-a-different-subscription-or-my-subscription-with-my-cluster-to-a-new-tenant"></a>Можно ли перенести мой кластер в другую подписку или подписку с моей кластера в новый клиент?

Если кластера AKS был перемещен в другую подписку или кластера, которой принадлежит подписка, в новый клиент, кластера будут потеряны функции из-за проигравшей назначений ролей и прав участников службы. **AKS не поддерживает кластеры, перемещение между подписками или клиентов** из-за этого ограничения.

## <a name="im-receiving-errors-trying-to-use-features-that-require-virtual-machine-scale-sets"></a>Я получаю ошибки при попытке использовать функции, требующие масштабируемые наборы виртуальных машин

*Помощь в устранении неполадок направляется из aka.ms/aks-vmss подключения*

Может появиться ошибки, которые указывают, что кластер AKS не на масштабируемый набор виртуальных машин, как в следующем примере:

**AgentPool «agentpool» задал автоматического масштабирования, поскольку включена, но не в наборах масштабирования виртуальных машин**

Использовать функции например автомасштабирования кластера или узла несколько пулов, кластерах AKS должны создаваться, использующих масштабируемые наборы виртуальных машин. Ошибки возвращаются в том случае, если вы попытаетесь использовать функции, зависящие от масштабируемых наборов виртуальных машин тем, и кластер AKS обычный, виртуальной машины масштабируемого набора. Поддержка набора масштабирования виртуальных машин в настоящее время доступна Предварительная версия в AKS.

Выполните *перед началом* шаги в соответствующий документ правильно зарегистрировать для масштабируемого набора виртуальных машин функция предварительного просмотра и создание кластера AKS:

* [Использовать инструмент автомасштабирования кластера](cluster-autoscaler.md)
* [Создание и использование нескольких пулов узлов](use-multiple-node-pools.md)
 
## <a name="what-naming-restrictions-are-enforced-for-aks-resources-and-parameters"></a>Какие ограничения именования являются обязательными для AKS ресурсы и параметры?

*Помощь в устранении неполадок направляется из aka.ms/aks-— правила именования*

Ограничения именования, реализуются посредством платформы Azure и AKS. Если имя ресурса или параметр нарушает одно из этих ограничений, возвращается ошибка, что с запросом о предоставляют другие входные данные. Применяются следующие общие правила именования:

* AKS *MC_* объединяет имя группы ресурсов, имя группы ресурсов и имя ресурса. Синтаксис автоматически генерируемым `MC_resourceGroupName_resourceName_AzureRegion` должно быть не больше 80 символов. При необходимости Сократите имя группы ресурсов или имя кластера AKS.
* *DnsPrefix* должно начинаться и заканчиваться на буквенно-цифровые значения. Допустимые символы включают буквенно-цифровые значения и дефисы (-). *DnsPrefix* не может содержать специальные символы, такие как точка (.).

## <a name="im-receiving-errors-when-trying-to-create-update-scale-delete-or-upgrade-cluster-that-operation-is-not-allowed-as-another-operation-is-in-progress"></a>Получено ошибок при попытке создания, обновления, масштабировать, удалить или обновить кластер, что операция не разрешена, поскольку выполняется другая операция.

*Помощь в устранении неполадок направляется из aka.ms/aks ожидающих операции*

Операции с кластером ограничены, когда предыдущая операция все еще выполняется. Чтобы получить подробные сведения о состоянии кластера, используйте `az aks show -g myResourceGroup -n myAKSCluster -o table` команды. Используйте собственную группу ресурсов и имя кластера AKS, при необходимости.

На основе выходных данных о состоянии кластера:

* Если кластер находится в любом состоянии подготовки, отличное от *Succeeded* или *Failed*, подождите, пока операция (*обновление / обновление / создания / масштабирование / удаление / миграция*) завершается. После завершения предыдущей операции, повторите попытку последней операции кластера.

* Если в кластере есть неудачного обновления, выполните действия, описанные [я получает ошибки, Мой кластер находится в состоянии сбоя и обновления или масштабирования не будут работать до ее устранения](#im-receiving-errors-that-my-cluster-is-in-failed-state-and-upgrading-or-scaling-will-not-work-until-it-is-fixed).