---
title: Установка и настройка интеграции отчетов AWS затратах и использовании в Azure Cost Management
description: В этой статье описана процедура установки и настройки интеграции отчетов AWS затратах и использовании в Azure Cost Management.
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 05/21/2019
ms.topic: conceptual
ms.service: cost-management
manager: ormaoz
ms.custom: ''
ms.openlocfilehash: 951178a82e0975f5f2af71bd48cf0f931246ae37
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66002127"
---
# <a name="set-up-and-configure-aws-cost-and-usage-report-integration"></a>Установка и настройка интеграции отчетов AWS затратах и использовании

С помощью Amazon Web Services (AWS) стоимость и использование интеграции отчетов (ВАЛ), можно отслеживать и контролировать расходы AWS в Azure Cost Management. Интеграция позволяет централизованно в на портале Azure, где можно отслеживать и элемент управления, расходов для Azure и AWS. В этой статье объясняется, как настроить интеграцию и настроить его таким образом, чтобы использовать функции управления затратами Azure для анализа затрат и просмотрите бюджетов.

Отчет о стоимости процессов управления AWS затрат и использования хранятся в контейнер S3 с помощью учетных данных доступа AWS для получения определений отчетов и загрузить отчет, который GZIP CSV-файлы.

## <a name="create-a-cost-and-usage-report-in-aws"></a>Создание отчета об издержках и использовании в AWS

С помощью отчета об издержках и использовании способ рекомендуется AWS для сбора и обработки на AWS. Дополнительные сведения см. в разделе [AWS затраты и отчет об использовании](https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/billing-reports-costusage.html) документации.

Используйте **стоимость & отчеты об использовании** странице консоли счетов и управлением затратами в AWS, чтобы создать отчет об издержках и использовании, сделав следующее:

1. Войдите в консоль управления AWS и откройте [выставления счетов и управления затратами в консоли](https://console.aws.amazon.com/billing).
2. В области навигации выберите **стоимость & отчеты об использовании**.
3. Выберите **Создание отчета**.
4. Для **имя отчета**, введите имя для отчета.
5. Для **сведения о дополнительных отчетов** для включения в отчет и выберите идентификаторы каждого ресурса **идентификаторы ресурсов включают**.
6. Для **параметры обновления данных**, выберите отчет AWS затратах и использовании для обновления, если AWS применяется возмещения, деньги на счете, или поддерживает платежи для вашей учетной записи после завершение счета. После обновления отчета щелкните новый отчет загружается в Amazon S3. Рекомендуется оставить этот параметр на.
7. Щелкните **Далее**.
8. Для **контейнера S3**, выберите **Настройка**.
9. В диалоговом окне настройки контейнера S3 выполните одно из следующих действий.
    1. Выберите существующий контейнер в раскрывающемся списке и выберите **Далее**.
    2. Введите имя контейнера и регион, где вы хотите создать новый контейнер и выберите **Далее**.
10. Выберите, который я подтвердили, что данная политика представляет исправьте и щелкните "Сохранить".
11. (Необязательно) Префикс пути отчета введите префикс пути отчета, который требуется присоединяемый к имени отчета.
Если не указать префикс, префикс по умолчанию является имя, которое вы указали для отчета на шаге 4 и диапазон дат для отчета, в следующем формате: `/report-name/date-range/`
12. Для **единицы времени**, выберите **почасовой**.
13. Для **управление версиями отчетов**, выберите, должен ли каждый версия отчета, чтобы перезаписать предыдущую версию отчета или доставки в дополнение к предыдущей версии.
14. Для **интеграции данных для**, ничего выбирать не требуется.
15. Для **сжатия**выберите **GZIP**.
16. Щелкните **Далее**.
17. Когда вы ознакомились с параметры для отчета, выберите **проверки» и «полная**.

    Обратите внимание, имя отчета. Оно будет использоваться в последующих шагах.

Может занять до 24 часов для AWS для подачи отчетов в контейнере Amazon S3. После запуска доставки AWS обновляет файлы отчетов AWS затратах и использовании хотя бы один раз в день. Можно продолжить настройку среды AWS без ожидания доставки для запуска.

## <a name="create-a-role-and-policy-in-aws"></a>Создание роли и политики в AWS

Управление затратами Azure обращается к контейнера S3, где отчет об издержках и использовании находится несколько раз в день. Служба должна доступ к учетным данным для поиска новых данных. Создание роли и политики в AWS, чтобы разрешить управление затратами на доступ к нему.

Чтобы включить доступ к учетной записи AWS в службе управления затратами на основе ролей, роли создается в консоли AWS. Необходимо иметь _роли ARN_ и _внешний идентификатор_ из консоли AWS. Позже, можно использовать их на **Создание соединителя AWS** страницы в службе управления затратами.

Используйте новую роль мастера создания:

1. Войдите в консоль AWS и выберите **служб**.
2. В списке служб выберите **IAM**.
3. Выберите **ролей** , а затем выберите **Create Role**.
4. На следующей странице выберите **учетной записи AWS другой**.
5. В **идентификатор учетной записи**, введите **432263259397**.
6. В **параметры**выберите **требуется внешний идентификатор (рекомендуется при предполагает этой роли, третья сторона)** .
7. В **внешний идентификатор**, введите внешний идентификатор. Внешний идентификатор — это общий секретный код между роли AWS и Azure Cost Management. Также используется один и тот же внешний идентификатор на **новый соединитель** страницы в службе управления затратами. Например, идентификатор внешнего вида _Companyname1234567890123_.

    > [!NOTE]
    > Не изменяйте его для **требования MFA**. Она должна оставаться снят.
8. По завершении выберите **Next: разрешения**.
9. Выберите **Создание политики**. Откроется новая вкладка браузера. Это, где вы создаете политику.
10. Выберите **выберите службу**.

Настройка разрешений для отчета об издержках и использовании:

1. Введите **затраты и отчет об использовании**.
2. Выберите **уровень доступа** > **чтения** > **DescribeReportDefinitions**. Этот шаг предоставляет управление затратами для чтения, какие отчеты ВАЛ определяются и определить, соответствуют ли они необходимым условием определения отчета.
3. Выберите **добавить дополнительные разрешения**.

Настройка разрешений для контейнера S3 и объектов:

1. Выберите **выберите службу**.
2. Введите **S3**.
3. Выберите **уровень доступа** > **списка** > **ListBucket**. Это действие получает список объектов в контейнере S3.
4. Выберите **уровень доступа** > **чтения** > **GetObject**. Это действие позволяет скачивание файлов для выставления счетов.
5. Выберите **ресурсы**.
6. Выберите **контейнеров — добавить ARN**.
7. В **имя контейнера**, введите контейнер, используемый для хранения файлов ВАЛ.
8. Выберите **объект — добавить ARN**.
9. В **имя контейнера**, введите контейнер, используемый для хранения файлов ВАЛ.
10. В **имя объекта**выберите **любой**.
11. Выберите **добавить дополнительные разрешения**.

Настройка разрешений для обозревателя затрат:

1. Выберите **выберите службу**.
2. Введите **затрат Explorer Service**.
3. Выберите **действия всех затрат обозревателя служб (ce:\*)** . Это действие проверяет правильность коллекции.
4. Выберите **добавить дополнительные разрешения**.

Добавьте разрешение для организаций AWS:

1. Введите **организаций**.
2. Выберите **уровень доступа** > **списка** > **ListAccounts**. Это действие получает имена учетных записей.
3. В **Просмотр политики**, введите имя для новой политики. Проверьте, что вы ввели правильные сведения, а затем выберите **создать политику**.
4. Вернитесь на предыдущую вкладку и обновить веб-страницу в браузере. На панели поиска выполните поиск новой политики.
5. Выберите **далее: проверка**.
6. Введите имя для новой роли. Проверьте, что вы ввели правильные сведения, а затем выберите **Create Role**.

    Примечание роль ARN и внешний идентификатор на предыдущих шагах вы использовали при создании роли. Вы сможете их использовать в дальнейшем при настройке соединителя Azure Cost Management.

Политика JSON должен выглядеть следующим образом. Замените _bucketname_ с именем контейнера S3.

```JSON
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
"organizations:ListAccounts",
            "ce:*",
            "cur:DescribeReportDefinitions"
            ],
            "Resource": "*"
        },
        {
            "Sid": "VisualEditor1",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::bucketname",
                "arn:aws:s3:::bucketname/*"
            ]
        }
    ]
}
```

## <a name="set-up-a-new-aws-connector-in-azure"></a>Настроить новый соединитель AWS в Azure

Чтобы создать соединитель AWS и приступить к наблюдению затраты на AWS, используйте следующие сведения:

1. Войдите на [портале Azure](https://portal.azure.com).
2. Перейдите к **Cost Management + выставление счетов** > **управление затратами**.
3. В разделе **параметры**выберите **облачных соединителей (Предварительная версия)** .  
    ![Пример, демонстрирующий соединители облака (Предварительная версия) параметр)](./media/aws-integration-setup-configure/cloud-connectors-preview01.png).
4. Выберите **+ добавить** в верхней части страницы, чтобы создать соединитель.
5. На **Создание соединителя AWS** странице **отображаемое имя**, введите имя для соединителя.  
    ![Пример страницы для создания соединитель AWS](./media/aws-integration-setup-configure/create-aws-connector01.png)
6. При необходимости выберите группу управления по умолчанию. Он будет хранить все обнаруженные связанные учетные записи. Можно выполнить его настройку позднее.
7. В **выставления счетов** выберите **оплата производится автоматически 1% в общедоступной версии** Если требуется обеспечить непрерывное выполнение по истечении срока действия предварительной версии. Если выбрать автоматический, необходимо выбрать подписки выставления счетов.
8. Для **ARN роли**, введите значение, которое вы использовали при настройке роли в AWS.
9. Для **внешний идентификатор**, введите значение, которое вы использовали при настройке роли в AWS.
10. Для **имя отчета**, введите имя, которое вы создали в AWS.
11. Выберите **Далее** , а затем выберите **создать**.

Может занять несколько часов новые области AWS, AWS consolidated учетной записи и учетных записей AWS связанного и их стоимость, для отображения данных.

После создания соединителя, рекомендуется назначать доступ к нему. Пользователи назначаются разрешения для вновь обнаруженных областей: AWS консолидированные учетной записи и учетных записей AWS связанной. Пользователь, создающий соединитель является владельцем соединитель, консолидированных учетную запись и все связанные учетные записи.

Назначение разрешений соединителя для пользователей, после обнаружения не назначить разрешения для существующих областей видимости AWS. Вместо этого только новые связанные учетные записи назначаются разрешения.

## <a name="take-additional-steps"></a>Выполнить дополнительные действия

- [Настройка групп управления](../governance/management-groups/index.md#initial-setup-of-management-groups), если у вас еще нет.
- Проверьте, что новые области добавляются в средстве выбора области. Выберите **обновить** для просмотра последних данных.
- На **облачных соединителей** выберите соединитель и выберите **перейдите к учетной записи выставления счетов** для назначения связанной учетной записи для группы управления.

## <a name="manage-cloud-connectors"></a>Управление соединителями облака

При выборе соединитель на **облачных соединителей** страницы, вы можете:

- Выберите **перейдите к учетной записи выставления счетов** для просмотра сведений о AWS consolidated учетной записи.
- Выберите **контроля доступа** управлять назначением ролей для соединителя.
- Выберите **изменить** обновить соединитель. Невозможно изменить номер учетной записи AWS, так как он отображается в роли ARN. Но вы можете создать новый соединитель.
- Выберите **Verify** для повторного выполнения тестов проверки, чтобы убедиться в том, что управление затратами может собирать данные с помощью параметров соединителя.

![Пример списка созданных соединителей AWS](./media/aws-integration-setup-configure/list-aws-connectors.png)

## <a name="set-up-azure-management-groups"></a>Настройка групп управления Azure

Чтобы создать единое расположение для просмотра сведения о поставщике облачной, необходимо поместить подписок Azure и AWS связанные учетные записи в той же группы управления. Если вы еще не настроен среде Azure с помощью групп управления, см. в разделе [начальная настройка групп управления](../governance/management-groups/index.md#initial-setup-of-management-groups).

Если вы хотите отделить затраты, можно создать группу управления, которая содержит только учетные записи AWS связанной.

## <a name="set-up-an-aws-consolidated-account"></a>Настройка AWS consolidated учетной записи

Учетная запись AWS consolidated сочетает в себе выставления счетов и оплаты для нескольких учетных записей AWS. Он также выступает в качестве учетной записи AWS связанной.

![Сведения о примере для AWS consolidated учетной записи](./media/aws-integration-setup-configure/aws-consolidated-account01.png)

На странице вы можете:

- Выберите **обновление** для массового обновления связь AWS связанные учетные записи, с группой управления.
- Выберите **контроля доступа** для параметра "Назначение роли для области".

### <a name="permissions-for-an-aws-consolidated-account"></a>Разрешения для AWS consolidated учетной записи

По умолчанию для учетной записи AWS объединенные разрешения после создания учетной записи, в зависимости от разрешений соединителя AWS. Создатель соединителя является владельцем.

Управлять уровнем доступа с помощью **уровень доступа** странице AWS consolidated учетной записи. Тем не менее, AWS связанные учетные записи не наследуют разрешения учетной записи AWS объединены.

## <a name="set-up-an-aws-linked-account"></a>Настройка учетной записи AWS связанной

Учетная запись AWS связанной является, где создаются и управляются ресурсов AWS. Связанной учетной записи также выступает в качестве границы безопасности.

На этой странице вы можете:

- Выберите **обновление** для обновления связь AWS связанной учетной записи с группой управления.
- Выберите **контроля доступа** задать назначения ролей для области.

![Пример страницы в связанной учетной записи AWS](./media/aws-integration-setup-configure/aws-linked-account01.png)

### <a name="permissions-for-an-aws-linked-account"></a>Разрешения для AWS связанной учетной записи

По умолчанию разрешения для учетной записи AWS связанной устанавливаются при создании на основе разрешений соединителя AWS. Создатель соединителя является владельцем. Управлять уровнем доступа с помощью **уровень доступа** странице AWS связанной учетной записи. AWS связанные учетные записи не наследуют разрешения из учетной записи AWS объединены.

AWS связанные учетные записи всегда наследуют разрешения из группы управления, которому они принадлежат.

## <a name="next-steps"></a>Дальнейшие действия

- Теперь, установки и настройки стоимость AWS и использование интеграции отчетов перейдите к [управление AWS затраты и использование](aws-integration-manage.md).
- Если вы не знакомы с анализа затрат, см. в разделе [исследовать и анализировать затраты с помощью анализа затрат](quick-acm-cost-analysis.md) быстрого запуска.
- Если вы не знакомы с бюджеты в Azure, см. в разделе [Создание и управление Azure бюджеты](tutorial-acm-create-budgets.md).
