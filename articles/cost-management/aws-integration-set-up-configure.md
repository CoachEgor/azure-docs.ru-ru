---
title: Установка и настройка интеграции отчетов AWS затратах и использовании в Azure Cost Management
description: В этой статье описана на то, что установка и настройка интеграции отчетов AWS затратах и использовании в Azure Cost Management.
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 06/06/2019
ms.topic: conceptual
ms.service: cost-management
manager: ormaoz
ms.custom: ''
ms.openlocfilehash: a7a020284f44eda0da62f307866c74b0a8df493d
ms.sourcegitcommit: 0568c7aefd67185fd8e1400aed84c5af4f1597f9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65205698"
---
# <a name="set-up-and-configure-aws-cost-and-usage-report-integration"></a>Установка и настройка интеграции отчетов AWS затратах и использовании

С помощью Amazon Web Services стоимость и использование интеграции отчетов можно отслеживать и контролировать расходы AWS в Azure Cost Management. Интеграция позволяет централизованно в на портале Azure, где можно отслеживать и элемент управления, расходов для Azure и AWS. В этой статье объясняется, как настроить интеграцию и настроить его таким образом, чтобы использовать функции управления затрат для анализа затрат и просмотрите бюджетов.

Отчет о стоимости процессов управления AWS затрат и использования хранятся в контейнер S3 с помощью учетных данных доступа AWS для получения определений отчетов и загрузить отчет, который GZIP CSV-файлы.

## <a name="create-a-cost-and-usage-report-in-aws"></a>Создание отчета об издержках и использовании в AWS

С помощью отчета об издержках и использовании — AWS, мы советуем для сбора и обработки на AWS. Дополнительные сведения см. в разделе [AWS затраты и отчет об использовании](https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/billing-reports-costusage.html) статьей документации.

Используйте **отчеты** странице консоли счетов и управлением затратами в AWS, чтобы создать отчет об издержках и использовании, выполнив следующие действия.

1. Войдите в консоль управления AWS и откройте консоль выставления счетов и управления затратами на https://console.aws.amazon.com/billing.
2. В области навигации щелкните **отчеты**.
3. Нажмите кнопку **Создание отчета**.
4. Для **имя отчета**, введите имя для отчета.
5. Для **единицы времени**, выберите **почасовой**.
6. Для **Include**, добавьте идентификаторы для каждого ресурса в отчете и выберите **идентификаторы ресурсов**.
7. Для **включить поддержку**, ничего выбирать не требуется.
8. Для **параметры обновления данных**выберите **автоматически обновлять ваши расходы &amp; отчет об использовании при обнаружении расходов для за предыдущие месяцы имеют закрыто ведомостей**.
9. Нажмите кнопку **Далее**.
10. Для **контейнере Amazon S3**, введите имя контейнера Amazon S3, место отчеты на и нажмите кнопку **Verify**. Сегмент должен иметь соответствующие разрешения был допустимым. Дополнительные сведения о добавлении разрешений для контейнеров, см. в разделе [параметр контейнера и прав доступа объекта](http://docs.aws.amazon.com/AmazonS3/latest/user-guide/set-permissions.html).
11. Для **префикс пути отчета**, введите префикс пути отчета, который требуется добавить к имени отчета.
12. Для **сжатия**выберите **GZIP**.
13. Нажмите кнопку **Далее**.
14. Ознакомившись параметры для отчета, нажмите кнопку **проверки» и «полная**.
    Примечание **имя отчета**. Он понадобится на следующих шагах.

Может занять до 24 часов для AWS для подачи отчетов в контейнере Amazon S3. После запуска доставки AWS обновляет файлы отчетов AWS затратах и использовании хотя бы один раз в день. Можно продолжить настройку среды AWS без ожидания доставки для запуска.

## <a name="create-a-role-and-policy-in-aws"></a>Создание роли и политики в AWS

Управление затратами Azure обращается к контейнера S3, где отчет об издержках и использовании находится несколько раз в день. Управление затратами требуется доступ к учетным данным для поиска новых данных. Создание роли и политики в AWS, чтобы разрешить доступ для управления затратами.

Чтобы включить доступ к учетной записи AWS в службе управления затратами Azure на основе ролей, роли создается в консоли AWS. Необходимо иметь _ARN роли_ и _внешний идентификатор_ из консоли AWS. Позже они используются в создание страницу соединитель AWS в Azure Cost Management.

Используйте роль мастера создания:

1. Войдите в консоль AWS и выберите **служб**.
2. В списке служб выберите **IAM**.
3. Выберите **ролей** и нажмите кнопку **Create Role**.
4. На следующей странице выберите **учетной записи AWS другой**.
5. В **идентификатор учетной записи** , введите _432263259397_.
6. В **параметры**выберите **требуется внешний идентификатор (рекомендуется при предполагает этой роли, третья сторона)**.
7. В **внешний идентификатор**, введите внешний идентификатор. Внешний идентификатор — это общий секретный код между роли AWS и Azure Cost Management. На странице новый соединитель в службе управления затратами также используется один и тот же внешний идентификатор. Например, идентификатор внешнего вида _Companyname1234567890123_.
    Не изменять выбор для **требования MFA**. Она должна оставаться снят.
8. Щелкните **Далее: разрешения**.
9. Щелкните **Create policy** (Создать политику). Открывается новая вкладка браузера, где создать новую политику.
10. Нажмите кнопку **выберите службу**.

Настройте разрешение затрат и отчет об использовании:

1. Тип **затраты и отчет об использовании**.
2. Выберите **уровень доступа**, **чтения** > **DescribeReportDefinitions**. Благодаря этому управление затратами чтения, что именно ВАЛ сообщает о определяются и определить, соответствуют ли они необходимым условием определения отчета.
3. Нажмите кнопку **добавить дополнительные разрешения**.

Настройте разрешение контейнеров и объектов S3:

1. Нажмите кнопку **выберите службу**.
2. Тип _S3_.
3. Выберите **уровень доступа**, **списка** > **ListBucket**. Это действие получает список объектов в контейнере S3.
4. Выберите **уровень доступа**, **чтения** > **GetObject**. Это действие позволяет выставления счетов скачивания файлов.
5. Выберите **ресурсы**.
6. Выберите **контейнеров — добавить ARN**.
7. В **имя контейнера**, введите контейнер, используемый для хранения файлов ВАЛ.
8. Выберите **объект — добавить ARN**.
9. В **имя контейнера**, введите контейнер, используемый для хранения файлов ВАЛ.
10. В **имя объекта**выберите **любой**.
11. Нажмите кнопку **добавить дополнительные разрешения**.

Настройте разрешение Explorer затрат:

1. Нажмите кнопку **выберите службу**.
2. Тип _затрат Explorer Service_.
3. Выберите **действия всех затрат обозревателя служб (ce:\*)**. Это действие проверяет правильность коллекции.
4. Нажмите кнопку **добавить дополнительные разрешения**.

Добавьте разрешение организаций:

1. Тип **организаций**.
2. Выберите **уровень доступа, списка** > **ListAccounts**. Это действие получает имена учетных записей.
3. В **Просмотр политики**, введите имя для новой политики. Проверьте, убедитесь, что вы ввели правильные сведения и нажмите кнопку **создать политику**.
4. Вернитесь на предыдущую вкладку и обновите веб-страницу в браузере. На панели поиска выполните поиск новой политики.
5. Выберите **далее: проверка**.
6. Введите имя для новой роли. Проверьте, убедитесь, что вы ввели правильные сведения и нажмите кнопку **Create Role**.
    Примечание **ARN роли** и **внешний идентификатор** на предыдущих шагах вы использовали при создании роли. Вам будет их использовать в дальнейшем при настройке соединителя Azure Cost Management.

Политика JSON должен выглядеть следующим образом. Замените _bucketname_ с именем контейнера S3.

```JSON
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
"organizations:ListAccounts",
            "ce:*",
            "cur:DescribeReportDefinitions"
            ],
            "Resource": "*"
        },
        {
            "Sid": "VisualEditor1",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::bucketname",
                "arn:aws:s3:::bucketname/*"
            ]
        }
    ]
}
```

## <a name="set-up-a-new-aws-connector-in-azure"></a>Настроить новый соединитель AWS в Azure

Используйте следующие сведения для создания нового соединителя AWS и начать наблюдение за свои затраты на AWS.

1. Войдите на портал Azure по https://portal.azure.com.
2. Перейдите к **Cost Management + выставление счетов** > **управление затратами**.
3. В разделе **параметры**, нажмите кнопку **облачных соединителей (Предварительная версия)**.  
    ![Пример, демонстрирующий соединители облака (Предварительная версия параметр)](./media/aws-integration-setup-configure/cloud-connectors-preview01.png).
4. Нажмите кнопку **+ добавить** в верхней части страницы, чтобы создать новый соединитель.
5. На создание страницей соединитель AWS, введите **отображаемое имя** имя соединителя.  
    ![Пример создания страницей соединитель AWS](./media/aws-integration-setup-configure/create-aws-connector01.png)
6. При необходимости выберите группу управления по умолчанию. Он будет хранить все обнаруженные связанные учетные записи. Можно выполнить его настройку позднее.
7. В разделе **выставления счетов** выберите **оплата производится автоматически 1% в общедоступной версии** Если требуется обеспечить непрерывное выполнение по истечении срока действия предварительной версии. Если выбрать автоматический, необходимо выбрать выставления счетов **подписки**.
8. Введите **роли ARN**. Это значение, которое вы использовали при настройке роли в AWS.
9. Введите **внешний идентификатор**. Это значение, которое вы использовали при настройке роли в AWS.
10. Введите **имя отчета** , созданный в AWS.
11. Нажмите кнопку **Далее** и нажмите кнопку **создать**.

Может занять несколько часов новые области AWS, учетной записи AWS консолидированных и связанные учетные записи AWS и их данные о затратах отображаются.

После создания соединителя, мы рекомендуем назначить контроля доступа к соединителю. Пользователи назначаются разрешения для вновь обнаруженных областей: AWS консолидированные счета и AWS связанные учетные записи. Пользователь, который создает соединитель является владельцем, консолидированных учетной записи, и все связанные учетные записи.

Назначение разрешений соединителя для пользователей, после обнаружения не назначить разрешения для существующих областей видимости AWS. Вместо этого только новые связанные учетные записи назначаются разрешения.

## <a name="additional-steps"></a>Дополнительные действия

- [Настройка групп управления](../governance/management-groups/index.md#initial-setup-of-management-groups), если у вас еще нет.
- Проверьте, что новые области добавляются в средстве выбора области. Не забудьте нажать кнопку **обновить** для просмотра последних данных.
- На странице соединителя облачной, выберите соединитель и нажмите кнопку **перейдите к учетной записи выставления счетов** для назначения связанной учетной записи для группы управления.

## <a name="manage-cloud-connectors"></a>Управление соединителями облака

При выборе соединителя на странице соединителей облака, вы можете:

- Нажмите кнопку **перейдите к учетной записи выставления счетов** для просмотра сведений учетной записи AWS при консолидации.
- Нажмите кнопку **контроля доступа** управлять назначением ролей для соединителя.
- Нажмите кнопку **изменить** обновить соединитель. Номер учетной записи AWS, изменить нельзя, как оно отображается в ARN роли. Тем не менее можно создать новый соединитель.
- Нажмите кнопку **Verify** для повторного выполнения тестов проверки, чтобы убедиться в том, что управление затратами может собирать данные, используя выбранные параметры соединителя.

![Пример, показывающий список соединителей, созданных AWS](./media/aws-integration-setup-configure/list-aws-connectors.png)

## <a name="role-of-azure-management-groups"></a>Роли групп управления Azure

Чтобы создать единое расположение для просмотра сведения о поставщике облачной, необходимо поместить подписок Azure и AWS связанные учетные записи в той же группы управления. Если вы еще не настроен среде Azure с помощью групп управления, см. в разделе [начальная настройка групп управления](../governance/management-groups/index.md#initial-setup-of-management-groups).

Если вы хотите отделить затраты, можно создать группу управления, которая содержит только учетные записи AWS связанной.

## <a name="aws-consolidated-account"></a>Учетная запись AWS Consolidated

Учетная запись AWS Consolidated используется для объединения выставления счетов и оплаты для нескольких учетных записей AWS. Учетной записи AWS Consolidated также выступает в роли AWS связанной учетной записи.

![Пример того, сведения об учетной записи Consolidated AWS](./media/aws-integration-setup-configure/aws-consolidated-account01.png)

На странице вы можете:

- Нажмите кнопку **обновление** для массового обновления AWS связанные учетные записи связь с группой управления.
- Нажмите кнопку **контроля доступа** для параметра "Назначение роли для области".

### <a name="aws-consolidated-account-permissions"></a>AWS объединенные разрешения учетной записи

По умолчанию AWS консолидированные учетной записи, при создании на основе разрешений соединителя AWS установлены разрешения. Создатель соединителя является владельцем.

Уровень доступа управлять с помощью страницы уровень доступа учетной записи AWS объединены. Тем не менее, разрешения на AWS consolidated учетной записи, не наследуются AWS связанные учетные записи.

## <a name="aws-linked-account"></a>AWS связанной учетной записи

AWS связанной учетной записи — где создаются и управляются ресурсов AWS. Связанной учетной записи также выступает в качестве границы безопасности.

На этой странице вы можете:

- Нажмите кнопку **обновление** для обновления связи учетной записи AWS связанного с группой управления.
- Нажмите кнопку **контроля доступа** задать назначения ролей для области.

![Пример страницы в связанной учетной записи AWS](./media/aws-integration-setup-configure/aws-linked-account01.png)

### <a name="aws-linked-account-permissions"></a>AWS связанных разрешений учетной записи

По умолчанию AWS связанной учетной записи разрешения задаются при создании на основе разрешений соединителя AWS. Создатель соединителя является владельцем. Уровень доступа управлять с помощью страницы уровень доступа AWS связанной учетной записи. Разрешения для учетной записи AWS Consolidated не наследуются AWS связанные учетные записи.

AWS связанные учетные записи всегда наследуют разрешения из группы управления, которому они принадлежат.

## <a name="next-steps"></a>Дальнейшие действия

- Теперь, установки и настройки стоимость AWS и использование интеграции отчетов перейдите к [управление AWS затраты и использование](aws-integration-manage.md).
- Если вы не знакомы с анализа затрат, см. в разделе [исследовать и анализировать затраты с помощью анализа затрат](quick-acm-cost-analysis.md) быстрого запуска.
- Если вы не знакомы с бюджеты в Azure, см. в разделе [Создание и управление Azure бюджеты](tutorial-acm-create-budgets.md) руководства.
