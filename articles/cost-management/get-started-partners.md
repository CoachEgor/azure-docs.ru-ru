---
title: Приступая к работе со службой "Управление затратами Azure" для партнеров
description: В этой статье объясняется, как партнеры используют функции управления затратами Azure и как они обеспечивают доступ к управлению затратами для своих клиентов.
services: cost-management
keywords: ''
author: bandersmsft
ms.author: banders
ms.date: 10/22/2019
ms.topic: conceptual
ms.service: cost-management
manager: aparnag
ms.custom: secdec18
ms.openlocfilehash: 6d59964013a2631430ecd7e46d1ce0f6be60a05f
ms.sourcegitcommit: be8e2e0a3eb2ad49ed5b996461d4bff7cba8a837
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72802030"
---
# <a name="get-started-with-azure-cost-management-for-partners"></a>Приступая к работе со службой "Управление затратами Azure" для партнеров

Служба "Управление затратами Azure" изначально доступна для партнеров, которые применяют клиентов к Соглашению Майкрософт. В этой статье объясняется, как партнеры используют функции [управления затратами Azure](https://docs.microsoft.com/azure/cost-management/) . Здесь также описывается, как партнеры обеспечивают доступ к управлению затратами для своих клиентов. Клиенты могут использовать функции управления затратами при включении их партнером CSP.

Партнеры CSP используют управление затратами для:

- Изучите стоимость выставленных счетов и свяжите расходы с клиентами, подписками, группами ресурсов и службами.
- Получите интуитивно понятное представление затрат Azure в [анализе затрат](quick-acm-cost-analysis.md) с помощью возможностей для анализа затрат по клиентам, подпискам, группам ресурсов, ресурсам, измерениям, службам и многим другим измерениям.
- Просмотр затрат на ресурсы, которые были применены к анализу затрат по кредитному партнёру (PEC).
- Настройте уведомления и автоматизацию с помощью программных [бюджетов](tutorial-acm-create-budgets.md) и оповещений, если затраты превышают бюджеты.
- Включите политику Azure Resource Manager, которая обеспечивает доступ клиентов к данным управления затратами. Клиенты могут просмотреть данные о затратах на потребление для своих подписок, используя [тарифы с оплатой по мере](https://azure.microsoft.com/pricing/calculator/)использования.

Ниже приведен пример, демонстрирующий затраты для всех клиентов.
![пример, в котором показаны затраты для всех клиентов](./media/get-started-partners/customer-costs1.png)

Ниже приведен пример, демонстрирующий затраты для одного клиента.
![пример, демонстрирующий затраты для одного клиента](./media/get-started-partners/customer-costs2.png)

Все функциональные возможности, доступные в службе "Управление затратами Azure", также доступны с помощью интерфейсов API. Используйте API для автоматизации задач управления затратами.

## <a name="prerequisites"></a>Технические условия

Служба управления затратами Azure требует доступа на чтение к учетной записи выставления счетов или к подписке. Доступ может предоставляться на любом уровне выше ресурсов, от учетной записи выставления счетов или группы управления до отдельных групп ресурсов, в которых вы управляете приложениями. Дополнительные сведения о включении и назначении доступа к службе "Управление затратами Azure" для счета выставления счетов см. в разделе [назначение ролей и разрешений пользователей](/partner-center/permissions-overview). Роли **глобального администратора** и **агента администратора** могут управлять затратами на выставление счетов.

Полный список поддерживаемых типов учетных записей см. в разделе [Общие сведения об управлении затратами](understand-cost-mgt-data.md).


## <a name="how-cost-management-uses-scopes"></a>Как в управлении затратами используются области

Области — это место, где вы управляете данными для выставления счетов, имеете роли, относящиеся к платежам, просматривайте счета и проводите общее управление учетными записями. Управление выставлением счетов и учетными записями осуществляется отдельно от областей, используемых для управления ресурсами, которые используют RBAC. Чтобы четко отличать назначение отдельных областей, включая различия в управлении доступом, они называются областью выставления счетов и областями RBAC соответственно.

Сведения об областях выставления счетов и ограничениях RBAC, а также о том, как управление затратами работает с областями, см. в разделе [Общие сведения и работа с областями](understand-work-scopes.md).

## <a name="manage-costs-with-partner-tenant-billing-scopes"></a>Управление затратами с помощью областей выставления счетов клиентов-партнеров

После подключения клиентов к соглашению с клиентами Майкрософт в вашем клиенте будут доступны следующие _области выставления счетов_ . Используйте области для управления затратами в управлении затратами.

### <a name="billing-account-scope"></a>Область счета выставления счетов

Используйте область счета выставления счетов для просмотра затрат на предварительный налог по всем клиентам и профилям выставления счетов. Затраты на счета отображаются только для продуктов, основанных на потреблении клиентов, в соглашении с клиентами Майкрософт. Однако затраты на счета отображаются для приобретенных продуктов для клиентов как в соглашении клиента Майкрософт, так и в предложении CSP. В настоящее время в качестве валюты по умолчанию для просмотра затрат в области используется доллар США. Бюджеты, заданные для области, также вычисляются в долларах США.

Независимо от различных валют, оплачиваемых счетами клиентов, партнеры используют область счетов для оплаты для задания бюджетов и управления затратами в долларах США по клиентам, подпискам, ресурсам и группам ресурсов.

Партнеры также фильтруют затраты в определенной валюте выставления счетов среди клиентов в представлении «анализ затрат». Выберите список **фактических затрат** , чтобы просмотреть затраты в поддерживаемых валютах выставления счетов клиента.

![Пример, в котором показаны фактические затраты на выбор для валют](./media/get-started-partners/actual-cost-selector.png)

Используйте [представление "амортизация затрат](quick-acm-cost-analysis.md#customize-cost-views) " в областях выставления счетов для просмотра зарезервированных фиксированных затрат в рамках срока резервирования.

### <a name="billing-profile-scope"></a>Область профиля выставления счетов

Используйте область профиля выставления счетов для просмотра предварительных затрат в валюте оплаты по всем клиентам для всех продуктов и подписок, входящих в счет. Вы можете фильтровать затраты в профиле выставления счетов для определенного счета с помощью фильтра **инвоицеид** . Фильтр показывает затраты на использование и приобретение продуктов для определенного счета. Вы также можете отфильтровать затраты для конкретного клиента в счете, чтобы увидеть затраты на предварительную налогообложение.

После подключения клиентов к соглашению с клиентами Майкрософт вы получаете счет, который включает все платежи для всех продуктов (потребления, покупок и прав) для этих клиентов в соответствии с соглашением клиента Майкрософт. При выставлении счета за одну и ту же валюту счета также включают расходы на использование и приобретенные продукты, такие как SaaS, Azure Marketplace и резервирования для клиентов, которые все еще находятся в предложении CSP.

Для согласования расходов по счету клиента область профиля выставления счетов позволяет просматривать все расходы, которые начисляются для клиентов. Как и в счете, область отображает затраты для каждого клиента в новом соглашении клиента Майкрософт. Эта область также показывает каждую плату за продукты для обслуживания клиентов, которые по-прежнему находятся в текущем предложении CSP.

Профиль выставления счетов и области счета выставления счетов являются единственными применимыми областями, которые показывают расходы на продукты на основе обслуживания и покупки, такие как Azure Marketplace и покупки по резервированию.

Профили выставления счетов определяют подписки, которые включены в счет. Профили выставления счетов являются функциональным аналогом регистрации соглашения Enterprise. Профиль выставления счетов — это область, в которой создаются счета.

В настоящее время валюта выставления счетов клиента является валютой по умолчанию при просмотре затрат в области профиля выставления счетов. Бюджеты, заданные в области профиля выставления счетов, относятся к валюте выставления счетов.

Партнеры могут использовать область для сверки с счетами. Кроме того, они используют область для задания бюджетов в валюте оплаты для следующих элементов:

- Конкретный отфильтрованный счет
- Клиент
- Subscription
- группа ресурсов.
- Ресурс
- Служба Azure
- Метрика
- ResellerMPNID

### <a name="customer-scope"></a>Область клиента

Партнеры используют область для управления затратами, связанными с клиентами, подключенными к соглашению клиента Майкрософт. Область позволяет партнерам просматривать затраты на предварительную налогообложение для конкретного клиента. Можно также отфильтровать затраты на предварительный налог для конкретной подписки, группы ресурсов или ресурса.

В область клиента не входят клиенты, которые относятся к текущему предложению CSP. Область включает только клиентов, у которых есть соглашение с клиентами Майкрософт. Затраты на обслуживание, а не использование Azure, для текущих клиентов с предложением CSP доступны в учетной записи выставления счетов и в области профиля выставления счетов при применении фильтра клиента.

## <a name="partner-access-to-billing-scopes-in-cost-management"></a>Доступ партнеров к областям выставления счетов в управлении затратами

Только пользователи с ролями **глобального администратора** и **агента администратора** могут управлять и просматривать затраты для счетов выставления счетов, профилей выставления счетов и клиентов непосредственно в клиенте Azure партнера. Дополнительные сведения о ролях центров партнеров см. в разделе [назначение ролей и разрешений пользователей](/partner-center/permissions-overview).

## <a name="enable-cost-management-in-the-customer-tenant"></a>Включение управления затратами в клиенте клиента

Партнеры могут разрешить доступ к управлению затратами после того, как клиенты будут подключены к соглашению для клиентов Майкрософт. Затем партнеры могут включить политику, позволяющую клиентам просматривать свои затраты, вычисленные в розничных тарифах с оплатой по мере использования. Затраты отображаются в валюте выставления счетов клиента для использования в областях подписки RBAC и групп ресурсов.

Когда партнер включает политику видимости затрат, любой пользователь с Azure Resource Manager доступом к подписке может управлять затратами и анализировать их в соответствии с тарифами с оплатой по мере использования. Фактически, торговые посредники и клиенты, имеющие соответствующий доступ RBAC к подпискам Azure, могут просматривать затраты.

Независимо от политики партнеры могут также просматривать затраты, если у них есть доступ к подписке и группе ресурсов.

### <a name="enable-the-policy-to-view-azure-usage-charges"></a>Включение политики для просмотра расходов на использование Azure

Партнеры используют следующие сведения, чтобы включить политику для просмотра расходов на использование Azure для своих клиентов.

В портал Azure Войдите в клиент-партнер и щелкните **Управление затратами + выставление счетов**. Выберите счет для выставления счетов и щелкните **Customers (клиенты**). Список клиентов связан с учетной записью выставления счетов.

В списке клиентов выберите клиента, для которого требуется разрешить просмотр затрат.

![Выбор клиентов в управлении затратами](./media/get-started-partners/customer-list.png)

В разделе **Параметры**щелкните **политики**.

Текущая политика видимости затрат отображается для расходов на **Использование Azure** , связанных с подписками для выбранного клиента.
![политика, позволяющая клиентам просматривать оплату с оплатой по мере использования](./media/get-started-partners/cost-management-billing-policies.png)

Если для политики установлено значение **нет**, служба "Управление затратами Azure" недоступна для пользователей подписки, связанных с клиентом. По умолчанию политика видимости затрат отключена для всех пользователей подписки, если она не включена партнером.

Если для политики стоимости задано значение **Да**, пользователи подписки, связанные с клиентом клиента, могут просматривать расходы на использование в тарифах с оплатой по мере использования.

Если включена политика видимости затрат, все службы, имеющие использование подписок, показывают затраты при тарифах с оплатой по мере использования. При использовании резервирования отображается нулевая плата за фактические и амортизацию. Покупки и права не связаны с определенной подпиской. Поэтому покупки не отображаются в области действия подписки.

Чтобы просмотреть затраты клиента клиента, откройте управление затратами + выставление счетов, а затем щелкните счета выставления счетов. В списке счетов выставления счетов щелкните счет выставления счетов.

![Выберите счет для выставления счетов](./media/get-started-partners/select-billing-account.png)

В разделе **выставление счетов**щелкните **подписки Azure**, а затем щелкните клиента.

![Выберите клиента подписки Azure](./media/get-started-partners/subscriptions-select-customer.png)

Щелкните **анализ затрат** и начните просмотр затрат.
Анализ затрат, бюджеты и оповещения теперь доступны для областей подписки и группы ресурсов RBAC при затратах на основе ставок с оплатой по мере использования.

![Просмотр анализа затрат как клиента ](./media/get-started-partners/customer-tenant-view-cost-analysis.png)

В незаполненных представлениях и фактических затратах для зарезервированных экземпляров в областях RBAC отображается нулевая плата. Затраты на зарезервированные экземпляры отображаются только в областях выставления счетов, в которых были совершены покупки.

## <a name="analyze-costs-in-cost-analysis"></a>Анализ затрат в анализе затрат

Партнеры могут исследовать и анализировать затраты в анализе затрат по клиентам для конкретного клиента или для счета. Функции Filter и Group By позволяют анализировать затраты по нескольким полям, в том числе:

| **Поле** | **Описание** |
| --- | --- |
| партнертенантид | Идентификатор клиента Azure Active Directory партнера |
| PartnerName | Имя клиента Azure Active Directory партнера |
| кустомертенантид | Идентификатор клиента Azure Active Directory подписки клиента. |
| CustomerName | Имя клиента Azure Active Directory, содержащего подписку клиента |
| ResellerMPNID | MPNID для торгового посредника, связанного с подпиской |
| Идентификатор подписки | Уникальный идентификатор, созданный корпорацией Майкрософт для подписки Azure |
| subscriptionName | Имя подписки Azure |
| биллингпрофилеид | Идентификатор профиля выставления счетов. Она группирует затраты между счетами в одной валюте выставления счетов среди клиентов.
| инвоицеид | Идентификатор счета в счете, где отображается конкретная транзакция |
| resourceGroup | Имя группы ресурсов Azure. Используется для управления жизненным циклом ресурсов. |
| партнереарнедкредитрате | Скидка, применяемая при наличии тарифного кредита (PEC), основанного на доступе партнерского администратора. |
| партнереарнедкредитапплиед | Указывает, был ли применен получившийся кредит партнера. |

В представлении « [анализ затрат](quick-acm-cost-analysis.md) » можно также [сохранять представления](quick-acm-cost-analysis.md#saving-and-sharing-customized-views) и экспортировать данные в [CSV-и PNG-файлы](quick-acm-cost-analysis.md#automation-and-offline-analysis).

## <a name="view-partner-earned-credit-pec-resource-costs"></a>Просмотр затрат ресурсов на получение кредитных кредитов (PEC)

В службе "Управление затратами Azure" партнеры могут использовать анализ затрат для просмотра затрат, получивших преимущества PEC.

В портал Azure Войдите в клиент-партнер и выберите **Управление затратами + выставление счетов**. В разделе **Управление затратами**щелкните **анализ затрат**.

В представлении "анализ затрат" отображаются затраты на счет выставления счетов для партнера. Выберите **область** , необходимую для партнера, определенного клиента или профиля выставления счетов для выверки счетов.

В кольцевой диаграмме щелкните раскрывающийся список и выберите **партнереарнедкредитапплиед** для детализации затрат PEC.

![Пример, в котором показано, как просмотреть полученные от партнеров кредиты](./media/get-started-partners/cost-analysis-pec1.png)

Если свойство **партнереарнедкредитапплиед** имеет _значение true_, связанная с ним стоимость имеет преимущество администратора, полученного от партнера.

Если свойство **партнереарнедкредитапплиед** имеет _значение false_, связанная стоимость не соответствует требованиям, необходимым для кредита. Или приобретенная служба не подходит для кредитного кредита партнера.

В службе "Управление затратами" для отображения данных об использовании служб обычно требуется 8-24 часов. Дополнительные сведения см. в разделе [Частота обновления данных об использовании](understand-cost-mgt-data.md#usage-data-update-frequency-varies). Кредиты PEC отображаются в течение 48 часов со времени доступа в службе "Управление затратами Azure".


Можно также группировать и фильтровать по свойству **партнереарнедкредитапплиед** с помощью параметров **Group By** . Используйте параметры для проверки затрат, которые не используют PEC.

![Группировка или фильтрация по партнерам — кредитные кредиты](./media/get-started-partners/cost-analysis-pec2.png)

## <a name="cost-management-rest-apis"></a>API-интерфейсы других функций управления затратами

Партнеры и клиенты могут использовать API управления затратами, описанные в следующих разделах, для решения распространенных задач.

### <a name="azure-cost-management-apis---direct-and-indirect-providers"></a>API-интерфейсы управления затратами Azure — прямые и косвенные поставщики

Партнеры, имеющие доступ к областям выставления счетов в клиенте-партнере, могут использовать следующие API для просмотра затрат по счетам.

Интерфейсы API в области подписки могут вызываться партнером независимо от политики затрат, если они имеют доступ к подписке. Другие пользователи, имеющие доступ к подписке, например клиенту или торговому посреднику, могут вызывать API только после того, как партнер включит политику затрат для клиента клиента.


#### <a name="to-get-a-list-of-billing-accounts"></a>Получение списка счетов выставления счетов

```
armclient get "providers/Microsoft.billing/billingAccounts?api-version=2019-10-01-preview"
```

#### <a name="to-get-a-list-of-customers"></a>Получение списка клиентов

```
armclient get "providers/Microsoft.billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/customers?api-version=2019-10-01-preview"
```
#### <a name="to-get-a-list-of-subscriptions"></a>Получение списка подписок

```
armclient get "/providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/customers/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY/billingSubscriptions?api-version=2019-10-01-preview"
```

#### <a name="to-get-the-policy-for-customers-to-view-costs"></a>Получение политики для клиентов для просмотра затрат

```
armclient get "providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/customers/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY/policies/default?api-version=2019-10-01-preview"
```

#### <a name="to-set-the-policy-for-customers-to-view-costs"></a>Настройка политики для клиентов для просмотра затрат

```
armclient put "providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/customers/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY/policies/default?api-version=2019-10-01-preview" @policy.json
```

#### <a name="to-get-azure-service-usage-for-a-billing-account"></a>Получение сведений об использовании службы Azure для учетной записи выставления счетов

```
armclient GET /providers/Microsoft.Billing/BillingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/providers/Microsoft.Consumption/usageDetails?api-version=2019-10-01
```

#### <a name="to-download-a-customers-azure-service-usage"></a>Загрузка службы Azure, используемой клиентом

Следующий вызов get является асинхронной операцией.

```
armclient get providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/customers/YYYYYYYY-YYYY-YYYY-YYYY-YYYYYYYYYYYY/providers/Microsoft.Consumption/usageDetails/download?api-version=2019-10-01 -verbose
```

Вызовите `Location` URI, возвращенный в ответе, чтобы проверить состояние операции. По *завершении*состояния свойство `downloadUrl` содержит ссылку, которую можно использовать для загрузки созданного отчета.


#### <a name="to-get-or-download-the-price-sheet-for-consumed-azure-services"></a>Чтобы получить или скачать прайс лист для использования служб Azure

Сначала используйте следующую запись.

```
armclient post "/providers/Microsoft.Billing/BillingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/billingProfiles/YYYY-YYYY-YYY-YYYY-YYY/pricesheet/default/download?api-version=2019-10-01-preview&format=csv" -verbose
```

Затем вызовите значение свойства асинхронной операции. Пример.

```
armclient get "providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/billingProfiles/YYYY-YYYY-YYY-YYYY-YYY/pricesheetDownloadOperations/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX?sessiontoken=0:11186&api-version=2019-10-01-preview"
```
Предыдущий вызов get возвращает ссылку для скачивания, содержащую прайс лист.

#### <a name="to-get-customer-costs-for-the-last-two-months-sorted-by-month"></a>Для получения затрат на клиента за последние два месяца, отсортированные по месяцам

```
armclient post providers/microsoft.billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31//providers/microsoft.costmanagement/query?api-version=2019-10-01 @CCMQueryCustomer.json
```

#### <a name="to-get-azure-subscription-costs-for-the-last-two-months-sorted-by-month"></a>Получение затрат на подписку Azure за последние два месяца, отсортированные по месяцам

```
armclient post providers/microsoft.billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31//providers/microsoft.costmanagement/query?api-version=2019-10-01 @CCMQuerySubscription.json
```

#### <a name="to-get-daily-costs-for-the-current-month"></a>Для получения ежедневных затрат за текущий месяц

```
armclient post providers/microsoft.billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31//providers/microsoft.costmanagement/query?api-version=2019-10-01 @CCMQueryDaily.json
```

#### <a name="create-a-budget-for-a-partner"></a>Создание бюджета для партнера

```
armclient put providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/providers/Microsoft.CostManagement/budgets/partnerworkshopbudget?api-version=2019-10-01 @budgetCreate.json
```


#### <a name="create-a-budget-for-a-customer"></a>Создание бюджета для клиента

```
armclient put providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/customers/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/providers/Microsoft.Consumption/budgets/test-partner-demo?api-version=2019-10-01 @budgetCreate.json
```
#### <a name="delete-a-budget"></a>Удаление бюджета

```
armclient delete providers/Microsoft.Billing/billingAccounts/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX:XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXXX_2019-05-31/providers/Microsoft.CostManagement/budgets/partnerworkshopbudget?api-version=2019-10-01
```


## <a name="next-steps"></a>Дальнейшие действия
- [Начать анализ затрат](quick-acm-cost-analysis.md) в управлении затратами
- [Создание бюджетов и управление ими](tutorial-acm-create-budgets.md) в управлении затратами
