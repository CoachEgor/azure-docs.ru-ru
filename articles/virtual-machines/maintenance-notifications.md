---
title: Уведомления об обслуживании
description: Обзор уведомлений об обслуживании виртуальных машин, работающих в Azure.
author: shants123
ms.service: virtual-machines
ms.workload: infrastructure-services
ms.topic: article
ms.date: 11/19/2019
ms.author: shants
ms.openlocfilehash: 68159577cb31145be5063bb19af6db71ca1727bd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77115679"
---
# <a name="handling-planned-maintenance-notifications"></a>Обработка запланированных уведомлений о техническом обслуживании

Azure периодически выполняет обновления, чтобы повысить надежность, производительность и безопасность инфраструктуры узлов, в которой работают виртуальные машины. Обновления — это изменения, такие как исправление среды размещения или модернизация оборудования и вывод его из эксплуатации. Большинство из этих обновлений завершены без какого-либо воздействия на размещенные виртуальные машины. Но в некоторых случаях они все же оказывают определенное воздействие:

- Если обслуживание не требует перезагрузки, Azure с помощью миграции на месте приостанавливает работу виртуальной машины во время обновления узла. Операции по техническому обслуживанию этих типов применяются в домене неисправности по домену неисправности. Этот процесс останавливается, если возникают любые предупреждения о состоянии работоспособности.

- Если для обслуживания требуется перезагрузка, вы получите уведомление во время планирования обслуживания. Вам дается временное окно около 35 дней, где вы можете начать обслуживание самостоятельно, когда он работает для вас.


Плановое обслуживание, требующее перезагрузки, разделяется на несколько этапов. Каждая волна имеет разную область (регионы).

- Волна начинается с уведомления клиентов. По умолчанию уведомление отправляется администратору службы и соадминистраторам. Вы можете добавить больше получателей и вариантов обмена сообщениями, таких как электронная почта, SMS и webhooks, используя [оповещения журнала активности.](../service-health/alerts-activity-log-service-notifications.md)  
- После того, как уведомление выходит, *окно самообслуживания* становится доступным. Во время этого окна вы можете заразиться, какие из ваших виртуальных машин затронуты, и начать техническое обслуживание на основе ваших собственных потребностей в планировании. Окно самообслуживания обычно составляет около 35 дней.
- После периода самообслуживания, начинается *период запланированного обслуживания*. В некоторый момент этого периода Azure назначает и применяет для вашей виртуальной машины необходимые операции обслуживания. 

Два периода нужны, чтобы у вас было достаточно времени для запуска обслуживания и перезагрузки виртуальной машины до того, как Azure начнет обслуживание автоматически.


Для запроса окон обслуживания для виртуальных машин и запуска самообслуживания можно использовать портал Azure, PowerShell, REST API и CLI.

 
## <a name="should-you-start-maintenance-using-during-the-self-service-window"></a>Нужно ли начинать обслуживание в период самообслуживания?  

Следующие рекомендации помогут решить, есть ли смысл использовать эту возможность для обслуживания по собственному графику. 

> [!NOTE] 
> Самостоятельное обслуживание может оказаться недоступным для некоторых виртуальных машин. Чтобы определить, доступно ли упреждающее обслуживание для ваших виртуальных машин, проверьте наличие ссылки **Начать сейчас** в информации о состоянии обслуживания. Самообслуживание в настоящее время недоступно для облачных служб (веб-ролей и рабочих ролей) и Service Fabric.


Обслуживание самообслуживания не рекомендуется для развертывания с использованием **наборов доступности.** Наборы доступности уже обновляются только по одному домену обновления одновременно. 

- Позвольте Azure управлять запуском обслуживания. Для обслуживания, которое требует перезагрузки, обслуживание будет сделано обновление домена обновления домена обновления. Домены обновления не обязательно получают обслуживание последовательно, и что существует 30-минутная пауза между доменами обновления. 
- Если проблема заключается в временной потере некоторой емкости (1 домен обновления), можно добавить экземпляры в период обслуживания. 
- Для обслуживания, не требующего перезагрузки, обновления применяются на уровне домена сбоя. 

**Не применяйте** режим самообслуживания в следующих ситуациях. 
- Если вы часто завершаете работу виртуальных машин, вручную, с помощью DevTest Labs, автоматического завершения работы или по расписанию. Перезагрузка может сбросить текущее состояние обслуживания, что приведет к дополнительным простоям.
- Если вы используете виртуальные машины в течение короткого периода, то есть они наверняка будут удалены до завершения периода обслуживания. 
- Если вы используете рабочие нагрузки с большим объемом информации о состоянии, которая хранится на локальном (временном) диске и должна сохраняться после обновления. 
- Если вы часто изменяете размер виртуальной машины, поскольку это действие может привести к сбросу состояния обслуживания. 
- Если вы настроили запланированные события, которые выполняют для рабочей нагрузки упреждающую отработку отказа или корректное завершение работы за 15 минут до завершения работы обслуживания

Обязательно **используйте** самообслуживание, если вы намерены использовать виртуальную машину без перерыва в течение всего периода запланированного обслуживания и ваша система не соответствует ни одному из "блокирующих" условий, которые перечислены выше. 

Режим самообслуживания лучше всего подходит для следующих ситуаций.
- Если вам нужно сообщить руководству или клиенту точное время обслуживания. 
- Если вам важно завершить обслуживание не позднее определенной даты. 
- Если вам важно соблюдать определенную последовательность обслуживания, например, чтобы гарантировать безопасное восстановление для многоуровневого приложения.
- Требуется более 30 минут времени восстановления VM между двумя доменами обновления (UD). Чтобы управлять длительностью пауз между обслуживанием доменов обновления, запускайте обслуживание виртуальных машин только для одного домена обновления.


## <a name="faq"></a>часто задаваемые вопросы


**Вопрос. Зачем вам нужно перезагружать сейчас мою виртуальную машину?**

**Ответ.** Хотя обновления платформы Azure преимущественно не оказывают влияния на доступность виртуальных машин, иногда мы не можем избежать перезагрузки виртуальных машин, размещенных в Azure. Мы хотим внести несколько изменений, и для этого нам нужно перезапустить наши серверы. Это, в свою очередь, приведет к перезагрузке виртуальных машин.

**В: Если я буду следовать вашим рекомендациям по высокой доступности, используя набор доступности, безопасно ли я?**

**Ответ.** Для виртуальных машин, развернутых в группе доступности или масштабируемом наборе виртуальных машин, применяется концепция доменов обновления. Во время обслуживания Azure учитывает ограничения доменов обновления и не выполняет перезагрузку виртуальных машин из разных доменов обновления (в пределах одной и той же группы доступности).  Azure также ожидает минимум 30 минут, прежде чем переходить к следующей группе виртуальных машин. 

Для получения дополнительной информации о высокой доступности [см.](./linux/availability.md)

**Вопрос. Как происходит информирование о плановом обслуживании?**

**Ответ.** Процедура планового обслуживания начинается с настройки расписания для одного или нескольких регионов Azure. Вскоре после этого, уведомление по электронной почте отправляется по подписи админов (одно письмо за подписку). Дополнительные каналы и получатели для этого уведомления можно настроить с помощью оповещений журнала действий. При развертывании виртуальной машины в регионе, в котором плановое обслуживание назначено по расписанию, вы не получите уведомление. Вам нужно будет проверить состояние обслуживания виртуальной машины.

**В: Я не вижу никаких указаний на плановое техническое обслуживание на портале, Powershell или CLI. Что не так?**

**Ответ.** Сведения о плановом обслуживании доступны в ходе этой процедуры только для виртуальных машин, которые включены в плановое обслуживание. Другими словами, если данные не отображаются, это значит, что процедура обслуживания уже завершена (или не начата) или виртуальная машина уже размещена на обновленном сервере.

**Вопрос. Можно ли точно узнать, когда моя виртуальная машина будет затронута?**

**Ответ.** При планировании расписания мы определяем временное окно в несколько дней. Но точная последовательность серверов (и связанных виртуальных машин) в рамках этого окна неизвестна. Если клиенту нужно знать точное время обслуживания виртуальных машин, он может применить [запланированные события](./linux/scheduled-events.md) и запросы из виртуальных машин, чтобы получить уведомление за 15 минут до перезагрузки виртуальной машины.

**Вопрос. Как долго моя виртуальная машина будет перезагружаться?**

**Ответ.** Перезагрузка в течение периода самообслуживания может занять несколько минут в зависимости от размера виртуальной машины. Перезагрузка, инициированная Azure в период запланированного обслуживания, обычно занимает около 25 минут. Если вы используете облачные службы (рабочие роли и веб-роли), масштабируемые наборы виртуальных машин или группы доступности, то вы получите дополнительную паузу 30 минут между обновлением разных групп (доменов обновления) виртуальных машин в период запланированного обслуживания.

**Вопрос. Как происходит обслуживание в случае с масштабируемыми наборами виртуальных машин?**

**A:** Запланированное техническое обслуживание теперь доступно для виртуальных наборов шкалы машин. Для инструкций о том, как инициировать самообслуживание обслуживания, отдавайте [запланированное техническое обслуживание для виртуального набора машинного набора.](../virtual-machine-scale-sets/virtual-machine-scale-sets-maintenance-notifications.md)

**Вопрос. Как обслуживание повлияет на облачные службы (рабочие роли или веб-роли) и Service Fabric?**

**Ответ.** Так как эти платформы будут затронуты плановым обслуживанием, клиенты смогут их безопасно использовать, если в указанный момент времени будут затронуты только виртуальные машины в одном домене обновления. Самообслуживание в настоящее время недоступно для облачных служб (веб-ролей и рабочих ролей) и Service Fabric.

**В: Я не вижу никакой информации о техническом обслуживании на моих ВМ. Что пошло не так?**

**Ответ.** Есть несколько причин, по которым вы можете не видеть информацию об обслуживании в виртуальных машинах:
1.  Вы используете подписку, отмеченную в Майкрософт как внутренняя.
2.  Для виртуальных машин не запланировано обслуживание. Процедура обслуживания завершена, отменена или изменена так, чтобы не влиять на виртуальные машины.
3.  В представлении списка виртуальных машин отсутствует столбец **Обслуживание**. Хотя мы добавили этот столбец в представление по умолчанию, клиенты, которые настроили отображение пользовательских столбцов, должны вручную добавить столбец **Обслуживание** в представление списка виртуальных машин.

**В: Мой VM планируется к обслуживанию во второй раз. Почему?**

**Ответ.** Есть несколько ситуаций, когда для виртуальной машины может быть запланирована еще одна процедура после обслуживания с повторным развертыванием:
1.  Мы отменили процедуру обслуживания и перезапустили ее с другими полезными данными. Мы обнаружили неисправные полезные данные, и нам просто нужно развернуть дополнительные полезные данные.
2.  Виртуальная машина *восстановлена* на другой узел из-за сбоя оборудования.
3.  Вы решили остановить (отменить распределение) и перезапустить виртуальную машину.
4.  Вы настроили **автоматическое завершение работы** для виртуальной машины.



## <a name="next-steps"></a>Дальнейшие действия

Вы можете обрабатывать запланированное техническое обслуживание с помощью [Azure CLI,](maintenance-notifications-cli.md) [Azure PowerShell](maintenance-notifications-powershell.md) или [портала.](maintenance-notifications-portal.md)

