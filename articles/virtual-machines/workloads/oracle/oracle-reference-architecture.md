---
title: Справочные архитектуры для баз данных Oracle в Azure Документы Майкрософт
description: Ссылки на архитектуры для запуска баз данных Oracle Database Enterprise Edition на виртуальных машинах Microsoft Azure.
services: virtual-machines-linux
author: mimckitt
manager: gwallace
tags: ''
ms.service: virtual-machines
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 12/13/2019
ms.author: mimckitt
ms.custom: ''
ms.openlocfilehash: 1dc677ded1e13a64c082d49140fa0de69c0ed9d4
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81263273"
---
# <a name="reference-architectures-for-oracle-database-enterprise-edition-on-azure"></a>Справочные архитектуры для Корпоративного издания Oracle Database на Azure

В этом руководстве подробно описывается информация о развертывании высокодоступной базы данных Oracle в Azure. Кроме того, это руководство погружается в соображения аварийного восстановления. Эти архитектуры были созданы на основе развертывания клиентов. Это руководство распространяется только на Oracle Database Enterprise Edition.

Если вы заинтересованы в получении дополнительной информации о максимизации производительности базы данных Oracle, [см.](oracle-design.md)

## <a name="assumptions"></a>Предположения

- У вас есть понимание различных понятий Azure, таких как [зоны доступности](../../../availability-zones/az-overview.md)
- Вы работаете Oracle Базы данных Enterprise Edition 12c или позже
- Вы знаете и признаете последствия лицензирования при использовании решений в этой статье

## <a name="high-availability-for-oracle-databases"></a>Высокая доступность баз данных Oracle

Достижение высокой доступности в облаке является важной частью планирования и проектирования каждой организации. Microsoft Azure предлагает [зоны доступности](../../../availability-zones/az-overview.md) и наборы доступности (для использования в регионах, где зоны доступности недоступны). Узнайте больше об [управлении доступностью виртуальных машин](../../../virtual-machines/linux/manage-availability.md) для проектирования облака.

В дополнение к облачным инструментам и предложениям Oracle предоставляет решения для высокой доступности, такие как [Oracle Data Guard,](https://docs.oracle.com/en/database/oracle/oracle-database/18/sbydb/introduction-to-oracle-data-guard-concepts.html#GUID-5E73667D-4A56-445E-911F-1E99092DD8D7) [Data Guard с FSFO,](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/index.html) [Sharding](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/admin/sharding-overview.html)и [GoldenGate,](https://www.oracle.com/middleware/technologies/goldengate.html) которые можно настроить на Azure. Это руководство охватывает справочные архитектуры для каждого из этих решений.

Наконец, при миграции или создании приложений для облака важно настроить код приложения, чтобы добавить шаблоны, нативные на облачные технологии, такие как [шаблон повторная попытка](https://docs.microsoft.com/azure/architecture/patterns/retry) и [шаблон выключателя цепи.](https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker) Дополнительные шаблоны, определенные в [руководстве по шаблонам облачных шаблонов,](https://docs.microsoft.com/azure/architecture/patterns/) могут помочь приложению быть более устойчивым.

### <a name="oracle-rac-in-the-cloud"></a>Oracle RAC в облаке

Oracle Real Application Cluster (RAC) — это решение Oracle, помогающее клиентам достичь высокой пропускной воды, имея доступ к одному экземпляру с одним хранилищем данных (общий шаблон архитектуры). В то время как Oracle RAC также может быть использован для высокой доступности на местах, Oracle RAC сама по себе не может быть использована для высокой доступности в облаке, поскольку она защищает только от сбоев уровня экземпляра, а не от сбоев уровня стойки или центра обработки данных. По этой причине Oracle рекомендует использовать Oracle Data Guard с базой данных (будь то один экземпляр или RAC) для высокой доступности. Клиенты обычно требуют высокой SLA для выполнения своих критически важных приложений. Oracle RAC в настоящее время не сертифицирована и не поддерживается Oracle в Azure. Тем не менее, Azure предлагает такие функции, как Azure, предлагает зоны доступности и запланированные окна обслуживания, чтобы защититься от сбоев уровня экземпляра. В дополнение к этому, клиенты могут использовать такие технологии, как Oracle Data Guard, Oracle GoldenGate и Oracle Sharding для высокой производительности и устойчивости, защищая свои базы данных от стойки уровня, а также центр данных уровня и геополитических сбоев.

При запуске баз данных Oracle в [различных зонах доступности](https://docs.microsoft.com/azure/availability-zones/az-overview) совместно с Oracle Data Guard или GoldenGate, клиенты могут получить время простоя SLA 99,99%. В регионах Azure, где зоны доступности пока не присутствуют, клиенты могут использовать [наборы доступности](https://docs.microsoft.com/azure/virtual-machines/linux/manage-availability#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy) и получить sLA времени простоя 99,95%.

>ПРИМЕЧАНИЕ: Вы можете иметь цель простоя, которая намного выше, чем время простоя SLA, предоставляемые microsoft.

## <a name="disaster-recovery-for-oracle-databases"></a>Восстановление после стихийных бедствий для баз данных Oracle

При размещении критически важных приложений в облаке важно проектировать для высокой доступности и аварийного восстановления.

Для Oracle Database Enterprise Edition Oracle Data Guard является полезной функцией для аварийного восстановления. Можно настроить экземпляр резервной базы данных в [спаренном регионе Azure](/azure/best-practices-availability-paired-regions) и настроить сбой Data Guard для аварийного восстановления. При нулевой потере данных рекомендуется развернуть экземпляр Oracle Data Guard Far Sync в дополнение к Active Data Guard. 

Рассмотрите возможность настройки экземпляра Data Guard Far Sync в другой зоне доступности, чем основная база данных Oracle, если приложение разрешает задержку (требуется тщательное тестирование). Используйте режим **максимальной доступности** для настройки синхронного переноса файлов повтора в экземпляр Far Sync. Затем эти файлы асинхронно передаются в базу данных ожидания. 

Если приложение не допускает потери производительности при настройке экземпляра Far Sync в другой зоне доступности в режиме **максимальной доступности** (синхронно), можно настроить экземпляр Far Sync в той же зоне доступности, что и основная база данных. Для дополнительной доступности следует настроить несколько экземпляров Far Sync рядом с основной базой данных и, по крайней мере, один экземпляр рядом с резервной базой данных (если роль переходит). Узнайте больше о Oracle Data Guard Far Sync в этом [документе Oracle Active Data Guard Far Sync.](https://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf)

При использовании баз данных Oracle Standard Edition существуют решения ISV, такие как DBVisit Standby, которые позволяют настроить высокую доступность и аварийное восстановление.

## <a name="reference-architectures"></a>Эталонные архитектуры

### <a name="oracle-data-guard"></a>Oracle Data Guard

Oracle Data Guard обеспечивает высокую доступность, защиту данных и аварийное восстановление корпоративных данных. Data Guard поддерживает резервные базы данных в качестве транзакционно согласованных копий основной базы данных. В зависимости от расстояния между первичными и вторичными базами данных и допуском приложения к задержке можно настроить синхронную или асинхронную репликацию. Затем, если основная база данных недоступна из-за запланированного или незапланированного сбой, Data Guard может переключить любую базу данных ожидания на основную роль, минимизируя время простоя. 

При использовании Oracle Data Guard вы также можете открыть вторичную базу данных только для чтения. Эта конфигурация называется Active Data Guard. Oracle Database 12c представила функцию под названием Data Guard Far Sync Instance. Этот экземпляр позволяет настроить конфигурацию потери данных с нулевым исданным способом базы данных Oracle без ущерба для производительности.

> [!NOTE]
> Active Data Guard требует дополнительного лицензирования. Эта лицензия также необходима для использования функции Far Sync. Пожалуйста, свяжитесь со своим представителем Oracle, чтобы обсудить последствия лицензирования.

#### <a name="oracle-data-guard-with-fsfo"></a>Oracle Data Guard с FSFO
Oracle Data Guard с Fast-Start Failover (FSFO) может обеспечить дополнительную устойчивость, настроив брокера на отдельную машину. Брокер Data Guard и второстепенная база данных управляют наблюдателем и наблюдают за основной базой данных для простоя. Это позволяет также обеспечить избыточность в настройках наблюдателя Data Guard. 

С версией Oracle Database 12.2 и выше можно также настроить несколько наблюдателей с одной конфигурацией брокера Oracle Data Guard. Эта настройка обеспечивает дополнительную доступность, в случае, если один наблюдатель и опыт простоя вторичной базы данных. Data Guard Broker является легким и может быть размещен на относительно небольшой виртуальной машине. Чтобы узнать больше о Data Guard Broker и его преимуществах, посетите [документацию Oracle](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/oracle-data-guard-broker-concepts.html) по этой теме.

Следующая диаграмма является рекомендуемой архитектурой для использования Oracle Data Guard на Azure с зонами доступности. Эта архитектура позволяет получить VM время простоя SLA 99,99%.

![База данных Oracle с использованием зон доступности с брокером Data Guard - FSFO](./media/oracle-reference-architecture/oracledb_dg_fsfo_az.png)

На предыдущей диаграмме клиентская система получает доступ к пользовательскому приложению с бэкэндом Oracle через Интернет. Веб-фронт передняя часть настроена в балансере нагрузки. Веб-фронтенд делает звонок на соответствующий сервер приложения для обработки работы. Сервер приложения запрашивает основную базу данных Oracle. База данных Oracle была настроена с помощью гиперпоточной [виртуальной машины, оптимизированной для оптимизации памяти](../../../virtual-machines/windows/sizes-memory.md) с [ограниченными основными vCPUs,](../../../virtual-machines/windows/constrained-vcpu.md) чтобы сэкономить на затратах на лицензирование и максимизировать производительность. Для производительности и высокой доступности используются несколько премиальных или ультрадисков (управляемых дисков).

Базы данных Oracle размещаются в зонах повышенной доступности для высокой доступности. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимой мощностью, охлаждением и сетью. Для обеспечения устойчивости во всех включенных регионах создано как минимум три отдельные зоны. Физическое разделение зон доступности в регионе защищает данные от сбоев в цОД. Кроме того, два наблюдателя FSFO настроены в двух зонах доступности для инициирования и сбоя над базой данных в вторую, когда происходит сбой. 

Вы можете настроить дополнительные базы данных наблюдателей и/или резервных баз данных в другой зоне доступности (в данном случае зоне, указанной в предыдущей архитектуре. Наконец, базы данных Oracle контролируются на время простоя и производительности менеджером Oracle Enterprise Manager (OEM). OEM также позволяет создавать различные отчеты о производительности и использовании.

В регионах, где зоны доступности не поддерживаются, можно использовать наборы доступности для развертывания базы данных Oracle в весьма доступной форме. Наборы доступности позволяют достичь времени простоя VM 99,95%. Следующая диаграмма является эталонной архитектурой этого использования:

![База данных Oracle с использованием наборов доступности с брокером Data Guard - FSFO](./media/oracle-reference-architecture/oracledb_dg_fsfo_as.png)

> [!NOTE]
> * VM-менеджер предприятия Oracle не должен быть помещен в набор доступности, так как есть только один экземпляр развертывания OEM.
> * Ультра диски в настоящее время не поддерживаются в конфигурации набора доступности.

#### <a name="oracle-data-guard-far-sync"></a>Oracle Data Guard Far Sync

Oracle Data Guard Far Sync предоставляет нулевые возможности защиты данных для баз данных Oracle. Эта возможность позволяет защититься от потери данных при сбое в службе базы данных. Oracle Data Guard Far Sync должна быть установлена на отдельном VM. Far Sync — это легкий экземпляр Oracle, в который есть только файл управления, файл паролей, спфайл и резервные журналы. Нет файлов данных или файлов журнала rego. 

Для защиты от потери данных должна быть синхронная связь между основной базой данных и экземпляром Far Sync. Экземпляр Far Sync получает повтор из основного синхронно и немедленно направляет его во все резервные базы данных асинхронным образом. Эта настройка также уменьшает накладные расходы на основной базе данных, поскольку она должна отправлять повтор только в экземпляр Far Sync, а не во все резервные базы данных. Если экземпляр Far Sync выходит из строя, Data Guard автоматически использует асинхронный перенос во вторичную базу данных из основной базы данных для поддержания почти нулевой защиты потерь данных. Для дополнительной устойчивости клиенты могут развертывать несколько экземпляров Far Sync на каждый экземпляр базы данных (первичные и второстепенные).

Следующая диаграмма представляет собой архитектуру высокой доступности с использованием Oracle Data Guard Far Sync:

![База данных Oracle с использованием зон доступности с Data Guard Far Sync &Broker - FSFO](./media/oracle-reference-architecture/oracledb_dg_fs_az.png)

В предыдущей архитектуре экземпляр Far Sync развернут в той же зоне доступности, что и экземпляр базы данных, чтобы уменьшить задержку между ними. В тех случаях, когда приложение является чувствительным к задержке, рассмотрите возможность развертывания базы данных и экземпляров Far Sync или экземпляров в [группе размещения.](../../../virtual-machines/linux/proximity-placement-groups.md)

Следующая диаграмма представляет собой архитектуру, используя Oracle Data Guard FSFO и Far Sync для достижения высокой доступности и аварийного восстановления:

![Oracle Database, использующего зоны доступности для аварийного восстановления с помощью Data Guard Far Sync & Broker - FSFO](./media/oracle-reference-architecture/oracledb_dg_fs_az_dr.png)

### <a name="oracle-goldengate"></a>Oracle GoldenGate

GoldenGate позволяет обмениваться и манипулировать данными на уровне транзакций между несколькими, неоднородными платформами по всему предприятию. Он перемещает транзакции с целостностью транзакций и минимальными накладными расходами на существующую инфраструктуру. Его модульная архитектура позволяет гибко извлекать и воспроизводить выбранные записи данных, транзакционные изменения и изменения в DDL (язык определения данных) в различных топологиях.

Oracle GoldenGate позволяет настроить базу данных для высокой доступности, предоставляя двунаправленную репликацию. Это позволяет настроить **мультимастерскую** или **активную конфигурацию.** Следующая диаграмма является рекомендуемой архитектурой для активной установки Oracle GoldenGate на Azure. В следующей архитектуре база данных Oracle была настроена с помощью гиперпоточной [виртуальной машины, оптимизированной с](../../../virtual-machines/windows/sizes-memory.md) [ограниченными процессорами ядра,](../../../virtual-machines/windows/constrained-vcpu.md) чтобы сэкономить на затратах на лицензирование и максимизировать производительность. Для производительности и доступности используются несколько премиальных или ультрадисков (управляемых дисков).

![База данных Oracle с использованием зон доступности с брокером Data Guard - FSFO](./media/oracle-reference-architecture/oracledb_gg_az.png)

> [!NOTE]
> Аналогичная архитектура может быть настроена с использованием наборов доступности в регионах, где зоны доступности в настоящее время недоступны.

Oracle GoldenGate имеет такие процессы, как extract, Pump и Replicat, которые помогут вам асинхронно реплицировать данные с одного сервера базы данных Oracle на другой. Эти процессы позволяют настроить двунаправленную репликацию для обеспечения высокой доступности базы данных при наличии времени простоя на уровне зоны доступности. На предыдущей диаграмме процесс extract работает на том же сервере, что и база данных Oracle, в то время как процессы Data Pump и Replicat работают на отдельном сервере в той же зоне доступности. Процесс Репликта используется для получения данных из базы данных в другой зоне доступности и передачи данных в базу данных Oracle в зоне ее доступности. Аналогичным образом, процесс data Pump отправляет данные, извлеченные в процессе extract, в процесс Репликта в другой зоне доступности. 

В то время как предыдущая диаграмма архитектуры показывает процесс Data Pump и Replicat, настроенный на отдельном сервере, можно настроить все процессы Oracle GoldenGate на одном сервере, основываясь на емкости и использовании сервера. Всегда проконсультируйтесь с отчетом AWR и метриками в Azure, чтобы понять шаблон использования сервера.

При настройке двунаправленной репликации Oracle GoldenGate в различных зонах доступности или в разных регионах важно обеспечить приемлемость задержки между различными компонентами для приложения. Задержка между зонами доступности и регионами может варьироваться и зависеть от нескольких факторов. Рекомендуется настроить тесты производительности между уровнем приложения и уровнем базы данных в разных зонах доступности и/или регионах, чтобы подтвердить, что они отвечают требованиям производительности приложения.

Уровень приложения можно настроить в собственной подсети, а уровень базы данных можно разделить на собственную подсеть. Когда это возможно, рассмотрите возможность использования [Azure Application Gateway](../../../application-gateway/overview.md) для загрузоки-баланса между серверами приложений. Azure Application Gateway — это надежный балансер нагрузки на веб-трафик. Он обеспечивает сродство сеанса на основе файлов cookie, которое сохраняет сеанс пользователя на одном сервере, тем самым минимизируя конфликты в базе данных. Альтернативой шлюзу приложений являются [Azure Load Balancer](../../../load-balancer/load-balancer-overview.md) и [Azure Traffic Manager.](../../../traffic-manager/traffic-manager-overview.md)

### <a name="oracle-sharding"></a>Оракул Осколдинг

Sharding — это шаблон уровня данных, который был введен в Oracle 12.2. Это позволяет горизонтально разгородить и масштабировать данные по независимым базам данных. Это архитектура общего доступа, в которой каждая база данных размещается на специализированной виртуальной машине, что позволяет высоко считывать и писать пропускную связь в дополнение к устойчивости и повышенной доступности. Этот шаблон устраняет отдельные точки сбоя, обеспечивает изоляцию неисправностей и позволяет обновлять систему без простоев. Время простоя одного осколка или сбой уровня центра обработки данных не влияет на производительность или доступность других осколков в других центрах обработки данных. 

Sharding подходит для высокопроизводительных приложений OLTP, которые не могут позволить себе время простоя. Все строки с одинаковым осколком ключа всегда гарантированно находятся на одном осколок, тем самым повышая производительность, обеспечивая высокую консистенцию. Приложения, использующие осколки, должны иметь четко определенную модель данных и стратегию распределения данных (последовательный хэш, диапазон, список или композитный), который в первую очередь получает доступ к данным с помощью ключа sharding (например, *customerId* или *accountNum).* Sharding также позволяет хранить определенные наборы данных ближе к конечным клиентам, тем самым помогая вам соответствовать вашим требованиям к производительности и соответствию.

Рекомендуется реплицировать осколки для высокой доступности и аварийного восстановления. Эта настройка может быть выполнена с помощью технологий Oracle Data Guard или Oracle GoldenGate. Единица репликации может быть осколок, часть осколка, или группа осколков. На наличие осколки базы данных не влияет сбой или замедление одного или нескольких осколков. Для высокой доступности резервные осколки могут быть помещены в ту же зону доступности, где помещаются первичные осколки. Для аварийного восстановления резервные осколки могут быть расположены в другом регионе. Вы также можете развернуть осколки в нескольких регионах для обслуживания трафика в этих регионах. Подробнее о настройке высокой доступности и репликации осколки базы данных можно узнать в [документации Oracle Sharding.](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-high-availability.html)

Oracle Sharding в основном состоит из следующих компонентов. Более подробную информацию об этих компонентах можно найти в [документации Oracle Sharding:](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html)

- **Каталог осколков** - специальная база данных Oracle, которая является постоянным хранилищем для всех данных конфигурации базы данных Shard. Все изменения конфигурации, такие как добавление или удаление осколков, картирование данных и DDL в базе данных осколков, инициируются в каталоге осколков. Каталог осколков также содержит мастер-копию всех дублированных таблиц в SDB. 

  Каталог осколков использует материализованные представления для автоматического воспроизведения изменений в дублированные таблицы во всех осколках. База данных каталога осколков также выступает в качестве координатора запросов, используемого для обработки многоостыжных запросов и запросов, в которых не указывается осколочно-солистивая клавиша. 
  
  Использование Oracle Data Guard в сочетании с зонами доступности или наборами доступности для высокой доступности каталога осколков является рекомендуемой наилучшей практикой. Наличие каталога осколков не влияет на доступность осколки базы данных. Простои в каталоге осколков влияют только на операции по техническому обслуживанию и многоуровневые запросы в течение короткого периода, который завершает failover Data Guard. Онлайн-транзакции продолжают маршрутизироваться и выполняться SDB и не подвержены отключению каталога.

- **Осколки директоров** - Легкие службы, которые должны быть развернуты в каждом регионе / зоне доступности, что ваши осколки проживают дюйма Осколки директоров являются глобальными менеджерами по обслуживанию, развернутыми в контексте Oracle Sharding. При высокой доступности рекомендуется развернуть по крайней мере по одному директору осколков в каждой зоне доступности, в какой существуют осколки. 

  При подключении к базе данных информация о реаутинге настраивается директором осколка и кэшируется для последующих запросов, минуя осколок директора. После того, как сеанс установлен с помощью осколок, все запросы и DML-запросы s'L поддерживаются и выполняются в рамках данного осколока. Эта трассировка быстра и используется для всех рабочих нагрузок OLTP, выполняющих внутриосколые транзакции. Рекомендуется использовать прямую рассылаемость для всех рабочих нагрузок OLTP, которые требуют самой высокой производительности и доступности. Кэш маршрутизатора автоматически обновляется, когда осколок становится недоступным или происходят изменения в топологии осколков. 
  
  Для высокопроизводительной, зависящей от данных реутрии Oracle рекомендует использовать пул подключений при доступе к данным в осколке базы данных. Пулы подключений Oracle, языковые библиотеки и драйверы поддерживают Oracle Sharding. Для получения более подробной информации обратитесь к [документации Oracle Sharding.](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html#GUID-3D41F762-BE04-486D-8018-C7A210D809F9)

- **Глобальный сервис** - Глобальный сервис аналогичен обычному сервису баз данных. В дополнение ко всем свойствам службы базы данных, глобальная служба имеет свойства для осколковых баз данных, таких как сродство региона между клиентами и допуском задержки осколков и репликации. Для чтения/записи данных в/из осколковой базы данных необходимо создать только одну глобальную службу. При использовании Active Data Guard и настройке только для чтения реплик иссоциы осколков можно создать еще один сервис gGobal для рабочих нагрузок только для чтения. Клиент может использовать эти глобальные службы для подключения к базе данных.

- **Базы данных осколков** - базы данных осколков являются базами данных Oracle. Каждая база данных реплицируется с помощью Oracle Data Guard в конфигурации Broker с включенным Fast-Start Failover (FSFO). Вам не нужно настраивать failover и репликацию Data Guard на каждом осколок. Это автоматически настраивается и развертывается при создании общей базы данных. При сходе конкретного осколка Oracle Sharing автоматически выходит из-за подключения к базе данных от основного к резервному режиму.

Вы можете развертывать и управлять базами данных Oracle с двумя интерфейсами: `GDSCTL` графическим интерфейсом Oracle Enterprise Manager Cloud Control и/или утилитой командной строки. Вы даже можете контролировать различные осколки для доступности и производительности с помощью управления облака. Команда `GDSCTL DEPLOY` автоматически создает осколки и их соответствующих слушателей. Кроме того, эта команда автоматически развертывает конфигурацию репликации, используемую для высокой доступности на уровне осколка, указанной администратором.

Существуют различные способы осколки базы данных:

* Системное осколочное - Автоматически распределяет по осколкам с помощью раздела
* Осколки с определенным ими - Позволяет указать отображение данных на осколки, что хорошо работает при наличии нормативных требований или требований к локализации данных)
* Композитный осколки - Сочетание системно-управляемого и определяемого пользователем осколков для _различных осколков_
* Подразделы таблицы - Похожи на обычную раздельную таблицу.

Узнайте больше о различных [методах осколки](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-methods.html) в документации Oracle.

В то время как осколки база данных может выглядеть как единая база данных для приложений и разработчиков, при переходе из неоспаряемой базы данных в осколки базу данных требуется тщательное планирование, чтобы определить, какие таблицы будут дублироваться по сравнению со осколками. 

Двойные таблицы хранятся на всех осколках, в то время как осколки таблицы распределены между различными осколками. Рекомендация состоит в том, чтобы дублировать небольшие и размерные таблицы и распространять/заседать таблицы фактов. Данные могут быть загружены в вашу осколковую базу данных, используя либо каталог осколков в качестве центрального координатора, либо при запуске data Pump на каждом осколок. Подробнее о [переносе данных в осколковую базу данных](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-loading-data.html) читайте в документации Oracle.

#### <a name="oracle-sharding-with-data-guard"></a>Oracle Sharding с data Guard

Oracle Data Guard можно использовать для осколков с помощью системных, определяемых пользователей и композитных методов осколков.

Следующая диаграмма является эталонной архитектурой для Oracle Sharding с Oracle Data Guard, используемой для высокой доступности каждого осколка. Диаграмма архитектуры показывает _метод композитного осколки._ Диаграмма архитектуры, скорее всего, будет отличаться для приложений с различными требованиями к локализации данных, балансировке нагрузки, высокой доступности, аварийному восстановлению и т.д. и может использовать другой метод для осколков. Oracle Sharding позволяет удовлетворить эти требования и масштабировать сяренно и эффективно, предоставляя эти опции. Аналогичная архитектура может быть даже развернута с помощью Oracle GoldenGate.

![Oracle Базы данных Sharding с использованием зон доступности с Data Guard Broker - FSFO](./media/oracle-reference-architecture/oracledb_dg_sh_az.png)

В то время как системно-управляемый осколки легче всего настраивать и управлять, пользовательский осколок или составной осколки хорошо подходит для сценариев, где ваши данные и приложение геораспределены или в сценариях, где вам нужно иметь контроль над репликацией каждого осколок. 

В предыдущей архитектуре композитный засрание используется для геораспределения данных и горизонтального масштабирования уровней приложения. Композитный осколок представляет собой сочетание системного управления и определяемого пользователем осколков и, таким образом, обеспечивает преимущество обоих методов. В предыдущем сценарии данные сначала осколкируются через несколько осколков, разделенных по регионам. Затем данные далее разделены последовательным хэшом по нескольким осколки в оксоте. Каждое осколочное пространство содержит несколько групп осколков. Каждая группа имеет несколько осколков и является "единицей" репликации, в данном случае. Каждая группа содержит все данные в оксотливе. Осколки A1 и B1 являются основными осколками, в то время как осколки A2 и B2 являются резервными. Вы можете выбрать, чтобы отдельные осколки быть единицей репликации, а не осколки.

В предыдущей архитектуре в каждой зоне доступности для высокой доступности размещается директор GSM/shard. Рекомендация заключается в развертывании по крайней мере одного GSM/shard директора на центр обработки данных/регион. Кроме того, экземпляр сервера приложения развертывается в каждой зоне доступности, содержащей группу. Эта настройка позволяет приложению удерживать задержку между сервером приложения и базой данных/группой с низким уровнем. Если база данных выходит из строя, сервер приложения в той же зоне, что и в резервной базе данных, может обрабатывать запросы после перехода роли базы данных. Azure Application Gateway и директор по осколку отслеживают запрос и задержку запросов и запросов на маршрут соответственно.

С точки зрения приложения, клиентская система делает запрос на Azure Application Gateway (или другие технологии балансировки нагрузки в Azure), который перенаправляет запрос в регион, наиболее близкий к клиенту. Azure Application Gateway также поддерживает липкие сеансы, поэтому любые запросы, поступающие от одного и того же клиента, направляются на один и тот же сервер приложения. Сервер приложения использует объединение соединений в драйверах доступа к данным. Эта функция доступна в драйверах, таких как JDBC, ODP.NET, OCI и т.д. Драйверы могут распознавать клавиши, указанные в запросе. [Oracle Universal Connection Pool (UCP)](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jjucp/ucp-database-sharding-overview.html) для клиентов JDBC может позволить клиентам приложений, не относясь к Oracle, таким как Apache Tomcat и IIS, работать с Oracle Sharding. 

Во время первоначального запроса сервер приложения подключается к директору осколок в регионе, чтобы получить информацию о маршрутизании для осколок, на который необходимо направить запрос. Основываясь на пройденеключаемом ключе, директор направляет сервер приложения в соответствующий осколок. Сервер приложения кэширует эту информацию, создавая карту, а для последующих запросов обходит директора осколка и направляет запросы прямо к осколоку.

#### <a name="oracle-sharding-with-goldengate"></a>Оракул обилие с GoldenGate

Следующая диаграмма является эталонной архитектурой для Oracle Sharding с Oracle GoldenGate для высокой доступности каждого осколок в регионе. В отличие от предыдущей архитектуры, эта архитектура изображает только высокую доступность в пределах одного региона Azure (зоны многократной доступности). Можно было бы развернуть многорегионанную базу данных высокой доступности (по аналогии с предыдущим примером) с помощью Oracle GoldenGate.

![Oracle База данных Sharding с использованием зон доступности с GoldenGate](./media/oracle-reference-architecture/oracledb_gg_sh_az.png)

Предыдущая эталонная архитектура использует _управляемый системой_ метод осколков для опрокидки данных. Поскольку репликация Oracle GoldenGate выполняется на уровне куска, половина данных, реплицируемых на один осколок, может быть воспроизведена на другой осколок. Другая половина может быть воспроизведена на другой осколок. 

Способ реплицирования данных зависит от фактора репликации. С коэффициентом репликации 2, вы будете иметь две копии каждого куска данных через три осколки в группе. Аналогичным образом, с коэффициентом репликации 3 и 3 осколков в вашей группе, все данные в каждом осколок будут реплицироваться на любой другой осколок в осколке. Каждый осколок в группе может иметь другой фактор репликации. Эта настройка поможет вам определить вашу высокую доступность и конструкцию аварийного восстановления эффективно в пределах группы осколков и в нескольких группах.

В предыдущей архитектуре группа A и группа B содержат одни и те же данные, но находятся в разных зонах доступности. Если оба фрагмента A и фрагмента b имеют один и тот же коэффициент репликации 3, каждая строка/кусок вашей осколки таблицы будет реплицироваться 6 раз через две группы фрагментов. Если фрагментная группа А имеет коэффициент репликации 3, а фрагментная группа B имеет коэффициент репликации 2, каждая строка/кусок будет реплицироваться 5 раз через две группы фрагментов.

Эта настройка предотвращает потерю данных, если происходит сбой уровня экземпляра или уровня доступности. Слой приложения способен читать и писать на каждый осколок. Чтобы свести к минимуму конфликты, Oracle Sharding обозначает «мастер-кусок» для каждого диапазона значений хэша. Эта функция гарантирует, что записи запросов на определенный кусок направляются на соответствующий кусок. Кроме того, Oracle GoldenGate обеспечивает автоматическое обнаружение и разрешение конфликтов для обработки любых конфликтов, которые могут возникнуть. Для получения дополнительной информации и ограничений реализации GoldenGate с Oracle [Oracle GoldenGate with a sharded database](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-high-availability.html#GUID-4FC0AC46-0B8B-4670-BBE4-052228492C72)Sharding, см.

В предыдущей архитектуре в каждой зоне доступности для высокой доступности размещается директор GSM/shard. Рекомендация заключается в развертывании по крайней мере одного GSM/shard директора в центре обработки данных или регионе. Кроме того, экземпляр сервера приложения развертывается в каждой зоне доступности, содержащей группу. Эта настройка позволяет приложению удерживать задержку между сервером приложения и базой данных/группой с низким уровнем. Если база данных выходит из строя, сервер приложения в той же зоне, что и в резервной базе данных, может обрабатывать запросы после перехода роли базы данных. Azure Application Gateway и директор по осколку отслеживают запрос и задержку запросов и запросов на маршрут соответственно.

С точки зрения приложения, клиентская система делает запрос на Azure Application Gateway (или другие технологии балансировки нагрузки в Azure), который перенаправляет запрос в регион, наиболее близкий к клиенту. Azure Application Gateway также поддерживает липкие сеансы, поэтому любые запросы, поступающие от одного и того же клиента, направляются на один и тот же сервер приложения. Сервер приложения использует объединение соединений в драйверах доступа к данным. Эта функция доступна в драйверах, таких как JDBC, ODP.NET, OCI и т.д. Драйверы могут распознавать клавиши, указанные в запросе. [Oracle Universal Connection Pool (UCP)](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/jjucp/ucp-database-sharding-overview.html) для клиентов JDBC может позволить клиентам приложений, не относясь к Oracle, таким как Apache Tomcat и IIS, работать с Oracle Sharding. 

Во время первоначального запроса сервер приложения подключается к директору осколок в регионе, чтобы получить информацию о маршрутизании для осколок, на который необходимо направить запрос. Основываясь на пройденеключаемом ключе, директор направляет сервер приложения в соответствующий осколок. Сервер приложения кэширует эту информацию, создавая карту, а для последующих запросов обходит директора осколка и направляет запросы прямо к осколоку.

## <a name="patching-and-maintenance"></a>Патчирование и техническое обслуживание

При развертывании рабочих нагрузок Oracle в Azure корпорация Майкрософт заботится обо всех исправлениях на уровне ОС. Любое запланированное техническое обслуживание на уровне ОС довелось сообщить клиентам заранее, чтобы клиент удался для этого запланированного обслуживания. Два сервера из двух разных зон доступности никогда не исправляются одновременно. Подробнее об обслуживании и исправлении VM можно узнать о [доступности виртуальных машин.](../../../virtual-machines/linux/manage-availability.md) 

Патчинг вашей виртуальной операционной системы машины может быть автоматизирован с помощью [Azure Automation.](../../../automation/automation-tutorial-update-management.md) Патчирование и обслуживание базы данных Oracle можно автоматизировать и запланировать с помощью [Azure Pipelines](/azure/devops/pipelines/get-started/what-is-azure-pipelines?view=azure-devops) или [Azure Automation](../../../automation/automation-tutorial-update-management.md) для минимизации простоев. Смотрите [непрерывную доставку и синий / зеленый развертывания,](/azure/devops/learn/what-is-continuous-delivery) чтобы понять, как он может быть использован в контексте баз данных Oracle.

## <a name="architecture-and-design-considerations"></a>Архитектура и дизайн соображения

- Рассмотрите возможность использования виртуальной [виртуальной машины](../../../virtual-machines/windows/sizes-memory.md) с ограниченной точностью до 2000-х лет с [ограниченными процессорами ядра](../../../virtual-machines/windows/constrained-vcpu.md) для вашего VM Oracle Database, чтобы сэкономить на затратах на лицензирование и максимизировать производительность. Используйте несколько премиальных или ультра дисков (управляемых дисков) для производительности и доступности.
- При использовании управляемых дисков имя диска/устройства может измениться при перезагрузках. Рекомендуется использовать устройство UUID вместо имени, чтобы обеспечить сохранение крепления в перезагрузке. Дополнительные сведения см. [здесь](../../../virtual-machines/linux/configure-raid.md#add-the-new-file-system-to-etcfstab).
- Используйте зоны доступности для достижения высокой доступности в регионе.
- Рассмотрите возможность использования ультрадисков (при наличии) или премиум-дисков для базы данных Oracle.
- С помощью Oracle Data Guard можно создать в режиме ожидания базу данных Oracle в другом регионе Azure.
- Рассмотрите возможность использования [групп размещения непосредственнок](../../../virtual-machines/linux/co-location.md#proximity-placement-groups) для уменьшения задержки между приложением и уровнем базы данных.
- Навладив менеджер по управлению, мониторингу и ведению журнала [Oracle.](https://docs.oracle.com/en/enterprise-manager/)
- Рассмотрите возможность использования Oracle Automatic Storage Management (ASM) для оптимизации управления хранением данных для вашей базы данных.
- Используйте [конвейеры Azure](/azure/devops/pipelines/get-started/what-is-azure-pipelines) для управления исправлением и обновлениями базы данных без простоев.
- Настройка кода приложения для добавления шаблонов, напрягающихся в облаке, таких как [шаблон повторная попытка,](/azure/architecture/patterns/retry) [шаблон выключателя схем](/azure/architecture/patterns/circuit-breaker)и другие шаблоны, определенные в [руководстве Cloud Design Patterns,](/azure/architecture/patterns/) которые могут помочь приложению быть более устойчивыми.

## <a name="next-steps"></a>Дальнейшие действия

Просмотрите следующие справочные статьи Oracle, применимые к вашему сценарию.

- [Введение в Oracle Data Guard](https://docs.oracle.com/en/database/oracle/oracle-database/18/sbydb/introduction-to-oracle-data-guard-concepts.html#GUID-5E73667D-4A56-445E-911F-1E99092DD8D7)
- [Концепции Oracle Data Guard Broker](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/dgbkr/oracle-data-guard-broker-concepts.html)
- [Настройка Oracle GoldenGate для активной и активной высокой доступности](https://docs.oracle.com/goldengate/1212/gg-winux/GWUAD/wu_bidirectional.htm#GWUAD282)
- [Обзор Оракела Sharding](https://docs.oracle.com/en/database/oracle/oracle-database/19/shard/sharding-overview.html)
- [Oracle Active Data Guard Far Sync нулевой потери данных на любом расстоянии](https://www.oracle.com/technetwork/database/availability/farsync-2267608.pdf)
