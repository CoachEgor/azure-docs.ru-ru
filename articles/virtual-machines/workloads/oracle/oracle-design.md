---
title: Разработка базы данных Oracle и ее реализация в Azure | Документация Майкрософт
description: Разработка базы данных Oracle и ее реализация в среду Azure.
author: dbakevlar
ms.service: virtual-machines-linux
ms.topic: article
ms.date: 08/02/2018
ms.author: kegorman
ms.reviewer: cynthn
ms.openlocfilehash: 9bfd2330f71b9690e2864968cf51cb438bb23676
ms.sourcegitcommit: d767156543e16e816fc8a0c3777f033d649ffd3c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/26/2020
ms.locfileid: "92534079"
---
# <a name="design-and-implement-an-oracle-database-in-azure"></a>Разработка базы данных Oracle и ее реализация в Azure

## <a name="assumptions"></a>Предположения

- Вы планируете перенести базу данных Oracle из локальной среды в Azure.
- У вас есть [диагностический пакет](https://docs.oracle.com/cd/E11857_01/license.111/e11987/database_management.htm) для Oracle Database, который требуется перенести.
- У вас есть представление о разных метриках, используемых в отчетах Oracle AWR.
- У вас есть базовое представление о производительности приложения и использовании платформы.

## <a name="goals"></a>Цели

- Получить сведения о том, как оптимизировать развертывание Oracle в Azure.
- Изучить параметры настройки производительности для базы данных Oracle в среде Azure.

## <a name="the-differences-between-an-on-premises-and-azure-implementation"></a>Различия между реализацией в локальной среде и среде Azure 

Ниже перечислены важные факторы, которые следует учитывать при миграции локальных приложений в Azure. 

Важным отличием является то, что при реализации в Azure ресурсы (например, виртуальные машины, диски и виртуальные сети) можно совместно использовать с другими клиентами. Кроме того, ресурс можно регулировать в соответствии с требованиями. В Azure все нацелено не столько на предотвращение сбоев (MTBF), сколько на восстановление после них (MTTR).

В таблице ниже перечислены некоторые различия между реализацией базы данных Oracle в локальной среде и среде Azure.


|  | Локальная реализация | Реализация в Azure |
| --- | --- | --- |
| **Сеть** |Локальная или глобальная сеть  |SDN (программно-конфигурируемая сеть)|
| **Группа безопасности** |Средства ограничения портов и IP-адресов |[Группа безопасности сети (NSG)](https://azure.microsoft.com/blog/network-security-groups) |
| **Устойчивость** |MTBF (среднее время безотказной работы) |MTTR (среднее время восстановления)|
| **Плановое техническое обслуживание** |Установка исправлений и обновлений|[Группы доступности](/previous-versions/azure/virtual-machines/windows/infrastructure-example) (установка исправлений и обновлений, управляемая Azure) |
| **Ресурс** |Выделенные  |Совместное использование с другими клиентами|
| **Регионы** |Центры обработки данных |[Пары регионов](../../regions.md#region-pairs)|
| **Хранилище** |Сеть SAN и физические диски |[Хранилище под управлением Azure](https://azure.microsoft.com/pricing/details/managed-disks/?v=17.23h)|
| **Масштабирование** |Вертикальное масштабирование |Горизонтальное масштабирование|


### <a name="requirements"></a>Требования

- Определите скорость увеличения и размер базы данных.
- Определите требования к числу операций ввода-вывода, которое можно рассчитать на основе отчета Oracle AWR или других средств мониторинга сети.

## <a name="configuration-options"></a>Варианты настройки

В среде Azure есть четыре области, которые можно настроить для повышения производительности:

- размер виртуальной машины;
- Пропускная способность сети
- Типы дисков и их конфигурации
- Настройки кэша дисков.

### <a name="generate-an-awr-report"></a>Создание отчета AWR

Если у вас уже есть база данных Oracle и вы планируете перенести ее в Azure, это можно сделать несколькими способами. Если у вас есть [Пакет диагностики](https://www.oracle.com/technetwork/oem/pdf/511880.pdf) для экземпляров Oracle, можно запустить отчет Oracle AWR для получения метрик (операций ввода-вывода, Мбит/с, ГБ и т. д.). Затем выберите виртуальную машину на основе собранных метрик. Также можно обратиться в группу обслуживания инфраструктуры, чтобы получить аналогичные сведения.

Вы можете запустить отчет AWR во время обычной и пиковой рабочей нагрузки, чтобы сравнить результаты. С помощью этих отчетов можно настроить размер виртуальных машин на основе данных средней или максимальной рабочей нагрузки.

Ниже приведен пример того, как создать отчет AWR (создать отчеты AWR с помощью Oracle Enterprise Manager, если у вас есть текущая установка):

```bash
$ sqlplus / as sysdba
SQL> EXEC DBMS_WORKLOAD_REPOSITORY.CREATE_SNAPSHOT;
SQL> @?/rdbms/admin/awrrpt.sql
```

### <a name="key-metrics"></a>Ключевые метрики

Ниже перечислены метрики, которые можно получить из отчета:

- общее число ядер;
- тактовая частота процессора;
- общий объем памяти в ГБ;
- загрузка ЦП;
- пиковая частота передачи данных;
- частота изменения числа операций ввода-вывода (чтение и запись);
- скорость записи в журнал повторяемых операций (Мбит/с);
- Пропускная способность сети
- показатель задержек сети (низкий и высокий уровень);
- размер базы данных (в ГБ);
- число байт, полученных через SQL*Net из клиента и поступивших него.

### <a name="virtual-machine-size"></a>размер виртуальной машины;

#### <a name="1-estimate-vm-size-based-on-cpu-memory-and-io-usage-from-the-awr-report"></a>1. Оценка размера виртуальной машины на основе использования ЦП, памяти и операций ввода-вывода из отчета AWR

Обратите внимание на пять первых событий переднего плана с наибольшим временем ожидания, которые указывают на проблемные места системы.

Например, в верхней строке представленной ниже схемы приведены данные синхронизации для файла журнала. В строке указано число периодов ожидания перед тем, как LGWR записывает содержимое буфера журнала в файл журнала повторяемых операций. Эти результаты указывают на то, что требуются более производительные диски или хранилище. Кроме того, на схеме указано объем ЦП (число ядер) и объем памяти.

![Снимок экрана, на котором показана синхронизация файла журнала в верхней части таблицы.](./media/oracle-design/cpu_memory_info.png)

На следующей схеме представлены общие показатели операций ввода-вывода для чтения и записи. На момент создания отчета для операций чтения зафиксирован показатель 59 ГБ, а для операций записи — 247,3 ГБ.

![Снимок экрана, показывающий общий ввод-вывод для чтения и записи.](./media/oracle-design/io_info.png)

#### <a name="2-choose-a-vm"></a>2. Выбор виртуальной машины

Далее на основе данных из отчета AWR следует выбрать размер виртуальной машины, который соответствует вашим требованиям. Список доступных виртуальных машин см. в статье об [оптимизации для памяти](../../sizes-memory.md).

#### <a name="3-fine-tune-the-vm-sizing-with-a-similar-vm-series-based-on-the-acu"></a>3. Настройка размера виртуальной машины с помощью аналогичных серий виртуальных машин на основе ACU

Выбрав виртуальные машины, обратите внимание на связанные единицы вычислений Azure (ACU). Можно выбрать разные виртуальные машины на основе значения ACU, которое соответствует вашим требованиям. Дополнительные сведения см. в статье [Единицы вычислений Azure (ACU)](../../acu.md).

![Снимок экрана со страницей единиц ACU](./media/oracle-design/acu_units.png)

### <a name="network-throughput"></a>Пропускная способность сети

На следующей схеме показана связь между пропускной способностью и числом операций ввода-вывода в секунду:

![Снимок экрана с показателями пропускной способности](./media/oracle-design/throughput.png)

Общая пропускная способность сети зависит от следующих показателей:
- объем трафика SQL*Net;
- Мбит/с x число серверов (исходящий поток, например Oracle Data Guard);
- другие факторы, такие как репликация приложений.

![Снимок экрана пропускной способности SQL*Net](./media/oracle-design/sqlnet_info.png)

С учетом требований к пропускной способности сети можно выбрать разные типы шлюзов. К ним относятся шлюзы категории "Базовый", VpnGw и Azure ExpressRoute. Дополнительные сведения см. на странице с [ценами на VPN-шлюзы](https://azure.microsoft.com/pricing/details/vpn-gateway/?v=17.23h).

**Рекомендации**

- Задержка в сети выше, чем в локальном развертывании. Сокращение круговых путей по сети существенно влияет на производительность.
- Консолидируйте приложения с высоким числом транзакций или активные приложения в пределах одной виртуальной машины, чтобы снизить число круговых путей.
- Используйте виртуальные машины с [ускоренной сетью](../../../virtual-network/create-vm-accelerated-networking-cli.md) для повышения производительности сети.
- Для некоторых дистрибутивов Linux рассмотрите возможность включения [поддержки TRIM/](../../linux/configure-lvm.md#trimunmap-support)unотмена.
- Установите [Oracle Enterprise Manager](https://www.oracle.com/technetwork/oem/enterprise-manager/overview/index.html) на отдельной виртуальной машине.
- По умолчанию огромные страницы не включены в Linux. Рассмотрите возможность включения огромных страниц и установки `use_large_pages = ONLY` на Oracle DB. Это может повысить производительность. Дополнительные сведения см. [здесь](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/USE_LARGE_PAGES.html#GUID-1B0F4D27-8222-439E-A01D-E50758C88390).

### <a name="disk-types-and-configurations"></a>Типы дисков и их конфигурации

- *Диски ОС по умолчанию.* Диски этого типа обеспечивают хранение постоянных данных и кэширование. Они оптимизированы для доступа к ОС при запуске и не предназначены для транзакционных рабочих нагрузок или рабочих нагрузок хранилищ данных (аналитических нагрузок).

- *Неуправляемые диски.* Диски этого типа позволяют управлять учетными записями хранения, используемыми для хранения VHD-файлов, которые соответствуют дискам виртуальной машины. VHD-файлы хранятся в учетных записях хранения Azure как страничные BLOB-объекты.

- *Управляемые диски.* Управлять учетными записями хранения, используемыми для дисков виртуальной машины, будет Azure. Вы просто выбираете категорию (Premium или Standard) и размер диска. Azure самостоятельно создаст диск и будет управлять им.

- *Диски хранилища класса Premium.* Диски этого типа лучше всего подходят для производственных рабочих нагрузок. Хранилище класса Premium поддерживает диски, которые можно подключить к виртуальным машинам определенных серий, включая DS, DSv2, GS и F. Размер диска класса Premium можно выбрать в диапазоне от 32 до 4096 ГБ. Каждый из них имеет свои собственные характеристики производительности. В зависимости от потребностей приложения вы можете подключить один или несколько этих дисков к виртуальной машине.

Создавая управляемый диск на портале, вы можете выбрать **тип учетной записи** для диска, который хотите использовать. Помните, что в раскрывающемся меню отображаются не все доступные диски. Когда вы выберете определенный размер виртуальной машины, в меню отобразятся только доступные номера SKU для хранилища класса Premium с учетом этого размера.

![Снимок экрана страницы управляемых дисков](./media/oracle-design/premium_disk01.png)

Настроив хранилище на виртуальной машине, вы можете выполнить нагрузочный тест дисков перед созданием базы данных. Зная частоту операций ввода-вывода в контексте задержки и пропускной способности, вы сможете определить, поддерживает ли виртуальная машина ожидаемую пропускную способность с целевыми показателями задержки.

Есть несколько средств для нагрузочного тестирования приложения, например Oracle Orion, Sysbench и Fio.

Повторно запустите нагрузочный тест после развертывания базы данных Oracle. Запустите обычные и пиковые рабочие нагрузки. В результатах отразятся основные показатели вашей среды.

Возможно, целесообразнее будет выбрать размер хранилища на основе частоты операций ввода-вывода. Например, если требуемый показатель для операций ввода-вывода составляет 5000 ГБ, но вам нужно только 200 ГБ, вы по-прежнему можете использовать диск P30 класса Premium, хоть он и обеспечивает хранилище объемом более 200 ГБ.

Из отчета AWR можно узнать скорость операций ввода-вывода. Она определяется журналом повторяемых операций, показателем физических операций чтения и скоростью операций записи.

![Снимок экрана страницы отчета AWR](./media/oracle-design/awr_report.png)

Например, скорость повторяемых операций составляет 12,200,000 байт в секунду, что равно 11,63 Мбит/с.
Число операций ввода-вывода в секунду: 12 200 000 / 2358 = 5174.

Получив четкое представление о требованиях к скорости операций ввода-вывода, можно выбрать оптимальное сочетание дисков.

**Рекомендации**

- Для табличного пространства данных распределите рабочую нагрузку операций ввода-вывода между несколькими дисками с помощью управляемого хранилища или Oracle ASM.
- Добавляйте дополнительные диски данных по мере увеличения размера блока ввода-вывода для интенсивных операций чтения и записи.
- Увеличьте размер блока для масштабных последовательных процессов.
- Используйте сжатие данных для сокращения числа операций ввода-вывода (для данных и индексов).
- Используйте отдельные диски данных для журналов повторяемых операций, а также табличного пространства system, temp и undo.
- Не размещайте файлы приложений на дисках операционной системы по умолчанию (/dev/sda). Эти диски не оптимизированы для быстрой загрузки виртуальной машины и не могут обеспечить высокую производительность приложений.
- При использовании виртуальных машин серии M в хранилище класса Premium включите [ускоритель записи](../../how-to-enable-write-accelerator.md) на диске журналы повтора.

### <a name="disk-cache-settings"></a>Настройки кэша дисков.

Существует три варианта кэширования узла:

- *ReadOnly* : все запросы кэшируются для будущих операций чтения. Все операции записи сохраняются непосредственно в хранилище BLOB-объектов Azure.

- *ReadWrite* — это алгоритм с упреждающим чтением. Операции чтения и записи кэшируются для будущих операций чтения. Операции несквозной записи сначала сохраняются в локальном кэше. Кроме того, служба обеспечивает наименьшую задержку диска для незначительных рабочих нагрузок. Использование значения кэширования ReadWrite для приложения, которое не обеспечивает сохранение необходимых данных, может привести к потере данных в случае сбоя виртуальной машины.

- *Нет* (отключено): с помощью этого параметра вы можете избежать кэширования. Все данные передаются на диск и хранятся в службе хранилища Azure. Этот метод обеспечивает наивысшую скорость ввода-вывода для рабочих нагрузок с большим объемом операций ввода-вывода. Также необходимо учитывать стоимость транзакции.

**Рекомендации**

Чтобы максимально увеличить пропускную способность, рекомендуется начать с **None** для кэширования узла. Помните, что для хранилища класса Premium необходимо отключить препятствующие факторы при подключении файловой системы с параметром **Только для чтения** или **Нет** . Внесите значения UUID дисков в файл /etc/fstab.

![Снимок экрана: страница "управляемый диск" с параметрами "только чтение" и "нет".](./media/oracle-design/premium_disk02.png)

- Для дисков операционной системы используйте кэширование **Чтение и запись** по умолчанию.
- Для кэширования SYSTEM, TEMP и UNDO используйте параметр **Нет** .
- Для кэширования DATA используйте параметр **Нет** . Но если база данных предназначена только для чтения или интенсивного чтения, используйте кэширование **Только для чтения** .

Сохранив настройки диска данных вы сможете изменить параметры кэширования узла, только отключив диск на уровне операционной системы, а затем снова подключив, когда изменения будут внесены.

## <a name="security"></a>Безопасность

Установив и настроив среду Azure, вы можете приступать к обеспечению защиты сети. Вот несколько рекомендаций.

- *Политика NSG:* NSG можно определить для подсети или сетевого адаптера. Проще управлять доступом на уровне подсети, как для безопасности, так и для принудительной маршрутизации таких вещей, как брандмауэры приложений.

- *Jumpbox:* для более безопасного доступа администраторы не должны напрямую подключаться к службам приложений или базам данных. jumpbox используется в качестве носителя между ресурсами Azure и компьютером администратора.
![Снимок экрана страницы топологии Jumpbox](./media/oracle-design/jumpbox.png)

    Компьютер администратора должен предоставлять доступ только к Jumpbox. Для Jumpbox следует предоставить доступ к базам данных и приложениям.

- *Частная сеть (подсети):* рекомендуем устанавливать службу приложений и базу данных в разных подсетях, чтобы политика NSG могла настроить расширенные возможности управления.


## <a name="additional-reading"></a>Дополнительные материалы

- [Настройка Oracle ASM](configure-oracle-asm.md)
- [Настройка Oracle Data Guard](configure-oracle-dataguard.md)
- [Реализация Oracle Golden Gate на виртуальной машине Azure под управлением Linux](configure-oracle-golden-gate.md)
- [Создание резервных копий и восстановление базы данных Oracle Database 12c на виртуальной машине Linux в Azure](./oracle-overview.md)

## <a name="next-steps"></a>Дальнейшие действия

- Изучите [руководство по созданию высокодоступных виртуальных машин](../../linux/create-cli-complete.md).
- [Изучите примеры развертывания виртуальных машин с помощью интерфейса командной строки](../../linux/cli-samples.md).
