---
title: Резервное копирование SAP HANA в Azure на уровне файлов | Документация Майкрософт
description: Существуют две основные возможности резервного копирования SAP HANA на виртуальных машинах Azure. В этой статье рассматривается резервное копирование на уровне файлов.
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: juergent
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 03/01/2020
ms.author: juergent
ms.openlocfilehash: 93b67936166eb73db5e9a15db42c2c6135794108
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78271383"
---
# <a name="sap-hana-azure-backup-on-file-level"></a>Резервное копирование SAP HANA в Azure на уровне файлов

## <a name="introduction"></a>Вступление

Эта статья представляет собой статью для руководства по [резервному копированию для SAP HANA на виртуальных машинах Azure,](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-backup-guide)в которой содержится обзор и информация о начале работы и более подробная информация об службе резервного копирования Azure и моментальных снимках хранения. 

Для разных типов виртуальных машин в Azure допустимо подключение различного числа виртуальных жестких дисков. Точные сведения описаны в статье [Размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes). Для тестов, упомянутых в этой документации, мы использовали GS5 Azure VM, который позволяет 64 прикрепленных дисков данных. В крупных системах SAP HANA большее число этих дисков могут занимать файлы данных и журналов, а также программное чередование, обеспечивающее оптимальную пропускную способность операций ввода-вывода на диске. Подробнее о предлагаемых конфигурациях дисков для развертывания SAP HANA на Azure VMs читайте в статье [SAP HANA Azure виртуальных конфигураций машинного хранения.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations-storage) Приведенные рекомендации также включают в себя рекомендации по дисковому пространству для локальных резервных копий.

Стандартный способ управления резервным копированием и восстановлением на уровне файлов заключается в создании резервных копий на основе файлов через SAP HANA Studio или инструкции SQL. Для получения дополнительной информации, прочитайте статью [SAP HANA S'L и системы Просмотров Справка](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf).

![Диалоговое окно меню резервного копирования в SAP HANA Studio](media/sap-hana-backup-file-level/backup-menue-dialog.png)

На рисунке выше показано диалоговое окно меню резервного копирования в SAP HANA Studio. Выбрав тип &quot;Файл&quot;, пользователь должен указать путь в файловой системе, по которому SAP HANA записывает файлы резервных копий. То же самое касается и процесса восстановления.

Хотя этот вариант выглядит простым, он имеет некоторые особенности. Azure VM имеет ограничение количества дисков данных, которые могут быть прикреплены. В зависимости от размера базы данных и требований к пропускной способности диска, необходимой для программного чередования данных по нескольким дискам, доступной емкости может не хватать для хранения файлов резервных копий SAP HANA в файловых системах. Сведения о разных вариантах перемещения этих файлов резервных копий, а также об управлении ограничениями размера и производительностью при обработке терабайт данных приведены далее в этой статье.

Еще один вариант, обеспечивающий большую гибкость в отношении общей емкости, — это хранилище BLOB-объектов Azure. Сейчас отдельный большой двоичный объект может хранить 1 ТБ данных, но общий объем контейнера BLOB-объектов составляет 500 ТБ. Кроме того, пользователи могут использовать более экономичное &quot;холодное&quot; хранилище BLOB-объектов. Смотрите [хранилище Azure Blob: горячие, прохладные и архивные уровни доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?tabs=azure-portal) для получения подробной информации о холодном хранении капли.

Чтобы обеспечить более высокий уровень безопасности, для хранения резервных копий SAP HANA используйте геореплицированную учетную запись хранения. Подробнее об избыточности хранилища и репликации хранилища Azure можно узнать об [избыточности](https://docs.microsoft.com/azure/storage/common/storage-redundancy) хранилища и репликации хранилища.

Пользователи могут поместить выделенные виртуальные жесткие диски, на которых хранятся резервные копии SAP HANA, в геореплицированную учетную запись хранения резервных копий. Кроме того, эти виртуальные жесткие диски можно скопировать в геореплицированную учетную запись хранения или в учетную запись хранения, расположенную в другом регионе.

## <a name="azure-blobxfer-utility-details"></a>Сведения о служебной программе Azure blobxfer

Чтобы сохранить каталоги и файлы в службе хранилища Azure, можно использовать интерфейс командной строки, PowerShell или средство, разработанное на основе одного из [пакетов SDK](https://azure.microsoft.com/downloads/). Существует также готовая к использованию утилита AzCopy для копирования данных в хранилище Azure. (см. [Данные передачи с помощью утилиты командования AzCopy).](../../../storage/common/storage-use-azcopy.md)

Поэтому в рамках этой статьи для копирования файлов резервных копий SAP HANA мы используем blobxfer. Это средство с открытым исходным кодом доступно в [GitHub](https://github.com/Azure/blobxfer). Большое количество пользователей использует его в рабочих средах. Оно также позволяет копировать данные непосредственно в хранилище BLOB-объектов Azure или файловый ресурс Azure. Он также предлагает ряд полезных функций, таких как хэш md5, или автоматический параллелизм при копировании каталога с несколькими файлами.

## <a name="sap-hana-backup-performance"></a>Производительность резервного копирования SAP HANA
В этой главе обсуждаются соображения производительности. Достигнутые цифры могут не представлять собой последнее состояние, так как существует устойчивая разработка для достижения лучшей пропускной выгоды для хранения Azure. В результате следует выполнять индивидуальные тесты для конфигурации и региона Azure.

![Консоль резервного копирования SAP HANA в SAP HANA Studio](media/sap-hana-backup-file-level/backup-console-hana-studio.png)

На этом скриншоте показана резервная консоль SAP HANA студии SAP HANA. Потребовалось около 42 минут, чтобы выполнить резервную копию 230 ГБ на одном диске хранения HDD Azure Standard, прикрепленном к HANA VM с помощью файловой системы XFS на одном диске.

![Средство YaST на тестовой виртуальной машине SAP HANA](media/sap-hana-backup-file-level/one-backup-disk.png)

На снимке экрана выше показано средство YaST на тестовой виртуальной машине SAP HANA. Вы можете увидеть 1-ТБ одного диска для резервного копирования SAP HANA. Создание резервной копии 230 ГБ данных занимает приблизительно 42 минуты. Кроме того, к виртуальной машине подключены 5 дисков емкостью 200 ГБ, на которых установлен программный RAID-массив md0, выполняющий чередование по этим дискам данных Azure.

![Повторное резервное копирование в программном RAID-массиве с чередованием по пяти дискам данных хранилища Azure класса Standard](media/sap-hana-backup-file-level/five-backup-disks.png)

Время повторного резервного копирования в программном RAID-массиве с чередованием по пяти дискам данных хранилища Azure класса Standard сократилось с 42 до 10 минут. Диски, подключенные к виртуальной машине, не кэшируются. Это упражнение демонстрирует важность пропускной записи диска для достижения хорошего времени резервного копирования. Можно переключиться на sSD-хранилище Azure Standard SSD или Azure Premium Storage для дальнейшего ускорения процесса для достижения оптимальной производительности. Как правило, стандартное хранение HDD Azure не рекомендуется и используется только в демонстрационных целях. Рекомендация заключается в использовании минимального хранилища SSD Azure Standard SSD или премиум-хранилища Azure для производственных систем.

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a>Копирование файлов резервных копий SAP HANA в хранилище BLOB-объектов Azure
Номера производительности, номера продолжительности резервного копирования и упомянутые номера копирования могут не представлять последнее состояние технологии Azure. Корпорация Майкрософт постоянно совершенствует систему хранения данных Azure, чтобы обеспечить большую пропускную способность и более низкую просрку. Поэтому номера предназначены только для демонстрационных целей. Вам необходимо проверить вашу индивидуальную потребность в регионе Azure по вашему выбору, чтобы иметь возможность судить с методом является лучшим для вас.

Другой вариант для быстрого сохранения файлов резервных копий SAP HANA — использование хранилища BLOB-объектов Azure. Один контейнер с каплями имеет лимит около 500 ТБ, достаточно для систем SAP HANA, использующих M32ts, M32ls, M64ls и GS5 VM типы Azure, чтобы сохранить достаточное количество резервных копирований SAP HANA. Клиенты имеют &quot;выбор&quot; &quot;между&quot; горячим и холодным хранилищем капли (см. [хранение Azure Blob: горячие, прохладные и архивные уровни доступа).](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?tabs=azure-portal)

Средство blobxfer упрощает копирование файлов резервных копий SAP HANA непосредственно в хранилище BLOB-объектов Azure.

![Файлы полной резервной копии SAP HANA](media/sap-hana-backup-file-level/list-of-backups.png)

Вы можете увидеть файлы полного резервного копирования файлов SAP HANA. Из четырех файлов, самый большой имеет примерно 230 ГБ размера.

![Копирование 230 ГБ данных в контейнер больших двоичных объектов учетной записи хранения класса Standard занимает примерно 3000 секунд](media/sap-hana-backup-file-level/copy-duration-blobxfer.png)

Копирование 230 ГБ данных в контейнер больших двоичных объектов учетной записи хранения класса Standard занимает примерно 3000 секунд (в начальном тесте не использовался MD5-хэш).

В консоли резервного копирования HANA Studio можно ограничить максимальный размер файлов резервных копий HANA. В среде образца, он улучшил производительность, имея несколько небольших файлов резервного копирования, вместо одного большого 230-ГБ файла.

Установка лимита размера резервного файла на стороне HANA&#39;не улучшает время резервного копирования, потому что файлы написаны последовательно. Для максимального размера файла задано значение 60 ГБ. Поэтому вместо одного большого файла емкостью 230 ГБ было создано 4 меньших файла данных. Использование нескольких файлов резервного копирования может стать необходимостью для резервного копирования баз данных HANA, если ваши целевые показатели резервного копирования имеют ограничения на размеры файлов размеров кабы.

![Чтобы проверить параллелизм средства blobxfer, максимальный размер файла резервных копий HANA изменили на 15 ГБ](media/sap-hana-backup-file-level/parallel-copy-multiple-backup-files.png)

Чтобы проверить параллелизм средства blobxfer, максимальный размер файла резервных копий HANA изменили на 15 ГБ. В общем количество файлов составило 19. С такой конфигурацией время копирования 230 ГБ данных в хранилище BLOB-объектов Azure с помощью средства blobxfer сократилось с 3000 до 875 секунд.

При изучении копирования резервных копий, выполняемых против локальных дисков в других местах, таких как хранилище Azure blob, имейте в виду, что пропускная способность, используемая в конечном итоге параллельным процессом копирования, является учетом в отношении сетевой или памятной квоты вашего индивидуального типа VM. В результате необходимо сбалансировать продолжительность копии с пропускной способностью сети и пропускной способностью, необходимой обычной рабочей нагрузке в VM. 


## <a name="copy-sap-hana-backup-files-to-nfs-share"></a>Копирование файлов резервных копий SAP HANA в общий ресурс NFS

Microsoft Azure предлагает родные nFS-акции через [Файлы NetApp Azure.](https://azure.microsoft.com/services/netapp/) Можно создавать различные объемы десятков ТБ, способных хранить и управлять резервными копированиями. Вы также можете моментировать эти тома на основе технологии NetApp. Файлы Сети Azure NetApp (ANF) предлагаются в трех различных уровнях обслуживания, которые дают различную пропускную емкость. Для получения более подробной информации читайте в статье [Уровни службы для файлов NetApp Azure](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels). Вы можете создать и смонтировать объем NFS из ANF, как описано в статье [Быстрый запуск: Настройка файлов NetApp Azure и создание тома NFS](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-quickstart-set-up-account-create-volumes?tabs=azure-portal).

Помимо использования родных объемов NFS Azure через ANF, существуют различные возможности создания собственных развертываний, которые предоставляют доли NFS в Azure. Все они имеют недостаток, что вам нужно для развертывания и управления этими решениями самостоятельно. Некоторые из этих возможностей описаны в следующих статьях:

- [Обеспечение высокого уровня доступности NFS на виртуальных машинах Azure в SUSE Linux Enterprise Server](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs)
- [GlusterFS на виртуальных машинах Azure с Red Hat Enterprise Linux для SAP NetWeaver](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-glusterfs)

Акции NFS, созданные описанными выше средствами, могут быть использованы для непосредственного выполнения резервных копий HANA против или копирования резервных копий, которые были выполнены против локальных дисков к этим акциям NFS.

> [!NOTE]
> SAP HANA поддерживает NFS v3 и NFS v4.x. Любой другой формат, как SMB с файловой системой CIFS, не поддерживается для записи резервных открепительных записей HANA против. Смотрите также [заметку поддержки SAP #1820529](https://launchpad.support.sap.com/#/notes/1820529)

## <a name="copy-sap-hana-backup-files-to-azure-files"></a>Копирование файлов резервных копий SAP HANA в файлы Azure

К виртуальной машине Azure под управлением Linux можно подключить файловый ресурс Azure. В статье [Как использовать хранилище файлов Azure с Linux](https://docs.microsoft.com/azure/storage/files/storage-how-to-use-files-linux) содержится подробная информация о том, как выполнять конфигурацию. Для ограничения на Azure файлов или Azure премиум-файлов, прочитайте статью [Azure файлы масштабируемости и производительности целей](https://docs.microsoft.com/azure/storage/files/storage-files-scale-targets).

> [!NOTE]
> SMB с файловой системой CIFS не поддерживается SAP HANA для записи резервных отсутсвий HANA против. Смотрите также [примечание поддержки SAP #1820529.](https://launchpad.support.sap.com/#/notes/1820529) В результате это решение можно использовать только в качестве конечного пункта назначения резервной базы данных HANA, которая проводилась непосредственно против локальных прикрепленных дисков
> 

В тесте, проведенном против Файлов Azure, а не Azure Premium Files, было около 929 секунд, чтобы скопировать 19 файлов резервного копирования с общим объемом 230 ГБ. Мы ожидаем, что время использования файлов Azure Premium будет намного лучше. Тем не менее, необходимо иметь в виду, что вам нужно сбалансировать интересы быстрой копии с требованиями вашей рабочей нагрузки по пропускной способности сети. Поскольку каждый тип Azure VM обеспечивает соблюдение квоты пропускной способности сети, необходимо оставаться в пределах этой квоты с рабочей нагрузкой плюс копией файлов резервного копирования.

![Копирование 19 файлов резервных копий SAP HANA занимает примерно 929 секунд](media/sap-hana-backup-file-level/parallel-copy-to-azure-files.png)


Хранение резервных файлов SAP HANA в файлах Azure может быть интересным вариантом. Особенно с улучшением задержки и пропускной их пропускной четырмония файлов Azure Premium.

## <a name="next-steps"></a>Дальнейшие действия
* Общие сведения и информацию о начале работы см. в [руководстве по резервному копированию SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).
* Дополнительные сведения об обеспечении высокого уровня доступности и планировании аварийного восстановления SAP HANA в Azure (крупные экземпляры) см. в [этой статье](hana-overview-high-availability-disaster-recovery.md).
