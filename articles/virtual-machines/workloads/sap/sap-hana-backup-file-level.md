---
title: Резервное копирование SAP HANA в Azure на уровне файлов | Документация Майкрософт
description: Существуют две основные возможности резервного копирования SAP HANA на виртуальных машинах Azure. В этой статье рассматривается резервное копирование на уровне файлов.
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: juergent
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 03/01/2020
ms.author: juergent
ms.openlocfilehash: 93b67936166eb73db5e9a15db42c2c6135794108
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "78271383"
---
# <a name="sap-hana-azure-backup-on-file-level"></a>Резервное копирование SAP HANA в Azure на уровне файлов

## <a name="introduction"></a>Введение

Эта статья содержит сведения, связанные с [руководством по резервному копированию для SAP HANA на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-backup-guide), которые предоставляют обзор и сведения о начале работы и дополнительные сведения о Azure Backup моментальных снимках службы и хранилища. 

Для разных типов виртуальных машин в Azure допустимо подключение различного числа виртуальных жестких дисков. Точные сведения описаны в статье [Размеры виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/sizes). Для тестов, упомянутых в этой документации, мы использовали виртуальную машину GS5 Azure, которая допускает 64 подключенных дисков данных. В крупных системах SAP HANA большее число этих дисков могут занимать файлы данных и журналов, а также программное чередование, обеспечивающее оптимальную пропускную способность операций ввода-вывода на диске. Дополнительные сведения о рекомендуемых конфигурациях дисков для SAP HANA развертываний на виртуальных машинах Azure см. в статье [SAP HANA конфигурациях хранилища виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations-storage). Приведенные рекомендации также включают в себя рекомендации по дисковому пространству для локальных резервных копий.

Стандартный способ управления резервным копированием и восстановлением на уровне файлов заключается в создании резервных копий на основе файлов через SAP HANA Studio или инструкции SQL. Дополнительные сведения см. в статье [Справочник по SQL и системным представлениям SAP HANA](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf).

![Диалоговое окно меню резервного копирования в SAP HANA Studio](media/sap-hana-backup-file-level/backup-menue-dialog.png)

На рисунке выше показано диалоговое окно меню резервного копирования в SAP HANA Studio. Выбрав тип &quot;Файл&quot;, пользователь должен указать путь в файловой системе, по которому SAP HANA записывает файлы резервных копий. То же самое касается и процесса восстановления.

Хотя этот вариант выглядит простым, он имеет некоторые особенности. Виртуальная машина Azure имеет ограничение на число дисков данных, которые можно подключить. В зависимости от размера базы данных и требований к пропускной способности диска, необходимой для программного чередования данных по нескольким дискам, доступной емкости может не хватать для хранения файлов резервных копий SAP HANA в файловых системах. Сведения о разных вариантах перемещения этих файлов резервных копий, а также об управлении ограничениями размера и производительностью при обработке терабайт данных приведены далее в этой статье.

Еще один вариант, обеспечивающий большую гибкость в отношении общей емкости, — это хранилище BLOB-объектов Azure. Сейчас отдельный большой двоичный объект может хранить 1 ТБ данных, но общий объем контейнера BLOB-объектов составляет 500 ТБ. Кроме того, пользователи могут использовать более экономичное &quot;холодное&quot; хранилище BLOB-объектов. Дополнительные сведения о очень удобном хранилище BLOB-объектов см. в статье [хранилище BLOB-объектов Azure: горячий, холодный и архивный уровни доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?tabs=azure-portal) .

Чтобы обеспечить более высокий уровень безопасности, для хранения резервных копий SAP HANA используйте геореплицированную учетную запись хранения. Дополнительные сведения о избыточности хранилища и репликации хранилища см. в статье [избыточность хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy) .

Пользователи могут поместить выделенные виртуальные жесткие диски, на которых хранятся резервные копии SAP HANA, в геореплицированную учетную запись хранения резервных копий. Кроме того, эти виртуальные жесткие диски можно скопировать в геореплицированную учетную запись хранения или в учетную запись хранения, расположенную в другом регионе.

## <a name="azure-blobxfer-utility-details"></a>Сведения о служебной программе Azure blobxfer

Чтобы сохранить каталоги и файлы в службе хранилища Azure, можно использовать интерфейс командной строки, PowerShell или средство, разработанное на основе одного из [пакетов SDK](https://azure.microsoft.com/downloads/). Для копирования данных в службу хранилища Azure также можно использовать готовую служебную программу AzCopy. (см. раздел [Перенос данных с помощью служебной программы командной строки AzCopy](../../../storage/common/storage-use-azcopy.md)).

Поэтому в рамках этой статьи для копирования файлов резервных копий SAP HANA мы используем blobxfer. Это средство с открытым исходным кодом доступно в [GitHub](https://github.com/Azure/blobxfer). Большое количество пользователей использует его в рабочих средах. Оно также позволяет копировать данные непосредственно в хранилище BLOB-объектов Azure или файловый ресурс Azure. Он также предлагает ряд полезных функций, таких как MD5-хэш, или автоматический параллелизм при копировании каталога с несколькими файлами.

## <a name="sap-hana-backup-performance"></a>Производительность резервного копирования SAP HANA
В этой главе обсуждаются вопросы, касающиеся производительности. Полученные числа могут не представлять самое последнее состояние, поскольку существует устойчивая разработка для повышения пропускной способности в службе хранилища Azure. В результате вы должны выполнять отдельные тесты для конфигурации и региона Azure.

![Консоль резервного копирования SAP HANA в SAP HANA Studio](media/sap-hana-backup-file-level/backup-console-hana-studio.png)

На этом снимке экрана показана консоль SAP HANA Backup в SAP HANA Studio. Резервное копирование 230 ГБ на один диск хранилища HDD (цен. категория "Стандартный") Azure, подключенный к виртуальной машине HANA с помощью файловой системы XFS на одном диске, занял примерно 42 минут.

![Средство YaST на тестовой виртуальной машине SAP HANA](media/sap-hana-backup-file-level/one-backup-disk.png)

На снимке экрана выше показано средство YaST на тестовой виртуальной машине SAP HANA. Для SAP HANA резервной копии можно просмотреть один диск объемом 1 ТБ. Создание резервной копии 230 ГБ данных занимает приблизительно 42 минуты. Кроме того, к виртуальной машине подключены 5 дисков емкостью 200 ГБ, на которых установлен программный RAID-массив md0, выполняющий чередование по этим дискам данных Azure.

![Повторное резервное копирование в программном RAID-массиве с чередованием по пяти дискам данных хранилища Azure класса Standard](media/sap-hana-backup-file-level/five-backup-disks.png)

Время повторного резервного копирования в программном RAID-массиве с чередованием по пяти дискам данных хранилища Azure класса Standard сократилось с 42 до 10 минут. Диски, подключенные к виртуальной машине, не кэшируются. В этом упражнении демонстрируется важность пропускной способности записи на диск для достижения хорошей длительности резервного копирования. Вы можете переключиться на хранилище Azure SSD (цен. категория "Стандартный") или хранилище Azure класса Premium, чтобы ускорить процесс для обеспечения оптимальной производительности. Как правило, хранение на жестких дисках Azure уровня "Стандартный" не рекомендуется и используется только в демонстрационных целях. Рекомендуется использовать как минимум хранилище Azure SSD (цен. категория "Стандартный") или хранилище Azure класса Premium для рабочих систем.

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a>Копирование файлов резервных копий SAP HANA в хранилище BLOB-объектов Azure
Номера производительности, значения длительности резервного копирования и номера продолжительности копирования могут не соответствовать последнему состоянию технологии Azure. Корпорация Майкрософт постоянно улучшает службу хранилища Azure, обеспечивая более высокую пропускную способность и более низкие задержки. Поэтому числа используются только в демонстрационных целях. Вам нужно протестировать индивидуальную потребность в выбранном регионе Azure, чтобы иметь возможность оценивать метод с помощью метода.

Другой вариант для быстрого сохранения файлов резервных копий SAP HANA — использование хранилища BLOB-объектов Azure. Один контейнер больших двоичных объектов имеет ограничение в 500 ТБ, достаточное для SAP HANA систем с использованием типов виртуальных машин M32ts, M32ls, M64ls и GS5 для хранения достаточного количества SAP HANA резервных копий. Клиенты имеют возможность выбора между &quot;&quot; горячим &quot;и&quot; холодным хранилищем больших двоичных объектов (см. раздел [хранилище BLOB-объектов Azure: горячий, холодный и архивный уровни доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers?tabs=azure-portal)).

Средство blobxfer упрощает копирование файлов резервных копий SAP HANA непосредственно в хранилище BLOB-объектов Azure.

![Файлы полной резервной копии SAP HANA](media/sap-hana-backup-file-level/list-of-backups.png)

Можно просмотреть файлы полной резервной копии файлов SAP HANA. Из четырех файлов наибольший размер составляет примерно 230 ГБ.

![Копирование 230 ГБ данных в контейнер больших двоичных объектов учетной записи хранения класса Standard занимает примерно 3000 секунд](media/sap-hana-backup-file-level/copy-duration-blobxfer.png)

Копирование 230 ГБ данных в контейнер больших двоичных объектов учетной записи хранения класса Standard занимает примерно 3000 секунд (в начальном тесте не использовался MD5-хэш).

В консоли резервного копирования HANA Studio можно ограничить максимальный размер файлов резервных копий HANA. В примере среды улучшена производительность за счет создания нескольких небольших файлов резервных копий вместо одного большого файла размером 230 ГБ.

Установка предельного размера файла резервной копии на стороне HANA не&#39;время резервного копирования, так как файлы записываются последовательно. Для максимального размера файла задано значение 60 ГБ. Поэтому вместо одного большого файла емкостью 230 ГБ было создано 4 меньших файла данных. Использование нескольких файлов резервных копий может стать обязательной для резервного копирования баз данных HANA, если целевые объекты резервного копирования имеют ограничения на размер файлов больших двоичных объектов.

![Чтобы проверить параллелизм средства blobxfer, максимальный размер файла резервных копий HANA изменили на 15 ГБ](media/sap-hana-backup-file-level/parallel-copy-multiple-backup-files.png)

Чтобы проверить параллелизм средства blobxfer, максимальный размер файла резервных копий HANA изменили на 15 ГБ. В общем количество файлов составило 19. С такой конфигурацией время копирования 230 ГБ данных в хранилище BLOB-объектов Azure с помощью средства blobxfer сократилось с 3000 до 875 секунд.

При изучении копирования резервных копий, выполняемых на локальных дисках, в другие расположения, такие как хранилище BLOB-объектов Azure, помните о том, что пропускная способность, используемая в результате параллельного процесса копирования, заключается в учете квоты сети или хранилища для отдельного типа виртуальной машины. В результате необходимо сбалансировать длительность копирования по сети и пропускной способности хранилища. нормальная рабочая нагрузка, выполняемая на виртуальной машине, требует. 


## <a name="copy-sap-hana-backup-files-to-nfs-share"></a>Копирование файлов резервных копий SAP HANA в общий ресурс NFS

Microsoft Azure предлагают собственные общие ресурсы NFS через [Azure NetApp Files](https://azure.microsoft.com/services/netapp/). Для хранения резервных копий и управления ими можно создавать различные объемы ресурсов TBs из десятков. Вы также можете создать моментальные снимки этих томов на основе технологии NetApp. Azure NetApp Files (использовании) предлагается на трех разных уровнях обслуживания, которые обеспечивают разную пропускную способность хранилища. Дополнительные сведения см. в статье [уровни обслуживания для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels). Вы можете создать и подключить том NFS из использовании, как описано в статье [Краткое руководство. настройка Azure NetApp Files и создание тома NFS](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-quickstart-set-up-account-create-volumes?tabs=azure-portal).

Помимо использования собственных томов NFS Azure с помощью использовании, существуют различные возможности создания собственных развертываний, предоставляющих общие папки NFS в Azure. Все имеют недостатки, необходимые для развертывания этих решений и управления ими самостоятельно. Некоторые из этих возможностей описаны в следующих статьях:

- [Обеспечение высокого уровня доступности NFS на виртуальных машинах Azure в SUSE Linux Enterprise Server](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs)
- [GlusterFS на виртуальных машинах Azure с Red Hat Enterprise Linux для SAP NetWeaver](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-glusterfs)

Общие папки NFS, созданные способами, описанными выше, можно использовать для непосредственного выполнения резервного копирования HANA в или для копирования резервных копий, которые были выполнены с локальных дисков на эти общие папки NFS.

> [!NOTE]
> SAP HANA поддерживают NFS v3 и NFS V4. x. Любой другой формат, например SMB с файловой системой CIFS, не поддерживается для записи резервных копий HANA в. См. также [Примечание о поддержке SAP #1820529](https://launchpad.support.sap.com/#/notes/1820529)

## <a name="copy-sap-hana-backup-files-to-azure-files"></a>Копирование файлов резервных копий SAP HANA в файлы Azure

К виртуальной машине Azure под управлением Linux можно подключить файловый ресурс Azure. В статье [Использование хранилища файлов Azure с Linux](https://docs.microsoft.com/azure/storage/files/storage-how-to-use-files-linux) приводятся подробные сведения о том, как выполнить настройку. Ограничения для файлов Azure и файлов Azure Premium см. в статье [целевые показатели масштабируемости и производительности файлов](https://docs.microsoft.com/azure/storage/files/storage-files-scale-targets)Azure.

> [!NOTE]
> Протокол SMB с файловой системой CIFS не поддерживается SAP HANA для записи резервных копий HANA в. См. также [Примечание о поддержке SAP #1820529](https://launchpad.support.sap.com/#/notes/1820529). В результате это решение можно использовать как конечное назначение резервной копии базы данных HANA, которая была проведена непосредственно на локальных подключенных дисках.
> 

В тесте, проведенном в службе файлов Azure, не рекомендуется создавать файлы Azure Premium примерно в течение 929 секунд, чтобы скопировать 19 файлов резервных копий с общим объемом 230 ГБ. Мы предполагаем, что время использования файлов Azure Premium лучше. Тем не менее необходимо помнить, что необходимо сбалансировать процентные интересы быстрой копии с учетом требований вашей рабочей нагрузки к пропускной способности сети. Так как каждый тип виртуальной машины Azure применяет квоту пропускной способности сети, необходимо остаться в диапазоне этой квоты с рабочей нагрузкой и копией файлов резервных копий.

![Копирование 19 файлов резервных копий SAP HANA занимает примерно 929 секунд](media/sap-hana-backup-file-level/parallel-copy-to-azure-files.png)


Хранение SAP HANA файлов резервных копий в службе файлов Azure может быть интересным вариантом. Особенно с улучшенной задержкой и пропускной способностью файлов Azure Premium.

## <a name="next-steps"></a>Дальнейшие шаги
* Общие сведения и информацию о начале работы см. в [руководстве по резервному копированию SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md).
* Дополнительные сведения об обеспечении высокого уровня доступности и планировании аварийного восстановления SAP HANA в Azure (крупные экземпляры) см. в [этой статье](hana-overview-high-availability-disaster-recovery.md).
