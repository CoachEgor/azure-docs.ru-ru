---
title: Конфигурации виртуального хранения данных SAP HANA Azure Документы Майкрософт
description: Рекомендации по хранению для VM, в которых размещен sAP HANA.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 03/10/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: c4e8b544ea3daeb23b22f3864beb21ba9d3f342f
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81255623"
---
# <a name="sap-hana-azure-virtual-machine-storage-configurations"></a>Конфигурации хранилища виртуальных машин SAP HANA в Azure

Azure предоставляет различные типы хранилищ, подходящие для MMs Azure, работающих под управлением SAP HANA. **Сертифицированные SAP HANA типы хранения Azure,** которые могут быть рассмотрены для списка развертываний SAP HANA: 

- Azure Premium SSD  
- [Диск (цен. категория "Ультра")](https://docs.microsoft.com/azure/virtual-machines/linux/disks-enable-ultra-ssd)
- [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) 

Чтобы узнать об этих типах дисков, смотрите статью [Выберите тип диска](https://docs.microsoft.com/azure/virtual-machines/linux/disks-types)

Azure предлагает два метода развертывания виртуальных жестких дисков (VHD) в хранилище Azure класса "Стандартный" и хранилище Azure класса Premium. Рекомендуется использовать развертывания [управляемых дисков Azure](https://azure.microsoft.com/services/managed-disks/), если общий сценарий это допускает. 

Список типов хранилища и их соглашения об уровне обслуживания в отношении операций ввода-вывода в секунду (IOPS) и пропускной способности хранилища см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).

> [!IMPORTANT]
> Независимо от выбранного типа хранилища Azure, файловая система, используемая на этом хранилище, должна поддерживаться SAP для конкретной операционной системы и DBMS. [Примечание поддержки SAP #405827](https://launchpad.support.sap.com/#/notes/405827) перечисляет поддерживаемые файловые системы для различных операционных систем и баз данных, включая SAP HANA. Это относится ко всем томам SAP HANA может получить доступ для чтения и записи для любой задачи. В частности, используя NFS на Azure для SAP HANA, дополнительные ограничения версий NFS применяются, как указано позднее в этой статье 


Минимальные сертифицированные условия SAP HANA для различных типов хранилища: 

- Azure Premium SSD - /hana/log требуется для кэша с помощью [ускорителя](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator)Azure Write. Громкость /hana/data может быть размещена на Premium SSD без ускорителя Azure Write или на диске Ultra
- Azure Ultra диск по крайней мере для /hana/log тома. Громкость /hana/data может быть размещена либо на Premium SSD без ускорителя Azure Write, либо для того, чтобы быстрее перезапустить время Ультра-диска
- **NFS v4.1** тома поверх файлов Azure NetApp для /hana/log **и** /hana/data. Объем /hana/shared может использовать протокол NFS v3 или NFS v4.1. Протокол NFS v4.1 является обязательным для /hana/data и/hana/log томов.

Некоторые типы хранилища можно комбинировать. Например, можно поместить /hana/data на Premium Storage и /hana/log можно разместить на хранении диска Ultra, чтобы получить необходимую низкую задержку. Однако, если вы используете том NFS v4.1 на основе ANF для /hana/data, вы должны использовать другой том NFS v4.1 на основе ANF для /hana/log. Использование NFS поверх ANF для одного из томов (например,/hana/data) и Azure Premium Storage или Ultra disk для другого тома (например,/hana/log) **не поддерживается.**

В современном мире редко приходилось заботиться о подсистемах ввоза и их возможностях. Это связано с тем, что поставщику оборудования необходимо было убедиться в том, что для SAP HANA соблюдены минимальные требования к хранению. При самостоятельном построении инфраструктуры Azure вы должны знать некоторые из этих требований SAP. Некоторые из минимальных характеристик пропускной способности, которые требуются от SAP, приводят к необходимости:

- Включить чтение/запись на **/hana/log** 250 МБ/сек с размерами 1 МБ всекунд/О
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.
- Включите действие записи с пропускной способностью не менее 250 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.

Так как небольшая задержка хранилища для систем СУБД является критической, даже такие системы, как SAP HANA, хранят данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Кроме того, такие операции, как запись точек сохранения или загрузка данных в памяти после восстановления из-за сбоя, могут быть критическими. Поэтому **необходимо** использовать высококачественные диски Azure Premium для **/hana/data** и **/hana/log** томов. Чтобы добиться минимальной пропускной способности **/hana/log** и **/hana/data** в соответствии с требованиями SAP, создайте RAID 0 с помощью MDADM или LVM на нескольких дисках хранилища Azure класса Premium и используйте тома RAID в качестве томов **/hana/data** и **/hana/log**. 

**Рекомендация: В качестве размеров полосы для RAID 0 рекомендация заключается в использовании:**

- 256 КБ для **/hana/данных**
- 32 KБ для **/hana/log**

> [!IMPORTANT]
> Размер полосы для /hana/data был изменен с более ранних рекомендаций, призывающих к 64 кБ или 128 КБ до 256 кБ на основе опыта клиентов с более поздними версиями Linux. Размер 256 КБ обеспечивает несколько более высокую производительность

> [!NOTE]
> Нет необходимости настраивать уровень избыточности с помощью томов RAID, так как хранилища Azure класса Premium и Standard хранят три образа виртуального жесткого диска. Использование тома RAID предназначено исключительно для настройки томов, которые предоставляют достаточную пропускную способность операций ввода-вывода.

Использование нескольких VHD Azure в RAID влияет на число операций ввода-вывода в секунду и пропускную способность хранилища. Таким образом, если вы добавите в RAID 0 3 диска P30 хранилища Azure класса Premium, число операций ввода-вывода в секунду и пропускная способность увеличатся в три раза, исходя из показателей одного диска P30 хранилища класса Premium.

Кроме того, при выборе виртуальной машины или изменении ее размера учитывайте пропускную способность ввода-вывода. Общие сведения о пропускной способности хранилища виртуальной машины см. в статье [Размеры виртуальных машин, оптимизированных для операций в памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

## <a name="linux-io-scheduler-mode"></a>Режим планировщика операций ввода–вывода для Linux
Linux имеет несколько разных режимов планирования операций ввода-вывода. Распространенная рекомендация через поставщиков Linux и SAP заключается в том, чтобы перенастроить режим планировщика ввоза/одолжны для объемов дисков из **mq-deadline** или **kyber-режима** в режим **noop** (не-multiqueue) или **нет** для (многокийного) режима. Подробности упоминаются в [SAP Note #1984787](https://launchpad.support.sap.com/#/notes/1984787). 


## <a name="solutions-with-premium-storage-and-azure-write-accelerator-for-azure-m-series-virtual-machines"></a>Решения с Premium Storage и Azure Write Accelerator для виртуальных машин Azure M-Series
Azure Write Accelerator — это функциональность, которая доступна исключительно для VM-м для Azure M-Series. Как очевидно из названия, целью функции является уменьшение задержки операций ввода-вывода записей в хранилище Azure класса Premium. В SAP HANA ускоритель записи нужно использовать только для тома **/hana/log**. Таким образом, **/hana/data** и **/hana/log** представляют собой отдельные тома с Azure Write Accelerator, поддерживающим только **/hana/log.** 

> [!IMPORTANT]
> При использовании Azure Premium Storage использование [ускорителя](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) записи Azure write или громкости /hana/log является обязательным. Write Accelerator доступен только для премиум-хранилища и M-Series и Mv2-Series VMs.

Приведенные ниже рекомендации по кэшированию даны исходя из следующих характеристик ввода-вывода для SAP HANA:

- Практически отсутствует рабочая нагрузка чтения файлов данных HANA. Исключениями являются большие по размеру операции ввода-вывода после перезапуска экземпляра HANA или когда данные загружаются в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. В этом случае кэширование чтения практически не имеет смысла, поскольку в большинстве случаев все тома файлов данных необходимо считать полностью.
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения выполняется асинхронно и не задерживает выполнение пользовательских транзакций. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Однако восстановление после сбоя происходит только в исключительных ситуациях
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются большие операции ввода-вывода при выполнении резервных копий журналов транзакций, восстановления после сбоя или во время перезапуска экземпляра HANA.  
- Основной нагрузкой на файл журнала повторяемых операций SAP HANA являются операции записи. В зависимости от характера рабочей нагрузки можно иметь операции ввода-вывода размером 4 КБ, тогда как в других случаях размер может превышать 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи необходимо сохранить на диске надежным образом

**Рекомендация: В результате этих наблюдаемых шаблонов вво/времени SAP HANA кэширование для различных томов с помощью Azure Premium Storage должно быть установлено следующим образом:**

- **/hana/data** — без кэширования.
- **/hana/log** - без кэширования - исключение для M- и Mv2-Series, где write Accelerator должен быть включен без чтения кэширования. 
- **/hana/shared** — кэширование чтения.

### <a name="production-recommended-storage-solution"></a>Производственное рекомендуемое решение для хранения данных

> [!IMPORTANT]
> Сертификация SAP HANA для виртуальных машин Azure серии M предоставлена исключительно для конфигурации, где ускоритель записи Azure используется только для тома **/hana/log**. В результате ожидается, что в развертываниях производственного сценария SAP HANA на виртуальных машинах Azure серии M ускоритель записи Azure будет настроен для тома **/hana/log**.  

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

Рекомендации часто превышают минимальные требования SAP, как указано ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размеру SAP и максимальной пропускной способности хранилища, обеспечиваемым различными типами VM.

**Рекомендация: Рекомендуемые конфигурации для сценариев производства выглядят следующими:**

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | hana/log; | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 4 x P20 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 |2 x P30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 3 x P30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 2 x P40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P40 |
| M208s_v2 | 2850 GiB | 1000 МБ/с | 4 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P40 |
| M208ms_v2 | 5700 GiB | 1000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416s_v2 | 5700 GiB | 2000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416ms_v2 | 11400 GiB | 2000 МБ/с | 8 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P50 |

Проверьте, соответствует ли пропускная память для различных предлагаемых томов рабочей нагрузке, которую вы хотите запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Размер объема с большим количеством VHD, чем в списке, увеличивает пропускную связь IOPS и I/O в пределах типа виртуальной машины Azure.

Ускоритель записи Azure работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Поэтому в качестве управляемых дисков необходимо развернуть по крайней мере диски хранилища Azure класса Premium, формирующие том **/hana/log**.

Есть ограничения на число виртуальных жестких дисков хранилища Azure класса Premium для каждой виртуальной машины, которые могут поддерживаться ускорителем записи Azure. Сейчас действуют такие ограничения:

- 16 VHD для M128xx и M416xx VM
- 8 VHD для M64xx и M208xx VM
- 4 виртуальных жестких диска для виртуальной машины серии M32xx.

Подробные инструкции по включению ускорителя записи Azure см. в статье [Write Accelerator](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) (Ускоритель записи).

Подробные сведения и ограничения для ускорителя записи Azure можно найти в той же статье.

**Рекомендация: Вам нужно использовать ускоритель Write для дисков, образующих громкость /hana/log**


### <a name="cost-conscious-azure-storage-configuration"></a>Стоимость конфигурации хранилища Azure
В следующей таблице показана конфигурация типов VM, которые клиенты также используют для размещения SAP HANA на VMs Azure. Могут быть некоторые типы VM, которые могут не соответствовать всем минимальным критериям хранения sAP HANA или официально не поддерживаются SAP HANA. Но пока эти виртуальные машины отлично работали в нерабочих средах. **/hana/data** и **/hana/log** объединяются в один том. В результате использование ускорителя записи Azure Write может стать ограничением с точки зрения IOPS.

> [!NOTE]
> Для сценариев, поддерживаемых SAP, проверьте, поддерживается ли определенный тип VM для SAP HANA SAP в [документации SAP для IAAS.](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html)

> [!NOTE]
> Переход от прежних рекомендаций по затратному решению заключается в переходе от [дисков Azure Standard HDD](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd) к более эффективным и более надежным [SSD-дискам Azure Standard](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd)

Рекомендации часто превышают минимальные требования SAP, как указано ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размеру SAP и максимальной пропускной способности хранилища, обеспечиваемым различными типами VM.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических томов или MDADM | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E16v3 | 128 ГБ | 384 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E32v3 | 256 Гиб | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| E64v3 | 432 ГиБ | 1200 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| GS5 | 448 ГиБ | 2000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 |1 x E30 |
| M64s | 1000 GiB | 1000 МБ/с | 2 x P30 | 1 x E30 | 1 x E6 | 1 x E6 |2 x E30 |
| M64ms | 1750 GiB | 1000 МБ/с | 3 x P30 | 1 x E30 | 1 x E6 | 1 x E6 | 3 x E30 |
| M128s | 2000 GiB | 2000 МБ/с |3 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E40 |
| M128ms | 3800 GiB | 2000 МБ/с | 5 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E50 |
| M208s_v2 | 2 850 GiB | 1000 МБ/с | 4 x P30 | 1 x E30 | 1 x E10 | 1 x E6 |  3 x E40 |
| M208ms_v2 | 5700 GiB | 1000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416s_v2 | 5700 GiB | 2000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416ms_v2 | 11400 GiB | 2000 МБ/с | 8 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E50 |


Диски 3 x P20, рекомендуемые для типов виртуальных машин меньшего размера, превышают размер томов согласно рекомендациям относительно дискового пространства, указанным в [техническом документе для хранилища SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Тем не менее этот вариант, как показано в таблице, был выбран, чтобы обеспечить необходимую пропускную способность диска для SAP HANA. Если вам нужны изменения в **томе /hana/backup,** который был рассчитан для хранения резервных ups, которые представляют в два раза объем памяти, не стесняйтесь корректировать.   
Проверьте, соответствует ли пропускная память для различных предлагаемых томов рабочей нагрузке, которую вы хотите запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Размер объема с большим количеством VHD, чем в списке, увеличивает пропускную связь IOPS и I/O в пределах типа виртуальной машины Azure. 

> [!NOTE]
> В приведенных выше конфигурациях было бы невыгодно использовать [соглашение об уровне обслуживания для отдельной виртуальной машины Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_6/), так как оно использует хранилища класса Standard и Premium одновременно. Однако выбор был сделан для оптимизации затрат. Необходимо выбрать хранилище класса Premium для всех дисков, для которых указано хранилище Azure класса Standard (Sxx), чтобы сделать конфигурацию виртуальной машины совместимой с соглашением об уровне обслуживания для отдельной виртуальной машины.


> [!NOTE]
> Приведенные рекомендации по конфигурации диска нацелены на минимальные требования, которые SAP выражает в отношении своих поставщиков инфраструктуры. В реальных сценариях развертывания и рабочей нагрузки клиентов возникали ситуации, когда эти рекомендации по-прежнему не обеспечивали достаточно возможностей. Это могут быть ситуации, когда клиенту нужна более быстрая перезагрузка данных после перезапуска HANA или когда для конфигураций резервного копирования требуется более высокая пропускная способность в хранилище. Другие случаи включали **/hana/log**, в которых 5000 операций ввода-вывода в секунду было недостаточно для конкретной рабочей нагрузки. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйте в соответствии с требованиями своей рабочей нагрузки.
>  

## <a name="azure-ultra-disk-storage-configuration-for-sap-hana"></a>Конфигурация хранения дисков Azure Ultra для SAP HANA
Корпорация Майкрософт находится в процессе развертывания нового типа хранения данных Azure под названием [Azure Ultra disk.](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#ultra-disk) Существенное различие между системой хранения Azure, предлагаемой до сих пор, и диском Ultra заключается в том, что возможности диска больше не привязаны к размеру диска. Как клиент вы можете определить эти возможности для ультра диска:

- Размер диска от 4 GiB до 65 536 GiB
- IOPS варьируются от 100 IOPS до 160K IOPS (максимум зависит от типов VM, а)
- Пропускная память от 300 МБ/сек до 2000 МБ/сек

Ультра диск дает вам возможность определить один диск, который выполняет ваш размер, IOPS, и диапазон пропускной их возможности диска. Вместо того, чтобы использовать логические менеджеры объемов, такие как LVM или MDADM, поверх Azure Premium Storage для построения объемов, отвечающих требованиям IOPS и пропускной памяти. Вы можете запустить конфигурацию между ультра диском и премиум-хранилищем. В результате можно ограничить использование диска Ultra критическими характеристиками /hana/data и /hana/log томов и покрыть другие тома с помощью Azure Premium Storage

Другие преимущества Ultra диск может быть лучше читать задержки по сравнению с Premium Storage. Более быстрая задержка чтения может иметь преимущества, если вы хотите сократить время запуска HANA и последующую загрузку данных в память. Преимущества хранения ультра диска также можно почувствовать, когда HANA пишет точки сохранения. В виду того что диски запаса для Premium для /hana/data обычно не пишут Accelerator кэшированные, задержка записи к /hana/данным на Premium Storage сравнена к диску Ultra более высока. Можно ожидать, что на диске Ultra лучше работает запись Savepoint с помощью диска Ultra.

> [!IMPORTANT]
> Ультрадиск пока не присутствует во всех регионах Azure, а также еще не поддерживает все типы VM, перечисленные ниже. Для получения подробной информации о том, где доступен диск Ultra и какие семьи VM поддерживаются, проверьте статью [Какие типы дисков доступны в Azure?](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#ultra-disk).

### <a name="production-recommended-storage-solution-with-pure-ultra-disk-configuration"></a>Производство рекомендуемое решение для хранения с чистой конфигурацией диска Ultra
В этой конфигурации отдельно хранится объемы /hana/data и /hana/log. Предлагаемые значения выводятся из KPIs, которые SAP должен сертифицировать типы VM для SAP HANA и конфигураций хранения, как это рекомендовано в [Whitepaper SAP TDI Storage.](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html)

Рекомендации часто превышают минимальные требования SAP, как указано ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размеру SAP и максимальной пропускной способности хранилища, обеспечиваемым различными типами VM.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/объем данных | /hana/data I/O пропускная передача | /hana/data IOPS | /hana/log том | /hana/log I/O пропускная часть | /hana/log IOPS |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| E64s_v3 | 432 ГиБ | 1200 МБ/с | 600 ГБ | 700 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2 000 |
| M32ts | 192 ГиБ | 500 МБ/с | 250 ГБ | 400 Мбит/с | 7500 | 256 ГБ | 250 Мбит/с  | 2 000 |
| M32ls | 256 Гиб | 500 МБ/с | 300 ГБ | 400 Мбит/с | 7500 | 256 ГБ | 250 Мбит/с  | 2 000 |
| M64ls | 512 ГБ | 1000 МБ/с | 600 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M64s | 1000 GiB | 1000 МБ/с |  1200 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M64ms | 1750 GiB | 1000 МБ/с | 2100 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M128s | 2000 GiB | 2000 МБ/с |2400 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M128ms | 3800 GiB | 2000 МБ/с | 4800 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M208s_v2 | 2 850 GiB | 1000 МБ/с | 3500 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 400 Мбит/с  | 2500 | 
| M208ms_v2 | 5700 GiB | 1000 МБ/с | 7200 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 400 Мбит/с  | 2500 | 
| M416s_v2 | 5700 GiB | 2000 МБ/с | 7200 ГБ | 1500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M416ms_v2 | 11 400 GiB | 2000 МБ/с | 14 400 ГБ | 1500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 3000 |   

Перечисленные значения должны быть отправной точкой и должны оцениваться с учетом реальных требований. Преимущество диска Azure Ultra заключается в том, что значения для IOPS и пропускной их пропускной четыральности могут быть адаптированы без необходимости отключения VM или остановки рабочей нагрузки, применяемой к системе.   

> [!NOTE]
> До сих пор моментальные снимки с помощью хранилища Ultra диска недоступны. Это блокирует использование снимков VM с помощью служб резервного копирования Azure

### <a name="cost-conscious-storage-solution-with-pure-ultra-disk-configuration"></a>Затраты сознательного решения для хранения с чистой конфигурацией диска Ultra
В этой конфигурации на одном диске вы /hana/data и /hana/log. Предлагаемые значения выводятся из KPIs, которые SAP должен сертифицировать типы VM для SAP HANA и конфигураций хранения, как это рекомендовано в [Whitepaper SAP TDI Storage.](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html) 

Рекомендации часто превышают минимальные требования SAP, как указано ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размеру SAP и максимальной пропускной способности хранилища, обеспечиваемым различными типами VM.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | Объем для /hana/data и /log | /hana/data и пропускная передача ввода-вво-регистра | /hana/данные и журнал IOPS |
| --- | --- | --- | --- | --- | --- |
| E64s_v3 | 432 ГиБ | 1200 МБ/с | 1200 ГБ | 1200 Мбит/с | 9,500 | 
| M32ts | 192 ГиБ | 500 МБ/с | 512 ГБ | 400 Мбит/с | 9,500 | 
| M32ls | 256 Гиб | 500 МБ/с | 600 ГБ | 400 Мбит/с | 9,500 | 
| M64ls | 512 ГБ | 1000 МБ/с | 1100 ГБ | 900 Мбит/с | 10 000 | 
| M64s | 1000 GiB | 1000 МБ/с |  1700 ГБ | 900 Мбит/с | 10 000 | 
| M64ms | 1750 GiB | 1000 МБ/с | 2600 ГБ | 900 Мбит/с | 10 000 | 
| M128s | 2000 GiB | 2000 МБ/с |2900 ГБ | 1800 Мбит/с |12 000 | 
| M128ms | 3800 GiB | 2000 МБ/с | 5300 ГБ | 1800 Мбит/с |12 000 |  
| M208s_v2 | 2 850 GiB | 1000 МБ/с | 4000 ГБ | 900 Мбит/с | 10 000 |  
| M208ms_v2 | 5700 GiB | 1000 МБ/с | 7700 ГБ | 900 Мбит/с | 10 000 | 
| M416s_v2 | 5700 GiB | 2000 МБ/с | 7700 ГБ | 1800Мбит/б/с | 12 000 |  
| M416ms_v2 | 11 400 GiB | 2000 МБ/с | 15 000 ГБ | 1800 Мбит/с | 12 000 |    

Перечисленные значения должны быть отправной точкой и должны оцениваться с учетом реальных требований. Преимущество диска Azure Ultra заключается в том, что значения для IOPS и пропускной их пропускной четыральности могут быть адаптированы без необходимости отключения VM или остановки рабочей нагрузки, применяемой к системе.  

## <a name="nfs-v41-volumes-on-azure-netapp-files"></a>Объемы NFS v4.1 в файлах Azure NetApp
Azure NetApp Files предоставляет нативные nFS-акции, которые можно использовать для /hana/shared, /hana/data и /hana/log томов. Использование акций NFS на основе ANF для /hana/data и /hana/log volumes требует использования протокола v4.1 NFS. Протокол NFS v3 не поддерживается для использования /hana/data и /hana/log томов при базировании акций на ANF. 

> [!IMPORTANT]
> Протокол NFS v3, реализованный в файлах Azure NetApp, **не** поддерживается для использования в /hana/data и /hana/log. Использование NFS 4.1 является обязательным для /hana/data и /hana/log томов с функциональной точки зрения. В то время как для /hana/общего тома протокол NFS v3 или NFS v4.1 может быть использован с функциональной точки зрения.

### <a name="important-considerations"></a>Важные сведения
При рассмотрении файлов Azure NetApp для SAP Netweaver и SAP HANA следуете знать следующие важные соображения:

- Бассейн минимальной вместимости составляет 4 TiB.  
- Минимальный размер объема составляет 100 GiB
- Файлы Azure NetApp и все виртуальные машины, на которых будут монтированы объемы файлов Azure NetApp, должны находиться в той же виртуальной сети Azure или в [виртуальных сетях](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) в том же регионе.  
- Выбранная виртуальная сеть должна иметь подсеть, делегированную файлам NetApp Azure.
- Пропускная часть объема Azure NetApp зависит от квоты объема и уровня обслуживания, как это зафиксировано на [уровне обслуживания для файлов NetApp Azure.](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels) При размере объемов NETApp HANA Azure убедитесь, что полученная пропускная часть соответствует требованиям системы HANA.  
- Azure NetApp Files предлагает [экспортную политику:](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-configure-export-policy)вы можете управлять разрешенными клиентами, типдоступа (читай&написать, только читать и т.д.). 
- Функция Azure NetApp Files еще не знает о зоне. В настоящее время функция Azure NetApp Files не развернута во всех зонах доступности в регионе Azure. Имейте в виду потенциальные последствия задержки в некоторых регионах Azure.  
- Важно, чтобы виртуальные машины были развернуты в непосредственной близости от хранилища WindowsApp Azure с низкой задержкой. 
- Идентификатор пользователя для <b>sid</b>adm и идентификатор группы для `sapsys` виртуальных машин должны соответствовать конфигурации в файлах Azure NetApp. 

> [!IMPORTANT]
> Для рабочих нагрузок SAP HANA низкая задержка имеет решающее значение. Работайте с представителем корпорации Майкрософт, чтобы убедиться, что виртуальные машины и объемы файлов NetApp Azure развертываются в непосредственной близости.  

> [!IMPORTANT]
> При наличии несоответствия между <b>sid</b>идентификатором пользователя `sapsys` для sid adm и идентификатором group ID между виртуальной машиной и конфигурацией `nobody`Azure NetApp разрешения на файлы на объемах Azure NetApp, установленные на виртуальных машинах, будут отображаться как : Убедитесь в том, чтобы указать правильный идентификатор пользователя для <b>sid</b>adm и идентификатор группы для, `sapsys`при [посадке новой системы](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRxjSlHBUxkJBjmARn57skvdUQlJaV0ZBOE1PUkhOVk40WjZZQVJXRzI2RC4u) в Azure NetApp Files.

### <a name="sizing-for-hana-database-on-azure-netapp-files"></a>Размер для базы данных HANA в файлах NetApp Azure

Пропускная часть объема Azure NetApp зависит от размера объема и уровня обслуживания, как это описано на [уровне обслуживания для файлов NetApp Azure.](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels) 

При проектировании инфраструктуры для SAP в Azure необходимо знать некоторые минимальные требования SAP к пропускной способности, которые приводят к минимальным характеристикам пропускной способности:

- Включить чтение/запись на /hana/log 250 МБ/сек с размерами 1 МБ всекунд/О  
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для /hana/data для размеров операций ввода-вывода 16 МБ и 64 МБ.  
- Включите действие записи с пропускной способностью не менее 250 МБ/с для /hana/data для размеров операций ввода-вывода 16 МБ и 64 МБ.  

[Ограничения пропускной промедляя сети Azure NetApp на](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels) 1 TiB квоты объема:
- Премиум уровень хранения - 64 MiB/s  
- Ультрауровень хранения - 128 MiB/s  

> [!IMPORTANT]
> Независимо от емкости, которую вы развертываете на одном томе NFS, пропускная способность, как ожидается, плато в диапазоне 1,2-1,4 ГБ / сек пропускной способности заемных средств потребителей в виртуальной машине. Это связано с базовой архитектурой предложения ANF и связанными с ними ограничениями сеанса Linux вокруг NFS. Показатели производительности и пропускной способности, как описано в статье [Результаты теста на тестовую производительность для Azure NetApp Files,](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-performance-benchmarks) были проведены против одного общего объема NFS с несколькими клиентами VMs и в результате с несколькими сеансами. Этот сценарий отличается от сценария, который мы измеряем в SAP. Где мы измеряем пропускную вылим от одного VM по отношению к объему NFS. размещены на ANF.

Для удовлетворения требований SAP минимальной пропускной способности данных и журнала, и в соответствии с руководящими принципами для `/hana/shared`, рекомендуемые размеры будут выглядеть следующим образом:

| Том | Размер<br /> Премиум уровень хранения | Размер<br /> Ультра уровень хранения | Поддерживаемый протокол NFS |
| --- | --- | --- |
| /hana/log/ | 4 ТиБ | 2 ТиБ | v4.1 |
| hana/data; | 6.3 TiB | 3.2 TiB | v4.1 |
| /hana/shared | Макс (512 ГБ, 1xRAM) на 4 рабочих узлов | Макс (512 ГБ, 1xRAM) на 4 рабочих узлов | v3 или v4.1 |


> [!NOTE]
> Приведенные здесь рекомендации по размеру файлов Сети Azure, ориентированные на соответствие минимальным требованиям, которые SAP выдает своим поставщикам инфраструктуры. В реальных развертываниях клиентов и сценариях рабочей нагрузки этого может быть недостаточно. Используйте эти рекомендации в качестве отправной точки и адаптируйтесь в зависимости от требований вашей конкретной рабочей нагрузки.  

Поэтому можно было бы рассмотреть возможность развертывания аналогичной пропускной связи для томов ANF, перечисленных для уже для хранения дисков Ultra. Также рассмотрим размеры для размеров, перечисленных для томов для различных VM SKUs, как это делается в таблицах ультра диска уже.

> [!TIP]
> Вы можете изменить размер объемов Файлов Azure NetApp `unmount` динамически, без необходимости в объемах, остановить виртуальные машины или остановить SAP HANA. Это позволяет гибко удовлетворять требованиям приложения как ожидаемые, так и непредвиденные требования к пропускной записи.

Документация о том, как развернуть конфигурацию масштаба SAP HANA с резервным узлом с использованием объемов NFS v4.1, размещенных в ANF, публикуется в [масштабе SAP HANA с резервным узлом на Azure VMs с файлами Azure NetApp на сервере SUSE Linux Enterprise Server.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-scale-out-standby-netapp-files-suse)


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в разделе:

- [Руководство SAP HANA по высокой доступности для виртуальных машин Azure.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-availability-overview)
