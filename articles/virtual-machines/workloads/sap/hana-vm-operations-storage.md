---
title: Конфигурации хранилища виртуальных машин SAP HANA в Azure | Документация Майкрософт
description: Требования к хранилищу для виртуальной Машины с SAP HANA, развернутых в них.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 06/05/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d062b6fff9693d5bda75edd65b8fe88d834eff57
ms.sourcegitcommit: 4cdd4b65ddbd3261967cdcd6bc4adf46b4b49b01
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2019
ms.locfileid: "66735516"
---
# <a name="sap-hana-azure-virtual-machine-storage-configurations"></a>Конфигурации хранилища виртуальных машин SAP HANA в Azure

Azure предоставляет различные виды хранения, которые подходят для виртуальных машин Azure, работающих под управлением SAP HANA. Типы хранилища Azure, которые могут считаться для списка развертываний SAP HANA, таких как: 

- Стандартный диск Твердотельные накопители (SSD)
- Твердотельные накопители (SSD) класса Premium
- Ultra SSD в общедоступной предварительной версии и еще не поддерживаются в рабочих приложений SAP

Дополнительные сведения об этих типах диска, см. в статье [выберите тип диска](https://docs.microsoft.com/azure/virtual-machines/linux/disks-types)

Azure предлагает два метода развертывания виртуальных жестких дисков (VHD) в хранилище Azure класса "Стандартный" и хранилище Azure класса Premium. Рекомендуется использовать развертывания [управляемых дисков Azure](https://azure.microsoft.com/services/managed-disks/), если общий сценарий это допускает. 

Список типов хранилища и их соглашения об уровне обслуживания в отношении операций ввода-вывода в секунду (IOPS) и пропускной способности хранилища см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).

**Рекомендация: Использование хранилища Azure уровня "премиум" в сочетании с ускорителем записи Azure и использовать управляемые диски Azure для развертывания**

В локальную среду вы редко нужно было беспокоиться о подсистемах операций ввода-вывода и ее возможностях. Это связано с тем, что поставщику оборудования необходимо было убедиться в том, что для SAP HANA соблюдены минимальные требования к хранению. Как вы создаете инфраструктуру Azure самостоятельно, следует иметь в виду некоторые из этих требований. Некоторые характеристики минимальную пропускную способность, задаваемые приводит к необходимости:

- Включить чтение и запись на **/hana/log** из 250 МБ/с с ввода-вывода размером 1 МБ
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.
- Включите действие записи с пропускной способностью не менее 250 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.

Так как небольшая задержка хранилища для систем СУБД является критической, даже такие системы, как SAP HANA, хранят данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Кроме того, такие операции, как запись точек сохранения или загрузка данных в памяти после восстановления из-за сбоя, могут быть критическими. Таким образом, **обязательные** использовать диски уровня "премиум" Azure для **/hana/data** и **/hana/log** тома. Чтобы добиться минимальной пропускной способности **/hana/log** и **/hana/data** в соответствии с требованиями SAP, создайте RAID 0 с помощью MDADM или LVM на нескольких дисках хранилища Azure класса Premium и используйте тома RAID в качестве томов **/hana/data** и **/hana/log**. 

**Рекомендация: Качестве размеров блоков для RAID 0 рекомендация состоит в использовании:**

- 64 КБ или 128 КБ для **/hana/data**
- 32 KБ для **/hana/log**

> [!NOTE]
> Нет необходимости настраивать уровень избыточности с помощью томов RAID, так как хранилища Azure класса Premium и Standard хранят три образа виртуального жесткого диска. Использование тома RAID предназначено исключительно для настройки томов, которые предоставляют достаточную пропускную способность операций ввода-вывода.

Использование нескольких VHD Azure в RAID влияет на число операций ввода-вывода в секунду и пропускную способность хранилища. Таким образом, если вы добавите в RAID 0 3 диска P30 хранилища Azure класса Premium, число операций ввода-вывода в секунду и пропускная способность увеличатся в три раза, исходя из показателей одного диска P30 хранилища класса Premium.

Приведенные ниже рекомендации по кэшированию даны исходя из следующих характеристик ввода-вывода для SAP HANA:

- Практически отсутствует рабочая нагрузка чтения файлов данных HANA. Исключениями являются большие по размеру операции ввода-вывода после перезапуска экземпляра HANA или когда данные загружаются в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. В этом случае кэширование чтения практически не имеет смысла, поскольку в большинстве случаев все тома файлов данных необходимо считать полностью.
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения выполняется асинхронно и не задерживает выполнение пользовательских транзакций. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Однако восстановление после сбоя происходит только в исключительных ситуациях
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются большие операции ввода-вывода при выполнении резервных копий журналов транзакций, восстановления после сбоя или во время перезапуска экземпляра HANA.  
- Основной нагрузкой на файл журнала повторяемых операций SAP HANA являются операции записи. В зависимости от характера рабочей нагрузки можно иметь операции ввода-вывода размером 4 КБ, тогда как в других случаях размер может превышать 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи необходимо сохранить на диске надежным образом

**Рекомендация: В результате этих шаблонов ввода-вывода, наблюдаемых с помощью SAP HANA необходимо задать кэширование для разных томов с помощью хранилища Azure класса Premium как:**

- **/hana/data** — без кэширования.
- **/hana/log** — без кэширования, за исключением серии M (см. далее в этом документе).
- **/hana/shared** — кэширование чтения.


Кроме того, при выборе виртуальной машины или изменении ее размера учитывайте пропускную способность ввода-вывода. Общие сведения о пропускной способности хранилища виртуальной машины см. в статье [Размеры виртуальных машин, оптимизированных для операций в памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

## <a name="linux-io-scheduler-mode"></a>Режим планировщика операций ввода–вывода для Linux
Linux имеет несколько разных режимов планирования операций ввода-вывода. Поставщики Linux и SAP рекомендуется перенастроить режим планировщика операций ввода-вывода для тома дисков из **cfq** режим **noop** режим. Дополнительные сведения см. в [примечании к SAP № 1984798](https://launchpad.support.sap.com/#/notes/1984787). 


## <a name="production-storage-solution-with-azure-write-accelerator-for-azure-m-series-virtual-machines"></a>Производственное решение хранилища с ускорителем записи Azure для виртуальных машин Azure серии M
Ускоритель записи Azure — это функция, которая предназначена исключительно для виртуальных машин Azure серии M. Как очевидно из названия, целью функции является уменьшение задержки операций ввода-вывода записей в хранилище Azure класса Premium. В SAP HANA ускоритель записи нужно использовать только для тома **/hana/log**. Таким образом **/hana/data** и **/hana/log** отдельных томов с поддержкой ускорителя записи Azure **/hana/log** только том. 

> [!IMPORTANT]
> Сертификация SAP HANA для виртуальных машин Azure серии M предоставлена исключительно для конфигурации, где ускоритель записи Azure используется только для тома **/hana/log**. В результате ожидается, что в развертываниях производственного сценария SAP HANA на виртуальных машинах Azure серии M ускоритель записи Azure будет настроен для тома **/hana/log**.  

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

**Рекомендация: Рекомендуемые конфигурации для рабочих сценариев выглядеть следующим образом:**

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | hana/log; | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 4 x P20 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 |2 x P30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 3 x P30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 2 x P40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P40 |
| M208s_v2 | 2850 Гиб | 1000 МБ/с | 4 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P40 |
| M208ms_v2 | 5700 Гиб | 1000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416s_v2 | 5700 Гиб | 2000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416ms_v2 | 11400 Гиб | 2000 МБ/с | 8 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P50 |

Типы виртуальных Машин M416xx_v2 не еще доступны корпорацией Майкрософт общедоступным. Проверьте, соответствует ли пропускная способность хранилища для разных предлагаемых томов рабочей нагрузки, которую вы хотите запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с большим количеством VHD, чем перечисленные увеличение операций ввода-ВЫВОДА и пропускной способности ввода-вывода в пределах ограничений типа виртуальной машины Azure.

Ускоритель записи Azure работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Поэтому в качестве управляемых дисков необходимо развернуть по крайней мере диски хранилища Azure класса Premium, формирующие том **/hana/log**.

Есть ограничения на число виртуальных жестких дисков хранилища Azure класса Premium для каждой виртуальной машины, которые могут поддерживаться ускорителем записи Azure. Сейчас действуют такие ограничения:

- 16 виртуальных жестких дисков для виртуальной Машины M128xx и M416xx
- 8 виртуальных жестких дисков для виртуальной Машины M64xx и M208xx
- 4 виртуальных жестких диска для виртуальной машины серии M32xx.

Подробные инструкции по включению ускорителя записи Azure см. в статье [Write Accelerator](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) (Ускоритель записи).

Подробные сведения и ограничения для ускорителя записи Azure можно найти в той же статье.

**Рекомендация: Необходимо использовать ускоритель записи для дисков, формирующие том/hana/log**


## <a name="cost-conscious-azure-storage-configuration"></a>Стоимость конфигурации хранилища Azure
В следующей таблице показана конфигурация типов виртуальных Машин, которые клиенты также используют для размещения SAP HANA на виртуальных машинах Azure. Возможно, некоторые типы виртуальных Машин, которые могут не удовлетворять всем критериям минимальный объем хранилища для SAP HANA или официально не поддерживаются с помощью SAP HANA в SAP. Но пока эти виртуальные машины отлично работали в нерабочих средах. **/Hana/data** и **/hana/log** объединяются в один том. В результате использования ускорителя записи Azure может стать ограничением с точки зрения операций ввода-ВЫВОДА.

> [!NOTE]
> Для сценариев, поддерживаемых SAP, проверьте, поддерживается ли определенного типа виртуальной Машины для SAP HANA, SAP в [документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html).

> [!NOTE]
> Изменение с бывшей рекомендации сознательное решение затрат, используются для перемещения с [диски Azure Standard HDD](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd) на более мощных и надежнее [дисков SSD Standard для Azure](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd)


| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических томов или MDADM | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E16v3 | 128 ГБ | 384 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E32v3 | 256 Гиб | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| E64v3 | 432 ГиБ | 1200 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| GS5 | 448 ГиБ | 2000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 |1 x E30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 2 x P30 | 1 x E30 | 1 x E6 | 1 x E6 |2 x E30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 1 x E30 | 1 x E6 | 1 x E6 | 3 x E30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E50 |
| M208s_v2 | 2850 Гиб | 1000 МБ/с | 4 x P30 | 1 x E30 | 1 x E10 | 1 x E6 |  3 x E40 |
| M208ms_v2 | 5700 Гиб | 1000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416s_v2 | 5700 Гиб | 2000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416ms_v2 | 11400 Гиб | 2000 МБ/с | 8 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E50 |


Типы виртуальных Машин M416xx_v2 не еще доступны корпорацией Майкрософт общедоступным. Диски 3 x P20, рекомендуемые для типов виртуальных машин меньшего размера, превышают размер томов согласно рекомендациям относительно дискового пространства, указанным в [техническом документе для хранилища SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Тем не менее этот вариант, как показано в таблице, был выбран, чтобы обеспечить необходимую пропускную способность диска для SAP HANA. При необходимости вы можете изменить размер тома **/hana/backup**, подобранный для хранения резервных копий, которые в два раза превышают объем памяти тома.   
Проверьте, соответствует ли пропускная способность хранилища для разных предлагаемых томов рабочей нагрузки, которую вы хотите запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с большим количеством VHD, чем перечисленные увеличение операций ввода-ВЫВОДА и пропускной способности ввода-вывода в пределах ограничений типа виртуальной машины Azure. 

> [!NOTE]
> В приведенных выше конфигурациях было бы невыгодно использовать [соглашение об уровне обслуживания для отдельной виртуальной машины Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_6/), так как оно использует хранилища класса Standard и Premium одновременно. Однако выбор был сделан для оптимизации затрат. Необходимо выбрать хранилище класса Premium для всех дисков, для которых указано хранилище Azure класса Standard (Sxx), чтобы сделать конфигурацию виртуальной машины совместимой с соглашением об уровне обслуживания для отдельной виртуальной машины.


> [!NOTE]
> Приведенные рекомендации по конфигурации диска нацелены на минимальные требования, которые SAP выражает в отношении своих поставщиков инфраструктуры. В реальных сценариях развертывания и рабочей нагрузки клиентов возникали ситуации, когда эти рекомендации по-прежнему не обеспечивали достаточно возможностей. Это могут быть ситуации, когда клиенту нужна более быстрая перезагрузка данных после перезапуска HANA или когда для конфигураций резервного копирования требуется более высокая пропускная способность в хранилище. Другие случаи включали **/hana/log**, в которых 5000 операций ввода-вывода в секунду было недостаточно для конкретной рабочей нагрузки. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйте в соответствии с требованиями своей рабочей нагрузки.
>  

## <a name="azure-ultra-ssd-storage-configuration-for-sap-hana"></a>Конфигурация хранилища Azure Ultra SSD для SAP HANA
Microsoft находится в процессе введение нового типа хранилища Azure называется [Azure Ultra SSD](https://azure.microsoft.com/updates/ultra-ssd-new-azure-managed-disks-offering-for-your-most-latency-sensitive-workloads/). Разница между хранилища Azure, предлагаемые в данный момент и Ultra SSD является то, что возможности дисков не привязаны к размер диска больше. Клиент может определить эти возможности для Ultra твердотельного Накопителя:

- Размер диска от 4 Гиб до 65 536 Гиб
- Операций ввода-ВЫВОДА в диапазоне от 100 операций ввода-ВЫВОДА до 160 КБ операций ввода-ВЫВОДА (максимум зависит от типов виртуальных Машин, а также)
- Пропускная способность хранилища от 300 МБ в секунду 2000 МБ в секунду

Подробности см. статью [объявляет о Ultra SSD — следующее поколение технологии диски Azure (Предварительная версия)](https://azure.microsoft.com/blog/announcing-ultra-ssd-the-next-generation-of-azure-disks-technology-preview/)

Режимом UltraSSD дает возможность определения одного диска, соответствующий вашей объема операций ввода-ВЫВОДА и диапазон пропускной способности диска. Вместо того чтобы использовать диспетчеры логического тома, такие как диспетчер логических ТОМОВ или MDADM, на основе хранилища класса Premium для создания тома, отвечающие требованиям пропускную способность операций ввода-ВЫВОДА и хранения. Набор конфигурации можно запустить между режимом UltraSSD и "премиум". Таким образом можно ограничить использование режимом UltraSSD производительность важных/hana/Data и тома/hana/log и рассматриваются другие тома с хранилищем Azure Premium

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | данные тома/hana / | пропускная способность ввода-вывода данных/hana / | / hana/data операций ввода-ВЫВОДА | / hana/log тома | пропускной способности/hana/log ввода-вывода | / hana/log операций ввода-ВЫВОДА |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ/с | 250 ГБ | 500 Мбит/с | 7500 | 256 ГБ | 500 Мбит/с  | 2000 |
| M32ls | 256 Гиб | 500 МБ/с | 300 ГБ | 500 Мбит/с | 7500 | 256 ГБ | 500 Мбит/с  | 2000 |
| M64ls | 512 ГБ | 1000 МБ/с | 600 ГБ | 500 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M64s | 1000 ГиБ | 1 000 МБ в секунду. |  1200 ГБ | 500 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M64ms | 1750 Гиб | 1 000 МБ в секунду. | 2100 ГБ | 500 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M128s | 2000 ГиБ | 2 000 МБ в секунду. |2400 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 2000 | 
| M128ms | 3800 Гиб | 2 000 МБ в секунду. | 4800 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 2000 | 
| M208s_v2 | 2850 Гиб | 1 000 МБ в секунду. | 3500 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 500 Мбит/с  | 2000 | 
| M208ms_v2 | 5700 Гиб | 1 000 МБ в секунду. | 7200 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 500 Мбит/с  | 2000 | 
| M416s_v2 | 5700 Гиб | 2 000 МБ в секунду. | 7200 ГБ | Бит/с 1500 МБ | 9000 | 512 ГБ | 800 Мбит/с  | 2000 | 
| M416ms_v2 | 11400 Гиб | 2 000 МБ в секунду. | 14400 ГБ | 1500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 2000 |   

Типы виртуальных Машин M416xx_v2 не еще доступны корпорацией Майкрософт общедоступным. Значения, перечисленные предназначены в качестве отправной точки и должны вычисляться реальные потребности. С помощью Azure Ultra SSD удобен тем, что значения операций ввода-ВЫВОДА и пропускную способность можно адаптировать без необходимости завершать работу виртуальной Машины или остановка рабочей нагрузки применяются к системе.   

> [!NOTE]
> На данный момент моментальных снимков хранилища с хранилищем режимом UltraSSD не поддерживается. Это блокирует использования моментальных снимков виртуальной Машины с помощью службы Azure Backup

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения можно найти в разделе

- [Руководство по высокой доступности SAP HANA для виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-availability-overview).