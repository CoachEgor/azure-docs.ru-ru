---
title: SAP HANA конфигураций хранилища виртуальных машин Azure | Документация Майкрософт
description: Рекомендации по хранению для виртуальной машины, в которой развернут SAP HANA.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 03/10/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: c4e8b544ea3daeb23b22f3864beb21ba9d3f342f
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81255623"
---
# <a name="sap-hana-azure-virtual-machine-storage-configurations"></a>Конфигурации хранилища виртуальных машин SAP HANA в Azure

Azure предоставляет различные типы хранилища, которые подходят для виртуальных машин Azure, на которых выполняется SAP HANA. **SAP HANA сертифицированные типы хранилища Azure** , которые можно рассматривать для SAP HANAных развертываний, например: 

- SSD (цен. категория "Премиум") Azure  
- [Диск (цен. категория "Ультра")](https://docs.microsoft.com/azure/virtual-machines/linux/disks-enable-ultra-ssd)
- [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) 

Дополнительные сведения об этих типах дисков см. в статье [Выбор типа диска](https://docs.microsoft.com/azure/virtual-machines/linux/disks-types) .

Azure предлагает два метода развертывания виртуальных жестких дисков (VHD) в хранилище Azure класса "Стандартный" и хранилище Azure класса Premium. Рекомендуется использовать развертывания [управляемых дисков Azure](https://azure.microsoft.com/services/managed-disks/), если общий сценарий это допускает. 

Список типов хранилища и их соглашения об уровне обслуживания в отношении операций ввода-вывода в секунду (IOPS) и пропускной способности хранилища см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).

> [!IMPORTANT]
> Независимо от выбранного типа хранилища Azure, файловая система, используемая в этом хранилище, должна поддерживаться SAP для конкретной операционной системы и СУБД. [Примечание о поддержке SAP #405827](https://launchpad.support.sap.com/#/notes/405827) список поддерживаемых файловых систем для различных операционных систем и баз данных, включая SAP HANA. Это относится ко всем томам, SAP HANA могут получать доступ для чтения и записи для любой задачи. В частности, с помощью NFS в Azure для SAP HANA дополнительные ограничения версий NFS применяются, как указано далее в этой статье. 


Минимальные SAP HANA сертифицированные условия для разных типов хранилищ: 

- Azure SSD (цен. категория "Премиум")-/Hana/log необходимо кэшировать с помощью [ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator)Azure. Том/Hana/Data можно разместить на SSD (цен. категория "Премиум") без Ускоритель записи Azure или на Ultra Disk.
- Azure Ultra Disk по крайней мере для тома/Hana/log. Том/Hana/Data может быть размещен либо SSD (цен. категория "Премиум") без Azure Ускоритель записи, либо для ускорения перезапуска с помощью Ultra Disk.
- Тома **NFS версии 4.1** поверх Azure NetApp Files для/Hana/log **и** /хана/Дата. Объем/Hana/Shared может использовать протокол NFS v3 или NFS v 4.1. Протокол NFS версии 4.1 является обязательным для томов/Hana/Data и Hana/log.

Некоторые типы хранилищ можно объединять. Например, можно поместить/Hana/Data в хранилище уровня "Премиум", а/Hana/log — на хранилище Ultra Disk, чтобы получить необходимую низкую задержку. Однако если вы используете том NFS версии 4.1 на основе использовании для/Hana/Data, вам потребуется использовать другой том NFS версии 4.1 на основе использовании для/Hana/log. Использование NFS поверх использовании для одного из томов (например,/Hana/Data) и хранилища Azure класса Premium или Ultra Disk для другого тома (например,/Hana/log) **не поддерживается**.

В локальной среде вам редко приходится заботиться о подсистемах ввода-вывода и ее возможностях. Это связано с тем, что поставщику оборудования необходимо было убедиться в том, что для SAP HANA соблюдены минимальные требования к хранению. По мере того как вы самостоятельно создаете инфраструктуру Azure, вам следует знать о некоторых из этих требований, выданных SAP. Некоторые минимальные характеристики пропускной способности, необходимые для SAP, приводят к необходимости:

- Включить чтение и запись в **/Hana/log** из 250 МБ/с с размером операций ввода-вывода в 1 МБ
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.
- Включите действие записи с пропускной способностью не менее 250 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.

Так как небольшая задержка хранилища для систем СУБД является критической, даже такие системы, как SAP HANA, хранят данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Кроме того, такие операции, как запись точек сохранения или загрузка данных в памяти после восстановления из-за сбоя, могут быть критическими. Поэтому **обязательно** используйте диски Azure уровня "Премиум" для томов **/Hana/Data** и **/Hana/log** . Чтобы добиться минимальной пропускной способности **/hana/log** и **/hana/data** в соответствии с требованиями SAP, создайте RAID 0 с помощью MDADM или LVM на нескольких дисках хранилища Azure класса Premium и используйте тома RAID в качестве томов **/hana/data** и **/hana/log**. 

**Рекомендация: в качестве размеров чередования для RAID 0 рекомендуется использовать:**

- 256 КБ для **/Hana/Data**
- 32 KБ для **/hana/log**

> [!IMPORTANT]
> Размер блока чередования для/Hana/Data был изменен с предыдущих рекомендаций для 64 КБ или 128 КБ до 256 КБ на основе пользовательских интерфейсов с более поздними версиями Linux. Размер 256 КБ обеспечивает немного более высокую производительность

> [!NOTE]
> Нет необходимости настраивать уровень избыточности с помощью томов RAID, так как хранилища Azure класса Premium и Standard хранят три образа виртуального жесткого диска. Использование тома RAID предназначено исключительно для настройки томов, которые предоставляют достаточную пропускную способность операций ввода-вывода.

Использование нескольких VHD Azure в RAID влияет на число операций ввода-вывода в секунду и пропускную способность хранилища. Таким образом, если вы добавите в RAID 0 3 диска P30 хранилища Azure класса Premium, число операций ввода-вывода в секунду и пропускная способность увеличатся в три раза, исходя из показателей одного диска P30 хранилища класса Premium.

Кроме того, при выборе виртуальной машины или изменении ее размера учитывайте пропускную способность ввода-вывода. Общие сведения о пропускной способности хранилища виртуальной машины см. в статье [Размеры виртуальных машин, оптимизированных для операций в памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

## <a name="linux-io-scheduler-mode"></a>Режим планировщика операций ввода–вывода для Linux
Linux имеет несколько разных режимов планирования операций ввода-вывода. Распространенная рекомендация по поставщикам Linux и SAP заключается в перенастройке режима планировщика ввода-вывода для томов дисков из режима **MQ-крайни** или **кибер** в режим **"не в нескольких** очередях" или " **нет** " для режима (многоочередь). Дополнительные сведения содержатся в [примечании SAP #1984787](https://launchpad.support.sap.com/#/notes/1984787). 


## <a name="solutions-with-premium-storage-and-azure-write-accelerator-for-azure-m-series-virtual-machines"></a>Решения с хранилищем класса Premium и Ускоритель записи Azure для виртуальных машин Azure серии M
Azure Ускоритель записи — это функция, которая доступна только для виртуальных машин Azure серии M. Как очевидно из названия, целью функции является уменьшение задержки операций ввода-вывода записей в хранилище Azure класса Premium. В SAP HANA ускоритель записи нужно использовать только для тома **/hana/log**. Таким образом, **/Hana/Data** и **/Hana/log** — это отдельные тома с ускоритель записи Azure, поддерживающими только том **/Hana/log** . 

> [!IMPORTANT]
> При использовании хранилища Azure класса Premium использование [ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) Azure или тома/Hana/log обязательно. Ускоритель записи доступен только для виртуальных машин хранилища класса Premium и серии M и Mv2.

Приведенные ниже рекомендации по кэшированию даны исходя из следующих характеристик ввода-вывода для SAP HANA:

- Практически отсутствует рабочая нагрузка чтения файлов данных HANA. Исключениями являются большие по размеру операции ввода-вывода после перезапуска экземпляра HANA или когда данные загружаются в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. В этом случае кэширование чтения практически не имеет смысла, поскольку в большинстве случаев все тома файлов данных необходимо считать полностью.
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения выполняется асинхронно и не задерживает выполнение пользовательских транзакций. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Однако восстановление после сбоя происходит только в исключительных ситуациях
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются большие операции ввода-вывода при выполнении резервных копий журналов транзакций, восстановления после сбоя или во время перезапуска экземпляра HANA.  
- Основной нагрузкой на файл журнала повторяемых операций SAP HANA являются операции записи. В зависимости от характера рабочей нагрузки можно иметь операции ввода-вывода размером 4 КБ, тогда как в других случаях размер может превышать 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи необходимо сохранить на диске надежным образом

**Рекомендация. в результате этих наблюдаемых шаблонов ввода-вывода SAP HANA, кэширование для различных томов с использованием хранилища Azure класса Premium должно быть установлено следующим образом:**

- **/hana/data** — без кэширования.
- **/Hana/log** -без кэширования — исключение для ряда M и Mv2, где ускоритель записи должны быть включены без кэширования чтения. 
- **/hana/shared** — кэширование чтения.

### <a name="production-recommended-storage-solution"></a>Рекомендуемое решение для хранения данных в рабочей среде

> [!IMPORTANT]
> Сертификация SAP HANA для виртуальных машин Azure серии M предоставлена исключительно для конфигурации, где ускоритель записи Azure используется только для тома **/hana/log**. В результате ожидается, что в развертываниях производственного сценария SAP HANA на виртуальных машинах Azure серии M ускоритель записи Azure будет настроен для тома **/hana/log**.  

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

Рекомендации часто превышают требования SAP к минимальным требованиям, как упоминалось ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размерам SAP и максимальной пропускной способностью хранилища, предоставляемыми различными типами виртуальных машин.

**Рекомендация. Рекомендуемые конфигурации для рабочих сценариев выглядят следующим образом:**

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | hana/log; | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 4 x P20 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 |2 x P30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 3 x P30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 2 x P40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P40 |
| M208s_v2 | 2850 гиб | 1000 МБ/с | 4 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P40 |
| M208ms_v2 | 5700 гиб | 1000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416s_v2 | 5700 гиб | 2000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416ms_v2 | 11400 гиб | 2000 МБ/с | 8 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P50 |

Проверьте, соответствует ли пропускная способность хранилища для различных рекомендуемых томов рабочей нагрузке, которую необходимо запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с большим количеством виртуальных жестких дисков, чем указано, увеличивает количество операций ввода-вывода и пропускную способность для типа виртуальной машины Azure.

Ускоритель записи Azure работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Поэтому в качестве управляемых дисков необходимо развернуть по крайней мере диски хранилища Azure класса Premium, формирующие том **/hana/log**.

Есть ограничения на число виртуальных жестких дисков хранилища Azure класса Premium для каждой виртуальной машины, которые могут поддерживаться ускорителем записи Azure. Сейчас действуют такие ограничения:

- 16 виртуальных жестких дисков для виртуальной машины M128xx и M416xx
- 8 виртуальных жестких дисков для виртуальной машины M64xx и M208xx
- 4 виртуальных жестких диска для виртуальной машины серии M32xx.

Подробные инструкции по включению ускорителя записи Azure см. в статье [Write Accelerator](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) (Ускоритель записи).

Подробные сведения и ограничения для ускорителя записи Azure можно найти в той же статье.

**Рекомендация. необходимо использовать Ускоритель записи для дисков, формирующих том/Hana/log**


### <a name="cost-conscious-azure-storage-configuration"></a>Стоимость конфигурации хранилища Azure
В следующей таблице показана конфигурация типов виртуальных машин, которые клиенты также используют для размещения SAP HANA на виртуальных машинах Azure. Могут существовать некоторые типы виртуальных машин, которые могут не соответствовать всем минимальным критериям хранения для SAP HANA или официально не поддерживались SAP HANA SAP. Но пока эти виртуальные машины отлично работали в нерабочих средах. **/Hana/Data** и **/Hana/log** объединены в один том. В результате использование Ускоритель записи Azure может стать ограничением в отношении операций ввода-вывода в секунду.

> [!NOTE]
> Для сценариев, поддерживаемых SAP, проверьте, поддерживается ли для SAP HANA SAP в [документации SAP для IaaS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html)конкретный тип виртуальной машины.

> [!NOTE]
> Изменение предыдущих рекомендаций для решения, представляющего стоимость, заключается в переходе с [дисков azure HDD (цен. Категория "Стандартный")](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd) на более эффективные и надежные [диски SSD (цен. Категория "Стандартный") Azure](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd) .

Рекомендации часто превышают требования SAP к минимальным требованиям, как упоминалось ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размерам SAP и максимальной пропускной способностью хранилища, предоставляемыми различными типами виртуальных машин.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических томов или MDADM | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E16v3 | 128 ГБ | 384 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E32v3 | 256 Гиб | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| E64v3 | 432 ГиБ | 1 200 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| GS5 | 448 ГиБ | 2 000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M64ls | 512 ГБ | 1 000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 |1 x E30 |
| M64s | 1 000 гиб | 1 000 МБ/с | 2 x P30 | 1 x E30 | 1 x E6 | 1 x E6 |2 x E30 |
| M64ms | 1 750 гиб | 1 000 МБ/с | 3 x P30 | 1 x E30 | 1 x E6 | 1 x E6 | 3 x E30 |
| M128s | 2 000 гиб | 2 000 МБ/с |3 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E40 |
| M128ms | 3 800 гиб | 2 000 МБ/с | 5 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E50 |
| M208s_v2 | 2 850 гиб | 1 000 МБ/с | 4 x P30 | 1 x E30 | 1 x E10 | 1 x E6 |  3 x E40 |
| M208ms_v2 | 5 700 гиб | 1 000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416s_v2 | 5 700 гиб | 2 000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416ms_v2 | 11400 гиб | 2 000 МБ/с | 8 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E50 |


Диски 3 x P20, рекомендуемые для типов виртуальных машин меньшего размера, превышают размер томов согласно рекомендациям относительно дискового пространства, указанным в [техническом документе для хранилища SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Тем не менее этот вариант, как показано в таблице, был выбран, чтобы обеспечить необходимую пропускную способность диска для SAP HANA. Если вам нужны изменения в томе **/Hana/Backup** , размер которого был таким, чтобы хранить резервные копии, представляющие вдвое больше объема памяти, можно настроить.   
Проверьте, соответствует ли пропускная способность хранилища для различных рекомендуемых томов рабочей нагрузке, которую необходимо запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с большим количеством виртуальных жестких дисков, чем указано, увеличивает количество операций ввода-вывода и пропускную способность для типа виртуальной машины Azure. 

> [!NOTE]
> В приведенных выше конфигурациях было бы невыгодно использовать [соглашение об уровне обслуживания для отдельной виртуальной машины Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_6/), так как оно использует хранилища класса Standard и Premium одновременно. Однако выбор был сделан для оптимизации затрат. Необходимо выбрать хранилище класса Premium для всех дисков, для которых указано хранилище Azure класса Standard (Sxx), чтобы сделать конфигурацию виртуальной машины совместимой с соглашением об уровне обслуживания для отдельной виртуальной машины.


> [!NOTE]
> Приведенные рекомендации по конфигурации диска нацелены на минимальные требования, которые SAP выражает в отношении своих поставщиков инфраструктуры. В реальных сценариях развертывания и рабочей нагрузки клиентов возникали ситуации, когда эти рекомендации по-прежнему не обеспечивали достаточно возможностей. Это могут быть ситуации, когда клиенту нужна более быстрая перезагрузка данных после перезапуска HANA или когда для конфигураций резервного копирования требуется более высокая пропускная способность в хранилище. Другие случаи включали **/hana/log**, в которых 5000 операций ввода-вывода в секунду было недостаточно для конкретной рабочей нагрузки. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйте в соответствии с требованиями своей рабочей нагрузки.
>  

## <a name="azure-ultra-disk-storage-configuration-for-sap-hana"></a>Конфигурация хранилища Azure "Ultra Disk" для SAP HANA
Корпорация Майкрософт находится в процессе развертывания нового типа хранилища Azure с именем " [Ultra Disk" Azure](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#ultra-disk). Значительная разница между хранилищем Azure, предлагаемой до сих пор, заключается в том, что возможности диска больше не привязаны к размеру диска. Как клиент вы можете определить эти возможности для Ultra Disk:

- Размер диска в диапазоне от 4 гиб до 65 536 гиб
- Число операций ввода-вывода в секунду в диапазоне от 100 до 160K операций ввода/вывода (максимум зависит от типов виртуальных машин)
- Пропускная способность хранилища от 300 МБ/с до 2 000 МБ/с

С помощью Ultra Disk можно определить один диск, выполняющий размер, число операций ввода-вывода и пропускную способность диска. Вместо использования диспетчеров логических томов, таких как LVM или MDADM, поверх хранилища Azure класса Premium, создайте тома, выполняющие требования к операциям ввода-вывода и пропускной способности хранилища. Вы можете запустить набор конфигурации между Ultra Disk и хранилищем класса Premium. В результате можно ограничить использование Ultra Disk критически важными для производительности/Hana/Data и/Hana/log томами и охватить другие тома с хранилищем Azure класса Premium.

Другими преимуществами использования Ultra Disk может быть лучшая задержка чтения при сравнении с хранилищем класса Premium. Более быстрая задержка чтения может иметь преимущества при необходимости сократить время запуска HANA и последующую загрузку данных в память. Преимущества использования чрезвычайного дискового пространства также могут быть фломастерами, когда HANA записывает точки сохранения. Так как диски хранилища класса Premium для/Hana/Data обычно не Ускоритель записи кэшируются, задержка записи в хранилище уровня "Премиум" по сравнению с Ultra Disk больше. Это может быть ожидаемым, что запись точки сохранения с помощью Ultra Disk работает лучше на Ultra Disk.

> [!IMPORTANT]
> Ultra Disk пока отсутствует во всех регионах Azure и пока не поддерживает все типы виртуальных машин, перечисленные ниже. Дополнительные сведения о том, [какие типы дисков доступны в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#ultra-disk), и о поддерживаемых СЕМЕЙСТВАХ виртуальных машин см. в статье.

### <a name="production-recommended-storage-solution-with-pure-ultra-disk-configuration"></a>Рекомендуемое решение для хранения данных в рабочей среде с чистой конфигурацией Ultra Disk
В этой конфигурации тома/Hana/Data и/Hana/log хранятся отдельно. Предлагаемые значения являются производными от ключевых показателей эффективности, которые должны сертифицироваться SAP для SAP HANA и конфигураций хранилища, как рекомендуется в [техническом документе по хранилищу TDI SAP](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html).

Рекомендации часто превышают требования SAP к минимальным требованиям, как упоминалось ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размерам SAP и максимальной пропускной способностью хранилища, предоставляемыми различными типами виртуальных машин.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | том/Hana/Data | пропускная способность ввода-вывода/Hana/Data | /Hana/Data операций ввода-вывода | том/Hana/log | пропускная способность ввода-вывода/Hana/log | /Hana/log операций ввода-вывода |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| E64s_v3 | 432 ГиБ | 1 200 МБ/с | 600 ГБ | 700 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2 000 |
| M32ts | 192 ГиБ | 500 МБ/с | 250 ГБ | 400 Мбит/с | 7500 | 256 ГБ | 250 Мбит/с  | 2 000 |
| M32ls | 256 Гиб | 500 МБ/с | 300 ГБ | 400 Мбит/с | 7500 | 256 ГБ | 250 Мбит/с  | 2 000 |
| M64ls | 512 ГБ | 1 000 МБ/с | 600 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M64s | 1 000 гиб | 1 000 МБ/с |  1 200 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M64ms | 1 750 гиб | 1 000 МБ/с | 2 100 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M128s | 2 000 гиб | 2 000 МБ/с |2 400 ГБ | 1 200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M128ms | 3 800 гиб | 2 000 МБ/с | 4 800 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M208s_v2 | 2 850 гиб | 1 000 МБ/с | 3 500 ГБ | 1 000 Мбит/с | 9000 | 512 ГБ | 400 Мбит/с  | 2500 | 
| M208ms_v2 | 5 700 гиб | 1 000 МБ/с | 7 200 ГБ | 1 000 Мбит/с | 9000 | 512 ГБ | 400 Мбит/с  | 2500 | 
| M416s_v2 | 5 700 гиб | 2 000 МБ/с | 7 200 ГБ | 1 500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M416ms_v2 | 11 400 гиб | 2 000 МБ/с | 14 400 ГБ | 1 500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 3000 |   

Перечисленные значения предназначены для отправной точки и должны оцениваться по реальным потребностям. Преимуществом Azure Ultra Disk является то, что значения операций ввода-вывода и пропускной способности могут быть адаптированы без необходимости завершать работу виртуальной машины или останавливать рабочую нагрузку, примененную к системе.   

> [!NOTE]
> До сих пор моментальные снимки хранилища с хранилищем Ultra Disk недоступны. Это блокирует использование моментальных снимков виртуальных машин с Azure Backup Services

### <a name="cost-conscious-storage-solution-with-pure-ultra-disk-configuration"></a>Экономичное решение для хранения данных с чистой конфигурацией Ultra Disk
В этой конфигурации тома/Hana/Data и/Hana/log находятся на одном диске. Предлагаемые значения являются производными от ключевых показателей эффективности, которые должны сертифицироваться SAP для SAP HANA и конфигураций хранилища, как рекомендуется в [техническом документе по хранилищу TDI SAP](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). 

Рекомендации часто превышают требования SAP к минимальным требованиям, как упоминалось ранее в этой статье. Перечисленные рекомендации являются компромиссом между рекомендациями по размерам SAP и максимальной пропускной способностью хранилища, предоставляемыми различными типами виртуальных машин.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | Том для/Hana/Data и/log | /Hana/Data и пропускная способность ввода-вывода журнала | /Hana/Data и журнал операций ввода-вывода |
| --- | --- | --- | --- | --- | --- |
| E64s_v3 | 432 ГиБ | 1 200 МБ/с | 1 200 ГБ | 1 200 Мбит/с | 9 500 | 
| M32ts | 192 ГиБ | 500 МБ/с | 512 ГБ | 400 Мбит/с | 9 500 | 
| M32ls | 256 Гиб | 500 МБ/с | 600 ГБ | 400 Мбит/с | 9 500 | 
| M64ls | 512 ГБ | 1 000 МБ/с | 1 100 ГБ | 900 Мбит/с | 10 000 | 
| M64s | 1 000 гиб | 1 000 МБ/с |  1 700 ГБ | 900 Мбит/с | 10 000 | 
| M64ms | 1 750 гиб | 1 000 МБ/с | 2 600 ГБ | 900 Мбит/с | 10 000 | 
| M128s | 2 000 гиб | 2 000 МБ/с |2 900 ГБ | 1 800 Мбит/с |12 000 | 
| M128ms | 3 800 гиб | 2 000 МБ/с | 5 300 ГБ | 1 800 Мбит/с |12 000 |  
| M208s_v2 | 2 850 гиб | 1 000 МБ/с | 4 000 ГБ | 900 Мбит/с | 10 000 |  
| M208ms_v2 | 5 700 гиб | 1 000 МБ/с | 7 700 ГБ | 900 Мбит/с | 10 000 | 
| M416s_v2 | 5 700 гиб | 2 000 МБ/с | 7 700 ГБ | 1, 800MBps | 12 000 |  
| M416ms_v2 | 11 400 гиб | 2 000 МБ/с | 15 000 ГБ | 1 800 Мбит/с | 12 000 |    

Перечисленные значения предназначены для отправной точки и должны оцениваться по реальным потребностям. Преимуществом Azure Ultra Disk является то, что значения операций ввода-вывода и пропускной способности могут быть адаптированы без необходимости завершать работу виртуальной машины или останавливать рабочую нагрузку, примененную к системе.  

## <a name="nfs-v41-volumes-on-azure-netapp-files"></a>Тома NFS версии 4.1 на Azure NetApp Files
Azure NetApp Files предоставляет собственные общие папки NFS, которые можно использовать для томов/Hana/Shared,/Hana/Data и/Hana/log. Использование общих ресурсов NFS на основе использовании для томов/Hana/Data и/Hana/log требует использования протокола NFS версии 4.1. Протокол NFS v3 не поддерживается для использования томов/Hana/Data и/Hana/log при создании общих папок на использовании. 

> [!IMPORTANT]
> Протокол NFS v3, реализованный в Azure NetApp Files, **не** поддерживается для/Hana/Data и/Hana/log. Использование NFS 4,1 является обязательным для томов/Hana/Data и/Hana/log из функциональной точки зрения. В то время как для тома/Hana/Shared протокол NFS v3 или NFS версии 4.1 можно использовать из функциональной точки зрения.

### <a name="important-considerations"></a>Важные сведения
При рассмотрении Azure NetApp Files для SAP NetWeaver и SAP HANA учитывайте следующие важные моменты.

- Пул минимальных мощностей — 4 тиб.  
- Минимальный размер тома — 100 гиб
- Azure NetApp Files и все виртуальные машины, где Azure NetApp Files тома будут подключены, должны находиться в одной виртуальной сети Azure или в [одноранговой виртуальной сети](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) в том же регионе.  
- Выбранная виртуальная сеть должна иметь подсеть, делегированную Azure NetApp Files.
- Пропускная способность тома NetApp для Azure является функцией квоты тома и уровня обслуживания, как описано в статье [об уровне обслуживания для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels). При определении размера томов HANA Azure NetApp убедитесь, что полученная пропускная способность соответствует требованиям к системе HANA.  
- Azure NetApp Files предлагает [политику экспорта](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-configure-export-policy). Вы можете управлять разрешенными клиентами, типом доступа (чтение&запись, доступ только для чтения и т. д.). 
- Azure NetApp Filesная функция еще не поддерживает зоны. В настоящее время Azure NetApp Files функция не развернута во всех зонах доступности в регионе Azure. Учитывайте возможные последствия задержки в некоторых регионах Azure.  
- Важно, чтобы виртуальные машины были развернуты в близком расположении к хранилищу NetApp для Azure с низкой задержкой. 
- Идентификатор пользователя для <b>SID</b>ADM и идентификатор группы для `sapsys` виртуальных машин должны соответствовать конфигурации в Azure NetApp Files. 

> [!IMPORTANT]
> Для SAP HANA рабочих нагрузок низкая задержка очень важна. Поработайте с представителями корпорации Майкрософт, чтобы убедиться, что виртуальные машины и Azure NetApp Filesные тома развернуты в близком близком отношении.  

> [!IMPORTANT]
> Если существует несоответствие между ИДЕНТИФИКАТОРом пользователя <b>SID</b>ADM и идентификатором группы `sapsys` между виртуальной машиной и конфигурацией Azure NetApp, то разрешения для файлов на томах NetApp в Azure, подключенных к виртуальным машинам, будут отображаться как `nobody`. Не забудьте указать правильный идентификатор пользователя для <b>SID</b>ADM и идентификатор группы для `sapsys`, когда подключается [Новая система](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRxjSlHBUxkJBjmARn57skvdUQlJaV0ZBOE1PUkhOVk40WjZZQVJXRzI2RC4u) для Azure NetApp Files.

### <a name="sizing-for-hana-database-on-azure-netapp-files"></a>Изменение размера базы данных HANA на Azure NetApp Files

Пропускная способность тома NetApp для Azure — это функция размера тома и уровня обслуживания, как описано в статье [об уровне обслуживания для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels). 

При проектировании инфраструктуры для SAP в Azure следует учитывать некоторые минимальные требования к пропускной способности хранилища, которые относятся к минимальным характеристикам пропускной способности:

- Включить чтение и запись в/Hana/log из 250 МБ/с с размером операций ввода-вывода в 1 МБ  
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для /hana/data для размеров операций ввода-вывода 16 МБ и 64 МБ.  
- Включите действие записи с пропускной способностью не менее 250 МБ/с для /hana/data для размеров операций ввода-вывода 16 МБ и 64 МБ.  

[Azure NetApp Files ограничения пропускной способности](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels) в 1 Тиб квоты тома:
- Уровень хранилища Premium-64 MiB/s  
- Ultra Storage уровня — 128 MiB/с  

> [!IMPORTANT]
> Независимо от емкости, развертываемой на одном томе NFS, пропускная способность должна плато в диапазоне от 1,2 до 1,4 ГБ/с, используемой потребителем на виртуальной машине. Это связано с базовой архитектурой предложения использовании и связанными с ним ограничениями сеанса Linux в отношении NFS. Показатели производительности и пропускной способности, как описано в статье [Результаты теста производительности для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-performance-benchmarks) были выполнены с одним общим томом NFS с несколькими клиентскими виртуальными машинами и в результате нескольких сеансов. Этот сценарий отличается от сценария, измеряемого в SAP. Где измеряется пропускная способность одной виртуальной машины с Томом NFS. размещается в использовании.

Чтобы удовлетворить минимальные требования к пропускной способности SAP для данных и журналов и в соответствии с `/hana/shared`рекомендациями для, Рекомендуемые размеры будут выглядеть следующим образом:

| Том | Size<br /> Уровень хранилища Premium | Size<br /> Уровень Ultra Storage | Поддерживаемый протокол NFS |
| --- | --- | --- |
| /Hana/log | 4 ТиБ | 2 ТиБ | Версия 4.1 |
| hana/data; | 6,3 тиб | 3,2 тиб | Версия 4.1 |
| /hana/shared | Максимум (512 ГБ, 1xRAM) на 4 рабочих узла | Максимум (512 ГБ, 1xRAM) на 4 рабочих узла | V3 или версия 4.1 |


> [!NOTE]
> Azure NetApp Files рекомендации по выбору размера, отмеченные здесь, предназначены для удовлетворения минимальных требований SAP Express к поставщикам инфраструктуры. В реальных сценариях развертывания клиентов и рабочих нагрузок это может быть недостаточно. Используйте эти рекомендации в качестве отправной точки и адаптируйте их в зависимости от требований конкретной рабочей нагрузки.  

Таким образом, вы можете подумать о том, чтобы развернуть подобную пропускную способность для томов использовании, перечисленных для хранения данных на диске. Кроме того, следует учесть размеры для всех размеров, перечисленных для томов, для различных номеров SKU виртуальной машины, как уже в таблицах Ultra Disk.

> [!TIP]
> Вы можете динамически изменять размер Azure NetApp Files томов без необходимости в том, чтобы `unmount` прерывать работу виртуальных машин или прерывать SAP HANA. Это позволяет обеспечить гибкость приложения как ожидаемых, так и непредвиденных требований к пропускной способности.

Документация по развертыванию конфигурации горизонтального масштабирования SAP HANA с резервным узлом с помощью томов NFS версии 4.1, размещенных в использовании, публикуется в [SAP HANA горизонтальном узле на виртуальных машинах Azure с Azure NetApp Files на SUSE Linux Enterprise Server](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-scale-out-standby-netapp-files-suse).


## <a name="next-steps"></a>Дальнейшие шаги
Дополнительные сведения можно найти в разделе

- [SAP HANA рекомендации по обеспечению высокой доступности для виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-availability-overview).
