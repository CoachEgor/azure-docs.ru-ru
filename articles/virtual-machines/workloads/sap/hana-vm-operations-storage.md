---
title: Конфигурации хранилища виртуальных машин SAP HANA в Azure | Документация Майкрософт
description: Рекомендации по хранению виртуальной машины, в которой развернут SAP HANA.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 05/19/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: aa3096f43952c047620b310412b27c434fc5fb06
ms.sourcegitcommit: 50673ecc5bf8b443491b763b5f287dde046fdd31
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2020
ms.locfileid: "83682607"
---
# <a name="sap-hana-azure-virtual-machine-storage-configurations"></a>Конфигурации хранилища виртуальных машин SAP HANA в Azure

Azure предоставляет различные типы хранилища, подходящие для виртуальных машин Azure, работающих под управлением SAP HANA. **Сертифицированные SAP HANA типы хранилищ**, которые можно рассматривать для списка развертываний SAP HANA, например: 

- SSD от Azure категории "Премиум"  
- [Диск (цен. категория "Ультра")](https://docs.microsoft.com/azure/virtual-machines/linux/disks-enable-ultra-ssd)
- [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) 

Дополнительные сведения о типах дисков см. в статье о [типах дисков, доступных в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/disks-types).

Azure предлагает два метода развертывания виртуальных жестких дисков (VHD) в хранилище Azure класса "Стандартный" и хранилище Azure класса Premium. Рекомендуется использовать развертывания [управляемых дисков Azure](https://azure.microsoft.com/services/managed-disks/), если общий сценарий это допускает. 

Список типов хранилища и их соглашения об уровне обслуживания в отношении операций ввода-вывода в секунду (IOPS) и пропускной способности хранилища см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).

> [!IMPORTANT]
> Вне зависимости от выбранного типа хранилища Azure, файловая система, используемая в этом хранилище, должна поддерживаться SAP для конкретной операционной системы и СУБД. [Примечание о поддержке SAP #405827](https://launchpad.support.sap.com/#/notes/405827) приводит список поддерживаемых файловых систем для различных операционных систем и баз данных, включая SAP HANA. Это относится ко всем томам, к которым SAP HANA может получать доступ для чтения и записи, для любой задачи. В частности, при использовании NFS в Azure для SAP HANA дополнительные ограничения версий NFS будут применяться, как указано далее в этой статье. 


Далее представлены минимальные сертифицированные SAP HANA условия для разных типов хранилищ. 

- SSD от Azure категории "Премиум" — /Hana/log требуется кэшировать через [Ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) Azure. Том /hana/data можно разместить как на SSD категории "Премиум" без использования ускорителя записи Azure, так и на диск категории "Ультра"
- По крайней мере для тома /hana/log следует использовать диск "Ультра". Том /hana/data может быть размещен либо на SSD категории "Премиум" без использования ускорителя записи Azure, либо на диск категории "Ультра" для ускорения перезапуска.
- Тома формата **NFS версии 4.1** поверх Azure NetApp Files для /hana/log **и** /hana/data. Том /hana/shared может использовать протоколы NFS v3 или NFS v 4.1. Протокол NFS версии 4.1 является обязательным для томов /hana/data и /hana/log.

Некоторые типы хранилищ можно объединять. Например, можно поместить /hana/data в хранилище класса "Премиум", а /hana/log — на хранилище класса "Ультра", чтобы достичь необходимого низкого уровня задержки. Однако если вы используете том NFS версии 4.1 на основе ANF для /hana/data, вам потребуется использовать другой том NFS версии 4.1 на основе ANF для /hana/log. Использование NFS поверх ANF для одного из томов (например, /hana/data) и хранилища Azure класса "Премиум" или диска "Ультра" для другого тома (например, /hana/log) **не поддерживается**.

До сего дня вам не нужно было беспокоиться о подсистемах ввода-вывода и их возможностях. Это связано с тем, что поставщику оборудования необходимо было убедиться в том, что для SAP HANA соблюдены минимальные требования к хранению. При самостоятельном создании инфраструктуры Azure вам следует знать некоторые из этих требований. Некоторые минимальные характеристики пропускной способности, необходимые для SAP, приводят к необходимости:

- Включить действия чтения и записи для **/hana/log** с пропускной способностью 250 МБ/с для размера операций ввода-вывода 1 МБ.
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.
- Включите действие записи с пропускной способностью не менее 250 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.

Так как небольшая задержка хранилища для систем СУБД является критической, даже такие системы, как SAP HANA, хранят данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Кроме того, такие операции, как запись точек сохранения или загрузка данных в памяти после восстановления из-за сбоя, могут быть критическими. Таким образом, становится **обязательным** использование дисков Azure класса "Премиум" для томов **/hana/data** и **/hana/log**. Чтобы добиться минимальной пропускной способности **/hana/log** и **/hana/data** в соответствии с требованиями SAP, создайте RAID 0 с помощью MDADM или LVM на нескольких дисках хранилища Azure класса Premium и используйте тома RAID в качестве томов **/hana/data** и **/hana/log**. 

> [!IMPORTANT]
>Три файловых системы SAP HANA, /data, /log и /shared, не должны быть размещены в группе томов по умолчанию или в корневой папке.  Настоятельно рекомендуется следовать рекомендациям для поставщиков Linux, которые обычно создают отдельные группы томов для /data, /log и /shared.

**Рекомендация. В качестве размеров блоков для RAID 0 рекомендуем использовать следующие.**

- 256 КБ для **/hana/data**
- 32 KБ для **/hana/log**

> [!IMPORTANT]
> Размер блока чередования для /hana/data был изменен со времени предыдущих рекомендаций (64 КБ или 128 КБ) до 256 КБ на основе опыта пользователей с более поздними версиями Linux. Размер 256 КБ обеспечивает немного более высокую производительность

> [!NOTE]
> Нет необходимости настраивать уровень избыточности с помощью томов RAID, так как хранилища Azure класса Premium и Standard хранят три образа виртуального жесткого диска. Использование тома RAID предназначено исключительно для настройки томов, которые предоставляют достаточную пропускную способность операций ввода-вывода.

Использование нескольких VHD Azure в RAID влияет на число операций ввода-вывода в секунду и пропускную способность хранилища. Таким образом, если вы добавите в RAID 0 3 диска P30 хранилища Azure класса Premium, число операций ввода-вывода в секунду и пропускная способность увеличатся в три раза, исходя из показателей одного диска P30 хранилища класса Premium.

Кроме того, при выборе виртуальной машины или изменении ее размера учитывайте пропускную способность ввода-вывода. Общие сведения о пропускной способности хранилища виртуальной машины см. в статье [Размеры виртуальных машин, оптимизированных для операций в памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

## <a name="linux-io-scheduler-mode"></a>Режим планировщика операций ввода–вывода для Linux
Linux имеет несколько разных режимов планирования операций ввода-вывода. Распространенная рекомендация поставщиков Linux и SAP предполагает перенастройку режима планировщика ввода-вывода для томов дисков с **mq-deadline** или режима **kyber** в режимы **noop** (без multiqueue) или **none** (multiqueue). Дополнительные сведения см. в [примечании к SAP № 1984787](https://launchpad.support.sap.com/#/notes/1984787). 


## <a name="solutions-with-premium-storage-and-azure-write-accelerator-for-azure-m-series-virtual-machines"></a>Решение хранилища класса "Премиум" с ускорителем записи Azure для виртуальных машин Azure серии M
Ускоритель записи Azure — это функция, которая предназначена исключительно для виртуальных машин Azure серии M. Как очевидно из названия, целью функции является уменьшение задержки операций ввода-вывода записей в хранилище Azure класса Premium. В SAP HANA ускоритель записи нужно использовать только для тома **/hana/log**. Таким образом, **/hana/data** и **/hana/log** являются отдельными томами, а ускоритель записи поддерживает только том **/hana/log**. 

> [!IMPORTANT]
> При использовании хранилища Azure класса "Премиум" использование [ускорителя записи Azure](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) или тома /hana/log обязательно. Ускоритель записи доступен только для виртуальных машин хранилища класса "Premium" серий M и Mv2.

Приведенные ниже рекомендации по кэшированию даны исходя из следующих характеристик ввода-вывода для SAP HANA:

- Практически отсутствует рабочая нагрузка чтения файлов данных HANA. Исключениями являются большие по размеру операции ввода-вывода после перезапуска экземпляра HANA или когда данные загружаются в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. В этом случае кэширование чтения практически не имеет смысла, поскольку в большинстве случаев все тома файлов данных необходимо считать полностью.
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения выполняется асинхронно и не задерживает выполнение пользовательских транзакций. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Однако восстановление после сбоя происходит только в исключительных ситуациях
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются большие операции ввода-вывода при выполнении резервных копий журналов транзакций, восстановления после сбоя или во время перезапуска экземпляра HANA.  
- Основной нагрузкой на файл журнала повторяемых операций SAP HANA являются операции записи. В зависимости от характера рабочей нагрузки можно иметь операции ввода-вывода размером 4 КБ, тогда как в других случаях размер может превышать 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи необходимо сохранить на диске надежным образом

**Рекомендация. В результате представленных шаблонов операций ввода-вывода от SAP HANA кэширование для разных томов, использующих хранилища Azure класса "Премиум", должно устанавливаться следующим образом.**

- **/hana/data** — без кэширования.
- **/Hana/log** — без кэширования, кроме модельного ряда M и Mv2, где ускоритель записи должен быть включен без кэширования чтения. 
- **/hana/shared** — кэширование чтения.

### <a name="production-recommended-storage-solution"></a>Рекомендуемое решение для хранения данных в рабочей среде

> [!IMPORTANT]
> Сертификация SAP HANA для виртуальных машин Azure серии M предоставлена исключительно для конфигурации, где ускоритель записи Azure используется только для тома **/hana/log**. В результате ожидается, что в развертываниях производственного сценария SAP HANA на виртуальных машинах Azure серии M ускоритель записи Azure будет настроен для тома **/hana/log**.  

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

Рекомендации часто превышают минимальные требования SAP, как и было сказано ранее в этой статье. Данные рекомендации являются компромиссными между рекомендациями по размеру от SAP и параметром максимальной пропускной способности, который предоставляют различные модели виртуальных машин.

**Рекомендация. Рекомендованные конфигурации для рабочих сценариев выглядят следующим образом.**

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | hana/log; | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 4 x P20 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 |2 x P30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 3 x P30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 2 x P40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P40 |
| M208s_v2 | 2850 ГиБ | 1000 МБ/с | 4 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P40 |
| M208ms_v2 | 5700 ГиБ | 1000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416s_v2 | 5700 ГиБ | 2000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416ms_v2 | 11400 ГиБ | 2000 МБ/с | 8 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P50 |

Проверьте, будет ли пропускная способность хранилища для разных предлагаемых томов соответствовать рабочей нагрузке, которую вы хотите запускать. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с увеличением количества VHD увеличит пропускную способность операций ввода-вывода и число IOPS в пределах ограничений типа виртуальной машины Azure.

Ускоритель записи Azure работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Поэтому в качестве управляемых дисков необходимо развернуть по крайней мере диски хранилища Azure класса Premium, формирующие том **/hana/log**.

Есть ограничения на число виртуальных жестких дисков хранилища Azure класса Premium для каждой виртуальной машины, которые могут поддерживаться ускорителем записи Azure. Сейчас действуют такие ограничения:

- 16 виртуальных жестких дисков для виртуальных машин M128xx и M416xx
- 8 виртуальных жестких дисков для виртуальных машин M64xx и M208xx
- 4 виртуальных жестких диска для виртуальной машины серии M32xx.

Подробные инструкции по включению ускорителя записи Azure см. в статье [Write Accelerator](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) (Ускоритель записи).

Подробные сведения и ограничения для ускорителя записи Azure можно найти в той же статье.

**Рекомендация. Необходимо использовать ускоритель записи для дисков, формирующих том /hana/log**


### <a name="cost-conscious-azure-storage-configuration"></a>Стоимость конфигурации хранилища Azure
В следующей таблице показана конфигурация типов виртуальных машин, которые клиенты чаще всего используют для размещения SAP HANA на виртуальных машинах Azure. Некоторые из этих типов машин не соответствуют всем требованиям для SAP HANA или официально не поддерживаются SAP. Но пока эти виртуальные машины отлично работали в нерабочих средах. **/hana/data** и **/hana/log** объединяются в один том. В результате этого использование ускорителя записи Azure может стать ограничением в плане операций ввода-вывода в секунду.

> [!NOTE]
> Для поддерживаемых сценариев SAP проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

> [!NOTE]
> Новой рекомендацией по снижению расходов является переход с [дисков Azure HDD (цен. категория "Стандартный")](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd) на более надежные и производительные [диски SSD (цен. категория "Стандартный") Azure](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd)

Рекомендации часто превышают минимальные требования SAP, как и было сказано ранее в этой статье. Данные рекомендации являются компромиссными между рекомендациями по размеру от SAP и параметром максимальной пропускной способности, который предоставляют различные модели виртуальных машин.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических томов или MDADM | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E16v3 | 128 ГБ | 384 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E32v3 | 256 Гиб | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| E64v3 | 432 ГиБ | 1200 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| GS5 | 448 ГиБ | 2000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 |1 x E30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 2 x P30 | 1 x E30 | 1 x E6 | 1 x E6 |2 x E30 |
| M64ms | 1750 ГиБ | 1000 МБ/с | 3 x P30 | 1 x E30 | 1 x E6 | 1 x E6 | 3 x E30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E40 |
| M128ms | 3800 ГиБ | 2000 МБ/с | 5 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E50 |
| M208s_v2 | 2850 ГиБ | 1000 МБ/с | 4 x P30 | 1 x E30 | 1 x E10 | 1 x E6 |  3 x E40 |
| M208ms_v2 | 5700 ГиБ | 1000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416s_v2 | 5700 ГиБ | 2000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416ms_v2 | 11400 ГиБ | 2000 МБ/с | 8 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E50 |


Диски 3 x P20, рекомендуемые для типов виртуальных машин меньшего размера, превышают размер томов согласно рекомендациям относительно дискового пространства, указанным в [техническом документе для хранилища SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Тем не менее этот вариант, как показано в таблице, был выбран, чтобы обеспечить необходимую пропускную способность диска для SAP HANA. При необходимости вы можете изменить размер тома **/hana/backup**, подобранный для хранения резервных копий, которые в два раза превышают объем памяти тома.   
Проверьте, будет ли пропускная способность хранилища для разных предлагаемых томов соответствовать рабочей нагрузке, которую вы хотите запускать. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с увеличением количества VHD увеличит пропускную способность операций ввода-вывода и число IOPS в пределах ограничений типа виртуальной машины Azure. 

> [!NOTE]
> В приведенных выше конфигурациях было бы невыгодно использовать [соглашение об уровне обслуживания для отдельной виртуальной машины Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_6/), так как оно использует хранилища класса Standard и Premium одновременно. Однако выбор был сделан для оптимизации затрат. Необходимо выбрать хранилище класса Premium для всех дисков, для которых указано хранилище Azure класса Standard (Sxx), чтобы сделать конфигурацию виртуальной машины совместимой с соглашением об уровне обслуживания для отдельной виртуальной машины.


> [!NOTE]
> Приведенные рекомендации по конфигурации диска нацелены на минимальные требования, которые SAP выражает в отношении своих поставщиков инфраструктуры. В реальных сценариях развертывания и рабочей нагрузки клиентов возникали ситуации, когда эти рекомендации по-прежнему не обеспечивали достаточно возможностей. Это могут быть ситуации, когда клиенту нужна более быстрая перезагрузка данных после перезапуска HANA или когда для конфигураций резервного копирования требуется более высокая пропускная способность в хранилище. Другие случаи включали **/hana/log**, в которых 5000 операций ввода-вывода в секунду было недостаточно для конкретной рабочей нагрузки. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйте в соответствии с требованиями своей рабочей нагрузки.
>  

## <a name="azure-ultra-disk-storage-configuration-for-sap-hana"></a>Конфигурации хранилища Azure категории "Ультра" для SAP HANA
Корпорация Майкрософт сейчас готовит к выпуску новый тип хранилища Azure, [Azure Disk категории "Ультра"](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#ultra-disk). Значительная разница между хранилищем Azure, предлагаемым до сих пор, и новым диском "Ультра" заключается в том, что возможности диска больше не привязаны к размеру диска. Как клиент вы можете определить эти возможности для диска "Ультра":

- Размер диска в диапазоне от 4 ГиБ до 65 536 ГиБ
- Число операций ввода-вывода в секунду в диапазоне от 100 до 160 тысяч операций (максимум также зависит от типов виртуальных машин)
- Пропускная способность хранилища от 300 МБ/с до 2000 МБ/с

Благодаря диску "Ультра" можно выбрать один диск, имеющий все подходящие параметры размера, числа операций ввода-вывода в секунду и пропускной способности. Вместо использования диспетчеров логических томов, таких как LVM или MDADM, поверх хранилища Azure класса Premium, создайте тома, выполняющие требования к операциям ввода-вывода и пропускной способности хранилища. Вы можете запустить общую конфигурацию для диска "Ультра" и хранилища класса "Premium". В результате этого можно ограничить использование диска "Ультра" критически важными для производительности томами /hana/data и /hana/log, в то время как остальные тома будут использоваться хранилищем класса "Premium".

Другим преимуществом использования диска "Ультра" является меньшая задержка чтения по сравнению с хранилищем класса "Premium". Более быстрая задержка чтения может иметь преимущества, если требуется сократить время запуска HANA и последующую загрузку данных в память. Преимущества использования хранилища "Ультра" также становятся заметны, когда HANA записывает точки сохранения. Так как диски хранилища класса "Premium" для /hana/data обычно не кэшируются ускорителем записи, задержка записи в хранилище "Premium" выше, чем у диска "Ультра". Ожидается, что запись точек сохранения с помощью "Ультра" будет работать лучше с диска "Ультра".

> [!IMPORTANT]
> Пока что диски "Ультра" доступны не во всех регионах Azure, а также не поддерживают представленные ниже типы виртуальных машин. Для получения подробной информации о доступности диска "Ультра" и поддерживаемых семействах виртуальных машин ознакомьтесь со статьей [Какие типы дисков доступны в Azure?](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#ultra-disk).

### <a name="production-recommended-storage-solution-with-pure-ultra-disk-configuration"></a>Рекомендуемое производителями решение для хранения данных с чистой конфигурацией диска "Ультра"
В этой конфигурации тома /hana/data и /hana/log хранятся отдельно. Предлагаемые значения получены из ключевых показателей эффективности, которые сертифицируются SAP для SAP HANA, и конфигураций хранилища,рекомендованных в [техническом документе по хранилищу SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html).

Рекомендации часто превышают минимальные требования SAP, как и было сказано ранее в этой статье. Данные рекомендации являются компромиссными между рекомендациями по размеру от SAP и параметром максимальной пропускной способности, который предоставляют различные модели виртуальных машин.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | Объем /hana/data | Максимальная пропускная способность ввода-вывода /hana/data | Число операций ввода-вывода в секунду /hana/data | Объем /hana/log | Максимальная пропускная способность ввода-вывода /hana/log | Число операции ввода-вывода в секунду /hana/log |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| E64s_v3 | 432 ГиБ | 1200 МБ/с | 600 ГБ | 700 МБит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2 000 |
| M32ts | 192 ГиБ | 500 МБ/с | 250 ГБ | 400 Мбит/с | 7500 | 256 ГБ | 250 Мбит/с  | 2 000 |
| M32ls | 256 Гиб | 500 МБ/с | 300 ГБ | 400 Мбит/с | 7500 | 256 ГБ | 250 Мбит/с  | 2 000 |
| M64ls | 512 ГБ | 1000 МБ/с | 600 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M64s | 1000 ГиБ | 1000 МБ/с |  1200 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M64ms | 1750 ГиБ | 1000 МБ/с | 2100 ГБ | 600 Мбит/с | 7500 | 512 ГБ | 400 Мбит/с  | 2500 |
| M128s | 2000 ГиБ | 2000 МБ/с |2400 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M128ms | 3800 ГиБ | 2000 МБ/с | 4800 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M208s_v2 | 2850 ГиБ | 1000 МБ/с | 3500 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 400 Мбит/с  | 2500 | 
| M208ms_v2 | 5700 ГиБ | 1000 МБ/с | 7200 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 400 Мбит/с  | 2500 | 
| M416s_v2 | 5700 ГиБ | 2000 МБ/с | 7200 ГБ | 1500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 3000 | 
| M416ms_v2 | 11400 ГБ | 2000 МБ/с | 14400 ГБ | 1500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 3000 |   

Перечисленные значения могут считаться отправной точкой и должны рассматриваться по реальным потребностям. Преимуществом диска "Ультра" Azure является то, что значения операций ввода-вывода и пропускной способности могут быть адаптированы без необходимости завершать работу виртуальной машины или останавливать рабочую нагрузку на систему.   

> [!NOTE]
> На данный момент снимки хранилища не поддерживаются хранилищем диска "Ультра". Это делает невозможным использование снимков виртуальных машин с помощью Azure Backup Services

### <a name="cost-conscious-storage-solution-with-pure-ultra-disk-configuration"></a>Рекомендуемое для снижения затрат решение с чистой конфигурацией диска "Ультра"
В этой конфигурации тома /hana/data и /hana/log хранятся на одном диске. Предлагаемые значения получены из ключевых показателей эффективности, которые сертифицируются SAP для SAP HANA, и конфигураций хранилища,рекомендованных в [техническом документе по хранилищу SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). 

Рекомендации часто превышают минимальные требования SAP, как и было сказано ранее в этой статье. Данные рекомендации являются компромиссными между рекомендациями по размеру от SAP и параметром максимальной пропускной способности, который предоставляют различные модели виртуальных машин.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | Том для /hana/data и /log | Максимальная пропускная способность ввода-вывода для /hana/data и /log | Число операций ввода-вывода в секунду для /hana/data и /log |
| --- | --- | --- | --- | --- | --- |
| E64s_v3 | 432 ГиБ | 1200 МБ/с | 1200 ГБ | 1200 Мбит/с | 9500 | 
| M32ts | 192 ГиБ | 500 МБ/с | 512 ГБ | 400 Мбит/с | 9500 | 
| M32ls | 256 Гиб | 500 МБ/с | 600 ГБ | 400 Мбит/с | 9500 | 
| M64ls | 512 ГБ | 1000 МБ/с | 1100 ГБ | 900 Мбит/с | 10 000 | 
| M64s | 1000 ГиБ | 1000 МБ/с |  1700 ГБ | 900 Мбит/с | 10 000 | 
| M64ms | 1750 ГиБ | 1000 МБ/с | 2600 ГБ | 900 Мбит/с | 10 000 | 
| M128s | 2000 ГиБ | 2000 МБ/с |2900 ГБ | 1800 Мбит/с |12 000 | 
| M128ms | 3800 ГиБ | 2000 МБ/с | 5300 ГБ | 1800 Мбит/с |12 000 |  
| M208s_v2 | 2850 ГиБ | 1000 МБ/с | 4000 ГБ | 900 Мбит/с | 10 000 |  
| M208ms_v2 | 5700 ГиБ | 1000 МБ/с | 7700 ГБ | 900 Мбит/с | 10 000 | 
| M416s_v2 | 5700 ГиБ | 2000 МБ/с | 7700 ГБ | 1800 Мбит/с | 12 000 |  
| M416ms_v2 | 11400 ГБ | 2000 МБ/с | 15000 ГБ | 1800 Мбит/с | 12 000 |    

Перечисленные значения могут считаться отправной точкой и должны рассматриваться по реальным потребностям. Преимуществом диска "Ультра" Azure является то, что значения операций ввода-вывода и пропускной способности могут быть адаптированы без необходимости завершать работу виртуальной машины или останавливать рабочую нагрузку на систему.  

## <a name="nfs-v41-volumes-on-azure-netapp-files"></a>Тома NFS версии 4.1 на Azure NetApp Files
Azure NetApp Files предоставляет собственные общие папки NFS, которые можно использовать для томов /hana/shared, /hana/data и /hana/log. Применение общих ресурсов NFS на основе ANF для томов /hana/data и /hana/log требует использования протокола NFS версии 4.1. Протокол NFS v3 не поддерживается для использования томов /hana/data и /hana/log при создании общих папок на основе ANF. 

> [!IMPORTANT]
> Протокол NFS v3, реализованный в Azure NetApp Files, **не поддерживается** для использования с /hana/data и /hana/log. Использование NFS 4.1 является обязательным для томов /hana/data и /hana/log из функциональной точки зрения. В то же время для тома /hana/shared можно использовать как протокол NFS v3, так и протокол NFS версии 4.1 с точки зрения функционала.

### <a name="important-considerations"></a>Важные сведения
При выборе Azure NetApp Files для SAP NetWeaver и SAP HANA стоит учитывать следующие важные моменты.

- Минимальный размер пула емкости равен 4 ТиБ.  
- Минимальный размер тома составляет 100 ГиБ.
- Azure NetApp Files и все виртуальные машины, на которых будут монтироваться тома Azure NetApp Files, должны быть развернуты в одной виртуальной сети Azure или в [одноранговых виртуальных сетях](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) в одном регионе.  
- В выбранной виртуальной сети должна быть подсеть, делегированная службе Azure NetApp Files.
- Пропускная способность тома Azure NetApp является функцией квоты тома и уровня обслуживания, как описано в статье [Уровни обслуживания для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels). При определении размера томов HANA в Azure NetApp убедитесь, что полученная пропускная способность соответствует требованиям к системе HANA.  
- Azure NetApp Files предлагает [политику экспорта](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-configure-export-policy), которая позволяет управлять разрешенными клиентами, типом доступа (чтение и запись, доступ только для чтения и т. д.). 
- Функция Azure NetApp Files пока еще не поддерживает зоны. В настоящее время Azure NetApp Files не развернута во всех зонах доступности региона Azure. Учитывайте возможную задержку в некоторых регионах Azure.  
- Важно, чтобы виртуальные машины были развернуты как можно ближе к хранилищу Azure NetApp, чтобы снизить задержку. 
- Идентификатор пользователя для <b>sid</b>adm и идентификатор группы для `sapsys` на виртуальных машинах должны соответствовать конфигурации в Azure NetApp Files. 

> [!IMPORTANT]
> Для рабочих нагрузок SAP HANA низкий показатель задержки чрезвычайно важен. Пообщайтесь с представителями корпорации Майкрософт, чтобы убедиться, что виртуальные машины и тома Azure NetApp Files развернуты близко друг от друга.  

> [!IMPORTANT]
> В случае несоответствия между идентификатором пользователя <b>sid</b>adm и идентификатором группы для `sapsys` в виртуальной машине и конфигурации Azure NetApp разрешения для файлов на томах NetApp в Azure, подключенных к виртуальным машинам, будут отображаться как `nobody`. Убедитесь, что указали правильный идентификатор пользователя для <b>sid</b>adm и правильный идентификатор группы для `sapsys` во время [установки новой системы ](https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbRxjSlHBUxkJBjmARn57skvdUQlJaV0ZBOE1PUkhOVk40WjZZQVJXRzI2RC4u) в среде Azure NetApp Files.

### <a name="sizing-for-hana-database-on-azure-netapp-files"></a>Выбор размера базы данных HANA в Azure NetApp Files

Пропускная способность тома Azure NetApp является функцией размера тома и уровня обслуживания, как описано в статье [Уровни обслуживания для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels). 

При проектировании инфраструктуры для SAP в Azure следует учитывать минимальные требования к пропускной способности хранилища от SAP, которые соотносятся с минимальными характеристиками пропускной способности следующего.

- Включение действия чтения и записи для /hana/log с пропускной способностью 250 МБ/с для размера операций ввода-вывода 1 МБ.  
- Включение действия чтения с пропускной способностью не менее 400 МБ/с для /hana/data для размеров операций ввода-вывода 16 МБ и 64 МБ.  
- Включение действия записи с пропускной способностью не менее 250 МБ/с для /hana/data для размеров операций ввода-вывода 16 МБ и 64 МБ.  

Ниже представлены [ограничения пропускной способности Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/azure-netapp-files-service-levels) на 1 ТиБ квоты тома.
- Класс "Premium" — 64 МиБ/с  
- Класс "Ультра" — 128 МиБ/с  

> [!IMPORTANT]
> Независимо от емкости, развертываемой на одном томе NFS, пропускная способность должна выравниваться в диапазоне от 1,2 до 1,4 ГБ/с, используемом пользователем виртуальной машины. Это связано с базовой архитектурой предложения ANF и связанными с ним ограничениями сеанса Linux в отношении NFS. Показатели производительности и пропускной способности, указанные в статье [Результаты теста производительности для Azure NetApp Files](https://docs.microsoft.com/azure/azure-netapp-files/performance-benchmarks-linux), были получены с одним общим томом NFS и несколькими клиентскими виртуальными машинами, в результате нескольких сеансов. Этот сценарий отличается от сценария, измеряемого в SAP. В этом случае измеряется пропускная способность одной виртуальной машины с томом NFS, размещенном на ANF.

Для удовлетворения минимальных требований SAP к пропускной способности для данных и файлов журналов, а также в соответствии с рекомендациями для `/hana/shared` рекомендованные размеры будут обозначены следующим образом.

| Том | Размер<br /> Хранилище класса "Premium" | Размер<br /> Хранилище класса "Ультра" | Поддерживаемый протокол NFS |
| --- | --- | --- |
| /hana/log/ | 4 ТиБ | 2 ТиБ | Версия 4.1 |
| hana/data; | 6.3 ТиБ | 3.2 ТиБ | Версия 4.1 |
| /hana/shared | Максимум (512 ГБ, 1xRAM) на 4 рабочих узла | Максимум (512 ГБ, 1xRAM) на 4 рабочих узла | Версия 3 или версия 4.1 |


> [!NOTE]
> Приведенные рекомендации по конфигурации диска нацелены на минимальные требования, которые SAP выражает в отношении своих поставщиков инфраструктуры. В реальных сценариях развертывания и рабочих нагрузок это может оказаться недостаточным. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйтесь в соответствии с требованиями своей рабочей нагрузки.  

Таким образом, вы можете подумать о том, чтобы развернуть похожую пропускную способность для томов ANF, как это было указано для хранилища "Ультра". Кроме того, следует учесть размеры всех томов для различных номеров SKU виртуальной машины, как это уже было указано в таблицах для диска "Ультра"

> [!TIP]
> Вы можете динамически изменять размер томов Azure NetApp Files без необходимости `unmount` тома, прекращать работу виртуальных машин или прерывать работу SAP HANA. Это позволяет создать гибкий подход, который поможет справиться как с ожидаемыми, так и с непредвиденными обстоятельствами, связанными с пропускной способностью.

Документацию по развертыванию конфигурации горизонтального масштабирования SAP HANA с резервным узлом с помощью томов NFS версии 4.1, размещенных в ANF, можно найти на сервере [SUSE Linux Enterprise, посвященному горизонтальному масштабированию SAP HANA с резервным узлом на виртуальных машинах Azure с Azure NetApp Files](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-scale-out-standby-netapp-files-suse).


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в разделе:

- [Руководство по обеспечению высокого уровня доступности SAP HANA на виртуальных машинах Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-availability-overview).
