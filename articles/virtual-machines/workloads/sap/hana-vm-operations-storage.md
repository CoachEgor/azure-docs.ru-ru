---
title: SAP HANA конфигураций хранилища виртуальных машин Azure | Документация Майкрософт
description: Рекомендации по хранению для виртуальной машины, в которой развернут SAP HANA.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 08/15/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 45d8844a34c5b7d9f36099304c1619e09d39305c
ms.sourcegitcommit: 44e85b95baf7dfb9e92fb38f03c2a1bc31765415
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "70099636"
---
# <a name="sap-hana-azure-virtual-machine-storage-configurations"></a>Конфигурации хранилища виртуальных машин SAP HANA в Azure

Azure предоставляет различные типы хранилища, которые подходят для виртуальных машин Azure, на которых выполняется SAP HANA. Типы хранилища Azure, которые можно рассматривать для SAP HANAных развертываний, например: 

- SSD (цен. категория "Стандартный") дисковых накопителей (SSD)
- Твердотельные накопители (SSD) класса Premium
- [Ultra Disk](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/disks-enable-ultra-ssd) 

Дополнительные сведения об этих типах дисков см. в статье [Выбор типа диска](https://docs.microsoft.com/azure/virtual-machines/linux/disks-types) .

Azure предлагает два метода развертывания виртуальных жестких дисков (VHD) в хранилище Azure класса "Стандартный" и хранилище Azure класса Premium. Рекомендуется использовать развертывания [управляемых дисков Azure](https://azure.microsoft.com/services/managed-disks/), если общий сценарий это допускает. 

Список типов хранилища и их соглашения об уровне обслуживания в отношении операций ввода-вывода в секунду (IOPS) и пропускной способности хранилища см. на странице [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).

**Рекомендуемые Использование хранилища Azure класса Premium совместно с Azure Ускоритель записи и использование управляемых дисков Azure для развертывания**

В локальной среде вам редко приходится заботиться о подсистемах ввода-вывода и ее возможностях. Это связано с тем, что поставщику оборудования необходимо было убедиться в том, что для SAP HANA соблюдены минимальные требования к хранению. При самостоятельном создании инфраструктуры Azure необходимо учитывать некоторые из этих требований. Некоторые из минимальных требуемых характеристик пропускной способности приводят к необходимости:

- Включить чтение и запись в **/Hana/log** из 250 МБ/с с размером операций ввода-вывода в 1 МБ
- Включите действие чтения с пропускной способностью не менее 400 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.
- Включите действие записи с пропускной способностью не менее 250 МБ/с для **/hana/data** для размеров операций ввода-вывода 16 МБ и 64 МБ.

Так как небольшая задержка хранилища для систем СУБД является критической, даже такие системы, как SAP HANA, хранят данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Кроме того, такие операции, как запись точек сохранения или загрузка данных в памяти после восстановления из-за сбоя, могут быть критическими. Поэтому **обязательно** используйте диски Azure уровня "Премиум" для томов **/Hana/Data** и **/Hana/log** . Чтобы добиться минимальной пропускной способности **/hana/log** и **/hana/data** в соответствии с требованиями SAP, создайте RAID 0 с помощью MDADM или LVM на нескольких дисках хранилища Azure класса Premium и используйте тома RAID в качестве томов **/hana/data** и **/hana/log**. 

**Рекомендуемые В качестве размеров чередования для RAID 0 рекомендуется использовать:**

- 64 КБ или 128 КБ для **/hana/data**
- 32 KБ для **/hana/log**

> [!NOTE]
> Нет необходимости настраивать уровень избыточности с помощью томов RAID, так как хранилища Azure класса Premium и Standard хранят три образа виртуального жесткого диска. Использование тома RAID предназначено исключительно для настройки томов, которые предоставляют достаточную пропускную способность операций ввода-вывода.

Использование нескольких VHD Azure в RAID влияет на число операций ввода-вывода в секунду и пропускную способность хранилища. Таким образом, если вы добавите в RAID 0 3 диска P30 хранилища Azure класса Premium, число операций ввода-вывода в секунду и пропускная способность увеличатся в три раза, исходя из показателей одного диска P30 хранилища класса Premium.

Приведенные ниже рекомендации по кэшированию даны исходя из следующих характеристик ввода-вывода для SAP HANA:

- Практически отсутствует рабочая нагрузка чтения файлов данных HANA. Исключениями являются большие по размеру операции ввода-вывода после перезапуска экземпляра HANA или когда данные загружаются в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. В этом случае кэширование чтения практически не имеет смысла, поскольку в большинстве случаев все тома файлов данных необходимо считать полностью.
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения выполняется асинхронно и не задерживает выполнение пользовательских транзакций. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Однако восстановление после сбоя происходит только в исключительных ситуациях
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются большие операции ввода-вывода при выполнении резервных копий журналов транзакций, восстановления после сбоя или во время перезапуска экземпляра HANA.  
- Основной нагрузкой на файл журнала повторяемых операций SAP HANA являются операции записи. В зависимости от характера рабочей нагрузки можно иметь операции ввода-вывода размером 4 КБ, тогда как в других случаях размер может превышать 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи необходимо сохранить на диске надежным образом

**Рекомендуемые В результате использования этих шаблонов ввода-вывода SAP HANA, кэширование для различных томов, использующих хранилище Azure класса Premium, должно быть установлено следующим образом:**

- **/hana/data** — без кэширования.
- **/hana/log** — без кэширования, за исключением серии M (см. далее в этом документе).
- **/hana/shared** — кэширование чтения.


Кроме того, при выборе виртуальной машины или изменении ее размера учитывайте пропускную способность ввода-вывода. Общие сведения о пропускной способности хранилища виртуальной машины см. в статье [Размеры виртуальных машин, оптимизированных для операций в памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

## <a name="linux-io-scheduler-mode"></a>Режим планировщика операций ввода–вывода для Linux
Linux имеет несколько разных режимов планирования операций ввода-вывода. Распространенная рекомендация по поставщикам Linux и SAP — перенастройка режима планировщика ввода-вывода для томов дисков из режима **CFQ** в режим **NOOP** . Дополнительные сведения см. в [примечании к SAP № 1984798](https://launchpad.support.sap.com/#/notes/1984787). 


## <a name="production-storage-solution-with-azure-write-accelerator-for-azure-m-series-virtual-machines"></a>Решение рабочего хранилища с Azure Ускоритель записи для виртуальных машин Azure серии M
Ускоритель записи Azure — это функция, которая предназначена исключительно для виртуальных машин Azure серии M. Как очевидно из названия, целью функции является уменьшение задержки операций ввода-вывода записей в хранилище Azure класса Premium. В SAP HANA ускоритель записи нужно использовать только для тома **/hana/log**. Таким образом, **/Hana/Data** и **/Hana/log** — это отдельные тома с ускоритель записи Azure, поддерживающими только том **/Hana/log** . 

> [!IMPORTANT]
> Сертификация SAP HANA для виртуальных машин Azure серии M предоставлена исключительно для конфигурации, где ускоритель записи Azure используется только для тома **/hana/log**. В результате ожидается, что в развертываниях производственного сценария SAP HANA на виртуальных машинах Azure серии M ускоритель записи Azure будет настроен для тома **/hana/log**.  

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

**Рекомендуемые Рекомендуемые конфигурации для рабочих сценариев выглядят следующим образом:**

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | hana/data; | hana/log; | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 4 x P20 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 |2 x P30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 3 x P30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 2 x P40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P40 |
| M208s_v2 | 2850 гиб | 1000 МБ/с | 4 x P30 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P40 |
| M208ms_v2 | 5700 гиб | 1000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416s_v2 | 5700 гиб | 2000 МБ/с | 4 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 3 x P50 |
| M416ms_v2 | 11400 гиб | 2000 МБ/с | 8 x P40 | 2 x P20 | 1 x P30 | 1 x P10 | 1 x P6 | 4 x P50 |

Типы виртуальных машин M416xx_v2 еще не предоставляются корпорацией Майкрософт в общедоступной. Проверьте, соответствует ли пропускная способность хранилища для различных рекомендуемых томов рабочей нагрузке, которую необходимо запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с большим количеством виртуальных жестких дисков, чем указано, увеличивает количество операций ввода-вывода и пропускную способность для типа виртуальной машины Azure.

Ускоритель записи Azure работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Поэтому в качестве управляемых дисков необходимо развернуть по крайней мере диски хранилища Azure класса Premium, формирующие том **/hana/log**.

Есть ограничения на число виртуальных жестких дисков хранилища Azure класса Premium для каждой виртуальной машины, которые могут поддерживаться ускорителем записи Azure. Сейчас действуют такие ограничения:

- 16 виртуальных жестких дисков для виртуальной машины M128xx и M416xx
- 8 виртуальных жестких дисков для виртуальной машины M64xx и M208xx
- 4 виртуальных жестких диска для виртуальной машины серии M32xx.

Подробные инструкции по включению ускорителя записи Azure см. в статье [Write Accelerator](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator) (Ускоритель записи).

Подробные сведения и ограничения для ускорителя записи Azure можно найти в той же статье.

**Рекомендуемые Необходимо использовать Ускоритель записи для дисков, формирующих том/Hana/log**


## <a name="cost-conscious-azure-storage-configuration"></a>Стоимость конфигурации хранилища Azure
В следующей таблице показана конфигурация типов виртуальных машин, которые клиенты также используют для размещения SAP HANA на виртуальных машинах Azure. Могут существовать некоторые типы виртуальных машин, которые могут не соответствовать всем минимальным критериям хранения для SAP HANA или официально не поддерживались SAP HANA SAP. Но пока эти виртуальные машины отлично работали в нерабочих средах. **/Hana/Data** и **/Hana/log** объединены в один том. В результате использование Ускоритель записи Azure может стать ограничением в отношении операций ввода-вывода в секунду.

> [!NOTE]
> Для сценариев, поддерживаемых SAP, проверьте, поддерживается ли для SAP HANA SAP в [документации SAP для IaaS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html)конкретный тип виртуальной машины.

> [!NOTE]
> Изменение предыдущих рекомендаций для решения, представляющего стоимость, заключается в переходе с [дисков azure HDD (цен. Категория "Стандартный")](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-hdd) на более эффективные и надежные [диски SSD (цен. Категория "Стандартный") Azure](https://docs.microsoft.com/azure/virtual-machines/windows/disks-types#standard-ssd) .


| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических томов или MDADM | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E16v3 | 128 ГБ | 384 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E15 |
| E32v3 | 256 Гиб | 768 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| E64v3 | 432 ГиБ | 1200 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| GS5 | 448 ГиБ | 2000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E30 |
| M32ts | 192 ГиБ | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M32ls | 256 Гиб | 500 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 | 1 x E20 |
| M64ls | 512 ГБ | 1000 МБ/с | 3 x P20 | 1 x E20 | 1 x E6 | 1 x E6 |1 x E30 |
| M64s | 1000 ГиБ | 1000 МБ/с | 2 x P30 | 1 x E30 | 1 x E6 | 1 x E6 |2 x E30 |
| M64ms | 1750 Гиб | 1000 МБ/с | 3 x P30 | 1 x E30 | 1 x E6 | 1 x E6 | 3 x E30 |
| M128s | 2000 ГиБ | 2000 МБ/с |3 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E40 |
| M128ms | 3800 Гиб | 2000 МБ/с | 5 x P30 | 1 x E30 | 1 x E10 | 1 x E6 | 2 x E50 |
| M208s_v2 | 2850 гиб | 1000 МБ/с | 4 x P30 | 1 x E30 | 1 x E10 | 1 x E6 |  3 x E40 |
| M208ms_v2 | 5700 гиб | 1000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416s_v2 | 5700 гиб | 2000 МБ/с | 4 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E40 |
| M416ms_v2 | 11400 гиб | 2000 МБ/с | 8 x P40 | 1 x E30 | 1 x E10 | 1 x E6 |  4 x E50 |


Типы виртуальных машин M416xx_v2 еще не предоставляются корпорацией Майкрософт в общедоступной. Диски 3 x P20, рекомендуемые для типов виртуальных машин меньшего размера, превышают размер томов согласно рекомендациям относительно дискового пространства, указанным в [техническом документе для хранилища SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Тем не менее этот вариант, как показано в таблице, был выбран, чтобы обеспечить необходимую пропускную способность диска для SAP HANA. При необходимости вы можете изменить размер тома **/hana/backup**, подобранный для хранения резервных копий, которые в два раза превышают объем памяти тома.   
Проверьте, соответствует ли пропускная способность хранилища для различных рекомендуемых томов рабочей нагрузке, которую необходимо запустить. Если для рабочей нагрузки необходимы большие тома **/hana/data** и **/hana/log**, нужно увеличить количество виртуальных жестких дисков хранилища Azure класса Premium. Изменение размера тома с большим количеством виртуальных жестких дисков, чем указано, увеличивает количество операций ввода-вывода и пропускную способность для типа виртуальной машины Azure. 

> [!NOTE]
> В приведенных выше конфигурациях было бы невыгодно использовать [соглашение об уровне обслуживания для отдельной виртуальной машины Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_6/), так как оно использует хранилища класса Standard и Premium одновременно. Однако выбор был сделан для оптимизации затрат. Необходимо выбрать хранилище класса Premium для всех дисков, для которых указано хранилище Azure класса Standard (Sxx), чтобы сделать конфигурацию виртуальной машины совместимой с соглашением об уровне обслуживания для отдельной виртуальной машины.


> [!NOTE]
> Приведенные рекомендации по конфигурации диска нацелены на минимальные требования, которые SAP выражает в отношении своих поставщиков инфраструктуры. В реальных сценариях развертывания и рабочей нагрузки клиентов возникали ситуации, когда эти рекомендации по-прежнему не обеспечивали достаточно возможностей. Это могут быть ситуации, когда клиенту нужна более быстрая перезагрузка данных после перезапуска HANA или когда для конфигураций резервного копирования требуется более высокая пропускная способность в хранилище. Другие случаи включали **/hana/log**, в которых 5000 операций ввода-вывода в секунду было недостаточно для конкретной рабочей нагрузки. Поэтому примите эти рекомендации в качестве отправной точки и адаптируйте в соответствии с требованиями своей рабочей нагрузки.
>  

## <a name="azure-ultra-disk-storage-configuration-for-sap-hana"></a>Конфигурация хранилища Azure "Ultra Disk" для SAP HANA
Корпорация Майкрософт находится в процессе развертывания нового типа хранилища Azure с именем " [Ultra Disk" Azure](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disks-types#ultra-disk). Значительная разница между хранилищем Azure, предлагаемой до сих пор, заключается в том, что возможности диска больше не привязаны к размеру диска. Как клиент вы можете определить эти возможности для Ultra Disk:

- Размер диска в диапазоне от 4 гиб до 65 536 гиб
- Число операций ввода-вывода в секунду в диапазоне от 100 до 160K операций ввода/вывода (максимум зависит от типов виртуальных машин)
- Пропускная способность хранилища от 300 МБ/с до 2 000 МБ/с

С помощью Ultra Disk можно определить один диск, выполняющий размер, число операций ввода-вывода и пропускную способность диска. Вместо использования диспетчеров логических томов, таких как LVM или MDADM, поверх хранилища Azure класса Premium, создайте тома, выполняющие требования к операциям ввода-вывода и пропускной способности хранилища. Вы можете запустить набор конфигурации между Ultra Disk и хранилищем класса Premium. В результате можно ограничить использование Ultra Disk критически важными для производительности/Hana/Data и/Hana/log томами и охватить другие тома с хранилищем Azure класса Premium.

> [!IMPORTANT]
> Ultra Disk пока отсутствует во всех регионах Azure и пока не поддерживает все типы виртуальных машин. Дополнительные сведения о том, [какие типы дисков доступны в Azure](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disks-types#ultra-disk), и о поддерживаемых СЕМЕЙСТВАХ виртуальных машин см. в статье.

| SKU виртуальной машины | ОЗУ | Макс. пропускная способность<br /> Пропускная способность | том/Hana/Data | пропускная способность ввода-вывода/Hana/Data | /Hana/Data операций ввода-вывода | том/Hana/log | пропускная способность ввода-вывода/Hana/log | /Hana/log операций ввода-вывода |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| E64s_v3 | 432 ГиБ | 1 200 МБ/с | 600 ГБ | 700 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M32ts | 192 ГиБ | 500 МБ/с | 250 ГБ | 500 Мбит/с | 7500 | 256 ГБ | 500 Мбит/с  | 2000 |
| M32ls | 256 Гиб | 500 МБ/с | 300 ГБ | 500 Мбит/с | 7500 | 256 ГБ | 500 Мбит/с  | 2000 |
| M64ls | 512 ГБ | 1000 МБ/с | 600 ГБ | 500 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M64s | 1000 ГиБ | 1 000 МБ/с |  1200 ГБ | 500 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M64ms | 1750 Гиб | 1 000 МБ/с | 2100 ГБ | 500 Мбит/с | 7500 | 512 ГБ | 500 Мбит/с  | 2000 |
| M128s | 2000 ГиБ | 2 000 МБ/с |2400 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 2000 | 
| M128ms | 3800 Гиб | 2 000 МБ/с | 4800 ГБ | 1200 Мбит/с |9000 | 512 ГБ | 800 Мбит/с  | 2000 | 
| M208s_v2 | 2850 гиб | 1 000 МБ/с | 3500 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 500 Мбит/с  | 2000 | 
| M208ms_v2 | 5700 гиб | 1 000 МБ/с | 7200 ГБ | 1000 Мбит/с | 9000 | 512 ГБ | 500 Мбит/с  | 2000 | 
| M416s_v2 | 5700 гиб | 2 000 МБ/с | 7200 ГБ | 1500M бит/с | 9000 | 512 ГБ | 800 Мбит/с  | 2000 | 
| M416ms_v2 | 11400 гиб | 2 000 МБ/с | 14400 ГБ | 1500 Мбит/с | 9000 | 512 ГБ | 800 Мбит/с  | 2000 |   

Типы виртуальных машин M416xx_v2 еще не предоставляются корпорацией Майкрософт в общедоступной. Перечисленные значения предназначены для отправной точки и должны оцениваться по реальным потребностям. Преимуществом Azure Ultra Disk является то, что значения операций ввода-вывода и пропускной способности могут быть адаптированы без необходимости завершать работу виртуальной машины или останавливать рабочую нагрузку, примененную к системе.   

> [!NOTE]
> До сих пор моментальные снимки хранилища с хранилищем Ultra Disk недоступны. Это блокирует использование моментальных снимков виртуальных машин с Azure Backup Services

## <a name="next-steps"></a>Следующие шаги
Дополнительные сведения можно найти в разделе

- [SAP HANA рекомендации по обеспечению высокой доступности для виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-availability-overview).