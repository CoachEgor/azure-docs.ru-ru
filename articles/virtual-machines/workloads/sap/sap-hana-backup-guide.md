---
title: Руководство по резервному копированию SAP HANA на виртуальных машинах Azure | Документация Майкрософт
description: Рекомендации по использованию двух основных возможностей резервного копирования SAP HANA на виртуальных машинах Azure.
services: virtual-machines-linux
documentationcenter: ''
author: msjuergent
manager: juergent
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 03/01/2020
ms.author: juergent
ms.openlocfilehash: bb32350597059209e5baf01d53b0c59fdc2344f3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78255224"
---
# <a name="backup-guide-for-sap-hana-on-azure-virtual-machines"></a>Руководство по резервному копированию SAP HANA на виртуальных машинах Azure

## <a name="getting-started"></a>Начало работы

В этом руководстве по резервному копированию для платформы SAP HANA, запущенной на виртуальных машинах Azure, рассматриваются темы, относящиеся только к Azure. Для общего элемента резервного копирования SAP HANA проверьте документацию SAP HANA. Мы ожидаем, что вы будете знакомы со стратегиями резервного копирования баз данных, причинами и мотивами, чтобы иметь обоснованную и действительную стратегию резервного копирования, и осведомлены о требованиях вашей компании к процедуре резервного копирования, периоду хранения резервных копирования и восстановлению Процедуры.

SAP HANA официально поддерживается на различных типах виртуальных машин Azure, таких как Azure серии M. Полный список сертифицированных SAP HANA VMs и HANA Large Instance можно найти сертифицированные [платформы IaaS.](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure) Microsoft Azure предлагает ряд единиц, где SAP HANA работает не виртуализированной на физических серверах. Эта услуга называется [HANA Large Instances.](hana-overview-architecture.md) Это руководство не будет охватывать процессы резервного копирования и инструменты для HANA Large Instances. Но будет ограничено лазурными машинами. Подробнее о процессах резервного копирования/восстановления с помощью HANA Large Instances читайте в статье [HLI Backup and Restore](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-backup-restore).

Основное внимание в этой статье уделяется трем возможностям резервного копирования SAP HANA на виртуальных машинах Azure:

- Резервное копирование HANA через [службы резервного копирования Azure](https://docs.microsoft.com/azure/backup/backup-overview) 
- резервное копирование HANA в файловую систему на виртуальной машине Azure под управлением Linux (см. статью [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md));
- Резервное копирование HANA на основе моментальных снимков хранения с помощью функции снимка каплей хранилища Azure вручную или службы резервного копирования Azure


SAP HANA предоставляет API-интерфейс архивации, который позволяет интегрировать средства резервного копирования сторонних поставщиков непосредственно с SAP HANA. Такие продукты, как служба резервного копирования Azure или [Commvault,](https://azure.microsoft.com/resources/protecting-sap-hana-in-azure/) используют этот собственный интерфейс для запуска базы данных SAP HANA или повторного резервного копирования журналов. 


Информацию о том, как можно найти программное обеспечение SAP, поддерживается на Azure, можно найти в статье [What SAP программное обеспечение поддерживается для развертывания Azure.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-supported-product-on-azure)

## <a name="azure-backup-service"></a>Служба архивации Azure

Первый сценарий показывает сценарий, при котором служба резервного `backint` копирования Azure использует интерфейс SAP HANA для выполнения потокового резервного копирования из базы данных SAP HANA. Или же вы используете более общую возможность службы резервного копирования Azure для создания согласованного снимка диска приложения и переноса этого момента в службу резервного копирования Azure.

Резервное копирование Azure интегрируется и сертифицировано в качестве резервного решения для SAP HANA с использованием фирменного интерфейса SAP HANA, который называется [backint.](https://www.sap.com/dmc/exp/2013_09_adpd/enEN/#/d/solutions?id=8f3fd455-a2d7-4086-aa28-51d8870acaa5) Для получения более подробной информации о решении, его возможностях и регионах Azure, где оно доступно, прочитайте матрицу поддержки статьи [для резервного копирования баз данных SAP HANA на M M Azure.](https://docs.microsoft.com/azure/backup/sap-hana-backup-support-matrix#scenario-support) Подробнее о службе резервного копирования Azure для HANA читайте в статье [о резервной базе данных SAP HANA в Azure VMs.](https://docs.microsoft.com/azure/backup/sap-hana-db-about) 

Вторая возможность использовать службу резервного копирования Azure — это создание приложения, последовательного резервного копирования с помощью дисковых снимков azure Premium Storage. Другие сертифицированные HANA хранилища Azure, такие как [диск Azure Ultra](https://docs.microsoft.com/azure/virtual-machines/linux/disks-enable-ultra-ssd) и [файлы NetApp Azure,](https://azure.microsoft.com/services/netapp/) не поддерживают такого рода моментальный снимок через службу резервного копирования Azure. Чтение этих статей:

- [Планирование инфраструктуры резервного копирования виртуальных машин в Azure](https://docs.microsoft.com/azure/backup/backup-azure-vms-introduction)
- [Согласованное с приложениями резервное копирование виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent) 

возникает такая последовательность действий:

- Резервное копирование Azure должно выполнить предмоментальный скрипт, который ставит приложение, в данном случае SAP HANA, в постоянное состояние
- По мере подтверждения этого последовательного состояния резервное копирование Azure выполняет снимки диска
- После завершения снимков резервное копирование Azure отменяет действие, совершенное в сценарии предварительного снимка
- После успешного выполнения резервное копирование Azure будет передавать данные в хранилище резервного копирования

В случае SAP HANA большинство клиентов используют Azure Write Accelerator для томов, содержащих журнал повторов SAP HANA. Служба резервного копирования Azure автоматически исключит эти тома из моментальных снимков. Это исключение не вредит способности HANA восстановить. Хотя это будет блокировать возможность восстановления почти со всеми другими SAP поддерживается DBMS.

Недостатком этой возможности является тот факт, что вам нужно разработать свой собственный до и после снимка скрипт. Скрипт предварительного снимка должен создать снимок HANA и обрабатывать возможные случаи исключения. В то время как после моментального сценария необходимо снова удалить снимок HANA. Для получения более подробной информации о требуемой логике начните с [заметок поддержки SAP #2039883.](https://launchpad.support.sap.com/#/notes/2039883) Соображения раздела «Согласованность данных SAP HANA при съемке моментков хранения» в этой статье в полной мере применимы к этому виду резервного копирования.

> [!NOTE]
> Снимок диска на основе резервных данных для SAP HANA в развертывании, где используются несколько контейнеров базы данных, требуют минимального выпуска HANA 2.0 SP04
> 

Подробная информация о моментальных снимках хранилища смотрите позже в этом документе.

![Две возможности сохранения текущего состояния виртуальной машины](media/sap-hana-backup-guide/azure-backup-service-for-hana.png)

## <a name="other-hana-backup-methods"></a>Другие методы резервного копирования HANA
Есть три других метода резервного копирования или пути, которые могут быть рассмотрены:

- Резервное копирование против доли NFS, основанной на файлах NetApp Azure (ANF). ANF снова имеет возможность создавать снимки тех томов, на которые вы храните резервные данные. Учитывая пропускную связь, которая в конечном итоге требуется для записи резервных данных, это решение может стать дорогостоящим методом. Хотя легко установить, так как HANA может написать резервные копирования непосредственно в Azure родной NFS доля
- Выполнение резервного копирования HANA против прилагаемых VM дисков Standard SSD или Azure Premium Storage. В качестве следующего шага вы можете скопировать эти файлы резервного копирования в хранилище Azure Blob. Эта стратегия может быть цена мудрым привлекательным
- Выполнение резервного копирования HANA против прилагаемых VM дисков Standard SSD или Azure Premium Storage. В качестве следующего шага диск получает моментальный снимок на регулярной основе. После первого снимка дополнительные снимки могут быть использованы для снижения затрат

![Варианты создания резервной копии файлов SAP HANA на виртуальной машине](media/sap-hana-backup-guide/other-hana-backup-paths.png)

На рисунке выше показаны варианты создания резервной копии файлов SAP HANA на виртуальной машине, а также их сохранение в другое расположение с помощью разных средств. Однако все решения, не связанные с сторонним службой резервного копирования или службой резервного копирования Azure, имеют несколько общих проблем. Некоторые из них могут быть перечислены, например, администрирование удержания, автоматический процесс восстановления и автоматическое восстановление точек в качестве службы резервного копирования Azure или других специализированных пакетов резервного копирования сторонних компаний и служб. Многие из этих сторонних сервисов могут работать на Azure. 


## <a name="sap-resources-for-hana-backup"></a>Ресурсы SAP для резервного копирования HANA

### <a name="sap-hana-backup-documentation"></a>Документация по резервному копированию SAP HANA

- [Introduction to SAP HANA Administration](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US) (Общие сведения об администрировании SAP HANA)
- [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Планирование стратегии резервного копирования и восстановления)
- [Schedule HANA Backup using ABAP DBACOCKPIT](https://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html) (Планирование резервного копирования HANA с помощью ABAP DBACOCKPIT)
- [Schedule Data Backups (SAP HANA Cockpit)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm) (Планирование резервного копирования данных (панель SAP HANA))
- Часто задаваемые вопросы о резервном копировании SAP HANA см. в [примечании к SAP 1642148](https://launchpad.support.sap.com/#/notes/1642148)
- Часто задаваемые вопросы о моментальных снимках базы данных и хранилища SAP HANA см. в [примечании к SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883)
- Сведения о сетевых файловых системах (NFS), неподдерживаемых для резервного копирования и восстановления, см. в [примечании к SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529)

### <a name="how-to-verify-correctness-of-sap-hana-backup"></a>Как проверить правильность резервной копии SAP HANA
Независимо от метода резервного копирования, запуск восстановления теста против другой системы является абсолютной необходимостью. Этот подход позволяет убедиться в правильности резервной копии, а также в том, что внутренние процессы резервного копирования и восстановления выполняются должным образом. В то время как восстановление резервных ups может быть препятствием на месте из-за его инфраструктуры требования, это гораздо легче выполнить в облаке, предоставляя необходимые ресурсы временно для этой цели. Это правильно, что Есть инструменты, предоставляемые с HANA, которые могут проверить резервные файлы на способность к восстановлению. Однако цель частых восстановительных работ состоит в том, чтобы проверить процесс восстановления базы данных и обучить этот процесс оперативному персоналу.

Обратите внимание, что недостаточно выполнить простое восстановление и проверку, когда платформа HANA настроена и запущена. Необходимо проверить согласованность таблицы, чтобы убедиться, что восстановленная база данных в порядке. SAP HANA предлагает несколько типов проверок согласованности (см. [примечание к SAP 1977584](https://launchpad.support.sap.com/#/notes/1977584)).

Сведения о проверке согласованности таблицы см. на веб-сайте SAP в [этой статье](https://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).

### <a name="pros-and-cons-of-hana-backup-versus-storage-snapshot"></a>Преимущества и недостатки резервной копии HANA и резервной копии на основе моментального снимка хранилища

В документации по SAP не указано, какая резервная копия более предпочтительна: резервная копия HANA или резервная копия на основе моментальных снимков хранилища. Там перечислены только преимущества и недостатки каждой из них. Таким образом каждый пользователь может выбрать предпочитаемый вариант в зависимости от ситуации и доступной технологии хранения (см. статью [Планирование стратегии резервного копирования и восстановления](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)).

В Azure следует отметить тот факт, что функция снимок Azure blob не&#39;обеспечивает согласованность файловой системы на нескольких дисках [(см. Использование снимков blob с PowerShell).](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) 

Кроме того, пользователи, которые часто работают с моментальными снимками больших двоичных объектов, должны понимать процесс выставления счетов. Дополнительные сведения см. в статье [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges) (Общие сведения об увеличении платы при использовании моментальных снимков). Это не так очевидно, как при использовании виртуальных дисков Azure.

### <a name="sap-hana-data-consistency-when-taking-storage-snapshots"></a>Согласованность данных SAP HANA при создании моментальных снимков хранилища

Как описано ранее, описание возможностей резервного копирования моментального снимка резервного копирования Azure, файловой системы и согласованности приложений является обязательным при съемке моментальных снимков. Самый простой способ избежать проблем — завершить работу SAP HANA или даже всей виртуальной машины. То, что не представляется возможным для производственного экземпляра.

> [!NOTE]
> Снимок диска на основе резервных данных для SAP HANA в развертывании, где используются несколько контейнеров базы данных, требуют минимального выпуска HANA 2.0 SP04
> 

Хранилище Azure не обеспечивает согласованность файловой системы на нескольких дисках или объемах, прикрепленных к VM во время процесса моментального снимка. Это означает, что согласованность приложения во время снимка должна быть доставлена приложением, в данном случае sAP HANA. [SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883) имеет важную информацию о резервных копий SAP HANA с помощью моментальных снимков хранения. Например, с помощью файлов xFS необходимо запустить **\_xfs замораживать** перед запуском моментального снимка хранилища, чтобы обеспечить согласованность приложения (см. [xfs\_freeze(8) - страница Linux man](https://linux.die.net/man/8/xfs_freeze) для получения подробной информации о **замораживании xfs).\_**

Ниже приведены действия для создания согласованного моментального снимка, представляющего область данных HANA, в сценарии, когда файловая система XFS охватывает четыре виртуальных диска Azure.

1. Создание подготовки снимка данных HANA
1. Заморозить файловые системы всех дисков / томов (например, использовать **\_xfs заморозить**)
1. Создайте все необходимые моментальные снимки больших двоичных объектов в Azure.
1. Освободите файловую систему.
1. Подтвердите снимок данных HANA (удалит снимок)

При использовании возможности резервного копирования Azure для выполнения резервного копирования моментального снимка приложения шаги, #1 должны быть закодированы/скриптированы вами для сценария перед моментальным снимком. Служба резервного копирования Azure выполняет шаги #2 и #3. Шаги #4 и #5 должны быть снова предоставлены кодом в скрипте после снимка. Если вы не используете службу резервного копирования Azure, необходимо также #2 и #3 по своему усмотрению закодировать/сценарий.
Более подробную информацию о создании снимков данных HANA можно найти в следующих статьях:

- Снимки данных HANA (https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/en-US/ac114d4b34d542b99bc390b34f8ef375.html
- Более подробную информацию для выполнения шага #1 можно найти в статье [Создать моментальный снимок данных (Родной S'L)](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/en-US/9fd1c8bb3b60455caa93b7491ae6d830.html) 
- Подробная информация для подтверждения/удаления снимков данных HANA как необходимости в шаге #5 можно найти в статье [Создать снимок данных (Родной S'L)](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/en-US/9fd1c8bb3b60455caa93b7491ae6d830.html) 

Очень важно подтвердить моментальный снимок HANA. В режиме подготовки моментального снимка системе SAP HANA может потребоваться дополнительное дисковое пространство, так как этот процесс сопровождается &quot;копированием при записи&quot;. Кроме того, вы также не сможете запустить новое резервное копирование до подтверждения моментального снимка SAP HANA.


### <a name="sap-hana-backup-scheduling-strategy"></a>Стратегия планирования резервного копирования SAP HANA

В статье SAP HANA [«Планирование стратегии резервного копирования и восстановления»](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) говорится об базовом плане резервного копирования. Опирайтесь на документацию SAP вокруг HANA и опыт работы с другими DBMS в определении стратегии резервного копирования/восстановления и процесса для SAP HANA. Последовательность различных типов резервных ups и период хранения сильно зависят от sLAs, которые необходимо предоставить.


### <a name="sap-hana-backup-encryption"></a>Шифрование резервной копии SAP HANA

SAP HANA обеспечивает шифрование данных и журнала. Если данные и журнал SAP HANA не зашифрованы, резервные копии не шифруются по умолчанию. Тем не менее, SAP HANA предлагает отдельное шифрование резервного копирования, как это описано в [sAP HANA Резервное шифрование](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.03/en-US/5f837a57ce5e468d9db21c8683bc84da.html). Если вы используете старые выпуски SAP HANA, возможно, потребуется проверить, является ли шифрование резервного копирования частью уже предоставленной функциональности.  


## <a name="next-steps"></a>Дальнейшие действия
* В статье [Резервное копирование SAP HANA в Azure на уровне файлов](sap-hana-backup-file-level.md) описан вариант резервного копирования на основе файлов,
* Дополнительные сведения об обеспечении высокого уровня доступности и планировании аварийного восстановления SAP HANA в Azure (крупные экземпляры) см. в [этой статье](hana-overview-high-availability-disaster-recovery.md).
