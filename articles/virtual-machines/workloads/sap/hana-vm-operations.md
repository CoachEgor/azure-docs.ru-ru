---
title: Конфигурации инфраструктуры SAP HANA и работа с ней в Azure | Документация Майкрософт
description: Руководство по использованию систем SAP HANA, развернутых на виртуальных машинах Azure.
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/04/2018
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: acccc553c5b63b2acd0f9793b0397b25145449dd
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60477476"
---
# <a name="sap-hana-infrastructure-configurations-and-operations-on-azure"></a>Конфигурации инфраструктуры SAP HANA и работа с ней в Azure
Статья содержит рекомендации о том, как настроить Azure инфраструктуры и эксплуатации систем SAP HANA, развернутых на виртуальных машинах Azure (ВМ). В этой статье также содержатся сведения о конфигурации для масштабного развертывания SAP HANA для M128s номера SKU. В этой статье не предназначен для замены стандартной документации SAP, который включает в себя следующее содержимое:

- [SAP HANA Administration Guide](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.02/330e5550b09d4f0f8b6cceb14a64cd22.html) (Руководство по администрированию SAP HANA);
- [SAP Installation Guides](https://service.sap.com/instguides) (Руководство по установке SAP);
- [Примечания по SAP](https://sservice.sap.com/notes)

## <a name="prerequisites"></a>Технические условия
Чтобы воспользоваться приведенными в этом руководстве сведениями, необходимо иметь базовые знания об использовании следующих компонентов Azure:

- [Виртуальные машины Azure](https://docs.microsoft.com/azure/virtual-machines/linux/tutorial-manage-vm)
- [Сети и виртуальные сети Azure](https://docs.microsoft.com/azure/virtual-machines/linux/tutorial-virtual-network).
- [Хранилище Azure](https://docs.microsoft.com/azure/virtual-machines/linux/tutorial-manage-disks)

Дополнительные сведения по SAP NetWeaver и другим компонентам SAP на базе Azure см. в статье [Using Azure for hosting and running SAP workload scenarios](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/get-started) (Размещение и выполнение сценариев рабочей нагрузки SAP с помощью Azure) и [документации по Azure](https://docs.microsoft.com/azure/).

## <a name="basic-setup-considerations"></a>Рекомендации по основной настройке
В следующих разделах описаны рекомендации по основной настройке развертывания систем SAP HANA на виртуальных машинах Azure.

### <a name="connect-to-azure-virtual-machines"></a>Подключение к виртуальным машинам Azure
Как описано в статье [Azure виртуальные машины, руководство по планированию](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/planning-guide), два основных метода используются для подключения к виртуальным машинам Azure:

- Подключение через Интернет и общедоступные конечные точки на виртуальной Машине JumpBox или на виртуальной Машине под управлением SAP HANA.
- Подключение через [VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) или Azure [ExpressRoute](https://azure.microsoft.com/services/expressroute/).

Подключение "сеть — сеть" через VPN или ExpressRoute необходимо для производственных сценариев. Этот тип подключения также необходим для сценариев нерабочей, производственными сценариями, в которых используется программное обеспечение SAP. Пример межсайтового подключения приведен на следующем рисунке:

![Межсайтовые подключения](media/virtual-machines-shared-sap-planning-guide/300-vpn-s2s.png)


### <a name="choose-azure-vm-types"></a>Выбор типов виртуальных машин Azure
Типы виртуальных Машин Azure для использования в рабочей среде, перечислены в [документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html). Для нерабочей сценариев доступен широкий спектр собственных типов виртуальных Машин Azure.

>[!NOTE]
> Для нерабочей сценариев используйте типы виртуальных Машин, которые перечислены в [примечании SAP № 1928533](https://launchpad.support.sap.com/#/notes/1928533). Для использования виртуальных машин Azure для рабочих сценариев, проверьте наличие виртуальных машин в опубликованных SAP, сертифицированные SAP HANA [certified список платформ IaaS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure).

Чтобы развернуть виртуальные машины в Azure, используйте следующую команду:

- портала Azure;
- командлетов Azure PowerShell;
- Azure CLI.

Вы также можете развернуть полностью установленную платформу SAP HANA на виртуальной Машине Azure службы через [облачной платформы SAP](https://cal.sap.com/). Сведения о процессе установки см. в разделе [развертывание SAP S/4HANA или BW/4HANA в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/cal-s4h). Сведения об автоматизации — см. в разделе [в этой статье GitHub](https://github.com/AzureCAT-GSI/SAP-HANA-ARM).

### <a name="choose-an-azure-storage-type"></a>Выберите тип хранилища Azure
Azure предоставляет два типа хранилища, подходящих для виртуальных машин Azure, запуск SAP HANA:  

- Стандартные жесткие диски (HDD)
- "Премиум" твердотельные накопители (SSD)

Дополнительные сведения об этих типах диска, см. в разделе [выберите тип диска](../../windows/disks-types.md).

Azure предлагает два метода развертывания для виртуальных жестких дисков на хранилища Azure классов standard и premium. Рекомендуется использовать развертывания [управляемых дисков Azure](https://azure.microsoft.com/services/managed-disks/), если общий сценарий это допускает.

Список типов хранилища и пропускной способности операций ввода-ВЫВОДА и хранения их соглашения об уровне обслуживания, см. в разделе [документация по Azure для управляемых дисков](https://azure.microsoft.com/pricing/details/managed-disks/).

### <a name="configure-the-storage-for-azure-virtual-machines"></a>Настройка хранилища для виртуальных машин Azure

Вы, возможно, никогда не карточки о подсистем ввода-вывода и их возможности, так как поставщик устройств убедитесь, что для SAP HANA выполнены минимальные требования к хранилищу. Когда вы создаете инфраструктуру Azure самостоятельно, необходимо ознакомиться с некоторыми из этих требований к. Также необходимо понимать требования к конфигурации, предлагаемые в следующих разделах. Для случаев, где Настройка виртуальных машин требуется SAP HANA под управлением, может потребоваться:

- Включите том чтения и записи в/hana/log, по меньшей мере 250 МБ/с для размеров ввода-вывода размером 1 МБ.
- Включите действие по крайней мере 400 МБ/с для/hana/Data, для 16- и 64 МБ размеров ввода-вывода чтения.
- Включите действие записи менее 250 МБ/с для/hana/Data, ввода-вывода размером 16 МБ и 64 МБ.

Low-памятью крайне важно для систем СУБД, несмотря на то, что СУБД, например SAP HANA, сохраняет данные в памяти. Критический путь в хранилище обычно находится рядом с записями журналов транзакций систем СУБД. Однако операции, такие как запись точек сохранения или загрузки данных в памяти после восстановления после сбоя также могут быть критически важными. 

Использование дисков Azure уровня "премиум" для томов/hana/Data и/hana/log является обязательным. Чтобы добиться минимальной пропускной способности/hana/log и/hana/Data, соответствии с требованиями SAP, создайте RAID 0 с помощью mdadm или диспетчер логических томов (LVM) на нескольких дисках хранилища Azure уровня "премиум". Также используйте тома RAID в качестве/hana/Data и тома/hana/log. Мы рекомендуем использовать следующие размеры блоков для RAID 0:

- 64 КБ или 128 КБ для/hana/data
- 32 КБ для/hana/log

> [!NOTE]
> Не нужно настраивать уровень избыточности с помощью томов RAID, так как хранения Azure premium и standard хранят три образа виртуального жесткого диска. Использование тома RAID-МАССИВА представляет собой исключительно для настройки томов, которые предоставляют достаточно пропускной способности ввода-вывода.

Число виртуальных жестких дисков Azure в RAID — накапливаемые из операций ввода-ВЫВОДА и пропускную способность хранилища. Если вы добавите в RAID 0 по 3 x P30 p30 хранилища Azure класса premium, она предоставляет три раза больше операций ввода-ВЫВОДА и три раза хранилища пропускную способность диска P30 хранилища единый Azure уровня "премиум".

Следующие рекомендации, кэширования, предполагают характеристик ввода-вывода для SAP HANA:

- Нет вряд ли нагрузку чтения для файлов данных HANA. Исключениями являются большого объема операций ввода-вывода после перезапуска экземпляра HANA, или при загрузке данных в HANA. Еще одним случаем большего размера операций чтения файлов данных является резервное копирование базы данных HANA. Таким образом кэширование операций чтения не имеет смысла так, как в большинстве случаев можно полностью прочитать файл томов с данными.
- Запись в файлы данных возникает скачкообразно в связи с созданием точек сохранения HANA и восстановления после сбоя. Запись точек сохранения является асинхронным и не выдерживает любые пользовательские транзакции. При записи данных во время восстановления после сбоя производительность является критически важной, поскольку необходимо восстановить работу системы как можно быстрее. Восстановление после сбоя должно быть довольно исключительных ситуациях.
- Вряд ли возникнут другие ситуации, когда понадобится чтение из файлов повторяемых операций HANA. Исключениями являются больших операций ввода-вывода при выполнении резервные копии журналов транзакций, восстановление после сбоя или этапа перезагрузки экземпляра HANA.  
- Основной нагрузки на файл журнала повторяемых операций SAP HANA — операции записи. В зависимости от характера рабочей нагрузки, что операции ввода-вывода как меньшего размера, 4 КБ, или в других случаях операций ввода-вывода размер не менее 1 МБ. Задержки записи для журнала повторяемых операций SAP HANA являются критическими для производительности.
- Все операции записи должны сохраняться на диске в виде надежных.

В результате этих шаблонов ввода-вывода, наблюдаемых с помощью SAP HANA параметра кэширования для разных томов, использующих хранилище Azure уровня "премиум" для:

- **/ hana/data**: Без кэширования.
- **/ hana/log**: Без кэширования, с исключением для виртуальных машин серии M (см. более подробно далее в этой статье).
- **/ hana/shared**: Кэширование чтения.


Кроме того Имейте в виду общая пропускная способность ввода-вывода виртуальной Машины при размера, или решить, на виртуальной Машине. В целом пропускной способности хранилища виртуальной Машины см. в [размеры виртуальных машин, оптимизированных для памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

#### <a name="linux-io-scheduler-mode"></a>Режим ввода-вывода Linux планировщика
Linux имеет несколько разных режимов планирования операций ввода-вывода. Поставщики Linux и SAP рекомендуется задать режим планировщика операций ввода-вывода для тома диска от **cfq** режим **noop** режим. Дополнительные сведения см. в разделе [1984798 # Примечание SAP](https://launchpad.support.sap.com/#/notes/1984787). 


#### <a name="storage-solution-with-write-accelerator-for-azure-m-series-virtual-machines"></a>Решение хранилища с ускорителем записи для Azure виртуальные машины серии M
 Записи Accelerator — это функция Azure, который станет доступен для виртуальных машин Azure серии M исключительно. Целью функции является уменьшение задержки операций ввода-вывода записей в хранилище Azure уровня "премиум". В SAP HANA ускоритель записи нужно использовать только для тома /hana/log. По этой причине необходимо изменить приведенные выше конфигурации. Основное изменение — настроить/hana/Data и/hana/log, чтобы использовать ускоритель записи на том/hana/log только. 

> [!IMPORTANT]
> Сертификация SAP HANA для Azure является уникальной для ускорителя записи для тома/hana/log виртуальные машины серии M. В результате рабочем сценарии развертывания SAP HANA в Azure виртуальных машин должны быть настроены ускорителя записи для/hana/серии M журнала тома.

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.

В следующей таблице показаны рекомендуемые конфигурации.

| SKU виртуальной машины | ОЗУ | Максимальная Пропускная способность<br /> throughput | hana/data; | hana/log; | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- | -- |
| M32ts | 192 ГиБ | 500 МБ в секунду | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M32ls | 256 Гиб | 500 МБ в секунду | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P20 |
| M64ls | 512 ГБ | 1000 МБИТ/с | 3 x P20 | 2 x P20 | 1 x P20 | 1 x P6 | 1 x P6 |1 x P30 |
| M64s | 1000 ГБ | 1000 МБИТ/с | 4 x P20 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 |2 x P30 |
| M64ms | 1750 Гиб | 1000 МБИТ/с | 3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 3 x P30 |
| M128s | 2 000 Гиб | 2000 МБ в секунду |3 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 2 x P40 |
| M128ms | 3800 Гиб | 2000 МБ в секунду | 5 x P30 | 2 x P20 | 1 x P30 | 1 x P6 | 1 x P6 | 2 x P50 |

Проверьте, соответствует ли пропускная способность хранилища для разных предлагаемых томов рабочей нагрузки, которую вы хотите запустить. Если рабочей нагрузки необходимы большие тома/hana/Data и/hana/log, увеличение числа хранилище Azure класса premium виртуальные жесткие диски. Изменение размера тома с большим количеством VHD, чем перечисленные увеличение операций ввода-ВЫВОДА и пропускной способности ввода-вывода в пределах ограничений типа виртуальной машины Azure.

Ускоритель записи работает только с [управляемыми дисками Azure](https://azure.microsoft.com/services/managed-disks/). Как минимум необходимо развернуть на диски хранилища Azure уровня "премиум", которые образуют тома/hana/log как управляемые диски.

Существуют ограничения для хранилища Azure класса premium VHD в одной виртуальной Машины, обеспечивающей ускоритель записи. Сейчас действуют такие ограничения:

- 16 виртуальных жестких дисках для M128xx виртуальной Машины.
- 8 виртуальных жестких дисках для M64xx виртуальной Машины.
- 4 виртуальных жестких дисках для M32xx виртуальной Машины.

Дополнительные сведения о том, как включить ускоритель записи см. в разделе [ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator).

Дополнительные сведения и ограничения для ускорителя записи см. в разделе той же статье.


#### <a name="cost-conscious-azure-storage-configuration"></a>Конфигурация стороннюю службу хранилища Azure
В следующей таблице показана конфигурация типов виртуальных машин, которые клиенты часто используют для размещения SAP HANA на виртуальных машинах Azure. Возможно, некоторые типы виртуальных Машин, которые не соответствуют всем требованиям для SAP HANA. Также возможны некоторые типы виртуальных Машин, которые не поддерживаются официально с SAP HANA в SAP. На данный момент этих виртуальных машинах, выполнено нормально для нерабочей сценариев. 

> [!NOTE]
> Для рабочих сред проверьте [в документации SAP для IAAS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html), поддерживает ли SAP определенный тип виртуальной машины для SAP HANA.


| SKU виртуальной машины | ОЗУ | Максимальная Пропускная способность<br /> throughput | /hana/data и /hana/log,<br /> чередующиеся с диспетчером логических ТОМОВ или mdadm | /hana/shared | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | -- |
| DS14v2 | 112 ГиБ | 768 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S15 |
| E16v3 | 128 ГБ | 384 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S15 |
| E32v3 | 256 Гиб | 768 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S20 |
| E64v3 | 432 ГиБ | 1200 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S30 |
| GS5 | 448 ГиБ | 2000 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S30 |
| M32ts | 192 ГиБ | 500 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S20 |
| M32ls | 256 Гиб | 500 МБ в секунду | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 | 1 x S20 |
| M64ls | 512 ГБ | 1000 МБИТ/с | 3 x P20 | 1 x S20 | 1 x S6 | 1 x S6 |1 x S30 |
| M64s | 1000 ГБ | 1000 МБИТ/с | 2 x P30 | 1 x S30 | 1 x S6 | 1 x S6 |2 x S30 |
| M64ms | 1750 Гиб | 1000 МБИТ/с | 3 x P30 | 1 x S30 | 1 x S6 | 1 x S6 | 3 x S30 |
| M128s | 2 000 Гиб | 2000 МБ в секунду |3 x P30 | 1 x S30 | 1 x S6 | 1 x S6 | 2 x S40 |
| M128ms | 3800 Гиб | 2000 МБ в секунду | 5 x P30 | 1 x S30 | 1 x S6 | 1 x S6 | 2 x S50 |


Диски, которые рекомендуются для типов виртуальных Машин меньшего размера 3 x P20 тома соображениям пространства рекомендации, которым предоставляется в [техническом документе хранилища SAP TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). Выбор, отображаемых в таблице был сделан обеспечить необходимую пропускную способность диска для SAP HANA. Если вам нужно изменить **/hana/backup** томе, в котором был увеличен до размера для сохранения резервных копий, которые дважды объема памяти тома, вы можете внести изменения. 

Проверьте, соответствует ли пропускная способность хранилища для разных предлагаемых томов рабочей нагрузки, которую вы хотите запустить. Если рабочей нагрузки необходимы большие тома/hana/Data и/hana/log, увеличение числа хранилище Azure класса premium виртуальные жесткие диски. Изменение размера тома с большим количеством VHD, чем перечисленные увеличение операций ввода-ВЫВОДА и пропускной способности ввода-вывода в пределах ограничений типа виртуальной машины Azure. 

> [!NOTE]
> Предыдущие конфигурации не преимущества [Azure для отдельной виртуальной Машины соглашение об уровне ОБСЛУЖИВАНИЯ](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_6/) так как оно использует хранилище Azure класса premium и стандартного хранилища Azure, и. Выбор был сделан для оптимизации расходов. Выберите хранилище уровня "премиум" для всех дисков в таблице, которые перечислены в качестве хранилища Azure класса standard (Sxx), чтобы сделать конфигурацию виртуальной Машины, совместимые с Azure одной виртуальной Машины соглашение об уровне ОБСЛУЖИВАНИЯ.


> [!NOTE]
> Рекомендации по конфигурации диска целевые минимальные требования, которые SAP дает ее инфраструктуры поставщиков. В фактических клиентских развертываний и сценариев рабочей нагрузки эти рекомендации не предоставляют достаточно возможностей, в некоторых ситуациях. Например клиент необходимо быстрее перезагружает данные после перезагрузки системы HANA, или конфигурациях резервного копирования требуется более высокой пропускной способностью в хранилище. Другие варианты включают/hana/log, где 5000 операций ввода-ВЫВОДА не достаточно для конкретной рабочей нагрузки. Используйте эти рекомендации в качестве отправной точки и адаптировать их в соответствии с требованиями рабочей нагрузки.
>  

### <a name="set-up-azure-virtual-networks"></a>Настройка виртуальных сетей Azure
Если у вас есть возможность подключения сеть сеть к Azure через VPN или Azure ExpressRoute, вам потребуется по крайней мере одной виртуальной сети Azure, подключенной через виртуальный шлюз к VPN или ExpressRoute. В простых развертываний виртуальный шлюз можно развернуть в подсети виртуальной сети Azure, на котором размещена экземпляры SAP HANA слишком. 

Чтобы установить SAP HANA, создайте две дополнительные подсети в виртуальной сети Azure. Одну подсеть, в которой размещаются виртуальные машины, на которых будут работать экземпляры SAP HANA, А другая выполняется JumpBox или виртуальные машины управления для размещения SAP HANA Studio, другое программное обеспечение управления или обеспечение приложений.

> [!IMPORTANT]
> Настройка [Azure сетевые виртуальные устройства](https://azure.microsoft.com/solutions/network-appliances/) пути передачи между приложением SAP и уровень СУБД для SAP NetWeaver-, не поддерживается Hybris- или системы SAP на основе S/4HANA. Это ограничение является по соображениям производительности и функциональности. Пути обмена данными между уровнем приложений SAP и уровень СУБД должен быть прямой. Ограничение не включает в себя [группу безопасности приложений (ASG) и сетевая безопасность группе правил (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) Если эти правила ASG и группы безопасности сети разрешают контура прямой обмен данными. 
>
> Другие сценарии, где не поддерживаются виртуальные сетевые модули находятся в: 
>
> - Каналы связи между виртуальными машинами Azure, представляющих Linux Pacemaker кластера узлов и устройств SBD, как описано в разделе [высокий уровень доступности SAP NetWeaver на виртуальных машинах Azure в SUSE Linux Enterprise Server for SAP Applications](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse).
> - Каналы связи между виртуальными машинами Azure и Windows Server масштабируемого файлового сервера до, как описано в разделе задать [кластеризация экземпляра SAP ASCS/SCS в отказоустойчивом кластере Windows с помощью общей папки в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-high-availability-guide-wsfc-file-share). 
>
> Виртуальные сетевые модули в путях взаимодействия можно легко double сетевая задержка между партнерами связи. Они также можно ограничить пропускную способность в критических путей между уровнем приложений SAP и уровень СУБД. В некоторых сценариях клиента виртуальных сетевых устройств может привести к кластеры Pacemaker Linux переход на другой. Ниже приведены случаи, где обмен данными между узлами кластера Pacemaker в Linux связь на свое устройство SBD через виртуальный сетевой модуль.  
> 

> [!IMPORTANT]
> Другой, проектирования *не* поддерживается разделения уровень приложений SAP и уровень СУБД в разных виртуальных сетях Azure, которые не являются [пиринговой связи](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) друг с другом. Мы рекомендуем разделить уровень приложений SAP и уровень СУБД с помощью подсетей в виртуальной сети Azure вместо с помощью разных виртуальных сетях Azure. 
>
>Если вы решили не рекомендацию и вместо этого разделить два слоя на разных виртуальных сетях, две виртуальные сети должен быть [пиринговой связи](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview). 
>
> Имейте в виду, что сетевой трафик между двумя [пиринговой связи](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) виртуальных сетей Azure регулируется расходы на передачу. Тома данных большой, состоит из многих терабайт передаются между уровнем приложений SAP и уровень СУБД. Значительные расходы могут накапливаться, если уровень приложений SAP и уровень СУБД, разделяются между двумя пиринговыми виртуальными сетями Azure. 

При установке виртуальных машин для запуска SAP HANA они должны иметь следующее:

- Два виртуальных сетевых адаптера. Один сетевой Адаптер подключается к подсети управления. Другой сетевой Адаптер подключается из локальной сети или других сетей к экземпляру SAP HANA на виртуальной машине Azure.
- Статические частные IP-адреса, развернутые для обоих виртуальных сетевых адаптеров.

> [!NOTE]
> Назначение статических IP-адресов в Azure означает назначить их в отдельных виртуальных сетевых адаптеров. Не назначать статические IP-адреса в гостевой ОС виртуальной сетевой карте. Некоторые службы Azure, такой как резервное копирование Azure полагаются на то что на как минимум первичного виртуальный сетевой Адаптер имеет значение DHCP, а не статических IP-адресов. Дополнительные сведения см. в разделе [резервного копирования виртуальных машин Azure, устранение неполадок](https://docs.microsoft.com/azure/backup/backup-azure-vms-troubleshoot#networking). Чтобы назначить несколько статических IP-адресов для виртуальной Машины, назначьте несколько виртуальных сетевых адаптеров виртуальной Машины.
>
>

Для развертываний, которые долгосрочными создаете архитектуру сети виртуального центра обработки данных в Azure. Эта архитектура рекомендует разделение шлюза виртуальной сети Azure, который подключается к локальной в отдельной виртуальной сети Azure. Этот отдельной виртуальной сети размещается весь трафик, который оставляет в локальную или к Интернету. При таком подходе можно развернуть программное обеспечение для аудита и журналов трафик, который поступает виртуальный центр обработки данных в Azure в этой виртуальной сети отдельный центр. Таким образом, у вас есть одна виртуальная сеть, на котором размещены все программное обеспечение и конфигурации, относящиеся к приходные и исходящим трафиком для развертывания Azure.


Дополнительные сведения о подход виртуального центра обработки данных и разработки связанных виртуальной сети Azure см. в разделе: 

- [Виртуальный центр обработки данных Azure: Сетевая Перспектива](https://docs.microsoft.com/azure/architecture/vdc/networking-virtual-datacenter).
- [Azure виртуальный центр обработки данных и плоскость управления предприятием](https://docs.microsoft.com/azure/architecture/vdc/).


>[!NOTE]
>Трафика, проходящего между центральной виртуальной сети и виртуальной сети периферийных зон с помощью [пиринга виртуальных сетей Azure](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) регулируется дополнительных [затраты](https://azure.microsoft.com/pricing/details/virtual-network/). Исходя из этих затрат, может потребоваться компромиссы между выполнением архитектуру strict концентратор и спица сети и несколько [шлюзы Azure ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-about-virtual-network-gateways) соединиться периферийных зонах для обхода пиринга виртуальных сетей. 
>
> Шлюзы Azure ExpressRoute вводят дополнительные [затраты](https://azure.microsoft.com/pricing/details/vpn-gateway/) слишком. Также могут возникнуть дополнительные затраты для стороннего программного обеспечения, которая использовалась для входа, аудит и мониторинг сетевого трафика. Учесть расходы на обмен данными через виртуальную сеть, пиринга и затраты, созданные дополнительные шлюзы ExpressRoute и лицензии на программное обеспечение. Вы можете на основе микросегментации в одной виртуальной сети с помощью подсетей как единицы изоляции, а не виртуальными сетями.


Обзор различных методов, которые можно использовать для назначения IP-адресов, см. в разделе [IP-адресов, типы и методы распределения в Azure](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm). 

Для виртуальных машин под управлением SAP HANA работаете с статические IP-адреса, назначенные. Причина в том, что некоторые атрибуты конфигурации для HANA ссылаются на IP-адреса.

[Группы безопасности сети Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg) можно перенаправить трафик, поступающий к экземпляру SAP HANA или JumpBox. Группы безопасности сети и в конечном итоге [группы безопасности приложений](https://docs.microsoft.com/azure/virtual-network/security-overview#application-security-groups) связаны с подсетью SAP HANA и подсетью управления.

Ниже приведен обзор приблизительной схемы развертывания для SAP HANA, следующий за архитектуру концентратор и спица виртуальной сети:

![Приблизительная схема развертывания SAP HANA](media/hana-vm-operations/hana-simple-networking.PNG)

Чтобы развернуть SAP HANA в Azure без подключения сеть сеть, защиты экземпляра SAP HANA из общедоступного Интернета и скрыть их за прокси-сервер переадресации. В этом стандартном сценарии для развертывания используются встроенные DNS-службы Azure для разрешения имен узлов. Встроенные DNS-службы Azure особо важны при более сложном развертывании, в котором используются общедоступные IP-адреса. Использовать группы безопасности сети Azure и [Azure сетевые виртуальные устройства](https://azure.microsoft.com/solutions/network-appliances/) для наблюдения за маршрутизацию из Интернета в архитектуру виртуальной сети Azure в Azure. 

Ниже приведен примерная схема для развертывания SAP HANA без подключения сеть сеть в архитектуре концентратор и спица виртуальной сети:
  
![Примерная схема развертывания SAP HANA без подключения "сеть — сеть"](media/hana-vm-operations/hana-simple-networking2.PNG)
 

Другой описание того, как использовать Azure сетевых виртуальных устройств для управления и отслеживания доступа к из Интернета без архитектуры концентратор и спица виртуальной сети, см. в разделе [развертыванию высокодоступных виртуальных сетевых](https://docs.microsoft.com/azure/architecture/reference-architectures/dmz/nva-ha).


## <a name="configure-azure-infrastructure-for-sap-hana-scale-out"></a>Настройка инфраструктуры Azure для горизонтального масштабирования SAP HANA
Корпорация Майкрософт имеет один номер SKU виртуальной Машины серии M, сертифицированным для конфигурации горизонтального масштабирования SAP HANA. Тип виртуальной Машины M128s сертифицирован для горизонтального масштабирования до 16 узлов. Изменения в сертификаты горизонтального масштабирования SAP HANA на виртуальных машинах Azure, см. в разделе [certified список платформ IaaS](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure).

Минимальное число хранимых выпусков операционной системы, используемая для развертывания конфигурации горизонтального масштабирования в виртуальных машинах Azure являются:

- SUSE Linux 12 SP3.
- Red Hat Linux 7.4.

Для сертификации 16 узлов горизонтального масштабирования:

- Один узел — это главный узел.
- До 15 узлов являются рабочими.

>[!NOTE]
>В масштабное развертывание виртуальной Машины Azure не можно использовать на резервный узел.
>

Есть две причины, почему не удается настроить резервный узел:

- Azure на данный момент не имеет собственной службы NFS. Таким образом общих ресурсов NFS необходимо настроить с помощью сторонних функций.
- Ни одна из конфигураций NFS независимых производителей можно удовлетворяющие критериям задержки хранилища для SAP HANA с помощью своих решений, развернутых в Azure.

Таким образом тома/hana/Data и/hana/log не может использоваться. Не совместное использование этих томов отдельные узлы предотвращает использование резервный узел SAP HANA в конфигурации горизонтального масштабирования.

На следующем рисунке показана базовая архитектура для одного узла в конфигурации горизонтального масштабирования:

![Основы горизонтального масштабирования одного узла](media/hana-vm-operations/scale-out-basics.PNG)

Базовая конфигурация узла виртуальной машины для горизонтального масштабирования SAP HANA выглядит так:

- Для/hana/Shared вы можете создать высокодоступные NFS кластер под управлением SUSE Linux 12 SP3. Этот кластер размещает общих ресурсов NFS/hana/Shared конфигурации горизонтального масштабирования и SAP NetWeaver или BW/4HANA центральные службы. Сведения о том, как создавать такая конфигурация, см. в разделе [высокого уровня доступности NFS на виртуальных машинах Azure в SUSE Linux Enterprise Server](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs).
- Все другие тома диска не становятся доступными между различными узлами и не основанных на NFS. Установка конфигурации и действия для установок HANA горизонтального масштабирования с не совместно/hana/Data и/hana/log приведены далее в этой статье.

>[!NOTE]
>Отображаемый на рисунке высокодоступный кластер NFS пока поддерживается только в SUSE Linux. В ближайшее время будет предложено высокодоступное решение NFS на базе Red Hat.

Определение размеров томов для узлов такое же, как масштабирование, за исключением/hana/Shared. Ниже приведены рекомендуемые размеры и типы для M128s номера SKU.

| SKU виртуальной машины | ОЗУ | Максимальная Пропускная способность<br /> throughput | hana/data; | hana/log; | том /root | /usr/sap | hana/backup |
| --- | --- | --- | --- | --- | --- | --- | --- |
| M128s | 2 000 Гиб | 2 000 МБ в секунду. |3 x P30 | 2 x P20 | 1 x P6 | 1 x P6 | 2 x P40 |


Проверьте, соответствует ли пропускная способность хранилища для разных предлагаемых томов рабочей нагрузки, которую вы хотите запустить. Если рабочей нагрузки необходимы большие тома/hana/Data и/hana/log, увеличение числа хранилище Azure класса premium виртуальные жесткие диски. Изменение размера тома с большим количеством VHD, чем перечисленные увеличение операций ввода-ВЫВОДА и пропускной способности ввода-вывода в пределах ограничений типа виртуальной машины Azure. Также можно применить ускоритель записи на диски, образующие тома/hana/log.
 

Формула, определяющая размер тома/hana/shared для горизонтального масштабирования, так как размер памяти одном рабочем узле в четыре рабочих узла, см. в разделе [требования к хранилищу SAP HANA TDI](https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html).

При условии, что вы предпримете SAP HANA горизонтального масштабирования сертифицированных M128s виртуальной Машине Azure с примерно 2 ТБ памяти, рекомендации по SAP вкратце описать следующим образом:

- Одним главным узлом и до четырех рабочих узлов размер тома/hana/Shared составляет 2 ТБ.
- Для одного главного узла и пять и восемь рабочих узлов размер тома/hana/Shared составляет 4 ТБ.
- Для одного главного узла и 9 – 12 рабочих узлов размер тома/hana/Shared составляет 6 ТБ.
- Для одного главного узла и 12 – 15 рабочих узлов размер тома/hana/Shared составляет 8 ТБ.

Другие важные структурные, отображаемый в графике конфигурации один узел для виртуальной Машины горизонтального масштабирования SAP HANA это виртуальная сеть и конфигурацию подсети. SAP настоятельно рекомендует разделение трафика для клиента и приложения из связи между узлами HANA. 

Для достижения этой цели, подключите два различных виртуальных сетевых адаптеров к виртуальной Машине, как показано на рисунке. Обоих виртуальных сетевых адаптеров находятся в разных подсетях и две отдельные IP-адреса. Затем вы управляете потоком трафика с правилами маршрутизации, с помощью группы безопасности сети или определяемые пользователем маршруты.

Особенно в Azure существует не означает, что и методы, обеспечивающие высокое качество обслуживания и квоты для конкретных виртуальных сетевых адаптеров. В результате разделения для клиента и приложения и внутри узла связи не открывается, возможность определять их приоритеты один поток трафика по отношению к другому. Вместо этого разделение остается меры безопасности для предотвращения обмена данными внутри узла в конфигурации горизонтального масштабирования.  

>[!IMPORTANT]
>SAP настоятельно рекомендует разделения сетевого трафика клиента и приложения на стороне и внутри узла трафик так, как описано в этой статье. Рекомендуется поместить архитектуры на месте, как показано на предыдущем рисунке.
>

На следующем рисунке показана архитектура Минимальный необходимый сетевой сети с точки зрения:

![Основы горизонтального масштабирования одного узла](media/hana-vm-operations/scale-out-networking-overview.PNG)

Ограничения, поддерживаемые в данный момент являются 15 рабочих узлов, в дополнение к одним главным узлом.

На следующем рисунке показана архитектура хранилища с точки зрения хранилища:


![Основы горизонтального масштабирования одного узла](media/hana-vm-operations/scale-out-storage-overview.PNG)

Том/hana/Shared находится в высокодоступной конфигурации общего ресурса NFS. Все другие диски локально подключаются к отдельным виртуальным машинам. 

### <a name="highly-available-nfs-share"></a>Общий ресурс NFS с высокой доступностью
На данный момент высокой доступности кластера NFS — работа с SUSE Linux только. Сведения о настройке см. в разделе [высокого уровня доступности NFS на виртуальных машинах Azure в SUSE Linux Enterprise Server](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-nfs). Если не предоставлять кластера NFS в других конфигурациях HANA за пределами виртуальной сети Azure, работающей экземпляры SAP HANA, установите его в той же виртуальной сети. Установите его в собственной подсети и убедитесь, что не весь трафик произвольного доступа к подсети. Вместо этого можно ограничьте трафик к этой подсети в IP-адреса виртуальной машины, которые выполняют трафик, тома/hana/Shared.

Относящиеся к виртуальному сетевому Адаптеру виртуальной машины HANA горизонтального масштабирования маршрутизации трафика/hana/Shared, ниже приведены рекомендации.

- Поскольку средняя трафика для/hana/Shared, его нужно маршрутизировать через виртуальный сетевой Адаптер, присвоенный клиентской сети в минимальной конфигурации.
- В конечном счете для трафика для/hana/shared, разверните третьей подсети в виртуальной сети, где развертывается конфигурации горизонтального масштабирования SAP HANA. Назначьте третий виртуальный сетевой Адаптер, который размещен в этой подсети. Используйте третий виртуальный сетевой Адаптер и IP-адреса для трафика к общей папке NFS. Затем вы можете применять отдельные правила доступа и маршрутизации.

>[!IMPORTANT]
>Сетевой трафик между виртуальные машины SAP HANA в режиме масштабного развертывания и высокой доступности NFS, ни при каких условиях может направляться через [виртуальный сетевой модуль](https://azure.microsoft.com/solutions/network-appliances/) или аналогичные виртуальные устройства. Группы безопасности сети Azure, нет таких устройств. Убедитесь, что ваши правила маршрутизации, чтобы убедиться в том, что на виртуальные сетевые устройства или аналогичные виртуальные устройства перенаправить при доступе к высокой доступности NFS, предоставление общего доступа с виртуальных машин под управлением SAP HANA.
> 

Если вы хотите поделиться высокой доступности кластера NFS конфигураций SAP HANA, переместите все эти конфигурации HANA в той же виртуальной сети. 
 

### <a name="install-an-sap-hana-scale-out-in-azure"></a>Установка SAP HANA горизонтального масштабирования в Azure
Чтобы установить конфигурации горизонтального масштабирования SAP, выполните следующие шаги:

- Новое развертывание или адаптировать новой инфраструктуры виртуальной сети Azure.
- Развертывание новых виртуальных машин с помощью тома хранилища "премиум" с управлением Azure.
- Разверните новый или адаптировать существующего кластера NFS высокой доступности.
- Адаптация сетевой маршрутизации, чтобы убедиться в том, что, например, внутриузловой передачи между виртуальными машинами не направляться через [виртуальный сетевой модуль](https://azure.microsoft.com/solutions/network-appliances/). То же самое верно для трафика между виртуальными машинами и высокой доступности кластера NFS.
- Установка главного узла SAP HANA.
- Изменить параметры конфигурации главный узел SAP HANA.
- Продолжите установку SAP HANA рабочих узлов.

#### <a name="install-sap-hana-in-a-scale-out-configuration"></a>Установка SAP HANA в конфигурации горизонтального масштабирования
Развертывания инфраструктуры виртуальных Машин Azure и завершения все другие подготовительные действия. Теперь чтобы установить конфигурации горизонтального масштабирования SAP HANA, выполните следующие действия.

- Установите на главный узел SAP HANA в соответствии с документацией по SAP.
- *После установки изменить файл global.ini и добавьте параметр "basepath_shared = no" для global.ini*. Этот параметр включает SAP HANA для запуска в масштабирования без общего/hana/Data и/hana/log томов между узлами. Дополнительные сведения см. в разделе [2080991 # Примечание SAP](https://launchpad.support.sap.com/#/notes/2080991).
- После изменения параметра global.ini, перезапустите экземпляр SAP HANA.
- Добавьте дополнительные рабочие узлы. Дополнительные сведения см. в разделе [руководство по администрированию SAP HANA](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US/0d9fe701e2214e98ad4f8721f6558c34.html). Укажите для SAP HANA обмен данными между узлами во время установки или после этого с помощью, например, локальный hdblcm внутренней сети. Дополнительные сведения см. в разделе [2183363 # Примечание SAP](https://launchpad.support.sap.com/#/notes/2183363). 

После этого процедура установки конфигурации горизонтального масштабирования, которые вы установили используются не совместно диски для запуска/hana/Data и/hana/log. Том/hana/shared помещается в высокой доступности для общей папки NFS.


## <a name="sap-hana-dynamic-tiering-20-for-azure-virtual-machines"></a>SAP HANA 2.0 динамического распределения по уровням для виртуальных машин Azure

Помимо сертификации SAP HANA на виртуальных машинах Azure серии M SAP HANA 2.0 динамического распределения по уровням (DT 2.0) также поддерживается в Microsoft Azure. Ссылки на динамические распределения по уровням документации SAP HANA см. в разделе «Ссылки на DT 2.0 документации» далее в этой статье. Нет никакой разницы в установки продукта, а также ОС, например, с помощью панели SAP HANA внутри виртуальной Машины Azure, но некоторые важные компоненты являются обязательными для Официальная поддержка в Azure. В следующих разделах описываются следующие основные моменты. 

SAP HANA DT 2.0 не поддерживает SAP BW или S4HANA. Основных вариантов использования прямо сейчас приложения являются собственными HANA.


### <a name="overview"></a>Обзор

Ниже приводится обзор поддержки DT 2.0 на платформе Microsoft Azure. Выполните эти обязательные требования, в соответствии с официальной сертификации.

- DT 2.0 необходимо устанавливать на выделенной виртуальной машине Azure Он может не работать на той же виртуальной Машине, где выполняется SAP HANA.
- SAP HANA и виртуальные машины 2.0 DT должны быть развернуты в той же виртуальной сети Azure.
- SAP HANA и виртуальные машины DT 2.0 необходимо развернуть с включенной функцией ускорения сети Azure.
- Тип хранилища для виртуальных машин 2.0 DT, необходимо хранилище Azure класса premium.
- Нескольких дисках Azure должен быть подключен к виртуальной Машине 2.0 DT.
- Создание программного обеспечения требуется RAID или чередующегося тома, с помощью диспетчера логических ТОМОВ или mdadm, с помощью чередования на дисках Azure.

Следующие разделы содержат более подробного объяснения.

![Обзор архитектуры SAP HANA DT 2.0](media/hana-vm-operations/hana-dt-20.PNG)



### <a name="dedicated-azure-vm-for-sap-hana-dt-20"></a>Выделенная виртуальная машина Azure для SAP HANA DT 2.0

В Azure IaaS DT 2.0 поддерживается только на выделенной виртуальной Машине. DT 2.0 не разрешено выполняться на той же виртуальной Машине Azure, где запущен экземпляр HANA. Изначально двух типов виртуальных Машин можно использовать для запуска SAP HANA DT 2.0:

- M64-32ms 
- E32sv3 

Описания типов виртуальных Машин, см. в разделе [размеры виртуальных машин, оптимизированных для памяти](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-memory).

Учитывая основная идея DT 2.0, о разгрузке "горячего" резервирования данных для сокращения затрат, имеет смысл использовать соответствующие размеры виртуальной Машины. Нет строгие правила для возможных сочетаний. Все зависит от конкретной рабочей нагрузки.

В следующей таблице показаны рекомендуемые конфигурации.

| Тип виртуальной машины для SAP HANA | Тип виртуальной машины для DT 2.0 |
| --- | --- | 
| M128ms | M64-32ms |
| M128s | M64-32ms |
| M64ms | E32sv3 |
| M64s | E32sv3 |


Все комбинации сертифицированные SAP HANA виртуальные машины серии M с поддерживаемых 2.0 DT виртуальных машин, таких как M64 32ms и E32sv3, возможны.


### <a name="azure-networking-and-sap-hana-dt-20"></a>Сети Azure и SAP HANA DT 2.0

DT 2.0 для установки на выделенной виртуальной Машине требуется пропускная способность сети между DT 2.0 виртуальной Машиной и виртуальной Машины SAP HANA с как минимум 10 ГБ. Таким образом нужно обязательно поместить все виртуальные машины в той же виртуальной сети Azure и включить функцию ускорения сети Azure.

Дополнительные сведения об ускоренной работе сети Azure см. в разделе [Создание виртуальной машины Linux с ускоренной сетью](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-cli).

### <a name="vm-storage-for-sap-hana-dt-20"></a>Хранилище виртуальной Машины для SAP HANA DT 2.0

В соответствии с DT 2.0 советы и рекомендации Минимальная производительность операций ввода-ВЫВОДА диска является 50 МБ в секунду на физическое ядро. Просмотрев спецификации для двух типов виртуальных Машин Azure, которые поддерживаются для DT 2.0, — максимальное число операций дискового установленное для нее ограничение пропускной способности ввода-ВЫВОДА:

- **E32sv3**:   768 МБ/с, выгружаемом из кэша, что означает, что на 48 МБ/с на физических ядро
- **M64 32ms**:  1000 МБ/с, выгружаемом из кэша, что означает, что доли 62,5 МБ в секунду на физическое ядро

Присоединение нескольких дисках Azure к виртуальной Машине 2.0 DT и создания программного RAID-МАССИВА с помощью чередования на уровне операционной системы для достижения предельного числа пропускную способность дисков на виртуальной Машине является обязательным. Один диск Azure не может обеспечить пропускную способность для достигает максимального виртуальной Машины. Хранилище Azure класса premium является обязательным для выполнения DT 2.0. 

- Дополнительные сведения о типах доступных дисков Azure, см. в разделе [выберите тип диска для виртуальных машин Windows Azure IaaS](../../windows/disks-types.md).
- Дополнительные сведения о том, как создать программный RAID-МАССИВ с помощью mdadm, см. в разделе [Настройка программного RAID на Linux](https://docs.microsoft.com/azure/virtual-machines/linux/configure-raid).
- Дополнительные сведения о том, как Настройка диспетчера логических ТОМОВ для создания чередующегося тома максимальной пропускной способности см. в разделе [Настройка диспетчера логических ТОМОВ на виртуальной Машине Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/configure-lvm).

В зависимости от требований к размеру существуют различные варианты для достижения максимальная пропускная способность виртуальной машины. Ниже приведены возможные конфигурации дисков для томов данных по каждому типу виртуальной машины для DT 2.0, позволяющие достичь верхнего предела пропускной способности для виртуальной машины. Виртуальная машина E32sv3 считается начального уровня для небольших рабочих нагрузок. Если это не достаточно быстро, может потребоваться изменить размер виртуальной Машины, чтобы M64 32ms.

Так как виртуальная машина M64 32ms имеет большой объем памяти, нагрузка операций ввода-ВЫВОДА не может достигнуть предела, особенно для рабочих нагрузок с высокой интенсивностью чтения. Меньшее количество дисков в чередующемся наборе может быть достаточно в зависимости от рабочей нагрузки конкретного клиента. Чтобы вы гарантируете безопасность, следующие конфигурации диска были выбраны для обеспечения максимальной пропускной способности.


| SKU виртуальной машины | Конфигурация диска 1 | Конфигурация диска 2 | Конфигурация диска 3 | Конфигурация диска 4 | Конфигурация диска 5 | 
| ---- | ---- | ---- | ---- | ---- | ---- | 
| M64-32ms | 4 x P50 -> 16 ТБ | 4 x P40 -> 8 ТБ | 5 x P30 -> 5 ТБ | 7 x P20 -> 3,5 ТБ | 8 x P15 -> 2 ТБ | 
| E32sv3 | 3 x P50 -> 12 ТБ | 3 x P40 -> 6 ТБ | 4 x P30 -> 4 ТБ | 5 x P20 -> 2,5 ТБ | 6 x P15 -> 1,5 ТБ | 


Особенно в том случае, если рабочая нагрузка связана с высокой интенсивностью чтения, включать параметр «только для чтения» кэша узла Azure согласно рекомендациям для томов данных программного обеспечения базы данных может повысить производительность ввода-ВЫВОДА. Для журнала транзакций кэша диска Azure узла должен быть «none». 

Начальной точкой, мы рекомендуем использовать размер тома журнала является эвристики 15 процентов от размера данных. Чтобы создать том журнала, используйте другой диск Azure типов в зависимости от требований затрат и пропускной способности. Том журнала высокая пропускная способность ввода-вывода не требуется. 

При использовании виртуальной Машины введите M64 32ms, мы рекомендуем включить [ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/linux/how-to-enable-write-accelerator). Ускоритель записи — это функция Azure, обеспечивающая задержки записи на диск, оптимальной для журнала транзакций. Он доступен только для серии M. Существуют некоторые элементы, которые необходимо учитывать, например максимальное число дисков на тип виртуальной Машины. Дополнительные сведения о ускоритель записи, см. в разделе [включить ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/windows/how-to-enable-write-accelerator).


Ниже приведены несколько примеров, которые помогут размер тома журнала.

| Введите размер тома данных и дисков | дисков и томов журнала введите 1 config | Журнал дисков и томов конфигурация типа 2 |
| --- | --- | --- |
| 4 x P50 -> 16 ТБ | 5 x P20 -> 2,5 ТБ | 3 x P30 -> 3 ТБ |
| 6 x P15 -> 1,5 ТБ | 4 x P6 -> 256 ТБ | 1 x P15 -> 256 ТБ |


Как и для горизонтального масштабирования SAP HANA, в каталог/hana/Shared должны совместно использоваться SAP HANA на виртуальной Машине и виртуальной Машиной 2.0 DT. Мы рекомендуем использовать ту же архитектуру, что и для горизонтального масштабирования SAP HANA с помощью выделенных виртуальных машин, которые действуют как высокодоступного NFS-сервера. Чтобы обеспечить общий том резервного копирования, используйте идентичную конструкцию. Но именно вы решаете, если необходим высокий уровень доступности, или если достаточно использовать выделенную виртуальную Машину с достаточной емкостью хранилища в качестве резервной копии сервера.



### <a name="links-to-dt-20-documentation"></a>Ссылки на документацию по DT 2.0 

- [SAP HANA динамического распределения по уровням установке и обновлению](https://help.sap.com/viewer/88f82e0d010e4da1bc8963f18346f46e/2.0.03/en-US)
- [SAP HANA динамического распределения по уровням учебники и ресурсы](https://help.sap.com/viewer/fb9c3779f9d1412b8de6dd0788fa167b/2.0.03/en-US)
- [SAP HANA динамического распределения по уровням подтверждения концепции](https://blogs.sap.com/2017/12/08/sap-hana-dynamic-tiering-delivering-on-low-tco-with-impressive-performance/)
- [SAP HANA 2.0 SPS 02 dynamic tiering enhancements](https://blogs.sap.com/2017/07/31/sap-hana-2.0-sps-02-dynamic-tiering-enhancements/) (Улучшения SAP HANA Dynamic Tiering SPS 02)




## <a name="operations-for-deploying-sap-hana-on-azure-vms"></a>Операции развертывания SAP HANA на виртуальных машинах Azure
В следующих разделах описаны некоторые операции, связанные с развертыванием систем SAP HANA на виртуальных машинах Azure.

### <a name="back-up-and-restore-operations-on-azure-vms"></a>Операции архивации и восстановления на виртуальных машинах Azure
Следующие документы содержат сведения об архивации и восстановлении развертывания SAP HANA:

- [Обзор резервного копирования SAP HANA](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-backup-guide)
- [Резервное копирование SAP HANA на уровне файлов](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-backup-file-level)
- [Резервное копирование SAP HANA на основе моментальных снимков хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-backup-storage-snapshots)


### <a name="start-and-restart-vms-that-contain-sap-hana"></a>Запуск и перезапуск виртуальных машин с SAP HANA
Отличительной чертой общедоступного облака Azure является то, что плата взимается только за время вычисления. Например при завершении работы виртуальной Машины под управлением SAP HANA, вы получите счет только за расходы на хранение в течение этого времени. Другая функция доступна при указании статических IP-адресов для виртуальных машин в начальном развертывании. Если перезагрузить виртуальную машину с SAP HANA, она перезапустится с предыдущим IP-адресом. 


### <a name="use-saprouter-for-sap-remote-support"></a>Удаленная поддержка SAP с помощью SAPRouter
Если у вас есть подключение "сеть сеть" между локальными расположениями и Azure и используете компоненты SAP, вероятно, уже запустили SAProuter. В этом случае выполните следующие действия для поддержки удаленного управления.

- Сохраните частный и статический IP-адрес виртуальной машины, на которой размещается SAP HANA, в конфигурации SAProuter.
- Настройте группу безопасности сети подсети, в которой размещена виртуальная машина HANA, чтобы разрешить трафик через порт TCP/IP 3299.

Если подключение к Azure через Интернет и у вас нет маршрутизатора SAP для виртуальной Машины с SAP HANA, установите компонент. Установите SAProuter на отдельной виртуальной Машине в подсети управления. 

На следующем рисунке показана примерная схема для развертывания SAP HANA с SAProuter и без подключения "сеть — сеть":

![Примерная схема развертывания SAP HANA без подключения "сеть — сеть" и SAProuter](media/hana-vm-operations/hana-simple-networking3.PNG)

Не забудьте установить SAProuter на отдельной виртуальной Машине, а не на виртуальной Машине JumpBox. Отдельная виртуальная машина должна иметь статический IP-адрес. Чтобы подключить ваш SAProuter к SAProuter, размещенный в SAP, обратитесь к SAP для IP-адресом. SAProuter, размещенный в SAP является аналогом экземпляра SAProuter, установите на виртуальной Машине. С помощью IP-адреса SAP можно настроить экземпляр SAProuter. В параметрах конфигурации требуется только TCP-порт 3299.

Дополнительные сведения о том, как настроить и поддерживать подключения удаленной поддержки через SAProuter, см. в разделе [документации по SAP](https://support.sap.com/en/tools/connectivity-tools/remote-support.html).

### <a name="high-availability-with-sap-hana-on-azure-native-vms"></a>Высокий уровень доступности SAP hana на собственных виртуальных машинах Azure
Если вы запустите SUSE Linux Enterprise Server 12 SP1 для приложений SAP или более поздней версии, можно установить кластер Pacemaker с устройствами STONITH. С помощью этих устройств можно настроить конфигурацию SAP HANA, которая использует синхронную репликацию с репликацией системы HANA и автоматической отработки отказа. Дополнительные сведения о процедуре установки см. в разделе [руководство высокого уровня доступности SAP HANA для виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-hana-availability-overview).
