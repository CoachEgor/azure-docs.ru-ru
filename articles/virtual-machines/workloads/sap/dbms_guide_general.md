---
title: Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure | Документы Майкрософт
description: Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/04/2018
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a852ddc68a6f51e677e5ff2e641ada25f4bf0105
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "70101362"
---
# <a name="considerations-for-azure-virtual-machines-dbms-deployment-for-sap-workload"></a>Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure
[1114181]:https://launchpad.support.sap.com/#/notes/1114181
[1409604]:https://launchpad.support.sap.com/#/notes/1409604
[1597355]:https://launchpad.support.sap.com/#/notes/1597355
[1928533]:https://launchpad.support.sap.com/#/notes/1928533
[1984787]:https://launchpad.support.sap.com/#/notes/1984787
[1999351]:https://launchpad.support.sap.com/#/notes/1999351
[2002167]:https://launchpad.support.sap.com/#/notes/2002167
[2015553]:https://launchpad.support.sap.com/#/notes/2015553
[2039619]:https://launchpad.support.sap.com/#/notes/2039619
[2069760]:https://launchpad.support.sap.com/#/notes/2069760
[2171857]:https://launchpad.support.sap.com/#/notes/2171857
[2178632]:https://launchpad.support.sap.com/#/notes/2178632
[2191498]:https://launchpad.support.sap.com/#/notes/2191498
[2233094]:https://launchpad.support.sap.com/#/notes/2233094
[2243692]:https://launchpad.support.sap.com/#/notes/2243692
[deployment-guide]:deployment-guide.md
[deployment-guide-3]:deployment-guide.md#b3253ee3-d63b-4d74-a49b-185e76c4088e
[planning-guide]:planning-guide.md

[Logo_Linux]:media/virtual-machines-shared-sap-shared/Linux.png
[Logo_Windows]:media/virtual-machines-shared-sap-shared/Windows.png


[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-rm-include.md)]

Это руководство является частью документации о том, как реализовать и развернуть программное обеспечение SAP в Microsoft Azure. Прежде чем вы читаете это руководство, прочитайте [руководство по планированию и реализации][planning-guide]. Этот документ охватывает общие аспекты развертывания систем DBMS, связанных с SAP, на виртуальных машинах Microsoft Azure (VMs) с помощью инфраструктуры Azure в качестве службы (IaaS).

Документ дополняет документацию по установке SAP и SAP Notes, которые представляют собой основные ресурсы для установки и развертывания программного обеспечения SAP на данных платформах.

В этом документе рассматриваются вопросы запуска связанных с SAP систем СУБД на виртуальных машинах Azure. Также здесь приводятся ссылки на конкретные СУБД. Вместо этого, после этого документа в настоящем документе обрабатываются конкретные системы DBMS.

## <a name="definitions"></a>Определения
На протяжении всего документа используются следующие термины:

* **IaaS**: Инфраструктура как услуга.
* **PaaS**: Платформа как услуга.
* **SaaS**: Программное обеспечение как услуга.
* **Компонент SAP**: индивидуальное приложение SAP, такое как центральный компонент ERP (ECC), бизнес-склад (BW), менеджер решений или корпоративный портал (EP). Компоненты SAP могут быть основаны на традиционных технологиях ABAP или Java или на приложении, не основанном на NetWeaver, таких как бизнес-объекты.
* **Среда SAP**: Один или несколько компонентов SAP логически сгруппированы для выполнения бизнес-функций, таких как разработка, обеспечение качества, обучение, аварийное восстановление или производство.
* **SAP пейзаж**: Этот термин относится ко всем активам SAP в ИТ-ландшафте клиента. Ландшафт SAP включает в себя все производственные и непроизводственные среды.
* **Система SAP**: Сочетание слоя DBMS и уровня приложения, например, системы разработки SAP ERP, системы тестирования SAP Business Warehouse или производственной системы SAP CRM. В развертывании Azure разделение этих двух слоев между помещениями и Azure не поддерживается. В результате система SAP либо развернута на месте, либо развернута в Azure. Можно развернуть различные системы ландшафта SAP в Azure или на месте. Например, можно развернуть системы разработки и тестирования SAP CRM в Azure, но развернуть производственную систему SAP CRM на месте.
* **Кросс-пределок**: Описывает сценарий, при котором в сети Будут развернуты информационные технологии Azure, которая имеет подключение сайта к сайту, мультисайту или Azure ExpressRoute между центрами обработки данных и Azure. В документации Azure развертывания такого рода также называются распределенными развертываниями. 

    Такое подключение используется для расширения в Azure локальных доменов, локальной службы Active Directory и локальной службы DNS. Локальная среда распространяется на ресурсы Azure, входящие в подписку. При таком расширении виртуальные машины могут быть частью локального домена. Пользователи домена в предварительном домене могут получить доступ к серверам и запустить службы на этих VMs, как dBMS услуг. Возможно взаимодействие и разрешение имен между виртуальными машинами, развернутыми в локальной сети и Azure. Этот сценарий является наиболее распространенным сценарием для развертывания ресурсов SAP в Azure. Дополнительные сведения см. в разделе [Планирование и проектирование VPN-шлюза](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-plan-design).

> [!NOTE]
> Кросс-пределость развертывания систем SAP , где Azure виртуальные машины, которые работают SAP системы являются членами предварительного домена и поддерживаются для производства Систем SAP. Распределенная конфигурация предполагает развертывание в Azure полного ландшафта SAP или его частей. Даже запуск полного ландшафта SAP в Azure требует, чтобы эти VMs были частью локтевого домена и Active Directory/LDAP. 
>
> В предыдущих версиях документации упоминались сценарии гибридно-ИТ. Термин *гибрид* коренится в том, что существует межпределоктная связь между натерритории и Azure. В этом случае гибрид также означает, что VMs в Azure являются частью предпособного Active Directory.
>
>

В некоторых документах Майкрософт сценарии кросс-предпосылок описаны немного по-другому, особенно для конфигураций высокой доступности DBMS. В случае документов, связанных с SAP, кросс-предпосылки сценария сводится к подключению от сайта к сайту или частному [подключению ExpressRoute](https://azure.microsoft.com/services/expressroute/) и ландшафту SAP, который распределяется между местными и Azure.

## <a name="resources"></a>Ресурсы
Есть и другие статьи, доступные на рабочей нагрузке SAP на Azure. Начните с [рабочей нагрузки SAP на Azure: приступайте](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/get-started) к работе, а затем выберите интересуемые области.

Следующие примечания SAP связаны с SAP на Azure в отношении области, охватываемой в этом документе.

| Номер примечания | Заголовок |
| --- | --- |
| [1928533] |Приложения SAP в Azure: поддерживаемые продукты и типы Azure VM |
| [2015553] |SAP на Microsoft Azure: предпосылки поддержки |
| [1999351] |Устранение неполадок, связанных с расширенным мониторингом Azure для SAP |
| [2178632] |Ключевые метрики мониторинга для SAP в Microsoft Azure |
| [1409604] |Виртуализация на Windows: Улучшенный мониторинг |
| [2191498] |SAP на Linux с Azure: Улучшенный мониторинг |
| [2039619] |SAP-приложения на Microsoft Azure с использованием базы данных Oracle: поддерживаемые продукты и версии |
| [2233094] |DB6: SAP-приложения на Azure с использованием IBM DB2 для Linux, UNIX и Windows: Дополнительная информация |
| [2243692] |Linux на виртуальной машине Microsoft Azure (IaaS): проблемы с лицензированием SAP |
| [1984787] |SUSE LINUX Enterprise Server 12: примечания к установке |
| [2002167] |Red Hat Enterprise Linux 7.x: Установка и обновление |
| [2069760] |Установка и обновление Oracle Linux 7.x SAP |
| [1597355] |Рекомендация по области буфера для Linux |
| [2171857] |Oracle Database 12c: Поддержка файловой системы на Linux |
| [1114181] |Oracle Database 11g: Поддержка файловой системы на Linux |


Для получения информации обо всех SAP Примечания для Linux, см [SAP сообщества вики](https://wiki.scn.sap.com/wiki/display/HOME/SAPonLinuxNotes).

Вам необходимы рабочие знания архитектуры Microsoft Azure и развертывания и эксплуатации виртуальных машин Microsoft Azure. Для получения дополнительной информации смотрите [документацию Azure](https://docs.microsoft.com/azure/).

В целом, установка и конфигурация Windows, Linux и DBMS по существу такие же, как и любая виртуальная машина или голая металлическая машина, которую вы устанавливаете в помещениях. При использовании Azure IaaS существуют различные решения по внедрению архитектуры и управления системой. В этом документе разъясняется специфика управления архитектурой и системой при использовании Azure IaaS.


## <a name="storage-structure-of-a-vm-for-rdbms-deployments"></a><a name="65fa79d6-a85f-47ee-890b-22e794f51a64"></a>Структура хранения VM для развертывания RDBMS
Чтобы следовать этой главе, прочитайте и поймите информацию, представленную в [этой главе][deployment-guide-3] Руководства [по развертыванию][deployment-guide]. Вы должны понимать и знать о различных VM-серии и различия между стандартным и премиум хранения, прежде чем читать эту главу. 

Чтобы узнать о хранилище Azure для VMs Azure, см.:

- [Введение в управляемые диски для Пазур Windows VMs](../../windows/managed-disks-overview.md).
- [Введение в управляемые диски для VMs-иносов Azure Linux.](../../linux/managed-disks-overview.md)

В базовой конфигурации мы обычно рекомендуем структуру развертывания, в которой операционная система, DBMS и возможные файлы SAP отделены от файлов базы данных. Мы рекомендуем, чтобы системы SAP, работающие в виртуальных машинах Azure, имели базовый VHD, или диск, установленный с операционной системой, исполнителями системы управления базами данных и исполнителями SAP. 

Файлы данных dBMS и журналов хранятся в стандартном хранении или премиум-хранилище. Они хранятся в отдельных дисках и прикрепляются в качестве логических дисков к исходному изображению операционной системы Azure VM. Для развертывания Linux документируются различные рекомендации, особенно для SAP HANA.

При планировании макета диска найдите оптимальный баланс между этими элементами:

* Количество файлов данных.
* Число дисков, содержащих файлы.
* Количество операций ввода-вывода для одного диска.
* Пропускная способность каждого диска.
* Количество дополнительных доступных дисков в зависимости от размера виртуальной машины.
* Общая пропускная способность хранилища, которую может предоставить виртуальная машина.
* Задержка для различных типов хранилища Azure.
* ВМ СЛА.

Azure обеспечивает квоту на количество операций ввода-вывода для каждого диска данных. Эти квоты отличаются для дисков, размещенных на стандартном хранении и премиум-хранении. Задержка ввода-вывода для двух типов хранилищ также различается. Премиум-хранилище обеспечивает лучшую задержку вв./о. 

Каждый из различных типов VM имеет ограниченное количество дисков данных, которые можно прикрепить. Другим ограничением является то, что только определенные типы VM могут использовать премиум-хранилище. Как правило, вы решаете использовать определенный тип VM на основе требований к процессору и памяти. Вы также можете рассмотреть требования IOPS, задержки и пропускной памяти дисков, которые обычно масштабируются с количеством дисков или типом дисков премиум-хранилища. Количество IOPS и пропускная емкость, которая будет достигнута на каждом диске может диктовать размер диска, особенно с премиум-памяти.

> [!NOTE]
> При развертывании DBMS мы рекомендуем использовать премиум-хранилище для любых данных, журналов транзакций или файлов повтора. Не имеет значения, хотите ли вы развернуть производственные или непроизводственные системы.

> [!NOTE]
> Чтобы воспользоваться уникальным [vM SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/)компании Azure, все диски, которые прикрепляются, должны быть премиум-типом хранилища, который включает в себя базовый VHD.

> [!NOTE]
> Размещение основных файлов баз данных, таких как данные и файлы журналов, баз данных SAP на оборудовании хранения данных, расположенном в совместно расположенных сторонних центрах обработки данных, прилегающих к центрам обработки данных Azure, не поддерживается. Для рабочих нагрузок SAP для данных и журналов транзакций в базах данных SAP поддерживается только хранилище, представленное как родная служба Azure.

Размещение файлов базы данных и файлов журналов и повторов и тип использовать хранилище Azure определяется требованиями IOPS, задержки и пропускной памяти. Чтобы иметь достаточно IOPS, вы можете быть вынуждены использовать несколько дисков или использовать больший премиум диск хранения. Если вы используете несколько дисков, создайте программную полосу на дисках, которые содержат файлы данных или файлы журнала и повтора. В таких случаях IOPS и дисковая пропускная часть SLAs базовых дисков премиум-хранилища или максимально достижимые IOPS стандартных дисков хранения накапливаются для результирующего набора полос.

Как уже отмечалось, если ваше требование IOPS превышает то, что может обеспечить один VHD, уравновейтесь количеству IOPS, которые необходимы для файлов базы данных в ряде VHD. Самый простой способ распределить нагрузку IOPS по дискам — построить программную полосу по различным дискам. Затем поместите ряд файлов данных SAP DBMS на LUNs, вырезанные из программной полосы. Количество дисков в полосе определяется требованиями IOPs, требованиями пропускной записи диска и требованиями к объему.


---
> ![Windows][Logo_Windows] Windows
>
> Мы рекомендуем использовать пробелы для хранения данных Windows для создания наборов полос на нескольких DVD-площадках Azure. Используйте по крайней мере Windows Server 2012 R2 или Windows Server 2016.
>
> ![Linux][Logo_Linux] Linux
>
> Только MDADM и логический менеджер по объему (LVM) поддерживаются для создания программного обеспечения RAID на Linux. Дополнительные сведения см. в разделе:
>
> - [Настройка программного обеспечения RAID на Linux](https://docs.microsoft.com/azure/virtual-machines/linux/configure-raid) с помощью MDADM
> - [Настройка диспетчера логических томов на виртуальной машине Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/configure-lvm) с помощью диспетчера логических томов
>
>

---

> [!NOTE]
> Поскольку Azure Storage хранит три изображения VHD, нет смысла настраивать избыточность при полоске. Вам нужно только настроить полоску так, чтобы ввоспроцание было распределено по различным VHD.
>

### <a name="managed-or-nonmanaged-disks"></a>Управляемые или неуправляемые диски
Учетная запись хранения Azure является административной конструкцией, а также предметом ограничений. Ограничения различаются между стандартными учетными записями хранения и премиум-аккаунтами хранения. Для получения информации о [Azure Storage scalability and performance targets](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets)возможностях и ограничениях см.

При стандартном хранении помните, что на учетную запись IOPS на одну учетную запись приходится ограничение. Просмотреть строку, содержащую **общий коэффициент запроса,** можно в статье [Azure Storage, ориентировоспособности и производительности.](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets) Существует также первоначальный лимит на количество учетных записей хранилища в подписке Azure. Баланс VHDs для большего ландшафта SAP через различные учетные записи хранения, чтобы избежать попадания в пределы этих учетных записей хранения. Это утомительная работа, когда вы говорите о нескольких сотнях виртуальных машин с более чем тысячей VHD.

Поскольку использование стандартного хранилища для развертывания DBMS в сочетании с рабочей нагрузкой SAP не рекомендуется, ссылки и рекомендации по стандартному хранению ограничены этой короткой [статьей](https://blogs.msdn.com/b/mast/archive/2014/10/14/configuring-azure-virtual-machines-for-optimal-storage-performance.aspx)

Чтобы избежать административной работы по планированию и развертыванию VHD-накопителях в различных учетных записях хранения Azure, корпорация Майкрософт представила [управляемые диски Azure](https://azure.microsoft.com/services/managed-disks/) в 2017 году. Управляемые диски доступны для стандартного хранения и премиум-памяти. Основными преимуществами управляемых дисков по сравнению с неуправляемыми дисками являются:

- Для управляемых дисков Azure автоматически распределяет различные VHD по разным учетным записям хранения во время развертывания. Таким образом, ограничения на хранение учетных записей для объема данных, пропускной связи ввода/от и IOPS не появляются.
- Используя управляемые диски, Azure Storage выполняет концепции наборов доступности Azure. Если VM является частью набора доступности Azure, базовый VHD и прилагаемый диск VM развертываются в различные домены неисправности и обновления.


> [!IMPORTANT]
> Учитывая преимущества управляемых дисков Azure, мы рекомендуем использовать управляемые диски Azure для развертывания DBMS и SAP в целом.
>

Чтобы преобразовать из неуправляемых управляемых дисков, см.:

- [Преобразование виртуальной машины Windows с неуправляемых дисков на управляемые диски.](https://docs.microsoft.com/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks)
- [Преобразуйте виртуальную машину Linux с неуправляемых дисков на управляемые диски.](https://docs.microsoft.com/azure/virtual-machines/linux/convert-unmanaged-to-managed-disks)


### <a name="caching-for-vms-and-data-disks"></a><a name="c7abf1f0-c927-4a7c-9c1d-c7b5b3b7212f"></a>Кэширование для виртуальных машин и дисков данных
При установке дисков на ВМ можно выбрать, кэшируется ли трафик ввоза между VM и дисками, расположенными в хранилище Azure. Стандартные и премиум-хранилища используют две различные технологии для этого типа кэша.

Следующие рекомендации предполагают эти характеристики ви/о для стандартных DBMS:

- Это в основном рабочая нагрузка чтения против файлов данных базы данных. Эти считываниявляются имеют решающее значение для системы DBMS.
- Запись в отношении файлов данных происходит в очередях на основе контрольно-пропускных пунктов или постоянного потока. В среднем за день, Есть меньше пишет, чем читает. Напротив считывания файлов данных, эти записи являются асинхронными и не задерживают транзакции пользователей.
- Вряд ли возникнут другие ситуации, когда понадобится чтение из журнала транзакций или файлов повторных операций. Исключениями являются большие висеян/os при выполнении резервных копий журнала транзакций.
- Основная нагрузка на файлы транзакций или повторов оговора записывается. В зависимости от характера рабочей нагрузки, вы можете иметь ви/ос, как малые, как 4 КБ или, в других случаях, ви-о размеров 1 МБ или более.
- Все записи должны быть упорствоваты на диске в надежном способе.

Для стандартного хранения возможные типы кэша:

* None
* Чтение
* Чтение/запись

Чтобы получить последовательную и детерминированную производительность, установите кэширование на стандартном хранилище для всех дисков, содержащих файлы данных, связанные с DBMS, журнал и повтор файлов, и пространство таблицы **нет.** Для параметров кэширования основного виртуального жесткого диска можно оставить значения по умолчанию.

Для премиум-хранилища существуют следующие варианты кэширования:

* None
* Чтение
* Чтение/запись
* Ни один - Напишите ускоритель, который предназначен только для VMs-м номерами Azure M-Series
* Читать и писать ускоритель, который только для Azure M-серии VMs

Для премиум-хранилища мы рекомендуем использовать **кэширование Read для файлов данных** базы данных SAP и выбрать **некэширование для дисков файла журнала (ы)**.

При развертывании M-Series мы рекомендуем использовать Azure Write Accelerator для развертывания DBMS. Для получения подробной информации, ограничений и развертывания ускорителя записи Azure Write [см.](https://docs.microsoft.com/azure/virtual-machines/windows/how-to-enable-write-accelerator)


### <a name="azure-nonpersistent-disks"></a>Неустойчивые диски Azure
VMs Azure предлагают неустойчивые диски после развертывания VM. В случае перезагрузки VM все содержимое на этих дисках уничтожается. Это учитывая, что файлы данных и журнал и переделы данных баз данных ни при каких обстоятельствах не должны быть расположены на этих неиссякаемых дисках. Для некоторых баз данных могут быть исключения, где эти неустойкие диски могут быть пригодны для временных и временных таблиц. Избегайте использования этих дисков для VMs-серии A, потому что эти неустойкие диски ограничены пропускной всей в этом семейством VM. 

Для получения дополнительной информации [см.](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/)

---
> ![Windows][Logo_Windows] Windows
>
> Drive D в Azure VM — это неподдерживаемый диск, который поддерживается некоторыми локальными дисками на вычислительном узле Azure. Из-за того, что при перезагрузке VM происходит перезагрузка, любые изменения, внесенные в содержимое диска D, теряются. Изменения включают файлы, которые были сохранены, каталоги, которые были созданы, и приложения, которые были установлены.
>
> ![Linux][Logo_Linux] Linux
>
> Linux Azure VMs автоматически монтируют диск на/mnt/ресурсе, который является неподдерживаемым диском, поддерживаемым локальными дисками на вычислительном узле Azure. Из-за того, что при перезагрузке VM происходит перезагрузка, любые изменения, внесенные в содержимое в /mnt/ресурсе, теряются при перезагрузке VM. Изменения включают файлы, которые были сохранены, каталоги, которые были созданы, и приложения, которые были установлены.
>
>

---



### <a name="microsoft-azure-storage-resiliency"></a><a name="10b041ef-c177-498a-93ed-44b3441ab152"></a>Устойчивость службы хранилища Microsoft Azure
Microsoft Azure Storage хранит базовый VHD с ОС и прикрепленными дисками или каплями, по крайней мере, на трех отдельных узлах хранения. Этот тип хранилища называется локально избыточным хранилищем (LRS). LRS — это значение по умолчанию для всех типов хранения в Azure.

Существуют и другие методы избыточности. Для получения дополнительной информации смотрите [репликацию хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy?toc=%2fazure%2fstorage%2fqueues%2ftoc.json).

> [!NOTE]
>Премиум-хранилище является рекомендуемым типом хранилища для DBMS VMs и дисков, которые хранят базу данных и журнал и повторфайлов. Единственным доступным методом избыточности для премиум-хранилища является LRS. В результате необходимо настроить методы базы данных, чтобы можно было воспроизввести данные базы данных в другой области или зоне доступности Azure. Методы баз данных включают в себя S'L Server Always On, Oracle Data Guard и репликацию системы HANA.


> [!NOTE]
> Для развертывания DBMS использование геоизбыточного хранилища (GRS) не рекомендуется для стандартного хранения. GRS серьезно влияет на производительность и не выполняет заказ на запись в различных VHD, которые прикреплены к VM. Нечесть порядка записи через различные VHDs потенциально приводит к несовместимым баз данных на стороне репликации целевой стороны. Эта ситуация возникает, если базы данных и журнал и повтор файлы распространяются по нескольким VHD, как это обычно бывает, на стороне источника VM.



## <a name="vm-node-resiliency"></a>Устойчивость узлов виртуальной машины
Azure предлагает несколько различных SLAs для VMs. Для получения дополнительной информации, смотрите последний релиз [SLA для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/). Поскольку слой DBMS обычно имеет решающее значение для доступности в системе SAP, необходимо понимать наборы доступности, зоны доступности и события обслуживания. Для получения дополнительной информации об этих концепциях [см. Управление доступностью виртуальных компьютеров Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability) и [управление наличием виртуальных машин Linux в Azure.](https://docs.microsoft.com/azure/virtual-machines/linux/manage-availability)

Минимальная рекомендация для сценариев производства DBMS с рабочей нагрузкой SAP заключается в:

- Развертывание двух ВМ в отдельном наборе доступности в том же регионе Azure.
- Запустите эти два Виртуальных ВМ в той же виртуальной сети Azure и прикрепите NICs из одних и тех же подсетей.
- Используйте методы базы данных для сервера горячей замены на второй виртуальной машине. Можно использовать такие методы, как SQL Server AlwaysOn, Oracle Data Guard и репликация системы HANA.

Вы также можете развернуть третий VM в другом регионе Azure и использовать те же методы базы данных для предоставления асинхронной реплики в другом регионе Azure.

Для получения информации о том, как настроить наборы доступности Azure, смотрите [этот учебник.](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-availability-sets)



## <a name="azure-network-considerations"></a>Соображения сети Azure
При крупномасштабных развертываниях SAP используйте чертеж [виртуального центра обработки данных Azure.](https://docs.microsoft.com/azure/architecture/vdc/networking-virtual-datacenter) Используйте его для виртуальной конфигурации сети, а также разрешений и назначений ролей в различных частях организации.

Эти рекомендации являются результатом сотен развертываний клиентов:

- Виртуальные сети, в которые развернуто приложение SAP, не имеют доступа к Интернету.
- Виртуальные технологии базы данных работают в той же виртуальной сети, что и слой приложения.
- Виртуальные виртуальные технологии имеют статическое распределение частного IP-адреса. Для получения дополнительной информации смотрите [типы IP-адресов и методы распределения в Azure.](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm)
- Ограничения на реутрию к И из DBMS VMs *не* устанавливаются с брандмауэрами, установленными на локальных DBMS VMs. Вместо этого, трафик разгрома определяется с [группами сетевой безопасности (NSGs)](https://docs.microsoft.com/azure/virtual-network/security-overview).
- Чтобы отделить и изолировать трафик на DBMS VM, назначаем различные NICs VM. Каждый NIC получает другой IP-адрес, и каждый NIC назначается другой виртуальной сетевой подсети. Каждая подсеть имеет различные правила NSG. Изоляция или разделение сетевого трафика является мерой для разгрома. Он не используется для установки квот для пропускной связи сети.

> [!NOTE]
> Назначение статических IP-адресов через Azure означает присвоение их отдельным виртуальным NICs. Не присваивайте статические IP-адреса в гостевой ОС виртуальному NIC. Некоторые службы Azure, такие как Azure Backup, полагаются на то, что, по крайней мере, основной виртуальный NIC настроен на DHCP, а не на статические IP-адреса. Для получения дополнительной информации смотрите [резервное копирование виртуальной машины Troubleshoot Azure.](https://docs.microsoft.com/azure/backup/backup-azure-vms-troubleshoot#networking) Чтобы назначить несколько статических IP-адресов VM, назначаем несколько виртуальных NICs VM.
>


> [!IMPORTANT]
> Настройка [сетевых виртуальных приборов](https://azure.microsoft.com/solutions/network-appliances/) на пути связи между приложением SAP и слоем DBMS системы SAP NetWeaver-, Hybris-, или S/4HANA не поддерживается. Это ограничение предназначено для функциональности и производительности. Путь связи между слоем приложения SAP и слоем DBMS должен быть прямым. Ограничение не включает в себя [правила безопасности приложений (ASG) и NSG,](https://docs.microsoft.com/azure/virtual-network/security-overview) если эти правила ASG и NSG позволяют прямой путь связи. 
>
> Другие сценарии, в которых сетевые виртуальные приборы не поддерживаются, находятся в:
>
> * Пути связи между VMs-технологиями Azure, представляющими кластерные узлы Linux Pacemaker и устройства SBD, описанные в [Высокой доступности для SAP NetWeaver на Azure VMs на SUSE Linux Enterprise Server для SAP-приложений.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse)
> * Пути связи между Azure VMs и Windows Server Scale Out File Server (SOFS), настроенными в описанном в [кластере экземпляра SAP ASCS/SCS на кластере сбоя Windows, с помощью доли файлов в Azure.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-high-availability-guide-wsfc-file-share) 
>
> Сетевые виртуальные приборы на путях связи могут легко удвоить задержку сети между двумя партнерами связи. Они также могут ограничивать пропускную связь в критических путях между слоем приложения SAP и слоем DBMS. В некоторых сценариях клиентов сетевые виртуальные приборы могут привести к сбою кластеров Pacemaker Linux. Это случаи, когда связь между кластерными узлами Linux Pacemaker передается на устройство SBD через сетевой виртуальный прибор.
>

> [!IMPORTANT]
> Другой не *поддерживается* эта конструкция — это разделение слоя приложений SAP и DBMS в различные виртуальные сети Azure, которые не [работаются](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) друг с другом. Мы рекомендуем сегрегировать слой приложения SAP и DBMS, используя подсети в виртуальной сети Azure, а не с помощью различных виртуальных сетей Azure. 
>
> Если вы решите не следовать рекомендации и вместо этого сегрегировать два слоя в разных виртуальных сетях, две виртуальные сети должны быть [заглянул](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview). 
>
> Имейте в виду, что сетевой трафик между двумя [заглядными](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) виртуальными сетями Azure подлежит затратам на передачу. Огромный объем данных, состоящий из множества терабайт, обменивается между слоем приложения SAP и слоем DBMS. Можно накопить значительные затраты, если слой приложения SAP и слой DBMS разделены между двумя заглядными виртуальными сетями Azure.

Используйте два ВМ для развертывания DBMS в комплекте доступности Azure. Также используйте отдельную routing для уровня приложения SAP и трафик управления и операций на двух DBMS VMs. См. следующее изображение:

![Схема двух виртуальных машин в двух подсетях](./media/virtual-machines-shared-sap-deployment-guide/general_two_dbms_two_subnets.PNG)


### <a name="use-azure-load-balancer-to-redirect-traffic"></a>Используйте балансер загрузки Azure для перенаправления трафика
Использование частных виртуальных IP-адресов, используемых в функциональных возможностях, таких как S'L Server Always On или HANA System Replication, требует конфигурации балансирующего нагрузочная нагрузка Azure. Балансилер нагрузки использует порты зонда для определения активного узла DBMS и маршрутирования трафика исключительно к этому активному узку базы данных. 

При сбое в узлах базы данных нет необходимости перенастраивать приложение SAP. Вместо этого наиболее распространенные архитектуры приложений SAP воссоединяются с частным виртуальным IP-адресом. Между тем, балансомер нагрузки реагирует на сбой узла, перенаправляя трафик против частного виртуального IP-адреса на второй узлы.

Azure предлагает два различных [балансораля нагрузки SKUs:](https://docs.microsoft.com/azure/load-balancer/load-balancer-overview)базовый SKU и стандартный SKU. Если вы не хотите развертывать в зонах доступности Azure, базовый балансик нагрузки SKU делает хорошо.

Трафик между VMs-м M DBMS и слоем приложений SAP всегда распределяется через балансера нагрузки все время? Ответ зависит от того, как настроить подсистему балансировки нагрузки. 

В это время входящий трафик на DBMS VM всегда направляется через балансера нагрузки. Исходящий маршрут движения от DBMS VM к уровеньу приложения VM зависит от конфигурации балансиста нагрузки. 

В подсистеме балансировки нагрузки можно установить значение параметра DirectServerReturn. Если эта опция настроена, трафик, направленный от DBMS VM к слою приложения SAP, *не* направляется через балансера нагрузки. Вместо этого он идет непосредственно к слою приложения. Если DirectServerReturn не настроен, обратный трафик на слой приложения SAP направляется через баланселист нагрузки.

Мы рекомендуем настроить DirectServerReturn в сочетании с балансиюрами нагрузки, которые расположены между слоем приложения SAP и слоем DBMS. Эта конфигурация уменьшает задержку сети между двумя слоями.

Например, как настроить эту конфигурацию с помощью s'L Server Always On, [см.](https://docs.microsoft.com/azure/virtual-machines/windows/sqlclassic/virtual-machines-windows-classic-ps-sql-int-listener)

Если вы используете опубликованные шаблоны GitHub JSON в качестве ссылки на развертывание инфраструктуры SAP в Azure, изучите этот [шаблон для системы SAP 3-Tier.](https://github.com/Azure/azure-quickstart-templates/tree/4099ad9bee183ed39b88c62cd33f517ae4e25669/sap-3-tier-marketplace-image-converged-md) В этом шаблоне также можно увидеть правильные настройки для балансиваля нагрузки.

### <a name="azure-accelerated-networking"></a>Ускорение работы в сети Azure
Для дальнейшего снижения задержки сети между VMs-ми займами Azure рекомендуется выбрать [ускоренную сеть Azure.](https://azure.microsoft.com/blog/maximize-your-vm-s-performance-with-accelerated-networking-now-generally-available-for-both-windows-and-linux/) Используйте его при развертывании MMs Azure для рабочей нагрузки SAP, особенно для уровня приложения SAP и слоя SAP DBMS.

> [!NOTE]
> Не все типы VM поддерживают ускоренную сеть. Предыдущая статья перечисляет типы VM, которые поддерживают ускоренную сеть.
>

---
> ![Windows][Logo_Windows] Windows
>
> Чтобы узнать, как развернуть виртуальные компьютеры с ускоренной сетью для Windows, [см.](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-powershell)
>
> ![Linux][Logo_Linux] Linux
>
> Для получения дополнительной информации о дистрибутиве Linux [см.](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-cli)
>
>

---

> [!NOTE]
> Для SUSE, Red Hat и Oracle Linux функция ускорения сети поддерживается в новых версиях этих дистрибутивов. Старые релизы, такие как SLES 12 SP2 или RHEL 7.2, не поддерживают ускоренную сеть Azure.
>


## <a name="deployment-of-host-monitoring"></a>Развертывание мониторинга принимающих мест
Для использования приложений SAP в виртуальных машинах Azure SAP требуется возможность получать данные мониторинга хоста от физических узлов, запускаемых виртуальными машинами Azure. Требуется определенный уровень исправлений SAP HostAgent, включающий эту возможность в SAPOSCOL и SAP HostAgent. Точное описание уровня исправлений указано в примечании к SAP [1409604].

Для получения дополнительной информации о развертывании компонентов, которые доставляют данные о хостах sAPOSCOL и SAP Host Agent, а также об управлении этими компонентами жизненного цикла, см. [Deployment guide][deployment-guide]


## <a name="next-steps"></a>Дальнейшие действия
Для получения дополнительной информации о конкретном DBMS см.:

- [Рабочие нагрузки SAP на Виртуальных машинах Azure. Руководство по развертыванию СУБД SQL Server](dbms_guide_sqlserver.md)
- [Рабочие нагрузки SAP на Виртуальных машинах Azure. Руководство по развертыванию СУБД Oracle](dbms_guide_oracle.md)
- [Рабочие нагрузки SAP на Виртуальных машинах Azure. Руководство по развертыванию СУБД IBM DB2](dbms_guide_ibm.md)
- [Рабочие нагрузки SAP на Виртуальных машинах Azure. Руководство по развертыванию СУБД SAP ASE](dbms_guide_sapase.md)
- [Развертывание SAP MaxDB, liveCache и сервера содержимого на виртуальных машинах Azure](dbms_guide_maxdb.md)
- [Руководство по использованию SAP HANA в Azure](hana-vm-operations.md)
- [Обеспечение высокого уровня доступности для SAP HANA на виртуальных машинах Azure](sap-hana-availability-overview.md)
- [Руководство по резервному копированию для SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md)

