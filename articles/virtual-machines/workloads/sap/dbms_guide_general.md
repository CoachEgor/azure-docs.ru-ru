---
title: Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure | Документы Майкрософт
description: Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/04/2018
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 8b19c0fd8af2792a4ffb877e5c6a7fc6b3f94511
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60836132"
---
# <a name="considerations-for-azure-virtual-machines-dbms-deployment-for-sap-workload"></a>Вопросы развертывания СУБД для рабочей нагрузки SAP на виртуальных машинах Azure
[1114181]: https://launchpad.support.sap.com/#/notes/1114181
[1409604]: https://launchpad.support.sap.com/#/notes/1409604
[1597355]: https://launchpad.support.sap.com/#/notes/1597355
[1928533]: https://launchpad.support.sap.com/#/notes/1928533
[1984787]: https://launchpad.support.sap.com/#/notes/1984787
[1999351]: https://launchpad.support.sap.com/#/notes/1999351
[2002167]: https://launchpad.support.sap.com/#/notes/2002167
[2015553]: https://launchpad.support.sap.com/#/notes/2015553
[2039619]: https://launchpad.support.sap.com/#/notes/2039619
[2069760]: https://launchpad.support.sap.com/#/notes/2069760
[2171857]: https://launchpad.support.sap.com/#/notes/2171857
[2178632]: https://launchpad.support.sap.com/#/notes/2178632
[2191498]: https://launchpad.support.sap.com/#/notes/2191498
[2233094]: https://launchpad.support.sap.com/#/notes/2233094
[2243692]: https://launchpad.support.sap.com/#/notes/2243692
[deployment-guide]:deployment-guide.md
[deployment-guide-3]:deployment-guide.md#b3253ee3-d63b-4d74-a49b-185e76c4088e
[planning-guide]:planning-guide.md

[Logo_Linux]:media/virtual-machines-shared-sap-shared/Linux.png
[Logo_Windows]:media/virtual-machines-shared-sap-shared/Windows.png


[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-rm-include.md)]

Это руководство является частью документации о том, как реализовать и развертывание программного обеспечения SAP на платформе Microsoft Azure. Перед прочтением этого руководства, прочитайте [руководство по планированию и внедрению][planning-guide]. В этом документе рассматриваются аспекты универсального развертывания систем СУБД, связанные с SAP на виртуальных машинах Microsoft Azure (ВМ) с помощью инфраструктуры Azure как возможности службы (IaaS).

Это руководство дополняет документацию по установке SAP и примечания к SAP, которые являются основными ресурсами по установке и развертыванию программного обеспечения SAP на упомянутых платформах.

В этом документе рассматриваются вопросы запуска связанных с SAP систем СУБД на виртуальных машинах Azure. Также здесь приводятся ссылки на конкретные СУБД. Вместо этого конкретные СУБД рассматриваются в этот документ, после этого документа.

## <a name="definitions"></a>Определения
Эти термины используются в этом документе:

* **IaaS**: Инфраструктура как услуга.
* **PaaS**: Платформа как услуга.
* **SaaS**: Программное обеспечение как услуга.
* **Компонент SAP**: Отдельное приложение SAP, например ERP Central Component (ECC), Business Warehouse (BW), Solution Manager или Enterprise Portal (EP). Компоненты SAP могут основываться на традиционной технологии ABAP или Java или приложения, не основанного NetWeaver, например бизнес-объектов.
* **Среда SAP**: Один или несколько компонентов SAP, логически сгруппированных для выполнения бизнес-функций, например разработки, контроля качества, обучение, аварийное восстановление или рабочей среде.
* **Ландшафт SAP**: этот термин обозначает все ресурсы SAP, доступные в клиентском ИТ-ландшафте. Ландшафт SAP включает все рабочие и нерабочей среды.
* **Системы SAP**: Сочетание уровня СУБД и уровня приложений, например, системы разработки SAP ERP, SAP Business Warehouse тестирование системы или рабочей системы SAP CRM. Разделение этих двух уровней между локальной сетью и Azure не поддерживается в развертываниях Azure. Таким образом система SAP должна либо развернуть в локальной среде или полностью в Azure. Можно развернуть различные системы ландшафта SAP в Azure или локально. Может, например, развертывание разработки SAP CRM и тестирование системы в Azure но развертывание SAP CRM рабочей системы на предприятии.
* **Распределенное развертывание**: Описывает сценарии, где развернуты виртуальные машины для подписки Azure, включающее "сеть сеть", многосайтового или центры обработки Azure expressroute между локальными данными и Azure. В документации Azure развертывания такого рода также называются распределенными развертываниями. 

    Такое подключение используется для расширения в Azure локальных доменов, локальной службы Active Directory и локальной службы DNS. Локальная среда распространяется на ресурсы Azure, входящие в подписку. При таком расширении виртуальные машины могут быть частью локального домена. Пользователи локального домена можно обращаться к серверам и запуска служб на этих виртуальных машинах, например, службы СУБД. Возможно взаимодействие и разрешение имен между виртуальными машинами, развернутыми в локальной сети и Azure. Этот сценарий является наиболее распространенным сценарием, который используется для развертывания ресурсов SAP в Azure. Дополнительные сведения см. в разделе [Планирование и проектирование VPN-шлюза](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-plan-design).

> [!NOTE]
> Распределенные развертывания систем SAP поддерживаются для производственных систем SAP и где виртуальных машинах под управлением систем SAP являются членами локального домена. Распределенная конфигурация предполагает развертывание в Azure полного ландшафта SAP или его частей. Даже если весь ландшафт SAP работает в Azure требуется этих виртуальных машинах, чтобы быть частью локального домена и Active Directory или LDAP. 
>
> В предыдущих версиях документации сценариях гибридной ИТ-были упомянуты. Термин *гибридных* уходит своими корнями в тот факт, что имеется распределенное подключение между локальной сетью и Azure. В этом случае гибридных также означает, что виртуальные машины в Azure являются частью локальной Active Directory.
>
>

В некоторой документации Майкрософт описывает сценариев распределенного развертывания немного по-другому, особенно для конфигураций высокой доступности СУБД. Документы, связанные с SAP, сценарий распределенного подключения сводится на сайт сайт или частных [ExpressRoute](https://azure.microsoft.com/services/expressroute/) подключения и ландшафта SAP, который распределяется между локальной сетью и Azure.

## <a name="resources"></a>Ресурсы
Доступны другие статьи от рабочей нагрузки SAP в Azure. Начните с [рабочих нагрузок SAP в Azure: Начало работы](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/get-started) и затем выберите вас интересует.

В следующих примечаниях SAP, связаны с SAP в Azure в отношении области, рассматриваемые в данном документе.

| Номер примечания | Название |
| --- | --- |
| [1928533] |Приложения SAP в Azure: поддерживаемые продукты и типы виртуальных машин Azure |
| [2015553] |SAP в Microsoft Azure: необходимые компоненты для поддержки |
| [1999351] |Устранение неполадок, связанных с расширенным мониторингом Azure для SAP |
| [2178632] |Ключевые метрики мониторинга для SAP в Microsoft Azure |
| [1409604] |Виртуализация в Windows: расширенный мониторинг |
| [2191498] |SAP на платформе Linux в Azure: расширенный мониторинг |
| [2039619] |Приложения SAP в Microsoft Azure с использованием Oracle Database: поддерживаемые продукты и версии |
| [2233094] |DB6: Приложения SAP в Azure с помощью IBM DB2 для Linux, UNIX и Windows: Дополнительные сведения |
| [2243692] |Linux на виртуальной машине Microsoft Azure (IaaS): проблемы с лицензированием SAP |
| [1984787] |SUSE Linux Enterprise Server 12 Замечания по установке |
| [2002167] |Red Hat Enterprise Linux 7.x: Установка и обновление |
| [2069760] |Установка и обновление Oracle Linux 7.x SAP |
| [1597355] |Рекомендация по области буфера для Linux |
| [2171857] |База данных Oracle 12c. Поддержка файловой системы в Linux |
| [1114181] |База данных Oracle 11g. Поддержка файловой системы в Linux |


Сведения о все примечания к SAP для Linux, см. в разделе [вики-сайт сообщества SAP](https://wiki.scn.sap.com/wiki/display/HOME/SAPonLinuxNotes).

Требуется знание архитектуры Microsoft Azure и как развертываются и эксплуатируются виртуальные машины Microsoft Azure. Дополнительные сведения см. в разделе [документации Azure](https://docs.microsoft.com/azure/).

В, Windows, Linux и СУБД установку и настройку целом выполняются так же, как любой виртуальной или физической машины установить локально. Есть некоторые архитектуры и системы управления реализации решения, которые отличаются при использовании Azure IaaS. В этом документе объясняется, определенных архитектуры и системные различия управления для подготовки при использовании Azure IaaS.


## <a name="65fa79d6-a85f-47ee-890b-22e794f51a64"></a>Структура хранилища виртуальной Машины для развертывания реляционной СУБД
Чтобы выполнить в этой главе, прочесть и понять сведения, представленные в [в этой главе] [ deployment-guide-3] из [руководство по развертыванию][deployment-guide]. Необходимо понимать и узнать о различных серий виртуальных Машин и различия между "стандартный" и "премиум" хранилище, перед чтением этой главе. 

Дополнительные сведения о службе хранилища Azure для виртуальных машин Azure, см. в разделе:

- [Введение в управляемые диски для виртуальных машин Windows Azure](../../windows/managed-disks-overview.md).
- [Введение в управляемые диски для виртуальных машин Azure Linux](../../linux/managed-disks-overview.md).

В базовой конфигурации мы обычно рекомендуем структуру развертывания, в которой операционная система, СУБД и конечные двоичные файлы SAP отделены от файлов базы данных. Рекомендуется наличие базового виртуального жесткого диска или диска, установлены с операционной системой, исполняемые файлы базы данных СУБД и исполняемые файлы SAP систем SAP, запущенными на виртуальных машинах Azure. 

Файлы данных и журналов СУБД хранятся в хранилище класса standard или premium. Они хранятся в отдельных дисков и присоединяться в качестве логических дисков в исходный образ операционной системы Azure виртуальной Машины. Для развертываний Linux описаны различные рекомендации, особенно для SAP HANA.

При планировании структуры дисков, найти оптимальный баланс между следующими элементами:

* Количество файлов данных.
* Число дисков, содержащих файлы.
* Количество операций ввода-вывода для одного диска.
* Пропускная способность каждого диска.
* Количество дополнительных доступных дисков в зависимости от размера виртуальной машины.
* Общая пропускная способность хранилища, которую может предоставить виртуальная машина.
* Задержка для различных типов хранилища Azure.
* Соглашения об уровне обслуживания виртуальных Машин.

Azure обеспечивает квоту на количество операций ввода-вывода для каждого диска данных. Эти квоты различаются для дисков, размещенных в хранилище класса standard и premium. Задержка ввода-вывода для двух типов хранилищ также различается. Хранилище уровня "премиум" обеспечивает лучшую задержки ввода-вывода. 

Каждый из типов виртуальных Машин имеет ограниченное число дисков данных, которые можно подключить. Другое ограничение состоит в том, что только определенные типы виртуальных Машин можно использовать хранилище класса premium. Как правило вы решили использовать определенного типа виртуальной Машины на основе требований ЦП и памяти. Также может потребоваться операций ввода-ВЫВОДА, задержки и требования к пропускной способности диска, которые обычно масштабируются в число дисков или типа дисков хранилища класса premium. Количество операций ввода-ВЫВОДА и пропускную способность достигаться каждым диском может определять размер диска, особенно при использовании хранилища уровня "премиум".

> [!NOTE]
> Для развертываний СУБД мы рекомендуем использовать хранилище класса premium для любых данных, журнал транзакций или вернуть файлы. Не важно, хотите ли вы развертывать рабочей среды или непроизводственной системы.

> [!NOTE]
> Чтобы использовать преимущества Azure уникальный [соглашения об уровне](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/), все диски, подключенные должен быть тип хранилища уровня "премиум", который включает в себя основной виртуальный жесткий ДИСК.

> [!NOTE]
> Размещение основные файлы базы данных, такие как файлы данных и журналов, баз данных SAP на оборудование для хранения, размещенную в центрах обработки совместно размещенных данных сторонних рядом центров обработки данных Azure не поддерживается. Для рабочих нагрузок SAP только хранилище, которое представляется как служба в машинном коде Azure поддерживается для файлов данных и транзакции журналов баз данных SAP.

Расположение файлов базы данных и файлов журналов и повтора и тип хранилища Azure, можно использовать, определяется требования к операциям ввода-ВЫВОДА, задержке и пропускной способности. Чтобы обеспечить достаточное количество операций ввода-ВЫВОДА, может потребоваться использовать несколько дисков или использовать более крупный диск хранилища уровня "премиум". Если вы используете несколько дисков, построить чередующийся программного обеспечения на дисках, содержащих файлы данных или журнала и вернуть файлы. В таких случаях, операций ввода-ВЫВОДА и пропускная способность дисков соглашения об уровне обслуживания базового хранилища уровня "премиум" являются накопительными итоговый чередующегося набора дисков или максимальное число IOPS достижимые из дисков стандартного хранилища.

Как уже говорилось выше Если требования операций ввода-ВЫВОДА превышает одного виртуального жесткого диска, которые можно предоставить, сбалансировать настраиваемое количество операций ввода-ВЫВОДА, которые необходимы для файлов базы данных на нескольких виртуальных жестких дисков. Для распределения нагрузки операций ввода-ВЫВОДА на дисках проще построить чередующийся программного обеспечения для разных дисков. Затем поместите ряд файлов данных СУБД SAP в LUN, полученные из stripe программного обеспечения. Число дисков в полосе определяется требования операций ввода-вывода, потребности в пропускной способности диска и тома требования.


- - -
> ![Windows][Logo_Windows] Windows
>
> Мы рекомендуем использовать дисковые пространства Windows для создания чередующихся наборов между несколькими виртуальными жесткими дисками Azure. Используйте по меньшей мере Windows Server 2012 R2 или Windows Server 2016.
>
> ![Linux][Logo_Linux] Linux
>
> Чтобы создать программный RAID-МАССИВА в Linux поддерживаются только MDADM и диспетчер логических томов (LVM). Дополнительные сведения можно найти в разделе
>
> - [Настройка программного RAID-МАССИВА в Linux](https://docs.microsoft.com/azure/virtual-machines/linux/configure-raid) с помощью MDADM
> - [Настройка диспетчера логических томов на виртуальной машине Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/configure-lvm) с помощью диспетчера логических томов
>
>

- - -

> [!NOTE]
> Так как служба хранилища Azure хранятся три образа виртуальных жестких дисков, нет смысла настроить избыточность, когда вы создаете чередующийся том. Необходимо настроить чередование, таким образом, чтобы операций ввода-вывода распределяются по разным VHD.
>

### <a name="managed-or-nonmanaged-disks"></a>Управляемых или неуправляемых дисков
Учетную запись хранения является административной конструкцией, а также и предметом ограничений. Ограничения отличаются от стандартных учетных записей и учетных записей хранения уровня "премиум". Сведения о возможностях и ограничениях см. в разделе [целевые показатели масштабируемости и производительности службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets).

Для хранилища класса standard Обратите внимание, что ограничение вывода в СЕКУНДУ на учетную запись хранения. См. в разделе строки, содержащей **общая частота запросов** в этой статье [целевые показатели масштабируемости и производительности службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-scalability-targets). Имеется также изначальное ограничение на число учетных записей хранения в подписке Azure. Баланс виртуальных жестких дисков для ландшафтом SAP в разных учетных записей хранения не превышать ограничения этих учетных записей хранения. Это утомительным, когда речь идет о нескольких сотен виртуальных машин с более тысячи виртуальных жестких дисков.

Так как не рекомендуется использовать хранилище класса standard для развертываний СУБД вместе с рабочей нагрузкой SAP, ссылки и рекомендации для хранилища класса standard ограничены этот короткий [статьи](https://blogs.msdn.com/b/mast/archive/2014/10/14/configuring-azure-virtual-machines-for-optimal-storage-performance.aspx)

Чтобы избежать административной работы, планирования и развертывания виртуальных жестких дисков в учетных записях хранения Azure, корпорация Майкрософт представила [управляемые диски Azure](https://azure.microsoft.com/services/managed-disks/) в 2017 г. Управляемые диски доступны для хранилища класса standard и premium. Перечислены основные преимущества управляемых дисков, по сравнению с неуправляемых дисков.

- Для управляемых дисков Azure распределяет разных виртуальных жестких дисков между разными учетными записями хранения автоматически во время развертывания. Таким образом ограничения учетной записи хранилища для тома данных, способность ввода-вывода и операций ввода-ВЫВОДА не попаданий.
- Использование управляемых дисков, службу хранилища Azure учитывает концепции группы доступности Azure. Если виртуальная машина является частью группы доступности Azure, основной виртуальный жесткий ДИСК и подключенный диск виртуальной машины будут развернуты в разных доменах сбоя и обновления.


> [!IMPORTANT]
> Учитывая преимущества управляемых дисков Azure, мы рекомендуем использовать управляемые диски Azure для развертываний СУБД и развертывании SAP в целом.
>

Переключение с неуправляемых на управляемые диски, см. в разделе:

- [Переключение виртуальной машины Windows с неуправляемых дисков на управляемые диски](https://docs.microsoft.com/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks).
- [Преобразовать виртуальную машину Linux с неуправляемыми дисками для использования управляемых дисков](https://docs.microsoft.com/azure/virtual-machines/linux/convert-unmanaged-to-managed-disks).


### <a name="c7abf1f0-c927-4a7c-9c1d-c7b5b3b7212f"></a>Кэширование для виртуальных машин и дисков данных
При подключении дисков к виртуальным машинам, можно выбрать, будет ли кэшироваться трафик ввода-вывода между виртуальной Машиной и этими дисками, размещенными в службе хранилища Azure. Хранилище класса Standard и premium используются две разные технологии для этого типа кэша.

Следующие рекомендации предполагают этих характеристик ввода-вывода для СУБД standard:

- Это главным образом чтения рабочую нагрузку для файлов данных базы данных. Эти операции выполнялись для СУБД Критическое для производительности.
- Записи с файлами данных происходит периодически, на основе контрольных точек или постоянный поток. Среднее значение за день, существует меньше записей, чем выполнение операций чтения. В отличие от операций чтения из файлов данных эти операции записи являются асинхронными и не выдерживает любые пользовательские транзакции.
- Вряд ли возникнут другие ситуации, когда понадобится чтение из журнала транзакций или файлов повторных операций. Исключениями являются больших операций ввода-вывода при выполнении резервные копии журналов транзакций.
- Основной нагрузки на файлы журнала транзакций или повторяемых операций — операции записи. Зависит от характера рабочей нагрузки, что операции ввода-вывода как меньшего размера, 4 КБ, или в других случаях, объемы ввода-вывода не менее 1 МБ.
- Все операции записи должны сохраняться на диске в виде надежных.

Для хранилища класса standard, возможные типы кэша:

* Нет
* Чтение
* Чтение/запись

Чтобы получить стабильную и предсказуемую производительность, параметра кэширования в стандартном хранилище для всех дисков, содержащих файлы данных СУБД, войдите и вернуть файлы и табличное пространство **NONE**. Для параметров кэширования основного виртуального жесткого диска можно оставить значения по умолчанию.

Для хранилища класса premium существуют следующие режимы кэширования:

* Нет
* Чтение
* Чтение/запись
* Нет + ускоритель записи, которая предназначена только для виртуальных машин Azure серии M
* Чтение + ускоритель записи, которая предназначена только для виртуальных машин Azure серии M

Для хранилища класса premium, мы рекомендуем использовать **кэширование для файлов данных чтения** из SAP базы данных и выберите **без кэширования дисков файлов журнала**.

Для развертываний серии M рекомендуется использовать ускоритель записи Azure для развертывания СУБД. Сведения, ограничения и развертывания ускорителя записи Azure, см. в разделе [включить ускоритель записи](https://docs.microsoft.com/azure/virtual-machines/windows/how-to-enable-write-accelerator).


### <a name="azure-nonpersistent-disks"></a>Временные диски Azure
Виртуальные машины Azure предлагают временные диски после развертывания виртуальной Машины. В случае перезагрузки виртуальной Машины все содержимое на этих дисках стирание. Это учитывая, что файлы данных и файлов журналов и повтора баз данных ни в коем случае находится на этих несохраняемые дисков. Возможны исключения для некоторых баз данных, где эти диски несохраняемые может подходить для базы данных tempdb и временных табличных пространств. Не используйте эти диски для виртуальных машин серии A, поскольку эти диски несохраняемые ограничены в пропускной способности с помощью этого семейства виртуальных Машин. 

Дополнительные сведения см. в разделе [понять временный диск, на виртуальных машинах Windows в Azure](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).

- - -
> ![Windows][Logo_Windows] Windows
>
> Диск D на виртуальной Машине Azure — это несохраняемые диск, поддерживаемый некоторыми локальными дисками на вычислительном узле Azure. Так как это несохраняемые, любые изменения содержимого на диске D, будут потеряны при перезагрузке виртуальной Машины. Изменения включают файлы, которые были сохранены, каталоги, которые были созданы и приложений, которые были установлены.
>
> ![Linux][Logo_Linux] Linux
>
> Виртуальные машины Azure Linux автоматически подключают диск в/mnt/Resource, — это несохраняемые диск, поддерживаемый локальными дисками на вычислительном узле Azure. Так как это несохраняемые, любые изменения, внесенные в содержимое в/mnt/resource теряются при перезагрузке виртуальной Машины. Изменения включают файлы, которые были сохранены, каталоги, которые были созданы и приложений, которые были установлены.
>
>

- - -



### <a name="10b041ef-c177-498a-93ed-44b3441ab152"></a>Устойчивость службы хранилища Microsoft Azure
Служба хранилища Microsoft Azure хранит базового VHD с ОС и подключенные диски или большие двоичные объекты, на по крайней мере три отдельных узла хранилища. Этот тип хранилища, называется локально избыточное хранилище (LRS). LRS используется по умолчанию для всех типов хранения в Azure.

Существуют другие методы обеспечения избыточности. Дополнительные сведения см. в статье [Репликация службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy?toc=%2fazure%2fstorage%2fqueues%2ftoc.json).

> [!NOTE]
>Хранилище уровня "премиум" — рекомендуемый тип хранилища для виртуальных машин СУБД и диски, которые хранения базы данных и журнала и возврата файлов. Метод доступен только избыточности для хранилища уровня "премиум" — LRS. Таким образом необходимо настроить методов базы данных, чтобы включить репликацию базы данных в другую зону Azure регион или доступности. Методы базы данных включают SQL Server Always On, Oracle Data Guard и репликации системы HANA.


> [!NOTE]
> Для развертываний СУБД не рекомендуется использовать географически избыточное хранилище (GRS) для хранилища класса standard. GRS серьезно влияет на производительность и не поддерживает порядок записи для разных виртуальных жестких дисков, подключенных к виртуальной Машине. Не учитывает порядок записи для разных виртуальных жестких дисков потенциально приводит к несогласованности баз данных на целевой стороне репликации. Такая ситуация возникает, если файлы базы данных и журнала и повтора распределены между несколькими виртуальными жесткими дисками, так как в данном случае для виртуальной Машины на стороне источника.



## <a name="vm-node-resiliency"></a>Устойчивость узлов виртуальной машины
Azure предлагает несколько разных соглашений об уровне обслуживания для виртуальных машин. Дополнительные сведения см. в разделе самая последняя версия [соглашение об уровне ОБСЛУЖИВАНИЯ для виртуальных машин](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/). Так как уровень СУБД обычно важна доступность в системе SAP, необходимо понимать группы доступности, зоны доступности и мероприятиях обслуживания. Дополнительные сведения об этих понятиях см. в разделе [Управление доступностью виртуальных машин Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/manage-availability) и [Управление доступностью виртуальных машин Linux в Azure](https://docs.microsoft.com/azure/virtual-machines/linux/manage-availability).

Минимальное рекомендуемое для рабочих сценариев СУБД с рабочей нагрузкой SAP является:

- Разверните две виртуальные машины в отдельной группе доступности в одном регионе Azure.
- Запустите эти две виртуальные машины в той же виртуальной сети Azure и иметь сетевые карты, подключить из те же подсети.
- Используйте методы базы данных для сервера горячей замены на второй виртуальной машине. Можно использовать такие методы, как SQL Server AlwaysOn, Oracle Data Guard и репликация системы HANA.

Также можно развернуть третью виртуальную Машину в другом регионе Azure и используйте те же методы базы данных для предоставления асинхронную реплику в другом регионе Azure.

Сведения о настройке группы доступности Azure, см. в разделе [учебником](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-availability-sets).



## <a name="azure-network-considerations"></a>Рекомендации по сети Azure
В крупномасштабных развертываниях SAP, используйте чертеж [виртуального центра обработки данных Azure](https://docs.microsoft.com/azure/architecture/vdc/networking-virtual-datacenter). Используется для назначения конфигурации и разрешения и роли виртуальной сети в различных частях вашей организации.

Эти рекомендации являются результатом сотни клиентских развертываний:

- Виртуальные сети, в которые выполняется развертывание приложения SAP в отсутствии доступа к Интернету.
- Виртуальные машины баз данных выполняются в той же виртуальной сети, что на уровне приложения.
- Виртуальные машины в виртуальной сети имеют выделения статических частных IP-адреса. Дополнительные сведения см. в разделе [IP-адресов, типы и методы распределения в Azure](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm).
- Ограничения маршрута и обратно на виртуальные машины СУБД, *не* набор с брандмауэрами, установка на локальной ВМ СУБД. Вместо этого определяется маршрутизации трафика с помощью [группы безопасности сети (Nsg)](https://docs.microsoft.com/azure/virtual-network/security-overview).
- Чтобы разделить и изолировать трафик к виртуальной Машине СУБД, назначьте разные сетевые карты к виртуальной Машине. Каждому сетевому Адаптеру, получает другой IP-адрес, и каждому сетевому Адаптеру назначен другой виртуальной сети. Каждая подсеть, имеет разные правила группы безопасности сети. Изоляция либо разделение трафика — это мера для маршрутизации. Чтобы задать квоты для пропускной способности сети не используется.

> [!NOTE]
> Назначение статических IP-адресов в Azure означает назначить их в отдельных виртуальных сетевых адаптеров. Не назначать статические IP-адреса в гостевой ОС виртуальной сетевой карте. Некоторые службы Azure, такой как резервное копирование Azure полагаются на то что на как минимум первичного виртуальный сетевой Адаптер имеет значение DHCP, а не статических IP-адресов. Дополнительные сведения см. в разделе [резервного копирования виртуальных машин Azure, устранение неполадок](https://docs.microsoft.com/azure/backup/backup-azure-vms-troubleshoot#networking). Чтобы назначить несколько статических IP-адресов для виртуальной Машины, назначьте несколько виртуальных сетевых адаптеров виртуальной Машины.
>


> [!IMPORTANT]
> Настройка [виртуальных сетевых](https://azure.microsoft.com/solutions/network-appliances/) пути передачи между приложением SAP и уровень СУБД для SAP NetWeaver-, не поддерживается Hybris- или системы SAP на основе S/4HANA. Это ограничение является по соображениям производительности и функциональности. Пути обмена данными между уровнем приложений SAP и уровень СУБД должен быть прямой. Ограничение не включает в себя [группу безопасности приложений (ASG) и правила группы безопасности сети](https://docs.microsoft.com/azure/virtual-network/security-overview) Если эти правила ASG и группы безопасности сети разрешают контура прямой обмен данными. 
>
> Другие сценарии, где не поддерживаются виртуальные сетевые модули находятся в:
>
> * Каналы связи между виртуальными машинами Azure, представляющих Linux Pacemaker кластера узлов и устройств SBD, как описано в разделе [высокий уровень доступности SAP NetWeaver на виртуальных машинах Azure в SUSE Linux Enterprise Server for SAP Applications](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse).
> * Каналы связи между виртуальными машинами Azure и Windows Server масштабируемого файлового сервера (SOFS) задайте до, как описано в разделе [кластеризация экземпляра SAP ASCS/SCS в отказоустойчивом кластере Windows с помощью общей папки в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-high-availability-guide-wsfc-file-share). 
>
> Виртуальные сетевые модули в путях взаимодействия можно легко double сетевая задержка между партнерами связи. Они также можно ограничить пропускную способность в критических путей между уровнем приложений SAP и уровень СУБД. В некоторых сценариях клиента виртуальных сетевых устройств может привести к кластеры Pacemaker Linux переход на другой. Ниже приведены случаи, где обмен данными между узлами кластера Pacemaker в Linux связь на свое устройство SBD через виртуальный сетевой модуль.
>

> [!IMPORTANT]
> Другой, проектирования *не* поддерживается разделения уровень приложений SAP и уровень СУБД в разных виртуальных сетях Azure, которые не являются [пиринговой связи](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) друг с другом. Мы рекомендуем разделить уровень приложений SAP и уровень СУБД с помощью подсетей в виртуальной сети Azure вместо с помощью разных виртуальных сетях Azure. 
>
> Если вы решили не рекомендацию и вместо этого разделить два слоя на разных виртуальных сетях, две виртуальные сети должен быть [пиринговой связи](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview). 
>
> Имейте в виду, что сетевой трафик между двумя [пиринговой связи](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) виртуальных сетей Azure регулируется расходы на передачу. Тома данных большой, состоит из многих терабайт обмениваются уровень приложений SAP и уровень СУБД. Значительные расходы могут накапливаться, если уровень приложений SAP и уровень СУБД, разделяются между двумя пиринговыми виртуальными сетями Azure.

Задать использование двух виртуальных машин для производства по развертыванию СУБД в доступности Azure. Также используйте отдельные маршрутизации для уровня приложений SAP и трафика управления и операций на две виртуальные машины СУБД. См. следующее изображение:

![Схема двух виртуальных машин в двух подсетях](./media/virtual-machines-shared-sap-deployment-guide/general_two_dbms_two_subnets.PNG)


### <a name="use-azure-load-balancer-to-redirect-traffic"></a>Использование Azure Load Balancer для перенаправления трафика
Использование частных виртуальных IP-адресов, используемых в функциональные возможности, как SQL Server AlwaysOn или репликацию системы HANA требуется настройка Azure load balancer. Подсистема балансировки нагрузки использует порты проверки, чтобы определить активный узел СУБД и направлять трафик только к этому узлу активной базы данных. 

Если отработка отказа узла базы данных, нет необходимости для приложения SAP перенастроить. Вместо этого наиболее распространенные архитектуры приложений SAP повторно подключиться к частный виртуальный IP-адрес. В то же время подсистемы балансировки нагрузки реагирует на узел отработки отказа, перенаправляя трафик от частный виртуальный IP-адрес для второго узла.

Azure предлагает два разных [номера SKU подсистемы балансировки нагрузки](https://docs.microsoft.com/azure/load-balancer/load-balancer-overview): SKU "базовый" и SKU "стандартный". Если вы хотите выполнить развертывание в зонах доступности Azure, подсистемы балансировки нагрузки базовый SKU выполняется нормально.

— Это трафик между ВМ СУБД и уровня приложений SAP, всегда перенаправляются через подсистему балансировки нагрузки все время? Ответ зависит от того, как настроить подсистему балансировки нагрузки. 

В настоящее время входящий трафик к виртуальной Машине СУБД всегда направляется через подсистему балансировки нагрузки. Исходящий трафик маршрута от СУБД для виртуальной Машины на уровень приложения, виртуальной Машины зависит от конфигурации подсистемы балансировки нагрузки. 

В подсистеме балансировки нагрузки можно установить значение параметра DirectServerReturn. Если этот параметр настроен, трафик, направленный из СУБД для виртуальной Машины в уровень приложений SAP — *не* направляться через подсистему балансировки нагрузки. Вместо этого он передается непосредственно на уровне приложения. Если DirectServerReturn не настроен, обратный трафик на уровень приложения SAP направляется через подсистему балансировки нагрузки.

Мы рекомендуем настроить DirectServerReturn в сочетании с подсистемами балансировки нагрузки, которые расположены между уровнем приложений SAP и уровень СУБД. Эта конфигурация уменьшает задержки в сети между двумя слоями.

Пример того, как настроить такую конфигурацию с SQL Server Always On, см. в разделе [настройка прослушивателя внутреннего балансировщика Нагрузки для групп доступности Always On в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sqlclassic/virtual-machines-windows-classic-ps-sql-int-listener).

При использовании опубликованные шаблоны GitHub JSON как ссылку для вашего развертывания инфраструктуры SAP в Azure, изучите это [шаблон для системы SAP 3-уровневое](https://github.com/Azure/azure-quickstart-templates/tree/4099ad9bee183ed39b88c62cd33f517ae4e25669/sap-3-tier-marketplace-image-converged-md). В этом шаблоне вы также увидите правильные параметры для подсистемы балансировки нагрузки.

### <a name="azure-accelerated-networking"></a>Ускорение работы в сети Azure
Чтобы еще больше сократить задержки в сети между виртуальными машинами Azure, мы советуем выбрать [ускоренной сетью Azure](https://azure.microsoft.com/blog/maximize-your-vm-s-performance-with-accelerated-networking-now-generally-available-for-both-windows-and-linux/). Используйте при развертывании виртуальных машин Azure для рабочих нагрузок SAP, особенно для уровня приложений SAP и уровень СУБД SAP.

> [!NOTE]
> Не все типы виртуальных Машин поддерживают ускоренной сетью. Предыдущей статье перечислены типы виртуальных Машин, которые поддерживают функцию ускорения сети.
>

- - -
> ![Windows][Logo_Windows] Windows
>
> Чтобы узнать, как развертывать виртуальные машины с ускоренной сети для Windows, см. в разделе [Создание виртуальной машины Windows с ускоренной сетью](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-powershell).
>
> ![Linux][Logo_Linux] Linux
>
> Дополнительные сведения о дистрибутив Linux, см. в разделе [Создание виртуальной машины Linux с ускоренной сетью](https://docs.microsoft.com/azure/virtual-network/create-vm-accelerated-networking-cli).
>
>

- - -

> [!NOTE]
> Для SUSE, Red Hat и Oracle Linux функция ускорения сети поддерживается в новых версиях этих дистрибутивов. Не поддерживают более старых версий, например с пакетом обновления 2 для SLES 12 или RHEL 7.2, повышения производительности сети Azure.
>


## <a name="deployment-of-host-monitoring"></a>Развертывание мониторинга узлов
Для использования в рабочей среде приложений SAP в виртуальных машинах SAP требуется возможность получения данных мониторинга узла от физических узлов, работающих виртуальных машин Azure. Требуется определенный уровень исправлений SAP HostAgent, включающий эту возможность в SAPOSCOL и SAP HostAgent. Точное описание уровня исправлений указано в примечании к SAP [1409604].

Дополнительные сведения о развертывании компонентов, данные узлов в SAPOSCOL и агента SAP Host Agent и управление жизненным циклом этих компонентов см. в разделе [руководство по развертыванию][deployment-guide].


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о конкретной СУБД см. в разделе:

- [Рабочие нагрузки SAP на виртуальных машинах Azure. Руководство по развертыванию СУБД SQL Server](dbms_guide_sqlserver.md)
- [Рабочие нагрузки SAP на виртуальных машинах Azure. Руководство по развертыванию СУБД Oracle](dbms_guide_oracle.md)
- [Рабочие нагрузки SAP на виртуальных машинах Azure. Руководство по развертыванию СУБД IBM DB2](dbms_guide_ibm.md)
- [Рабочие нагрузки SAP на виртуальных машинах Azure. Руководство по развертыванию СУБД SAP ASE](dbms_guide_sapase.md)
- [Развертывание SAP MaxDB, liveCache и сервера содержимого на виртуальных машинах Azure](dbms_guide_maxdb.md)
- [Руководство по использованию SAP HANA в Azure](hana-vm-operations.md)
- [Обеспечение высокого уровня доступности для SAP HANA на виртуальных машинах Azure](sap-hana-availability-overview.md)
- [Руководство по резервному копированию SAP HANA на виртуальных машинах Azure](sap-hana-backup-guide.md)

