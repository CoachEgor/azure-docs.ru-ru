---
title: Группы размещения близости Azure для приложений SAP Документы Майкрософт
description: Описывает сценарии развертывания SAP с группами размещения близости Azure
services: virtual-machines-linux,virtual-machines-windows
documentationcenter: ''
author: msjuergent
manager: bburns
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 01/17/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 01ce1599f86082aef3ff53d298cc53896074af66
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76277599"
---
# <a name="azure-proximity-placement-groups-for-optimal-network-latency-with-sap-applications"></a>Группы размещения близости Azure для оптимальной задержки сети с приложениями SAP
Приложения SAP, основанные на архитектуре SAP NetWeaver или SAP S/4HANA, чувствительны к задержке сети между уровнем приложений SAP и уровнем базы данных SAP. Эта чувствительность является результатом большей части бизнес-логики, работая в уровне приложения. Поскольку слой приложения SAP выполняет бизнес-логику, он выдает запросы уровню базы данных на высокой частоте со скоростью тысячи или десятки тысяч в секунду. В большинстве случаев характер этих запросов прост. Они часто могут быть запущены на уровне базы данных в 500 микросекунд или меньше.

Время, затрачиваемые в сети на отправку такого запроса из уровня приложения на уровень базы данных и получение отставания результатов, оказывает существенное влияние на время, затрачиваемые на запуск бизнес-процессов. Эта чувствительность к задержке сети является причиной того, что необходимо достичь оптимальной задержки сети в проектах развертывания SAP. Смотрите [sAP Примечание #1100926 - часто задаваемые вопросы: Производительность сети](https://launchpad.support.sap.com/#/notes/1100926/E) для руководящих принципов о том, как классифицировать задержку сети.

Во многих регионах Azure количество центров обработки данных выросло. Этот рост также был вызван введением зон доступности. В то же время, клиенты, особенно для высококачественных систем SAP, используют более специальные VM SKUs в семейство M-Series, или HANA Large Instances. Эти типы виртуальных машин Azure доступны не во всех центрах обработки данных в определенном регионе Azure. Из-за этих двух тенденций, клиенты испытали задержку сети, которая не в оптимальном диапазоне. В некоторых случаях эта задержка приводит к неоптимальной производительности их SAP-систем.

Чтобы предотвратить эти проблемы, Azure предлагает [группы размещения близости.](https://docs.microsoft.com/azure/virtual-machines/linux/co-location) Эта новая функциональность уже используется для развертывания различных систем SAP. Для ограничений на группы размещения близости см. В этой статье рассматриваются сценарии SAP, в которых можно или нужно использовать группы размещения близости Azure.

## <a name="what-are-proximity-placement-groups"></a>Что такое группы размещения близости? 
Группа размещения близости Azure является логической конструкцией. Когда один из них определен, он привязан к региону Azure и группе ресурсов Azure. При развертывании ВМ группа размещения на ней ссылается:

- Первый Azure VM, развернутый в центре обработки данных. Первую виртуальную машину можно считать «областью VM», развернутой в центре обработки данных на основе алгоритмов распределения Azure, которые в конечном итоге сочетаются с определениями пользователей для конкретной зоны доступности.
- Все последующие виртуальные машины развернули эту ссылку на группу размещения близости, чтобы разместить все впоследствии развернутые впоследствии виртуальные технологии Azure в том же центре обработки данных, что и первая виртуальная машина.

> [!NOTE]
> Если в центре обработки данных, где был размещен первый VM, развернуто не используемое оборудование для узлов, которое могло бы выполнить определенный тип VM, развертывание запрошенного типа VM не увенчается успехом. Вы получите сообщение о сбое.

Одна [группа ресурсов Azure](https://docs.microsoft.com/azure/azure-resource-manager/manage-resources-portal) может иметь несколько групп размещения близости, назначенных ей. Но группа размещения близости может быть назначена только одной группе ресурсов Azure.

При использовании групп размещения близости имейте в виду следующие соображения:

- Когда вы стремитесь к оптимальной производительности для системы SAP и ограничиваете себя единым центром обработки данных Azure для системы с помощью групп размещения непосредственной близости, вы не сможете объединить все типы семейств VM в группе размещения. Эти ограничения возникают из-за того, что аппаратура-хоста, необходимая для выполнения определенного типа VM, может не присутствовать в центре обработки данных, в котором был развернут "спределизированный VM" группы размещения.
- В течение жизненного цикла такой системы SAP можно было бы заставить перенести систему в другой центр обработки данных. Этот шаг может потребоваться, если вы решите, что ваш масштабированный слой HANA DBMS должен, например, перемещаться с четырех узлов на 16 узлов, и не хватает мощности, чтобы получить дополнительные 12 ВМ типа, используемого в центре обработки данных.
- Из-за вывода из эксплуатации оборудования корпорация Майкрософт может создать потенциал для типа VM, который использовался в другом центре обработки данных, а не для того, который изначально использовался. В этом случае может потребоваться переместить все вгруппы размещения в другую группу данных в другой центр обработки данных.

## <a name="proximity-placement-groups-with-sap-systems-that-use-only-azure-vms"></a>Группы размещения близости с системами SAP, которые используют только VMs Azure
Большинство развертываний систем SAP NetWeaver и S/4HANA в Azure не используют сяочку [HANA Large Instances.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture) Для развертываний, не использовавших HANA Large Instances, важно обеспечить оптимальную производительность между уровнем приложения SAP и уровнем DBMS. Для этого определите группу размещения близости Azure только для системы.

В большинстве развертываний клиентов клиенты создают единую [группу ресурсов Azure](https://docs.microsoft.com/azure/azure-resource-manager/manage-resources-portal) для систем SAP. В этом случае существует один-к-одному связь между, например, группой ресурсов системы производства ERP и группой ее размещения близости. В других случаях клиенты организуют свои группы ресурсов горизонтально и собирают все производственные системы в единую группу ресурсов. В этом случае у вас будет одно-к-много отношений между вашей группой ресурсов для производства Систем SAP и несколько групп размещения близости для вашего производства SAP ERP, SAP BW, и так далее.

Избегайте объединения нескольких производственных или непроизводственных систем SAP в единую группу размещения. Когда небольшое количество систем SAP или системы SAP и некоторые окружающие приложения должны иметь сетевую связь с низкой задержкой, можно рассмотреть возможность перевода этих систем в одну группу размещения. Следует избегать связок систем, поскольку чем больше систем вы группируете в группе размещения, тем выше шансы:

- Это требует типа VM, который не может быть запущен в конкретном центре обработки данных, в который была ориентирована группа размещения на ней.
- Эти ресурсы неосновных ВМ, такие как M-Series VMs, могут в конечном итоге оказаться невыполненными, когда вам нужно больше, потому что вы добавляете программное обеспечение в группу размещения близости с течением времени.

Вот как выглядит идеальная конфигурация:

![Группы размещения близости с только Пазуй VMs](./media/sap-proximity-placement-scenarios/ppg-for-all-azure-vms.png)

В этом случае отдельные системы SAP сгруппированы в одну группу ресурсов каждая, с одной группой размещения близости каждая. Нет никакой зависимости от того, используете ли вы конфигурации масштабирования HANA или DBMS.

## <a name="proximity-placement-groups-and-hana-large-instances"></a>Группы размещения близости и HANA Большие инстанции
Если некоторые из ваших систем SAP полагаются на [hanA Large Instances](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture) для уровня приложения, вы можете испытать значительные улучшения в задержке сети между блоком HANA Large Instances и Azure VMs при использовании единиц HANA Large Instances, развернутых в [строках или марках Revision 4.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture#networking-architecture-for-hana-large-instance) Одним из улучшений является то, что подразделения HANA Large Instances по мере их развертывания развертываются с группой размещения. Эту группу размещения близости можно использовать для развертывания VMs-раздатчиков уровня приложения. В результате эти ВМ будут развернуты в том же центре обработки данных, где размещается устройство HANA Large Instances.

Чтобы определить, развернуто ли устройство HANA Large Instances в штампе или строке Revision 4, проверьте [управление azure HANA Large Instances через портал Azure.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-li-portal#look-at-attributes-of-single-hli-unit) В обзоре атрибутов подразделения HANA Large Instances можно также определить название группы размещения близости, поскольку оно было создано при развертывании подразделения HANA Large Instances. Имя, которое отображается в обзоре атрибутов, — это имя группы размещения непосредственной близости, в которую следует развернуть vMs-разломы уровня приложения.

По сравнению с системами SAP, которые используют только виртуальные машины Azure, при использовании HANA Large Instances у вас меньше гибкости при принятии решения о том, сколько [групп ресурсов Azure](https://docs.microsoft.com/azure/azure-resource-manager/manage-resources-portal) использовать. Все подразделения HANA Large Instances [арендатора HANA Large Instances](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-know-terms) сгруппированы в единую группу ресурсов, как описано [в этой статье.](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-li-portal#display-of-hana-large-instance-units-in-the-azure-portal) Если вы не развернете в разных клиентах, чтобы отделить, например, производственные и непроизводственные системы или другие системы, все ваши подразделения HANA Large Instances будут развернуты в одном арендаторе HANA Large Instances. Этот арендатор имеет отношения один к одному с группой ресурсов. Но для каждого из отдельных единиц будет определена отдельная группа размещения.

В результате, отношения между группами ресурсов Azure и группами размещения близости для одного арендатора будут показаны здесь:

![Группы размещения близости и HANA Большие инстанции](./media/sap-proximity-placement-scenarios/ppg-for-hana-large-instance-units.png)

## <a name="example-of-deployment-with-proximity-placement-groups"></a>Пример развертывания с группами размещения близости
Ниже приведены некоторые команды PowerShell, которые можно использовать для развертывания вдовых с группами размещения приближений Azure.

Первый шаг после входной регистрации в [Azure Cloud Shell](https://azure.microsoft.com/features/cloud-shell/)— проверить, входите ли вы в подписку Azure, которую вы хотите использовать для развертывания:

<pre><code>
Get-AzureRmContext
</code></pre>

Если вам нужно перейти на другую подписку, вы можете сделать это, запустив эту команду:

<pre><code>
Set-AzureRmContext -Subscription "my PPG test subscription"
</code></pre>

Создайте новую группу ресурсов Azure, запустив эту команду:

<pre><code>
New-AzResourceGroup -Name "myfirstppgexercise" -Location "westus2"
</code></pre>

Создайте новую группу размещения близости, запустив эту команду:

<pre><code>
New-AzProximityPlacementGroup -ResourceGroupName "myfirstppgexercise" -Name "letsgetclose" -Location "westus2"
</code></pre>

Развертывайте свой первый VM в группу размещения близости, используя команду, как эта:

<pre><code>
New-AzVm -ResourceGroupName "myfirstppgexercise" -Name "myppganchorvm" -Location "westus2" -OpenPorts 80,3389 -ProximityPlacementGroup "letsgetclose" -Size "Standard_DS11_v2"
</code></pre>

Предыдущая команда развертывает VM на базе Windows. После успешного развертывания VM область расположена в области размещения центров обработки данных в регионе Azure. Все последующие развертывания VM, которые ссылаются на группу размещения близости, как показано в предыдущей команде, будут развернуты в том же центре обработки данных Azure, если тип VM может размещаться на оборудовании, размещенном в этом центре обработки данных, и емкость юаней для этого типа VM Доступны.

## <a name="combine-availability-sets-and-availability-zones-with-proximity-placement-groups"></a>Объедините наборы доступности и зоны доступности с группами размещения непосредственного доступа
Одним из недостатков использования зон доступности для развертывания систем SAP является то, что нельзя развертывать слой приложения SAP, используя наборы доступности в определенной зоне. Вы хотите, чтобы слой приложения SAP был развернут в тех же зонах, что и слой DBMS. Ссылки на зону доступности и набор доступности при развертывании одного VM не поддерживаются. Таким образом, ранее вы были вынуждены развернуть слой приложения, ссылаясь на зону. Вы потеряли возможность убедиться, что vMs-вимы с уровнем приложений были распределены по различным доменам обновления и сбоя.

Используя группы размещения непосредственной близости, вы можете обойти это ограничение. Вот последовательность развертывания:

- Создайте группу размещения близости.
- Развертывайте якорь VM, обычно dBMS-сервер, ссылаясь на зону доступности.
- Создайте набор доступности, который ссылается на группу близости Azure. (См. команду позже в этой статье.)
- Развертывайте VMs-группы уровня приложения, ссылаясь на набор доступности и группу размещения близости.

Вместо развертывания первого VM, как показано в предыдущем разделе, при развертывании VM вы ссылаетесь на зону доступности и группу размещения близости:

<pre><code>
New-AzVm -ResourceGroupName "myfirstppgexercise" -Name "myppganchorvm" -Location "westus2" -OpenPorts 80,3389 -Zone "1" -ProximityPlacementGroup "letsgetclose" -Size "Standard_E16_v3"
</code></pre>

Успешное развертывание этой виртуальной машины будет размещать экземпляр базы данных системы SAP в одной зоне доступности. Область расположения группы размещения приспозна к одному из центров обработки данных, представляющим определенную зону доступности.

Предположим, что вы развертываете VMs-сообщения центральных служб так же, как и MMS DBMS, ссылаясь на те же зоны или зоны и те же группы размещения близости. На следующем этапе необходимо создать наборы доступности, которые вы хотите использовать для уровня приложения вашей системы SAP.

Вам необходимо определить и создать группу размещения близости. Команда для создания набора доступности требует дополнительной ссылки на идентификатор группы размещения (не имя). Вы можете получить идентификатор группы размещения близости с помощью этой команды:

<pre><code>
Get-AzProximityPlacementGroup -ResourceGroupName "myfirstppgexercise" -Name "letsgetclose"
</code></pre>

При создании набора доступности необходимо учитывать дополнительные параметры при использовании управляемых дисков (по умолчанию, если не указано иное) и группы размещения при сяминге:

<pre><code>
New-AzAvailabilitySet -ResourceGroupName "myfirstppgexercise" -Name "myppgavset" -Location "westus2" -ProximityPlacementGroupId "/subscriptions/my very long ppg id string" -sku "aligned" -PlatformUpdateDomainCount 3 -PlatformFaultDomainCount 2 
</code></pre>

В идеале следует использовать три домена неисправностей. Но количество поддерживаемых доменов неисправностей может варьироваться от региона к региону. В этом случае максимальное количество доменов неисправностей, возможных для конкретных регионов, составляет два. Для развертывания VMs-развязывании уровня приложения необходимо добавить ссылку на имя набора доступности и имя группы размещения близости, как показано здесь:

<pre><code>
New-AzVm -ResourceGroupName "myfirstppgexercise" -Name "myppgavsetappvm" -Location "westus2" -OpenPorts 80,3389 -AvailabilitySetName "myppgavset" -ProximityPlacementGroup "letsgetclose" -Size "Standard_DS11_v2"
</code></pre>

Результатом этого развертывания является:
- Слой DBMS и центральные службы для вашей системы SAP, расположенной в определенной зоне доступности или зонах доступности.
- Слой приложения SAP, расположенный через наборы доступности в тех же центрах обработки данных Azure, что и DBMS VM или VMs.

> [!NOTE]
> Поскольку один DBMS VM разворачивается в одну зону, а вторая DBMS VM — в другую, чтобы создать конфигурацию высокой доступности, для каждой из зон потребуется другая группа размещения близости. То же самое относится и к любому набору доступности, который вы используете.

## <a name="move-an-existing-system-into-proximity-placement-groups"></a>Перемещение существующей системы в группы размещения непосредственного размещения
Если у вас уже есть системы SAP, можно оптимизировать задержку сети некоторых критически важных систем и найти слой приложения и слой DBMS в том же центре обработки данных. Для перемещения вс-пропускных выв.М. полной группы доступности Azure в существующую группу размещения, которая уже используется, необходимо отключить все ВМ набора доступности и назначить набор доступности существующей группе размещения на портале Azure, PowerShell или CLI. Если вы хотите переместить VM, который не является частью набора доступности в существующую группу размещения близости, вам просто нужно выключить VM и назначить его существующей группе размещения близости. 


## <a name="next-steps"></a>Дальнейшие действия
Ознакомьтесь с документацией:

- [Рабочие нагрузки SAP в Azure: контрольный список планирования и развертывания](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-deployment-checklist)
- [Предварительный просмотр: Развертывание ВМ в группы размещения непосредственной близости с помощью Azure CLI](https://docs.microsoft.com/azure/virtual-machines/linux/proximity-placement-groups)
- [Предварительный просмотр: Развертывание VMs в группы размещения близости с помощью PowerShell](https://docs.microsoft.com/azure/virtual-machines/windows/proximity-placement-groups)
- [Рассмотрение вопроса о развертывании DBMS виртуальных машин Azure для рабочих нагрузок SAP](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/dbms_guide_general)

