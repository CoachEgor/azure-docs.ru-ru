---
title: Установка SAP HANA на сервере SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт
description: Как установить SAP HANA на SAP HANA на Azure (Большие инстанции).
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: juergent
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 01/16/2020
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: ca59305b22fcf1e81ef518612910731cb6edea5d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77617091"
---
# <a name="how-to-install-and-configure-sap-hana-large-instances-on-azure"></a>Как установить и настроить SAP HANA в Azure (крупные экземпляры)

Перед чтением этой статьи ознакомьтесь с [основными терминами в контексте крупных экземпляров HANA](hana-know-terms.md) и [номерами SKU крупных экземпляров HANA](hana-available-skus.md).

Вы ответственны за установку SAP HANA. Установив подключение между виртуальными сетями Azure и единицами крупных экземпляров HANA, можно приступить к установке нового SAP HANA на сервере Azure (крупные экземпляры). 

> [!Note]
> В политике SAP установка SAP HANA должна выполняться человеком, сдавшим сертифицированный экзамен SAP Technology Associate, сертификационный экзамен SAP HANA Installation или являющемуся сертифицированным системным интегратором SAP (SI).

Если вы планируете установить HANA 2.0, см. документ [SAP Support Note #2235581 — SAP HANA: Supported Operating Systems](https://launchpad.support.sap.com/#/notes/2235581/E) (Примечание по поддержке SAP №2235581. SAP HANA: поддерживаемые операционные системы), чтобы убедиться, что используемая ОС поддерживается выпуском SAP HANA, который вы собираетесь установить. В поддерживаемой ОС для HANA 2.0 больше ограничений, чем в ОС для HANA 1.0. Вы также должны проверить, является ли релиз ОС вы заинтересованы в указан в качестве поддерживается для конкретного блока HLI в этом опубликованном [списке](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure). Нажмите на устройство, чтобы получить все детали с поддерживаемым списком ОС этого устройства. 

Проверьте следующее перед началом установки HANA:
- [единицы HLI](#validate-the-hana-large-instance-units);
- [конфигурация операционной системы;](#operating-system)
- [Конфигурация сети](#networking)
- [Конфигурация хранилища](#storage)


## <a name="validate-the-hana-large-instance-units"></a>Проверка единиц крупного экземпляра HANA

Когда вы получите единицу крупного экземпляра HANA от корпорации Майкрософт, проверьте указанные ниже параметры и внесите необходимые изменения.

**Первый шаг** после получения HANA Large Instance и установления доступа и подключения к экземплярам— проверить на портале Azure, отображаются ли экземпляры (ы) с правильными SRU и ОС. Прочитайте [контроль azure HANA Large Instances через портал Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-li-portal) для выполнения шагов, необходимых для выполнения проверок.

**Второй шаг** после получения HANA Large Instance и установления доступа и подключения к экземплярам— регистрация ОС экземпляра у поставщика ОС. Этот шаг также включает регистрацию операционной системы SUSE Linux в экземпляре SUSE SMT, который развернут на виртуальной машине в Azure. 

К этому экземпляру SMT может подключаться единица крупного экземпляра HANA. (Дополнительные сведения см. в статье [Настройка сервера SMT для SUSE Linux](hana-setup-smt.md)). Операционную систему Red Hat также можно зарегистрировать в диспетчере подписок Red Hat, к которому нужно подключиться. Для получения дополнительных сведений см. комментарии в [Что такое SAP HANA в Azure (большие экземпляры)?](https://docs.microsoft.com/azure/virtual-machines/linux/sap-hana-overview-architecture?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Этот шаг необходим для исправления ОС, которая является обязанностью клиента. Для SUSE на странице [установки SMT](https://www.suse.com/documentation/sles-12/book_smt/data/smt_installation.html) найдите документацию по установке и настройке SMT.

**Третий шаг** заключается в проверке новых патчей и исправлений конкретного релиза/версии ОС. Проверьте, что используется последняя версия крупного экземпляра HANA. Возможны варианты, которые не включают последние исправления. После получения единицы крупного экземпляра HANA проверьте, нужно ли применить исправления.

**Четвертый шаг** заключается в том, чтобы проверить соответствующие заметки SAP для установки и настройки SAP HANA на конкретный релиз/версию ОС. Из-за изменения рекомендаций или примечаний к заметкам SAP, а также конфигураций, которые зависят от отдельных сценариев установки, Майкрософт не всегда может обеспечить правильную настройку единицы крупного экземпляра HANA. 

Вы как клиент должны обязательно ознакомиться с примечаниями к SAP, относящимися к SAP HANA в вашем выпуске Linux. Проверьте настройки выпуска или версии операционной системы и примените параметры конфигурации, если это еще не сделано.

Проверьте приведенные ниже параметры и измените их значения на следующие:

- net.core.rmem_max = 16777216;
- net.core.wmem_max = 16777216;
- net.core.rmem_default = 16777216;
- net.core.wmem_default = 16777216;
- net.core.optmem_max = 16777216;
- net.ipv4.tcp_rmem = 65536 16777216 16777216;
- net.ipv4.tcp_wmem = 65536 16777216 16777216.

Начиная с SLES 12 с пакетом обновления 1 (SP1) и RHEL 7.2, эти параметры необходимо определить в файле конфигурации в каталоге /etc/sysctl.d. Например, в этом каталоге должен находиться файл конфигурации с именем 91-NetApp-HANA.conf. В предыдущих выпусках SLES и RHEL эти параметры необходимо задать в файле /etc/sysctl.conf.

Для всех релизов RHEL, начиная с RHEL 6.3, имейте в виду: 
- параметр sunrpc.tcp_slot_table_entries = 128 необходимо задать в файле in/etc/modprobe.d/sunrpc-local.conf. Если файл не существует, необходимо сначала создать его, добавив запись: 
    - options sunrpc tcp_max_slot_table_entries=128.

**Пятый шаг** заключается в проверке системного времени вашего подразделения HANA Large Instance. Экземпляры развертываются с помощью часового пояса. Этот часовой пояс — это расположение региона Azure, в котором расположен стек крупных экземпляров HANA. Системное время и часовой пояс экземпляров можно изменить. 

При добавлении новых экземпляров к клиенту необходимо соответствующим образом изменить их часовой пояс. Ресурсы Майкрософт не имеют доступ к сведениям о настройке часового пояса системы в экземплярах после передачи их в эксплуатацию. Поэтому часовой пояс новых экземпляров может отличаться от установленного вами. В результате вы как клиент должны проверить и при необходимости изменить часовой пояс полученных экземпляров. 

Шестой **шаг** заключается в том, чтобы проверить и т.д. / хостов. После передачи в колонках для разных целей назначены отдельные IP-адреса. Проверьте файл/etc/hosts. При добавлении единиц к существующему клиенту в файле etc/hosts новых систем могут быть неправильно настроены IP-адреса предыдущих систем. Вы как пользователь обязаны проверить правильность конфигурации. Это позволит новым экземплярам взаимодействовать с ранее развернутыми единицами в клиенте и разрешать их имена. 


## <a name="operating-system"></a>Операционная система

Для области буфера доставленного образа ОС выделено 2 ГБ в соответствии с документом [SAP Support Note #1999997 — FAQ: SAP HANA Memory](https://launchpad.support.sap.com/#/notes/1999997/E) (Примечание по поддержке SAP №1999997. Часто задаваемые вопросы: память SAP HANA). В качестве клиента необходимо самостоятельно задать требуемый параметр.

Для SAP HANA в Azure (большие экземпляры) используется дистрибутив [SUSE Linux Enterprise Server 12 SP1 для приложений SAP](https://www.suse.com/products/sles-for-sap/download/). Этот дистрибутив предоставляет все необходимые для SAP функции без дополнительной настройки (в том числе предварительно настроенные параметры для эффективного запуска SAP на сервере SLES).

В разделе [библиотеки ресурсов и технической документации](https://www.suse.com/products/sles-for-sap/resource-library#white-papers) на веб-сайте SUSE и на [странице SAP для SUSE](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE) в сетевом сообществе SAP (SCN) доступно несколько полезных ресурсов, в которых описывается развертывание SAP HANA на SLES (в том числе настройки высокой доступности, методы обеспечения безопасности для работы SAP и многое другое).

Дополнительные сведения и полезные ссылки по SAP в SUSE см. ниже.

- [SAP HANA на сайте SUSE Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+SUSE).
- [Best Practice for SAP: Enqueue Replication — SAP NetWeaver on SUSE Linux Enterprise 12](https://www.suse.com/docrepcontent/container.jsp?containerId=9113) (Рекомендации по SAP. Постановка репликации в очередь — SAP NetWeaver в SUSE Linux Enterprise 12).
- [ClamSAP — SLES Virus Protection for SAP](https://scn.sap.com/community/linux/blog/2014/04/14/clamsap--suse-linux-enterprise-server-integrates-virus-protection-for-sap) (ClamSAP — защита от вирусов на сервере SLES для SAP) (включая SLES 12 для приложений SAP).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12, см. ниже.

- [SAP Support Note #1944799 — SAP HANA Guidelines for SLES Operating System Installation](http://service.sap.com/sap/support/notes/1944799) (Примечание по поддержке SAP №1944799. Рекомендации по установке SAP HANA в ОС SLES).
- [SAP Support Note #2205917 — SAP HANA DB Recommended OS Settings for SLES 12 for SAP Applications](https://launchpad.support.sap.com/#/notes/2205917/E) (Примечание по поддержке SAP №2205917. База данных SAP HANA: рекомендуемые параметры ОС для SLES 12 для приложений SAP).
- [SAP Support Note #1984787 — SUSE Linux Enterprise Server 12: Installation Notes](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №1984787. Заметки об установке SUSE Linux Enterprise Server 12).
- [SAP Support Note #171356 — SAP Software on Linux: General Information](https://launchpad.support.sap.com/#/notes/1984787) (Примечание по поддержке SAP №171356. Общие сведения о ПО SAP на платформе Linux).
- [SAP примечание поддержки #1391070 - Linux UUID решения](https://launchpad.support.sap.com/#/notes/1391070)

[Red Hat Enterprise Linux для SAP HANA](https://www.redhat.com/en/resources/red-hat-enterprise-linux-sap-hana) — еще одно решение для запуска SAP HANA на крупных экземплярах HANA. Выпуски RHEL 7.2 и 7.3 доступны и поддерживаются. 

Дополнительные сведения и полезные ссылки по SAP в Red Hat приведены ниже.
- [Сайт SAP HANA в Red Hat Linux](https://wiki.scn.sap.com/wiki/display/ATopics/SAP+on+Red+Hat).

Примечания по поддержке SAP, применимые к реализации SAP HANA на SLES 12, приведены ниже.

- [SAP примечание поддержки #2009879 - SAP HANA руководящие принципы для Red Hat Enterprise Linux (RHEL) операционная система](https://launchpad.support.sap.com/#/notes/2009879/E)
- [SAP Support Note #2292690 — SAP HANA DB: Recommended OS settings for RHEL 7](https://launchpad.support.sap.com/#/notes/2292690) (Примечание по поддержке SAP №2292690. База данных SAP HANA: рекомендуемые параметры операционной системы для RHEL 7).
- [SAP примечание поддержки #1391070 - Linux UUID решения](https://launchpad.support.sap.com/#/notes/1391070)
- [SAP Support Note #2228351 — Linux: SAP HANA Database SPS 11 revision 110 (or higher) on RHEL 6 or SLES 11](https://launchpad.support.sap.com/#/notes/2228351) (Примечание по поддержке SAP №2228351. Linux: база данных SAP HANA SPS 11, редакция 110 (или более поздняя), в RHEL 6 или SLES 11).
- [SAP Support Note #2397039 — FAQ: SAP on RHEL](https://launchpad.support.sap.com/#/notes/2397039) (Примечание по поддержке SAP №2397039. Часто задаваемые вопросы: SAP в RHEL).
- [SAP Support Note #2002167 — Red Hat Enterprise Linux 7.x: Installation and Upgrade](https://launchpad.support.sap.com/#/notes/2002167) (Примечание по поддержке SAP №1496410. Установка и обновление Red Hat Enterprise Linux 7.x).

### <a name="time-synchronization"></a>Синхронизация времени

Приложения SAP, построенные на основе архитектуры SAP NetWeaver, чувствительны к разнице системного времени на разных компонентах, образующих систему SAP. Короткие дампы SAP ABAP с ошибкой, озаглавленной ZDATE\_LARGE\_TIME\_DIFF, похожи. Это связано с тем, что эти короткие дампы появляются, когда системное время разных серверов или виртуальных машинах существенно различается.

Для SAP HANA в Azure (крупные экземпляры) синхронизация времени в Azure не применяется к единицам вычисления в стеках больших экземпляров. Эта синхронизация не относится к приложениям SAP, выполняемым на виртуальных машинах Azure, так как Azure гарантирует правильную синхронизацию времени системы. 

В результате потребуется отдельный сервер времени, который будут использовать серверы приложений SAP, работающие на виртуальных машинах Azure, и экземпляры баз данных SAP HANA, работающие на HANA (крупные экземпляры). Для инфраструктуры хранения в стеках крупных экземпляров время синхронизируется с серверами NTP.


## <a name="networking"></a>Сети
В этом разделе предполагается, что вы следовали рекомендациям по проектированию виртуальных сетей Azure и их подключению к крупным экземплярам HANA, приведенным в следующих документах:

- [Обзор и архитектура SAP HANA (Large Instance) на Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture)
- [Инфраструктура sAP HANA (Большие инстанции) и подключение на Azure](hana-overview-infrastructure-connectivity.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

При проектировании сети отдельной единицы следует учитывать некоторые моменты. Каждой единице крупного экземпляра HANA выделяется два или три IP-адреса, которые назначаются соответствующему числу портов сетевого адаптера. Три IP-адреса используются в масштабируемых конфигурациях HANA или в сценарии репликации системы HANA. Один из IP-адресов, назначенных сетевому адаптеру единицы, выделяется из диапазона серверного пула IP-адресов. Дополнительные сведения см. в статье [Обзор и описание архитектуры SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture).

Дополнительные сведения о Ethernet по архитектуре см. в разделе [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md).

## <a name="storage"></a>Хранилище

Макет хранилища для SAP HANA на Azure (Большие инстанции) настроен SAP HANA на Azure `service management` через рекомендуемые SAP рекомендации. Рекомендации описаны в техническом документе с описанием [требований к хранилищу SAP HANA](https://go.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html). 

Приблизительные размеры разных томов с различными SKU крупных экземпляров HANA задокументированы в статье [Что такое SAP HANA в Azure (большие экземпляры)?](hana-overview-architecture.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).

Соглашения об именовании томов хранилища перечислены в следующей таблице.

| Использование хранилища | Имя подключения | Имя тома | 
| --- | --- | ---|
| Данные HANA | /hana/data/SID/mnt0000m\<> | IP хранилища: /hana_data_SID_mnt00001_tenant_vol |
| Журнал HANA | /hana/log/SID/mnt0000m\<> | IP хранилища: /hana_log_SID_mnt00001_tenant_vol |
| Резервная копия журнала HANA | /hana/log/backups | IP хранилища: /hana_log_backups_SID_mnt00001_tenant_vol |
| Общий HANA | /hana/shared/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/shared |
| usr/sap | /usr/sap/SID | IP хранилища: /hana_shared_SID_mnt00001_tenant_vol/usr_sap |

*SID* — это системный идентификатор экземпляра HANA. 

*Tenant* — это внутреннее перечисление операций при развертывании клиента.

HANA usr/sap предоставляет общий доступ к тому. В спецификацию точек подключения входит системный идентификатор экземпляров HANA, а также номер подключения. В масштабируемых развертываниях существует только одно подключение, например, mnt00001. В масштабируемом развертывании будет отображаться столько подключений, сколько рабочих и главных узлов находится в вашем распоряжении. 

В масштабируемой среде данные, журнал, тома журнала резервного копирования являются общими и присоединяются к каждому узлу в масштабируемой конфигурации. Для конфигураций с несколькими экземплярами SAP создается другой набор томов, который присоединяется к единице крупного экземпляра HAN. См. статью [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md) для изучения конфигурации хранилища для вашего сценария.

После ознакомления с этим документом и оценки единицы крупного экземпляра HANA вы поймете, что эти единицы имеют крупный том диска HANA/data, а также наличие тома HANA/log/backup. Причина, почему мы выделили больше места для HANA/data, заключается в том, что на этот том диска также сохраняются моментальные снимки, созданные с помощью предоставленной нами функции. Чем больше моментальных снимков вы сделали, тем больше требуется пространства. 

Том HANA/log/backup не используется как том для хранения резервных копий базы данных. Его размер походит для использования в качестве архивного тома для резервных копий журнала транзакций HANA. Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление SAP HANA в Azure (крупные экземпляры)](hana-overview-high-availability-disaster-recovery.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json). 

Кроме предоставленного хранилища можно приобрести дополнительную емкость хранилища с шагом приращения 1 ТБ. Это дополнительное хранилище добавляется к HANA (крупные экземпляры) как новые тома.

Во время посадки с SAP `service management`HANA на Azure клиент указывает идентификатор пользователя (UID) и идентификатор группы группы sidadm (например: 1000 500). Во время установки системы SAP HANA необходимо использовать эти же значения. Так как вы хотите развернуть несколько экземпляров HANA, вы получите несколько наборов томов (один набор для каждого экземпляра). В результате во время развертывания необходимо определить следующие моменты:

- Идентификатор SID разных экземпляров HANA (на его основе получается sidadm).
- Объемы памяти разных экземпляров HANA. Объем памяти каждого экземпляра определяет размер тома в каждом отдельном наборе томов.

Согласно рекомендациям поставщика хранилища для всех подключенных томов настраиваются следующие параметры подключения (кроме LUN загрузки):

- nfs    rw, vers=4, hard, timeo=600, rsize=1048576, wsize=1048576, intr, noatime, lock 0 0

Эти точки подключения настраиваются в /etc/fstab, как показано на следующих снимках экрана.

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image1_fstab.PNG)

Выходные данные команды df -h в единице крупного экземпляра S72m HANA выглядят следующим образом.

![fstab подключенных томов в единице крупного экземпляра HANA](./media/hana-installation/image2_df_output.PNG)


Контроллер хранилища и узлы в стеках больших экземпляров синхронизируются с NTP-серверами. Если выполняется синхронизация с NTP-сервером для единиц SAP HANA в Azure (крупные экземпляры) и виртуальных машин Azure, не должно быть заметного смещения времени между инфраструктурой и единицами вычислений в Azure или стеками крупных экземпляров.

Чтобы оптимизировать хранилище, используемое SAP HANA, необходимо задать следующие параметры конфигурации:

- max_parallel_io_requests 128;
- async_read_submit on;
- async_write_submit_active on;
- async_write_submit_blocks all.
 
Начиная с версии SAP HANA 1.0 и до SPS 12, эти параметры можно указать во время установки базы данных SAP HANA, как описано в [примечании к SAP 2267798](https://launchpad.support.sap.com/#/notes/2267798).

С помощью средства hdbparam можно настроить эти параметры после установки базы данных SAP HANA. 

Хранилище, используемое в HANA Large Instances, имеет ограничение размера файла. [Ограничение размера составляет 16 ТБ](https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-vsmg%2FGUID-AA1419CF-50AB-41FF-A73C-C401741C847C.html) на файл. В отличие от ограничений размера файла в файловых системах EXT3, HANA не знает о ограничении хранилища, применяемом хранилищем HANA Large Instances. В результате HANA не будет автоматически создавать новый файл данных при достигнув предела размера файла в 16 ТБ. По мере того, как HANA пытается увеличить количество файлов за 16 ТБ, HANA сообщит об ошибках, а сервер индекса в конце сбой.

> [!IMPORTANT]
> Для предотвращения того, чтобы HANA пыталась увеличить количество файлов данных за предельный размер 16 ТБ в хранилище HANA Large Instance, необходимо установить следующие параметры в файле конфигурации SAP HANA global.ini
> 
> - datavolume_striping
> - datavolume_striping_size_gb 15000 евро
> - Смотрите также #2400005 SAP [примечание](https://launchpad.support.sap.com/#/notes/2400005)
> - Будьте в курсе SAP примечание [#2631285](https://launchpad.support.sap.com/#/notes/2631285)


Это средство не поддерживается в системе SAP HANA 2.0. В таком случае эти параметры необходимо задать, используя команды SQL. Дополнительные сведения см. в [примечании к SAP 2399079 об устранении hdbparam в HANA 2.0](https://launchpad.support.sap.com/#/notes/2399079).

Для изучения макета хранилища вашей архитектуры см. статью [Поддерживаемые сценарии для крупных экземпляров HANA](hana-supported-scenario.md).


**Дальнейшие действия**

- См. статью [Пример установки SAP HANA на крупных экземплярах HANA](hana-example-installation.md).










































 







 




