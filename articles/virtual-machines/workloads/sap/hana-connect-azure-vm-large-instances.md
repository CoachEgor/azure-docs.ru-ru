---
title: Настройка подключения к SAP HANA в Azure (крупные экземпляры) с виртуальных машин | Документация Майкрософт
description: Настройка подключения с виртуальных машин для использования SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 05/25/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: fb6f88fbfcbd539603e435b11661c428d54f3c34
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74224731"
---
# <a name="connecting-azure-vms-to-hana-large-instances"></a>Подключение виртуальных машин Azure к крупным экземплярам HANA

Статья [Что такое SAP HANA в Azure (большие экземпляры)?](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-overview-architecture) упоминает, что минимальное развертывание крупных экземпляров HANA с уровнем приложений SAP в Azure выглядит следующим образом.

![Виртуальная сеть Azure подключена к SAP HANA в Azure (крупные экземпляры) и к локальной сети](./media/hana-overview-architecture/image1-architecture.png)

Приближайшемкая к виртуальной сети Azure, необходимо:

- определение виртуальной сети Azure, которое будет использоваться для развертывания виртуальных машин на уровне приложений SAP;
- определение подсети в виртуальной сети Azure по умолчанию — это то, во что развертываются виртуальные машины;
- в создаваемой виртуальной сети Azure должна быть по крайней мере одна подсеть виртуальной машины и одна подсеть шлюза для ExpressRoute. Таким подсетям нужно назначить диапазоны IP-адресов в соответствии со сведениями, указанными в разделах ниже.


## <a name="create-the-azure-virtual-network-for-hana-large-instances"></a>Создание виртуальной сети Azure для крупных экземпляров HANA

>[!Note]
>Эту виртуальную сеть Azure для крупных экземпляров HANA следует создавать с использованием модели развертывания с помощью Azure Resource Manager. Крупные экземпляры HANA не поддерживают старую модель развертывания Azure, известную как классическая модель развертывания.

Чтобы создать виртуальную сеть, можно использовать портал Azure, PowerShell, шаблон Azure или Azure CLI. (Для получения дополнительной информации [см. Создать виртуальную сеть с помощью портала Azure](../../../virtual-network/manage-virtual-network.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json#create-a-virtual-network)). В следующем примере мы рассмотрим виртуальную сеть, которая создается с помощью портала Azure.

При отсылке к **адресное пространство** в этой документации можно использовать адресное пространство, которое разрешено использовать виртуальной сети Azure. Оно будет использоваться в виртуальной сети для распространения маршрутов BGP. Это **адресное пространство** можно увидеть здесь:

![Адресное пространство виртуальной сети Azure на портале Azure](./media/hana-overview-connectivity/image1-azure-vnet-address-space.png)

В предыдущем примере, с 10.16.0.0/16, виртуальная сеть Azure получила довольно большой и широкий диапазон IP-адресов для использования. Таким образом, все диапазоны IP-адресов последующих подсетей в виртуальной сети могут входить в указанное адресное пространство. Обычно мы не рекомендуем такой большой диапазон адресов для одной виртуальной сети в Azure. Давайте взглянем на подсети, которые определены в виртуальной сети Azure.

![Подсети виртуальной сети Azure и диапазоны их IP-адресов](./media/hana-overview-connectivity/image2b-vnet-subnets.png)

Как видно, создана виртуальная сеть с первой подсетью виртуальной машины (с именем "default") и подсеть GatewaySubnet.

В двух предыдущих графиках **пространство адресов виртуальной сети** охватывает как **диапазон IP-адресов подсети VM,** так и диапазон виртуального сетевого шлюза.

Можно ограничить **адресное пространство виртуальной сети** определенными диапазонами, используемыми каждой подсетью. В этом случае **адресное пространство виртуальной сети** можно определить через несколько конкретных диапазонов, как показано ниже.

![Адресное пространство виртуальной сети Azure в качестве двух пространств](./media/hana-overview-connectivity/image3-azure-vnet-address-space_alternate.png)

В этом случае для **адресного пространства виртуальной сети** определено два пространства. Они идентичны диапазонам IP-адресов, определенным для диапазона IP-адресов подсети виртуальной машины Azure и диапазона IP-адресов подсети шлюза виртуальной сети. 

Для этих подсетей клиента (подсетей виртуальной машины) можно использовать любой стандарт именования. Тем не менее **каждой виртуальной подсети должна соответствовать только одна подсеть шлюза**, подключающаяся к цепи ExpressRoute для SAP HANA в Azure (крупные экземпляры). **Эта подсеть шлюза должна быть названа "GatewaySubnet",** чтобы убедиться, что шлюз ExpressRoute правильно размещен.

> [!WARNING] 
> Очень важно, чтобы подсеть шлюза всегда называлась "GatewaySubnet".

Можно использовать несколько подсетей виртуальной машины, а также диапазоны не связанных адресов. **Адресное пространство виртуальной сети** должно охватывать эти диапазоны адресов. Они могут находиться в сводной форме. Они могут также быть заданы списком точных диапазонов подсетей виртуальной машины и подсети шлюза.

Ниже приведен краткий перечень важных сведений о виртуальной сети Azure, которая подключается к крупным экземплярам HANA.

- При первоначальном развертывании HANA Large Instances необходимо отправить в корпорацию Майкрософт **пространство адресного адреса виртуальной сети.** 
- **Адресное пространство виртуальной сети** может представлять собой один большой диапазон, охватывающий диапазоны IP-адресов подсети виртуальной машины Azure и диапазон IP-адресов подсети шлюза виртуальной сети.
- Можно отправить несколько диапазонов, охватывающих разные диапазоны IP-адресов в пределах диапазонов IP-адресов подсети виртуальной машины и диапазона IP-адресов подсети шлюза.
- Определенное **адресное пространство виртуальной сети** используется для распространения маршрутов BGP.
- Название подсети шлюза должно быть: **"GatewaySubnet".**
- Адресное пространство используется в качестве фильтра на стороне крупных экземпляров HANA, чтобы разрешать или запрещать передачу трафика к единицам крупных экземпляров HANA из Azure. Убедитесь, что сведения о маршрутах BGP виртуальной сети Azure и диапазонах IP-адресов, настроенных для фильтрации на стороне крупных экземпляров HANA, совпадают. В противном случае могут возникнуть проблемы с подключением.
- В разделе **Подключение виртуальной сети к каналу ExpressRoute крупных экземпляров HANA** ниже указаны некоторые дополнительные сведения о подсети шлюза.



## <a name="different-ip-address-ranges-to-be-defined"></a>Определение разных диапазонов IP-адресов 

Некоторые из диапазонов IP-адресов, необходимых для развертывания HANA Large Instances, уже введены. Существуют и другие важные диапазоны IP-адресов. Не все следующие диапазоны IP-адресов должны быть представлены в корпорацию Майкрософт. Тем не менее их нужно определить перед отправкой запроса на первоначальное развертывание.

- **Виртуальное сетевое адресное пространство:** **виртуальное сетевое пространство адреса** — это диапазоны IP-адресов, которые вы присваивают параметру пространства адреса в виртуальных сетях Azure. Эти сети будут подключаться к среде крупных экземпляров SAP HANA. Рекомендуется задавать этот параметр пространства адресов при помощи многострочного значения. Оно должно состоять из диапазона подсети виртуальной машины Azure и диапазонов подсети шлюза Azure. Диапазон подсети был показан на предыдущем рисунке. Он НЕ должен пересекаться с локальным диапазоном адресов, диапазоном IP-адресов пула серверов или с диапазоном адресов ER-P2P. Как это можно осуществить? Ваша корпоративная сетевая команда или поставщик услуг должны предоставить один или несколько диапазон IP-адресов(ы), которые не используются внутри вашей сети. Например, подсеть вашего Azure VM составляет 10.0.0.0/24, а подсеть вашей подсети шлюза Azure — 10.0.2.0/28.  Мы рекомендуем определить адресное пространство виртуальной сети Azure: 10.0.0/24 и 10.0.2.0/28. Несмотря на то что значения адреса пространств можно агрегировать, мы рекомендуем сопоставить их с диапазонами подсетей. Таким образом можно избежать случайного повторного использования неиспользуемых диапазонов IP-адресов в больших адресных пространствах в других местах вашей сети. **Виртуальное сетевое адресное пространство представляет собой диапазон IP-адресов. Он должен быть представлен корпорации Майкрософт, когда вы запрашиваете для первоначального развертывания.**
- **Диапазон IP-адресов подсети Azure VM:** Этот диапазон IP-адресов — это параметр подсети виртуальной сети Azure. Этот параметр находится в виртуальной сети Azure и подключается к среде крупных экземпляров SAP HANA. Этот диапазон IP-адресов используется для назначения IP-адресов виртуальным машинам Azure. IP-адреса вне этого диапазона разрешено использовать для подключения к серверам крупных экземпляров SAP HANA. При необходимости можно использовать несколько подсетей виртуальной машины Azure. Для каждой подсети виртуальной машины Azure рекомендуется блок /24 CIDR. Этот диапазон адресов должен быть частью значений, используемых в адресном пространстве виртуальной сети Azure. Как это можно осуществить? Специалисты по работе с корпоративными сетями или поставщик услуг должны предоставить диапазон IP-адресов, используемый вне сети.
- **Диапазон IP-адресов подсети шлюза виртуальной сети.** В зависимости от функций, которые планируется использовать, мы рекомендуем применять следующие размеры.
   - Ультрапроизводительный шлюз ExpressRoute: блок адресов размером /26 — требуется для номеров SKU класса II.
   - Сосуществование с VPN и ExpressRoute с применением шлюза HighPerformance ExpressRoute (или более низкой версии): блок адресов размером /27.
   - Другие ситуации: блок адресов размером /28. Этот диапазон адресов должен быть частью значений, используемых в адресном пространстве виртуальной сети. Этот диапазон адресов должен быть частью значений, используемых в адресном пространстве виртуальной сети Azure, которые нужно отправить в корпорацию Майкрософт. Как это можно осуществить? Специалисты по работе с корпоративными сетями или поставщик услуг должны предоставить диапазон IP-адресов, используемых вне сети. 
- **Диапазон адресов для подключения ER-P2P** — это диапазон IP-адресов для однорангового подключения ExpressRoute (ER) крупных экземпляров SAP HANA. Это должен быть диапазон IP-адресов CIDR с маской /29. Этот диапазон НЕ ДОЛЖЕН пересекаться с локальным диапазоном адресов и с другими диапазонами IP-адресов Azure. Он используется для настройки подключения ER между шлюзом ExpressRoute виртуальной сети Azure и серверами крупных экземпляров SAP HANA. Как это можно осуществить? Специалисты по работе с корпоративными сетями или поставщик услуг должны предоставить диапазон IP-адресов, используемых вне сети. **Этот диапазон представляет собой диапазон IP-адресов. Он должен быть представлен корпорации Майкрософт, когда вы запрашиваете для первоначального развертывания.**  
- **Диапазон адресов IP-адреса сервера:** Этот диапазон IP-адресов используется для присвоения отдельного IP-адреса серверам HANA. Размер рекомендуемой подсети — блок /24 CIDR. При необходимости его можно уменьшить всего лишь до 64 IP-адресов. Первые 30 IP-адресов в этом диапазоне будут зарезервированы для использования корпорацией Майкрософт. Убедитесь, что этот факт при выборе размера диапазона учитывается. Этот диапазон НЕ ДОЛЖЕН пересекаться с локальным диапазоном адресов и с другими диапазонами IP-адресов Azure. Как это можно осуществить? Специалисты по работе с корпоративными сетями или поставщик услуг должны предоставить диапазон IP-адресов, используемых вне сети.  **Этот диапазон представляет собой диапазон IP-адресов, который должен быть представлен корпорации Майкрософт при запросе для первоначального развертывания.**

Дополнительные диапазоны IP-адресов, которые в конечном итоге должны быть представлены в корпорацию Майкрософт:

- Если вы решили использовать [ExpressRoute Global Reach](https://docs.microsoft.com/azure/expressroute/expressroute-global-reach) для включения прямой маршрутики из помещений в подразделения HANA Large Instance, вам необходимо зарезервировать другой диапазон IP-адресов /29. Этот диапазон может не перекрываться ни с одной из других диапазонов IP-адресов, которые вы определяли ранее.
- Если вы решили использовать [ExpressRoute Global Reach](https://docs.microsoft.com/azure/expressroute/expressroute-global-reach) для включения прямой маршрутики от арендатора HANA Large Instance в одном регионе Azure к другому арендатору HANA Large Instance в другом регионе Azure, вам необходимо зарезервировать другой диапазон IP-адресов /29. Этот диапазон может не перекрываться ни с одной из других диапазонов IP-адресов, которые вы определяли ранее.

Для получения дополнительной информации о ExpressRoute Global Reach и использовании вокруг HANA крупных экземпляров, проверить документы:

- [Сетевая архитектура SAP HANA в Azure (крупные экземпляры)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture)
- [Подключение виртуальной сети к крупным экземплярам HANA](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-connect-vnet-express-route)
 
Необходимо определить и спланировать диапазоны IP-адресов, которые были описаны ранее. Тем не менее передавать все из них в корпорацию Майкрософт не нужно. В корпорацию Майкрософт необходимо отправить следующие диапазоны IP-адресов.

- Адресное пространство виртуальной сети.
- Диапазон IP-адресов для подключений ER-P2P.
- Диапазон IP-адресов пула серверов.

При добавлении дополнительных виртуальных сетей, которым требуется подключиться к крупным экземплярам HANA, необходимо отправить новое адресное пространство виртуальной сети Azure, добавляемой в корпорацию Майкрософт. 

Ниже приведен пример различных диапазонов, которые нужно настроить и отправить в корпорацию Майкрософт. Значение для адресного пространства виртуальной сети Azure не агрегируется в первом примере. Оно определяется на основе диапазона IP-адресов подсети виртуальной машины Azure и диапазона IP-адресов подсети шлюза виртуальной сети. 

Можно использовать несколько подсетей виртуальной машины в виртуальной сети Azure, настроив и отправив дополнительные диапазоны IP-адресов дополнительных виртуальных подсетей в составе адресного пространства виртуальной сети Azure.

![Диапазоны IP-адресов, необходимые для минимального развертывания SAP HANA в Azure (крупные экземпляры)](./media/hana-overview-connectivity/image4b-ip-addres-ranges-necessary.png)

На графике не показан дополнительный диапазон IP-адресов(ы), необходимый для факультативного использования ExpressRoute Global Reach.

Можно также объединить данные, отправленные в корпорацию Майкрософт. В этом случае адресное пространство виртуальной сети Azure будет содержать всего одно пространство. Используя диапазоны IP-адресов из примера выше, объединенное адресное пространство виртуальной сети может выглядеть, как на следующем изображении.

![Второй вариант диапазонов IP-адресов, необходимых для минимального развертывания SAP HANA в Azure (крупные экземпляры)](./media/hana-overview-connectivity/image5b-ip-addres-ranges-necessary-one-value.png)

Как можно заметить в примере, вместо двух диапазонов меньшего размера, определяющих адресное пространство виртуальной сети Azure, у нас есть один больший диапазон, охватывающий 4096 IP-адресов. При таком крупном определении адресного пространства некоторые крупные диапазоны не используются. Так как значения адресного пространства виртуальной сети используются для распространения маршрутов BGP, использование неиспользуемых диапазонов локально или в другой части сети может вызвать проблемы маршрутизации. На графике не показан дополнительный диапазон IP-адресов(ы), необходимый для факультативного использования ExpressRoute Global Reach.

Мы рекомендуем держать адресное пространство в плотном соответствии с фактическим адресным пространством подсети, которое используется. При необходимости вы можете в любое время добавить новые значения адресного пространства позже, не вызывая простоя в виртуальной сети.
 
> [!IMPORTANT] 
> Каждый диапазон IP-адресов ER-P2P, пула серверов IP-адресов и адресное пространство виртуальной сети Azure необходимо **НЕ** перекрывать друг с другом или с другими диапазонами, используемыми в вашей сети. Они должны быть дискретными. Как показано на двух предыдущих рисунках, они не могут быть подсетями другого диапазона. Если диапазоны пересекаются, виртуальная сеть Azure может не подключиться к цепи ExpressRoute.

## <a name="next-steps-after-address-ranges-have-been-defined"></a>Дальнейшие действия после определения диапазонов адресов
После определения диапазонов IP-адресов нужно сделать следующее:

1. Отправить диапазоны IP-адресов для адресного пространства виртуальной сети Azure, подключения ER-P2P и диапазона IP-адресов пула серверов, а также другие данные, указанные в начале документа. На этом этапе также можно приступить к созданию виртуальной сети и подсети виртуальной машины. 
2. Корпорация Майкрософт создает канал ExpressRoute между подпиской Azure и меткой крупных экземпляров HANA.
3. Корпорация Майкрософт создает клиентскую сеть в стеке крупных экземпляров.
4. Специалисты Майкрософт настроят сеть таким образом, чтобы инфраструктура SAP HANA в Azure (крупные экземпляры) принимала IP-адреса из адресного диапазона виртуальной сети Azure, которая будет взаимодействовать с крупными экземплярами HANA.
5. В зависимости от конкретного приобретенного номера SKU SAP HANA в Azure (крупные экземпляры) корпорация Майкрософт назначит единицу вычисления в сети клиента, выделит и подключит хранилище, а также установит операционную систему (SUSE или Red Hat Linux). IP-адреса для этих единиц берутся из диапазона IP-адресов пула серверов, отправленного в корпорацию Майкрософт.

В конце развертывания специалисты Майкрософт отправят вам следующие данные:
- Сведения, нужные для подключения виртуальной сети Azure к каналу ExpressRoute, по которому они подключаются к крупным экземплярам HANA, включают:
     - ключи авторизации;
     - код узла ExpressRoute.
- Данные для доступа к крупным экземплярам HANA по настроенному каналу ExpressRoute и виртуальной сети Azure.

Можно также обратиться к последовательности подключения крупных экземпляров HANA, которая описана в документе [SAP HANA on Azure (Large Instances) Setup](https://azure.microsoft.com/resources/sap-hana-on-azure-large-instances-setup/) (Комплексная настройка крупных экземпляров SAP HANA). Многие из следующих действий демонстрируются в примере развертывания в этом документе. 

## <a name="next-steps"></a>Дальнейшие действия

- См. статью [Подключение виртуальной сети к крупным экземплярам HANA](hana-connect-vnet-express-route.md).
