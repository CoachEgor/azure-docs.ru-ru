---
title: Миграция SAP HANA в Azure (крупные экземпляры) на виртуальные машины Azure | Документация Майкрософт
description: Как выполнить миграцию SAP HANA в Azure (крупные экземпляры) на виртуальные машины Azure
services: virtual-machines-linux
documentationcenter: ''
author: saghorpa
manager: gwallace
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 02/11/2020
ms.author: saghorpa
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 2dd01bf60104939fcf1f9bd1ccec0e7d72710041
ms.sourcegitcommit: 812bc3c318f513cefc5b767de8754a6da888befc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2020
ms.locfileid: "77154924"
---
# <a name="sap-hana-on-azure-large-instance-migration-to-azure-virtual-machines"></a>SAP HANA миграции крупных экземпляров Azure на виртуальные машины Azure
В этой статье описываются возможные сценарии развертывания крупных экземпляров Azure и предлагается подход к планированию и миграции с минимальным временем простоя перехода.

## <a name="overview"></a>Обзор
Так как объявление о больших экземплярах Azure для SAP HANA (ХЛИ) в сентябре 2016, многие клиенты приняли это оборудование как услугу для своей платформы вычислений в памяти.  В последние годы расширение масштабируемости виртуальных машин Azure, объединенное с поддержкой модели масштабного развертывания HANA, превысило максимальное требование к емкости базы данных ERP корпоративных клиентов.  Мы начнем с того, чтобы клиенты выражают необходимость переноса SAP HANA рабочей нагрузки с физических серверов на виртуальные машины Azure.
Это средство не является пошаговым документом по настройке, но он описывает общие модели развертывания и предлагает планирование, а также рекомендации по вызываемым вопросам для подготовки к уменьшению времени простоя перехода.

## <a name="assumptions"></a>Предположения
Для работы с этой статьей предполагается следующее:
- Единственная заинтересованная особенность — это однородная миграция службы базы данных HANA с крупных экземпляров Hana (ХЛИ) на виртуальную машину Azure без значительных обновлений программного обеспечения или исправлений. Эти небольшие обновления включают использование более новой версии ОС или версии HANA, явно оговоренной в соответствующих примечаниях SAP. 
- Все действия по обновлению и обновлению, если нужно выполнить до или после миграции.  Например, SAP HANA МКОС преобразование в развертывание MDC. 
- Подход к миграции, который предложит наименьшее время простоя, SAP HANA репликации системы. Другие методы миграции не являются частью области этого документа.
- Это применимо как для REV3, так и для rev4 номеров SKU ХЛИ.
- Архитектура развертывания HANA во время миграции остается в основном без изменений.  То есть система с одним экземпляром DR останется таким же образом в месте назначения.
- Клиенты проверили и поняли Соглашение об уровне обслуживания (SLA) целевой архитектуры. 
- Из-за различий в коммерческих условиях между Хлис и виртуальными машинами клиенты должны отслеживать использование виртуальных машин для управления затратами.
- Клиенты понимают и подтверждают, что ХЛИ является выделенной платформой вычислений. Однако виртуальные машины работают в общей инфраструктуре, которая защищена и изолирована от других клиентов.
- Клиенты проверили, что целевые виртуальные машины поддерживают предполагаемую архитектуру. Чтобы просмотреть все поддерживаемые SKU виртуальных машин, сертифицированные для SAP HANAного развертывания, проверьте [каталог SAP HANA оборудования](https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/iaas.html#categories=Microsoft%20Azure).
- Клиенты прошли проверку плана проектирования и миграции.
- Запланируйте узел аварийного восстановления вместе с первичным сайтом.  Клиенты не смогут использовать узел аварийного восстановления ХЛИ для первичного сайта, работающего на виртуальных машинах после миграции.
- Клиенты скопировали необходимые файлы резервных копий на целевые виртуальные машины, исходя из требований к восстановлению и соответствию бизнесу. Это позволяет покрыть потребности восстановления на определенный момент времени в течение периода перехода.
- Для HSR высокого уровня доступности клиентам необходимо настроить и настроить STONITH Device per SAP HANA HA Guide for [SLES](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-pacemaker) and [RHEL](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-pacemaker).  Он не является предварительно настроенным как вариант ХЛИ.
- Этот подход к миграции не охватывает номера SKU ХЛИ с конфигурацией Оптане.

## <a name="deployment-scenarios"></a>Сценарии развертывания
Общие модели развертывания с клиентами ХЛИ приведены в следующей таблице.  Возможна миграция на виртуальные машины Azure для всех сценариев ХЛИ.  В некоторых сценариях может потребоваться незначительное изменение архитектуры, чтобы получить преимущества текущих предложений служб Azure.

| Идентификатор сценария | Сценарий ХЛИ | Выполнить миграцию на виртуальную машину буквально? | Комментарий |
| --- | --- | --- | --- |
| 1 | [Один узел с одним идентификатором безопасности](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-one-sid) | Да | - |
| 2 | [Один узел с МКОС](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-mcos) | Да | - |
| 3 | [Один узел с аварийным восстановлением с помощью репликации хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-dr-using-storage-replication) | нет | Репликация хранилища недоступна для виртуальной платформы Azure, измените текущее решение аварийного восстановления на HSR или резервное копирование или восстановление. |
| 4 | [Один узел с аварийным восстановлением (многоцелевые) с использованием репликации хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-dr-multipurpose-using-storage-replication) | нет | Репликация хранилища недоступна для виртуальной платформы Azure, измените текущее решение аварийного восстановления на HSR или резервное копирование или восстановление. |
| 5 | [HSR с STONITH для обеспечения высокой доступности](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#hsr-with-stonith-for-high-availability) | Да | Нет предварительно настроенных SBD для целевых виртуальных машин.  Выберите и разверните решение STONITH.  Возможные варианты: агент ограждения Azure (поддерживается для [RHEL](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-pacemaker), [SLES](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/high-availability-guide-suse-pacemaker)), SBD |
| 6 | [Высокая доступность с помощью HSR, аварийное восстановление с репликацией хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#high-availability-with-hsr-and-dr-with-storage-replication) | нет | Замена репликации хранилища для нужд аварийного восстановления с помощью HSR или резервного копирования или восстановления |
| 7 | [Автоматическая отработка отказа узла (1 + 1)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#host-auto-failover-11) | Да | Использование использовании для общего хранилища с виртуальными машинами Azure |
| 8 | [Горизонтальное масштабирование с резервом](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-with-standby) | Да | BW/4HANA с M128s, M416s, M416ms виртуальных машин, использующих использовании только для хранилища |
| 9 | [Горизонтальное масштабирование без резерва](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-without-standby) | Да | BW/4HANA с виртуальными машинами M128s, M416s, M416ms (с помощью или без использования использовании для хранилища) |
| 10 | [Масштабирование с помощью аварийного восстановления с использованием репликации хранилища](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-with-dr-using-storage-replication) | нет | Замена репликации хранилища для нужд аварийного восстановления с помощью HSR или резервного копирования или восстановления |
| 11 | [Один узел с аварийным восстановлением с помощью HSR](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-with-dr-using-hsr) | Да | - |
| 12 | [Один узел HSR в аварийное восстановление (оптимизированные затраты)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#single-node-hsr-to-dr-cost-optimized) | Да | - |
| 13 | [Высокая доступность и аварийное восстановление с помощью HSR](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#high-availability-and-disaster-recovery-with-hsr) | Да | - |
| 14 | [HA и DR с HSR (оптимизированные затраты)](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#high-availability-and-disaster-recovery-with-hsr-cost-optimized) | Да | - |
| 15 | [Горизонтальное масштабирование с помощью аварийного восстановления с использованием HSR](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-supported-scenario#scale-out-with-dr-using-hsr) | Да | BW/4HANA с M128s. M416s, M416ms виртуальные машины (с помощью или без использования использовании для хранилища) |


## <a name="source-hli-planning"></a>Планирование исходного (ХЛИ)
При подключении сервера ХЛИ как управление службами Майкрософт, так и клиенты проходили планирование вычислений, сети, хранилища и параметров, относящихся к конкретной ОС, для запуска базы данных SAP HANA.  Аналогичное планирование необходимо выполнить для миграции на виртуальную машину Azure.

### <a name="sap-hana-housekeeping"></a>SAP HANA обслуживания 
Перед переносом базы данных HANA рекомендуется выполнить содержимое базы данных, чтобы нежелательные, устаревшие данные или устаревшие журналы не переносились в новую базу данных.  Как правило, для обслуживания используются удаление или архивация старых, просроченных или неактивных данных.  Поэтому эти действия "Data санации" следует тестировать в непроизводственных системах, чтобы проверить правильность их сокращения до использования в рабочей среде.

### <a name="allow-network-connectivity-for-new-vms-and-or-virtual-network"></a>Разрешить сетевое подключение для новых виртуальных машин, или виртуальная сеть 
В развертывании ХЛИ клиента сетевое подключение из Azure виртуальных сетей было установлено на основе сведений, описанных в статье [SAP HANA (крупные экземпляры) сетевая архитектура](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-network-architecture). Кроме того, маршрутизация сетевого трафика выполняется способом, описанным в разделе "Маршрутизация в Azure".
1. Чтобы настроить новую виртуальную машину в качестве целевого объекта HSR для миграции, если новая виртуальная машина Azure размещена в существующей виртуальной сети с диапазонами IP-адресов, у которых уже есть разрешение на подключение к узлу ХЛИ, дальнейшее обновление подключения ХЛИ не требуется.
2. Если новая виртуальная машина Azure размещена в новой виртуальной сети (может находиться в другом регионе) и подключена к существующей виртуальной сети, можно использовать ключ службы ExpressRoute и идентификатор ресурса из исходной подготовки ХЛИ, чтобы разрешить доступ к этому новому диапазону IP-адресов виртуальной сети.  Согласуйте с управлением службами Майкрософт, чтобы обеспечить ХЛИ подключение виртуальной сети.  Примечание. чтобы избежать задержки в сети между уровнями приложения и базы данных, уровни приложения и базы данных должны находиться в одной виртуальной сети.  

### <a name="existing-app-layer-availability-set-availability-zones-and-proximity-placement-group"></a>Существующая группа доступности уровня приложения, Зоны доступности и группы размещения с близкой назначением
Текущая модель развертывания выполняется для удовлетворения определенных целей уровня обслуживания.  В этом перемещении убедитесь, что Целевая инфраструктура соответствует целевым показателям или превышает их.  
Скорее всего, клиенты сервера приложений SAP помещаются в группу доступности.  Если текущим уровнем обслуживания развертывания является удовлетворительная и 
- Если замена сервера SAP HANA выполняется с помощью разрешения имен путем обмена IP-адресами для имени узла базы данных, никаких дополнительных действий не требуется.  
- Если вы не используете ППГ, не забудьте разместить все серверы приложений и баз данных в одной зоне, чтобы избежать задержки в сети.
- Если вы используете ППГ, ознакомьтесь с разделом Планирование назначения, Группа доступности, Зоны доступности и группы размещения близости (ППГ).

### <a name="storage-replication-discontinuance-process-if-used"></a>Процесс прекращения репликации хранилища (если используется)
Если репликация хранилища используется в качестве решения аварийного восстановления, то после завершения работы приложения SAP репликация должна быть прервана (незапланированная), а последняя SAP HANA каталог, файл журнала, резервные копии данных будут реплицированы на тома удаленного хранилища.  Это действие является предосторожностью, способов, что у нас есть текущая база данных на ХЛИ аварийного восстановления в случае сбоя во время перехода физического компьютера в виртуальную машину Azure.

### <a name="data-backups-preservation-consideration"></a>Важность сохранения резервных копий данных
После того как прямую миграцию SAP HANA на виртуальной машине Azure, все данные на основе моментальных снимков или резервные копии журналов на ХЛИ не будут легко доступны или restorable на виртуальной машине, если это необходимо. Для раннего перехода на резервную копию на основе Azure с достаточным объемом журнала, чтобы удовлетворить требования к восстановлению на определенный момент времени, рекомендуется использовать резервные копии на уровне файлов в дополнение к моментальным снимкам в ХЛИ, Days/weeks до прямую миграцию.  Эти резервные копии копируются в учетную запись хранения Azure, доступную для новой виртуальной машины SAP HANA. Помимо резервного копирования содержимого ХЛИ, также рекомендуется создать полные резервные копии в альбоме SAP, которые доступны в случае необходимости отката.

### <a name="adjusting-system-monitoring"></a>Настройка мониторинга системы 
Клиенты используют множество различных средств для мониторинга и отправки уведомлений об оповещениях для систем в своей ландшафте SAP.  Этот элемент является просто вызовом для соответствующего действия при добавлении новых виртуальных машин, включающих любую корректировку для мониторинга и обновления получателей уведомлений о предупреждениях при необходимости.

### <a name="microsoft-operations-team-involvement"></a>Участие в группе Microsoft Operations 
Откройте билет из портал Azure основанных на существующем экземпляре ХЛИ.  После создания запроса в службу поддержки он свяжется с вами по электронной почте.  

### <a name="engage-microsoft-account-team"></a>Участие в группе разработчиков учетных записей Майкрософт
Планируйте миграцию ближе к времени продления ХЛИ контракта, чтобы уменьшить излишние расходы на ресурсы вычислений. Чтобы списать колонку ХЛИ, необходимо координировать завершение контракта и фактическое завершение работы единицы.

## <a name="destination-planning"></a>Планирование назначений
Благодаря новой инфраструктуре, которая принимает место существующего, заслуживает некоторого мышления о том, что новое сложение будет помещаться в большой схеме вещей.  Ниже приведены некоторые ключевые моменты для размышления.

### <a name="resource-availability-in-the-target-region"></a>Доступность ресурсов в целевом регионе 
Текущий регион развертывания сервера приложений SAP, как правило, находится в близком к связанному Хлис.  Однако Хлис предлагаются в меньшем объеме, чем доступные регионы Azure.  При переходе с физического ХЛИ на виртуальную машину Azure вы сможете точно настроить расстояние в близости от всех связанных служб для оптимизации производительности.  При этом важно учитывать, что в выбранном регионе есть нужные ресурсы.  Например, доступность определенного семейства виртуальных машин или предложения зон Azure для обеспечения высокого уровня доступности.

### <a name="virtual-network"></a>Виртуальная сеть 
Архитектор инфраструктуры будет иметь возможность выбрать, следует ли выполнять новую базу данных HANA в существующей виртуальной сети приложения SAP или создать новую.  Основным конструктивным фактором является текущий макет сети для ландшафта SAP.  В случае изменения инфраструктуры развертывания рассматривается, например, переход от одной зоны к развертыванию с двумя зонами и использование преимуществ ППГ. Это улучшение доступности накладывает изменения архитектуры. Дополнительные сведения см. в статье [Azure ППГ для обеспечения оптимальной сетевой задержки с помощью приложения SAP](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-proximity-placement-scenarios).   

### <a name="security"></a>безопасность
Является ли новая виртуальная машина виртуальной машины SAP HANA новой или существующей виртуальной сетью или подсетью, она представляет новую критическую для бизнеса службу, требующую защиты.  Правильное управление доступом, совместимое с политикой безопасности сведений о компании для этого нового класса службы, должно оцениваться и развертываться. 

### <a name="vm-sizing-recommendation"></a>Рекомендации по выбору размера виртуальной машины
Эта миграция также позволяет правильно изменить размер подсистемы вычислений HANA.  Можно использовать [системные представления](https://help.sap.com/viewer/7c78579ce9b14a669c1f3295b0d8ca16/Cloud/3859e48180bb4cf8a207e15cf25a7e57.html) Hana совместно с Hana Studio, чтобы понять потребление системных ресурсов, что позволяет правильно изменять размер для повышения эффективности затрат.

### <a name="storage"></a>Память 
Производительность хранилища — это один из факторов, влияющих на взаимодействие с пользователями приложений SAP.  Основано на заданном номере SKU виртуальной машины. существуют рекомендации по [настройке хранилища виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations-storage), опубликованные SAP HANA. Мы рекомендуем просмотреть эти минимальные спецификации и сравнить существующую статистику системы ХЛИ, чтобы обеспечить достаточную емкость операций ввода-вывода и производительность для новой виртуальной машины HANA.

Если вы настроили ППГ для новой виртуальной машины HANA и связанных с ней серверов, отправьте запрос в службу поддержки для проверки и обеспечения совместного размещения хранилища и виртуальной машины HANA.  
Так как вам может потребоваться изменить решение резервного копирования, следует также повторно посещать затраты на хранение, чтобы избежать непредвиденных расходов на эксплуатацию. 

### <a name="storage-replication-for-disaster-recovery"></a>Репликация хранилища для аварийного восстановления
В ХЛИ репликация хранилища была предложена по умолчанию для репликации аварийного восстановления базы данных HANA. Эта функция не является параметром по умолчанию для виртуальной машины Azure. Рассмотрим HSR, резервное копирование и восстановление или другие поддерживаемые решения, удовлетворяющие потребностям вашего бизнеса.

### <a name="availability-sets-availability-zones-and-proximity-placement-groups"></a>Группы доступности, Зоны доступности и групп размещения с учетом расположения 
Чтобы свести к минимуму расстояние между уровнем приложения и SAP HANA, чтобы обеспечить минимальную задержку в сети, Новая виртуальная машина базы данных и текущие серверы приложений SAP должны быть помещены в группу размещения с учетом расположения (ППГ). Сведения о том, как группа доступности Azure и Зоны доступности работают с ППГ для развертываний SAP, см. в [группе размещения с близкой](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-proximity-placement-scenarios) назначением.
Если члены целевой системы HANA развернуты в нескольких зонах Azure, клиенты должны иметь четкое представление о профиле задержки выбранных зон. Размещение системных компонентов SAP оптимально в отношении расстояния проксимал между приложением SAP и базой данных.  [Средство тестирования задержки зоны доступности](https://github.com/Azure/SAP-on-Azure-Scripts-and-Utilities/tree/master/AvZone-Latency-Test) общедоступного домена упрощает измерение.  


### <a name="backup-strategy"></a>Стратегия резервного копирования
Многие клиенты уже используют сторонние решения резервного копирования для SAP HANA на ХЛИ.  В этом случае необходимо настроить только дополнительную защищенную виртуальную машину и базы данных HANA.  Текущие задания резервного копирования ХЛИ теперь не планируются, если после миграции компьютер выдается из эксплуатации.
Служба архивации Azure для SAP HANA на виртуальной машине теперь общедоступна.  Ниже приведены ссылки на подробные сведения о [резервном](https://docs.microsoft.com/azure/backup/backup-azure-sap-hana-database)копировании, [восстановлении](https://docs.microsoft.com/azure/backup/sap-hana-db-restore), [управлении](https://docs.microsoft.com/azure/backup/sap-hana-db-manage) SAP HANA резервным копированием на виртуальных машинах Azure.

### <a name="dr-strategy"></a>Стратегия аварийного восстановления
Если цели уровня обслуживания имеют более длительное время восстановления простой резервной копии в хранилище BLOB-объектов, а также восстановление на месте или на новую виртуальную машину, это самая простая и наименее дорогостоящая стратегия АВАРИЙного восстановления.  
Как и платформа крупных экземпляров, где HANA DR обычно выполняется с помощью HSR; На виртуальной машине Azure HSR является также самым естественным и собственным SAP HANAным решением аварийного восстановления.  Независимо от того, является ли развертывание источником единственным экземпляром, кластеризованным или без автоматической отработки отказа, или масштабируемым HANA с несколькими узлами, в регионе аварийного восстановления требуется Целевая реплика HSR исходной инфраструктуры. Эта HSR Целевая реплика аварийного восстановления будет установлена после завершения миграции первичной виртуальной машины ХЛИ.  Экземпляр HANA для аварийного восстановления будет зарегистрирован в первичной SAP HANA экземпляра виртуальной машины в качестве вторичного сайта репликации.  

### <a name="sap-application-server-connectivity-destination-change"></a>Изменение места назначения для подключения к серверу приложений SAP
Подход, HSR миграцию, приводит к новому узлу базы данных HANA и, следовательно, новому имени узла базы данных для уровня приложения, профили SAP должны быть изменены для отражения нового имени узла.  Если параметр выполняется с помощью разрешения имен, сохраняя имя узла, изменение профиля не требуется.

### <a name="operating-system"></a>Операционная система
Образы операционной системы для ХЛИ и виртуальных машин, даже если они имеют одинаковый уровень выпуска, например SLES 11 SP4, не идентичны. Клиенты должны проверить необходимые пакеты, исправления, исправления, ядро и исправления безопасности в ХЛИ, чтобы их можно было установить в операционной системе целевой виртуальной машины.  Кроме того, клиенты часто настраивают более новую версию ОС на целевой виртуальной машине для SAP HSR.  Это поддерживается в соответствии с [примечанием SAP 2763388](https://launchpad.support.sap.com/#/notes/2763388).

### <a name="new-sap-license-request"></a>Новый запрос лицензии SAP
Простой вызов для запроса новой лицензии SAP для новой системы HANA теперь, чтобы она была перенесена на виртуальные машины.

### <a name="service-level-agreement-sla-differences"></a>Различия в соглашении об уровне обслуживания (SLA)
Авторы, например, называю разницу между ХЛИ и виртуальной машиной Azure.  Например, Хлисные пары доступности с высоким уровнем доступности обеспечивают доступность 99,99%. Для достижения одного и того же соглашения об уровне обслуживания необходимо развернуть виртуальные машины в зонах доступности. В этой [статье](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_9/) описывается доступность с помощью связанных архитектур развертывания, чтобы клиенты могли соответствующим образом спланировать целевую инфраструктуру.


## <a name="migration-strategy"></a>Стратегия миграции
В этом документе мы рассмотрим только подход к репликации системы HANA для миграции с ХЛИ на виртуальную машину Azure.  Зависит от развернутого целевого решения хранилища. Этот процесс немного отличается. Общие действия описаны ниже.

### <a name="vm-with-premiumultra-disks-for-data"></a>Виртуальная машина с Premium или Ultra-Disks для данных
Для виртуальных машин, развернутых с помощью Premium или Ultra-Disks, применяется стандартная конфигурация репликации SAP HANA системы, которую можно использовать для установки HSR.  [Справочная статья SAP](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.04/099caa1959ce4b3fa1144562fa09e163.html) содержит общие сведения о шагах, связанных с настройкой репликации системы между двумя системами, переходом на вторичную систему, возвратом в основную систему и отключением репликации системы.  Для целей миграции потребуется только Настройка, переработка и отключение репликации системы на шагах источника ХЛИ.  

### <a name="vm-with-anf-for-data-and-log-volumes"></a>Виртуальная машина с использовании для томов данных и журналов
На высоком уровне последние моментальные снимки хранилища ХЛИ для всех томов данных и журналов должны быть скопированы в службу хранилища Azure, где они доступны и могут быть восстановлены целевой виртуальной машиной HANA.  Процесс копирования можно выполнить с помощью любых собственных средств копирования Linux.  

>[!Important]
> Скорость копирования и передачи данных может занять несколько часов, зависит от размера базы данных HANA и пропускной способности сети.  Основная часть процесса копирования должна быть выполнена заранее, чем время простоя первичной базы данных HANA.

### <a name="mcos-to-mdc-conversion"></a>Преобразование МКОС в MDC
Несколько компонентов в одной системе (МКОС) были выбраны некоторыми из наших клиентов ХЛИ.  Мотивация заключается в обходе ограничения на моментальные снимки хранилища контейнеров нескольких баз данных (MDC) более ранних версий SAP HANA.  В модели МКОС несколько независимых экземпляров SAP HANA помещаются в одну колонку ХЛИ.  Использование HSR для миграции будет работать нормально в результате нескольких виртуальных машин HANA с одной базой данных клиента.  Это конечное состояние повышает качество, чем может быть у клиента.  При развертывании SAP HANA 2,0 по умолчанию MDC можно выполнить [перемещение клиента Hana](https://launchpad.support.sap.com/#/notes/2472478) после миграции HSR.  Этот процесс объединяет эти независимые базы данных HANA в клиенты в одном контейнере HANA.  

### <a name="application-layer-consideration"></a>Вопросы о прикладном уровне
Сервер базы данных отображается в качестве центра системы SAP.  Все серверы приложений должны располагаться рядом с SAP HANA DB.  В некоторых случаях, когда требуется новое использование ППГ, переместите существующие серверы приложений на ППГ, где может потребоваться виртуальная машина HANA.  Создание новых серверов приложений может быть проще, если шаблоны развертывания уже имеются под рукой.  
Если существующие серверы приложений и Новая виртуальная машина HANA оптимально расположены, новые серверы приложений создавать не нужно, пока не будет нужна дополнительная емкость.  
Если создана новая инфраструктура для повышения доступности служб, существующие серверы приложений могут оказаться ненужными и должны быть выключены и удалены.
Если имя узла целевой виртуальной машины изменилось и отличается от имени узла ХЛИ, необходимо настроить профили сервера приложений SAP, чтобы они указывали на новый узел.  Если изменился только IP-адрес базы данных HANA, необходимо обновить запись DNS, чтобы привести входящие подключения к новой виртуальной машине HANA.

### <a name="acceptance-test"></a>Приемочный тест
Несмотря на то, что миграция с ХЛИ на виртуальную машину не вносит изменений в содержимое базы данных по сравнению с разнородной миграцией, мы по-прежнему рекомендуем проверять ключевые функциональные возможности и аспекты производительности новой установки.  

### <a name="cutover-plan"></a>План прямую миграцию
Несмотря на то, что миграция выполняется прямо вперед, она включает в себя списание существующей базы данных.  Тщательное планирование сохранения исходной системы со связанным содержимым и изображениями резервных копий очень важно в случае необходимости резервного копирования.  Хорошее планирование предлагает спидиер Сторнирование.   


## <a name="post-migration"></a>Действия после перемещения
Задание миграции не выполняется до тех пор, пока не будут безопасно отключены какие-либо службы или подключения, зависящие от ХЛИ, для обеспечения сохранности данных.  Кроме того, завершите работу ненужных служб.  В этом разделе приводится несколько наиболее подходящих элементов.

### <a name="decommissioning-the-hli"></a>Списание ХЛИ
После успешной миграции базы данных HANA на виртуальную машину Azure не следует выполнять рабочие бизнес-транзакции в ХЛИ DB.  Тем не менее, поддержание ХЛИ в течение периода, равного периоду хранения резервных копий данных, является надежной практикой, гарантируя при необходимости восстановление данных спидиер.  Только после этого должна быть списана колонка ХЛИ.  В дополнение к техническим вопросам, клиенты в своих лучших интересах должны заключить в договоры обязательства ХЛИ с корпорацией Майкрософт.  Клиенты должны обратиться к представителям корпорации Майкрософт для работы с процессом списания ХЛИ.

### <a name="remove-any-proxy-ex-iptables-bigip-configured-for-hli"></a>Удалите все прокси-серверы (например: iptables, BIGIP), настроенные для ХЛИ 
Если прокси-служба, такая как IPTables, используется для маршрутизации локального трафика в ХЛИ, эта служба больше не требуется после успешной миграции на виртуальную машину.  Однако эту службу подключения следует хранить до тех пор, пока колонка ХЛИ по-прежнему находится в разделе о списании.  Эта служба может быть завершена после того, как колонка ХЛИ будет полностью списана. 

### <a name="remove-global-reach-for-hli"></a>Удаление Global Reach для ХЛИ 
Global Reach обычно используется для подключения шлюза ExpressRoute клиента к шлюзу ExpressRoute ХЛИ, который позволяет локальному трафику клиента обращаться к клиенту ХЛИ напрямую без необходимости использования прокси-службы.  Как и в случае со службой прокси IPTables, Глобалреач следует хранить до тех пор, пока не будет полностью списана колонка ХЛИ.

### <a name="operating-system-subscription--movereuse"></a>Подписка операционной системы — перемещение и повторное использование
По мере того, как серверы виртуальных машин становятся стоялиами и выводятся колонки ХЛИ, подписки ОС можно заменить или повторно использовать, чтобы избежать двойной оплаты лицензий ОС.



## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи:
- [SAP HANA конфигураций и операций инфраструктуры в Azure](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations).
- [Рабочие нагрузки SAP в Azure: контрольный список для планирования и развертывания](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/sap-deployment-checklist).
