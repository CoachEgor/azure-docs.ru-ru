---
title: Обновление операционной системы для SAP HANA в Azure (крупные экземпляры) | Документация Майкрософт
description: Выполнение обновления операционной системы для SAP HANA в Azure (крупные экземпляры).
services: virtual-machines-linux
documentationcenter: ''
author: saghorpa
manager: gwallace
editor: ''
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 07/04/2019
ms.author: juergent
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 0275d30f2314073af07eced224ade47c49e580c1
ms.sourcegitcommit: b8f2fee3b93436c44f021dff7abe28921da72a6d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2020
ms.locfileid: "77425382"
---
# <a name="operating-system-upgrade"></a>Обновление операционной системы
В этом документе описывается обновление операционной системы в HANA (крупные экземпляры).

>[!NOTE]
>Обновление операционной системы — это ответственность клиента, служба поддержки Microsoft Operations может помочь вам в изходе обновления. Перед планированием обновления необходимо обратиться к поставщику операционной системы.

Во время подготовки модульной подсистемы Microsoft Operations ХЛИ устанавливает операционную систему.
Со временем вам потребуется обслуживать операционную систему (пример: установка исправлений, настройка, обновление и т. д.) на модуле HLI.

Перед внесением основных изменений в операционную систему (например, обновление с пакетом обновления 1 (SP1)) необходимо обратиться в службу Microsoft Operations, отправив запрос в службу поддержки.

Добавьте в свой билет:

* Идентификатор подписки HLI.
* Имя вашего сервера.
* Уровень исправления, который необходимо применить.
* Дата планирования этого изменения. 

Мы рекомендуем вам открыть этот запрос по крайней мере за неделю до желаемой даты обновления, поскольку команда Operations проверяет необходимость обновления прошивки в колонке сервера.


Сведения о совместимости другой версии SAP HANA с другими версиями Linux см. в [примечании SAP № 2235581](https://launchpad.support.sap.com/#/notes/2235581).


## <a name="known-issues"></a>Известные проблемы

Ниже приведены некоторые распространенные известные проблемы, возникающие во время обновления.
- Для категории номеров SKU класса II после установки новой версии операционной системы удаляется Software Foundation Server (SFS). После обновления ОС необходимо переустановить совместимый СФС.
- Драйверы карт Ethernet (ENIC и FNIC) откатываются до предыдущей версии. После обновления необходимо переустановить совместимую версию драйверов.

## <a name="sap-hana-large-instance-type-i-recommended-configuration"></a>Рекомендуемая конфигурация SAP HANA крупного экземпляра (тип I)

Конфигурация операционной системы может отменять Рекомендуемые параметры с течением времени из-за исправлений, обновлений системы и изменений, внесенных клиентами. Кроме того, корпорация Майкрософт выявляет обновления, необходимые для существующих систем, чтобы обеспечить оптимальную конфигурацию для оптимальной производительности и устойчивости. Следующие инструкции описывают рекомендации, которые устраняют производительность сети, стабильность системы и оптимальную производительность HANA.

### <a name="compatible-enicfnic-driver-versions"></a>Совместимые версии драйверов ЕНИК/Фник
  Чтобы обеспечить правильную производительность сети и стабильность системы, рекомендуется убедиться, что соответствующая версия драйверов ЕНИК и Фник для конкретной операционной системы установлена, как показано в следующей таблице совместимости. Серверы доставляются клиентам с совместимыми версиями. Обратите внимание, что в некоторых случаях при установке исправлений для ОС и ядра драйверы можно откатить к версии драйвера по умолчанию. Убедитесь, что соответствующая версия драйвера запущена после операций исправления операционной системы или ядра.
       
      
  |  Поставщик ОС    |  Версия пакета ОС     |  Драйвер ЕНИК  |  Драйвер Фник |
  |---------------|-------------------------|---------------|--------------|
  |   SuSE        |  SLES 12 SP2            |   2.3.0.40    |   1.6.0.34   |
  |   SuSE        |  SLES 12 SP3            |   2.3.0.44    |   1.6.0.36   |
  |   Red Hat     |  RHEL 7.2;               |   2.3.0.39    |   1.6.0.34   |
 

### <a name="commands-for-driver-upgrade-and-to-clean-old-rpm-packages"></a>Команды для обновления драйверов и очистки старых пакетов RPM
```
rpm -U driverpackage.rpm
rpm -e olddriverpackage.rpm
```

#### <a name="commands-to-confirm"></a>Команды для подтверждения
```
modinfo enic
modinfo fnic
```

### <a name="suse-hlis-grub-update-failure"></a>Сбой обновления для SuSE Хлис GRUB
При обновлении крупные экземпляры SAP в Azure HANA (тип I) могут находиться в незагрузочном состоянии. Описанная ниже процедура решает эту проблему.
#### <a name="execution-steps"></a>Шаги выполнения


*   Выполните команду `multipath -ll`.
*   Получите идентификатор LUN, размер которого равен приблизительно 50G, или используйте команду: `fdisk -l | grep mapper`
*   Обновление `/etc/default/grub_installdevice` файла `/dev/mapper/<LUN ID>`Line. Пример:/dev/Mapper/3600a09803830372f483f495242534a56
>[!NOTE]
>ИДЕНТИФИКАТОР LUN отличается от сервера к серверу.


### <a name="disable-edac"></a>Отключить ЕДАК 
   Модуль обнаружения и исправления ошибок (ЕДАК) помогает обнаружить и исправить ошибки памяти. Однако базовое оборудование для SAP HANA на крупных экземплярах Azure (тип I) уже выполняет ту же функцию. Наличие той же функции на уровнях оборудования и операционной системы (ОС) может привести к конфликтам и может привести к случайным и незапланированным завершениям работы сервера. Поэтому рекомендуется отключить модуль от операционной системы.

#### <a name="execution-steps"></a>Шаги выполнения

* Проверьте, включен ли модуль ЕДАК. Если в приведенной ниже команде возвращается результат, это означает, что модуль включен. 
```
lsmod | grep -i edac 
```
* Отключите модули, добавив следующие строки в файл `/etc/modprobe.d/blacklist.conf`
```
blacklist sb_edac
blacklist edac_core
```
Чтобы внести изменения на месте, требуется перезагрузка. Выполните команду `lsmod` и убедитесь, что модуль отсутствует в выходных данных.


### <a name="kernel-parameters"></a>параметры ядра;
   Убедитесь, что применяются правильные параметры для `transparent_hugepage`, `numa_balancing`, `processor.max_cstate`, `ignore_ce` и `intel_idle.max_cstate`.

* intel_idle. max_cstate = 1
* процессор. max_cstate = 1
* transparent_hugepage = Never
* numa_balancing = Disable
* MCE = ignore_ce


#### <a name="execution-steps"></a>Шаги выполнения

* Добавьте эти параметры в строку `GRB_CMDLINE_LINUX` в файле `/etc/default/grub`
```
intel_idle.max_cstate=1 processor.max_cstate=1 transparent_hugepage=never numa_balancing=disable mce=ignore_ce
```
* Создайте новый файл GRUB.
```
grub2-mkconfig -o /boot/grub2/grub.cfg
```
* Перезагрузка системы.


## <a name="next-steps"></a>Дальнейшие действия
- Ознакомьтесь с [резервным копированием и восстановлением](hana-overview-high-availability-disaster-recovery.md) операционной системы для номеров SKU класса I.
- См. статью [резервное копирование ОС для номеров SKU типа II версий 3](os-backup-type-ii-skus.md) для класса SKU типа II.
