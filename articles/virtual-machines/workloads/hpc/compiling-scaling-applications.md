---
title: Масштабирование hPC-приложений - Виртуальные машины Azure Документы Майкрософт
description: Узнайте, как масштабировать приложения HPC на M Ms Azure.
services: virtual-machines
documentationcenter: ''
author: vermagit
manager: gwallace
editor: ''
tags: azure-resource-manager
ms.service: virtual-machines
ms.workload: infrastructure-services
ms.topic: article
ms.date: 05/15/2019
ms.author: amverma
ms.openlocfilehash: 00d5b86c8cae01d342d55b7ad20ec59c3f7530bd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "67707841"
---
# <a name="scaling-hpc-applications"></a>Масштабирование hPC-приложений

Оптимальное масштабирование и масштабирование производительности приложений HPC в Azure требует экспериментов по настройке производительности и оптимизации для конкретной рабочей нагрузки. В этом разделе и страницах серии VM содержатся общие рекомендации по масштабированию приложений.

## <a name="compiling-applications"></a>Составление приложений

Хотя это и не требуется, компиляция приложений с соответствующими флагами оптимизации обеспечивает наилучшую производительность масштабирования на HB и HC-серии VMs.

### <a name="amd-optimizing-cc-compiler"></a>AMD Оптимизация C / C е Компилятор

Система компилятора AMD Optimizing C/C-Compiler (AOCC) предлагает высокий уровень расширенной оптимизации, многопоточной поддержки и поддержки процессоров, которая включает глобальную оптимизацию, векторизацию, межпроцедурный анализ, преобразования циклов и генерацию кода. Бинарные файлы компилятора AOCC подходят для систем Linux, имеющих версию GNU C Library (glibc) 2.17 и выше. Набор компилятора состоит из компилятора C/C '(clang), компилятора Fortran (FLANG) и передней части Fortran clang (Dragon Egg).

### <a name="clang"></a>Clang

Clang — это компилятор C, C и Objective-C, обрабатывающий предварительную обработку, разбор, оптимизацию, генерацию кода, сборку и связь. Clang поддерживает `-march=znver1` флаг, чтобы обеспечить лучшее создание кода и настройку для архитектуры x86 на основе ДЗAMD.

### <a name="flang"></a>FLANG

Компилятор FLANG является недавним дополнением к набору AOCC (добавлен в апреле 2018 года) и в настоящее время находится в предварительном выпуске для разработчиков для загрузки и тестирования. Основываясь на Fortran 2008, AMD расширяет версиюhttps://github.com/flangcompiler/flang)GitHub FLANG ( . Компилятор FLANG поддерживает все параметры компилятора Clang и дополнительное количество вариантов компилятора FLANG.

### <a name="dragonegg"></a>DragonEgg

DragonEgg является gcc плагин, который заменяет оптимизаторы GCC и генераторы кода с теми, из проекта LLVM. DragonEgg, который поставляется с AOCC работает с gcc-4.8.x, был протестирован на x86-32/x86-64 целей и был успешно использован на различных платформах Linux.

GFortran является фактическим фронтпередом для программ Fortran, ответственных за предварительную обработку, анализ и семантический анализ генерации GCC GIMPLE промежуточного представительства (IR). DragonEgg является плагин GNU, подключение к GFortran компиляции потока. Он реализует API плагина GNU. С архитектурой плагина, DragonEgg становится драйвером компилятора, управляя различными фазами компиляции.  После следующих инструкций по загрузке и установке, Dragon Egg можно высаживаться с помощью: 

```bash
$ gfortran [gFortran flags] 
   -fplugin=/path/AOCC-1.2-Compiler/AOCC-1.2-     
   FortranPlugin/dragonegg.so [plugin optimization flags]     
   -c xyz.f90 $ clang -O3 -lgfortran -o xyz xyz.o $./xyz
```
   
### <a name="pgi-compiler"></a>Пилюбер PGI
PGI Community Edition ver. 17 подтверждено для работы с AMD EPYC. PGI-компилированная версия STREAM обеспечивает полную пропускную способность памяти платформы. Новое издание Сообщества 18.10 (ноябрь 2018) также должно хорошо работать. Ниже приведен образец CLI для оптимального компилятора с intel Compiler:

```bash
pgcc $(OPTIMIZATIONS_PGI) $(STACK) -DSTREAM_ARRAY_SIZE=800000000 stream.c -o stream.pgi
```

### <a name="intel-compiler"></a>Компилятор Intel
Intel Compiler ver. 18 подтверждено для работы с AMD EPYC. Ниже приведен образец CLI для оптимального компилятора с intel Compiler.

```bash
icc -o stream.intel stream.c -DSTATIC -DSTREAM_ARRAY_SIZE=800000000 -mcmodel=large -shared-intel -Ofast –qopenmp
```

### <a name="gcc-compiler"></a>Компилятор GCC 
Для HPC, AMD рекомендует Компилятор GCC 7.3 или новее. Старые версии, такие как 4.8.5, включенные в RHEL/CentOS 7.4, не рекомендуются. GCC 7.3, и новые, будет поставлять значительно более высокую производительность на HPL, HPCG, и DGEMM испытаний.

```bash
gcc $(OPTIMIZATIONS) $(OMP) $(STACK) $(STREAM_PARAMETERS) stream.c -o stream.gcc
```

## <a name="scaling-applications"></a>Масштабирование приложений 

Следующие предложения применяются для оптимальной эффективности масштабирования приложений, производительности и согласованности:

* Прикреплять процессы к ядрам 0-59 с использованием последовательного подхода к закреплению (в отличие от подхода автоматического баланса). 
* Связывание numa/Core/HwThread лучше, чем привязка по умолчанию.
* Для гибридных параллельных приложений (OpenMP-MPI) используйте 4 потока и 1 ранг MPI на CCX.
* Для чистых приложений MPI, эксперимент с 1-4 MPI ряды за CCX для оптимальной производительности.
* Некоторые приложения с крайней чувствительностью к пропускной способности памяти могут извлечь выгоду из использования уменьшенного количества ядер на CCX. Для этих приложений использование 3 или 2 ядер на CCX может уменьшить количество проблем с пропускной способностью памяти и повысить производительность в реальном мире или более последовательную масштабируемость. В частности, от этого может выиграть MPI Allreduce.
* Для значительно больших масштабов, рекомендуется использовать UD или гибридные транспорты RC-UD. Многие библиотеки MPI/время выполнения библиотеки делают это внутренне (например, UCX или MVAPICH2). Проверьте конфигурацию транспорта для крупномасштабных запусков.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте больше о [HPC](https://docs.microsoft.com/azure/architecture/topics/high-performance-computing/) на Azure.
