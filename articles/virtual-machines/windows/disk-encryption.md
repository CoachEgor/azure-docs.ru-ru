---
title: Шифрование управляемых дисков Azure на стороне сервера — PowerShell
description: Служба хранилища Azure защищает ваши данные путем шифрования неактивных данных перед их сохранением в кластерах хранилища. Для шифрования управляемых дисков можно использовать ключи, управляемые корпорацией Майкрософт, или ключи, управляемые клиентом, для управления шифрованием своими собственными ключами.
author: roygara
ms.date: 09/23/2020
ms.topic: conceptual
ms.author: rogarana
ms.service: virtual-machines
ms.subservice: disks
ms.custom: references_regions
ms.openlocfilehash: 49898f2215139c4460c639dc8caa3d2764082e34
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91274781"
---
# <a name="server-side-encryption-of-azure-disk-storage-for-powershell"></a>Шифрование Хранилище дисков Azure на стороне сервера для PowerShell

Шифрование на стороне сервера (SSE) защищает данные и помогает соблюсти корпоративные обязательства по обеспечению безопасности и соответствия. SSE автоматически шифрует данные, хранящиеся на управляемых дисках Azure (диски операционной системы и дисков данных), по умолчанию при сохранении их в облаке. 

Данные в управляемых дисках Azure шифруются прозрачно с использованием 256-разрядного [шифрования AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard), одного из наиболее сильных блочных шифров, который совместим со стандартом FIPS 140-2. Дополнительные сведения о криптографических модулях, лежащих в основе функции управляемых дисков Azure, см. в статье [Cryptography API: Next Generation](/windows/desktop/seccng/cng-portal) (API Cryptography: следующее поколение).

Шифрование на стороне сервера не влияет на производительность управляемых дисков и не дает дополнительных затрат. 

> [!NOTE]
> Временные диски не являются управляемыми дисками и не шифруются с помощью SSE, если только вы не Включите шифрование на узле.

## <a name="about-encryption-key-management"></a>Об управлении ключами шифрования

Вы можете использовать ключи, управляемые платформой, для шифрования управляемого диска или управлять шифрованием с помощью собственных ключей. Если вы решили управлять шифрованием с помощью собственных ключей, вы можете указать *управляемый клиентом ключ*, который будет использоваться для шифрования и расшифровки всех данных на управляемых дисках. 

В следующих разделах подробно описаны все варианты управления ключами.

### <a name="platform-managed-keys"></a>Ключи, управляемые платформой

По умолчанию управляемые диски используют управляемые платформой ключи шифрования. Все управляемые диски, моментальные снимки, изображения и данные, записанные на существующие управляемые диски, автоматически шифруются с помощью ключей, управляемых платформой.

### <a name="customer-managed-keys"></a>Ключи, управляемые клиентом

[!INCLUDE [virtual-machines-managed-disks-description-customer-managed-keys](../../../includes/virtual-machines-managed-disks-description-customer-managed-keys.md)]

#### <a name="restrictions"></a>Ограничения

В настоящее время ключи, управляемые клиентом, имеют следующие ограничения.

- Если эта функция включена для диска, ее нельзя отключить.
    Если нужно обойти это ограничение, необходимо [скопировать все данные](disks-upload-vhd-to-managed-disk-powershell.md#copy-a-managed-disk) на другой управляемый диск, не использующий ключи, управляемые клиентом.
[!INCLUDE [virtual-machines-managed-disks-customer-managed-keys-restrictions](../../../includes/virtual-machines-managed-disks-customer-managed-keys-restrictions.md)]

#### <a name="supported-regions"></a>Поддерживаемые регионы

Ключи, управляемые клиентом, доступны во всех регионах, где доступны управляемые диски.

## <a name="encryption-at-host---end-to-end-encryption-for-your-vm-data"></a>Шифрование на основе сквозного шифрования данных виртуальной машины

Сквозное шифрование начинается с узла виртуальной машины, сервера Azure, на который выделяется виртуальная машина. Данные на временных дисках, временных дисках ОС и дисковых кэшах ОС и данных хранятся на этом узле виртуальной машины. При включении сквозного шифрования все эти данные шифруются в неактивных потоках и передаются в зашифрованном виде в службу хранилища, где они сохраняются. Полное шифрование не использует ЦП виртуальной машины и не влияет на производительность виртуальной машины. 

Временные диски и временные диски ОС шифруются при хранении с помощью ключей, управляемых платформой, при включении сквозного шифрования. Кэш операционной системы и диска данных шифруется при хранении с помощью управляемых клиентом или управляемых платформой ключей в зависимости от типа шифрования. Например, если диск зашифрован ключами, управляемыми клиентом, то кэш для диска шифруется с помощью ключей, управляемых клиентом, а если диск шифруется с помощью ключей, управляемых платформой, кэш диска шифруется с помощью ключей, управляемых платформой.

### <a name="restrictions"></a>Ограничения

[!INCLUDE [virtual-machines-disks-encryption-at-host-restrictions](../../../includes/virtual-machines-disks-encryption-at-host-restrictions.md)]

#### <a name="supported-regions"></a>Поддерживаемые регионы

[!INCLUDE [virtual-machines-disks-encryption-at-host-regions](../../../includes/virtual-machines-disks-encryption-at-host-regions.md)]

#### <a name="supported-vm-sizes"></a>Поддерживаемые размеры виртуальных машин

[!INCLUDE [virtual-machines-disks-encryption-at-host-suported-sizes](../../../includes/virtual-machines-disks-encryption-at-host-suported-sizes.md)]

## <a name="double-encryption-at-rest"></a>Двойное шифрование при хранении

Клиенты с высоким уровнем безопасности, которые связаны с риском, связанным с любым конкретным алгоритмом шифрования, реализацией или скомпрометированным ключом, теперь могут использовать дополнительный уровень шифрования с использованием другого алгоритма или режима шифрования на уровне инфраструктуры, используя ключи шифрования, управляемые платформой. Этот новый слой можно применить к материализованным дискам ОС и данным, моментальным снимкам и изображениям, которые будут зашифрованы при хранении с помощью двойного шифрования.

### <a name="supported-regions"></a>Поддерживаемые регионы

[!INCLUDE [virtual-machines-disks-double-encryption-at-rest-regions](../../../includes/virtual-machines-disks-double-encryption-at-rest-regions.md)]

## <a name="server-side-encryption-versus-azure-disk-encryption"></a>Шифрование на стороне сервера и шифрование дисков Azure

[Шифрование дисков Azure](../../security/fundamentals/azure-disk-encryption-vms-vmss.md) использует функцию Windows [BitLocker](/windows/security/information-protection/bitlocker/bitlocker-overview) для шифрования управляемых дисков с помощью управляемых клиентом ключей в гостевой виртуальной машине. Шифрование на стороне сервера с использованием управляемых клиентом ключей улучшает работу шифрования дисков Azure, позволяя использовать любые типы ОС и образы для виртуальных машин путем шифрования данных в службе хранилища.

> [!IMPORTANT]
> Управляемые клиентом ключи используют управляемые удостоверения для ресурсов Azure — функцию Azure Active Directory (Azure AD). При настройке управляемых пользователем ключей управляемое удостоверение автоматически назначается вашим ресурсам. При перемещении подписки, группы ресурсов или управляемого диска из одного каталога Azure AD в другой управляемое удостоверение, связанное с управляемыми дисками, не передается в новый клиент, поэтому управляемые клиентом ключи могут перестать работать. Дополнительные сведения см. в статье [Передача подписки между каталогами Azure AD](../../active-directory/managed-identities-azure-resources/known-issues.md#transferring-a-subscription-between-azure-ad-directories).


## <a name="next-steps"></a>Дальнейшие действия

- Включите сквозное шифрование с использованием шифрования на узле с помощью [PowerShell](disks-enable-host-based-encryption-powershell.md) или [портал Azure](../disks-enable-host-based-encryption-portal.md).
- Включите двойное шифрование при неактивных дисках для управляемых дисков с помощью [PowerShell](disks-enable-double-encryption-at-rest-powershell.md) или [портал Azure](../disks-enable-double-encryption-at-rest-portal.md).
- Включите управляемые пользователем ключи для управляемых дисков с помощью [PowerShell](disks-enable-customer-managed-keys-powershell.md) или [портал Azure](../disks-enable-customer-managed-keys-portal.md).
- [Изучите шаблоны Azure Resource Manager для создания зашифрованных дисков с помощью управляемых клиентом ключей](https://github.com/ramankumarlive/manageddiskscmkpreview)
- [Что такое хранилище ключей Azure?](../../key-vault/general/overview.md)
