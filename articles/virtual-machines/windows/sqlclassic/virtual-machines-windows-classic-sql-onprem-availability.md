---
title: Расширение локальных групп доступности Always On в Azure | Документация Майкрософт
description: В этом руководстве используются ресурсы, созданные с помощью классической модели развертывания. Также здесь показано, как с помощью мастера добавления реплики в SQL Server Management Studio (SSMS) добавить реплику группы доступности Always On в Azure.
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: craigg
editor: ''
tags: azure-service-management
ms.assetid: 7ca7c423-8342-4175-a70b-d5101dfb7f23
ms.service: virtual-machines-sql
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: 4521c2c112c93e83144cfc84d600208817b2ccac
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75978051"
---
# <a name="extend-on-premises-always-on-availability-groups-to-azure"></a>Расширение локальных групп доступности Always On в Azure
Группы доступности Always On обеспечивают высокий уровень доступности для групп базы данных путем добавления вторичных реплик. Эти реплики позволяют отрабатывать отказы баз данных. Кроме того, их можно использовать для разгрузки рабочих нагрузок чтения или задач резервного копирования.

Вы можете расширить локальные группы доступности в Microsoft Azure. Для этого подготовьте одну или несколько виртуальных машин Azure с помощью SQL Server, а затем добавьте их в локальные группы доступности в качестве реплик.

В этом учебнике предполагается, что у вас есть следующие компоненты.

* Активная подписка Azure. Вы можете [воспользоваться бесплатной пробной версией](https://azure.microsoft.com/pricing/free-trial/).
* Существующая локальная группа доступности Always On. Дополнительные сведения о группах доступности см. в статье [Группы доступности Always On](https://msdn.microsoft.com/library/hh510230.aspx).
* Подключение между локальной сетью и виртуальной сетью Azure. Дополнительные сведения о создании этой виртуальной сети см. в статье [Создание подключения типа "сеть — сеть" с помощью классического портала Azure](../../../vpn-gateway/vpn-gateway-howto-site-to-site-classic-portal.md).

> [!IMPORTANT] 
> Azure имеет две различные модели развертывания для создания и работы с ресурсами: [менеджер ресурсов и Classic.](../../../azure-resource-manager/management/deployment-models.md) В этой статье рассматривается использование классической модели развертывания. Для большинства новых развертываний Майкрософт рекомендует использовать модель диспетчера ресурсов.

## <a name="add-azure-replica-wizard"></a>Мастер добавления реплики Azure
В этом разделе показано, как с помощью **мастера добавления реплик Azure** расширить решение группы доступности Always On и включить реплики Azure.

> [!IMPORTANT]
> **Мастер добавления реплик Azure** поддерживает только виртуальные машины, созданные при помощи классической модели развертывания. Для новых развертываний виртуальных машин следует использовать более новую модель Resource Manager. Если вы используете VMs с менеджером ресурсов, необходимо вручную добавить вторичную реплику Azure с помощью команд Transact-S'L (не показанных здесь). Данный мастер не будет работать в сценарии с Resource Manager.

1. Из студии управления серверами S'L расширьте всегда на**группах** >  **доступности высокой доступности** > **(Имя вашей группы доступности)**.
2. Правой кнопкой мыши щелкните **Реплики доступности**, а затем выберите команду **Добавить реплику**.
3. По умолчанию откроется **мастер добавления реплики в группу доступности** . Нажмите кнопку **Далее**.  Если во время предыдущего запуска мастера в нижней части страницы был выбрать параметр **Больше не показывать эту страницу**, этот экран отображаться не будет.
   
    ![SQL](./media/virtual-machines-windows-classic-sql-onprem-availability/IC742861.png)
4. Вам потребуется подключиться ко всем существующим вторичным репликам. Щелкните **Connect…** (Подключиться...) рядом с каждой репликой или **Connect All…** (Подключить все...).  в нижней части экрана. После проверки подлинности нажмите кнопку **Далее**, чтобы перейти к следующему экрану.
5. В верхней части страницы **Указание реплик** есть несколько вкладок: **Реплики**, **Конечные точки**, **Параметры резервного копирования** и **Прослушиватель**. На вкладке **Реплики** щелкните **Добавить реплику Azure…**. , чтобы запустить мастер добавления реплики Azure.
   
    ![SQL](./media/virtual-machines-windows-classic-sql-onprem-availability/IC742863.png)
6. Выберите существующий сертификат управления Azure в локальном хранилище сертификатов Windows, если он уже установлен. Выберите или введите идентификатор подписки Azure, если вы ранее использовали его. Вы можете нажать кнопку "Загрузить", чтобы скачать и установить сертификат управления Azure, а также скачать список подписок, используя учетную запись Azure.
   
    ![SQL](./media/virtual-machines-windows-classic-sql-onprem-availability/IC742864.png)
7. Каждое поле на странице будет заполнено значениями, которые будут использоваться для создания виртуальной машины Azure, на которой будет размещена реплика.
   
   | Параметр | Описание |
   | --- | --- |
   | **ОС контейнера** |Выберите нужное сочетание операционной системы и SQL Server. |
   | **Размер VM** |Выберите размер виртуальной машины в соответствии с вашими бизнес-потребностями. |
   | **Имя виртуальной машины** |Укажите уникальное имя для новой виртуальной машины. Имя должно содержать от 3 до 15 символов, может включать только буквы, цифры и дефисы, а также должно начинаться с буквы и заканчиваться буквой или цифрой. |
   | **Имя пользователя виртуальной машины** |Укажите имя пользователя учетной записи администратора на виртуальной машине. |
   | **Пароль администратора виртуальной машины** |Укажите пароль для новой учетной записи. |
   | **Подтверждение пароля** |Подтвердите пароль для новой учетной записи. |
   | **Виртуальная сеть** |Укажите виртуальную сеть Azure, которую будет использовать новая виртуальная машина. Дополнительные сведения о виртуальных сетях см. в статье [Обзор виртуальной сети](../../../virtual-network/virtual-networks-overview.md). |
   | **Подсеть виртуальной сети** |Укажите подсеть виртуальной сети, которую будет использовать новая виртуальная машина. |
   | **Домена** |Подтвердите правильность предварительно заполненного значения для домена. |
   | **Имя пользователя домена** |Укажите учетную запись, входящую в группу локальных администраторов на локальных узлах кластера. |
   | **Пароль** |Укажите пароль для имени пользователя домена. |
8. Нажмите кнопку **ОК** для проверки параметров развертывания.
9. После этого отобразятся условия соглашения. Прочтите их и в случае согласия с ними нажмите кнопку **ОК**.
10. Снова откроется страница **Выбор реплик**. Проверьте параметры новой реплики Azure на вкладках **Реплики**, **Конечные точки** и **Параметры резервного копирования**. Измените параметры в соответствии со своими бизнес-требованиями.  Дополнительные сведения о параметрах на этих вкладках см. в статье [Страница "Выбор реплик" (мастер создания группы доступности/мастер добавления реплики)](https://msdn.microsoft.com/library/hh213088.aspx). Обратите внимание, что на вкладке "Прослушиватель" невозможно создать прослушиватели для групп доступности, содержащих реплики Azure. Кроме того, если прослушиватель создан еще до запуска мастера, вы получите сообщение о том, что служба Azure не поддерживает прослушиватель. Создание прослушивателей рассматривается в разделе **Создание прослушивателя группы доступности**.
    
     ![SQL](./media/virtual-machines-windows-classic-sql-onprem-availability/IC742865.png)
11. Нажмите кнопку **Далее**.
12. На странице **Выбор начальной синхронизации данных** выберите метод синхронизации данных, а затем нажмите кнопку **Далее**. В большинстве случаев следует выбирать вариант **Full Data Synchronization** (Полная синхронизация данных). Дополнительные сведения о методах синхронизации данных см. в статье [Страница "Выбор начальной синхронизации данных" (мастера группы доступности Always On)](https://msdn.microsoft.com/library/hh231021.aspx).
13. Просмотрите результаты на странице **Проверка** . Исправьте нерешенные ошибки и при необходимости перезапустите проверку. Нажмите кнопку **Далее**.
    
     ![SQL](./media/virtual-machines-windows-classic-sql-onprem-availability/IC742866.png)
14. Проверьте данные на странице **Сводка**, а затем нажмите кнопку **Готово**.
15. Начнется процесс подготовки. После успешного завершения работы мастера, нажмите кнопку **Закрыть**, чтобы выйти из мастера.

> [!NOTE]
> Мастер добавления реплики Azure создает файл журнала в папке Пользователи\<имя_пользователя>\AppData\Local\SQL Server\AddReplicaWizard. С помощью этого файла журнала можно устранить ошибки при развертывании реплик Azure. Если мастеру не удается выполнить любое действие, выполняется откат всех предыдущих операций, в том числе удаление подготовленной виртуальной машины.
> 
> 

## <a name="create-an-availability-group-listener"></a>Создание прослушивателя группы доступности
После создания группы доступности необходимо создать прослушиватель для подключения клиентов к репликам. Прослушиватели направляют входящие подключения на первичную или доступную только для чтения вторичную реплику. Дополнительные сведения о прослушивателях см. в статье [Настройка прослушивателя внутренней подсистемы балансировки нагрузки для группы доступности Always On в Azure](../classic/ps-sql-int-listener.md).

## <a name="next-steps"></a>Дальнейшие действия
Вы можете не только использовать **мастер добавления реплики Azure** для расширения группы доступности Always On в Azure, но также полностью переместить некоторые рабочие нагрузки SQL Server в Azure. Чтобы приступить к работе, см. статью [Подготовка виртуальной машины SQL Server в Azure](../sql/virtual-machines-windows-portal-sql-server-provision.md).

Другие темы, связанные с запуском SQL Server на виртуальных машинах Azure, рассматриваются в статье [SQL Server на виртуальных машинах Azure](../sql/virtual-machines-windows-sql-server-iaas-overview.md).

