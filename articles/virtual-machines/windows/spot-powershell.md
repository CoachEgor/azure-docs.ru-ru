---
title: Развертывание виртуальных машин точки Azure с помощью PowerShell
description: Узнайте, как использовать Azure PowerShell для развертывания плашечных виртуальных машин, чтобы сэкономить на затратах.
author: cynthn
ms.service: virtual-machines
ms.workload: infrastructure-services
ms.topic: how-to
ms.date: 03/25/2020
ms.author: cynthn
ms.reviewer: jagaveer
ms.openlocfilehash: 321983fbe99d17dc78198feb195eed8ea26de569
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82100623"
---
# <a name="deploy-spot-vms-using-azure-powershell"></a>Развертывание плашечных виртуальных машин с помощью Azure PowerShell


Использование [плашечных виртуальных машин](spot-vms.md) позволяет использовать преимущества нашей неиспользуемой емкости с значительной экономией затрат. В любой момент, когда Azure нужна емкость, инфраструктура Azure будет выключать плашечные виртуальные машины. Таким образом, точечные виртуальные машины отлично подходят для рабочих нагрузок, которые могут обрабатывать прерывания, такие как задания пакетной обработки, среды разработки и тестирования, большие вычислительные рабочие нагрузки и многое другое.

Цены для плашечных виртуальных машин являются переменными в зависимости от региона и SKU. Дополнительные сведения см. в статье цены на виртуальные машины для [Linux](https://azure.microsoft.com/pricing/details/virtual-machines/linux/) и [Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/). Дополнительные сведения о настройке максимальной цены см. в разделе [точки на виртуальных машинах — цены](spot-vms.md#pricing).

Вы можете задать максимальную цену, которую вы хотите платить, в час, для виртуальной машины. Максимальная цена на плашечную виртуальную машину можно установить в долларах США (USD), используя до 5 десятичных разрядов. Например, значением `0.98765`будет максимальная цена $0,98765 долл. США в час. Если для параметра Максимальная цена задано значение `-1`, виртуальная машина не будет удалена на основе цены. Цена на виртуальную машину будет соответствовать текущей цене или цене для стандартной виртуальной машины, которая когда-либо будет меньше, если есть доступная емкость и квота.


## <a name="create-the-vm"></a>Создание виртуальной машины

Создайте Спотвм с помощью [New-азвмконфиг](/powershell/module/az.compute/new-azvmconfig) , чтобы создать конфигурацию. Включите `-Priority Spot` и задайте `-MaxPrice` одно из следующих действий:
- `-1`так что виртуальная машина не будет исключена на основе цены.
- сумма в долларах, до 5 цифр. Например, `-MaxPrice .98765` это означает, что виртуальная машина будет освобождена, когда цена за спотвм займет около $. 98765 в час.


В этом примере создается Спотвм, который не будет освобожден на основе ценообразования (только в том случае, если Azure требуется обратная емкость).

```azurepowershell-interactive
$resourceGroup = "mySpotRG"
$location = "eastus"
$vmName = "mySpotVM"
$cred = Get-Credential -Message "Enter a username and password for the virtual machine."
New-AzResourceGroup -Name $resourceGroup -Location $location
$subnetConfig = New-AzVirtualNetworkSubnetConfig `
   -Name mySubnet -AddressPrefix 192.168.1.0/24
$vnet = New-AzVirtualNetwork -ResourceGroupName $resourceGroup `
   -Location $location -Name MYvNET -AddressPrefix 192.168.0.0/16 `
   -Subnet $subnetConfig
$pip = New-AzPublicIpAddress -ResourceGroupName $resourceGroup -Location $location `
  -Name "mypublicdns$(Get-Random)" -AllocationMethod Static -IdleTimeoutInMinutes 4
$nsgRuleRDP = New-AzNetworkSecurityRuleConfig -Name myNetworkSecurityGroupRuleRDP  -Protocol Tcp `
  -Direction Inbound -Priority 1000 -SourceAddressPrefix * -SourcePortRange * -DestinationAddressPrefix * `
  -DestinationPortRange 3389 -Access Allow
$nsg = New-AzNetworkSecurityGroup -ResourceGroupName $resourceGroup -Location $location `
  -Name myNetworkSecurityGroup -SecurityRules $nsgRuleRDP
$nic = New-AzNetworkInterface -Name myNic -ResourceGroupName $resourceGroup -Location $location `
  -SubnetId $vnet.Subnets[0].Id -PublicIpAddressId $pip.Id -NetworkSecurityGroupId $nsg.Id

# Create a virtual machine configuration and set this to be a Spot VM

$vmConfig = New-AzVMConfig -VMName $vmName -VMSize Standard_D1 -Priority "Spot" -MaxPrice -1| `
Set-AzVMOperatingSystem -Windows -ComputerName $vmName -Credential $cred | `
Set-AzVMSourceImage -PublisherName MicrosoftWindowsServer -Offer WindowsServer -Skus 2016-Datacenter -Version latest | `
Add-AzVMNetworkInterface -Id $nic.Id

New-AzVM -ResourceGroupName $resourceGroup -Location $location -VM $vmConfig
```

После создания виртуальной машины можно выполнить запрос, чтобы увидеть максимальную цену для всех виртуальных машин в группе ресурсов.

```azurepowershell-interactive
Get-AzVM -ResourceGroupName $resourceGroup | `
   Select-Object Name,@{Name="maxPrice"; Expression={$_.BillingProfile.MaxPrice}}
```

## <a name="next-steps"></a>Дальнейшие шаги

Можно также создать плашечную виртуальную машину с помощью [Azure CLI](../linux/spot-cli.md) или [шаблона](../linux/spot-template.md).

Если возникает ошибка, см. раздел [коды ошибок](../error-codes-spot.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).