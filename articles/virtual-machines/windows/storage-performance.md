---
title: Оптимизация производительности виртуальных машин серии Azure Lsv2 - Хранение
description: Узнайте, как оптимизировать производительность для решения на виртуальных машинах серии Lsv2.
services: virtual-machines-windows
author: sasha-melamed
manager: gwallace
ms.service: virtual-machines-windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 04/17/2019
ms.author: joelpell
ms.openlocfilehash: 57b248908a02327f2521be05920259681a26817a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77920235"
---
# <a name="optimize-performance-on-the-lsv2-series-virtual-machines"></a>Оптимизация производительности на виртуальных машинах серии Lsv2

Виртуальные машины серии Lsv2 поддерживают различные рабочие нагрузки, которые требуют высокого ввода-от и пропускной памяти на локальном хранении в широком диапазоне приложений и отраслей.  Серия Lsv2 идеально подходит для баз данных Big Data, S'L, NoS'L, складирования данных и больших транзакционных баз данных, включая Cassandra, MongoDB, Cloudera и Redis.

Конструкция виртуальных машин серии Lsv2 (VMs) максимизирует процессор AMD EPYC™ 7551, чтобы обеспечить лучшую производительность между процессором, памятью, устройствами NVMe и VMs. В дополнение к максимизации производительности оборудования, VMs-м визажают в серию Lsv2, предназначенные для работы с потребностями операционных систем Windows и Linux для повышения производительности оборудования и программного обеспечения.

Настройка программного и аппаратного обеспечения привела к оптимизированной версии [Windows Server 2019 Datacenter,](https://azuremarketplace.microsoft.com/marketplace/apps/microsoftwindowsserver.windowsserver?tab=Overview)выпущенной в начале декабря 2018 года на Azure Marketplace, которая поддерживает максимальную производительность на устройствах NVMe в VMs-м микрокомпаниям серии Lsv2.

В этой статье содержатся советы и предложения, которые обеспечивают максимальную производительность, предназначенную для ввоза. Информация на этой странице будет постоянно обновляться по мере добавления в Azure Marketplace большего количества оптимизированных изображений Lsv2.

## <a name="amd-eypc-chipset-architecture"></a>АРХИТЕКТУРа чипсетов AMD EYPC™

VMs-серии Lsv2 используют AMD EYPC™ серверных процессоров на основе микроархитектуры Дзэн. AMD разработала Infinity Fabric (IF) для EYPC™ как масштабируемое соединение для своей модели NUMA, которая может быть использована для связи на уровне смерти, на упаковке и мультипакете. По сравнению с «PI» (быстрый путь interconnect) и UPI (Ultra-Path Interconnect), используемыми на современных монолитных процессорах Intel, архитектура AMD с небольшой смертью может принести как преимущества производительности, так и проблемы. Фактическое влияние ограничений на пропускную способность памяти и задержки может варьироваться в зависимости от типа выполнения рабочих нагрузок.

## <a name="tips-for-maximizing-performance"></a>Советы по максимизации производительности

* Оборудование, которое питает VMs-технологий серии Lsv2, использует устройства NVMe с восемью парами вво/с. Каждая очередь ВВМ-Устройства NVMe на самом деле является парой: очередью представления и очередью завершения. Драйвер NVMe настроен для оптимизации использования этих восьми вхыщных кВ-, распределяя вволок и от входе в круглом графике робина. Чтобы получить максимальную производительность, запустите восемь заданий на устройство, чтобы соответствовать.

* Избегайте смешивания команд NVMe admin (например, запрос информации NVMe SMART и т.д.) с командами NVMe I/O во время активных рабочих нагрузок. Устройства Lsv2 NVMe поддерживаются технологией Hyper-V NVMe Direct, которая переключается в "медленный режим" всякий раз, когда какие-либо команды NVMe-интерфейса находятся на рассмотрении. Пользователи Lsv2 могли видеть резкое падение производительности производительности NVMe I/O, если это произойдет.

* Пользователи Lsv2 не должны полагаться на информацию numA устройства (все 0), представленную из ВМ для дисков данных, чтобы решить сродство NUMA для своих приложений. Рекомендуемый способ повышения производительности — по возможности распределить рабочие нагрузки по процессорам по всем процессорам. 

* Максимальная поддерживаемая глубина очереди на пару очередей ВВ2 для устройства Lsv2 VM NVMe составляет 1024 (против лимита Amazon i3 32). Пользователи Lsv2 должны ограничить свои (синтетические) бенчмаркинговые рабочие нагрузки глубиной очереди 1024 или ниже, чтобы избежать запуска полной очереди, что может снизить производительность.

## <a name="utilizing-local-nvme-storage"></a>Использование локального хранилища NVMe

Местное хранение на диске 1.92 TB NVMe на всех ВМ Lsv2 является эфемерным. Во время успешной стандартной перезагрузки VM данные на локальном диске NVMe сохранятся. Данные не будут сохраняться на NVMe, если VM будет передислоцирован, удален или удален. Данные не сохранятся, если другая проблема приведет к тому, что VM или используемое им оборудование станет неработоспособным. Когда это происходит, любые данные о старом узлах надежно стираются.

Будут также случаи, когда VM необходимо перенести в другую принимающую машину, например, во время плановой операции по техническому обслуживанию. Плановые операции по техническому обслуживанию и некоторые аппаратные сбои можно предвидеть с [помощью запланированных событий.](scheduled-events.md) Запланированные события следует использовать для обновления любых прогнозируемых операций по техническому обслуживанию и восстановлению.

В случае, если запланированное событие обслуживания требует воссоздания VM на новом узле с пустыми локальными дисками, данные должны быть ресинхронизированы (опять же, при надежном удалении данных о старом хобе). Это происходит потому, что VMs-м визажает Lv2 серии VMs, которые в настоящее время не поддерживают миграцию в реальном времени на локальном диске NVMe.

Существует два режима планового технического обслуживания.

### <a name="standard-vm-customer-controlled-maintenance"></a>Стандартное обслуживание, контролируемое клиентами VM

- VM перемещается в обновленный хост в течение 30-дневного окна.
- Локальные данные хранения Lv2 могут быть утеряны, поэтому рекомендуется резервное копирование данных до начала мероприятия.

### <a name="automatic-maintenance"></a>Автоматическое техническое обслуживание

- Происходит, если клиент не выполняет обслуживание, контролируемое клиентом, или в случае чрезвычайных процедур, таких как событие нулевого дня безопасности.
- Предназначен для сохранения данных клиентов, но существует небольшой риск замораживания или перезагрузки VM.
- Локальные данные хранения Lv2 могут быть утеряны, поэтому рекомендуется резервное копирование данных до начала мероприятия.

Для любых предстоящих событий службы используйте процесс контролируемого обслуживания, чтобы выбрать наиболее удобное для вас время для обновления. Перед событием вы можете создать резервную копию данных в премиум-хранилище. После завершения события обслуживания вы можете вернуть свои данные в обновленное локальное хранилище Lv2 VMs.

Сценарии, которые поддерживают данные о локальных дисках NVMe, включают:

- VM работает и здоров.
- VM перезагружается на месте (вы или Azure).
- VM приостанавливается (остановлен без де-распределения).
- Большинство запланированных операций по техническому обслуживанию.

Сценарии, которые надежно стирают данные для защиты клиента, включают:

- VM передислоцируется, останавливается (де-выделено) или удаляется (вы).
- VM становится нездоровым и должен обслуживать исцелить другой узла из-за аппаратной проблемы.
- Небольшое число запланированных операций по техническому обслуживанию, которые требуют, чтобы ВМ был перераспределен на другой уместитель для обслуживания.

Чтобы узнать больше о вариантах резервного копирования данных в локальном хранилище, см. [Резервное копирование и аварийное восстановление для дисков Azure IaaS.](backup-and-disaster-recovery-for-azure-iaas-disks.md)

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

* **Как начать развертывание VMs-кратных возбуждающих сявков серии?**  
   Как и любой другой VM, используйте [portal,](quick-create-portal.md) [Azure CLI](quick-create-cli.md)или [PowerShell](quick-create-powershell.md) для создания VM.

* **Приведет ли сбой диска NVMe к сбою всех вмвм на хосте?**  
   Если сбой диска обнаружен на аппаратном узло, аппаратное обеспечение находится в неисправном состоянии. Когда это происходит, все ВМ на узлах автоматически девыделяются и перемещаются в здоровый узла. Для VMs-м визажает серия Lsv2, это означает, что данные клиента о сбоенный узла также надежно стерты и должны быть воссозданы клиентом на новом узлах. Как отмечается, до того, как миграция в реальном времени станет доступна на Lsv2, данные о сбойу узла будут активно перемещаться с помощью ВМ по мере их передачи в другой узла.

* **Нужно ли вносить корректировки опросов в Windows в Windows Server 2012 или Windows Server 2016?**  
   Опрос NVMe доступен только на Windows Server 2019 на Azure.  

* **Могу ли я вернуться к традиционной модели обслуживания прерывания (ISR)?**  
   VM серии Lsv2 оптимизированы для опроса NVMe. Обновления постоянно предоставляются для повышения производительности опросов.

* **Могу ли я настроить настройки опроса в Windows Server 2019?**  
   Настройки опроса не регулируются пользователем.
   
## <a name="next-steps"></a>Дальнейшие действия

* Просмотрите спецификации для всех [VMs, оптимизированные для производительности хранилища](sizes-storage.md) в Azure
