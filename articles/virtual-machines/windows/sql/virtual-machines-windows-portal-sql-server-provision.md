---
title: Обеспечение виртуальной машины с порталом Azure
description: В этом руководстве описаны варианты создания виртуальных машин Windows SQL Server 2017 на портале Azure.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
manager: craigg
tags: azure-resource-manager
ms.assetid: 1aff691f-a40a-4de2-b6a0-def1384e086e
ms.service: virtual-machines-sql
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: infrastructure-services
ms.date: 11/07/2019
ms.author: mathoma
ms.reviewer: jroth
ms.custom: seo-lt-2019
ms.openlocfilehash: 1fdf776570b6f10a363fb98dfe343387d86219d6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79249793"
---
# <a name="how-to-provision-a-windows-sql-server-virtual-machine-in-the-azure-portal"></a>Как подготовить виртуальную машину SQL Server на платформе Windows на портале Azure

В этом руководстве рассматриваются различные варианты, доступные при создании виртуальной машины SQL Server на платформе Windows на портале Azure. В этой статье рассматривается больше параметров конфигурации, чем в [кратком руководстве по виртуальным машинам SQL Server](quickstart-sql-vm-create-portal.md), и описывается одна возможная задача подготовки. 

Используйте это руководство, чтобы создать собственную виртуальную машину SQL Server. Его также можно использовать как справочник по параметрам, доступным на портале Azure.

> [!TIP]
> Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](virtual-machines-windows-sql-server-iaas-faq.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="sql-server-virtual-machine-gallery-images"></a><a id="select"></a> Образы из коллекции виртуальных машин SQL Server

При создании виртуальной машины SQL Server можно выбрать один из нескольких предварительно настроенных образов, доступных в коллекции виртуальных машин. Ниже приведены инструкции по выбору одного из образов SQL Server 2017.

1. В левом меню портала Azure выберите **Azure S'L.** Если **Azure SQL** отсутствует в списке, выберите **Все службы** и в поле поиска введите Azure SQL. (Необязательно) Щелкните звезду рядом с **Azure SQL**, чтобы добавить этот элемент в избранное и область навигации слева. 
1. Щелкните **+ Добавить**, чтобы открыть страницу **Выбор варианта развертывания SQL**. Вы можете просмотреть дополнительную информацию, выбрав **детали Show.** 
1. Введите `2017` окно поиска изображений сервера S'L Server на плитке **виртуальных машин,** а затем выберите Бесплатную лицензию сервера **S'L: S'L Server 2017 Разработчик на Windows Server 2016** из выпадающих. 


   ![Выберите изображение ВМ](media/virtual-machines-windows-portal-sql-server-provision/select-sql-vm-image-portal.png)

   > [!TIP]
   > В этом пошаговом руководстве используется выпуск Developer, так как это полнофункциональный выпуск SQL Server, предоставляемый бесплатно для тестирования в процессе разработки. Вы оплачиваете только стоимость выполнения виртуальной машины. Но вы можете выбрать для использования в этом пошаговом руководстве любой образ. Описание доступных образов см. в разделе [Начало работы с виртуальными машинами SQL](virtual-machines-windows-sql-server-iaas-overview.md#payasyougo).

   > [!TIP]
   > Стоимость лицензий для SQL Server включена в цену секунды использования создаваемой виртуальной машины и зависит от выпуска и числа ядер. Тем не менее выпуск SQL Server Developer предоставляется бесплатно для разработки и тестирования (не для рабочей среды), а выпуск SQL Express предоставляется бесплатно для упрощенных рабочих нагрузок (требующих менее 1 ГБ памяти и 10 ГБ хранилища). Можно также использовать собственную лицензию (BYOL) и платить только за виртуальную машину. Имена таких образов содержат префикс {BYOL}. 
   >
   > Дополнительные сведения об этих параметрах см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).


1. Выберите **Создать**.


## <a name="1-configure-basic-settings"></a>1. Настройка базовых настроек


На вкладке **Основные сведения** укажите следующую информацию.

* В соответствии с **деталями проекта**убедитесь, что выбрана правильная подписка. 
*  В разделе **Группа ресурсов** либо выберите существующую группу ресурсов из списка, либо **создайте новую** для создания новой группы ресурсов. Группа ресурсов — это коллекция связанных ресурсов в Azure (виртуальные машины, учетные записи хранения, виртуальные сети и т. д.). 

    ![Подписка](media/quickstart-sql-vm-create-portal/basics-project-details.png)

  > [!NOTE]
  > Рекомендуется использовать новую группу ресурсов для тестирования или изучения процесса развертывания SQL Server в Azure. После завершения теста удалите группу ресурсов, чтобы автоматически удалить виртуальную машину и все ресурсы, связанные с этой группой ресурсов. Для получения дополнительной информации о группах ресурсов можно ознакомиться [на обзоре менеджера ресурсов Azure](../../../azure-resource-manager/management/overview.md).


* В разделе **Сведения об экземпляре**:
    1. Введите уникальное **название виртуальной машины.**  
    1. Выберите расположение для параметра **Регион**. 
    1. Для целей настоящего руководства оставьте **параметры доступности, установленные** _для отсутствия требуемой избыточности инфраструктуры._ См. подробнее о [регионах и доступности виртуальных машин в Azure](../../windows/availability.md). 
    1. В списке **изображений** выберите Бесплатную лицензию сервера _S'L: Разработчик сервера S'L 2017 на Windows Server 2016_.  
    1. Выберите **Изменить размер** для параметра **Размер** виртуальной машины, а затем выберите предложение **A2 Basic**. Обязательно очистите ресурсы после завершения работы с ними, чтобы предотвратить любые непредвиденные расходы. Для рабочих нагрузок изучите рекомендации по размерам машин SQL Server и их настройке в статье [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md).

    ![Подробности об экземпляре](media/quickstart-sql-vm-create-portal/basics-instance-details.png)

> [!IMPORTANT]
> В расчетную ежемесячную стоимость, указанную в окне **Выбор размера**, не включена стоимость лицензирования SQL Server. Это только стоимость виртуальной машины. Для выпусков SQL Server Express и Developer указана итоговая расчетная стоимость. Получить сведения о других выпусках можно на странице [цен на виртуальные машины Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/), где вы можете выбрать целевой выпуск SQL Server. Также см. [руководство по ценообразованию для виртуальных компьютеров](virtual-machines-windows-sql-server-pricing-guidance.md) и [размеров сервера](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)S'L Server.

* Под **учетной записью Администратора**укажите имя пользователя и пароль. Пароль должен включать минимум 12 символов и соответствовать [определенным требованиям к сложности](../../windows/faq.md#what-are-the-password-requirements-when-creating-a-vm).

   ![Учетная запись администратора](media/quickstart-sql-vm-create-portal/basics-administrator-account.png)

* В разделе **Правила входящего порта** щелкните **Разрешить выбранные порты**, а затем выберите **RDP (3389)** из раскрывающегося списка. 

   ![Правила для входящих портов](media/quickstart-sql-vm-create-portal/basics-inbound-port-rules.png)


## <a name="2-configure-optional-features"></a>2. Настройка дополнительных функций

### <a name="disks"></a>Диски

На вкладке **Диски** назначьте параметры диска. 

* Под **типом диска ОС**выберите тип диска, который вы хотите для Вашей ОС, из выпадения вниз. Премиум рекомендуется для производственных систем, но не доступен для Basic VM. Чтобы использовать Premium SSD, измените размер виртуальной машины. 
* Под **Расширенный**, выберите **Да** под **использованием управляемых дисков**.

   > [!NOTE]
   > Корпорация Майкрософт рекомендует использовать управляемые диски для SQL Server. Управляемые диски управляют хранилищем в фоновом режиме. Кроме того, когда виртуальные машины с управляемыми дисками находятся в одной группе доступности, Azure распределяет ресурсы хранения, чтобы обеспечить соответствующую избыточность. Для получения дополнительной информации смотрите [обзор управляемых дисков Azure](../managed-disks-overview.md). Подробные сведения об управляемых дисках в группе доступности см. в статье [Управление доступностью виртуальных машин Windows в Azure](../manage-availability.md).

![Настройки Диска VM](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-disks.png)
  
  
### <a name="networking"></a>Сети

На вкладке **Сеть** наверстывайте параметры сетей. 

* Создайте новую **виртуальную сеть**или используйте существующую vNet для вашего VM сервера S'L. Обозначьте **подсеть,** а также. 

* В **группе безопасности сети NIC**выберите либо базовую группу безопасности, либо расширенную группу безопасности. Выбор базовой опции позволяет выбрать входящие порты для VM сервера S'L (те же значения, которые были настроены на вкладке **Basic).** Выбор расширенной опции позволяет выбрать существующую группу сетевой безопасности или создать новую. 

* Вы можете изменить другие параметры сети или оставить их значения по умолчанию.

![Настройки сети ВМ](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-networking.png)

#### <a name="monitoring"></a>Наблюдение

На вкладке **Мониторинг** настраиваете мониторинг и автозакрытие. 

* Azure позволяет **диагностике Boot** по умолчанию с той же учетной записью хранения, предназначенной для VM. Вы можете изменить эти настройки здесь, а также включение **Диагностики гостей ОС.** 
* Вы также можете включить **систему, назначенную управляемой идентификатором** и **автозакрытием** на этой вкладке. 

![Настройки управления VM](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-management.png)


## <a name="3-configure-sql-server-settings"></a>3. Настройка настроек сервера S'L

На **вкладке настроек сервера S'L** нанастройка конкретных настроек и оптимизации для сервера S'L Server. Настройки, которые можно настроить для сервера S'L, включают в себя следующие:

| Параметр |
| --- |
| [Подключения](#connectivity) |
| [Проверка подлинности](#authentication) |
| [Интеграция с хранилищем ключей Azure](#azure-key-vault-integration) |
| [Конфигурация хранилища](#storage-configuration) |
| [Автоматическое исправление](#automated-patching) |
| [Автоматизированное резервное копирование](#automated-backup) |
| [Услуги машинного обучения](#machine-learning-services) |


### <a name="connectivity"></a>Соединение

В разделе **Подключение SQL**укажите необходимый тип доступа к экземпляру SQL Server на этой виртуальной машине. В рамках этого пошагового руководства выберите **Общедоступный (Интернет)** для подключения к SQL Server с компьютеров или из служб в Интернете. С помощью выбранной этой опции Azure автоматически настраивает брандмауэр и группу сетевой безопасности, чтобы разрешить трафик в выбранном порту.

> [!TIP]
> По умолчанию, S'L Server слушает на известном порту, **1433**. Для повышения безопасности измените порт в предыдущем диалоговом окне, чтобы ожидать передачи данных через нестандартный порт, например 1401. После изменения порта необходимо выполнить подключение, используя этот порт, с помощью любого клиентского инструмента, например SSMS.

![Безопасность ВМ](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-security.png)

Чтобы подключиться к SQL Server через Интернет, также необходимо включить проверку подлинности SQL Server, как описано в следующем разделе.

Если вы не хотите включать подключения к ядру СУБД через Интернет, выберите один из следующих вариантов:

* **Локальное (только в виртуальной машине)** — для подключения к SQL Server только в пределах самой виртуальной машины.
* **Частное (в виртуальной сети)** — для подключения к SQL Server с машин или из служб в той же виртуальной сети.

Как правило, чтобы повысить уровень безопасности, необходимо выбрать наиболее подходящий тип подключения для выполнения вашего сценария. Но все параметры можно защитить с помощью правил группы безопасности сети и проверки подлинности Windows или SQL. Вы можете изменить группу безопасности сети после создания виртуальной машины. Дополнительные сведения см. в статье [Вопросы безопасности SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-security.md).



### <a name="authentication"></a>Проверка подлинности

Если вам требуется аутентификация сервера, нажмите **«Включить»** под **аутентификацией s'L** на **вкладке настроек сервера S'L.**

![Проверка подлинности SQL Server](./media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-authentication.png)

> [!NOTE]
> Если вы планируете предоставить доступ к SQL Server через Интернет (т. е. включаете параметр общедоступного подключения), включите аутентификацию SQL здесь. Для общего доступа к SQL Server необходимо использовать проверку подлинности SQL.

Если вы включаете проверку подлинности SQL Server, укажите **имя для входа** и **пароль**. Это имя входа настроено как логин аутентификации сервера s'L server и член закрепленной роли сервера **sysadmin.** Дополнительные сведения о режимах проверки подлинности см. в [этой статье](https://docs.microsoft.com/sql/relational-databases/security/choose-an-authentication-mode).

Если проверка подлинности SQL Server не включена, подключиться к экземпляру SQL Server можно с помощью локальной учетной записи администратора на виртуальной машине.


### <a name="azure-key-vault-integration"></a>Интеграция с хранилищем ключей Azure

Для хранения секретов безопасности в Azure для шифрования выберите **настройки сервера S'L**и прокрутите вниз до **интеграции хранилища ключей Azure.** Выберите **Включить** и заполнить запрашиваемую информацию. 

![Интеграция с хранилищем ключей Azure](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-akv.png)

В следующей таблице перечислены параметры, необходимые для настройки интеграции с хранилищем ключей Azure.

| ПАРАМЕТР | DESCRIPTION | ПРИМЕР |
| --- | --- | --- |
| **URL-адрес хранилища ключей** |Расположение хранилища ключей. |https:\//contosokeyvault.vault.azure.net/ |
| **Имя субъекта** |Имя субъекта-службы Azure Active Directory. Этот имя также называется идентификатором клиента. |fde2b411-33d5-4e11-af04eb07b669ccf2 |
| **Секрет субъекта** |Секрет субъекта-службы Azure Active Directory. Этот секрет также называется секретом клиента. |9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM= |
| **Credential name (Имя учетных данных)** |**Учетное имя**: интеграция AKV создает учетные данные в рамках SQL Server, позволяя виртуальной машине иметь доступ к хранилищу ключей. Выберите имя для этих учетных данных. |mycred1 |

Дополнительные сведения см. в статье [Настройка интеграции хранилища ключей Azure для SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-ps-sql-keyvault.md).

### <a name="storage-configuration"></a>Конфигурация хранилища

На **вкладке настроек s'L Server** в **конфигурации хранилища**выберите **конфигурацию изменения,** чтобы открыть страницу оптимизации памяти и указать требования к хранению.

![Конфигурация хранилища VM](media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-configuration-provisioning.png)

В разделе **Storage optimized for**(Оптимизация хранилища) выберите один из следующих вариантов.

* **Общая** — это значение по умолчанию, которое поддерживает большинство рабочих нагрузок.
* **Транзакционная обработка** оптимизирует хранилище для традиционных рабочих нагрузок OLTP базы данных.
* **Хранилище данных** оптимизирует хранилище для рабочих нагрузок аналитики и отчетов.

![Конфигурация хранилища VM](media/virtual-machines-windows-sql-storage-configuration/sql-vm-storage-configuration.png)

Вы можете оставить значения по умолчанию, или вы можете вручную изменить топологию хранения в соответствии с вашими потребностями IOPS. Для получения дополнительной информации [см.](virtual-machines-windows-sql-server-storage-configuration.md) 

### <a name="sql-server-license"></a>Лицензия SQL Server
Если вы являетесь клиентом Software Assurance, вы можете использовать [гибридную выгоду Azure,](https://azure.microsoft.com/pricing/hybrid-benefit/) чтобы принести свою собственную лицензию s'L Server и сэкономить на ресурсах. 

![Лицензия ВМ](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-license.png)

### <a name="automated-patching"></a>Автоматическое исправление

**Automated patching** включен по умолчанию. Автоматическая установка исправлений позволяет Azure автоматически исправлять SQL Server и операционную систему. Укажите день недели, время и длительность периода обслуживания. Azure устанавливает исправления в период обслуживания. Расписание периода обслуживания использует для определения времени региональные параметры VM. Если вы не хотите, чтобы платформа Azure автоматически устанавливала исправления для SQL Server и операционной системы, выберите вариант **Отключить**.  

![Автоматизированное исправление ВМ](media/virtual-machines-windows-portal-sql-server-provision/azure-sqlvm-automated-patching.png)

Дополнительные сведения см. в статье [Автоматическая установка исправлений SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-patching.md).

### <a name="automated-backup"></a>Автоматическая архивация

Включите автоматическую архивацию для всех баз данных в разделе **Автоматическая архивация**. По умолчанию автоматическая архивация отключена.

Во время включения автоматического резервного копирования SQL можно настроить следующие параметры:

* срок хранения (в днях) для резервных копий;
* учетная запись хранения, используемая для резервных копий;
* параметр шифрования и пароль для резервных копий.
* архивация системных баз данных;
* настройка расписания архивации баз данных.

Для шифрования резервной копии щелкните **Включить**. Затем введите **пароль**. Azure создает сертификат для шифрования резервных копий и использует указанный пароль для защиты этого сертификата. По умолчанию расписание устанавливается автоматически, но вы можете создать ручное расписание, выбрав **Руководство.** 

![Автоматизированное резервное копирование ВМ](media/virtual-machines-windows-portal-sql-server-provision/automated-backup.png)

Дополнительную информацию см. в статье [Автоматическая архивация SQL Server на виртуальных машинах Azure (Resource Manager)](virtual-machines-windows-sql-automated-backup.md).


### <a name="machine-learning-services"></a>Служба машинного обучения

У вас есть возможность включить [службы машинного обучения.](/sql/advanced-analytics/) Эта опция позволяет использовать машинное обучение с Помощью Python и R в S'L Server 2017. Выберите **Включить в** окне **настроек сервера S'L.**


## <a name="4-review--create"></a>4. Обзор и создание

На вкладке **Отзыв и создание** просмотрите сводные данные и выберите **Создать**, чтобы создать SQL Server, группу ресурсов и ресурсы, указанные для этой виртуальной машины.

Развертывание можно отслеживать на портале Azure. Если нажать кнопку **Уведомления** в верхней части окна, будут показаны основные сведения о состоянии развертывания.

> [!NOTE]
> Чтобы предоставить вам сведения о времени, необходимом для выполнения развертывания, в нашем сценарии виртуальная машина SQL была развернута в восточной части США с параметрами по умолчанию. На выполнение тестового развертывания требуется около 12 минут. Время развертывания зависит от региона и выбранных параметров.

## <a name="open-the-vm-with-remote-desktop"></a><a id="remotedesktop"></a> Открытие виртуальных машин с помощью удаленного рабочего стола

Выполните следующие действия, чтобы подключиться к виртуальной машине SQL Server через удаленный рабочий стол.

[!INCLUDE [Connect to SQL Server VM with remote desktop](../../../../includes/virtual-machines-sql-server-remote-desktop-connect.md)]

После подключения к виртуальной машине SQL Server вы можете запустить SQL Server Management Studio и подключиться с проверкой подлинности Windows, используя свои учетные данные локального администратора. Если включена проверка подлинности SQL Server, можно также подключиться с проверкой подлинности SQL, используя имя пользователя и пароль SQL, настроенные во время подготовки.

Доступ к машине позволяет напрямую изменять настройки компьютера и SQL Server в зависимости от ваших требований. Например, можно настроить параметры брандмауэра или изменить параметры конфигурации SQL Server.

## <a name="connect-to-sql-server-remotely"></a><a id="connect"></a> Удаленное подключение к SQL Server

В рамках этого пошагового руководства для виртуальной машины используется **открытый** доступ и **аутентификация SQL Server**. Эти параметры позволяют автоматически настроить виртуальную машину для получения доступа к экземпляру SQL Server из любого клиента через Интернет (при условии, что будет использоваться правильное имя пользователя SQL).

> [!NOTE]
> Если вы не выбрали открытый доступ во время подготовки, можно изменить параметры подключения к SQL на портале после подготовки. Дополнительные сведения см. в разделе [об изменении параметров подключения SQL](virtual-machines-windows-sql-connect.md#change).

В следующих разделах описано, как подключиться к вашему экземпляру виртуальной машины SQL Server через Интернет.

[!INCLUDE [Connect to SQL Server in a VM Resource Manager](../../../../includes/virtual-machines-sql-server-connection-steps-resource-manager.md)]

  > [!NOTE]
  > В этом примере используется общий порт 1433. Однако это значение необходимо будет изменить, если во время развертывания VM сервера ВМ был указан другой порт (например, 1401). 


## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании SQL Server в Azure см. в статье [Приступая к работе с SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-overview.md) и [Часто задаваемые вопросы об SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-server-iaas-faq.md).
