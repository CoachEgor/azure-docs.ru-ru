---
title: Часто задаваемые вопросы об SQL Server на виртуальных машинах Windows в Azure | Документация Майкрософт
description: В этой статье содержатся ответы на часто задаваемые вопросы о запуске SQL Server в виртуальных машинах Azure.
services: virtual-machines-windows
documentationcenter: ''
author: v-shysun
manager: felixwu
editor: ''
tags: azure-service-management
ms.assetid: 2fa5ee6b-51a6-4237-805f-518e6c57d11b
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: troubleshooting
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 07/12/2018
ms.author: v-shysun
ms.openlocfilehash: 95ad2ba4798d41f2e5e49ca33735b997859af23f
ms.sourcegitcommit: cf438e4b4e351b64fd0320bf17cc02489e61406a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2019
ms.locfileid: "67658138"
---
# <a name="frequently-asked-questions-for-sql-server-running-on-windows-virtual-machines-in-azure"></a>Часто задаваемые вопросы об SQL Server на виртуальных машинах Windows в Azure

> [!div class="op_single_selector"]
> * [Windows](virtual-machines-windows-sql-server-iaas-faq.md)
> * [Linux](../../linux/sql/sql-server-linux-faq.md)

В этой статье содержатся ответы на некоторые распространенные вопросы о запуске [SQL Server на виртуальных машинах Windows в Azure](https://azure.microsoft.com/services/virtual-machines/sql-server/).

> [!NOTE]
> Эта статья посвящена проблемам с SQL Server на виртуальных машинах Windows. Если вы используете SQL Server на виртуальных машинах Linux, см. [вопросы и ответы о виртуальных машинах Linux](../../linux/sql/sql-server-linux-faq.md).

[!INCLUDE [support-disclaimer](../../../../includes/support-disclaimer.md)]

## <a id="images"></a> Образы

1. **Какие образы доступны в коллекции виртуальных машин SQL Server?** 

   В Azure доступны образы виртуальных машин для всех поддерживаемых основных выпусков SQL Server во всех выпусках Windows и Linux. Дополнительные сведения см. в полном списке образов виртуальных машин [Windows](virtual-machines-windows-sql-server-iaas-overview.md#payasyougo) и [Linux](../../linux/sql/sql-server-linux-virtual-machines-overview.md#create).

1. **Обновляются ли доступные образы в коллекции виртуальных машин SQL Server?**

   Каждые два месяца образы SQL Server в коллекции виртуальных машин обновляются до последних версий Windows и Linux. Образы Windows содержат все обновления, отмеченные как важные в Центре обновления Windows, в частности важные обновления системы безопасности и пакеты обновления SQL Server. Образы Linux содержат последние обновления системы. Накопительные пакеты обновления SQL Server в Linux и Windows обрабатываются по-разному. Для Linux накопительные пакеты обновления SQL Server также включены в обновление. Но виртуальные машины Windows сейчас не поддерживают накопительные пакеты обновления для SQL Server или Windows Server.

1. **Можно ли удалить образы виртуальных машин SQL Server из коллекции?**

   Да. Azure поддерживает только один образ для основного номера версии и выпуска. Например, при выпуске нового пакета обновления SQL Server в коллекцию Azure для него добавляется новый образ. Образ SQL Server для предыдущего пакета обновления немедленно удаляется с портала Azure. Но он доступен для подготовки из PowerShell в течение следующих трех месяцев. После трех месяцев предыдущий образ пакета обновления становится недоступным. Эта политика удаления также применяется, если версия SQL Server перестает поддерживаться по окончании жизненного цикла.


1. **Это позволяет развертывать старые образ SQL Server, который не отображается на портале Azure?**

   Да, с помощью PowerShell. Дополнительные сведения о том, как развернуть виртуальные машины SQL Server с помощью PowerShell, см. в статье [Как подготовить виртуальные машины SQL Server с помощью Azure PowerShell](virtual-machines-windows-ps-sql-create.md).

1. **Можно ли создать образ виртуального жесткого диска из виртуальной машины SQL Server?**

   Да, но нужно учесть некоторые факторы. Если развернуть этот виртуальный жесткий ДИСК в новую виртуальную Машину в Azure, не дает в разделе Конфигурация SQL Server на портале. Параметрами конфигурации SQL Server нужно будет управлять через PowerShell. Кроме того, с вас будет взиматься плата по тарифу виртуальной машины SQL, на которой изначально был основан образ. Этот принцип будет применяться, даже если перед развертыванием удалить SQL Server с виртуального жесткого диска. 

1. **Можно ли настраивать конфигурации, которых нет в коллекции виртуальных машин (например Windows 2008 R2 + SQL Server 2012)?**

   Нет. С помощью портала Azure или [PowerShell](virtual-machines-windows-ps-sql-create.md) вы можете выбрать только один из представленных в коллекции образов виртуальных машин с SQL Server. 


## <a name="creation"></a>Создание

1. **Как создать виртуальную машину Azure с SQL Server?**

   Самый простой способ — создать виртуальную машину с SQL Server. Инструкции по регистрации в Azure и созданию виртуальной машины SQL на портале см. в статье [Создание виртуальной машины Windows SQL Server на портале Azure](virtual-machines-windows-portal-sql-server-provision.md). Вы можете выбрать образ виртуальной машины, использующей лицензирование SQL Server с посекундной оплатой, или же образ, который позволяет применить собственную лицензию SQL Server. Кроме того, вы можете вручную установить SQL Server на виртуальной машине, используя выпуск с бесплатной лицензией (Developer или Express) или предоставив существующую локальную лицензию. При использовании собственной лицензии у вас должно быть преимущество [Перемещение лицензий в рамках программы Software Assurance в Azure](https://azure.microsoft.com/pricing/license-mobility/). Дополнительные сведения см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

1. **Как перенести локальную базу данных SQL Server в облако?**

   Сначала создайте виртуальную машину Azure с экземпляром SQL Server. Затем перенесите локальные базы данных в этот экземпляр. Стратегии переноса данных см. в статье [Миграция базы данных SQL Server в экземпляр SQL Server на виртуальной машине Azure](virtual-machines-windows-migrate-sql.md).

## <a name="licensing"></a>Лицензирование

1. **Как установить лицензированную копию SQL Server в виртуальной машине Azure?**

   Это можно сделать двумя способами. Можно подготовить один из [образов виртуальных машин, которые поддерживают лицензии](virtual-machines-windows-sql-server-iaas-overview.md#BYOL). Такая модель также называется "с использованием собственной лицензии" (BYOL). Кроме того, можно скопировать установочный носитель SQL Server на виртуальную машину Windows Server, а затем установить SQL Server на виртуальную машину. Тем не менее при установке SQL Server вручную отсутствует интеграция с порталом и расширение агента IaaS для SQL Server не поддерживается, поэтому такие компоненты, как автоматическое резервное копирование и автоматическая установка исправлений, не будут работать в этом сценарии. Исходя из этого, мы рекомендуем использовать один из образов коллекции BYOL. Чтобы использовать образ BYOL или собственный носитель SQL Server для виртуальной машины Azure, необходимо преимущество [Перемещение лицензий в рамках Software Assurance в Azure](https://azure.microsoft.com/pricing/license-mobility/). Дополнительные сведения см. в [руководстве по выбору ценовой категории для виртуальных машин Azure SQL Server](virtual-machines-windows-sql-server-pricing-guidance.md).

1. **Нужно ли платить за лицензирование SQL Server на виртуальной машине Azure, если она используется только для резервирования или отработки отказа?**

   Наличие Software Assurance, а затем воспользоваться возможностью перемещения лицензий, как описано в разделе [виртуальной машины вопросы и ответы](https://azure.microsoft.com/pricing/licensing-faq/), то нет необходимости платить за лицензию на один сервер SQL Server, участвующий в качестве пассивной вторичной реплики в развертывании с высоким уровнем ДОСТУПНОСТИ. В противном случае вам нужно приобрести лицензию.

1. **Можно ли настроить виртуальную машину для использования собственной лицензии SQL Server, если она была создана из одного из образов коллекции с оплатой по мере использования?**

   Да. Вы можете переключаться между двумя моделями лицензирования, если вы начали работу с образом из коллекции с оплатой по мере использования. Однако вы не сможете переключить модель лицензирования на PAYG, если вы начали работу с образом BYOL. Дополнительные сведения см. в разделе [Изменение модели лицензирования для виртуальной машины SQL Server в Azure](virtual-machines-windows-sql-ahb.md).

   > [!Note]
   > Сейчас эта возможность доступна только клиентам общедоступного облака.

1. **Для создания новой виртуальной машины SQL необходимо использовать образ BYOL или поставщик ресурсов виртуальной машины SQL?**

   Образы с использованием собственных лицензий (BYOL) доступны только для клиентов EA. Другие клиенты, имеющие Software Assurance, должны использовать поставщик ресурсов виртуальной машины SQL для создания виртуальной машины SQL с применением программы [Преимущество гибридного использования Azure (AHB)](https://azure.microsoft.com/pricing/licensing-faq/). 

1. **Будет ли переход на другую модель лицензирования сопровождаться простоем SQL Server?**

   Нет. [Изменение модели лицензирования](virtual-machines-windows-sql-ahb.md) не сопровождается простоем SQL Server, так как изменение вступает в силу немедленно и не требует перезапуска виртуальной машины. Тем не менее, чтобы зарегистрировать виртуальную машину SQL Server в поставщике ресурсов виртуальной машины SQL, требуется [расширение IaaS для SQL](virtual-machines-windows-sql-server-agent-extension.md). При установке расширения IaaS для SQL служба SQL Server перезапускается. Если нужно установить расширение IaaS для SQL, то это следует сделать во время периода обслуживания. 

1. **Могут ли из подписок CSP активировать Преимущество гибридного использования Azure?**

   Да, Преимущество гибридного использования Azure доступно для подписок CSP. Клиентам CSP следует сначала развернуть образ с оплатой по мере использования, а затем [изменить модель лицензирования](virtual-machines-windows-sql-ahb.md), чтобы использовать собственную лицензию.  

1. **Приведет ли регистрация виртуальной машины в новом поставщике ресурсов виртуальной машины SQL к дополнительным затратам?**

   Нет. Поставщик ресурсов виртуальной машины SQL обеспечивает дополнительную управляемость для SQL Server на виртуальной машине Azure без каких-либо дополнительных затрат. 

1. **Доступен ли поставщик ресурсов виртуальной машины SQL для всех клиентов?**
 
   Да. Все клиенты могут выполнять регистрацию в новом поставщике ресурсов виртуальной машины SQL. Тем не менее только клиенты с преимуществом Software Assurance могут активировать [Преимущество гибридного использования Azure (AHB)](https://azure.microsoft.com/pricing/hybrid-benefit/) (или BYOL) на виртуальной машине SQL Server. 

1. **Что происходит с _Microsoft.SqlVirtualMachine_ ресурсов при перемещении или удалении ресурса виртуальной Машины?** 

   Когда ресурс Microsoft.Compute/VirtualMachine удаляется или перемещается, связанному с ним ресурсу виртуальной машины Microsoft.Sql приходит уведомление об асинхронной репликации операции.

1. **Что происходит с виртуальной Машины, если _Microsoft.SqlVirtualMachine_ удалении ресурсов?**

    Удаление ресурса Microsoft.SqlVirtualMachine не влияет на ресурс Microsoft.Compute/VirtualMachine. Тем не менее изменения лицензирования по умолчанию возвращают исходный источник образов. 

1. **Возможно ли зарегистрировать самостоятельно развернутые виртуальные машины SQL Server в поставщике ресурсов виртуальной машины SQL?**

    Да. Если вы развернули SQL Server с собственного носителя и установили расширение SQL IaaS, вы можете зарегистрировать виртуальную машину SQL в поставщике ресурсов, чтобы получить преимущества управления, предоставляемые расширением SQL IaaS. Однако вы не можете преобразовать самостоятельно развернутую виртуальную машину SQL в виртуальную машину с оплатой по мере использования.

## <a name="administration"></a>Администрирование

1. **Можно ли установить второй экземпляр SQL Server в той же виртуальной машине? Можно изменить установленные компоненты экземпляра по умолчанию?**

   Да. Установочный носитель SQL Server находится в папке на диске **C** . Запустите файл **Setup.exe** из этого расположения, чтобы добавить новые экземпляры SQL Server или изменить другие компоненты SQL Server, установленные на виртуальной машине. Обратите внимание, что некоторые функции, такие как автоматическое резервное копирование, автоматическая установка исправлений и интеграции хранилища ключей Azure, работают только с экземпляром по умолчанию или именованный экземпляр, на котором был настроен должным образом (см. вопрос 3). 

1. **Можно ли удалить экземпляр по умолчанию SQL Server?**

   Да, но нужно учесть некоторые факторы. Как уже говорилось в предыдущем ответе, имеются функции, основанные на [расширение агента IaaS SQL Server](virtual-machines-windows-sql-server-agent-extension.md).  При удалении экземпляра по умолчанию без удаления расширения IaaS также расширение продолжает искать его и может создавать ошибки в журнале событий. У этих ошибок два источника: **служба управления учетными данными Microsoft SQL Server** и **агент IaaS Microsoft SQL Server**. Пример одной из ошибок показан ниже.

      При подключении к SQL Server произошла ошибка, связанная с сетью или с определенным экземпляром. Сервер не найден или недоступен.

   Если вы решите удалить экземпляр по умолчанию, удалите и [расширение агента IaaS SQL Server](virtual-machines-windows-sql-server-agent-extension.md).

1. **Можно ли использовать именованный экземпляр SQL Server с помощью расширения IaaS**?
   
   Да, если именованный экземпляр является единственным экземпляром на сервере SQL Server, и в том случае, если исходный экземпляр по умолчанию был [удалено должным образом](../sqlclassic/virtual-machines-windows-classic-sql-server-agent-extension.md#installation). Если имеется несколько именованных экземпляров на одной виртуальной Машины SQL Server нет экземпляра по умолчанию, расширение IaaS удастся установить. 

1. **Можно ли полностью удалить SQL Server с виртуальной машины SQL?**

   Да, но с вас будет по-прежнему взиматься плата за виртуальную машину SQL, как описано в статье [Руководство по выбору ценовой категории для виртуальных машин SQL Server в Azure](virtual-machines-windows-sql-server-pricing-guidance.md). Если вам больше не нужен SQL Server, можно развернуть новую виртуальную машину и перенести туда данные и приложения. Затем виртуальную машину SQL Server можно удалить.
   
## <a name="updating-and-patching"></a>Установка обновлений и исправлений

1. **Как изменить различные версии или выпуска SQL Server на виртуальной Машине Azure?**

   Клиенты можно изменить их версии или выпуска SQL Server с помощью установочного носителя, содержащего их нужную версию или выпуск SQL Server. После выпуска было изменено, измените значение свойства edition виртуальной машины для точного отражения выставления счетов для виртуальной Машины с помощью портала Azure. Дополнительные сведения см. в разделе [изменить выпуск виртуальную Машину SQL Server](virtual-machines-windows-sql-change-edition.md). 


1. **Как обновления и пакеты обновления применяются к виртуальной машине SQL Server?**

   Виртуальные машины позволяют контролировать сервер, в том числе время и способ применения обновлений. Что касается операционной системы, вы можете вручную применять обновления для Windows или включить службу расписаний под названием [Автоматическое исправление](virtual-machines-windows-sql-automated-patching.md). Эта служба устанавливает все обновления, помеченные как важные, включая обновления SQL Server из этой категории. Другие необязательные обновления для SQL Server необходимо устанавливать вручную.

## <a name="general"></a>Общие сведения

1. **Поддерживаются ли экземпляры отказоустойчивого кластера SQL Server на виртуальных машинах Azure?**

   Да. Вы можете [создать отказоустойчивый кластер Windows на платформе Windows Server 2016](virtual-machines-windows-portal-sql-create-failover-cluster.md) и использовать локальные дисковые пространства (S2D) для хранилища кластера. Кроме того, можно использовать сторонние решения кластеризации или хранения, как описано в статье [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-high-availability-dr.md#azure-only-high-availability-solutions).

   > [!IMPORTANT]
   > В настоящее время [расширение агента IaaS SQL Server](virtual-machines-windows-sql-server-agent-extension.md) не поддерживается для экземпляра отказоустойчивого кластера SQL Server в Azure. Мы рекомендуем удалить расширение с виртуальных машин, которые участвуют в экземпляре отказоустойчивого кластера. Это расширение поддерживает такие компоненты, как автоматическое резервное копирование и установка исправлений, а также некоторые возможности портала для SQL. Эти компоненты не будут работать для виртуальных машин SQL после удаления агента.

1. **В чем разница между виртуальными машинами SQL и службой "База данных SQL"?**

   По существу выполнение SQL Server в виртуальной машине Azure не отличается от выполнения SQL Server в удаленном центре данных. В свою очередь, служба [База данных SQL](../../../sql-database/sql-database-technical-overview.md) предлагается на основе модели "база данных как услуга". При использовании Базы данных SQL у вас нет доступа к компьютерам, на которых размещаются ваши базы данных. Полное сравнение см. в разделе [Выбор компонента SQL Server в облаке: база данных SQL Azure (PaaS) или SQL Server на виртуальных машинах Azure (IaaS)](../../../sql-database/sql-database-paas-vs-sql-server-iaas.md).

1. **Как установить SQL Server Data Tools в виртуальной машине Azure?**

    Скачайте инструменты SQL Server Data Tools со страницы [Microsoft SQL Server Data Tools ― Business Intelligence для Visual Studio 2013](https://www.microsoft.com/download/details.aspx?id=42313) и установите их.

1. **Все распределенные транзакции при использовании MSDTC, поддерживаемые на виртуальных машинах SQL Server?**
   
    Да. Локальную службу DTC, поддерживаемых SQL Server 2016 с пакетом обновления 2 и более. Тем не менее приложения необходимо протестировать, при использовании групп доступности Always On, как транзакции, активных во время отработки отказа завершится ошибкой и должна быть повторена. Кластеризованного DTC доступен, начиная с Windows Server 2019. 

## <a name="resources"></a>Ресурсы

**Для виртуальных машин Windows**:

* [Приступая к работе с SQL Server на виртуальных машинах Azure (Windows)](virtual-machines-windows-sql-server-iaas-overview.md)
* [Подготовка виртуальной машины SQL Server на базе Windows](virtual-machines-windows-portal-sql-server-provision.md).
* [Миграция базы данных в SQL Server на виртуальной машине Azure](virtual-machines-windows-migrate-sql.md)
* [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-high-availability-dr.md)
* [Рекомендации по оптимизации производительности SQL Server в виртуальных машинах Azure](virtual-machines-windows-sql-performance.md)
* [Шаблоны приложений и стратегии разработки для SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-server-app-patterns-dev-strategies.md)

**Для виртуальных машин Linux**:

* [Обзор SQL Server на виртуальных машинах Linux](../../linux/sql/sql-server-linux-virtual-machines-overview.md).
* [Подготовка виртуальной машины SQL Server на базе Linux на портале Azure](../../linux/sql/provision-sql-server-linux-virtual-machine.md)
* [Frequently asked questions for SQL Server on Linux Azure Virtual Machines](../../linux/sql/sql-server-linux-faq.md) (Часто задаваемые вопросы об SQL Server на виртуальных машинах Azure (Linux))
* [Документация по SQL Server в Linux](https://docs.microsoft.com/sql/linux/sql-server-linux-overview)
