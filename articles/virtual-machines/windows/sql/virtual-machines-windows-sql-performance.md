---
title: Рекомендации по оптимизации производительности SQL Server в Azure | Документация Майкрософт
description: Содержит рекомендации по оптимизации производительности SQL Server в виртуальных машинах Microsoft Azure.
services: virtual-machines-windows
documentationcenter: na
author: MashaMSFT
manager: craigg
editor: ''
tags: azure-service-management
ms.assetid: a0c85092-2113-4982-b73a-4e80160bac36
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 09/26/2018
ms.author: mathoma
ms.reviewer: jroth
ms.openlocfilehash: d81c1941f114efbfd4ede559152317e907edeaea
ms.sourcegitcommit: aa042d4341054f437f3190da7c8a718729eb675e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/09/2019
ms.locfileid: "68882386"
---
# <a name="performance-guidelines-for-sql-server-in-azure-virtual-machines"></a>Рекомендации по оптимизации производительности SQL Server на виртуальных машинах Azure

## <a name="overview"></a>Обзор

В этой статье приведены советы по оптимизации производительности SQL Server на виртуальной машине Microsoft Azure. При выполнении SQL Server в виртуальных машинах Azure рекомендуется продолжать использование тех же средств настройки производительности базы данных, которые применяются для SQL Server в локальной серверной среде. Однако производительность реляционной базы данных в общедоступном облаке зависит от многих факторов, таких как размер виртуальной машины и конфигурации дисков с данными.

[Образы SQL Server, подготовленные на портале Azure](quickstart-sql-vm-create-portal.md), соответствуют общим рекомендациям по конфигурации хранилища. Дополнительные сведения о настройке хранилища см. в статье [Настройка хранилища для виртуальных машин SQL Server](virtual-machines-windows-sql-server-storage-configuration.md). Завершив подготовку обдумайте, нужно ли применить другие виды оптимизации, описанные в этой статье. При принятии решений учитывайте характер рабочих нагрузок, а затем проверьте выбор путем тестирования.

> [!TIP]
> Как правило, существует компромисс между оптимизацией затрат и оптимизацией производительности. Этот документ содержит инструкции по достижению *оптимальной* производительности SQL Server на виртуальных машинах Azure. Если рабочая нагрузка не так велика, могут потребоваться не все перечисленные ниже оптимизации. При оценке этих рекомендаций учитывайте актуальные потребности в производительности, затраты и характер рабочих нагрузок.

## <a name="quick-check-list"></a>Краткий контрольный список

Ниже приведен краткий контрольный список по обеспечению оптимальной производительности SQL Server на виртуальных машинах Azure.

| Область | Оптимизация |
| --- | --- |
| [Размер виртуальной машины](#vm-size-guidance) | - [DS3_v2](../sizes-general.md) или выше для выпуска SQL Enterprise.<br/><br/> - [DS2_v2](../sizes-general.md) или выше для выпусков SQL Standard и SQL Web. |
| [Хранилище](#storage-guidance) | Используйте [SSD (цен. категория "Премиум")](../disks-types.md). Стандартное хранилище рекомендуется использовать только для разработки и тестирования.<br/><br/> Храните [учетную запись хранения](../../../storage/common/storage-create-storage-account.md) и виртуальную машину SQL Server в одном и том же регионе.<br/><br/> Отключите [геоизбыточное хранилище](../../../storage/common/storage-redundancy.md) (георепликацию) Azure в учетной записи хранения. |
| [диски;](#disks-guidance) | Используйте как минимум два [диска P30](../disks-types.md#premium-ssd) (один для файлов журнала и один для файлов данных, включая TempDB). Для рабочих нагрузок, требующих порядка 50 000 операций ввода-вывода в секунду, рассмотрите возможность использования дисков SSD (цен. категория "Ультра"). <br/><br/> Избегайте использования дисков операционной системы или временных дисков для хранения базы данных или журналов.<br/><br/> Включите кэширование операций чтения на дисках, где размещаются файлы данных и файлы данных базы данных TempDB.<br/><br/> Не включайте кэширование на дисках, где находится файл журнала.  **Важно!** Остановите службу SQL Server при изменении параметров кэша для диска виртуальной машины Azure.<br/><br/> Обеспечьте чередование нескольких дисков данных Azure для увеличения пропускной способности ввода-вывода.<br/><br/> Выполняйте форматирование с использованием задокументированных размеров кластеров. <br/><br/> Разместите базу данных tempdb на локальном `D:\` накопителе SSD для критически важных SQL Server рабочих нагрузок (после выбора правильного размера виртуальной машины). Дополнительные сведения в блоге [с использованием твердотельных накопителей для хранения базы данных tempdb](https://cloudblogs.microsoft.com/sqlserver/2014/09/25/using-ssds-in-azure-vms-to-store-sql-server-tempdb-and-buffer-pool-extensions/).  |
| [ВВОД-ВЫВОД](#io-guidance) |Включите сжатие страниц базы данных.<br/><br/> Включите быструю инициализацию для файлов данных.<br/><br/> Ограничьте авторасширение базы данных.<br/><br/> Отключите автосжатие базы данных.<br/><br/> Переместите все базы данных на диски с данными, включая системные базы данных.<br/><br/> Переместите журнал ошибок SQL Server и каталоги файлов трассировки на диски данных.<br/><br/> Настройте расположения по умолчанию для файлов резервных копий и базы данных.<br/><br/> Включите заблокированные страницы.<br/><br/> Примените исправления производительности SQL Server. |
| [Характерные особенности компонента](#feature-specific-guidance) | Используйте резервное копирование напрямую в хранилище BLOB-объектов. |

Дополнительные сведения о том, *как* выполнить эти оптимизации и *для чего* они необходимы, см. в следующих разделах.

## <a name="vm-size-guidance"></a>Рекомендации по выбору размеров виртуальных машин

Для приложений, чувствительных к уровню производительности, рекомендуется использовать следующие [размеры виртуальных машин](../sizes.md):

* **SQL Server Enterprise Edition**: DS3_v2 или выше
* **SQL Server Standard Edition и Web Edition**: DS2_v2 или выше

Виртуальные машины [серии DSv2](../sizes-general.md#dsv2-series) поддерживают хранилища класса Premium, рекомендуемые для наилучшей производительности. Приведенные здесь рекомендации по размерам являются базовыми. Размер конкретной виртуальной машины необходимо выбирать в соответствии с вашими потребностями в рабочей нагрузке. Виртуальные машины серии DSv2 являются машинами общего назначения и хорошо подходят для широкого ряда рабочих нагрузок, тогда как другие размеры машин оптимизированы для конкретных типов рабочих нагрузок. Например, машины [серии M](../sizes-memory.md#m-series) позволяют использовать наибольшие количество виртуальных ЦП и объем памяти и подходят для самых больших рабочих нагрузок SQL-серверов. [Серия GS](../sizes-previous-gen.md#gs-series) и [серия Dv2 11-15](../sizes-memory.md#dsv2-series-11-15) оптимизированы для использования больших объемов памяти. Обе этих серии также доступны в вариантах с [ограниченным числом ядер](../../windows/constrained-vcpu.md), что позволяет сэкономить средства для рабочих нагрузок с невысокими требованиями к вычислительной мощности. Машины [серии Ls](../sizes-storage.md) оптимизированы для высокой пропускной способности дисков и операций ввода-вывода. Важно учитывать рабочую нагрузку конкретного SQL-сервера при выборе серии и размера виртуальной машины.

## <a name="storage-guidance"></a>Рекомендации по выбору хранилища

Виртуальные машины серий DS (а также DSv2 и GS) поддерживают [SSD (цен. категория "Премиум")](../disks-types.md). Для всех производственных рабочих нагрузок мы рекомендуем использовать SSD (цен. категория "Премиум").

> [!WARNING]
> HDD и SSD (цен. категория "Стандартный") характеризуются различными задержками и пропускной способностью и рекомендуется только для рабочих нагрузок по разработке и тестированию. Для производственных рабочих нагрузок необходимо использовать SSD (цен. категория "Премиум").

Кроме того, рекомендуется создать свою учетную запись хранения Azure в одном центре обработки данных с виртуальными машинами SQL Server для уменьшения задержек при передаче данных. При создании учетной записи хранения отключите георепликацию, поскольку согласованный порядок записи на несколько дисков не гарантируется. Вместо этого рекомендуется реализовать средства аварийного восстановления SQL Server между двумя центрами обработки данных Azure. Дополнительные сведения см. в статье [Высокий уровень доступности и аварийное восстановление для SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-high-availability-dr.md).

## <a name="disks-guidance"></a>Рекомендации по использованию дисков

Виртуальная машина Azure поддерживает три основных типа дисков:

* **Диск ОС**: при создании виртуальной машины Azure платформа подключает к ней по меньшей мере один диск (обозначенный буквой **C**), используемый в качестве диска операционной системы. Этот диск представляет собой VHD-файл, сохраненный как страничный BLOB-объект в хранилище.
* **Временный диск**: виртуальные машины Azure содержат еще один диск (обозначенный буквой **D**), который называется временным диском. Это диск на узле, который может использоваться для области временных файлов.
* **Диски данных**: Вы также можете присоединить к виртуальной машине дополнительные диски, например диски данных, и они также будут сохранены в хранилище как страничные BLOB-объекты.

В следующих разделах приводятся рекомендации по использованию этих дисков.

### <a name="operating-system-disk"></a>Диск операционной системы

Диск операционной системы — это виртуальный жесткий диск, который можно установить и использовать как диск с установленной операционной системой, данный диск имеет метку **C:** .

По умолчанию для диска операционной системы применяется политика кэширования **Чтение и запись**. Для приложений, чувствительных к уровню производительности, рекомендуется использовать диски данных вместо диска операционной системы. См. подраздел "Диски данных" ниже.

### <a name="temporary-disk"></a>Временный диск

Диск временного хранилища с меткой **D:** не сохраняется в хранилище больших двоичных объектов. Не храните файлы пользовательской базы данных или файлы журнала транзакций пользователя на диске **D**.

В виртуальных машинах серий D, Dv2 и G роль временного диска выполняет диск на основе SSD. Если рабочая нагрузка усложняет использование базы данных TempDB (например, для временных объектов или сложных соединений), то хранение базы данных TempDB на диске **D** может повысить пропускную способность и уменьшить задержку базы данных TempDB. Пример сценария см. в обсуждении о TempDB в записи блога [Storage Configuration Guidelines for SQL Server on Azure VM](https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/09/25/storage-configuration-guidelines-for-sql-server-on-azure-vm) (Инструкции конфигурации хранилища для SQL Server в виртуальной машине Azure).

Для виртуальных машин, которые поддерживают SSD (цен. категория "Премиум") (серии D, Dv2 и G), рекомендуется хранить базу данных TempDB на диске, поддерживающем SSD (цен. категория "Премиум"), с включенным кэшированием чтения.

Существует одно исключение: _если работа базы данных TempDB предусматривает большое количество операций записи, то для достижения более высокой производительности можно сохранить базу данных TempDB на локальном диске **D**, который на виртуальных машинах этого размера также является диском на основе SSD._ Дополнительные сведения см. в блоге [Использование SSDS с базой данных tempdb](https://cloudblogs.microsoft.com/sqlserver/2014/09/25/using-ssds-in-azure-vms-to-store-sql-server-tempdb-and-buffer-pool-extensions/) . 

### <a name="data-disks"></a>Диски данных

* **Использование дисков данных для файлов данных и журналов**: Если чередование дисков не используется, используйте два диска P30 SSD "Премиум", где один диск содержит файлы журнала, а другой — данные и базу данных TempDB (за исключением критически важных и интенсивных рабочих нагрузок, как упоминалось выше). Каждый SSD (цен. категория "Премиум") обеспечивает определенное количество операций ввода-вывода в секунду и пропускную способность (МБ/с) в зависимости от своего размера, как описано в статье [What disk types are available in Azure?](../disks-types.md) (Типы дисков доступные в Azure). При использовании метода чередования дисков, например дискового пространства, можно достичь оптимальной производительности, имея два пула: один для файлов журнала, а другой для файлов данных. Однако, если вы планируете использовать экземпляры отказоустойчивого кластера (FCI) SQL Server, необходимо настроить один пул.

   > [!TIP]
   > - Результаты теста на различных дисках и в различных конфигурациях рабочей нагрузки см. в записи блога [Storage Configuration Guidelines for SQL Server on Azure VM](https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/09/25/storage-configuration-guidelines-for-sql-server-on-azure-vm/) (Инструкции конфигурации хранилища для SQL Server в виртуальной машине Azure).
   > - Чтобы обеспечить надежную работу критически важных серверов SQL Server, для которых требуется порядка 50 000 операций ввода-вывода в секунду, рассмотрите возможность замены дисков P10–P30 дисками SSD (цен. категория "Ультра"). Дополнительные сведения доступны в этой записи блога: [Mission critical performance with Ultra SSD](https://azure.microsoft.com/blog/mission-critical-performance-with-ultra-ssd-for-sql-server-on-azure-vm/) (Выполнение критически важных операций с помощью дисков SSD (цен. категория "Ультра")).

   > [!NOTE]
   > При подготовке виртуальной машины SQL Server на портале у вас есть возможность изменить конфигурацию хранилища. В зависимости от конфигурации Azure настраивает один или несколько дисков. Несколько дисков объединяются в единый пул хранилищ с чередованием. Файлы данных и журналов совместно размещаются в этой конфигурации. Дополнительные сведения см. в статье [Настройка хранилища для виртуальных машин SQL Server](virtual-machines-windows-sql-server-storage-configuration.md).

* **Чередование дисков**: для повышения пропускной способности можно добавить дополнительные диски с данными и использовать чередование дисков. Чтобы определить количество дисков данных, необходимо проанализировать количество операций ввода-вывода в секунду и пропускную способность, необходимые для ваших файлов журналов, файлов данных и tempdb. Обратите внимание, что разные размеры виртуальной машины накладывают разные ограничения на количество операций ввода-вывода в секунду и пропускную способность. Ознакомьтесь с таблицами зависимости количества операций ввода-вывода в секунду от [размера виртуальной машины](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json). Придерживайтесь приведенных ниже рекомендаций.

  * Для Windows 8 и Windows Server 2012 или более поздней версии используйте [дисковые пространства](https://technet.microsoft.com/library/hh831739.aspx), придерживаясь приведенных ниже рекомендаций.

      1. Задайте размер чередования в 64 КБ (65 536 байт) для рабочих нагрузок OLTP и 256 КБ (262 144 байт) для рабочих нагрузок хранилища данных, чтобы избежать снижения производительности из-за рассогласования разделов. Это следует сделать в PowerShell.
      2. Задайте число столбцов равным количеству физических дисков. Используйте PowerShell (не пользовательский интерфейс диспетчера сервера) при настройке более 8 дисков. 

    Например, следующая команда PowerShell создает пул носителей с размером чередования 64 КБ и числом столбцов, равным 2:

    ```powershell
    $PoolCount = Get-PhysicalDisk -CanPool $True
    $PhysicalDisks = Get-PhysicalDisk | Where-Object {$_.FriendlyName -like "*2" -or $_.FriendlyName -like "*3"}

    New-StoragePool -FriendlyName "DataFiles" -StorageSubsystemFriendlyName "Storage Spaces*" -PhysicalDisks $PhysicalDisks | New-VirtualDisk -FriendlyName "DataFiles" -Interleave 65536 -NumberOfColumns 2 -ResiliencySettingName simple –UseMaximumSize |Initialize-Disk -PartitionStyle GPT -PassThru |New-Partition -AssignDriveLetter -UseMaximumSize |Format-Volume -FileSystem NTFS -NewFileSystemLabel "DataDisks" -AllocationUnitSize 65536 -Confirm:$false 
    ```

  * Для Windows 2008 R2 или более ранней версии можно воспользоваться динамическими дисками (чередующимися томами операционной системы), при этом размер чередования всегда составляет 64 КБ. Обратите внимание, что эта возможность не поддерживается в Windows 8 и Windows Server 2012. Дополнительные сведения см. в заявлении о поддержке в статье [Virtual Disk Service is transitioning to Windows Storage Management API](https://msdn.microsoft.com/library/windows/desktop/hh848071.aspx) (Служба виртуальных дисков переходит на API управления хранилищами Windows).

  * Если вы используете [локальные дисковые пространства (S2D)](/windows-server/storage/storage-spaces/storage-spaces-direct-in-vm) с [экземплярами отказоустойчивого кластера SQL Server](virtual-machines-windows-portal-sql-create-failover-cluster.md), вам нужно настроить единый пул. Обратите внимание, что хотя в этом пуле можно создать тома с разной емкостью, они будут отличаться общей характеристикой, например общая политика кэширования.

  * Определите число дисков, связанных с пулом хранилищ, на основании ожидаемой нагрузки. Помните, что в разных размерах виртуальной машины можно подключать различное число дисков данных. Дополнительные сведения см. в статье [Размеры виртуальных машин в Azure](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).

  * Если SSD (цен. категория "Премиум") не применяется (сценарии разработки и тестирования), то рекомендуется добавить максимальное количество дисков данных, поддерживаемое для вашего [размера виртуальной машины](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) и использовать чередование дисков.

* **Политика кэширования**: изучите предложенные ниже рекомендации по выбору политики кэширования в зависимости от конфигурации хранилища.

  * Если вы используете отдельные диски для файлов данных и файлов журналов, включите кэширование операций чтения только на дисках с файлами данных и файлами TempDB. Это позволит существенно повысить производительность. Не включайте кэширование для диска, где хранятся файлы журналов, так как это немного снижает производительность.

  * Если вы используете чередование дисков в едином пуле хранилища, для большинства рабочих нагрузок кэширование операций чтения повысит производительность. Если у вас есть отдельные пулы хранения для файлов журнала и данных, включите кэширование чтения только в пуле хранения для файлов данных. Для некоторых рабочих нагрузок с операциями записи большого объема данных можно повысить производительность, отключив кэширование. Точные данные можно получить только путем тестирования.

  * Все описанные выше рекомендации относятся к SSD (цен. категория "Премиум"). Если SSD (цен. категория "Премиум") не используется, не включайте кэширование ни для каких дисков данных.

  * Инструкции по настройке кэширования дисков см. в указанных ниже статьях. Для классической модели развертывания (ASM) изучите: [Set-AzureOSDisk](https://msdn.microsoft.com/library/azure/jj152847) и [Set-AzureDataDisk](https://msdn.microsoft.com/library/azure/jj152851.aspx). Для модели развертывания Azure Resource Manager изучите: [Set-AzOSDisk](https://docs.microsoft.com/powershell/module/az.compute/set-azvmosdisk) и [Set-AzVMDataDisk](https://docs.microsoft.com/powershell/module/az.compute/set-azvmdatadisk).

     > [!WARNING]
     > Остановите службу SQL Server при настройке кэширования дисков виртуальной машины Azure, чтобы избежать возможного повреждения баз данных.

* **Размер единицы размещения NTFS**: при форматировании диска с данными мы советуем использовать размер единицы размещения 64 КБ для файлов данных и журналов, а также TempDB.

* **Рекомендации по управлению дисками**: при удалении диска данных или изменении его типа кэша остановите службу SQL Server. При изменении параметров кэширования диска ОС Azure останавливает виртуальную машину, изменяет тип кэша и перезапускает виртуальную машину. При изменении параметров кэша диска данных виртуальная машина не останавливается. Диск данных отключается от нее на время внесения изменений, а затем снова подключается к виртуальной машине.

  > [!WARNING]
  > Если не останавливать службу SQL Server на время таких операций, это может привести к повреждению базы данных.


## <a name="io-guidance"></a>Рекомендации по использованию операций ввода-вывода

* Наилучшие результаты работы с SSD (цен. категория "Премиум") достигаются при параллелизации приложений и запросов. SSD (цен. категория "Премиум") предназначено для сценариев, где глубина очереди ввода-вывода больше 1, поэтому прирост производительности для однопоточных последовательных запросов почти не ощущается (даже если они направляются в хранилище в большом объеме). Например, это может негативно повлиять на результаты однопоточного тестирования в средствах анализа производительности, таких как SQLIO.

* Рекомендуется использовать [сжатие страниц базы данных](https://msdn.microsoft.com/library/cc280449.aspx) , так как это позволяет повысить производительность рабочих нагрузок с большим объемом операций ввода-вывода. Однако сжатие данных может повысить потребление ресурсов ЦП на сервере базы данных.

* Рекомендуется включить быструю инициализацию файлов для сокращения времени, необходимого для начального выделения файлов. Чтобы воспользоваться преимуществами быстрой инициализации файлов, назначьте SE_MANAGE_VOLUME_NAME учетной записи службы SQL Server (MSSQLSERVER) и добавьте ее в политику безопасности **Выполнение задач по обслуживанию томов**. Если вы используете образ платформы SQL Server для Azure, то учетная запись службы по умолчанию (NT Service\MSSQLSERVER) не добавляется в политику безопасности **Выполнение задач по обслуживанию томов**. Другими словами, быстрая инициализация файлов в образе платформы SQL Server Azure не включена. После добавления учетной записи службы SQL Server в политику безопасности **Выполнение задач по обслуживанию томов** перезапустите службу SQL Server. Использование этой функции может быть показано из соображений безопасности. Дополнительные сведения см. в статье [Мгновенная инициализация файлов базы данных](https://msdn.microsoft.com/library/ms175935.aspx).

* **Авторасширение** считается лишь предупредительной мерой на случай непредвиденного роста. Не используйте авторасширение для повседневного управления ростом данных и журналов. При использовании авторасширения предварительно увеличьте размер файла с помощью параметра размера.

* Убедитесь, что **автосжатие** отключено, чтобы избежать ненужных затрат ресурсов, что может отрицательно повлиять на производительность.

* Переместите все базы данных на диски с данными, включая системные базы данных. Дополнительные сведения см. в статье [Перемещение системных баз данных](https://msdn.microsoft.com/library/ms345408.aspx).

* Переместите журнал ошибок SQL Server и каталоги файлов трассировки на диски с данными. Для этого в диспетчере конфигурации SQL Server щелкните правой кнопкой мыши свой экземпляр SQL Server и выберите пункт "Свойства". На вкладке **Параметры запуска** можно изменить параметры файлов трассировки и журнала ошибок. Каталог дампа указан на вкладке **Дополнительно** . На приведенных далее снимках экрана показано, где находится параметр запуска журнала ошибок.

    ![Снимок экрана SQL ErrorLog](./media/virtual-machines-windows-sql-performance/sql_server_error_log_location.png)

* Настройка расположений по умолчанию для файлов резервных копий и базы данных. Следуйте рекомендациям в этой статье и внесите изменения в окне свойств сервера. Инструкции см. в статье [Просмотр или изменение расположения по умолчанию для файлов данных и журнала (среда SQL Server Management Studio)](https://msdn.microsoft.com/library/dd206993.aspx). На следующем снимке экрана показано, где нужно внести необходимые изменения.

    ![Файлы журнала данных SQL и резервных копий](./media/virtual-machines-windows-sql-performance/sql_server_default_data_log_backup_locations.png)
* Включение блокировки страниц для сокращения числа операций ввода-вывода, а также операций разбиения по страницам. Дополнительные сведения см. в статье [Включение параметра «Блокировка страниц в памяти» (Windows)](https://msdn.microsoft.com/library/ms190730.aspx).

* Если вы используете SQL Server 2012, установите накопительный пакет обновления 10 для пакета обновления 1. Это обновление содержит исправление для низкой производительности ввода-вывода при выполнении оператора выборки во временную таблицу в SQL Server 2012. Дополнительные сведения см. в этой [статье базы знаний](https://support.microsoft.com/kb/2958012).

* Рекомендуется сжимать файлы данных при их передаче в среду Azure и из нее.

## <a name="feature-specific-guidance"></a>Обзор конкретных функций

Для некоторых развертываний получить дополнительные преимущества, используя более сложные методики настройки. В следующем списке перечислены некоторые функции SQL Server, которые могут помочь добиться лучшей производительности:

### <a name="backup-to-azure-storage"></a>Резервное копирование в службу хранилища Azure
при выполнении резервного копирования данных SQL Server, запущенного на виртуальных машинах Azure, можно использовать [резервное копирование в SQL Server по URL-адресу](https://msdn.microsoft.com/library/dn435916.aspx). Эта функция доступна, начиная с накопительного пакета обновления 2 для пакета обновления 1 SQL Server 2012, и рекомендуется к применению при архивации на подключенные диски данных. При выполнении архивации или восстановления с использованием службы хранилища Azure следуйте рекомендациям из раздела [Рекомендации по архивации SQL Server на URL-адрес, устранению неполадок и восстановлению из резервных копий в службе хранилища Azure](https://msdn.microsoft.com/library/jj919149.aspx). Кроме того, можно автоматизировать эти процессы архивации с помощью [автоматической архивации SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-automated-backup.md).

В выпусках, предшествующих SQL Server 2012, можно использовать [инструмент архивации SQL Server в Azure](https://www.microsoft.com/download/details.aspx?id=40740). Это средство может помочь повысить пропускную способность при архивации благодаря использованию нескольких чередующихся целей архивации.

### <a name="sql-server-data-files-in-azure"></a>SQL Server файлы данных в Azure

эта новая функция, [Файлы данных SQL Server в Microsoft Azure](https://msdn.microsoft.com/library/dn385720.aspx), доступна, начиная с SQL Server 2014. Выполнение SQL Server с файлами данных в Azure демонстрирует уровень производительности, сравнимый с использованием дисков данных Azure.

### <a name="failover-cluster-instance-and-storage-spaces"></a>Экземпляр отказоустойчивого кластера и дисковые пространства

Если вы используете дисковые пространства, при добавлении узлов в кластер на странице **подтверждения** снимите флажок **Добавить все подходящие хранилища в кластер**. 

![Снять флажок с подходящего хранилища](media/virtual-machines-windows-sql-performance/uncheck-eligible-cluster-storage.png)

Если вы используете дисковые пространства и не сняли флажок **Добавление всех допустимых хранилищ в кластер**, то Windows отключит виртуальные диски во время процесса кластеризации. Как следствие, они не отобразятся в диспетчере дисков или Explorer, пока дисковые пространства не будут удалены из кластера и повторно подключены с помощью PowerShell. Дисковые пространства группируют несколько дисков в пулы носителей. Дополнительные сведения см. в статье [Обзор дисковых пространств](/windows-server/storage/storage-spaces/overview).

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о хранилище и производительности см. в записи блога, посвященной [рекомендациям по конфигурации хранилища для SQL Server на виртуальной машине Azure](https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/09/25/storage-configuration-guidelines-for-sql-server-on-azure-vm/).

Рекомендации по безопасности см. в статье [Вопросы безопасности SQL Server на виртуальных машинах Azure](virtual-machines-windows-sql-security.md).

Ознакомьтесь с другими статьями, посвященными виртуальным машинам SQL Server, используя руководство с [обзором SQL Server на виртуальных машинах с Windows](virtual-machines-windows-sql-server-iaas-overview.md). Если у вас есть вопросы по виртуальным машинам SQL Server, см. раздел [часто задаваемых вопросов](virtual-machines-windows-sql-server-iaas-faq.md).
