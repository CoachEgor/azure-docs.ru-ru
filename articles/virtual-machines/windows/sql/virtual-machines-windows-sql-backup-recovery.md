---
title: Резервное копирование и восстановление SQL Server на виртуальных машинах Azure | Документация Майкрософт
description: Содержит сведения об архивации и восстановлении баз данных SQL Server на виртуальных машинах Azure.
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: craigg
editor: ''
tags: azure-resource-management
ms.assetid: 95a89072-0edf-49b5-88ed-584891c0e066
ms.service: virtual-machines-sql
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 06/04/2018
ms.author: mikeray
ms.openlocfilehash: e4c126bbac73accb984f1040a7fea1740d919233
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79249780"
---
# <a name="backup-and-restore-for-sql-server-in-azure-virtual-machines"></a>Резервное копирование и восстановление SQL Server в виртуальных машинах Azure

В этой статье описаны функции резервного копирования и восстановления, доступные для SQL Server на виртуальных машинах Windows в Azure. В службе хранилища Azure хранятся три копии каждого диска виртуальной машины Azure для защиты от потери или физического повреждения данных. В отличие от локальной среды здесь вы можете не беспокоиться об аппаратных сбоях. Но для баз данных SQL Server все равно следует создавать резервные копии, чтобы защитить их от ошибок приложений и (или) пользователей, например случайной вставки или удаления данных. В таких случаях важно иметь возможность выполнить восстановление до определенной точки во времени.

В первой части этой статьи описаны доступные функции резервного копирования и восстановления. За ней следуют разделы с более подробной информацией о каждой стратегии.

## <a name="backup-and-restore-options"></a>Функции резервного копирования и восстановления

Следующая таблица предоставляет сведения о разных функциях для резервного копирования и восстановления SQL Server на виртуальных машинах Azure.

| Стратегия | Версии SQL | Описание |
|---|---|---|
| [Автоматизированное резервное копирование](#automated) | 2014<br/> 2016<br/> 2017 | Автоматическое резервное копирование позволяет запланировать регулярное создание резервных копий для всех баз данных на виртуальной машине с SQL Server. Резервные копии хранятся в хранилище Azure в течение 30 дней. Начиная с SQL Server 2016, применяется автоматическое резервное копирование версии 2, с рядом дополнительных возможностей, таких как настройка расписания вручную и настройка частоты полного резервного копирования и резервного копирования журналов. |
| [Azure Backup для виртуальных машин SQL](#azbackup) | 2008<br/> 2012<br/> 2014<br/> 2016<br/> 2017 | Microsoft Azure Backup предоставляет возможности резервного копирования корпоративного класса для экземпляров SQL Server, работающих на виртуальных машинах Azure. Эта служба позволяет централизованно управлять резервным копированием для нескольких серверов и тысяч баз данных. Любую из баз данных с помощью портала можно восстановить до определенной точки во времени. Служба поддерживает настраиваемые политики хранения, в том числе хранение резервных копий в течение нескольких лет. |
| [Ручное резервное копирование](#manual) | All | В зависимости от установленной версии SQL Server у вас есть несколько вариантов вручную выполнять резервное копирование и восстановление SQL Server на виртуальной машине Azure. В этом сценарии вы отвечаете за способ резервного копирования баз данных, место хранения резервных копий и управление ими. |

В следующих разделах каждый из этих вариантов описан подробнее. В последнем разделе этой статьи представлена сводка в виде матрицы функций.

## <a name="automated-backup"></a><a id="automated"></a>Автоматизированное резервное копирование

Автоматическое резервное копирование реализует службу автоматического резервного копирования для экземпляров SQL Server Standard и Enterprise, работающих на виртуальной машине Windows в Azure. Эта служба работает на базе [расширения агента SQL Server IaaS](virtual-machines-windows-sql-server-agent-extension.md), которое автоматически устанавливается на все образы виртуальных машин Windows для SQL Server, представленные на портале Azure.

Резервные копии всех баз данных помещаются в настраиваемую учетную запись хранения Azure. Резервные копии можно шифровать и сохранять до 30 дней.

Виртуальные машины с SQL Server 2016 и более поздних версий предоставляют больше возможностей для настройки, так как поддерживают автоматическое резервное копирование версии 2. Среди прочего, добавлены следующие улучшения:

- резервное копирование системных баз данных;
- настройка расписания резервного копирования и интервала времени вручную;
- интервал для полного резервного копирования и резервного копирования файлов журнала.

Чтобы восстановить базу данных, следует найти нужный файл (или файлы) резервной копии и выполнить восстановление на виртуальной машине SQL с помощью SQL Server Management Studio или команд Transact-SQL.

Дополнительные сведения о настройке автоматического резервного копирования для виртуальных машин SQL см. в следующих статьях:

- **Сервер S'L 2016/2017**: [Автоматизированное резервное копирование v2 для виртуальных машин Azure](virtual-machines-windows-sql-automated-backup-v2.md)
- **SQL Server 2014**: [Автоматическая архивация для виртуальных машин SQL Server 2014](virtual-machines-windows-sql-automated-backup.md)

## <a name="azure-backup-for-sql-vms"></a><a id="azbackup"></a>Резервное копирование Azure для VMs-серверов S'L

[Microsoft Azure Backup](/azure/backup/) предоставляет возможности резервного копирования корпоративного класса для экземпляров SQL Server, работающих на виртуальных машинах Azure. Все резервные копии хранятся в хранилище служб восстановления, где вы можете ими управлять. Это решение имеет ряд важных преимуществ, особенно для предприятий:

- **Не требуется инфраструктура для резервного копирования**. Вам не придется управлять серверами и (или) хранилищами для резервных копий.
- **Масштабируемость**. Вы можете защитить большое число виртуальных машин SQL и тысячи баз данных.
- **Оплата по мере использования**. Эта функция реализована в виде отдельной службы, предоставляемой в Azure Backup, и оплачивается только по мере использования, как и все остальные службы Azure.
- **Централизованное управление и мониторинг**. Вы можете централизованно управлять всеми резервными копиями, в том числе для поддерживаемых Azure Backup сторонних рабочих нагрузок, с помощью единой панели мониторинга Azure.
- **Резервное копирование и хранение на основе политик**. Вы можете создавать стандартные политики резервного копирования для регулярного выполнения резервного копирования. Политики хранения позволяют хранить резервные копии в течение многих лет.
- **Поддержка SQL Always On**. Вы можете выявлять и защищать конфигурацию SQL Server Always On с учетом параметров резервного копирования, настроенных для группы доступности.
- **15-минутная целевая точка восстановления (RPO)**. Для журналов транзакций SQL можно настроить интервал резервного копирования до 15 минут.
- **Восстановление до точки во времени**. С помощью портала вы можете восстанавливать базы данных до определенной точки во времени, без необходимости вручную восстанавливать полные и разностные резервные копии, а также резервные копии журналов.
- **Консолидированные оповещения об ошибках по электронной почте**. Настройте консолидированные уведомления по электронной почте о любых сбоях.
- **Управление доступом на основе ролей**. На портале вы можете определить пользователей, которые смогут управлять операциями резервного копирования и восстановления.

Краткий обзор и демонстрация этой возможности представлена в следующем видео:

> [!VIDEO https://www.youtube.com/embed/wmbANpHos_E]

Это решение резервного копирования Azure для VMs-серверов, как правило, доступно. Дополнительные сведения см. в статье [Back up SQL Server database in Azure](../../../backup/backup-azure-sql-database.md) (Резервное копирование базы данных SQL Server в Azure).

## <a name="manual-backup"></a><a id="manual"></a> Резервное копирование вручную

Если вы хотите вручную управлять операциями резервного копирования и восстановления для виртуальных машин SQL, это можно сделать несколькими способами в зависимости от используемой версии SQL Server. Обзор функций резервного копирования и восстановления см. в следующих статьях для разных версий SQL Server:

- [резервное копирование и восстановление для SQL Server 2016 и более поздних версий](https://docs.microsoft.com/sql/relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases);
- [резервное копирование и восстановление для SQL Server 2014](https://msdn.microsoft.com/library/ms187048%28v=sql.120%29.aspx);
- [резервное копирование и восстановление для SQL Server 2012](https://msdn.microsoft.com/library/ms187048%28v=sql.110%29.aspx);
- [резервное копирование и восстановление для SQL Server 2008 R2](https://msdn.microsoft.com/library/ms187048%28v=sql.105%29.aspx);
- [Резервное копирование и восстановление для SQL Server 2008](https://msdn.microsoft.com/library/ms187048%28v=sql.100%29.aspx).

В следующих разделах подробнее описаны некоторые способы выполнять резервное копирование и восстановление вручную.

### <a name="backup-to-attached-disks"></a>Резервное копирование на подключенные диски

Для экземпляров SQL Server, работающих на виртуальных машинах Azure, вы можете применить встроенные функции резервного копирования и восстановления, используя подключенные диски в качестве хранилища для файлов резервных копий. При этом существует ограничение на количество дисков, которые можно присоединить к виртуальной машине Azure, связанное с [размером виртуальной машины](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json). Также необходимо учитывать накладные расходы на управление дисками.

В статье [Создание полной резервной копии базы данных (SQL Server)](https://docs.microsoft.com/sql/relational-databases/backup-restore/create-a-full-database-backup-sql-server) описано, как вручную создать полную резервную копию базы данных с помощью SQL Server Management Studio (SSMS) или Transact-SQL.

### <a name="backup-to-url"></a>Резервное копирование на URL-адрес

Начиная с SQL Server 2012 SP1 CU2, добавлена возможность резервного копирования непосредственно в хранилище и восстановления из него больших двоичных объектов Microsoft Azure. Этот метод также называется резервным копированием на URL-адрес. В SQL Server 2016 эта функция получила ряд усовершенствований.

| Усовершенствования 2016 года | Сведения |
| --- | --- |
| **Чередование** |Когда выполняется резервное копирование в хранилище BLOB-объектов Microsoft Azure, SQL Server 2016 позволяет использовать сразу несколько больших двоичных объектов и, таким образом, создавать резервные копии больших баз данных размером до 12,8 ТБ. |
| **Резервное копирование моментальных снимков** |Благодаря использованию моментальных снимков Azure функция резервного копирования моментальных снимков файлов SQL Server дает возможность практически мгновенно создавать резервные копии и быстро восстанавливать файлы баз данных, сохраненные с помощью службы хранилища BLOB-объектов Azure. Это позволяет упростить политики архивации и восстановления политик. Функция архивации моментальных снимков файлов поддерживает также восстановление до определенной точки во времени. Дополнительные сведения см. в статье [Резервные копии моментальных снимков файлов для файлов базы данных в Azure](https://docs.microsoft.com/sql/relational-databases/backup-restore/file-snapshot-backups-for-database-files-in-azure). |

Дополнительные сведения см. в следующих статьях для разных версий SQL Server:

- [резервное копирование SQL Server на URL-адрес](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service) для **SQL Server 2016/2017**;
- [резервное копирование SQL Server на URL-адрес](https://msdn.microsoft.com/library/jj919148%28v=sql.120%29.aspx) для **SQL Server 2014**;
- [резервное копирование SQL Server на URL-адрес](https://msdn.microsoft.com/library/jj919148%28v=sql.110%29.aspx) для **SQL Server 2012**.

### <a name="managed-backup"></a>Управляемое резервное копирование

Начиная с SQL Server 2014 добавлена функция управляемого резервного копирования, которая автоматизирует создание резервных копий в хранилище Azure. Управляемое резервное копирование в фоновом режиме выполняет резервное копирование на URL-адрес (см. выше). Кроме того, управляемое резервное копирование является базовым компонентом, обеспечивающим поддержку службы автоматического резервного копирования виртуальной машины SQL Server.

Начиная с SQL Server 2016, управляемое резервное копирование поддерживает несколько новых функций, в том числе создание расписаний, резервное копирование системной базы данных, настройку частоты полного резервного копирования и резервного копирования журналов.

Дополнительные сведения см. в следующих статьях для разных версий SQL Server:

- [управляемое резервное копирование SQL Server в Microsoft Azure для SQL Server 2016 и более поздних версий](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure);
- [управляемое резервное копирование SQL Server в Microsoft Azure для SQL Server 2014](https://msdn.microsoft.com/library/dn449496%28v=sql.120%29.aspx).

## <a name="decision-matrix"></a>Матрица принятия решений

Следующая таблица содержит сводку всех функций резервного копирования и восстановления, доступных для виртуальных машин SQL Server в Azure.

|| **Автоматизированное резервное копирование** | **Azure Backup для SQL** | **Ручное резервное копирование** |
|---|---|---|---|
| Требуется дополнительная служба Azure |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Настройка политики резервного копирования на портале Azure | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Восстановление баз данных на портале Azure |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Управление несколькими серверами на одной панели мониторинга |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Восстановление на момент времени | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |
| Целевая точка восстановления (RPO) 15 минут | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |
| Краткосрочная политика хранения резервных копий (в днях) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Долгосрочная политика хранения резервных копий (месяцы, годы) |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Встроенная поддержка SQL Server Always On |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Резервное копирование в учетную запись хранения Azure | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png)(автоматически) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png)(автоматически) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png)(под управлением пользователя) |
| Управление хранилищами и файлами резервных копий | | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |  |
| Резервное копирование на подключенные диски виртуальной машины |   |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |
| Централизованные настраиваемые отчеты о резервном копировании |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Объединенные оповещения об ошибках по электронной почте |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Настройка мониторинга на основе журналов Azure Monitor |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   |
| Мониторинг заданий резервного копирования с помощью скриптов SSMS или Transact-SQL | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |
| Восстановление баз данных с помощью скриптов SSMS или Transact-SQL | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |   | ![Да](./media/virtual-machines-windows-sql-backup-recovery/yes.png) |

## <a name="next-steps"></a>Дальнейшие действия

Если вы планируете развертывание SQL Server на виртуальной машине Azure, см. рекомендации в руководстве [Как подготовить виртуальную машину SQL Server на платформе Windows на портале Azure](virtual-machines-windows-portal-sql-server-provision.md).

При том, что архивацию и восстановление можно использовать для переноса данных, существуют более простые способы переноса данных в SQL Server на виртуальной машине Azure. Полное описание вариантов переноса и соответствующие рекомендации см. в статье [Миграция базы данных SQL Server в экземпляр SQL Server на виртуальной машине Azure](virtual-machines-windows-migrate-sql.md).
