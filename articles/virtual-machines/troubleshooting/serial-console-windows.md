---
title: Серийная консоль Azure для Windows Документы Майкрософт
description: Двухнаправленная серийная консоль для виртуальных машин Azure и виртуальных наборов масштабов машин.
services: virtual-machines-windows
documentationcenter: ''
author: asinn826
manager: gwallace
editor: ''
tags: azure-resource-manager
ms.service: virtual-machines-windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 5/1/2019
ms.author: alsin
ms.openlocfilehash: 87ccb1c4995337b385f685797980a9fc3962bc6f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79267005"
---
# <a name="azure-serial-console-for-windows"></a>Серийная консоль Azure для Windows

Система Ная на портале Azure обеспечивает доступ к текстовой консоли для виртуальных компьютеров Windows (VMs) и экземпляров набора виртуальных машин. Это последовательное соединение подключается к серийному порту COM1 VM или виртуальному набору машин, обеспечивая доступ к нему независимо от состояния сети или операционной системы. К серийной консоли можно получить доступ только с помощью портала Azure и допускаются только те пользователи, которые имеют роль участника доступа или выше к набору VM или виртуальной машины.

Серийная консоль работает таким же образом для виртуальных и виртуальных машин масштаба набора экземпляров. В этом документе все упоминания в Виртуальные мва неявно включают экземпляры набора виртуальной шкалы машин, если не указано иное.

Для серийной консоли [Azure Serial Console for Linux](serial-console-linux.md)документации для Linux см.

> [!NOTE]
> Серийная консоль обычно доступна в глобальных регионах Azure и в публичном предварительном просмотре в правительстве Azure. Он пока не доступен в облаке Azure China.


## <a name="prerequisites"></a>Предварительные требования

* В вашем экземпляре набора VM или виртуальной шкалы машин должен использоваться модель развертывания ресурсов. Классические развертывания не поддерживаются.

- Ваша учетная запись, используюая серийную консоль, должна иметь [роль вкладчика виртуальной машины](../../role-based-access-control/built-in-roles.md#virtual-machine-contributor) для VM и учетную запись [хранения диагностики ботинок](boot-diagnostics.md)

- В вашем экземпляре набора VM или виртуальной машины должен быть пользователь на основе паролей. Вы можете создать ее с функцией [сброса пароля](https://docs.microsoft.com/azure/virtual-machines/extensions/vmaccess#reset-password) расширения для доступа к виртуальной машине. В разделе **Поддержка и устранение неполадок** выберите **Сбросить пароль**.

* В VM для виртуального набора машин должно быть [включена диагностика ботинок.](boot-diagnostics.md)

    ![Параметры диагностики загрузки](../media/virtual-machines-serial-console/virtual-machine-serial-console-diagnostics-settings.png)

## <a name="enable-serial-console-functionality-for-windows-server"></a>Включить функцию серийной консоли для Windows Server

> [!NOTE]
> Если вы ничего не видите в серийной консоли, убедитесь, что диагностика загрузки включена на вашем VM или виртуальном наборе масштабов машины.

### <a name="enable-the-serial-console-in-custom-or-older-images"></a>Включение последовательной консоли в пользовательских или старых образах
Новые изображения Windows Server в Azure имеют [специальную административную консоль](https://technet.microsoft.com/library/cc787940(v=ws.10).aspx) (SAC), включенную по умолчанию. SAC поддерживается в серверных версиях Windows, но недоступна в клиентских версиях (например, в Windows 10, Windows 8 или Windows 7).

Для более старых образов Windows Server (созданных до февраля 2018 г.) вы можете автоматизировать включение последовательной консоли с помощью функции "Выполнить команду" на портале Azure. На портале Azure выберите **команду Run,** а затем выберите команду **EnableEMS** из списка.

![Список команд запуска](./media/virtual-machines-serial-console/virtual-machine-windows-serial-console-runcommand.png)

Кроме того, чтобы вручную включить серийную консоль для Windows VMs/виртуального набора машин, созданного до февраля 2018 года, выполните следующие действия:

1. Подключитесь к виртуальной машине Windows через удаленный рабочий стол.
1. Запустите следующие команды из командной строки с правами администратора:
    - `bcdedit /ems {current} on`
    - `bcdedit /emssettings EMSPORT:1 EMSBAUDRATE:115200`
1. Чтобы использовать консоль SAC, перезагрузите систему.

    ![Консоль SAC](./media/virtual-machines-serial-console/virtual-machine-windows-serial-console-connect.gif)

В случае необходимости SAC можно также включить в автономном режиме.

1. Подключите к существующей виртуальной машине в качестве диска данных тот диск Windows, для которого вы хотите настроить SAC.

1. Запустите следующие команды из командной строки с правами администратора:
   - `bcdedit /store <mountedvolume>\boot\bcd /ems {default} on`
   - `bcdedit /store <mountedvolume>\boot\bcd /emssettings EMSPORT:1 EMSBAUDRATE:115200`

#### <a name="how-do-i-know-if-sac-is-enabled"></a>Как узнать, доступна ли SAC?

Если консоль [SAC](https://technet.microsoft.com/library/cc787940(v=ws.10).aspx) не включена, последовательная консоль не отображает строку запроса SAC. В некоторых случаях сведения о работоспособности виртуальной машины отображаются, а иногда строка остается пустой. Если вы используете образ Windows Server, созданный ранее февраля 2018 года, консоль SAC вряд ли будет включена.

### <a name="enable-the-windows-boot-menu-in-the-serial-console"></a>Включение меню загрузки Windows в последовательной консоли

Если вы намерены включить отображение сообщений загрузчика Windows в последовательной консоли, добавьте параметры в конфигурацию загрузки. Дополнительные сведения см. в документации по [bcdedit](https://docs.microsoft.com/windows-hardware/drivers/devtest/bcdedit--set).

1. Подключитесь к Windows VM или виртуальному масштабу машины, установленному экземпляром, с помощью удаленного рабочего стола.

1. Запустите следующие команды из командной строки с правами администратора:
   - `bcdedit /set {bootmgr} displaybootmenu yes`
   - `bcdedit /set {bootmgr} timeout 10`
   - `bcdedit /set {bootmgr} bootems yes`

1. Перезагрузите систему, чтобы включить меню загрузки.

> [!NOTE]
> Время ожидания, установленное для отображения меню диспетчера загрузки, будет влиять на общее время загрузки ОС. Если период ожидания 10 секунд вы считаете слишком коротким или слишком долгим, измените это значение.

## <a name="use-serial-console"></a>Использование последовательной консоли

### <a name="use-cmd-or-powershell-in-serial-console"></a>Используйте CMD или PowerShell в серийной консоли

1. Подключение к последовательной консоли Если подключение выполнено успешно, в командной строке отображается приглашение **SAC>**:

    ![Подключение к SAC](./media/virtual-machines-serial-console/virtual-machine-windows-serial-console-connect-sac.png)

1.  Введите `cmd`, чтобы создать канала с экземпляром командной строки.

1.  `ch -si 1` Введите `<esc>+<tab>` или нажмите клавиши ярлыка для переключения на канал, который работает экземпляр CMD.

1.  Нажмите клавишу **ВВОД**, а затем введите учетные данные для входа с привилегиями администратора.

1.  После ввода действительных учетных данных открывается экземпляр командной строки.

1.  Чтобы запустить экземпляр PowerShell, введите `PowerShell` в экземпляре командной строки и нажмите клавишу **ВВОД**.

    ![Открытие экземпляра PowerShell](./media/virtual-machines-serial-console/virtual-machine-windows-serial-console-powershell.png)

### <a name="use-the-serial-console-for-nmi-calls"></a>Использование последовательной консоли для вызовов немаскируемого прерывания
Немаскируемое прерывание (NMI) предназначено для создания сигнала, который программное обеспечение на виртуальной машине не будет игнорировать. Раньше немаскируемые прерывания использовались для мониторинга аппаратных проблем в системах, требующих определенного времени отклика. Сегодня программисты и системные администраторы часто используют NMI в качестве механизма для отладки или устранения неполадок систем, которые не реагируют.

Из последовательной консоли можно отправить немаскируемое прерывание на виртуальную машину Azure, нажав значок клавиатуры в командной строке. Поведение системы при получении немаскируемого прерывания зависит от конфигурации виртуальной машины. В Windows можно настроить аварийное завершение и создание дампа памяти при получении немаскируемого прерывания.

![Отправка немаскируемого прерывания](../media/virtual-machines-serial-console/virtual-machine-windows-serial-console-nmi.png) <br>

Сведения о настройке Windows для создания аварийного дампа при получении немаскируемого прерывания см. в статье [Как создать файл дампа памяти ядра или полный файла аварийной копии памяти с помощью прерывание (NMI) на компьютере под управлением Windows](https://support.microsoft.com/help/927069/how-to-generate-a-complete-crash-dump-file-or-a-kernel-crash-dump-file).

### <a name="use-function-keys-in-serial-console"></a>Использование функциональных клавиш в последовательной консоли
Функциональные клавиши включены для использования в последовательной консоли на виртуальных машинах Windows. Клавиша F8 в раскрывающемся списке последовательной консоли позволяет легко перейти к меню Advanced Boot Settings (Расширенные параметры загрузки), но последовательная консоль совместима и с другими функциональными клавишами. Возможно, вам придется нажать **Fn** + **F1** (или F2, F3 и т.д.) на клавиатуре в зависимости от компьютера вы используете серийную консоль с.

### <a name="use-wsl-in-serial-console"></a>Использование WSL в последовательной консоли
Подсистема Windows для Linux (WSL) включена для Windows Server 2019 или более поздней версии, поэтому, если вы используете такую ОС, эту подсистему также можно включить для использования в последовательной консоли. Это может быть полезным для пользователей, которые умеют работать с командами Linux. Инструкции по включению WSL для Windows Server см. в [руководстве по установке](https://docs.microsoft.com/windows/wsl/install-on-server).

### <a name="restart-your-windows-vmvirtual-machine-scale-set-instance-within-serial-console"></a>Перезапустите экземпляр набора шкалы Windows VM/виртуальной машины в серийной консоли
Вы можете инициировать перезагрузку в серийной консоли, перенаправившись к кнопке питания и нажав кнопку "Перезагрузка VM". При этом запустится перезагрузка виртуальной машины и на портале Azure появится уведомление о перезапуске.

Это полезно в ситуациях, когда вы можете получить доступ к меню загрузки, не выходя из серийного интерфейса консоли.

![Перезагрузка последовательной консоли Windows](./media/virtual-machines-serial-console/virtual-machine-serial-console-restart-button-windows.gif)

## <a name="disable-the-serial-console"></a>Отключить серийную консоль
По умолчанию все подписки имеют серийный доступ к консоли. Вы можете отключить серийную консоль на уровне подписки или vM/виртуальном уровне шкалы машины. Для получения подробных инструкций посетите [Enable и отключите серийную консоль Azure.](./serial-console-enable-disable.md)

## <a name="serial-console-security"></a>Безопасность последовательной консоли

### <a name="access-security"></a>Безопасность доступа
Доступ к последовательной консоли ограничен пользователями, которые имеют [роли с доступом участника виртуальной машины](../../role-based-access-control/built-in-roles.md#virtual-machine-contributor) или выше. Если клиент Azure Active Directory требует многофакторной проверки подлинности (MFA), то для доступа к последовательной консоли также понадобится MFA, так как доступ к последовательной консоли предоставляется через [портал Azure](https://portal.azure.com).

### <a name="channel-security"></a>Безопасность канала
Все данные, исходящие и поступающие, при пересылке по сети зашифрованы.

### <a name="audit-logs"></a>Журналы аудита
Все сведения о доступе к последовательной консоли записываются в журналы [диагностики загрузки](https://docs.microsoft.com/azure/virtual-machines/linux/boot-diagnostics) на виртуальной машине. Права доступа к этим журналам и на работу с ними принадлежат администратору виртуальной машины Azure.

> [!CAUTION]
> Пароли доступа для консоли не записываются. Тем не менее если команды, выполняемые в консоли, содержат или выводят пароли, секреты, имена пользователей или другие персональные данные в любой форме, они будут записываться в журналы диагностики загрузки виртуальной машины. Персональные данные будут записываться вместе с другим видимым текстом как часть реализации функции обратной прокрутки последовательной консоли. Эти журналы являются циклическими. Только пользователи с разрешениями на чтение в учетной записи хранения диагностики имеют к ним доступ. Но мы советуем следовать рекомендациям по использованию удаленного рабочего стола для всего, что может содержать секретные или персональные данные.

### <a name="concurrent-usage"></a>Одновременное использование
Когда один пользователь подключен к последовательной консоли, а другой успешно запрашивает доступ к этой же виртуальной машине, первый пользователь будет отключен, а второй — подключен к тому же сеансу.

> [!CAUTION]
> Это означает, что пользователь, который отключен, не будет зарегистрирован. Возможность принудительного выхода при отключении (с помощью SIGHUP или аналогичного механизма) все еще находится в дорожной карте. Для Windows включено автоматическое истечение времени ожидания в SAC, а в Linux вы можете самостоятельно настроить для терминала время ожидания.

## <a name="accessibility"></a>Специальные возможности
Возможности доступа являются важной задачей для последовательной консоли Azure. С этой целью мы обеспечили доступность последовательной консоли для лиц с нарушениями зрения и слуха, а также для людей, которые не могут использовать мышь.

### <a name="keyboard-navigation"></a>Навигация с помощью клавиатуры
Используйте клавишу **TAB** на клавиатуре для навигации по интерфейсу последовательной консоли на портале Azure. Ваше местоположение будет выделено на экране. Чтобы оставить фокус окона серийной консоли, нажмите **Ctrl**+**F6** на клавиатуре.

### <a name="use-the-serial-console-with-a-screen-reader"></a>Использование последовательной консоли с помощью средства чтения экрана
Последовательная консоль имеет встроенную поддержку чтения экрана. Навигация с помощью включенного средства чтения экрана дает возможность чтения текста вслух с помощью выбранной кнопки.

## <a name="common-scenarios-for-accessing-the-serial-console"></a>Общие сценарии для доступа к последовательной консоли

Сценарий          | Действия в последовательной консоли
:------------------|:-----------------------------------------
Неверные правила брандмауэра | Откройте последовательную консоль и исправьте правила брандмауэра Windows.
Проверка файловой системы на случай повреждения | Откройте последовательную консоль и восстановите файловую систему.
Проблемы с конфигурацией RDP | Откройте последовательную консоль и измените параметры. Дополнительные сведения см. в [документации по RDP](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/clients/remote-desktop-allow-access).
Сеть блокирует работу системы | Чтобы управлять системой, откройте последовательную консоль на портале Azure. Некоторые команды сети перечислены в статье [о командах Windows для CMD и PowerShell](serial-console-cmd-ps-commands.md).
Взаимодействие с загрузчиком | Подключитесь к данным конфигурации загрузки через последовательную консоль. Этот процесс описан в статье [Включение меню загрузки Windows в последовательной консоли](#enable-the-windows-boot-menu-in-the-serial-console).

## <a name="known-issues"></a>Известные проблемы
Мы знаем о некоторых проблемах с серийной консолью и операционной системой VM. Вот список этих проблем и шаги для смягчения последствий для Windows VMs. Эти проблемы и смягчения применяются как для виртуальных вс-чатов, так и для виртуальных экземпляров, установленных шкалой машин. Если они не совпадают с ошибкой, которую вы видите, обратитесь к общим ошибкам службы серий консолей при [общих ошибках последовательной консоли.](./serial-console-errors.md)

Проблема                             |   Меры по снижению риска
:---------------------------------|:--------------------------------------------|
Нажатие клавиши **ВВОД** после заголовка соединения не вызывает появления запроса на вход в систему. | Дополнительные сведения см. в статье [Нажатие клавиши ВВОД не приводит ни к каким результатам](https://github.com/Microsoft/azserialconsole/blob/master/Known_Issues/Hitting_enter_does_nothing.md). Такая ошибка происходит, если вы используете пользовательскую виртуальную машину, защищенное устройство или конфигурацию загрузки, параметры которых не позволяют Windows нормально подключиться к последовательному порту. Эта ошибка также будет возникать, если вы работаете с Windows 10 VM, потому что только Windows Server VMs настроены, чтобы иметь EMS включен.
Отображаются только сведения о работоспособности при подключении к виртуальной машине Windows| Эта ошибка возникает, если консоль специального администрирования не была включена для изображения Windows. Инструкции о том, как вручную включить SAC на виртуальной машине Windows, см. в разделе [Включение последовательной консоли в пользовательских или старых образах](#enable-the-serial-console-in-custom-or-older-images). Дополнительные сведения см. в документации [и сигналах работоспособности Windows](https://github.com/Microsoft/azserialconsole/blob/master/Known_Issues/Windows_Health_Info.md).
SAC не занимает всю область Serial Console в браузере | Это известная проблема с Windows и эмулятортерминала. Мы отслеживаем эту проблему с обеими командами, но на данный момент нет никакого смягчения.
Не удается выполнить ввод в командной строке SAC, если включена отладка ядра. | Подключитесь к виртуальной машине по протоколу RDP и выполните `bcdedit /debug {current} off` из командной строки с повышенными привилегиями. Если вы не можете использовать RDP, вместо этого подключите диск ОС к другой виртуальной машине Azure и при подключении сделайте его диском данных, выполнив `bcdedit /store <drive letter of data disk>:\boot\bcd /debug <identifier> off`, а затем переключите диск обратно.
Вставка в PowerShell в SAC приводит к возникновению третьего знака, если исходное содержимое имело повторяющийся знак | В качестве обходного решения вы можете выполнить `Remove-Module PSReadLine`, чтобы выгрузить модуль PSReadLine из текущего сеанса. Но это действие не удаляет модуль.
Некоторые данные при вводе с клавиатуры создают странные выходные данные SAC (например, **[A**, **[3~**). | Еscape-последовательность [VT100](https://aka.ms/vtsequences) не поддерживается в командной строке SAC.
Вставка длинных строк не работает. | Последовательная консоль ограничивает длину строк, которые можно вставить в окно терминала, до 2048 знаков, чтобы избежать перегрузки пропускной способности серийного порта.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**В. Как я могу отправить обратную связь?**

A. Оставьте отзыв, разместив запись на GitHub по адресу https://aka.ms/serialconsolefeedback. Вы также можете (менее предпочтительно) отправить отзыв по адресу azserialhelp@microsoft.com или в категории виртуальной машины на сайте https://feedback.azure.com.

**В. Копия/вставка последовательной консоли?**

A. Да. Используйте **Ctrl**+**Shift**+**C** и **Ctrl**+**Shift**+**V,** чтобы скопировать и вставить в терминал.

**В. Кто может включить или отключить серийную консоль для моей подписки?**

A. Чтобы включить или отключить последовательную консоль на уровне подписки, у вас должно быть разрешение на запись в этой подписке. Разрешение на запись есть у ролей администратора и владельца. У пользовательских ролей также может быть разрешение на запись.

**В. Кто может получить доступ к серийной консоли для моего VM?**

A. Для доступа к последовательной консоли виртуальной машины необходимо иметь роль участника виртуальной машины или выше.

**В. Моя серийная консоль ничего не показывает, что мне делать?**

A. Возможно, ваш образ неправильно настроен для доступа к последовательной консоли. Дополнительные сведения о настройке образа для включения последовательной консоли см. в разделе [Включение последовательной консоли в пользовательских или старых образах](#enable-the-serial-console-in-custom-or-older-images).

**В. Доступна ли серийная консоль для виртуальных наборов масштабов машин?**

A. Да! Посмотреть [серийную консоль для виртуальных наборов шкалы машин](./serial-console-overview.md#serial-console-for-virtual-machine-scale-sets)

## <a name="next-steps"></a>Дальнейшие действия
* Подробное руководство по командам CMD и PowerShell, которые можно использовать в Windows SAC, см. в статье [Команды Windows — CMD и PowerShell](serial-console-cmd-ps-commands.md).
* Последовательная консоль также доступна для виртуальных машин [Linux](serial-console-linux.md).
* Подробнее о [диагностике ботинок.](boot-diagnostics.md)
