---
title: Серийная консоль Azure для Linux (ru) Документы Майкрософт
description: Двухнаправленная серийная консоль для виртуальных машин Azure и виртуальных наборов масштабов машин.
services: virtual-machines-linux
documentationcenter: ''
author: asinn826
manager: borisb
editor: ''
tags: azure-resource-manager
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 5/1/2019
ms.author: alsin
ms.openlocfilehash: b1f7708c9bd213e201ba4eb8837a191dca68ca9e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77167013"
---
# <a name="azure-serial-console-for-linux"></a>Последовательная консоль Azure для Linux

Система Ная на портале Azure обеспечивает доступ к текстовой консоли для виртуальных машин Linux (VM) и виртуальных экземпляров масштабов машин. Это серийное соединение подключается к серийному порту ttys0 VM или виртуальному набору машин, обеспечивая доступ к нему независимо от состояния сети или операционной системы. К серийной консоли можно получить доступ только с помощью портала Azure и допускаются только те пользователи, которые имеют роль участника доступа или выше к набору VM или виртуальной машины.

Серийная консоль работает таким же образом для виртуальных и виртуальных машин масштаба набора экземпляров. В этом документе все упоминания в Виртуальные мва неявно включают экземпляры набора виртуальной шкалы машин, если не указано иное.

Для документации serial Console [Serial Console for Windows](../windows/serial-console.md)для Windows см.

> [!NOTE]
> Серийная консоль обычно доступна в глобальных регионах Azure и в публичном предварительном просмотре в правительстве Azure. Он пока не доступен в облаке Azure China.


## <a name="prerequisites"></a>Предварительные требования

- В вашем экземпляре набора VM или виртуальной шкалы машин должен использоваться модель развертывания ресурсов. Классические развертывания не поддерживаются.

- Ваша учетная запись, используюая серийную консоль, должна иметь [роль вкладчика виртуальной машины](../../role-based-access-control/built-in-roles.md#virtual-machine-contributor) для VM и учетную запись [хранения диагностики ботинок](boot-diagnostics.md)

- В вашем экземпляре набора VM или виртуальной машины должен быть пользователь на основе паролей. Вы можете создать ее с функцией [сброса пароля](https://docs.microsoft.com/azure/virtual-machines/extensions/vmaccess#reset-password) расширения для доступа к виртуальной машине. В разделе **Поддержка и устранение неполадок** выберите **Сбросить пароль**.

- В вашем экземпляре набора VM или виртуальной машины должна быть [включена диагностика ботинок.](boot-diagnostics.md)

    ![Параметры диагностики загрузки](./media/virtual-machines-serial-console/virtual-machine-serial-console-diagnostics-settings.png)

- Сведения о параметрах, относящихся к дистрибутивам Linux, см. в разделе [Доступность дистрибутива Linux для последовательной консоли](#serial-console-linux-distribution-availability).

- Ваш vM или виртуальный набор набора машины набор `ttys0`должен быть настроен для серийного вывода на. Это значение для изображений Azure по умолчанию, но вы хотите, чтобы дважды проверить это на пользовательских изображений. Подробности [ниже](#custom-linux-images).


> [!NOTE]
> Для последовательной консоли требуется локальный пользователь с настроенным паролем. Виртуальные технологии или наборы виртуальной шкалы машин, настроенные только с помощью общедоступного ключа SSH, не смогут войти в серийную консоль. Чтобы создать локального пользователя с паролем, используйте [расширение доступа к виртуальной машине](https://docs.microsoft.com/azure/virtual-machines/linux/using-vmaccess-extension), доступное на портале Azure при выборе **Сброс пароля**.
> Кроме того, вы можете сбросить пароль администратора в своей учетной записи, [используя GRUB, чтобы загрузить однопользовательский режим](./serial-console-grub-single-user-mode.md).

## <a name="serial-console-linux-distribution-availability"></a>Доступность дистрибуции серийных консолей Linux
Для правильной работы последовательной консоли гостевая операционная система должна быть настроена для чтения и записи сообщений консоли в последовательный порт. Большинство [одобренных дистрибутивов Azure Linux](https://docs.microsoft.com/azure/virtual-machines/linux/endorsed-distros) имеют серийную консоль, настроенную по умолчанию. Чтобы получить доступ к последовательной консоли, в разделе **Поддержка и устранение неполадок** выберите **Последовательная консоль**.

> [!NOTE]
> Если в последовательной консоли ничего не отображается, убедитесь, что на виртуальной машине включена диагностика загрузки. Нажатие **Enter** часто исправляет проблемы, когда ничего не отображается в серийной консоли.

Distribution      | Доступ к последовательной консоли
:-----------|:---------------------
Red Hat Enterprise Linux    | Доступ к последовательной консоли включен по умолчанию.
CentOS      | Доступ к последовательной консоли включен по умолчанию.
Debian      | Доступ к последовательной консоли включен по умолчанию.
Ubuntu      | Доступ к последовательной консоли включен по умолчанию.
CoreOS      | Доступ к последовательной консоли включен по умолчанию.
SUSE        | В новых образах SLES, доступных в Azure, доступ к последовательной консоли включен по умолчанию. Чтобы включить последовательную консоль при использовании более старых версий (10 или более ранних) SLES в Azure, ознакомьтесь со [статьей базы знаний](https://www.novell.com/support/kb/doc.php?id=3456486).
Oracle Linux        | Доступ к последовательной консоли включен по умолчанию.

### <a name="custom-linux-images"></a>Пользовательские образы Linux
Чтобы включить последовательную консоль для настраиваемого образа виртуальной машины Linux, включите доступ к консоли в файле */etc/inittab* для запуска терминала на `ttyS0`. Например: `S0:12345:respawn:/sbin/agetty -L 115200 console vt102`. Возможно, вам также придется породить гетти на ttyS0. Это может быть `systemctl start serial-getty@ttyS0.service`сделано с .

Вы также хотите добавить ttys0 в качестве места назначения для серийного вывода. Для получения дополнительной информации о настройке пользовательского изображения для работы с серийной консолью ознакомьтесь с общими требованиями системы в [Create и загрузите Linux VHD в Azure.](https://aka.ms/createuploadvhd#general-linux-system-requirements)

Если вы создаете настраиваемое ядро, советуем включить флаги `CONFIG_SERIAL_8250=y` и `CONFIG_MAGIC_SYSRQ_SERIAL=y`. Файл конфигурации обычно находится в пути */boot/*.

## <a name="common-scenarios-for-accessing-the-serial-console"></a>Общие сценарии доступа к последовательной консоли

Сценарий          | Действия в серийной консоли
:------------------|:-----------------------------------------
Сломанный файл *FSTAB* | Нажмите клавишу **ВВОД**, чтобы продолжить, и исправьте *FSTAB*-файл с помощью текстового редактора. Для этого вам может потребоваться перейти в однопользовательский режим. Для получения дополнительной информации см. раздел серийной консоли [Как устранить проблемы fstab](https://support.microsoft.com/help/3206699/azure-linux-vm-cannot-start-because-of-fstab-errors) и [использовать серийную консоль для доступа к GRUB и единому пользовательскому режиму.](serial-console-grub-single-user-mode.md)
Неверные правила брандмауэра |  Если вы настроили iptables для блокировки SSH-соединения, вы можете использовать серийную консоль для взаимодействия с VM без необходимости SSH. Более подробную информацию можно найти на [странице человека iptables](https://linux.die.net/man/8/iptables).<br>Аналогичным образом, если брандмауэр блокирует доступ SSH, вы можете получить доступ к VM через серийную консоль и перенастроить брандмауэр. Более подробную информацию можно найти в [документации брандмауэра](https://firewalld.org/documentation/).
Проверка файловой системы на случай повреждения | Пожалуйста, посмотрите, что серийный раздел консоли [Azure Linux VM не может начаться из-за ошибок файловой системы](https://support.microsoft.com/en-us/help/3213321/linux-recovery-cannot-ssh-to-linux-vm-due-to-file-system-errors-fsck) для получения более подробной информации о устранении неполадок поврежденных файлововых систем с помощью серийной консоли.
Проблемы конфигурации SSH | Откройте последовательную консоль и измените параметры. Серийная консоль может использоваться независимо от конфигурации SSH VM, поскольку она не требует, чтобы VM мог иметь подключение к сети для работы. Руководство по устранению неполадок доступно при [подключении Troubleshoot SSH к Linux VM Azure, которое выходит из строя, выходит или отказано.](https://docs.microsoft.com/azure/virtual-machines/troubleshooting/troubleshoot-ssh-connection) Более подробная информация доступна на [подробных шагах sSH по устранению неполадок для проблем, связанных с Linux VM в Azure](./detailed-troubleshoot-ssh-connection.md)
Взаимодействие с загрузчиком | Перезапустите виртуальную машину из колонки последовательной консоли для доступа к GRUB на виртуальной машине Linux. Для получения более подробной информации и информации о дистро-специфической информации [см.](serial-console-grub-single-user-mode.md)

## <a name="disable-the-serial-console"></a>Отключить серийную консоль

По умолчанию все подписки имеют серийный доступ к консоли. Вы можете отключить серийную консоль на уровне подписки или vM/виртуальном уровне шкалы машины. Для получения подробных инструкций посетите [Enable и отключите серийную консоль Azure.](./serial-console-enable-disable.md)

## <a name="serial-console-security"></a>Безопасность последовательной консоли

### <a name="access-security"></a>Безопасность доступа
Доступ к последовательной консоли ограничен пользователями, которые имеют [роли с доступом участника виртуальной машины](../../role-based-access-control/built-in-roles.md#virtual-machine-contributor) или выше. Если клиент Azure Active Directory требует многофакторной проверки подлинности (MFA), то для доступа к последовательной консоли также понадобится MFA, так как доступ к последовательной консоли предоставляется через [портал Azure](https://portal.azure.com).

### <a name="channel-security"></a>Безопасность канала
Все данные, исходящие и поступающие, при пересылке по сети зашифрованы.

### <a name="audit-logs"></a>Журналы аудита
Все сведения о доступе к последовательной консоли записываются в журналы [диагностики загрузки](https://docs.microsoft.com/azure/virtual-machines/linux/boot-diagnostics) на виртуальной машине. Права доступа к этим журналам и на работу с ними принадлежат администратору виртуальной машины Azure.

> [!CAUTION]
> Пароли доступа для консоли не записываются. Тем не менее если команды, выполняемые в консоли, содержат или выводят пароли, секреты, имена пользователей или другие персональные данные в любой форме, они будут записываться в журналы диагностики загрузки виртуальной машины. Персональные данные будут записываться вместе с другим видимым текстом как часть реализации функции обратной прокрутки последовательной консоли. Эти журналы являются циклическими. Только пользователи с разрешениями на чтение в учетной записи хранения диагностики имеют к ним доступ. Если вы вводите какие-либо команды dataor, содержащие секреты или PII, мы рекомендуем использовать SSH, если не будет абсолютно необходима серийная консоль.

### <a name="concurrent-usage"></a>Одновременное использование
Когда один пользователь подключен к последовательной консоли, а другой успешно запрашивает доступ к этой же виртуальной машине, первый пользователь будет отключен, а второй — подключен к тому же сеансу.

> [!CAUTION]
> Это означает, что пользователь, который отключен, не будет зарегистрирован. Возможность принудительного выхода при отключении (с помощью SIGHUP или аналогичного механизма) все еще находится на дорожной карте. Для Windows включено автоматическое истечение времени ожидания в специальной административной консоли, а для Linux можно настроить параметр времени ожидания терминала. Чтобы сделать это, добавьте `export TMOUT=600` в файл *.bash_profile* или *.profile* для пользователя, которого вы используете для входа в консоль. При использовании этого параметра время действия сеанса истечет через 10 минут.

## <a name="accessibility"></a>Специальные возможности
Доступность является ключевым направлением для серийной консоли Azure. Для этого мы убедились, что последовательная консоль полностью доступна.

### <a name="keyboard-navigation"></a>Навигация с помощью клавиатуры
Используйте клавишу **TAB** на клавиатуре для навигации по интерфейсу последовательной консоли на портале Azure. Ваше местоположение будет выделено на экране. Чтобы оставить фокус окона серийной консоли, нажмите **Ctrl**+**F6** на клавиатуре.

### <a name="use-serial-console-with-a-screen-reader"></a>Используйте серийную консоль с считывателем экрана
Последовательная консоль имеет встроенную поддержку чтения экрана. Навигация с помощью включенного средства чтения экрана дает возможность чтения текста вслух с помощью выбранной кнопки.

## <a name="known-issues"></a>Известные проблемы
Мы знаем о некоторых проблемах с серийной консолью и операционной системой VM. Вот список этих проблем и шаги для смягчения для Linux VMs. Эти проблемы и смягчения применяются как для виртуальных вс-чатов, так и для виртуальных экземпляров, установленных шкалой машин. Если они не совпадают с ошибкой, которую вы видите, обратитесь к общим ошибкам службы серий консолей при [общих ошибках последовательной консоли.](./serial-console-errors.md)

Проблема                           |   Меры по снижению риска
:---------------------------------|:--------------------------------------------|
Нажатие клавиши **ВВОД** после заголовка соединения не вызывает появления запроса на вход в систему. | GRUB может быть настроен неправильно. Выполнить следующие `grub2-mkconfig -o /etc/grub2-efi.cfg` команды: `grub2-mkconfig -o /etc/grub2.cfg`and/or . Дополнительные сведения см. в статье [Нажатие клавиши ВВОД не приводит ни к каким результатам](https://github.com/Microsoft/azserialconsole/blob/master/Known_Issues/Hitting_enter_does_nothing.md). Эта проблема может возникнуть, если вы работаете пользовательский VM, закаленный прибор, или GRUB конфигурации, что приводит к Linux не в состоянии подключиться к серийному порту.
Текст последовательной консоли только занимает часть размера экрана (часто после использования текстового редактора). | Последовательные консоли не поддерживают согласование с размером окна ([RFC 1073](https://www.ietf.org/rfc/rfc1073.txt)). Это означает, что сигнал обновления размера экрана SIGWINCH не отправляется и виртуальная машина не может определить размер окна терминала. Установите xterm или другую подобную служебную программу, содержащую команду `resize`, а затем выполните команду `resize`.
Вставка длинных строк не работает. | Последовательная консоль ограничивает длину строк, которые можно вставить в окно терминала, до 2048 знаков, чтобы избежать перегрузки пропускной способности серийного порта.
Неустойчивый ввод клавиатуры в изображениях SLES BYOS. Ввод клавиатуры только спорадически признается. | Это проблема с пакетом Plymouth. Plymouth не должен работать в Azure, так как вам не нужен экран всплеска, а Плимут мешает платформе использовать Serial Console. Удалить Плимут `sudo zypper remove plymouth` с, а затем перезагрузить. Кроме того, измените линию ядра конфигурации `plymouth.enable=0` GRUB, приложив к концу строки. Вы можете сделать это путем [редактирования загрузки вступления во время загрузки](https://aka.ms/serialconsolegrub#single-user-mode-in-suse-sles), или путем редактирования GRUB_CMDLINE_LINUX линии в, `/etc/default/grub`восстановление GRUB с `grub2-mkconfig -o /boot/grub2/grub.cfg`, а затем перезагрузки.


## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**В. Как я могу отправить обратную связь?**

A. Оставьте отзыв, разместив запись на GitHub по адресу https://aka.ms/serialconsolefeedback. Вы также можете (менее предпочтительно) отправить отзыв по адресу azserialhelp@microsoft.com или в категории виртуальной машины на сайте https://feedback.azure.com.

**В. Копия/вставка последовательной консоли?**

A. Да. Используйте **Ctrl**+**Shift**+**C** и **Ctrl**+**Shift**+**V,** чтобы скопировать и вставить в терминал.

**В. Могу ли я использовать серийную консоль вместо соединения SSH?**

A. Хотя это может показаться технически возможным, последовательная консоль предназначена для использования в качестве средства устранения неполадок в случаях, когда подключение по протоколу SSH не возможно. Мы не рекомендуем использовать последовательную консоль в качестве замещения SSH по таким причинам:

- Последовательная консоль не имеет такую пропускную способность, как SSH. Это текстовое соединение, поэтому в последовательной консоли сложнее взаимодействовать с графическим интерфейсом пользователя (GUI).
- Доступ к последовательной консоли в данный момент можно получить только с помощью имени пользователя и пароля. Ключи SSH более безопасны, чем комбинации имени пользователя и пароля, поэтому с точки зрения безопасности входа рекомендуется запускать SSH через последовательную консоль.

**В. Кто может включить или отключить серийную консоль для моей подписки?**

A. Чтобы включить или отключить последовательную консоль на уровне подписки, у вас должно быть разрешение на запись в этой подписке. Разрешение на запись есть у ролей администратора и владельца. У пользовательских ролей также может быть разрешение на запись.

**В. Кто может получить доступ к серийной консоли для моего набора VM/virtual machine?**

A. Вы должны иметь роль virtual Machine Contributor или выше для VM или виртуальной шкалы машины набор для доступа к серийной консоли.

**В. Моя серийная консоль ничего не показывает, что мне делать?**

A. Возможно, ваш образ неправильно настроен для доступа к последовательной консоли. Дополнительные сведения о настройке образа для включения последовательной консоли см. в разделе [Доступность дистрибутива Linux для последовательной консоли](#serial-console-linux-distribution-availability).

**В. Доступна ли серийная консоль для виртуальных наборов масштабов машин?**

A. Да! Посмотреть [серийную консоль для виртуальных наборов шкалы машин](serial-console-overview.md#serial-console-for-virtual-machine-scale-sets)

**В. Если я настроил амортизацию VM или виртуальную машину, установленную с помощью только проверки подлинности ключа SSH, могу ли я использовать серийную консоль для подключения к примеру набора VM/virtual machine?**

A. Да. Так как для последовательной консоли не требуются ключи SSH, все, что вам нужно, — это настроить имя пользователя и пароль. Это можно сделать, выбрав **Сброс пароля** на портале Azure и используя эти учетные данные для входа в последовательную консоль.

## <a name="next-steps"></a>Дальнейшие действия
* Используйте последовательную консоль для [доступа к GRUB и однопользовательскому режиму](serial-console-grub-single-user-mode.md).
* Используйте последовательную консоль для [вызовов SysRq и NMI](serial-console-nmi-sysrq.md).
* Узнайте, как использовать серийную консоль для [включения GRUB в различные дистрибутивы](serial-console-grub-proactive-configuration.md)
* Серийная консоль также доступна для [Windows VMs](../windows/serial-console.md).
* Подробнее о [диагностике ботинок.](boot-diagnostics.md)

