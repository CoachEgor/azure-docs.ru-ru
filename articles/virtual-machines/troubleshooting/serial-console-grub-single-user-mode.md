---
title: Серийная консоль Azure для GRUB и однопользовательского режима Документы Майкрософт
description: В этой статье описывается, как использовать serial Console для GRUB в виртуальных машинах Azure.
services: virtual-machines-linux
documentationcenter: ''
author: asinn826
manager: gwallace
editor: ''
tags: azure-resource-manager
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 08/06/2019
ms.author: alsin
ms.openlocfilehash: 06cb3fe5d551ddfc95fcbd37cd9620adebd825c5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "70883928"
---
# <a name="use-serial-console-to-access-grub-and-single-user-mode"></a>Используйте серийную консоль для доступа к GRUB и однопользовательскому режиму
GRand Unified Bootloader (GRUB), вероятно, первое, что вы видите при загрузке виртуальной машины (VM). Поскольку GRUB отображается до запуска операционной системы, GRUB недоступен через SSH. В GRUB можно изменить конфигурацию загрузки для загрузки в однопользовательском режиме, среди прочего.

Однопользовательский режим представляет собой минимальную среду с минимальной функциональностью. Он может быть полезен для изучения проблем с загрузкой, проблем файловой системы или сетевых проблем. Меньшее количество служб может работать в фоновом режиме, и, в зависимости от уровня выполнения, файловая система может даже не быть установлена автоматически.

Однопользовательский режим также полезен в ситуациях, когда ваш VM может быть настроен для приема только sSH-ключей для вхождения в систему. В этом случае можно использовать однопользовательский режим для создания учетной записи с проверкой подлинности паролей. 

> [!NOTE]
> Служба Serial Console позволяет только пользователям с уровнем *вклада* или более высокими разрешениями получить доступ к серийной консоли VM.

Чтобы войти в однопользовательский режим, введите GRUB при загрузке ВМ и измените конфигурацию загрузки в GRUB. Подробные инструкции по вводу GRUB смотрите в следующем разделе. Как правило, если ваш VM был настроен для отображения GRUB, вы можете использовать кнопку перезагрузки в серийной консоли вашего VM для перезапуска VM и отображения GRUB.

![Кнопка перезагрузки последовательной консоли Linux](./media/virtual-machines-serial-console/virtual-machine-serial-console-restart-button-bar.png)

## <a name="general-grub-access"></a>Общий доступ к GRUB
Чтобы получить доступ к GRUB, перезагрузите VM, пока панель serial Console открыта. Некоторые дистрибутивы требуют ввода клавиатуры для отображаемого GRUB, а другие автоматически показывают GRUB в течение нескольких секунд, чтобы пользователь клавиатура ввода, чтобы отменить тайм-аут.

Чтобы иметь доступ к режиму с одним пользователем, необходимо обеспечить включение GRUB на вашем VM. В зависимости от дистрибутива может потребоваться определенная работа по настройке, чтобы обеспечить включение GRUB. Для получения информации о дистрибуции можно ознакомиться в следующем разделе и нашей поддержке Linux на странице [Azure.](https://blogs.msdn.microsoft.com/linuxonazure/2018/10/23/why-proactively-ensuring-you-have-access-to-grub-and-sysrq-in-your-linux-vm-could-save-you-lots-of-down-time/)

### <a name="restart-your-vm-to-access-grub-in-serial-console"></a>Перезагрузка виртуальной машины для доступа к GRUB в последовательной консоли
Вы можете перезапустить VM в серийной консоли, зависая над кнопкой **перезагрузки,** а затем выбрав **перезагрузить VM.** Уведомление о перезагрузке отображается в нижней части панели.

Вы также можете перезапустить VM, запустив команду SysRq "b", если [включен SysRq.](./serial-console-nmi-sysrq.md) Чтобы узнать, чего ожидать от GRUB при перезагрузке, смотрите инструкции по распределению в следующих разделах.

![Перезапуск серийной консоли Linux](./media/virtual-machines-serial-console/virtual-machine-serial-console-restart-button-ubuntu.gif)

## <a name="general-single-user-mode-access"></a>Общий доступ в однопользовательский режим
Вам может понадобиться ручной доступ к режиму с одним пользователем, когда вы не настроили учетную запись с проверкой подлинности пароля. Измените конфигурацию GRUB для ручного ввода однопользовательского режима. После этого см. раздел "Использование однопользовательского режима для сбросить или добавить пароль" для дальнейших инструкций.

Если VM не может загрузиться, дистрибутивы часто автоматически переходят в однопользовательский или аварийный режим. Другие дистрибутивы, однако, требуют дополнительной настройки, такие как настройка корневого пароля, прежде чем они могут автоматически высадить вас в однопользовательском или аварийном режиме.

### <a name="use-single-user-mode-to-reset-or-add-a-password"></a>Используйте однопользовательский режим для сбросить или добавить пароль
После того, как вы находитесь в режиме с одним пользователем, добавьте нового пользователя с привилегиями sudo, сделав следующее:
1. Выполнить, `useradd <username>` чтобы добавить пользователя.
1. Запуск, `sudo usermod -a -G sudo <username>` чтобы предоставить новые привилегии корней пользователя.
1. Используйте `passwd <username>`, чтобы задать пароль для нового пользователя. Затем вы можете войти в систему в качестве нового пользователя.


## <a name="access-for-red-hat-enterprise-linux-rhel"></a>Доступ в Red Hat Enterprise Linux (RHEL)
Если RHEL не может нормально загрузиться, он автоматически перебрасывает вас в однопользовательский режим. Однако, если вы не создали корневой доступ для однопользовательского режима, у вас нет корневого пароля и вы не можете войти в систему. Существует обходной путь (см. "Ручно введите однопользовательский режим в разделе RHEL"), но мы предлагаем настроить корневой доступ на начальном этапе.

### <a name="grub-access-in-rhel"></a>Доступ к GRUB в RHEL
В RHEL GRUB всегда включается по умолчанию. Чтобы войти в GRUB, перезагрузите VM, запустив, `sudo reboot`а затем нажмите любой ключ. Панель GRUB должна отображаться. Если это не так, убедитесь, что следующие строки присутствуют в вашем файле GRUB ():`/etc/default/grub`

**Для RHEL 8**

```
GRUB_TIMEOUT=5
GRUB_TERMINAL="serial console"
GRUB_CMDLINE_LINUX="console=tty1 console=ttyS0 earlyprintk=ttyS0 rootdelay=300"
```

**Для RHEL 7**

```
GRUB_TIMEOUT=5
GRUB_TERMINAL_OUTPUT="serial console"
GRUB_CMDLINE_LINUX="console=tty1 console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300 net.ifnames=0"
```

> [!NOTE]
> Red Hat также предоставляет документацию для загрузки в режим спасения, режим экстренной помощи или режима оттачки, а также для сброса корневого пароля. Для получения инструкций смотрите [редактирование меню терминала во время загрузки.](https://aka.ms/rhel7grubterminal)

### <a name="set-up-root-access-for-single-user-mode-in-rhel"></a>Настройка корневого доступа для однопользовательского режима в RHEL
Корневой пользователь отключен по умолчанию. Однопользовательский режим в RHEL требует включения корневого пользователя. Если вам нужно включить режим для одного пользователя, используйте следующие инструкции:

1. Войти на систему Red Hat через SSH.
1. Переключитесь на корень.
1. Включите пароль для корневого пользователя, сделав следующее:
    * Выполнить `passwd root` (установить сильный корневой пароль).
1. Убедитесь, что корневой пользователь может войти только через ttyS0, делая следующее:  
    а. Выполнить, `edit /etc/ssh/sshd_config`и убедитесь, что `no`PermitRootLogIn установлен на .  
    b. Выполнить, `edit /etc/securetty file` чтобы позволить войти в систему только через ttyS0.

Теперь, если система загружается в однопользовательский режим, вы можете войти в систему с корневым паролем.

Кроме того, для RHEL 7.4 или 6.9 ", чтобы включить однопользовательский режим в запросах GRUB, [см. Загрузка в однопользовательском режиме.](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/installation_guide/s1-rescuemode-booting-single)

### <a name="manually-enter-single-user-mode-in-rhel"></a>Вручную введите однопользовательский режим в RHEL
Если вы настроили GRUB и корневый доступ с помощью предыдущих инструкций, вы можете войти в режим с одним пользователем, сделав следующее:

1. Чтобы войти в GRUB, нажмите Esc при перезапуске VM.
1. В GRUB нажмите E, чтобы отсеить ОС, в которую вы хотите загрузиться. ОС, как правило, перечислены на первой строке.
1. Найдите линию ядра. В Azure, она начинается с *linux16*.
1. Нажмите ctrl-E, чтобы перейти к концу линии.
1. В конце строки добавьте *systemd.unit-rescue.target*.
    
    Это действие загружает вас в однопользовательский режим. Если вы хотите использовать режим экстренной помощи, добавьте *systemd.unit-emergency.target* к концу линии (вместо *systemd.unit-rescue.target).*

1. Нажмите на Ctrl-X, чтобы выйти и перезагрузить с прикладными настройками.

   Вам будет предложено пароль администратора, прежде чем вы сможете ввести однопользовательский режим. Этот пароль создан в предыдущих инструкциях.

    ![](../media/virtual-machines-serial-console/virtual-machine-linux-serial-console-rhel-enter-emergency-shell.gif)

### <a name="enter-single-user-mode-without-root-account-enabled-in-rhel"></a>Введите однопользовательский режим без включенной корневой учетной записи в RHEL
Если вы не включите корневого пользователя, следуя более ранним инструкциям, вы все равно можете сбросить корневой пароль, сделав следующее:

> [!NOTE]
> Если вы используете SELinux, при сбросить корневой пароль, не забудьте следовать дополнительным шагам, описанным в [документации Red Hat.](https://aka.ms/rhel7grubterminal)

1. Чтобы войти в GRUB, нажмите Esc при перезапуске VM.

1. В GRUB нажмите E, чтобы отсеить ОС, в которую вы хотите загрузиться. ОС, как правило, перечислены на первой строке.
1. Найдите линию ядра. В Azure, она начинается с *linux16*.
1. В конце строки добавьте *rd.break* в конце линии. Оставьте пространство между линией ядра и *rd.break*.

    Это действие прерывает процесс загрузки `initramfs` до `systemd`того, как управление передается из, как описано в [документации Red Hat.](https://aka.ms/rhel7rootpassword)
1. Нажмите на Ctrl-X, чтобы выйти и перезагрузить с прикладными настройками.

   После перезагрузки вы попадаете в режим экстренной помощи с помощью файловой системы только для чтения. 
   
1. В оболочке `mount -o remount,rw /sysroot` введите, чтобы восстановить корневую файловую систему с разрешениями на чтение/запись.
1. После загрузки в однопользовательский `chroot /sysroot` режим введите, чтобы переключиться в тюрьму. `sysroot`
1. Теперь ты в корне. Вы можете сбросить корневой пароль, введя, `passwd` а затем использовать предыдущие инструкции для входа в однопользовательском режиме. 
1. После того как вы `reboot -f` закончите, введите для перезагрузки.

![](../media/virtual-machines-serial-console/virtual-machine-linux-serial-console-rhel-emergency-mount-no-root.gif)

> [!NOTE]
> Запуск через предыдущие инструкции падает вас в аварийной оболочки, `fstab`так что вы также можете выполнять такие задачи, как редактирование. Тем не менее, мы обычно предлагаем сбросить корневой пароль и использовать его для входа в однопользовательский режим.

## <a name="access-for-centos"></a>Доступ для CentOS
Как и Red Hat Enterprise Linux, однопользовательский режим в CentOS требует включения GRUB и корневого пользователя.

### <a name="grub-access-in-centos"></a>Доступ к GRUB в CentOS
В CentOS GRUB всегда включается по умолчанию. Чтобы войти в GRUB, перезагрузите VM, введя, `sudo reboot`а затем нажмите любой ключ. Это действие отображает панель GRUB.

### <a name="single-user-mode-in-centos"></a>Однопользовательский режим в CentOS
Чтобы включить однопользовательский режим в CentOS, следуйте более ранним инструкциям для RHEL.

## <a name="access-for-ubuntu"></a>Доступ для Ubuntu
Изображения Ubuntu не требуют корневого пароля. Если система загружается в однопользовательский режим, вы можете использовать ее без дополнительных учетных данных.

### <a name="grub-access-in-ubuntu"></a>Доступ к GRUB в Ubuntu
Чтобы получить доступ к GRUB, нажмите и удерживайте Esc во время загрузки VM.

По умолчанию изображения Ubuntu могут автоматически не отображать панель GRUB. Вы можете изменить настройку, сделав следующее:
1. В текстовом редакторе откройте *файл /etc/default/grub.d/50-cloudimg-settings.cfg.*

1. Измените `GRUB_TIMEOUT` значение на ненулевое значение.
1. В текстовом редакторе, открыть */etc /etc/default/grub*.
1. Комментарий из `GRUB_HIDDEN_TIMEOUT=1` строки.
1. Убедитесь, что `GRUB_TIMEOUT_STYLE=menu` есть линия.
1. Выполните `sudo update-grub`.

### <a name="single-user-mode-in-ubuntu"></a>Однопользовательский режим в Ubuntu
Если Ubuntu не может нормально загрузиться, он автоматически перебрасывает вас в однопользовательский режим. Для ввода однопользовательского режима вручную сделайте следующее:

1. В GRUB нажмите E, чтобы отсеять запись ботинка (запись Ubuntu).
1. Ищите линию, которая начинается с *linux*, а затем искать *ro*.
1. Добавить *один* после *ro*, обеспечение есть место до и после *одного*.
1. Нажмите на Ctrl-X, чтобы перезагрузиться с этими настройками и ввести однопользовательский режим.

### <a name="use-grub-to-invoke-bash-in-ubuntu"></a>Используйте GRUB для вызывать Баш в Ubuntu
После того как вы попробовали предыдущие инструкции, может возникнуть ситуация (например, забытый корневой пароль), когда вы все еще не можете получить доступ к режиму с одним пользователем в вашем Ubuntu VM. Вы также можете сказать ядро `/bin/bash` для запуска в качестве init, а не системы init. Это действие дает вам оболочку Bash и позволяет для обслуживания системы. Для этого сделайте следующее:

1. В GRUB нажмите E, чтобы отсеять запись ботинка (запись Ubuntu).

1. Ищите линию, которая начинается с *linux*, а затем искать *ro*.
1. Заменить *ro* с *rw init'/bin/bash*.

    Это действие устанавливает вашу файловую систему `/bin/bash` как чтение и использует в качестве процесса иначины.
1. Нажмите на Ctrl'X, чтобы перезагрузиться с этими настройками.

## <a name="access-for-coreos"></a>Доступ для CoreOS
Однопользовательский режим в CoreOS требует включения GRUB.

### <a name="grub-access-in-coreos"></a>Доступ к GRUB в CoreOS
Чтобы получить доступ к GRUB, нажмите любой ключ во время загрузки ВМ.

### <a name="single-user-mode-in-coreos"></a>Однопользовательский режим в CoreOS
Если CoreOS не может нормально загрузиться, он автоматически перебрасывает вас в однопользовательский режим. Для ввода однопользовательского режима вручную сделайте следующее:

1. В GRUB нажмите E, чтобы отсеять запись в загрузке.

1. Ищите линию, которая начинается с *linux$*. Там должно быть два экземпляра линии, каждый инкапсулированный в различных, *если ... другое* положение.
1. Придатите *coreos.autologin'ttyS0* к концу каждой линии *linux$.*
1. Нажмите на Ctrl-X, чтобы перезагрузиться с этими настройками и ввести однопользовательский режим.

## <a name="access-for-suse-sles"></a>Доступ для SUSE SLES
Новые изображения SLES 12 SP3 позволяют получить доступ через серийную консоль, если система загружается в режим аварийной ситуации.

### <a name="grub-access-in-suse-sles"></a>Доступ к GRUB в SUSE SLES
GRUB доступ в SLES требует загрузки конфигурации через YaST. Чтобы создать конфигурацию, сделайте следующее:

1. Используйте SSH, чтобы войти в свой SLES VM, а затем запустить `sudo yast bootloader`. Нажмите Tab, нажмите Введите, а затем использовать клавиши со стрелками для навигации по меню.

1. Перейдите к **параметрам ядра,** а затем выберите **серийный флажок консоли Use.**
1. Добавьте `serial --unit=0 --speed=9600 --parity=no` к аргументам **консоли.**
1. Нажмите F10, чтобы сохранить настройки и выход.
1. Чтобы войти в GRUB, перезагрузите VM и нажмите любой ключ во время последовательности загрузки, чтобы сохранить отображение панели GRUB.

    Тайм-аут по умолчанию для GRUB составляет **1s.** Вы можете изменить эту `GRUB_TIMEOUT` настройку, изменив переменную в *файле /etc/default/gRUB.*

![Инициализация конфигурации загрузочика](../media/virtual-machines-serial-console/virtual-machine-linux-serial-console-sles-yast-grub-config.gif)

### <a name="single-user-mode-in-suse-sles"></a>Однопользовательский режим в SUSE SLES
Если SLES не может нормально загрузиться, вы автоматически попадаете в аварийную оболочку. Чтобы войти в аварийный оболочку вручную, сделайте следующее:

1. В GRUB нажмите E, чтобы отсеять запись ботинка (запись SLES).

1. Ищите линию ядра, которая начинается с *linux*.
1. Приложение *systemd.unit-emergency.target* к концу линии ядра.
1. Нажмите на Ctrl'X, чтобы перезагрузиться с этими настройками и ввести аварийную оболочку.

   > [!NOTE]
   > Это действие высаживает вас в аварийную оболочку с помощью файловой системы только для чтения. Чтобы отредотировать любые файлы, переоборуйте файловую систему с разрешениями на чтение-запись. Для этого введите `mount -o remount,rw /` в оболочку.

## <a name="access-for-oracle-linux"></a>Доступ для Oracle Linux
Как и Red Hat Enterprise Linux, однопользовательский режим в Oracle Linux требует включения GRUB и корневого пользователя.

### <a name="grub-access-in-oracle-linux"></a>Доступ к GRUB в Oracle Linux
В Oracle Linux GRUB всегда включается по умолчанию. Чтобы войти в GRUB, перезагрузите VM, запустив, `sudo reboot`а затем нажмите Esc. Это действие отображает панель GRUB. Если панель GRUB не отображается, убедитесь, что `GRUB_TERMINAL` значение строки содержит `GRUB_TERMINAL="serial console"` *серийную консоль* (т.е.). Восстановить GRUB `grub2-mkconfig -o /boot/grub/grub.cfg`с .

### <a name="single-user-mode-in-oracle-linux"></a>Однопользовательский режим в Oracle Linux
Чтобы включить однопользовательский режим в Oracle Linux, следуйте более ранним инструкциям для RHEL.

## <a name="next-steps"></a>Дальнейшие действия
Чтобы узнать больше о серийной консоли, см.:
* [Linux Серийная консоль документации](serial-console-linux.md)
* [Используйте серийную консоль для включения GRUB в различные дистрибутивы](https://blogs.msdn.microsoft.com/linuxonazure/2018/10/23/why-proactively-ensuring-you-have-access-to-grub-and-sysrq-in-your-linux-vm-could-save-you-lots-of-down-time/)
* [Используйте серийную консоль для вызовов NMI и SysRq](serial-console-nmi-sysrq.md)
* [Серийная консоль для Windows VMs](serial-console-windows.md)
* [Диагностика загрузки](boot-diagnostics.md)
