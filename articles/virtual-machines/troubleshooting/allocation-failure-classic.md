---
title: Устранение ошибок выделения виртуальной машины в Azure при использовании классической модели развертывания | Документация Майкрософт
description: Устраните ошибки выделения ресурсов при создании, перезагрузке или изменении размера классической виртуальной машины в Azure.
services: azure-service-management
documentationcenter: ''
author: genlin
manager: willchen
editor: ''
tags: top-support-issue,azure-resource-manager,azure-service-management
ms.assetid: bb939e23-77fc-4948-96f7-5037761c30e8
ms.service: virtual-machines
ms.topic: troubleshooting
ms.date: 11/01/2018
ms.author: genli
ms.openlocfilehash: 7cd7897e3a0b940bbc636b2fbc3dbbc13b7cf540
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60505569"
---
# <a name="troubleshooting-steps-specific-to-allocation-failure-scenarios-in-the-classic-deployment-model"></a>Инструкции по устранению конкретных ошибок выделения ресурсов в классической модели развертывания

Ниже описаны распространенные сценарии выделения ресурсов, которые приводят к закреплению запросов на выделение. Каждый сценарий мы более подробно рассмотрим ниже.

- Изменение размера виртуальной машины или добавление дополнительных виртуальных машин или экземпляров ролей в существующую облачную службу
- Перезапустите частично остановленные (освобожденные) виртуальные машины
- Перезапустите полностью остановленные (освобожденные) виртуальные машины
- Промежуточное и рабочее развертывания (только для "платформы как услуги")
- Территориальная группа (взаимодействие с виртуальными машинами или службами)
- Виртуальная сеть на основе территориальной группы

При возникновении ошибки выделения проверьте, не соответствует ли ваша ситуация одному из приведенных ниже сценариев. Используйте ошибку выделения, возвращенную платформой Azure, чтобы определить соответствующий сценарий. Если выполненный запрос прикреплен, попробуйте удалить некоторые ограничения этого прикрепления, чтобы распространить запрос на большее количество кластеров и тем самым повысить вероятность успешного выделения.
В общем случае, если в сообщении об ошибке не указано, что запрошенные размер виртуально машины не поддерживается, то попытку можно будет повторить немного позже. К тому моменту в кластере может освободиться достаточно ресурсов для выполнения вашего запроса. Если проблема заключается в том, что запрошенный размер виртуальной машины не поддерживается, попробуйте выбрать другой размер виртуальной машины. В противном случае единственная возможность — удалить соответствующее ограничение.

Два самых распространенных сценариев возникновения ошибок связаны с территориальными группами. Ранее территориальные группы использовались для обеспечения тесного взаимодействия виртуальными машинами и экземплярами служб либо для создания виртуальной сети. С появлением региональных виртуальных сетей территориальные группы больше не используются для создания виртуальной сети. Ввиду сокращения задержки в сети инфраструктуры Azure изменились рекомендации по использованию территориальных групп для взаимодействия с виртуальными машинами или службами.

На следующей схеме показана таксономия сценариев выделения (закрепленных) ресурсов. 

![Таксономия выделения прикрепленных ресурсов](./media/virtual-machines-common-allocation-failure/Allocation3.png)

## <a name="resize-a-vm-or-add-vms-or-role-instances-to-an-existing-cloud-service"></a>Изменение размера виртуальной машины или добавление дополнительных виртуальных машин или экземпляров ролей в существующую облачную службу
**Ошибка**

Upgrade_VMSizeNotSupported или GeneralError

**Причина прикрепления к кластеру**

Попытка выполнить запрос на изменение размера виртуальной машины или ее добавление, а также добавление экземпляра роли в существующую облачную службу должна осуществляться в исходном кластере, в котором размещена существующая облачная служба. Если создать новую облачную службу, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальных машин.

**Возможное решение**

При возникновении ошибки Upgrade_VMSizeNotSupported* попробуйте изменить размер виртуальной машины. Если использовать другой размер виртуальной машины нецелесообразно, но допускается использование другого виртуального IP-адреса, создайте облачную службу, где будет размещена новая виртуальная машина, и добавьте новую облачную службу в региональную виртуальную сеть, в которой запущены виртуальные машины. Если существующая облачная служба не использует региональную виртуальную сеть, вы по-прежнему можете создать виртуальную сеть для новой облачной службы и подключить [имеющуюся виртуальную сеть к новой](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/). См. дополнительные сведения о [региональных виртуальных сетях](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).

Если возникла ошибка GeneralError*, это означает, что кластер, скорее всего, поддерживает этот тип ресурса (например виртуальные машины определенного размера), но сейчас в нем нет свободных ресурсов. По аналогии с использованным выше сценарием попробуйте добавить необходимый вычислительный ресурс, создав облачную службу (обратите внимание, что новая облачная служба должна использовать другой виртуальный IP-адрес) и используя региональную виртуальную сеть для подключения к облачным службам.

## <a name="restart-partially-stopped-deallocated-vms"></a>Перезапустите частично остановленные (освобожденные) виртуальные машины
**Ошибка**

GeneralError*

**Причина прикрепления к кластеру**

Частичное освобождение означает, что в облачной службе будут остановлены (освобождены) одна или несколько виртуальных машин, но не все. При остановке (освобождении) виртуальной машины происходит освобождение связанных с ней ресурсов. Таким образом, перезагрузка остановленной (освобожденной) виртуальной машины предусматривает выполнение нового запроса. Перезапуск виртуальных машин в частично освобожденной облачной службе эквивалентен добавлению виртуальных машин к существующей облачной службе. Попытка выполнения запроса должна осуществляться в исходном кластере, в котором размещена существующая облачная служба. Если создать новую облачную службу, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальной машины.

**Возможное решение**

Если допускается использование различных виртуальных IP-адресов, удалите остановленные (освобожденные) виртуальные машины (но сохраните связанные диски) и добавьте виртуальные машины обратно, используя другую облачную службу. Используйте региональную виртуальную сеть для подключения к облачным службам:

* Если существующая облачная служба использует региональную виртуальную сеть, просто добавьте новую облачную службу в ту же виртуальную сеть.
* Если существующая облачная служба не использует региональную виртуальную сеть, создайте виртуальную сеть для новой облачной службы и [подключите имеющуюся виртуальную сеть к новой](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/). См. дополнительные сведения о [региональных виртуальных сетях](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).

## <a name="restart-fully-stopped-deallocated-vms"></a>Перезапустите полностью остановленные (освобожденные) виртуальные машины
**Ошибка**

GeneralError*

**Причина прикрепления к кластеру**

Полное освобождение означает, что в облачной службе остановлены (освобождены) все виртуальные машины. Попытка выполнения запроса для перезапуска этих виртуальных машин должна осуществляться в исходном кластере, в котором размещена облачная служба. Если создать новую облачную службу, платформа Azure сможет найти другой кластер, в котором есть свободные ресурсы или который поддерживает запрошенный размер виртуальных машин.

**Возможное решение**

Если допускается использование другого виртуального IP-адреса, удалите исходные остановленные (освобожденные) виртуальные машины (но сохраните связанные диски) и соответствующие облачные службы (связанные вычислительные ресурсы уже освобождены при остановке (освобождении) виртуальных машин)). Создайте облачную службу для повторного добавления виртуальных машин.

## <a name="stagingproduction-deployments-platform-as-a-service-only"></a>Промежуточное и рабочее развертывание (только для "платформы как услуги")
**Ошибка**

New_General* или New_VMSizeNotSupported\*

**Причина прикрепления к кластеру**

Промежуточное и рабочее развертывания облачной службы размещаются в одном кластере. При добавлении второго развертывания соответствующий запрос на выделение будет выполнен в том же кластере, в котором размещено первое.

**Возможное решение**

Удалите первое развертывание и исходную облачную службу и разверните облачную службу повторно. Выполнив это действие, можно разместить первое развертывание в кластере, в котором достаточно свободных ресурсов для обоих развертываний, или в кластере, который поддерживает запрошенный размер виртуальной машины.

## <a name="affinity-group-vmservice-proximity"></a>Территориальная группа (взаимодействие с виртуальными машинами или службами)
**Ошибка**

New_General* или New_VMSizeNotSupported\*

**Причина прикрепления к кластеру**

Все вычислительные ресурсы, назначенные территориальной группе, привязываются к одному кластеру. Попытки выполнения запросов на новые вычислительные ресурсы в этой территориальной группе должны осуществляться в том же кластере, в котором размещены существующие ресурсы. Это не зависит от того, создаются ли новые ресурсы на основе новой облачной службы или существующей облачной службы.

**Возможное решение**

Если территориальная группа не нужна, не используйте ее или сгруппируйте вычислительные ресурсы в нескольких территориальных группах.

## <a name="affinity-group-based-virtual-network"></a>Виртуальная сеть на основе группы сходства
**Ошибка**

New_General* или New_VMSizeNotSupported\*

**Причина прикрепления к кластеру**

Прежде чем объявить региональную виртуальную сеть, необходимо связать виртуальную сеть с территориальной группой. В результате вычислительных ресурсов, помещаются в территориальной группе связаны отношением те же ограничения, как описано в разделе «сценарий выделения: Территориальная группа (взаимодействие с виртуальными Машинами или службами)» выше. Вычислительные ресурсы будут привязаны к одному кластеру.

**Возможное решение**

Если территориальная группа не нужна, создайте региональную виртуальную сеть для новых ресурсов, которые вы собираетесь добавить, а затем [подключите имеющуюся виртуальную сеть к новой виртуальной сети](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/). См. дополнительные сведения о [региональных виртуальных сетях](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).

Кроме того, можно [перенести виртуальную сеть на основе территориальной группы в региональную виртуальную сеть](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), а затем снова добавить необходимые ресурсы.


