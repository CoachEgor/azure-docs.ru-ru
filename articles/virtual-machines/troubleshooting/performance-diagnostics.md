---
title: Диагностика производительности для виртуальных машин Azure | Документация Майкрософт
description: Эта статья содержит сведения о системе диагностики производительности Azure для Windows.
services: virtual-machines-windows'
documentationcenter: ''
author: anandhms
manager: cshepard
editor: przlplx
tags: ''
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: troubleshooting
ms.date: 9/20/2018
ms.author: anandh
ms.openlocfilehash: c0e0b5db9958fae6c9f49f636a97bf16697e74e0
ms.sourcegitcommit: 670c38d85ef97bf236b45850fd4750e3b98c8899
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/08/2019
ms.locfileid: "68854423"
---
# <a name="performance-diagnostics-for-azure-virtual-machines"></a>Диагностика производительности для виртуальных машин Azure

Средство диагностики производительности помогает устранять проблемы, связанные с производительностью, которые могут повлиять на виртуальную машину Windows или Linux. Поддерживаемые сценарии устранения неполадок включают быструю проверку на известные проблемы, анализ рекомендаций, а также проверку на наличие сложных проблем, связанных с низкой производительностью виртуальной машины, высокой нагрузкой процессора или высоким коэффициентом использования дискового пространства и памяти.

Диагностику производительности можно выполнять непосредственно на портале Azure, где также можно просмотреть аналитические сведения, отчеты различных журналов, расширенные параметры конфигурации и данные диагностики. Мы рекомендуем выполнить диагностику производительности, а также просмотреть аналитические сведения и данные диагностики, прежде чем связаться со службой поддержки Майкрософт.

> [!NOTE]
> В Windows Диагностика производительности в настоящее время поддерживается на виртуальных машинах, где установлен пакет SDK для .NET версии 4,5 или более поздней версии. Сведения по выполнению диагностики производительности на классических виртуальных машинах см. в статье [Azure Performance Diagnostics VM Extension for Windows](performance-diagnostics-vm-extension.md) (Расширение виртуальной машины диагностики производительности Azure для Windows).

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

### <a name="windows"></a>Windows

Windows 10, Windows 8, Windows 8 Корпоративная, Windows 8 Профессиональная, Windows 8.1, Windows Server 2016, Windows Server 2012, Windows Server 2012 Datacenter, Windows Server 2012 R2, Windows Server 2012 R2 Datacenter, Windows Server 2012 R2 Standard, Windows Server 2012 Standard, Windows Server 2008 R2, Windows Server 2008 R2 Datacenter, Windows Server 2008 R2 Enterprise, Windows Server 2008 R2 Foundation, Windows Server 2008 R2 SP1, Windows Server 2008 R2 Standard.

### <a name="linux"></a>Linux

Oracle Linux Server 6,10 [`*`], 7,3, 7,6, 7,5 (Oracle-Database-ee 13,8 Marketplace Image), CentOS 6,5 [`*`], 7,6, RHEL 7,2, 7,5, 8,0 [`*`], Ubuntu 14,04, 16,04, 18,04, Debian 8, 9, 10 [`*`], SLES 12 SP4 [`*`]

>[!Note]
>[`*`] См. [Известные проблемы](how-to-use-perfinsights-linux.md#known-issues)

## <a name="install-and-run-performance-diagnostics-on-your-vm"></a>Установка средства диагностики производительности и выполнение диагностики на виртуальной машине

Диагностика производительности устанавливает расширение виртуальной машины, которое запускает средство диагностики с именем PerfInsights. PerfInsights доступен как для [Windows](https://aka.ms/perfinsights) , так и для [Linux](https://aka.ms/perfinsightslinux). Чтобы установить средство диагностики производительности и запустить диагностику, выполните следующие действия:

1. В левом столбце команд выберите **Виртуальные машины**.
1. Из списка имен виртуальных машин выберите виртуальную машину, на которой нужно выполнить диагностику.
1. В правом столбце команд выберите **Диагностика производительности**.

    ![Снимок экрана портала Azure с выделенной кнопкой установки диагностики производительности](media/performance-diagnostics/performance-diagnostics-install.png)

    > [!NOTE]
    > На этом снимке экрана колонка имен виртуальных машин скрыта.
1. Выберите учетную запись хранения (необязательно).

    Если вы хотите использовать одну учетную запись хранения для хранения результатов диагностики производительности для нескольких виртуальных машин, выберите ее, нажав кнопку **Параметры** на панели инструментов. Выбрав учетную запись хранения, нажмите кнопку **ОК**.

    Если вы не укажете учетную запись хранения, новая учетная запись хранения будет создана по умолчанию.

    ![Снимок экрана колонки "Диагностика производительности" с выделенной кнопкой "Параметры" на панели инструментов](media/performance-diagnostics/settings-button.png)

    ![Снимок экрана выбора учетной записи хранения из колонки параметров диагностики производительности](media/performance-diagnostics/select-storage-account.png)

1. Нажмите кнопку **Установить диагностику производительности**.
1. Установите флажок **Выполнить диагностику**, если хотите запустить диагностику после завершения установки. После установки флажка вы сможете выбрать сценарий анализа производительности и связанные параметры.

    ![Снимок экрана кнопки установки диагностики производительности](media/performance-diagnostics/install-diagnostics-button.png)

## <a name="select-an-analysis-scenario-to-run"></a>Выбор сценария анализа для выполнения

На портале Azure доступны приведенные ниже сценарии анализа. Выберите анализ, в зависимости от возникших проблем с производительностью. Выберите параметры длительности и трассировки, необходимые для анализа.

* **Быстрый анализ производительности**  
    Проверяет наличие известных проблем, анализирует рекомендации и собирает данные диагностики. Выполнение анализа занимает несколько минут. Дополнительные сведения о [Windows](https://aka.ms/perfinsights/quick) или [Linux](https://aka.ms/perfinsightslinux/quick)

* **Анализ производительности**  
    Выполняет все проверки в быстром анализе производительности и отслеживает высокое потребление ресурсов. Используйте эту версию для устранения общих неполадок производительности, таких как высокое потребление ЦП, памяти и диска. Этот анализ может занять от 30 секунд до 15 минут в зависимости от выбранного периода времени. Дополнительные сведения о [Windows](https://aka.ms/perfinsights/vmslow) или [Linux](https://aka.ms/perfinsightslinux/vmslow)

* **Расширенный анализ производительности**`*`  
    Выполняет все проверки в анализе производительности и собирает одну или несколько трассировок, указанных в следующих разделах. Используйте этот сценарий для устранения сложных проблем, которые требуют дополнительных трассировок. Выполнение этого сценария для более длительных периодов увеличит общий размер выходных данных диагностики в зависимости от размера виртуальной машины и выбранных параметров трассировки. Выполнение этого анализа может занять от 30 секунд до 15 минут в зависимости от выбранного периода времени. [Подробнее](https://aka.ms/perfinsights/advanced)

* **Анализ файлов Azure**`*`  
    Выполняет все проверки в анализе производительности, а также записывает трассировку сети и счетчики SMB. Используйте этот сценарий для диагностики производительности файлов Azure. Выполнение этого анализа может занять от 30 секунд до 15 минут в зависимости от выбранного периода времени. [Подробнее](https://aka.ms/perfinsights/azurefiles)

>[!Note]
>[`*`] Эти сценарии анализа поддерживаются только в Windows.

![Снимок экрана области "Выполнить диагностику" в колонке "Диагностика производительности"](media/performance-diagnostics/run-diagnostics-pane.png)

### <a name="provide-symptoms-optional"></a>Указание симптомов (необязательно)

Выберите любые предустановленные симптомы из списка или добавьте новые. Это позволит нам улучшить анализ в будущем.

### <a name="provide-support-request-number-if-available-optional"></a>Указание номера запроса в службу поддержки, если он доступен (необязательно)

Если вы работаете с сотрудником службы поддержки Майкрософт над существующим запросом, укажите номер запроса в службу поддержки.

### <a name="review-the-privacy-policy-and-legal-terms-and-select-the-check-box-to-acknowledge-required"></a>Просмотр политики конфиденциальности и условий использования и установка флажка для согласия (обязательно)

Чтобы выполнить диагностику, необходимо принять условия использования и политику конфиденциальности.

### <a name="select-ok-to-run-the-diagnostics"></a>Нажатие кнопки "ОК" для выполнения диагностики

Когда начнется установка диагностики производительности, отобразится уведомление. После завершения установки отобразится уведомление об успешной установке. Затем выбранный анализ будет выполняться в соответствии с указанным периодом времени. Это подходящий момент для воспроизведения проблемы производительности. Таким образом, данные диагностики будут записаны в нужное время.

После завершения анализа в таблицы Azure и контейнер больших двоичных объектов в указанной учетной записи хранения будут переданы следующие элементы:

* все аналитические сведения и информация, связанная с выполнением;
* Сжатый ZIP-файл (с именем **PerformanceDiagnostics_yyyy-mm-dd_hh-mm-ss-FFF. zip** ) в Windows и файл tar-шара (с именем **PerformanceDiagnostics_yyyy-mm-dd_hh-mm-ss-FFF. tar. gz** ) в Linux, который содержит файлы журналов
* отчет HTML.

После отправки новый отчет о диагностике отображается на портале Azure.

![Снимок экрана со списком отчетов о диагностике в колонке диагностики производительности](media/performance-diagnostics/diagnostics-report-list.png)

## <a name="how-to-change-performance-diagnostics-settings"></a>Как изменить параметры диагностики производительности

Чтобы изменить учетную запись хранения для сохранения аналитических сведений и выходных данных диагностики, нажмите кнопку **Параметры** на панели инструментов. Одну учетную запись хранения можно использовать для нескольких виртуальных машин, для которых выполняется диагностика производительности. При изменении учетной записи хранения старые отчеты и аналитические сведения не удаляются. Однако они больше не будут отображаться в списке отчетов о диагностике.

## <a name="review-insights-and-performance-diagnostics-report"></a>Просмотр аналитических сведений и отчета о диагностике производительности

Каждое выполнение диагностики содержит список аналитических сведений и рекомендаций, пострадавшие ресурсы, файлы журналов и другие подробные сведения диагностики, а также отчет для просмотра в автономном режиме. Полный список всех собранных диагностических данных см. в разделе **какие сведения собираются с помощью PerfInsights?** в [Windows](how-to-use-perfinsights.md#what-kind-of-information-is-collected-by-perfinsights) или [Linux](how-to-use-perfinsights-linux.md#what-kind-of-information-is-collected-by-perfinsights).

### <a name="select-a-performance-diagnostics-report"></a>Выбор отчета о диагностике производительности

Список отчетов о диагностике можно использовать для поиска всех созданных отчетов. В списке содержатся данные об использованном анализе, найденные аналитические сведения и уровень влияния. Выберите строку, чтобы просмотреть дополнительные сведения.

![Снимок экрана выбора отчета о диагностике из колонки "Диагностика производительности"](media/performance-diagnostics/select-report.png)

### <a name="review-a-performance-diagnostics-report"></a>Просмотр отчета о диагностике производительности

Каждый отчет о диагностике производительности может содержать некоторые аналитические сведения и указывать на высокий, средний или низкий уровень влияния. Каждый тип аналитических сведений также содержит рекомендации по устранению проблемы. Для удобной фильтрации аналитические сведения группируются.

Уровни влияния представляют потенциальное воздействие проблемы производительности на основе таких факторов, как неправильная настройка, а также на основе известных проблем или проблем, указанных другими пользователями. Возможно, вы еще не сталкивались с одной или несколькими перечисленными проблемами. Например, файлы журналов SQL и файлы базы данных используются на одном диске данных. В таком случае есть высокая вероятность возникновения узких мест и других проблем с производительностью, если база данных интенсивно используется. В то же время вы можете не заметить проблему в случае низкой нагрузки на базу данных.

![Снимок экрана колонки обзора отчета о диагностике производительности](media/performance-diagnostics/performance-diagnostics-report-overview.png)

### <a name="reviewing-performance-diagnostics-insights-and-recommendations"></a>Просмотр аналитических сведений и рекомендаций, полученных в результате диагностики производительности

Выберите аналитические сведения, чтобы просмотреть подробную информацию о затронутых ресурсах, предлагаемые способы их устранения и ссылки для справки.

![Снимок экрана с подробными аналитическими сведениями по диагностике производительности](media/performance-diagnostics/insight-detail.png)

### <a name="download-and-review-the-full-performance-diagnostics-report"></a>Загрузка и просмотр полного отчета о диагностике производительности

Нажмите кнопку **Загрузить отчет**, чтобы загрузить HTML-отчет, в котором содержатся дополнительные подробные диагностические сведения, такие как конфигурация хранилища и сети, счетчики производительности, трассировки, список процессов и журналы. Содержимое зависит от выбранного анализа. При расширенном поиске проблем отчет может содержать дополнительную информацию и интерактивные диаграммы, которые связаны с высокой загрузкой ЦП, высоким уровнем потребления диска и процессами, чрезмерно потребляющими память. Дополнительные сведения о отчете о диагностике производительности см. в разделе [Windows](how-to-use-perfinsights.md#review-the-diagnostics-report) или [Linux](how-to-use-perfinsights-linux.md#review-the-diagnostics-report).

## <a name="manage-performance-diagnostics-reports"></a>Управление отчетами о диагностике производительности

Один или несколько отчетов о диагностике производительности можно удалить, нажав кнопку **Удалить отчет**.

## <a name="how-to-uninstall-performance-diagnostics"></a>Как удалить средство диагностики производительности

Средство диагностики производительности можно удалить с виртуальной машины. Это действие удаляет расширение виртуальной машины, но не изменяет данные диагностики в учетной записи хранения.

![Снимок экрана панели инструментов колонки "Диагностика производительности" с выделенной кнопкой "Удалить"](media/performance-diagnostics/uninstal-button.png)

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

### <a name="where-is-the-diagnostics-data-from-my-vm-stored"></a>Где хранятся диагностические данные из моей виртуальной машины

Все аналитические сведения и отчеты о диагностике производительности хранятся в собственной учетной записи хранения. Аналитические сведения хранятся в таблицах Azure. Сжатый файл отчетов хранится в контейнере больших двоичных объектов, который называется azdiagextnresults.

Сведения об учетной записи хранения можно просмотреть, нажав кнопку "Параметры" на панели инструментов.

### <a name="how-do-i-share-this-data-with-microsoft-customer-support"></a>Разделы справки поделиться этими данными с помощью службы поддержки пользователей Майкрософт

Поделиться отчетом о диагностике с корпорацией Майкрософт можно несколькими способами.

**Вариант 1.** Автоматически предоставлять общий доступ к последнему отчету  
При создании запроса в службу поддержки Майкрософт важно поделиться отчетом о диагностике производительности. Если вы решили предоставить общий доступ к этой информации корпорации Майкрософт во время выполнения диагностики (установив флажок **I agree to share diagnostics information with Microsoft** (Я соглашаюсь делиться диагностической информацией с корпорацией Майкрософт)), корпорация Майкрософт сможет получить доступ к отчету из учетной записи хранения с использованием ссылки SAS на выходной ZIP-файл в течение 30 дней после даты выполнения. Сотруднику службы поддержки будет доступен только последний отчет.

**Вариант 2.** Создание подписи общего доступа для сжатого файла отчета диагностики  
С помощью подписанного URL-адреса можно поделиться ссылкой на сжатый файл отчетов. Для этого выполните следующие действия.

1. На портале Azure перейдите к учетной записи хранения, в которой хранятся диагностические данные.
1. В разделе **Служба BLOB-объектов** выберите **BLOB-объекты**.
1. Выберите контейнер **azdiagextnresults**.
1. Выберите выходной сжатый файл диагностики производительности, которым необходимо поделиться.
1. На вкладке **Создать SAS** выберите критерии для совместного использования.
1. Щелкните **Generate blob SAS token and URL** (Создать маркер и URL-адрес SAS большого двоичного объекта).
1. Скопируйте **URL-адрес SAS большого двоичного объекта** и поделитесь им со специалистом службы поддержки.

**Вариант 3.** Скачать отчет из учетной записи хранения

Сжатый файл отчета о диагностике производительности можно найти, выполнив шаги 1–4 в варианте 2. Загрузите файл, а затем поделитесь им по электронной почте с сотрудником службы поддержки или обратитесь к сотруднику службы поддержки за инструкциями по отправке файла.  

### <a name="how-do-i-capture-the-diagnostics-data-at-the-correct-time"></a>Разделы справки записывать диагностические данные в нужное время

Каждое выполнение диагностики производительности происходит в два этапа:

1. Установка или обновление расширения виртуальной машины диагностики производительности.
1. Выполнение диагностики в соответствии с указанным периодом времени.

В настоящее время нет простого способа узнать, когда завершится установка расширения виртуальной машины. Обычно установка занимает от 45 секунд до 1 минуты. После установки расширения виртуальной машины можно выполнить шаги по воспроизведению проблемы, чтобы средство диагностики производительности записало правильный набор данных для устранения неполадок.

## <a name="next-steps"></a>Следующие шаги

Если после просмотра аналитических сведений и отчета по диагностике производительности вы все еще не можете определить причину неполадки и вам нужна дополнительная помощь, можно создать запрос в службу поддержки Майкрософт.

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и выберите **Получить поддержку**. Дополнительные сведения об использовании службы поддержки Azure см. в статье [Часто задаваемые вопросы о поддержке Microsoft Azure](https://azure.microsoft.com/support/faq/).
