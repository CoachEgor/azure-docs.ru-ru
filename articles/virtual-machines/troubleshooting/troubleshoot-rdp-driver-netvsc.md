---
title: Устранении неполадок netvsc.sys при удаленном подключении к виртуальной машине Windows 10 или Windows Server 2016 в Azure | Документация Майкрософт
description: Сведения об устранении неполадок в RDP, связанных с проблемой в netsvc.sys при подключении к виртуальной машине Windows 10 или Windows Server 2016 в Azure.
services: virtual-machines-windows
documentationCenter: ''
author: genlin
manager: dcscontentpm
editor: v-jesits
ms.service: virtual-machines-windows
ms.topic: troubleshooting
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure
ms.date: 11/19/2018
ms.author: genli
ms.openlocfilehash: 4c10a2dcd55c1605cfafe6c67cfefd9d8a3c5f9d
ms.sourcegitcommit: ca359c0c2dd7a0229f73ba11a690e3384d198f40
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2019
ms.locfileid: "71057984"
---
# <a name="cannot-connect-remotely-to-a-windows-10-or-windows-server-2016-vm-in-azure-because-of-netvscsys"></a>netvsc.sys не позволяет удаленно подключиться к виртуальной машине Windows 10 или Windows Server 2016 в Azure

В этой статье описаны действие, позволяющие устранить неполадки, связанные с невозможностью сетевого подключения к виртуальной машине Windows 10 или Windows Server 2016 Datacenter на узле Hyper-V Server 2016.

## <a name="symptoms"></a>Проблемы

Вы не можете подключиться к виртуальной машине Azure Windows 10 или Windows Server 2016 с помощью протокол удаленного рабочего стола (RDP). В [диагностике загрузки](boot-diagnostics.md) экран отображает красный крест на сетевом адаптере. Это означает, что виртуальная машина не имеет сетевого подключения после завершения загрузки операционной системы.

Обычно такая проблема возникает в Windows [сборки 14393](https://support.microsoft.com/help/4093120/) и [сборки 15063](https://support.microsoft.com/help/4015583/). Эта статья неприменима к проблемам с более поздней версией операционной системы, чем указанные выше. Чтобы проверить версию системы, откройте сеанс командной строки из [последовательной консоли доступа](serial-console-windows.md) и запустите команду **Ver**.

## <a name="cause"></a>Причина:

Эта проблема может возникать, если установлен системный файл netvsc.sys версии **10.0.14393.594** или **10.0.15063.0**. Эти версии файла netvsc.sys могут помешать системе взаимодействовать с платформой Azure.


## <a name="solution"></a>Решение

Прежде чем выполнять какие-либо действия, [сделайте моментальный снимок диска системы](../windows/snapshot-copy-managed-disk.md) затронутой виртуальной машины в качестве резервной копии. Чтобы устранить эту проблему, воспользуйтесь последовательной консолью или [восстановите виртуальную машину в автономном режиме](#repair-the-vm-offline), присоединив ее системный диск к виртуальной машине для восстановления.


### <a name="use-the-serial-console"></a>Использование последовательной консоли

Подключитесь к [последовательной консоли и откройте экземпляр PowerShell](serial-console-windows.md), затем выполните в нем следующее.

> [!NOTE]
> Если последовательную консоль не включено на виртуальной машине, перейдите к разделу [repair the VM offline](#repair-the-vm-offline)(Автономное восстановление виртуальной машины).

1. Выполните следующую команду в экземпляре PowerShell, чтобы получить версию файла (**c:\windows\system32\drivers\netvsc.sys**):

   ```
   (get-childitem "$env:systemroot\system32\drivers\netvsc.sys").VersionInfo.FileVersion
   ```

2. Скачайте соответствующее обновление на любой новый или существующий диск, который подключен к любой работающей виртуальной машине в том же регионе:

   - **10.0.14393.594**: [KB4073562 или более позднее](https://support.microsoft.com/help/4073562) обновление
   - **10.0.15063.0**: [KB4016240](https://support.microsoft.com/help/4016240) или более позднее обновление

3. Отсоедините этот вспомогательный диск от работающей виртуальной машины и присоедините его к проблемной виртуальной машине.

4. Выполните следующую команду, чтобы установить обновление на виртуальную машину:

   ```
   dism /ONLINE /add-package /packagepath:<Utility Disk Letter>:\<KB .msu or .cab>
   ```

5. Перезапустите виртуальную машину.

### <a name="repair-the-vm-offline"></a>Автономное восстановление виртуальной машины

1. [Подключите системный диск к виртуальной машине восстановления](../windows/troubleshoot-recovery-disks-portal.md).

2. Установите подключение с помощью удаленного рабочего стола к виртуальной машине, используемой для восстановления.

3. Убедитесь, что в консоли "Управление дисками" подключенный диск имеет состояние **Подключен**. Запишите или запомните букву диска, которая назначена подключенному системному диску.

4. Создайте копию папки **\Windows\System32\config** на случай, если потребуется откат изменений.

5. Запустите редактор реестра (regedit.exe) на виртуальной машине восстановления.

6. Выберите раздел **HKEY_LOCAL_MACHINE**, а затем в меню выберите **Файл** > **Загрузить куст**.

7. Перейдите к файлу SYSTEM в папке **\Windows\System32\config**.

8. Выберите **Открыть**, в качестве имени введите **BROKENSYSTEM** и разверните раздел **HKEY_LOCAL_MACHINE**. Здесь вы увидите дополнительный раздел с именем **BROKENSYSTEM**.

9. Откройте следующее расположение:

   ```
   HKLM\BROKENSYSTEM\ControlSet001\Control\Class\{4d36e972-e325-11ce-bfc1-08002be10318}
   ```

10. В каждом подразделе (0000 и т. п.) проверьте значение **DriverDesc**, которое отображается как **Microsoft HYPER-V Network Adapter** (сетевой адаптер Microsoft HYPER-V).

11. В этом подразделе найдите значение **DriverVersion**, которое содержит номер версии драйвера для сетевого адаптера виртуальной машины.

12. Скачайте соответствующее обновление:

    - **10.0.14393.594**: [KB4073562 или более позднее](https://support.microsoft.com/help/4073562) обновление
    - **10.0.15063.0**: [KB4016240](https://support.microsoft.com/help/4016240) или более позднее обновление

13. Подключите системный диск в качестве диска данных к виртуальной машине восстановления, на которую вы скачали обновление.

14. Выполните следующую команду, чтобы установить обновление на виртуальную машину:

    ```
    dism /image:<OS Disk letter>:\ /add-package /packagepath:c:\temp\<KB .msu or .cab>
    ```

15. Выполните следующую команду, чтобы отключить кусты:

    ```
    reg unload HKLM\BROKENSYSTEM
    ```

16. [Отсоедините системный диск и снова создайте виртуальную машину](../windows/troubleshoot-recovery-disks-portal.md).

## <a name="need-help-contact-support"></a>Требуется помощь? Связаться со службой поддержки

Если вам все еще нужна помощь, [обратитесь в службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), которая поможет быстро устранить проблему.
