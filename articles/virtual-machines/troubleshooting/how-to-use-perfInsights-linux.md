---
title: Использование PerfInsights Linux в Microsoft Azure | Документация Майкрософт
description: Узнайте, как использовать PerfInsights для устранения проблем с производительностью виртуальных машин Linux.
services: virtual-machines-linux'
documentationcenter: ''
author: anandhms
manager: cshepard
editor: na
tags: ''
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.topic: troubleshooting
ms.date: 7/10/2019
ms.author: genli
ms.openlocfilehash: 19b2fcaed2c80d4ca52ada9f9f0898479e73bcf2
ms.sourcegitcommit: 509b39e73b5cbf670c8d231b4af1e6cfafa82e5a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2020
ms.locfileid: "78394769"
---
# <a name="how-to-use-perfinsights"></a>Как использовать PerfInsights

[PerfInsights Linux](https://aka.ms/perfinsightslinuxdownload) — это средство диагностики самообслуживания, которое собирает и анализирует диагностические данные, а также предоставляет отчет для устранения проблем производительности виртуальных машин Linux в Azure. PerfInsights можно запустить на поддерживаемых виртуальных машинах в качестве автономного средства или непосредственно с портала, используя [диагностику производительности для виртуальных машин Azure](performance-diagnostics.md).

При возникновении проблем производительности на виртуальных машинах перед обращением в службу поддержки запустите это средство.

## <a name="supported-troubleshooting-scenarios"></a>Поддерживаемые сценарии устранения неисправностей

PerfInsights может собирать и анализировать несколько типов данных. В следующих разделах описываются типовые сценарии.

### <a name="quick-performance-analysis"></a>Быстрый анализ производительности

Этот сценарий собирает основные сведения, такие как конфигурация хранилища и оборудования виртуальной машины, различные журналы, в том числе:

- Сведения об операционной системе

- Сведения об устройстве PCI

- Общие журналы гостевой ОС

- Файлы конфигурации

- Сведения о хранилище

- Конфигурация виртуальной машины Azure (собранная с помощью [службы метаданных экземпляра Azure](https://docs.microsoft.com/azure/virtual-machines/windows/instance-metadata-service))

- Список работающих процессов, диск, память и использование ЦП

- Сведения о сети

Это пассивный сбор данных, который не должен повлиять на систему.

>[!Note]
>Сценарий быстрого анализа производительности автоматически включается в каждый из следующих сценариев:

### <a name="performance-analysis"></a>Анализ производительности

Этот сценарий похож на быстрый анализ производительности, но позволяет собирать диагностические данные в течение длительного времени.

## <a name="what-kind-of-information-is-collected-by-perfinsights"></a>Сведения о типе данных, собираемых PerfInsights

Собираются сведения о виртуальной машине Linux, операционной системе, блочных устройствах, больших потребителях ресурсов, конфигурации и различных журналах. Ниже приведены дополнительные сведения.

- Операционная система
  - Дистрибутив и версия Linux
  - Сведения о ядре
  - Сведения о драйвере

- Оборудование
  - Устройства PCI [`*`]

- Процессы и память
  - Список процессов (имя задачи, используемая память, открытые файлы)
  - Общая, доступная и свободная физическая память
  - Общая, доступная и свободная память подкачки
  - Профилирование захвата ЦП и обработка загрузки ЦП с интервалом в 5 секунд
  - Профилирование отслеживания использования памяти процессами с интервалом в 5 секунд

- Сеть  
  - Список сетевых адаптеров со статистикой адаптеров
  - Таблица сетевой маршрутизации
  - Открытые порты и состояние

- Память
  - Список блочных устройств
  - Список секций
  - Список точек подключения
  - Сведения о томе MDADM
  - Сведения о томе LVM
  - Сбор данных профилирования на всех дисках с интервалом в 5 секунд

- Журналы
  - /var/log/messages.
  - /вар/лог/сислог
  - /вар/лог/керн.лог
  - /вар/лог/крон.лог
  - /вар/лог/бут.лог
  - /вар/лог/юм.лог
  - /вар/лог/дпкг.лог
  - /вар/лог/клауд-инит.лог
  - /вар/лог/клауд-инит-аутпут.лог
  - /вар/лог/гпу-манажер.лог
  - /var/log/waagent.log
  - /Вар/лог/Азуре/[папка расширения]/\*журнал\*
  - /вар/опт/микрософт/омсконфиг/омсконфиг.лог
  - /var/opt/microsoft/omsagent/log/omsagent.log;
  - /етк/ваажент.конфиг
  - Выходные данные жаурналктл за последние пять дней

- [Метаданные экземпляра виртуальной машины Azure](https://docs.microsoft.com/azure/virtual-machines/windows/instance-metadata-service)

>[!Note]
>[`*`] Сведения о PCI еще не собраны в дистрибутивах Debian и SLES

## <a name="run-the-perfinsights-linux-on-your-vm"></a>Запуск PerfInsights Linux на виртуальной машине

### <a name="what-do-i-have-to-know-before-i-run-the-tool"></a>Что необходимо узнать перед запуском средства

#### <a name="tool-requirements"></a>Требования инструмента

- Этот инструмент следует запускать на виртуальных машинах с проблемами производительности.
- На виртуальной машине должен быть установлен Python 2,7

- В настоящее время поддерживаются следующие дистрибутивы:

    | Распределение               | Версия                                         |
    |----------------------------|-------------------------------------------------|
    | Сервер Oracle Linux        | 6,10 [`*`], 7,3, 7,6, 7,5 (Oracle-Database-ee 13,8 Marketplace Image)|
    | CentOS                     | 6,5 [`*`], 7,6                                    |
    | RHEL                       | 7,2, 7,5, 8,0 [`*`]                               |
    | Ubuntu                     | 14.04, 16.04, 18.04                               |
    | Debian                     | 8, 9, 10 [`*`]                                    |
    | SLES                       | 12 SP4 [`*`]                                      |
    |                            |                                                   |

>[!Note]
>[`*`] См. раздел [известных проблем](#known-issues)

### <a name="known-issues"></a>Известные проблемы

- По умолчанию в RHEL 8 не установлен Python. Для запуска PerfInsights Linux необходимо сначала установить Python 2,7

- Сбор сведений о гостевом агенте может завершиться сбоем в CentOS 6. x

- Сведения об устройствах PCI не собираются в дистрибутивах на основе Debian

- Сведения о LVM частично собираются в некоторых дистрибутивах

### <a name="how-do-i-run-perfinsights"></a>Разделы справки запустить PerfInsights

Вы можете запустить PerfInsights на виртуальной машине, установив диагностику производительности Azure из портал Azure. Кроме того, вы можете запустить его в качестве автономного инструмента.

>[!Note]
>PerfInsights просто собирает и анализирует данные. Он не вносит никаких изменений в систему.

#### <a name="install-and-run-perfinsights-from-the-azure-portal"></a>Установка и запуск PerfInsights из портал Azure

Дополнительные сведения об этом параметре см. в статье [Диагностика производительности Azure](performance-diagnostics.md).  

#### <a name="run-perfinsights-in-standalone-mode"></a>Запуск PerfInsights в автономном режиме

Чтобы запустить инструмент PerfInsights, сделайте следующее.

1. Скачайте [PerfInsights. tar. gz](https://aka.ms/perfinsightslinuxdownload) в папку на виртуальной машине и извлеките содержимое с помощью приведенных ниже команд из терминала.

   ```bash
   wget https://download.microsoft.com/download/9/F/8/9F80419C-D60D-45F1-8A98-718855F25722/PerfInsights.tar.gz
   ```

   ```bash
   tar xzvf PerfInsights.tar.gz
   ```

2. Перейдите в папку, содержащую файл `perfinsights.py`, а затем запустите `perfinsights.py`, чтобы просмотреть доступные параметры командной строки.

    ```bash
    cd <the path of PerfInsights folder>
    sudo python perfinsights.py
    ```

    ![Снимок экрана выходных данных командной строки PerfInsights Linux](media/how-to-use-perfinsights-linux/perfinsights-linux-commandline.png)

    Ниже приведен пример базового синтаксиса для запуска сценариев PerfInsights:

    ```bash
    sudo python perfinsights.py -r <ScenarioName> -d [duration]<H | M | S> [AdditionalOptions]
    ```

    Приведенный ниже пример можно использовать для запуска сценария быстрого анализа производительности в течение 1 минуты и создания результатов в папке/ТМП/аутпут:

    ```bash
    sudo python perfinsights.py -r quick -d 1M -a -o /tmp/output
    ```

    Приведенный ниже пример можно использовать для запуска сценария анализа производительности на 5 минут и передачи результата tar в учетную запись хранения.

    ```bash
    sudo python perfinsights.py -r vmslow -d 300S -a -t <StorageAccountName> -k <StorageAccountKey> -i <full resource Uri of the current VM>
    ```

    >[!Note]
    >Перед запуском сценария PerfInsights запрашивает у пользователя согласие на обмен диагностическими данными и согласие с условиями лицензии. Чтобы пропустить эти запросы, используйте параметр **-a или--Accept-unоговорка-and-share-Diagnostics** .
    >
    >Если у вас есть активный запрос в службу поддержки корпорации Майкрософт и выполняется PerfInsights по запросу инженера службы поддержки, с которым вы работаете, обязательно укажите номер запроса в службу поддержки с помощью параметра **-s или--support-Request** .

После завершения выполнения новый tar-файл появится в той же папке, что и PerfInsights, если не указана выходная папка. Имя файла — **перформанцедиагностикс\_гггг-мм-дд\_чч-мм-СС-МММ. tar. gz.** Вы можете отправить этот файл в службу поддержки для анализа или открыть отчет внутри файла, чтобы ознакомиться с результатами и рекомендациями.

## <a name="review-the-diagnostics-report"></a>Просмотр отчета о диагностике

В файле **перформанцедиагностикс\_гггг-мм-дд\_чч-мм-СС-МММ. tar. gz** можно найти HTML-отчет, в котором подробно описаны результаты PerfInsights. Чтобы проверить отчет, разверните файл **перформанцедиагностикс\_гггг-мм-дд\_чч-мм-СС-МММ. tar. gz** , а затем откройте файл **PerfInsights Report. HTML** .

### <a name="overview-tab"></a>Вкладка "Обзор"

На вкладке **Обзор** представлены основные сведения о запуске и сведения о виртуальной машине. На вкладке **результаты** отображается сводка рекомендаций из всех различных разделов отчета PerfInsights.

![Снимок экрана отчета PerfInsights](media/how-to-use-perfinsights-linux/perfinsights-linux-overview.png)  
![Снимок экрана отчета PerfInsights](media/how-to-use-perfinsights-linux/perfinsights-linux-findings-tab.png)

> [!NOTE]
> В категорию результатов высокого уровня попадают известные неполадки, которые могут вызвать проблемы с производительностью. В категорию среднего уровня попадают результаты, указывающие на неоптимальную конфигурацию, которая может не приводить к проблемам с производительностью. Результаты низкого уровня содержат сообщения, которые полезно принять к сведению.

Просмотрите рекомендации и ссылки на для всех результатов высокого и среднего уровня. Узнайте, как они могут повлиять на производительность, и ознакомьтесь с рекомендациями по оптимизации производительности конфигураций.

### <a name="cpu-tab"></a>Вкладка "ЦП"

На вкладке **ЦП** приводятся сведения о потреблении ресурсов на уровне системы во время выполнения PerfInsights. Сведения о высоких периодах использования ЦП и основных длительных потребителях ЦП будут полезны при устранении проблем, связанных с ЦП.

![Снимок экрана вкладки "ЦП" отчета PerfInsights](media/how-to-use-perfinsights-linux/perfinsights-linux-cpu-tab.png)

### <a name="storage-tab"></a>Вкладка хранилища

В разделе **Результаты** отображаются разные результаты и рекомендации, которые относятся к хранилищу.

**Блочные устройства** и другие связанные разделы, такие как **разделы partitions**, **LVM**и **MDADM** , описывают настройку блочных устройств и их связь друг с другом.

![Снимок экрана: вкладка "хранилище"](media/how-to-use-perfinsights-linux/perfinsights-linux-storage-tab.png)  
![Снимок экрана вкладки MDADM](media/how-to-use-perfinsights-linux/perfinsights-linux-mdadm-config.png)

### <a name="linux-tab"></a>Вкладка "Linux"

Вкладка **Linux** содержит сведения об оборудовании и операционной системе, работающей на виртуальной машине. Сведения включают список запущенных процессов и сведения о гостевых агентах, PCI, ЦП, драйверах и драйверах LIS.

![Снимок экрана вкладки Linux](media/how-to-use-perfinsights-linux/perfinsights-linux-tab.png)

## <a name="next-steps"></a>Следующие шаги

Вы можете отправить журналы диагностики и отчетов в службу поддержки Майкрософт для дальнейшего анализа При работе с сотрудниками служба поддержки Майкрософт они могут запросить передачу выходных данных, созданных PerfInsights, для помощи в процессе устранения неполадок.

На следующем снимке экрана отображается сообщение, которое вы можете получить:

![Снимок экрана примера сообщения от службы поддержки Майкрософт](media/how-to-use-perfinsights-linux/support-email.png)

Следуйте инструкциям в сообщении, чтобы получить доступ к рабочему пространству передачи файлов. Для обеспечения дополнительной безопасности необходимо изменить пароль при первом использовании.

После входа в систему появится диалоговое окно для отправки файла **перформанцедиагностикс\_гггг-мм-дд\_чч-мм-СС-МММ. tar. gz** , собранного PerfInsights.
