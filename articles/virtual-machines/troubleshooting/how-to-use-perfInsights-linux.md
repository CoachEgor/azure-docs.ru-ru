---
title: Как использовать Linux PerfInsights в Microsoft Azure Документы Майкрософт
description: Узнайте, как использовать PerfInsights для устранения неполадок в производительности Linux VM.
services: virtual-machines-linux'
documentationcenter: ''
author: anandhms
manager: cshepard
editor: na
tags: ''
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.topic: troubleshooting
ms.date: 7/10/2019
ms.author: genli
ms.openlocfilehash: 19b2fcaed2c80d4ca52ada9f9f0898479e73bcf2
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79266992"
---
# <a name="how-to-use-perfinsights"></a>Как использовать PerfInsights

[PerfInsights Linux](https://aka.ms/perfinsightslinuxdownload) — это инструмент диагностики самопомощи, который собирает и анализирует диагностические данные и предоставляет отчет, помогая устранить проблемы с производительностью виртуальной машины Linux в Azure. PerfInsights можно запускать на поддерживаемых виртуальных машинах в качестве автономного инструмента или непосредственно с портала, используя [диагностику производительности для виртуальных машин Azure.](performance-diagnostics.md)

При возникновении проблем производительности на виртуальных машинах перед обращением в службу поддержки запустите это средство.

## <a name="supported-troubleshooting-scenarios"></a>Поддерживаемые сценарии устранения неисправностей

PerfInsights может собирать и анализировать несколько типов данных. В следующих разделах описываются типовые сценарии.

### <a name="quick-performance-analysis"></a>Быстрый анализ производительности

Этот сценарий собирает основные сведения, такие как емкость хранилища и аппаратного обеспечения вашей виртуальной машины, различные журналы, в том числе:

- Информация о операционной системе

- Информация об устройстве PCI

- Общие журналы Гостевой ОС

- Файлы конфигурации

- Сведения о хранилище

- Конфигурация виртуальной машины Azure (собрана с помощью [службы метаданных экземпляров Azure)](https://docs.microsoft.com/azure/virtual-machines/windows/instance-metadata-service)

- Список запущенных процессов, использование диска, памяти и процессора

- Сетевая информация

Это пассивный сбор данных, который не должен повлиять на систему.

>[!Note]
>Сценарий анализа быстрой производительности автоматически включается в каждый из следующих сценариев:

### <a name="performance-analysis"></a>Анализ производительности

Этот сценарий аналогичен анализу производительности быстрого времени, но позволяет улавливать информацию о диагностике в течение более длительного времени.

## <a name="what-kind-of-information-is-collected-by-perfinsights"></a>Какую информацию собирает PerfInsights

Собрана информация о виртуальной машине Linux, операционной системе, блок-устройствах, высокопотребителях ресурсов, конфигурации и различных журналах. Ниже приведены дополнительные сведения:

- Операционная система
  - Дистрибуция и версия Linux
  - Информация о ядрах
  - Информация о драйверах

- Оборудование
  - Устройства`*`PCI

- Процессы и память
  - Список процессов (имя задачи, используемая память, открытые файлы)
  - Общая, доступная и свободная физическая память
  - Всего, доступная и бесплатная память своп
  - Профилирование захвата процессора и обрабатывает использование процессора с 5-секундным интервалом
  - Профилирование захвата использования памяти процессов с 5-секундным интервалом

- Сети  
  - Список сетевых адаптеров со статистикой адаптеров
  - Таблица сетевой разработки
  - Открытые порты и статус

- Хранилище
  - Блокирование списка устройств
  - Список секций
  - Список точек горы
  - Информация об объеме MDADM
  - Информация об объеме LVM
  - Профилирование захвата на всех дисках с 5-секундным интервалом

- Журналы
  - /var/log/messages.
  - /var/log/syslog
  - /var/log/kern.log
  - /var/log/cron.log
  - /var/log/boot.log
  - /var/log/yum.log
  - /var/log/dpkg.log
  - /var/log/cloud-init.log
  - /var/log/cloud-init-output.log
  - /var/log/gpu-manager.log
  - /var/log/waagent.log
  - /var/log/azure/'расширение папка)\*/ журнал\*
  - /var/opt/microsoft/omsconfig/omsconfig.log
  - /var/opt/microsoft/omsagent/log/omsagent.log;
  - /etc/waagent.config
  - Выход журнала за последние пять дней

- [Метаданные виртуального экземпляра виртуальной машины Azure](https://docs.microsoft.com/azure/virtual-machines/windows/instance-metadata-service)

>[!Note]
>Информация`*`PCI еще не собрана в дистрибутивах Debian и SLES

## <a name="run-the-perfinsights-linux-on-your-vm"></a>Выполнить PerfInsights Linux на вашем VM

### <a name="what-do-i-have-to-know-before-i-run-the-tool"></a>Что я должен знать, прежде чем запустить инструмент

#### <a name="tool-requirements"></a>Требования инструмента

- Этот инструмент следует запускать на виртуальных машинах с проблемами производительности.
- Python 2.7 должен быть установлен на VM

- В настоящее время поддерживаются следующие дистрибутивы:

    | Distribution               | Версия                                         |
    |----------------------------|-------------------------------------------------|
    | Oracle Linux Server        | 6.10`*`, 7.3, 7.6, 7.5 (Oracle-Database-Ee 13.8 изображение рынка)|
    | CentOS                     | 6,5`*`ю, 7,6                                    |
    | RHEL                       | 7.2, 7.5, 8.0`*`                               |
    | Ubuntu                     | 14.04, 16.04, 18.04                               |
    | Debian                     | 8, 9, 10`*`                                    |
    | SLES                       | 12 SP4`*`                                      |
    |                            |                                                   |

>[!Note]
>-`*`Пожалуйста, обратитесь к разделу ["Известные вопросы"](#known-issues)

### <a name="known-issues"></a>Известные проблемы

- RHEL 8 не имеет Python, установленный по умолчанию. Для запуска PerfInsights Linux необходимо сначала установить Python 2.7

- Сбор информации гостевого агента может вывести из строя CentOS 6.x

- Информация о устройствах PCI не собирается на дистрибутивах на основе Debian

- Информация LVM частично собирается по некоторым дистрибутивам

### <a name="how-do-i-run-perfinsights"></a>Как запустить PerfInsights

Вы можете запустить PerfInsights на виртуальной машине, установив диагностику производительности Azure с портала Azure. Кроме того, вы можете запустить его в качестве автономного инструмента.

>[!Note]
>PerfInsights просто собирает и анализирует данные. Он не внося никаких изменений в систему.

#### <a name="install-and-run-perfinsights-from-the-azure-portal"></a>Установка и запуск PerfInsights на портале Azure

Для получения дополнительной информации [Azure Performance Diagnostics](performance-diagnostics.md)об этой опции см.  

#### <a name="run-perfinsights-in-standalone-mode"></a>Запуск PerfInsights в автономном режиме

Чтобы запустить инструмент PerfInsights, сделайте следующее.

1. Загрузите [PerfInsights.tar.gz](https://aka.ms/perfinsightslinuxdownload) в папку на виртуальной машине и извлеките содержимое, используя ниже приведенные команды из терминала.

   ```bash
   wget https://download.microsoft.com/download/9/F/8/9F80419C-D60D-45F1-8A98-718855F25722/PerfInsights.tar.gz
   ```

   ```bash
   tar xzvf PerfInsights.tar.gz
   ```

2. Перейдите к папке, содержащей `perfinsights.py` файл, а затем запустите `perfinsights.py` для просмотра доступных параметров командной строки.

    ```bash
    cd <the path of PerfInsights folder>
    sudo python perfinsights.py
    ```

    ![Скриншот вывода командной строки PerfInsights Linux](media/how-to-use-perfinsights-linux/perfinsights-linux-commandline.png)

    Ниже приведен пример базового синтаксиса для запуска сценариев PerfInsights:

    ```bash
    sudo python perfinsights.py -r <ScenarioName> -d [duration]<H | M | S> [AdditionalOptions]
    ```

    Вы можете использовать приведенный ниже пример для запуска сценария анализа быстрой производительности в течение 1 минуты и создания результатов под /tmp/выходной папкой:

    ```bash
    sudo python perfinsights.py -r quick -d 1M -a -o /tmp/output
    ```

    Вы можете использовать приведенный ниже пример для запуска сценария анализа производительности в течение 5 минут и загрузки шарика смолы результата на учетную запись хранения:

    ```bash
    sudo python perfinsights.py -r vmslow -d 300S -a -t <StorageAccountName> -k <StorageAccountKey> -i <full resource Uri of the current VM>
    ```

    >[!Note]
    >Перед запуском сценария PerfInsights запрашивает у пользователя согласие на обмен диагностическими данными и согласие с условиями лицензии. Используйте **-a или --принять отказ-и-доля-диагностика** вариант, чтобы пропустить эти запросы.
    >
    >Если у вас есть активный билет поддержки с корпорацией Майкрософт и работает perfInsights по запросу инженера службы поддержки, с которым вы работаете, не забудьте предоставить номер билета поддержки, используя опцию **-s или --support-request.**

Когда запуск завершен, новый файл смолы отображается в той же папке, что и PerfInsights, если не указана папка вывода. Название файла **PerformanceDiagnostics\_yyyy-MM-dd\_hh-mm-ss-fff.tar.gz.** Вы можете отправить этот файл агенту поддержки для анализа или открыть отчет внутри файла для анализа выводов и рекомендаций.

## <a name="review-the-diagnostics-report"></a>Просмотр отчета о диагностике

В файле **PerformanceDiagnostics\_yyy-MM-dd\_hh-mm-ss-fff.tar.gz** вы можете найти отчет HTML, в который подробно описаны выводы PerfInsights. Чтобы просмотреть отчет, расширьте файл **PerformanceDiagnostics\_yyyy-MM-dd\_hh-mm-ss-fff.tar.gz,** а затем откройте файл **PerfInsights Report.html.**

### <a name="overview-tab"></a>Вкладка "Обзор"

Вкладка **«Обзор»** содержит основные данные о запуске и информацию о виртуальной машине. Вкладка **«Выводы»** отображает резюме рекомендаций из всех различных разделов отчета PerfInsights.

![Скриншот отчета PerfInsights](media/how-to-use-perfinsights-linux/perfinsights-linux-overview.png)  
![Скриншот отчета PerfInsights](media/how-to-use-perfinsights-linux/perfinsights-linux-findings-tab.png)

> [!NOTE]
> В категорию результатов высокого уровня попадают известные неполадки, которые могут вызвать проблемы с производительностью. В категорию среднего уровня попадают результаты, указывающие на неоптимальную конфигурацию, которая может не приводить к проблемам с производительностью. Результаты низкого уровня содержат сообщения, которые полезно принять к сведению.

Просмотрите рекомендации и ссылки на для всех результатов высокого и среднего уровня. Узнайте, как они могут повлиять на производительность, и ознакомьтесь с рекомендациями по оптимизации производительности конфигураций.

### <a name="cpu-tab"></a>Вкладка процессора

**Вкладка Процессора** предоставляет информацию о общесистемном потреблении процессора во время выполнения PerfInsights. Информация о высоких периодах использования процессора и верхней долго работает потребителей процессора будет полезно для устранения проблем с высокими проблемами, связанными с процессором.

![Скриншот вкладки PerfInsights Report CPU](media/how-to-use-perfinsights-linux/perfinsights-linux-cpu-tab.png)

### <a name="storage-tab"></a>Вкладка хранилища

В разделе **Результаты** отображаются разные результаты и рекомендации, которые относятся к хранилищу.

**Блок-устройства** и другие связанные разделы, такие как **разделы,** **LVM**и **MDADM,** описывают настройку устройств блоков и связанные друг с другом.

![Скриншот вкладки хранения](media/how-to-use-perfinsights-linux/perfinsights-linux-storage-tab.png)  
![Скриншот вкладки MDADM](media/how-to-use-perfinsights-linux/perfinsights-linux-mdadm-config.png)

### <a name="linux-tab"></a>Вкладка Linux

Вкладка **Linux** содержит информацию об оборудовании и операционной системе, работающей в вашем VM. Подробная информация включает в себя список запущенных процессов и информацию о гостевом агенте, PCI, процессоре, драйверах и драйверах LIS.

![Скриншот вкладки Linux](media/how-to-use-perfinsights-linux/perfinsights-linux-tab.png)

## <a name="next-steps"></a>Дальнейшие действия

Вы можете отправить журналы диагностики и отчетов в службу поддержки Майкрософт для дальнейшего анализа При работе с сотрудниками службы поддержки Майкрософт они могут потребовать передать выход, генерируемый PerfInsights, для оказания помощи в процессе устранения неполадок.

На следующем снимке экрана отображается сообщение, которое вы можете получить:

![Снимок экрана примера сообщения от службы поддержки Майкрософт](media/how-to-use-perfinsights-linux/support-email.png)

Следуйте инструкциям в сообщении, чтобы получить доступ к рабочему пространству передачи файлов. Для обеспечения дополнительной безопасности необходимо изменить пароль при первом использовании.

После входа в систему вы найдете диалоговый ящик для загрузки файла **PerformanceDiagnostics\_yyy-MM-dd\_hh-mm-ss-fff.tar.gz,** который был собран PerfInsights.
