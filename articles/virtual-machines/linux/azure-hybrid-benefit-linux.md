---
title: Виртуальные машины Преимущество гибридного использования Azure и Linux
description: Преимущество гибридного использования Azure позволяет экономить деньги на виртуальных машинах Linux, работающих в Azure.
services: virtual-machines
documentationcenter: ''
author: mathapli
manager: westonh
ms.service: virtual-machines-linux
ms.topic: conceptual
ms.workload: infrastructure-services
ms.date: 09/22/2020
ms.author: mathapli
ms.openlocfilehash: f4dce87533927eebef792987b87d148e6a5268b4
ms.sourcegitcommit: d60976768dec91724d94430fb6fc9498fdc1db37
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2020
ms.locfileid: "96500620"
---
# <a name="azure-hybrid-benefit--how-it-applies-for-linux-virtual-machines"></a>Преимущество гибридного использования Azure — как это применяется для Виртуальные машины Linux

## <a name="overview"></a>Обзор

Преимущество гибридного использования Azure позволяет упростить перенос локальных Red Hat Enterprise Linux (RHEL) и SUSE Linux Enterprise Server (SLES) виртуальных машин в Azure с помощью собственной предварительно существующей подписки на программное обеспечение Red Hat или SUSE. С этим преимуществом вы платите только за стоимость инфраструктуры виртуальной машины, так как плата за программное обеспечение охватывается подпиской RHEL или SLES. Преимущество распространяется на все образы RHEL и SLES Marketplace с оплатой по мере использования (PAYG).

> [!IMPORTANT]
> Преимущество гибридного использования Azure для виртуальных машин Linux сейчас доступны для общего доступа


## <a name="benefit-description"></a>Описание преимущества

С помощью Преимущество гибридного использования Azure вы можете легко перенести локальные серверы RHEL и SLES в Azure, преобразовав существующие виртуальные машины RHEL и SLES PAYG в Azure для выставления счетов вашей подписки (BYOS). Как правило, виртуальные машины, развернутые из образов PAYG в Azure, будут взимать плату за инфраструктуру, а также плату за программное обеспечение. С Преимущество гибридного использования Azure виртуальные машины PAYG можно преобразовать в модель выставления счетов BYOS без повторного развертывания, избегая каких-либо угроз простоя.

:::image type="content" source="./media/ahb-linux/azure-hybrid-benefit-cost.png" alt-text="Преимущество гибридного использования Azure визуализации затрат на виртуальных машинах Linux.":::

При включении преимуществ на виртуальной машине RHEL или SLES больше не взимается плата за дополнительное программное обеспечение, как правило, на виртуальной машине PAYG. Вместо этого ваша виртуальная машина начнет выдавать BYOS плату, которая включает только вычисление платы за оборудование и отсутствие платы за программное обеспечение.

При желании вы также можете преобразовать виртуальную машину, для которой было включено преимущество, в модель выставления счетов PAYG.

## <a name="scope-of-azure-hybrid-benefit-eligibility-for-linux-vms"></a>Область допустимости Преимущество гибридного использования Azure для виртуальных машин Linux

Преимущество гибридного использования Azure доступен для всех образов PAYG RHEL и SLES Marketplace. Это преимущество еще не доступно для образов RHEL или SLES Marketplace BYOS или пользовательских образов.

Зарезервированные экземпляры, выделенные узлы и преимущества гибридных приложений SQL не подходят для Преимущество гибридного использования Azure, если вы уже используете преимущества виртуальных машин Linux.

## <a name="how-to-get-started"></a>Начало работы

### <a name="red-hat-customers"></a>Клиенты Red Hat

Преимущество гибридного использования Azure для RHEL доступны клиентам, у которых есть активные и неиспользуемые подписки RHEL, которые можно использовать в Azure, и кто включил одну или несколько подписок для использования в Azure с помощью программы [Cloud Access для Red Hat](https://www.redhat.com/en/technologies/cloud-computing/cloud-access) . 

1.  Включите одну или несколько подходящих подписок RHEL для использования в Azure с помощью [интерфейса пользователя Cloud Access для Red Hat](https://access.redhat.com/management/cloud).
1.  Подписки Azure, которые вы указали в процессе включения облачного доступа Red Hat, смогут использовать Преимущество гибридного использования Azure функцию.
1.  Примените Преимущество гибридного использования Azure к любой из существующих виртуальных машин RHEL PAYG, а также к новым виртуальным машинам RHEL, которые развертываются из образов Azure Marketplace PAYG.
1.  Следуйте рекомендуемым [дальнейшим действиям](https://access.redhat.com/articles/5419341) по настройке источников обновлений для ВИРТУАЛЬНЫХ машин RHEL и правилам соответствия подписок RHEL.


### <a name="suse-customers"></a>Клиенты SUSE

1.    Регистрация в программе общедоступного облака SUSE
1.    Примените преимущество к существующим виртуальным машинам с помощью Azure CLI
1.    Регистрация виртуальных машин, получающих преимущество, с помощью отдельного источника обновлений


### <a name="enable-and-disable-the-benefit-in-the-azure-cli"></a>Включение и отключение преимущества в Azure CLI

Для обновления существующих виртуальных машин можно использовать команду AZ VM Update. Для виртуальных машин RHEL выполните команду с параметром--License-Type в RHEL_BYOS. Для виртуальных машин SLES выполните команду с параметром--License-Type в SLES_BYOS.

#### <a name="cli-example-to-enable-the-benefit"></a>Пример интерфейса командной строки для включения преимущества:
```azurecli
# This will enable the benefit on a RHEL VM
az vm update -g myResourceGroup -n myVmName --license-type RHEL_BYOS

# This will enable the benefit on a SLES VM
az vm update -g myResourceGroup -n myVmName --license-type SLES_BYOS
```
#### <a name="cli-example-to-disable-the-benefit"></a>Пример интерфейса командной строки для отключения этого преимущества:
Чтобы отключить преимущество, используйте значение "нет" для типа лицензии.
```azurecli
# This will disable the benefit on a VM
az vm update -g myResourceGroup -n myVmName --license-type None
```

#### <a name="cli-example-to-enable-the-benefit-on-a-large-number-of-vms"></a>Пример интерфейса командной строки для использования преимущества на большом количестве виртуальных машин
Чтобы обеспечить преимущество для большого количества виртуальных машин, можно использовать `--ids` параметр в Azure CLI.

```azurecli
# This will enable the benefit on a RHEL VM. In this example, ids.txt is an
# existing text file containing a delimited list of resource IDs corresponding
# to the VMs using the benefit
az vm update -g myResourceGroup -n myVmName --license-type RHEL_BYOS --ids $(cat ids.txt)
```

В следующих примерах показаны два способа получения списка идентификаторов ресурсов — один на уровне группы ресурсов, один на уровне подписки.
```azurecli
# To get a list of all the resource IDs in a resource group:
$(az vm list -g MyResourceGroup --query "[].id" -o tsv)

# To get a list of all the resource IDs of VMs in a subscription:
az vm list -o json | jq '.[] | {VMName: .name, ResourceID: .id}'
```

## <a name="check-ahb-status-of-a-vm"></a>Проверка состояния АХБ виртуальной машины
Состояние АХБ виртуальной машины можно просмотреть двумя способами: с помощью Azure CLI или с помощью службы метаданных экземпляра Azure (Azure IMDS).


### <a name="azure-cli"></a>Azure CLI

`az vm get-instance-view`Для этой цели можно использовать команду. Найдите поле licenseType в ответе. Если поле licenseType существует и имеет значение "RHEL_BYOS" или "SLES_BYOS", то для виртуальной машины будет включено преимущество.

```azurecli
az vm get-instance-view -g MyResourceGroup -n MyVm
```

### <a name="azure-instance-metadata-service"></a>Служба метаданных экземпляров Azure

В самой виртуальной машине вы можете запросить IMDS метаданные, чтобы определить licenseType виртуальной машины. Значение licenseType, равное "RHEL_BYOS" или "SLES_BYOS", указывает на то, что для виртуальной машины включено преимущество. Дополнительные сведения о аттестации метаданных см. [здесь](./instance-metadata-service.md#attested-data) .

## <a name="compliance"></a>Соответствие нормативным требованиям

### <a name="red-hat"></a>Red Hat

Клиенты, использующие Преимущество гибридного использования Azure для RHEL, согласились со стандартными [юридическими условиями](http://www.redhat.com/licenses/cloud_CSSA/Red_Hat_Cloud_Software_Subscription_Agreement_for_Microsoft_Azure.pdf) и [заявлением о конфиденциальности](http://www.redhat.com/licenses/cloud_CSSA/Red_Hat_Privacy_Statement_for_Microsoft_Azure.pdf) , связанным с предложениями RHEL Azure Marketplace.

Клиенты, использующие Преимущество гибридного использования Azure для RHEL, имеют три варианта предоставления обновлений программного обеспечения и исправлений для этих виртуальных машин:

1.  [Инфраструктура обновления Red Hat (RHUI)](../workloads/redhat/redhat-rhui.md) (параметр по умолчанию)
1.  Вспомогательный сервер Red Hat
1.  Диспетчер подписок Red Hat

Клиенты, использующие параметр RHUI, могут продолжать использовать RHUI в качестве основного источника обновлений для виртуальных машин АХБ RHEL, не присоединяя подписки RHEL к этим виртуальным машинам.  Клиенты, для которых выбран параметр RHUI, отвечают за обеспечение соответствия подписок RHEL.

Клиенты, выбираемые с помощью сервера Red Hat Спутниковое или диспетчера подписки Red Hat, должны удалить конфигурацию RHUI, а затем присоединить подписку RHEL с облачным доступом к своим виртуальным машинам АХБ RHEL.  

Дополнительные сведения о соответствии требованиям к подписке Red Hat, обновлениям программного обеспечения и источникам для виртуальных машин АХБ RHEL можно найти [здесь](https://access.redhat.com/articles/5419341).

### <a name="suse"></a>SUSE

Чтобы использовать Преимущество гибридного использования Azure для виртуальных машин SLES, сначала необходимо зарегистрировать в программе общедоступного облака SUSE. Дополнительные сведения о программе см. здесь. После приобретения подписок SUSE необходимо зарегистрировать виртуальные машины с помощью этих подписок на свой источник обновлений с помощью центра клиентов SUSE, сервера средства управления подписками или SUSE Manager.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
*Вопрос. можно ли использовать тип лицензии "RHEL_BYOS" с образом SLES или наоборот?*

Ответ. нет, вы не можете. Попытка ввести тип лицензии, которая неправильно соответствует дистрибутив, выполняемому на виртуальной машине, не приведет к обновлению метаданных выставления счетов. Однако если случайно ввести неправильный тип лицензии, то при обновлении виртуальной машины до правильного типа лицензии все равно будет включено преимущество.

*Вопрос. я зарегистрировался с помощью облачного доступа Red Hat, но по-прежнему не сможет включить преимущества на моих виртуальных машинах RHEL. Чем я занимаюсь?*

Ответ. регистрация подписки на облачный доступ Red Hat с помощью Red Hat в Azure может занять некоторое время. Если вы по-прежнему видите ошибку в течение одного рабочего дня, обратитесь в службу поддержки Майкрософт.

*Вопрос. я развернул виртуальную машину с помощью RHEL BYOS "Золотой образ". Можно ли преобразовать выставление счетов на эти образы из BYOS в PAYG?*

Ответ. нет, вы не можете. Преимущество гибридного использования Azure поддерживает преобразование только для изображений с оплатой по мере использования.

*Вопрос. я развернул виртуальную машину с помощью RHEL BYOS "Золотой образ". Можно ли преобразовать выставление счетов на эти образы из BYOS в PAYG?*

Ответ. нет, вы не можете. Преимущество гибридного использования Azure поддерживает преобразование только для изображений с оплатой по мере использования.

*Вопрос. я отправил собственный образ RHEL из локальной среды (с помощью службы "миграция Azure", ASR или иным образом) в Azure. Можно ли преобразовать выставление счетов на эти образы из BYOS в PAYG?*

Ответ. нет, вы не можете. Преимущество гибридного использования Azure возможность доступна только в образах RHEL и SLES Marketplace уже сегодня. 

*Вопрос. я отправил собственный образ RHEL из локальной среды (с помощью службы "миграция Azure", ASR или иным образом) в Azure. Нужно ли делать что-нибудь, чтобы воспользоваться преимуществами Преимущество гибридного использования Azure?*

Ответ. нет, нет. Отправляемые вами образы RHEL уже считаются BYOS, и плата взимается только за затраты на инфраструктуру Azure. Вы несете ответственность за RHELные подписки, как и для локальных сред. 

*Вопрос. можно ли использовать Преимущество гибридного использования Azure на виртуальных машинах, развернутых из Marketplace RHEL и SLES SAP Images?*

Ответ. Да, можете. Вы можете использовать тип лицензии "RHEL_BYOS" для виртуальных машин RHEL и "SLES_BYOS" для преобразования виртуальных машин, развернутых из RHEL в Marketplace и SLES SAP.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure в масштабируемом наборе виртуальных машин (VMSS) для RHEL и SLES?*

Ответ. нет, вы не можете. В настоящее время для RHEL и SLES VMSS не находится в области Преимущество гибридного использования Azure.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure на зарезервированных экземплярах (RIs) для RHEL и SLES?*

Ответ. нет, вы не можете. В настоящее время служба RIs не находится в области Преимущество гибридного использования Azure для RHEL и SLES.

*Вопрос. можно ли использовать Преимущество гибридного использования Azure на виртуальной машине, развернутой для SQL Server в образах RHEL?*

Ответ. нет, вы не можете. Не существует плана для поддержки этих.
 

## <a name="common-issues"></a>Распространенные проблемы
В этом разделе содержится список распространенных проблем, которые могут возникнуть, а также приведены меры по их устранению.

| Error | Меры по снижению риска |
| ----- | ---------- |
| "Не удалось выполнить действие, так как наши записи показывают, что вы не включили облачный доступ Red Hat к вашей подписке Azure..." | Чтобы использовать преимущество с виртуальными машинами RHEL, необходимо сначала зарегистрировать ваши подписки Azure с помощью облачного доступа Red Hat. Перейдите по этой ссылке, чтобы узнать больше о том, как зарегистрировать подписки Azure для облачного доступа к Red Hat.

## <a name="next-steps"></a>Дальнейшие действия
* Узнайте, как создавать и обновлять виртуальные машины и добавлять типы лицензий (RHEL_BYOS, SLES_BYOS) для Преимущество гибридного использования Azure с помощью [Azure CLI.](/cli/azure/vm?preserve-view=true&view=azure-cli-latest)