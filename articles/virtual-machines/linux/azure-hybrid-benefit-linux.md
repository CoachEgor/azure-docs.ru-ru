---
title: Виртуальные машины Преимущество гибридного использования Azure и Linux
description: Преимущество гибридного использования Azure позволяет экономить деньги на виртуальных машинах Linux, работающих в Azure.
services: virtual-machines
documentationcenter: ''
author: mathapli
manager: westonh
ms.service: virtual-machines-linux
ms.topic: conceptual
ms.workload: infrastructure-services
ms.date: 09/22/2020
ms.author: alsin
ms.openlocfilehash: da17122de8db41b6ba9ae9597d52bc3e1d8d0062
ms.sourcegitcommit: d103a93e7ef2dde1298f04e307920378a87e982a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "91962400"
---
# <a name="preview-azure-hybrid-benefit--how-it-applies-for-linux-virtual-machines"></a>Предварительный просмотр: Преимущество гибридного использования Azure — как он применяется для Виртуальные машины Linux

## <a name="overview"></a>Обзор

Преимущество гибридного использования Azure позволяет упростить перенос локальных Red Hat Enterprise Linux (RHEL) и SUSE Linux Enterprise Server (SLES) виртуальных машин в Azure с помощью собственной предварительно существующей подписки на программное обеспечение Red Hat или SUSE. С этим преимуществом вы платите только за стоимость инфраструктуры виртуальной машины, так как плата за программное обеспечение охватывается подпиской RHEL или SLES. Преимущество распространяется на все образы RHEL и SLES Marketplace с оплатой по мере использования (PAYG).

> [!IMPORTANT]
> Преимущество гибридного использования Azure для виртуальных машин Linux в настоящее время находится в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="benefit-description"></a>Описание преимущества

С помощью Преимущество гибридного использования Azure вы можете легко перенести локальные серверы RHEL и SLES в Azure, преобразовав существующие виртуальные машины RHEL и SLES PAYG в Azure для выставления счетов вашей подписки (BYOS). Как правило, виртуальные машины, развернутые из образов PAYG в Azure, будут взимать плату за инфраструктуру, а также плату за программное обеспечение. С Преимущество гибридного использования Azure виртуальные машины PAYG можно преобразовать в модель выставления счетов BYOS без повторного развертывания, избегая каких-либо угроз простоя.

:::image type="content" source="./media/ahb-linux/azure-hybrid-benefit-cost.png" alt-text="Преимущество гибридного использования Azure визуализации затрат на виртуальных машинах Linux.":::

При включении преимуществ на виртуальной машине RHEL или SLES больше не взимается плата за дополнительное программное обеспечение, как правило, на виртуальной машине PAYG. Вместо этого ваша виртуальная машина начнет выдавать BYOS плату, которая включает только вычисление платы за оборудование и отсутствие платы за программное обеспечение.

При желании вы также можете преобразовать виртуальную машину, для которой было включено преимущество, в модель выставления счетов PAYG.

## <a name="scope-of-azure-hybrid-benefit-eligibility-for-linux-vms"></a>Область допустимости Преимущество гибридного использования Azure для виртуальных машин Linux

Преимущество гибридного использования Azure доступен для всех образов PAYG RHEL и SLES Marketplace. Это преимущество еще не доступно для образов RHEL или SLES Marketplace BYOS или пользовательских образов.

Зарезервированные экземпляры, выделенные узлы и преимущества гибридных приложений SQL не подходят для Преимущество гибридного использования Azure, если вы уже используете преимущества виртуальных машин Linux.

## <a name="how-to-get-started"></a>Начало работы

Преимущество гибридного использования Azure в настоящее время находится на этапе предварительной версии для виртуальных машин Linux. Когда вы получите доступ к предварительной версии, вы можете воспользоваться преимуществами портал Azure или Azure CLI.

### <a name="preview"></a>Предварительный просмотр

На этом этапе вы можете получить доступ к преимуществам, заполнив форму [здесь](https://aka.ms/ahb-linux-form). После заполнения формы ваши подписки Azure будут включены для этого преимущества, и вы получите подтверждение от Майкрософт в течение трех рабочих дней.

### <a name="red-hat-customers"></a>Клиенты Red Hat

1.    Заполните форму запроса на предварительную версию выше
1.    Регистрация в [программе Cloud Access для Red Hat](https://aka.ms/rhel-cloud-access)
1.    Включите подписки Azure для доступа к облаку и включите подписки, содержащие виртуальные машины, для которых вы хотите использовать преимущества.
1.    Примените преимущество к существующим виртуальным машинам с помощью портал Azure или Azure CLI
1.    Регистрация виртуальных машин, получающих преимущество, с помощью отдельного источника обновлений

### <a name="suse-customers"></a>Клиенты SUSE

1.    Заполните форму запроса на предварительную версию выше
1.    Регистрация в программе общедоступного облака SUSE
1.    Примените преимущество к существующим виртуальным машинам с помощью портал Azure или Azure CLI
1.    Регистрация виртуальных машин, получающих преимущество, с помощью отдельного источника обновлений

### <a name="enable-and-disable-the-benefit-in-the-azure-portal"></a>Включение и отключение преимущества в портал Azure

Вы можете включить преимущества для существующих виртуальных машин, перейдя в колонку **Конфигурация** и выполнив действия, описанные в этой статье. Вы можете включить преимущества для новых виртуальных машин во время создания виртуальной машины.

### <a name="enable-and-disable-the-benefit-in-the-azure-cli"></a>Включение и отключение преимущества в Azure CLI

Для обновления существующих виртуальных машин можно использовать команду AZ VM Update. Для виртуальных машин RHEL выполните команду с параметром--License-Type в RHEL_BYOS. Для виртуальных машин SLES выполните команду с параметром--License-Type в SLES_BYOS.

#### <a name="cli-example-to-enable-the-benefit"></a>Пример интерфейса командной строки для включения преимущества:
```azurecli
# This will enable the benefit on a RHEL VM
az vm update -g myResourceGroup -n myVmName --license-type RHEL_BYOS

# This will enable the benefit on a SLES VM
az vm update -g myResourceGroup -n myVmName --license-type SLES_BYOS
```
#### <a name="cli-example-to-disable-the-benefit"></a>Пример интерфейса командной строки для отключения этого преимущества:
Чтобы отключить преимущество, используйте значение "нет" для типа лицензии.
```azurecli
# This will disable the benefit on a VM
az vm update -g myResourceGroup -n myVmName --license-type None
```

#### <a name="cli-example-to-enable-the-benefit-on-a-large-number-of-vms"></a>Пример интерфейса командной строки для использования преимущества на большом количестве виртуальных машин
Чтобы обеспечить преимущество для большого количества виртуальных машин, можно использовать `--ids` параметр в Azure CLI.

```azurecli
# This will enable the benefit on a RHEL VM. In this example, ids.txt is an
# existing text file containing a delimited list of resource IDs corresponding
# to the VMs using the benefit
az vm update -g myResourceGroup -n myVmName --license-type RHEL_BYOS --ids $(cat ids.txt)
```

В следующих примерах показаны два способа получения списка идентификаторов ресурсов — один на уровне группы ресурсов, один на уровне подписки.
```azurecli
# To get a list of all the resource IDs in a resource group:
$(az vm list -g MyResourceGroup --query "[].id" -o tsv)

# To get a list of all the resource IDs of VMs in a subscription:
az vm list -o json | jq '.[] | {VMName: .name, ResourceID: .id}'
```

## <a name="check-ahb-status-of-a-vm"></a>Проверка состояния АХБ виртуальной машины
Состояние АХБ виртуальной машины можно просмотреть тремя способами: на портале, с помощью Azure CLI или с помощью службы метаданных экземпляра Azure (Azure IMDS).


### <a name="portal"></a>Портал

Просмотрите колонку конфигурация и проверьте состояние лицензирования, чтобы узнать, включена ли АХБ для виртуальной машины.

### <a name="azure-cli"></a>Azure CLI

`az vm get-instance-view`Для этой цели можно использовать команду. Найдите поле licenseType в ответе. Если поле licenseType существует и имеет значение "RHEL_BYOS" или "SLES_BYOS", то для виртуальной машины будет включено преимущество.

```azurecli
az vm get-instance-view -g MyResourceGroup -n MyVm
```

### <a name="azure-instance-metadata-service"></a>Служба метаданных экземпляров Azure

В самой виртуальной машине вы можете запросить IMDS метаданные, чтобы определить licenseType виртуальной машины. Значение licenseType, равное "RHEL_BYOS" или "SLES_BYOS", указывает на то, что для виртуальной машины включено преимущество. Дополнительные сведения о аттестации метаданных см. [здесь](./instance-metadata-service.md#attested-data) .

## <a name="compliance"></a>Соответствие нормативным требованиям

### <a name="red-hat"></a>Red Hat

Чтобы использовать Преимущество гибридного использования Azure для виртуальных машин RHEL, необходимо сначала зарегистрироваться в программе Cloud Access для Red Hat. Это можно сделать с помощью сайта облачного доступа Red Hat здесь. После включения этого преимущества на виртуальной машине необходимо зарегистрировать виртуальную машину с помощью собственного источника обновлений с помощью диспетчера подписки Red Hat или вспомогательного приложения Red Hat. Регистрация для обновления гарантирует, что состояние останется в поддерживаемом состоянии.

### <a name="suse"></a>SUSE

Чтобы использовать Преимущество гибридного использования Azure для виртуальных машин SLES, сначала необходимо зарегистрировать в программе общедоступного облака SUSE. Дополнительные сведения о программе см. здесь. После приобретения подписок SUSE необходимо зарегистрировать виртуальные машины с помощью этих подписок на свой источник обновлений с помощью центра клиентов SUSE, сервера средства управления подписками или SUSE Manager.

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
*Вопрос. можно ли использовать тип лицензии "RHEL_BYOS" с образом SLES или наоборот?*

Ответ. нет, вы не можете. Попытка ввести тип лицензии, которая неправильно соответствует дистрибутив, выполняемому на виртуальной машине, не приведет к обновлению метаданных выставления счетов. Однако если случайно ввести неправильный тип лицензии, то при обновлении виртуальной машины до правильного типа лицензии все равно будет включено преимущество.

*Вопрос. я зарегистрировался с помощью облачного доступа Red Hat, но по-прежнему не сможет включить преимущества на моих виртуальных машинах RHEL. Чем я занимаюсь?*

Ответ. регистрация подписки на облачный доступ Red Hat с помощью Red Hat в Azure может занять некоторое время. Если вы по-прежнему видите ошибку в течение одного рабочего дня, обратитесь в службу поддержки Майкрософт.

## <a name="common-errors"></a>Распространенные ошибки
В этом разделе содержится список распространенных ошибок и действий по их устранению.

| Ошибка | Меры по снижению риска |
| ----- | ---------- |
| "Подписка не зарегистрирована для предварительной версии Linux Преимущество гибридного использования Azure. Пошаговые инструкции см. в https://aka.ms/ahb-linux разделе " | Заполните форму, https://aka.ms/ahb-linux-form чтобы зарегистрироваться для использования предварительной версии Linux преимущество гибридного использования Azure.
| "Не удалось выполнить действие, так как наши записи показывают, что вы не включили облачный доступ Red Hat к вашей подписке Azure..." | Чтобы использовать преимущество с виртуальными машинами RHEL, необходимо сначала зарегистрировать ваши подписки Azure с помощью облачного доступа Red Hat. Перейдите по этой ссылке, чтобы узнать больше о том, как зарегистрировать подписки Azure для облачного доступа к Red Hat.

## <a name="next-steps"></a>Дальнейшие действия
* Начните работу с предварительной версией, заполнив форму [здесь](https://aka.ms/ahb-linux-form).