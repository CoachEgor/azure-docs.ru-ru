---
title: Руководство. Настройка развертывания canary для Виртуальных машин Linux
description: Из этого учебника вы узнаете, как настроить конвейер непрерывного развертывания (CD), который обновляет группу Виртуальных машин Linux с помощью стратегии развертывания canary.
author: moala
manager: jpconnock
tags: azure-devops-pipelines
ms.assetid: ''
ms.service: virtual-machines-linux
ms.topic: tutorial
ms.tgt_pltfrm: azure-pipelines
ms.workload: infrastructure
ms.date: 4/10/2020
ms.author: moala
ms.custom: devops
ms.openlocfilehash: b51b4aed85f737e436565ce8ba1ab4a295714734
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82120532"
---
# <a name="tutorial---configure-canary-deployment-strategy-for-azure-linux-virtual-machines"></a>Руководство. Настройка стратегии развертывания Canary для Виртуальных машин Linux


## <a name="iaas---configure-cicd"></a>IaaS — настройка CI/CD 
Azure Pipelines предоставляет комплексный и полнофункциональный набор инструментов для автоматизации CI/CD при развертывании на виртуальных машинах. Вы можете настроить конвейер непрерывной поставки для виртуальной машины Azure непосредственно на портале Azure. В этом документе описывается, как настроить конвейер CI/CD, который использует стратегию Canary, для развертываний с несколькими компьютерами. Вы также можете ознакомиться с другими стратегиями, такими как [последовательное развертывание](https://aka.ms/AA7jlh8) и [развертывание blue-green](https://aka.ms/AA83fwu), которые поддерживаются по умолчанию на портале Azure. 


**Настройка CI/CD для Виртуальных машин**

Виртуальные машины можно добавлять в качестве целевых объектов в [группу развертывания](https://docs.microsoft.com/azure/devops/pipelines/release/deployment-groups) и назначать для обновления на нескольких компьютерах. После того как вы выполните развертывание, с помощью **журнала развертываний** в группе развертывания можно отслеживать передачу данных с виртуальной машины в конвейер и затем на фиксацию. 
 
  
**Ранние развертывания.** Раннее развертывание снижает риск, так как развертывание выполняется медленно для небольшой группы пользователей. Когда вы будете уверены в новой версии, ее можно будет выпустить на другие серверы в инфраструктуре, предоставив ее большему количеству пользователей. Вы можете настроить режим раннего развертывания для виртуальных машин на портале Azure, используя механизм непрерывной поставки. Ниже представлено пошаговое руководство. 
1. Войдите на портал Azure и перейдите к нужной виртуальной машине. 
2. На панели слева для виртуальной машины перейдите в меню  **Непрерывная поставка** . Нажмите **Настроить**. 

   ![AzDevOps_configure](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure.png) 
3. На панели конфигурации щелкните **Организация Azure DevOps**, чтобы выбрать существующую учетную запись или создать новую. Затем выберите проект, в котором вы хотите настроить конвейер.  


   ![AzDevOps_project](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling.png) 
4. Группа развертывания — это логический набор целевых компьютеров для развертывания, который представляет определенную физическую среду, например среду разработки, тестирования и пользовательского приемочного тестирования, а также рабочую среду. Вы можете создать новую группу развертывания или выбрать существующую. 
5. Выберите конвейер сборки, который публикует пакет для развертывания на виртуальной машине. Обратите внимание, что опубликованный пакет должен содержать скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке `deployscripts` в корне пакета. Этот скрипт развертывания будет запущен конвейером Azure DevOps во время выполнения.
6. Выберите стратегию развертывания по своему усмотрению. Выберите **Canary**.
7. Добавьте тег canary для виртуальных машин, которые должны быть частью ранних развертываний, и тег prod для виртуальных машин, которые являются частью развертываний, выполняемых после успешного раннего развертывания. Теги помогут выбрать виртуальные машины только с определенной ролью.
![AzDevOps_configure_canary](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure-canary.png)

8. Щелкните **ОК** в диалоговом окне, чтобы настроить конвейер непрерывной поставки. Теперь вы получите конвейер непрерывной поставки, настроенный для развертывания на виртуальной машине.
![AzDevOps_canary_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-canary-pipeline.png)


9. Щелкните **Изменить** для конвейера выпуска в Azure DevOps, чтобы просмотреть конфигурацию конвейера. Конвейер состоит из трех этапов. Первый — это этап группы развертывания, на котором выполняется развертывание на виртуальных машинах с тегом _canary_. На втором этапе конвейер приостанавливается и ожидает возобновления вручную. Если пользователь удовлетворен стабильностью развертывания canary, выполнение конвейера можно возобновить, запустив третий этап, на котором выполняется развертывание на виртуальных машинах с тегом _prod_. ![AzDevOps_canary_task](media/tutorial-devops-azure-pipelines-classic/azure-devops-canary-task.png)

10. Прежде чем возобновить выполнение конвейера, убедитесь, что хотя бы одна виртуальная машина имеет тег _prod_. На третьем этапе конвейера приложение будет развернуто только на тех ВМ, которые имеют тег _prod_.

11. Задача по выполнению скрипта развертывания по умолчанию выполнит скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке "deployscripts" корневого каталога опубликованного пакета. Убедитесь, что выбранный конвейер сборки публикует его в корневом каталоге пакета. 
![AzDevOps_publish_package](media/tutorial-deployment-strategy/package.png)




## <a name="other-deployment-strategies"></a>Другие стратегии развертывания
- [Настройка стратегии последовательного развертывания](https://aka.ms/AA7jlh8)
- [Настройка стратегии развертывания по схеме Blue-Green](https://aka.ms/AA83fwu)

## <a name="azure-devops-project"></a>Azure DevOps Projects 
Начать работу с Azure теперь стало еще проще.
 
С помощью Azure DevOps Projects вы можете запустить приложение в любой службе Azure, выполнив всего три шага: выбрав язык приложения, среду разработки и службу Azure.
 
[Подробнее](https://azure.microsoft.com/features/devops-projects/ ).
 
## <a name="additional-resources"></a>Дополнительные ресурсы 
- [Руководство по развертыванию приложения ASP.NET на виртуальных машинах Azure с помощью Azure DevOps Projects](https://docs.microsoft.com/azure/devops-project/azure-devops-project-vms)
- [Реализация непрерывного развертывания приложения в масштабируемом наборе виртуальных машин Azure](https://docs.microsoft.com/azure/devops/pipelines/apps/cd/azure/deploy-azure-scaleset)
