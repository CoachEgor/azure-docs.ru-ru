---
title: Выполнить скрипты оболочки на виртуальной машине Linux в Azure
description: В этом разделе описывается выполнение скриптов в виртуальной машине Azure Linux с помощью команды запуска
services: automation
ms.service: automation
author: georgewallace
ms.author: gwallace
ms.date: 04/26/2019
ms.topic: article
manager: carmonm
ms.openlocfilehash: fe0547c1ddb89b8d9ab3e876e83bbdea17a58743
ms.sourcegitcommit: 44a85a2ed288f484cc3cdf71d9b51bc0be64cc33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2019
ms.locfileid: "64570598"
---
# <a name="run-shell-scripts-in-your-linux-vm-with-run-command"></a>Выполнение скриптов оболочки в виртуальной машине Linux с помощью команды запуска

Команда запуска использует агент виртуальной машины для выполнения скриптов оболочки в виртуальной машине Azure Linux. Эти сценарии можно использовать для общих компьютеров или управления приложениями, также их можно использовать для быстрой диагностики и устранения проблем доступа и сети виртуальной машины и получить ее рабочее состояние.

## <a name="benefits"></a>Преимущества

Существует несколько вариантов, которые можно использовать для доступа к виртуальным машинам. Команда запуска может удаленно выполнять сценарии на виртуальных машинах с помощью их агента. Команда запуска может использоваться на портале Microsoft Azure, [REST API](/rest/api/compute/virtual%20machines%20run%20commands/runcommand), [Azure CLI](/cli/azure/vm/run-command?view=azure-cli-latest#az-vm-run-command-invoke) для виртуальных машин Linux.

Эта возможность может использоваться во всех случаях, когда необходимо запускать сценарии на виртуальных машинах. Она является одним из немногих способов диагностики и устранения неполадок виртуальных машин в тех случаях, когда к ним невозможно подключиться по RDP или у них нет открытого порта SSH из-за неправильной настройки сети или параметров администратора.

## <a name="restrictions"></a>Ограничения

Ниже приведен список ограничений, которые присутствуют при использовании команды запуска.

* Выводятся только последние 4096 байт
* Минимальное время для выполнения скрипта составляет около 20 секунд
* Скрипты выполняются по умолчанию от имени пользователя с повышенными привилегиями в Linux
* Два сценария не могут выполняться одновременно
* Скрипты, которые запрашивают сведения (в интерактивном режиме), не поддерживаются.
* Вы не можете отменить выполнение сценария
* Максимальное время выполнения сценария составляет 90 минут, после чего он выдаст ошибку времени ожидания
* Чтобы вернуть результаты скрипта, требуется разрешить исходящие подключения из виртуальной машины.

> [!NOTE]
> Чтобы команда запуска работала правильно, требуется подключение (через порт 443) к общедоступным IP-адресам Azure. Если расширение не имеет доступа к этим конечным точкам, скрипты могут успешно выполняться, но результаты не будут возвращаться. Если вы блокируете трафик на виртуальной машине, вы можете использовать [теги служб](../../virtual-network/security-overview.md#service-tags), чтобы разрешить трафик к общедоступным IP-адресам Azure с помощью тега `AzureCloud`.

## <a name="azure-cli"></a>Инфраструктура CLI Azure

Ниже приведен пример с использованием команды [az vm run-command](/cli/azure/vm/run-command?view=azure-cli-latest#az-vm-run-command-invoke) для запуска сценария оболочки на виртуальной машине Linux Azure.

```azurecli-interactive
az vm run-command invoke -g myResourceGroup -n myVm --command-id RunShellScript --scripts "sudo apt-get update && sudo apt-get install -y nginx"
```

> [!NOTE]
> Для выполнения команд от имени другого пользователя можно использовать `sudo -u`, чтобы указать учетную запись пользователя, которую нужно использовать.

## <a name="azure-portal"></a>Портал Azure

Перейдите к виртуальной машине в [Azure](https://portal.azure.com) и выберите **Запуск команды** под **ОПЕРАЦИИ**. Появится список доступных команд, выполняемых на виртуальной машине.

![Список команд запуска](./media/run-command/run-command-list.png)

Выберите команду для запуска. Некоторые команды могут иметь необязательные или требуемые входные параметры. Параметры для этих команд представлены в виде текстовых полей для ввода входных значений. В каждой команде можно развернуть **Просмотреть сценарий**, чтобы просмотреть выполняемый сценарий. **RunShellScript** отличается от других команд тем, что он позволяет предоставить пользовательский скрипт.

> [!NOTE]
> Встроенные команды не редактируются.

После выбора команды щелкните **Запуск** для выполнения сценария. Сценарий выполняется и по завершении выдает сообщения и возможные ошибки в окне вывода. На следующем снимке экрана показан пример вывода команды запуска **ifconfig**.

![Вывод сценария команды запуска](./media/run-command/run-command-script-output.png)

## <a name="available-commands"></a>Доступные команды

В этой таблице представлен список команд, доступных для виртуальных машин Linux. Команда **RunShellScript** может использоваться для выполнения любых скриптов.

|**Имя**|**Описание**|
|---|---|
|**RunShellScript**|Выполняет сценарий оболочки Linux.|
|**ifconfig**| Получает конфигурации всех сетевых интерфейсов.|

## <a name="limiting-access-to-run-command"></a>Ограничение доступа к команде запуска

Перечисление выполнение команд или отображение сведений о команде требуется `Microsoft.Compute/locations/runCommands/read` разрешение на уровне подписки, который встроенной [чтения](../../role-based-access-control/built-in-roles.md#reader) роли и более поздней версии.

Для выполнения команды необходимо `Microsoft.Compute/virtualMachines/runCommand/action` разрешение на уровне подписки, который [участник виртуальных машин](../../role-based-access-control/built-in-roles.md#virtual-machine-contributor) роли и более поздней версии.

Можно использовать одну из [встроенных](../../role-based-access-control/built-in-roles.md) ролей или создать [пользовательскую](../../role-based-access-control/custom-roles.md) роль для запуска команды.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о других способах для удаленного запуска скриптов и команд на виртуальной машине см. в разделе [Выполнение скриптов в виртуальных машинах Linux](run-scripts-in-vm.md).
