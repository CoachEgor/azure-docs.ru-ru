---
title: Руководство. Использование интегрированного пакета DevOps для IaaS и PaaS в Azure
description: Узнайте, как настроить непрерывную интеграцию (CI) и непрерывное развертывание (CD) приложения на виртуальных машинах Azure с помощью Azure Pipelines.
author: ushan
manager: jpconnock
tags: azure-devops-pipelines
ms.assetid: ''
ms.service: virtual-machines-linux
ms.topic: tutorial
ms.tgt_pltfrm: azure-pipelines
ms.workload: infrastructure
ms.date: 1/16/2020
ms.author: ushan
ms.custom: devops
ms.openlocfilehash: 4159bf27c39087926d982552c49c606f3484de77
ms.sourcegitcommit: d187fe0143d7dbaf8d775150453bd3c188087411
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80885911"
---
# <a name="tutorial-integrated-devops-for-iaas-and-paas-on-azure"></a>Руководство по Использование интегрированного пакета DevOps для IaaS и PaaS в Azure

Благодаря полнофункциональным решениям в Azure разработчики могут внедрять методики DevOps для любого этапа жизненного цикла приложения, включая планирование, разработку, доставку и эксплуатацию. 

Ниже перечислены некоторые службы Azure, которые упрощают облачные рабочие нагрузки и хорошо сочетаются, создавая невероятно мощные сценарии.
Эти технологии, используемые специалистами вместе с соответствующими процессами, повышают ценность предложений для клиентов. 

- Azure (https://portal.azure.com ) — портал для создания облачных рабочих нагрузок. Администрируйте и отслеживайте все решения, начиная от простых веб-приложений и заканчивая сложными облачными приложениями. 
- Azure DevOps (https://dev.azure.com ) — набор современных служб разработки оптимизирует планирование, улучшает взаимодействие и ускоряет доставку. 
- Студия Машинного обучения Azure (https://ml.azure.com ) — позволяет подготавливать данные, обучать и развертывать модели машинного обучения 
 

Azure DevOps — это встроенная служба Azure, которая автоматизирует выполнение каждой части процесса DevOps и применяет непрерывную интеграцию и непрерывную поставку для любого ресурса Azure.
Независимо от того, использует ли ваше приложение виртуальные машины, веб-приложения, Kubernetes или любой другой ресурс, вы можете реализовать подход "инфраструктура как код", включая непрерывную интеграцию, непрерывное тестирование, непрерывную поставку и непрерывный мониторинг с использованием Azure и Azure DevOps подход  
![AzDevOps_portalView](media/tutorial-devops-azure-pipelines-classic/azdevops-view.png) 
 
 
## <a name="iaas---configure-cicd"></a>IaaS — настройка CI/CD 
Azure Pipelines предоставляет комплексный и полнофункциональный набор инструментов для автоматизации CI/CD при развертывании на виртуальных машинах. Вы можете настроить конвейер непрерывной поставки для виртуальной машины Azure непосредственно на портале Azure. В этом документе описывается, как настроить конвейер CI/CD для развертываний с несколькими компьютерами с использованием портала Azure. 


**Настройка CI/CD для Виртуальных машин**

Виртуальные машины можно добавлять в качестве целевых объектов в [группу развертывания](https://docs.microsoft.com/azure/devops/pipelines/release/deployment-groups) и назначать для обновления на нескольких компьютерах. В зависимости от ваших требований можно выбрать одну из готовых стратегий развертывания — _последовательное_, _раннее_ или _развертывание по схеме Blue-Green_ — либо настроить их нужным образом. После того как вы выполните развертывание, вы сможете с помощью представлений журнала развертываний в группах развертывания отслеживать передачу данных с виртуальной машины в конвейер и затем на фиксацию. 
 
**Последовательные развертывания.** При последовательном развертывании экземпляры предыдущей версии приложения в каждой итерации заменяются экземплярами новой версии в фиксированном наборе виртуальных машин (наборе последовательного обновления). Давайте подробно рассмотрим процесс настройки последовательного обновления для виртуальных машин.  
Вы можете настроить последовательные обновления для **виртуальных машин** на портале Azure с помощью механизма непрерывной поставки. 

Ниже представлено пошаговое руководство. 
1. Войдите на портал Azure и перейдите к нужной виртуальной машине. 
2. На панели слева для виртуальной машины перейдите в меню  **Непрерывная поставка** . Затем щелкните  **Настроить**. 

   ![AzDevOps_configure](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure.png) 
3. На панели конфигурации щелкните "Организация Azure DevOps", чтобы выбрать существующую учетную запись или создать новую. Затем выберите проект, в котором вы хотите настроить конвейер.  


   ![AzDevOps_project](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling.png) 
4. Группа развертывания — это логический набор целевых компьютеров для развертывания, который представляет определенную физическую среду, например среду разработки, тестирования и пользовательского приемочного тестирования, а также рабочую среду. Вы можете создать новую группу развертывания или выбрать существующую. 
5. Выберите конвейер сборки, который публикует пакет для развертывания на виртуальной машине. Обратите внимание, что опубликованный пакет должен содержать скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке _deployscripts_ в корне пакета. Этот скрипт развертывания будет запущен конвейером Azure DevOps во время выполнения.
6. Выберите стратегию развертывания по своему усмотрению. В этом случае мы выберем вариант "Последовательное".
7. При желании можно присвоить компьютеру тег, обозначающий роль. Например, web или db. Это поможет выбрать виртуальные машины только с определенной ролью.
8. Щелкните **ОК** в диалоговом окне, чтобы настроить конвейер непрерывной поставки. 
9. Когда процесс завершится, вы получите конвейер непрерывной поставки, настроенный для развертывания на виртуальной машине.  


   ![AzDevOps_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-deployment-history.png)
10. Вы увидите, что на виртуальной машине выполняется развертывание. Можно щелкнуть ссылку, чтобы перейти к этому конвейеру. Щелкните **Release-1**, чтобы просмотреть развертывание. Можно также щелкнуть **Изменить**, чтобы изменить определение для конвейера выпуска. 
11. Если вам нужно настроить несколько виртуальных машин, повторите шаги 2–4 для добавления других виртуальных машин в группу развертывания. Обратите внимание, что при выборе группы развертывания, для которой уже существует выполнение конвейера, виртуальная машина будет добавлена в группу развертывания без создания новых конвейеров. 
12. Затем щелкните определение конвейера, перейдите к организации Azure DevOps и выберите **Изменить** для конвейера выпуска. 
   ![AzDevOps_edit_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling-pipeline.png)
13. Щелкните ссылку **1 задание, 1 задача** на этапе **Разработка**. Щелкните этап **Развертывание**.
   ![AzDevOps_deploymentGroup](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling-pipeline-tasks.png)
14. На панели конфигурации справа можно указать количество компьютеров, которые требуется развернуть параллельно в каждой итерации. Если вы хотите выполнить одновременное развертывание на нескольких компьютерах, можно задать значение в процентах с помощью ползунка.  

15. Задача по выполнению скрипта развертывания по умолчанию выполнит скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке _deployscripts_ корневого каталога опубликованного пакета.
  
**Ранние развертывания.** Раннее развертывание снижает риск, так как развертывание выполняется медленно для небольшой группы пользователей. Когда вы будете уверены в новой версии, ее можно будет выпустить на другие серверы в инфраструктуре, предоставив ее большему количеству пользователей. Вы можете настроить режим раннего развертывания для **виртуальных машин** на портале Azure, используя механизм непрерывной поставки. Ниже представлено пошаговое руководство. 
1. Войдите на портал Azure и перейдите к нужной виртуальной машине. 
2. Выполните шаги 2–7 из раздела **Последовательные развертывания**, чтобы добавить несколько виртуальных машин в группу развертывания. В раскрывающемся списке стратегий развертывания выберите вариант "Раннее".
![AzDevOps_configure_canary](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure-canary.png)

3. Добавьте тег canary для виртуальных машин, которые должны быть частью ранних развертываний, и тег prod для виртуальных машин, которые являются частью развертываний, выполняемых после успешного раннего развертывания.
4. Когда процесс завершится, вы получите конвейер непрерывной поставки, настроенный для развертывания на виртуальной машине.
![AzDevOps_canary_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-canary-pipeline.png)


5. Как и в случае с **последовательными развертываниями**, вы можете щелкнуть **Изменить** для конвейера выпуска в Azure DevOps, чтобы просмотреть конфигурацию конвейера. Конвейер состоит из трех этапов: первый — это этап группы развертывания, на котором выполняется развертывание на виртуальных машинах с тегом _canary_. На втором этапе конвейер приостанавливается и ожидает возобновления вручную. Если пользователь удовлетворен стабильностью раннего развертывания, выполнение конвейера можно возобновить, запустив третий этап, на котором выполняется развертывание на виртуальных машинах с тегом _prod_. ![AzDevOps_canary_task](media/tutorial-devops-azure-pipelines-classic/azure-devops-canary-task.png)



**Развертывания по схеме Blue-Green.** Такое развертывание сокращает время простоя при развертывании путем использования идентичной резервной среды. В любой момент времени одна из этих сред является активной. При подготовке к новому выпуску вы выполняете последний этап тестирования в зеленой среде. Когда программное обеспечение будет правильно работать в зеленой среде, переключите на нее весь трафик входящих запросов, и теперь синяя среда станет неактивной.
Вы можете настроить схему "Синее-зеленое" для **виртуальных машин** на портале Azure, используя механизм непрерывной поставки. 

Ниже представлено пошаговое руководство.

1. Войдите на портал Azure и перейдите к нужной виртуальной машине. 
2. Выполните шаги 2–7 из раздела **Последовательные развертывания**, чтобы добавить несколько виртуальных машин в группу развертывания. Добавьте тег blue или green к виртуальным машинам, для которых будет применяться схема развертывания Blue-Green. Если виртуальная машина предназначена для резервной роли, добавьте к ней тег green.
![AzDevOps_bluegreen_configure](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-configure.png)

4. Когда процесс завершится, вы получите конвейер непрерывной поставки, настроенный для развертывания на виртуальной машине.
![AzDevOps_bluegreen_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-pipeline.png)

5. Как и в случае с **последовательными развертываниями**, вы можете щелкнуть **Изменить** для конвейера выпуска в Azure DevOps, чтобы просмотреть конфигурацию конвейера. Конвейер состоит из трех этапов: первый — это этап группы развертывания, на котором выполняется развертывание на виртуальных машинах с тегом _green_ (резервные виртуальные машины). На втором этапе конвейер приостанавливается и ожидает возобновления посредством вмешательства вручную. Если пользователь удовлетворен стабильностью развертывания, трафик можно перенаправить на виртуальные машины с тегом _green_ и возобновить выполнение конвейера, который затем поменяет местами теги _blue_ и _green_ для виртуальных машин. Это гарантирует, что виртуальные машины с более старой версией приложения будут иметь тег _green_ и будут развернуты при следующем выполнении конвейера.
![AzDevOps_bluegreen_task](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-tasks.png)

6. Обратите внимание, что такая стратегия развертывания требует наличия по меньшей мере одной виртуальной машины с тегом blue и одной виртуальной машины с тегом green. Убедитесь, что перед возобновлением выполнения конвейера на шаге вмешательства вручную у вас есть хотя бы одна виртуальная машина с тегом _blue_.





 
## <a name="azure-devops-project"></a>Azure DevOps Projects 
Начать работу с Azure теперь стало еще проще.
 
С помощью Azure DevOps Projects вы можете запустить приложение в любой службе Azure, выполнив всего три шага: выбрав язык приложения, среду разработки и службу Azure.
 
[Подробнее](https://azure.microsoft.com/features/devops-projects/ ).
 
## <a name="additional-resources"></a>Дополнительные ресурсы 
- [Руководство по развертыванию приложения ASP.NET на виртуальных машинах Azure с помощью Azure DevOps Projects](https://docs.microsoft.com/azure/devops-project/azure-devops-project-vms)
- [Реализация непрерывного развертывания приложения в масштабируемом наборе виртуальных машин Azure](https://docs.microsoft.com/azure/devops/pipelines/apps/cd/azure/deploy-azure-scaleset)
