---
title: Руководство. Настройка последовательного развертывания для Виртуальных машины Linux
description: Из этого учебника вы узнаете, как настроить конвейер непрерывного развертывания (CD), который постепенно обновляет группу Виртуальных машин Linux с помощью стратегии последовательного развертывания.
author: moala
manager: jpconnock
tags: azure-devops-pipelines
ms.assetid: ''
ms.service: virtual-machines-linux
ms.topic: tutorial
ms.tgt_pltfrm: azure-pipelines
ms.workload: infrastructure
ms.date: 4/10/2020
ms.author: moala
ms.custom: devops
ms.openlocfilehash: 75888b1ebbda33891296fe0b54c5d204955e32a3
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82113495"
---
# <a name="tutorial---configure-rolling-deployment-strategy-for-azure-linux-virtual-machines"></a>Руководство. Настройка стратегии последовательного развертывания для Виртуальных машин Linux

Azure DevOps — это встроенная служба Azure, которая автоматизирует выполнение каждой части процесса DevOps и применяет непрерывную интеграцию и непрерывную поставку для любого ресурса Azure.
Независимо от того, использует ли ваше приложение виртуальные машины, веб-приложения, Kubernetes или любой другой ресурс, вы можете реализовать подход "инфраструктура как код", включая непрерывную интеграцию, непрерывное тестирование, непрерывную поставку и непрерывный мониторинг с использованием Azure и Azure DevOps.  

![AzDevOps_portalView](media/tutorial-devops-azure-pipelines-classic/azdevops-view.png) 


## <a name="iaas---configure-cicd"></a>IaaS — настройка CI/CD 
Azure Pipelines предоставляет комплексный и полнофункциональный набор инструментов для автоматизации CI/CD при развертывании на виртуальных машинах. Вы можете настроить конвейер непрерывной поставки для виртуальной машины Azure непосредственно на портале Azure. В этом документе описывается, как настроить конвейер CI/CD для последовательных развертываний с несколькими компьютерами с портала Azure. Вы также можете ознакомиться с другими стратегиями, такими как [canary](https://aka.ms/AA7jdrz) и [blue-green](https://aka.ms/AA83fwu), которые поддерживаются по умолчанию на портале Azure. 


**Настройка CI/CD для Виртуальных машин**

Виртуальные машины можно добавлять в качестве целевых объектов в [группу развертывания](https://docs.microsoft.com/azure/devops/pipelines/release/deployment-groups) и назначать для обновления на нескольких компьютерах. После того как вы выполните развертывание, с помощью **журнала развертываний** в группе развертывания можно отслеживать передачу данных с виртуальной машины в конвейер и затем на фиксацию. 
 

**Последовательные развертывания.** При последовательном развертывании экземпляры предыдущей версии приложения в каждой итерации заменяются экземплярами новой версии в фиксированном наборе виртуальных машин (наборе последовательного обновления). Давайте подробно рассмотрим процесс настройки последовательного обновления для виртуальных машин.  
Вы можете настроить последовательные обновления для **виртуальных машин** на портале Azure с помощью механизма непрерывной поставки. 

Ниже представлено пошаговое руководство. 
1. Войдите на портал Azure и перейдите к нужной виртуальной машине. 
2. На панели слева для виртуальной машины перейдите в меню  **Непрерывная поставка** . Затем щелкните  **Настроить**. 

   ![AzDevOps_configure](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure.png) 
3. На панели конфигурации щелкните "Организация Azure DevOps", чтобы выбрать существующую учетную запись или создать новую. Затем выберите проект, в котором вы хотите настроить конвейер.  


   ![AzDevOps_project](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling.png) 
4. Группа развертывания — это логический набор целевых компьютеров для развертывания, который представляет определенную физическую среду, например среду разработки, тестирования и пользовательского приемочного тестирования, а также рабочую среду. Вы можете создать новую группу развертывания или выбрать существующую. 
5. Выберите конвейер сборки, который публикует пакет для развертывания на виртуальной машине. Обратите внимание, что опубликованный пакет должен содержать скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке `deployscripts` в корне пакета. Этот скрипт развертывания будет запущен конвейером Azure DevOps во время выполнения.
6. Выберите стратегию развертывания по своему усмотрению. В этом случае мы выберем вариант "Последовательное".
7. При желании можно присвоить компьютеру тег, обозначающий роль. Например, web или db. Это поможет выбрать виртуальные машины только с определенной ролью.
8. Щелкните **ОК** в диалоговом окне, чтобы настроить конвейер непрерывной поставки. 
9. Когда процесс завершится, вы получите конвейер непрерывной поставки, настроенный для развертывания на виртуальной машине.  


   ![AzDevOps_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-deployment-history.png)
10. Вы увидите, что на виртуальной машине выполняется развертывание. Можно щелкнуть ссылку, чтобы перейти к этому конвейеру. Щелкните **Release-1**, чтобы просмотреть развертывание. Можно также щелкнуть **Изменить**, чтобы изменить определение для конвейера выпуска. 
11. Если вам нужно настроить несколько виртуальных машин, повторите шаги 2–4 для добавления других виртуальных машин в группу развертывания. Обратите внимание, что при выборе группы развертывания, для которой уже существует выполнение конвейера, виртуальная машина будет добавлена в группу развертывания без создания новых конвейеров. 
12. Затем щелкните определение конвейера, перейдите к организации Azure DevOps и выберите **Изменить** для конвейера выпуска. 
   ![AzDevOps_edit_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling-pipeline.png)
13. Щелкните ссылку **1 задание, 1 задача** на этапе **Разработка**. Щелкните этап **Развертывание**.
   ![AzDevOps_deploymentGroup](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling-pipeline-tasks.png)
14. На панели конфигурации справа можно указать количество компьютеров, которые требуется развернуть параллельно в каждой итерации. Если вы хотите выполнить одновременное развертывание на нескольких компьютерах, можно задать значение в процентах с помощью ползунка.  

15. Задача по выполнению скрипта развертывания по умолчанию выполнит скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке "deployscripts" корневого каталога опубликованного пакета.  
![AzDevOps_publish_package](media/tutorial-deployment-strategy/package.png)

## <a name="other-deployment-strategies"></a>Другие стратегии развертывания

- [Настройка стратегии развертывания Canary](https://aka.ms/AA7jdrz)
- [Настройка стратегии развертывания по схеме Blue-Green](https://aka.ms/AA83fwu)

 
## <a name="azure-devops-project"></a>Azure DevOps Projects 
Начать работу с Azure теперь стало еще проще.
 
С помощью Azure DevOps Projects вы можете запустить приложение в любой службе Azure, выполнив всего три шага: выбрав язык приложения, среду разработки и службу Azure.
 
[Подробнее](https://azure.microsoft.com/features/devops-projects/ ).
 
## <a name="additional-resources"></a>Дополнительные ресурсы 
- [Руководство по развертыванию приложения ASP.NET на виртуальных машинах Azure с помощью Azure DevOps Projects](https://docs.microsoft.com/azure/devops-project/azure-devops-project-vms)
- [Реализация непрерывного развертывания приложения в масштабируемом наборе виртуальных машин Azure](https://docs.microsoft.com/azure/devops/pipelines/apps/cd/azure/deploy-azure-scaleset)
