---
title: Инфраструктура обновления Red Hat Update Infrastructure | Документация Майкрософт
description: Узнайте об инфраструктуре обновления Red Hat Update Infrastructure для предоставляемых по запросу экземпляров Red Hat Enterprise Linux в Microsoft Azure.
services: virtual-machines-linux
documentationcenter: ''
author: asinn826
manager: BorisB2015
editor: ''
ms.assetid: f495f1b4-ae24-46b9-8d26-c617ce3daf3a
ms.service: virtual-machines-linux
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 6/6/2019
ms.author: borisb
ms.openlocfilehash: 6b332af53f421230b3fb5401e525bd77c5e87ed9
ms.sourcegitcommit: 44e85b95baf7dfb9e92fb38f03c2a1bc31765415
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2019
ms.locfileid: "70081383"
---
# <a name="red-hat-update-infrastructure-for-on-demand-red-hat-enterprise-linux-vms-in-azure"></a>Red Hat Update Infrastructure для предоставляемых по запросу виртуальных машин Red Hat Enterprise Linux в Azure
 [Red Hat Update Infrastructure](https://access.redhat.com/products/red-hat-update-infrastructure) (RHUI) позволяет поставщикам облачных служб (например, Azure) создавать зеркальные копии размещенного с помощью Red Hat содержимого репозитория, создавать пользовательские репозитории с содержимым для Azure и предоставлять пользовательским виртуальным машинам доступ к этому содержимому.

Образы Red Hat Enterprise Linux (RHEL) с оплатой по мере использования (PAYG) предварительно настроены для доступа к Azure RHUI. Никаких дополнительных настроек не требуется. Чтобы получить последние обновления, выполните `sudo yum update`, когда экземпляр RHEL будет готов. Плата за эту службу входит в стоимость программного обеспечения RHEL (PAYG).

Дополнительные сведения об образах RHEL в Azure, включая политики публикации и хранения, можно найти [здесь](./rhel-images.md).

Сведения о политиках поддержки Red Hat для всех версий RHEL можно найти на странице [о жизненных циклах выпусков Red Hat Enterprise Linux](https://access.redhat.com/support/policy/updates/errata).

## <a name="important-information-about-azure-rhui"></a>Важные сведения об Azure RHUI

* Azure RHUI — это инфраструктура обновления, которая поддерживает все виртуальные машины RHEL PAYG, созданные в Azure. Это не позволит вам зарегистрировать виртуальные машины PAYG RHEL с помощью диспетчера подписки или вспомогательного или другого источника обновлений, но это приведет к непрямой двойной оплате с помощью виртуальной машины PAYG. Дополнительные сведения см. в следующей точке.
* В стоимость образа RHEL (PAYG) входит плата за доступ к инфраструктуре RHUI, размещенной в Azure. Отмена регистрации виртуальной машины RHEL (PAYG) в инфраструктуре RHUI в Azure не приведет к ее преобразованию в виртуальную машину с использованием собственной лицензии (BYOL). В случае регистрации одной и той же виртуальной машины в другом источнике обновлений вы можете нести двойные _косвенные_ расходы. Первая плата будет взиматься за использование программного обеспечения Azure RHEL. Вторая плата будет взиматься за подписки Red Hat, которые были приобретены ранее. Если вам постоянно требуется использовать инфраструктуру обновления, отличную от RHUI, размещенной в Azure, рассмотрите возможность регистрации для использования [образов BYOS RHEL](https://aka.ms/rhel-byos).

* Образы RHEL (SAP PAYG) в Azure (RHEL for SAP, RHEL for SAP HANA и RHEL for SAP Business Applications) подключаются к выделенным каналам RHUI, которые остаются на определенной версии RHEL с дополнительным номером, что требуется для сертификации SAP.

* Доступ к размещенной в Azure инфраструктуре RHUI могут получать виртуальные машины с IP-адресами в рамках [диапазонов IP-адресов центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653). Если весь трафик виртуальной машины перенаправляется через локальную сетевую инфраструктуру, может потребоваться настройка определяемых пользователем маршрутов, чтобы виртуальные машины RHEL (PAYG) могли получить доступ к инфраструктуре RHUI в Azure. В этом случае необходимо добавить определяемые пользователем маршруты для _всех_ IP-адресов RHUI.

## <a name="image-update-behavior"></a>Поведение при обновлении изображения

По состоянию на апрель 2019 в Azure есть образы RHEL, которые подключены к репозиториям расширенной поддержки обновлений (ЕУС) по умолчанию и RHEL, которые подключены к обычным (не ЕУС) репозиториям по умолчанию. Дополнительные сведения о RHEL ЕУС см. в документации [по жизненному циклу версий](https://access.redhat.com/support/policy/updates/errata) Red Hat и в [документации ЕУС](https://access.redhat.com/articles/rhel-eus). Поведение `sudo yum update` по умолчанию зависит от того, какой образ RHEL вы подготовили, поскольку разные образы подключены к разным репозиториям.

Для полного списка образов выполните команду `az vm image list --publisher redhat --all` , используя Azure CLI.

### <a name="images-connected-to-non-eus-repositories"></a>Образы, подключенные к репозиториям, отличным от ЕУС

Если вы подготавливаете виртуальную машину из образа RHEL, подключенного к репозиториям, отличным от ЕУС, при запуске `sudo yum update`вы будете обновлены до последней версии RHEL. Например, если вы подготавливаете виртуальную машину из образа RHEL 7,4 и запуститее `sudo yum update`, то в итоге появится виртуальная машина RHEL 7,7 (последняя дополнительная версия в семействе RHEL7).

Образы, подключенные к репозиториям, отличным от ЕУС, не будут содержать дополнительный номер версии в номере SKU. Номер SKU — третий элемент в URN (полное имя образа). Например, все приведенные ниже образы присоединяются к репозиториям, отличным от ЕУС.

```text
RedHat:RHEL:7-LVM:7.4.2018010506
RedHat:RHEL:7-LVM:7.5.2018081518
RedHat:RHEL:7-LVM:7.6.2019062414
RedHat:RHEL:7-RAW:7.4.2018010506
RedHat:RHEL:7-RAW:7.5.2018081518
RedHat:RHEL:7-RAW:7.6.2019062120
```

Обратите внимание, что номера SKU: 7-LVM или 7-RAW. Дополнительный номер версии указывается в версии (Четвертый элемент в URN) этих изображений.

### <a name="images-connected-to-eus-repositories"></a>Образы, подключенные к репозиториям ЕУС

При подготовке виртуальной машины из образа RHEL, подключенного к репозиториям ЕУС, вы не будете обновлять до последней версии RHEL во время выполнения `sudo yum update`. Это связано с тем, что образы, подключенные к репозиториям ЕУС, также будут заблокированы до определенной дополнительной версии.

Образы, подключенные к репозиториям ЕУС, будут содержать дополнительный номер версии в номере SKU. Например, все приведенные ниже образы присоединяются к репозиториям ЕУС:

```text
RedHat:RHEL:7.4:7.4.2019062107
RedHat:RHEL:7.5:7.5.2019062018
RedHat:RHEL:7.6:7.6.2019062116
```

## <a name="rhel-eus-and-version-locking-rhel-vms"></a>Предложение RHEL EUS и фиксация версии виртуальных машин RHEL

Некоторым клиентам может потребоваться блокировать виртуальные машины RHEL в определенный RHEL дополнительный выпуск после подготовки виртуальной машины. Вы можете зафиксировать определенный дополнительный номер версии для виртуальной машины RHEL, изменив репозитории таким образом, чтобы они указывали на репозитории Extended Update Support (EUS). Можно также отменить операцию блокировки ЕУС версии.

>[!NOTE]
> ЕУС не поддерживается в Дополнениех RHEL. Это означает, что если вы устанавливаете пакет, который обычно доступен в канале RHEL, вы не сможете сделать это на ЕУС. Дополнительные сведения о жизненном цикле продукта Red Hat см. [здесь](https://access.redhat.com/support/policy/updates/extras/).

На момент написания этой статьи поддержка ЕУС была завершена для RHEL < = 7,3. Дополнительные сведения см. в разделе "дополнительные компоненты поддержки Red Hat Enterprise Linux" в [документации по Red Hat](https://access.redhat.com/support/policy/updates/errata/) .
* RHEL 7,4 ЕУС поддержка заканчивается 31 августа 2019 г.
* Поддержка RHEL 7,5 ЕУС заканчивается 30 апреля 2020
* RHEL 7,6 ЕУС поддержка заканчивается 31 октября 2020 г.
* Поддержка RHEL 7,7 ЕУС заканчивается 30 августа 2021

### <a name="switch-a-rhel-vm-to-eus-version-lock-to-a-specific-minor-version"></a>Переключение виртуальной машины RHEL в ЕУС (Блокировка версии на конкретную промежуточную версию)
Используйте приведенные ниже инструкции, чтобы заблокировать виртуальную машину RHEL в определенном вспомогательном выпуске (Запуск от имени root):

>[!NOTE]
> Это применяется только для версий RHEL, для которых доступна EUS. На момент написания этой статьи сюда входит RHEL 7.2-7.7. Дополнительные сведения можно найти на странице [Red Hat Enterprise Linux Life Cycle](https://access.redhat.com/support/policy/updates/errata) (Жизненный цикл Red Hat Enterprise Linux).

1. Отключите репозитории без поддержки EUS:
    ```bash
    yum --disablerepo='*' remove 'rhui-azure-rhel7'
    ```

1. Добавьте репозитории EUS:
    ```bash
    yum --config='https://rhelimage.blob.core.windows.net/repositories/rhui-microsoft-azure-rhel7-eus.config' install 'rhui-azure-rhel7-eus'
    ```

1. Блокировка переменной релеасевер (Запуск от имени привилегированного пользователя):
    ```bash
    echo $(. /etc/os-release && echo $VERSION_ID) > /etc/yum/vars/releasever
    ```

    >[!NOTE]
    > Выполнив приведенные выше инструкции, вы зафиксируете текущий дополнительный номер версии в качестве дополнительного номера версии RHEL. Введите конкретный дополнительный номер версии, если вам нужно обновить систему и зафиксировать дополнительный номер версии, который не является последним. Например, команда `echo 7.5 > /etc/yum/vars/releasever` зафиксирует версию RHEL 7.5

1. Обновление виртуальной машины RHEL
    ```bash
    sudo yum update
    ```

### <a name="switch-a-rhel-vm-back-to-non-eus-remove-a-version-lock"></a>Переключение виртуальной машины RHEL обратно на non-ЕУС (удаление блокировки версии)
Выполните следующую команду в качестве корневого:
1. Удалите файл релеасевер:
    ```bash
    rm /etc/yum/vars/releasever
     ```

1. Отключите репозиториев ЕУС:
    ```bash
    yum --disablerepo='*' remove 'rhui-azure-rhel7-eus'
   ```

1. Настройка виртуальной машины RHEL
    ```bash
    yum --config='https://rhelimage.blob.core.windows.net/repositories/rhui-microsoft-azure-rhel7.config' install 'rhui-azure-rhel7'
    ```
    
1. Обновление виртуальной машины RHEL
    ```bash
    sudo yum update
    ```

## <a name="the-ips-for-the-rhui-content-delivery-servers"></a>IP-адреса для серверов доставки содержимого RHUI

Инфраструктура RHUI поддерживается во всех регионах, где доступны предоставляемые по запросу образы RHEL. Сейчас в этот список входят общедоступные регионы, указанные на странице [состояния Azure](https://azure.microsoft.com/status/), регионы, обслуживающие государственные организации США, и регионы Microsoft Azure — Германия.

При использовании конфигурации сети для усиленного ограничения доступа с виртуальных машин RHEL (PAYG) убедитесь, что для приведенных ниже IP-адресов разрешена операция `yum update`, в зависимости от используемой среды.


```
# Azure Global
13.91.47.76
40.85.190.91
52.187.75.218
52.174.163.213
52.237.203.198

# Azure US Government
13.72.186.193
13.72.14.155
52.244.249.194

# Azure Germany
51.5.243.77
51.4.228.145
```

## <a name="azure-rhui-infrastructure"></a>Инфраструктура RHUI Azure


### <a name="update-expired-rhui-client-certificate-on-a-vm"></a>Обновление сертификата клиента RHUI с истекшим сроком действия на виртуальной машине

Если вы используете одну из предыдущих версий образа виртуальной машины RHEL, например RHEL 7.4 (URN образа: `RedHat:RHEL:7.4:7.4.2018010506`), будут возникать проблемы с подключением к инфраструктуре RHUI из-за просроченного SSL-сертификата клиента. Ошибка, которую вы увидите, может иметь вид _"Кэширующий узел SSL отклонил сертификат, срок действия которого истек"_ или _"Ошибка: Не удалось получить метаданные репозитория (repomd.xml) для репозитория:... Проверьте указанный путь и повторите попытку"_ . Чтобы решить эту проблему, обновите пакет клиента RHUI на виртуальной машине, используя следующую команду.

```bash
sudo yum update -y --disablerepo='*' --enablerepo='*microsoft*'
```

Кроме того, с помощью команды `sudo yum update` можно также обновить пакет сертификата клиента (в зависимости от версии RHEL), несмотря на ошибки "Срок действия SSL-сертификата истек", которые будут отображаться для других репозиториев. После успешного обновления нормальное подключение к другим репозиториям RHUI должно быть восстановлено, как и возможность успешного выполнения команды `sudo yum update`.

Если во время `yum update`выполнения возникла ошибка 404, попробуйте выполнить следующие действия, чтобы обновить кэш Yum:
```bash
sudo yum clean all;
sudo yum makecache
```

### <a name="troubleshoot-connection-problems-to-azure-rhui"></a>Устранение неполадок подключения к инфраструктуре RHUI в Azure
Если вы столкнулись с проблемами при подключении к инфраструктуре RHUI в Azure с виртуальной машины RHEL (PAYG) в Azure, выполните следующие действия.

1. Проверьте конфигурацию виртуальной машины для конечной точки RHUI в Azure.

    1. Проверьте, содержит ли файл `/etc/yum.repos.d/rh-cloud.repo` ссылку на `rhui-[1-3].microsoft.com` в `baseurl` раздела `[rhui-microsoft-azure-rhel*]`. Если это так, то вы используете новую версию инфраструктуры RHUI Azure.

    1. Если он указывает на расположение с помощью шаблона `mirrorlist.*cds[1-4].cloudapp.net`, то требуется обновить конфигурацию. Вы используете устаревший моментальный снимок виртуальной машины. Его нужно обновить, чтобы в файле было указано расположение новой версии инфраструктуры RHUI в Azure.

1. Доступ к размещенной в Azure инфраструктуре RHUI могут получать только виртуальные машины с [IP-адресами в диапазонах центра обработки данных Azure](https://www.microsoft.com/download/details.aspx?id=41653).

1. Если вы убедились, что IP-адрес подключаемой виртуальной машины находится в диапазоне IP-адресов Azure, но при использовании новой конфигурации вам по-прежнему не удается подключиться к инфраструктуре RHUI в Azure, обратитесь в службу поддержки Майкрософт или Red Hat.

### <a name="infrastructure-update"></a>Обновление инфраструктуры

В сентябре 2016 года была развернута обновленная инфраструктура RHUI в Azure. В апреле 2017 года работа старой инфраструктуры RHUI в Azure была завершена. Если вы использовали образы RHEL (PAYG) либо их моментальные снимки с сентября 2016 года или более позднего времени, вы автоматически подключились к новой версии инфраструктуры RHUI в Azure. Но если у вас есть более старые моментальные снимки виртуальных машин, их конфигурации необходимо обновить вручную, чтобы обеспечить доступ к инфраструктуре RHUI в Azure, как описано в следующем разделе.

Новые серверы RHUI в Azure развертываются с помощью [диспетчера трафика Azure](https://azure.microsoft.com/services/traffic-manager/). В диспетчере трафика одну конечную точку (rhui-1.microsoft.com) может использовать любая виртуальная машина независимо от региона.

### <a name="manual-update-procedure-to-use-the-azure-rhui-servers"></a>Процедура обновления вручную для использования серверов Azure RHUI
Эта процедура приводится только для справки. Образы RHEL (PAYG) уже содержат правильную конфигурацию для подключения к инфраструктуре RHUI в Azure. Чтобы вручную обновить конфигурацию для использования серверов RHUI в Azure, выполните следующие действия.

- Для RHEL 6:
  ```bash
  yum --config='https://rhelimage.blob.core.windows.net/repositories/rhui-microsoft-azure-rhel6.config' install 'rhui-azure-rhel6'
  ```

- Для RHEL 7:
  ```bash
  yum --config='https://rhelimage.blob.core.windows.net/repositories/rhui-microsoft-azure-rhel7.config' install 'rhui-azure-rhel7'
  ```

## <a name="next-steps"></a>Следующие шаги
* Сведения о создании виртуальной машины Red Hat Enterprise Linux на основе образа с оплатой по мере использования (PAYG) и о применении размещенной в Azure инфраструктуры RHUI см. на странице [Azure Marketplace](https://azure.microsoft.com/marketplace/partners/redhat/).
* Дополнительные сведения об образах Red Hat в Azure можно найти на [странице документации](./rhel-images.md).
* Сведения о политиках поддержки Red Hat для всех версий RHEL можно найти на странице [о жизненных циклах выпусков Red Hat Enterprise Linux](https://access.redhat.com/support/policy/updates/errata).
