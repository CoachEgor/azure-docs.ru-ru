---
title: Руководство. Настройка развертывания canary для Виртуальных машин Linux
description: Из этого учебника вы узнаете, как настроить конвейер непрерывного развертывания (CD), который обновляет группу виртуальных машин Azure с помощью стратегии развертывания blue-green.
author: moala
manager: jpconnock
tags: azure-devops-pipelines
ms.assetid: ''
ms.service: virtual-machines-linux
ms.topic: tutorial
ms.tgt_pltfrm: azure-pipelines
ms.workload: infrastructure
ms.date: 4/10/2020
ms.author: moala
ms.custom: devops
ms.openlocfilehash: b1a57245434bb188ffaab56a8891b4b0ee27f044
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82120552"
---
# <a name="tutorial---configure-blue-green-deployment-strategy-for-azure-linux-virtual-machines"></a>Руководство. Настройка стратегии развертывания Blue-Green для Виртуальных машин Linux


## <a name="iaas---configure-cicd"></a>IaaS — настройка CI/CD 
Azure Pipelines предоставляет комплексный и полнофункциональный набор инструментов для автоматизации CI/CD при развертывании на виртуальных машинах. Вы можете настроить конвейер непрерывной поставки для виртуальной машины Azure непосредственно на портале Azure. В этом документе описывается, как настроить конвейер CI/CD, который использует стратегию blue-green для развертываний с несколькими компьютерами. Вы также можете ознакомиться с другими стратегиями, такими как [последовательное развертывание](https://aka.ms/AA7jlh8) и [развертывание canary](https://aka.ms/AA7jdrz), которые поддерживаются по умолчанию на портале Azure. 

 
 **Настройка CI/CD для Виртуальных машин**

Виртуальные машины можно добавлять в качестве целевых объектов в [группу развертывания](https://docs.microsoft.com/azure/devops/pipelines/release/deployment-groups) и назначать для обновления на нескольких компьютерах. После того как вы выполните развертывание, просмотр **журнала развертываний** в группе развертывания поможет отслеживать передачу данных с виртуальной машины в конвейер и затем на фиксацию. 
 
  
**Развертывания по схеме Blue-Green.** Такое развертывание сокращает время простоя при развертывании путем использования идентичной резервной среды. В любой момент времени одна из этих сред является активной. При подготовке к новому выпуску вы выполняете последний этап тестирования в зеленой среде. Когда программное обеспечение будет правильно работать в зеленой среде, переключите на нее весь трафик входящих запросов, и теперь синяя среда станет неактивной.
Вы можете настроить схему "Синее-зеленое" для **виртуальных машин** на портале Azure, используя механизм непрерывной поставки. 

Ниже представлено пошаговое руководство.

1. Войдите на портал Azure и перейдите к нужной виртуальной машине. 
2. В левой области виртуальной машины перейдите к пункту **Непрерывная поставка**. Затем нажмите кнопку **Настройка**. 

   ![AzDevOps_configure](media/tutorial-devops-azure-pipelines-classic/azure-devops-configure.png) 
3. На панели конфигурации щелкните **Организация Azure DevOps**, чтобы выбрать существующую учетную запись или создать новую. Затем выберите проект, в котором вы хотите настроить конвейер.  


   ![AzDevOps_project](media/tutorial-devops-azure-pipelines-classic/azure-devops-rolling.png) 
4. Группа развертывания — это логический набор целевых компьютеров для развертывания, который представляет определенную физическую среду, например среду разработки, тестирования и пользовательского приемочного тестирования, а также рабочую среду. Вы можете создать новую группу развертывания или выбрать существующую. 
5. Выберите конвейер сборки, который публикует пакет для развертывания на виртуальной машине. Обратите внимание, что опубликованный пакет должен содержать скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке `deployscripts` в корне пакета. Этот скрипт развертывания будет запущен конвейером Azure DevOps во время выполнения.
6. Выберите стратегию развертывания по своему усмотрению. Выберите **Blue-Green**.
7. Добавьте тег blue или green к виртуальным машинам, для которых будет применяться схема развертывания Blue-Green. Если виртуальная машина предназначена для резервной роли, добавьте к ней тег "green". В противном случае добавьте тег "blue".
![AzDevOps_bluegreen_configure](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-configure.png)

8. Щелкните **ОК**, чтобы настроить конвейер непрерывной поставки. Теперь вы получите конвейер непрерывной поставки, настроенный для развертывания на виртуальной машине.
![AzDevOps_bluegreen_pipeline](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-pipeline.png)


9. Щелкните **Изменить** для конвейера выпуска в Azure DevOps, чтобы просмотреть конфигурацию конвейера. Конвейер состоит из трех этапов. Первый — это этап группы развертывания, на котором выполняется развертывание на виртуальных машинах с тегом _green_ (резервные ВМ). На втором этапе конвейер приостанавливается и ожидает возобновления посредством вмешательства вручную. Если пользователь удовлетворен стабильностью развертывания, трафик можно перенаправить на виртуальные машины с тегом _green_ и возобновить выполнение конвейера, который затем поменяет местами теги _blue_ и _green_ для виртуальных машин. Это гарантирует, что виртуальные машины с более старой версией приложения будут иметь тег _green_ и будут развернуты при следующем выполнении конвейера.
![AzDevOps_bluegreen_task](media/tutorial-devops-azure-pipelines-classic/azure-devops-blue-green-tasks.png)


10. Задача по выполнению скрипта развертывания по умолчанию выполнит скрипт развертывания _deploy.ps1_ или _deploy.sh_ в папке `deployscripts` корневого каталога опубликованного пакета. Убедитесь, что выбранный конвейер сборки публикует его в корневом каталоге пакета.
![AzDevOps_publish_package](media/tutorial-deployment-strategy/package.png)




## <a name="other-deployment-strategies"></a>Другие стратегии развертывания
- [Настройка стратегии последовательного развертывания](https://aka.ms/AA7jlh8)
- [Настройка стратегии развертывания Canary](https://aka.ms/AA7jdrz)

## <a name="azure-devops-project"></a>Azure DevOps Projects 
Начать работу с Azure теперь стало еще проще.
 
С помощью Azure DevOps Projects вы можете запустить приложение в любой службе Azure, выполнив всего три шага: выбрав язык приложения, среду разработки и службу Azure.
 
[Подробнее](https://azure.microsoft.com/features/devops-projects/ ).
 
## <a name="additional-resources"></a>Дополнительные ресурсы 
- [Руководство по развертыванию приложения ASP.NET на виртуальных машинах Azure с помощью Azure DevOps Projects](https://docs.microsoft.com/azure/devops-project/azure-devops-project-vms)
- [Реализация непрерывного развертывания приложения в масштабируемом наборе виртуальных машин Azure](https://docs.microsoft.com/azure/devops/pipelines/apps/cd/azure/deploy-azure-scaleset)
