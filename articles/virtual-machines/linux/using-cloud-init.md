---
title: Обзор облачной поддержки Linux VMs в Azure
description: Обзор возможностей облачного инаугов для настройки VM во время подготовки в Azure.
services: virtual-machines-linux
documentationcenter: ''
author: danielsollondon
manager: gwallace
editor: ''
tags: azure-resource-manager
ms.assetid: 195c22cd-4629-4582-9ee3-9749493f1d72
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: azurecli
ms.topic: article
ms.date: 01/23/2019
ms.author: danis
ms.openlocfilehash: 1f0395956fa6977be5d1d6f4f4faf06b84c094d8
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79465045"
---
# <a name="cloud-init-support-for-virtual-machines-in-azure"></a>поддержка облачных технологий для виртуальных машин в Azure
В этой статье объясняется поддержка, которая существует для [облачного инаки](https://cloudinit.readthedocs.io) для настройки виртуальной машины (VM) или виртуальных наборов масштабов машин во время подготовки в Azure. Эти конфигурации облачного инау работают при первой загрузке после того, как ресурсы будут подготовлены Azure.  

VM Provisioning — это процесс, в котором Azure передаст значения параметров VM Create, такие как имя хоста, имя пользователя, пароль и т.д., и сделает их доступными для VM по мере загрузки. "Агент подготовки" будет потреблять эти значения, настраивать VM и отчитываться о завершении. 

Azure поддерживает два агента [подготовки облачных ивитов](https://cloudinit.readthedocs.io)и [Azure Linux Agent (WALA).](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-linux)

## <a name="cloud-init-overview"></a>обзор облачных инов
[облако-init](https://cloudinit.readthedocs.io) широко используется подход для настройки Linux VM, как он загружается в первый раз. Вы можете использовать cloud-init для установки пакетов, записи файлов или настройки пользователей и параметров безопасности. Так как cloud-init вызывается при начальной загрузке, к вашей конфигурации не нужно применять какие-либо дополнительные действия или агентов.  Для получения дополнительной информации `#cloud-config` о том, как правильно [cloud-init documentation site](https://cloudinit.readthedocs.io/en/latest/topics/format.html#cloud-config-data)форматировать файлы или другие входные данные, см.  Файлы `#cloud-config` — это текстовые файлы, закодированные в формате base64.

облако-инит также работает в разных дистрибутивах. Например, для установки пакета не используется **apt-get install** или **yum install**. Вместо этого можно определить список пакетов для установки. cloud-init автоматически использует инструмент управления нативным пакетом для выбранного вами дистро.

Мы активно сотрудничаем с нашими утвержденными партнерами, работающими над дистрибутивами Linux, чтобы образы с поддержкой cloud-init стали доступными в Azure Marketplace. Эти образы обеспечивают бесперебойную работу развертываний и конфигураций cloud-init с виртуальными машинами и масштабируемыми наборами виртуальных машин. Сначала мы сотрудничаем с одобренными партнерами Linux distro и вверх по течению, чтобы обеспечить функции облачного инаит с ОС на Azure, затем пакеты обновляются и становятся общедоступными в репозиториях пакетов дистро. 

Существует два этапа, чтобы сделать облачность доступной для одобренной Linux distro OS на Azure, поддержку пакетов, а затем поддержку изображений:
* Поддержка пакетов cloud-init в документах Azure, которые поддерживаются или находятся в предварительном просмотре, так что эти пакеты можно использовать с ОС в пользовательском изображении.
* Документы «облако изображения готовы», если изображение уже настроено для использования облачного инита.


### <a name="canonical"></a>Canonical
| Издатель / Версия| ПРЕДЛОЖЕНИЕ | номер SKU | Версия | изображение облачно-иту готов | поддержка пакетов облачных вычислений в Azure|
|:--- |:--- |:--- |:--- |:--- |:--- |
|Канонические 18.04 |UbuntuServer |18.04-LTS |последняя |да | да |
|Канонические 16,04|UbuntuServer |16.04-LTS |последняя |да | да |
|Канонические 14,04|UbuntuServer |14.04.5-LTS |последняя |да | да |

### <a name="rhel"></a>RHEL
| Издатель / Версия | ПРЕДЛОЖЕНИЕ | номер SKU | Версия | изображение облачно-иту готов | поддержка пакетов облачных вычислений в Azure|
|:--- |:--- |:--- |:--- |:--- |:--- |
|RedHat 7.6 |RHEL |7-RAW-CI |7.6.2019072418 |да | Да - поддержка из варианта пакета: *18.2-1.el7_6.2*|
|RedHat 7.7 |RHEL |7-RAW-CI |7.7.2019081601 | да (обратите внимание, это изображение предварительного просмотра, и как только все ИЗОБРАЖЕНИЯ RHEL 7.7 поддерживают облако-init, это будет удалено в середине 2020 года, уведомление будет дано) | Да - поддержка из пакета версии: *18.5-3.el7*|
|RedHat 7.7 |RHEL |7-RAW | Недоступно| нет - обновление изображений завершится в конце апреля 2020 года| Да - поддержка из пакета версии: *18.5-3.el7*|
|RedHat 7.7 |RHEL |7-LVM | Недоступно| нет - обновления изображений для завершения в конце апреля| Да - поддержка из пакета версии: *18.5-3.el7*|
|RedHat 7.7 |RHEL |7.7 | Недоступно| нет - обновления изображений для завершения в конце апреля | Да - поддержка из пакета версии: *18.5-3.el7*|
|RedHat 7.7 |rhel-byos | rhel-lvm77 | Недоступно|нет - обновления изображений для завершения в конце апреля  | Да - поддержка из пакета версии: *18.5-3.el7*|

### <a name="centos"></a>CentOS

| Издатель / Версия | ПРЕДЛОЖЕНИЕ | номер SKU | Версия | изображение облачно-иту готов | поддержка пакетов облачных вычислений в Azure|
|:--- |:--- |:--- |:--- |:--- |:--- |
|OpenLogic 7.7 |CentOS |7-CI |7.7.20190920 |да (обратите внимание, это изображение предварительного просмотра, и как только все Изображения CentOS 7.7 поддерживают облако-init, это будет удалено в середине 2020 года, уведомление будет дано) | Да - поддержка из варианта пакета: *18.5-3.el7.centos*|

* CentOS 7.7 изображения, которые будут облачно-инит включен быть обновлены здесь в марте 2020 

### <a name="oracle"></a>Oracle;

| Издатель / Версия | ПРЕДЛОЖЕНИЕ | номер SKU | Версия | изображение облачно-иту готов | поддержка пакетов облачных вычислений в Azure|
|:--- |:--- |:--- |:--- |:--- |:--- |
|Oracle 7.7 |Oracle-Linux |77-ci |7.7.01| Предварительный просмотр изображения (обратите внимание, что это изображение предварительного просмотра, и это как только все Oracle 7.7 изображения поддерживают облако-init, это будет удалено в середине 2020 года, уведомление будет дано) | Нет, в предварительном просмотре, пакет: *18.5-3.0.el7*

### <a name="debian--suse-sles"></a>Debian & SuSE SLES
В настоящее время мы работаем для предварительного просмотра поддержки, ожидаем обновления в феврале и марте 2020 года.

В настоящее время Azure Stack будет поддерживать подготовку изображений с поддержкой облачного инит.


## <a name="what-is-the-difference-between-cloud-init-and-the-linux-agent-wala"></a>Разница между cloud-init и агентом Linux (WALA)
WALA — это агент, используемый для предоставления и настройки ВМ и [обработки расширений Azure.](https://docs.microsoft.com/azure/virtual-machines/extensions/features-linux) 

Мы расширяем задачу настройки ВМ для использования облачных интит вместо агента Linux, чтобы позволить существующим клиентам облачного интита использовать свои текущие скрипты облачного интона или новых клиентов, чтобы воспользоваться преимуществами богатой функциональности конфигурации облака. Если у вас есть существующие инвестиции в облачные скрипты для настройки систем Linux, **нет никаких дополнительных настроек, необходимых** для их обработки. 

облако-инит не может обрабатывать расширения Azure, поэтому WALA по-прежнему требуется в изображении для обработки расширений, но необходимо будет иметь его код подготовки отключен, для одобренных linux дистро изображения, которые преобразуются в положение облачных инициата, они будут иметь WALA установлен, и настроить правильно.

При создании VM, если вы не включаете `--custom-data` переключатель Azure CLI во время подготовки, cloud-init или WALA использует минимальные параметры подготовки VM, необходимые для предоставления VM и завершения развертывания по умолчанию.  Если вы ссылаетесь на конфигурацию облачного `--custom-data` инат с коммутатором, все, что содержится в пользовательских данных, будет доступно для облачных инот, когда VM-загрузки.

конфигурации облачного инат, применяемые к ВМ, не имеют временных ограничений и не приведут к сбою развертывания при сбою в сроках. Это не верно для WALA, если вы измените WALA по умолчанию для обработки пользовательских данных, он не может превышать общую сумму времени в подготовку VM 40 минут, если это так, VM Create не удастся.

## <a name="deploying-a-cloud-init-enabled-virtual-machine"></a>Развертывание виртуальной машины с поддержкой cloud-init
Развертывать виртуальную машину с включенным cloud-init так же просто, как и ссылаться на распределение с включенным cloud-init во время развертывания.  Распространители дистрибутивов Linux должны включать и интегрировать cloud-init в свои базовые опубликование образы Azure. Убедившись, что в образе, который нужно развернуть, включен cloud-init, вы можете использовать Azure CLI для его развертывания. 

Первым шагом при развертывании образа является создание группы ресурсов с использованием команды [az group create](/cli/azure/group). Группа ресурсов Azure является логическим контейнером, в котором происходит развертывание ресурсов Azure и управление ими. 

В следующем примере создается группа ресурсов с именем *myResourceGroup* в расположении *eastus*.

```azurecli-interactive 
az group create --name myResourceGroup --location eastus
```
Следующим действием является создание файла *cloud-init.txt* в текущей оболочке и вставка следующей конфигурации. Для этого примера создайте файл в Cloud Shell (не на локальном компьютере). Вы можете использовать любой редактор. Введите `sensible-editor cloud-init.txt`, чтобы создать файл и просмотреть список доступных редакторов. Выберите первый пункт, чтобы использовать редактор **nano**. Убедитесь, что весь файл cloud-init скопирован правильно, особенно первая строка:

```yaml
#cloud-config
package_upgrade: true
packages:
  - httpd
```
Нажмите клавиши `ctrl-X`, чтобы выйти из файла, введите `y`, чтобы сохранить изменения в файле, а затем нажмите клавишу `enter`, чтобы подтвердить имя файла при выходе.

Последним шагом является создание виртуальной машины с использованием команды [az vm create](/cli/azure/vm). 

В следующем примере создаются виртуальная машина *centos74* и ключи SSH, если они не существуют в расположении ключей по умолчанию. Чтобы использовать определенный набор ключей, используйте параметр `--ssh-key-value`.  Используйте параметр `--custom-data`, чтобы передать файл конфигурации cloud-init. Укажите полный путь к конфигурации *cloud-init.txt*, если этот файл сохранен вне текущего рабочего каталога. В следующем примере создается виртуальная машина с именем *centos74*.

```azurecli-interactive 
az vm create \
  --resource-group myResourceGroup \
  --name centos74 \
  --image OpenLogic:CentOS-CI:7-CI:latest \
  --custom-data cloud-init.txt \
  --generate-ssh-keys 
```

После создания виртуальной машины в Azure CLI появятся сведения о вашем развертывании. Запишите значение `publicIpAddress`. Этот адрес используется для доступа к виртуальной машине.  На создание виртуальной машины, установку пакетов и запуск приложения может потребоваться некоторое время. Некоторые фоновые задачи продолжают работу после возврата к командной строке в Azure CLI. Вы можете подключиться к виртуальной машине по протоколу SSH и выполнить шаги, описанные в разделе "Устранение неполадок", чтобы просмотреть журналы cloud-init. 

## <a name="troubleshooting-cloud-init"></a>Устранение неполадок cloud-init
После подготовки виртуальной машины cloud-init запустит все модули и скрипты, заданные в параметре `--custom-data`, для ее настройки.  Если вам необходимо устранить ошибки или пропуски в конфигурации, найдите имя модуля (`disk_setup` или `runcmd`, к примеру) в журнале cloud-init, который находится в файле **/var/log/cloud-init.log**.

> [!NOTE]
> Не каждый сбой модуля приводит к неустранимому сбою всей конфигурации cloud-init. Например, если используется модуль `runcmd`, при сбое скрипта cloud-init все еще будет отображать сообщение об успешной подготовке, так как выполнен модуль runcmd.

Дополнительные сведения о журнале cloud-init см. в [документации по cloud-init](https://cloudinit.readthedocs.io/en/latest/topics/logging.html) 

## <a name="next-steps"></a>Дальнейшие действия
Примеры изменения конфигураций с помощью cloud-init см. в следующих документах:
 
- [Добавление пользователя Linux к виртуальной машине](cloudinit-add-user.md)
- [Запуск диспетчера пакетов для обновления существующих пакетов при первой загрузке](cloudinit-update-vm.md)
- [Изменение имени локального узла виртуальной машины](cloudinit-update-vm-hostname.md) 
- [Установка пакета приложения, обновление файлов конфигурации и внедрение ключей](tutorial-automate-vm-deployment.md)
 
