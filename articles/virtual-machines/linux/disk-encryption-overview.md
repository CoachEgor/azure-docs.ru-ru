---
title: Enable Azure Disk Encryption for Linux IaaS VMs (Включение шифрования дисков Azure для виртуальных машин IaaS под управлением Linux)
description: В этой статье приведены инструкции по включению шифрования дисков Microsoft Azure для виртуальных машин Linux.
author: msmbaldwin
ms.service: virtual-machines-linux
ms.subservice: security
ms.topic: article
ms.author: mbaldwin
ms.date: 08/06/2019
ms.custom: seodec18
ms.openlocfilehash: f75e5c856e05cc5ce53598849a7cb11ed059827a
ms.sourcegitcommit: 11572a869ef8dbec8e7c721bc7744e2859b79962
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "82838864"
---
# <a name="azure-disk-encryption-for-linux-vms"></a>Шифрование дисков Azure для виртуальных машин Linux 

Шифрование дисков Azure помогает защитить данные согласно корпоративным обязательствам по обеспечению безопасности и соответствия. В нем используется функция [DM-](https://en.wikipedia.org/wiki/Dm-crypt) Encryption в Linux для обеспечения шифрования томов и дисков данных виртуальных машин Azure, а также интегрировано с [Azure Key Vault](../../key-vault/index.yml) , помогающее управлять ключами и секретами шифрования диска и управлять ими. 

Если вы используете [Центр безопасности Azure](../../security-center/index.yml), вы получаете оповещения, если у вас есть виртуальные машины, которые не шифруются. Вы получите оповещение высокого уровня серьезности вместе c рекомендацией о шифровании таких виртуальных машин.

![Оповещение о шифровании диска в центре безопасности Azure](media/disk-encryption/security-center-disk-encryption-fig1.png)

> [!WARNING]
> - Если вы ранее использовали шифрование дисков Azure с Azure AD для шифрования виртуальной машины, необходимо продолжить использовать этот параметр для шифрования виртуальной машины. Дополнительные сведения см. [в статье шифрование дисков Azure с помощью Azure AD (предыдущий выпуск)](disk-encryption-overview-aad.md) . 
> - Выполнение некоторых приведенных рекомендаций может привести к более интенсивному использованию данных, сети или вычислительных ресурсов, а следовательно к дополнительным затратам на лицензии или подписки. Необходима действующая подписка Azure, которая позволяет создавать ресурсы Azure в поддерживаемых регионах.
> - В настоящее время виртуальные машины поколения 2 не поддерживают шифрование дисков Azure. Дополнительные сведения см. [в статье поддержка виртуальных машин поколения 2 в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/generation-2) .

Основные сведения о шифровании дисков Azure для Linux можно получить всего за несколько минут с помощью [Azure CLI](disk-encryption-cli-quickstart.md) быстрого запуска или [создания и шифрования виртуальной машины linux с помощью Azure PowerShell краткого руководства](disk-encryption-powershell-quickstart.md).

## <a name="supported-vms-and-operating-systems"></a>Поддерживаемые виртуальные машины и операционные системы

### <a name="supported-vms"></a>Поддерживаемые виртуальные машины

Виртуальные машины Linux доступны в [различных размерах](sizes.md). Шифрование дисков Azure недоступно на виртуальных машинах [уровня "базовый", "серия](https://azure.microsoft.com/pricing/details/virtual-machines/series/)" или на виртуальных машинах, которые не соответствуют следующим минимальным требованиям к памяти:

| Виртуальная машина | Минимальные требования к памяти |
|--|--|
| Виртуальные машины Linux, когда шифруются только тома данных| 2 ГБ |
| Виртуальные машины Linux при шифровании томов данных и ОПЕРАЦИОННЫХ систем, а также в том случае, если корневой файл (/) используется не менее 4 ГБ. | 8 ГБ |
| Виртуальные машины Linux при шифровании данных и томов ОС, а также о том, где корневое (/) использование файловой системы превышает 4 ГБ | Использование корневой файловой системы * 2. Например, 16 Гб использования корневой файловой системы требуют не менее 32 Гбайт ОЗУ. |

После завершения процесса шифрования диска ОС на виртуальных машинах Linux можно настроить запуск виртуальной машины с меньшим объемом памяти. 

Шифрование дисков Azure также доступно для виртуальных машин с хранилищем класса Premium.

Шифрование дисков Azure недоступно на [виртуальных машинах поколения 2](generation-2.md#generation-1-vs-generation-2-capabilities)и [виртуальных машинах серии Lsv2](../lsv2-series.md)). Дополнительные сведения об исключениях см. в статье [Шифрование дисков Azure: неподдерживаемые сценарии](disk-encryption-linux.md#unsupported-scenarios).

### <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Шифрование дисков Azure поддерживается в подмножестве [дистрибутивов Linux](endorsed-distros.md), рекомендованных Azure, которые являются подмножеством всех возможных дистрибутивов Linux Server.

![Диаграмма Венна для дистрибутивов Linux Server, поддерживающих шифрование дисков Azure](./media/disk-encryption/ade-supported-distros.png)

Дистрибутивы сервера Linux, не поддерживаемые Azure, не поддерживают шифрование дисков Azure. из тех, которые были одобрены, поддерживаются только следующие дистрибутивы и версии, поддерживаемые шифрованием дисков Azure:

| Издатель | ПРЕДЛОЖЕНИЕ | номер SKU | URN | Тип тома, для которого поддерживается шифрование |
| --- | --- |--- | --- |
| Canonical | Ubuntu | 18.04-LTS | Канонический: UbuntuServer: 18.04-LTS: Latest | Диск операционной системы и данных |
| Canonical | Ubuntu 18.04 | 18,04-ЕЖЕДНЕВНОЕ — LTS | Канонический: UbuntuServer: 18.04-DAILY-LTS: Latest | Диск операционной системы и данных |
| Canonical | Ubuntu 16.04 | 16.04-DAILY-LTS | Канонический: UbuntuServer: 16.04-DAILY-LTS: Latest | Диск операционной системы и данных |
| Canonical | Ubuntu 14.04.5</br>[с ядром, оптимизированным для Azure, обновленным до версии 4.15 или более поздней версии](disk-encryption-troubleshooting.md) | 14.04.5-LTS | Канонический: UbuntuServer: 14.04.5-LTS: Latest | Диск операционной системы и данных |
| Canonical | Ubuntu 14.04.5</br>[с ядром, оптимизированным для Azure, обновленным до версии 4.15 или более поздней версии](disk-encryption-troubleshooting.md) | 14.04.5-DAILY-LTS | Канонический: UbuntuServer: 14.04.5-DAILY-LTS: Latest | Диск операционной системы и данных |
| RedHat | RHEL 7,7 | 7,7 | RedHat: RHEL: 7.7: Последняя | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7,7 | 7-RAW | RedHat: RHEL: 7 — необработанный: последний | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7,7 | 7-LVM | RedHat: RHEL: 7 — LVM: Последняя | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7,6 | 7.6 | RedHat: RHEL: 7.6: Последняя | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7.5 | 7.5 | RedHat: RHEL: 7.5: Последняя | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7.4 | 7.4 | RedHat: RHEL: 7.4: Последняя | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7.3 | 7.3 | RedHat: RHEL: 7.3: Последняя | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 7.2; | 7.2 | RedHat: RHEL: 7,2: Последняя версия | ОС и диск данных (см. Примечание ниже) |
| RedHat | RHEL 6,8 | 6,8 | RedHat: RHEL: 6.8: Последняя | Диск данных (см. Примечание ниже) |
| RedHat | RHEL 6,7 | 6.7 | RedHat: RHEL: 6.7: Последняя | Диск данных (см. Примечание ниже) |
| OpenLogic | CentOS 7,7 | 7,7 | OpenLogic: CentOS: 7.7: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7,7 | 7-LVM | OpenLogic: CentOS: 7 — LVM: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7,6 | 7.6 | OpenLogic: CentOS: 7.6: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7.5 | 7.5 | OpenLogic: CentOS: 7.5: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7.4 | 7.4 | OpenLogic: CentOS: 7.4: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7.3 | 7.3 | OpenLogic: CentOS: 7.3: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7,2 n | 7.2n | OpenLogic: CentOS: 7,2 n: Последняя | Диск операционной системы и данных |
| OpenLogic | CentOS 7.1; | 7.1 | OpenLogic: CentOS: 7.1: Последняя версия | Только диск данных |
| OpenLogic | CentOS 7,0 | 7.0 | OpenLogic: CentOS: 7.0: Последняя версия | Только диск данных |
| OpenLogic | CentOS 6.8. | 6,8 | OpenLogic: CentOS: 6.8: Последняя | Только диск данных |
| SUSE | openSUSE 42.3 | 42.3 | SUSE:openSUSE-Leap:42.3:latest | Только диск данных |
| SUSE | SLES 12 — SP4 | 12-SP4 | SUSE: SLES: 12-SP4: Последняя версия | Только диск данных |
| SUSE | SLES HPC 12-SP3 | 12-SP3 | SUSE:SLES-HPC:12-SP3:latest | Только диск данных |

> [!NOTE]
> Новая реализация шифрования дисков Azure поддерживается для RHEL ОС и диска данных для образов RHEL7 с оплатой по мере использования.  
>
> ADE также поддерживается для RHELных образов с собственной подпиской, но только **после** регистрации подписки. Дополнительные сведения см. [в статье Red Hat Enterprise Linux собственные образы на основе собственных подписок в Azure](../workloads/redhat/byos.md#encrypt-red-hat-enterprise-linux-bring-your-own-subscription-gold-images) .

## <a name="additional-vm-requirements"></a>Дополнительные требования к виртуальным машинам

Для шифрования дисков Azure в системе должны присутствовать модули DM-encryption и вфат. Удаление или отключение вфат из образа по умолчанию не позволит системе считывать ключ тома и получать ключ, необходимый для разблокировки дисков при последующих перезагрузках. Действия по укреплению безопасности системы, удаляющие модуль вфат из системы, несовместимы с шифрованием дисков Azure. 

Перед включением шифрования диски данных, подлежащий шифрованию, должны быть должным образом перечислены в/etc/fstab. Используйте постоянное имя устройства для этой записи, так как имена устройств в формате "/dev/sdX" необязательно будут с одним и тем же диском в случае перезагрузок, особенно после применения шифрования. Подробнее об этом поведении см. статье [Устранение неполадок при изменении имени устройства виртуальной машины Linux](troubleshoot-device-names-problems.md).

Убедитесь, что параметры /etc/fstab для подключения настроены правильно. Чтобы настроить эти параметры, запустите команду mount -a или перезагрузите виртуальную машину и подключите ее заново таким образом. Как только это будет завершено, проверьте выходные данные команды lsblk, чтобы убедиться, что нужный диск все еще подключен. 
- Если файл /etc/fstab не подключает диск должным образом до включения шифрования, служба шифрования дисков Azure не сможет правильно подключить его.
- Служба шифрования дисков Azure переместит информацию о подключении из /etc/fstab в собственный файл конфигурации как часть процесса шифрования. Не волнуйтесь, если увидите, что запись отсутствует в /etc/fstab после завершения шифрования диска данных.
- Перед запуском шифрования убедитесь, что все службы и процессы, которые могут быть записаны в подключенные диски данных, отключены, поэтому они не перезапускаются автоматически после перезагрузки. Они могут открывать файлы в этих разделах, предотвращая их повторное подключение, что приводит к сбою шифрования. 
- После перезагрузки процессу шифрования дисков Azure потребуется некоторое время для подключения только что зашифрованных дисков. После перезагрузки они не будут доступны сразу. Прежде чем зашифрованные диски станут доступными для других процессов, потребуется некоторое время для их запуска, разблокировки и подключения. Этот процесс может занять более минуты после перезагрузки в зависимости от характеристик системы.

Пример команд, которые можно использовать для подключения дисков данных и создания необходимых записей/etc/fstab, можно найти в [сценарии CLI для предварительных требований к шифрованию дисков Azure](https://github.com/ejarvi/ade-cli-getting-started) (строки 244-248) и в [сценарии PowerShell для предварительных требований к шифрованию дисков Azure](https://github.com/Azure/azure-powershell/tree/master/src/Compute/Compute/Extension/AzureDiskEncryption/Scripts). 

## <a name="networking-requirements"></a>Требования к сети

Чтобы включить функцию шифрования дисков Azure, виртуальные машины Linux должны соответствовать следующим требованиям к конфигурации конечной точки сети.
  - Чтобы получить маркер для подключения к хранилищу ключей, виртуальная машина Linux должна иметь возможность подключения к конечной точке Azure Active Directory \[Login.microsoftonline.com.\]
  - Чтобы записать ключи шифрования в хранилище ключей, виртуальная машина Linux должна иметь возможность подключения к конечной точке хранилища ключей.
  - Виртуальная машина Linux должна иметь возможность подключения к конечной точке службы хранилища Azure, в которой размещен репозиторий расширения Azure, и учетной записи хранения Azure, в которой размещены VHD-файлы.
  -  Если ваша политика безопасности ограничивает доступ к Интернету с виртуальных машин Azure, можно разрешить указанный выше универсальный код ресурса (URI) и настроить определенное правило, чтобы разрешить исходящие подключения к данным IP-адресам. Дополнительные сведения см. в статье [Доступ к Azure Key Vault из-за брандмауэра](../../key-vault/general/access-behind-firewall.md).  

## <a name="encryption-key-storage-requirements"></a>Требования к хранилищу ключей шифрования  

Для шифрования дисков Azure требуется Azure Key Vault, чтобы управлять ключами и секретами шифрования дисков и управлять ими. Ваше хранилище ключей и виртуальные машины должны находиться в одном регионе Azure и подписке.

Дополнительные сведения см. [в статье Создание и Настройка хранилища ключей для шифрования дисков Azure](disk-encryption-key-vault.md).

## <a name="terminology"></a>Терминология
В следующей таблице описаны некоторые распространенные термины, используемые в документации по шифрованию дисков Azure.

| Терминология | Определение |
| --- | --- |
| Azure Key Vault | Key Vault представляет собой службу управления криптографическими ключами. Она основана на аппаратных модулях безопасности, соответствующих Федеральному стандарту обработки информации (FIPS). Эти стандарты позволяют надежно хранить криптографические ключи и конфиденциальные данные. Дополнительные сведения см. в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) документации, а также [о создании и настройке хранилища ключей для шифрования дисков Azure](disk-encryption-key-vault.md). |
| Azure CLI | [Azure CLI](/cli/azure/install-azure-cli) оптимизирован для администрирования ресурсов Azure и управления ими из командной строки.|
| DM-Crypt |[DM-](https://gitlab.com/cryptsetup/cryptsetup/wikis/DMCrypt) Encryption — это прозрачная подсистема шифрования дисков на основе Linux, которая используется для включения шифрования дисков на виртуальных машинах Linux. |
| Ключ шифрования ключа (KEK) | Асимметричный ключ (RSA 2048), который можно использовать для защиты или перетекания секрета. Вы можете использовать защищенный HSM ключ или ключ с программной защитой. Дополнительные сведения см. в [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) документации, а также [о создании и настройке хранилища ключей для шифрования дисков Azure](disk-encryption-key-vault.md). |
| Командлеты PowerShell | Дополнительные сведения см. в статье [Общие сведения об Azure PowerShell](/powershell/azure/overview). |


## <a name="next-steps"></a>Дальнейшие действия

- [Краткое руководство. Создание и шифрование виртуальной машины Linux с помощью Azure CLI](disk-encryption-cli-quickstart.md)
- [Краткое руководство. Создание и шифрование виртуальной машины Linux с помощью Azure PowerShell](disk-encryption-powershell-quickstart.md)
- [Azure Disk Encryption scenarios on Linux VMs](disk-encryption-linux.md) (Сценарии шифрования дисков Azure для виртуальных машин Linux)
- [Сценарий CLI для предварительных требований к шифрованию дисков Azure](https://github.com/ejarvi/ade-cli-getting-started)
- [Сценарий PowerShell для предварительных требований к шифрованию дисков Azure](https://github.com/Azure/azure-powershell/tree/master/src/Compute/Compute/Extension/AzureDiskEncryption/Scripts)
- [Создание и настройка хранилища ключей для шифрования дисков Azure](disk-encryption-key-vault.md)


