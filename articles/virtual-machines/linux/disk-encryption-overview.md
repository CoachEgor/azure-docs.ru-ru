---
title: Enable Azure Disk Encryption for Linux IaaS VMs (Включение шифрования дисков Azure для виртуальных машин IaaS под управлением Linux)
description: В этой статье содержатся инструкции по включению шифрования дисков Microsoft Azure для Linux VMs.
author: msmbaldwin
ms.service: virtual-machines-linux
ms.subservice: security
ms.topic: article
ms.author: mbaldwin
ms.date: 08/06/2019
ms.custom: seodec18
ms.openlocfilehash: d058ff5f9863642f73725db3472c942161447f25
ms.sourcegitcommit: 980c3d827cc0f25b94b1eb93fd3d9041f3593036
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80548433"
---
# <a name="azure-disk-encryption-for-linux-vms"></a>Лазурное шифрование дисков для Linux VMs 

Шифрование дисков Azure помогает защитить данные согласно корпоративным обязательствам по обеспечению безопасности и соответствия. Он использует функцию [DM-Crypt](https://en.wikipedia.org/wiki/Dm-crypt) Linux для обеспечения громкости шифрования для ОС и дисков данных виртуальных машин Azure (VMs), и интегрирован с [Azure Key Vault,](../../key-vault/index.yml) чтобы помочь вам управлять и управлять ключами шифрования диска и секретами. 

Если вы используете [Центр безопасности Azure,](../../security-center/index.yml)вы будете предупреждены, если у вас есть vMs, которые не зашифрованы. Вы получите оповещение высокого уровня серьезности вместе c рекомендацией о шифровании таких виртуальных машин.

![Оповещение о шифровании диска в центре безопасности Azure](media/disk-encryption/security-center-disk-encryption-fig1.png)

> [!WARNING]
> - Если ранее для шифрования VM использовалось шифрование Azure Disk с Azure AD, вы должны продолжать использовать эту опцию для шифрования VM. Подробнее о [шифровании azure Disk с помощью Azure AD (предыдущий релиз).](disk-encryption-overview-aad.md) 
> - Выполнение некоторых приведенных рекомендаций может привести к более интенсивному использованию данных, сети или вычислительных ресурсов, а следовательно к дополнительным затратам на лицензии или подписки. Необходима действующая подписка Azure, которая позволяет создавать ресурсы Azure в поддерживаемых регионах.
> - В настоящее время VMs-иносы поколения 2 не поддерживают шифрование azure Disk. Подробнее о [см.](https://docs.microsoft.com/azure/virtual-machines/windows/generation-2)

Вы можете узнать основы шифрования Azure Disk для Linux всего за несколько минут с [помощью Create и шифрования Linux VM с помощью быстрого запуска Azure CLI](disk-encryption-cli-quickstart.md) или [создания и шифрования Linux VM с помощью quickstart Azure Powershell.](disk-encryption-powershell-quickstart.md)

## <a name="supported-vms-and-operating-systems"></a>Поддерживаемые ВМ и операционные системы

### <a name="supported-vms"></a>Поддерживаемые виртуальные машины

Linux VMs доступны в [диапазоне размеров.](sizes.md) Шифрование Azure Disk недоступно на [виртуальных визах Basic, A-series](https://azure.microsoft.com/pricing/details/virtual-machines/series/)или на виртуальных машинах, которые не отвечают этим минимальным требованиям к памяти:

| Виртуальная машина | Минимальное требование к памяти |
|--|--|
| Linux VMs, когда только шифрование объемов данных| 2 ГБ |
| Linux VMs при шифровании как данных, так и объемов ОС, и где использование корневой (/) файловой системы составляет 4 ГБ или меньше | 8 ГБ |
| Linux VMs при шифровании как данных, так и объемов ОС, и где использование корневой (/) файловой системы превышает 4 ГБ | Использование корневой файловой системы No 2. Например, использование корневой файловой системы в 16 ГБ требует не менее 32 ГБ оперативной памяти |

После завершения процесса шифрования диска ОС на виртуальных машинах Linux VM можно настроить сясполнив для запуска с меньшим количеством памяти. 

Шифрование Azure Disk также доступно для vMs с премиум-хранилищем.

Лазурный диск шифрование не доступно на [поколение 2 VMs](generation-2.md#generation-1-vs-generation-2-capabilities)) и [Lsv2-серии VMs](../lsv2-series.md)). Для получения дополнительных [Azure Disk Encryption: Unsupported scenarios](disk-encryption-linux.md#unsupported-scenarios)исключений см.

### <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Шифрование Azure Disk поддерживается на подмножестве [одобренных Azure дистрибутивов Linux,](endorsed-distros.md)который сам по себе является подмножеством всех возможных дистрибутивов сервера Linux.

![Venn Диаграмма дистрибутивов серверов Linux, поддерживающих шифрование Azure Disk](./media/disk-encryption/ade-supported-distros.png)

Дистрибутивы серверов Linux, которые не одобрены Azure, не поддерживают шифрование azure Disk; из тех, которые одобрены, только следующие дистрибутивы и версии поддерживают шифрование Azure Disk:

| Дистрибутив Linux | Версия | Тип тома, для которого поддерживается шифрование|
| --- | --- |--- |
| Ubuntu | 18,04| Диск операционной системы и данных |
| Ubuntu | 16.04| Диск операционной системы и данных |
| Ubuntu | 14.04.5</br>[с ядром, оптимизированным для Azure, обновленным до версии 4.15 или более поздней версии](disk-encryption-troubleshooting.md) | Диск операционной системы и данных |
| RHEL | 7.7 | ОС и диск данных (см. примечание ниже) |
| RHEL | 7.6 | ОС и диск данных (см. примечание ниже) |
| RHEL | 7.5 | ОС и диск данных (см. примечание ниже) |
| RHEL | 7.4 | ОС и диск данных (см. примечание ниже) |
| RHEL | 7.3 | ОС и диск данных (см. примечание ниже) |
| RHEL | 7.2 | ОС и диск данных (см. примечание ниже) |
| RHEL | 6,8 | Диск данных (см. примечание ниже) |
| RHEL | 6.7 | Диск данных (см. примечание ниже) |
| CentOS | 7.7 | Диск операционной системы и данных |
| CentOS | 7.6 | Диск операционной системы и данных |
| CentOS | 7.5 | Диск операционной системы и данных |
| CentOS | 7.4 | Диск операционной системы и данных |
| CentOS | 7.3 | Диск операционной системы и данных |
| CentOS | 7.2n | Диск операционной системы и данных |
| CentOS | 6,8 | Диск данных |
| openSUSE | 42.3 | Диск данных |
| SLES | 12-SP4 | Диск данных |
| SLES | 12-SP3 | Диск данных |

> [!NOTE]
> Новая реализация azure Disk Encryption поддерживается для RHEL OS и диска данных для изображений RHEL7 Pay-As-You-Go.  
>
> ADE также поддерживается для RHEL Bring-Your-Own-Подписка Золотые изображения, но только **после того,** как подписка была зарегистрирована . Для получения дополнительной информации, см [Red Hat Предприятие Linux Принесите-Ваш-собственный-подписка Золотые изображения в Azure](../workloads/redhat/byos.md#encrypt-red-hat-enterprise-linux-bring-your-own-subscription-gold-images)

## <a name="additional-vm-requirements"></a>Дополнительные требования к VM

Лазурное шифрование диска требует, чтобы в системе присутствовали модули dm-crypt и vfat. Удаление или отключение вфата из изображения по умолчанию не позволит системе считывать ключевой объем и получать ключ, необходимый для разблокировки дисков при последующих перезагрузках. Шаги закаливания системы, которые удаляют модуль vfat из системы, не совместимы с шифрованием azure Disk. 

Перед включением шифрования диски данных должны быть зашифрованы должным образом перечислены в /etc/fstab. Используйте постоянное имя устройства для этой записи, так как имена устройств в формате "/dev/sdX" необязательно будут с одним и тем же диском в случае перезагрузок, особенно после применения шифрования. Подробнее об этом поведении см. статье [Устранение неполадок при изменении имени устройства виртуальной машины Linux](troubleshoot-device-names-problems.md).

Убедитесь, что параметры /etc/fstab для подключения настроены правильно. Чтобы настроить эти параметры, запустите команду mount -a или перезагрузите виртуальную машину и подключите ее заново таким образом. Как только это будет завершено, проверьте выходные данные команды lsblk, чтобы убедиться, что нужный диск все еще подключен. 
- Если файл /etc/fstab не подключает диск должным образом до включения шифрования, служба шифрования дисков Azure не сможет правильно подключить его.
- Служба шифрования дисков Azure переместит информацию о подключении из /etc/fstab в собственный файл конфигурации как часть процесса шифрования. Не волнуйтесь, если увидите, что запись отсутствует в /etc/fstab после завершения шифрования диска данных.
- Перед запуском шифрования не забудьте остановить все службы и процессы, которые могут писать на установленные диски данных, и отключить их, чтобы они не перезагружались автоматически после перезагрузки. Они могут держать файлы открытыми на этих разделах, предотвращая процедуру шифрования для их реактивации, вызывая сбой шифрования. 
- После перезагрузки процессу шифрования дисков Azure потребуется некоторое время для подключения только что зашифрованных дисков. После перезагрузки они не будут доступны сразу. Прежде чем зашифрованные диски станут доступными для других процессов, потребуется некоторое время для их запуска, разблокировки и подключения. Этот процесс может занять более минуты после перезагрузки в зависимости от характеристик системы.

Пример команд, которые могут быть использованы для установки дисков данных и создания необходимых записей /etc/fstab, можно найти в [предпосылках шифрования azure Disk CLI](https://github.com/ejarvi/ade-cli-getting-started) (строки 244-248) и [предпосылках для шифрования данных PowerShell.](https://github.com/Azure/azure-powershell/tree/master/src/Compute/Compute/Extension/AzureDiskEncryption/Scripts) 

## <a name="networking-requirements"></a>Требования к сети

Для включения функции шифрования дисков Azure, Linux VMs должны соответствовать следующим требованиям конфигурации конечных точек сети:
  - Чтобы получить токен для подключения к хранилищу ключей, Linux VM должен быть в \[\]состоянии подключиться к конечной точке Azure Active Directory, login.microsoftonline.com.
  - Чтобы написать ключи шифрования в хранилище ключей, Linux VM должен быть в состоянии подключиться к точке свода ключей.
  - Linux VM должен быть в состоянии подключиться к конечной точке хранения Azure, в которой размещается репозиторий расширения Azure и учетная запись хранения Azure, в которой размещаются файлы VHD.
  -  Если ваша политика безопасности ограничивает доступ к Интернету с виртуальных машин Azure, можно разрешить указанный выше универсальный код ресурса (URI) и настроить определенное правило, чтобы разрешить исходящие подключения к данным IP-адресам. Дополнительные сведения см. в статье [Доступ к Azure Key Vault из-за брандмауэра](../../key-vault/key-vault-access-behind-firewall.md).  

## <a name="encryption-key-storage-requirements"></a>Требования к хранению ключей шифрования  

Шифрование azure Disk требует, чтобы Убежище azure Key Vault контролировало и управляло ключами и секретами шифрования дисков. Хранилище ключей и вс-м ввода м ввода-возах должны находиться в одном и том же регионе Azure и подписке.

Для получения подробной информации [см. Создание и настройка хранилища ключей для шифрования azure Disk.](disk-encryption-key-vault.md)

## <a name="terminology"></a>Терминология
В следующей таблице определены некоторые общие термины, используемые в документации по шифрованию дисков Azure:

| Терминология | Определение |
| --- | --- |
| Azure Key Vault | Key Vault представляет собой службу управления криптографическими ключами. Она основана на аппаратных модулях безопасности, соответствующих Федеральному стандарту обработки информации (FIPS). Эти стандарты позволяют надежно хранить криптографические ключи и конфиденциальные данные. Для получения дополнительной информации ознакомьтесь с документацией [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) и [созданием и настройкой хранилища ключей для шифрования azure Disk.](disk-encryption-key-vault.md) |
| Azure CLI | [Azure CLI](/cli/azure/install-azure-cli) оптимизирован для администрирования ресурсов Azure и управления ими из командной строки.|
| DM-Crypt |[DM-Crypt](https://gitlab.com/cryptsetup/cryptsetup/wikis/DMCrypt) — это прозрачная подсистема шифрования дисков на основе Linux, используемая для шифрования дисков на Linux VMs. |
| Ключ шифрования (KEK) | Асимметричный ключ (RSA 2048), который можно использовать для защиты или обертывания секрета. Вы можете использовать защищенный HSM ключ или ключ с программной защитой. Для получения дополнительной информации ознакомьтесь с документацией [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) и [созданием и настройкой хранилища ключей для шифрования azure Disk.](disk-encryption-key-vault.md) |
| Командлеты PowerShell | Дополнительные сведения см. в статье [Общие сведения об Azure PowerShell](/powershell/azure/overview). |


## <a name="next-steps"></a>Дальнейшие действия

- [Быстрый запуск - Создание и шифрование Linux VM с Azure CLI](disk-encryption-cli-quickstart.md)
- [Быстрый запуск - Создание и шифрование Linux VM с Azure Powershell](disk-encryption-powershell-quickstart.md)
- [Azure Disk Encryption scenarios on Linux VMs](disk-encryption-linux.md) (Сценарии шифрования дисков Azure для виртуальных машин Linux)
- [Предпосылки для шифрования дисков Azure](https://github.com/ejarvi/ade-cli-getting-started)
- [Предпосылки для шифрования дисков Azure](https://github.com/Azure/azure-powershell/tree/master/src/Compute/Compute/Extension/AzureDiskEncryption/Scripts)
- [Создание и настройка хранилища ключей для шифрования дисков Azure](disk-encryption-key-vault.md)


