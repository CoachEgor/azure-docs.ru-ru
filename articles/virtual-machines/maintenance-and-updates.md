---
title: Обслуживание и обновления для виртуальных машин в Azure | Документация Майкрософт
description: Общие сведения об обслуживании и обновлениях для виртуальных машин, работающих в Azure.
services: virtual-machines
documentationcenter: ''
author: shants123
editor: ''
tags: azure-resource-manager,azure-service-management
ms.service: virtual-machines
ms.workload: infrastructure-services
ms.topic: article
ms.date: 11/18/2019
ms.author: shants
ms.openlocfilehash: 8e522b49c53dd40a4438755520481383984c1e01
ms.sourcegitcommit: 85e7fccf814269c9816b540e4539645ddc153e6e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2019
ms.locfileid: "74535890"
---
# <a name="maintenance-for-virtual-machines-in-azure"></a>Обслуживание виртуальных машин Linux в Azure

Azure периодически обновляет свою платформу, чтобы повысить надежность, производительность и безопасность инфраструктуры узла для виртуальных машин. Причины этих обновлений разные: от исправлений программных компонентов в среде размещения до обновления сетевых компонентов или вывода оборудования из эксплуатации. 

Обновления редко влияют на размещенные виртуальные машины. Когда обновления вступают в действие, Azure выбирает метод с минимальным влиянием на обновления:

- Если обновление не требует перезагрузки, виртуальная машина приостанавливается во время обновления узла или виртуальная машина переносится на уже обновленный узел. 
- Если обслуживание требует перезагрузки, вы получаете уведомления о плановом обслуживании. Azure также предоставляет временное окно, в котором можно начать обслуживание самостоятельно, в любое удобное для вас время. Период самообслуживания обычно составляет 30 дней, если обслуживание не срочно. Azure — это инвестиции в технологии, чтобы сократить число случаев, в которых запланированное обслуживание платформы требует перезагрузки виртуальных машин. Инструкции по управлению плановым обслуживанием см. в статье обработка уведомлений о плановом обслуживании с помощью Azure [CLI](maintenance-notifications-cli.md), [PowerShell](maintenance-notifications-powershell.md) или [портала](maintenance-notifications-portal.md).

На этой странице описано, как Azure выполняет обслуживание обоих типов. Дополнительные сведения о незапланированных событиях (сбоях) см. в статье [Управление доступностью виртуальных машин для Windows](./windows/manage-availability.md) или соответствующей статьи для [Linux](./linux/manage-availability.md).

На виртуальной машине можно получать уведомления о предстоящем обслуживании [с помощью запланированные события для Windows](/windows/scheduled-events.md) или [Linux](/linux/scheduled-events.md).



## <a name="maintenance-that-doesnt-require-a-reboot"></a>Обслуживание, не требующее перезагрузки

Большинство обновлений платформы не влияет на виртуальные машины клиента. Если обновление без влияния невозможно, Azure выбирает механизм обновления, который наименее воздействие на виртуальные машины клиентов. 

Наиболее ненулевое обслуживание приостанавливает работу виртуальной машины менее 10 секунд. В некоторых случаях Azure использует механизмы обслуживания с сохранением памяти. Эти механизмы приостанавливают работу виртуальной машины в течение 30 секунд и сохраняют память в ОЗУ. После этого виртуальная машина возобновляется, и ее часы автоматически синхронизируются. 

Обслуживание с сохранением памяти работает на более чем 90% виртуальных машин Azure. Он не работает для серии G, M, N и H. Azure все чаще использует технологии динамической миграции и улучшает механизмы обслуживания с сохранением памяти для уменьшения длительности паузы.  

Эти операции обслуживания, не требующие перезагрузки, применяются к одному домену сбоя за раз. Они останавливаются, если получают сигналы исправности предупреждений. 

Эти типы обновлений могут повлиять на некоторые приложения. Когда виртуальная машина динамически переносится на другой узел, некоторые конфиденциальные рабочие нагрузки могут привести к снижению производительности в течение нескольких минут, ведущих к приостановке виртуальной машины. Чтобы подготовиться к обслуживанию виртуальных машин и снизить влияние на обслуживание Azure, попробуйте [использовать запланированные события для Windows](/windows/scheduled-events.md) или [Linux](/linux/scheduled-events.md) для таких приложений. 

Кроме того, в общедоступной предварительной версии есть функция управления обслуживанием, которая может помочь в управлении обслуживанием, не требующей перезагрузки. Необходимо использовать либо [выделенные узлы Azure](./linux/dedicated-hosts.md) , либо [изолированную виртуальную машину](../security/fundamentals/isolation-choices.md). Управление обслуживанием позволяет пропустить обновления платформы и применить обновления на выбранный момент времени в течение интервала в 35 дней. Дополнительные сведения см. [в разделе Управление обновлениями с помощью управления обслуживанием и Azure CLI](maintenance-control-cli.md).


### <a name="live-migration"></a>Динамическая миграция

Динамическая миграция — это операция, которая не требует перезагрузки и сохраняет память для виртуальной машины. Это приводит к паузе или замораживанию, обычно не превышающей 5 секунд. За исключением серии G, M, N и H, все виртуальные машины в инфраструктуре как услуги (IaaS) подходят для динамической миграции. Подходящие виртуальные машины представляют более 90 процентов виртуальных машин IaaS, развернутых на парк Azure. 

Платформа Azure запускает динамическую миграцию в следующих сценариях:
- Плановое техническое обслуживание
- Сбой оборудования
- Оптимизация распределения

В некоторых сценариях планового обслуживания используется динамическая миграция, и вы можете использовать Запланированные события, чтобы заранее получить сведения о начале операций динамической миграции.

Динамическая миграция также может использоваться для перемещения виртуальных машин, когда Машинное обучение Azure алгоритмы прогнозирует незапланированный сбой оборудования или если требуется оптимизировать выделение ресурсов виртуальной машины. Дополнительные сведения о прогнозном моделировании, который обнаруживает экземпляры сниженного оборудования, см. [в статье улучшение устойчивости виртуальных машин Azure с помощью прогнозного машинного обучения и динамической миграции](https://azure.microsoft.com/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/?WT.mc_id=thomasmaurer-blog-thmaure). Уведомления динамической миграции отображаются в портал Azure в журналах мониторинга и работоспособности служб, а также в Запланированные события при использовании этих служб.

## <a name="maintenance-that-requires-a-reboot"></a>Обслуживание, требующее перезагрузки

В редких случаях, когда требуется перезагрузка виртуальных машин для планового обслуживания, вы будете уведомлены заранее. Плановое обслуживание включает в себя два этапа: этап самообслуживания и этап запланированного обслуживания.

На *этапе самообслуживания*, который обычно длится четыре недели, вы запускаете обслуживание виртуальных машин. В рамках самообслуживания можно запросить каждую виртуальную машину, чтобы просмотреть ее состояние и результат последнего запроса на обслуживание.

При запуске самостоятельного обслуживания виртуальная машина повторно развертывается на уже обновленном узле. Так как виртуальная машина перезагружается, происходит потеря временного диска и обновляются динамические IP-адреса, связанные с виртуальным сетевым интерфейсом.

Если во время самостоятельного обслуживания возникает ошибка, операция останавливается, виртуальная машина не обновляется, и вы получаете возможность повторить попытку самостоятельного обслуживания. 

После завершения этапа самообслуживания начинается *этап запланированного обслуживания* . На этом этапе вы по-прежнему можете запрашивать этап обслуживания, но вы не можете начать обслуживание самостоятельно.

Дополнительные сведения об управлении обслуживанием, требующей перезагрузки, см. в статье **обработка уведомлений о плановом обслуживании** с помощью Azure [CLI](maintenance-notifications-cli.md), [PowerShell](maintenance-notifications-powershell.md) или [портала](maintenance-notifications-portal.md). 

### <a name="availability-considerations-during-scheduled-maintenance"></a>Вопросы доступности во время запланированного обслуживания 

Если вы решили дождаться запланированного этапа обслуживания, следует учесть несколько моментов, чтобы обеспечить максимальную доступность виртуальных машин. 

#### <a name="paired-regions"></a>Пары регионов

Каждый регион Azure связан с другим регионом в пределах одной географической области. Вместе они образуют пару регионов. На этапе запланированного обслуживания Azure обновляет только виртуальные машины в одном регионе пары регионов. Например, при обновлении виртуальной машины в северо-центральном регионе США Azure не обновляет ни одну виртуальную машину в Южной Центральной части США одновременно. Однако в других регионах, например в Северной Европе, обслуживание может происходить одновременно с обслуживанием в восточной части США. Чтобы лучше распределить виртуальные машины по регионам, ознакомьтесь с принципами работы пар регионов. Дополнительные сведения см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).

#### <a name="availability-sets-and-scale-sets"></a>Группы доступности и масштабируемые наборы

При развертывании рабочей нагрузки на виртуальных машинах Azure можно создать виртуальные машины в *группе доступности* , чтобы обеспечить высокий уровень доступности для приложения. С помощью групп доступности можно гарантировать, что во время сбоя или события обслуживания, требующего перезагрузки, доступна по крайней мере одна виртуальная машина.

Отдельные виртуальные машины в группе доступности могут быть распределены между максимум 20 доменами обновления. Во время запланированного обслуживания в любой момент времени обновляется только один домен обновления. Домены обновления не обязательно обновляются последовательно. 

*Масштабируемые наборы* виртуальных машин — это ресурсы вычислений Azure, которые можно использовать для развертывания набора идентичных виртуальных машин и управления ими в качестве одного ресурса. Масштабируемый набор автоматически развертывается в доменов обновления, например на виртуальных машинах в группе доступности. Как и в случае с группами доступности, при использовании масштабируемых наборов только один обновления обновляется в любое заданное время во время запланированного обслуживания.

Дополнительные сведения о настройке виртуальных машин для обеспечения высокой доступности см. в статье [Управление доступностью виртуальных машин для Windows](./windows/manage-availability.md) или соответствующей статьи для [Linux](./linux/manage-availability.md).

#### <a name="availability-zones"></a>Зоны доступности

Зоны доступности являются уникальными физическими расположениями в пределах региона Azure. Каждая зона состоит из одного или нескольких центров обработки данных, оснащенных независимыми системами электроснабжения, охлаждения и сетевого взаимодействия. Чтобы обеспечить отказоустойчивость, во всех включенных регионах используются минимум три отдельные зоны. 

Зона доступности — это сочетание домена сбоя и домена обновления. При создании трех или более виртуальных машин в трех зонах в регионе Azure виртуальные машины эффективно распределяются по трем доменам сбоя и трем доменам обновления. Платформа Azure поддерживает такое распределение между доменами обновления, чтобы виртуальные машины в различных зонах не обновлялись одновременно.

Каждое обновление инфраструктуры разворачивает зону по зонам в пределах одного региона. Но в то же время развертывание можно выполнять в зона 1, а другое развертывание — в зона 2. Развертывания не являются сериализуемыми. Однако в одном развертывании только одна зона разворачивается за раз, чтобы снизить риск.

## <a name="next-steps"></a>Дальнейшие действия 

Для управления плановым обслуживанием можно использовать [Azure CLI](maintenance-notifications-cli.md), [Azure PowerShell](maintenance-notifications-powershell.md) или [портал](maintenance-notifications-portal.md) . 