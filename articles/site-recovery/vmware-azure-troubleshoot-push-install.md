---
title: Установка Push-установки службы безопасности с помощью установки Azure Site Recovery f
description: Ошибки устранения ошибок в установке служб мобильности при включении репликации для аварийного восстановления с помощью восстановления сайта Azure.
author: Rajeswari-Mamilla
manager: rochakm
ms.service: site-recovery
ms.topic: conceptual
ms.author: ramamill
ms.date: 09/11/2019
ms.openlocfilehash: 3646499ad2104566cb82f3f26c6b55d05f84dc7d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "73953779"
---
# <a name="troubleshoot-mobility-service-push-installation"></a>Установка Push-установки Службы по устранению неполадок 

Установка службы Mobility Service является ключевым шагом во время включения репликации. Успех этого шага зависит исключительно от выполнения предварительных требований и работы с поддерживаемыми конфигурациями. Как правило, сбои во время установки Mobility Service возникают по следующим причинам:

* [ошибки учетных данных или привилегий](#credentials-check-errorid-95107--95108);
* [Неудачные попытки входа.](#login-failures-errorid-95519-95520-95521-95522)
* [Ошибки подключения.](#connectivity-failure-errorid-95117--97118)
* [ошибки совместного доступа к файлам и принтерам](#file-and-printer-sharing-services-check-errorid-95105--95106);
* [ошибки WMI](#windows-management-instrumentation-wmi-configuration-check-error-code-95103);
* [Неподдерживаемые операционные системы](#unsupported-operating-systems)
* [Неподдерживаемые конфигурации загрузки](#unsupported-boot-disk-configurations-errorid-95309-95310-95311)
* [Ошибки установки VSS](#vss-installation-failures)
* [в конфигурации GRUB указано имя устройства вместо его UUID](#enable-protection-failed-as-device-name-mentioned-in-the-grub-configuration-instead-of-uuid-errorid-95320);
* [том LVM](#lvm-support-from-920-version);
* [предупреждения о необходимости перезагрузки](#install-mobility-service-completed-with-warning-to-reboot-errorid-95265--95266).

При включении репликации Azure Site Recovery пытается принудительно установить агент Mobility Service на виртуальной машине. В рамках этого процесса сервер конфигурации пытается подключиться к виртуальной машине и скопировать агент. Для успешной установки выполните пошаговые инструкции по устранению неполадок, представленные ниже.

## <a name="credentials-check-errorid-95107--95108"></a>Проверка учетных данных (код ошибки: 95107 и 95108)

* Убедитесь, что учетная запись пользователя, выбранная во время включения репликации, является **допустимой и верной**.
* Azure Site Recovery необходима учетная запись **суперпользователя** или учетная запись пользователя с **правами администратора** для выполнения принудительной установки. В противном случае принудительная установка будет заблокирована на исходном компьютере.
  * В Windows (**ошибка 95107**) убедитесь, что у учетной записи есть административный доступ, локальный или для домена, на исходном компьютере.
  * Если учетная запись домена не используется, на локальном компьютере потребуется отключить контроль удаленного доступа пользователей.
    * Чтобы отключить управление удаленным доступом пользователей на компьютере, добавьте в разделе реестра HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System параметр DWORD: LocalAccountTokenFilterPolicy. Присвойте ему значение 1. Для этого в окне командной строки выполните следующую команду:

         `REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1`
  * В Linux (**ошибка 95108**) выберите суперпользователя для успешной установки агента Mobility Service. Кроме того, SFTP-службы должны работать. Включите подсистему SFTP и проверку пароля в файле sshd_config:
    1. Выполните вход в качестве привилегированного пользователя.
    2. В файле /etc/ssh/sshd_config найдите строку, которая начинается с PasswordAuthentication.
    3. Раскомментируйте строку и измените значение на yes.
    4. Найдите строку, которая начинается с Subsystem, и раскомментируйте ее.
    5. Перезапустите службу SSHD.

Если вы хотите изменить учетные данные выбранной учетной записи, следуйте инструкциям, приведенным [здесь](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation).

## <a name="insufficient-privileges-failure-errorid-95517"></a>Недостаточная сбой привилегий (ErrorID: 95517)

Когда у пользователя, выбранного для установки агента Mobility Service, нет прав администратора, сервер конфигурации или сервер обработки масштабирования не смогут скопировать программное обеспечение этого агента на исходный компьютер. Таким образом, эта ошибка является результатом сбоя из-за отказа в доступе. Убедитесь, что учетной записи пользователя назначены права администратора.

Если вы хотите изменить учетные данные выбранной учетной записи, следуйте инструкциям, приведенным [здесь](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation).

## <a name="insufficient-privileges-failure-errorid-95518"></a>Недостаточная сбой привилегий (ErrorID: 95518)

Когда установить отношения доверительного кондиционирования домена между основным доменом и рабочей станцией не удается при попытке войти в исходную машину, установка агента мобильности не справляется с id 95518. Таким образом, убедитесь, что учетная запись пользователя, используемая для установки мобильного агента, имеет административные привилегии для входного в систему через основной домен исходной машины.

Если вы хотите изменить учетные данные выбранной учетной записи, следуйте инструкциям, приведенным [здесь](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation).

## <a name="login-failures-errorid-95519-95520-95521-95522"></a>Сбои входа (ErrorID: 95519, 95520, 95521, 95522)

### <a name="credentials-of-the-user-account-have-been-disabled-errorid-95519"></a>Учетные данные учетной записи пользователя были отключены (ErrorID: 95519)

Учетная запись пользователя, выбранная во время включения репликации, была отключена. Чтобы включить учетную запись пользователя, обратитесь к [этой статье](https://aka.ms/enable_login_user) или выполните следующую команду, заменив текст *username* фактическим именем пользователя.
`net user 'username' /active:yes`

### <a name="credentials-locked-out-due-to-multiple-failed-login-attempts-errorid-95520"></a>Учетные данные заблокированы из-за нескольких неудачных попыток входа (ErrorID: 95520)

Несколько неудачных повторных попыток при получении доступа к компьютеру приведут к блокировке учетной записи пользователя. Сбой может быть связан со следующими причинами:

* Во время настройки конфигурации указаны неверные учетные данные.
* Учетная запись пользователя, выбранная во время включения репликации, неправильная.

Поэтому измените выбранные учетные данные, следуя указанным [здесь](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation) инструкциям, и повторите операцию через некоторое время.

### <a name="logon-servers-are-not-available-on-the-source-machine-errorid-95521"></a>Логон серверы не доступны на исходной машине (ErrorID: 95521)

Эта ошибка возникает, когда серверы входа недоступны на исходном компьютере. Недоступность серверов входа приведет к сбою запроса на вход, и, следовательно, агент Mobility Service невозможно будет установить. Для успешного входа убедитесь, что серверы входа доступны на исходном компьютере, и запустите службу входа. Для получения подробных инструкций см. KB [139410](https://support.microsoft.com/en-in/help/139410/err-msg-there-are-currently-no-logon-servers-available) Err Msg: В настоящее время нет серверов лога.

### <a name="logon-service-isnt-running-on-the-source-machine-errorid-95522"></a>Служба Logon не работает на исходной машине (ErrorID: 95522)

Служба входа не запущена на исходном компьютере, что и вызвало сбой запроса на вход. Как результат агент Mobility Service невозможно установить. Чтобы устранить проблему, убедитесь, что служба входа запущена на исходном компьютере, что гарантирует успешный вход. Для запуска службы входа выполните команду net start Logon из командной строки или запустите службу NetLogon, используя диспетчер задач.

## <a name="connectivity-failure-errorid-95117--97118"></a>**Сбой подключения (Ошибка: 95117 & 97118)**

Сервер конфигурации или сервер обработки масштабирования пытаются подключиться к исходной виртуальной машине для установки агента Mobility Service. Эта ошибка возникает, если исходный компьютер недоступен из-за проблем с сетевым подключением. Чтобы устранить проблему:

* Проверьте связь исходного компьютера с сервером конфигурации. Если вы выбрали сервер обработки горизонтального масштабирования во время включения репликации, проверьте связь исходного компьютера с сервером обработки.
  * В командной строке компьютера исходного сервера используйте Telnet, чтобы проверить связь сервера конфигурации или сервера обработки горизонтального масштабирования с HTTPS-портом (135), как показано ниже, чтобы узнать, имеются ли проблемы с сетевым подключением или с блокировкой порта брандмауэра.

     `telnet <CS/ scale-out PS IP address> <135>`
* Кроме того, для **виртуальной машины Linux**:
  * Проверьте, установлены ли последние версии пакетов openssh, openssh-server и openssl.
  * Убедитесь, что протокол Secure Shell (SSH) включен и работает через порт 22.
  * SFTP-службы должны работать. Включите подсистему SFTP и проверку пароля в файле sshd_config:
    * Выполните вход в качестве привилегированного пользователя.
    * В файле /etc/ssh/sshd_config найдите строку, которая начинается с PasswordAuthentication.
    * Раскомментируйте строку и измените значение на yes.
    * Найдите строку, которая начинается с Subsystem, и раскомментируйте ее.
    * Перезапустите службу SSHD.
* Попытка соединения может завершиться сбоем, если после определенного периода не поступает допустимый ответ, или установленное соединение может завершиться, если подключенный узел не отвечает.
* Это может быть вызвано проблемой с подключением, сетью или доменом. Также это может быть связано с проблемой разрешения имени DNS или нехваткой порта TCP. Проверьте, существуют ли такие проблемы в вашем домене.

## <a name="connectivity-failure-errorid-95523"></a>Сбой подключения (ErrorID: 95523)

Эта ошибка возникает, если сеть, в которой находится исходный компьютер, не найдена, была удалена или больше недоступна. Единственным способом для устранения этой ошибки является проверка наличия сети.

## <a name="file-and-printer-sharing-services-check-errorid-95105--95106"></a>Проверка служб совместного доступа к файлам и принтерам (код ошибки: 95105 и 95106)

После проверки подключения убедитесь, что на вашей виртуальной машине включена служба совместного доступа к файлам и принтерам. Эти параметры необходимы для копирования агента Mobility Service на исходный компьютер.

Для **Windows 2008 R2 и более ранних версий**

* Включение общего доступа к файлам и принтерам через брандмауэр Windows:
  * Откройте панель управления -> Система и безопасность -> Брандмауэр Windows -> на левой панели нажмите Дополнительные параметры -> выберите "Правила для входящих подключений" в дереве консоли.
  * Найдите правила "Общий доступ к файлам и принтерам (NB-Session-In)" и "Общий доступ к файлам и принтерам (SMB-In)". Щелкните правой кнопкой мыши на каждом правиле и нажмите **Включить правило**.
* Включение общего доступа к файлам с помощью групповой политики:
  * Откройте меню "Пуск", введите "gpmc.msc" и выполните поиск.
  * На панели навигации откройте следующие папки: "Политика локального компьютера", "Конфигурация пользователя", "Административные шаблоны", "Компоненты Windows" и "Общий доступ к сети".
  * В области сведений дважды щелкните **Запретить пользователям представлять общий доступ к файлам в профиле**. Чтобы отключить параметр "Групповая политика" и разрешить предоставлять общий доступ к файлам, нажмите "Отключено". Нажмите кнопку ОК, чтобы сохранить изменения. Чтобы узнать больше, [см. Включить или отключить обмен файлами с помощью групповой политики](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754359(v=ws.10)).

Для **более поздних версий**следуйте инструкциям, предоставленным в [службе установки Mobility для аварийного восстановления VMw и физических серверов](vmware-azure-install-mobility-service.md) для обеспечения совместного использования файлов и принтеров.

## <a name="windows-management-instrumentation-wmi-configuration-check-error-code-95103"></a>Проверка конфигурации управления Windows (WMI) (Код ошибки: 95103)

После проверки служб файлов и принтеров включите службу WMI для частного и общедоступного профиля, а также профиля домена через брандмауэр. Эти параметры необходимы для запуска удаленного выполнения на исходном компьютере. Чтобы включить:

* Откройте панель управления, щелкните "Безопасность", а затем "Брандмауэр Windows".
* Откройте вкладку "Исключения" в разделе "Изменить параметры".
* В окне "Исключения" установите флажок для инструментария управления Windows (WMI), чтобы разрешить трафик WMI через брандмауэр. 

Вы также можете разрешить трафик WMI через брандмауэр в командной строке. Используйте команду `netsh advfirewall firewall set rule group="windows management instrumentation (wmi)" new enable=yes`
Дополнительные сведения об устранении неполадок WMI:

* [Базовое тестирование WMI](https://blogs.technet.microsoft.com/askperf/2007/06/22/basic-wmi-testing/)
* [Устранение неполадок WMI](https://msdn.microsoft.com/library/aa394603(v=vs.85).aspx)
* [Проблемы устранения неполадок с помощью скриптов WMI и сервисов WMI](https://technet.microsoft.com/library/ff406382.aspx#H22)

## <a name="unsupported-operating-systems"></a>Неподдерживаемая операционная система

Еще одной частой причиной сбоя может быть неподдерживаемая операционная система. Убедитесь, что используете поддерживаемую версию операционной системы или ядра, для успешной установки службы Mobility Service. Избегайте использования закрытого исправления.
Чтобы просмотреть полный список версий операционных систем и ядра, которые поддерживаются службой Azure Site Recovery, см. [таблицу поддержки](vmware-physical-azure-support-matrix.md#replicated-machines).

## <a name="unsupported-boot-disk-configurations-errorid-95309-95310-95311"></a>Неподдерживаемые конфигурации загрузочным диска (ErrorID: 95309, 95310, 95311)

### <a name="boot-and-system-partitions--volumes-are-not-the-same-disk-errorid-95309"></a>Загрузочные и системные перегородки / тома не являются одинаковым диском (ErrorID: 95309)

До версии 9.20, если загрузочные и системные разделы или тома находились на разных дисках, такая конфигурация не поддерживалась. Начиная с [версии 9.20](https://support.microsoft.com/en-in/help/4478871/update-rollup-31-for-azure-site-recovery) такая конфигурация поддерживается. Используйте последнюю версию для поддержки этой возможности.

### <a name="the-boot-disk-is-not-available-errorid-95310"></a>Загрузочный диск недоступен (ErrorID: 95310)

Невозможно защитить виртуальную машину без загрузочного диска. Это необходимо для обеспечения бесперебойного восстановления виртуальной машины во время восстановления после отработки отказа. Отсутствие загрузочного диска приводит к невозможности загрузки компьютера после отработки отказа. Убедитесь, что виртуальная машина содержит загрузочный диск, и повторите операцию. Также обратите внимание, что несколько загрузочных дисков на одном компьютере не поддерживаются.

### <a name="multiple-boot-disks-present-on-the-source-machine-errorid-95311"></a>Несколько дисков boot, присутствующих на исходной машине (ErrorID: 95311)

Виртуальная машина с несколькими загрузочными дисками не является [поддерживаемой конфигурацией](vmware-physical-azure-support-matrix.md#linux-file-systemsguest-storage).

## <a name="system-partition-on-multiple-disks-errorid-95313"></a>Системная перегородка на нескольких дисках (ErrorID: 95313)

До версии 9.20 конфигурация, в которой корневой раздел или том расположен на нескольких дисках, не поддерживалась. Начиная с [версии 9.20](https://support.microsoft.com/en-in/help/4478871/update-rollup-31-for-azure-site-recovery) такая конфигурация поддерживается. Используйте последнюю версию для поддержки этой возможности.

## <a name="enable-protection-failed-as-device-name-mentioned-in-the-grub-configuration-instead-of-uuid-errorid-95320"></a>Защита включить не удалось, как имя устройства, указанное в конфигурации GRUB вместо UUID (ErrorID: 95320)

**Возможная причина:** </br>
Файлы конфигурации GRUB ("/boot/grub/menu.lst", "/boot/grub/grub.cfg", "/boot/grub2/grub.cfg" или "/etc/default/grub") могут содержать значение для **корней** параметров и **резюмироваться** как фактические названия устройств вместо UUID. Site Recovery требует наличие подхода UUID, поскольку имя устройства может меняться при перезагрузке виртуальной машины, а виртуальная машина может не выдавать одно и то же имя при сбое, что приводит к ошибкам. Пример: </br>


- Следующая строка из файла GRUB **/boot/grub2/grub.cfg**. <br>
  *linux   /boot/vmlinuz-3.12.49-11-default **root=/dev/sda2**  ${extra_cmdline} **resume=/dev/sda1** splash=silent quiet showopts*


- Следующая строка из файла GRUB **/boot/grub/menu.lst**
  *ядро /загрузка/vmlinuz-3.0.101-63-по умолчанию **корень/dev/sda2** **резюме/dev/sda1** splash'silent crashkernel-256M-:128M showopts vga'0x314*

Обратите внимание на строки, выделенные полужирным шрифтом: параметры "root" и "resume" в GRUB содержат фактические имена устройств вместо их UUID.
 
**Как исправить:**<br>
Имена устройств должны быть заменены на соответствующий UUID.<br>


1. Найти UUID устройства, выдав команду "blkid \<имя устройства>". Пример:<br>
   ```
   blkid /dev/sda1
   /dev/sda1: UUID="6f614b44-433b-431b-9ca1-4dd2f6f74f6b" TYPE="swap"
   blkid /dev/sda2 
   /dev/sda2: UUID="62927e85-f7ba-40bc-9993-cc1feeb191e4" TYPE="ext3" 
   ```

2. Теперь замените название устройства на UUID в формате,\<как "root-UUID" UUID>". Например, если мы заменим имена устройств на UUID для корней и резюме параметра, упомянутых выше в файлах "/boot/grub2/grub.cfg", "/boot/grub2/grub.cfg" или "/etc/default/grub: тогда линии в файлах выглядят как. <br>
   *kernel /boot/vmlinuz-3.0.101-63-default **root=UUID=62927e85-f7ba-40bc-9993-cc1feeb191e4** **resume=UUID=6f614b44-433b-431b-9ca1-4dd2f6f74f6b** splash=silent crashkernel=256M-:128M showopts vga=0x314*
3. Перезапустите службу защиты еще раз.

## <a name="install-mobility-service-completed-with-warning-to-reboot-errorid-95265--95266"></a>Установка мобильной службы завершена с предупреждением для перезагрузки (ErrorID: 95265 & 95266)

Служба мобильности Site Recovery состоит из множества компонентов, один из которых — драйвер-фильтр. Драйвер-фильтр загружаться в системную память только во время перезагрузки системы. Это означает, что исправления драйвер-фильтра можно реализовать только во время загрузки нового драйвер-фильтра — только при перезагрузке системы.

**Обратите внимание**, что это предупреждение, и существующая репликация будут работать даже после обновления нового агента. Вы можете выбрать перезагрузку в любое время вы хотите получить преимущества нового драйвера фильтра, но если вы не перезагрузить старый драйвер фильтра продолжает работать. В таком случае после обновления без перезагрузки можно **воспользоваться преимуществами других улучшений службы мобильности** без обновления драйвер-фильтра. Таким образом, хотя и рекомендуется, это не является обязательным для перезагрузки после каждого обновления. Для получения информации о том, когда перезагрузка является обязательной, установите [перезагрузку исходной машины после обновления мобильного агента](https://aka.ms/v2a_asr_reboot) в обновлениях службы в Azure Site Recovery.

> [!TIP]
>Для достижения наилучших методов планирования обновлений во время окна обслуживания [см. поддержку последних версий ОС/ядра](https://aka.ms/v2a_asr_upgrade_practice) в обновлениях службы в Azure Site Recovery.

## <a name="lvm-support-from-920-version"></a>Поддержка диспетчера логических томов (LVM) начиная с версии 9.20

До версии 9.20 LVM поддерживался только для дисков данных. Каталог /boot должен находиться в разделе диска и не должен быть томом LVM.

Начиная с [версии 9.20](https://support.microsoft.com/en-in/help/4478871/update-rollup-31-for-azure-site-recovery)[LVM поддерживается для диска операционной системы](vmware-physical-azure-support-matrix.md#linux-file-systemsguest-storage). Используйте последнюю версию для поддержки этой возможности.

## <a name="insufficient-space-errorid-95524"></a>Недостаточное пространство (Ошибка: 95524)

При копировании агента Mobility Service на исходный компьютер необходимо по крайней мере 100 МБ свободного места. Поэтому убедитесь, что у исходного компьютера достаточно свободного места, и повторите операцию.

## <a name="vss-installation-failures"></a>Ошибки установки VSS

Установка VSS является частью установки агента Mobility. Эта служба используется в процессе создания точек восстановления с согласованным состоянием приложений. Ошибки во время установки VSS могут возникнуть по нескольким причинам. Чтобы в точности определить ошибки, просмотрите файл **c:\ProgramData\ASRSetupLogs\ASRUnifiedAgentInstaller.log**. В следующем разделе выделены некоторые распространенные ошибки и действия по их устранению.

### <a name="vss-error--2147023170-0x800706be---exit-code-511"></a>Ошибка VSS 2147023170 [0x800706BE] — код выхода 511

Эта проблема в основном наблюдается, когда антивирусное программное обеспечение блокирует работу служб восстановления сайта Azure. Для разрешения этой проблемы:

1. Исключите все папки, упомянутые [здесь](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program).
2. Следуйте указаниям, опубликованным поставщиком антивирусных программ, чтобы разблокировать регистрацию DLL в Windows.

### <a name="vss-error-7-0x7---exit-code-511"></a>Ошибка VSS 7 [0x7] — код выхода 511

Эта ошибка среды выполнения вызвана нехваткой памяти для установки VSS. Убедитесь, что дисковое пространство увеличено для успешного завершения этой операции.

### <a name="vss-error--2147023824-0x80070430---exit-code-517"></a>Ошибка VSS 2147023824 [0x80070430] — код выхода 517

Эта ошибка возникает, когда служба поставщика VSS Azure Site Recovery [помечена для удаления](https://msdn.microsoft.com/library/ms838153.aspx). Попробуйте вручную установить VSS на исходный компьютер, запустив следующую командную строку:

`C:\Program Files (x86)\Microsoft Azure Site Recovery\agent>"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

### <a name="vss-error--2147023841-0x8007041f---exit-code-512"></a>Ошибка VSS 2147023841 [0x8007041F] — код выхода 512

Эта ошибка возникает, когда база данных службы поставщика VSS Azure Site Recovery [заблокирована](https://msdn.microsoft.com/library/ms833798.aspx). Попробуйте вручную установить VSS на исходный компьютер, запустив следующую командную строку:

`C:\Program Files (x86)\Microsoft Azure Site Recovery\agent>"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

В случае сбоя проверьте, не застревают ли какие-либо антивирусные программы или другие службы в состоянии "Старт". Это может сохранить блокировку служб баз данных. Это приведет к сбоям в установке поставщика VSS. Убедитесь, что служба не находится в состоянии "Запуск", а затем повторить вышеупомянутую операцию.

### <a name="vss-exit-code-806"></a>Код выхода VSS 806

Эта ошибка возникает, когда учетная запись пользователя, используемая для установки, не имеет разрешений на выполнение команды CSScript. Предоставьте учетной записи пользователя необходимые разрешения на выполнение скрипта и повторите операцию.

### <a name="other-vss-errors"></a>Другие ошибки VSS

Попробуйте вручную установить службу поставщика VSS на исходный компьютер, запустив следующую командную строку:

`C:\Program Files (x86)\Microsoft Azure Site Recovery\agent>"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`



## <a name="vss-error---0x8004e00f"></a>Ошибка VSS - 0x8004E00F

Эта ошибка обычно возникает при установке мобильного агента из-за проблем в DCOM и DCOM находится в критическом состоянии.

Используйте следующую процедуру, чтобы определить причину ошибки.

**Изучите журналы установки**

1. Откройте журнал установки, расположенный по адресу c:'ProgramData-ASRSetupLogs-ASRUnifiedAgentInstaller.log.
2. Наличие следующей ошибки указывает на эту проблему:

    Нерегистрация существующего приложения...  Создание объекта каталога Получить коллекцию приложений 

    ОШИБКА:

    - Код ошибки: -2147164145
    - Код выхода: 802

Чтобы устранить проблему:

Свяжитесь с [группой платформы Microsoft Windows,](https://aka.ms/Windows_Support) чтобы получить помощь в решении проблемы DCOM.

Когда проблема DCOM будет решена, переустановите vsS-провайдер Azure Site, используя следующие команды:
 
**C:'Программные файлы (x86)»Microsoft Azure Site Recovery-агент>"C:'Файлы программы (x86)»-"Microsoft Azure Site Recovery-InMageVSSProvider_Install.cmd**
  
Если согласованность приложений не является критической для требований аварийного восстановления, можно обойти установку VSS Provider. 

Чтобы обойти установку azure Site Recovery VSS Provider и вручную установить послеустановку послеустановки Azure Site Recovery VSS Provider:

1. Установите услугу мобильности. 
   > [!Note]
   > 
   > Установка выйдет из строя на этапе "Почтовая установка конфигурации". 
2. Чтобы обойти установку VSS:
   1. Откройте каталог установки службы восстановления мобильности сайта Azure, расположенный по адресу:
   
      C:-Программные файлы (x86) » Агент восстановления лазурного средства Microsoft Azure
   2. Изменяйте сценарии установки установки vsS-провайдера Сайта **Azure, nMageVSSProvider_Install** и **InMageVSSProvider_Uninstall.cmd,** чтобы всегда преуспеть, добавив следующие строки:
    
      ```     
      rem @echo off
      setlocal
      exit /B 0
      ```

3. Повторное запуск установки мобильного агента вручную. 
4. Когда установка успешно и переходит к следующему шагу, **настроите,** удалите добавленные строки.
5. Чтобы установить провайдера VSS, откройте запрос команды в качестве администратора и запустите следующую команду:
   
    **C:'Программные файлы (x86)»-"Рекуперации сайта Microsoft Azure'> .'InMageVSSProvider_Install.cmd**

9. Убедитесь, что поставщик ASR VSS установлен в качестве службы в службах Windows, и откройте Компонентную службу MMC, чтобы проверить, что поставщик ASR VSS указан.
10. Если установка VSS Provider продолжает выходить из строя, работайте с CX, чтобы устранить ошибки разрешений в CAPI2.

## <a name="vss-provider-installation-fails-due-to-the-cluster-service-being-enabled-on-non-cluster-machine"></a>Установка VSS Provider не удается из-за включения кластерного обслуживания на некластерном компьютере

Эта проблема приводит к тому, что установка установки переодежения подвижного средства Azure Site сбой во время этапа установки ASAzure Site RecoveryR VSS Provider из-за проблемы с КОМЗ, которая препятствует установке поставщика VSS.
 
### <a name="to-identify-the-issue"></a>Для выявления проблемы

В журнале, расположенном на сервере конфигурации по адресу C: 'ProgramData-ASRSetupLogs-UploadedLogs\<дата-время>UA_InstallLogFile.log, вы найдете следующее исключение:

Коме не смог поговорить с координатором распределенных транзакций Майкрософт (Исключение из HRESULT: 0x8004E00F)

Чтобы устранить проблему:

1.  Убедитесь, что эта машина является некластерной машиной и что компоненты кластера не используются.
3.  Если компоненты не используются, удалите компоненты кластера из машины.

## <a name="drivers-are-missing-on-the-source-server"></a>Драйверы отсутствуют на сервере исходного кода

Если установка Mobility Agent не удается, изучите журналы в соответствии с C: «ProgramData»ASRSetupLogs, чтобы определить, отсутствуют ли некоторые из необходимых драйверов в некоторых наборах управления.
 
Чтобы устранить проблему:
  
1. Используя редактор реестра, такой как regedit.msc, откройте реестр.
2. Откройте узла HKEY_LOCAL_MACHINE SYSTEM.
3. В узло SYSTEM найдите наборы управления.
4. Откройте каждый набор управления и убедитесь, что следующие драйверы Windows присутствуют:

   - Atapi
   - Вмбус
   - Сторфльт
   - Сторвск
   - intelide;
 
Переустановите все недостающие драйверы.

## <a name="next-steps"></a>Дальнейшие действия

[Узнайте, как](vmware-azure-tutorial.md) настроить аварийное восстановление для виртуальных машин VMware.
