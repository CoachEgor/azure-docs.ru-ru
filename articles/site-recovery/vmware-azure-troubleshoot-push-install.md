---
title: Установка Push-установки службы обслуживания проблем с восстановлением сайта Azure
description: Ошибки устранения ошибок в установке служб мобильности при включении репликации для аварийного восстановления с помощью восстановления сайта Azure.
author: Rajeswari-Mamilla
manager: rochakm
ms.service: site-recovery
ms.topic: conceptual
ms.author: ramamill
ms.date: 04/03/2020
ms.openlocfilehash: 1afd931249d4dbeda2b4b25f822837e2a564f959
ms.sourcegitcommit: 62c5557ff3b2247dafc8bb482256fef58ab41c17
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80656321"
---
# <a name="troubleshoot-mobility-service-push-installation"></a>Установка push-нажима службы Troubleshoot Mobility

Установка службы Мобильности является ключевым шагом для включения репликации. Успех этого шага зависит от соблюдения предпосылок и работы с поддерживаемыми конфигурациями. Наиболее распространенные сбои, с которыми вы можете столкнуться во время установки службы Mobility, связаны с:

* [ошибки учетных данных или привилегий](#credentials-check-errorid-95107--95108);
* [Неудачные попытки входа.](#login-failures-errorid-95519-95520-95521-95522)
* [Ошибки подключения.](#connectivity-failure-errorid-95117--97118)
* [ошибки совместного доступа к файлам и принтерам](#file-and-printer-sharing-services-check-errorid-95105--95106);
* [Сбои в работе инструментов управления Windows (WMI)](#windows-management-instrumentation-wmi-configuration-check-error-code-95103)
* [Неподдерживаемые операционные системы](#unsupported-operating-systems)
* [Неподдерживаемые конфигурации загрузки](#unsupported-boot-disk-configurations-errorid-95309-95310-95311)
* [Сбои установки Службы копирования теней тома (VSS)](#vss-installation-failures)
* [в конфигурации GRUB указано имя устройства вместо его UUID](#enable-protection-failed-as-device-name-mentioned-in-the-grub-configuration-instead-of-uuid-errorid-95320);
* [Логический менеджер по объему (LVM) объем](#lvm-support-from-920-version)
* [предупреждения о необходимости перезагрузки](#install-mobility-service-completed-with-warning-to-reboot-errorid-95265--95266).

При включании репликации восстановление сайта Azure пытается установить агент службы мобильности на виртуальную машину (VM). В рамках этого процесса сервер конфигурации пытается подключиться к виртуальной машине и скопировать агента. Чтобы обеспечить успешную установку, следуйте пошаговым рекомендациям по устранению неполадок.

## <a name="credentials-check-errorid-95107--95108"></a>Проверка учетных данных (код ошибки: 95107 и 95108)

Проверьте, является ли учетная запись пользователя, выбранная во время репликации включить, действительной и точной. Восстановление сайта Azure требует, чтобы **корневая** учетная запись или учетная запись пользователя с **привилегиями администратора** выполняли установку push. В противном случае установка push будет заблокирована на исходной машине.

Для Windows **(ошибка 95107**), убедитесь, что учетная запись пользователя имеет административный доступ на исходном компьютере, либо с локальной учетной записью или учетной записью домена. Если вы не используете учетную запись домена, вам необходимо отключить управление удаленного доступа пользователей на локальном компьютере.

* Для ручного добавления ключа реестра, который отключает управление удаленного пользовательского доступа:

  * `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`
  * Добавить `DWORD`новый:`LocalAccountTokenFilterPolicy`
  * Установите значение для`1`

* Чтобы добавить ключ реестра из запроса команды, запустите следующую команду:

  `REG ADD HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1`

Для Linux **(ошибка 95108),** вы должны выбрать **корневой** счет для успешной установки мобильного агента службы. Кроме того, должны быть запущены службы sSH File Transfer Protocol (SFTP). Для обеспечения подсистемы SFTP и проверки подлинности пароля в _sshd_config_ файле:

1. Войти в качестве **корня**.
1. Перейти к _/etc/shsh/sshd_config файл,_ найдите строку, которая начинается с `PasswordAuthentication`.
1. Некомментируйте строку и измените значение на `yes`.
1. Найти линию, `Subsystem`которая начинается с , и без комментариев линии.
1. Перезапустите службу `sshd` .

Если вы хотите изменить учетные данные выбранной учетной записи пользователя, следуйте [этим инструкциям.](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation)

## <a name="insufficient-privileges-failure-errorid-95517"></a>Недостаточная сбой привилегий (ErrorID: 95517)

Если пользователь, выбранный для установки агента Mobility, не имеет привилегий администратора, сервер процесса настройки/масштабирования не будет допущен к копированию программного обеспечения агента Mobility для исходной машины. Эта ошибка является результатом отказа от сбоя доступа. Убедитесь, что учетной записи пользователя назначены права администратора.

Если вы хотите изменить учетные данные выбранной учетной записи пользователя, следуйте [этим инструкциям.](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation)

## <a name="insufficient-privileges-failure-errorid-95518"></a>Недостаточная сбой привилегий (ErrorID: 95518)

Когда создание доверительных отношений домена между основным доменом и рабочей станцией выходит из строя при попытке войти в исходную машину, установка агента Mobility завершается сбоем с идентификатором ошибки 95518. Убедитесь, что учетная запись пользователя, используемая для установки агента Mobility, имеет административные привилегии для входного в входного сообщения через основной домен исходной машины.

Если вы хотите изменить учетные данные выбранной учетной записи пользователя, следуйте [этим инструкциям.](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation)

## <a name="login-failures-errorid-95519-95520-95521-95522"></a>Сбои входа (ErrorID: 95519, 95520, 95521, 95522)

В этом разделе описаны сообщения с учетным и учетным и ошибками входа.

### <a name="credentials-of-the-user-account-have-been-disabled-errorid-95519"></a>Учетные данные учетной записи пользователя были отключены (ErrorID: 95519)

Учетная запись пользователя, выбранная во время репликации включить, была отключена. Чтобы включить учетную запись пользователя, обратитесь к [этой статье](/powershell/module/Microsoft.PowerShell.LocalAccounts/Enable-LocalUser) или запустите следующую команду, заменив _имя пользователя_ с фактическим именем пользователя.

`net user 'username' /active:yes`

### <a name="credentials-locked-out-because-of-multiple-failed-login-attempts-errorid-95520"></a>Учетные данные заблокированы из-за нескольких неудачных попыток входа (ErrorID: 95520)

Несколько неудачных повторных попыток при получении доступа к компьютеру приведут к блокировке учетной записи пользователя. Сбой может быть связан со следующими причинами:

* Учетные данные, предоставляемые при настройке конфигурации, неверны.
* Пользовательская учетная запись, выбранная во время репликации включить, неверна.

Измените выбранные учетные данные, следуя [этим инструкциям,](vmware-azure-manage-configuration-server.md#modify-credentials-for-mobility-service-installation) и повторите операцию.

### <a name="logon-servers-arent-available-on-the-source-machine-errorid-95521"></a>Логон серверы не доступны на исходной машине (ErrorID: 95521)

Эта ошибка возникает, когда серверы входа недоступны на исходной машине. Если серверы входа недоступны, запросы на вход не сдадутся, а агент Mobility не может быть установлен. Для успешного входа убедитесь, что серверы входа доступны на исходной машине и запустите службу Netlogon. Для получения дополнительной информации смотрите [сценарии входа в журнал Windows](/windows-server/security/windows-authentication/windows-logon-scenarios).

### <a name="logon-service-isnt-running-on-the-source-machine-errorid-95522"></a>Служба Logon не работает на исходной машине (ErrorID: 95522)

Служба входа не работает на исходной машине и вызвала сбой запроса входа. Агент мобильности не может быть установлен. Чтобы устранить ошибку, используйте один из `Netlogon` следующих методов для запуска службы на исходной машине:

* Чтобы запустить `Netlogon` службу с командной `net start Netlogon`подсказки, запустите команду.
* От менеджера задач `Netlogon` запустите службу.

## <a name="connectivity-failure-errorid-95117--97118"></a>Сбой подключения (Ошибка: 95117 & 97118)

Сервер конфигурации/масштабирование процесса пытается подключиться к исходую VM для установки агента мобильности. Эта ошибка возникает, когда исходная машина недосягаема из-за проблем с подключением к сети.

Чтобы устранить эту ошибку, сделайте следующее:

* Убедитесь, что вы можете пинг исходного аппарата с сервера конфигурации. Если вы выбрали сервер процесса масштабирования во время репликации включить, убедитесь, что вы можете пинг исходную машину с сервера процесса.

* От командной строки машины `Telnet` сервера исходного сервера используйте для пинга сервера конфигурации или сервера процесса масштабирования в порту HTTPS 135, как показано в следующей команде. Эта команда проверяет наличие проблем с подключением сети или блокировку брандмауэра.

  `telnet <CS/ scale-out PS IP address> <135>`

* Кроме того, для Linux VM:
  * Проверьте, установлены ли последние пакеты OpenSSH, OpenSSH Server и OpenSSL.
  * Убедитесь, что протокол Secure Shell (SSH) включен и работает через порт 22.
  * SFTP-службы должны работать. Для обеспечения подсистемы SFTP и проверки подлинности пароля в _sshd_config_ файле:

    1. Войти в качестве **корня**.
    1. Перейти к _/etc/ssh/sshd_config_ файл, найдите строку, которая начинается с `PasswordAuthentication`.
    1. Некомментируйте строку и измените значение на `yes`.
    1. Найти линию, `Subsystem`которая начинается с , и без комментариев линии
    1. Перезапустите службу `sshd` .

* Попытка подключения могла быть неудачной, если через какое-то время не было надлежащих ответов или устоявшегося соединения не удалось, поскольку подключенный узла не ответил.
* Это может быть проблема подключения/сети/домена. Это также может быть связано с тем, что проблема решения проблемы решения dNS или проблемы истощения порта TCP. Проверьте, существуют ли такие проблемы в вашем домене.

## <a name="connectivity-failure-errorid-95523"></a>Сбой подключения (ErrorID: 95523)

Эта ошибка возникает, когда сеть, в которую находится исходная машина, не найдена, может быть удалена или больше недоступна. Единственный способ устранить ошибку — убедиться в существовании сети.

## <a name="file-and-printer-sharing-services-check-errorid-95105--95106"></a>Проверка служб совместного доступа к файлам и принтерам (код ошибки: 95105 и 95106)

После проверки подключения проверьте, включен атакжем ируется ли служба обмена файлами и принтерами на вашей виртуальной машине. Эти настройки необходимы для копирования агента Мобильности на исходную машину.

Для **Windows 2008 R2 и предыдущих версий:**

* Включение общего доступа к файлам и принтерам через брандмауэр Windows:
  1. Система **панели** > открытого управления**и системы безопасности** > **Windows Firewall**. В левом стеле выберите **Расширенные настройки** > **Входящие правила** в консольном дереве.
  1. Найдите правила "Общий доступ к файлам и принтерам (NB-Session-In)" и "Общий доступ к файлам и принтерам (SMB-In)".
  1. Щелкните правой кнопкой мыши на каждом правиле и нажмите **Включить правило**.

* Для обеспечения обмена файлами с политикой группы:
  1. Перейти к `gpmc.msc` **запуску,** введите и поиск.
  1. В навигационном стеколе откройте следующие папки: **Локальная компьютерная политика** > **Пользователь Configuration** > **Административные шаблоны** > **Windows Компоненты** > **Сети Обмен.**
  1. В области сведений дважды щелкните **Запретить пользователям представлять общий доступ к файлам в профиле**.

     Чтобы отключить настройки групповой политики и предоставить пользователю возможность совместного использования файлов, выберите **Отключение.**

  1. Нажмите кнопку **ОК** , чтобы сохранить изменения.

  Чтобы узнать больше, [см. Включить или отключить обмен файлами с помощью групповой политики](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754359(v=ws.10)).

Для обеспечения совместного использования файлов и принтеров для более поздних версий Windows или Linux следуйте инструкциям в [службе установки мобильности для аварийного восстановления VMw и физических серверов.](vmware-azure-install-mobility-service.md)

## <a name="windows-management-instrumentation-wmi-configuration-check-error-code-95103"></a>Проверка конфигурации управления Windows (WMI) (Код ошибки: 95103)

После проверки служб файлов и принтеров включите службу WMI для частных, общедоступных и доменных профилей через брандмауэр. Эти параметры необходимы для запуска удаленного выполнения на исходном компьютере.

Для включения WMI:

1. Перейдите к**безопасности** **панели** > управления и выберите Windows **Firewall.**
1. Выберите **параметры изменений,** а затем выберите вкладку **Исключений.**
1. В окне **Исключений** выберите флажок для инструментов управления Windows (WMI), чтобы включить трафик WMI через брандмауэр.

Вы также можете включить трафик WMI через брандмауэр из запроса команды со следующей командой:

`netsh advfirewall firewall set rule group="windows management instrumentation (wmi)" new enable=yes`

Дополнительные сведения об устранении неполадок WMI:

* [Базовое тестирование WMI](https://blogs.technet.microsoft.com/askperf/2007/06/22/basic-wmi-testing/)
* [Устранение неполадок WMI](/windows/win32/wmisdk/wmi-troubleshooting)
* [Проблемы устранения неполадок с помощью скриптов WMI и сервисов WMI](/previous-versions/tn-archive/ff406382(v=msdn.10))

## <a name="unsupported-operating-systems"></a>Неподдерживаемые операционные системы

Другой распространенной причиной сбоя может быть из-за неподдерживаемой операционной системы. Используйте поддерживаемую операционную систему и версию ядра для успешной установки службы Mobility. Избегайте использования частных патчей.

Для просмотра списка операционных систем и версий ядер, [support matrix document](vmware-physical-azure-support-matrix.md#replicated-machines)поддерживаемых восстановлением сайта Azure, см.

## <a name="unsupported-boot-disk-configurations-errorid-95309-95310-95311"></a>Неподдерживаемые конфигурации загрузочным диска (ErrorID: 95309, 95310, 95311)

### <a name="boot-and-system-partitions--volumes-arent-the-same-disk-errorid-95309"></a>Загрузка и системные перегородки / тома не тот же диск (ErrorID: 95309)

До версии 9.20 разделы/объемы загрузки и системы на разных дисках были неподдерживаемой конфигурацией. Начиная с [версии 9.20,](https://support.microsoft.com/help/4478871/update-rollup-31-for-azure-site-recovery)эта конфигурация поддерживается.

### <a name="the-boot-disk-isnt-available-errorid-95310"></a>Загрузочный диск недоступен (ErrorID: 95310)

Виртуальная машина без загрузожаемого диска не может быть защищена. Загрузочный диск обеспечивает плавное восстановление виртуальной машины во время сбоя. Отсутствие загрузоспособного диска приводит к отказу в загрузке машины после сбоя. Убедитесь, что виртуальная машина содержит загрузочный диск и повторно попробуйте операцию. Кроме того, несколько загрузочных дисков на одной и той же машине не поддерживаются.

### <a name="multiple-boot-disks-present-on-the-source-machine-errorid-95311"></a>Несколько дисков boot, присутствующих на исходной машине (ErrorID: 95311)

Виртуальная машина с несколькими загрузочными дисками не является [поддерживаемой конфигурацией.](vmware-physical-azure-support-matrix.md#linux-file-systemsguest-storage)

## <a name="system-partition-on-multiple-disks-errorid-95313"></a>Системная перегородка на нескольких дисках (ErrorID: 95313)

До версии 9.20 корневая перегородка или настройка громкости на нескольких дисках была неподдерживаемой конфигурацией. Начиная с [версии 9.20,](https://support.microsoft.com/help/4478871/update-rollup-31-for-azure-site-recovery)эта конфигурация поддерживается.

## <a name="enable-protection-failed-as-device-name-mentioned-in-the-grub-configuration-instead-of-uuid-errorid-95320"></a>Защита включить не удалось, как имя устройства, указанное в конфигурации GRUB вместо UUID (ErrorID: 95320)

### <a name="possible-cause"></a>Возможные причины

Файлы конфигурации Grand Unified Bootloader (GRUB) (_/boot/grub/menu.lst,_ _/boot/grub/grub.cfg,_ _/boot/grub2/grub.cfg_, или _/etc/default/grub)_ могут содержать значение для **корней** параметров и **возобновляются** как фактические названия устройств вместо универсально уникального идентификатора (UUID). Восстановление сайта требует подхода UUID, поскольку имена устройств могут изменяться при перезагрузке VM. Например, VM не может выйти в интернет с тем же именем на failover, и что приводит к проблемам.

Пример:

- Следующая строка из файла GRUB _/boot/grub2/grub.cfg:_

  `linux /boot/vmlinuz-3.12.49-11-default root=/dev/sda2  ${extra_cmdline} resume=/dev/sda1 splash=silent quiet showopts`

- Следующая строка из файла GRUB _/загрузка/grub/menu.lst:_

  `kernel /boot/vmlinuz-3.0.101-63-default root=/dev/sda2 resume=/dev/sda1 splash=silent crashkernel=256M-:128M showopts vga=0x314`

> [!NOTE]
> Линии GRUB содержат фактические названия устройств для **корней** параметров и **резюме,** а не UUID.

### <a name="how-to-fix"></a>Как исправить

Имена устройств должны быть заменены на соответствующий UUID.

1. Найдите UUID устройства, выдав команду. `blkid \<device name>`

   Пример:

   ```shell
   blkid /dev/sda1
   /dev/sda1: UUID="6f614b44-433b-431b-9ca1-4dd2f6f74f6b" TYPE="swap"
   blkid /dev/sda2
   /dev/sda2: UUID="62927e85-f7ba-40bc-9993-cc1feeb191e4" TYPE="ext3"
   ```

1. Теперь замените название устройства на UUID в формате, как `root=UUID=\<UUID>`. Например, если мы заменим имена устройств на UUID для корней и резюме параметра, упомянутых в файлах _/ загрузка / grub2/grub.cfg_, _/ загрузка / grub2/grub.cfg_, или _/ и т.д./по умолчанию / GRUB_ затем строки в файлах выглядят следующим и следующим образом:

   `kernel /boot/vmlinuz-3.0.101-63-default root=UUID=62927e85-f7ba-40bc-9993-cc1feeb191e4 resume=UUID=6f614b44-433b-431b-9ca1-4dd2f6f74f6b splash=silent crashkernel=256M-:128M showopts vga=0x314`

1. Перезапустите защиту.

## <a name="install-mobility-service-completed-with-warning-to-reboot-errorid-95265--95266"></a>Установка Мобильное обслуживание завершено с предупреждением для перезагрузки (ErrorID: 95265 & 95266)

Служба восстановления сайта имеет много компонентов, один из которых называется драйвером фильтра. Драйвер фильтра загружается в системную память только во время перезагрузки системы. Исправление драйвера фильтра может быть реализовано только при загрузке нового драйвера фильтра во время перезагрузки системы.

> [!IMPORTANT]
> Это предупреждение, и существующая репликация будет работать даже после обновления нового агента. Вы можете выбрать перезагрузку в любое время вы хотите получить преимущества нового драйвера фильтра, но если вы не перезагрузить, старый драйвер фильтра продолжает работать. Таким образом, после обновления без перезагрузки, за исключением драйвера фильтра, **преимущества других улучшений и исправлений в службе мобильности реализуются.** Хотя это и рекомендуется, перезагрузка не является обязательной после каждого обновления. Для получения информации о том, когда перезагрузка является обязательной, установите раздел [перезагрузки после обновления службы мобильности](service-updates-how-to.md#reboot-after-mobility-service-upgrade) в обновлениях службы в восстановлении сайта Azure.

> [!TIP]
>Для достижения наилучших методов планирования обновлений во время окна обслуживания [см.](service-updates-how-to.md#support-for-latest-operating-systemskernels)

## <a name="lvm-support-from-920-version"></a>Поддержка диспетчера логических томов (LVM) начиная с версии 9.20

До версии 9.20 logical Volume Manager (LVM) поддерживался только для дисков данных. Раздел `/boot` должен быть на дисковой перегородке, а не на томе LVM.

Начиная с [версии 9.20,](https://support.microsoft.com/help/4478871/update-rollup-31-for-azure-site-recovery) [оС диск на LVM](vmware-physical-azure-support-matrix.md#linux-file-systemsguest-storage) поддерживается.

## <a name="insufficient-space-errorid-95524"></a>Недостаточное пространство (Ошибка: 95524)

При копировании агента Mobility в исходную машину требуется не менее 100 МБ свободного пространства. Убедитесь, что ваша исходная машина имеет необходимое количество свободного пространства и повторить операцию.

## <a name="vss-installation-failures"></a>Ошибки установки VSS

Установка Volume Shadow copy Service (VSS) является частью установки агента мобильности. Эта услуга используется в процессе генерации согласованных точек восстановления приложения. Ошибки во время установки VSS могут возникнуть по нескольким причинам. Для выявления точных ошибок, обратитесь к _C: »ProgramData-ASRSetupLogs-ASRUnifiedAgentInstaller.log_. Некоторые распространенные ошибки и шаги разрешения выделены в следующем разделе.

### <a name="vss-error--2147023170-0x800706be---exit-code-511"></a>Ошибка VSS 2147023170 [0x800706BE] — код выхода 511

Эта проблема чаще всего наблюдается, когда антивирусное программное обеспечение блокирует работу служб восстановления сайтов Azure.

Для разрешения этой проблемы:

1. Просмотрите список [исключений папок из антивирусной программы.](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program)
1. Следуйте рекомендациям, опубликованным вашим антивирусным провайдером, чтобы разблокировать регистрацию DLL в Windows.

### <a name="vss-error-7-0x7---exit-code-511"></a>Ошибка VSS 7 [0x7] — код выхода 511

Эта ошибка является ошибкой выполнения, которая вызвана из-за недостаточной памяти для установки VSS. Увеличьте пространство диска для успешного завершения этой операции.

### <a name="vss-error--2147023824-0x80070430---exit-code-517"></a>Ошибка VSS 2147023824 [0x80070430] — код выхода 517

Эта ошибка возникает, когда служба поставщика VSS Azure Site Recovery [помечена для удаления](/previous-versions/ms838153(v=msdn.10)). Попробуйте установить VSS вручную на исходную машину, запустив следующую команду:

`"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

### <a name="vss-error--2147023841-0x8007041f---exit-code-512"></a>Ошибка VSS 2147023841 [0x8007041F] — код выхода 512

Эта ошибка возникает при [блокировке](/previous-versions/ms833798(v=msdn.10))базы данных службы Azure Site Recovery VSS Provider. Попробуйте установить VSS вручную на исходную машину, запустив следующую команду из запроса команды:

`"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

При сбое проверьте, застряла ли какая-либо антивирусная программа или другие службы в **исходном** состоянии. Процесс в **исходном** состоянии может сохранить блокировку служб базы данных. Это приведет к сбоям в установке поставщика VSS. Убедитесь, что служба не находится в **исходном** состоянии, а затем повторно попробуйте вышеупомянутую операцию.

### <a name="vss-exit-code-806"></a>Код выхода VSS 806

Эта ошибка возникает, когда учетная запись пользователя, используемая для установки, не имеет разрешений `CSScript` на выполнение команды. Предоставьте учетной записи пользователя необходимые разрешения на выполнение скрипта и повторите операцию.

### <a name="other-vss-errors"></a>Другие ошибки VSS

Попробуйте установить услугу поставщика VSS вручную на исходную машину, запустив следующую команду из запроса команды:

`"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

## <a name="vss-error---0x8004e00f"></a>Ошибка VSS - 0x8004E00F

Эта ошибка обычно возникает во время установки `DCOM` `DCOM` агента мобильности из-за проблем в и находится в критическом состоянии.

Используйте следующую процедуру, чтобы определить причину ошибки.

### <a name="examine-the-installation-logs"></a>Изучите журналы установки

1. Откройте журнал установки, расположенный по адресу _C: 'ProgramData-ASRSetupLogs-ASRUnifiedAgentInstaller.log_.
2. Наличие следующей ошибки указывает на эту проблему:

    ```Output
    Unregistering the existing application...
    Create the catalogue object
    Get the collection of Applications

    ERROR:

    - Error code: -2147164145 [0x8004E00F]
    - Exit code: 802
    ```

Чтобы устранить проблему:

Свяжитесь с [группой платформы Microsoft Windows,](https://aka.ms/Windows_Support) чтобы получить помощь в решении проблемы DCOM.

Когда проблема DCOM будет решена, переустановите vsS-провайдер Azure Site, используя следующую команду из запроса команды:

`"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

Если согласованность приложений не является критической для требований к аварийному восстановлению, можно обойти установку VSS Provider.

Чтобы обойти установку azure Site Recovery VSS Provider и вручную установить послеустановку послеустановки Azure Site Recovery VSS Provider:

1. Установите службу Mobility Service. Установка выйдет из строя на этапе: **Настройка post.**
1. Чтобы обойти установку VSS:
   1. Откройте каталог установки службы восстановления мобильности сайта Azure, расположенный по адресу:

      _C:-Программные файлы (x86) » Агент восстановления лазурного средства Microsoft Azure_

   1. Изменяйте сценарии установки установки vsS Provider сайта _Azure, InMageVSSProvider_Install_ и _InMageVSSProvider_Uninstall.cmd,_ чтобы всегда преуспеть, добавив следующие строки:

      ```plaintext
      rem @echo off
      setlocal
      exit /B 0
      ```

1. Сделайте ручную установку мобильного агента.
1. Когда установка успешно и переходит к следующему шагу, **настроите,** удалите добавленные строки.
1. Чтобы установить провайдера VSS, откройте запрос команды в качестве администратора и запустите следующую команду:

   `"C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\InMageVSSProvider_Install.cmd"`

1. Убедитесь, что поставщик VSS-сервиса восстановления сайта Azure установлен в качестве службы в службах Windows. Откройте компонентную службу MMC, чтобы подтвердить, что поставщик VSS указан.
1. Если установка VSS Provider продолжает сбой, работайте с технической поддержкой для устранения ошибок разрешений в интерфейсе программирования cryptographic Application (CAPI2).

## <a name="vss-provider-installation-fails-because-the-cluster-service-being-enabled-on-non-cluster-machine"></a>Установка VSS Provider не удается из-за включения кластерного обслуживания на некластерной машине

Эта проблема приводит к сбою установки установки переемний мобильного агента Azure Site Recovery Mobility Agent во время установки поставщика VSS-провайдера восстановления сайта Azure. Сбой связан с `COM+` тем, что возникает проблема, которая препятствует установке поставщика VSS.

### <a name="to-identify-the-issue"></a>Для выявления проблемы

В журнале, расположенном на сервере конфигурации по адресу _C: 'ProgramData-ASRSetupLogs-UploadedLogs\<дата-дата>UA_InstallLogFile.log_ вы найдете следующее исключение:

```plaintext
COM+ was unable to talk to the Microsoft Distributed Transaction Coordinator (Exception from HRESULT: 0x8004E00F)
```

Чтобы устранить проблему:

1. Убедитесь, что эта машина является некластерной машиной и что компоненты кластера не используются.
1. Если компоненты не используются, удалите компоненты кластера из машины.

## <a name="drivers-are-missing-on-the-source-server"></a>Драйверы отсутствуют на исходном сервере

Если установка Mobility Agent не удается, изучите журналы в соответствии с _C: «ProgramData»ASRSetupLogs,_ чтобы определить, отсутствуют ли некоторые из необходимых драйверов в некоторых наборах управления.

Чтобы устранить проблему:

1. Использование редактора реестра, таких как `regedit.msc`, открыть реестр.
1. Открой `HKEY_LOCAL_MACHINE\SYSTEM` узла.
1. В `SYSTEM` узлах найдите наборы управления.
1. Откройте каждый набор управления и убедитесь, что следующие драйверы Windows присутствуют:

   * Atapi
   * Вмбус
   * Сторфльт
   * Сторвск
   * Интелид

1. Переустановите все недостающие драйверы.

## <a name="next-steps"></a>Дальнейшие действия

[Узнайте больше](vmware-azure-tutorial.md) о том, как настроить аварийное восстановление для VMware VMs.
