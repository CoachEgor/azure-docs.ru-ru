---
title: Устранение неполадок процесса сервера Azure Site Recovery
description: В этой статье описывается, как устранить неполадки с сервера обработки Azure Site Recovery
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: troubleshooting
ms.date: 04/29/2019
ms.author: rayne
ms.openlocfilehash: 0383226853ed86943b73d2b8740825967f3124c9
ms.sourcegitcommit: 6f043a4da4454d5cb673377bb6c4ddd0ed30672d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2019
ms.locfileid: "65411528"
---
# <a name="troubleshoot-the-process-server"></a>Устранение неполадок с сервера обработки

[Site Recovery](site-recovery-overview.md) сервер обработки используется при настройке аварийного восстановления в Azure для локальных виртуальных машин VMware и физических серверов. В этой статье описывается, как устранить неполадки с сервера обработки, включая проблемы репликации и возможностью подключения.

[Дополнительные сведения](vmware-physical-azure-config-process-server-overview.md) о сервере обработки.

## <a name="before-you-start"></a>Перед началом работы

Прежде чем начать устранение неполадок:

1. Убедитесь, что вы понимаете как [отслеживать серверы обработки](vmware-physical-azure-monitor-process-server.md).
2. Советы и рекомендации ниже.
3. Убедитесь, что вы выполните [емкости для управляемой](site-recovery-plan-capacity-vmware.md#capacity-considerations)и используйте рекомендации по выбору размеров для [сервер конфигурации](site-recovery-plan-capacity-vmware.md#size-recommendations-for-the-configuration-server-and-inbuilt-process-server) или [автономные серверы обработки](site-recovery-plan-capacity-vmware.md#size-recommendations-for-the-process-server).

## <a name="best-practices-for-process-server-deployment"></a>Рекомендации по развертыванию сервера обработки

Для достижения оптимальной производительности серверов обработки перечисленными ряд общих практических рекомендаций.

**Рекомендации** | **Сведения**
--- |---
**Использование** | Убедитесь, что сервер конфигурации/изолированного сервера обработки используются только для указанных целей. Не что-нибудь еще выполняются на компьютере.
**IP-адрес** | Убедитесь, что сервер обработки имеет статический адрес IPv4 и не настроены преобразования сетевых адресов.
**Контроль использования памяти и Процессору** |Получайте использование ЦП и памяти, в разделе 70%.
**Убедитесь, свободного места** | Свободное место ссылается на пространство на диске кэша на сервере обработки. Данные репликации хранятся в кэше, перед отправкой в Azure.<br/><br/> Сохраните свободного пространства превышает 25%. Если он опускается ниже 20%, репликация регулируется реплицируемым виртуальным машинам, которые связаны с сервером обработки.

## <a name="check-process-server-health"></a>Проверка работоспособности сервера обработки

Устранение неполадок первым делом для проверки работоспособности и состояние процесса сервера. Чтобы сделать это, просмотрите все оповещения, проверьте, что необходимые службы запущены и убедитесь в наличии пульса от сервера обработки. Эти действия представлены на следующем рисунке, следуют процедуры для выполнения действия.

![Устранение неполадок исправности сервера обработки](./media/vmware-physical-azure-troubleshoot-process-server/troubleshoot-process-server-health.png)

## <a name="step-1-troubleshoot-process-server-health-alerts"></a>Шаг 1. Устранение неполадок оповещений о работоспособности сервера обработки

Сервер обработки формирует количество оповещений о работоспособности. В следующей таблице приведены эти предупреждения и рекомендуемые действия.

**Тип оповещения** | **Ошибка** | **Устранение неполадок**
--- | --- | --- 
![Работоспособна][green] | Нет  | Сервер обработки подключен и исправен.
![Предупреждение][yellow] | Указанные службы не работают. | 1. Проверьте, что службы запущены.<br/> 2. Если они работают должным образом, следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).
![Предупреждение][yellow]  | > 80% использования ЦП за последние 15 минут. | 1. Не добавляйте новые машины.<br/>2. Убедитесь, что количество виртуальных машин с помощью сервера обработки выполняется выравнивание по [определенные ограничения](site-recovery-plan-capacity-vmware.md#capacity-considerations)и рассмотрите возможность настройки [дополнительный сервер обработки](vmware-azure-set-up-process-server-scale.md).<br/>3. Следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).
![критические ошибки.][red] |  > 95% использования ЦП за последние 15 минут. | 1. Не добавляйте новые машины.<br/>2. Убедитесь, что количество виртуальных машин с помощью сервера обработки выполняется выравнивание по [определенные ограничения](site-recovery-plan-capacity-vmware.md#capacity-considerations)и рассмотрите возможность настройки [дополнительный сервер обработки](vmware-azure-set-up-process-server-scale.md).<br/>3. Следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).<br/> 4. Если проблема повторится, запустите [планировщика развертывания](https://aka.ms/asr-v2a-deployment-planner) для репликации VMware или физического сервера.
![Предупреждение][yellow] | Использование памяти > 80% за последние 15 минут. |  1. Не добавляйте новые машины.<br/>2. Убедитесь, что количество виртуальных машин с помощью сервера обработки выполняется выравнивание по [определенные ограничения](site-recovery-plan-capacity-vmware.md#capacity-considerations)и рассмотрите возможность настройки [дополнительный сервер обработки](vmware-azure-set-up-process-server-scale.md).<br/>3. Следуйте всем инструкциям, связанный с данным предупреждением.<br/> 4. Если проблема будет повторяться, следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).
![критические ошибки.][red] | > 95% использования памяти за последние 15 минут. | 1. Не добавляйте новые машины и о настройке [дополнительный сервер обработки](vmware-azure-set-up-process-server-scale.md).<br/> 2. Следуйте всем инструкциям, связанный с данным предупреждением.<br/> 3. 4. Если проблема не устранена, следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).<br/> 4. Если проблема повторится, запустите [планировщика развертывания](https://aka.ms/asr-v2a-deployment-planner) для проблем с репликацией VMware или физического сервера.
![Предупреждение][yellow] | Кэш папку свободного места < 30% за последние 15 минут. | 1. Не добавлять новые машины и рассмотрите возможность настройки [дополнительный сервер обработки](vmware-azure-set-up-process-server-scale.md).<br/>2. Убедитесь, что количество виртуальных машин с помощью сервера обработки выполняется выравнивание по [рекомендации](site-recovery-plan-capacity-vmware.md#capacity-considerations).<br/> 3. Следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).
![критические ошибки.][red] |  < 25% свободного места для последние 15 минут | 1. Следуйте инструкциям, связанный с данным предупреждением для этой проблемы.<br/> 2. 3. Следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).<br/> 3. Если проблема повторится, запустите [планировщика развертывания](https://aka.ms/asr-v2a-deployment-planner) для репликации VMware или физического сервера.
![критические ошибки.][red] | Нет пульса от сервера обработки для 15 минут или более. Служба tmansvs не обменивается данными с сервером конфигурации. | 1) убедитесь, что сервер обработки был запущен и работает.<br/> 2. Проверьте, что tmassvc запущена на сервере обработки.<br/> 3. Следуйте инструкциям ниже, чтобы [Устранение неполадок подключений и репликация](#check-connectivity-and-replication).


![Ключ таблицы](./media/vmware-physical-azure-troubleshoot-process-server/table-key.png)


## <a name="step-2-check-process-server-services"></a>Шаг 2. Проверка службы сервера обработки

В следующей таблице приведены службы, которые должны выполняться на сервере обработки. Существуют небольшие различия в службах, в зависимости от способа развертывания сервера обработки. 

Для всех служб, за исключением агент служб восстановления Microsoft Azure (obengine), проверьте, что StartType присвоено **автоматического** или **автоматически (отложенный запуск)**.
 
**Развертывание** | **Запущенные службы**
--- | ---
**Сервер обработки на сервере конфигурации** | ProcessServer; ProcessServerMonitor; cxprocessserver; InMage PushInstall; Служба отправки журнала (LogUpload); Службу приложения InMage Scout. Агент служб восстановления Microsoft Azure (obengine); InMage Scout VX Agent — Sentinel/Outpost (svagents); tmansvc; Веб-публикации службу (W3SVC); MySQL; Службе Microsoft Azure Site Recovery (dra)
**Процесс сервера, работающего в качестве изолированного сервера** | ProcessServer; ProcessServerMonitor; cxprocessserver; InMage PushInstall; Служба отправки журнала (LogUpload); Службу приложения InMage Scout. Агент служб восстановления Microsoft Azure (obengine); InMage Scout VX Agent — Sentinel/Outpost (svagents); tmansvc.
**Сервер обработки, развернутый в Azure для восстановления размещения** | ProcessServer; ProcessServerMonitor; cxprocessserver; InMage PushInstall; Служба отправки журнала (LogUpload)


## <a name="step-3-check-the-process-server-heartbeat"></a>Шаг 3. Проверьте периодический сигнал сервера обработки

Если нет пульса от сервера обработки (код ошибки 806), сделайте следующее:

1. Убедитесь, что сервер обработки виртуальной Машины запущен и работает.
2. Проверьте эти журналы ошибок.

    C:\ProgramData\ASR\home\svsystems\eventmanager *.log  C\ProgramData\ASR\home\svsystems\monitor_protection*.log

## <a name="check-connectivity-and-replication"></a>Проверьте подключение и репликации

 Ошибки начальной и выполняющейся репликацией часто вызваны проблемы с подключением между исходных компьютеров и сервером обработки или между сервером обработки и Azure. Эти действия представлены на следующем рисунке, следуют процедуры для выполнения действия.

![Устранение неполадок подключений и репликация](./media/vmware-physical-azure-troubleshoot-process-server/troubleshoot-connectivity-replication.png)


## <a name="step-4-verify-time-sync-on-source-machine"></a>Шаг 4. Проверка синхронизации времени на исходном компьютере

Убедитесь, что системные дата и время для реплицируемого компьютера синхронизации. [Подробнее](https://docs.microsoft.com/windows-server/networking/windows-time-service/accurate-time)

## <a name="step-5-check-anti-virus-software-on-source-machine"></a>Шаг 5. Проверьте антивирусное программное обеспечение на исходном компьютере

Проверьте, что нет антивирусного программного обеспечения на реплицируемой виртуальной машины блокируется Site Recovery. Если вам нужно исключить Site Recovery с помощью антивирусных программ, просмотрите [в этой статье](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program).

## <a name="step-6-check-connectivity-from-source-machine"></a>Шаг 6. Проверьте подключение между исходным компьютером


1. Установка [клиента Telnet](https://technet.microsoft.com/library/cc771275(v=WS.10).aspx) на исходном компьютере, если вам нужно. Не используйте команду Ping.
2. С исходного компьютера проверьте связь с сервером обработки на использование порта HTTPS по протоколу Telnet. По умолчанию 9443 — HTTPS-порт для трафика репликации.

    `telnet <process server IP address> <port>`

3. Проверьте, является ли соединение успешно.


**Соединение** | **Сведения** | **Действие**
--- | --- | ---
**Успешно** | Telnet остается пустым, и сервер обработки был доступен. | Больше не потребуется предпринять действия.
**Неудачно** | Не удается подключиться | Убедитесь, что на сервере обработки разрешен входящий порт 9443. Например, если у вас есть демилитаризованной зоне или промежуточной подсети. Проверьте подключение еще раз.
**Частично успешно** | Вы можете подключиться, но на исходный компьютер сообщает, что сервер обработки недоступен. | Выполните следующую процедуру по устранению неполадок.

## <a name="step-7-troubleshoot-an-unreachable-process-server"></a>Шаг 7. Устранение неполадок сервер обработки недоступен

Если сервер обработки не доступен с исходного компьютера, будет отображаться ошибка 78186. Если не устранить эту проблему приведет к оба согласованные и точек с согласованием восстановления не создаются должным образом.

Устранение неполадок путем проверки на исходном компьютере может достичь IP-адрес сервера обработки и запустите средство cxpsclient на исходном компьютере, чтобы проверить состояние подключения end-to-end.


### <a name="check-the-ip-connection-on-the-process-server"></a>Проверьте подключение к IP-адрес на сервере обработки

Если telnet прошла успешно, но на исходный компьютер сообщает, что сервер обработки недоступен, проверьте, можно ли достичь IP-адрес сервера обработки.

1. В веб-браузер попробуйте обратиться https://<PS_IP>:<PS_Data_Port>/ адрес IP-адрес.
2. Если эта проверка показывает ошибку сертификата HTTPS, который находится в обычном состоянии. Если пропустить ошибку, вы увидите, что 400 — Неверный запрос. Это означает, что сервер не может обслуживать запрос браузера, а стандартное подключение HTTPS нормально.
3. Если эта проверка не сработает, найдите сообщение об ошибке. Например сообщение об ошибке 407 будет указывать на проблему с проверкой подлинности прокси-сервера.

### <a name="check-the-connection-with-cxpsclient"></a>Проверьте подключение с cxpsclient

Кроме того можно запустить средство cxpsclient, чтобы проверить состояние подключения end-to-end.

1. Запустите средство следующим образом:

    ```
    <install folder>\cxpsclient.exe -i <PS_IP> -l <PS_Data_Port> -y <timeout_in_secs:recommended 300>
    ```

2. На сервере обработки Проверьте созданные журналы в этих папках:

    C:\ProgramData\ASR\home\svsystems\transport\log\cxps.err  C:\ProgramData\ASR\home\svsystems\transport\log\cxps.xfer



### <a name="check-source-vm-logs-for-upload-failures-error-78028"></a>Проверьте журналы виртуальных Машин источника для передачи ошибок (error 78028)

Проблема с заблокирован с исходных компьютеров к службе процесс передачи данных может привести обоих отказоустойчивые и согласованные точки восстановления не создается. 

1. Чтобы устранить ошибки передачи по сети, можно искать ошибки в этот журнал:

    C:\Program файлы (x86) \Microsoft Azure Site Recovery\agent\svagents*.log 

2. Использование остальной части процедуры, описанные в этой статье может помочь вам устранить проблемы передачи данных.



## <a name="step-8-check-whether-the-process-server-is-pushing-data"></a>Шаг 8. Проверьте, является ли сервер обработки передачи данных

Проверьте, активно ли сервер обработки передаваемых данных в Azure.

  1. Откройте диспетчер задач на сервере обработки (нажмите клавиши CTRL+SHIFT+ESC).
  2. Выберите **производительности** вкладке > **открыть монитор ресурсов**.
  3. В **монитор ресурсов** выберите **сети** вкладки. В разделе **процессы с сетевой активностью**, проверять ли cbengine.exe активно передает большой vNotolume данных.

       ![Тома в процессы с сетевой активностью](./media/vmware-physical-azure-troubleshoot-process-server/cbengine.png)

  Если файл cbengine.exe не отправляет большие объемы данных, выполните действия, указанные в следующих разделах.

## <a name="step-9-check-the-process-server-connection-to-azure-blob-storage"></a>Шаг 9. Проверьте подключение к серверу процесса в хранилище BLOB-объектов Azure

1. В мониторе ресурсов выберите **cbengine.exe**.
2. В разделе **TCP-подключения**, проверьте, есть ли подключение с сервера обработки в хранилище Azure.

  ![Подключение между cbengine.exe и URL-адрес хранилища BLOB-объектов Azure](./media/vmware-physical-azure-troubleshoot-process-server/rmonitor.png)

### <a name="check-services"></a>Проверка службы

Если отсутствует подключение с сервера обработки на URL-адрес хранилища BLOB-объектов Azure, проверьте, что службы запущены.

1. В панели управления выберите **служб**.
2. Убедитесь, что запущены следующие службы:

    - cxprocessserver;
    - InMage Scout VX Agent – Sentinel/Outpost;
    - Агент служб восстановления Microsoft Azure
    - служба Microsoft Azure Site Recovery;
    - tmansvc.

3. Запустите или перезапустите службы, которые не запущены.
4. Убедитесь, что сервер обработки подключен и доступен. 

## <a name="step-10-check-the-process-server-connection-to-azure-public-ip-address"></a>Шаг 10: Проверьте подключение к серверу процесса Azure общедоступный IP-адрес

1. На сервере обработки в **%programfiles%\Microsoft Azure Recovery Services Agent\Temp**, откройте последний файл CBEngineCurr.errlog.
2. В файле, поиска **443**, или для строки **подключения не удалась**.

  ![Журналы ошибок в папке Temp](./media/vmware-physical-azure-troubleshoot-process-server/logdetails1.png)

3. Если вы видите проблемы, расположенным Azure общедоступный IP-адрес в файле CBEngineCurr.currLog через порт 443:

  `telnet <your Azure Public IP address as seen in CBEngineCurr.errlog>  443`

5. Из командной строки на сервере обработки используйте Telnet, чтобы проверить связь с Azure общедоступный IP-адрес.
6. Если подключение отсутствует, выполните следующую процедуру.

## <a name="step-11-check-process-server-firewall-settings"></a>Шаг 11. Проверьте параметры брандмауэра для сервера обработки. 

Проверьте, является ли IP-адрес брандмауэра на основе адресов на сервере обработки блокирует доступ.

1. Для правил брандмауэра на основе адреса IP-адресов:

    ) скачайте полный список [диапазоны IP-адрес центра обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653).

    (б) добавьте диапазоны IP-адресов в свою конфигурацию брандмауэра, чтобы убедиться, что брандмауэр разрешает обмен данными в Azure (порт HTTPS по умолчанию, 443).

    c) Разрешить диапазоны IP-адресов региона Azure подписки и региона Azure Западная часть США (используется для доступа к контроля и управления удостоверениями).

2. Для брандмауэров на основе URL-адрес добавьте URL-адреса, перечисленные в следующей таблице в конфигурацию брандмауэра.

    [!INCLUDE [site-recovery-URLS](../../includes/site-recovery-URLS.md)]  


## <a name="step-12-verify-process-server-proxy-settings"></a>Шаг 12. Проверьте параметры прокси-сервера процесс 

1. Если вы используете прокси-сервер, убедитесь, что его имя разрешается DNS-сервером. Проверьте значение, который использовался при настройке сервера конфигурации в раздел реестра **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Azure Site Recovery\ProxySettings**.
2. Убедитесь, что те же параметры используются агентом Azure Site Recovery для отправки данных.

    ) поиск **Microsoft Azure Backup**.

    b) откройте **Microsoft Azure Backup**и выберите **действие** > **изменить свойства**.

    c) на **конфигурацию прокси-сервера** вкладке адрес прокси-сервера следует использовать тот же адрес прокси-сервера, который отображается в параметрах реестра. В противном случае измените его на тот адрес.

## <a name="step-13-check-bandwidth"></a>Шаг 13. Проверить пропускную способность

Увеличить пропускную способность между сервером обработки и Azure и проверьте, сохраняется ли проблема.


## <a name="next-steps"></a>Дальнейшие действия

Если вам нужна дополнительная помощь, задайте свой вопрос на [форуме Azure Site Recovery](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr). 

[green]: ./media/vmware-physical-azure-troubleshoot-process-server/green.png
[yellow]: ./media/vmware-physical-azure-troubleshoot-process-server/yellow.png
[red]: ./media/vmware-physical-azure-troubleshoot-process-server/red.png