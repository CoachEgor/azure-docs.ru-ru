---
title: Устранение неполадок расширения виртуальной машины Azure для аварийного восстановления с помощью Azure Site Recovery
description: Устранение неполадок с расширением виртуальной машины Azure для аварийного восстановления с Azure Site Recovery.
author: sideeksh
manager: rochakm
ms.topic: troubleshooting
ms.date: 11/27/2018
ms.openlocfilehash: a780a42179a0bacf0e4a12ba1e75ae84943539b4
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "77190723"
---
# <a name="troubleshoot-azure-vm-extension-issues"></a>Устранение проблем с расширением виртуальной машины Azure

В этой статье приведены инструкции по устранению ошибок Azure Site Recovery, связанных с агентом и расширением виртуальной машины.


## <a name="azure-site-recovery-extension-time-out"></a>Время ожидания расширения Azure Site Recovery  

Сообщение об ошибке: "Task execution has timed out while tracking for extension operation to be started" (Истекло время ожидания выполнения задачи при отслеживании запуска операции расширения)<br>
Код ошибки: "151076"

 Azure Site Recovery установить расширение на виртуальной машине как часть задания включения защиты. Любое из следующих условий может препятствовать активации защиты и привести к сбою задания. Выполните следующие шаги по устранению неполадок, а затем повторите операцию:

- [Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)
- [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)
- [Не удалось обновить или загрузить расширение Site Recovery](#the-site-recovery-extension-fails-to-update-or-load).

Сообщение об ошибке: "Предыдущая операция расширения Site Recovery занимает больше времени, чем ожидалось".<br>
Код ошибки: "150066"

- [Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)
- [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)
- [Неправильное состояние расширения Site Recovery](#the-site-recovery-extension-fails-to-update-or-load).

## <a name="protection-fails-because-the-vm-agent-is-unresponsive"></a>Защита завершается ошибкой, так как агент виртуальной машины не отвечает

Сообщение об ошибке: "Task execution has timed out while tracking for extension operation to be started" (Истекло время ожидания выполнения задачи при отслеживании запуска операции расширения)<br>
Код ошибки: "151099"

Эта ошибка может возникать, если Гостевой агент Azure в виртуальной машине не находится в состоянии "Готово".

Состояние гостевого агента Azure можно проверить в [портал Azure](https://portal.azure.com/). Перейдите к виртуальной машине, которую вы пытаетесь защитить, и проверьте состояние в**свойствах** > **параметров** >  **виртуальной машины** > **состояние агента**. В большинстве случаев состояние агента Готово после перезагрузки виртуальной машины. Однако если вы не можете выполнить перезагрузку или вы по-прежнему столкнулись с проблемой, выполните следующие действия по устранению неполадок:

- [Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)](#the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms)
- [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)


Сообщение об ошибке: "Task execution has timed out while tracking for extension operation to be started" (Истекло время ожидания выполнения задачи при отслеживании запуска операции расширения)<br>
Код ошибки: "151095"

Эта ошибка возникает, когда версия агента на компьютере Linux устарела. Выполните следующие действия по устранению неполадок.

- [Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)](#the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms)  

## <a name="causes-and-solutions"></a>Причины и решения

### <a name="the-agent-is-installed-in-the-vm-but-its-unresponsive-for-windows-vms"></a><a name="the-agent-installed-in-the-vm-but-unresponsive-for-windows-vms"></a>Агент установлен на виртуальной машине, но не отвечает (для виртуальных машин Windows)

#### <a name="solution"></a>Решение
Возможно, агент виртуальной машины может быть поврежден или служба остановлена. Повторная установка агента виртуальной машины поможет получить последнюю версию и возобновить обмен данными со службой.

1. Определите, запущена ли служба гостевого агента Microsoft Azure в службах виртуальной машины (services.msc). Перезапустите службу гостевого агента Windows Azure.    
1. Если служба гостевого агента Windows Azure не отображается в оснастке "службы", откройте панель управления. Перейдите в раздел **программы и компоненты** , чтобы узнать, установлена ли служба гостевого агента Windows.
1. Если гостевой агент Microsoft Azure отображается в разделе **Программы и компоненты**, удалите его.
1. Скачайте и установите [последнюю версию файла MSI агента](https://go.microsoft.com/fwlink/?LinkID=394789&clcid=0x409). Для завершения установки требуются права администратора.
1. Убедитесь, что служба гостевого агента Windows Azure отображается в списке службы.
1. Перезапустите задание защиты.

Кроме того, убедитесь, что [Microsoft .NET 4.5 установлен](https://docs.microsoft.com/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed) на виртуальной машине. Для взаимодействия агента виртуальной машины со службой требуется .NET 4,5.

### <a name="the-agent-installed-in-the-vm-is-out-of-date-for-linux-vms"></a>Устарел агент, установленный на виртуальной машине (для виртуальных машин Linux)

#### <a name="solution"></a>Решение
Большая часть неполадок, связанных с агентом или расширением на виртуальных машинах Linux, вызваны проблемами с устаревшим агентом виртуальной машины. Чтобы устранить эту проблему, следуйте приведенным ниже общим рекомендациям.

1. Выполните указания по [обновлению агента виртуальной машины Linux ](../virtual-machines/linux/update-agent.md).

   > [!NOTE]
   > Мы *настоятельно рекомендуем* обновлять агент только посредством репозитория дистрибутивов. Не рекомендуется скачивать код агента непосредственно из GitHub и обновлять его. Если последняя версия агента для дистрибутива недоступна, обратитесь в службу поддержки распространения за инструкциями по ее установке. Чтобы проверить наличие последней версии агента, перейдите на страницу [агента Linux для Microsoft Azure](https://github.com/Azure/WALinuxAgent/releases) в репозитории GitHub.

1. Убедитесь, что на виртуальной машине запущен агент Azure, выполнив команду `ps -e`.

   Если нужный процесс не запущен, выполните следующие команды для его перезапуска:

   - Для Ubuntu: `service walinuxagent start`.
   - Для других дистрибутивов: `service waagent start`.

1. [Настройте агент автоматического перезапуска](https://github.com/Azure/WALinuxAgent/wiki/Known-Issues#mitigate_agent_crash).
1. Включите защиту для виртуальной машины.

### <a name="the-site-recovery-extension-fails-to-update-or-load"></a>Не удалось обновить или загрузить расширение Site Recovery

Состояние расширения отображается как "Empty", "NotReady" или "переход".

#### <a name="solution"></a>Решение

Удалите расширение и перезапустите операцию.

Чтобы удалить расширение, сделайте следующее:

1. В [портал Azure](https://portal.azure.com/)перейдите на виртуальную машину, на которой возникла ошибка резервного копирования.
1. Выберите **Параметры**.
1. Выберите **расширения**.
1. Выберите **Расширение Site Recovery**.
1. Выберите **Удалить**.

Если на виртуальной машине Linux расширение VMSnapshot не отображается в портал Azure, [Обновите агент Linux для Azure](../virtual-machines/linux/update-agent.md). Затем запустите защиту.

После выполнения этих действий расширение будет переустановлено во время защиты.
