---
title: Настройка аварийного восстановления в Azure для большого числа виртуальных машин VMware или физических серверов с помощью Azure Site Recovery | Документация Майкрософт
description: Узнайте, как настроить аварийное восстановление в Azure для большого количества локальных виртуальных машин VMware или физических серверов с помощью Azure Site Recovery.
author: rayne-wiselman
manager: carmonm
ms.service: site-recovery
ms.topic: conceptual
ms.date: 05/14/2019
ms.author: raynew
ms.openlocfilehash: e96aafe61c0d8547ffca9e97bfd9e90c9529155f
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66237266"
---
# <a name="set-up-disaster-recovery-at-scale-for-vmware-vmsphysical-servers"></a>Настройка аварийного восстановления в масштабе для виртуальных машин VMware или физических серверов

В этой статье описывается, как настроить аварийное восстановление в Azure для больших чисел (> 1000) локальных виртуальных машин VMware или физических серверов в рабочей среде, с помощью [Azure Site Recovery](site-recovery-overview.md) службы.


## <a name="define-your-bcdr-strategy"></a>Определение стратегии BCDR

Непрерывность бизнес-процессов и стратегии аварийного восстановления (BCDR), определение целевые точки восстановления (RPO) и целями времени восстановления (RTO) для бизнес-приложений и рабочих нагрузок. RTO измеряет продолжительность времени, а также службы уровня в течение которого бизнес-приложение или процесс должен быть восстановления и обеспечения доступности, чтобы избежать проблем с непрерывности.
- Site Recovery обеспечивает непрерывную репликацию для виртуальных машин VMware и физических серверов и [соглашение об уровне ОБСЛУЖИВАНИЯ](https://azure.microsoft.com/support/legal/sla/site-recovery/v1_2/) для RTO.
- При планировании для крупномасштабных аварийного восстановления для виртуальных машин VMware и выясните, ресурсы Azure, которые требуется, можно указать значение RTO, который будет использоваться для вычисления емкости.


## <a name="best-practices"></a>Рекомендации

Некоторые общие рекомендации для крупномасштабных аварийного восстановления. Эти рекомендации рассматриваются более подробно в следующих разделах документа.

- **Определение требований к целевой**: Оценка out емкости и потребности в ресурсах в Azure, прежде чем настраивать аварийное восстановление.
- **Планирование компонентов Site Recovery**: Понять, какие компоненты Site Recovery (сервер конфигурации и серверов обработки), необходимо выполнить Оценка производительности.
- **Настройте один или несколько серверов обработки масштабирования**: Не используйте сервер обработки, на котором выполняется по умолчанию на сервере конфигурации. 
- **Запустите последние обновления**: Команда Site Recovery освобождает новые версии компонентов Site Recovery на регулярной основе, и следует убедиться в том, что вы используете последние версии. Чтобы упростить, отслеживать [новые](site-recovery-whats-new.md) для обновлений, и [Включение и установка обновлений](service-updates-how-to.md) сразу после их выхода.
- **Упреждающий мониторинг**: При получении аварийного восстановления работу программ, упреждающий мониторинг состояния и работоспособности реплицированные машины и ресурсы инфраструктуры.
- **Аварийного восстановления**: Вы должны выполнять аварийное восстановление на регулярной основе. Они не влияют на рабочую среду, но помочь убедитесь, что отработка отказа в Azure будет работать некорректно при необходимости.



## <a name="gather-capacity-planning-information"></a>Соберите сведения о планировании загрузки

Соберите сведения о вашей локальной среде, помогут оценить и оценки требований емкость целевого (Azure).
- Для VMware Запуск планировщика развертывания для виртуальных машин VMware сделать это.
- Для физических серверов соберите сведения вручную.

### <a name="run-the-deployment-planner-for-vmware-vms"></a>Запуск планировщика развертывания для виртуальных машин VMware

Планировщик развертывания помогает собирать сведения о вашей локальной среды VMware.

- Запуск планировщика развертывания в течение периода, представляющий оттока типичный для виртуальных машин. Будет создано более точные оценки и рекомендации.
- Мы рекомендуем Запуск планировщика развертывания на компьютере сервера конфигурации, так как планировщик вычисляет пропускную способность на сервере, на котором он выполняется. [Дополнительные сведения](site-recovery-vmware-deployment-planner-run.md#get-throughput) о измерение пропускной способности.
- Если у вас еще нет сервера конфигурации, настройки:
    - [Обзор](vmware-physical-azure-config-process-server-overview.md) компоненты Site Recovery.
    - [Настройте сервер конфигурации](vmware-azure-deploy-configuration-server.md), чтобы запуск планировщика развертывания на нем.

Затем запустите планировщик следующим образом:

1. [Дополнительные сведения о](site-recovery-deployment-planner.md) планировщике. Последнюю версию можно загрузить на портале или [непосредственная загрузка](https://aka.ms/asr-deployment-planner).
2. Просмотрите [предварительные требования](site-recovery-deployment-planner.md#prerequisites) и [последние обновления](site-recovery-deployment-planner-history.md) для планировщика развертывания, и [Загрузите и извлеките](site-recovery-deployment-planner.md#download-and-extract-the-deployment-planner-tool) средство.
3. [Запуск планировщика развертывания](site-recovery-vmware-deployment-planner-run.md) на сервере конфигурации.
4. [Создание отчета](site-recovery-vmware-deployment-planner-run.md#generate-report) суммировать оценок и рекомендации.
5. Анализ [отчетов рекомендации](site-recovery-vmware-deployment-planner-analyze-report.md) и [стоимость оценки](site-recovery-vmware-deployment-planner-cost-estimation.md).

>[!NOTE]
> По умолчанию средство настроено для профилирования и создает отчет до 1000 виртуальных машин. Это ограничение можно изменить, увеличив значение ключа MaxVMsSupported в файле ASRDeploymentPlanner.exe.config.

## <a name="plan-target-azure-requirements-and-capacity"></a>Планирование требований к целевой базе (Azure) и емкости

С помощью собранных оценок и рекомендации, можно запланировать для целевой ресурсами и емкостью. Если вы запустили планировщик развертывания для виртуальных машин VMware, можно использовать ряд [отчетов рекомендации](site-recovery-vmware-deployment-planner-analyze-report.md#recommendations) помогут вам.

- **Совместимые виртуальные машины**: Используйте этот номер для определения количества виртуальных машин, которые готовы для аварийного восстановления в Azure. Рекомендации по пропускной способности сети и ядер Azure основаны на этот номер.
- **Требуемая пропускная способность сети**: Обратите внимание, пропускной способности, необходимый для разностной репликации в совместимых виртуальных машин. 
    - Запуск планировщика вами требований к RPO в минутах. Рекомендации по Показать пропускной способности, необходимый для соблюдения этого RPO 100% и 90% времени. 
    - Рекомендации по пропускной способности сети принимать во внимание пропускную способность, необходимую для общее число серверов конфигурации и серверов обработки, рекомендуется в планировщике.
- **Требуется ядер Azure**: Обратите внимание, количество ядер, необходимо в целевом регионе Azure, зависит от число совместимых виртуальных машин. Если у вас нет достаточного числа ядер, при отработке отказа Site Recovery будет невозможно создавать необходимые виртуальные машины Azure.
- **Рекомендуемый размер виртуальной Машины пакета**: Рекомендованный размер партии основан на возможность завершения начальной репликации для пакета в течение 72 часов по умолчанию, а также предоставляет значение RPO составляет 100%. Значения часов могут изменяться.

Эти рекомендации можно использовать для планирования ресурсов Azure, пропускной способности сети и виртуальных Машин пакетной обработки.

## <a name="plan-azure-subscriptions-and-quotas"></a>Планирование подписок Azure и квоты

Мы хотим, чтобы убедиться в том, что доступных квот в целевой подписке, достаточно отработки отказа.

**Task** | **Сведения** | **Действие**
--- | --- | ---
**Проверьте ядер** | Если ядер в доступную квоту не равняться или превышать общее количество во время отработки отказа, произойдет сбой отработки отказа. | Для виртуальных машин VMware проверьте, что имеется достаточное количество ядер в целевой подписке в соответствии с core рекомендации планировщика развертывания.<br/><br/> Для физических серверов проверьте, что ядер Azure соответствуют вручную оценок.<br/><br/> Чтобы проверить квоты, на портале Azure > **подписки**, нажмите кнопку **использование и квоты**.<br/><br/> [Дополнительные сведения](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request) об увеличении квоты.
**Проверка ограничений отработки отказа** | Число переход на другой ресурс не должен превышать ограничения отработки отказа Site Recovery. |  Если переход на другой ресурс превышает ограничения, можно добавить подписки и при сбое на несколько подписок или увеличить квоту для подписки. 


### <a name="failover-limits"></a>Ограничения для отработки отказа

Ограничения указывать количество отработки отказа, которые поддерживаются службой Site Recovery в течение одного часа, при условии, что для трех дисков, на каждом компьютере.

Что соответствует среднее? Для запуска виртуальной Машины Azure, Azure требуются некоторые драйверы в начальное состояние загрузки и служб, таких как DHCP, чтобы задать автоматический запуск.
- Машин, которые соответствуют уже будет иметь эти параметры на месте.
- Для машин под управлением Windows можно заранее проверить соответствие и обеспечивающие их соответствие, при необходимости. [Узнайте больше](site-recovery-failover-to-azure-troubleshoot.md#failover-failed-with-error-id-170010).
- Компьютеры Linux только переходят в соответствие во время отработки отказа.

**Компьютер требованиям Azure?** | **Ограничения виртуальной Машины Azure (отработка отказа управляемого диска)**
--- | --- 
Да | 2000
Нет | 1000

- Ограничения предполагается минимальной других заданий, в в целевом регионе для подписки.
- Некоторых регионах Azure имеют меньший размер и может иметь несколько ниже ограничения.

## <a name="plan-infrastructure-and-vm-connectivity"></a>Планирование инфраструктуры и подключение виртуальной Машины

После отработки отказа в Azure необходимо рабочие нагрузки для работы как на локальном и для предоставления пользователям доступа к рабочих нагрузок, выполняющихся на виртуальных машинах Azure.

- [Дополнительные сведения](site-recovery-active-directory.md#test-failover-considerations) около отработка отказа в локальной инфраструктуры Active Directory или DNS в Azure.
- [Дополнительные сведения](site-recovery-test-failover-to-azure.md#prepare-to-connect-to-azure-vms-after-failover) о подготовке к виртуальным машинам Azure после отработки отказа.



## <a name="plan-for-source-capacity-and-requirements"></a>Планирование емкости источника и требования

Очень важно, что имеется достаточно серверов конфигурации и серверов обработки масштабирования в соответствии с требованиями к емкости. Как только вы начнете крупномасштабное развертывание, начните с один сервер конфигурации и сервер одного процесса горизонтального масштабирования. Как вы достигли ограничения предписанных, добавьте дополнительные серверы.

>[!NOTE]
> Для виртуальных машин VMware планировщик делает некоторые рекомендации о серверах конфигурации и обработки, что нужно. Мы рекомендуем использовать таблицы, включенные в следующих процедурах вместо рекомендации планировщика развертывания. 


## <a name="set-up-a-configuration-server"></a>Настройте сервер конфигурации
 
Емкость сервера конфигурации зависит от количество машин, реплицируемых и не по данных скорость обработки данных. Чтобы выяснить, нужны ли дополнительные серверы конфигурации, используйте эти определенные ограничения виртуальной Машины.

**CPU** | **Память** | **Диск кэша** | **Реплицированные предел компьютера**
 --- | --- | --- | ---
8 виртуальных ЦП<br> 2 сокета * 4 ядра с частотой 2,5 ГГц | 16 ГБ | 600 ТБ | 550 компьютеров<br> Предполагается, что каждый компьютер имеет три диска объемом 100 ГБ.

- Эти ограничения основаны на конфигурации сервера, заданного с помощью шаблона OVF.
- Ограничения предполагается, что вы не используете сервер обработки, на котором выполняется по умолчанию на сервере конфигурации.

Если вам нужно добавить новый сервер конфигурации, выполните следующие действия:

- [Настройте сервер конфигурации](vmware-azure-deploy-configuration-server.md) для аварийного восстановления виртуальных Машин VMware, с помощью шаблона OVF.
- [Настройте сервер конфигурации](physical-azure-set-up-source.md) вручную для физических серверов, или для развертываний VMware, которые не могут использовать шаблон OVF.

При настройке сервера конфигурации, обратите внимание, что:

- При настройке сервера конфигурации, важно учитывать подписки и хранилище, в которой он находится, так как они не должны изменяться после завершения установки. Если нужно изменить хранилище, необходимо отменить связь сервера конфигурации из хранилища и выполните их повторную регистрацию. Это предотвратит репликации виртуальных машин в хранилище.
- Если вы хотите настроить сервер конфигурации с несколькими сетевыми адаптерами, это следует сделать во время. Это нельзя сделать после регистрации сервера конфигурации в хранилище.

## <a name="set-up-a-process-server"></a>Настроить сервер обработки

Процесс емкости сервера снижается скорость обработки данных, а не количество машин, включенные для репликации.

- Для крупных развертываний должны всегда иметь по крайней мере один сервер обработки масштабирования.
- Чтобы выяснить, нужны ли дополнительные серверы, используйте следующую таблицу.
- Мы рекомендуем добавить сервер с наивысшим спецификациями. 


**CPU** | **Память** | **Диск кэша** | **Скорость обработки данных**
 --- | --- | --- | --- 
12 виртуальных ЦП<br> 2 сокета * 6 ядер с частотой 2,5 ГГц | 24 ГБ | 1 GB | До 2 ТБ в день

Настройте сервер обработки следующим образом:

1. Ознакомьтесь с [предварительными требованиями.](vmware-azure-set-up-process-server-scale.md#prerequisites)
2. Установка производится в [портала](vmware-azure-set-up-process-server-scale.md#install-from-the-ui), или из [командной строки](vmware-azure-set-up-process-server-scale.md#install-from-the-command-line).
3. Настройте реплицированные компьютеры для использования нового сервера. Если у вас уже есть репликация машин:
    - Вы можете [переместить](vmware-azure-manage-process-server.md#switch-an-entire-workload-to-another-process-server) весь процесс рабочей нагрузки сервера на новый сервер обработки.
    - Кроме того, вы можете [переместить](vmware-azure-manage-process-server.md#move-vms-to-balance-the-process-server-load) определенные виртуальные машины на новый сервер обработки.



## <a name="enable-large-scale-replication"></a>Включение крупномасштабных репликации

После планирования емкости и развертывание инфраструктуры и необходимые компоненты, включите репликацию для большого количества виртуальных машин.

1. Сортировать машин на пакеты. Включение репликации для виртуальных машин в пакете и затем перейдем к следующему пакету.

    - Для виртуальных машин VMware, можно использовать [рекомендуемый размер виртуальной Машины пакета](site-recovery-vmware-deployment-planner-analyze-report.md#recommended-vm-batch-size-for-initial-replication) в отчете планировщик развертывания.
    - Для физических компьютеров мы рекомендуем вам определить пакеты основе на компьютерах, имеющих аналогичный размер и объем данных, а также на доступной пропускной способности сети. Цель состоит в пакетной службе машинах, которые, скорее всего завершить их начальной репликации в примерного такого же времени.
    
2. Если скорость обработки диска для машины велико или превышает ограничения в thePlanner развертывания, можно переместить некритические файлы, которые не нужно реплицировать (например, дампы журнала или временные файлы) из системы на компьютере. Для виртуальных машин VMware, можно переместить эти файлы на отдельный диск, а затем [исключить этот диск](vmware-azure-exclude-disk.md) из репликации.
3. Перед включением репликации, проверьте, что компьютеры соответствуют [требования к репликации](vmware-physical-azure-support-matrix.md#replicated-machines).
4. Настройка политики репликации для [виртуальных машин VMware](vmware-azure-set-up-replication.md#create-a-policy) или [физических серверов](physical-azure-disaster-recovery.md#create-a-replication-policy).
5. Включение репликации для [виртуальных машин VMware](vmware-azure-enable-replication.md) или [физических серверов](physical-azure-disaster-recovery.md#enable-replication). Эта команда запускает начальную репликацию для выбранных компьютеров.

## <a name="monitor-your-deployment"></a>Мониторинг развертывания

После ее нужно будет запустить репликацию для первого пакета виртуальных машин, запустите мониторинг развертывания следующим образом:  

1. Назначьте администратором аварийного восстановления, чтобы отслеживать состояние работоспособности реплицированные машины.
2. [Наблюдения за событиями](site-recovery-monitor-and-troubleshoot.md) для реплицированных элементов и инфраструктуры.
3. [Наблюдать за работоспособностью](vmware-physical-azure-monitor-process-server.md) серверов обработки масштабирования.
4. Зарегистрируйтесь для получения [уведомления по электронной почте](https://docs.microsoft.com/azure/site-recovery/site-recovery-monitor-and-troubleshoot#subscribe-to-email-notifications) для событий, для упрощения мониторинга.
5. Регулярное проведение [аварийного восстановления](site-recovery-test-failover-to-azure.md), чтобы убедиться, что все работает должным образом.


## <a name="plan-for-large-scale-failovers"></a>План для крупномасштабных отработки отказа

В случае аварии может потребоваться выполнить отработку отказа большое количество машин и рабочих нагрузок в Azure. Подготовка для этого типа события следующим образом.

Можно подготовить заранее для отработки отказа следующим образом:

- [Подготовьте инфраструктуру и виртуальные машины](#plan-infrastructure-and-vm-connectivity) таким образом, чтобы рабочие нагрузки будут доступны после отработки отказа, и таким образом, пользователи могут обращаться к виртуальным машинам Azure.
- Примечание [ограничения отработки отказа](#failover-limits) ранее в этом документе. Убедитесь, что процедуры отработки отказа будет находится в пределах этих ограничений.
- Выполните обычные [аварийного восстановления](site-recovery-test-failover-to-azure.md). Детализирует помогают:
    - Находить пробелы в развертывании перед выполнением отработки отказа.
    - Оценка end-to-end RTO для ваших приложений.
    - Оценка end-to-end целевая точка восстановления для рабочих нагрузок.
    - Определите диапазон конфликтов IP-адресов.
    - Как вы выполнять, рекомендуется, не используйте рабочих сетей для Детализирует, старайтесь не использовать те же имена подсети в сети рабочего и тестового и очистка тестовой отработки отказа после каждого детализации.

Для выполнения крупномасштабных отработки отказа, мы рекомендуем следующее.

1. Создание планов восстановления для отработки отказа рабочей нагрузки.
    - Каждый план восстановления может инициировать отработку отказа до 50 машин.
    - [Узнайте подробнее](recovery-plan-overview.md) о планах восстановления.
2. Добавьте сценарии runbook службы автоматизации Azure в планы восстановления, чтобы автоматизировать все ручные задачи в Azure. К ним относятся, Настройка подсистемы балансировки нагрузки, обновление DNS и т.д. [Подробнее](site-recovery-runbook-automation.md)
2. Перед выполнением отработки отказа Подготовьте машины Windows, таким образом, чтобы они соответствовали среде Azure. [Ограничения для отработки отказа](#plan-azure-subscriptions-and-quotas) выше для машин, которые соответствуют. [Дополнительные сведения](site-recovery-failover-to-azure-troubleshoot.md#failover-failed-with-error-id-170010) о модулях Runbook.
4.  Активируйте отработку отказа с [AzRecoveryServicesAsrPlannedFailoverJob начала](https://docs.microsoft.com/powershell/module/az.recoveryservices/start-azrecoveryservicesasrplannedfailoverjob?view=azps-2.0.0&viewFallbackFrom=azps-1.1.0) командлет PowerShell, а также план восстановления.



## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Мониторинг Site Recovery](site-recovery-monitor-and-troubleshoot.md)
