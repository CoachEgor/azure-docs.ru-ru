---
title: Azure Site Recovery устранение ошибок репликации из Azure в Azure | Документация Майкрософт
description: Устранение ошибок при репликации виртуальных машин Azure для аварийного восстановления.
services: site-recovery
author: asgang
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 04/08/2019
ms.author: asgang
ms.openlocfilehash: baf7a21d04e8f9bcf86c67abde302a558dfba01c
ms.sourcegitcommit: d70c74e11fa95f70077620b4613bb35d9bf78484
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2019
ms.locfileid: "70910384"
---
# <a name="troubleshoot-azure-to-azure-vm-replication-errors"></a>Устранение ошибок репликации виртуальных машин Azure в Azure

В этой статье описывается, как устранять распространенные ошибки в Azure Site Recovery во время репликации и восстановления виртуальных машин Azure из одного региона в другой. Дополнительные сведения о поддерживаемых конфигурациях см. в статье [Azure Site Recovery support matrix for replicating from Azure to Azure](site-recovery-support-matrix-azure-to-azure.md) (Матрица поддержки Azure Site Recovery для репликации виртуальных машин из Azure в Azure).

## <a name="azure-resource-quota-issues-error-code-150097"></a>Проблемы с квотами ресурсов Azure (код ошибки 150097)

Убедитесь, что ваша подписка включена для создания виртуальных машин Azure в целевом регионе, который планируется использовать в качестве региона аварийного восстановления. Кроме того, убедитесь, что у вашей подписки достаточно квоты для создания виртуальных машин требуемого размера. По умолчанию Site Recovery выбирает размер целевой виртуальной машины, который совпадает с размером исходной виртуальной машины. Если соответствующий размер недоступен, Site Recovery автоматически выбирает ближайший доступный размер.

Если размер, который поддерживает конфигурацию исходной виртуальной машины, отсутствует, появится следующее сообщение:

> "Не удалось включить репликацию для виртуальной машины *VmName*".

### <a name="possible-causes"></a>Возможные причины

- Идентификатор подписки не включен для создания виртуальных машин в расположении целевого региона.
- Идентификатор подписки не включен или не имеет достаточной квоты для создания конкретных размеров виртуальных машин в расположении целевого региона.
- Не удалось найти подходящий размер целевой виртуальной машины для сопоставления с количеством сетевых адаптеров (NIC) исходной виртуальной машины (2) для идентификатора подписки в расположении целевого региона.

### <a name="fix-the-problem"></a>Устранение проблемы

Обратитесь в [службу поддержки выставления счетов Azure](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request) , чтобы позволить вашей подписке создавать виртуальные машины требуемых размеров в целевом расположении. Затем повторите невыполненную операцию.

Если целевое расположение имеет ограничение емкости, отключите к нему репликацию. Затем включите репликацию в другое расположение, в котором ваша подписка имеет достаточную квоту для создания виртуальных машин требуемого размера.

## <a name="trusted-root-certificates-error-code-151066"></a>Доверенные корневые сертификаты (код ошибки 151066)

Если на виртуальной машине имеются не все последние Доверенные корневые сертификаты, то задание Site Recovery "включить репликацию" может завершиться ошибкой. Проверка подлинности и авторизация Site Recovery вызовов службы с виртуальной машины завершается сбоем без этих сертификатов. 

Если задание "включить репликацию" завершается сбоем, появляется следующее сообщение:

> "Сбой настройки Site Recovery".

### <a name="possible-cause"></a>Возможная причина

Доверенные корневые сертификаты, необходимые для авторизации и проверки подлинности, отсутствуют на виртуальной машине.

### <a name="fix-the-problem"></a>Устранение проблемы

#### <a name="windows"></a>Windows

Для виртуальной машины, работающей под управлением операционной системы Windows, установите на ней последние обновления Windows, чтобы все доверенные корневые сертификаты присутствовали на компьютере. Выполните типичный процесс управления обновлениями или обновлениями сертификатов в Организации, чтобы получить последние корневые сертификаты и обновленный список отзыва сертификатов на виртуальных машинах.

При работе в отключенной среде следуйте стандартной процедуре обновления Windows в вашей организации, чтобы получить сертификаты. Если необходимые сертификаты отсутствуют на виртуальной машине, вызовы к службе Site Recovery завершатся ошибкой по соображениям безопасности.

Чтобы убедиться, что проблема устранена, перейдите на веб-сайт login.microsoftonline.com из браузера на виртуальной машине.

Дополнительные сведения см. в разделе [Настройка доверенных корней и запрещенных сертификатов](https://technet.microsoft.com/library/dn265983.aspx).

#### <a name="linux"></a>Linux

Следуйте инструкциям, предоставленным распространителем версии операционной системы Linux, чтобы получить последние Доверенные корневые сертификаты и последний список отзыва сертификатов на виртуальной машине.

Так как SuSE Linux использует символьные ссылки (или *символических ссылок*) для ведения списка сертификатов, выполните следующие действия.

1. Войдите как привилегированный пользователь.

1. Выполните следующую команду, чтобы изменить каталог:

    **число/ЕТК/ССЛ/цертс CD**

1. Проверьте наличие сертификата корневого ЦС Symantec:

    **# Ls VeriSign_Class_3_Public_Primary_Certification_Authority_G5. PEM**

1. Если сертификат корневого ЦС Symantec не найден, выполните следующую команду, чтобы скачать файл. Проверьте наличие ошибок и следуйте рекомендуемым действиям для сетевых сбоев.

    **# Wget https://www.symantec.com/content/dam/symantec/docs/other-resources/verisign-class-3-public-primary-certification-authority-g5-en.pem -O VeriSign_Class_3_Public_Primary_Certification_Authority_G5. PEM**

1. Проверьте, имеется ли сертификат корневого ЦС Baltimore:

    **# Ls Baltimore_CyberTrust_Root. PEM**

1. Если сертификат корневого ЦС Baltimore не найден, выполните следующую команду, чтобы скачать сертификат:

    **# Wget https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem -O Baltimore_CyberTrust_Root. PEM**

1. Проверьте, имеется ли сертификат DigiCert_Global_Root_CA:

    **# Ls DigiCert_Global_Root_CA. PEM**

1. Если DigiCert_Global_Root_CA не найден, выполните следующие команды, чтобы скачать сертификат:

    **число wget http://www.digicert.com/CACerts/DigiCertGlobalRootCA.crt**

    **# OpenSSL x509 — в Дигицертглобалрутка. CRT — уведомление der-out-DigiCert_Global_Root_CA. PEM**

1. Чтобы обновить хэши субъектов сертификата для вновь скачанных сертификатов, выполните сценарий rehash.

    **# c_rehash**

1. Выполните следующие команды, чтобы проверить, были ли созданы хэш-значения символических ссылок для сертификатов:

    - Команда:

        **# ls-l | grep Baltimore**

    - Выходные данные:

        `lrwxrwxrwx 1 root root   29 Jan  8 09:48 3ad48a91.0 -> Baltimore_CyberTrust_Root.pem`

        `-rw-r--r-- 1 root root 1303 Jun  5  2014 Baltimore_CyberTrust_Root.pem`

    - Команда:

        **# ls-l | grep VeriSign_Class_3_Public_Primary_Certification_Authority_G5**

    - Выходные данные:

        `-rw-r--r-- 1 root root 1774 Jun  5  2014 VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem`

        `lrwxrwxrwx 1 root root   62 Jan  8 09:48 facacbc6.0 -> VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem`

    - Команда:

        **# ls-l | grep DigiCert_Global_Root**

    - Выходные данные:

        `lrwxrwxrwx 1 root root   27 Jan  8 09:48 399e7759.0 -> DigiCert_Global_Root_CA.pem`

        `-rw-r--r-- 1 root root 1380 Jun  5  2014 DigiCert_Global_Root_CA.pem`

1. Создайте копию файла VeriSign_Class_3_Public_Primary_Certification_Authority_G5. PEM с именем filename b204d74a. 0:

    **# CP VeriSign_Class_3_Public_Primary_Certification_Authority_G5. pem b204d74a. 0**

1. Создайте копию файла Baltimore_CyberTrust_Root. PEM с именем filename 653b494a. 0:

    **# CP Baltimore_CyberTrust_Root. pem 653b494a. 0**

1. Создайте копию файла DigiCert_Global_Root_CA. PEM с именем filename 3513523f. 0:

    **# CP DigiCert_Global_Root_CA. pem 3513523f. 0**

1. Проверьте, имеются ли файлы:

    - Команда:

        **# ls-l 653b494a. 0 b204d74a. 0 3513523f. 0**

    - Вывод

        `-rw-r--r-- 1 root root 1774 Jan  8 09:52 3513523f.0`

        `-rw-r--r-- 1 root root 1303 Jan  8 09:52 653b494a.0`

        `-rw-r--r-- 1 root root 1774 Jan  8 09:52 b204d74a.0`

## <a name="outbound-connectivity-for-site-recovery-urls-or-ip-ranges-error-code-151037-or-151072"></a>Исходящие подключения для URL-адресов Site Recovery или IP-диапазонов (код ошибки 151037 или 151072)

Для работы Site Recovery репликации требуется исходящее подключение от виртуальной машины к конкретным URL-адресам или диапазонам IP. Если виртуальная машина находится за брандмауэром или использует правила группы безопасности сети (NSG) для управления исходящими подключениями, могут возникнуть следующие проблемы.

### <a name="issue-1-failed-to-register-azure-virtual-machine-with-site-recovery-151195-br"></a>Проблема 1. Не удалось зарегистрировать виртуальную машину Azure с Site Recovery (код ошибки 151195)

#### <a name="possible-cause"></a>Возможная причина 

Не удается установить подключение к Site Recovery конечным точкам из-за сбоя разрешения DNS.

Эта проблема чаще всего возникает при повторном включении защиты виртуальной машины, но DNS-сервер недоступен из региона аварийного восстановления (DR).

#### <a name="fix-the-problem"></a>Устранение проблемы

Если вы используете настраиваемую службу DNS, убедитесь, что DNS-сервер доступен из региона аварийного восстановления. Чтобы узнать, есть ли у вас настраиваемый DNS-сервер, на виртуальной машине перейдите в раздел Сетевые > **DNS-серверы** *аварийного восстановления*.

![Список настраиваемых DNS-серверов](./media/azure-to-azure-troubleshoot-errors/custom_dns.PNG)

Попробуйте получить доступ к DNS-серверу с виртуальной машины. Если сервер недоступен, сделайте его доступным либо путем отработки отказа DNS-сервера, либо путем создания линии сайта между сетью аварийного восстановления и DNS.

### <a name="issue-2-site-recovery-configuration-failed-error-code-151196"></a>Проблема 2. Сбой настройки Site Recovery (код ошибки 151196)

#### <a name="possible-cause"></a>Возможная причина

Не удается установить подключение к конечным точкам проверки подлинности и IP4-удостоверений Office 365.

#### <a name="fix-the-problem"></a>Устранение проблемы

Site Recovery требуется доступ к диапазонам IP-адресов Office 365 для проверки подлинности.
Если вы используете правила Azure NSG или прокси-сервер брандмауэра для управления исходящими сетевыми подключениями на виртуальной машине, убедитесь, что вы разрешаете подключение к диапазонам IP-адресов Office 365. Создайте правило NSG на основе [тега службы Azure Active Directory (Azure AD)](../virtual-network/security-overview.md#service-tags), чтобы разрешить доступ ко всем IP-адресам, СООТВЕТСТВУЮЩИМ Azure AD. Если новые адреса добавляются в Azure AD в будущем, необходимо создать новые правила NSG.

> [!NOTE]
> Если виртуальные машины находятся за *стандартным* внутренним подсистемой балансировки нагрузки, подсистема балансировки нагрузки по умолчанию не имеет доступа к диапазонам IP-адресов Office 365 (то есть Login.microsoftonline.com). Либо измените тип внутренней подсистемы балансировки нагрузки на *базовый* или создайте исходящий доступ, как описано в статье [Настройка балансировки нагрузки и правил исходящего трафика](https://aka.ms/lboutboundrulescli).

### <a name="issue-3-site-recovery-configuration-failed-error-code-151197"></a>Проблема 3. Сбой настройки Site Recovery (код ошибки 151197)

#### <a name="possible-cause"></a>Возможная причина

Не удается установить подключение для Site Recovery конечных точек службы.

#### <a name="fix-the-problem"></a>Устранение проблемы

Site Recovery требуется доступ к [Site Recovery диапазонам IP-адресов](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-about-networking#outbound-connectivity-for-ip-address-ranges)в зависимости от региона. Убедитесь, что необходимые диапазоны IP-адресов доступны с виртуальной машины.

### <a name="issue-4-azure-to-azure-replication-failed-when-the-network-traffic-goes-through-an-on-premises-proxy-server-error-code-151072"></a>Проблема 4. Не удалось выполнить репликацию из Azure в Azure, если сетевой трафик проходит через локальный прокси-сервер (код ошибки 151072).

#### <a name="possible-cause"></a>Возможная причина

Недопустимые параметры настраиваемого прокси-сервера, а Site Recovery агент службы мобильности не обнаружил параметры прокси-сервера в Internet Explorer автоматически.

#### <a name="fix-the-problem"></a>Устранение проблемы

Агент службы Mobility Service обнаруживает параметры прокси-сервера из Internet Explorer в Windows и из/ЕТК/енвиронмент в Linux.

Если вы предпочитаете задать прокси только для службы Mobility Service, вы можете указать сведения о прокси-сервере в файле Проксинфо. conf в следующих расположениях:

- **Linux**:/УСР/локал/инмаже/конфиг/
- **Windows**: C:\ProgramData\Microsoft Azure Site Recovery\Config

В Проксинфо. conf укажите параметры прокси-сервера в следующем формате файла инициализации:

> [*прокси*]

> Адрес = *http://1.2.3.4*

> Порт =*567*


> [!NOTE]
> Site Recovery агент службы Mobility Service поддерживает только *прокси-серверы без проверки подлинности*.

### <a name="more-information"></a>Дополнительные сведения

Чтобы указать [необходимые URL-адреса](azure-to-azure-about-networking.md#outbound-connectivity-for-urls) или [диапазоны IP-](azure-to-azure-about-networking.md#outbound-connectivity-for-ip-address-ranges)адресов, следуйте указаниям в статье [о работе с сетью в Azure для репликации Azure](site-recovery-azure-to-azure-networking-guidance.md).

## <a name="disk-not-found-in-the-machine-error-code-150039"></a>На компьютере не найден диск (код ошибки 150039)

Необходимо инициализировать новый диск, подключенный к виртуальной машине. Если диск не найден, появится следующее сообщение:

> "Диск данных Azure *DiskName* *DiskURI* с логическим номером *LUN* *LUNValue* не сопоставлен с соответствующим диском, который указан в виртуальной машине и имеет то же значение LUN.

### <a name="possible-causes"></a>Возможные причины

- Новый диск данных был подключен к виртуальной машине, но не был инициализирован.
- Диск данных в виртуальной машине неправильно сообщает значение логического номера устройства (LUN), с которого диск был подключен к виртуальной машине.

### <a name="fix-the-problem"></a>Устранение проблемы

Убедитесь, что диски данных инициализированы, и повторите операцию.

- **Windows**: [Подключение управляемого диска данных к виртуальной машине Windows с помощью портала Azure](https://docs.microsoft.com/azure/virtual-machines/windows/attach-managed-disk-portal).

- **Linux**: [Добавление диска к виртуальной машине Linux](https://docs.microsoft.com/azure/virtual-machines/linux/add-disk).

Если проблема не исчезнет, обратитесь в службу поддержки.

## <a name="one-or-more-disks-are-available-for-protection-error-code-153039"></a>Один или несколько дисков доступны для защиты (код ошибки 153039).

### <a name="possible-causes"></a>Возможные причины

- Один или несколько дисков недавно были добавлены в виртуальную машину после защиты.
- Один или несколько дисков были инициализированы после защиты виртуальной машины.

### <a name="fix-the-problem"></a>Устранение проблемы

Чтобы снова сделать состояние репликации виртуальной машины работоспособным, можно выбрать защиту дисков или закрыть предупреждение.

#### <a name="to-protect-the-disks"></a>Защита дисков

1. Перейдите к разделу **реплицированные элементы** > *диски* > **имен виртуальных машин**.
1. Выберите незащищенный диск, а затем щелкните **включить репликацию**.

    ![Включение репликации на дисках виртуальных машин](./media/azure-to-azure-troubleshoot-errors/add-disk.png)

#### <a name="to-dismiss-the-warning"></a>Чтобы закрыть предупреждение

1. Перейдите в раздел " **реплицированные элементы** > "*имя виртуальной машины*.
1. Выберите предупреждение в разделе **Обзор** и нажмите кнопку **ОК**.

    ![Отклонить новое — предупреждение о новом диске](./media/azure-to-azure-troubleshoot-errors/dismiss-warning.png)

## <a name="remove-the-virtual-machine-from-the-vault-completed-with-information-error-code-150225"></a>Удаление виртуальной машины из хранилища завершена со сведениями (код ошибки 150225)

При защите виртуальной машины Site Recovery создает некоторые ссылки на исходной виртуальной машине. При удалении защиты или отключении репликации Site Recovery удаляет эти ссылки в рамках задания очистки. Если виртуальная машина имеет блокировку ресурсов, задание очистки завершается с помощью этих сведений. Эта информация говорит о том, что виртуальная машина была удалена из хранилища служб восстановления, но на исходном компьютере не удалось очистить некоторые устаревшие ссылки.

Это предупреждение можно проигнорировать, если вы никогда не планируете защищать эту виртуальную машину еще раз. Но если вы хотите защитить эту виртуальную машину позже, выполните действия, описанные в разделе "Устранение проблемы", чтобы очистить ссылки.

> [!WARNING]
> Если вы не выполняете очистку, сделайте следующее:
>
> - При включении репликации с помощью хранилища служб восстановления виртуальная машина не будет отображаться в списке.
> - Если вы попытаетесь защитить виртуальную машину с помощью**параметров** >  **виртуальной машины** > **Аварийное восстановление**, операция завершится с сообщением "не удается включить репликацию из-за существующих устаревших ссылок на ресурсы в Виртуальная машина ".

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Во время выполнения этих действий Site Recovery не удаляет исходную виртуальную машину или не влияет на нее каким бы то ни было.

1. Удалите блокировку виртуальной машины или группы ресурсов виртуальной машины. Например, на следующем рисунке блокировка ресурса на виртуальной машине с именем "Моведемо" должна быть удалена:

    ![Снятие блокировки с виртуальной машины](./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png)

1. Скачайте скрипт, чтобы [Удалить устаревшую конфигурацию Site Recovery](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1).
1. Запустите скрипт, который называется Клеануп-стале-АСР-конфиг-Азуре-ВМ. ps1. Укажите идентификатор подписки, группу ресурсов виртуальной машины и имя виртуальной машины в качестве параметров.
1. Если вы запрашиваете учетные данные Azure, укажите их. Затем убедитесь, что сценарий выполняется без сбоев.

## <a name="replication-cant-be-enabled-because-of-stale-resource-links-on-the-vm-error-code-150226"></a>Невозможно включить репликацию из-за устаревших ссылок на ресурсы на виртуальной машине (код ошибки 150226)

### <a name="possible-cause"></a>Возможная причина

Виртуальная машина имеет устаревшую конфигурацию от предыдущей защиты Site Recovery.

Устаревшая конфигурация может возникать на виртуальной машине Azure, если вы включили репликацию для виртуальной машины Azure с помощью Site Recovery, а затем:

- Репликация отключена, но исходная виртуальная машина была заблокирована ресурсом.
- Вы удалили хранилище Site Recovery без явного отключения репликации на виртуальной машине.
- Вы удалили группу ресурсов, содержащую хранилище Site Recovery, без явного отключения репликации на виртуальной машине.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Во время выполнения этих действий Site Recovery не удаляет исходную виртуальную машину или не влияет на нее каким бы то ни было.

1. Удалите блокировку виртуальной машины или группы ресурсов виртуальной машины. Например, на следующем рисунке блокировка ресурса на виртуальной машине с именем "Моведемо" должна быть удалена:

    ![Снятие блокировки с виртуальной машины](./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png)

1. Скачайте скрипт, чтобы [Удалить устаревшую конфигурацию Site Recovery](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1).
1. Запустите скрипт, который называется Клеануп-стале-АСР-конфиг-Азуре-ВМ. ps1. Укажите идентификатор подписки, группу ресурсов виртуальной машины и имя виртуальной машины в качестве параметров.
1. Если вы запрашиваете учетные данные Azure, укажите их. Затем убедитесь, что сценарий выполняется без сбоев.

## <a name="unable-to-see-the-azure-vm-or-resource-group-for-the-selection-in-the-enable-replication-job"></a>Не удалось просмотреть виртуальную машину или группу ресурсов Azure для выбора в задании "включить репликацию".

### <a name="cause-1-the-resource-group-and-source-virtual-machine-are-in-different-locations"></a>Причина 1. Группа ресурсов и исходная виртуальная машина находятся в разных расположениях

Site Recovery в настоящее время требуется, чтобы группа ресурсов исходного региона и виртуальные машины находящегося в одном расположении. Если это не так, вы не сможете найти виртуальную машину или группу ресурсов при попытке применения защиты.

В качестве обходного решения можно включить репликацию из виртуальной машины, а не из хранилища служб восстановления. Перейдите в раздел > **Свойства** > исходной виртуальной машины**Аварийное восстановление** и включите репликацию.

### <a name="cause-2-the-resource-group-is-not-part-of-the-selected-subscription"></a>Причина 2. Группа ресурсов не является частью выбранной подписки

Возможно, вы не сможете найти группу ресурсов во время защиты, если группа ресурсов не является частью выбранной подписки. Убедитесь, что группа ресурсов принадлежит подписке, которую вы используете.

### <a name="cause-3-stale-configuration"></a>Причина 3. Устаревшая конфигурация

Вы можете не увидеть виртуальную машину, которую вы хотите включить для репликации, если на виртуальной машине Azure была оставлена устаревшая конфигурация Site Recovery. Это состояние может произойти, если вы включили репликацию для виртуальной машины Azure с помощью Site Recovery, а затем:

- Вы удалили хранилище Site Recovery без явного отключения репликации на виртуальной машине.
- Вы удалили группу ресурсов, содержащую хранилище Site Recovery, без явного отключения репликации на виртуальной машине.
- Репликация отключена, но исходная виртуальная машина была заблокирована ресурсом.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Не забудьте обновить модуль "AzureRM. Resources" перед использованием сценария, указанного в этом разделе.  Во время выполнения этих действий Site Recovery не удаляет исходную виртуальную машину или не влияет на нее каким бы то ни было.

1. Удалите блокировку, если она есть, из виртуальной машины или группы ресурсов виртуальной машины. Например, на следующем рисунке блокировка ресурса на виртуальной машине с именем "Моведемо" должна быть удалена:

    ![Снятие блокировки с виртуальной машины](./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png)

1. Скачайте скрипт, чтобы [Удалить устаревшую конфигурацию Site Recovery](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1).
1. Запустите скрипт, который называется Клеануп-стале-АСР-конфиг-Азуре-ВМ. ps1. Укажите идентификатор подписки, группу ресурсов виртуальной машины и имя виртуальной машины в качестве параметров.
1. Если вы запрашиваете учетные данные Azure, укажите их. Затем убедитесь, что сценарий выполняется без сбоев.

## <a name="unable-to-select-a-virtual-machine-for-protection"></a>Не удалось выбрать виртуальную машину для защиты

### <a name="cause-1-the-virtual-machine-has-an-extension-installed-in-a-failed-or-unresponsive-state"></a>Причина 1. Расширение виртуальной машины установлено в состоянии сбоя или без реагирования

Перейдите в раздел**Параметры** >  > виртуальной машины**расширения** и проверьте наличие расширений в состоянии сбоя. Удалите все неудачные расширения и повторите попытку, чтобы защитить виртуальную машину.

### <a name="cause-2-the-vms-provisioning-state-is-not-valid"></a>Причина 2. Состояние подготовки виртуальной машины недопустимо

Действия по устранению неполадок в [состоянии подготовки виртуальной машины недопустимы](#the-vms-provisioning-state-is-not-valid-error-code-150019), далее в этой статье.

## <a name="the-vms-provisioning-state-is-not-valid-error-code-150019"></a>Недопустимое состояние подготовки виртуальной машины (код ошибки 150019)

Чтобы включить репликацию на виртуальной машине, ее состояние подготовки должно быть **установлено**. Выполните следующие действия, чтобы проверить состояние подготовки.

1. В портал Azure выберите **Обозреватель ресурсов** из **всех служб**.
1. Разверните список **Подписки** и выберите нужную подписку.
1. Разверните список **ResourceGroups** и выберите группу ресурсов, к которой относится виртуальная машина.
1. Разверните список **ресурсы** и выберите свою виртуальную машину.
1. Проверьте поле **provisioningState** в представлении экземпляров с правой стороны.

### <a name="fix-the-problem"></a>Устранение проблемы

- Если в поле **provisioningState** отображается значение **Сбой**, обратитесь в службу поддержки и предоставьте необходимые сведения для устранения проблемы.
- Если **provisioningState** обновляется **, может**быть развернуто другое расширение. Проверьте, нет ли текущих операций на виртуальной машине, дождитесь их завершения и повторите Site Recovery задание "включить репликацию".

## <a name="unable-to-select-target-vm-network-selection-tab-is-unavailable"></a>Не удалось выбрать целевую виртуальную машину (вкладка "Выбор сети" недоступна)

### <a name="cause-1-your-vm-is-attached-to-a-network-thats-already-mapped-to-a-target-network"></a>Причина 1. Виртуальная машина подключена к сети, которая уже сопоставлена с целевой сетью.

Если исходная виртуальная машина является частью виртуальной сети, а другая виртуальная машина из той же виртуальной сети уже сопоставлена с сетью в Целевой группе ресурсов, раскрывающийся список "Выбор сети" недоступен (отображается серым цветом) по умолчанию.

![Список выбора сети недоступен](./media/site-recovery-azure-to-azure-troubleshoot/unabletoselectnw.png)

### <a name="cause-2-you-previously-protected-the-vm-by-using-site-recovery-and-then-you-disabled-the-replication"></a>Причина 2. Вы ранее защитили виртуальную машину с помощью Site Recovery, а затем отключили репликацию

Отключение репликации виртуальной машины не приводит к удалению сетевого сопоставления. Сопоставление должно быть удалено из хранилища служб восстановления, в котором была защищена виртуальная машина. Перейдитек *хранилищу служб восстановления* > **Site Recovery** > **Сетевое сопоставление**инфраструктуры.

![Удалить сопоставление сетей](./media/site-recovery-azure-to-azure-troubleshoot/delete_nw_mapping.png)

Целевая сеть, настроенная во время настройки аварийного восстановления, может быть изменена после начальной установки после того, как виртуальная машина будет защищена:

![Изменение сетевого сопоставления](./media/site-recovery-azure-to-azure-troubleshoot/modify_nw_mapping.png)

Обратите внимание, что изменение сетевого сопоставления влияет на все защищенные виртуальные машины, использующие это же Сетевое сопоставление.

## <a name="com-or-volume-shadow-copy-service-error-error-code-151025"></a>Ошибка службы COM+ или теневого копирования томов (код ошибки 151025)

При возникновении этой ошибки появляется следующее сообщение:

> "Не удалось установить расширение Site Recovery"

### <a name="possible-causes"></a>Возможные причины

- Служба приложений системы COM+ отключена.
- Служба теневого копирования томов отключена.

### <a name="fix-the-problem"></a>Устранение проблемы

Задайте для системного приложения COM+ и служб теневого копирования томов автоматический или ручной режим запуска.

1. Откройте консоль службы в Windows.
1. Убедитесь, что в качестве **типа запуска**для системного приложения COM+ и служб теневого копирования томов не задано значение **отключено** .

    ![Проверка типа запуска системного приложения COM+ и служб теневого копирования томов](./media/azure-to-azure-troubleshoot-errors/com-error.png)

## <a name="unsupported-managed-disk-size-error-code-150172"></a>Неподдерживаемый размер управляемого диска (код ошибки 150172)

При возникновении этой ошибки появляется следующее сообщение:

> "Не удалось включить защиту для виртуальной машины, так как она имеет *DiskName* с размером *DiskSize*) *, которая меньше минимального поддерживаемого размера 1024 МБ".

### <a name="possible-cause"></a>Возможная причина

Размер диска меньше поддерживаемого размера в 1024 МБ.

### <a name="fix-the-problem"></a>Устранение проблемы

Убедитесь, что размер диска находится в пределах поддерживаемого диапазона размеров, и повторите операцию.

## <a name="enable-protection-failed-as-device-name-mentioned-in-the-grub-configuration-instead-of-uuid-error-code-151126"></a>Защита не включена, так как конфигурация GRUB включает имя устройства вместо UUID (код ошибки 151126).

### <a name="possible-cause"></a>Возможная причина

В файлах конфигурации Linux GRUB (/Boot/GRUB/menu.lst ",/Бут/груб/груб.КФГ,/Boot/grub2/GRUB.cfg или/etc/default/grub) могут указываться фактические имена устройств вместо значений UUID для параметров *root* и *Resume* . Site Recovery требуются UUID, так как имена устройств могут изменяться. После перезагрузки виртуальная машина может не иметь такого же имени при отработке отказа, что приведет к проблемам.

В следующих примерах показаны строки из файлов GRUB, где вместо требуемых UUID отображаются имена устройств (выделены жирным шрифтом):

- /Boot/grub2/GRUB.cfg файла

  > **корневой каталог Linux/boot/vmlinuz-3.12.49-11-Default =/dev/sda2** $ {extra_cmdline} **Resume =/dev/sda1** -Splash = тихий режим без уведомления шовоптс

- Файл:/Boot/GRUB/menu.lst

  > ядро/boot/vmlinuz-3.0.101-63-Default **корень =/dev/sda2** **Resume =/dev/sda1** Splash = Silent crashkernel = 256M-: 128M шовоптс VGA = 0x314


### <a name="fix-the-problem"></a>Устранение проблемы

Замените имя каждого устройства соответствующим UUID:

1. Найдите UUID устройства, выполнив команду **blkid** ***имя устройства***. Пример:

    ```
    blkid /dev/sda1
    /dev/sda1: UUID="6f614b44-433b-431b-9ca1-4dd2f6f74f6b" TYPE="swap"
    blkid /dev/sda2
    /dev/sda2: UUID="62927e85-f7ba-40bc-9993-cc1feeb191e4" TYPE="ext3"
   ```

1. Замените имя устройства UUID, в формате **root = UUID**==*UUID* и **Resume =** UUID*UUID*. Например, после замены строка из/Boot/GRUB/menu.lst (обсуждалась ранее) будет выглядеть следующим образом:

    > ядро/boot/vmlinuz-3.0.101-63-Default **корень = UUID = 62927e85-f7ba-40bc-9993-cc1feeb191e4** **Resume = UUID = 6f614b44-433b-431b-9ca1-4dd2f6f74f6b** Splash = Silent crashkernel = 256M-: 128M шовоптс VGA = 0x314

1. Повторите защиту.

## <a name="enable-protection-failed-because-the-device-mentioned-in-the-grub-configuration-doesnt-exist-error-code-151124"></a>Не удалось включить защиту, так как устройство, указанное в конфигурации GRUB, не существует (код ошибки 151124)

### <a name="possible-cause"></a>Возможная причина

Файлы конфигурации GRUB (/Boot/GRUB/menu.lst,/Бут/груб/груб.КФГ,/Boot/grub2/GRUB.cfg или/etc/default/grub) могут содержать параметры *Rd.LVM.lv* или *rd_LVM_LV*. Эти параметры определяют устройства диспетчера логических томов (LVM), которые должны быть обнаружены во время загрузки. Если эти устройства LVM не существуют, защищенная система не загрузится и будет зависнуть в процессе загрузки. Эта же проблема также будет отображаться на виртуальной машине отработки отказа. Рассмотрим несколько примеров.

- Файл:/Boot/grub2/GRUB.cfg на RHEL7:

    > linux16/vmlinuz-3.10.0-957.el7.x86_64 root =/dev/Mapper/rhel_mup--rhel7u6-root ro crashkernel = 128M\@64M **Rd. LVM. Латвия = рутвг/root Rd. LVM. Латвия = рутвг/swap** рхгб quiet lang = en_US. UTF-8

- Файл:/etc/default/grub на RHEL7:

    > GRUB_CMDLINE_LINUX = "crashkernel = автоматический **Rd. LVM. lv = рутвг/корневой Rd. LVM. Латвия = рутвг/swap** рхгб quiet"

- Файл:/Boot/GRUB/menu.lst на RHEL6:

    > ядро/vmlinuz-2.6.32-754.el6.x86_64 ro root = UUID = 36dd8b45-e90d-40d6-81ac-ad0d0725d69e rd_NO_LUKS LANG = en_US. UTF-8 rd_NO_MD СИСФОНТ = латарцирхеб-sun16 crashkernel = Auto **rd_LVM_LV = рутвг/lv_root** кэйбоардтипе = PC кэйтабле = US **rd_LVM_LV = рутвг/lv_swap** rd_NO_DM рхгб quiet

В каждом примере часть, выделенная жирным шрифтом, показывает, что GRUB должен обнаружить два LVM устройства с именами "root" и "Swap" из группы томов "рутвг".

### <a name="fix-the-problem"></a>Устранение проблемы

Если устройство LVM не существует, создайте его или удалите соответствующие параметры из файлов конфигурации GRUB. Затем повторите попытку, чтобы включить защиту.

## <a name="a-site-recovery-mobility-service-update-finished-with-warnings-error-code-151083"></a>Обновление службы Site Recovery Mobility Service завершено с предупреждениями (код ошибки 151083)

Служба Site Recovery Mobility Service имеет много компонентов, одна из которых называется драйвером фильтра. Драйвер фильтра загружается в системную память только во время перезапуска системы. Всякий раз, когда обновление службы Mobility включает изменения драйвера фильтра, компьютер обновляется, но по-прежнему отображается предупреждение о том, что некоторые исправления нуждаются в перезагрузке. Предупреждение появляется, потому что исправления драйвера фильтра могут вступить в силу только после загрузки нового драйвера фильтра, который происходит только при перезапуске.

> [!NOTE]
> Это всего лишь предупреждение. Существующая репликация продолжит работать даже после нового обновления агента. Вы можете перезапускать каждый раз, когда вы хотите воспользоваться преимуществами нового драйвера фильтра, но старый драйвер фильтра продолжает работать, если не перезапускается.
>
> Помимо драйвера фильтра, преимущества любых других усовершенствований и исправлений в обновлении службы Mobility вступят в силу без перезагрузки.  

## <a name="protection-couldnt-be-enabled-because-the-replica-managed-disk-already-exists-without-expected-tags-in-the-target-resource-group-error-code-150161"></a>Не удалось включить защиту, так как управляемый диск реплики уже существует, без ожидаемых тегов в Целевой группе ресурсов (код ошибки 150161).

### <a name="possible-cause"></a>Возможная причина

Эта проблема может возникать, если ранее была защищена виртуальная машина, и когда репликация была отключена, диск реплики не был очищен.

### <a name="fix-the-problem"></a>Устранение проблемы

Удалите диск реплики, указанный в сообщении об ошибке, и повторите задание защиты, завершившееся сбоем.

## <a name="next-steps"></a>Следующие шаги

[Репликация виртуальных машин Azure](site-recovery-replicate-azure-to-azure.md)
