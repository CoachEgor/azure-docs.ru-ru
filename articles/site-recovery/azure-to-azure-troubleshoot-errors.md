---
title: Репликация Azure VM в восстановлении сайта Azure
description: Ошибки при репликации виртуальных машин Azure для аварийного восстановления.
author: rochakm
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 04/08/2019
ms.author: rochakm
ms.openlocfilehash: c131609a5622061e2ea49db422bc4e9da96666d1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80276688"
---
# <a name="troubleshoot-azure-to-azure-vm-replication-errors"></a>Ошибки, связанные с ошибками Azure-to-Azure VM, ошибки репликации VM

В этой статье описывается, как устранить распространенные ошибки в восстановлении сайта Azure во время репликации и восстановления виртуальных машин Azure (VM) из одного региона в другой. Дополнительные сведения о поддерживаемых конфигурациях см. в статье [Azure Site Recovery support matrix for replicating from Azure to Azure](site-recovery-support-matrix-azure-to-azure.md) (Матрица поддержки Azure Site Recovery для репликации виртуальных машин из Azure в Azure).

## <a name="azure-resource-quota-issues-error-code-150097"></a><a name="azure-resource-quota-issues-error-code-150097"></a>Проблемы с квотами ресурсов Azure (код ошибки 150097)

Убедитесь, что подписка включена для создания m Ms Azure в целевом регионе, который планируется использовать в регионе аварийного восстановления. Также убедитесь, что ваша подписка имеет достаточную квоту для создания vMs необходимых размеров. По умолчанию восстановление сайта выбирает целевой размер VM, который совпадает с размером исходного VM. Если размер соответствия недоступен, восстановление сайта автоматически выбирает ближайший доступный размер.

Если нет размера, который поддерживает конфигурацию исходного VM, появляется следующее сообщение:

> "Репликация не может быть включена для виртуальной машины *VmName."*

### <a name="possible-causes"></a>Возможные причины

- Идентификатор подписки не позволяет создавать vMs в месте расположения целевого региона.
- Идентификатор подписки не включен или не имеет достаточной квоты для создания определенных размеров VM в местоположении целевого региона.
- Не найдено подходящего целевого размера VM, сопоставимого с картой сетевого интерфейса (NIC) источника VM (NIC) для идентификатора подписки в месте расположения целевого региона.

### <a name="fix-the-problem"></a>Устранение проблемы

Обратитесь в [службу выставления счетов Azure,](https://docs.microsoft.com/azure/azure-portal/supportability/resource-manager-core-quotas-request) чтобы включить подписку для создания внушительных размеров в целевом местоположении. Затем повторите неудачную операцию.

Если целевое место имеет ограничение емкости, отогнайте репликацию к нему. Затем включите репликацию в другое место, где ваша подписка имеет достаточную квоту для создания вс-ам-м, требуемых размеров.

## <a name="trusted-root-certificates-error-code-151066"></a><a name="trusted-root-certificates-error-code-151066"></a>Доверенные корневые сертификаты (код ошибки 151066)

Если не все последние доверенные корневые сертификаты присутствуют на VM, ваша работа по восстановлению сайта "Включить" может выполнить неудачу. Аутентификация и авторизация вызовов службы восстановления сайта из VM не сбой без этих сертификатов.

Если задание "Включить репликацию" не удается, появляется следующее сообщение:

> "Конфигурация восстановления сайта не удалась."

### <a name="possible-cause"></a>Возможная причина

Доверенные корневые сертификаты, необходимые для авторизации и аутентификации, не присутствуют на виртуальной машине.

### <a name="fix-the-problem"></a>Устранение проблемы

#### <a name="windows"></a>Windows

Для VM под управлением операционной системы Windows установите последние обновления Windows на VM, чтобы все доверенные корневые сертификаты присутствовали на машине. Следите за типичным процессом управления обновлением Windows или сертификатами в организации, чтобы получить последние корневые сертификаты и обновленный список отзыва сертификатов на ВМ.

При работе в отключенной среде следуйте стандартной процедуре обновления Windows в вашей организации, чтобы получить сертификаты. Если необходимые сертификаты отсутствуют на виртуальной машине, вызовы к службе Site Recovery завершатся ошибкой по соображениям безопасности.

Чтобы убедиться, что проблема устранена, перейдите на веб-сайт login.microsoftonline.com из браузера на виртуальной машине.

Для получения дополнительной [информации см.](https://technet.microsoft.com/library/dn265983.aspx)

#### <a name="linux"></a>Linux

Следуйте рекомендациям, предоставленным дистрибьютором вашей версии операционной системы Linux, чтобы получить последние доверенные корневые сертификаты и последний список отзывов сертификатов на VM.

Поскольку SUSE Linux использует символические ссылки (или *симлинки)* для поддержания списка сертификатов, выполните следующие действия:

1. Войдите как привилегированный пользователь.

1. Запустите эту команду, чтобы изменить каталог:

    **cd /etc/ssl/certs**

1. Проверьте, присутствует ли сертификат Symantec root CA:

    **- ls VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem**

1. Если сертификат Root CA Symantec не найден, запустите следующую команду для загрузки файла. Проверьте наличие ошибок и следуйте рекомендуемым действиям на наличие сбоев в сети.

    **Wget https://docs.broadcom.com/docs-and-downloads/content/dam/symantec/docs/other-resources/verisign-class-3-public-primary-certification-authority-g5-en.pem -O VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem**

1. Проверьте, присутствует ли сертификат Балтимора root CA:

    **- л.с Baltimore_CyberTrust_Root.pem**

1. Если сертификат Baltimore root CA не найден, запустите эту команду для загрузки сертификата:

    **Wget https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem -O Baltimore_CyberTrust_Root.pem**

1. Проверьте, присутствует ли сертификат DigiCert_Global_Root_CA:

    **- ls DigiCert_Global_Root_CA.pem**

1. Если DigiCert_Global_Root_CA не найдено, запустите следующие команды для загрузки сертификата:

    **- wgethttp://www.digicert.com/CACerts/DigiCertGlobalRootCA.crt**

    **- открывает x509 -в DigiCertGlobalRootCA.crt-inform der-outform pem - out DigiCert_Global_Root_CA.pem**

1. Выполнить сценарий перепева для обновления хэша темы сертификата для недавно загруженных сертификатов:

    **- c_rehash**

1. Выполнить эти команды, чтобы проверить, были ли созданы хэши объекта как симлины для сертификатов:

    - Команда:

        **-л. Grep Балтимор**

    - Выходные данные:

        `lrwxrwxrwx 1 root root   29 Jan  8 09:48 3ad48a91.0 -> Baltimore_CyberTrust_Root.pem`

        `-rw-r--r-- 1 root root 1303 Jun  5  2014 Baltimore_CyberTrust_Root.pem`

    - Команда:

        **-л. Греп VeriSign_Class_3_Public_Primary_Certification_Authority_G5**

    - Выходные данные:

        `-rw-r--r-- 1 root root 1774 Jun  5  2014 VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem`

        `lrwxrwxrwx 1 root root   62 Jan  8 09:48 facacbc6.0 -> VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem`

    - Команда:

        **-л. Греп DigiCert_Global_Root**

    - Выходные данные:

        `lrwxrwxrwx 1 root root   27 Jan  8 09:48 399e7759.0 -> DigiCert_Global_Root_CA.pem`

        `-rw-r--r-- 1 root root 1380 Jun  5  2014 DigiCert_Global_Root_CA.pem`

1. Создайте копию файла VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem с именем файла b204d74a.0:

    **- cp VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem b204d74a.0**

1. Создайте копию файла Baltimore_CyberTrust_Root.pem с именем файла 653b494a.0:

    **- cp Baltimore_CyberTrust_Root.pem 653b494a.0**

1. Создайте копию файла DigiCert_Global_Root_CA.pem с именем файла 3513523f.0:

    **- cp DigiCert_Global_Root_CA.pem 3513523f.0**

1. Проверьте, присутствуют ли файлы:

    - Команда:

        **ls -l 653b494a.0 b204d74a.0 3513523f.0**

    - Выходные данные

        `-rw-r--r-- 1 root root 1774 Jan  8 09:52 3513523f.0`

        `-rw-r--r-- 1 root root 1303 Jan  8 09:52 653b494a.0`

        `-rw-r--r-- 1 root root 1774 Jan  8 09:52 b204d74a.0`

## <a name="outbound-connectivity-for-site-recovery-urls-or-ip-ranges-error-code-151037-or-151072"></a>Исходящие подключения для URL-адресов Site Recovery или IP-диапазонов (код ошибки 151037 или 151072)

Для того чтобы репликация восстановления сайта работала, от VM требуется исходящие подключения к определенным URL-адресам. Если виртуальная машина находится за брандмауэром или использует правила группы безопасности сети (NSG) для управления исходящими подключениями, могут возникнуть следующие проблемы. Обратите внимание, что, хотя мы продолжаем поддерживать исходящий доступ через URL-адреса, использование разрешительного списка диапазонов IP больше не поддерживается.

### <a name="issue-1-failed-to-register-azure-virtual-machine-with-site-recovery-151195-br"></a><a name="issue-1-failed-to-register-azure-virtual-machine-with-site-recovery-151195-br"></a>Проблема 1. Не удалось зарегистрировать виртуальную машину Azure в Site Recovery (151195) </br>
- **Возможная причина** </br>
  - Подключение к конечным точкам восстановления сайта не может быть установлено из-за сбоя разрешения DNS.
  - Это чаще наблюдается во время повторной защиты, когда вы выполнили отработку отказа виртуальной машины, но DNS-сервер недоступен из региона аварийного восстановления.

- **Решение**
   - Если вы используете настраиваемый DNS-сервер, обеспечьте его доступность из региона аварийного восстановления. Чтобы проверить, есть ли у вас настраиваемый DNS-сервер, выберите "Виртуальная машина", затем щелкните сеть аварийного восстановления и выберите "DNS-серверы". Попробуйте получить доступ к DNS-серверу с виртуальной машины. Если он недоступен, обеспечьте его доступность, выполнив отработку отказа DNS-сервера или обеспечив видимость между сетью аварийного восстановления и DNS-сервером.

    ![com-error](./media/azure-to-azure-troubleshoot-errors/custom_dns.png)


### <a name="issue-2-site-recovery-configuration-failed-151196"></a>Проблема 2. Сбой при выполнении настройки Site Recovery (151196)
- **Возможная причина** </br>
  - Не удается подключиться к конечным точкам IP4 удостоверения и проверки подлинности Office 365.

- **Решение**
  - Обеспечьте доступ Azure Site Recovery для выполнения проверки подлинности диапазонов IP-адресов Office 365.
    Если вы используете правила Azure Network Security Group (NSG) (прокси-сервер брандмауэра) для управления исходящим подключением к сети на VM, убедитесь, что вы используете на основе правила NSG службы [Azure Active Directory (AAD)](../virtual-network/security-overview.md#service-tags) для предоставления доступа к AAD. Мы больше не поддерживаем правила NSG на основе IP-адресов.


### <a name="issue-3-site-recovery-configuration-failed-151197"></a>Проблема 3. Сбой при выполнении настройки Site Recovery (151197)
- **Возможная причина** </br>
  - Не удается подключиться к конечным точкам службы Azure Site Recovery.

- **Решение**
  - Если вы используете правила Azure Network Security Group (NSG) /прокси-сервер брандмауэра для управления испускаемым подключением к сети на VM, убедитесь, что вы используете теги услуг. Мы больше не поддерживаем использование разрешаемого списка IP-адресов через НСГ для восстановления сайта Azure (ASR).


### <a name="issue-4-a2a-replication-failed-when-the-network-traffic-goes-through-on-premise-proxy-server-151072"></a>Проблема 4. Во время прохождения сетевого трафика через локальный прокси-сервер репликация A2A завершилась ошибкой (151072)
 - **Возможная причина** </br>
   - Пользовательские настройки прокси-сервера недействительны, а агент службы Mobility Service ASR не смог автоматически определить параметры прокси-сервера из Internet Explorer


 - **Решение**
   1.    Агент службы Mobility Service обнаруживает настройки прокси-сервера из Internet Explorer в ОС Windows и в каталоге /etc/environment в ОС Linux.
   2.  Если вы предпочитаете устанавливать прокси-сервер только для службы Mobility Service ASR, данные прокси-сервера можно внести в файл ProxyInfo.conf, расположенный по адресу:</br>
       - ``/usr/local/InMage/config/`` в ***Linux***
       - ``C:\ProgramData\Microsoft Azure Site Recovery\Config``на ***Windows***
   3.    Файл ProxyInfo.conf должен содержать параметры прокси-сервера в таком формате INI.</br>
                   *(прокси)*</br>
                   *Адрес: адресhttp://1.2.3.4*</br>
                   *Port=567*</br>
   4. Агент службы Mobility Service ASR поддерживает только ***прокси-серверы, которые не прошли проверку подлинности***.


### <a name="fix-the-problem"></a>Устранение проблемы

Чтобы добавить [необходимые URL-адреса](azure-to-azure-about-networking.md#outbound-connectivity-for-urls) в список разрешений, выполните последующие шаги в [документе сетевого руководства.](site-recovery-azure-to-azure-networking-guidance.md)


### <a name="more-information"></a>Дополнительные сведения

Чтобы указать [требуемые URL-адреса](azure-to-azure-about-networking.md#outbound-connectivity-for-urls) или [требуемые диапазоны IP,](azure-to-azure-about-networking.md#outbound-connectivity-using-service-tags)следуйте инструкциям [в сети Azure и репликации Azure.](site-recovery-azure-to-azure-networking-guidance.md)

## <a name="disk-not-found-in-the-machine-error-code-150039"></a>На компьютере не найден диск (код ошибки 150039)

Необходимо инициализировать новый диск, подключенный к виртуальной машине. Если диск не найден, появляется следующее сообщение:

> "Azure data disk *DiskName* *DiskURI* с логическим номером единицы *LUNLUNValue* не был отображен на соответствующем диске, сообщаемом из VM, который имеет то же значение LUN. *LUN*

### <a name="possible-causes"></a>Возможные причины

- Новый диск данных был прикреплен к VM, но не был инициализирован.
- Диск данных внутри VM не правильно сообщает о логическом значении единицы (LUN), при котором диск был прикреплен к VM.

### <a name="fix-the-problem"></a>Устранение проблемы

Убедитесь, что диски данных инициализированы, а затем повторно попробуйте операцию.

- **Windows**: [Прикрепите и инициализировать новый диск](https://docs.microsoft.com/azure/virtual-machines/windows/attach-managed-disk-portal).

- **Linux**: [Инициализация нового диска данных в Linux](https://docs.microsoft.com/azure/virtual-machines/linux/add-disk).

Если проблема не исчезнет, обратитесь в службу поддержки.

## <a name="one-or-more-disks-are-available-for-protection-error-code-153039"></a>Один или несколько дисков доступны для защиты (код ошибки 153039)

### <a name="possible-causes"></a>Возможные причины

- Один или несколько дисков были недавно добавлены в виртуальную машину после защиты.
- Один или несколько дисков были инициализированы после защиты виртуальной машины.

### <a name="fix-the-problem"></a>Устранение проблемы

Чтобы сделать статус репликации VM снова здоровым, вы можете выбрать либо для защиты дисков или отклонить предупреждение.

#### <a name="to-protect-the-disks"></a>Для защиты дисков

1. Перейти к **Replicated Элементы** > *VM имя* > **диски**.
1. Выберите незащищенный диск, а затем выберите **репликацию Включить:**

    ![Включить репликацию на vM-дисках](./media/azure-to-azure-troubleshoot-errors/add-disk.png)

#### <a name="to-dismiss-the-warning"></a>Отклонить предупреждение

1. Перейти к **Replicated пунктов** > *VM имя*.
1. Выберите предупреждение в разделе **Обзор,** а затем выберите **OK**.

    ![Отклонить предупреждение о новом диске](./media/azure-to-azure-troubleshoot-errors/dismiss-warning.png)

## <a name="remove-the-virtual-machine-from-the-vault-completed-with-information-error-code-150225"></a>Удалите виртуальную машину из хранилища, заполненную информацией (код ошибки 150225)

Когда он защищает виртуальную машину, Восстановление сайта создает некоторые ссылки на исходную виртуальную машину. При удалении защиты или отключить репликацию восстановление сайта удаляет эти ссылки как часть задания очистки. Если виртуальная машина имеет блокировку ресурса, задание очистки завершается с информацией. Информация говорит, что виртуальная машина была удалена из хранилища служб восстановления, но что некоторые устаревшие ссылки не могут быть очищены на исходной машине.

Вы можете проигнорировать это предупреждение, если вы никогда не собираетесь защитить эту виртуальную машину снова. Но если у вас есть, чтобы защитить эту виртуальную машину позже, следуйте шагам в соответствии с "Исправить проблему", чтобы очистить ссылки.

> [!WARNING]
> Если вы не сделаете очистку:
>
> - При включении репликации с помощью хранилища служб восстановления виртуальная машина не будет указана.
> - Если вы попытаетесь защитить VM с помощью**виртуальных** >  **параметров машины** > **аварийного восстановления,** операция выйдет из строя с сообщением "Репликация не может быть включена из-за существующих устаревших ссылок ресурсов на VM".

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Восстановление сайта не удаляет исходную виртуальную машину и не влияет на нее каким-либо образом во время выполнения этих шагов.

1. Удалите блокировку из группы ресурсов VM или VM. Например, на следующем изображении блокировка ресурса на VM под названием "MoveDemo" должна быть удалена:

    ![Удалить блокировку из VM](./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png)

1. Скачать скрипт, чтобы [удалить устаревшую конфигурацию восстановления сайта.](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1)
1. Выполнить сценарий, который называется Cleanup-stale-asr-config-Azure-VM.ps1. Предоставируйте идентификатор подписки, группу ресурсов VM и имя VM в качестве параметров.
1. Если у вас запрашивается учетные данные Azure, предоставьте их. Затем убедитесь, что скрипт работает без каких-либо сбоев.

## <a name="replication-cant-be-enabled-because-of-stale-resource-links-on-the-vm-error-code-150226"></a>Репликация не может быть включена из-за устаревших ссылок ресурсов на VM (код ошибки 150226)

### <a name="possible-cause"></a>Возможная причина

Виртуальная машина имеет устаревшую конфигурацию от предыдущей защиты восстановления сайта.

Несхочная конфигурация может возникнуть на VM Azure, если вы включили репликацию для Azure VM с помощью восстановления сайта, а затем:

- Вы отключили репликацию, но у исходного VM была блокировка ресурса.
- Вы удалили хранилище восстановления сайта без явного отключения репликации на VM.
- Вы удалили группу ресурсов, содержащую хранилище восстановления сайта, без явного отключения репликации на VM.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Восстановление сайта не удаляет исходную виртуальную машину и не влияет на нее каким-либо образом во время выполнения этих шагов.

1. Удалите блокировку из группы ресурсов VM или VM. Например, на следующем изображении блокировка ресурса на VM под названием "MoveDemo" должна быть удалена:

    ![Удалить блокировку из VM](./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png)

1. Скачать скрипт, чтобы [удалить устаревшую конфигурацию восстановления сайта.](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1)
1. Выполнить сценарий, который называется Cleanup-stale-asr-config-Azure-VM.ps1. Предоставируйте идентификатор подписки, группу ресурсов VM и имя VM в качестве параметров.
1. Если у вас запрашивается учетные данные Azure, предоставьте их. Затем убедитесь, что скрипт работает без каких-либо сбоев.

## <a name="unable-to-see-the-azure-vm-or-resource-group-for-the-selection-in-the-enable-replication-job"></a>Невозможно просмотреть ВМ Azure или группу ресурсов для выбора в задания "Включить репликацию"

### <a name="cause-1-the-resource-group-and-source-virtual-machine-are-in-different-locations"></a>Причина 1: Группа ресурсов и источник виртуальной машины находятся в разных местах

Восстановление сайта в настоящее время требует, чтобы группа ресурсов региона исходного кода и виртуальные машины были в одном месте. Если это не так, вы не сможете найти виртуальную машину или группу ресурсов, когда вы попытаетесь применить защиту.

В качестве обходного пути можно включить репликацию из VM вместо хранилища служб восстановления. Перейдите в **Source VM** > **Свойства** > **аварийного восстановления** и включить репликацию.

### <a name="cause-2-the-resource-group-is-not-part-of-the-selected-subscription"></a>Причина 2: Группа ресурсов не является частью выбранной подписки

Возможно, вы не сможете найти группу ресурсов во время защиты, если группа ресурсов не является частью выбранной подписки. Убедитесь, что группа ресурсов относится к подписке, которую вы используете.

### <a name="cause-3-stale-configuration"></a>Причина 3: Устаревая конфигурация

Возможно, вы не увидите VM, который требуется включить для репликации, если в Azure VM осталась устаревая конфигурация восстановления сайта. Это условие может возникнуть, если вы включили репликацию для Azure VM с помощью восстановления сайта, а затем:

- Вы удалили хранилище восстановления сайта без явного отключения репликации на VM.
- Вы удалили группу ресурсов, содержащую хранилище восстановления сайта, без явного отключения репликации на VM.
- Вы отключили репликацию, но у исходного VM была блокировка ресурса.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Не забудьте обновить модуль "AzureRM.Resources" перед использованием сценария, упомянутого в этом разделе.  Восстановление сайта не удаляет исходную виртуальную машину и не влияет на нее каким-либо образом во время выполнения этих шагов.

1. Удалите блокировку, если таковой имеется, из группы ресурсов VM или VM. Например, на следующем изображении блокировка ресурса на VM под названием "MoveDemo" должна быть удалена:

    ![Удалить блокировку из VM](./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png)

1. Скачать скрипт, чтобы [удалить устаревшую конфигурацию восстановления сайта.](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1)
1. Выполнить сценарий, который называется Cleanup-stale-asr-config-Azure-VM.ps1. Предоставируйте идентификатор подписки, группу ресурсов VM и имя VM в качестве параметров.
1. Если у вас запрашивается учетные данные Azure, предоставьте их. Затем убедитесь, что скрипт работает без каких-либо сбоев.

## <a name="unable-to-select-a-virtual-machine-for-protection"></a>Невозможно выбрать виртуальную машину для защиты

### <a name="cause-1-the-virtual-machine-has-an-extension-installed-in-a-failed-or-unresponsive-state"></a>Причина 1: Виртуальная машина имеет расширение, установленное в неисправном или безответном состоянии

Перейдите к**расширениям настроек** > **виртуальных** **машин** > и проверьте наличие расширений в неисправном состоянии. Удалите любое неудачное расширение, а затем попробуйте снова защитить виртуальную машину.

### <a name="cause-2-the-vms-provisioning-state-is-not-valid"></a>Причина 2: Состояние подготовки ВМ не является действительным

Посмотреть шаги устранения неполадок в [состоянии подготовки VM не является действительным,](#the-vms-provisioning-state-is-not-valid-error-code-150019)позже в этой статье.

## <a name="the-vms-provisioning-state-is-not-valid-error-code-150019"></a>Состояние подготовки VM не является действительным (код ошибки 150019)

Для того, чтобы репликация на VM, его состояние подготовки должно быть **успешно выполнено.** Выполните следующие действия, чтобы проверить состояние подготовки:

1. На портале Azure выберите **исследователь ресурсов** из **всех служб.**
1. Разверните список **Подписки** и выберите нужную подписку.
1. Разверните список **ResourceGroups** и выберите группу ресурсов, к которой относится виртуальная машина.
1. Расширьте список **ресурсов** и выберите VM.
1. Проверьте поле **provisioningState** в представлении Instance с правой стороны.

### <a name="fix-the-problem"></a>Устранение проблемы

- Если в поле **provisioningState** отображается значение **Сбой**, обратитесь в службу поддержки и предоставьте необходимые сведения для устранения проблемы.
- Если **положение в области подготовки** **обновляется,** может быть развернуто другое расширение. Проверьте, есть ли какие-либо текущие операции на VM, подождите, пока они закончатся, а затем повторно попробуйте неудавшую работу по восстановлению сайта "Включить репликацию".

## <a name="unable-to-select-target-vm-network-selection-tab-is-unavailable"></a>Неудается выбрать целевой VM (вкладка выбора сети недоступна)

### <a name="cause-1-your-vm-is-attached-to-a-network-thats-already-mapped-to-a-target-network"></a>Причина 1: Ваш VM подключен к сети, которая уже отображена в целевой сети

Если исходный VM является частью виртуальной сети, а другой VM из той же виртуальной сети уже отображен с сетью в целевой группе ресурсов, окно списка выпадающих сетей по умолчанию недоступно (появляется затемненным).

![Список выбора сети недоступен](./media/site-recovery-azure-to-azure-troubleshoot/unabletoselectnw.png)

### <a name="cause-2-you-previously-protected-the-vm-by-using-site-recovery-and-then-you-disabled-the-replication"></a>Причина 2: Вы ранее защищали VM с помощью восстановления сайта, а затем вы отключили репликацию

Отключение репликации VM не удаляет сетевое отображение. Отображение должно быть удалено из хранилища служб восстановления, где был защищен VM. Перейти к *восстановлению Услуги хранилище* > **инфраструктуры инфраструктуры инфраструктуры** > **отображение инфраструктуры.**

![Удаление сетевого отображения](./media/site-recovery-azure-to-azure-troubleshoot/delete_nw_mapping.png)

Целевая сеть, настроенная во время установки аварийного восстановления, может быть изменена после первоначальной настройки после защиты VM:

![Изменение сетевого картирования](./media/site-recovery-azure-to-azure-troubleshoot/modify_nw_mapping.png)

Обратите внимание, что изменение отображения сети влияет на все защищенные VMs, которые используют тот же картографический отображение сети.

## <a name="com-or-volume-shadow-copy-service-error-error-code-151025"></a>Ошибка службы копирования теней КОМЗ или Тома (код ошибки 151025)

При возникновении этой ошибки появляется следующее сообщение:

> "Расширение восстановления сайта не удалось установить"

### <a name="possible-causes"></a>Возможные причины

- Служба применения системы КОМЗ отключена.
- Служба Volume Shadow Copy отключена.

### <a name="fix-the-problem"></a>Устранение проблемы

Установите службы приложения com' System ИС-

1. Откройте консоль Служб в Windows.
1. Убедитесь, что службы приложения COM' System Application и Volume Shadow Copy не настроены на **отключение** в качестве **типа запуска.**

    ![Проверьте тип запуска системных приложений и сервисов копирования теней com](./media/azure-to-azure-troubleshoot-errors/com-error.png)

## <a name="unsupported-managed-disk-size-error-code-150172"></a>Неподдерживаемый размер управляемого диска (код ошибки 150172)

При возникновении этой ошибки появляется следующее сообщение:

> "Защита не может быть включена для виртуальной машины, как это *DiskName* с размером *DiskSize)*" , что меньше, чем минимальный поддерживаемый размер 1024 МБ".

### <a name="possible-cause"></a>Возможная причина

Диск меньше поддерживаемого размера 1024 МБ.

### <a name="fix-the-problem"></a>Устранение проблемы

Убедитесь, что размер диска находится в пределах поддерживаемого диапазона размеров, а затем повторить операцию.

## <a name="protection-was-not-enabled-because-the-grub-configuration-includes-the-device-name-instead-of-the-uuid-error-code-151126"></a><a name="enable-protection-failed-as-device-name-mentioned-in-the-grub-configuration-instead-of-uuid-error-code-151126"></a>Защита не была включена, поскольку конфигурация GRUB включает имя устройства вместо UUID (код ошибки 151126)

### <a name="possible-cause"></a>Возможная причина

Файлы конфигурации Linux GRUB (/boot/grub/menu.lst" /boot/grub/grub.cfg,/boot/grub2/grub.cfg, или /etc/default/grub) могут указывать фактические имена устройств вместо значений UUID для параметров *корня* и *резюме.* Восстановление сайта требует UUID, поскольку имена устройств могут меняться. При перезагрузке VM может не придумать одно и то же имя при неудачном перезапуске, что приведет к проблемам.

Ниже приведены строки из файлов GRUB, где вместо требуемых UUID появляются имена устройств (показаны жирным шрифтом):

- Файл /загрузка/grub2/grub.cfg

  > linux   /boot/vmlinuz-3.12.49-11-default **root=/dev/sda2**  ${extra_cmdline} **resume=/dev/sda1** splash=silent quiet showopts

- Файл: /boot/grub/menu.lst

  > ядро /загрузка/vmlinuz-3.0.101-63-default **root'/dev/sda2** **резюме/dev/sda1** splash-silent crashkernel-256M-:128M showopts vga'0x314


### <a name="fix-the-problem"></a>Устранение проблемы

Замените каждое имя устройства соответствующим UUID:

1. Найдите UUID устройства, выдыхая ***имя***устройства **команды blkid.** Пример:

    ```
    blkid /dev/sda1
    /dev/sda1: UUID="6f614b44-433b-431b-9ca1-4dd2f6f74f6b" TYPE="swap"
    blkid /dev/sda2
    /dev/sda2: UUID="62927e85-f7ba-40bc-9993-cc1feeb191e4" TYPE="ext3"
   ```

1. Замените название устройства на его UUID, в форматах **root-UUID**=*UUID* и **резюме UUID**=*UUID*. Например, после замены строка от /boot/grub/menu.lst (обсуждается ранее) будет выглядеть следующим образом:

    > kernel /boot/vmlinuz-3.0.101-63-default **root=UUID=62927e85-f7ba-40bc-9993-cc1feeb191e4** **resume=UUID=6f614b44-433b-431b-9ca1-4dd2f6f74f6b** splash=silent crashkernel=256M-:128M showopts vga=0x314

1. Повторите защиту.

## <a name="enable-protection-failed-because-the-device-mentioned-in-the-grub-configuration-doesnt-exist-error-code-151124"></a>Защита включить не удалось, потому что устройство, упомянутое в конфигурации GRUB не существует (код ошибки 151124)

### <a name="possible-cause"></a>Возможная причина

Файлы конфигурации GRUB (/boot/grub/menu.lst, /boot/grub/grub.cfg, /boot/grub2/grub.cfg, или /etc/default/grub) могут содержать параметры *rd.lvm.lv* или *rd_LVM_LV.* Эти параметры определяют устройства Logical Volume Manager (LVM), которые должны быть обнаружены во время загрузки. Если эти устройства LVM не существуют, защищенная система сама по себе не будет загружаться и будет застряла в процессе загрузки. Та же проблема будет также рассматриваться с failover VM. Рассмотрим несколько примеров.

- Файл: /boot/grub2/grub.cfg на RHEL7:

    > linux16 /vmlinuz-3.10.0-957.el7.x86_64 root'/dev/mapper/rhel_mup-rhel7u6-root ro crashkernel-128M\@64M **rd.lvm.lv'rootvg/root rd.lvm.en_US lv** UTF-8

- Файл: /etc/default/grub на RHEL7:

    > GRUB_CMDLINE_LINUX"crashkernel-auto **rd.lvm.lvvg/root rd.lvm.lv.rurootvg/swap** rhgb quiet"

- Файл: /boot/grub/menu.lst на RHEL6:

    > ядро /vmlinuz-2.6.32-754.el6.x86_64 ro root-UUID-36dd8b45-e90d-40d6-81ac-ad0d0725d69e rd_NO_LUKS ЛАНГ-en_US. УТФ-8 rd_NO_MD СИСФОНТ-латаркирхеб-солнце16 грохот-авто **rd_LVM_LV-rootvg/lv_root** KEYBOARDTYPE-PC KEY rd_NO_DM **lv_swap rd_LVM_LVTABLE**

В каждом примере, часть жирным шрифтом показывает, что GRUB должен обнаружить два устройства LVM с названиями "корень" и "своп" из группы объемов "rootvg".

### <a name="fix-the-problem"></a>Устранение проблемы

Если устройство LVM не существует, либо создайте его, либо удалите соответствующие параметры из файлов конфигурации GRUB. Затем повторите попытку обеспечить защиту.

## <a name="a-site-recovery-mobility-service-update-finished-with-warnings-error-code-151083"></a>Обновление службы мобильности восстановления сайта завершено с предупреждениями (код ошибки 151083)

Служба восстановления сайта имеет много компонентов, один из которых называется драйвером фильтра. Драйвер фильтра загружается в системную память только во время перезагрузки системы. Всякий раз, когда обновление службы мобильности включает в себя изменения драйвера фильтра, машина обновляется, но вы все еще видите предупреждение о том, что некоторые исправления требуют перезагрузки. Предупреждение появляется потому, что исправления драйвера фильтра могут всменяться только при загрузке нового драйвера фильтра, что происходит только во время перезагрузки.

> [!NOTE]
> Это всего лишь предупреждение. Существующее репликация продолжает работать даже после обновления нового агента. Вы можете перезапустить, когда вы хотите преимущества нового драйвера фильтра, но старый драйвер фильтра продолжает работать, если вы не перезаработаете.
>
> Помимо драйвера фильтра, преимущества любых других улучшений и исправлений в обновлении службы мобильности вступают в силу без необходимости перезагрузки.

## <a name="protection-couldnt-be-enabled-because-the-replica-managed-disk-already-exists-without-expected-tags-in-the-target-resource-group-error-code-150161"></a>Защита не может быть включена, поскольку управляемый репликой диск уже существует, без ожидаемых тегов, в целевой группе ресурсов (код ошибки 150161)

### <a name="possible-cause"></a>Возможная причина

Эта проблема может возникнуть, если виртуальная машина была ранее защищена, и когда репликация была отключена, диск реплики не был очищен.

### <a name="fix-the-problem"></a>Устранение проблемы

Удалите диск реплики, указанный в сообщении об ошибке, и повторно попробуйте неудавленное задание защиты.

## <a name="next-steps"></a>Дальнейшие действия

[Репликация виртуальных машин Azure](site-recovery-replicate-azure-to-azure.md)
