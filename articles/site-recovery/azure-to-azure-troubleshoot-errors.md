---
title: Репликация Azure VM в восстановлении сайта Azure
description: Ошибки при репликации виртуальных машин Azure для аварийного восстановления.
author: rochakm
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 04/07/2020
ms.author: rochakm
ms.openlocfilehash: 0882eaa8b54966c7a804cf78a3928771b238e056
ms.sourcegitcommit: d187fe0143d7dbaf8d775150453bd3c188087411
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80885010"
---
# <a name="troubleshoot-azure-to-azure-vm-replication-errors"></a>Ошибки, связанные с ошибками Azure-to-Azure VM, ошибки репликации VM

В этой статье описывается, как устранить распространенные ошибки в восстановлении сайта Azure во время репликации и восстановления виртуальных машин Azure (VM) из одного региона в другой. Дополнительные сведения о поддерживаемых конфигурациях см. в статье [Azure Site Recovery support matrix for replicating from Azure to Azure](azure-to-azure-support-matrix.md) (Матрица поддержки Azure Site Recovery для репликации виртуальных машин из Azure в Azure).

## <a name="azure-resource-quota-issues-error-code-150097"></a>Проблемы с квотами ресурсов Azure (код ошибки 150097)

Убедитесь, что подписка включена для создания mMs-иносов Azure в целевом регионе, который планируется использовать в регионе аварийного восстановления (DR). Ваша подписка нуждается в достаточной квоте для создания VMs необходимых размеров. По умолчанию восстановление сайта выбирает целевой размер VM, который совпадает с размером исходного VM. Если размер соответствия недоступен, восстановление сайта автоматически выбирает ближайший доступный размер.

Если нет размера, который поддерживает конфигурацию исходного VM, отображается следующее сообщение:

```Output
Replication couldn't be enabled for the virtual machine <VmName>.
```

### <a name="possible-causes"></a>Возможные причины

- Идентификатор подписки не позволяет создавать vMs в месте расположения целевого региона.
- Идентификатор подписки не включен или не имеет достаточной квоты для создания определенных размеров VM в местоположении целевого региона.
- Не найдено подходящего целевого размера VM, сопоставимого с картой сетевого интерфейса (NIC) источника VM (NIC) для идентификатора подписки в месте расположения целевого региона.

### <a name="fix-the-problem"></a>Устранение проблемы

Обратитесь в [службу выставления счетов Azure,](/azure/azure-portal/supportability/resource-manager-core-quotas-request) чтобы включить подписку для создания внушительных размеров в целевом местоположении. Затем повторите неудачную операцию.

Если целевое местоположение имеет ограничение емкости, отогнайте репликацию в этом месте. Затем включите репликацию в другое место, где ваша подписка имеет достаточную квоту для создания вс-ам-м, требуемых размеров.

## <a name="trusted-root-certificates-error-code-151066"></a>Доверенные корневые сертификаты (код ошибки 151066)

Если не все последние доверенные корневые сертификаты присутствуют на VM, ваша работа по репликации для восстановления сайта может выйти из строя. Аутентификация и авторизация вызовов службы восстановления сайта из VM не сбой без этих сертификатов.

Если задание репликации включить не удается, отображается следующее сообщение:

```Output
Site Recovery configuration failed.
```

### <a name="possible-cause"></a>Возможная причина

Доверенные корневые сертификаты, необходимые для авторизации и аутентификации, не присутствуют на виртуальной машине.

### <a name="fix-the-problem"></a>Устранение проблемы

#### <a name="windows"></a>Windows

Для VM под управлением операционной системы Windows установите последние обновления Windows, чтобы все доверенные корневые сертификаты присутствовали на VM. Следите за типичным процессом управления обновлением Windows или обновлениям сертификатов в организации, чтобы получить последние корневые сертификаты и обновленный список отзыва сертификатов на ВМ.

- При работе в отключенной среде следуйте стандартной процедуре обновления Windows в вашей организации, чтобы получить сертификаты.
- Если необходимые сертификаты отсутствуют на виртуальной машине, вызовы к службе Site Recovery завершатся ошибкой по соображениям безопасности.

Чтобы убедиться, что проблема `login.microsoftonline.com` решена, перейдите из браузера в вашем VM.

Для получения дополнительной [информации см.](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn265983(v=ws.11))

#### <a name="linux"></a>Linux

Следуйте рекомендациям, предоставленным дистрибьютором вашей версии операционной системы Linux, чтобы получить последние доверенные корневые сертификаты и последний список отзыва сертификатов на VM.

Поскольку SUSE Linux использует символические ссылки, или симлинки, для поддержания списка сертификатов, выполните следующие действия:

1. Войти в качестве **корневого** пользователя. Символ хэша`#`() — это запрос команды по умолчанию.

1. Чтобы изменить каталог, запустите эту команду:

   `cd /etc/ssl/certs`

1. Проверьте, присутствует ли сертификат Symantec root CA:

   `ls VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem`

   - Если сертификат Root CA Symantec не найден, запустите следующую команду для загрузки файла. Проверьте наличие ошибок и следуйте рекомендуемым действиям на наличие сбоев в сети.

     `wget https://docs.broadcom.com/docs-and-downloads/content/dam/symantec/docs/other-resources/verisign-class-3-public-primary-certification-authority-g5-en.pem -O VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem`

1. Проверьте, присутствует ли сертификат Балтимора root CA:

   `ls Baltimore_CyberTrust_Root.pem`

   - Если сертификат Baltimore root CA не найден, запустите эту команду для загрузки сертификата:

     `wget https://www.digicert.com/CACerts/BaltimoreCyberTrustRoot.crt.pem -O Baltimore_CyberTrust_Root.pem`

1. Проверьте, присутствует ли сертификат DigiCert_Global_Root_CA:

   `ls DigiCert_Global_Root_CA.pem`

    - Если DigiCert_Global_Root_CA не найден, запустите следующие команды для загрузки сертификата:

      ```shell
      wget http://www.digicert.com/CACerts/DigiCertGlobalRootCA.crt

      openssl x509 -in DigiCertGlobalRootCA.crt -inform der -outform pem -out DigiCert_Global_Root_CA.pem
      ```

1. Чтобы обновить хэши темы сертификата для недавно загруженных сертификатов, запустите сценарий перепева:

   `c_rehash`

1. Чтобы проверить, были ли созданы хэши объекта как симлины для сертификатов, запустите эти команды:

   ```shell
   ls -l | grep Baltimore
   ```

   ```Output
   lrwxrwxrwx 1 root root   29 Jan  8 09:48 3ad48a91.0 -> Baltimore_CyberTrust_Root.pem

   -rw-r--r-- 1 root root 1303 Jun  5  2014 Baltimore_CyberTrust_Root.pem
   ```

   ```shell
   ls -l | grep VeriSign_Class_3_Public_Primary_Certification_Authority_G5
   ```

   ```Output
   -rw-r--r-- 1 root root 1774 Jun  5  2014 VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem

   lrwxrwxrwx 1 root root   62 Jan  8 09:48 facacbc6.0 -> VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem
   ```

   ```shell
   ls -l | grep DigiCert_Global_Root
   ```

   ```Output
   lrwxrwxrwx 1 root root   27 Jan  8 09:48 399e7759.0 -> DigiCert_Global_Root_CA.pem

   -rw-r--r-- 1 root root 1380 Jun  5  2014 DigiCert_Global_Root_CA.pem
   ```

1. Создайте копию файла _VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem_ с именем файла _b204d74a.0_:

   `cp VeriSign_Class_3_Public_Primary_Certification_Authority_G5.pem b204d74a.0`

1. Создайте копию файла _Baltimore_CyberTrust_Root.pem_ с именем файла _653b494a.0_:

   `cp Baltimore_CyberTrust_Root.pem 653b494a.0`

1. Создайте копию файла _DigiCert_Global_Root_CA.pem_ с именем файла _3513523f.0_:

   `cp DigiCert_Global_Root_CA.pem 3513523f.0`

1. Убедитесь, что файлы присутствуют:

   ```shell
   ls -l 653b494a.0 b204d74a.0 3513523f.0
   ```

   ```Output
   -rw-r--r-- 1 root root 1774 Jan  8 09:52 3513523f.0

   -rw-r--r-- 1 root root 1303 Jan  8 09:52 653b494a.0

   -rw-r--r-- 1 root root 1774 Jan  8 09:52 b204d74a.0
   ```

## <a name="outbound-connectivity-for-site-recovery-urls-or-ip-ranges-error-code-151037-or-151072"></a>Исходящие подключения для URL-адресов Site Recovery или IP-диапазонов (код ошибки 151037 или 151072)

Для того чтобы репликация восстановления сайта работала, от VM требуется исходящие подключения к определенным URL-адресам. Если виртуальная машина находится за брандмауэром или использует правила группы безопасности сети (NSG) для управления исходящими подключениями, могут возникнуть следующие проблемы. В то время как мы продолжаем поддерживать исходящий доступ через URL-адреса, использование разрешительного списка диапазонов IP больше не поддерживается.

### <a name="issue-1-failed-to-register-azure-virtual-machine-with-site-recovery-151195"></a>Проблема 1. Не удалось зарегистрировать виртуальную машину Azure в Site Recovery (151195)

#### <a name="possible-causes"></a>Возможные причины

- Соединение не может быть установлено в конечных точках восстановления сайта из-за сбоя системы доменных имен (DNS).
- Эта проблема чаще встречается при повторной защите при сбое в виртуальной машине, но dNS-сервер недосягаем из региона аварийного восстановления (DR).

#### <a name="fix-the-problem"></a>Устранение проблемы

Если вы используете пользовательские DNS, убедитесь, что DNS-сервер доступен из области аварийного восстановления.

Чтобы проверить, использует ли VM пользовательскую настройку DNS:

1. Откройте **виртуальные машины** и выберите VM.
1. Перейдите к **настройкам** vMs и выберите **Сеть.**
1. В **виртуальной сети/подсети**выберите ссылку, чтобы открыть страницу ресурсов виртуальной сети.
1. Перейдите к **настройкам** и выберите **DNS-серверы.**

Попробуйте получить доступ к серверу DNS с виртуальной машины. Если DNS-сервер недоступен, сделайте его доступным либо из-за сбоя в сервере DNS, либо создав линию сайта между сетью DR и DNS.

:::image type="content" source="./media/azure-to-azure-troubleshoot-errors/custom_dns.png" alt-text="com-error.":::

### <a name="issue-2-site-recovery-configuration-failed-151196"></a>Проблема 2. Сбой при выполнении настройки Site Recovery (151196)

#### <a name="possible-cause"></a>Возможная причина

Подключение не может быть установлено в точках проверки подлинности Office 365 и идентификационных IP4.

#### <a name="fix-the-problem"></a>Устранение проблемы

Восстановление сайта Azure требует доступа к IP-диапазонам Office 365 для проверки подлинности.
Если вы используете правила Azure Network Security Group (NSG) /прокси-сервер брандмауэра для управления исходящим подключением к сети на VM, убедитесь, что вы используете на основе nG-тега [Службы активного каталога Azure (AAD)](/azure/virtual-network/security-overview#service-tags) для предоставления доступа к AAD. Мы больше не поддерживаем правила NSG на основе IP-адресов.

### <a name="issue-3-site-recovery-configuration-failed-151197"></a>Проблема 3. Сбой при выполнении настройки Site Recovery (151197)

#### <a name="possible-cause"></a>Возможная причина

Подключение не может быть установлено в конечных точках восстановления сайта Azure.

#### <a name="fix-the-problem"></a>Устранение проблемы

Если вы используете правила Azure Network Security Group (NSG) /прокси-сервер брандмауэра для управления испускаемым подключением к сети на VM, убедитесь, что вы используете теги обслуживания. Мы больше не поддерживаем использование разрешаемого списка IP-адресов через НСГ для восстановления сайта Azure.

### <a name="issue-4-azure-to-azure-replication-failed-when-the-network-traffic-goes-through-on-premises-proxy-server-151072"></a>Выпуск 4: Репликация Azure to Azure не сработала, когда сетевой трафик проходит через сервер прокси-сервера (151072)

#### <a name="possible-cause"></a>Возможная причина

Пользовательские настройки прокси являются недействительными, и агент службы мобильности не автоматически выявлял настройки прокси от Internet Explorer (IE).

#### <a name="fix-the-problem"></a>Устранение проблемы

1. Агент службы мобильности обнаруживает настройки прокси-серверов из IE на Windows и `/etc/environment` linux.
1. Если вы предпочитаете устанавливать прокси только для службы Mobility, то вы можете предоставить прокси-данные в _ProxyInfo.conf,_ расположенном по адресу:

   - **Linux**:`/usr/local/InMage/config/`
   - **Windows**:`C:\ProgramData\Microsoft Azure Site Recovery\Config`

1. _ПроксиИнфо.конф_ должен иметь настройки прокси в следующем формате _INI._

   ```plaintext
   [proxy]
   Address=http://1.2.3.4
   Port=567
   ```

> [!NOTE]
> Агент службы мобильности поддерживает только **непроверенные прокси.**

### <a name="more-information"></a>Дополнительные сведения

Чтобы указать [требуемые URL-адреса](azure-to-azure-about-networking.md#outbound-connectivity-for-urls) или [требуемые диапазоны IP,](azure-to-azure-about-networking.md#outbound-connectivity-using-service-tags)следуйте инструкциям [в сети Azure и репликации Azure.](azure-to-azure-about-networking.md)

## <a name="disk-not-found-in-the-machine-error-code-150039"></a>На компьютере не найден диск (код ошибки 150039)

Необходимо инициализировать новый диск, подключенный к виртуальной машине. Если диск не найден, отображается следующее сообщение:

```Output
Azure data disk <DiskName> <DiskURI> with logical unit number <LUN> <LUNValue> was not mapped to a corresponding disk being reported from within the VM that has the same LUN value.
```

### <a name="possible-causes"></a>Возможные причины

- Новый диск данных был прикреплен к VM, но не был инициализирован.
- Диск данных внутри VM не правильно сообщает о логическом значении единицы (LUN), при котором диск был прикреплен к VM.

### <a name="fix-the-problem"></a>Устранение проблемы

Убедитесь, что диски данных инициализированы, а затем повторно попробуйте операцию.

- **Windows**: [Прикрепите и инициализировать новый диск](/azure/virtual-machines/windows/attach-managed-disk-portal).
- **Linux**: [Инициализация нового диска данных в Linux](/azure/virtual-machines/linux/add-disk).

Если проблема не исчезнет, обратитесь в службу поддержки.

## <a name="one-or-more-disks-are-available-for-protection-error-code-153039"></a>Один или несколько дисков доступны для защиты (код ошибки 153039)

### <a name="possible-causes"></a>Возможные причины

- Один или несколько дисков были недавно добавлены в виртуальную машину после защиты.
- Один или несколько дисков были инициализированы после защиты виртуальной машины.

### <a name="fix-the-problem"></a>Устранение проблемы

Чтобы сделать статус репликации VM снова здоровым, вы можете выбрать либо для защиты дисков или отклонить предупреждение.

#### <a name="to-protect-the-disks"></a>Для защиты дисков

1. Перейти к **Replicated Элементы** > _VM имя_ > **диски**.
1. Выберите незащищенный диск, а затем выберите **репликацию Включить:**

   :::image type="content" source="./media/azure-to-azure-troubleshoot-errors/add-disk.png" alt-text="Включить репликацию на vM-дисках.":::

#### <a name="to-dismiss-the-warning"></a>Отклонить предупреждение

1. Перейти к **Replicated пунктов** > _VM имя_.
1. Выберите предупреждение в разделе **Обзор,** а затем выберите **OK**.

   :::image type="content" source="./media/azure-to-azure-troubleshoot-errors/dismiss-warning.png" alt-text="Отключите предупреждение о новом диске.":::

## <a name="remove-the-virtual-machine-from-the-vault-completed-with-information-error-code-150225"></a>Удалите виртуальную машину из хранилища, заполненную информацией (код ошибки 150225)

Когда восстановление сайта защищает виртуальную машину, он создает ссылки на исходную виртуальную машину. При удалении защиты или отключить репликацию восстановление сайта удаляет эти ссылки как часть задания очистки. Если виртуальная машина имеет блокировку ресурса, задание очистки завершается с информацией. Информация говорит, что виртуальная машина была удалена из хранилища служб восстановления, но что некоторые устаревшие ссылки не могут быть очищены на исходной машине.

Вы можете проигнорировать это предупреждение, если вы никогда не собираетесь защитить эту виртуальную машину снова. Но если у вас есть, чтобы защитить эту виртуальную машину позже, следуйте шагам в этом разделе, чтобы очистить ссылки.

> [!WARNING]
> Если вы не сделаете очистку:
>
> - При включении репликации с помощью хранилища служб восстановления виртуальная машина не будет указана.
> - Если вы попытаетесь защитить VM с помощью**виртуальных параметров** >  **машины** > **аварийного восстановления,** операция выйдет из строя с сообщением **Репликация не может быть включена из-за существующих устаревших ссылок ресурсов на VM**.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Восстановление сайта не удаляет исходную виртуальную машину и не влияет на нее каким-либо образом во время выполнения этих шагов.

1. Удалите блокировку из группы ресурсов VM или VM. Например, на следующем изображении блокировка ресурса `MoveDemo` на названном VM должна быть удалена:

   :::image type="content" source="./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png" alt-text="Снимите блокировку с VM.":::

1. Скачать скрипт, чтобы [удалить устаревшую конфигурацию восстановления сайта.](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1)
1. Выполнить сценарий, _Очистка-устаревший-аср-конфигурация-Azure-VM.ps1_. Предоставить **идентификатор подписки,** **группу ресурсов VM**и **имя VM** в качестве параметров.
1. Если вам предложено предоставить учетные данные Azure, предоставьте их. Затем убедитесь, что скрипт работает без каких-либо сбоев.

## <a name="replication-cant-be-enabled-because-of-stale-resource-links-on-the-vm-error-code-150226"></a>Репликация не может быть включена из-за устаревших ссылок ресурсов на VM (код ошибки 150226)

### <a name="possible-causes"></a>Возможные причины

Виртуальная машина имеет устаревшую конфигурацию от предыдущей защиты восстановления сайта.

Несхочная конфигурация может возникнуть на VM Azure, если вы включили репликацию для Azure VM с помощью восстановления сайта, а затем:

- Вы отключили репликацию, но у исходного VM была блокировка ресурса.
- Вы удалили хранилище восстановления сайта без явного отключения репликации на VM.
- Вы удалили группу ресурсов, содержащую хранилище восстановления сайта, без явного отключения репликации на VM.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Восстановление сайта не удаляет исходную виртуальную машину и не влияет на нее каким-либо образом во время выполнения этих шагов.

1. Удалите блокировку из группы ресурсов VM или VM. Например, на следующем изображении блокировка ресурса `MoveDemo` на названном VM должна быть удалена:

   :::image type="content" source="./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png" alt-text="Снимите блокировку с VM.":::

1. Скачать скрипт, чтобы [удалить устаревшую конфигурацию восстановления сайта.](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1)
1. Выполнить сценарий, _Очистка-устаревший-аср-конфигурация-Azure-VM.ps1_. Предоставить **идентификатор подписки,** **группу ресурсов VM**и **имя VM** в качестве параметров.
1. Если вам предложено предоставить учетные данные Azure, предоставьте их. Затем убедитесь, что скрипт работает без каких-либо сбоев.

## <a name="unable-to-see-the-azure-vm-or-resource-group-for-the-selection-in-the-enable-replication-job"></a>Невозможно просмотреть ВМ Azure или группу ресурсов для выбора в задания репликации включить

### <a name="issue-1-the-resource-group-and-source-virtual-machine-are-in-different-locations"></a>Выпуск 1: Группа ресурсов и источник виртуальной машины находятся в разных местах

Восстановление сайта в настоящее время требует, чтобы группа ресурсов региона исходного кода и виртуальные машины были в одном месте. Если это не так, вы не сможете найти виртуальную машину или группу ресурсов, когда вы попытаетесь применить защиту.

В качестве обходного пути можно включить репликацию из VM вместо хранилища служб восстановления. Перейдите в **Source VM** > **Свойства** > **аварийного восстановления** и включить репликацию.

### <a name="issue-2-the-resource-group-isnt-part-of-the-selected-subscription"></a>Выпуск 2: Группа ресурсов не входит в выбранную подписку

Возможно, вы не сможете найти группу ресурсов во время защиты, если группа ресурсов не является частью выбранной подписки. Убедитесь, что группа ресурсов относится к подписке, которую вы используете.

### <a name="issue-3-stale-configuration"></a>Выпуск 3: Устаревая конфигурация

Возможно, вы не увидите VM, который требуется включить для репликации, если в Azure VM существует устаревая конфигурация восстановления сайта. Это условие может возникнуть, если вы включили репликацию для Azure VM с помощью восстановления сайта, а затем:

- Вы удалили хранилище восстановления сайта без явного отключения репликации на VM.
- Вы удалили группу ресурсов, содержащую хранилище восстановления сайта, без явного отключения репликации на VM.
- Вы отключили репликацию, но у исходного VM была блокировка ресурса.

### <a name="fix-the-problem"></a>Устранение проблемы

> [!NOTE]
> Убедитесь в `AzureRM.Resources` том, чтобы обновить модуль перед использованием скрипта, упомянутого в этом разделе. Восстановление сайта не удаляет исходную виртуальную машину и не влияет на нее каким-либо образом во время выполнения этих шагов.

1. Удалите блокировку, если таковой имеется, из группы ресурсов VM или VM. Например, на следующем изображении блокировка ресурса `MoveDemo` на названном VM должна быть удалена:

   :::image type="content" source="./media/site-recovery-azure-to-azure-troubleshoot/vm-locks.png" alt-text="Снимите блокировку с VM.":::

1. Скачать скрипт, чтобы [удалить устаревшую конфигурацию восстановления сайта.](https://github.com/AsrOneSdk/published-scripts/blob/master/Cleanup-Stale-ASR-Config-Azure-VM.ps1)
1. Выполнить сценарий, _Очистка-устаревший-аср-конфигурация-Azure-VM.ps1_. Предоставить **идентификатор подписки,** **группу ресурсов VM**и **имя VM** в качестве параметров.
1. Если вам предложено предоставить учетные данные Azure, предоставьте их. Затем убедитесь, что скрипт работает без каких-либо сбоев.

## <a name="unable-to-select-a-virtual-machine-for-protection"></a>Невозможно выбрать виртуальную машину для защиты

### <a name="possible-cause"></a>Возможная причина

Виртуальная машина имеет расширение, установленное в неисправном или безответном состоянии

### <a name="fix-the-problem"></a>Устранение проблемы

Перейдите к**расширениям настроек** > **виртуальных** **машин** > и проверьте наличие расширений в неисправном состоянии. Удалите любое неудачное расширение, а затем попробуйте снова защитить виртуальную машину.

## <a name="the-vms-provisioning-state-isnt-valid-error-code-150019"></a>Состояние подготовки VM не является действительным (код ошибки 150019)

Для того, чтобы репликация на VM, его состояние подготовки должно быть **успешно выполнено.** Выполните следующие действия, чтобы проверить состояние подготовки:

1. На портале Azure выберите **исследователь ресурсов** из **всех служб.**
1. Разверните список **Подписки** и выберите нужную подписку.
1. Разверните список **ResourceGroups** и выберите группу ресурсов, к которой относится виртуальная машина.
1. Расширьте список **ресурсов** и выберите VM.
1. Проверьте поле **provisioningState** в представлении экземпляра с правой стороны.

### <a name="fix-the-problem"></a>Устранение проблемы

- Если **состояние подготовки** **не удалось,** обратитесь в службу поддержки с подробной информацией для устранения неполадок.
- Если **положение в области подготовки** **обновляется,** может быть развернуто другое расширение. Проверьте, есть ли какие-либо текущие операции на VM, подождите, пока они закончатся, а затем повторно попробуйте неудавшую работу по восстановлению сайта, чтобы включить репликацию.

## <a name="unable-to-select-target-vm-network-selection-tab-is-unavailable"></a>Неудается выбрать целевой VM (вкладка выбора сети недоступна)

### <a name="issue-1-your-vm-is-attached-to-a-network-thats-already-mapped-to-a-target-network"></a>Выпуск 1: Ваш VM подключен к сети, которая уже отображена в целевой сети

Если исходный VM является частью виртуальной сети, а другой VM из той же виртуальной сети уже отображен с сетью в целевой группе ресурсов, окно списка выпадающих сетей по умолчанию недоступно (появляется затемненным).

:::image type="content" source="./media/site-recovery-azure-to-azure-troubleshoot/unabletoselectnw.png" alt-text="Список выбора сети недоступен.":::

### <a name="issue-2-you-previously-protected-the-vm-by-using-site-recovery-and-then-you-disabled-the-replication"></a>Выпуск 2: Вы ранее защищали VM с помощью восстановления сайта, а затем отключили репликацию

Отключение репликации VM не удаляет сетевое отображение. Отображение должно быть удалено из хранилища служб восстановления, где был защищен VM. Перейти к **восстановлению Услуги хранилище** > **инфраструктуры инфраструктуры инфраструктуры** > **отображение инфраструктуры.**

:::image type="content" source="./media/site-recovery-azure-to-azure-troubleshoot/delete_nw_mapping.png" alt-text="Удалить сетевое отображение.":::

Целевая сеть, настроенная во время установки аварийного восстановления, может быть изменена после первоначальной настройки и после защиты VM:

:::image type="content" source="./media/site-recovery-azure-to-azure-troubleshoot/modify_nw_mapping.png" alt-text="Измените сетевое отображение.":::

Изменение картирования сети влияет на все защищенные VMs, которые используют тот же отображение сети.

## <a name="com-or-volume-shadow-copy-service-error-error-code-151025"></a>Ошибка службы копирования теней КОМЗ или объема (код ошибки 151025)

При возникновении этой ошибки отображается следующее сообщение:

```Output
Site Recovery extension failed to install.
```

### <a name="possible-causes"></a>Возможные причины

- Служба применения системы КОМЗ отключена.
- Служба копирования теней тома отключена.

### <a name="fix-the-problem"></a>Устранение проблемы

Установите приложение системы COM' и обслуживание копирования теней объема в автоматический или ручной режим запуска.

1. Откройте консоль Служб в Windows.
1. Убедитесь, что приложение com' System Application и Volume Shadow Copy Service не настроены на **отключение** в качестве **типа запуска.**

   :::image type="content" source="./media/azure-to-azure-troubleshoot-errors/com-error.png" alt-text="Проверьте тип запуска COM плюс системное приложение и обслуживание копирования теней тома.":::

## <a name="unsupported-managed-disk-size-error-code-150172"></a>Неподдерживаемый размер управляемого диска (код ошибки 150172)

При возникновении этой ошибки отображается следующее сообщение:

```Output
Protection couldn't be enabled for the virtual machine as it has <DiskName> with size <DiskSize> that is lesser than the minimum supported size 1024 MB.
```

### <a name="possible-cause"></a>Возможная причина

Диск меньше поддерживаемого размера 1024 МБ.

### <a name="fix-the-problem"></a>Устранение проблемы

Убедитесь, что размер диска находится в пределах поддерживаемого диапазона размеров, а затем повторить операцию.

## <a name="protection-wasnt-enabled-because-the-grub-configuration-includes-the-device-name-instead-of-the-uuid-error-code-151126"></a>Защита не была включена, поскольку конфигурация GRUB включает имя устройства вместо UUID (код ошибки 151126)

### <a name="possible-causes"></a>Возможные причины

Linux Grand Unified Bootloader (GRUB) файлы конфигурации (_/boot/grub/menu.lst_, _/boot/grub/grub.cfg,_ _/boot/grub2/grub.cfg_, или _/etc/default/grub)_ могут указать фактические названия устройств вместо универсально уникальных идентификаторов (UUID) значений `root` для и `resume` параметров. Восстановление сайта требует UUID, поскольку имена устройств могут меняться. При перезагрузке VM может не придумать одно и то же имя при неудачном перезапуске, что приведет к проблемам.

Ниже приведены строки из файлов GRUB, где вместо требуемых UUID появляются имена устройств:

- Файл _/загрузка/grub2/grub.cfg_:

  `linux /boot/vmlinuz-3.12.49-11-default root=/dev/sda2  ${extra_cmdline} resume=/dev/sda1 splash=silent quiet showopts`

- Файл: _/boot/grub/menu.lst_

  `kernel /boot/vmlinuz-3.0.101-63-default root=/dev/sda2 resume=/dev/sda1 splash=silent crashkernel=256M-:128M showopts vga=0x314`

### <a name="fix-the-problem"></a>Устранение проблемы

Замените каждое имя устройства соответствующим UUID:

1. Найдите UUID устройства, выдав команду. `blkid <device name>` Пример:

   ```shell
   blkid /dev/sda1
   /dev/sda1: UUID="6f614b44-433b-431b-9ca1-4dd2f6f74f6b" TYPE="swap"
   blkid /dev/sda2
   /dev/sda2: UUID="62927e85-f7ba-40bc-9993-cc1feeb191e4" TYPE="ext3"
   ```

1. Замените название устройства на UUID, `root=UUID=<UUID>` в `resume=UUID=<UUID>`форматах и . Например, после замены строка от _/boot/grub/menu.lst_ будет выглядеть следующим образом:

   `kernel /boot/vmlinuz-3.0.101-63-default root=UUID=62927e85-f7ba-40bc-9993-cc1feeb191e4 resume=UUID=6f614b44-433b-431b-9ca1-4dd2f6f74f6b splash=silent crashkernel=256M-:128M showopts vga=0x314`

1. Повторите защиту.

## <a name="enable-protection-failed-because-the-device-mentioned-in-the-grub-configuration-doesnt-exist-error-code-151124"></a>Защита включить не удалось, потому что устройство, упомянутое в конфигурации GRUB не существует (код ошибки 151124)

### <a name="possible-cause"></a>Возможная причина

Файлы конфигурации GRUB (_/boot/grub/menu.lst_, _/boot/grub/grub.cfg_, _/boot/grub2/grub.cfg,_ или _/etc/default/grub)_ могут содержать параметры `rd.lvm.lv` или `rd_LVM_LV`. Эти параметры определяют устройства Logical Volume Manager (LVM), которые должны быть обнаружены во время загрузки. Если эти устройства LVM не существуют, защищенная система сама по себе не будет загружаться и будет застряла в процессе загрузки. Та же проблема будет также рассматриваться с failover VM. Рассмотрим несколько примеров.

- Файл: _/boot/grub2/grub.cfg_ на RHEL7:

  `linux16 /vmlinuz-3.10.0-957.el7.x86_64 root=/dev/mapper/rhel_mup--rhel7u6-root ro crashkernel=128M\@64M rd.lvm.lv=rootvg/root rd.lvm.lv=rootvg/swap rhgb quiet LANG=en_US.UTF-8`

- Файл: _/etc/default/grub_ на RHEL7:

  `GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=rootvg/root rd.lvm.lv=rootvg/swap rhgb quiet`

- Файл: _/boot/grub/menu.lst_ на RHEL6:

  `kernel /vmlinuz-2.6.32-754.el6.x86_64 ro root=UUID=36dd8b45-e90d-40d6-81ac-ad0d0725d69e rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto rd_LVM_LV=rootvg/lv_root  KEYBOARDTYPE=pc KEYTABLE=us rd_LVM_LV=rootvg/lv_swap rd_NO_DM rhgb quiet`

В каждом примере GRUB должен обнаружить два `root` `swap` устройства LVM `rootvg`с именами и из группы громкости.

### <a name="fix-the-problem"></a>Устранение проблемы

Если устройство LVM не существует, либо создайте его, либо удалите соответствующие параметры из файлов конфигурации GRUB. Затем повторите попытку обеспечить защиту.

## <a name="a-site-recovery-mobility-service-update-finished-with-warnings-error-code-151083"></a>Обновление службы восстановления мобильности сайта завершено с предупреждениями (код ошибки 151083)

Служба восстановления сайта имеет много компонентов, один из которых называется драйвером фильтра. Драйвер фильтра загружается в системную память только во время перезагрузки системы. Всякий раз, когда обновление службы Mobility включает изменения драйвера фильтра, машина обновляется, но вы все еще видите предупреждение о том, что некоторые исправления требуют перезагрузки. Предупреждение появляется потому, что исправления драйвера фильтра могут всменяться только при загрузке нового драйвера фильтра, что происходит только во время перезагрузки.

> [!NOTE]
> Это всего лишь предупреждение. Существующая репликация продолжает работать даже после обновления нового агента. Вы можете перезапустить, когда вы хотите преимущества нового драйвера фильтра, но старый драйвер фильтра продолжает работать, если вы не перезаработаете.
>
> Помимо драйвера фильтра, преимущества любых других улучшений и исправлений в обновлении службы мобильности вступают в силу без необходимости перезагрузки.

## <a name="protection-couldnt-be-enabled-because-the-replica-managed-disk-already-exists-without-expected-tags-in-the-target-resource-group-error-code-150161"></a>Защита не может быть включена, поскольку управляемый репликой диск уже существует, без ожидаемых тегов, в целевой группе ресурсов (код ошибки 150161)

### <a name="possible-cause"></a>Возможная причина

Эта проблема может возникнуть, если виртуальная машина была ранее защищена, и когда репликация была отключена, диск реплики не был удален.

### <a name="fix-the-problem"></a>Устранение проблемы

Удалите диск реплики, указанный в сообщении об ошибке, и повторно попробуйте неудавленное задание защиты.

## <a name="next-steps"></a>Дальнейшие действия

[ТиражAzр VM в другой регион Azure](azure-to-azure-how-to-enable-replication.md)
