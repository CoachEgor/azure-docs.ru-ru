---
title: Перенос виртуальных машин IaaS Azure в другой регион Azure с помощью службы Azure Site Recovery | Документация Майкрософт
description: Используйте службу Azure Site Recovery для переноса виртуальных машин IaaS Azure из одного региона Azure в другой.
services: site-recovery
author: rajani-janaki-ram
ms.service: site-recovery
ms.topic: tutorial
ms.date: 01/28/2019
ms.author: rajanaki
ms.custom: MVC
ms.openlocfilehash: 0d446be664d695af946d46abc48389d4f7be92cd
ms.sourcegitcommit: 36c50860e75d86f0d0e2be9e3213ffa9a06f4150
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2019
ms.locfileid: "65791039"
---
# <a name="move-azure-vms-to-another-region"></a>Перенос виртуальных машин Azure в другой регион

Существуют разные причины, по которым может потребоваться перенос существующих виртуальных машин Azure IaaS из одного региона в другой. Например, вы захотите повысить надежность и доступность существующих виртуальных машин, оптимизировать управление ими или соблюсти дополнительные требования к системе управления. Дополнительные сведения см. в статье с [общими сведениями о переносе виртуальных машин Azure](azure-to-azure-move-overview.md). 

Службу [Azure Site Recovery](site-recovery-overview.md) можно использовать для управления и координации аварийного восстановления локальных компьютеров и виртуальных машин Azure в составе системы непрерывности бизнес-процессов и аварийного восстановления (BCDR). Также Site Recovery можно применить для управления переносом виртуальных машин Azure в дополнительный регион.

Изучив данный учебник, вы научитесь:

> [!div class="checklist"]
> 
> * проверять предварительные требования для переноса;
> * подготавливать исходные виртуальные машины и целевой регион;
> * копировать данные и включать репликацию;
> * проверять конфигурацию и выполнять перемещение;
> * удалять ресурсы в исходном регионе.
> 
> [!NOTE]
> В этом руководстве показано, как выполнить перенос виртуальных машин Azure из одного региона в другой без дополнительных изменений. Если вы намерены повысить уровень доступности, переместив виртуальные машины из группы доступности в прикрепленные к зонам виртуальные машины в другом регионе, воспользуйтесь [этим учебником](move-azure-vms-avset-azone.md).

## <a name="prerequisites"></a>Предварительные требования

- Убедитесь, что виртуальные машины действительно расположены в том регионе Azure, из которого вы намерены их перенести.
- Проверьте, поддерживается ли выбранная [комбинация исходного и целевого региона](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-support-matrix#region-support), и примите взвешенное решение о целевом регионе.
- Вам должны быть понятны [архитектура и компоненты сценария](azure-to-azure-architecture.md).
- Просмотрите [ограничения и требования для поддержки](azure-to-azure-support-matrix.md).
- Проверьте разрешения для учетной записи. Если вы создали бесплатную учетную запись Azure, вы являетесь администратором этой подписки. Если вы не администратор подписки, свяжитесь с администратором, чтобы получить необходимые разрешения. Чтобы включить репликацию для виртуальной машины и позднее скопировать данные с помощью Azure Site Recovery, необходимо следующее.

    * Разрешения на создание виртуальной машины в ресурсах Azure. Встроенная роль "Участник виртуальных машин" обладает такими разрешениями, а именно:
        - разрешение на создание виртуальной машины в выбранной группе ресурсов;
        - разрешение на создание виртуальной машины в выбранной виртуальной сети;
        - разрешение на запись в выбранной учетной записи хранения.

    * Разрешения на управление операциями Azure Site Recovery. Роль "Участник Site Recovery" имеет все разрешения, необходимые для управления операциями Site Recovery в хранилище служб восстановления.

## <a name="prepare-the-source-vms"></a>Подготовка исходных виртуальных машин

1. Убедитесь, что на виртуальных машинах Azure, которые вы решили перенести, установлены все действующие корневые сертификаты. Если корневые сертификаты отсутствуют на виртуальной машине, ограничения безопасности заблокируют копирование данных в целевой регион.

    - При использовании виртуальных машин Windows установите на виртуальной машине все последние обновления Windows, чтобы гарантировать присутствие всех доверенных корневых сертификатов. При работе в отключенной среде следуйте стандартным процедурам обновления Windows и сертификатам в вашей организации.
    - На виртуальных машинах Linux выполните инструкции, предоставленные распространителем Linux, чтобы установить все свежие доверенные корневые сертификаты и список отзыва сертификатов.
1. Убедитесь, что для управления подключением к сети для виртуальных машин, которые вы хотите перенести, не используется прокси-сервер аутентификации.
1. Если виртуальная машина, которую вы пытаетесь переместить, не имеет доступа к Интернету и (или) использует прокси-сервер брандмауэра для управления исходящим доступом, проверьте [соответствующие требования](azure-to-azure-tutorial-enable-replication.md#set-up-outbound-network-connectivity-for-vms).
1. Определите структуру сети в исходном регионе и все ресурсы, которые вы сейчас используете. Сюда могут входить, среди прочего, подсистемы балансировки нагрузки, группы безопасности сети и общедоступные IP-адреса.

## <a name="prepare-the-target-region"></a>Подготовка целевого региона

1. Убедитесь, что используемая подписка Azure позволяет создавать виртуальные машины в целевом регионе, который настроен для аварийного восстановления. Свяжитесь со службой поддержки, чтобы включить необходимые квоты.

1. Убедитесь, что подписка располагает достаточными ресурсами для поддержки виртуальных машин тех же размеров, которые установлены для исходных виртуальных машин. Если для копирования данных в целевой объект вы используете Site Recovery, эта служба выберет для целевой виртуальной машины такой же размер или наиболее близкий к нему.

1. Убедитесь, что вы создали в целевом регионе аналог каждого компонента, который вы обнаружили ранее в структуре сети исходного региона. Это важно для того, чтобы после перехода в целевой регион виртуальные машины сохранили все функции и возможности виртуальных машин в исходном регионе.

    > [!NOTE]
    > При включении репликации для исходной виртуальной машины служба Azure Site Recovery автоматически обнаруживает и создает виртуальную сеть. Можно также предварительно создать сеть и назначить ее на виртуальную машину в рамках процесса включения репликации. Любые другие ресурсы необходимо создать в целевом регионе вручную, как будет описано далее.

     Сведения о создании наиболее часто используемых сетевых ресурсов на основе конфигурации исходной виртуальной машины см. в следующих документах.

   - [Группы безопасности сети](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)
   - [Подсистемы балансировки нагрузки](https://docs.microsoft.com/azure/load-balancer/#step-by-step-tutorials)
   - [Общедоступный IP-адрес](../virtual-network/virtual-network-public-ip-address.md)
    
     Сведения о других сетевых компонентах см. в [документации по сетям](https://docs.microsoft.com/azure/#pivot=products&panel=network).

1. Вручную [создайте непроизводственную сеть](https://docs.microsoft.com/azure/virtual-network/quick-create-portal) в целевом регионе, если вы хотите проверить конфигурацию перед окончательным переходом в целевой регион. Мы рекомендуем не пропускать этот шаг, так как он позволит минимизировать влияние на рабочую сеть.

## <a name="copy-data-to-the-target-region"></a>Копирование данных в целевой регион
Использование Azure Site Recovery для копирования данных в целевой регион, описано в действиях, приведенных далее.

### <a name="create-the-vault-in-any-region-except-the-source-region"></a>Создайте хранилище в любом регионе, за исключением исходного.

1. Войдите на [портал Azure](https://portal.azure.com) > **Службы восстановления**.
1. Выберите **Создать ресурс** > **Средства управления** > **Backup and Site Recovery**.
1. В поле **Имя** укажите понятное имя **ContosoVMVault**. Если у вас есть несколько подписок, выберите нужную.
1. Создайте группу ресурсов **ContosoRG**.
1. Укажите регион Azure. Сведения о поддерживаемых регионах см. в разделе "Географическая доступность" на странице [цен на службу Azure Site Recovery](https://azure.microsoft.com/pricing/details/site-recovery/).
1. Для **хранилища Служб восстановления** выберите действие **Обзор** > **ConsotoVMVault** > **+Реплицировать**.
1. В поле **Источник** выберите **Azure**.
1. В поле **Исходное расположение** выберите исходный регион Azure, в котором сейчас запущены виртуальные машины.
1. Выберите модель развертывания Resource Manager. Затем выберите настройку **Исходная подписка** и **Исходная группа ресурсов**.
1. Нажмите кнопку **ОК**, чтобы сохранить настройки.

### <a name="enable-replication-for-azure-vms-and-start-copying-the-data"></a>Включение репликации для виртуальных машин Azure и начало копирования данных

Site Recovery получает список виртуальных машин, связанных с подпиской и группой ресурсов.

1. На следующем шаге выберите виртуальную машину, которую вы намерены переместить, и щелкните **OK**.
1. В разделе **Параметры** выберите **Аварийное восстановление**.
1. В разделе **Настройка аварийного восстановления** > **Целевой регион** выберите целевой регион, в который будет выполняться репликация.
1. Для работы с этим руководством примите остальные значения по умолчанию.
1. Выберите **Включить репликацию**. Это действие запускает задание для включения репликации виртуальной машины.

    ![Включение репликации](media/tutorial-migrate-azure-to-azure/settings.png)

## <a name="test-the-configuration"></a>Тестирование конфигурации

1. Перейдите в хранилище. В разделе **Параметры** > **Реплицированные элементы** выберите виртуальную машину, которую необходимо переместить в целевой регион, и выберите действие **+Тестовая отработка отказа**.
1. На странице **Тестовая отработка отказа** выберите точку восстановления.

   - **Последняя обработанная**. Отработка отказа выполняется до последней точки восстановления виртуальной машины, которая была обработана службой Site Recovery. Для нее отображается метка времени. Этот вариант не требует времени на обработку данных, обеспечивая низкий показатель целевого времени восстановления.
   - **Последняя с согласованием приложений**. Отработка отказа всех виртуальных машин выполняется до последней точки восстановления с согласованным состоянием приложений. Для нее отображается метка времени.
   - **Настраиваемая**. Вы можете выбрать любую точку восстановления.

1. Чтобы проверить конфигурацию, выберите целевую виртуальную сеть Azure, в которую вы хотите переместить виртуальные машины Azure.
    > [!IMPORTANT]
    > Мы рекомендуем использовать для тестовой отработки отказа отдельную сеть виртуальных машин Azure. Не используйте для этого рабочую сеть, которая была настроена при включении репликации, то есть в которую вы намерены переместить виртуальные машины.
1. Чтобы начать тестирование, щелкните **ОК**. За ходом выполнения можно следить в окне свойств, которое можно открыть, щелкнув виртуальную машину. Также можно щелкнуть задание **Тестовая отработка отказа** в разделе "Имя хранилища" > **Параметры** > **Задания** > **Задания Site Recovery**.
1. Когда отработка отказа завершится, на вкладке **Виртуальные машины** портала Azure появится реплика виртуальной машины. Убедитесь, что виртуальная машина работает, имеет правильный размер и подключена к нужной сети.
1. Если вы хотите удалить виртуальную машину, которую создали для тестирования переноса, щелкните **Очистить тестовую отработку отказа** для реплицированного элемента. В разделе **Примечания** можно записать и сохранить сведения о тестировании.

## <a name="perform-the-move-to-the-target-region-and-confirm"></a>Выполнение и подтверждение переноса в целевой регион

1. Перейдите в хранилище. Щелкните **Параметры** > **Реплицированные элементы**, а затем выберите действие **Отработка отказа**.
1. В области **Отработка отказа**выберите **Последнее**.
1. Выберите **Завершение работы виртуальной машины перед началом отработки отказа**. Site Recovery попытается выключить исходную виртуальную машину перед запуском отработки отказа. Отработка отказа продолжится, даже если их не удастся отключить. На странице **Задания** можно следить за ходом выполнения отработки отказа.
1. Когда задание будет завершено, проверьте, отображается ли виртуальная машина в целевом регионе Azure, как и ожидалось.
1. В разделе **Реплицированные элементы** щелкните виртуальную машину правой кнопкой мыши и выберите **Зафиксировать**. Это действие завершает перенос в целевой регион. Дождитесь, пока завершится задание фиксации.

## <a name="delete-the-resource-in-the-source-region"></a>Удаление ресурса в исходном регионе

Перейдите к виртуальной машине. Щелкните **Отключить репликацию**. Это действие остановит процесс копирования данных для выбранной виртуальной машины.

> [!IMPORTANT]
> Это очень важный шаг, который избавляет от лишних расходов на репликацию Azure Site Recovery.

Если вы не планируете далее использовать исходные ресурсы, выполните следующие шаги.

1. Удалите в исходном регионе все сетевые ресурсы, которые вы идентифицировали на шаге 4 в разделе [Подготовка исходных виртуальных машин](#prepare-the-source-vms).
1. Удалите соответствующую учетную запись хранения в исходном регионе.

## <a name="next-steps"></a>Дополнительная информация

В этом руководстве вы перенесли виртуальную машину Azure в другой регион Azure. Теперь можно настроить аварийное восстановление для перенесенной виртуальной машины.

> [!div class="nextstepaction"]
> [Настройка аварийного восстановления после миграции](azure-to-azure-quickstart.md)

