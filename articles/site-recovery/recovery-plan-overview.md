---
title: Использование планов восстановления для аварийного восстановления с помощью Azure Site Recovery | Документация Майкрософт
description: Сведения об использвоании планов восстановления для аварийного восстановления с помощью службы Azure Site Recovery.
author: rayne-wiselman
manager: carmonm
services: site-recovery
ms.service: site-recovery
ms.topic: article
ms.date: 05/30/2019
ms.author: raynew
ms.openlocfilehash: 0df9e4b41ff89dd295fe644900b78640a083e985
ms.sourcegitcommit: 6cb4dd784dd5a6c72edaff56cf6bcdcd8c579ee7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2019
ms.locfileid: "67514569"
---
# <a name="about-recovery-plans"></a>Сведения о планах восстановления

В этой статье описываются планы восстановления [Azure Site Recovery](site-recovery-overview.md).

План восстановления позволяет объединять компьютеры в группы восстановления. План можно настроить, добавив в него порядок, инструкции и задачи. После определения плана с помощью можно выполнить отработку отказа.  Компьютеры можно ссылаться в нескольких планах восстановления, в котором последующие планы пропустит развертывания и запуска компьютера, если она была ранее развернута с помощью другого плана восстановления.


## <a name="why-use-a-recovery-plan"></a>Для чего используется план восстановления?

План восстановления помогает определить систематический процесс восстановления путем создания небольших независимых модулей, для которых можно выполнять отработку отказа. Как правило, модуль представляет приложение в вашей среде. План восстановления определяет, как выполняется отработка отказа компьютеров, а также последовательность их запуска после этого. Планы восстановления используются для следующего:

* Моделирование приложения с точки зрения его зависимостей.
* Автоматизация задач восстановления для уменьшения RTO.
* Проверка готовности к миграции или аварийному восстановлению путем добавления приложений в план восстановления.
* Выполнение тестовой отработки отказа для планов восстановления, чтобы убедиться, что аварийное восстановление или миграция выполняется надлежащим образом.


## <a name="model-apps"></a>Моделирование приложений

Можно запланировать и создать группу восстановления для записи свойств приложений. Например, рассмотрим типичное трехуровневое приложение, содержащее серверную часть SQL Server, ПО промежуточного слоя и веб-интерфейс. Как правило, план восстановления настраивается таким образом, чтобы после отработки отказа компьютеры на каждом уровне запускались в правильном порядке.

- Сначала должна быть запущена серверная часть SQL, затем — ПО промежуточного слоя и, наконец, веб-интерфейс.
- Этот порядок запуска гарантирует, что к моменту запуска последнего компьютера приложение будет работать.
- Этот порядок гарантирует, что когда ПО промежуточного слоя запустится и попытается подключиться к уровню SQL Server, этот уровень уже будет работать. 
- Данный порядок запуска также гарантирует, что интерфейсный сервер запустится в последнюю очередь и пользователи не подключатся к URL-адресу приложения, пока все компоненты не будут запущены, а приложение — готово к приему запросов.

Чтобы создать этот порядок, добавьте группы в группу восстановления и добавьте компьютеры в эти группы.
- Если порядок задан, используется последовательная обработка. Действия выполняются параллельно, где это возможно, для улучшения RTO восстановления приложений.
- Отработка отказа компьютеров, которые входят в одну группу, выполняется в параллельном режиме.
- Отработка отказа компьютеров в разных группах выполняется в порядке групп. Это значит, что отработка отказа компьютеров в группе 2 начинается только после завершения отработки отказа и запуска всех компьютеров в группе 1.

    ![Пример плана восстановления](./media/recovery-plan-overview/rp.png)

При внесении приведенных изменений в параметры при выполнении отработки отказа для плана восстановления происходит следующее. 

1. Сначала выполняется шаг завершения работы, на котором осуществляется попытка отключить локальные компьютеры. Исключением является тестовая отработка отказа. В этом случае основной сайт продолжает работать. 
2. Завершение работы инициирует параллельную отработку отказа всех виртуальных машин в плане восстановления.
3. При отработке отказа с помощью реплицированных данных подготавливаются диски виртуальных машин.
4. В указанном порядке выполняются группы запуска и запускаются виртуальные машины в каждой группе. Сначала запускается группа 1, затем группа 2 и, наконец, группа 3. Если в какой-либо группе имеется более одного компьютера, то все они запускаются параллельно.


## <a name="automate-tasks"></a>Автоматизация задач

Восстановление больших приложений может быть сложной задачей. Выполнение действий вручную подвергают процесс ошибкам, и пользователь, выполняющий отработку отказа, может быть не осведомлен обо всех особенностях приложений. Можно использовать план восстановления для упорядочения и автоматизации действий, необходимых на каждом шаге, применяя модули runbook службы автоматизации Azure для отработки отказа в Azure. Можно также использовать сценарии. Для выполнения задач, которые невозможно автоматизировать, планы восстановления обеспечивают возможность вставки пауз для действий, выполняемых вручную. Существует несколько типов задач, которые можно настроить.

* **Задачи, выполняемые с виртуальной машиной Azure после отработки отказа**. При отработке отказа в Azure обычно требуется выполнить ряд действий, чтобы обеспечить подключение к виртуальной машине после отработки отказа. Пример: 
    * создание общедоступного IP-адреса для виртуальной машины Azure;
    * назначение группы безопасности сети сетевому адаптеру виртуальной машины Azure;
    * добавление подсистемы балансировки нагрузки в группу доступности.
* **Задачи в виртуальной машине после отработки отказа**. Как правило, они нужны для перенастройки приложения, которое запущено на виртуальной машине, таким образом, чтобы приложение работало в новой среде. Пример:
    * изменение строки подключения к базе данных в компьютере;
    * изменение конфигурации или правил веб-сервера.


## <a name="test-failover"></a>Тестовая отработка отказа

План восстановления можно использовать для активации тестовой отработки отказа. Используйте приведенные ниже рекомендации.

- Всегда выполняйте тестовую отработку отказа для приложения, прежде чем выполнять полную отработку отказа. Тестовая отработка отказа помогает проверить, запустится ли приложение на сайте восстановления.
- Если обнаружится, что вы что-либо забыли, активируйте очистку и повторите тестовую отработку отказа. 
- Несколько раз выполните тестовую отработку отказа, пока не будете уверены в надежном восстановлении приложения.
- Так как все приложения уникальны, необходимо создать планы восстановления, подходящие для каждого из них, и выполнить тестовую отработку отказа для этих планов.
- Приложения и их зависимости часто изменяются. Чтобы обеспечить актуальность планов восстановления, запускайте тестовую отработку отказа для каждого приложения раз в квартал.

    ![Снимок экрана примера тестового плана восстановления в Site Recovery](./media/recovery-plan-overview/rptest.png)

## <a name="watch-the-video"></a>Просмотрите видео

Просмотрите краткий пример видео, демонстрирующее при отработке отказа на щелчком для 2 уровневого приложения WordPress.
    
> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/One-click-failover-of-a-2-tier-WordPress-application-using-Azure-Site-Recovery/player]



## <a name="next-steps"></a>Дальнейшие действия

- [Создайте](site-recovery-create-recovery-plans.md) план восстановления.
- Узнайте больше о [выполнении отработки отказа](site-recovery-failover.md).  
