---
title: Автоматическое обновление службы Mobility Service в Azure Site Recovery
description: Общие сведения об автоматическом обновлении службы Mobility Service при репликации виртуальных машин Azure с помощью Azure Site Recovery.
services: site-recovery
author: rajani-janaki-ram
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 04/02/2020
ms.author: rajanaki
ms.openlocfilehash: b57ce89979225015dc87bbfb17f9603897ef6d6b
ms.sourcegitcommit: e995f770a0182a93c4e664e60c025e5ba66d6a45
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2020
ms.locfileid: "86135839"
---
# <a name="automatic-update-of-the-mobility-service-in-azure-to-azure-replication"></a>Автоматическое обновление службы Mobility Service в репликации Azure в Azure

Azure Site Recovery использует ежемесячную частоту выпуска для устранения любых проблем и улучшения существующих функций или добавления новых. Для поддержания актуальности службы необходимо планировать развертывание исправлений каждый месяц. Чтобы избежать издержек, связанных с каждым обновлением, можно разрешить Site Recovery управлять обновлениями компонентов.

Как упоминалось в [архитектуре аварийного восстановления Azure в Azure](azure-to-azure-architecture.md), служба Mobility Service устанавливается на всех виртуальных машинах Azure, для которых включена репликация из одного региона Azure в другой. При использовании автоматического обновления каждый новый выпуск обновляет расширение службы Mobility Service.

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="how-automatic-updates-work"></a>Как работают автоматические обновления

При использовании Site Recovery для управления обновлениями он развертывает глобальный модуль Runbook (используемый службами Azure) через учетную запись службы автоматизации, созданную в той же подписке, что и хранилище. В каждом хранилище используется одна учетная запись службы автоматизации. Для каждой виртуальной машины в хранилище модуль Runbook проверяет наличие активных АвтоОбновлений. Если доступна более новая версия расширения службы Mobility Service, то обновление устанавливается.

Расписание Runbook по умолчанию выполняется ежедневно в 12:00 часового пояса в регионе реплицированной виртуальной машины. Вы также можете изменить расписание Runbook с помощью учетной записи службы автоматизации.

> [!NOTE]
> Начиная с [накопительного пакета обновления 35](site-recovery-whats-new.md#updates-march-2019), можно выбрать существующую учетную запись службы автоматизации для использования при обновлениях. Перед обновлением накопительного пакета обновления 35 по умолчанию Site Recovery создала учетная запись службы автоматизации. Этот параметр можно выбрать только при включении репликации для виртуальной машины. Она недоступна для виртуальной машины, для которой уже включена репликация. Выбранный параметр применяется ко всем виртуальным машинам Azure, защищенным в одном хранилище.

Включение автоматического обновления не требует перезапуска виртуальных машин Azure или повлияет на текущую репликацию.

Выставление счетов за задание в учетной записи службы автоматизации зависит от количества минут выполнения заданий, использованных в месяц. Каждый день выполнение задания занимает несколько секунд и рассматривается как свободные единицы. По умолчанию 500 минут включается в качестве свободных единиц для учетной записи службы автоматизации, как показано в следующей таблице.

| Количество свободных единиц (каждый месяц) | Price |
|---|---|
| Время выполнения задания 500 минут | ₹ 0.14/мин

## <a name="enable-automatic-updates"></a>Включение автоматических обновлений

Существует несколько способов управления обновлениями расширений Site Recovery.

- [Управление в рамках шага включения репликации](#manage-as-part-of-the-enable-replication-step)
- [Переключение параметров обновления для расширения внутри хранилища](#toggle-the-extension-update-settings-inside-the-vault)
- [Управление обновлениями вручную](#manage-updates-manually)

### <a name="manage-as-part-of-the-enable-replication-step"></a>Управление в рамках шага включения репликации

При включении репликации для виртуальной машины либо из [представления виртуальной машины](azure-to-azure-quickstart.md) , либо [из хранилища служб восстановления](azure-to-azure-how-to-enable-replication.md)можно либо разрешить Site Recovery управлять обновлениями для расширения Site Recovery, либо управлять им вручную.

:::image type="content" source="./media/azure-to-azure-autoupdate/enable-rep.png" alt-text="Параметры расширения":::

### <a name="toggle-the-extension-update-settings-inside-the-vault"></a>Переключение параметров обновления для расширения внутри хранилища

1. В хранилище служб восстановления перейдите к разделу **Управление**  >  **инфраструктурой Site Recovery**.
1. В разделе **для**  >  **параметров обновления расширения**виртуальных машин Azure  >  **Разрешить Site Recovery управлять**, выберите **вкл**.

   Чтобы вручную управлять расширением, установите флажок **выкл**.

1. Щелкните **Сохранить**.

:::image type="content" source="./media/azure-to-azure-autoupdate/vault-toggle.png" alt-text="Параметры обновления расширения":::

> [!IMPORTANT]
> При выборе параметра **разрешить Site Recovery для управления**этот параметр применяется ко всем виртуальным машинам в хранилище.

> [!NOTE]
> Любой параметр уведомляет вас об учетной записи службы автоматизации, используемой для управления обновлениями. Если вы используете эту функцию в хранилище впервые, по умолчанию создается новая учетная запись службы автоматизации. Кроме того, можно настроить параметр и выбрать существующую учетную запись службы автоматизации. При каждом последующем включении репликации в том же хранилище будет использоваться ранее созданная учетная запись службы автоматизации. В настоящее время в раскрывающемся меню будут перечислены учетные записи службы автоматизации, которые находятся в той же группе ресурсов, что и хранилище.

### <a name="manage-updates-manually"></a>Управление обновлениями вручную

1. Если на виртуальных машинах установлены новые обновления для службы Mobility Service, вы увидите следующее уведомление: **новое Site Recovery доступно обновление агента репликации. Щелкните, чтобы установить.**

   :::image type="content" source="./media/vmware-azure-install-mobility-service/replicated-item-notif.png" alt-text="Окно "Реплицированные элементы"":::

1. Выберите уведомление, чтобы открыть страницу выбора виртуальной машины.
1. Выберите виртуальные машины, которые требуется обновить, и нажмите кнопку **ОК**. Служба обновления Mobility Service будет запущена для каждой выбранной виртуальной машины.

   :::image type="content" source="./media/vmware-azure-install-mobility-service/update-okpng.png" alt-text="Список виртуальных машин "Реплицированные элементы"":::

## <a name="common-issues-and-troubleshooting"></a>Распространенные проблемы и устранение неполадок

Если возникла проблема с автоматическими обновлениями, вы увидите уведомление об ошибке в разделе **проблемы конфигурации** на панели мониторинга хранилища.

Если вы не можете включить автоматическое обновление, ознакомьтесь со следующими распространенными ошибками и рекомендуемыми действиями.

- **Ошибка**: у вас нет разрешений на создание учетной записи запуска от имени Azure (субъекта-службы) и предоставление субъекту-службе роли участника.

  **Рекомендуемое действие**: Убедитесь, что учетная запись для входа назначена как участник, и повторите попытку. Дополнительные сведения о назначении разрешений см. в разделе "необходимые разрешения" статьи [как использовать портал для создания приложения Azure AD и субъекта-службы, которые имеют доступ к ресурсам](../active-directory/develop/howto-create-service-principal-portal.md#permissions-required-for-registering-an-app).

  Чтобы устранить большинство проблем после включения автоматического обновления, выберите **восстановить**. Если кнопка восстановить недоступна, см. сообщение об ошибке, отображаемое в области Параметры обновления расширений.

  :::image type="content" source="./media/azure-to-azure-autoupdate/repair.png" alt-text="Кнопка восстановления службы Site Recovery в параметрах обновления расширения":::

- **Ошибка**: учетная запись запуска от имени не имеет разрешения на доступ к ресурсу служб восстановления.

  **Рекомендуемое действие**: удалите и [повторно создайте учетную запись запуска от имени](../automation/manage-runas-account.md). Или убедитесь, что Azure Active Directory приложение учетной записи запуска от имени службы автоматизации может получить доступ к ресурсу служб восстановления.

- **Ошибка**: учетная запись запуска от имени не найдена. Не был создан или был удален один из следующих объектов: приложение Azure Active Directory, субъект-служба, роль, ресурс сертификата службы автоматизации, ресурс подключения службы автоматизации. Либо не совпадает отпечаток у сертификата и подключения.

  **Рекомендуемое действие**: удалите и [повторно создайте учетную запись запуска от имени](../automation/manage-runas-account.md).

- **Ошибка**: истекает срок действия сертификата запуска от имени Azure, используемого учетной записью службы автоматизации.

  Срок действия самозаверяющего сертификата, созданного для учетной записи запуска от имени, истекает один год с даты создания. Его можно обновить в любое время до истечения его срока действия. Если вы подписались на уведомления по электронной почте, вы также получаете сообщения электронной почты, когда на стороне вас потребуются какие-либо действия. Эта ошибка будет отображаться на два месяца раньше даты истечения срока действия и изменится на критическую ошибку, если срок действия сертификата истек. После истечения срока действия сертификата автоматическое обновление не будет работать до тех пор, пока вы не обновите его.

  **Рекомендуемое действие**: чтобы устранить эту проблему, выберите **восстановить** , а затем **продлить сертификат**.

  :::image type="content" source="./media/azure-to-azure-autoupdate/automation-account-renew-runas-certificate.PNG" alt-text="продление сертификата":::

  > [!NOTE]
  > После продления сертификата обновите страницу, чтобы отобразить текущее состояние.
