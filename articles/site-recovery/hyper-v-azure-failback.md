---
title: Отказ назад hyper-V VMs от Azure с Azure восстановления сайта
description: Как вывести из строя Hyper-V VM на сайт из Azure с восстановлением сайта Azure.
services: site-recovery
author: rajani-janaki-ram
manager: gauravd
ms.service: site-recovery
ms.topic: article
ms.date: 09/12/2019
ms.author: rajanaki
ms.openlocfilehash: 4b005ae308576db6fd26fcf079161430b266ec3f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79281786"
---
# <a name="run-a-failback-for-hyper-v-vms"></a>Восстановление размещения для виртуальных машин Hyper-V

В этой статье описывается, как выйти из строя на базе VMs Azure, которые были созданы после отказа от Hyper-V VMs с сайта на территории Azure, с [восстановлением сайта Azure.](site-recovery-overview.md)

- Вы не сможете вернуть Hyper-V VM из Azure, запустив запланированный сбой из Azure в локта.ру. Если направление сбоя от Azure к он-к-предпосылке, это считается отказом.
- Поскольку Azure является высокодоступной средой и vMs всегда доступны, отказ от Azure является запланированным действием. Можно спланировать небольшое время простоя, чтобы рабочие нагрузки снова начали работать на месте. 
- Запланированный отказ отключает вывешивания в Azure и загружает последние изменения. Потеря данных не ожидается.

## <a name="before-you-start"></a>Перед началом работы

1. [Просмотрите типы сбой,](failover-failback-overview.md#hyper-v-reprotectionfailback) который вы можете использовать - первоначальное восстановление местоположения и альтернативное восстановление местоположения.
2. Убедитесь, что VMs-накопитель Azure используют учетную запись хранения и не управляемые диски. Failback Hyper-V VMs, реплицированных с помощью управляемых дисков, не поддерживается.
3. Убедитесь, что внутренний хост Hyper-V (или VMM-сервер System Center, если вы используете с помощью восстановления сайта) работает и подключен к Azure. 
4. Убедитесь, что сбой и коммит являются полными для VMs. Вам не нужно настраивать какие-либо конкретные компоненты восстановления сайта для отказа от Hyper-V VMs из Azure.
5. Время, необходимое для завершения синхронизации данных и запуска на месте VM будет зависеть от ряда факторов. Чтобы ускорить загрузку данных, можно настроить агент служб ы восстановления Майкрософт, чтобы использовать больше потоков для параллелизации загрузки. Ознакомьтесь с [дополнительными сведениями](https://support.microsoft.com/help/3056159/how-to-manage-on-premises-to-azure-protection-network-bandwidth-usage).


## <a name="fail-back-to-the-original-location"></a>Восстановление размещения в исходное расположение.

Чтобы не вернуть Hyper-V VM в Azure на оригинальный наемный VM, запустите запланированный сбой из Azure на объект ежект- и далее:

1. В хранилище > **Реплицированные элементы,** выберите VM. Справа щелкните VM > **Planned Failover**. Если вы не смогли вернуть план восстановления, выберите имя плана и нажмите **Failover** > **Запланированный Failover**.
2. В **подтвердите запланированный Failover**, выберите источник и целевые места. Запомните направление отработки отказа. Если сбой от первичного работал, как ожидалось, и все виртуальные машины находятся во вторичном месте это только для информации.
3. При **синхронизации данных**выберите опцию:
    - **Синхронизация данных перед сбоем (синхронизация только дельта-изменения)**- Этот параметр сводит к минимуму время простоя для VMs, поскольку он синхронизирует ся, не закрывая их.
        - **Фаза 1**: Делает снимок Azure VM и копирует его на место второго раза. Машина продолжит работать в Azure.
        - **Фаза 2**: Выключает Azure VM, чтобы там не произошло никаких новых изменений. Окончательный набор дельта-изменений передается на сервер и запускается на месте VM.
    - **Синхронизировать данные во время сбоя только (полная загрузка)**- Эта опция быстрее, потому что мы предполагаем, что большая часть диска изменилась, и не хотим тратить время на расчет checksums. Этот параметр не выполняет вычисления контрольной суммы.
        - Выполняется скачивание диска. 
        - Мы рекомендуем вам использовать эту опцию, если вы работаете в Azure некоторое время (месяц или более) или если в помещении VM удален.

4. Для VMM только в случае включения шифрования данных для облака в **ключе шифрования**выберите сертификат, который был выдан при включении шифрования данных во время установки поставщика на сервере VMM.
5. Запустите отработку отказа. На вкладке **Задания** можно следить за ходом выполнения отработки отказа.
6. Если вы выбрали опцию синхронизации данных до сбоя, после завершения первоначальной синхронизации данных и вы готовы выключить виртуальные машины в Azure, нажмите **«Джобс** > имя задания > **Полный Failover**. Таким образом вы сделаете следующее:
    - Выключает машину Azure.
    - Переносит последние изменения в помещение VM.
    - Запускает на месте VM.
7. Теперь вы можете войти в предприимчезную машину VM, чтобы проверить, что она доступна, как ожидалось.
8. Виртуальная машина будет находиться в состоянии ожидания фиксации. Щелкните **Применить**, чтобы применить отработку отказа.
9. Чтобы завершить сбой, нажмите **Обратный репликации,** чтобы начать репликацию на месте VM в Azure снова.



## <a name="fail-back-to-an-alternate-location"></a>Восстановление размещения в альтернативное расположение. 

Не вернуться в другое место следующим образом:

1. Если вы настраиваете новое оборудование, установите [поддерживаемую версию Windows](hyper-v-azure-support-matrix.md#replicated-vms)и роль Hyper-V на машине.
2. Создайте коммутатор виртуальной сети с тем же именем, что и на исходном сервере.
3. В **защищенных элементах** > **Защита группы** > \<ProtectionGroupName> - > \<VirtualMachineName>, выберите VM вы хотите потерпеть неудачу назад, а затем выберите **запланированный Failover**.
4. В **Подтвердите запланированный Failover**s, избрать **Создать на-предпосылки виртуальную машину, если она не существует.**
5. В **названии хоста**выберите новый сервер Hyper-V, на котором вы хотите разместить VM.
6. В **синхронизации данных**мы рекомендуем выбрать опцию синхронизации данных до сбоя. Это сводит к минимуму время простоя для VMs, поскольку оно синхронизируется без их выключения. Он выполняет следующие действия:
    - **Фаза 1**: Делает снимок VM Azure и копирует его на место второго раза. Машина продолжит работать в Azure.
    - **Фаза 2**: Выключает Azure VM, чтобы там не произошло никаких новых изменений. Последний набор изменений передается на локальный сервер, после чего запускается локальная виртуальная машина.
    
7. Установите этот флажок, чтобы начать отработку отказа (восстановление размещения).
8. После завершения первоначальной синхронизации и готовности выключить Azure VM нажмите кнопку **«Работа,** > \<запланированная сбой> > **полный Failover.** Это выключает машину Azure, передает последние изменения в предприимки VM и запускает его.
9. Вы можете войти в помещение VM, чтобы убедиться, что все работает как ожидалось.
10. Нажмите **Commit,** чтобы закончить неудачу. Commit удаляет Azure VM и его диски и готовит предприимчатемый VM для повторной защиты.
10. Нажмите **Обратная репликация,** чтобы начать репликацию на месте VM в Azure. Только дельта изменяется с момента выключения VM в Azure, будет реплицироваться.

    > [!NOTE]
    > При отмене задания свозврата при синхронизации данных, впредь VM будет находиться в поврежденном состоянии. Это связано с тем, что синхронизация данных копирует последние данные с дисков Azure VM на диски на наличие данных, и до завершения синхронизации данные диска могут находиться не в согласованном состоянии. Если при внеосновенее VM запускается после отмены синхронизации данных, он может не загрузиться. В этом случае повторное выполнение сбоя для завершения синхронизации данных.


## <a name="next-steps"></a>Дальнейшие действия
После того, как предприимчивый VM реплицируется в Azure, можно при необходимости [запустить еще один сбой](site-recovery-failover.md) в Azure.
