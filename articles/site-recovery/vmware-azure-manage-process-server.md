---
title: Управление сервером обработки для VMware VMs/физического восстановления сервера в восстановлении сайта Azure
description: В этой статье описывается управление сервером процессов для аварийного восстановления VMw/физических серверов с помощью Azure Site Recovery.
author: Rajeswari-Mamilla
manager: rochakm
ms.service: site-recovery
ms.topic: conceptual
ms.date: 04/28/2019
ms.author: ramamill
ms.openlocfilehash: ef16e3b75ca8e051b1b7abb1a92843279884c697
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79257255"
---
# <a name="manage-process-servers"></a>Управление серверами обработки

В этой статье описаны общие задачи для управления сервером процесса восстановления сайта.

Сервер процесса используется для получения, оптимизации и отправки данных репликации в Azure. Он также выполняет push-установку службы Мобильности на VMware VMs и физических серверах, которые вы хотите воспроизвести, и выполняет автоматическое обнаружение на месте машин. Для воспроизведения vMs-технологий VMware или физических серверов в Azure сервер процесса устанавливается по умолчанию на сервер конфигурации. 

- Для больших развертываний могут понадобиться дополнительные серверы обработки в локальной среде, чтобы изменять масштаб емкости.
- Для отказа от Azure к началу локализации необходимо настроить временный сервер процессов в Azure. Восстановив размещение, вы можете удалить эту виртуальную машину. 

Подробнее о сервере процесса.


## <a name="upgrade-a-process-server"></a>Обновление сервера обработки

При развертывании сервера процесса на месте или в качестве VM Azure для сбоя, устанавливается последняя версия сервера процесса. Команды разработчиков Site Recovery регулярно выпускают исправления и улучшения, и мы рекомендуем вам систематически обновлять свои серверы обработки. Обновление сервера процесса можно следующим образом:

[!INCLUDE [site-recovery-vmware-upgrade -process-server](../../includes/site-recovery-vmware-upgrade-process-server-internal.md)]


## <a name="move-vms-to-balance-the-process-server-load"></a>Перемещение ВМ, чтобы сбалансировать нагрузку сервера процесса

Сбалансировать нагрузку, перемещая ВМ между двумя серверами процесса, следующим образом:

1. В хранилище, под **управлением** нажмите **Инфраструктура восстановления сайта**. Под **для VMware & физические машины,** нажмите **Конфигурация серверов**.
2. Нажмите на сервер конфигурации, с которым зарегистрированы серверы процесса.
3. Нажмите на сервер процесса, для которого вы хотите загрузить баланс трафика.

    ![LoadBalance](media/vmware-azure-manage-process-server/LoadBalance.png)

4. Нажмите **баланс нагрузки,** выберите сервер процесса целевого процесса, на который вы хотите переместить машины. Затем нажмите **OK**

    ![LoadPS](media/vmware-azure-manage-process-server/LoadPS.PNG)

2. Нажмите **Выберите машины**и выберите машины, которые вы хотите переместить с текущего на сервер целевого процесса. Сведения о среднем значении изменения данных отображаются возле каждой виртуальной машины. После этого щелкните **OK**. 
3. В хранилище следите за ходом выполнения работ ы в рамках **мониторинга** > **заданиями по восстановлению сайта.**

Для отражения изменений на портале потребуется около 15 минут. Для более быстрого эффекта [обновите сервер конфигурации.](vmware-azure-manage-configuration-server.md#refresh-configuration-server)

## <a name="switch-an-entire-workload-to-another-process-server"></a>Переключите всю рабочую нагрузку на другой сервер процесса

Переместите всю рабочую нагрузку, обрабатываемую сервером процесса, на другой сервер процесса следующим образом:

1. В хранилище, под **управлением** нажмите **Инфраструктура восстановления сайта**. Под **для VMware & физические машины,** нажмите **Конфигурация серверов**.
2. Нажмите на сервер конфигурации, с которым зарегистрированы серверы процесса.
3. Нажмите на сервер процесса, с которого требуется переключить рабочую нагрузку.
4. Нажмите на **коммутатор,** выберите сервер целевого процесса, на который требуется переместить рабочую нагрузку. Затем нажмите **OK**

    ![Параметр](media/vmware-azure-manage-process-server/Switch.PNG)

5. В хранилище следите за ходом выполнения работ ы в рамках **мониторинга** > **заданиями по восстановлению сайта.**

Для отражения изменений на портале потребуется около 15 минут. Для более быстрого эффекта [обновите сервер конфигурации.](vmware-azure-manage-configuration-server.md#refresh-configuration-server)

## <a name="register-a-master-target-server"></a>Регистрация основного целевого сервера

Мастер-целевой сервер находится на сервере конфигурации и серверах процесса масштабирования. Он должен быть зарегистрирован на сервере конфигурации. В случае сбоя в этой регистрации, это может повлиять на работоспособность охраняемых элементов. Чтобы зарегистрировать основной целевой сервер с сервером конфигурации, войдите в определенный сервер конфигурации/масштабпроцесса, на котором требуется регистрация. Перейдите к папке **%PROGRAMDATA%-ASR-Агент**и запустите следующий запрос команды администратора.

   ```
   cmd
   cdpcli.exe --registermt

   net stop obengine

   net start obengine

   exit
   ```

## <a name="reregister-a-process-server"></a>Повторная регистрация сервера обработки

Перерегистрируйте сервер процесса, работающий на месте или на Azure VM с сервером конфигурации следующим образом:

[!INCLUDE [site-recovery-vmware-register-process-server](../../includes/site-recovery-vmware-register-process-server.md)]

Сохранив параметры, сделайте следующее:

1. Откройте командную строку администратора на сервере обработки.
2. Перейдите к папке **%PROGRAMDATA%\ASR\Agent** и выполните эту команду:

    ```
    cdpcli.exe --registermt
    net stop obengine
    net start obengine
    ```

## <a name="modify-proxy-settings-for-an-on-premises-process-server"></a>Изменение параметров прокси-сервера для сервера обработки в локальной среде

Если сервер внутреннего процесса использует прокси для подключения к Azure, можно изменить настройки прокси следующим образом:

1. Войти в процесс серверной машины. 
2. Откройте командную строку PowerShell с правами администратора и выполните следующую команду.
   ```powershell
   $pwd = ConvertTo-SecureString -String MyProxyUserPassword
   Set-OBMachineSetting -ProxyServer http://myproxyserver.domain.com -ProxyPort PortNumber –ProxyUserName domain\username -ProxyPassword $pwd
   net stop obengine
   net start obengine
   ```
2. Просмотрите папку **%PROGRAMDATA%-ASR-Агент**, и запустите эту команду:
   ```
   cmd
   cdpcli.exe --registermt

   net stop obengine

   net start obengine

   exit
   ```

## <a name="remove-a-process-server"></a>Удаление сервера обработки

[!INCLUDE [site-recovery-vmware-unregister-process-server](../../includes/site-recovery-vmware-unregister-process-server.md)]

## <a name="exclude-folders-from-anti-virus-software"></a>Исключить папки из антивирусного программного обеспечения

Если антивирусное программное обеспечение работает на сервере процесса масштабирования (или главном целевом сервере), исключите следующие папки из антивирусных операций:


- C:\Program Files\Microsoft Azure Recovery Services Agent
- C:\ProgramData\ASR.
- C:\ProgramData\ASRLogs.
- C:\ProgramData\ASRSetupLogs.
- C:\ProgramData\LogUploadServiceLogs.
- C:\ProgramData\Microsoft Azure Site Recovery.
- Обработка каталога установки сервера. Например: C:'Файлы программы (x86)»Восстановление сайта Microsoft Azure