---
title: Настройка репликации для VMs Azure в восстановлении сайта Azure
description: Узнайте, как настроить репликацию в другой регион для MMs-иносов Azure с помощью восстановления сайта.
author: sideeksh
manager: rochakm
ms.topic: how-to
ms.date: 04/29/2018
ms.openlocfilehash: 1c6b7cfbf193f02598052b6922efec17fb16ec83
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75973691"
---
# <a name="replicate-azure-vms-to-another-azure-region"></a>ТиражAzр VM в другой регион Azure


В этой статье описывается, как включить репликацию виртуальных машин Azure между регионами Azure.

## <a name="before-you-start"></a>Перед началом работы

В этой статье предполагается, что вы подготовили развертывание для восстановления сайта, как описано в [учебнике по восстановлению аварийного восстановления Azure to Azure.](azure-to-azure-tutorial-enable-replication.md)

Предпосылки должны быть на месте, и вы должны были создать хранилище служб восстановления.


## <a name="enable-replication"></a>Включение репликации

Включите репликацию. Предполагается, что основной регион Azure — это "Восточная Азия", а дополнительный — "Юго-Восточная Азия".

1. В хранилище щелкните **+Replicate** (+Репликация).
2. Обратите внимание на следующие поля:
   - **Источник** — источник происхождения виртуальных машин, в этом случае это **Azure**.
   - **Месторасположено исходное местоположение**: Область Azure, от которой вы хотите защитить свои всхожи. В этом примере исходным расположением является "Восточная Азия".
   - **Модель развертывания** — модель развертывания Azure для исходных компьютеров.
   - **Подписка на источник**: Подписка, к которой принадлежат ваши исходные ВМ. Это может быть любая подписка в одном клиенте Azure Active Directory, где существует хранилище служб восстановления.
   - **Группа ресурсов** — группа ресурсов, к которой принадлежат исходные виртуальные машины. Для защиты на следующем шаге будут перечислены все виртуальные машины в выбранной группе ресурсов.

     ![Включение репликации](./media/site-recovery-replicate-azure-to-azure/enabledrwizard1.png)

3. В **виртуальных машинах > Выберите виртуальные машины,** нажмите и выберите каждый VM, который вы хотите воспроизвести. Можно выбрать только те компьютеры, для которых можно включить репликацию. После этого щелкните **OK**.
    ![Включение репликации](./media/site-recovery-replicate-azure-to-azure/virtualmachine_selection.png)

4. В разделе **Параметры** можно при необходимости настроить параметры целевого веб-сайта:

   - **Целевое расположение**. Расположение, куда будут реплицированы данные исходных виртуальных машин. В зависимости от расположения выбранной машины Site Recovery предоставит список подходящих целевых регионов. Мы рекомендуем сохранить такое же целевое расположение, что и расположение хранилищ служб восстановления.
   - **Целевая подписка**. Целевая подписка, используемая для аварийного восстановления. По умолчанию целевая подписка будет совпадать с исходной подпиской.
   - **Целевая группа ресурсов**. Группа ресурсов, в которой будут находиться все реплицированные виртуальные машины.
       - По умолчанию Восстановление сайта создает новую группу ресурсов в целевом регионе с суффиксом «аср» в имени.
       - Если группа ресурсов, созданная Восстановлением сайта, уже существует, она используется повторно.
       - Настройки группы ресурсов можно настроить.
       - Местоположение целевой группы ресурсов может быть в любом регионе Azure, за исключением региона, в котором размещаются исходные VMs.
   - **Целевая виртуальная сеть**: По умолчанию, Восстановление сайта создает новую виртуальную сеть в целевом регионе с суффиксом "asr" в имени. Она будет сопоставлена с исходной сетью и будет использоваться для защиты в будущем. [Узнайте больше](site-recovery-network-mapping-azure-to-azure.md) о сетевом сопоставлении.
   - **Учетные записи целевых хранилищ (источник VM не использует управляемые диски)**: По умолчанию восстановление сайта создает новую учетную запись целевого хранилища, имитирующую конфигурацию исходного хранилища VM. В случае, если учетная запись хранения уже существует, она используется повторно.
   - **Реплика управляемых дисков (источник VM использует управляемые диски)**: Восстановление сайта создает новые реплики управляемых дисков в целевой области, чтобы отразить исходный VM управляемых дисков с тем же типом хранения (стандартный или премиум), как источник VM управляемых дисков.
   - **Cache Storage accounts** (Учетные записи хранения кэша). Для Site Recovery необходима дополнительная учетная запись хранения, называемая учетной записью хранения кэша, в исходном регионе. Все изменения, происходящие на исходных виртуальных машинах, отслеживаются и отправляются учетной записи хранения кэша перед репликацией в целевое расположение. Эта учетная запись хранения должна быть стандартной.
   - **Наборы целевых наборов доступности**: По умолчанию восстановление сайта создает новый набор доступности в целевом регионе с суффиксом "asr" в названии для VMs, которые являются частью доступности, установленной в регионе исходного кода. Если набор доступности, созданный восстановлением сайта, уже существует, он используется повторно.
   - **Целевые зоны доступности.** По умолчанию Site Recovery назначает один и тот же номер зоны как исходный регион в целевом регионе, если целевой регион поддерживает зоны доступности.

     Если целевой регион не поддерживает зоны доступности, целевые виртуальные машины настраиваются как отдельные экземпляры по умолчанию. При необходимости можно включить такие виртуальные машины в группы доступности в целевом регионе. Для этого нажмите кнопку "Настроить".

     >[!NOTE]
     >После включения репликации изменить тип доступности (один экземпляр), группу доступности или зону доступности нельзя. Чтобы изменить тип доступности, необходимо отключить и повторно включить репликацию.
     >

   - **Политика репликации** определяет параметры для журнала хранения точки восстановления и периодичность создания моментальных снимков, совместимых с приложениями. По умолчанию восстановление сайта Azure создает новую политику репликации с настройками "24 часа" для сохранения точек восстановления и "4 часа" для частоты снимков приложения.

     ![Включение репликации](./media/site-recovery-replicate-azure-to-azure/enabledrwizard3.PNG)

### <a name="enable-replication-for-added-disks"></a>Включить репликацию для добавленных дисков

Если вы добавляете диски в VM Azure, для которого включена репликация, происходит следующее:
-   Здоровье репликации для VM показывает предупреждение, и примечание сообщает вам, что один или несколько дисков доступны для защиты.
-   Если вы включите защиту добавленных дисков, предупреждение исчезнет после первоначальной репликации диска.
-   Если вы решили не включать репликацию для диска, вы можете отклонить предупреждение.


    ![Добавлен новый диск](./media/azure-to-azure-how-to-enable-replication/newdisk.png)

Для репликации добавленного диска сделайте следующее:

1.  В хранилище > **Реплицированные элементы,** нажмите на VM, к которому вы добавили диск.
2.  Нажмите **на диски,** а затем выберите диск данных, для которого вы хотите включить репликацию (эти диски имеют **незащищенный** статус).
3.  В **деталях диска**нажмите **Включить репликации**.

    ![Включить репликацию для добавленного диска](./media/azure-to-azure-how-to-enable-replication/enabled-added.png)

После выполнения задания репликации включить и завершения первоначальной репликации предупреждение о работе с воспроизведением для проблемы диска удаляется.



## <a name="customize-target-resources"></a>Настройка целевых ресурсов

Можно изменить целевые параметры по умолчанию, используемые Site Recovery.

1. Нажмите кнопку **Настройка** рядом с пунктом "Целевая подписка", чтобы изменить целевую подписку по умолчанию. Выберите подписку из списка подписок, доступных в одном клиенте Azure Active Directory (AAD).

2. Щелкните **Настроить**, чтобы изменить параметры по умолчанию:
    - **Целевая группа ресурсов**. Выберите группу ресурсов из списка групп ресурсов в целевом расположении подписки.
    - **Target Virtual Network** (Целевая виртуальная сеть). Выберите сеть из списка всех виртуальных сетей в целевой локации.
    - **Группа доступности**. Здесь можно добавить параметры группы доступности для виртуальной машины, если она является частью группы доступности исходного региона.
    - **Target Storage accounts** (Целевые учетные записи хранения). Выберите учетную запись хранения, которую нужно использовать.

        ![Включение репликации](./media/site-recovery-replicate-azure-to-azure/customize.PNG)
3. Щелкните **Настроить**, чтобы изменить настройки репликации.
4. В **последовательности Multi-VM**выберите всхожие вывешины, которые вы хотите воспроизвести совместно.
    - На всех компьютерах в группе репликации будут общие отказоустойчивые и согласованные точки восстановления после отработки отказа.
    - Включение мульти-VM согласованности может повлиять на производительность рабочей нагрузки (так как это интенсивный процессор). Она должна быть включена только в том случае, если машины работают с одной и той же рабочей нагрузкой, и вам необходима согласованность в нескольких машинах.
    - Например, если в приложении есть 2 виртуальных устройства сервера S'L Server и два веб-сервера, то к группе репликации следует добавить только виртуальные компьютеры сервера S'L.
    - Вы можете выбрать максимум 16 ВМ в группе репликации.
    - Если включить согласованность между виртуальными машинами, компьютеры в группе репликации будут обмениваться данными друг с другом через порт 20004.
    - Убедитесь, что нет брандмауэра, блокирующего внутреннюю связь между ВМ через порт 20004.
    - Если вы хотите, чтобы Linux VMs были частью группы репликации, убедитесь, что исходящий трафик в порту 20004 вручную открыт в соответствии с рекомендациями для конкретной версии Linux.
![Включение репликации](./media/site-recovery-replicate-azure-to-azure/multivmsettings.PNG)

5. Нажмите **Создать целевой ресурс** > **Включить репликации**.
6. После включения репликации виртуальных машин можно проверить их состояние работоспособности в разделе **Реплицированные элементы**.

>[!NOTE]
>Во время начальной репликации обновление состояния может занять некоторое время (без видимого прогресса). Щелкните **Обновить**, чтобы получить последние сведения о состоянии задания.
>

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о выполнении тестовой отработки отказа см. в [этой статье](site-recovery-test-failover-to-azure.md).
