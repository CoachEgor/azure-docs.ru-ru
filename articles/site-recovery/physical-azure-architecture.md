---
title: Архитектура аварийного восстановления сервера в Azure
description: В этой статье представлен обзор компонентов и архитектуры, используемых при аварийном восстановлении физических серверов из локальной среды в Azure с помощью службы Azure Site Recovery.
ms.topic: conceptual
ms.date: 02/11/2020
ms.openlocfilehash: 089d981284986a2b6eb0ee7f1dbd401fc7ce4fcd
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77162843"
---
# <a name="physical-server-to-azure-disaster-recovery-architecture"></a>Архитектура для аварийного восстановления физических серверов в Azure

Эта статья описывает архитектуру и процессы, используемые при репликации, отработке отказа и восстановлении физических серверов Windows и Linux между локальным сайтом и Azure с помощью службы [Azure Site Recovery](site-recovery-overview.md).

## <a name="architectural-components"></a>Компоненты архитектуры

Следующая таблица и графика обеспечивают высокоуровневое представление компонентов, используемых для репликации физического сервера в Azure.

| **Компонент** | **Требование** | **Подробно** |
| --- | --- | --- |
| **Azure** | Подписка Azure и сеть Azure. | Реплицированные данные с локальной физической машины хранятся на управляемых дисках Azure. Виртуальные машины Azure создаются с использованием реплицированных данных при запуске отработки отказа из локальной среды в Azure. При создании виртуальные машины Azure подключаются к виртуальной сети Azure. |
| **Сервер обработки** | По умолчанию устанавливается вместе с сервером конфигурации. | Выступает в качестве шлюза репликации. Получает данные репликации, оптимизирует их путем кэширования, сжатия и шифрования и отправляет эти данные в службу хранилища Azure.<br/><br/> Сервер обработки также устанавливает службу Mobility Service на серверах, которые требуется реплицировать.<br/><br/> По мере увеличения масштаба развертывания вы можете добавлять дополнительные отдельные серверы для обработки растущего объема данных репликации. |
| **Главный целевой сервер** | По умолчанию устанавливается вместе с сервером конфигурации. | Обработка данных репликации во время сбоя из Azure.<br/><br/> Для крупных развертываний вы можете добавить отдельный главный целевой сервер для восстановления размещения. |
| **Реплицированные серверы** | Служба Mobility Service устанавливается на каждом реплицируемом сервере. | Рекомендуем разрешить автоматическую установку с сервера обработки. Или можно установить службу вручную или использовать автоматизированный метод развертывания, такой как Configuration Manager. |

**Архитектура: репликация физических компьютеров в Azure**

![Компоненты](./media/physical-azure-architecture/arch-enhanced.png)

## <a name="replication-process"></a>Процесс репликации

1. Необходимо настроить развертывание, в том числе локальные компоненты и компоненты Azure. В хранилище служб восстановления нужно указать источник и целевой объект репликации, настроить сервер конфигурации, создать политику репликации и включить репликацию.
1. Машины реплицируются с помощью политики репликации, и начальная копия данных сервера реплицируется в хранилище Azure.
1. После завершения начальной репликации начинается репликация разностных изменений в Azure. Отслеживаемые изменения для машины хранятся в файле с расширением _.hrl._
   - Машины общаются с сервером конфигурации на входящих в порт HTTPS 443 для управления репликацией.
   - Машины отправляют данные репликации на сервер процесса в входящий порт HTTPS 9443 (может быть изменен).
   - Сервер конфигурации организует управление репликацией с Azure через исходящий порт HTTPS 443.
   - Сервер процесса получает данные из исходных машин, оптимизирует и шифрует их, а также отправляет их в хранилище Azure через исходящий порт HTTPS 443.
   - Если включить согласованность между виртуальными машинами, компьютеры в группе репликации будут обмениваться данными друг с другом через порт 20004. Эту функция используется, если вы объединяете несколько компьютеров в группы репликации, и они совместно используют отказоустойчивые и согласованные точки восстановления после отработки отказа. Эти группы полезны, если машины работают с одной и той же рабочей нагрузкой и должны быть последовательными.
1. Трафик реплицируется в общедоступные конечные точки службы хранилища Azure через Интернет. Кроме того, вы можете использовать azure ExpressRoute [публичного пиринга](../expressroute/about-public-peering.md).

   > [!NOTE]
   > Репликация не поддерживается через VPN от сайта к сайту с сайта или [приватного пиринга](concepts-expressroute-with-site-recovery.md#on-premises-to-azure-replication-with-expressroute)Azure ExpressRoute.

**Процедура репликации физических компонентов в Azure**

![Процесс репликации](./media/physical-azure-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a>Процесс отработки отказа и восстановления размещения

После настройки репликации можно запустить аварийное сверло (тест failover), чтобы проверить, что все работает как ожидалось. После этого, вы можете потерпеть неудачу сверх и потерпит неудачу назад по мере необходимости. Рекомендуются следующие действия.

- Плановая отработка отказа не поддерживается.
- Не требуется возврат к предприимки VMware VM. Вам нужна припредстная инфраструктура VMware, даже если вы воспроизводите на месте физические серверы в Azure.
- Выполните отработку отказа одного компьютера или создайте планы восстановления, чтобы выполнить отработку отказа нескольких компьютеров.
- При выполнении отработки отказа из реплицированных данных создаются виртуальные машины Azure в службе хранилища Azure.
- После срабатывания исхода выемки, вы обязуетесь начать доступ к рабочей нагрузке из Azure VM.
- Когда основной локальный сайт снова станет доступным, вы сможете выполнить восстановление размещения.
- Настройка инфраструктуры отказов, которая включает в себя:
  - **Временный сервер обработки в Azure**. Чтобы восстановить размещение из Azure, настройте виртуальную машину Azure как сервер обработки. Это позволит выполнять репликацию из Azure. Вы можете удалить этот VM после сбоя назад отделки.
  - **VPN-подключение**. Для восстановления размещения нужно настроить VPN-подключение (или Azure ExpressRoute) между сетью Azure и локальным сайтом.
  - **Отдельный основной целевой сервер:** По умолчанию сбой обратно обрабатывается мастерским целевым сервером, который был установлен с сервером конфигурации на предприимчном VMware VM. Если вам необходимо выполнить отказ от больших объемов трафика, следует настроить отдельный внутренний целевой сервер.
  - **Политика восстановления размещения.** Для репликации обратно на локальный сайт необходима политика восстановления размещения. Политика автоматически создавалась при создании политики репликации из предварительного помещения в Azure.
  - **Инфраструктура VMware:** Чтобы выйти из строя, вам нужна инфраструктура VMware. Восстанавливать размещение на физический сервер нельзя.
- После того, как компоненты на месте, сбой обратно происходит в три этапа:
  - **Этап 1**: Reprotect Azure VMs, чтобы они реплицировались из Azure обратно в предприимченные VMw.
  - **Этап 2**: Запуск failover на месте на месте.
  - **Этап 3**: После того, как рабочие нагрузки не сработали назад, вы пополните репликацию.

**Восстановление размещения VMware с переносом из Azure**

![Восстановление размещения](./media/physical-azure-architecture/enhanced-failback.png)

## <a name="next-steps"></a>Дальнейшие действия

Для настройки [аварийного](physical-azure-disaster-recovery.md)восстановления для физических серверов в Azure см.
