---
title: Устранение неполадок репликации при аварийном восстановлении виртуальных машин VMware и физических серверов в Azure с помощью Azure Site Recovery | Документация Майкрософт
description: В этой статье описано, как устранять распространенные неполадки репликации при аварийном восстановлении физических серверов и виртуальных машин VMware в Azure с помощью Azure Site Recovery.
author: mayurigupta13
manager: rochakm
ms.service: site-recovery
ms.topic: article
ms.date: 08/2/2019
ms.author: mayg
ms.openlocfilehash: f91ee5654b4add37d3cce4f875be1f9c2b398ab9
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81259499"
---
# <a name="troubleshoot-replication-issues-for-vmware-vms-and-physical-servers"></a>Устранение неполадок с репликацией виртуальных машин VMware и физических серверов

В этой статье описаны некоторые общие проблемы и конкретные ошибки, с которыми вы можете столкнуться при воспроизведении на местах VMware VMs и физических серверов в Azure с помощью [восстановления сайта.](site-recovery-overview.md)

## <a name="step-1-monitor-process-server-health"></a>Шаг 1: Мониторинг работоспособности сервера процесса

Восстановление сайта использует [сервер процесса](vmware-physical-azure-config-process-server-overview.md#process-server) для получения и оптимизации реплицированных данных и отправки их в Azure.

Мы рекомендуем следить за работоспособностью серверов процессов на портале, чтобы убедиться, что они подключены и работают должным образом, и что репликация прогрессирует для исходных машин, связанных с сервером процесса.

- [Узнайте о](vmware-physical-azure-monitor-process-server.md) серверах процесса мониторинга.
- [Анализ рекомендаций](vmware-physical-azure-troubleshoot-process-server.md#best-practices-for-process-server-deployment)
- [Устранение проблемы](vmware-physical-azure-troubleshoot-process-server.md#check-process-server-health) обрабатывает работоспособность сервера.

## <a name="step-2-troubleshoot-connectivity-and-replication-issues"></a>Шаг 2: Проблемы подключения и репликации проблем с устранением неполадок

Первоначальные и текущие сбои репликации часто вызваны проблемами подключения между сервером-источником и сервером процесса или между сервером процесса и Azure.

Для решения этих проблем, [устранение неполадок подключения и репликации.](vmware-physical-azure-troubleshoot-process-server.md#check-connectivity-and-replication)




## <a name="step-3-troubleshoot-source-machines-that-arent-available-for-replication"></a>Шаг 3: Исходные машины, которые недоступны для репликации

При попытке выбрать исходную машину для включения репликации с помощью Azure Site Recovery она может быть недоступна по одной из следующих причин.

* **Две виртуальные машины с одинаковым экземпляром UUID:** Если два виртуальных машины под vCenter имеют один и тот же экземпляр UUID, первая виртуальная машина, обнаруженная сервером конфигурации, отображается на портале Azure. Для устранения этой проблемы убедитесь, что виртуальным машинам назначены уникальные UUID экземпляра. Этот сценарий обычно рассматривается в тех случаях, когда резервное копирование VM становится активным и входит в наши записи открытий. Обратитесь к [Azure Site Recovery VMware-to-Azure: как очистить дубликаты или устаревшие записи](https://social.technet.microsoft.com/wiki/contents/articles/32026.asr-vmware-to-azure-how-to-cleanup-duplicatestale-entries.aspx) для решения.
* **Неправильные учетные данные пользователей vCenter**: Убедитесь, что вы добавили правильные учетные данные vCenter при настройке сервера конфигурации с помощью шаблона OVF или единой настройки. Чтобы проверить учетные данные, добавленные во время установки, обратитесь к разделу [Изменение учетных данных для автоматического обнаружения](vmware-azure-manage-configuration-server.md#modify-credentials-for-automatic-discovery).
* **vCenter недостаточные привилегии**: Если разрешения, предоставляемые для доступа vCenter не имеют необходимых разрешений, неспособность обнаружить виртуальные машины может произойти. Убедитесь, что разрешения, описанные в разделе [Подготовка учетной записи для автоматического обнаружения](vmware-azure-tutorial-prepare-on-premises.md#prepare-an-account-for-automatic-discovery), добавлены в учетную запись пользователя vCenter.
* **Серверы управления Azure Site Recovery:** Если виртуальная машина используется в качестве сервера управления под одной или более из следующих ролей - Configuration server /scale-out process server / Master target server, то вы не сможете выбрать виртуальную машину с портала. Серверы управления не могут быть реплицированы.
* **Уже защищены/не удалось более через Службы восстановления сайта Azure**: Если виртуальная машина уже защищена или не закончена через восстановление сайта, виртуальная машина не доступна для выбора для защиты на портале. Убедитесь, что виртуальная машина, которую вы ищете на портале, не защищена другим пользователем или в рамках другой подписки.
* **vCenter не подключен:** Проверьте, находится ли vCenter в подключенном состоянии. Чтобы проверить, перейдите в "Хранилище Служб восстановления > Инфраструктура Site Recovery > Серверы конфигурации", щелкните соответствующий сервер конфигурации, и справа откроется колонка с подробными сведениями о связанных серверах. Проверьте, подключен ли vCenter. Если он в состоянии "Не подключен", устраните проблему, а затем [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server) на портале. После этого виртуальная машина появится в списке на портале.
* **ESXi отключен:** Если хост ESXi, под которым находится виртуальная машина, находится в выключенном состоянии, то виртуальная машина не будет указана или не будет выбрана на портале Azure. Включите узел ESXi и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server) на портале. После этого виртуальная машина появится в списке на портале.
* **В ожидании перезагрузки:** Если на виртуальной машине будет отложена перезагрузка, вы не сможете выбрать машину на портале Azure. Убедитесь, что ожидаемая перезагрузка выполнена, и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server). После этого виртуальная машина появится в списке на портале.
* **IP не найден:** Если виртуальная машина не имеет действительного IP-адреса, связанного с ним, то вы не сможете выбрать машину на портале Azure. Убедитесь, что виртуальной машине назначен допустимый IP-адрес, и [обновите сервер конфигурации](vmware-azure-manage-configuration-server.md#refresh-configuration-server). После этого виртуальная машина появится в списке на портале.

### <a name="troubleshoot-protected-virtual-machines-greyed-out-in-the-portal"></a>Troubleshoot защищены виртуальные машины серый в портале

Виртуальные машины, которые реплицируются Site Recovery, недоступны на портале Azure, если в системе существуют повторяющиеся записи. Чтобы узнать, как удалить устаревшие записи и решить проблему, обратитесь к [Azure сайта Восстановление VMware-к-Azure: Как очистить дубликаты или устаревшие записи](https://social.technet.microsoft.com/wiki/contents/articles/32026.asr-vmware-to-azure-how-to-cleanup-duplicatestale-entries.aspx).

## <a name="no-crash-consistent-recovery-point-available-for-the-vm-in-the-last-xxx-minutes"></a>Нет точки аварийного восстановления, доступной для VM в последние "XXX" минут

Ниже приведены некоторые из наиболее распространенных проблем,

### <a name="initial-replication-issues-error-78169"></a>Первоначальные проблемы репликации (ошибка 78169)

Над выше, гарантируя, что нет подключения, пропускной способности или синхронизации времени, связанные с вопросами, убедитесь, что:

- Никакое антивирусное программное обеспечение не блокирует восстановление сайта Azure. Узнайте [больше](vmware-azure-set-up-source.md#azure-site-recovery-folder-exclusions-from-antivirus-program) об исключениях папок, необходимых для восстановления сайта Azure.

### <a name="source-machines-with-high-churn-error-78188"></a>Исходные машины с высоким оттоком (ошибка 78188)

Возможные причины:
- Скорость изменения данных (запись байт/сек) на перечисленных дисках виртуальной машины больше, чем [поддерживаемые Azure Site Recovery пределы](site-recovery-vmware-deployment-planner-analyze-report.md#azure-site-recovery-limits) для типа учетной записи целевого хранилища репликации.
- Существует внезапный скачок в скорости оттока, из-за которого большой объем данных находится на рассмотрении для загрузки.

Чтобы устранить проблему:
- Убедитесь, что тип целевого счета хранения (Standard или Premium) подготовлен в рамках требования к коэффициенту оттока в источнике.
- Если вы уже копируете на управляемый диск Premium (тип asrseeddisk), убедитесь, что размер диска поддерживает наблюдаемую скорость оттока в зависимости от лимитов восстановления сайта. При необходимости можно увеличить размер ассидного диска. Сделайте следующее:
    - Перейдите к лезвию дисков реплицированной реплицированной машины и скопируйте имя диска реплики
    - Перейдите на этот диск, управляемый репликой
    - На лезвии Обзора может быть вид баннера, в котором говорится, что URL SAS был создан. Нажмите на этот баннер и отмените экспорт. Игнорировать этот шаг, если вы не видите баннер.
    - Как только URL SAS отменяется, перейдите на лезвие конфигурации управляемого диска и увеличьте размер так, чтобы ASR поддерживал наблюдаемую скорость оттока на исходном диске
- Если наблюдаемый отток носит временный характер, подождите несколько часов, пока не будет загружена информация, чтобы наверстать упущенное и создать точки восстановления.
- Если диск содержит некритические данные, такие как временные журналы, тестовые данные и т.д., рассмотрите возможность переноса этих данных в другое место или полностью исключить этот диск из репликации
- Если проблема продолжает сохраняться, используйте [планировщик развертывания](site-recovery-deployment-planner.md#overview) site Recovery, чтобы помочь спланировать репликацию.

### <a name="source-machines-with-no-heartbeat-error-78174"></a>Исходные машины без сердцебиения (ошибка 78174)

Это происходит, когда агент Azure Site Recovery Mobility на машине Исходного не общается с сервером конфигурации (CS).

Чтобы решить проблему, используйте следующие шаги для проверки подключения сети от источника VM к Config Server:

1. Убедитесь, что машина Исхода работает.
2. Войти на машину Исходного кода с помощью учетной записи с привилегиями администратора.
3. Убедитесь, что следующие службы работают, и если не перезапустить службы:
   - Svagents (InMage Scout VX Agent);
   - служба приложений InMage Scout;
4. На Машине Источника изучите журналы на месте для получения сведений об ошибках:

       C:\Program Files (X86)\Microsoft Azure Site Recovery\agent\svagents*log

### <a name="process-server-with-no-heartbeat-error-806"></a>Процесс сервера без сердцебиения (ошибка 806)
В случае, если нет сердцебиения от process Server (PS, проверьте, что:
1. PS VM запущен и работает
2. Проверьте следующие журналы на PS для получения сведений об ошибках:

       C:\ProgramData\ASR\home\svsystems\eventmanager*.log
       and
       C:\ProgramData\ASR\home\svsystems\monitor_protection*.log

### <a name="master-target-server-with-no-heartbeat-error-78022"></a>Мастер-целевой сервер без сердцебиения (ошибка 78022)

Это происходит, когда агент по восстановлению сайта Azure в Основной целевой объект не общается с сервером конфигурации.

Чтобы решить проблему, используйте следующие шаги для проверки состояния службы:

1. Убедитесь, что работает Master Target VM.
2. Войти на Master Target VM с помощью учетной записи с привилегиями администратора.
    - Убедитесь, что служба svagents работает. Если он запущен, перезапустите службу
    - Проверьте журналы на месте для получения информации об ошибках:

          C:\Program Files (X86)\Microsoft Azure Site Recovery\agent\svagents*log
3. Чтобы зарегистрировать master target с сервером конфигурации, перейдите в папку **%PROGRAMDATA%-ASR-Agent**и запустите следующий запрос команды:
   ```
   cmd
   cdpcli.exe --registermt

   net stop obengine

   net start obengine

   exit
   ```

## <a name="error-id-78144---no-app-consistent-recovery-point-available-for-the-vm-in-the-last-xxx-minutes"></a>Id ошибки 78144 - Нет приложения последовательной точки восстановления доступны для VM в последние 'XXX' минут

Были внесены улучшения в версиях агента мобильности [9.23](vmware-physical-mobility-service-overview.md#mobility-service-agent-version-923-and-higher) & [9.27](site-recovery-whats-new.md#update-rollup-39) для обработки поведения сбоя установки VSS. Убедитесь, что вы находитесь на последних версиях для лучшего руководства по устранению неполадок VSS сбоев.

Ниже приведены некоторые из наиболее распространенных проблем,

#### <a name="cause-1-known-issue-in-sql-server-20082008-r2"></a>Причина 1: Известная проблема на сервере S'L 2008/2008 R2
**Как исправить** : Существует известная проблема с сервером S'L 2008/2008 R2. Пожалуйста, назови эту статью KB [Azure Site Recovery Agent или другой некомпонентный резервную систему VSS, не имеющем стаи для сервера, хозяйничающего S'L Server 2008 R2](https://support.microsoft.com/help/4504103/non-component-vss-backup-fails-for-server-hosting-sql-server-2008-r2)

#### <a name="cause-2-azure-site-recovery-jobs-fail-on-servers-hosting-any-version-of-sql-server-instances-with-auto_close-dbs"></a>Причина 2: Задания по восстановлению сайта Azure не сбой на серверах, где размещается любая версия экземпляров S'L Server с AUTO_CLOSE DB
**Как исправить** : Ссылка Kb [статьи](https://support.microsoft.com/help/4504104/non-component-vss-backups-such-as-azure-site-recovery-jobs-fail-on-ser)


#### <a name="cause-3-known-issue-in-sql-server-2016-and-2017"></a>Причина 3: Известная проблема в сервере S'L 2016 и 2017
**Как исправить** : Ссылка Kb [статьи](https://support.microsoft.com/help/4493364/fix-error-occurs-when-you-back-up-a-virtual-machine-with-non-component)


### <a name="more-causes-due-to-vss-related-issues"></a>Другие причины из-за проблем, связанных с VSS:

Чтобы устранить неполадки, Проверьте файлы на исходной машине, чтобы получить точный код ошибки для сбоя:

    C:\Program Files (x86)\Microsoft Azure Site Recovery\agent\Application Data\ApplicationPolicyLogs\vacp.log

Как найти ошибки в файле?
Поиск строки "vacpError", открыв файл vacp.log в редакторе

    Ex: vacpError:220#Following disks are in FilteringStopped state [\\.\PHYSICALDRIVE1=5, ]#220|^|224#FAILED: CheckWriterStatus().#2147754994|^|226#FAILED to revoke tags.FAILED: CheckWriterStatus().#2147754994|^|

В приведенном выше примере **2147754994** код ошибки, который говорит вам о сбое, как показано ниже

#### <a name="vss-writer-is-not-installed---error-2147221164"></a>Писатель VSS не установлен - Огонек No 2147221164

*Как исправить*: Для создания тега согласованности приложений Azure Site Recovery использует службу копирования Microsoft Volume Shadow (VSS). Он устанавливает vsS Provider для своей работы, чтобы сделать снимки согласованности приложений. Этот поставщик VSS устанавливается как услуга. В случае, если услуга VSS Provider не установлена, создание моментального снимка согласованности приложения завершается неудачей с идентификатором ошибки 0x80040154 "Класс не зарегистрирован". </br>
Refer [article for VSS writer installation troubleshooting](https://docs.microsoft.com/azure/site-recovery/vmware-azure-troubleshoot-push-install#vss-installation-failures)

#### <a name="vss-writer-is-disabled---error-2147943458"></a>Писатель VSS отключен - Огонек No 2147943458

**Как исправить**: Для создания тега согласованности приложений Azure Site Recovery использует службу копирования Microsoft Volume Shadow (VSS). Он устанавливает vsS Provider для своей работы, чтобы сделать снимки согласованности приложений. Этот поставщик VSS устанавливается как услуга. В случае отключения службы VSS Provider создание моментального снимка согласованности не справляется с идентификатором ошибки "Указанная служба отключена и не может быть запущена (0x80070422)". </br>

- Если VSS отключен,
    - Убедитесь, что тип запуска службы VSS Provider настроен на **автоматическое.**
    - Перезапустите следующие службы:
        - Услуга VSS
        - поставщик VSS Azure Site Recovery.
        - Сервис VDS

####  <a name="vss-provider-not_registered---error-2147754756"></a>VSS PROVIDER NOT_REGISTERED - Ошибка 2147754756

**Как исправить**: Для создания тега согласованности приложений Azure Site Recovery использует службу копирования Microsoft Volume Shadow (VSS).
Проверьте, установлена ли служба Azure Site Recovery VSS Provider или нет. </br>

- Повторите установку поставщика, используя следующие команды:
- Неустановимый существующий провайдер: C:'Программные файлы (x86)»Microsoft Azure Site Recovery-InMageVSSProvider_Uninstall.cmd
- Переустановка: C:'Файлы программы (x86)»Microsoft Azure Восстановление сайта»-агентInMageVSSProvider_Install.cmd

Убедитесь, что тип запуска службы VSS Provider настроен на **автоматическое.**
    - Перезапустите следующие службы:
        - Услуга VSS
        - поставщик VSS Azure Site Recovery.
        - Сервис VDS

## <a name="next-steps"></a>Дальнейшие действия

Если вам нужна дополнительная помощь, задайте свой вопрос на [форуме Azure Site Recovery](https://social.msdn.microsoft.com/Forums/azure/home?forum=hypervrecovmgr). У нас активное сообщество, и один из наших инженеров сможет помочь вам.
