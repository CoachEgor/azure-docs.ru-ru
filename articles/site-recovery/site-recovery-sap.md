---
title: Настройка аварийного восстановления SAP NetWeaver с восстановлением сайта Azure
description: Узнайте, как настроить аварийное восстановление для SAP NetWeaver с помощью восстановления сайта Azure.
author: sideeksh
manager: rochakm
ms.topic: how-to
ms.date: 11/27/2018
ms.openlocfilehash: 29acd1b00d23e4f1c2f241027dadbbb406e5e049
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77190800"
---
# <a name="set-up-disaster-recovery-for-a-multi-tier-sap-netweaver-app-deployment"></a>Настройка аварийного восстановления для многоуровневого развертывания приложения SAP NetWeaver

Для большинства развертываний большого и среднего размера SAP используется какая-либо разновидность решения аварийного восстановления. По мере переноса все большего числа ключевых бизнес-процессов в такие приложения, как SAP, повысилась важность надежных и тестируемых решений аварийного восстановления. Azure Site Recovery был протестирован и интегрирован с приложениями SAP. Восстановление сайта превышает возможности большинства решений по восстановлению после стихийных бедствий на местах и при меньших суммарных затратах на владение, чем конкурирующие решения.

Служба Site Recovery предоставляет следующие возможности:
* защита рабочих приложений SAP NetWeaver и других приложений, запущенных в локальной среде, с помощью репликации компонентов в Azure;
* защита рабочих приложений SAP NetWeaver и других приложений, запущенных в Azure, с помощью репликации компонентов в другой центр обработки данных Azure;
* упрощение миграции в облако благодаря использованию Site Recovery для переноса развертывания SAP в Azure;
* Упростите обновление, тестирование и прототипирование проектов SAP, создав производственный клон по требованию для тестирования приложений SAP.

Вы можете защитить развертывание приложений SAP NetWeaver с помощью [восстановления сайта Azure.](site-recovery-overview.md) В этой статье рассматриваются рекомендации по защите трехуровневого развертывания SAP NetWeaver в Azure при репликации в другой центр обработки данных Azure с помощью восстановления сайта. В статье описаны поддерживаемые сценарии и конфигурации, а также как сделать тестовые неудачи (упражнения для аварийного восстановления) и фактические сбой.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать, необходимо знать, как выполнять следующие задачи:

* [Репликация виртуальной машины в Azure](azure-to-azure-walkthrough-enable-replication.md).
* [Проектирование сети для аварийного восстановления](site-recovery-azure-to-azure-networking-guidance.md)
* [Выполнение тестовой отработки отказа в Azure](azure-to-azure-walkthrough-test-failover.md).
* [Выполнение отработки отказа в Azure](site-recovery-failover.md).
* [Репликация контроллера домена](site-recovery-active-directory.md)
* [Повторите экземпляр сервера S'L](site-recovery-sql.md)

## <a name="supported-scenarios"></a>Поддерживаемые сценарии

С помощью Site Recovery можно реализовать решение аварийного восстановления для приведенных ниже сценариев:
* В одном центре обработки данных Azure работают системы SAP, и они реплицируется в другой центр обработки данных Azure (восстановление аварийности Azure-to-Azure). 
   Дополнительные сведения см. в статье [Azure to Azure replication architecture](https://aka.ms/asr-a2a-architecture) (Архитектура репликации из Azure в Azure).
* У вас есть системы SAP, работающие на vMware (или физических) серверах на месте. Вы также воспроизводите системы SAP в место аварийного восстановления в центре обработки данных Azure (VMware-to-Azure disaster recovery). 
   Данному сценарию требуются некоторые дополнительные компоненты. Дополнительные сведения см. в статье [Архитектура репликации из VMware в Azure](https://aka.ms/asr-v2a-architecture).
* У вас есть системы SAP, работающие на Hyper-V на месте. Вы также воспроизводите системы SAP в место аварийного восстановления в центре обработки данных Azure (Hyper-V-to-Azure disaster recovery).
   Данному сценарию требуются некоторые дополнительные компоненты. Дополнительные сведения см. в статье [Архитектура репликации из Hyper-V в Azure](https://aka.ms/asr-h2a-architecture).

В этой статье мы используем сценарий аварийного восстановления **Azure-to-Azure.** Сценарий показывает возможности sAP аварийного восстановления восстановления сайта. Так как репликация Site Recovery не относится к приложению, описанный процесс применим к другим сценариям.

### <a name="required-foundation-services"></a>Требуемые основные службы
В сценарии, описанном в этой статье, развертываются следующие основные службы:
* Azure ExpressRoute или VPN-шлюз Azure;
* По крайней мере один контроллер домена Active Directory Azure и DNS-сервер, работающий в Azure

Рекомендуем развернуть эту инфраструктуру перед развертыванием Site Recovery.

## <a name="reference-sap-application-deployment"></a>Развертывание эталонного приложения SAP

Эта эталонная архитектура работает под управлением SAP NetWeaver в среде Windows в Azure с высокой доступностью. Эта архитектура развертывается с определенными размерами виртуальной машины (VM), которые можно изменить с учетом потребностей организации.

![Схема обычного шаблона развертывания SAP](./media/site-recovery-sap/sap-netweaver_latest.png)

## <a name="disaster-recovery-considerations"></a>Рекомендации по аварийному восстановлению

Для аварийного восстановления, вы должны быть в состоянии потерпеть неудачу в вторичном регионе. Каждый уровень использует другую стратегию для обеспечения защиты от аварийного восстановления.

#### <a name="vms-running-sap-web-dispatcher-pools"></a>VMs работает SAP веб диспетчербассейны

Компонент Web Dispatcher работает как баланселизатор нагрузки для трафика SAP среди серверов приложений SAP. Для обеспечения высокой доступности компонента Web Dispatcher Azure Load Balancer реализует параллельную настройку Web Dispatcher. Web Dispatcher использует круговую конфигурацию для распределения трафика HTTP(S среди доступных веб-диспетчеров в пуле балансеров.

#### <a name="vms-running-application-servers-pools"></a>VMs работает пулы серверов приложений
Транзакция SMLG управляет группами входа для серверов приложений ABAP. Он использует функцию балансировки нагрузки на сервере сообщений Центральных служб для распределения рабочей нагрузки между пулами серверов приложений SAP для SAPGUIs и трафика RFC. Вы можете воспроизвести это управление с помощью восстановления сайта.

#### <a name="vms-running-sap-central-services-clusters"></a>VMs, работающие с кластерами SAP Central Services
Эта эталонная архитектура запускает центральные службы на виртуальных машинах на уровне приложений. Центральные службы — это потенциальная единая точка сбоя, когда в одном VM. Типичное развертывание и высокая доступность не являются требованиями.

Для реализации решения высокой доступности можно использовать кластер общего диска или кластер совместного использования файлов. Чтобы настроить виртуальные машины для кластера общих дисков, используйте отказоустойчивый кластер Windows Server. Мы рекомендуем использовать свидетель кулачку в качестве свидетеля кворума.

 > [!NOTE]
 > Поскольку восстановление сайта не повторяет заверестья облака, мы рекомендуем развернуть свидетель облако в зоне аварийного восстановления.

Для поддержки кластерной среды [SIOS DataKeeper Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) выполняет функцию совместного объема кластера кластера. В функции кластер SIOS DataKeeper реплицирует независимые диски, принадлежащие кластерным узлам. Поскольку Azure не поддерживает общие диски, для этого требуются решения, предоставляемые SIOS.

Можно также обрабатывать кластеризм, реализуя кластер совместного файла. В [SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster) недавно изменили шаблон развертывания центральных служб для доступа к глобальным каталогам /sapmnt через UNC-путь. Мы по-прежнему рекомендуем вам убедиться, что /sapmnt ДОЛЯ КООН очень доступна. Вы можете проверить экземпляр Центральных служб. Используйте windows Server Failover Cluster с масштабированием файлового сервера (SOFS) и функцией «Прямая помощь для хранения данных» (S2D) в Windows Server 2016.

 > [!NOTE]
 > Восстановление сайта в настоящее время поддерживает только краш-согласованное репликацию виртуальных машин, которые используют непосредственное пространство для хранения данных и пассивный узел sIOS Datakeeper.


## <a name="more-disaster-recovery-considerations"></a>Больше соображений аварийного восстановления

Вы можете использовать восстановление сайта для организации сбоя полного развертывания SAP в регионах Azure.
Ниже приведены меры по настройке аварийного восстановления:

1. Репликация виртуальных машин
1. Проектирование сети для аварийного восстановления
1. Репликация контроллера домена
1. Репликация уровня базы данных
1. Выполнение тестовой отработки отказа
1. Выполнение отработки отказа

Ниже приведена рекомендация для аварийного восстановления каждого уровня, используемого в этом примере.

 **Уровни SAP** | **Рекомендации**
 --- | ---
**Пул Диспетчера SAP Web** |  Повторите с помощью восстановления сайта 
**Пул серверов приложений SAP** |  Повторите с помощью восстановления сайта 
**Кластер центральных служб SAP** |  Повторите с помощью восстановления сайта 
**Виртуальные машины Active Directory** |  Использование репликации Active каталога 
**Серверы базы данных S'L** |  Используйте сервер S'L Всегда при репликации

## <a name="replicate-virtual-machines"></a>Репликация виртуальных машин

Чтобы начать, репликацию всех виртуальных машин приложений SAP в центре обработки данных аварийного восстановления Azure, следуйте указаниям в статье о [репликации виртуальных машин в Azure](azure-to-azure-walkthrough-enable-replication.md).

* Для получения рекомендаций по защите Active Directory и DNS узнайте, [как защитить Active Directory и DNS.](site-recovery-active-directory.md)

* Для получения рекомендаций по защите уровня базы данных, работающего на сервере S'L, узнайте, [как защитить сервер S'L](site-recovery-sql.md)Server.

## <a name="networking-configuration"></a>Конфигурация сети

Если используется статический IP-адрес, вы можете указать нужный IP-адрес для виртуальной машины. Чтобы установить IP-адрес, перейдите на вычислительные **и сетевые настройки** > **сети интерфейсной карты.**

![Снимок экрана, показывающий, как установить частный IP-адрес в области карты сетевого интерфейса Site Recovery](./media/site-recovery-sap/sap-static-ip.png)


## <a name="create-a-recovery-plan"></a>Создайте план восстановления

План восстановления позволяет воссоздать последовательность различных уровней в многоуровневом приложении во время отработки отказа. Благодаря этому обеспечивается целостность на уровне приложения. При создании плана восстановления для многоуровневого веб-приложения выполните действия, описанные в [этой статье](site-recovery-create-recovery-plans.md).

### <a name="add-virtual-machines-to-failover-groups"></a>Добавление виртуальных машин в группы отработки отказа

1. Создайте план восстановления, добавив сервер приложения, веб-диспетчера и SAP Central сервисов VMs.
1. Выберите **настроить** для группы VMs. По умолчанию все ВМ являются частью группы 1.

### <a name="add-scripts-to-the-recovery-plan"></a>Добавление сценариев в план восстановления
Для правильного функционирования приложений может потребоваться несколько операций на виртуальных машинах Azure. Делайте эти операции после сбоя или во время тестового сбоя. Вы также можете автоматизировать некоторые операции после неудачи. Например, обновите вход DNS и измените привязки и соединения, добавив соответствующие скрипты в план восстановления.

Наиболее часто используемые скрипты восстановления сайта можно развернуть в учетную запись Azure Automation, выбрав **развертывание в Azure.** При использовании любого опубликованного сценария следуйте указаниям в скрипте.

[![Развертывание в Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)

1. Добавьте сценарий предварительного действия в группу 1, чтобы сбой в группе доступности сервера S'L. Используйте сценарий ASR-S'L-FailoverAG, опубликованный в образцах скриптов. Следуйте инструкциям в скрипте и внося необходимые изменения в сценарий надлежащим образом.
1. Добавьте скрипт после действия, чтобы прикрепить баланселистер нагрузки к неисправимым виртуальным машинам веб-уровня (Группа 1). Используйте сценарий ASR-AddSingleLoadBalancer, опубликованный в образцах скриптов. Следуйте инструкциям в скрипте и внедне необходимые изменения в сценарий по мере необходимости.

![План восстановления SAP](./media/site-recovery-sap/sap_recovery_plan.png)


## <a name="run-a-test-failover"></a>Запуск тестовой отработки отказа

1. На портале Azure выберите хранилище служб восстановления.
1. Выберите план восстановления, созданный для приложений SAP.
1. Выберите **Тестовая отработка отказа**.
1. Чтобы запустить тестовую отработку отказа, выберите точку восстановления и виртуальную сеть Azure.
1. После запуска вторичной среды можно выполнить проверку.
1. Когда проверка завершена, очистите среду отказа, выбрав **тест Cleanup failover.**

Дополнительные сведения см. в статье [Тестовая отработка отказа в Azure с помощью Site Recovery](site-recovery-test-failover-to-azure.md).

## <a name="run-a-failover"></a>Запуск отработки отказа

1. На портале Azure выберите хранилище служб восстановления.
1. Выберите план восстановления, созданный для приложений SAP.
1. Выберите **Отработка отказа**.
1. Чтобы запустить отработку отказа, выберите точку восстановления.

Дополнительные сведения см. в статье [Отработка отказа в Site Recovery](site-recovery-failover.md).

## <a name="next-steps"></a>Дальнейшие действия
* Подробнее о создании решения для аварийного восстановления для развертывания SAP NetWeaver с помощью восстановления сайта. Смотрите загружаемую белую бумагу [SAP NetWeaver: Создание решения для аварийного восстановления с восстановлением сайта.](https://aka.ms/asr_sap) В «Белом документе» рассматриваются рекомендации для различных архитектур SAP. Вы можете видеть поддерживаемые приложения и типы VM для SAP на Azure. Существуют также варианты планирования для тестирования решения для аварийного восстановления.
* Узнайте больше о [репликации других рабочих нагрузок](site-recovery-workload.md) с помощью Site Recovery.
