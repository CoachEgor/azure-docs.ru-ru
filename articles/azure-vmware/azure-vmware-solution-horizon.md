---
title: Развертывание горизонта в решении VMware для Azure
description: Узнайте, как развернуть горизонт VMware в решении VMware для Azure.
ms.topic: how-to
ms.date: 09/29/2020
ms.openlocfilehash: bda4be049e360670cb7038bfbb3070c2a5f262c4
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91729055"
---
# <a name="deploy-horizon-on-azure-vmware-solution"></a>Развертывание горизонта в решении VMware для Azure 

>[!NOTE]
>В этом документе рассматривается продукт VMware горизонт. Прежде чем изменить название продукта с горизонта 7 на горизонт, он назывался горизонтом 7. Горизонт — это решение, которое отличается от использования облака горизонта в Azure, хотя существуют некоторые общие компоненты. Основные преимущества решения VMware для Azure включают в себя и более простой метод изменения размера, а также интеграцию управления VMware Cloud Foundation в портал Azure.

® [VMware горизонт](https://www.vmware.com/products/horizon.html)— это платформа виртуальных рабочих столов и приложений, которая работает в центре обработки данных и обеспечивает простое и централизованное управление. Она предоставляет виртуальным рабочим столам и приложениям конечным пользователям на любом устройстве в любом месте. Горизонт позволяет создавать подключения к виртуальным рабочим столам Windows, виртуальным рабочим столам Linux, размещенным в удаленный рабочий стол Server (RDS) приложениям, настольным компьютерам и физическим компьютерам.

Здесь основное внимание уделяется разработке горизонта развертывания в решении VMware для Azure. Общие сведения о горизонте VMware см. в рабочей документации по горизонту.

* [Что такое горизонт VMware?](https://www.vmware.com/products/horizon.html)

* [Дополнительные сведения о горизонте VMware](https://docs.vmware.com/en/VMware-Horizon/index.html)

* [Эталонная архитектура горизонта](https://techzone.vmware.com/resource/workspace-one-and-horizon-reference-architecture)

С введением в горизонт для решения VMware Azure теперь существует два решения инфраструктуры виртуальных рабочих столов (VDI) на платформе Azure. На следующей схеме показаны основные различия на высоком уровне.

:::image type="content" source="media/horizon/difference-horizon-azure-vmware-solution-horizon-cloud-azure.png" alt-text="Различия между горизонтом в решении Azure VMware и облаком горизонта в Azure" border="false":::

Горизонт 2006 и более поздних версий в строке выпуска горизонта 8 поддерживает локальное развертывание и развертывание решения VMware для Azure. Существует несколько функций горизонта, которые поддерживаются локально, но не в решении VMware для Azure. Также поддерживаются дополнительные продукты в экосистеме горизонта. Дополнительные сведения см. в разделе [четность и взаимодействие компонентов](https://kb.vmware.com/s/article/80850).

## <a name="deploy-horizon-in-a-hybrid-cloud"></a>Развертывание горизонта в гибридном облаке

Вы можете развернуть горизонт в гибридной облачной среде при использовании архитектуры Cloud Pod (CPA) на основе горизонта для подключения к локальным центрам обработки данных и центрам вычислений Azure. CPA обычно используется для увеличения масштаба развертывания, создания гибридного облака и обеспечения отказоустойчивости непрерывности бизнес-процессов и аварийного восстановления. Подробное обсуждение рекомендаций по обеспечению непрерывности бизнес-процессов VMware горизонта см. в разделе [развертывание существующих сред с горизонтом 7](https://techzone.vmware.com/resource/business-continuity-vmware-horizon#_Toc41650874).

>[!IMPORTANT]
>CPA не является растянутым развертыванием; Каждый модуль горизонта является отдельным, и все серверы подключения, относящиеся к каждому из отдельных модулей Pod, должны находиться в одном расположении и выполняться в одном и том же домене вещания с точки зрения сети.

Как и в локальном, так и в частном центре обработки данных, горизонт можно развернуть в частном облаке решения Azure VMware. Мы обсудим ключевые отличия в локальной среде развертывания и решении VMware для Azure в следующих разделах.

Частное облако Azure концептуально аналогично тому, что и VMware SDDC — термин, который обычно используется в документации по горизонту. Оставшаяся часть документа будет использовать взаимозаменяемые частное облако Azure и VMware SDDC.

Облачный соединитель горизонта необходим для планирования решения Azure VMware на управление лицензиями на подписки. Облачный соединитель можно развернуть в виртуальной сети Azure вместе с серверами подключения горизонта.

>[!IMPORTANT]
>Поддержка горизонта управления горизонтом в решении VMware для Azure пока недоступна. Не забудьте скачать VHD-версию соединителя горизонта для облака.

## <a name="vcenter-cloud-admin-role"></a>роль администратора облака vCenter

Так как решение VMware Azure — это служба SDDC, а Azure управляет жизненным циклом решения "SDDC в Azure VMware", модель разрешений vCenter в решении Azure VMware ограничена конструкцией.

Клиентам необходимо использовать роль администратора облака, имеющую ограниченный набор разрешений vCenter. Продукт горизонта был изменен для работы с ролью администратора облака в решении VMware для Azure, в частности:

* Мгновенная подготовка клонов была изменена для запуска в решении VMware для Azure.

* Определенная политика vSAN (VMware_Horizon) была создана в решении Azure VMware для работы с горизонтом, который должен быть доступен и использован в Сддкс, развернутом для горизонта.

* Кэш чтения на основе содержимого vSphere (КБРК), также известный как ускоритель хранилища, отключается при работе в решении Azure VMware.

>[!IMPORTANT]
>КБРК не должен быть включен снова.

>[!NOTE]
>Решение Azure VMware автоматически настраивает определенные параметры горизонта при условии развертывания горизонта 2006 (с горизонтом 8) и выше в ветви горизонта 8 и выборе параметра **Azure** в установщике сервера подключения горизонта.

## <a name="horizon-on-azure-vmware-solution-deployment-architecture"></a>Горизонт архитектуры развертывания решения VMware в Azure

В типичном проекте архитектуры горизонта используется модель Pod и блочная стратегия. Блок — это один vCenter, в то время как несколько блоков составляют модуль. Модуль горизонта — это единица Организации, определяемая ограничениями масштабируемости горизонта. Каждый модуль каждого из них имеет отдельный портал управления, поэтому Стандартная методика проектирования заключается в том, чтобы максимально сокращать количество модулей Pod.

Каждое облако имеет собственную схему сетевого подключения. В сочетании с сетевыми подключениями VMware SDDC или НСКС пограничным сетевым подключением Azure VMware предоставляются уникальные требования к развертыванию горизонта, отличного от локального.

Каждое частное облако Azure (SDDC) может обрабатывать 4 000 рабочих столов или сеансов приложений, что предполагает следующее:

* Трафик рабочей нагрузки соответствует Логинвси рабочему профилю задачи.

* Учитывается только трафик протокола, данные пользователя отсутствуют.

* НСКС граница настроена как крупная.

>[!NOTE]
>Профиль рабочей нагрузки и потребности могут отличаться, поэтому результаты могут отличаться в зависимости от вашего варианта использования. В контексте рабочей нагрузки объем пользовательских томов данных может быть меньше ограничения. Измените размер и Спланируйте развертывание соответствующим образом. Дополнительные сведения см. в разделе изменение размера в [узлах решения Azure VMware для развертываний горизонта](#size-azure-vmware-solution-hosts-for-horizon-deployments) .

Учитывая максимальное ограничение для частного облака Azure или SDDC, мы рекомендуем использовать архитектуру развертывания, в которой серверы подключения горизонта и шлюзы унифицированного доступа VMware (УАГС) выполняются в виртуальной сети Azure. Это эффективно превращает каждое частное облако или SDDC Azure в блок. Это, в свою очередь, увеличивает масштабируемость горизонта, выполняющегося в решении Azure VMware.

Подключение из виртуальной сети Azure к частным облакам Azure или Сддкс должно быть настроено с помощью ExpressRoute Фастпас. На следующей схеме показано развертывание модуля Pod с базовым горизонтом.

:::image type="content" source="media/horizon/horizon-pod-deployment-expresspath-fast-path.png" alt-text="Различия между горизонтом в решении Azure VMware и облаком горизонта в Azure" border="false":::

## <a name="network-connectivity-to-scale-horizon-on-azure-vmware-solution"></a>Сетевое подключение к горизонту масштабирования в решении Azure VMware

В этом разделе рассматривается архитектура сети на высоком уровне для масштабирования горизонта в решении Azure VMware с помощью некоторых распространенных примеров развертывания. Здесь основное внимание уделяется важнейшим элементам сети.

### <a name="single-horizon-pod-on-azure-vmware-solution"></a>Модуль с одним горизонтом в решении VMware для Azure

:::image type="content" source="media/horizon/single-horizon-pod-azure-vmware-solution.png" alt-text="Различия между горизонтом в решении Azure VMware и облаком горизонта в Azure" border="false":::

Один модуль горизонта — это наиболее прямой сценарий прямого развертывания. В этом примере вы решили развернуть только один модуль горизонта в Восточном регионе США. Так как каждое частное облако или SDDC оценивается приблизительно как обрабатывающий трафик 4 000 сеансов рабочего стола, для развертывания максимального размера Pod, можно спланировать развертывание до трех частных облаков или Сддкс.

Поэтому в этом примере в сочетании с виртуальными машинами инфраструктуры горизонта, развернутыми в виртуальной сети Azure, вы можете получить доступ к каждому модулю 12 000 сеансов на каждый из них в зависимости от потребностей рабочей нагрузки и данных. Подключение между частным облаком и SDDC и виртуальной сетью Azure — это быстрый путь ExpressRoute, в котором не требуется трафик восточной части между частными облаками.

Основные предположения для этого базового примера развертывания включают следующее:

* У вас нет локального модуля горизонта, который вы хотите подключить к этому новому Pod с помощью архитектуры Cloud Pod (CPA).

* Конечные пользователи подключаются к виртуальным рабочим столам через Интернет (VS. подключение через локальный центр обработки данных).

В этом базовом примере можно подключить контроллер домена AD в виртуальной сети Azure к локальной Active Directory через VPN или канал ExpressRoute.

Вариант, описанный в основном примере, может поддерживать подключение к локальным ресурсам. Это может быть пользователь, обращающийся к рабочим столам и создающий трафик приложений виртуального рабочего стола или подключающийся к локальному модулю горизонта с помощью CPA.

На схеме ниже показано, как это можно сделать.Чтобы подключить корпоративную сеть к виртуальной сети Azure, вам потребуется ExpressRoute.Кроме того, вам потребуется подключить корпоративную сеть к каждому частному облаку или Сддкс с помощью Global Reach, что обеспечивает подключение из SDDC к ExpressRoute и локальным ресурсам.

:::image type="content" source="media/horizon/connect-corporate-network-azure-virtual-network.png" alt-text="Различия между горизонтом в решении Azure VMware и облаком горизонта в Azure" border="false":::

### <a name="multiple-horizon-pods-on-azure-vmware-solution-across-multiple-regions"></a>Несколько многогоризонтических модулей Pod в решении Azure VMware в нескольких регионах

В качестве примера для другого объекта Pod рассмотрим пример, демонстрирующий горизонт масштабирования для нескольких модулей.В этом примере выполняется развертывание двух модулей Pod в двух разных регионах и их Федерацию с помощью CPA.Конфигурация сети похожа на предыдущий пример с некоторыми дополнительными связями между регионами. 

Вам потребуется подключить виртуальную Входящий сетевой трафик Azure к частным облакам или Сддкс в другом регионе, чтобы серверы подключения горизонта, которые являются частью Федерации CPA, подключались ко всем настольным компьютерам в среде управления.Добавление дополнительных частных облаков или Сддкс в эту конфигурацию позволит вам масштабировать до 24 000 сеансов в целом. 

Хотя в этом примере показано несколько регионов, при необходимости развертывания двух модулей Pod в одном регионе применяется один и тот же принцип. Обратите внимание, что второй модуль горизонта должен быть развернут в *отдельной виртуальной сети Azure*.Наконец, как и в предыдущем примере с одним модулем, вы можете подключить корпоративную сеть и локальный модуль к этому примеру с несколькими модулями или регионами с помощью ExpressRoute и Global Reach.

:::image type="content" source="media/horizon/multiple-horizon-pod-azure-vmware-solution.png" alt-text="Различия между горизонтом в решении Azure VMware и облаком горизонта в Azure" border="false":::

## <a name="size-azure-vmware-solution-hosts-for-horizon-deployments"></a>Изменение размера узлов решения Azure VMware для развертываний горизонта 

Методология изменения размера горизонта на узле, работающем в решении VMware для Azure, проще, чем в локальной среде, так как экземпляр узла решения VMware Azure является стандартизированным. Точный размер узла поможет определить количество узлов, необходимых для поддержки требований VDI, и является центральным для определения затрат на Рабочий стол.

### <a name="azure-vmware-solution-host-instance"></a>Экземпляр узла решения VMware Azure

* Сервер PowerEdge R640 Server-DSS с ОГРАНИЧЕНным доступом

* 36 ядер \@ 2.3 ГГц

* 576 ГБ ОЗУ

* Контроллер HBA SAS HBA330 12 Гбит/с (не RAID)

* 1,92-SSD-твердотельный накопитель SATA с 6 Гбит/с 512 2.5 в горячей подключаемой накопителе AG, 3 ДВПД, 10512 ТБВ

* Intel 1,6 ТБ, NVMe, смешанное использование Express Flash, 2,5 СФФ Drive, U. 2, P4600 с перевозчиком

* 2 vSAN группы дисков: 1,6 x 4 (1.92 ТБ)

### <a name="horizon-sizing-inputs"></a>Входные данные изменения размера горизонта

Найдите следующие сведения о запланированной рабочей нагрузке.

* Число одновременных настольных систем

* Обязательный виртуальных ЦП на Рабочий стол

* Требуемая видеопамять на Рабочий стол

* Требуемое хранилище на Рабочий стол

Как правило, развертывания VDI — это ограничение в ЦП или ОЗУ, так как эти факторы определяют размер узла. Рассмотрим следующий пример для рабочего типа рабочей нагрузки Логинвси Knowledge, проверенного с помощью тестирования производительности:

* 2 000 параллельное развертывание настольных систем

* 2vCPU на Рабочий стол.

* 4 Гб видеопамяти на Рабочий стол.

* 50 ГБ памяти на Рабочий стол

В этом примере общее число узлов имеет значение, равное 18, и обеспечивается плотность виртуальных машин в 111.

>[!IMPORTANT]
>Рабочие нагрузки клиента будут отличаться в этом примере для рабочей роли Логинвси Knowledge. В рамках планирования развертывания вы должны работать с SEsой VMware EUC для конкретной потребности в размере и производительности. Не забудьте запустить собственное тестирование производительности, используя реальную плановую рабочую нагрузку перед окончательным изменением размера узла и соответствующим образом изменить его.

## <a name="horizon-on-azure-vmware-solution-licensing"></a>Горизонт лицензирования решений Azure VMware 

Существует четыре компонента, которые относятся к общим затратам на выполнение горизонта в решении Azure VMware. 

### <a name="azure-vmware-solution-capacity-cost"></a>Стоимость ресурсов решения VMware для Azure

Сведения о ценах см. на странице [цен на решение VMware для Azure](https://azure.microsoft.com/pricing/details/azure-vmware/) .

### <a name="horizon-licensing-cost"></a>Стоимость лицензирования горизонта

Существует две доступные лицензии для использования с решением VMware для Azure, которое может быть одновременно одновременным пользователем (CCU) или именованным пользователем (ню):

* Лицензия на подписку горизонта

* Лицензия универсальной подписки на горизонт

Если вы развертываете горизонт в решении Azure VMware только в ожидаемом будущем, используйте лицензию на использование подписки горизонта, так как это более низкая стоимость.

Если вы разворачиваете оба горизонта в решении Azure VMware и в локальной среде, как в случае аварийного восстановления, выберите лицензию на использование универсальной подписки на горизонт. Универсальная лицензия является более выгодной, так как включает лицензию vSphere для локального развертывания.

Обратитесь к группе продаж по VMware EUC, чтобы определить стоимость лицензирования в зависимости от ваших потребностей.

### <a name="cost-of-the-horizon-infrastructure-vms-on-azure-virtual-network"></a>Стоимость виртуальных машин инфраструктуры горизонта в виртуальной сети Azure

На основе стандартной архитектуры развертывания виртуальные машины инфраструктуры горизонта состоят из серверов подключения, УАГС, диспетчеров томов приложений и развертываются в виртуальной сети Azure клиента. Дополнительные экземпляры Azure Native требуются для поддержки служб высокой доступности (HA), Microsoft SQL или Microsoft Active Directory (AD) в Azure. Ниже приведен список экземпляров Azure на основе примера развертывания 2 000-Desktop. 

| Компонент инфраструктуры горизонта | Экземпляр Azure | Необходимое количество экземпляров (для 2 000-настольных компьютеров)    | Комментарий  |
|----------------------------------|----------------|----------------------------------------------------|----------|
| Сервер подключения                | D4sv3          | 2       | *Включает 1 экземпляр для HA*             |    
| UAG                              | F2sv2          | 2       | *Включает 1 экземпляр для HA*             |
| Диспетчер томов приложений              | D4sv3          | 2       | *Включает 1 экземпляр для HA*             |
| Соединитель облака                  | D4sv3          | 1       |                                          |
| Контроллер AD                    | D4sv3          | 2       | *Возможность использования службы MSFT AD в Azure* |
| База данных MS-SQL                  | D4sv3          | 2       | *Возможность использовать службу SQL в Azure*     |
| Общая папка Windows               | D4sv3          |         | *Необязательно*                               |

Стоимость виртуальной машины инфраструктуры составляет \$ 0,36 на пользователя в месяц для развертывания 2 000-Desktop в примере выше. Обратите внимание, что в этом примере используется стоимость экземпляра Azure Восточная часть США с 2020 июня. Цены могут отличаться в зависимости от региона, выбранных параметров и времени.
