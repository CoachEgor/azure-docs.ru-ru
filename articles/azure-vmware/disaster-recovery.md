---
title: Завершение аварийного восстановления виртуальных машин
description: В этой статье показано, как выполнить аварийное восстановление виртуальных машин с помощью AVS.
ms.topic: how-to
ms.date: 05/04/2020
ms.openlocfilehash: 5ccaa009c8e3e059597636a8bb78cc3bd255fe68
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84749949"
---
# <a name="complete-a-disaster-recovery-of-virtual-machines-using-azure-vmware-solution"></a>Завершение аварийного восстановления виртуальных машин с помощью решения VMware для Azure

В этой статье описывается процесс аварийного восстановления виртуальных машин с помощью решения VMware для гибридного облака (ХККС) и использование частного облака решения Azure VMware в качестве восстановления или целевого сайта.

VMware ХККС предоставляет различные операции, обеспечивающие четкое управление и детализацию в политиках репликации. Доступные операции включают:

- Обратный — после аварии. Обратить помогает сделать сайт B исходным сайтом и сайтом, где находится Защищенная виртуальная машина.

- Пауза — Приостановка текущей политики репликации, связанной с выбранной виртуальной машиной.

- Возобновить — приостановить текущую политику репликации, связанную с выбранной виртуальной машиной.

- Удалить — удалить текущую политику репликации, связанную с выбранной виртуальной машиной.

- Синхронизация сейчас — вне связанной виртуальной машины синхронизации с защищаемой ВИРТУАЛЬНОЙ машиной.

В этом руководство рассматриваются следующие сценарии репликации:

- Защитите виртуальную машину или группу виртуальных машин.

- Выполните тестирование восстановления виртуальной машины или группы виртуальных машин.

- Восстановление виртуальной машины или группы виртуальных машин.

- Обратная Защита виртуальной машины или группы виртуальных машин.

## <a name="protect-virtual-machines"></a>Защита виртуальных машин

Войдите в **vSphere Client** на исходном сайте и получите доступ к **подключаемому модулю хккс**.

:::image type="content" source="./media/disaster-recovery/hcx-vsphere.png" alt-text="Параметр ХККС в vSphere" border="true":::

Введите область **аварийного восстановления** и щелкните **Защита виртуальных машин**.

:::image type="content" source="./media/disaster-recovery/protect-virtual-machine.png" alt-text="Выбор защиты виртуальных машин" border="true":::

В открывшемся окне выберите источник и удаленные сайты, в этом случае удаленный сайт должен быть частным облаком AVS.

:::image type="content" source="./media/disaster-recovery/protect-virtual-machines.png" alt-text="окно "Защита виртуальных машин"" border="true":::

При необходимости выберите параметры репликации по умолчанию.

- **Включить сжатие:** Рекомендуется для сценариев с низкой пропускной способностью.

- **Включить замороженной:** Приостанавливает работу виртуальной машины, чтобы обеспечить синхронизацию согласованной копии с удаленным сайтом.

- **Целевое хранилище:** Выберите удаленное хранилище данных для защищенных виртуальных машин. В частном облаке AVS этот выбор должен быть хранилищем данных vSAN.

- **Контейнер вычислений:** Удаленный кластер vSphere или пул ресурсов.

- **Конечная папка:** Папка с удаленным назначением, этот параметр является необязательным. Если папка не выбрана, виртуальные машины будут отображаться в этом списке непосредственно в выбранном кластере.

- **RPO:** Это значение представляет собой интервал синхронизации между исходной виртуальной машиной и защищенной виртуальной машиной и может находиться в любом диапазоне от 5 минут до 24 часов.

- **Интервал моментальных снимков:** Интервал между моментальными снимками.

- **Число моментальных снимков:** Общее число моментальных снимков в пределах заданного интервала моментальных снимков.

:::image type="content" source="./media/disaster-recovery/protect-virtual-machine-options.png" alt-text="параметры защиты виртуальных машин" border="true":::

Выберите одну или несколько виртуальных машин из списка и настройте для виртуальной машины необходимые параметры репликации.

По умолчанию виртуальные машины будут наследовать политику глобальных параметров, настроенную в параметрах репликации по умолчанию. Для каждого сетевого интерфейса в выбранной виртуальной машине настройте **группу удаленных сетевых портов** и нажмите кнопку **Готово** , чтобы запустить процесс защиты.

:::image type="content" source="./media/disaster-recovery/network-interface-options.png" alt-text="параметры сетевого интерфейса" border="true":::

Как показано на следующем рисунке, можно отслеживать процесс для каждой из выбранных виртуальных машин в одной области аварийного восстановления.

:::image type="content" source="./media/disaster-recovery/protect-monitor-progress.png" alt-text="мониторинг хода выполнения защиты" border="true":::

После защиты виртуальной машины на вкладке **моментальные снимки** можно просмотреть различные моментальные снимки.

:::image type="content" source="./media/disaster-recovery/list-of-snapshots.png" alt-text="список моментальных снимков" border="true":::

Желтый треугольник означает, что моментальные снимки и виртуальный объект не проверялись в ходе операции восстановления теста.

Существуют основные различия между выключенной виртуальной машиной и питанием.
На предыдущем снимке экрана показан процесс синхронизации для виртуальной машины с питанием. Процесс синхронизации запущен до завершения первого моментального снимка, который является полной копией виртуальной машины, а затем завершается в течение заданного интервала.

Для виртуальной машины с питанием будет выполнена синхронизация копии, после чего виртуальная машина будет отображаться как неактивная, а операция защиты будет показана как завершенная.

Когда виртуальная машина будет включена, она начнет синхронизацию процесса на удаленном сайте.

## <a name="complete-a-test-recover-of-virtual-machines"></a>Завершение тестового восстановления виртуальных машин

Войдите в **vSphere Client** на удаленном сайте, который является частным облаком AVS. В **подключаемом модуле хккс**в области аварийного восстановления выберите вертикальные многоточия на любой виртуальной машине, чтобы отобразить меню операции. Выберите **тест восстановить виртуальную машину**.

:::image type="content" source="./media/disaster-recovery/test-recover-virtual-machine.png" alt-text="Выбор тестового восстановления виртуальной машины" border="true":::

В новом окне выберите параметры для теста. Выберите моментальный снимок, который вы хотите использовать для проверки различных состояний виртуальной машины.

:::image type="content" source="./media/disaster-recovery/choose-snapshot.png" alt-text="выберите моментальный снимок и нажмите кнопку "тест"" border="true":::

После нажатия кнопки " **тест**" начнется операция восстановления.

После завершения операции восстановления можно проверить новую виртуальную машину в частном облаке AVS.

:::image type="content" source="./media/disaster-recovery/verify-test-recovery.png" alt-text="Проверка операции восстановления" border="true":::

После выполнения тестирования на виртуальной машине или запущенных на ней приложений выполните очистку, чтобы удалить тестовый экземпляр.

:::image type="content" source="./media/disaster-recovery/cleanup-test-instance.png" alt-text="Очистка экземпляра теста" border="true":::

## <a name="recover-virtual-machines"></a>Восстановление виртуальных машин

Войдите в **vSphere Client** на удаленном сайте, который является частным облаком AVS, и получите доступ к **подключаемому модулю хккс**.

Для сценария восстановления это группа виртуальных машин, используемых в этом примере.

Выберите виртуальную машину для восстановления из списка, откройте меню **действия** и выберите **восстановить виртуальные машины**.

:::image type="content" source="./media/disaster-recovery/recover-virtual-machines.png" alt-text="восстановление виртуальных машин" border="true":::

Настройте параметры восстановления для каждого экземпляра и нажмите кнопку **восстановить** , чтобы начать операцию восстановления.

:::image type="content" source="./media/disaster-recovery/recover-virtual-machines-confirm.png" alt-text="Подтверждение восстановления виртуальных машин" border="true":::

После завершения операции восстановления новые виртуальные машины отобразятся в удаленном vCenter Server инвентаризации.

## <a name="complete-a-reverse-replication-on-virtual-machines"></a>Выполнить обратную репликацию на виртуальных машинах

Войдите в **клиент vSphere** в частном облаке AVS и получите доступ к **подключаемому модулю хккс**.
Прежде чем начать обратную репликацию, необходимо отключить питание исходных виртуальных машин на исходном сайте. Операция завершается ошибкой, если виртуальные машины не выключены.

Выберите виртуальные машины для репликации обратно на исходный сайт из списка, откройте меню **действия** и выберите пункт **обратить**. Во всплывающем окне щелкните **обратить** , чтобы начать репликацию.

:::image type="content" source="./media/disaster-recovery/reverse-operation-virtual-machines.png" alt-text="Выберите обратить действие в разделе Защита операций." border="true":::

Репликацию можно отслеживать в разделе сведений каждой виртуальной машины.

:::image type="content" source="./media/disaster-recovery/review-reverse-operation.png" alt-text="Проверка результатов действия отмены действий" border="true":::

## <a name="disaster-recovery-plan-automation"></a>Автоматизация планов аварийного восстановления

В настоящее время VMware ХККС не имеет встроенного механизма для создания и автоматизации плана аварийного восстановления. Эта возможность не существует в ХККС. Однако он предоставляет набор API-интерфейсов, включая интерфейсы API для операции аварийного восстановления.

Спецификация API может быть доступа в ХККС Manager в URL-адресе.

Эти API охватывают следующие операции аварийного восстановления.

- Защита

- Recover

- Проверка восстановления

- Запланированное восстановление

- Reverse

- Запрос

- Очистка теста

- Пауза

- Продолжить

- Снять защиту

- Перенастройка

Ниже приведен пример полезных данных операции восстановления в JSON.

```json
[

    {

        "replicationId": "string",

        "needPowerOn": true,

        "instanceId": "string",

        "source": {

            "endpointType": "string",

            "endpointId": "string",

            "endpointName": "string",

            "resourceType": "string",

            "resourceId": "string",

            "resourceName": "string"

        },

        "destination": {

            "endpointType": "string",

            "endpointId": "string",

            "endpointName": "string",

            "resourceType": "string",

            "resourceId": "string",

            "resourceName": "string"

        },

        "placement": [

            {

                "containerType": "string",

                "containerId": "string"

            }

        ],

        "resourceId": "string",

        "forcePowerOff": true,

        "isTest": true,

        "forcePowerOffAfterTimeout": true,

        "isPlanned": true

    }

]
```

Используя эти API, клиент может создать собственный механизм для автоматизации создания и выполнения плана аварийного восстановления.
