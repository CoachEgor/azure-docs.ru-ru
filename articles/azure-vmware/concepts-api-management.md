---
title: Основные понятия — управление API
description: Узнайте, как служба управления API защищает интерфейсы API, работающие на виртуальных машинах решения Azure VMware (AVS).
ms.topic: conceptual
ms.date: 06/23/2020
ms.openlocfilehash: 62112bf3c0bf551232e09e5910e3eaae228dc202
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85306811"
---
# <a name="api-management-to-publish-and-protect-apis-running-on-avs-based-vms"></a>Управление API для публикации и защиты интерфейсов API, работающих на виртуальных машинах на базе AVS

Microsoft Azure [управления API](https://azure.microsoft.com/services/api-management/) позволяет разработчикам и DevOps командам безопасно публиковать как внутренних, так и внешних потребителей.

Хотя в нескольких SKU предлагаются только номера SKU для разработчиков и Premium, можно использовать интеграцию виртуальной сети Azure для публикации интерфейсов API, работающих на рабочих нагрузках решения Azure VMware (AVS). Эти два номера SKU безопасно обеспечивают подключение между службой управления API и серверной частью. SKU для разработчиков предназначен для разработки и тестирования, а SKU Premium — для рабочих развертываний.

Для серверных служб, работающих на основе виртуальных машин AVS, конфигурация в службе управления API по умолчанию аналогична локальным серверным службам. Для внутренних и внешних развертываний служба управления API настраивает виртуальный IP-адрес (VIP) балансировщика нагрузки в качестве конечной точки сервера, когда внутренний сервер помещается за Load Balancer НСКС на стороне AVS.

## <a name="external-deployment"></a>Внешнее развертывание

Внешнее развертывание публикует API, используемые внешними пользователями, с помощью общедоступной конечной точки. Разработчики и инженеры DevOps могут управлять API с помощью портал Azure или PowerShell, а также портала разработчика управления API.

На схеме внешнего развертывания показан весь процесс и участвующие субъекты (показаны в верхней части). Субъекты:

- **Администраторы:** Представляет группу администраторов или DevOps, которая управляет AVS с помощью портал Azure и механизмов автоматизации, таких как PowerShell или Azure DevOps.

- **Пользователи:**  Представляет потребителей предоставляемых интерфейсов API и представляет пользователей и службы, использующие API-интерфейсы.

Поток трафика проходит через экземпляр управления API, который абстрагирует внутренние службы, подключенные к виртуальной сети концентратора. Шлюз ExpressRoute направляет трафик в ExpressRoute Global Reach канал и достиг НСКС Load Balancer распределения входящего трафика по разным экземплярам серверных служб.

Служба управления API имеет общедоступный API Azure и активирует службу Azure от атак DDoS Protection. 

:::image type="content" source="media/api-management/external-deployment.png" alt-text="Внешнее развертывание — управление API для AVS":::


## <a name="internal-deployment"></a>Внутреннее развертывание

Внутреннее развертывание публикует интерфейсы API, используемые внутренними пользователями или системами. Разработчики DevOps команды и API используют те же средства управления и портал разработчика, что и во внешнем развертывании.

Внутренние развертывания могут быть [с помощью шлюза приложений Azure](../api-management/api-management-howto-integrate-internal-vnet-appgateway.md) , чтобы создать общедоступную и безопасную конечную точку для API-интерфейса, использующего его возможности, и создать гибридное развертывание, позволяющее выполнять различные сценарии.  API использует свои возможности и создает гибридное развертывание, позволяющее выполнять различные сценарии.

* Используйте один и тот же ресурс управления API для использования как внутренними, так и внешними потребителями.

* Наличие одного ресурса управления API с подмножеством интерфейсов API, определенных и доступных для внешних потребителей.

* Предоставляют простой способ переключения доступа к управлению API из общедоступного Интернета.

На схеме развертывания ниже показаны потребители, которые могут быть внутренними или внешними, с каждым типом доступа к одному или разным интерфейсам API.

Во внутреннем развертывании API-интерфейсы доступны для одного экземпляра управления API. Перед управлением API шлюз приложений развертывается с активированной возможностью брандмауэра веб-приложения Azure (WAF) и набором прослушивателей HTTP и правилами для фильтрации трафика, предоставляя только подмножество серверных служб, работающих в AVS.

* Внутренний трафик направляется через шлюз ExpressRoute в брандмауэр Azure, а затем в службу управления API, если правила трафика установлены или непосредственно в службу управления API.  

* Внешний трафик входит в Azure через шлюз приложений, который использует внешний уровень защиты для управления API.


:::image type="content" source="media/api-management/internal-deployment.png" alt-text="Внутреннее развертывание — управление API для AVS":::