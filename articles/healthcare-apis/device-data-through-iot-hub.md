---
title: Руководство по Получение данных устройства через Центр Интернета вещей Azure
description: В этом руководстве показано, как включить маршрутизацию данных устройства из Центра Интернета вещей в Azure API для FHIR с помощью соединителя Интернета вещей.
services: healthcare-apis
author: ms-puneet-nagpal
ms.service: healthcare-apis
ms.subservice: iomt
ms.topic: tutorial
ms.date: 06/27/2020
ms.author: punagpal
ms.openlocfilehash: d606cd4f5c4b901c060c97d73524997b94eaf225
ms.sourcegitcommit: cee72954f4467096b01ba287d30074751bcb7ff4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2020
ms.locfileid: "87446304"
---
# <a name="tutorial-receive-device-data-through-azure-iot-hub"></a>Руководство по Получение данных устройства через Центр Интернета вещей Azure

Соединитель Интернета вещей позволяет принимать данные из Интернета медицинских вещей (Internet of Medical Things, сокращенно IoMT) в Azure API для FHIR. В кратком руководстве [Развертывание соединителя IoT (предварительная версия) с помощью портала Azure](iot-fhir-portal-quickstart.md) показан пример устройства под управлением Azure IoT Central, которое [отправляет данные телеметрии](iot-fhir-portal-quickstart.md#connect-your-devices-to-iot) в соединитель Интернета вещей. Соединитель Интернета вещей также может работать с устройствами, подготовленными и управляемыми через Центр Интернета вещей Azure. В этом руководстве показано, как подключить Центр Интернета вещей Azure к соединителю Интернета вещей и настроить маршрутизацию данных устройства.

## <a name="prerequisites"></a>Предварительные требования

- Активная подписка Azure — [создайте подписку бесплатно](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
- Azure API для FHIR хотя бы с одним соединителем Интернета вещей — [разверните соединитель с помощью портала Azure (предварительная версия)](iot-fhir-portal-quickstart.md).
- Ресурс Центра Интернета вещей Azure, подключенный к реальным или имитированным устройствам — [создайте Центр Интернета вещей с помощью портала Azure](https://docs.microsoft.com/azure/iot-hub/quickstart-send-telemetry-dotnet).

> [!TIP]
> Если вы используете приложение для имитированного устройства в Центре Интернета вещей Azure, вы можете выбрать любое приложение из разных поддерживаемых языков и систем.

## <a name="get-connection-string-for-iot-connector-preview"></a>Получение строки подключения для соединителя Интернета вещей (предварительная версия)

Для безопасного подключения Центра Интернета вещей к соединителю Интернета вещей требуется строка подключения. См. сведения о [создании строки подключения для соединителя Интернета вещей](iot-fhir-portal-quickstart.md#generate-a-connection-string). Эта строка подключения будет использоваться на следующем шаге.

Соединитель Интернета вещей использует для получения сообщений устройства экземпляр концентратора событий Azure. Созданная выше строка подключения по сути устанавливает подключение к этому базовому концентратору событий.

## <a name="connect-azure-iot-hub-with-the-iot-connector-preview"></a>Подключение Центра Интернета вещей Azure к соединителю Интернета вещей (предварительная версия)

Центр Интернета вещей Azure поддерживает [маршрутизацию сообщений](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-messages-d2c). Эта возможность позволяет отправлять данные устройства в разные службы Azure, например в концентратор событий, учетную запись хранения или служебную шину. Соединитель IoT использует эту возможность для подключения и отправки данных устройства из Центра Интернета вещей Azure в конечную точку концентратора событий.

> [!NOTE] 
> Сейчас [создать маршрутизацию сообщений](https://docs.microsoft.com/azure/iot-hub/tutorial-routing) можно только с помощью команд PowerShell или CLI, так как концентратор событий Центра Интернета вещей не размещается в подписке клиента и не доступен через портал Azure. Когда объекты маршрута добавляются с помощью PowerShell или CLI, они появляются на портале Azure, и вы можете управлять ими там.

Настройка маршрутизации сообщений состоит из двух этапов.

### <a name="add-an-endpoint"></a>Добавление конечной точки
Этот шаг определяет конечную точку, к которой Центр Интернета вещей будет направлять данные. Для создания конечной точки выполните команду PowerShell [Add-AzIotHubRoutingEndpoint](https://docs.microsoft.com/powershell/module/az.iothub/Add-AzIotHubRoutingEndpoint) или команду CLI [az iot hub routing-endpoint create](https://docs.microsoft.com/cli/azure/iot/hub/routing-endpoint?#az-iot-hub-routing-endpoint-create) (в зависимости от предпочтений).

Ниже приведен список параметров, которые можно использовать с командой для создания конечной точки.

|Параметр PowerShell|Параметр CLI|Описание|
|---|---|---|
|ResourceGroupName|resource-group|Имя группы ресурсов для ресурса Центра Интернета вещей.|
|Имя|hub-name|Имя ресурса Центра Интернета вещей.|
|EndpointName|endpoint-name|Укажите имя, которое вы хотите назначить создаваемой конечной точке.|
|EndpointType|endpoint-type|Тип конечной точки, к которой будет подключаться Центр Интернета вещей. Используйте литеральное значение EventHub для PowerShell и eventhub для CLI.|
|EndpointResourceGroup|endpoint-resource-group|Имя группы ресурсов для ресурса Azure API для FHIR соединителя Интернета вещей. Это значение можно узнать на странице обзора для Azure API для FHIR.|
|EndpointSubscriptionId|endpoint-subscription-id|Идентификатор подписки для ресурса Azure API для FHIR соединителя Интернета вещей. Это значение можно узнать на странице обзора для Azure API для FHIR.|
|ConnectionString|Строка подключения|Строка подключения к соединителю Интернета вещей. Используйте значение, полученное на предыдущем шаге.|

### <a name="add-a-message-route"></a>Добавление маршрута сообщений
На этом шаге определяется маршрут сообщений на основе созданной выше конечной точки. Создайте маршрут с помощью команды PowerShell [Add-AzIotHubRoute](https://docs.microsoft.com/powershell/module/az.iothub/Add-AzIoTHubRoute) или команды CLI [az iot hub route create](https://docs.microsoft.com/cli/azure/iot/hub/route#az-iot-hub-route-create) (в зависимости от предпочтений).

Ниже приведен список параметров, которые можно использовать с командой для создания конечной точки.

|Параметр PowerShell|Параметр CLI|Описание|
|---|---|---|
|ResourceGroupName|g|Имя группы ресурсов для ресурса Центра Интернета вещей.|
|Имя|hub-name|Имя ресурса Центра Интернета вещей.|
|EndpointName|endpoint-name|Имя ранее созданной конечной точки.|
|RouteName|route-name|Имя, которое вы хотите присвоить создаваемому маршруту сообщений.|
|Источник|source-type|Тип данных для отправки в конечную точку. Используйте литеральное значение DeviceMessages для PowerShell и devicemessages для CLI.|

## <a name="send-device-message-to-iot-hub"></a>Отправка сообщения в Центр Интернета вещей

Используйте реальное или имитированное устройство, чтобы отправить в центр Интернета вещей Azure тестовое сообщение пульса, показанное ниже. Это сообщение будет перенаправлено в соединитель Интернета вещей, где оно будет преобразовано в ресурс наблюдения FHIR и сохранено в Azure API для FHIR.

```json
{
  "HeartRate": 80,
  "RespiratoryRate": 12,
  "HeartRateVariability": 64,
  "BodyTemperature": 99.08839032397609,
  "BloodPressure": {
    "Systolic": 23,
    "Diastolic": 34
  },
  "Activity": "walking"
}
```
> [!IMPORTANT]
> Не забудьте, что отправляемое сообщение устройства должно соответствовать [шаблонам сопоставления](iot-mapping-templates.md), которые настроены для вашего соединителя Интернета вещей.

## <a name="view-device-data-in-azure-api-for-fhir"></a>Просмотр данных устройства в Azure API для FHIR

Вы можете просматривать ресурсы наблюдения FHIR, созданные соединителем Интернета вещей в Azure API для FHIR, используя Postman. Настройте [доступ к Azure API для FHIR в Postman](access-fhir-postman-tutorial.md) и выполните запрос `GET` к `https://your-fhir-server-url/Observation?code=http://loinc.org|8867-4`, чтобы просмотреть ресурсы наблюдения FHIR с информацией о частоте пульса, отправленной ранее в тестовом сообщении.

> [!TIP]
> Убедитесь, что пользователь имеет необходимые права доступа к плоскости данных Azure API для FHIR. Для назначения ролей в плоскости данных используйте [управление доступом на основе ролей Azure (Azure RBAC)](configure-azure-rbac.md).


## <a name="next-steps"></a>Дальнейшие действия

В этом кратком руководстве показано, как настроить Центр Интернета вещей Azure для маршрутизации данных устройства в соединитель Интернета вещей. Чтобы узнать больше о соединителе Интернета вещей, см. следующие ресурсы.

Сведения о разных стадиях потока данных в соединителе Интернета вещей.

>[!div class="nextstepaction"]
>[Поток данных соединителя Интернета вещей ](iot-data-flow.md)

Сведения о настройке соединителя Интернета вещей с помощью шаблонов устройства и сопоставления FHIR.

>[!div class="nextstepaction"]
>[Шаблоны сопоставления для соединителя Интернета вещей](iot-mapping-templates.md)

FHIR — это зарегистрированная торговая марка организации HL7, которая используется с разрешения HL7.
