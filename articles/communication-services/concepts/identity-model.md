---
title: Модель удостоверений
titleSuffix: An Azure Communication Services concept
description: Сведения о удостоверениях и маркерах доступа
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 10/26/2020
ms.topic: conceptual
ms.service: azure-communication-services
ms.openlocfilehash: 336e708334778e107331f5f393476c4b3dbb98a3
ms.sourcegitcommit: 4bee52a3601b226cfc4e6eac71c1cb3b4b0eafe2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2020
ms.locfileid: "94507549"
---
# <a name="identity-model"></a>Модель удостоверений

Службы связи Azure — это независимая служба идентификации. Эта схема имеет несколько преимуществ.
- Повторное использование существующих удостоверений из системы управления удостоверениями
- Гибкость сценариев интеграции
- Сохранение личных удостоверений в службах связи Azure

Вместо дублирования существующей информации в системе вы будете поддерживать отношение сопоставления, относящееся к конкретному бизнес-случаю. Например, Сопоставление удостоверений 1:1, 1: N, N:1, Н:М. Внешние идентификаторы (например, Номера телефонов, пользователи, устройства, приложения, GUID) нельзя использовать в качестве удостоверения связи Azure. Маркеры доступа, созданные для удостоверения службы связи Azure, используются для доступа к примитивам, таким как чат или вызов. 

## <a name="identity"></a>Идентификация

Удостоверения создаются с помощью библиотеки администрирования службы связи Azure. Удостоверение служит идентификатором в диалогах и используется для создания маркеров доступа. Одно и то же удостоверение может участвовать в нескольких одновременных сеансах на нескольких устройствах. Удостоверение может одновременно иметь несколько активных маркеров доступа. Удаление удостоверения, ресурса или подписки приводит к недействительности всех ее маркеров доступа и удалению всех данных, сохраненных для этого удостоверения. Удаленное удостоверение не может выдавать новые маркеры доступа, ни один из них не имеет доступа к ранее сохраненным данным (например, сообщения в чате). 

Вы не платите за количество удостоверений, которые у вас есть, но при использовании примитивов. Количество удостоверений не обязательно ограничивать, как сопоставлять удостоверения приложения с удостоверениями служб связи Azure. Свобода сопоставления несет ответственность за соблюдение условий конфиденциальности. Когда пользователь приложения желает удалить из системы, необходимо удалить все удостоверения, связанные с этим пользователем.

Службы связи Azure не предоставляют специальные удостоверения для анонимных пользователей. Он не сохраняет сопоставление между пользователями и удостоверениями, но не знает, является ли удостоверение анонимным. Концепцию можно спроектировать в соответствии с вашими требованиями. Мы рекомендуем создать новое удостоверение для анонимного пользователя приложения. При наличии действительного маркера доступа любой пользователь может получить доступ к содержимому, не удаленному по идентификатору. Например, сообщения разговора, отправленные пользователем. Доступ ограничен только областями, которые являются частью маркера доступа. Дополнительные сведения об областях см. в разделе *маркер доступа*.

### <a name="mapping-of-identities"></a>Сопоставление удостоверений

Службы связи Azure не реплицируют функции МГНОВЕНных сообщений. Он не предоставляет клиентам возможность использовать удостоверения, зависящие от клиента. Например, номер телефона или адрес электронной почты. Вместо этого он предоставляет уникальные идентификаторы, которые можно назначить удостоверениям приложения. Службы связи Azure не хранят никаких сведений, которые могут обнаружить реальную идентификацию пользователей.

Вместо дублирования рекомендуется проектировать, как пользователи из вашего домена удостоверений будут сопоставляться с удостоверениями службы связи Azure. Вы можете следовать любому типу шаблона 1:1, 1: N, N:1 или М:Н. Вы можете определить, сопоставляется ли один пользователь с одним удостоверением или с несколькими удостоверениями. При создании нового удостоверения рекомендуется сохранить сопоставление этого удостоверения с пользователем или пользователями приложения. Так как удостоверения требуют наличия маркеров доступа для использования примитивов, удостоверение должно быть известно пользователю приложения или пользователям.

Если вы используете реляционную базу данных для хранения пользователей, реализация может отличаться в зависимости от сценария сопоставления. Для сценариев с сопоставлением 1:1 или N:1 в таблицу можно добавить столбец *коммуникатионсервицесид* для хранения удостоверения служб связи Azure. В сценариях с отношением 1: N или Н:М можно создать отдельную таблицу в реляционной базе данных.

## <a name="access-token"></a>Маркер доступа

Маркер доступа — это маркер JWT, который можно использовать для получения доступа к примитивам службы связи Azure. Выданный маркер доступа имеет защиту целостности. его утверждения нельзя изменить после выдачи. Таким образом, ручное изменение свойств, таких как Identity, Expires или области, сделает маркер доступа недействительным. Использование примитивов с недействительными маркерами приводит к отказу в доступе к примитиву. 

К свойствам маркера доступа относятся: *Identity, Expires* и *Scope*. Маркер доступа всегда действителен в течение 24 часов. По истечении этого времени маркер доступа становится недействительным и не может использоваться для доступа к любому примитиву. Удостоверение должно иметь способ, чтобы запросить новый маркер доступа из службы на стороне сервера. *Область* параметра определяет непустой набор примитивов, которые можно использовать. Службы связи Azure поддерживают следующие области для маркеров доступа:

|Имя|Description|
|---|---|
|Чат|  Предоставляет возможность участвовать в чате|
|VoIP|  Предоставляет возможность вызова удостоверений и телефонных номеров|


Если вы хотите отозвать маркер доступа до истечения срока его действия, для этого можно использовать библиотеку администрирования службы связи Azure. Отзыв маркера выполняется немедленнее и занимает до 15 минут для распространения. Удаление удостоверения, ресурса или подписки приведет к отзыву всех маркеров доступа. Если вы хотите удалить возможность доступа пользователя к определенной функциональности, отмените все маркеры доступа. Затем выдайте новый маркер доступа с более ограниченным набором областей.
Смена ключей доступа службы связи Azure приведет к отзыву всех активных маркеров доступа, созданных с помощью прежних ключей доступа. Все удостоверения потеряют доступ к службе связи Azure и должны будут выдавать новые маркеры доступа. 

Рекомендуется выдавать маркеры доступа в службе на стороне сервера, а не в приложении клиента. Причина заключается в том, что для выпуска требуется ключ доступа или управляемое удостоверение. Не рекомендуется по соображениям безопасности совместно использовать ключи доступа в клиентском приложении. Клиентское приложение должно использовать доверенную конечную точку службы, которая может проверять подлинность клиентов и выдавать маркер доступа от их имени. Дополнительные сведения об архитектуре можно найти [здесь](./client-and-server-architecture.md).

При кэшировании маркеров доступа в резервное хранилище рекомендуется использовать шифрование. Маркер доступа — это конфиденциальные данные, которые можно использовать для вредоносных действий, если они не защищены. При наличии маркера доступа можно инициализировать пакет SDK и получить доступ к API. Доступный API ограничен только на основе областей, на которые имеет маркер доступа. Рекомендуется выдавать маркеры доступа только с требуемыми областями.