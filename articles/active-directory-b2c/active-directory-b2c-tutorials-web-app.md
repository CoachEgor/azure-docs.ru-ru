---
title: Руководство. Включение в веб-приложении аутентификации c помощью Azure Active Directory B2C
description: Руководство по предоставлению пользователю данных для входа в веб-приложение ASP.NET с помощью Azure Active Directory B2C.
services: active-directory-b2c
author: mmacy
manager: celestedg
ms.author: marsma
ms.date: 09/19/2019
ms.custom: mvc
ms.topic: tutorial
ms.service: active-directory
ms.subservice: B2C
ms.openlocfilehash: b42634aa86f210382adb1ae224c847a92d89109b
ms.sourcegitcommit: 1c9858eef5557a864a769c0a386d3c36ffc93ce4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2019
ms.locfileid: "71103311"
---
# <a name="tutorial-enable-authentication-in-a-web-application-using-azure-active-directory-b2c"></a>Руководство по Включение в веб-приложении аутентификации с помощью Azure Active Directory B2C

В этом руководстве описано использование Azure Active Directory B2C (Azure AD B2C) для входа и регистрации пользователей в веб-приложении ASP.NET. Azure AD B2C позволяет приложениям выполнять проверку подлинности учетных записей социальных сетей, корпоративных учетных записей и учетных записей Azure Active Directory с помощью стандартных протоколов.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * Настройка примера для использования приложения.
> * регистрация с помощью потока пользователя.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

* [Создайте потоки пользователя](tutorial-create-user-flows.md), чтобы обеспечить взаимодействие с пользователями в приложении.
* Установите [Visual Studio 2019](https://www.visualstudio.com/downloads/) с рабочей нагрузкой **ASP.NET и веб-разработка**.

## <a name="update-the-application"></a>Обновление приложения

Во время прохождения руководства, которое является частью предварительных требований, вы добавили веб-приложение в Azure AD B2C. Для обеспечения взаимодействия с примером в этом руководстве необходимо добавить URI перенаправления для приложения в Azure AD B2C.

1. Войдите на [портале Azure](https://portal.azure.com).
1. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Щелкните пункт **Приложения**, а затем выберите приложение *webapp1*.
1. В разделе **URL-адрес ответа** добавьте `https://localhost:44316`.
1. Щелкните **Сохранить**.
1. На странице свойств запишите идентификатор приложения, который будет использоваться при настройке веб-приложения.
1. Выберите **Ключи**, а затем щелкните **Создать ключ** и нажмите кнопку **Сохранить**. Запишите ключ, который будет использоваться при настройке веб-приложения.

## <a name="configure-the-sample"></a>Настройка примера

С помощью этого руководства вы настроите пример, который можно скачать из репозитория GitHub. В примере применяется ASP.NET для предоставления простого списка задач и используются [компоненты ПО промежуточного слоя OWIN](https://docs.microsoft.com/aspnet/aspnet/overview/owin-and-katana/). [Скачайте ZIP-файл](https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi/archive/master.zip) или клонируйте пример с GitHub. Убедитесь, что вы извлекаете пример файла в папку, общая длина пути к которой меньше 260 символов.

```
git clone https://github.com/Azure-Samples/active-directory-b2c-dotnet-webapp-and-webapi.git
```

Пример решения состоит из следующих двух проектов:

* **TaskWebApp** — создание и изменение списка задач. Пример использует поток пользователя **регистрации или входа** для регистрации пользователей и входа в систему.
* **TaskService** — это веб-API, поддерживающий функции создания, чтения, обновления и удаления списка задач. API защищен с помощью Azure AD B2C и вызывается TaskWebApp.

Для использования приложения, зарегистрированного в клиенте, измените данные в примере, в частности укажите идентификатор приложения и ключ, записанные ранее. Кроме того, необходимо также настроить созданные потоки пользователя. Пример определяет значения конфигурации, такие как параметры, в файле *Web.config*.

Обновите параметры в файле Web.config для работы с пользовательским потоком:

1. Откройте решение **B2C-WebAPI-DotNet** в Visual Studio.
1. В проекте **TaskWebApp** откройте файл **Web.config**.
    1. Измените значение `ida:Tenant` и `ida:AadInstance` на имя созданного клиента Azure AD B2C. Например, замените `fabrikamb2c` на `contoso`.
    1. Замените значение `ida:ClientId` идентификатором приложения, который вы записали.
    1. Замените значение `ida:ClientSecret` ключом, который вы записали. Перед добавлением секрета клиента в файл Web. config необходимо выполнить его кодирование в формате XML.
    1. Замените значение `ida:SignUpSignInPolicyId` на `b2c_1_signupsignin1`.
    1. Замените значение `ida:EditProfilePolicyId` на `b2c_1_profileediting1`.
    1. Замените значение `ida:ResetPasswordPolicyId` на `b2c_1_passwordreset1`.

## <a name="run-the-sample"></a>Запуск примера

1. В обозревателе решений щелкните проект **TaskWebApp** правой кнопкой мыши, а затем выберите пункт **Назначить запускаемым проектом**.
1. Нажмите клавишу **F5**. Запустится браузер по умолчанию, и откроется адрес локального веб-сайта `https://localhost:44316/`.

### <a name="sign-up-using-an-email-address"></a>Регистрация с помощью адреса электронной почты

1. Выберите **Sign up / Sign in** (Вход в службу или регистрация), чтобы зарегистрироваться как пользователь приложения. Используется поток пользователя **b2c_1_signupsignin1**.
1. Появляется страница входа в Azure AD B2C со ссылкой для регистрации. Щелкните ссылку **Зарегистрироваться сейчас**, так как у вас нет учетной записи. В рамках рабочего процесса регистрации появляется страница для сбора данных и проверки личности пользователя с использованием адреса электронной почты. Рабочий процесс регистрации также собирает пароль пользователя и запрашиваемые атрибуты, определенные в потоке пользователя.
1. Используйте действительный адрес электронной почты и подтвердите его с помощью кода проверки. Задайте пароль. Введите значения запрашиваемых атрибутов.

    ![Страница регистрации, отображаемая как часть рабочего процесса входа и регистрации](media/active-directory-b2c-tutorials-web-app/sign-up-workflow.PNG)

1. Выберите **Создать**, чтобы создать локальную учетную запись в клиенте Azure AD B2C.

Теперь пользователь может использовать свой адрес электронной почты для входа в веб-приложение и работы с ним.

Однако компонент **Список задач** не будет работать, пока вы не завершите работу со следующим руководством в серии, [Руководство: Использование Azure AD B2C для защиты веб-API ASP.NET](active-directory-b2c-tutorials-web-api.md).

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * Настройка примера для использования приложения.
> * регистрация с помощью потока пользователя.

Теперь перейдите к следующему руководству, чтобы включить компонент**Список задач** в веб-приложении. В нем вы зарегистрируете приложение веб-API в собственном клиенте Azure AD B2C, а затем измените пример кода, чтобы использовать клиент для проверки подлинности API.

> [!div class="nextstepaction"]
> [Руководство. Использование Azure Directory B2C для защиты веб-API ASP.NET >](active-directory-b2c-tutorials-web-api.md)
