---
title: Подходы к миграции пользователей
titleSuffix: Azure AD B2C
description: Переносите учетные записи пользователей из другого поставщика идентификационных данных в Azure AD B2C, используя методы массового импорта или бесшовной миграции.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 02/14/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: b3ee069985fd39288a562d3caafc50b12290c060
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80332332"
---
# <a name="migrate-users-to-azure-ad-b2c"></a>Миграция пользователей в Azure AD B2C

Переход от другого поставщика идентификационных данных к B2C Active Directory (Azure AD B2C) также может потребовать миграции существующих учетных записей пользователей. Здесь обсуждаются два способа миграции: *массовый импорт* и *бесшовная миграция.* При любом подходе необходимо написать приложение или скрипт, который использует [API Microsoft Graph](manage-user-accounts-graph-api.md) для создания учетных записей пользователей в Azure AD B2C.

## <a name="bulk-import"></a>Массовый импорт

В потоке массового импорта приложение миграции выполняет следующие действия для каждой учетной записи пользователя:

1. Прочитайте учетную запись пользователя от старого поставщика идентификационных данных, включая его текущие учетные данные (имя пользователя и пароль).
1. Создайте соответствующую учетную запись в каталоге Azure AD B2C с текущими учетными данными.

Используйте объемный поток импорта в любой из этих двух ситуаций:

- У вас есть доступ к учетным данным пользователя (их имя пользователя и пароль).
- Учетные данные зашифрованы, но вы можете расшифровать их.

Для получения информации о программном создании учетных записей пользователей [см.](manage-user-accounts-graph-api.md)

## <a name="seamless-migration"></a>Бесшовная миграция

Используйте бесшовный миграционный поток, если пароли простого текста в старом поставщике идентификационных данных недоступны. Например, когда:

- Пароль хранится в одностороннем зашифрованном формате, например, с функцией хэша.
- Пароль хранится устаревшей идентификационным поставщиком таким образом, чтобы вы не могли получить доступ. Например, когда поставщик идентификационных данных проверяет учетные данные, вызывая веб-службу.

Бесшовный миграционный поток по-прежнему требует массовой миграции учетных записей пользователей, но затем использует [пользовательскую политику](custom-policy-get-started.md) для запроса [REST API](custom-policy-rest-api-intro.md) (который вы создаете) для установки пароля каждого пользователя при первом входе в систему.

Таким образом, бесшовный миграционный поток имеет два этапа: *объемный импорт* и *набор учетных данных.*

### <a name="phase-1-bulk-import"></a>Фаза 1: Массовый импорт

1. Приложение для миграции считывает учетные записи пользователей от старого поставщика идентификационных данных.
1. Миграционное приложение создает соответствующие учетные записи пользователей в каталоге Azure AD B2C, но *не устанавливает пароли.*

### <a name="phase-2-set-credentials"></a>Фаза 2: Установить учетные данные

После завершения массовой миграции учетных записей пользовательская политика и REST API выполняют следующие функции, когда пользователь впишется в:

1. Прочитайте учетную запись пользователя Azure AD B2C, соответствующую указанному адресу электронной почты.
1. Проверьте, помечена ли учетная запись для миграции, оценив атрибут расширения boolean.
    - Если атрибут расширения `True`возвращается, позвоните в REST API для проверки пароля в отношении поставщика устаревших идентификационных данных.
      - Если REST API установит, что пароль неверен, верните пользователю ошибку.
      - Если REST API установит правильный пароль, напишите пароль в учетную запись Azure AD `False`B2C и измените атрибут расширения boolean на .
    - Если атрибут расширения boolean возвращается, `False`продолжайте процесс ввоза в обычном режиме.

Чтобы увидеть пример пользовательской политики и REST API, см. [выборку бесшовной миграции пользователей](https://aka.ms/b2c-account-seamless-migration) на GitHub.

![Диаграмма Flowchart бесшовного подхода к миграции пользователей](./media/user-migration/diagram-01-seamless-migration.png)<br />*Диаграмма: Бесшовный миграционный поток*

## <a name="best-practices"></a>Рекомендации

### <a name="security"></a>Безопасность

Подход бесшовной миграции использует свой собственный пользовательский REST API для проверки учетных данных пользователя в отношении поставщика устаревших идентификационных данных.

**Вы должны защитить ваш REST API от атак грубой силы.** Злоумышленник может отправить несколько паролей в надежде в конечном итоге угадать учетные данные пользователя. Чтобы победить такие атаки, прекратите подавать запросы на ваш REST API, когда количество попыток входного регистра проходит определенный порог. Кроме того, обезопажьте связь между Azure AD B2C и ВАШИМ REST API. Чтобы узнать, как обеспечить ваши RESTful API для производства, [см.](secure-rest-api.md)

### <a name="user-attributes"></a>Атрибуты пользователя

Не вся информация в поставщике устаревших идентификационных данных должна быть перенесена в каталог Azure AD B2C. Определите соответствующий набор атрибутов пользователя для хранения в Azure AD B2C перед миграцией.

- **DO** магазин в Azure AD B2C
  - Имя пользователя, пароль, адреса электронной почты, номера телефонов, номера участников/идентификаторы.
  - Маркеры согласия для политики конфиденциальности и лицензионных соглашений с конечными пользователями.
- **НЕ** храните в Azure AD B2C
  - Конфиденциальные данные, такие как номера кредитных карт, номера социального страхования (SSN), медицинские записи или другие данные, регулируемые государственными или отраслевыми органами по соблюдению нормативных требований.
  - Маркетинговые или коммуникационные предпочтения, поведение пользователей и идеи.

### <a name="directory-clean-up"></a>Очистка каталога

Прежде чем начать процесс миграции, воспользуйтесь возможностью очистить свой каталог.

- Определите набор атрибутов пользователя, которые будут храниться в Azure AD B2C, и переносите только то, что вам нужно. При необходимости можно создать [пользовательские атрибуты](custom-policy-custom-attributes.md) для хранения большего количества данных о пользователе.
- Если вы мигрируете из среды с несколькими источниками аутентификации (например, каждое приложение имеет свой собственный каталог пользователей), перейти на единую учетную запись в Azure AD B2C.
- Если несколько приложений имеют разные имена пользователей, вы можете хранить все они в учетной записи пользователя Azure AD B2C с помощью коллекции идентификационных данных. Что касается пароля, пусть пользователь выберет один и установит его в каталог. Например, при бесшовной миграции в учетной записи Azure AD B2C должен храниться только выбранный пароль.
- Удалите неиспользованные учетные записи пользователей до миграции или не мигрируйте устаревшие учетные записи.

### <a name="password-policy"></a>Политика паролей

Если учетные записи, которые вы мигрируете, имеют более слабую прочность пароля, чем [сильная сила пароля,](../active-directory/authentication/concept-sspr-policy.md) применяемая Azure AD B2C, вы можете отключить сильное требование пароля. Для получения дополнительной [Password policy property](manage-user-accounts-graph-api.md#password-policy-property)информации см.

## <a name="next-steps"></a>Дальнейшие действия

Репозиторий [azure-ad-b2c/пользователь-миграция](https://github.com/azure-ad-b2c/user-migration) на GitHub содержит пример пользовательской политики миграции и образец кода REST API:

[Бесшовная пользовательская политика миграции пользователей & образца кода REST API](https://aka.ms/b2c-account-seamless-migration)
