---
title: Учебник. Добавление поставщиков удостоверений в приложения
titleSuffix: Azure AD B2C
description: Узнайте, как добавить поставщики удостоверений своим приложениям в Azure Active Directory B2C с помощью портала Azure.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: article
ms.date: 07/08/2019
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 1f49061210ca8e3c106b0569f77a67d1f10757a1
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "78183522"
---
# <a name="tutorial-add-identity-providers-to-your-applications-in-azure-active-directory-b2c"></a>Учебник. Добавление поставщиков удостоверений в приложения в Azure Active Directory B2C

В своих приложениях вы можете разрешить пользователям входить с разными поставщиками удостоверений. *Поставщик удостоверений* создает, поддерживает и управляет сведениями об удостоверении, одновременно предоставляя приложениям службы проверки подлинности. Поставщики удостоверений, поддерживаемые Azure Active Directory B2C (Azure AD B2C), можно добавить в [пользовательские потоки](user-flow-overview.md) с помощью портал Azure.

Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Обычно в приложениях используется только один поставщик удостоверений, но у вас есть возможность добавить еще. В этом руководстве показано, как добавить поставщик удостоверений Azure AD и Facebook в приложение. Добавление обоих этих поставщиков удостоверений в приложение является необязательным. Вы также можете добавить других поставщиков удостоверений, таких как [Amazon](identity-provider-amazon.md), [GitHub](identity-provider-github.md), [Google](identity-provider-google.md), [LinkedIn](identity-provider-linkedin.md), [Microsoft](identity-provider-microsoft-account.md)или [Twitter](identity-provider-twitter.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

[Создайте поток пользователя](tutorial-create-user-flows.md), чтобы пользователи могли зарегистрироваться и войти в ваше приложение.

## <a name="create-applications"></a>Создание приложений

Приложения поставщика удостоверений предоставляют идентификатор и ключ для обеспечения связи с вашим клиентом Azure AD B2C. В этом разделе руководства вы создадите приложения Azure AD и Facebook, из которых получите идентификаторы и ключи, чтобы добавить в клиент поставщики удостоверений. Если вы добавляете лишь один из поставщиков удостоверений, необходимо создать приложение для данного поставщика.

### <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Чтобы включить вход для пользователей из Azure AD, вам необходимо зарегистрировать приложение в клиенте Azure AD. Клиент Azure AD отличается от клиента Azure AD B2C.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Убедитесь, что вы используете каталог, содержащий клиент Azure AD, выбрав фильтр " **каталог и подписка** " в верхнем меню и выбрав Каталог, содержащий ваш клиент Azure AD.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Введите имя приложения. Например, `Azure AD B2C App`.
1. Примите выбранные **учетные записи в этом каталоге организации только** для этого приложения.
1. Для **URI перенаправления**оставьте значение **Web** и введите следующий URL-адрес в строчных буквах, заменив `your-B2C-tenant-name` именем клиента Azure AD B2C.

    ```
    https://your-B2C-tenant-name.b2clogin.com/your-B2C-tenant-name.onmicrosoft.com/oauth2/authresp
    ```

    Например, `https://contoso.b2clogin.com/contoso.onmicrosoft.com/oauth2/authresp`.

    Всем URL-адресам следует использовать [b2clogin.com](b2clogin.md).

1. Выберите **зарегистрировать**, а затем запишите **идентификатор приложения (клиента)** , который вы используете на следующем шаге.
1. В разделе **Управление** в меню приложение выберите **Сертификаты & секреты**, а затем выберите **новый секрет клиента**.
1. Введите **Описание** секрета клиента. Например, `Azure AD B2C App Secret`.
1. Выберите срок действия. Для этого приложения Примите выбор **в течение 1 года**.
1. Выберите **Добавить**, а затем запишите значение нового секрета клиента, который вы используете на следующем шаге.

### <a name="create-a-facebook-application"></a>Создание приложения Facebook

Чтобы использовать учетную запись Facebook в качестве поставщика удостоверений в Azure AD B2C, необходимо создать приложение в Facebook. Если у вас еще нет учетной записи Facebook, ее можно получить по [https://www.facebook.com/](https://www.facebook.com/)адресу.

1. Выполните вход на [веб-сайт разработчиков Facebook](https://developers.facebook.com/) с учетными данными от учетной записи Facebook.
1. Если вы этого еще не сделали, необходимо зарегистрироваться в качестве разработчика Facebook. Для этого выберите начало **работы** в правом верхнем углу страницы, примите политики Facebook и выполните действия по регистрации.
1. Выберите **Мои приложения** , а затем — **создать приложение**.
1. Введите **Отображаемое название** и **Эл. адрес для связи**.
1. Нажмите кнопку **Создайте ID приложения**. Для этого может потребоваться принять условия политики платформы Facebook и пройти проверку безопасности в сети.
1. Выберите **Параметры** > **базовый**.
1. Выберите **категорию**, например `Business and Pages`. Это значение является обязательным для Facebook, но не используется Azure AD B2C.
1. В нижней части страницы, выберите **Добавить платформу**, а затем выберите **Веб-сайт**.
1. В поле **URL-адрес сайта** введите `https://your-tenant-name.b2clogin.com/`, заменив `your-tenant-name` именем вашего клиента.
1. Введите **URL-адрес политики конфиденциальности**, например `http://www.contoso.com/`. URL-адрес политики конфиденциальности — это страница, которую вы сохраняете, чтобы предоставить сведения о конфиденциальности для вашего приложения.
1. Щелкните **Save changes** (Сохранить изменения).
1. В верхней части страницы запишите значение **идентификатора приложения**.
1. Рядом с параметром **секрет приложения**выберите **Показывать** и записать его значение. Для настройки Facebook в качестве поставщика удостоверений в клиенте используется идентификатор приложения и секрет приложения. **Секрет приложения** — это важные учетные данные безопасности, которые следует хранить безопасно.
1. Щелкните знак "плюс" рядом с элементом **продукты**, а затем в разделе **имя входа Facebook**выберите **настроить**.
1. В разделе **имя входа Facebook** в меню слева выберите **Параметры**.
1. В поле **Valid OAuth redirect URIs** (Допустимые URI перенаправления OAuth) введите `https://your-tenant-name.b2clogin.com/your-tenant-name.onmicrosoft.com/oauth2/authresp`. Замените `your-tenant-name` именем вашего клиента. В нижней части страницы щелкните **сохранить изменения** .
1. Чтобы сделать приложение Facebook доступным для Azure AD B2C, щелкните селектор **состояния** в правом верхнем углу страницы и **включите его,** чтобы сделать приложение общедоступным, а затем нажмите кнопку **подтвердить**. На этом этапе состояние должно измениться с **Разработка** на **Активно**.

## <a name="add-the-identity-providers"></a>Добавление поставщиков удостоверений

После создания приложения для поставщика удостоверений, который необходимо добавить, вы добавляете поставщик удостоверений к своему арендатору.

### <a name="add-the-azure-active-directory-identity-provider"></a>Добавление поставщика удостоверений Azure Active Directory

1. Убедитесь, что вы используете каталог, содержащий клиент Azure AD B2C. В верхнем меню выберите фильтр **каталог и подписка** и выберите каталог, содержащий клиент Azure AD B2C.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Выберите **поставщики удостоверений**, а затем выберите **Новый поставщик OpenID Connect Connect**.
1. Введите **имя**. Например, введите *Azure AD Contoso*.
1. В поле **URL-адрес метаданных**введите следующий URL `your-AD-tenant-domain` -адрес, заменяющий доменное имя вашего клиента Azure AD:

    ```
    https://login.microsoftonline.com/your-AD-tenant-domain/.well-known/openid-configuration
    ```

    Например, `https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration`.

1. В поле **идентификатор клиента**введите ранее записанный идентификатор приложения.
1. В поле **секрет клиента**введите секрет клиента, который вы записали ранее.
1. Оставьте значения по умолчанию для **область**, **тип**отклика и **режим ответа**.
1. Используемых Введите значение для **Domain_hint**. Например, *контосоад*. [Указания домена](../active-directory/manage-apps/configure-authentication-for-federated-users-portal.md) — это директивы, которые включены в запрос проверки подлинности из приложения. Их можно использовать для ускорения входа пользователя на страницу входа федеративного поставщика удостоверений. Или они могут использоваться мультитенантным приложением, чтобы ускорить для клиента вход пользователя непосредственно на страницу входа Azure AD с фирменной символикой.
1. В разделе **сопоставление утверждений поставщика удостоверений**введите следующие значения сопоставления утверждений.

    * **Идентификатор пользователя**: *OID*
    * **Отображаемое имя**: *имя*
    * **Заданное имя**: *given_name*
    * **Фамилия**: *family_name*
    * **Адрес электронной почты**: *unique_name*

1. Щелкните **Сохранить**.

### <a name="add-the-facebook-identity-provider"></a>Добавление поставщика удостоверений в Facebook

1. Выберите **поставщики удостоверений**, а затем выберите **Facebook**.
1. Введите **имя**. Например, *Facebook*.
1. В поле **идентификатор клиента**введите идентификатор приложения Facebook, созданного ранее.
1. В качестве **секрета клиента**введите записанный секрет приложения.
1. Щелкните **Сохранить**.

## <a name="update-the-user-flow"></a>Обновление потока пользователя

В этом руководстве, которое вы завершили как часть предварительных условий, вы создали пользовательский поток для регистрации и входа с именем *B2C_1_signupsignin1*. В этом разделе вы добавляете поставщики удостоверений в поток пользователя *B2C_1_signupsignin1*.

1. Выберите **Потоки пользователей (политики)**, а затем — поток пользователя *B2C_1_signupsignin1*.
2. В разделе **Поставщики удостоверений** выберите **Facebook**, а затем добавленные поставщики удостоверений **Azure AD Contoso**.
3. Щелкните **Сохранить**.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. На странице "Обзор" созданного потока пользователя выберите **Выполнить поток пользователя**.
1. В разделе **Приложение** выберите зарегистрированное ранее веб-приложение с именем *webapp1*. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Выберите пункт **запустить поток пользователя**, а затем выполните вход с помощью добавленного ранее поставщика удостоверений.
1. Повторите шаги 1–3 для других добавленных поставщиков удостоверений.

Если операция входа выполнена успешно, вы будете перенаправлены на, на `https://jwt.ms` котором отображается декодированный маркер, аналогично следующему:

```json
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "<key-ID>"
}.{
  "exp": 1562346892,
  "nbf": 1562343292,
  "ver": "1.0",
  "iss": "https://your-b2c-tenant.b2clogin.com/10000000-0000-0000-0000-000000000000/v2.0/",
  "sub": "20000000-0000-0000-0000-000000000000",
  "aud": "30000000-0000-0000-0000-000000000000",
  "nonce": "defaultNonce",
  "iat": 1562343292,
  "auth_time": 1562343292,
  "name": "User Name",
  "idp": "facebook.com",
  "postalCode": "12345",
  "tfp": "B2C_1_signupsignin1"
}.[Signature]
```

## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Далее Узнайте, как настроить пользовательский интерфейс страниц, отображаемых для пользователей в рамках своей идентификации в приложениях.

> [!div class="nextstepaction"]
> [Настройка пользовательского интерфейса для приложений в Azure Active Directory B2C](tutorial-customize-ui.md)
