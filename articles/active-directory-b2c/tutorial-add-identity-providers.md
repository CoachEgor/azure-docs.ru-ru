---
title: Руководство. Добавление поставщиков удостоверений в приложения — Azure Active Directory B2C
description: Узнайте, как добавить поставщики удостоверений своим приложениям в Azure Active Directory B2C с помощью портала Azure.
services: active-directory-b2c
author: mmacy
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: article
ms.date: 07/08/2019
ms.author: marsma
ms.subservice: B2C
ms.openlocfilehash: 33f595dd36ac9448cc1276647f9943326b0b74c1
ms.sourcegitcommit: cf438e4b4e351b64fd0320bf17cc02489e61406a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2019
ms.locfileid: "67655217"
---
# <a name="tutorial-add-identity-providers-to-your-applications-in-azure-active-directory-b2c"></a>Учебник. Добавление поставщиков удостоверений приложениям в Azure Active Directory B2C

В своих приложениях вы можете разрешить пользователям входить с разными поставщиками удостоверений. *Поставщик удостоверений* создает, поддерживает и управляет сведениями об удостоверении, одновременно предоставляя приложениям службы проверки подлинности. С помощью портала Azure вы можете добавить поставщики удостоверений, которые поддерживаются Azure Active Directory (Azure AD) B2C, в свои [потоки пользователя](active-directory-b2c-reference-policies.md).

В этой статье раскрываются следующие темы:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Обычно в приложениях используется только один поставщик удостоверений, но у вас есть возможность добавить еще. В этом руководстве показано, как добавить поставщик удостоверений Azure AD и Facebook в приложение. Добавление обоих этих поставщиков удостоверений в приложение является необязательным. Можно также добавить другие поставщики удостоверений, таких как [Amazon](active-directory-b2c-setup-amzn-app.md), [GitHub](active-directory-b2c-setup-github-app.md), [Google](active-directory-b2c-setup-goog-app.md), [LinkedIn](active-directory-b2c-setup-li-app.md), [Microsoft](active-directory-b2c-setup-msa-app.md), или [Twitter](active-directory-b2c-setup-twitter-app.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>предварительные требования

[Создайте поток пользователя](tutorial-create-user-flows.md), чтобы пользователи могли зарегистрироваться и войти в ваше приложение.

## <a name="create-applications"></a>Создавать приложения

Приложения поставщика удостоверений предоставляют идентификатор и ключ для обеспечения связи с вашим клиентом Azure AD B2C. В этом разделе руководства вы создадите приложения Azure AD и Facebook, из которых получите идентификаторы и ключи, чтобы добавить в клиент поставщики удостоверений. Если вы добавляете лишь один из поставщиков удостоверений, необходимо создать приложение для данного поставщика.

### <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Чтобы включить вход для пользователей из Azure AD, вам необходимо зарегистрировать приложение в клиенте Azure AD. Клиент Azure AD отличается от клиента Azure AD B2C.

1. Войдите на [портале Azure](https://portal.azure.com).
1. Убедитесь, что используете каталог, содержащий клиент организации Azure AD, щелкнув **Фильтр каталога и подписки** в верхнем меню и выбрав каталог, который содержит ваш клиент Azure AD.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Введите имя приложения. Например, `Azure AD B2C App`.
1. Примите Выбор **учетных записей в организации каталога только** для этого приложения.
1. Для **URI перенаправления**, оставьте значение **Web** и введите следующий URL-адрес в нижнем регистре, заменив `your-B2C-tenant-name` с именем вашего клиента Azure AD B2C.

    ```
    https://your-B2C-tenant-name.b2clogin.com/your-B2C-tenant-name.onmicrosoft.com/oauth2/authresp
    ```

    Например, `https://contoso.b2clogin.com/contoso.onmicrosoft.com/oauth2/authresp`.

    Всем URL-адресам следует использовать [b2clogin.com](b2clogin.md).

1. Выберите **зарегистрировать**, затем запишите **идентификатор приложения (клиент)** используемом на более позднем этапе.
1. В разделе **управление** в меню приложения выберите **сертификаты и секреты**, а затем выберите **новый секрет клиента**.
1. Введите **описание** для секрета клиента. Например, `Azure AD B2C App Secret`.
1. Выберите период окончания срока действия. Для этого приложения, примите Выбор **через один год**.
1. Выберите **добавить**, затем запишите значение новый секрет клиента, который можно использовать в дальнейшем.

### <a name="create-a-facebook-application"></a>Создание приложения Facebook

Чтобы использовать учетную запись Facebook в качестве поставщика удостоверений в Azure AD B2C, необходимо создать приложение в Facebook. Если у вас нет учетной записи Facebook, вы можете получить ее по адресу [https://www.facebook.com/](https://www.facebook.com/).

1. Выполните вход на [веб-сайт разработчиков Facebook](https://developers.facebook.com/) с учетными данными от учетной записи Facebook.
1. Если вы этого еще не сделали, необходимо зарегистрироваться в качестве разработчика Facebook. Чтобы сделать это, выберите **приступить к работе** в правом верхнем углу страницы, примите политики Facebook и завершите регистрацию.
1. Выберите **Мои приложения** и затем **Создание приложения**.
1. Введите **Отображаемое название** и **Эл. адрес для связи**.
1. Нажмите кнопку **Создайте ID приложения**. Для этого может потребоваться принять условия политики платформы Facebook и пройти проверку безопасности в сети.
1. Выберите **Параметры** > **Основные**.
1. Выберите **категорию**, например `Business and Pages`. Это значение требуется Facebook, но не используется Azure AD B2C.
1. В нижней части страницы, выберите **Добавить платформу**, а затем выберите **Веб-сайт**.
1. В поле **URL-адрес сайта** введите `https://your-tenant-name.b2clogin.com/`, заменив `your-tenant-name` именем вашего клиента.
1. Введите **URL-адрес политики конфиденциальности**, например `http://www.contoso.com/`. URL-адрес политики конфиденциальности — это страница, на которые нужно поддерживать для предоставления сведений о конфиденциальности для вашего приложения.
1. Щелкните **Save changes** (Сохранить изменения).
1. В верхней части страницы, запишите значение **идентификатор приложения**.
1. Рядом с полем **секрет приложения**выберите **Показать** и запишите его значение. Используйте идентификатор приложения и секрет приложения для настройки Facebook в качестве поставщика удостоверений в клиенте. **Секрет приложения** — это важный элемент обеспечения безопасности учетные данные, в которой следует хранить безопасно.
1. Щелкните знак «плюс» рядом **ПРОДУКТОВ**, а затем в разделе **имени для входа Facebook**выберите **Настройка**.
1. В разделе **имени для входа Facebook** в меню слева выберите **параметры**.
1. В поле **Valid OAuth redirect URIs** (Допустимые URI перенаправления OAuth) введите `https://your-tenant-name.b2clogin.com/your-tenant-name.onmicrosoft.com/oauth2/authresp`. Замените `your-tenant-name` именем вашего клиента. Выберите **сохранить изменения** в нижней части страницы.
1. Чтобы подготовить приложение Facebook в Azure AD B2C, нажмите кнопку **состояние** селектор в верхней правой части страницы и превратить ее **на** сделать общедоступными приложения, а затем нажмите кнопку **подтверждение** . На этом этапе состояние должно измениться с **Разработка** на **Активно**.

## <a name="add-the-identity-providers"></a>Добавление поставщиков удостоверений

После создания приложения для поставщика удостоверений, который необходимо добавить, вы добавляете поставщик удостоверений к своему арендатору.

### <a name="add-the-azure-active-directory-identity-provider"></a>Добавление поставщика удостоверений Azure Active Directory

1. Убедитесь, что используете каталог, содержащий клиент Azure AD B2C, щелкнув **Фильтр каталога и подписки** в верхнем меню и выбрав каталог, который содержит ваш клиент.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Щелкните **Поставщики удостоверений** и выберите **Добавить**.
1. Введите **Имя**. Например, введите *Azure AD Contoso*.
1. Щелкните **Тип поставщика удостоверений**, выберите **Open ID Connect** и нажмите кнопку **ОК**.
1. Щелкните **Настроить этот поставщик удостоверений**.
1. Для **URL-адрес метаданных**, введите следующий URL-адрес, заменив `your-AD-tenant-domain` доменным именем вашего клиента Azure AD.

    ```
    https://login.microsoftonline.com/your-AD-tenant-domain/.well-known/openid-configuration
    ```

    Например, `https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration`.

1. Для **идентификатор клиента**, введите *идентификатор приложения (клиент)* записанным ранее.
1. Для **секрет клиента**, введите *секрет клиента* значением, записанным ранее.
1. При необходимости введите значение для **Domain_hint**. Например, `ContosoAD`. [Указания домена](../active-directory/manage-apps/configure-authentication-for-federated-users-portal.md) представляют собой директивы, включенные в запрос на аутентификацию из приложения. Их можно использовать для ускорения входа пользователя на страницу входа федеративного поставщика удостоверений. Или они могут использоваться мультитенантным приложением, чтобы ускорить для клиента вход пользователя непосредственно на страницу входа Azure AD с фирменной символикой.
1. Нажмите кнопку **ОК**.
1. Выберите **Сопоставление утверждений для этого поставщика удостоверений** и задайте следующие утверждения.

    - В поле **Идентификатор пользователя** введите `oid`.
    - В поле **Отображаемое имя** введите `name`.
    - В поле **Имя** введите `given_name`.
    - В поле **Фамилия** введите `family_name`.
    - В поле **Электронная почта** введите `unique_name`.

1. Выберите **ОК**, а затем выберите **создать** чтобы сохранить конфигурацию.

### <a name="add-the-facebook-identity-provider"></a>Добавление поставщика удостоверений в Facebook

1. Щелкните **Поставщики удостоверений** и выберите **Добавить**.
1. Введите **Имя**. Например, введите *Facebook*.
1. Выберите **тип поставщика удостоверений**выберите **Facebook**, а затем выберите **ОК**.
1. Выберите **настроить этот поставщик удостоверений** и введите *идентификатор приложения* , записанные ранее в качестве **идентификатор клиента**.
1. Введите *секрет приложения* , записанный как **секрет клиента**.
1. Выберите **ОК** , а затем выберите **создать** чтобы сохранить конфигурацию Facebook.

## <a name="update-the-user-flow"></a>Обновление потока пользователя

В этом руководстве, которое вы завершили как часть предварительных условий, вы создали пользовательский поток для регистрации и входа с именем *B2C_1_signupsignin1*. В этом разделе вы добавляете поставщики удостоверений в поток пользователя *B2C_1_signupsignin1*.

1. Выберите **Потоки пользователей (политики)** , а затем выберите поток пользователя *B2C_1_signupsignin1*.
2. В разделе **Поставщики удостоверений** выберите **Facebook**, а затем добавленные поставщики удостоверений **Azure AD Contoso**.
3. Щелкните **Сохранить**.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. На странице "Обзор" созданного потока пользователя выберите **Выполнить поток пользователя**.
1. В разделе **Приложение** выберите зарегистрированное ранее веб-приложение с именем *webapp1*. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Выберите **выполнения потока пользователя**и затем войдите, используя поставщик удостоверений, добавленный ранее.
1. Повторите шаги 1–3 для других добавленных поставщиков удостоверений.

При успешном выполнении входа в операции, вы будете перенаправлены `https://jwt.ms` отображает декодировать Token, аналогичную:

```json
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "<key-ID>"
}.{
  "exp": 1562346892,
  "nbf": 1562343292,
  "ver": "1.0",
  "iss": "https://your-b2c-tenant.b2clogin.com/10000000-0000-0000-0000-000000000000/v2.0/",
  "sub": "20000000-0000-0000-0000-000000000000",
  "aud": "30000000-0000-0000-0000-000000000000",
  "nonce": "defaultNonce",
  "iat": 1562343292,
  "auth_time": 1562343292,
  "name": "User Name",
  "idp": "facebook.com",
  "postalCode": "12345",
  "tfp": "B2C_1_signupsignin1"
}.[Signature]
```

## <a name="next-steps"></a>Следующие шаги

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Узнайте, как настроить пользовательский Интерфейс страницы, которые отображаются для пользователей, как часть процедур идентификации в приложениях:

> [!div class="nextstepaction"]
> [Руководство. Настройка пользовательского интерфейса приложений в Azure Active Directory B2C](tutorial-customize-ui.md)
