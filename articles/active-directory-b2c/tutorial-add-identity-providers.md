---
title: Руководство по Добавление поставщиков удостоверений в приложения
titleSuffix: Azure AD B2C
description: Узнайте, как добавить поставщики удостоверений своим приложениям в Azure Active Directory B2C с помощью портала Azure.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: tutorial
ms.date: 07/30/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 1bdb7637624a1da5270eb1cba49e9f66e5042ccf
ms.sourcegitcommit: 11e2521679415f05d3d2c4c49858940677c57900
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2020
ms.locfileid: "87482011"
---
# <a name="tutorial-add-identity-providers-to-your-applications-in-azure-active-directory-b2c"></a>Руководство по Добавление поставщиков удостоверений приложениям в Azure Active Directory B2C

В своих приложениях вы можете разрешить пользователям входить с разными поставщиками удостоверений. *Поставщик удостоверений* создает, поддерживает и управляет сведениями об удостоверении, одновременно предоставляя приложениям службы проверки подлинности. С помощью портала Azure вы можете добавить поставщики удостоверений, которые поддерживает Azure Active Directory B2C (Azure AD B2C), в свои [потоки пользователя](user-flow-overview.md).

Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений в клиент через Facebook и Azure Active Directory
> * Добавление поставщиков удостоверений для вашего потока пользователя

Обычно в приложениях используется только один поставщик удостоверений, но у вас есть возможность добавить еще. В этом руководстве показано, как добавить поставщик удостоверений Azure AD и Facebook в приложение. Добавление обоих этих поставщиков удостоверений в приложение является необязательным. Кроме того, вы можете добавить другие поставщики удостоверений, например [Amazon](identity-provider-amazon.md), [GitHub](identity-provider-github.md), [Google](identity-provider-google.md), [LinkedIn](identity-provider-linkedin.md), [Microsoft](identity-provider-microsoft-account.md) или [Twitter](identity-provider-twitter.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

[Создайте поток пользователя](tutorial-create-user-flows.md), чтобы пользователи могли зарегистрироваться и войти в ваше приложение.

## <a name="create-applications"></a>Создавать приложения

Приложения поставщика удостоверений предоставляют идентификатор и ключ для обеспечения связи с вашим клиентом Azure AD B2C. В этом разделе руководства вы создадите приложения Azure AD и Facebook, из которых получите идентификаторы и ключи, чтобы добавить в клиент поставщики удостоверений. Если вы добавляете лишь один из поставщиков удостоверений, необходимо создать приложение для данного поставщика.

### <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Чтобы включить вход для пользователей из Azure AD, вам необходимо зарегистрировать приложение в клиенте Azure AD. Клиент Azure AD отличается от клиента Azure AD B2C.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Убедитесь, что вы используете каталог с клиентом Azure AD, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом Azure AD.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Введите имя приложения. Например, `Azure AD B2C App`.
1. Подтвердите выбор параметра **Accounts in this organizational directory only** (Учетные записи только в этом каталоге организации) для этого приложения.
1. В поле **URI перенаправления** подтвердите значение **Веб** и введите уазанный ниже URL-адрес (строчными буквами), заменив `your-B2C-tenant-name` реальным именем клиента Azure AD B2C.

    ```
    https://your-B2C-tenant-name.b2clogin.com/your-B2C-tenant-name.onmicrosoft.com/oauth2/authresp
    ```

    Например, `https://contoso.b2clogin.com/contoso.onmicrosoft.com/oauth2/authresp`.

    Всем URL-адресам следует использовать [b2clogin.com](b2clogin.md).

1. Щелкните **Зарегистрировать**, а затем запишите значение **Идентификатор приложения (клиента)** , который вы примените на более позднем шаге.
1. В разделе **Управление** в меню приложения выберите пункт **Сертификаты и секреты**, а затем щелкните элемент **Новый секрет клиента**.
1. Введите **описание** для секрета клиента. Например, `Azure AD B2C App Secret`.
1. Выберите срок действия. Для этого приложения выберите вариант **Через один год**.
1. Щелкните команду **Добавить**, а затем запишите значение нового секрета клиента, который вы примените на более позднем этапе.

### <a name="create-a-facebook-application"></a>Создание приложения Facebook

Чтобы использовать учетную запись Facebook в качестве поставщика удостоверений в Azure AD B2C, необходимо создать приложение в Facebook. Если у вас нет учетной записи Facebook, вы можете получить ее по адресу [https://www.facebook.com/](https://www.facebook.com/).

1. Выполните вход на [веб-сайт разработчиков Facebook](https://developers.facebook.com/) с учетными данными от учетной записи Facebook.
1. Если вы этого еще не сделали, необходимо зарегистрироваться в качестве разработчика Facebook. Для этого щелкните **Get Started** (Начать работу) в правом верхнем углу страницы, примите политики Facebook и завершите регистрацию.
1. Щелкните **My Apps** (Мои приложения) и **Create App** (Создать приложение).
1. Введите **Отображаемое название** и **Эл. адрес для связи**.
1. Нажмите кнопку **Создайте ID приложения**. Для этого может потребоваться принять условия политики платформы Facebook и пройти проверку безопасности в сети.
1. Выберите **Параметры** > **Основные**.
1. Выберите **категорию**, например `Business and Pages`. Это значение требуется для Facebook, но не используется в Azure AD B2C.
1. В нижней части страницы, выберите **Добавить платформу**, а затем выберите **Веб-сайт**.
1. В поле **URL-адрес сайта** введите `https://your-tenant-name.b2clogin.com/`, заменив `your-tenant-name` именем вашего клиента.
1. Введите **URL-адрес политики конфиденциальности**, например `http://www.contoso.com/`. URL-адрес политики конфиденциальности — это управляемая вами страница со сведениями о конфиденциальности для вашего приложения.
1. Щелкните **Save changes** (Сохранить изменения).
1. В верхней части страницы скопируйте значение **App ID** (Идентификатор приложения).
1. Рядом с полем **App Secret** (Секрет приложения) щелкните кнопку **Show** (Показать) и скопируйте представленное значение. Идентификатор и секрет приложения потребуются вам для настройки Facebook в качестве поставщика удостоверений для вашего клиента. **Секрет приложения** — это важные учетные данные безопасности, которые необходимо хранить безопасно.
1. Щелкните знак плюса рядом с полем **PRODUCTS** (Продукты), а затем выберите **Set up** (Настройка) в разделе **Facebook Login** (Вход через Facebook).
1. В разделе **Facebook Login** (Вход через Facebook) в меню слева выберите **Settings** (Параметры).
1. В поле **Valid OAuth redirect URIs** (Допустимые URI перенаправления OAuth) введите `https://your-tenant-name.b2clogin.com/your-tenant-name.onmicrosoft.com/oauth2/authresp`. Замените `your-tenant-name` именем вашего клиента. Щелкните**Save Changes** (Сохранить изменения) в нижней части страницы.
1. Чтобы сделать приложение Facebook доступным в Azure AD B2C, щелкните селектор **Status** (Состояние) в верхней правой части страницы и установите его в положение **On** (Вкл.) для предоставления общего доступа к приложению, а затем нажмите кнопку **Confirm** (Подтвердить). На этом этапе состояние должно измениться с **Разработка** на **Активно**.

## <a name="add-the-identity-providers"></a>Добавление поставщиков удостоверений

После создания приложения для поставщика удостоверений, который необходимо добавить, вы добавляете поставщик удостоверений к своему арендатору.

### <a name="add-the-azure-active-directory-identity-provider"></a>Добавление поставщика удостоверений Azure Active Directory

1. Убедитесь, что вы используете каталог, содержащий клиент Azure AD B2C. Выберите фильтр **Каталог и подписка** в верхнем меню, а затем каталог, содержащий клиент Azure AD B2C.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Щелкните элемент **Поставщики удостоверений**, а затем выберите **Новый поставщик OpenID Connect**.
1. Введите **Имя**. Например, введите *Azure AD Contoso*.
1. В поле **URL-адрес метаданных** введите указанный ниже URL-адрес, заменив `your-AD-tenant-domain` реальным доменным именем вашего клиента Azure AD.

    ```
    https://login.microsoftonline.com/your-AD-tenant-domain/.well-known/openid-configuration
    ```

    Например, `https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration`.

1. В поле **Идентификатор клиента** введите ранее записанное значение идентификатора приложения.
1. В поле **Секрет клиента** введите ранее записанное значение секрета клиента.
1. Сохраните значения по умолчанию для параметров **Область**, **Тип ответа** и **Режим ответа**.
1. (Необязательно) Введите значение для указания домена (**Domain_hint**). Например, *ContosoAD*. [Указания домена](../active-directory/manage-apps/configure-authentication-for-federated-users-portal.md) представляют собой директивы, включаемые в запрос на аутентификацию из приложения. Их можно использовать для ускорения входа пользователя на страницу входа федеративного поставщика удостоверений. Или они могут использоваться мультитенантным приложением, чтобы ускорить для клиента вход пользователя непосредственно на страницу входа Azure AD с фирменной символикой.
1. В разделе **Сопоставление утверждений поставщика удостоверений** введите следующие значения для сопоставления утверждений:

    * **User ID**: *oid*;
    * **Display name**: *name*;
    * **Given name**: *given_name*;
    * **Surname**: *family_name*;
    * **Email**: *unique_name*.

1. Щелкните **Сохранить**.

### <a name="add-the-facebook-identity-provider"></a>Добавление поставщика удостоверений в Facebook

1. Щелкните элемент **Поставщики удостоверений** и выберите вариант **Facebook**.
1. Введите **Имя**. Например, *Facebook*.
1. В поле **Идентификатор клиента** введите идентификатор созданного ранее приложения Facebook.
1. В поле **Секрет клиента** введите секрет приложения, записанный ранее.
1. Щелкните **Сохранить**.

## <a name="update-the-user-flow"></a>Обновление потока пользователя

В этом руководстве, которое вы завершили как часть предварительных условий, вы создали пользовательский поток для регистрации и входа с именем *B2C_1_signupsignin1*. В этом разделе вы добавляете поставщики удостоверений в поток пользователя *B2C_1_signupsignin1*.

1. Выберите **Потоки пользователей** и щелкните поток пользователя *B2C_1_signupsignin1*.
2. В разделе **Поставщики удостоверений** выберите **Facebook**, а затем добавленные поставщики удостоверений **Azure AD Contoso**.
3. Щелкните **Сохранить**.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. На странице "Обзор" созданного потока пользователя выберите **Выполнить поток пользователя**.
1. В разделе **Приложение** выберите зарегистрированное ранее веб-приложение с именем *webapp1*. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Выберите элемент **Выполнить поток пользователя** и выполните вход с помощью добавленного ранее поставщика удостоверений.
1. Повторите шаги 1–3 для других добавленных поставщиков удостоверений.

В случае успешного входа вы будете перенаправлены на страницу `https://jwt.ms`, где отображается декодированный токен следующего вида:

```json
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "<key-ID>"
}.{
  "exp": 1562346892,
  "nbf": 1562343292,
  "ver": "1.0",
  "iss": "https://your-b2c-tenant.b2clogin.com/10000000-0000-0000-0000-000000000000/v2.0/",
  "sub": "20000000-0000-0000-0000-000000000000",
  "aud": "30000000-0000-0000-0000-000000000000",
  "nonce": "defaultNonce",
  "iat": 1562343292,
  "auth_time": 1562343292,
  "name": "User Name",
  "idp": "facebook.com",
  "postalCode": "12345",
  "tfp": "B2C_1_signupsignin1"
}.[Signature]
```

## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Теперь узнайте, как настроить пользовательский интерфейс для страниц, которые отображаются в процессах подтверждения личности в приложениях.

> [!div class="nextstepaction"]
> [Руководство. Настройка пользовательского интерфейса приложений в Azure Active Directory B2C](tutorial-customize-ui.md)
