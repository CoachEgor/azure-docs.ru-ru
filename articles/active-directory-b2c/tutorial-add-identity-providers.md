---
title: 'Учебник: Добавление поставщиков идентификационных данных в приложения'
titleSuffix: Azure AD B2C
description: Узнайте, как добавить поставщики удостоверений своим приложениям в Azure Active Directory B2C с помощью портала Azure.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: article
ms.date: 07/08/2019
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 1f49061210ca8e3c106b0569f77a67d1f10757a1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78183522"
---
# <a name="tutorial-add-identity-providers-to-your-applications-in-azure-active-directory-b2c"></a>Учебник: Добавление поставщиков идентификационных данных в приложениях Azure Active Directory B2C

В своих приложениях вы можете разрешить пользователям входить с разными поставщиками удостоверений. *Поставщик удостоверений* создает, поддерживает и управляет сведениями об удостоверении, одновременно предоставляя приложениям службы проверки подлинности. Вы можете добавить в [потоки пользователей](user-flow-overview.md) с помощью портала Azure провайдеры идентификационных данных, поддерживаемые B2C Active Directory B2C (Azure AD B2C).

Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Обычно в приложениях используется только один поставщик удостоверений, но у вас есть возможность добавить еще. В этом руководстве показано, как добавить поставщик удостоверений Azure AD и Facebook в приложение. Добавление обоих этих поставщиков удостоверений в приложение является необязательным. Вы также можете добавить другие поставщики идентификационных данных, такие как [Amazon,](identity-provider-amazon.md) [GitHub,](identity-provider-github.md) [Google,](identity-provider-google.md) [LinkedIn,](identity-provider-linkedin.md) [Microsoft](identity-provider-microsoft-account.md)или [Twitter](identity-provider-twitter.md).

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Предварительные требования

[Создайте поток пользователя](tutorial-create-user-flows.md), чтобы пользователи могли зарегистрироваться и войти в ваше приложение.

## <a name="create-applications"></a>Создавать приложения

Приложения поставщика удостоверений предоставляют идентификатор и ключ для обеспечения связи с вашим клиентом Azure AD B2C. В этом разделе руководства вы создадите приложения Azure AD и Facebook, из которых получите идентификаторы и ключи, чтобы добавить в клиент поставщики удостоверений. Если вы добавляете лишь один из поставщиков удостоверений, необходимо создать приложение для данного поставщика.

### <a name="create-an-azure-active-directory-application"></a>Создание приложения Azure Active Directory

Чтобы включить вход для пользователей из Azure AD, вам необходимо зарегистрировать приложение в клиенте Azure AD. Клиент Azure AD отличается от клиента Azure AD B2C.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Убедитесь, что вы используете каталог, содержащий ваш клиент Azure AD, выбрав фильтр **подписки каталога в** верхнем меню и выбрав каталог, содержащий арендатор Azure AD.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Регистрация приложений**.
1. Выберите **Новая регистрация**.
1. Введите имя приложения. Например, `Azure AD B2C App`.
1. Примите выбор **учетных записей в этом каталоге организации только** для этого приложения.
1. Для **перенаправления URI**примите значение **Web** и введите следующий URL `your-B2C-tenant-name` во всех буквах нижнего регистра, заменив имя вашего арендатора Azure AD B2C.

    ```
    https://your-B2C-tenant-name.b2clogin.com/your-B2C-tenant-name.onmicrosoft.com/oauth2/authresp
    ```

    Например, `https://contoso.b2clogin.com/contoso.onmicrosoft.com/oauth2/authresp`.

    Всем URL-адресам следует использовать [b2clogin.com](b2clogin.md).

1. Выберите **Регистр,** затем запишите **идентификатор приложения (клиента),** который вы используете на более позднем этапе.
1. Под **управлением** в меню приложения, выберите **Сертификаты & секреты,** а затем выберите **новый секрет клиента**.
1. Введите **описание** секрета клиента. Например, `Azure AD B2C App Secret`.
1. Выберите период истечения срока действия. Для этого приложения, принять выбор **В 1 год**.
1. Выберите **Добавить,** а затем записать значение нового клиента секрет, который вы используете в более позднем шаге.

### <a name="create-a-facebook-application"></a>Создание приложения Facebook

Чтобы использовать учетную запись Facebook в качестве поставщика удостоверений в Azure AD B2C, необходимо создать приложение в Facebook. Если у вас еще нет учетной записи [https://www.facebook.com/](https://www.facebook.com/)Facebook, вы можете получить ее по адресу .

1. Выполните вход на [веб-сайт разработчиков Facebook](https://developers.facebook.com/) с учетными данными от учетной записи Facebook.
1. Если вы этого еще не сделали, необходимо зарегистрироваться в качестве разработчика Facebook. Для этого выберите **Get Started** в правом верхнем углу страницы, примите политики Facebook и завершите шаги по регистрации.
1. Выберите **мои приложения,** а затем **создайте приложение**.
1. Введите **Отображаемое название** и **Эл. адрес для связи**.
1. Нажмите кнопку **Создайте ID приложения**. Для этого может потребоваться принять условия политики платформы Facebook и пройти проверку безопасности в сети.
1. Выберите **Настройки** > **Основные**.
1. Выберите **категорию**, например `Business and Pages`. Это значение требуется Facebook, но не используется Azure AD B2C.
1. В нижней части страницы, выберите **Добавить платформу**, а затем выберите **Веб-сайт**.
1. В поле **URL-адрес сайта** введите `https://your-tenant-name.b2clogin.com/`, заменив `your-tenant-name` именем вашего клиента.
1. Введите **URL-адрес политики конфиденциальности**, например `http://www.contoso.com/`. URL-адрес политики конфиденциальности — это страница, на которая вы ведете, чтобы предоставить информацию о конфиденциальности для вашего приложения.
1. Щелкните **Save changes** (Сохранить изменения).
1. В верхней части страницы запишите значение **Идентификатора Приложения.**
1. Рядом с **App Secret,** выберите **Показать** и записать его значение. Вы используете идентификатор приложения и App Secret для настройки Facebook в качестве поставщика идентификационных данных в вашем арендаторе. **App Secret** является важным учетным данным безопасности, которые вы должны хранить надежно.
1. Выберите плюс знак рядом с **PRODUCTS**, то под **Facebook Войти,** выберите **Настройка.**
1. Под **Facebook Login** в левом меню выберите **Настройки.**
1. В поле **Valid OAuth redirect URIs** (Допустимые URI перенаправления OAuth) введите `https://your-tenant-name.b2clogin.com/your-tenant-name.onmicrosoft.com/oauth2/authresp`. Замените `your-tenant-name` именем вашего клиента. Выберите **Сохранить изменения** в нижней части страницы.
1. Чтобы сделать ваше приложение Facebook доступным для Azure AD B2C, щелкните селектор **статуса** в правом верхнем правом верхнем виде страницы и включите **его,** чтобы сделать приложение общедоступным, а затем нажмите **Confirm.** На этом этапе состояние должно измениться с **Разработка** на **Активно**.

## <a name="add-the-identity-providers"></a>Добавление поставщиков удостоверений

После создания приложения для поставщика удостоверений, который необходимо добавить, вы добавляете поставщик удостоверений к своему арендатору.

### <a name="add-the-azure-active-directory-identity-provider"></a>Добавление поставщика удостоверений Azure Active Directory

1. Убедитесь, что вы используете каталог, содержащий арендатор Azure AD B2C. Выберите фильтр **подписки каталога** в верхнем меню и выберите каталог, содержащий ваш клиент Azure AD B2C.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Выберите **поставщиков идентификационных данных,** а затем выберите **нового поставщика OpenID Connect.**
1. Введите **имя**. Например, введите *Azure AD Contoso*.
1. Для **URL-адреса Metadata**введите следующий URL-адрес, заменив `your-AD-tenant-domain` его доменным именем вашего aure AD-арендатора:

    ```
    https://login.microsoftonline.com/your-AD-tenant-domain/.well-known/openid-configuration
    ```

    Например, `https://login.microsoftonline.com/contoso.onmicrosoft.com/.well-known/openid-configuration`.

1. Для **идентификатора клиента**введите идентификатор приложения, который вы ранее записали.
1. Для **секрета клиента,** введите секрет клиента, который вы ранее записали.
1. Оставьте значения по умолчанию для **scope,** **Response type**и **режима ответа.**
1. (Необязательно) Введите значение для **Domain_hint.** Например, *ContosoAD*. [Подсказки домена](../active-directory/manage-apps/configure-authentication-for-federated-users-portal.md) являются директивами, включенными в запрос на проверку подлинности приложения. Их можно использовать для ускорения входа пользователя на страницу входа федеративного поставщика удостоверений. Или они могут использоваться мультитенантным приложением, чтобы ускорить для клиента вход пользователя непосредственно на страницу входа Azure AD с фирменной символикой.
1. В соответствии с **картированием требований поставщика идентификационных данных**введите следующие значения отображения утверждений:

    * **Идентификатор пользователя**: *oid*
    * **Имя дисплея**: *имя*
    * **Данное имя**: *given_name*
    * **Фамилия**: *family_name*
    * **Электронная почта**: *unique_name*

1. Нажмите кнопку **Сохранить**.

### <a name="add-the-facebook-identity-provider"></a>Добавление поставщика удостоверений в Facebook

1. Выберите **поставщиков идентификационных данных,** а затем выберите **Facebook.**
1. Введите **имя**. Например, *Facebook*.
1. Для **идентификатора клиента**введите идентификатор приложения Facebook, созданного ранее.
1. Для **секрета клиента,** введите Секрет app который вы записали.
1. Нажмите кнопку **Сохранить**.

## <a name="update-the-user-flow"></a>Обновление потока пользователя

В этом руководстве, которое вы завершили как часть предварительных условий, вы создали пользовательский поток для регистрации и входа с именем *B2C_1_signupsignin1*. В этом разделе вы добавляете поставщики удостоверений в поток пользователя *B2C_1_signupsignin1*.

1. Выберите **Потоки пользователей (политики)**, а затем — поток пользователя *B2C_1_signupsignin1*.
2. В разделе **Поставщики удостоверений** выберите **Facebook**, а затем добавленные поставщики удостоверений **Azure AD Contoso**.
3. Нажмите кнопку **Сохранить**.

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. На странице "Обзор" созданного потока пользователя выберите **Выполнить поток пользователя**.
1. В разделе **Приложение** выберите зарегистрированное ранее веб-приложение с именем *webapp1*. В поле **URL-адрес ответа** должно содержаться значение `https://jwt.ms`.
1. Выберите **поток пользователей,** а затем вопийте с поставщиком идентификационных данных, который вы ранее добавили.
1. Повторите шаги 1–3 для других добавленных поставщиков удостоверений.

Если в действии знака удается, `https://jwt.ms` вы перенаправляется, на который отображается декодированный токен, похожий на:

```json
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "<key-ID>"
}.{
  "exp": 1562346892,
  "nbf": 1562343292,
  "ver": "1.0",
  "iss": "https://your-b2c-tenant.b2clogin.com/10000000-0000-0000-0000-000000000000/v2.0/",
  "sub": "20000000-0000-0000-0000-000000000000",
  "aud": "30000000-0000-0000-0000-000000000000",
  "nonce": "defaultNonce",
  "iat": 1562343292,
  "auth_time": 1562343292,
  "name": "User Name",
  "idp": "facebook.com",
  "postalCode": "12345",
  "tfp": "B2C_1_signupsignin1"
}.[Signature]
```

## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Создание приложений поставщика удостоверений
> * Добавление поставщиков удостоверений для вашего клиента
> * Добавление поставщиков удостоверений для вашего потока пользователя

Далее, узнайте, как настроить пользовательский интерфейс страниц, показанных пользователям, как часть их идентификации в приложениях:

> [!div class="nextstepaction"]
> [Настройка пользовательского интерфейса приложений в Azure Active Directory B2C](tutorial-customize-ui.md)
