---
title: Потоки пользователей в Azure Active Directory B2C | Документация Майкрософт
description: Сведения о расширяемой платформе политик Azure Active Directory B2C и создании различных потоков пользователей.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 11/30/2018
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: c11bc48742c398d2048a236c7d00af044971f845
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "78185623"
---
# <a name="user-flows-in-azure-active-directory-b2c"></a>Потоки пользователей в Azure Active Directory B2C

Расширяемая структура политик Azure Active Directory B2C (Azure AD B2C) — это основная сила службы. Политики полностью описывают процесс идентификации: регистрацию, вход и редактирование профиля. Чтобы вам было проще настроить наиболее распространенные задачи идентификации, на портале Azure AD B2C реализованы предопределенные настраиваемые политики, которые называются **потоками пользователей**.

## <a name="what-are-user-flows"></a>Что такое потоки пользователей?

Поток пользователя позволяет управлять поведением в приложениях с помощью таких параметров:

- типы учетных записей, используемые для входа в систему, такие как учетные записи социальных сетей, например Facebook, или локальные учетные записи;
- атрибуты, которые нужно получить от пользователя, например имя, почтовый индекс и размер обуви;
- Многофакторная идентификация Azure
- настройка пользовательского интерфейса;
- сведения, которые приложение получает в виде утверждений в токене.

В своем клиенте вы можете создать много потоков пользователей различных типов и при необходимости использовать их в приложениях. Потоки пользователей могут повторно использоваться в разных приложениях. Такая гибкость позволяет определять и изменять процесс идентификации, внося лишь незначительные изменения в код или совсем не изменяя его. Приложение запускает поток пользователя с помощью стандартного HTTP-запроса на проверку подлинности, содержащего параметры потока пользователя. Настраиваемый [токен](tokens-overview.md) возвращается в качестве ответа.

Ниже приведены примеры, в которых используется параметр строки запроса "p", указывающий на поток пользователя для использования.

```
https://contosob2c.b2clogin.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siup                                       // Your sign-up user flow
```

```
https://contosob2c.b2clogin.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siin                                       // Your sign-in user flow
```

## <a name="user-flow-versions"></a>Версии потоков на уровне пользователя

На портале Azure постоянно добавляются новые [версии потоков пользователей](user-flow-versions.md). Если вы только начинаете работать с Azure AD B2C, рекомендуется использовать протестированные потоки пользователей. При создании нового потока пользователя вы выбираете поток нужного типа на вкладке **Рекомендуемые**.

В настоящее время рекомендуется использовать следующие потоки пользователей:

- **Sign up and sign in** (Регистрация и вход) — регулирует процедуры регистрации и входа в систему в рамках одной конфигурации. Пользователи проходят через соответствующую процедуру в зависимости от контекста. Мы советуем использовать этот поток пользователя вместо потока пользователя **регистрации** или **входа**.
- **Profile editing** (Изменение профиля) — позволяет пользователям изменять сведения профиля.
- **Password reset** (Сброс пароля) — позволяет настроить возможность и способ сброса паролей пользователями.

## <a name="linking-user-flows"></a>Связывание потоков пользователей

При использовании потока пользователя **регистрации или входа** с локальными учетными записями на первой странице интерфейса отображается ссылка **Забыли пароль?**. При переходе по этой ссылке поток пользователя сброса паролей не активируется автоматически.

Вместо этого в приложение возвращается код ошибки `AADB2C90118`. Приложение должно обработать этот код ошибки, выполнив конкретный поток пользователя, который позволяет сбросить пароль. Чтобы увидеть пример, просмотрите [простой пример ASP.NET](https://github.com/AzureADQuickStarts/B2C-WebApp-OpenIDConnect-DotNet-SUSI), в котором демонстрируется связывание потоков пользователей.

## <a name="email-address-storage"></a>Место хранения адреса электронной почты

Адрес электронной почты может требоваться как часть потока пользователя. Если пользователь проходит проверку подлинности с помощью поставщика удостоверений социальных сетей, адрес электронной почты сохраняется в свойстве **otherMails**. Если локальная учетная запись основана на имени пользователя, адрес электронной почты сохраняется в свойстве сведений строгой проверки подлинности. Если локальная учетная запись основана на адресе электронной почты, адрес электронной почты сохраняется в свойстве **signInNames**.

Проверка адреса электронной почты не гарантируется в любом из этих вариантов. Администратор клиента может отключить проверку адреса электронной почты в базовых политиках для локальных учетных записей. Даже если проверка адреса электронной почты включена, адреса не проверяются, если они исходят от поставщика удостоверений социальных сетей и они еще не были изменены.

Через API Microsoft Graph доступны только свойства **осермаилс** и **signInNames** . Адрес электронной почты в свойстве сведений строгой проверки подлинности недоступен.

## <a name="next-steps"></a>Дальнейшие шаги

Чтобы создать рекомендованные пользовательские потоки, следуйте инструкциям в разделе [учебник. Создание потока пользователя](tutorial-create-user-flows.md).
