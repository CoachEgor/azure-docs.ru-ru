---
title: Руководство по включению проверки подлинности в одностраничном приложении
titleSuffix: Azure AD B2C
description: Из этого учебника вы узнаете, как с помощью Azure Active Directory B2C обеспечить вход пользователя в систему для одностраничного приложения на базе JavaScript (SPA).
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.author: mimart
ms.date: 10/14/2019
ms.custom: mvc, seo-javascript-september2019
ms.topic: tutorial
ms.service: active-directory
ms.subservice: B2C
ms.openlocfilehash: 435800d9c6bfd9131d50681a9808f9836104fac0
ms.sourcegitcommit: 0947111b263015136bca0e6ec5a8c570b3f700ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "78183352"
---
# <a name="tutorial-enable-authentication-in-a-single-page-application-using-azure-active-directory-b2c-azure-ad-b2c"></a>Руководство по Включение в одностраничном приложении проверки подлинности с помощью Azure Active Directory B2C (Azure AD B2C)

В этом руководстве показано, как использовать Azure Active Directory (Azure Active Directory) B2C для входа и регистрации пользователей в одностраничном приложении (SPA). Azure AD B2C позволяет приложениям выполнять проверку подлинности учетных записей социальных сетей, корпоративных учетных записей и учетных записей Azure Active Directory с помощью стандартных протоколов.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * настройка примера для использования приложения;
> * регистрация с помощью потока пользователя.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

Для продолжения выполнения действий, описанных в этом учебнике, необходимы следующие ресурсы Azure AD B2C:

* [клиент Azure AD B2C](tutorial-create-tenant.md);
* [приложение, зарегистрированное](tutorial-register-applications.md) в клиенте;
* [созданные маршруты пользователей](tutorial-create-user-flows.md) в клиенте.

Кроме того, вам понадобятся следующие компоненты в локальной среде разработки:

* редактор кода, например [код Visual Studio](https://code.visualstudio.com/) или [Visual Studio 2019](https://www.visualstudio.com/downloads/);
* [.NET Core SDK 2.2](https://dotnet.microsoft.com/download) или более поздней версии.
* [Node.js](https://nodejs.org/en/download/)

## <a name="update-the-application"></a>Обновление приложения

При прохождении второго учебника для выполнения предварительных условий вы зарегистрировали веб-приложение в Azure AD B2C. Для обеспечения взаимодействия с примером в этом руководстве необходимо добавить URI перенаправления для приложения в Azure AD B2C.

Для обновления приложения можно использовать текущий интерфейс **Приложения** или новый объединенный интерфейс **Регистрация приложений (предварительная версия)** . [См. дополнительные сведения о новом интерфейсе](https://aka.ms/b2cappregintro).

#### <a name="applications"></a>[Приложения](#tab/applications/)

1. Войдите на [портал Azure](https://portal.azure.com).
1. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Щелкните пункт **Приложения**, а затем выберите приложение *webapp1*.
1. В разделе **URL-адрес ответа** добавьте `http://localhost:6420`.
1. Щелкните **Сохранить**.
1. На странице свойств запишите **идентификатор приложения**. Идентификатор приложения будет использован на более позднем этапе, когда вы обновите код в одностраничном веб-приложении.

#### <a name="app-registrations-preview"></a>[Регистрация приложений (предварительная версия)](#tab/app-reg-preview/)

1. Войдите на [портал Azure](https://portal.azure.com).
1. Выберите фильтр **Каталог и подписка** в верхнем меню, а затем выберите каталог, содержащий клиент Azure AD B2C.
1. В меню слева выберите **Azure AD B2C**. Либо щелкните **Все службы**, а затем найдите и выберите **Azure AD B2C**
1. Выберите **Регистрация приложений (предварительная версия)** , щелкните вкладку **Собственные приложения**, а затем выберите приложение *webapp1*.
1. Выберите **Проверка подлинности**, а затем — **Попробовать новый пользовательский интерфейс** (если этот параметр показан).
1. В разделе **Интернет** выберите ссылку **Добавление URI**, введите `http://localhost:6420`, а затем нажмите кнопку **Сохранить**.
1. Щелкните **Обзор**.
1. Запишите значение параметра **Идентификатор приложения (клиент)** для использования на более позднем этапе при обновлении кода в одностраничном веб-приложении.

* * *

## <a name="get-the-sample-code"></a>Получение кода примера

С помощью этого руководства вы настроите пример кода, который можно скачать из репозитория GitHub. В этом примере показано, как использовать Azure AD B2C в одностраничном приложении для регистрации и входа пользователя, а также вызова защищенного веб-API.

[Скачайте ZIP-файл](https://github.com/Azure-Samples/active-directory-b2c-javascript-msal-singlepageapp/archive/master.zip) или клонируйте пример с GitHub.

```
git clone https://github.com/Azure-Samples/active-directory-b2c-javascript-msal-singlepageapp.git
```

## <a name="update-the-sample"></a>Обновление примера

Теперь, когда вы получили пример, обновите код, указав имя своего клиента Azure AD B2C и идентификатор приложения, который был записан на предыдущем шаге.

1. Откройте файл `index.html` в корневом каталоге примера.
1. В определении `msalConfig` измените значение **clientId** на идентификатор приложения, который был записан на предыдущем шаге. Затем обновите значение URI **authority**, указав имя клиента Azure AD B2C. Также обновите URI, указав имя маршрута пользователей при регистрации или входе, созданного при выполнении одного из предварительных условий (например, *B2C_1_signupsignin1*).

    ```javascript
    var msalConfig = {
        auth: {
            clientId: "00000000-0000-0000-0000-000000000000", //This is your client ID
            authority: "https://fabrikamb2c.b2clogin.com/fabrikamb2c.onmicrosoft.com/b2c_1_susi", //This is your tenant info
            validateAuthority: false
        },
        cache: {
            cacheLocation: "localStorage",
            storeAuthStateInCookie: true
        }
    };
    ```

    Имя потока пользователя, используемое в этом руководстве, — **B2C_1_signupsignin1**. Если используется другое имя маршрута пользователей, укажите это имя в значении `authority`.

## <a name="run-the-sample"></a>Запуск примера

1. Откройте окно консоли и перейдите в каталог, содержащий этот пример. Пример:

    ```console
    cd active-directory-b2c-javascript-msal-singlepageapp
    ```
1. Выполните следующие команды:

    ```
    npm install && npm update
    node server.js
    ```

    В окне консоли отображается номер порта локально работающего сервера Node.js:

    ```
    Listening on port 6420...
    ```

1. Перейдите к `http://localhost:6420` в браузере для просмотра приложения.

Пример поддерживает регистрацию пользователей, вход в систему, редактирование профилей и сброс паролей. В этом руководстве показан процесс регистрации пользователя с помощью адреса электронной почты.

### <a name="sign-up-using-an-email-address"></a>Регистрация с помощью адреса электронной почты

> [!WARNING]
> После регистрации или входа в систему может появиться [сообщение об ошибке, информирующее о недостаточности разрешений](#error-insufficient-permissions). Эта ошибка возникает из-за текущей реализации примера кода. Эта проблема будет решена в следующей версии примера кода, и тогда это предупреждение будет удалено.

1. Щелкните **Войти**, чтобы инициировать поток пользователя *B2C_1_signupsignin1*, указанный на предыдущем шаге.
1. Появляется страница входа в Azure AD B2C со ссылкой для регистрации. Щелкните ссылку **Зарегистрироваться сейчас**, так как у вас пока нет учетной записи.
1. В рамках рабочего процесса регистрации появляется страница для сбора данных и проверки личности пользователя с использованием адреса электронной почты. Рабочий процесс регистрации также собирает пароль пользователя и запрашиваемые атрибуты, определенные в потоке пользователя.

    Используйте действительный адрес электронной почты и подтвердите его с помощью кода проверки. Задайте пароль. Введите значения запрашиваемых атрибутов.

    ![Страница регистрации, представленная потоком входа и регистрации пользователя](./media/tutorial-single-page-app/azure-ad-b2c-sign-up-workflow.png)

1. Щелкните **Создать**, чтобы создать локальную учетную запись в каталоге Azure AD B2C.

При нажатии кнопки **Создать**, страница регистрации закрывается и страница входа появляется снова.

Теперь можно использовать свой адрес электронной почты и пароль для входа в приложение.

### <a name="error-insufficient-permissions"></a>Ошибка: недостаточно прав

После входа приложение может сообщить об ошибке из-за недостаточных разрешений:

```Output
ServerError: AADB2C90205: This application does not have sufficient permissions against this web resource to perform the operation.
Correlation ID: ce15bbcc-0000-0000-0000-494a52e95cd7
Timestamp: 2019-07-20 22:17:27Z
```

Эта ошибка возникает, так как веб-приложение пытается получить доступ к веб-API, защищенному с помощью демонстрационного каталога *fabrikamb2c*. Так как маркер доступа действителен только для вашего каталога Azure AD, вызов API считается неавторизованным.

Чтобы устранить эту ошибку, перейдите к следующему руководству из этой серии (см. [Дальнейшие действия](#next-steps)), чтобы узнать, как создать защищенный веб-API для своего каталога.

## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * настройка примера для использования приложения;
> * регистрация с помощью потока пользователя.

Теперь перейдите к следующему руководству из этой серии, чтобы предоставить доступ к защищенному веб-API из SPA:

> [!div class="nextstepaction"]
> [Руководство. Предоставление доступа к веб-API ASP.NET Core из одностраничного приложения с помощью Azure AD B2C >](tutorial-single-page-app-webapi.md)
