---
title: Настройка пользовательского интерфейса приложения с помощью настраиваемой политики в Azure Active Directory B2C | Документация Майкрософт
description: Дополнительные сведения о настройке пользовательского интерфейса с помощью настраиваемой политики в Azure Active Directory B2C.
services: active-directory-b2c
author: mmacy
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 09/11/2019
ms.author: marsma
ms.subservice: B2C
ms.openlocfilehash: 2f0e13b4e68ee4b94a254cb8497a44cc0b8b470f
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74209446"
---
# <a name="customize-the-user-interface-of-your-application-using-a-custom-policy-in-azure-active-directory-b2c"></a>Настройка пользовательского интерфейса приложения с помощью настраиваемой политики в Azure Active Directory B2C

[!INCLUDE [active-directory-b2c-advanced-audience-warning](../../includes/active-directory-b2c-advanced-audience-warning.md)]

После завершения работы с этой статьей вы получите настраиваемую политику регистрации и входа в систему с фирменной символикой и внешним видом. Благодаря Azure Active Directory B2C (Azure AD B2C) вы получаете практически полный контроль над содержимым HTML и CSS, которое представляется пользователям. При использовании настраиваемой политики вы настраиваете пользовательский интерфейс в XML-файле, а не с помощью элементов управления на портале Azure.

## <a name="prerequisites"></a>предварительным требованиям

Выполните шаги, описанные в статье [Начало работы с настраиваемыми политиками в Azure Active Directory B2C](active-directory-b2c-get-started-custom.md). Для регистрации и входа с использованием локальных учетных записей необходимо иметь рабочую настраиваемую политику.

## <a name="page-ui-customization"></a>Настройка пользовательского интерфейса страницы

С помощью функции настройки пользовательского интерфейса страницы можно настроить оформление любой настраиваемой политики. Кроме того, можно обеспечить согласованность фирменной символики и визуализации в приложении и службе Azure AD B2C.

Вот как это работает. Служба Azure AD B2C выполняет код в браузере пользователя и использует современный метод — [общий доступ к ресурсам независимо от источника (CORS)](https://www.w3.org/TR/cors/). Сначала необходимо указать URL-адрес в настраиваемой политике с настраиваемым содержимым HTML. Azure AD B2C объединяет элементы пользовательского интерфейса с содержимым HTML, загруженным по указанному URL-адресу, и отображает страницу для пользователя.

## <a name="create-your-html5-content"></a>Создание содержимого HTML5

Создадим содержимое HTML с названием вашей торговой марки в заголовке.

1. Скопируйте следующий фрагмент кода HTML. Это код HTML5 с правильным форматом. Он содержит пустой элемент *\<div id="api"\>\</div\>* , заключенный в теги *\<body\>* . Этот элемент определяет расположение, в которое будет вставлено содержимое Azure AD B2C.

   ```html
   <!DOCTYPE html>
   <html>
   <head>
       <title>My Product Brand Name</title>
   </head>
   <body>
       <div id="api"></div>
   </body>
   </html>
   ```

1. Вставьте скопированный фрагмент кода в текстовый редактор и сохраните файл как *customize-ui.html*.

> [!NOTE]
> Элементы формы HTML будут удалены из-за ограничений безопасности при использовании login.microsoftonline.com. Используйте b2clogin.com, если вы хотите использовать элементы HTML-форм в пользовательском HTML-содержимом. Другие преимущества см. в разделе [использование b2clogin.com](b2clogin.md) .

## <a name="create-an-azure-blob-storage-account"></a>Создание учетной записи хранения BLOB-объектов Azure

>[!NOTE]
> В этой статье мы используем хранилище BLOB-объектов Azure для размещения содержимого. Можно выбрать для этого веб-сервер, но тогда нужно [включить для веб-сервера поддержку CORS](https://enable-cors.org/server.html).

Чтобы разместить это содержимое HTML в хранилище BLOB-объектов, выполните следующие действия.

1. Войдите на [портале Azure](https://portal.azure.com).
1. В меню **Концентратор** выберите **Создать** > **Хранилище** > **Учетная запись хранения**.
1. Выберите **подписку** для своей учетной записи хранения.
1. Создайте новую **группу ресурсов** или выберите существующую.
1. Введите уникальное **имя** учетной записи хранения.
1. Выберите **географический регион** для учетной записи хранения.
1. Для параметра **Модель развертывания** можно оставить значение **Диспетчер ресурсов**.
1. Для параметра **Производительность** можно оставить значение **Стандартная**.
1. Измените **тип учетной записи** на **хранилище BLOB-объектов**.
1. Для параметра **Репликация** можно оставить значение **RA-GRS**.
1. Для параметра **Уровень доступа** можно оставить значение **Горячий**.
1. Щелкните **проверить и создать** , чтобы создать учетную запись хранения.
    После завершения развертывания страница **учетная запись хранения** откроется автоматически.

## <a name="create-a-container"></a>Создание контейнера

Чтобы создать общедоступный контейнер в хранилище BLOB-объектов, выполните следующие действия.

1. В разделе **Служба BLOB-объектов** в меню слева выберите **большие двоичные объекты**.
1. Щелкните **+ контейнер**.
1. В качестве **имени**введите *root*. Это может быть имя вашего выбора, например *wingtiptoys*, но для простоты мы используем *корень* в этом примере.
1. Для общедоступного **уровня доступа**выберите **BLOB-объект**, а затем нажмите **кнопку ОК**.
1. Щелкните **корень** , чтобы открыть новый контейнер.
1. Щелкните **Отправить**.
1. Щелкните значок папки рядом с элементом **Выбор файла**.
1. Перейдите к и выберите **Customize-UI. HTML** , созданный ранее в разделе Настройка пользовательского интерфейса страницы.
1. Если вы хотите отправить во вложенную папку, разверните узел **Дополнительно** и введите имя папки в списке **отправить в папку**.
1. Щелкните **Отправить**.
1. Выберите переданный большой двоичный объект **Customize-UI. HTML** .
1. Справа от текстового поля **URL-адрес** выберите значок **Копировать в буфер обмена** , чтобы скопировать URL-адрес в буфер обмена.
1. В веб-браузере перейдите по URL-адресу, который вы скопировали, чтобы убедиться, что переданный BLOB-объект доступен. Если он недоступен, например, при возникновении ошибки `ResourceNotFound` убедитесь, что для параметра Тип доступа к контейнеру выбрано значение **BLOB**.

## <a name="configure-cors"></a>Настройка CORS

Настройте хранилище BLOB-объектов для совместного использования ресурсов в разных источниках, выполнив следующие действия.

1. В меню выберите **CORS**.
1. В поле **Допустимые источники** введите `https://your-tenant-name.b2clogin.com`. Замените `your-tenant-name` именем вашего клиента Azure AD B2C. Пример: `https://fabrikam.b2clogin.com`. Необходимо использовать только строчные буквы в имени вашего клиента.
1. В поле **Допустимые методы** выберите `GET` и `OPTIONS`.
1. В поле **Допустимые заголовки** введите звездочку (*).
1. В поле **Доступные заголовки** введите звездочку (*).
1. В поле **Максимальный возраст** введите 200.
1. Выберите команду **Сохранить**.

## <a name="test-cors"></a>Тестирование CORS

Убедитесь, что вы готовы, выполнив следующие действия.

1. Перейдите на веб-сайт [www.test-cors.org](https://www.test-cors.org/) и вставьте URL-адрес в поле **Remote URL** (Удаленный URL-адрес).
1. Щелкните **Send Request** (Отправить запрос).
    Если произошла ошибка, проверьте правильность [параметров CORS](#configure-cors). Кроме того, вам может потребоваться очистить кэш браузера или открыть закрытый сеанс, нажав CTRL+SHIFT+P.

## <a name="modify-the-extensions-file"></a>Изменение файла расширений

Чтобы настроить пользовательский интерфейс, скопируйте **ContentDefinition** вместе с дочерним элементом из базового файла в файл расширений.

1. Откройте базовый файл политики. Например, <em>`SocialAndLocalAccounts/` **`TrustFrameworkBase.xml`** </em> . Это один из файлов политики, включенных в начальный пакет пользовательской политики, который должен быть получен в предварительных требованиях, чтобы приступить [к работе с пользовательскими политиками](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-get-started-custom).
1. Найдите и скопируйте содержимое элемента **ContentDefinitions**.
1. Откройте файл расширения, Например, *TrustFrameworkExtensions.xml*. Найдите элемент **BuildingBlocks**. Если такой элемент не существует, добавьте его.
1. Вставьте содержимое скопированного элемента **ContentDefinitions** в качестве дочернего элемента **BuildingBlocks**.
1. Найдите элемент **ContentDefinition**, содержащий `Id="api.signuporsignin"` в скопированном файле XML.
1. Измените значение **LoadUri** на URL-адрес файла HTML, который был передан в хранилище. Пример: `https://your-storage-account.blob.core.windows.net/your-container/customize-ui.html`.

    Пользовательская политика должна выглядеть следующим образом:

    ```xml
    <BuildingBlocks>
      <ContentDefinitions>
        <ContentDefinition Id="api.signuporsignin">
          <LoadUri>https://your-storage-account.blob.core.windows.net/your-container/customize-ui.html</LoadUri>
          <RecoveryUri>~/common/default_page_error.html</RecoveryUri>
          <DataUri>urn:com:microsoft:aad:b2c:elements:unifiedssp:1.0.0</DataUri>
          <Metadata>
            <Item Key="DisplayName">Signin and Signup</Item>
          </Metadata>
        </ContentDefinition>
      </ContentDefinitions>
    </BuildingBlocks>
    ```

1. Сохраните файл расширений.

## <a name="upload-your-updated-custom-policy"></a>Отправка обновленной настраиваемой политики

1. Убедитесь, что используете каталог с клиентом Azure AD B2C, выбрав фильтр **Каталог и подписка** в меню вверху и каталог с вашим клиентом.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Выберите **Инфраструктура процедур идентификации**.
1. Щелкните **Все политики**.
1. Выберите **Отправить политику**.
1. Выполните отправку ранее измененного файла расширений.

## <a name="test-the-custom-policy-by-using-run-now"></a>Тестирование настраиваемой политики с помощью параметра **Запустить сейчас**

1. На странице **Azure AD B2C** выберите **все политики**.
1. Выберите отправленную вами настраиваемую политику и нажмите кнопку **Запустить сейчас**.
1. Вы сможете зарегистрироваться, используя адрес электронной почты.

## <a name="reference"></a>Справочные материалы

### <a name="sample-templates"></a>Примеры шаблонов
Здесь можно найти примеры шаблонов для настройки пользовательского интерфейса:

```
git clone https://github.com/azureadquickstarts/b2c-azureblobstorage-client
```

Папка sample_templates/wingtip содержит следующие файлы HTML:

| Шаблон HTML5 | ОПИСАНИЕ |
|----------------|-------------|
| *phonefactor.html* | Этот файл используется как шаблон для страницы многофакторной проверки подлинности. |
| *ResetPassword.html* | Этот файл используется как шаблон для страницы восстановления пароля. |
| *selfasserted.html* | Этот файл используется как шаблон для страницы регистрации учетных записей социальных сетей, страницы регистрации локальной учетной записи или страницы входа в локальную учетную запись. |
| *unified.html* | Этот файл используется как шаблон для единой страницы регистрации или входа в систему. |
| *updateprofile.html* | Этот файл используется как шаблон для страницы обновления профиля. |

Ниже приведены инструкции по использованию примера.

1. Клонировать репозиторий на локальном компьютере. Выберите папку шаблона в разделе sample_templates. Можно использовать `wingtip` или `contoso`.
1. Передайте все файлы в папки `css`, `fonts`и `images` в хранилище BLOB-объектов, как описано в предыдущих разделах.
1. Затем откройте каждый файл \*. HTML в корне `wingtip` или `contoso` (в зависимости от выбранного на первом шаге) и замените все экземпляры "http://localhost" URL-адресами файлов CSS, изображений и шрифтов, отправленных на шаге 2.
1. Сохраните файлы \*. HTML и отправьте их в хранилище BLOB-объектов.
1. Теперь измените файл расширений, как упоминалось ранее [, в файле](#modify-the-extensions-file)с расширением.
1. Если вы видите отсутствующие шрифты, изображения или CSS, проверьте ссылки в политиках расширений и файлах \*. HTML.

### <a name="content-definition-ids"></a>Идентификаторы определения содержимого

В разделе "Изменение настраиваемой политики регистрации или входа" мы настроили определение содержимого для `api.idpselections`. Полный набор идентификаторов для определения содержимого, распознаваемых в инфраструктуре Identity Experience Framework Azure AD B2C, а также их описания представлены в таблице ниже.

| Идентификатор для определения содержимого | ОПИСАНИЕ |
|-----------------------|-------------|
| *api.error* | **Страница ошибки.** Эта страница отображается при обнаружении исключения или ошибки. |
| *api.idpselections* | **Страница выбора поставщика удостоверений.** На этой странице содержится список поставщиков удостоверений, которых можно выбирать во время входа пользователя. Это поставщики удостоверений организаций, социальных сетей, включая Facebook и Google+, или локальных учетных записей. |
| *api.idpselections.signup* | **Выбор поставщика удостоверений для регистрации.** На этой странице содержится список поставщиков удостоверений, которых можно выбирать во время регистрации. Это поставщики удостоверений организаций, социальных сетей, включая Facebook и Google+, или локальных учетных записей. |
| *api.localaccountpasswordreset* | **Страница восстановления пароля.** Эта страница содержит форму, которую нужно заполнить для сброса пароля.  |
| *api.localaccountsignin* | **Страница входа в локальную учетную запись.** Эта страница содержит форму для входа в локальную учетную запись (на основе адреса электронной почты или имени пользователя). Форма может содержать текстовое поле ввода и окно ввода пароля. |
| *api.localaccountsignup* | **Страница регистрации локальной учетной записи.** Эта страница содержит форму для регистрации локальной учетной записи (на основе адреса электронной почты или имени пользователя). Форма может содержать разные элементы управления для ввода текста, например: текстовое поле, поле ввода пароля, переключатель, раскрывающийся список с единственным выбором или флажки множественного выбора. |
| *api.phonefactor* | **Страница Многофакторной идентификации.** Эта страница позволяет пользователю подтвердить свой номер телефона (с помощью SMS-сообщения или голосового вызова) во время регистрации или входа. |
| *api.selfasserted* | **Страница регистрации учетной записи социальных сетей.** Эта страница содержит форму регистрации, которую нужно заполнить при регистрации с использованием существующей учетной записи от таких поставщиков удостоверений социальных сетей, как Facebook или Google+. Эта страница аналогична странице регистрации локальных учетных записей, за исключением полей для ввода пароля. |
| *api.selfasserted.profileupdate* | **Страница обновления профиля.** Эта страница содержит форму для обновления профиля пользователя. Эта страница аналогична странице регистрации локальных учетных записей, за исключением полей для ввода пароля. |
| *api.signuporsignin* | **Единая страница регистрации или входа.** На этой странице обрабатываются данные для регистрации и входа пользователей, которые могут использовать поставщики удостоверений организаций, поставщики удостоверений социальных сетей, включая Facebook или Google+, или локальные учетные записи.  |

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения об элементах пользовательского интерфейса, которые можно настроить, см. в [справочном руководстве по настройке пользовательского интерфейса для потоков пользователей](active-directory-b2c-reference-ui-customization.md).
