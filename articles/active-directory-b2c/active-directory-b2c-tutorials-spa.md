---
title: Руководство. Включение аутентификации в одностраничном приложении — Azure Active Directory B2C
description: Узнайте, как использовать Azure Active Directory B2C для обеспечения входа пользователя в систему для одностраничного приложения (JavaScript).
services: active-directory-b2c
author: mmacy
manager: celestedg
ms.author: marsma
ms.date: 07/08/2019
ms.custom: mvc
ms.topic: tutorial
ms.service: active-directory
ms.subservice: B2C
ms.openlocfilehash: 496cf801a44638af61306b43791abce9466e2cb2
ms.sourcegitcommit: 64798b4f722623ea2bb53b374fb95e8d2b679318
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67835688"
---
# <a name="tutorial-enable-authentication-in-a-single-page-application-using-azure-active-directory-b2c"></a>Руководство по Включение в одностраничном приложении аутентификации с помощью Azure Active Directory B2C

В этом руководстве описано использование Azure Active Directory (Azure Active Directory) B2C для входа и регистрации пользователей в одностраничном приложении (SPA). Azure AD B2C позволяет приложениям выполнять проверку подлинности учетных записей социальных сетей, корпоративных учетных записей и учетных записей Azure Active Directory с помощью стандартных протоколов.

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * Настройка примера для использования приложения.
> * регистрация с помощью потока пользователя.

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a>Предварительные требования

Для продолжения выполнения действий, описанных в этом учебнике, необходимы следующие ресурсы Azure AD B2C:

* [клиент Azure AD B2C](tutorial-create-tenant.md);
* [приложение, зарегистрированное](tutorial-register-applications.md) в клиенте;
* [созданные маршруты пользователей](tutorial-create-user-flows.md) в клиенте.

Кроме того, вам понадобятся следующие компоненты в локальной среде разработки:

* редактор кода, например [код Visual Studio](https://code.visualstudio.com/) или [Visual Studio 2019](https://www.visualstudio.com/downloads/);
* [.NET Core SDK 2.0.0](https://www.microsoft.com/net/core) или более поздней версии.
* [Node.js](https://nodejs.org/en/download/)

## <a name="update-the-application"></a>Обновление приложения

При прохождении второго учебника для выполнения предварительных условий вы зарегистрировали веб-приложение в Azure AD B2C. Для обеспечения взаимодействия с примером в этом руководстве необходимо добавить URI перенаправления для приложения в Azure AD B2C.

1. Войдите на [портале Azure](https://portal.azure.com).
1. Убедитесь, что используете каталог, содержащий клиент Azure AD B2C, щелкнув **Фильтр каталога и подписки** в верхнем меню и выбрав каталог, содержащий ваш клиент.
1. Выберите **Все службы** в левом верхнем углу окна портала Azure, а затем найдите и выберите **Azure AD B2C**.
1. Щелкните пункт **Приложения**, а затем выберите приложение *webapp1*.
1. В разделе **URL-адрес ответа** добавьте `http://localhost:6420`.
1. Щелкните **Сохранить**.
1. На странице свойств запишите **идентификатор приложения**. Идентификатор приложения будет использован на более позднем этапе, когда вы обновите код в одностраничном веб-приложении.

## <a name="get-the-sample-code"></a>Получение кода примера

С помощью этого руководства вы настроите пример кода, который можно скачать из репозитория GitHub. В этом примере показано, как использовать Azure AD B2C в одностраничном приложении для регистрации и входа пользователя, а также вызова защищенного веб-API.

[Скачайте ZIP-файл](https://github.com/Azure-Samples/active-directory-b2c-javascript-msal-singlepageapp/archive/master.zip) или клонируйте пример с GitHub.

```
git clone https://github.com/Azure-Samples/active-directory-b2c-javascript-msal-singlepageapp.git
```

## <a name="update-the-sample"></a>Обновление примера

Теперь, когда вы получили пример, обновите код, указав имя своего клиента Azure AD B2C и идентификатор приложения, который был записан на предыдущем шаге.

1. Откройте файл `index.html` в корневом каталоге примера.
1. В определении `msalConfig` измените значение **clientId** на идентификатор приложения, который был записан на предыдущем шаге. Затем обновите значение URI **authority**, указав имя клиента Azure AD B2C. Также обновите URI, указав имя маршрута пользователей при регистрации или входе, созданного при выполнении одного из предварительных условий (например, *B2C_1_signupsignin1*).

    ```javascript
    var msalConfig = {
        auth: {
            clientId: "00000000-0000-0000-0000-000000000000", //This is your client ID
            authority: "https://fabrikamb2c.b2clogin.com/fabrikamb2c.onmicrosoft.com/b2c_1_susi", //This is your tenant info
            validateAuthority: false
        },
        cache: {
            cacheLocation: "localStorage",
            storeAuthStateInCookie: true
        }
    };
    ```

    Имя потока пользователя, используемое в этом руководстве, — **B2C_1_signupsignin1**. Если используется другое имя маршрута пользователей, укажите это имя в значении `authority`.

## <a name="run-the-sample"></a>Запуск примера

1. Откройте окно консоли и перейдите в каталог, содержащий этот пример. Например:

    ```console
    cd active-directory-b2c-javascript-msal-singlepageapp
    ```
1. Выполните следующие команды:

    ```
    npm install && npm update
    node server.js
    ```

    В окне консоли отображается номер порта локально работающего сервера Node.js:

    ```
    Listening on port 6420...
    ```

1. Перейдите к `http://localhost:6420` в браузере для просмотра приложения.

Пример поддерживает регистрацию пользователей, вход в систему, редактирование профилей и сброс паролей. В этом руководстве показан процесс регистрации пользователя с помощью адреса электронной почты.

### <a name="sign-up-using-an-email-address"></a>Регистрация с помощью адреса электронной почты

1. Щелкните **Войти**, чтобы зарегистрироваться как пользователь приложения. При этом используется маршрут пользователей **B2C_1_signupsignin1**, указанный на предыдущем шаге.
1. Появляется страница входа в Azure AD B2C со ссылкой для регистрации. Щелкните ссылку **Зарегистрироваться сейчас**, так как у вас нет учетной записи.
1. В рамках рабочего процесса регистрации появляется страница для сбора данных и проверки личности пользователя с использованием адреса электронной почты. Рабочий процесс регистрации также собирает пароль пользователя и запрашиваемые атрибуты, определенные в потоке пользователя.

    Используйте действительный адрес электронной почты и подтвердите его с помощью кода проверки. Задайте пароль. Введите значения запрашиваемых атрибутов.

    ![Страница регистрации, представленная потоком входа и регистрации пользователя](./media/active-directory-b2c-tutorials-desktop-app/sign-up-workflow.PNG)

1. Щелкните **Создать**, чтобы создать локальную учетную запись в каталоге Azure AD B2C.

При нажатии кнопки **Создать**, страница регистрации закрывается и страница входа появляется снова.

Теперь можно использовать свой адрес электронной почты и пароль для входа в приложение.

### <a name="error-insufficient-permissions"></a>Ошибка: недостаточно прав

После входа в приложении отображается сообщение об ошибке, информирующее о недостаточности прав. Это **ожидаемое поведение**.

`ServerError: AADB2C90205: This application does not have sufficient permissions against this web resource to perform the operation.`

Данная ошибка возникает, так как вы пытаетесь получить доступ к ресурсу в демонстрационном каталоге, но маркер доступа действителен только для вашего каталога Azure AD. Поэтому вызов API не авторизован.

Перейдите к следующему учебнику из этой серии (см. [Следующий шаг](#next-steps)), чтобы узнать, как создать защищенный веб-API для своего каталога.

## <a name="next-steps"></a>Дополнительная информация

Из этой статьи вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Обновление приложения в Azure AD B2C.
> * Настройка примера для использования приложения.
> * регистрация с помощью потока пользователя.

Теперь перейдите к следующему руководству из этой серии, чтобы предоставить доступ к защищенному веб-API из SPA:

> [!div class="nextstepaction"]
> [Руководство. Предоставление доступа к веб-API ASP.NET Core из одностраничного приложения с помощью Azure Active Directory B2C](active-directory-b2c-tutorials-spa-webapi.md)
