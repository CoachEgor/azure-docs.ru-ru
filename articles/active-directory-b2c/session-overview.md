---
title: Сеансы единого входа в Azure Active Directory B2C | Документация Майкрософт
description: Общие сведения о настройке поведения сеанса в Azure Active Directory B2C.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: conceptual
ms.date: 12/01/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 5e02323df3a12c4a74de1fb62b36762fc739e9e5
ms.sourcegitcommit: ea551dad8d870ddcc0fee4423026f51bf4532e19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/07/2020
ms.locfileid: "96750447"
---
# <a name="azure-ad-b2c-session"></a>Azure AD B2C сеанс

Единый вход (SSO) обеспечивает безопасность и удобство при входе пользователей в приложения в Azure Active Directory B2C (Azure AD B2C). В этой статье описываются методы единого входа, используемые в Azure AD B2C и помогающие выбрать наиболее подходящий метод единого входа при настройке политики.

С помощью единого входа пользователи могут войти один раз с одной учетной записью и получить доступ к нескольким приложениям. Приложение может быть веб-приложением, мобильным или одностраничным, независимо от платформы или имени домена.

Когда пользователь изначально входит в приложение, Azure AD B2C сохраняет сеанс на основе файла cookie. При последующих запросах проверки подлинности Azure AD B2C считывает и проверяет сеанс на основе файлов cookie и выдает маркер доступа без запроса пользователя на вход. Если сеанс на основе файлов cookie истекает или становится недействительным, пользователю предлагается выполнить вход еще раз.  

## <a name="sso-session-types"></a>Типы сеансов единого входа

Интеграция с Azure AD B2C включает три типа сеансов единого входа:

- **Azure AD B2C** — сеанс, управляемый Azure AD B2C
- **Федеративный поставщик удостоверений** — сеанс, управляемый поставщиком удостоверений, например Facebook, Salesforce или учетная запись Майкрософт
- Сеанс **приложения** , управляемый веб-, мобильным приложением или одностраничное приложение

![Сеанс единого входа](media/session-overview/sso-session-types.png)

### <a name="azure-ad-b2c-sso"></a>Azure AD B2C единый вход 

При успешной проверке подлинности пользователя с локальной или социальной учетной записью Azure AD B2C сохраняет сеанс на основе файлов cookie в браузере пользователя. Файл cookie хранится в доменном имени клиента Azure AD B2C, например `https://contoso.b2clogin.com` .

Если пользователь изначально выполняет вход с помощью федеративной учетной записи, а затем во время сеанса (срок жизни или TTL) входит в то же приложение или другое приложение, Azure AD B2C пытается получить новый маркер доступа от федеративного поставщика удостоверений. Если срок действия сеанса федеративного поставщика удостоверений истек или недопустим, то поставщик федеративных удостоверений запрашивает у пользователя свои учетные данные. Если сеанс все еще активен (или если пользователь выполнил вход с локальной учетной записью вместо федеративной учетной записи), Azure AD B2C авторизует пользователя и не выводит дальнейшие запросы.

Можно настроить поведение сеанса, включая срок жизни сеанса, а также то, как Azure AD B2C использует сеанс совместно с политиками и приложениями.

### <a name="federated-identity-provider-sso"></a>Единый вход поставщика удостоверений Федерации

Социальные или корпоративные поставщики удостоверений управляют собственным сеансом. Файл cookie хранится в доменном имени поставщика удостоверений, например `https://login.salesforce.com` . Azure AD B2C не управляет сеансом федеративного поставщика удостоверений. Вместо этого поведение сеанса определяется федеративным поставщиком удостоверений. 

Рассмотрим следующий сценарий.

1. Пользователь входит в Facebook для проверки канала.
2. Позже пользователь откроет приложение и начнет процесс входа. Приложение перенаправляет пользователя в Azure AD B2C для завершения процесса входа.
3. На странице Регистрация или вход Azure AD B2C пользователь выбирает вход с использованием учетной записи Facebook. Пользователь перенаправляется на Facebook. Если в Facebook есть активный сеанс, пользователь не будет получать запрос на ввод учетных данных и сразу же перенаправится на Azure AD B2C с маркером Facebook.

### <a name="application-sso"></a>Единый вход приложения

Приложение, которое может быть защищено с помощью доступа OAuth, маркеров идентификации или SAML-токенов, можно защитить через Интернет, на мобильные устройства или на отдельные страницы. Когда пользователь пытается получить доступ к защищенному ресурсу в приложении, приложение проверяет наличие активного сеанса на стороне приложения. Если сеанс приложения отсутствует или срок действия сеанса истек, приложение перейдет на страницу входа Azure AD B2C.

Сеанс приложения может быть сеансом на основе файлов cookie, хранящимся в имени домена приложения, например `https://contoso.com` . В мобильных приложениях сеанс может храниться по-другому, но с помощью аналогичного подхода.

## <a name="azure-ad-b2c-session-configuration"></a>Конфигурация сеанса Azure AD B2C

### <a name="session-scope"></a>Область сеанса

Для сеанса Azure AD B2C можно настроить следующие области.

- **Клиент**. Это значение по умолчанию. Если выбрано это значение, несколько приложений и потоков пользователя в клиенте B2C могут совместно использовать один и тот же сеанс пользователя. Например, когда пользователь выполняет вход в приложение, он также может без труда войти в другой пользователь при обращении к нему.
- **Приложение**. Значение этого параметра позволяет поддерживать сеанс пользователя исключительно для одного приложения и независимо от других приложений. Например, этот параметр можно использовать, если вы хотите, чтобы пользователь вошел в Contoso фармацевтической независимо от того, входит ли пользователь в Contoso Гроцериес.
- **Политика**. Этот параметр позволяет поддерживать эксклюзивный сеанс пользователя для определенного потока пользователя, независимо от использующих его приложений. Например, если пользователь уже выполнил вход и выполнил шаг многофакторной проверки подлинности (MFA), ему может быть предоставлен доступ к частям с более высоким уровнем безопасности в нескольких приложениях, если срок действия сеанса, привязанного к потоку пользователя, не истекает.
- **Отключено** — этот параметр заставляет пользователя выполнять весь поток пользователя при каждом выполнении политики.

### <a name="session-life-time"></a>Время жизни сеанса

**Время жизни сеанса** — это время, в течение которого файл cookie сеанса Azure AD B2C сохраняется в браузере пользователя после успешной проверки подлинности. Время жизни сеанса можно установить в интервале от 15 до 720 минут.

### <a name="keep-me-signed-in"></a>Оставаться в системе

Функция " [оставаться в](custom-policy-keep-me-signed-in.md) системе" расширяет время жизни сеанса с помощью постоянного файла cookie. Сеанс остается активным после того, как пользователь закроет и снова откроет браузер. Сеанс отменяется, только когда пользователь выходит из него. Функция "оставаться в системе" применяется только для входа с локальными учетными записями.

Функция "оставаться в системе" имеет приоритет над временем жизни сеанса. Если функция "оставаться в системе" включена и пользователь выбрал ее, эта функция определяет время истечения срока действия сеанса. 

### <a name="session-expiry-type"></a>Тип истечения срока действия сеанса

**Тип срока действия сеанса** указывает на то, как сеанс расширяется параметром время жизни сеанса или параметром "оставаться в системе".

- **Пошаговое — указывает** , что сеанс увеличивается каждый раз, когда пользователь выполняет проверку подлинности на основе файлов cookie (по умолчанию).
- **Absolute** — указывает, что пользователь вынужден пройти повторную проверку подлинности по истечении указанного периода времени.

## <a name="sign-out"></a>Функция выхода

Если вы хотите подписать пользователя из приложения, достаточно очистить файлы cookie приложения или иным способом завершить сеанс с пользователем. Необходимо перенаправить пользователя в Azure AD B2C для выхода. В противном случае пользователь может повторно пройти проверку подлинности в приложениях без повторного ввода учетных данных.

При запросе выхода Azure AD B2C:

1. Делает недействительным сеанс на основе файла cookie Azure AD B2C.
1. Пытается выйти из федеративных поставщиков удостоверений:
   - OpenID Connect Connect — если конечная точка хорошо известной конфигурации поставщика удостоверений указывает `end_session_endpoint` расположение.
   - OAuth2 — если [метаданные поставщика удостоверений](oauth2-technical-profile.md#metadata) содержат `end_session_endpoint` расположение.
   - SAML — если [метаданные поставщика удостоверений](saml-identity-provider-technical-profile.md#metadata) содержат `SingleLogoutService` расположение.
1. При необходимости выходит из других приложений. Дополнительные сведения см. в разделе [единый выход](#single-sign-out) .

> [!NOTE]
> С помощью [пользовательских политик](custom-policy-overview.md)можно отключить выход из федеративных поставщиков удостоверений, установив метаданные технического профиля поставщика удостоверений `SingleLogoutEnabled` в значение `false` .

При выходе выполняется очистка состояния единого входа пользователя с Azure AD B2C, но пользователь не может выйти из сеанса поставщика удостоверений социальных сетей. Если пользователь выбирает одного и того же поставщика удостоверений во время последующего входа, он может выполнить повторную проверку подлинности без ввода учетных данных. Если пользователь хочет выйти из приложения, это не обязательно означает, что нужно выйти из своей учетной записи Facebook. Однако если используются локальные учетные записи, то сеанс пользователя завершается правильно.

### <a name="single-sign-out"></a>Единый выход 


> [!NOTE]
> Эта функция ограничена [пользовательскими политиками](custom-policy-overview.md).

При перенаправлении пользователя в конечную точку выхода Azure AD B2C (для протоколов OAuth2 и SAML) Azure AD B2C очищает сеанс пользователя из браузера. Однако пользователь по-прежнему может войти в другие приложения, использующие Azure AD B2C для проверки подлинности. Чтобы разрешить этим приложениям одновременный выход пользователя из приложения, Azure AD B2C отправляет запрос HTTP GET зарегистрированным `LogoutUrl` во всех приложениях, на которые пользователь вошел в систему.


Приложения должны ответить на него, удалив любой сеанс, который идентифицирует пользователя, и возвратив ответ `200`. Если вы хотите поддерживать единый выход в приложении, необходимо реализовать `LogoutUrl` в коде приложения. 

## <a name="next-steps"></a>Следующие шаги

- Узнайте, как [настроить поведение сеанса в потоке пользователя](session-behavior.md).
- Узнайте, как [настроить поведение сеанса в пользовательских политиках](session-behavior-custom-policy.md).
