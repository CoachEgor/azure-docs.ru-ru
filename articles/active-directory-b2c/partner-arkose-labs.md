---
title: Аркосе Labs с Azure Active Directory B2C
titleSuffix: Azure AD B2C
description: Узнайте, как интегрировать проверку подлинности Azure AD B2C с Аркосе Labs, чтобы защититься от атак с помощью программы-робота, атак перенаправление учетных записей и мошеннических учетных записей.
services: active-directory-b2c
author: msmimart
manager: celestedg
ms.service: active-directory
ms.workload: identity
ms.topic: how-to
ms.date: 06/08/2020
ms.author: mimart
ms.subservice: B2C
ms.openlocfilehash: 333bb42643539cedec04d37680749c749a003536
ms.sourcegitcommit: cd9754373576d6767c06baccfd500ae88ea733e4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94953888"
---
# <a name="tutorial-for-configuring-arkose-labs-with-azure-active-directory-b2c"></a>Руководство по настройке Аркосе Labs с помощью Azure Active Directory B2C

В этом руководстве описано, как интегрировать проверку подлинности Azure AD B2C с Аркосе Labs. Аркосе Labs помогают организациям в отношении атак Bot, атак перенаправление и мошеннических учетных записей.  

## <a name="prerequisites"></a>Предварительные требования

Чтобы приступить к работе, вам потребуется:

* подписка Azure AD; Если у вас нет подписки, вы можете получить [бесплатную учетную запись](https://azure.microsoft.com/free/).
* [Клиент Azure AD B2C](tutorial-create-tenant.md) , связанный с вашей подпиской Azure.

## <a name="scenario-description"></a>Описание сценария

На следующей схеме показано, как Аркосе Labs интегрируется с Azure AD B2C.

![Схема архитектуры Аркосе Labs](media/partner-arkose-labs/arkose-architecture-diagram.png)

| Шаг  | Описание |
|---|---|
|1     | Пользователь входит в систему с помощью ранее созданной учетной записи. Когда пользователь нажмет кнопку "Отправить", появится запрос на принудительное выполнение Аркосе Labs. После того как пользователь завершит запрос, состояние будет отправлено в Аркосе Labs для создания маркера.        |
|2     |  Аркосе Labs отправляет маркер обратно в Azure AD B2C.       |
|3     |  Перед отправкой формы входа маркер отправляется в Аркосе Labs для проверки.       |
|4     |  Аркосе отправляет результат успешного или неуспешного выполнения запроса.       |
|5     |  Если запрос успешно завершен, в Azure AD B2C отправляется форма входа, после чего Azure AD B2C завершает проверку подлинности.       |
|   |   |

## <a name="onboard-with-arkose-labs"></a>Подключение с помощью Аркосе Labs

1. Начните с связи с [Аркосе Labs](https://www.arkoselabs.com/book-a-demo/) и созданием учетной записи.

2. После создания учетной записи перейдите по адресу https://dashboard.arkoselabs.com/login .

3. На панели мониторинга перейдите к разделу Параметры сайта, чтобы найти открытый ключ и закрытый ключ. Эти сведения потребуются позже для настройки Azure AD B2C.

## <a name="integrate-with-azure-ad-b2c"></a>Интеграция с Azure AD B2C

### <a name="part-1--create-blob-storage-to-store-the-custom-html"></a>Часть 1. Создание хранилища BLOB-объектов для хранения пользовательского HTML

Чтобы создать учетную запись хранения, выполните следующие действия.  

1. Войдите в портал Azure.

2. Убедитесь, что используется каталог, содержащий подписку Azure. В верхнем меню выберите фильтр **каталог и подписка** и выберите каталог, содержащий подписку. Этот каталог отличается от каталога, который содержит ваш клиент Azure B2C.

3. Выберите **все службы** в левом верхнем углу портал Azure, а затем найдите и выберите  **учетные записи хранения**.

4. Выберите **Добавить**.

5. В разделе  **Группа ресурсов** выберите  **создать**, введите имя новой группы ресурсов, а затем нажмите кнопку **ОК**.

6. Введите имя учетной записи хранения. Имя должно быть уникальным для Azure, содержать от 3 до 24 символов и состоять только из цифр и строчных букв.

7. Выберите расположение учетной записи хранения или примите расположение по умолчанию.

8. Примите все остальные значения по умолчанию, выберите   **проверить & создать**  >  **создать**.

9. После создания учетной записи хранения выберите  **Перейти к ресурсу**.

#### <a name="create-a-container"></a>Создание контейнера

1. На странице Обзор учетной записи хранения выберите  **большие двоичные объекты**.

2. Выберите   **контейнер**, введите имя для контейнера, выберите BLOB-  **объект** (анонимный доступ на чтение только для больших двоичных объектов) и нажмите кнопку **ОК**.

#### <a name="enable-cross-origin-resource-sharing-cors"></a>Включить общий доступ к ресурсам в разных источниках (CORS)

Код Azure AD B2C в браузере использует современный и стандартный подход для загрузки настраиваемого содержимого по URL-адресу, указанному в потоке пользователя. CORS позволяет запрашивать ограниченные ресурсы на веб-странице из других доменов.

1. В меню выберите  **CORS**.

2. Для  **разрешенных источников** введите  `https://your-tenant-name.b2clogin.com` . Замените имя клиента на имя клиента Azure AD B2C. Например,  `https://fabrikam.b2clogin.com`. При вводе имени клиента используйте все строчные буквы.

3. Для параметра  **разрешенные методы** выберите  **Get**, **Размещение** и  **Параметры**.

4. В поле **Допустимые заголовки** введите звездочку (*).

5. Для **раскрытого заголовка** введите звездочку (*).

6. В поле **Максимальный возраст** введите 200.

   ![Регистрация и вход в Аркосе Labs](media/partner-arkose-labs/signup-signin-arkose.png)

7. Щелкните **Сохранить**.

### <a name="part-2--set-up-a-back-end-server"></a>Часть 2. Настройка фонового сервера

Скачайте Git Bash и выполните следующие действия:

1. Следуйте инструкциям по [созданию веб-приложения](../app-service/quickstart-php.md), пока не появится сообщение "Поздравляем!Вы развернули свое первое приложение PHP в службе приложений.

2. Откройте локальную папку и переименуйте файл **index. php** в **верифи-токен. php**.

3. Откройте только что переименованный файл верифи-токен. php и выполните следующие действия.

   a. Замените содержимое содержимым из файла верифи-токен. php, найденного в [репозитории GitHub](https://github.com/ArkoseLabs/Azure-AD-B2C).

   b. Замените <private_key> в строке 3 закрытым ключом, полученным с панели мониторинга Аркосе Labs.

4. В окне терминала на локальном компьютере зафиксируйте изменения в Git, а затем отправьте изменения кода в Azure, введя следующую команду в Git Bash:

   ``git commit -am "updated output"``

   ``git push azure master``  

### <a name="part-3---final-setup"></a>Часть 3 — Окончательная установка

#### <a name="store-the-custom-html"></a>Сохранение пользовательского HTML

1. Откройте файл index.html, хранящийся в [репозитории GitHub](https://github.com/ArkoseLabs/Azure-AD-B2C).

2. Замените все экземпляры `<tenantname>` именем вашего клиента b2C (иными словами `<tenantname>.b2clogin.com` ). Должно быть четыре экземпляра.

3. Замените `<appname>` именем приложения, созданным в части 2, шаг 1.

   ![Снимок экрана, показывающий Аркосе Labs Azure CLI](media/partner-arkose-labs/arkose-azure-cli.png)

4. Замените в `<public_key>` строке 64 открытым ключом, полученным на панели мониторинга Аркосе Labs.

5. Отправьте файл index.html в хранилище BLOB-объектов, созданное ранее.

6. Перейдите к **Storage**  >  **Container**  >  **отправке** контейнера хранилища.

#### <a name="set-up-azure-ad-b2c"></a>Настройка Azure AD B2C

> [!NOTE]
> Если у вас еще нет клиента Azure AD B2C, [создайте](tutorial-create-tenant.md) его. Он должен быть связан с вашей подпиской Azure.

1. Создайте пользовательский поток на [основе сведений.](tutorial-create-user-flows.md) При достижении раздела **Проверка потока пользователя** прекращается.

2. Включение JavaScript в [потоке пользователя](user-flow-javascript-overview.md).

3. На одной и той же странице потока пользователей включите URL-адрес настраиваемой **User flow** страницы: переход к  >  **макету страницы** потока пользователей  >  **Использование настраиваемого содержимого страницы**  =  **Да**  >  **Вставка URL-адреса настраиваемой страницы**.
URL-адрес настраиваемой страницы получен из расположения файла index.html в хранилище больших двоичных объектов  

   ![Снимок экрана с URL-адресом хранилища Аркосе Labs](media/partner-arkose-labs/arkose-storage-url.png)

## <a name="test-the-user-flow"></a>Тестирование потока пользователя

1. Откройте клиент Azure AD B2C и в разделе **политики** выберите **потоки пользователей**.

2. Выберите ранее созданный поток пользователя.

3. Выберите **запустить поток пользователя** и выберите параметры:

   a. **Приложение** — выберите зарегистрированное приложение (пример — JWT).

   b. **URL-адрес ответа** — выберите URL-адрес перенаправления.

   c. Выберите **Выполнить поток пользователя**.

4. Пройдите процесс регистрации и создайте учетную запись.

5. Выполните выход.

6. Пройдите по потоку входа.

7. После нажатия на кнопку **"продолжить"** появится головоломка Аркосе Labs.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения см. в следующих статьях:

- [Пользовательские политики в Azure AD B2C](custom-policy-overview.md)

- [Приступая к работе с пользовательскими политиками в Azure AD B2C](custom-policy-get-started.md?tabs=applications)