---
title: Локальное развертывание решения для удаленного мониторинга — DOCKER в Azure | Документация Майкрософт
description: В этом руководстве показано, как развернуть акселератор решения для удаленного мониторинга на локальном компьютере с использованием Docker в целях тестирования и разработки.
author: avneet723
manager: hegate
ms.author: avneets
ms.service: iot-accelerators
services: iot-accelerators
ms.date: 10/25/2018
ms.topic: conceptual
ms.openlocfilehash: 32b47d9d6d45ff471961f55f8159dbe85eae2dce
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "73888833"
---
# <a name="deploy-the-remote-monitoring-solution-accelerator-locally---docker"></a>Локальное развертывание акселератора решения для удаленного мониторинга Docker

[!INCLUDE [iot-accelerators-selector-local](../../includes/iot-accelerators-selector-local.md)]

В этой статье показано, как развернуть акселератор решения для удаленного мониторинга на локальном компьютере в целях тестирования и разработки. Вы узнаете, как развернуть микрослужбы в контейнерах Docker на локальном компьютере. Для развертывания локальных микрослужб используются следующие облачные службы: Центр Интернета вещей, Cosmos DB, Azure Streaming Analytics и службы Аналитики временных рядов Azure.

Если вы хотите запустить акселератор решения для удаленного мониторинга в IDE на локальном компьютере, см. статью [Локальное развертывание акселератора решения для удаленного мониторинга](iot-accelerators-remote-monitoring-deploy-local.md).

## <a name="prerequisites"></a>Предварительные условия

Для развертывания служб Azure, используемых акселератором решения для удаленного мониторинга, требуется активная подписка Azure.

Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе [Бесплатная пробная версия Azure](https://azure.microsoft.com/pricing/free-trial/).

### <a name="machine-setup"></a>Настройки компьютера

Для завершения локального развертывания необходимо установить следующие средства на локальный компьютер разработчика:

* [Git](https://git-scm.com/);
* [Docker](https://www.docker.com)
* [Visual Studio](https://visualstudio.microsoft.com/), если вы планируете вносить изменения в микрослужбы.
* [Node.js версии 8](https://nodejs.org/). Это программное обеспечение является необходимым компонентом для интерфейса командной строки PCS, который используется в сценариях для создания ресурсов Azure. Не используйте Node.js версии 10.

> [!NOTE]
> Эти средства доступны на многих платформах, включая Windows, Linux и iOS.

[!INCLUDE [iot-accelerators-local-setup](../../includes/iot-accelerators-local-setup.md)]

## <a name="run-the-microservices-in-docker"></a>Запуск микрослужб в Docker

Чтобы иметь доступ к переменным средам, установленным сценарием **start.cmd**, откройте командную строку. Чтобы проверить, являются ли переменные среды настроенными в ОС Windows, выполните следующую команду.

```cmd
set PCS
```

В результате выполнения команды появятся переменные среды, установленные сценарием **start.cmd**.

Убедитесь, что Docker запущен на локальном компьютере.
> [!NOTE]
> Docker должен работать с [контейнерами Linux](https://docs.docker.com/docker-for-windows/), если он выполняется под управлением Windows.

Микрослужбам, работающим в локальных контейнерах Docker, необходим доступ к облачным службам Azure. Вы можете протестировать подключение среды Docker к Интернету, используя следующую команду, которая проверит адреса в Интернете, находящиеся внутри контейнера.

```cmd/sh
docker run --rm -ti library/alpine ping google.com
```

Чтобы запустить акселератор решений, перейдите в папку **services\\scripts\\local** в среде командной строки и выполните следующую команду:

```cmd/sh
docker-compose up
```

> [!NOTE] 
> Перед запуском `docker-compose up` убедитесь, что для Docker обеспечен [общий доступ к локальному диску](https://github.com/Azure/azure-iot-pcs-remote-monitoring-dotnet/issues/115).

При первом выполнении этой команды Docker скачивает образы микрослужб из центра Docker для локальной сборки контейнеров. При последующих выполнениях Docker запускает контейнеры немедленно.

> [!TIP]
> Корпорация Майкрософт регулярно публикует новые образы Docker с обновленной функциональностью. Чтобы очистить локальные контейнеры Docker и соответствующие образы, прежде чем извлечь последние из них, можно использовать следующий набор команд:

```cmd/sh
docker list
docker rm <list_of_containers>
docker rmi <list_of_images>
```

С помощью отдельной оболочки можно просмотреть журналы из контейнера. Для этого сначала найдите идентификатор контейнера с помощью команды `docker ps`. Затем с помощью команды `docker logs {container-id} --tail 1000` просмотрите последние 1000 сущностей для указанного контейнера.

### <a name="start-the-stream-analytics-job"></a>Запуск задания Stream Analytics

Чтобы запустить задание Stream Analytics, выполните следующие действия:

1. Перейдите на [портал Azure](https://portal.azure.com).
1. Перейдите к **группе ресурсов**, созданной для решения. Имя группы ресурсов — это имя, выбранное для решения при запуске скрипта **Start. cmd** .
1. В списке ресурсов щелкните **Задание Stream Analytics**.
1. На странице **Обзор** задания Stream Analytics нажмите кнопку **Запуск**. Затем, чтобы немедленно начать задание, щелкните **Пуск**.

### <a name="connect-to-the-dashboard"></a>Подключение к панели мониторинга

Для доступа к панели мониторинга решения для удаленного мониторинга перейдите по адресу `http://localhost:8080` в браузере. Теперь можно использовать веб-Интерфейс и локальные микрослужбы.

## <a name="clean-up"></a>Очистка

Чтобы избежать ненужных расходов, после завершения тестирования удалите облачные службы из подписки Azure. Чтобы удалить службы, перейдите на [портал Azure](https://ms.portal.azure.com) и удалите группу ресурсов, созданную при запуске сценария **start.cmd**.

Воспользуйтесь командой `docker-compose down --rmi all`, чтобы удалить образы Docker и освободить место на локальном компьютере. Также можно удалить локальную копию репозитория удаленного мониторинга, созданную при клонировании исходного кода из GitHub.

## <a name="next-steps"></a>Дальнейшие шаги

Теперь, когда вы развернули решение для удаленного мониторинга, ознакомьтесь со статьей [Краткое руководство. Использование облачного решения для удаленного мониторинга](quickstart-remote-monitoring-deploy.md).
