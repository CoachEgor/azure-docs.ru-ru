---
title: Как развернуть модуль хранилище OPC с нуля — Azure | Документация Майкрософт
description: Как развернуть хранилище OPC с нуля.
author: dominicbetts
ms.author: dobett
ms.date: 11/26/2018
ms.topic: conceptual
ms.service: iot-industrialiot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: dedba42d7e4b8d603d97522cf0173f41efd20b3a
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61450335"
---
# <a name="deploy-opc-vault-from-scratch"></a>Развертывание хранилища OPC с нуля

OPC Vault — это микрослужба, которая настраивает и регистрирует сертификаты клиентских приложений и сервера на основе унифицированной архитектуры OPC в облаке, а также управляет их жизненным циклом. В этой статье показано, как развернуть хранилище OPC с нуля.

## <a name="configuration-and-environment-variables"></a>Конфигурации и переменные среды

Конфигурация службы хранится с использованием адаптеров конфигурации ASP.NET Core, в appsettings.ini. Для сохранения значений в удобном для чтения формате, с комментариями позволяет формате INI.
Это приложение также поддерживает вставку переменные среды, такие как учетные данные и подробными сведениями о сети. (В этом разделе изначально называется TODO конфигурации и переменные среды).

Файл конфигурации в репозитории ссылается на некоторые переменные среды, которые необходимо создать по крайней мере один раз. В зависимости от операционной системы и интегрированной среды разработки существует несколько способов управления переменными среды:

- Для пользователей Windows скрипт env переменных setup.cmd необходимо быть подготовлена и выполнена только один раз. При выполнении, параметры будут сохраняться между сеансам терминалов и перезагрузок.

- Для сред Linux и OS x env переменных-скрипт должен выполняться каждый раз при открытии новой консоли. В зависимости от операционной системы и терминал существуют способы сохранения значений глобально, Дополнительные сведения должны помочь эти страницы:

  - https://stackoverflow.com/questions/13046624/how-to-permanently-export-a-variable-in-linux
  
  - https://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x
  
  - https://help.ubuntu.com/community/EnvironmentVariables
  

- Visual Studio. Переменные среды можно также задать из Visual Studio, в свойствах проекта, в области слева выберите «Свойства конфигурации» и «Среда», чтобы получить раздел, где можно добавить несколько переменных.

- IntelliJ Rider: Переменные среды задаются в каждой конфигурации запуска аналогичным образом для IntelliJ IDEA https://www.jetbrains.com/help/idea/run-debug-configuration-application.html

## <a name="run-and-debug-with-visual-studio"></a>Выполнение и отладку с помощью Visual Studio

Visual Studio позволяет быстро открывать приложение без использования командной строки без настройки любым устройствам вне интегрированной среды разработки.

Действия, с помощью Visual Studio 2017:

1. Откройте решение, используя `iot-opc-gds-service.sln` файл.

1. При загрузке решения, щелкните правой кнопкой мыши `WebService` проекта, выберите и перейдите к `Debug` раздел.

1. В один и тот же раздел определите необходимые переменные среды.

1. Нажмите клавишу **F5**, или **запуска** значок. Visual Studio откроется в браузере, показывающий состояние службы в формате JSON.

## <a name="run-and-debug-with-intellij-rider"></a>Выполнение и отладку с помощью IntelliJ Rider

1. Откройте решение, используя `iot-opc-gds-service.sln` файл.

1. При загрузке решения, перейдите к `Run > Edit Configurations` и создайте новый `.NET Project` конфигурации.

1. В конфигурации выберите проект веб-службы.

1. Сохранить параметры и конфигурации, созданный на основе инструментов интегрированной среды разработки.

1. Вы увидите службу начальной загрузки сообщения в окне IntelliJ выполнения сведения, такие как URL-адрес, где выполняется веб-службы и службы журналов.

## <a name="build-and-run-from-the-command-line"></a>Сборка и запуск из командной строки

Папку «Скрипты» содержит некоторые скрипты для выполнения частых задач:

- `build`: Скомпилировать все проекты и выполнять тесты.

- `compile`: Скомпилируйте все проекты.

- `run`: Проекты Скомпилируйте и запустите службу, которая запрашивает привилегий в Windows для запуска веб-службы.

Проверьте скрипты установки переменных среды. Можно задать переменные среды глобально в вашей операционной системе или используйте сценарий «env переменных setup» в папку «скрипты».

### <a name="sandbox"></a>Песочница

Скрипты предполагают, что вы настроили среду разработки с помощью .NET Core и Docker. Можно избежать установки .NET Core и установить только Docker и использовать параметр командной строки `--in-sandbox` (или краткая форма `-s`), например:

- `build --in-sandbox`: Выполняет задачу сборки в контейнере Docker (Краткая форма `build -s`).

- `compile --in-sandbox`: Выполняет задачу компиляции в контейнере Docker (Краткая форма `compile -s`).

- `run --in-sandbox`: Запускает службу в контейнере Docker (Краткая форма `run -s`).

Образов Docker, используемых для "песочницы" размещенный в концентраторе Docker [здесь](https://hub.docker.com/r/azureiotpcs/code-builder-dotnet).

## <a name="package-the-application-to-a-docker-image"></a>Пакет приложения в образ Docker

`scripts` Папка содержит вложенную папку docker с помощью файлы, необходимые для упаковки службы в образ Docker:

- `Dockerfile`: Спецификации образы docker.
- `build`: Создание контейнера Docker и сохранить изображение в локальном реестре.
- `run`: Запуск контейнера Docker с изображением, хранящимся в локальном реестре.
- `content`: Папка с файлами, Копировать в образ, включая сценарий точки входа.

## <a name="azure-iot-hub-setup"></a>Настройка центра Интернета вещей Azure

Чтобы использовать в микрослужбе, Настройка центра Интернета вещей Azure для разработки и интеграции тестов.

Проект включает некоторые скрипты Bash для установки:

- Создайте новый центр Интернета вещей: `./scripts/iothub/create-hub.sh`

- Для вывода списка существующих центров: `./scripts/iothub/list-hubs.sh`

- Показать подробности (например, ключи) центра Интернета вещей: `./scripts/iothub/show-hub.sh`

И в случае, если имеется несколько подписок Azure:

- Показать список подписок: `./scripts/iothub/list-subscriptions.sh`

- Изменить текущую подписку: `./scripts/iothub/select-subscription.sh`

## <a name="development-setup"></a>Настройка разработки

### <a name="net-setup"></a>Программа установки .NET

Рабочий процесс проекта управляется с помощью [.NET Core](https://dotnet.github.io) 1.x, в котором необходимо установить в вашей среде, так что можно выполнять все сценарии и убедитесь, что интегрированная СРЕДА работает должным образом.

Мы также предоставляем [версию Java](https://github.com/Azure/iot-opc-gds-service-dotnet) над этим проектом и других компонентов ПК Интернета вещей Azure.

### <a name="ide"></a>ИНТЕГРИРОВАННАЯ СРЕДА РАЗРАБОТКИ

Ниже приведены некоторые из интегрированных сред разработки, который можно использовать для работы на ПК Интернета вещей Azure.

- [Visual Studio](https://www.visualstudio.com)
- [Visual Studio для Mac](https://www.visualstudio.com/vs/visual-studio-mac)
- [IntelliJ Rider](https://www.jetbrains.com/rider)
- [Visual Studio Code](https://code.visualstudio.com)

### <a name="git-setup"></a>Настройка Git

Проект содержит обработчик, Git, чтобы автоматизировать некоторые проверки, прежде чем принять изменение кода. Можно выполнить тесты вручную или позволить платформе непрерывной Интеграции для выполнения тестов. Мы используем следующий обработчик Git для автоматического запуска всех тестов перед отправкой изменений кода в GitHub и ускорить рабочий процесс разработки.

Если в любой момент вы хотите удалить обработчик, просто удалите его, установлена в папке `.git/hooks`. Можно также обойти перед фиксацией обработчик с помощью `--no-verify` параметр.

#### <a name="pre-commit-hook-with-sandbox"></a>Перед фиксацией перехватчик, указав "песочницы"

Устанавливало включено, откройте консоль Windows, Linux и Mac OS и выполните:

```
cd PROJECT-FOLDER
cd scripts/git
setup --with-sandbox
```

В такой конфигурации во время возврата файлов Git проверяет, что приложение передает все тесты, выполните построение и тестирование в контейнере Docker, в которой настроены все требования к разработке.

#### <a name="pre-commit-hook-without-sandbox"></a>Обработчик перед фиксацией без "песочницы"

> [!NOTE] 
> Обработчик без "песочницы" требует [.NET Core](https://dotnet.github.io) в системную переменную PATH.

Устанавливало включено, откройте консоль Windows, Linux и Mac OS и выполните:

```
cd PROJECT-FOLDER
cd scripts/git
setup --no-sandbox
```
В такой конфигурации во время возврата файлов Git проверяет, что приложение передает все тесты, выполните построение и тестирование в рабочей станции с помощью средства, установленные в вашей операционной системе.

Руководство по стиль кода проекта:

- Там, где это целесообразно, длина строки ограничена max 80 знаков для проверки кода и редакторы командной строки.

- Отступы блоков кода четырех пробелов. Следует избегать char вкладки.

- Текстовые файлы используйте Unix конец формат строки (LF).

- Внедрение зависимостей, управляемых с помощью [Autofac](https://autofac.org).

- Поля API-интерфейсы веб-службы являются CamelCased за исключением метаданных.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как развернуть хранилище OPC с нуля, вот мы предлагаем:

> [!div class="nextstepaction"]
> [Развертывание Двойника OPC с нуля](howto-opc-twin-deploy-modules.md)