---
title: Развертывание настраиваемых имитированных устройств с помощью Интернета вещей в Azure | Документация Майкрософт
description: В этом практическом руководстве показано, как развернуть настраиваемые имитированные устройства в акселератор решения для удаленного мониторинга.
author: dominicbetts
manager: timlt
ms.author: dobett
ms.service: iot-accelerators
services: iot-accelerators
ms.date: 08/15/2018
ms.topic: conceptual
ms.openlocfilehash: cdd2b24e6f833ee0acb229a37c7cd3b8b6f36339
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "66143398"
---
# <a name="deploy-a-new-simulated-device"></a>Развертывание нового имитированного устройства

Акселераторы решений для удаленного мониторинга и имитации устройств позволяют определить собственные имитированные устройства. В этой статье показано, как развернуть настраиваемый тип устройства Chiller и новый тип устройства Lightbulb в акселератор решения для удаленного мониторинга.

В этой статье предполагается, что вы завершили руководство [Создание и тестирование нового имитированного устройства](iot-accelerators-remote-monitoring-create-simulated-device.md) и у вас есть файлы, которые определяют типы устройств: настраиваемый Chiller и новый Lightbulb.

В этом практическом руководстве показано, как:

1. Использовать SSH для доступа к файловой системе виртуальной машины, где размещен акселератор решения для удаленного мониторинга.

1. Настраивать Docker для загрузки моделей устройств из расположения за пределами контейнера Docker.

1. Запускать акселератор решения для удаленного мониторинга с помощью файлов пользовательских моделей устройств.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Чтобы выполнить действия, описанные в этом руководстве, вам потребуется активная подписка Azure.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу.

## <a name="prerequisites"></a>Технические условия

Чтобы следовать этому пошаговому руководству, вам необходимы следующие компоненты.

- Развернутый экземпляр [акселератора решения для удаленного мониторинга](https://www.azureiotsolutions.com/Accelerators#solutions/types/RM2).
- Локальная оболочка **bash** для выполнения команд `ssh` и `scp`. В Windows нужно установить [git](https://git-scm.com/download/win), чтобы легко установить **bash**.
- Файлы пользовательских моделей устройств, такие, как описаны в статье [Создание и тестирование нового имитированного устройства](iot-accelerators-remote-monitoring-create-simulated-device.md).

[!INCLUDE [iot-solution-accelerators-access-vm](../../includes/iot-solution-accelerators-access-vm.md)]

## <a name="configure-docker"></a>Настройка Docker

В этом разделе выполняется настройка Docker для загрузки файлов моделей устройств из папки **/tmp/devicemodels** виртуальной машины, а не из контейнера Docker. Выполните команды в этом разделе в оболочке **bash** на локальном компьютере:

В этом разделе выполняется настройка Docker для загрузки файлов моделей устройств из папки **/tmp/devicemodels** виртуальной машины, а не из контейнера Docker. Выполните команды в этом разделе в оболочке **bash** на локальном компьютере:

1. Установите SSH-подключение к виртуальной машине в Azure с локального компьютера. В команде ниже предполагается общедоступный IP-адрес виртуальной машины **vm-vikxv** — **104.41.128.108**. Замените это значение общедоступным IP-адресом своей виртуальной машины из предыдущего раздела:

   ```sh
    ssh azureuser@104.41.128.108
    ```

    Следуйте инструкциям, чтобы войти в систему виртуальной машины с помощью пароля, настроенного в предыдущем разделе.

1. Настройте службу имитации устройств для загрузки моделей устройств из-за пределов контейнера. Сначала откройте файл конфигурации Docker:

    ```sh
    sudo nano /app/docker-compose.yml
    ```

    Найдите параметры для контейнера **devicesimulation** и измените параметр **volumes**, как показано в следующем фрагменте кода:

    ```yml
    devicesimulation:
      image: azureiotpcs/device-simulation-dotnet:1.0.0
      networks:
        - default_net
      depends_on:
        - storageadapter
      environment:
        - PCS_KEYVAULT_NAME
        - PCS_AAD_APPID
        - PCS_AAD_APPSECRET
      # How one could mount custom device models
      volumes:
        - /tmp/devicemodels:/app/webservice/data/devicemodels:ro
    ```

    Сохраните изменения.

1. Скопируйте имеющиеся файлы моделей устройств из контейнера в новое расположение. Сначала найдите идентификатор контейнера для имитирования устройств.

    ```sh
    docker ps
    ```

    Затем скопируйте файлы моделей устройств в папку **tmp** на виртуальной машине. В указанной ниже команде предполагается, что идентификатор контейнера — c378d6878407. Замените это значение идентификатором контейнера для имитирования устройств.

    ```sh
    docker cp c378d6878407:/app/webservice/data/devicemodels /tmp
    ```

    Не закрывайте окно **Bash** с сеансом SSH.

1. Скопируйте файлы пользовательских моделей устройств на виртуальную машину. Выполните следующую команду в другой оболочке **bash** на компьютере, где были созданы пользовательские модели устройств. Сначала перейдите к локальной папке, содержащей JSON-файлы моделей устройств. В командах ниже предполагается, что общедоступный IP-адрес виртуальной машины — **104.41.128.108**. Замените это значение общедоступным IP-адресом своей виртуальной машины. Введите пароль виртуальной машины при появлении запроса:

    ```sh
    scp *json azureuser@104.41.128.108:/tmp/devicemodels
    cd scripts
    scp *js azureuser@104.41.128.108:/tmp/devicemodels/scripts
    ```

1. Перезапустите контейнер Docker для имитации устройств, чтобы использовать новые модели устройств. Выполните следующие команды в оболочке **bash** при открытом сеансе SSH с виртуальной машиной:

    ```sh
    sudo /app/start.sh
    ```

    Чтобы просмотреть состояние запущенных контейнеров Docker и их идентификаторы, выполните следующую команду:

    ```sh
    docker ps
    ```

    Чтобы просмотреть журнал из контейнера для имитирования устройств, выполните следующую команду. Замените идентификатор контейнера идентификатором вашего контейнера для имитирования устройств:

    ```sh
    docker logs -f 5d3f3e78822e
    ```

## <a name="run-simulation"></a>Выполнение имитации

Теперь можно использовать пользовательские модели устройств в решении для удаленного мониторинга.

1. Запустите панель мониторинга для удаленного мониторинга из [акселератора решений Интернета вещей Microsoft Azure](https://www.azureiotsolutions.com/Accelerators#dashboard).

1. На странице **устройств** можно добавить имитированные устройства. При добавлении нового имитированного устройства можно выбрать новые модели устройства.

1. На панели мониторинга можно просматривать телеметрию и вызывать методы устройства.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы планируете продолжить изучение, не удаляйте развернутый акселератор решения для удаленного мониторинга.

Если вам больше не нужен ускоритель решения, удалите его со страницы [Подготовленные решения](https://www.azureiotsolutions.com/Accelerators#dashboard), а затем щелкните **Удалить решение**.

## <a name="next-steps"></a>Дальнейшие действия

В этом практическом руководстве показано, как развернуть пользовательские модели устройств в акселератор решения для удаленного мониторинга. Далее мы предлагаем вам ознакомиться со статьей [Подключение устройства к предварительно настроенному решению для удаленного мониторинга (Node.js)](iot-accelerators-connecting-devices-node.md).
