---
title: Развертывание решения для удаленного мониторинга локально - IntelliJ IDE - Azure Документы Майкрософт
description: В этом руководстве показано, как развернуть ускоритель решений удаленного мониторинга на локальной машине с помощью IntelliJ для тестирования и разработки.
author: v-krghan
manager: dominicbetts
ms.author: v-krghan
ms.service: iot-accelerators
services: iot-accelerators
ms.date: 01/24/2019
ms.topic: conceptual
ms.openlocfilehash: 779ee1e057d74b11c5e0ba58dc2fd32b803f1e0e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "73888811"
---
# <a name="deploy-the-remote-monitoring-solution-accelerator-locally---intellij"></a>Локальное развертывание акселератора решения для удаленного мониторинга IntelliJ

[!INCLUDE [iot-accelerators-selector-local](../../includes/iot-accelerators-selector-local.md)]

В этой статье показано, как развернуть акселератор решения для удаленного мониторинга на локальном компьютере в целях тестирования и разработки. Вы узнаете, как управлять микрослужбами в IntelliJ. В локальном развертывании микрослужб будут использоваться следующие облачные службы: IoT Hub, Azure Cosmos DB, Аналитика потоковой передачи Azure и исследование временных рядов Azure.

Если вы хотите запустить акселератор решения для удаленного мониторинга в Docker на локальном компьютере, см. статью [Deploy the Remote Monitoring solution accelerator locally — Docker](iot-accelerators-remote-monitoring-deploy-local-docker.md) (Локальное развертывание акселератора решения для удаленного мониторинга в Docker).

## <a name="prerequisites"></a>Предварительные требования

Для развертывания служб Azure, используемых акселератором решения для удаленного мониторинга, требуется активная подписка Azure.

Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Для получения подробной информации [см.](https://azure.microsoft.com/pricing/free-trial/)

### <a name="machine-setup"></a>Настройки компьютера

Для завершения локального развертывания необходимо установить следующие средства на локальный компьютер разработчика:

* [Git](https://git-scm.com/);
* [Docker](https://www.docker.com)
* [Java 8](https://www.oracle.com/technetwork/java/javase/downloads/index.html)
* [IntelliJ Community Edition](https://www.jetbrains.com/idea/download/);
* [Плагин IntelliJ Scala](https://plugins.jetbrains.com/plugin/1347-scala)
* [Плагин IntelliJ SBT](https://plugins.jetbrains.com/plugin/5007-sbt)
* [IntelliJ SBT Исполнитель плагин](https://plugins.jetbrains.com/plugin/7247-sbt-executor)
* [Nginx](https://nginx.org/en/download.html)
* [Node.js v8](https://nodejs.org/)

Node.js v8 является необходимым условием для PCS CLI, который скрипты используют для создания ресурсов Azure. Не используйте Node.js версии 10.

> [!NOTE]
> Служба IntelliJ IDE доступна для Windows и Mac.

## <a name="download-the-source-code"></a>Скачивание исходного кода

Репозиторий исходного кода для удаленного мониторинга включает в себе исходный код и файлы конфигурации Docker, необходимые для запуска образов Docker микрослужб.

Чтобы клонировать и создавать локальную версию репозитория, используйте среду командной строки, чтобы перейти к подходящей папке на локальной машине. Затем запустите один из следующих наборов команд для клонирования репозитория Java:

* Чтобы загрузить последнюю версию реализации микрослужбы Java, запустите следующую команду:

  ```cmd/sh
  git clone --recurse-submodules https://github.com/Azure/azure-iot-pcs-remote-monitoring-java.git
  ```

* Чтобы получить последние подмодули, запустите следующие команды:

   ```cmd/sh
   cd azure-iot-pcs-remote-monitoring-java
   git submodule foreach git pull origin master
    ```

> [!NOTE]
> Эти команды загружают исходный код для всех микрослужб в дополнение к сценариям, которые используются для локального запуска микрослужб. Вам не нужен исходный код для запуска микрослужб в Docker. Но исходный код полезен, если вы позже планируете изменить ускоритель решений и протестировать изменения локально.

## <a name="deploy-the-azure-services"></a>Развертывание служб Azure

Несмотря на то что в этой статье показано, как запускать микрослужбы локально, они зависят от служб Azure, выполняемых в облаке. Воспользуйтесь приведенным ниже скриптом для развертывания служб Azure. Примеры скриптов предполагают, что вы используете репозиторий Java на компьютере Windows. Если вы работаете в другой среде, измените пути, расширения файлов и разделители путей соответствующим образом.

### <a name="create-new-azure-resources"></a>Создание ресурсов Azure

Если вы еще не создали необходимые ресурсы Azure, выполните следующие действия:

1. В среде командной строки перейдите в папку **«услуги»-сценарий локального запуска** в клонированной копии репозитория.

1. Выполните следующие команды для установки инструмента CLI **pcs** и войдите в вашу учетную запись Azure.

    ```cmd
    npm install -g iot-solutions
    pcs login
    ```

1. Запустите скрипт **start.cmd**. Скрипт запрашивает следующие сведения:

   * имя решения;
   * Подписка Azure, которую нужно использовать.
   * расположение центра обработки данных Azure, который будет использоваться.

   Скрипт создает группу ресурсов в Azure с именем решения. Эта группа ресурсов содержит ресурсы Azure, которые использует ускоритель решений. Вы можете удалить эту группу ресурсов после того, как вам больше не нужны соответствующие ресурсы.

   Скрипт также добавляет набор переменных среды в локальной машине. Каждое переменное имя имеет префикс **PCS.** Эти переменные среды предоставляют детали, которые позволяют удаленному мониторингу считывать значения конфигурации с ресурса Azure Key Vault.

   > [!TIP]
   > Когда сценарий завершается, он сохраняет переменные среды в файл, называемый ** \<вашей домашней папке\>\\\\\<.pcs имя\>решения .env**. Их можно использовать для будущих развертываний ускорителей решений. Обратите внимание, что любые переменные среды, установленные на локальной машине, переопределяют значения в **\\\\локальном\\** файле .env при запуске **докер-компонировать.**

1. Закройте среду командной строки.

### <a name="use-existing-azure-resources"></a>Использование существующих ресурсов Azure

Если вы уже создали необходимые ресурсы Azure, установите соответствующие переменные среды на локальной машине:
* **PCS_KEYVAULT_NAME**: Название ресурса Key Vault.
* **PCS_AAD_APPID:** Идентификатор приложения Active Directory Azure (Azure AD).
* **PCS_AAD_APPSECRET**: Секрет приложения Azure AD.

Значения конфигурации будут читаться с этого ресурса Key Vault. Эти переменные среды могут быть сохранены в ** \<названии\>\\\\\<\>решения .pcs домашней папки .env** из файла развертывания. Обратите внимание, что при запуске **docker-compose** набор переменных среды на вашем компьютере переопределяет значения в файле **services\\scripts\\local\\.env**.

Часть конфигурации, необходимой микрослужбе, хранится в экземпляре Key Vault, который был создан при первоначальном развертывании. Соответствующие переменные в хранилище ключей должны быть изменены по мере необходимости.

## <a name="run-the-microservices"></a>Запуск микрослужб

В этом разделе вы запустите микрослужбы для удаленного мониторинга. Тогда вам нужно выполнить такую команду:

* Веб-uI родом.
* Услуги менеджера по моделированию устройств Изоот Azure, Auth и менеджеру по аналитике потоков Azure в Docker.
* Микросервисы в IntelliJ.

### <a name="run-the-device-simulation-service"></a>Запустите службу моделирования устройств

Откройте новое окно Командного Оперативного. Убедитесь, что у вас есть доступ к переменным среды, установленным скриптом **start.cmd** в предыдущем разделе.

Выполнить следующую команду, чтобы открыть контейнер Docker для службы моделирования устройств. Служба имитирует устройства для решения удаленного мониторинга.

```cmd
<path_to_cloned_repository>\services\device-simulation\scripts\docker\run.cmd
```

### <a name="run-the-auth-service"></a>Запуск службы "Аутентификация"

Откройте новое окно Командно-оперативная, а затем запустите следующую команду, чтобы открыть контейнер Docker для службы Auth. Используя эту услугу, вы можете управлять пользователями, которые имеют право на доступ к решениям Azure IoT.

```cmd
<path_to_cloned_repository>\services\auth\scripts\docker\run.cmd
```

### <a name="run-the-stream-analytics-manager-service"></a>Запустите сервис Stream Analytics Manager

Откройте новое окно командного запроса, а затем запустите следующую команду, чтобы открыть контейнер Docker для службы Stream Analytics Manager. С помощью этого сервиса вы можете управлять заданиями Stream Analytics. Такое управление включает в себя настройку конфигурации задания и запуск, остановку и мониторинг состояния задания.

```cmd
<path_to_cloned_repository>\services\asa-manager\scripts\docker\run.cmd
```

### <a name="deploy-all-other-microservices-on-your-local-machine"></a>Развертывание всех других микрослужб на локальной машине

Следующие шаги показывают, как запустить микрослужбы удаленного мониторинга в IntelliJ.

#### <a name="import-a-project"></a>Импорт проекта

1. Откройте IntelliJ IDE.
1. Выберите **проект импорта**.
1. Выберите **Azure-iot-pcs-удаленный-мониторинг-java-услуги-build.sbt**.

#### <a name="create-run-configurations"></a>Создание конфигураций запусков

1. Выберите**конфигурации Run Edit**. **Run** > 
1. Выберите **Добавить новую задачу конфигурации** > **sbt.**
1. Введите **имя,** а затем введите **задачи** в качестве **запуска.**
1. Выберите **рабочий каталог** на основе службы, которая вы хотите запустить.
1. Выберите **Apply** > **OK,** чтобы сохранить свой выбор.
1. Создавайте конфигурации выполнения для следующих веб-сервисов:
    * WebService (services\config);
    * WebService (services\device-telemetry);
    * WebService (services\iothub-manager);
    * WebService (services\storage-adapter).

Например, на следующем изображении показано, как добавить конфигурацию для службы:

[![Скриншот окна конфигураций IntelliJ Run/Debug Configurations, показывающий опцию storageAdapter, выделенную в списке задач sbt в левом стекле, и записи в поле имен, задач, рабочего каталога и параметров VM в правом стекле.](./media/deploy-locally-intellij/run-configurations.png)](./media/deploy-locally-intellij/run-configurations.png#lightbox)

#### <a name="create-a-compound-configuration"></a>Создание сложной конфигурации

1. Чтобы запустить все службы вместе, выберите **Добавить новое соединение конфигурации.** > **Compound**
1. Введите **имя,** а затем выберите **добавить sbt задач.**
1. Выберите **Apply** > **OK,** чтобы сохранить свой выбор.

Например, на следующем изображении показано, как добавить все задачи sbt в одну конфигурацию:

[![Скриншот окна конфигураций IntelliJ Run/Debug Configurations, показывающий опцию AllServices, выделенную в списке соединения в левом стекле, и опцию sbt Task 'deviceTelemetry', выделенную в правом стекле.](./media/deploy-locally-intellij/all-services.png)](./media/deploy-locally-intellij/all-services.png#lightbox)

Выберите **Run** для создания и запуска веб-служб на локальной машине.

Каждый веб-сервис открывает окно Командный запрос и окно веб-браузера. В запросе команды вы видите выход из работаного сервиса. Окно браузера позволяет контролировать состояние. Не закрывайте окна командования оперативного управления или веб-страницы, так как эти действия останавливают веб-службу.

Чтобы получить доступ к статусу услуг, перейдите на следующие URL-адреса:

* Менеджер IoT-Hub:[http://localhost:9002/v1/status](http://localhost:9002/v1/status)
* Телеметрия устройства:[http://localhost:9004/v1/status](http://localhost:9004/v1/status)
* Config:[http://localhost:9005/v1/status](http://localhost:9005/v1/status)
* адаптер для хранения данных:[http://localhost:9022/v1/status](http://localhost:9022/v1/status)

### <a name="start-the-stream-analytics-job"></a>Запуск задания Stream Analytics

Чтобы запустить задание Stream Analytics, выполните следующие действия:

1. Перейдите на [портал Azure](https://portal.azure.com).
1. Перейдите к **группе ресурсов,** созданной для вашего решения. Название группы ресурсов — это имя, выбранное для решения при запуске сценария **start.cmd.**
1. Выберите **задание Stream Analytics** в списке ресурсов.
1. На странице **обзора** вакансий Stream Analytics выберите кнопку **«Пуск»,** а затем выберите **«Начало»** для начала работы.

### <a name="run-the-web-ui"></a>Запуск веб-интерфейса

На этом этапе вы запустите веб-интерфейс. Откройте новое окно Командного Оперативного. Убедитесь, что у вас есть доступ к переменным среды, установленным скриптом **start.cmd.** Перейдите в папку **webui** в локальной копии репозитория, а затем запустите следующие команды:

```cmd
npm install
npm start
```

Когда **команда запуска** завершена, браузер отображает страницу [http://localhost:3000/dashboard](http://localhost:3000/dashboard)по адресу. На этой странице могут возникать ошибки. Чтобы просмотреть приложение без ошибок, выполните следующие шаги.

### <a name="configure-and-run-nginx"></a>Налаживание и запуск Nginx

Навлажьте обратный прокси-сервер, который связывает веб-приложение с микрослужбами, работающими на локальной машине:

1. Копируйте файл **nginx.conf** из папки **webui-scripts-localhost** в локальной копии репозитория в каталог установки **nginx-conf.**
1. Беги Нгинкс.

Для получения дополнительной информации о запуске Nginx, [см.](https://nginx.org/en/docs/windows.html)

### <a name="connect-to-the-dashboard"></a>Подключение к панели мониторинга

Чтобы получить доступ к панели мониторинга удаленного мониторинга, перейдите в http://localhost:9000 браузере.

## <a name="clean-up"></a>Очистка

Чтобы избежать ненужных платежей, удалите облачные службы из подписки Azure после завершения тестирования. Чтобы удалить службы, перейдите на [портал Azure](https://ms.portal.azure.com)и удалите группу ресурсов, созданную скриптом **start.cmd.**

Вы также можете удалить локальную копию репозитория удаленного мониторинга, созданного при клонировании исходного кода gitHub.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы развернули решение для удаленного мониторинга, ознакомьтесь со статьей [Краткое руководство. Использование облачного решения для удаленного мониторинга](quickstart-remote-monitoring-deploy.md).
