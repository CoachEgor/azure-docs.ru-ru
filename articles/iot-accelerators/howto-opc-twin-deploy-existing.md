---
title: Как развернуть модуль OPC Twin в существующий проект Azure Документы Майкрософт
description: В этой статье описывается, как развернуть OPC Twin в существующий проект. Вы также можете узнать, как устранить сбои развертывания.
author: dominicbetts
ms.author: dobett
ms.date: 11/26/2018
ms.topic: conceptual
ms.service: industrial-iot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: b971ec13c71ccfd7d28ae6987593d09201b9b764
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "73824120"
---
# <a name="deploy-opc-twin-to-an-existing-project"></a>Развертывание OPC Twin в существующий проект

Модуль OPC Twin работает на IoT Edge и предоставляет несколько услуг EDGE для opC Twin и регистрационных служб.

Микрослужба OPC Twin облегчает связь между операторами завода и серверными устройствами OPC UA на заводе с помощью модуля OPC Twin IoT Edge. Микрослужба предоставляет услуги OPC UA (Browse, Read, Write и Execute) через aPI REST. 

Микрослужба реестра устройств OPC UA обеспечивает доступ к зарегистрированным приложениям OPC UA и их конечным точкам. Операторы и администраторы могут регистрировать и регистрировать новые приложения OPC UA и просматривать существующие приложения, включая их конечные точки. В дополнение к управлению приложениями и конечными точками, служба регистрации также каталогизирует зарегистрированные модули OPC Twin IoT Edge. API службы позволяет управлять функциональностью краевого модуля, например, запускаили или останавливали обнаружение сервера (службы сканирования) или активировали новые близнецы конечных точек, к которым можно получить доступ с помощью микрослужбы OPC Twin.

Ядром модуля является идентификация руководителя. Руководитель управляет конечным близнецом, который соответствует конечным точкам сервера OPC UA, которые активируются с помощью соответствующего API реестра OPC UA. Эта конечная точка близнецов перевести OPC UA JSON получил от OPC Twin микрослужбы работает в облаке в OPC UA двоичные сообщения, которые отправляются по состоянию безопасного канала в управляемой конечной точке. Руководитель также предоставляет услуги обнаружения, которые отправляют события обнаружения устройств в службу бортовой посадки OPC UA для обработки, где эти события приводят к обновлению реестра OPC UA.  В этой статье показано, как развернуть модуль OPC Twin в существующий проект.

> [!NOTE]
> Для получения дополнительной [информации](https://github.com/Azure/azure-iiot-opc-twin-module)о деталях развертывания и инструкциях см.

## <a name="prerequisites"></a>Предварительные требования

Убедитесь, что у вас установлены расширения PowerShell и [AzureRM PowerShell.](https://docs.microsoft.com/powershell/azure/azurerm/install-azurerm-ps) Если вы еще не сделали этого, клоните этот репозиторий GitHub. В PowerShell выполните следующие команды:

```powershell
git clone --recursive https://github.com/Azure/azure-iiot-components.git
cd azure-iiot-components
```

## <a name="deploy-industrial-iot-services-to-azure"></a>Развертывание промышленных IoT-сервисов в Azure

1. В сеансе PowerShell запустите:

    ```powershell
    set-executionpolicy -ExecutionPolicy Unrestricted -Scope Process
    .\deploy.cmd
    ```

2. Следуйте запросам, чтобы присвоить имя группе ресурсов развертывания и имя веб-сайта.   Скрипт развертывает микрослужбы и их зависимости платформы Azure в группу ресурсов в подписке Azure.  Скрипт также регистрирует приложение в вашем каталоге Активных каталогов Azure (AAD) для поддержки проверки подлинности на основе OAUTH.  Развертывание займет несколько минут.  Пример того, что можно увидеть после успешного развертывания решения:

   ![Промышленный IoT OPC Twin развертывает в существующий проект](media/howto-opc-twin-deploy-existing/opc-twin-deploy-existing1.png)

   Выход включает URL-адрес общедоступной конечной точки. 

3. После успешного завершения скрипта выберите, `.env` хотите ли вы сохранить файл.  Вам нужен файл `.env` среды, если вы хотите подключиться к точке облака с помощью таких инструментов, как консоль или развернуть модули для разработки и отладки.

## <a name="troubleshooting-deployment-failures"></a>Устранение сбоев в развертывании

### <a name="resource-group-name"></a>Имя группы ресурсов

Убедитесь, что вы используете короткое и простое имя группы ресурсов.  Имя используется также для именования ресурсов как таковых, которые должны соответствовать требованиям именования ресурсов.  

### <a name="website-name-already-in-use"></a>Название веб-сайта уже используется

Не исключено, что название сайта уже используется.  Если вы столкнулись с этой ошибкой, вам нужно использовать другое имя приложения.

### <a name="azure-active-directory-aad-registration"></a>Регистрация Активного каталога Azure (AAD)

Скрипт развертывания пытается зарегистрировать два приложения AAD в Active Directory Azure.  В зависимости от ваших прав на выбранного арендатора AAD развертывание может выйти из строя. Имеются две возможности:

1. Если вы выбрали арендатора AAD из списка арендаторов, перезапустите скрипт и выберите другой из списка.
2. Кроме того, развернуть частный арендатор AAD в другой подписке, перезапустить скрипт и выбрать его для его использования.

> [!WARNING]
> НИКОГДА не продолжать без аутентификации.  Если вы решите сделать это, любой может получить доступ к вашим конечным точкам OPC Twin из Интернета без подлинности.   Вы всегда можете выбрать ["местный" вариант развертывания,](howto-opc-twin-deploy-dependencies.md) чтобы пнуть шины.

## <a name="deploy-an-all-in-one-industrial-iot-services-demo"></a>Развертывание демонстрации промышленных IoT-услуг «все-в-одном»

Вместо просто служб и зависимостей можно также развернуть демо-версию «все-в-одном».  Все в одном демо содержит три OPC UA серверов, модуль OPC Twin, все микрослужбы, и образец веб-приложений.  Предназначен для демонстрационных целей.

1. Убедитесь, что у вас есть клон репозитория (см. выше). Откройте запрос PowerShell в корне репозитория и запустите:

    ```powershell
    set-executionpolicy -ExecutionPolicy Unrestricted -Scope Process
    .\deploy -type demo
    ```

2. Следуйте запросам, чтобы присвоить новое имя группе ресурсов и имя веб-сайту.  После успешного развертывания скрипт будет отображать URL-адрес конечной точки веб-приложения.

## <a name="deployment-script-options"></a>Параметры сценария развертывания

Скрипт принимает следующие параметры:

```powershell
-type
```

Тип развертывания (vm, локальный, демо))

```powershell
-resourceGroupName
```

Может быть имя существующей или новой группы ресурсов.

```powershell
-subscriptionId
```

Дополнительный идентификатор подписки, в котором будут развернуты ресурсы.

```powershell
-subscriptionName
```

Или имя подписки.

```powershell
-resourceGroupLocation
```

Необязательно, расположение группы ресурсов. Если указано, попытается создать новую группу ресурсов в этом месте.

```powershell
-aadApplicationName
```

Название приложения AAD для регистрации.

```powershell
-tenantId
```

AAD арендатора для использования.

```powershell
-credentials
```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как развернуть OPC Twin в существующий проект, вот следующий шаг:

> [!div class="nextstepaction"]
> [Безопасная связь OPC UA Client и OPC UA PLC](howto-opc-vault-secure.md)
