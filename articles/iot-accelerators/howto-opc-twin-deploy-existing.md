---
title: Как развернуть модуль OPC Двойника в существующий проект Azure | Документация Майкрософт
description: Как развернуть OPC Двойника в существующий проект.
author: dominicbetts
ms.author: dobett
ms.date: 11/26/2018
ms.topic: conceptual
ms.service: iot-industrialiot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: 6eeca062bdc17ec207910b9ba4aa8cea4048f849
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67080509"
---
# <a name="deploy-opc-twin-to-an-existing-project"></a>Развертывание OPC Двойника в существующий проект

OPC Двойника модуля выполняется в IoT Edge и предоставляет несколько служб edge Двойника OPC и реестра службы.

Micro service Двойника OPC облегчает взаимодействие между операторы фабрики и устройствам сервера OPC UA на заводской площадке через модуль Edge Интернета вещей для Двойников OPC. Micro service предоставляет службы OPC UA (обзора, чтение, запись и выполнение) с помощью REST API. 

В микрослужбе реестра OPC UA устройства предоставляет доступ к зарегистрированные приложения OPC UA и их конечные точки. Администраторы и операторы можно зарегистрировать и отменить регистрацию новых приложений OPC UA и обзор существующих данных, включая их конечные точки. Помимо приложения и управление конечными точками Служба реестра также каталоги зарегистрированных модулей Edge Интернета вещей для Двойников OPC. Предоставляет API службы управления функциональности модуля edge, например, запуск или остановка обнаружения серверов (сканирования службы) или активации новой конечной точки двойники, может осуществляться с помощью службы micro Двойника OPC.

Модуль лежит удостоверение "контролер". Контролер управляет двойника конечной точки, который соответствует конечные точки сервера OPC UA, которые были активированы с помощью соответствующего интерфейса API реестра OPC UA. Этой конечной точки двойников перевод JSON OPC UA, получил от службы micro OPC Двойника, работающее в облаке в OPC UA двоичные сообщения, отправляемые через защищенный канал с отслеживанием состояния, чтобы управляемые конечной точки. Контролер также обнаружения служб, которые отправляют события обнаружения устройства к службе адаптации OPC UA устройства для обработки данных, когда эти события привести обновлений в реестр OPC UA.  В этой статье показано, как развернуть OPC Двойника модуля в существующий проект.

> [!NOTE]
> Дополнительные сведения о подробных сведений о развертывании и инструкции см. в разделе со сведениями о GitHub [репозитория](https://github.com/Azure/azure-iiot-opc-twin-module).

## <a name="prerequisites"></a>Технические условия

Убедитесь, что у вас есть PowerShell и [Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps) установлены расширения. Если вы еще не сделали, клонируйте этот репозиторий GitHub. В PowerShell выполните следующие команды:

```powershell
git clone --recursive https://github.com/Azure/azure-iiot-components.git
cd azure-iiot-components
```

## <a name="deploy-industrial-iot-services-to-azure"></a>Развертывание служб промышленного Интернета вещей в Azure

1. В сеансе PowerShell выполните следующую команду:

    ```powershell
    set-executionpolicy -ExecutionPolicy Unrestricted -Scope Process
    .\deploy.cmd
    ```

2. Следуйте инструкциям на экране, чтобы назначить имя группе ресурсов развертывания и имя веб-сайта.   Скрипт подготовит micro служб и зависимости платформы Azure, в группе ресурсов в подписке Azure.  Скрипт также регистрирует приложение в клиенте Azure Active Directory (AAD) для поддержки проверки подлинности на основе OAUTH.  Развертывание займет несколько минут.  Пример, которую вы видите после успешного развертывания решения:

   ![Развертывание Двойника OPC промышленного Интернета вещей в существующий проект](media/howto-opc-twin-deploy-existing/opc-twin-deploy-existing1.png)

   Выходные данные содержат URL-адрес общедоступной конечной точки. 

3. После успешного выполнения сценария, выберите, хотите ли вы сохранить env-файле.  Требуется среде env-файле, если вы хотите подключиться к облачной конечной точки, с помощью средств, таких как консоль или развернуть модули для разработки и отладки.

## <a name="troubleshooting-deployment-failures"></a>Устранение неполадок развертывания

### <a name="resource-group-name"></a>Имя группы ресурсов

Убедитесь, что использовать короткие и простые имя группы ресурсов.  Имя также используется для имени ресурсы таким образом оно должно подчиняться с требованиями к именованию ресурсов.  

### <a name="website-name-already-in-use"></a>Имя веб-сайта уже используется

Вполне возможно, что имя веб-сайта уже используется.  При возникновении этой ошибки, необходимо использовать имя приложения.

### <a name="azure-active-directory-aad-registration"></a>Регистрация в Azure Active Directory (AAD)

Скрипт развертывания пытается зарегистрировать два приложения AAD в Azure Active Directory.  В зависимости от того, ваши права для выбранного клиента AAD развертывание может завершиться ошибкой. Существуют два варианта:

1. Если вы выбрали с клиентом AAD из списка клиентов, перезапустите сценарий и выберите его из списка.
2. Кроме того развертывание частного клиента AAD в другой подписке, перезапустите сценарий и выберите, чтобы использовать его.

> [!WARNING]
> Никогда не переходил без проверки подлинности.  Если вы решили сделать это, любой пользователь может доступа к конечным точкам OPC Двойника из Интернета без проверки подлинности.   Вы всегда можете [вариант развертывания «local»](howto-opc-twin-deploy-dependencies.md) тестовая.

## <a name="deploy-an-all-in-one-industrial-iot-services-demo"></a>Развертывание демонстрационной службы Интернета вещей промышленного All-In-one

Вместо необходимых служб и зависимости можно также развернуть все в одном demo.  Все в одной демонстрации содержит три сервера OPC UA, OPC Двойник модуля, всех микрослужб и образец веб-приложения.  Он предназначен для демонстрационных целей.

1. Убедитесь, что у вас есть клон репозитория (см. выше). Откройте командную строку PowerShell в корне репозитория и выполните:

    ```powershell
    set-executionpolicy -ExecutionPolicy Unrestricted -Scope Process
    .\deploy -type demo
    ```

2. Следуйте инструкциям на экране, чтобы назначить новое имя группы ресурсов и имя веб-сайта.  После успешного развертывания сценарий выводит URL-адрес конечной точки веб-приложения.

## <a name="deployment-script-options"></a>Параметры скрипта развертывания

Сценарий принимает следующие параметры:

```powershell
-type
```

Тип развертывания (виртуальной машины, local, демонстрация)

```powershell
-resourceGroupName
```

Может быть именем существующей или новой группы ресурсов.

```powershell
-subscriptionId
```

Необязательно, идентификатор подписки, где будут развертываться ресурсы.

```powershell
-subscriptionName
```

Или имя подписки.

```powershell
-resourceGroupLocation
```

Необязательно, расположение группы ресурсов. Если указано, будет предпринята попытка создать новую группу ресурсов в этом расположении.

```powershell
-aadApplicationName
```

Имя для приложения AAD для регистрации в разделе.

```powershell
-tenantId
```

Клиент AAD для использования.

```powershell
-credentials
```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как развернуть OPC Двойника в существующий проект, вот мы предлагаем:

> [!div class="nextstepaction"]
> [Безопасный обмен данными клиента OPC и OPC PLC](howto-opc-vault-deploy-existing-client-plc-communication.md)
