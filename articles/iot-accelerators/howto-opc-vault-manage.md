---
title: Как управлять службой сертификатов OPC Vault - Azure Документы Майкрософт
description: Управление сертификатами ROOT CA OPC Vault и разрешениями пользователей.
author: mregen
ms.author: mregen
ms.date: 8/16/2019
ms.topic: conceptual
ms.service: industrial-iot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: 890a25ed2cf11d657cad930815d78dbf968cc9f9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "71203648"
---
# <a name="manage-the-opc-vault-certificate-service"></a>Управление службой сертификатов OPC Vault

В этой статье разъясняются административные задачи службы управления сертификатами OPC Vault в Azure. Она включает в себя информацию о том, как обновить сертификаты эмитента CA, как обновить список отзыва сертификатов (CRL), и как предоставить и отозвать доступ к пользователю.

## <a name="create-or-renew-the-root-ca-certificate"></a>Создание или обновление корневого сертификата CA

После развертывания OPC Vault необходимо создать корневой сертификат CA. Без действительного сертификата Эмитента CA вы не можете подписать или выдать сертификаты заявок. Ссылайтесь на [сертификаты](howto-opc-vault-secure-ca.md#certificates) для управления сертификатами с разумными и безопасными сроками службы. Обновите сертификат Эмитента CA после половины срока его службы. При обновлении также учитывайте, что настроенный срок службы недавно подписанного сертификата приложения не должен превышать срок действия сертификата Ca эмитента.
> [!IMPORTANT]
> Роль администратора необходима для создания или обновления сертификата CA эмитента.

1. Откройте сертификат `https://myResourceGroup-app.azurewebsites.net`службы на , и войти в систему.
2. Перейти к **группе сертификатов**.
3. В списке есть одна группа сертификатов по умолчанию. Выберите **Изменить**.
4. В сведениях о **группе правок edit,** вы можете изменить имя объекта и срок службы сертификатов CA и приложений. Предмет и сроки службы должны быть установлены только один раз до выдачи первого сертификата CA. Пожизненные изменения во время операций могут привести к несогласованности сроков службы выданных сертификатов и CRL.
5. Введите действительный предмет `CN=My CA Root, O=MyCompany, OU=MyDepartment`(например, ).<br>
   > [!IMPORTANT]
   > Если вы измените тему, вы должны обновить сертификат эмитента, или служба не подпишет сертификаты приложения. Предмет конфигурации проверяется с субъектом активного сертификата эмитента. Если предметы не совпадают, подписание сертификата отказано.
6. Нажмите кнопку **Сохранить**.
7. Если на данном этапе вы столкнулись с «запрещенной» ошибкой, учетные данные пользователей не имеют разрешения администратора на изменение или создание нового корневого сертификата. По умолчанию у пользователя, развернувшего службу, есть администратор и подписывающие роли с службой. Другие пользователи должны быть добавлены к ролям Утверждениера, Писателя или Администратора, если это уместно в регистрации приложения Azure Active Directory (Azure AD).
8. Выберите **подробную информацию**. Это должно показать обновленную информацию.
9. Выберите **Renew CA Certificate** для выдачи первого сертификата Эмитента CA или для продления сертификата эмитента. Затем выберите **OK**.
10. Через несколько секунд вы увидите **сведения о сертификате.** Чтобы загрузить последний сертификат CA и CRL для распространения в приложениях OPC UA, выберите **Эмитента** или **Crl.**

Теперь служба управления сертификатами OPC UA готова выдавать сертификаты для приложений OPC UA.

## <a name="renew-the-crl"></a>Обновление CRL

Обновление CRL — это обновление, которое должно распространяться среди приложений через регулярные промежутки времени. Устройства OPC UA, поддерживающие расширение CRL Distribution Point X509, могут напрямую обновлять CRL с точки зрения микрослужбы. Другие устройства OPC UA могут потребовать ручных обновлений или могут быть обновлены с помощью расширений нажатия сервера GDS для обновления списков доверия с помощью сертификатов и CRL.

В следующем рабочем процессе все запросы сертификатов в удаленных состояниях отменяются в CRL, которые соответствуют сертификату Эмитента CA, для которого они были выданы. Номер версии CRL приращен на 1. <br>
> [!NOTE]
> Все выпущенные CRL действительны до истечения срока действия сертификата Эмитента CA. Это связано с тем, что спецификация OPC UA не требует обязательной детерминированной модели распределения для CRL.

> [!IMPORTANT]
> Роль Администратора необходима для обновления CRL-эмитента.

1. Откройте сертификат `https://myResourceGroup.azurewebsites.net`службы на , и войти в систему.
2. Перейдите на страницу **группы сертификатов.**
3. Выберите **подробную информацию**. При этом следует отображать текущий сертификат и информацию о CRL.
4. Выберите **список отзыва обновлений CRL (CRL)** для выпуска обновленного CRL для всех активных сертификатов эмитента в хранилище OPC Vault.
5. Через несколько секунд вы увидите **сведения о сертификате.** Чтобы загрузить последний сертификат CA и CRL для распространения в приложениях OPC UA, выберите **Эмитента** или **Crl.**

## <a name="manage-user-roles"></a>Создание ролей пользователей

Вы управляете ролями пользователей микрослужбы OPC Vault в корпоративном приложении Azure AD. Подробное описание определений ролей [см.](howto-opc-vault-secure-ca.md#roles)

По умолчанию аутентифицированный пользователь в арендаторе может зарегистрироваться в службе в качестве читателя. Более высокие привилегированные роли требуют ручного управления на портале Azure или с помощью PowerShell.

### <a name="add-user"></a>Добавление пользователя

1. Откройте портал Azure.
2. Перейдите к > **приложениям**Active Directory Enterprise **Azure.**
3. Выберите регистрацию микросервиса OPC Vault (по умолчанию ваш). `resourceGroupName-service`
4. Перейти к **пользователям и группам**.
5. Выберите **Добавить пользователь**.
6. Выберите или пригласите пользователя для назначения на определенную роль.
7. Выберите роль для пользователей.
8. Выберите **Назначить**.
9. Для пользователей в роли администратора или утверждения продолжайте добавлять политики доступа к доступу к ключу Azure Key Vault.

### <a name="remove-user"></a>Удаление пользователя

1. Откройте портал Azure.
2. Перейдите к > **приложениям**Active Directory Enterprise **Azure.**
3. Выберите регистрацию микросервиса OPC Vault (по умолчанию ваш). `resourceGroupName-service`
4. Перейти к **пользователям и группам**.
5. Выберите пользователя с ролью для удаления, а затем выберите **Удалить**.
6. Для удаленных пользователей в роли администратора или утверждения также удалите их из политики Azure Key Vault.

### <a name="add-user-access-policy-to-azure-key-vault"></a>Добавление политики доступа пользователей в Хранилище ключей Azure

Для утверждений и администраторов требуются дополнительные политики доступа.

По умолчанию идентификатор службы имеет только ограниченные разрешения на доступ к Key Vault, чтобы предотвратить повышенные операции или изменения, которые происходят без олицетворения пользователя. Основные разрешения службы Get and List, как для секретов, так и для сертификатов. Для secrets есть только одно исключение: служба может удалить личный ключ из секретного магазина после того, как он будет принят пользователем. Все остальные операции требуют выданных пользователем разрешений.

#### <a name="for-an-approver-role-the-following-permissions-must-be-added-to-key-vault"></a>Для роли Утвержденного в Key Vault необходимо добавить следующие разрешения

1. Откройте портал Azure.
2. Перейдите в OPC Vault, `resourceGroupName`используемый во время развертывания.
3. Перейти к `resourceGroupName-xxxxx`Key Vault .
4. Перейти к **политике доступа**.
5. Нажмите кнопку **Добавить**.
6. Пропустить шаблон. Нет шаблона, который соответствовал бы требованиям.
7. Выберите **«Выбрать главного»** и выберите пользователя для добавления или пригласите нового пользователя к арендатору.
8. Выберите следующие **ключевые разрешения**: **Получите,** **Перечислите**и **Подпишите.**
9. Выберите следующие **секретные разрешения**: **Получить,** **Список**, **Установить**, и **удалить**.
10. Выберите следующие **разрешения сертификата**: **Получите** и **перечислите**.
11. Выберите **OK,** и выберите **Сохранить**.

#### <a name="for-an-administrator-role-the-following-permissions-must-be-added-to-key-vault"></a>Для роли администратора в Key Vault необходимо добавить следующие разрешения

1. Откройте портал Azure.
2. Перейдите в OPC Vault, `resourceGroupName`используемый во время развертывания.
3. Перейти к `resourceGroupName-xxxxx`Key Vault .
4. Перейти к **политике доступа**.
5. Нажмите кнопку **Добавить**.
6. Пропустить шаблон. Нет шаблона, который соответствовал бы требованиям.
7. Выберите **«Выбрать главного»** и выберите пользователя для добавления или пригласите нового пользователя к арендатору.
8. Выберите следующие **ключевые разрешения**: **Получите,** **Перечислите**и **Подпишите.**
9. Выберите следующие **секретные разрешения**: **Получить,** **Список**, **Установить**, и **удалить**.
10. Выберите следующие **разрешения сертификата**: **Получите,** **Список,** **Обновление,** **Создание**и **Импорт**.
11. Выберите **OK,** и выберите **Сохранить**.

### <a name="remove-user-access-policy-from-azure-key-vault"></a>Удалить политику доступа пользователей из Хранилища ключей Azure

1. Откройте портал Azure.
2. Перейдите в OPC Vault, `resourceGroupName`используемый во время развертывания.
3. Перейти к `resourceGroupName-xxxxx`Key Vault .
4. Перейти к **политике доступа**.
5. Найдите пользователя для удаления и выберите **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как управлять сертификатами OPC Vault и пользователями, вы можете:

> [!div class="nextstepaction"]
> [Безопасная связь устройств OPC](howto-opc-vault-secure.md)
