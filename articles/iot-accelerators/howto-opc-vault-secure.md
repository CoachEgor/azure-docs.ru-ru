---
title: Защищайте связь устройств OPC UA с ПОМОЩЬю OPC Vault - Azure Документы Майкрософт
description: Как зарегистрировать приложения OPC UA и как выдавать подписанные сертификаты приложений для устройств OPC UA с OPC Vault.
author: mregen
ms.author: mregen
ms.date: 8/16/2018
ms.topic: conceptual
ms.service: industrial-iot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: af5e511cbf273bc4e4fa0a08d089a955426fe75c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75454193"
---
# <a name="use-the-opc-vault-certificate-management-service"></a>Воспользуйтесь службой управления сертификатом OPC Vault

В этой статье объясняется, как зарегистрировать приложения и как выдавать подписанные сертификаты приложений для ваших устройств OPC UA.

## <a name="prerequisites"></a>Предварительные требования

### <a name="deploy-the-certificate-management-service"></a>Развертывание службы управления сертификатами

Во-первых, развернуть службу в облаке Azure. Для получения подробной информации [см.](howto-opc-vault-deploy.md)

### <a name="create-the-issuer-ca-certificate"></a>Создание сертификата Эмитента CA

Если вы еще этого не сделали, создайте сертификат Эмитента CA. Для получения подробной информации [см. Создать и управлять сертификатом эмитента для OPC Vault.](howto-opc-vault-manage.md)

## <a name="secure-opc-ua-applications"></a>Безопасные приложения OPC UA

### <a name="step-1-register-your-opc-ua-application"></a>Шаг 1: Зарегистрируйте приложение OPC UA 

> [!IMPORTANT]
> Роль писателя необходима для регистрации приложения.

1. Откройте сертификат `https://myResourceGroup-app.azurewebsites.net`службы на , и войти в систему.
2. Перейти к **регистрации новых**. Для регистрации приложения пользователю необходимо назначить хотя бы роль писателя.
2. Форма входа соответствует соглашениям о наименовании в OPC UA. Например, на следующем скриншоте показаны параметры для образца [OPC UA Reference Server](https://github.com/OPCFoundation/UA-.NETStandard/tree/master/SampleApplications/Workshop/Reference) в стекле OPC UA .NET Standard:

   ![Скриншот регистрации сервера UA](media/howto-opc-vault-secure/reference-server-registration.png "Ua Справочная регистрация сервера")

5. Выберите **регистр** для регистрации приложения в базе данных приложения службы сертификатов. Рабочий процесс непосредственно направляет пользователя к следующему шагу, чтобы запросить подписанный сертификат для приложения.

### <a name="step-2-secure-your-application-with-a-ca-signed-application-certificate"></a>Шаг 2: Защищайте свое приложение сертификатом приложения, подписанным CA

Защитите свою заявку OPC UA, выпустив подписанный сертификат на основе запроса на подписание сертификата (CSR). Кроме того, вы можете запросить новую пару ключей, которая включает в себя новый закрытый ключ в формате PFX или PEM. Для получения информации о том, какой метод поддерживается для приложения, смотрите документацию вашего устройства OPC UA. Как правило, рекомендуется метод КСО, так как он не требует переноса закрытого ключа через провод.

#### <a name="request-a-new-certificate-with-a-new-keypair"></a>Запросить новый сертификат с новой парой ключей

1. Перейти к **приложениям**.
3. Выберите **новый запрос** для включенного приложения.

   ![Скриншот запроса нового сертификата](media/howto-opc-vault-secure/request-new-certificate.png "Запрос нового сертификата")

3. Выберите **запрос нового KeyPair и Сертификата** для запроса частного ключа и нового подписанного сертификата с общедоступным ключом для вашего приложения.

   ![Скриншот создания нового KeyPair и сертификата](media/howto-opc-vault-secure/generate-new-key-pair.png "Создание новой ключевой пары")

4. Заполните форму предметом и доменными именами. Для частного ключа выберите PEM или PFX с паролем. Для создания запроса сертификата выберите **новый KeyPair.**

   ![Скриншот Сведения о запросе сертификата просмотра](media/howto-opc-vault-secure/approve-reject.png "Утвердить сертификат")

5. Для утверждения требуется пользователь с ролью Утверждениера и с подписанием разрешений в Azure Key Vault. В обычном рабочем процессе роли утверждение и запрос должен быть назначены разным пользователям. Выберите **Утвердить** или **отклонить,** чтобы начать или отменить фактическое создание ключевой пары и операции подписания. Новая пара ключей создается и надежно хранится в Azure Key Vault до загрузки запрашивателем сертификата. Полученный сертификат с открытым ключом подписывается ЦА. Завершение этих операций может занять несколько секунд.

   ![Скриншот сведения о запросе сертификата просмотра с сообщением утверждения внизу](media/howto-opc-vault-secure/view-key-pair.png "Посмотреть ключевую пару")

7. Полученный частный ключ (PFX или PEM) и сертификат (DER) можно загрузить отсюда в формате, выбранном в качестве загрузки двоичного файла. Кроме того, доступна закодированная версия base64, например, для копирования и вставки сертификата в командную строку или запись текста. 
8. После того, как закрытый ключ загружается и хранится надежно, вы можете выбрать **Delete Private Key**. Сертификат с общедоступным ключом остается доступным для использования в будущем.
9. В связи с использованием сертификата CA, сертификат CA и список отзыва сертификатов (CRL) также должны быть загружены здесь.

Теперь это зависит от устройства OPC UA, как применять новую пару ключей. Как правило, сертификат CA и CRL `trusted` копируются в папку, в то время как `own` общедоступные и частные ключи сертификата приложения применяются к папке в магазине сертификатов. Некоторые устройства могут уже поддерживать нажатие сервера на обновление сертификатов. Обратитесь к документации вашего устройства OPC UA.

#### <a name="request-a-new-certificate-with-a-csr"></a>Запросить новый сертификат с КСО 

1. Перейти к **приложениям**.
3. Выберите **новый запрос** для включенного приложения.

   ![Скриншот запроса нового сертификата](media/howto-opc-vault-secure/request-new-certificate.png "Запрос нового сертификата")

3. Выберите **Запрос нового сертификата с подпиской Запрос** на запрос нового подписанного сертификата для вашего приложения.

   ![Скриншот создания нового сертификата](media/howto-opc-vault-secure/generate-new-certificate.png "Создание нового сертификата")

4. Загрузите CSR, выбрав локальный файл или вставив базовый 64 закодированного КСО в форме. Выберите **создание нового сертификата**.

   ![Скриншот Сведения о запросе сертификата просмотра](media/howto-opc-vault-secure/approve-reject-csr.png "Утвердить КСО")

5. Для утверждения требуется пользователь с ролью Утверждениера и с подписанием разрешений в Azure Key Vault. Выберите **Утвердить** или **отклонить,** чтобы начать или отменить фактическую операцию подписания. Полученный сертификат с открытым ключом подписывается ЦА. Завершение этой операции может занять несколько секунд.

   ![Скриншот сведения о запросе сертификата просмотра с сообщением утверждения внизу](media/howto-opc-vault-secure/view-cert-csr.png "Просмотр сертификата")

6. Полученный сертификат (DER) можно загрузить отсюда как двоичный файл. Кроме того, доступна закодированная версия base64, например, для копирования и вставки сертификата в командную строку или запись текста. 
10. После того, как сертификат загружается и хранится надежно, вы можете выбрать **Сертификат Удаления**.
11. В связи с использованием сертификата CA, сертификат CA и CRL должны быть загружены здесь также.

Теперь от устройства OPC UA зависит, как применять новый сертификат. Как правило, сертификат CA и CRL `trusted` копируются в папку, в `own` то время как сертификат приложения применяется к папке в магазине сертификатов. Некоторые устройства могут уже поддерживать нажатие сервера на обновление сертификатов. Обратитесь к документации вашего устройства OPC UA.

### <a name="step-3-device-secured"></a>Шаг 3: Устройство защищено

Устройство OPC UA теперь готово к общению с другими устройствами OPC UA, защищенными сертификатами CA, без дальнейшей конфигурации.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как защитить устройства OPC UA, вы можете:

> [!div class="nextstepaction"]
> [Запуск службы безопасного управления сертификатами](howto-opc-vault-secure-ca.md)
