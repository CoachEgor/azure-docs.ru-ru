---
title: Защита обмена данными между устройствами OPC UA и хранилищем OPC в Azure | Документация Майкрософт
description: Как регистрировать приложения OPC UA и выдавать подписанные сертификаты приложений для устройств OPC UA с помощью хранилища OPC.
author: mregen
ms.author: mregen
ms.date: 8/16/2018
ms.topic: conceptual
ms.service: industrial-iot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: ae10bb3488c21b6637163e333231e95a18c652bf
ms.sourcegitcommit: 4b8a69b920ade815d095236c16175124a6a34996
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2019
ms.locfileid: "69996154"
---
# <a name="how-to-use-the-opc-vault-certificate-management-service"></a>Как использовать службу управления сертификатами хранилища OPC

В этой статье описывается регистрация приложений и выдача подписанных сертификатов приложений для устройств OPC UA.

## <a name="prerequisites"></a>Предварительные требования

### <a name="deploy-the-certificate-management-service"></a>Развертывание службы управления сертификатами

Прежде всего, служба должна быть развернута в облаке Azure.
Ознакомьтесь со статьей, в которой описывается [развертывание службы управления сертификатами хранилища OPC](howto-opc-vault-deploy.md).

### <a name="create-the-issuer-ca-certificate"></a>Создание сертификата ЦС издателя

Если вы еще не сделали этого, создайте сертификат ЦС поставщика.

Найдите статью, в которой описывается [Создание сертификата издателя для хранилища OPC и управление им](howto-opc-vault-manage.md).

## <a name="secure-opc-ua-applications"></a>Защита приложений OPC UA

### <a name="step-1-register-your-opc-ua-application"></a>Шаг 1. Регистрация приложения OPC UA 

> [!IMPORTANT]
> Для регистрации приложения требуется роль "Writer".

1. Откройте службу сертификатов по адресу `https://myResourceGroup-app.azurewebsites.net` и выполните вход.
2. Перейдите на страницу `Register New`.
1. Для регистрации приложения пользователю необходимо иметь по крайней мере назначенную роль "модуль записи".
2. Форма ввода соответствует соглашениям об именовании в мире OPC UA. Например, на рисунке ниже приведены параметры для примера [эталонного сервера OPC UA](https://github.com/OPCFoundation/UA-.NETStandard/tree/master/SampleApplications/Workshop/Reference) в OPC UA. Показан стек NetStandard:

   ![Регистрация эталонного сервера UA](media/howto-opc-vault-secure/reference-server-registration.png "Регистрация эталонного сервера UA")

5. Нажмите кнопку `Register` , чтобы зарегистрировать приложение в базе данных приложения службы сертификатов. Рабочий процесс непосредственно направляет пользователя к следующему шагу, чтобы запросить подписанный сертификат для приложения.

### <a name="step-2-secure-your-application-with-a-ca-signed-application-certificate"></a>Шаг 2. Защита приложения с помощью сертификата подписанного приложения ЦС

Приложение OPC UA можно защитить, выполнив подписанный сертификат на основе запроса подписи сертификата (CSR) или запросив новую пару ключей, которая также включает новый закрытый ключ в формате PFX или PEM. Следуйте документации устройства OPC UA, в котором поддерживается метод для вашего приложения. Как правило, рекомендуется использовать метод CSR, поскольку ему не требуется передавать закрытый ключ по сети.

- Если устройству требуется выдать новую пару ключей, следуйте указаниям [Step3a](##step-3a-request-a-new-certificate-with-a-new-keypair).
- Если устройство поддерживает запрос подписи сертификата (CSR), используйте [Step3b](#step-3b-request-a-new-certificate-with-a-csr).

### <a name="step-3a-request-a-new-certificate-with-a-new-keypair"></a>Шаг 3а. Запросить новый сертификат с помощью новой пары ключей

1. Перейдите на страницу `Applications`.
3. Запустите рабочий процесс запроса сертификата, выбрав `New Request` для указанного приложения.

   ![Запросить новый сертификат](media/howto-opc-vault-secure/request-new-certificate.png "Запросить новый сертификат")

3. Нажмите кнопку "запросить новую пару ключей и сертификат", чтобы запросить закрытый ключ и новый подписанный сертификат с открытым ключом для вашего приложения.

   ![Создать новую пару ключей](media/howto-opc-vault-secure/generate-new-key-pair.png "Создать новую пару ключей")

4. Заполните форму, указав тему, доменные имена и выберите PEM или PFX с паролем для закрытого ключа. Нажмите кнопку `Generate New Certificate` , чтобы создать запрос на сертификат.

   ![Утвердить сертификат](media/howto-opc-vault-secure/approve-reject.png "Утвердить сертификат")

5. Для шага утверждения требуется пользователь с ролью "Утверждающий" и разрешениями на подписывание в Azure Key Vault. В обычном рабочем процессе роль утверждающего и запрашивающего лица должны быть назначены разным пользователям.
6. Утвердите или отклоните запрос на сертификат для запуска или отмены фактического создания пары ключей и операции подписывания. Новая пара ключей создается и сохраняется безопасно в Azure Key Vault до тех пор, пока не будет загружена инициатором запроса сертификата. Полученный сертификат с открытым ключом подписывается центром сертификации. Для завершения этих операций может потребоваться несколько секунд.

   ![Просмотреть пару ключей](media/howto-opc-vault-secure/view-key-pair.png "Просмотреть пару ключей")

7. Полученный закрытый ключ (PFX или PEM) и сертификат (DER) можно скачать отсюда в формате, выбранном как Загрузка двоичных файлов. Версия с кодировкой base64 также доступна, например, для копирования вставки сертификата в командную строку или в текстовую запись. 
8. После скачивания и безопасного сохранения закрытого ключа его можно удалить из службы с помощью `Delete Private Key` кнопки. Сертификат с открытым ключом остается доступным для будущего использования.
9. Из-за использования сертификата, подписанного центром сертификации, также следует скачать сертификат ЦС и список отзыва сертификатов.
10. Теперь он зависит от устройства OPC UA, как применить новую пару ключей. Как правило, сертификат ЦС и список отзыва сертификатов копируются `trusted` в папку, а открытый и закрытый ключи сертификата приложения применяются `own` к папке в хранилище сертификатов. Некоторые устройства могут уже поддерживать принудительную отправку на сервер для обновлений сертификатов. См. документацию по устройству OPC UA.

### <a name="step-3b-request-a-new-certificate-with-a-csr"></a>Шаг 3b. Запрос нового сертификата с помощью CSR 

1. Перейдите на страницу `Applications`.
3. Запустите рабочий процесс запроса сертификата, выбрав `New Request` для указанного приложения.

   ![Запросить новый сертификат](media/howto-opc-vault-secure/request-new-certificate.png "Запросить новый сертификат")

3. Нажмите кнопку "запросить новый сертификат с запросом подписи", чтобы запросить новый подписанный сертификат для приложения.

   ![Создать новый сертификат](media/howto-opc-vault-secure/generate-new-certificate.png "Создать новый сертификат")

4. Отправьте CSR, выбрав локальный файл или вставляя CSR в кодировке Base64 в форме. Нажмите кнопку `Generate New Certificate` , чтобы создать запрос на сертификат.

   ![Утверждение CSR](media/howto-opc-vault-secure/approve-reject-csr.png "Утверждение CSR")

5. Для шага утверждения требуется пользователь с ролью "Утверждающий" и разрешениями на подписывание в Azure Key Vault. Утвердите или отклоните запрос на сертификат, чтобы запустить или отменить фактическую операцию подписи. Полученный сертификат с открытым ключом подписывается центром сертификации. Для завершения этой операции может потребоваться несколько секунд.

   ![Просмотр сертификата](media/howto-opc-vault-secure/view-cert-csr.png "Просмотр сертификата")

6. Полученный сертификат (DER) можно скачать отсюда в виде двоичного файла. Версия с кодировкой base64 также доступна, например, для копирования вставки сертификата в командную строку или в текстовую запись. 
10. После скачивания и безопасного сохранения сертификата его можно удалить из службы с помощью `Delete Certificate` кнопки.
11. Из-за использования сертификата, подписанного центром сертификации, также следует скачать сертификат ЦС и список отзыва сертификатов.
12. Теперь он зависит от устройства OPC UA, как применить новый сертификат. Как правило, сертификаты ЦС и CRL копируются в `trusted` папку, а сертификат приложения применяется `own` к папке в хранилище сертификатов. Некоторые устройства могут уже поддерживать принудительную отправку на сервер для обновлений сертификатов. См. документацию по устройству OPC UA.

### <a name="step-4-device-secured"></a>Шаг 4. Устройство защищено

Теперь устройство OPC UA готово к взаимодействии с другими устройствами OPC UA, защищенными сертификатами, подписанными ЦС, без дальнейшей настройки. Вот и все!


## <a name="next-steps"></a>Следующие шаги

Теперь, когда вы узнали, как защитить устройства OPC UA, предлагаем следующий шаг:

> [!div class="nextstepaction"]
> [Запуск службы безопасного управления сертификатами](howto-opc-vault-secure-ca.md)