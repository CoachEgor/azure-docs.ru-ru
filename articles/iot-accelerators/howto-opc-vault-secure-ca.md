---
title: Как безопасно управлять службой управления сертификатами OPC Vault - Azure Документы Майкрософт
description: Описывает, как безопасно управлять сертификатом OPC Vault в Azure, и просматривает другие рекомендации по безопасности, которые необходимо учитывать.
author: mregen
ms.author: mregen
ms.date: 8/16/2019
ms.topic: conceptual
ms.service: industrial-iot
services: iot-industrialiot
manager: philmea
ms.openlocfilehash: 88f8188779c5fb6b3cd07c67e9f35a6b8f9ad97d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79271711"
---
# <a name="run-the-opc-vault-certificate-management-service-securely"></a>Безопасное управление службой управления сертификатами OPC Vault

В этой статье объясняется, как безопасно управлять сертификатами OPC Vault в Azure, и рассматриваются другие рекомендации по безопасности для рассмотрения.

## <a name="roles"></a>Роли

### <a name="trusted-and-authorized-roles"></a>Доверенные и авторизованные роли

Микрослужба OPC Vault позволяет использовать различные функции для доступа к различным частям службы.

> [!IMPORTANT]
> Во время развертывания скрипт добавляет только пользователя, который запускает сценарий развертывания в качестве пользователя для всех ролей. Для развертывания производства следует просмотреть это назначение ролей и соответствующим образом настроить систему, следуя приведенным ниже рекомендациям. Эта задача требует ручного назначения ролей и служб на портале корпоративных приложений Azure Active Directory (Azure AD).

### <a name="certificate-management-service-roles"></a>Роли службы управления сертификатами

Микрослужба OPC Vault определяет следующие роли:

- **Reader**: По умолчанию любой аутентифицированный пользователь в арендаторе прочитал доступ. 
  - Прочитайте доступ к приложениям и запросам сертификатов. Можно перечислить и запрашивать заявки и запросы сертификатов. Также информация об обнаружении устройств и публичные сертификаты доступны с доступом к чтению.
- **Автор:** Роль писателя назначается пользователю для добавления разрешений на запись для определенных задач. 
  - Прочитайте/напишите доступ к приложениям и запросам сертификатов. Можно регистрировать, обновлять и отменить заявки. Можно создавать запросы на сертификаты и получать одобренные личные ключи и сертификаты. Можно также удалить личные ключи.
- **Утверждение**: Роль утверждая назначается пользователю для утверждения или отклонения запросов сертификатов. Роль не включает в себя никакой другой роли.
  - В дополнение к роли Одобрения для доступа к API микрослужбы OPC Vault, пользователь должен также иметь ключевое разрешение на подписание в Azure Key Vault, чтобы иметь возможность подписать сертификаты.
  - Роль писателя и утверждения должна быть назначена различным пользователям.
  - Основная роль Утверждение является утверждение поколения и отказ от запросов сертификата.
- **Администратор**: Роль администратора назначается пользователю для управления группами сертификатов. Роль не поддерживает роль Утверждения, но включает роль писателя.
  - Администратор может управлять группами сертификатов, менять конфигурацию и отзывать сертификаты приложений, выдавая новый список отзыва сертификатов (CRL).
  - В идеале роли писателя, утверждения и администратора назначаются разным пользователям. Для дополнительной безопасности пользователю с ролью «Утверждение или Администратор» также необходимо разрешение на подписание ключей в Key Vault, выдачу сертификатов или продление сертификата Ca эмитента.
  - В дополнение к роли администрирования микрослужб, роль включает в себя, но не ограничивается:
    - Ответственность за администрирование внедрения методов безопасности CA.
    - Управление генерацией, аннулирование и приостановление действия сертификатов. 
    - Криптографическое ключевое управление жизненным циклом (например, обновление ключей Ca эмитента).
    - Установка, конфигурация и обслуживание служб, работающих в Ца.
    - Повседневная работа служб. 
    - Резервное копирование и восстановление базы данных.

### <a name="other-role-assignments"></a>Другие ролевые задания

Также рассмотрим следующие роли при запуске службы:

- Бизнес-владелец договора о закупках сертификатов с внешним органом по сертификации корней (например, когда владелец покупает сертификаты у внешнего ЦА или управляет ЦА, который подчиняется внешнему CA).
- Разработка и проверка Сертификатного органа.
- Обзор аудиторских записей.
- Сотрудники, которые помогают поддерживать ЦС или управлять физическими и облачными объектами, но не получают прямого доверия для выполнения операций CA, выполняют *авторизованную* роль. Набор задач, которые допускаются к выполнению лицами, выполняемыми уполномоченными, также должен быть задокументирован.

### <a name="review-memberships-of-trusted-and-authorized-roles-quarterly"></a>Ежеквартально ежеквартально просматривает членство доверенных и авторизованных ролей

Просмотрите членство доверенных и уполномоченных ролей по крайней мере ежеквартально. Убедитесь, что набор людей (для ручных процессов) или идентификаторов служб (для автоматизированных процессов) в каждой роли сведен к минимуму.

### <a name="role-separation-between-certificate-requester-and-approver"></a>Разделение ролей между запрашивателем сертификатов и утверждателем

Процесс выдачи сертификата должен обеспечить разделение ролей между запрашивателем сертификата и ролями утверждая сертификата (лица или автоматизированные системы). Выдача сертификата должна быть санкционирована ролью правообладателя сертификата, который проверяет, что запрашиваемый сертификат уполномочен на получение сертификатов. Лица, которые имеют роль удостоверяющему сертификату, должны быть официально уполномоченным лицом.

### <a name="restrict-assignment-of-privileged-roles"></a>Ограничение назначения привилегированных ролей

Следует ограничить назначение привилегированных ролей, таких как разрешение на членство в группе Администраторов и Утверждений, ограниченным набором уполномоченных сотрудников. Любые привилегированные изменения ролей должны быть отменены в течение 24 часов. Наконец, ежеквартально проверяйте привилегированные назначения ролей и удалите все ненужные или просроченные назначения.

### <a name="privileged-roles-should-use-two-factor-authentication"></a>Привилегированные роли должны использовать двухфакторную аутентификацию

Используйте многофакторную аутентификацию (также называемую двухфакторной аутентификацией) для интерактивных всхыдок утверждений и администраторов службы.

## <a name="certificate-service-operation-guidelines"></a>Руководящие принципы обслуживания сертификатов

### <a name="operational-contacts"></a>Оперативные контакты

Служба сертификатов должна иметь в файле актуальную план реагирования на безопасность, содержащий подробные оперативные контакты реагирования на инциденты.

### <a name="security-updates"></a>Обновления для системы безопасности

Все системы должны постоянно контролироваться и обновляться с последними обновлениями безопасности.

> [!IMPORTANT]
> Репозиторий GitHub службы OPC Vault постоянно обновляется с помощью патчей безопасности. Отслеживайте эти обновления и регулярно применяйте их к службе.

### <a name="security-monitoring"></a>Мониторинг безопасности

Подпишитесь на или внедрите соответствующий мониторинг безопасности. Например, подписаться на решение центрального мониторинга (например, Центр безопасности Azure или решение мониторинга Office 365) и настроить его соответствующим образом, чтобы обеспечить передачу событий безопасности в решение мониторинга.

> [!IMPORTANT]
> По умолчанию служба OPC Vault развертывается с [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/devops) в качестве решения для мониторинга. Рекомендуется добавлять решение безопасности, такое как [Центр безопасности Azure.](https://azure.microsoft.com/services/security-center/)

### <a name="assess-the-security-of-open-source-software-components"></a>Оценка безопасности компонентов программного обеспечения с открытым исходным кодом

Все компоненты с открытым исходным кодом, используемые в продукте или службе, должны быть свободны от умеренных или больших уязвимостей безопасности.

> [!IMPORTANT]
> Во время непрерывной интеграции хранилища GitHub службы OPC Vault сканируют все компоненты на наличие уязвимостей. Отслеживайте эти обновления на GitHub и регулярно применяйте их к службе.

### <a name="maintain-an-inventory"></a>Ведение инвентаризации

Ведение инвентаризации активов для всех производственных узлов (включая постоянные виртуальные машины), устройств, всех внутренних диапазонов IP-адресов, VIP-персон и общедоступных доменных имен DNS. Всякий раз, когда вы добавляете или удаляете систему, IP-адрес устройства, VIP или общедоступный домен DNS, вы должны обновить инвентарь в течение 30 дней.

#### <a name="inventory-of-the-default-azure-opc-vault-microservice-production-deployment"></a>Инвентаризация развертывания производства микрослужбы Azure OPC Vault по умолчанию 

В Azure выполните следующее.
- **План обслуживания приложений**: План обслуживания приложений для узлов службы. По умолчанию S1.
- **Служба приложений** для микрослужбы: хозяин службы OPC Vault.
- **Служба приложений** для примерного применения: выборочный выборочный хост приложения OPC Vault.
- **Key Vault Standard**: Для хранения секретов и ключей Azure Cosmos DB для веб-сервисов.
- **Key Vault Premium:** для размещения ключей CA эмитента, для обслуживания подписи, а также для конфигурации хранилища и хранения личных ключей приложения.
- **Azure Cosmos DB**: База данных для запросов приложений и сертификатов. 
- **Приложение Исследования**: (необязательно) Мониторинг решения для веб-службы и приложения.
- **Регистрация приложений Azure AD**: Регистрация для образца приложения, службы и модуля края.

Для облачных служб должны быть задокументированы все имена узла, группы ресурсов, имена ресурсов, идентификации подписок и идентификаций клиентов, используемых для развертывания службы. 

В Azure IoT Edge или на локальном сервере IoT Edge:
- **МОДУЛЬ OPC Vault IoT Edge**: Для поддержки заводской сети OPC UA Global Discovery Server. 

Для устройств IoT Edge имена хоста и IP-адреса должны быть задокументированы. 

### <a name="document-the-certification-authorities-cas"></a>Документ сертификационных органов (CAs)

Документация иерархии CA должна содержать все управляемые CA. Это включает в себя все связанные с ними cA, родительские CA и корневые CAs, даже если они не управляются службой. Вместо официальной документации можно предоставить исчерпывающий набор всех неисчерпаемых сертификатов CA.

> [!NOTE]
> Образец приложения OPC Vault поддерживает загрузку всех сертификатов, используемых и подготовленных в службе документации.

### <a name="document-the-issued-certificates-by-all-certification-authorities-cas"></a>Документируйте выданные сертификаты всеми сертификационными органами (CAs)

Предоставьте исчерпывающий набор всех сертификатов, выданных за последние 12 месяцев.

> [!NOTE]
> Образец приложения OPC Vault поддерживает загрузку всех сертификатов, используемых и подготовленных в службе документации.

### <a name="document-the-standard-operating-procedure-for-securely-deleting-cryptographic-keys"></a>Документирование стандартной процедуры работы для безопасного удаляния криптографических ключей

В течение срока службы CA удаление ключей может происходить очень редко. Вот почему ни один пользователь не имеет Key Vault Certificate Удалить право назначен, и почему Есть нет AIS подвергаются удалению сертификата Ca эмитента. Ручная стандартная процедура эксплуатации для безопасного удаляемого криптографических ключей сертификационного органа доступна только при непосредственном доступе к Key Vault на портале Azure. Вы также можете удалить группу сертификатов в Key Vault. Чтобы обеспечить немедленное удаление, отключите функциональность [мягкого удаления Key Vault.](https://docs.microsoft.com/azure/key-vault/key-vault-ovw-soft-delete)

## <a name="certificates"></a>Сертификаты

### <a name="certificates-must-comply-with-minimum-certificate-profile"></a>Сертификаты должны соответствовать минимальному профилю сертификата

Служба OPC Vault — это онлайн-цП, который выдает абонентам сертификаты конечных сущностей. Микрослужба OPC Vault следует этим рекомендациям в реализации по умолчанию.

- Все сертификаты должны включать следующие поля X.509, как указано ниже:
  - Содержание поля версии должно быть v3. 
  - Содержимое поля serialNumber должно включать не менее 8 байтов энтропии, полученных из генератора случайных чисел FIPS (Federal Information Processing Standards) 140 утвержденных генераторов случайных чисел.<br>
    > [!IMPORTANT]
    > Серийный номер OPC Vault по умолчанию составляет 20 байтов и получен из шифрографического генератора случайных чисел операционной системы. Генератор случайных чисел FIPS 140 одобрен на устройствах Windows, но не на Linux. Рассмотрим это при выборе развертывания службы, использующее Linux VMs или контейнеры для докеров Linux, на которых не одобрена базовая технология OpenSSL.
  - Не должны присутствовать поля issuerUniqueID и subjectUniqueID.
  - Сертификаты конечных сущностей должны быть идентифицированы с расширением основных ограничений в соответствии с IETF RFC 5280.
  - Поле pathLenConstraint должно быть установлено до 0 для сертификата Выдачи CA. 
  - Расширение расширенного использования ключей должно присутствовать и содержать минимальный набор идентификаторов объектов расширенного использования ключей (OID). AnyExtendedKeyUsage OID (2.5.29.37.0) не должен быть указан. 
  - Расширение CRL Distribution Point (CDP) должно присутствовать в сертификате Эмитента CA.<br>
    > [!IMPORTANT]
    > Расширение CDP присутствует в сертификатах OPC Vault CA. Тем не менее, устройства OPC UA используют пользовательские методы для распространения CRLs.
  - Расширение доступа к информации органа должно присутствовать в сертификатах абонента.<br>
    > [!IMPORTANT]
    > Расширение доступа к информации органа присутствует в сертификатах абонента OPC Vault. Тем не менее, устройства OPC UA используют пользовательские методы для распространения информации эмитента CA.
- Должны использоваться утвержденные асимметричные алгоритмы, длина ключа, хэш-функции и режимы обивки.
  - RSA и SHA-2 являются единственными поддерживаемыми алгоритмами.
  - RSA может быть использован для шифрования, обмена ключами и подписи.
  - Шифрование RSA должно использовать только режимы обивки OAEP, RSA-KEM или RSA-PSS.
  - Требуются длина ключа, превышающее или равное 2048 битам.
  - Используйте семейство хэш-алгоритмов SHA-2 (SHA256, SHA384 и SHA512).
  - RSA Root CA ключи с типичной жизни больше, чем или равна 20 лет должно быть 4096 бит или больше.
  - RSA эмитент CA ключи должны быть не менее 2048 битов. Если срок действия сертификата CA истекает после 2030 года, ключ CA должен быть 4096 бит или больше.
- Срок службы сертификата
  - Сертификаты Root CA: Максимальный срок действия сертификата для корневых CAs не должен превышать 25 лет.
  - Сертификаты Sub CA или онлайн-эмитента CA: Максимальный срок действия сертификата для CAs, которые находятся в сети и выдают только сертификаты абонента, не должен превышать 6 лет. Для этих CAs, связанный частный ключ подписи не должен использоваться более 3 лет для выдачи новых сертификатов.<br>
    > [!IMPORTANT]
    > Сертификат эмитента, поскольку он генерируется в микрослужбе OPC Vault по умолчанию без внешнего Root CA, рассматривается как онлайн-Sub CA с соответствующими требованиями и сроками службы. Срок действия по умолчанию установлен на 5 лет, а длина ключа превышает или равна 2048 году.
  - Все асимметричные ключи должны иметь максимальный 5-летний срок службы и рекомендуемый 1-летний срок службы.<br>
    > [!IMPORTANT]
    > По умолчанию срок службы сертификатов приложений, выданных OPC Vault, имеет срок службы 2 года и должен заменяться каждый год. 
  - Всякий раз, когда сертификат обновляется, он обновляется с новым ключом.
- Расширения OPC UA-специфические в сертификатах экземпляров приложений
  - В темуAltName расширение включает в себя приложение Uri и хосты. Они также могут включать адреса F-DN, IPv4 и IPv6.
  - KeyUsage включает в себя цифровуюподпись, неотказ, keyEncipherment и dataEncipherment.
  - ExtendedKeyUsage включает в себя serverAuth и clientAuth.
  - Авторитет, указанный в подписанных сертификатах.

### <a name="ca-keys-and-certificates-must-meet-minimum-requirements"></a>Ключи и сертификаты CA должны соответствовать минимальным требованиям

- **Частные ключи**: RSA ключи должны быть не менее 2048 битов. Если срок действия сертификата CA истекает после 2030 года, ключ CA должен быть 4096 бит или больше.
- **Срок службы**: Максимальный срок действия сертификата для CAs, которые находятся в сети и выдают только сертификаты абонента, не должен превышать 6 лет. Для этих CAs, связанный частный ключ подписи не должен использоваться более 3 лет для выдачи новых сертификатов.

### <a name="ca-keys-are-protected-using-hardware-security-modules"></a>Ключи CA защищены с помощью модулей аппаратной безопасности

OpcVault использует Azure Key Vault Premium, а ключи защищены модулями безопасности оборудования FIPS 140-2 уровня (HSM). 

Криптографические модули, которые использует Key Vault, будь то HSM или программное обеспечение, проверяются FIPS. Ключи, созданные или импортируемые под защиту HSM, обрабатываются внутри HSM, проверяются на FIPS 140-2 Level 2. Ключи, созданные или импортированные в качестве защищенных от программного обеспечения, обрабатываются внутри криптографических модулей, проверенных на уровне 1 FIPS 1.

## <a name="operational-practices"></a>Оперативная практика

### <a name="document-and-maintain-standard-operational-pki-practices-for-certificate-enrollment"></a>Документирование и поддержание стандартных оперативных практик PKI для регистрации сертификатов

Документирование и поддержание стандартных оперативных процедур (SOP) для того, как CAs выдавать сертификаты, в том числе: 
- Как идентифицируется и проверяется подлинность абонента. 
- Как обрабатывается и проверяется запрос на сертификацию сертификата (если это применимо, включите также способ обработки запросов на продление сертификата и запросы на повторное использование). 
- Как выданные сертификаты распределяются среди подписчиков. 

Микрослужба OPC Vault SOP описана в [архитектуре OPC Vault](overview-opc-vault-architecture.md) и [управляет сервисом сертификатов OPC Vault.](howto-opc-vault-manage.md) Практики следуют "OPC Единой архитектуры Спецификация Часть 12: Открытие и глобальных услуг".


### <a name="document-and-maintain-standard-operational-pki-practices-for-certificate-revocation"></a>Документирование и поддержание стандартных оперативных практик PKI для отзыва сертификатов

Процесс отзыва сертификата описан в [архитектуре OPC Vault](overview-opc-vault-architecture.md) и [управляет службой сертификатов OPC Vault.](howto-opc-vault-manage.md)
    
### <a name="document-ca-key-generation-ceremony"></a>Церемония вручения документов CA по ключевому поколению 

Генерация ключей Эмитента CA в микросервисе OPC Vault упрощается из-за безопасного хранения в Azure Key Vault. Для получения дополнительной информации [см.](howto-opc-vault-manage.md)

Однако, когда вы используете внешний орган сертификации Root, церемония генерации ключей CA должна соответствовать следующим требованиям.

Церемония генерации ключевых элементов CA должна быть выполнена в соответствии с задокументированным скриптом, который включает по крайней мере следующие элементы: 
- Определение ролей и обязанностей участников.
- Утверждение для проведения церемонии ключевого поколения CA.
- Криптографическое оборудование и материалы активации, необходимые для церемонии.
- Подготовка оборудования (включая обновление информации об активах/конфигурации и выподписание).
- Установка операционной системы.
- Конкретные шаги, выполненные во время церемонии генерации ключевых поколений CA, такие как: 
  - Установка и конфигурация приложения CA.
  - CA генерации ключей.
  - Резервное копирование ключа CA.
  - Подписание сертификата CA.
  - Импорт подписанных ключей в защищенном HSM службы.
  - Выключение системы CA.
  - Подготовка материалов для хранения.


## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как безопасно управлять OPC Vault, вы можете:

> [!div class="nextstepaction"]
> [Безопасные устройства OPC UA с OPC Vault](howto-opc-vault-secure.md)
