---
title: 'Azure: действие электронной почты с использованием удаленного мониторинга | Документация Майкрософт'
description: В этом руководстве показано, как добавить действие электронной почты в новое или существующее правило.
author: asdonald
manager: hegate
ms.author: asdonald
ms.service: iot-accelerators
services: iot-accelerators
ms.date: 11/12/2018
ms.topic: conceptual
ms.openlocfilehash: fbb5f92258ff31dd7077bb1ade7fa7e5644c8bac
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65466952"
---
# <a name="add-an-email-action"></a>Добавление действия электронной почты

Действие электронной почты поможет никогда не пропускать оповещения. Действие электронной почты можно добавить к существующему правилу или при создании нового правила.

Для выполнения шагов, указанных в этом руководстве, вам понадобится развернутый экземпляр акселератора решения для удаленного мониторинга в подписке Azure.

Создать или изменить правило вы можете, только если у вас есть роль [**администратора** или соответствующие разрешения](iot-accelerators-remote-monitoring-rbac.md).

## <a name="edit-an-existing-rule"></a>Изменение имеющегося правила

Выполните указанные ниже шаги, чтобы добавить действие электронной почты к существующему правилу.

1. Перейдите к своему решению для удаленного мониторинга.

1. На **панели мониторинга** перейдите к странице **Правила**.

    ![Страница "Правила"](./media/iot-accelerators-remote-monitoring-email-actions/rules-email.png)

1. Установите флажок напротив существующего правила, которое нужно изменить, и нажмите кнопку **Изменить** вверху. Появится панель **Правило**, где можно внести изменение.

1. В разделе **Действие** переведите переключатель **Электронная почта включена** в положение **включения**.

1. При первом включении действия электронной почты в акселераторе решений необходимо [войти в Outlook](#outlook).

1. Введите электронный адрес в поле получателя. Для ввода каждого адреса нажимайте клавишу **ENTER**.

    ![Запись адреса](./media/iot-accelerators-remote-monitoring-email-actions/address-email.png)

1. Введите тему сообщения.

1. Введите дополнительные примечания для получателей электронной почты в виде обычного текста. При [изменении шаблона электронной почты](#htmledit) можно использовать форматирование HTML.

1. Убедитесь, что для параметра **Состояние правила** установлено значение **Включено**.

1. Нажмите кнопку **Применить**.

## <a name="create-a-new-rule"></a>Создание нового правила

Выполните указанные ниже шаги, чтобы добавить действие электронной почты при создании нового правила.

1. Перейдите к своему решению для удаленного мониторинга.

1. На **панели мониторинга** перейдите к странице **Правила**.

    ![Страница "Правила"](./media/iot-accelerators-remote-monitoring-email-actions/rules-email.png)

1. Выполняйте шаги, описанные в пункте [Создание раздела правила](iot-accelerators-remote-monitoring-automate.md#create-a-rule). Выполните шаги, указанные в разделе [Создание расширенного правила](iot-accelerators-remote-monitoring-automate.md#create-an-advanced-rule), до момента установки значения для параметра **Уровень серьезности**. Не нажимайте **Применить**.

1. В разделе **Действие** переведите переключатель **Электронная почта включена** в положение **включения**.

1. При первом включении действия электронной почты в акселераторе решений необходимо [войти в Outlook](#outlook).

1. Введите электронный адрес в поле получателя. Для ввода каждого адреса нажимайте клавишу **ENTER**.

    ![Запись адреса](./media/iot-accelerators-remote-monitoring-email-actions/address-email.png)

1. Введите тему сообщения.

1. Введите дополнительные примечания для получателей электронной почты в виде обычного текста. При [изменении шаблона электронной почты](#htmledit) можно использовать форматирование HTML.

1. Убедитесь, что для параметра **Состояние правила** установлено значение **Включено**.

1. Нажмите кнопку **Применить**.

После этого правило с действием электронной почты будет включено. Каждый раз, когда запускается действие, получателям отправляется новое электронное сообщение.

## Вход в Outlook <a name="outlook"></a>

При первом включении действия электронной почты в акселераторе решений необходимо войти в Outlook. Это действие настраивает учетную запись электронной почты, с которой отправляются уведомления по электронной почте.

> [!NOTE]
> Необходимо создать специальную учетную запись Outlook только для уведомлений акселератора решений и использовать эту учетную запись при включении первого действия электронной почты.

### <a name="contributor-role-outlook-setup"></a>Настройка Outlook для роли участника

Если кто-то с ролью **участника** в подписке развернул акселератор решений, приложение не имеет достаточных разрешений для установки и проверки действий электронной почты через веб-интерфейс.

Прежде чем начать, создайте учетную запись Outlook для отправки уведомлений по электронной почте из акселератора решений.

Ниже показано, как настроить и проверить действия электронной почты вручную.

1. Перейдите на [портал Azure](https://portal.azure.com).

1. Перейдите к группе ресурсов для акселератора решений.

1. Выберите **office365-connector**:

    ![API подключения](./media/iot-accelerators-remote-monitoring-email-actions/apiconnector1.png)

1. Щелкните баннер, чтобы начать процесс авторизации:

    ![Авторизация](./media/iot-accelerators-remote-monitoring-email-actions/connector1.png)

1. Щелкните **Авторизовать**. Вам будет предложено выполнить вход. Для учетной записи, которую вы используете для входа, должен быть указан электронный адрес, который используется приложением для отправки уведомлений по электронной почте.

    ![Кнопка "Авторизовать"](./media/iot-accelerators-remote-monitoring-email-actions/authorize.png)

1. В нижней части щелкните **Сохранить**. Если баннер исчез, авторизация прошла успешно.

1. Чтобы изменить электронный адрес, с которого будут посылаться уведомления, нажмите **Правка подключения API**.

    ![Изменение электронного адреса](./media/iot-accelerators-remote-monitoring-email-actions/editemail1.png)

### <a name="owner-role-outlook-setup"></a>Настройка Outlook для роли владельца

Если кто-то с ролью **владельца** в подписке развернул акселератор решений, приложение может проверить правильность настройки действий электронной почты через веб-интерфейс.

Прежде чем начать, создайте учетную запись Outlook для отправки уведомлений по электронной почте из акселератора решений.

Следующие шаги позволяют выполнить вход и настроить действия электронной почты:

1. Щелкните для входа в Outlook. Вас перенаправят на портал Azure:

   ![Вход в Outlook](./media/iot-accelerators-remote-monitoring-email-actions/owneroutlook-email.png)

1. Щелкните **Авторизовать**. Вам будет предложено выполнить вход. Для учетной записи, которую вы используете для входа, должен быть указан электронный адрес, который используется приложением для отправки уведомлений по электронной почте.

1. Выберите команду **Сохранить**. Вернитесь к акселератору решений и обновите страницу.

1. Если вы успешно настроили уведомления по электронной почте, отобразится это сообщение:

   ![Вход в Outlook выполнен успешно](./media/iot-accelerators-remote-monitoring-email-actions/success-email.png)

## Настройте HTML для электронной почты <a name="htmledit"></a>

Готовый акселератор решения для удаленного мониторинга содержит базовый шаблон HTML для действий электронной почты. Шаблон электронной почты использует значения из параметров действия электронной почты. Ниже приведен пример.

![Пример электронного сообщения](./media/iot-accelerators-remote-monitoring-email-actions/emailtemplate1.png)

Ниже показано, как изменить шаблон электронной почты HTML. Например, можно включить дополнительные сведения или добавить пользовательские изображения.

1. Клонируйте репозиторий удаленного мониторинга Java или .NET на GitHub.

1. Перейдите к расположению шаблона электронного сообщения:
  
    `Dotnet: device-telemetry\ActionsAgent\data\EmailTemplate.html`
  
    `Java device-telemetry/app/resources/data/EmailTemplate.html`

1. Для изменения сообщения можно добавлять параметры к этому шаблону или удалять их из него. Можно также добавить, удалить или заменить вызовы при необходимости.

    Например, в коде .NET: `emailTemplate = emailTemplate.Replace("${subject}", emailAction.GetSubject());`

    Например, в коде Java: `this.emailTemplate.replace("${subject}", emailAction.GetSubject());`

1. Параметры в шаблоне имеют форму `${...}`. Чтобы удалить параметр, удалите необходимую строку. Чтобы добавить параметр, добавьте строку со значением для вставки.

1. Чтобы добавить изображения или пользовательский текст, обновите файл EmailTemplate.HTML напрямую.

## <a name="throttling"></a>Регулирование

Акселератор решения для удаленного мониторинга использует Outlook для отправки уведомлений по электронной почте. Outlook ограничивает количество отправляемых электронных сообщений, допуская не более [30 в 1 минуту](https://docs.microsoft.com/office365/servicedescriptions/exchange-online-service-description/exchange-online-limits#receiving-and-sending-limits). Клиенты электронной почты, получающие электронные сообщения, могут также регулировать количество сообщений, получаемых за одну минуту. Проверьте ограничения для определенного клиента электронной почты. При настройке для правила уведомлений по электронной почте правило должно рассчитывать средние значения в течение по крайней мере одной минуты и не использовать мгновенных значений.

![Расчет среднего значения](./media/iot-accelerators-remote-monitoring-email-actions/calculation-email.png)

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве показано, как добавить действие электронной почты в новое или существующее правило в рамках решения для удаленного мониторинга. Руководство также показывает, как изменить код HTML, который определяет формат сообщения.

Предлагаемый следующий шаг — узнать, [как использовать оповещения и устранять проблемы с устройством](iot-accelerators-remote-monitoring-maintain.md).
