---
title: Поиск местоположения с помощью служб поиска Azure Maps Карты Microsoft Azure
description: В этой статье вы узнаете, как искать местоположение с помощью службы поиска Microsoft Azure Maps для геокодирования и обратного геокодирования.
author: philmea
ms.author: philmea
ms.date: 01/15/2020
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.openlocfilehash: cf0e5267885df1ace51271c53bb2d68ee5002f00
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80335427"
---
# <a name="search-for-a-location-using-azure-maps-search-services"></a>Поиск местоположения с помощью служб поиска Azure Maps

[Служба поиска](https://docs.microsoft.com/rest/api/maps/search) Карт Azure — это набор API RESTful, предназначенных для поиска адресов, мест, бизнес-списков по имени или категории и другой географической информации. В дополнение к поддержке традиционного геокодирования, службы могут также переворачивать адреса геокодов и пересекать улицы в зависимости от широт и долготы. Значения широты и долготы, возвращенные поиском, могут быть использованы в качестве параметров в других службах Azure Maps, таких как [Route](https://docs.microsoft.com/rest/api/maps/route) и [Weather](https://docs.microsoft.com/rest/api/maps/weather) services.

В этой статье вы узнаете, как:

* Запрос координат широты и долготы для адреса (местоположение адреса геокода) с помощью [API адресного адреса поиска]( https://docs.microsoft.com/rest/api/maps/search/getsearchaddress)
* Поиск адреса или точки интереса (POI) с помощью [API поиска нечеткой](https://docs.microsoft.com/rest/api/maps/search/getsearchfuzzy)
* Поиск адреса наряду с свойствами и координатами
* Сделайте [обратный поиск адреса](https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse) для перевода координировать местоположение на адрес улицы
* Поиск перекрестной улицы с помощью [Search Address Обратный Крест-стрит API](https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreversecrossstreet)

## <a name="prerequisites"></a>Предварительные требования

Для выполнения шагов в этой статье необходимо сначала создать учетную запись Azure Maps и получить ключ подписки на учетную запись. Следуйте инструкциям в [создании учетной записи](quick-demo-map-app.md#create-an-account-with-azure-maps) для создания подписки на учетную запись Azure Maps и следуйте инструкциям по [созданию основного ключа](quick-demo-map-app.md#get-the-primary-key-for-your-account) для получения основного ключа для вашей учетной записи. Дополнительные сведения о проверке подлинности в Azure Maps см. в [этой статье](./how-to-manage-authentication.md).

В этой статье для создания вызовов REST используется [приложение Postman](https://www.getpostman.com/apps). Вы можете использовать любую среду разработки API.

## <a name="request-latitude-and-longitude-for-an-address-geocoding"></a>Запрос широты и долготы для адреса (геокодирование)

В этом примере мы используем Azure Maps [Get Search Address API](https://docs.microsoft.com/rest/api/maps/search/getsearchaddress) для преобразования адреса улиц в координаты широты и долготы. Вы можете передать полный или частичный адрес улицы API и получить ответ, который включает в себя подробные адресные свойства, такие как улица, почтовый индекс и страна/регион, а также позиционные значения в широте и долготе.

Если у вас есть набор адресов для геокода, можно использовать [API Post Search Address Batch](https://docs.microsoft.com/rest/api/maps/search/postsearchaddressbatch) для отправки пакета запросов в одном вызове API.

1. В Postman, нажмите **Новый запрос** | **GET запрос** и имя его адрес **поиска**.

2. На вкладке Builder (Конструктор) выберите метод HTTP **GET**, введите URL-адрес запроса для конечной точки API и выберите протокол авторизации, если он используется.

![Поиск адреса](./media/how-to-search-for-address/address_search_url.png)

| Параметр | Рекомендуемое значение |
|---------------|------------------------------------------------| 
| Метод HTTP | GET |
| Request URL (URL-адрес запроса) | [https://atlas.microsoft.com/search/address/json?](https://atlas.microsoft.com/search/address/json?) | 
| Авторизация | No Auth (Без авторизации) |

3. Щелкните **Params** (Параметры) и введите следующие пары "ключ — значение", которые будут использоваться в качестве параметров запроса или пути в URL-адресе запроса: 

![Поиск адреса](./media/how-to-search-for-address/address_search_params.png) 

| Ключ | Значение | 
|------------------|-------------------------| 
| api-version | 1.0 | 
| subscription-key | \<Ваш ключ службы "Карты Azure"\> | 
| query | Броад Стрит 400, Сиэтл, штат Вашингтон, 98109 | 

4. Щелкните **Send** (Отправить), а затем просмотрите текст ответа. 

В этом случае указан запрос с полным адресом и получен один результат в тексте ответа. 

5. В разделе Params (Параметры) замените строку запроса следующим значением. 

    ```plaintext 
        400 Broad, Seattle 
    ``` 

6. Добавьте следующую пару "ключ-значение" в раздел **Параметры** и нажмите кнопку **Отправить**: 

| Ключ | Значение | 
|-----|------------| 
| typeahead | Да | 

Флажок **typeahead** сообщает API поиска адреса, что нужно обработать запрос как частичные входные данные и вернуть массив прогнозных значений.

## <a name="using-fuzzy-search-api"></a>Использование API поиска нечеткой

[API поиска Azure Maps Fuzzy](https://docs.microsoft.com/rest/api/maps/search/getsearchfuzzy) рекомендуется использовать, если вы не знаете, что ваш пользователь вводит для поискового запроса. API сочетает в себе поиск точки интереса (POI) и геокодирование в канонический «однолинейный поиск». Например, API-интерфейс может обрабатывать входные данные любой комбинации адреса или токена POI. Ему также можно назначить взвешенное значение с помощью контекстно-зависимой позиции (пары широты или долготы), полностью ограничить с помощью координат и радиуса, а также выполнить без точки привязки геосмещения.

Большинство запросов службы поиска по умолчанию имеют значение `maxFuzzyLevel=1` для улучшения производительности и уменьшения количества необычных результатов. Это значение по умолчанию можно переопределить в зависимости от запроса, используя параметр запроса `maxFuzzyLevel=2` или `3`.

### <a name="search-for-an-address-using-fuzzy-search"></a>Поиск адреса с помощью поиска нечетких соответствий

1. Откройте приложение Postman, в раскрывающемся списке New (Создать) щелкните Create New (Создать) и выберите **запрос GET**. Введите название запроса **поиска нечетких соответствий**, выберите коллекцию или папку, в которую нужно его сохранить, и щелкните **Save** (Сохранить).

2. На вкладке Builder (Конструктор) выберите метод HTTP **GET** и введите URL-адрес запроса для конечной точки API.

    ![Поиск нечетких соответствий](./media/how-to-search-for-address/fuzzy_search_url.png)

    | Параметр | Рекомендуемое значение |
    |---------------|------------------------------------------------|
    | Метод HTTP | GET |
    | Request URL (URL-адрес запроса) | [https://atlas.microsoft.com/search/fuzzy/json?](https://atlas.microsoft.com/search/fuzzy/json?) |
    | Авторизация | No Auth (Без авторизации) |

    Атрибут **json** в URL-адресе пути определяет формат ответа. В этой статье используется Json для удобства использования и читаемости. Доступные форматы ответа в определении **метода Get поиска нечетких соответствий** можно найти в [справочнике по функциональным API службы Maps](https://docs.microsoft.com/rest/api/maps/search/getsearchfuzzy).

3. Щелкните **Params** (Параметры) и введите следующие пары "ключ — значение", которые будут использоваться в качестве параметров запроса или пути в URL-адресе запроса:

    ![Поиск нечетких соответствий](./media/how-to-search-for-address/fuzzy_search_params.png)

    | Ключ | Значение |
    |------------------|-------------------------|
    | api-version | 1.0 |
    | subscription-key | \<Ваш ключ службы "Карты Azure"\> |
    | query | пицца |

4. Щелкните **Send** (Отправить), а затем просмотрите текст ответа.

    Двусмысленная строка запроса для "пиццы" вернула [10-процентный результат](https://docs.microsoft.com/rest/api/maps/search/getsearchpoi#searchpoiresponse) (POI) как в категориях "пицца", так и "ресторан". Каждый результат возвращает адрес улицы, значения широты и долготы, порт представления и точки входа для местоположения.
  
    Результаты для этого запроса различны и не связаны с конкретным эталонным расположением. Вы можете использовать параметр **countrySet,** чтобы указать только страны/регионы, для которых ваша заявка нуждается в охвате. Поведение по умолчанию заключается в поиске по всему миру, потенциально возвращающ ненужные результаты.

5. Добавьте следующую пару "ключ-значение" в раздел **Параметры** и нажмите кнопку **Отправить**:

    | Ключ | Значение |
    |------------------|-------------------------|
    | countrySet | США |
  
    Теперь результаты ограничены кодом страны и запрос возвращает адреса пиццерий в США.
  
    Для получения результатов для указанного места можно запрашивать точку интереса и использовать возвращаемое значение широты и долготы в вызове службы поиска нечетких соответствий. В этом случае служба поиска использовалась для возврата местоположения Space Needle (Сиэтл) и применялись значения широты и долготы, чтобы ориентировать поиск.
  
6. В разделе Params (Параметры) введите следующие пары "ключ — значение" и щелкните **Send** (Отправить).

    ![Поиск нечетких соответствий](./media/how-to-search-for-address/fuzzy_search_latlon.png)
  
    | Ключ | Значение |
    |-----|------------|
    | lat | 47,620525 |
    | lon | –122,349274 |


## <a name="search-for-a-street-address-using-reverse-address-search"></a>Поиск улицы и номера дома с использованием обратного поиска адреса

Azure Maps [Get Search Address Обратный API]( https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse) помогает перевести координаты (пример: 37.786505, -122.3862) в понятный для человека адрес улицы. Чаще всего это необходимо в приложениях для отслеживания, где вы получаете GPS-канал с устройства или актива и хотите знать, по какому адресу находится координат.
Если у вас есть набор координат для обратного геокода, вы можете использовать [Post Search Address Reverse Batch API](https://docs.microsoft.com/rest/api/maps/search/postsearchaddressreversebatch) для отправки пакета запросов в одном вызове API.


1. В Postman, нажмите **Новый запрос** | **GET запрос** и назвать его **Обратный адрес поиска**.

2. На вкладке Builder (Конструктор) выберите метод HTTP **GET** и введите URL-адрес запроса для конечной точки API.
  
    ![URL-адрес обратного поиска адреса](./media/how-to-search-for-address/reverse_address_search_url.png)
  
    | Параметр | Рекомендуемое значение |
    |---------------|------------------------------------------------|
    | Метод HTTP | GET |
    | Request URL (URL-адрес запроса) | [https://atlas.microsoft.com/search/address/reverse/json?](https://atlas.microsoft.com/search/address/reverse/json?) |
    | Авторизация | No Auth (Без авторизации) |
  
3. Щелкните **Params** (Параметры) и введите следующие пары "ключ — значение", которые будут использоваться в качестве параметров запроса или пути в URL-адресе запроса:
  
    ![Параметры обратного поиска адреса](./media/how-to-search-for-address/reverse_address_search_params.png)
  
    | Ключ | Значение |
    |------------------|-------------------------|
    | api-version | 1.0 |
    | subscription-key | \<Ваш ключ службы "Карты Azure"\> |
    | query | 47,591180, –122,332700 |
  
4. Щелкните **Send** (Отправить), а затем просмотрите текст ответа.

    Ответ включает основные сведения об адресе Safeco Field.
  
5. Добавьте следующую пару "ключ-значение" в раздел **Параметры** и нажмите кнопку **Отправить**:

    | Ключ | Значение |
    |-----|------------|
    | number | Да |

    Если параметр запроса [номера](https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse) отправляется с запросом, ответ может включать сторону улицы (слева или справа), а также смещение позиции для этого числа.
  
6. Добавьте следующую пару "ключ-значение" в раздел **Параметры** и нажмите кнопку **Отправить**:

    | Ключ | Значение |
    |-----|------------|
    | returnSpeedLimit | Да |
  
    При установке параметра запроса [returnSpeedLimit](https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse) ответ возвращает вывешенное ограничение скорости.

7. Добавьте следующую пару "ключ-значение" в раздел **Параметры** и нажмите кнопку **Отправить**:

    | Ключ | Значение |
    |-----|------------|
    | returnRoadUse | Да |

    Если задан параметр запроса [returnRoadUse](https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse), в ответе возвращается массив использования пути для обратных геокодов на уровне улицы.

8. Добавьте следующую пару "ключ-значение" в раздел **Параметры** и нажмите кнопку **Отправить**:

    | Ключ | Значение |
    |-----|------------|
    | roadUse | Да |

    Можно ограничить обратный запрос геокода определенным типом дороги с помощью параметра [запроса roadUse.](https://docs.microsoft.com/rest/api/maps/search/getsearchaddressreverse)
  
## <a name="search-for-cross-street-using-reverse-address-cross-street-search"></a>Поиск перекрестной улицы с помощью Обратный адрес Кросс-стрит Поиск

1. В Postman, нажмите **Новый запрос** | **GET запрос** и назвать его **Обратный адрес Кросс-стрит Поиск**.

2. На вкладке Builder (Конструктор) выберите метод HTTP **GET** и введите URL-адрес запроса для конечной точки API.
  
    ![Обратный поиск адреса для пересекающей улицы](./media/how-to-search-for-address/reverse_address_search_url.png)
  
    | Параметр | Рекомендуемое значение |
    |---------------|------------------------------------------------|
    | Метод HTTP | GET |
    | Request URL (URL-адрес запроса) | [https://atlas.microsoft.com/search/address/reverse/crossstreet/json?](https://atlas.microsoft.com/search/address/reverse/crossstreet/json?) |
    | Авторизация | No Auth (Без авторизации) |
  
3. Щелкните **Params** (Параметры) и введите следующие пары "ключ — значение", которые будут использоваться в качестве параметров запроса или пути в URL-адресе запроса:
  
    | Ключ | Значение |
    |------------------|-------------------------|
    | api-version | 1.0 |
    | subscription-key | \<Ваш ключ службы "Карты Azure"\> |
    | query | 47,591180, –122,332700 |
  
4. Щелкните **Send** (Отправить), а затем просмотрите текст ответа.

## <a name="next-steps"></a>Дальнейшие действия

- Изучите [документацию Azure Maps Search Service REST API.](https://docs.microsoft.com/rest/api/maps/search)
- Узнайте о [рекомендациях службы поиска Azure Maps](https://docs.microsoft.com/azure/azure-maps/how-to-use-best-practices-for-search) и о том, как оптимизировать запросы.
