---
title: Руководство по Создание геозоны и отслеживание устройств в Microsoft Azure Maps
description: Сведения о настройке геозоны и отслеживании устройств относительно геозоны с помощью службы пространственных данных Microsoft Azure Maps.
author: anastasia-ms
ms.author: v-stharr
ms.date: 7/15/2020
ms.topic: tutorial
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.custom: mvc
ms.openlocfilehash: 775d98b992f2bca4441c868873ceaeb2389db81a
ms.sourcegitcommit: 3543d3b4f6c6f496d22ea5f97d8cd2700ac9a481
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/20/2020
ms.locfileid: "86517398"
---
# <a name="tutorial-set-up-a-geofence-by-using-azure-maps"></a>Руководство по Настройка геозоны с использованием Azure Maps

В этом руководстве показано, как создавать и использовать службы геозон в Azure Maps для следующего сценария.

*Руководителю строительного объекта нужно отслеживать оборудование, которое пересекает периметр строительной зоны в любую сторону. Всякий раз, когда оборудование прибывает в зону или покидает ее, руководителю будет отправляться уведомление по электронной почте.*

Azure Maps предоставляет несколько служб, которые помогут отслеживать оборудование, прибывающее в зону строительства и покидающее ее, как в описанном выше сценарии. Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Отправка [данных о геозонах в формате GeoJSON](geofence-geojson.md), которые определяют отслеживаемую строительную зону. Мы применим [API отправки данных](https://docs.microsoft.com/rest/api/maps/data/uploadpreview) для передачи геозон в виде координат многоугольника в учетную запись Azure Maps.
> * Настройка двух активируемых [приложений логики](https://docs.microsoft.com/azure/event-grid/handler-webhooks#logic-apps), которые отправляют по электронной почте уведомления руководителю строительного объекта при пересечении оборудованием границ геозоны.
> * Применение [Сетки событий Azure](https://docs.microsoft.com/azure/event-grid/overview) для подписки на события входа в геозону Azure Maps и выхода из нее. Мы настроим две подписки на события веб-перехватчиков, которые будут вызывать конечные точки HTTP, определенные в этих двух приложениях логики. После этого Logic Apps будет отправлять уведомления по электронной почте о входе оборудования в геозону и выходе из нее.
> * Применение [API поиска по геозоне](https://docs.microsoft.com/rest/api/maps/spatial/getgeofence) для получения уведомлений о пересечении оборудованием границ геозоны.

## <a name="prerequisites"></a>Предварительные требования

1. [Создайте учетную запись службы Azure Maps](quick-demo-map-app.md#create-an-azure-maps-account)
2. [Получите первичный ключ подписки](quick-demo-map-app.md#get-the-primary-key-for-your-account), который иногда называется первичным ключом или ключом подписки.

В этом руководстве используется приложение [Postman](https://www.postman.com/), но вы можете выбрать другую среду разработки API.

## <a name="upload-geofencing-geojson-data"></a>Отправка данных о геозоне в формате GeoJSON

В этом руководстве показано, как отправить данные о геозоне в формате JSON с коллекцией `FeatureCollection`. `FeatureCollection` определяет две геозоны в виде многоугольников на строительном объекте. Для первой геозоны какие-либо ограничения, включая временные, отсутствуют. Вторая доступна для запросов только в рабочее время (с 9:00 по 17:00 по тихоокеанскому времени) и станет недействительной после 1 января 2022 г. См. сведения о [формате данных GeoJSON](geofence-geojson.md).

>[!TIP]
>Вы можете в любое время изменить сведения о геозонах. См. сведения об обновлении этих данных в документации [по API отправки данных](https://docs.microsoft.com/rest/api/maps/data/uploadpreview).

1. Откройте приложение Postman. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Collection** (Коллекция).  Присвойте имя коллекции и нажмите кнопку **Создать**.

2. Чтобы создать запрос, нажмите кнопку **Создать** еще раз. В окне **Create New** (Создание) выберите **Request** (Запрос). Введите **Имя запроса** для запроса. Выберите коллекцию, созданную на предыдущем шаге, а затем нажмите кнопку **Сохранить**.

3. Выберите HTTP-метод **POST** на вкладке построителя и введите следующий URL-адрес, чтобы отправить данные о геозоне в службу Azure Maps. Для этого запроса и других запросов, упомянутых в этой статье, замените `{Azure-Maps-Primary-Subscription-key}` первичным ключом подписки.

    ```HTTP
    https://atlas.microsoft.com/mapData/upload?subscription-key={Azure-Maps-Primary-Subscription-key}&api-version=1.0&dataFormat=geojson
    ```

    Параметр _geojson_ в URL-адресе определяет формат отправляемых данных.

4. Щелкните вкладку **Body** (Текст). Выберите формат входных данных **raw** (Необработанные) и **JSON**. Скопируйте и вставьте следующие данные GeoJSON в текстовую область **Body** (Текст).

   ```JSON
   {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  -122.13393688201903,
                  47.63829579223815
                ],
                [
                  -122.13389128446579,
                  47.63782047131512
                ],
                [
                  -122.13240802288054,
                  47.63783312249837
                ],
                [
                  -122.13238388299942,
                  47.63829037035086
                ],
                [
                  -122.13393688201903,
                  47.63829579223815
                ]
              ]
            ]
          },
          "properties": {
            "geometryId": "1"
          }
        },
        {
          "type": "Feature",
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  -122.13374376296996,
                  47.63784758098976
                ],
                [
                  -122.13277012109755,
                  47.63784577367854
                ],
                [
                  -122.13314831256866,
                  47.6382813338708
                ],
                [
                  -122.1334782242775,
                  47.63827591198201
                ],
                [
                  -122.13374376296996,
                  47.63784758098976
                ]
              ]
            ]
          },
          "properties": {
            "geometryId": "2",
            "validityTime": {
            "expiredTime": "2022-01-01T00:00:00",
            "validityPeriod": [
                {
                  "startTime": "2020-07-15T16:00:00",
                  "endTime": "2020-07-15T24:00:00",
                  "recurrenceType": "Daily",
                  "recurrenceFrequency": 1,
                  "businessDayOnly": true
                }
              ]
            }
          }
        }
      ]
   }
   ```

5. Нажмите синюю кнопку **Отправить** и дождитесь обработки запроса. После завершения запроса перейдите на вкладку **Заголовки** ответа. Скопируйте значение ключа **Расположение**, который является `status URL`.

    ```http
    https://atlas.microsoft.com/mapData/operations/<operationId>?api-version=1.0
    ```

6. Чтобы проверить состояние вызова API, создайте HTTP-запрос **GET** по `status URL`. Вам потребуется добавить первичный ключ подписки к URL-адресу для проверки подлинности. Запрос **GET** должен быть похож на следующий URL-адрес.

   ```HTTP
   https://atlas.microsoft.com/mapData/<operationId>/status?api-version=1.0&subscription-key={Subscription-key}
   ```

7. Когда HTTP-запрос **GET** завершается успешно, он возвращает `resourceLocation`. `resourceLocation` содержит уникальное значение `udid` для переданного содержимого. Это значение `udid` нужно сохранить, чтобы вы могли отправлять запросы к API получения геозоны, как показано в последнем разделе этого руководства. Также вы можете использовать URL-адрес `resourceLocation`, чтобы получить метаданные из этого ресурса на следующем шаге.

      ```json
      {
          "status": "Succeeded",
          "resourceLocation": "https://atlas.microsoft.com/mapData/metadata/{udid}?api-version=1.0"
      }
      ```

8. Чтобы получить метаданные содержимого, создайте HTTP-запрос **GET** по URL-адресу `resourceLocation`, который вы получили на шаге 7. Не забудьте добавить первичный ключ подписки к этому URL-адресу для проверки подлинности. Запрос **GET** должен быть похож на следующий URL-адрес.

    ```http
   https://atlas.microsoft.com/mapData/metadata/{udid}?api-version=1.0&subscription-key={Azure-Maps-Primary-Subscription-key}
    ```

9. После успешного завершения HTTP-запрос **GET** возвращает ответ, текст которого содержит значение `udid`, определенное в `resourceLocation` на шаге 7, а также расположение для последующего доступа к содержимому (скачивания) и набор других метаданных для этого содержимого (даты создания и обновления, размер и т. д.). Пример общего ответа:

    ```json
    {
        "udid": "{udid}",
        "location": "https://atlas.microsoft.com/mapData/{udid}?api-version=1.0",
        "created": "7/15/2020 6:11:43 PM +00:00",
        "updated": "7/15/2020 6:11:45 PM +00:00",
        "sizeInBytes": 1962,
        "uploadStatus": "Completed"
    }
    ```

## <a name="create-logic-app-workflows"></a>Создание рабочих процессов приложения логики

В этом разделе показано, как создать две конечные точки [приложения логики](https://docs.microsoft.com/azure/event-grid/handler-webhooks#logic-apps), которые будут отправлять уведомления по электронной почте. Мы покажем, как создать первый триггер для отправки уведомлений по электронной почте при каждом вызове этой конечной точки.

1. Войдите на [портал Azure](https://portal.azure.com)

2. В верхнем левом углу [портала Azure](https://portal.azure.com) щелкните **Создать ресурс**.

3. В поле *Поиск по Marketplace* введите **Приложение логики**.

4. В списке *Результаты* выберите **Приложение логики**. Нажмите кнопку **Создать**.

5. На странице **Приложение логики** укажите следующее:
    * *Подписка* для этого приложения логики.
    * *Группа ресурсов* для этого приложения логики. Вы *создать новую* или *использовать существующую* группу ресурсов.
    * *Имя приложения логики*. В нашем примере используется имя `Equipment-Enter`.

    Для работы с этим руководством оставьте значения по умолчанию для всех остальных параметров.

    :::image type="content" source="./media/tutorial-geofence/logic-app-create.png" alt-text="Создайте приложение логики":::

6. Нажмите кнопку **Просмотр и создание**. Проверьте параметры и нажмите кнопку **Создать**, чтобы отправить развертывание. Когда развертывание успешно завершится, щелкните **Перейти к ресурсу**. Вы перейдете в **Конструктор приложений логики**.

7. Теперь нужно выбирать тип триггера. Прокрутите страницу вниз до раздела *Начинаем с часто используемого триггера**. Щелкните **При получении HTTP-запроса**.

     :::image type="content" source="./media/tutorial-geofence/logic-app-trigger.png" alt-text="Создание триггера HTTP в приложении логики":::

8. В правом верхнем углу конструктора щелкните **Сохранить**. Будет автоматически создан **URL-адрес HTTP-запроса POST**. Сохраните этот URL-адрес, так как он понадобится для создания конечной точки события в следующем разделе.

    :::image type="content" source="./media/tutorial-geofence/logic-app-httprequest.png" alt-text="URL-адрес и содержимое в формате JSON для HTTP-запроса приложения логики":::

9. Выберите **+ Новый шаг**. Теперь мы выберем нужное действие. Введите `outlook.com email` в поле поиска. Прокрутите список **Действия** вниз и щелкните **Отправить сообщение электронной почты (v2)** .
  
    :::image type="content" source="./media/tutorial-geofence/logic-app-designer.png" alt-text="Создание приложения логики в окне конструктора":::

10. Войдите в учетную запись Outlook.com. Щелкните **Да**, чтобы разрешить приложению логики доступ к этой учетной записи. Заполните поля для отправки сообщения электронной почты.

    :::image type="content" source="./media/tutorial-geofence/logic-app-email.png" alt-text="Создание приложения логики, шаг отправки электронного письма":::

    >[!TIP]
    > Вы можете получать в уведомлениях по электронной почте данные из ответа в формате GeoJSON, например `geometryId` или `deviceId`, настроив в приложении логики чтение данных, отправляемых Сеткой событий. Сведения о том, как настроить в приложении логики получение данных о событиях и их передачу в уведомлениях по электронной почте, см. в руководстве [ Отправка уведомлений электронной почты о событиях в Центре Интернета вещей Azure с помощью Сетки событий и Logic Apps](https://docs.microsoft.com/azure/event-grid/publish-iot-hub-events-to-logic-apps).

11. Нажмите кнопку **Сохранить** в верхнем левом углу окна конструктора Logic Apps.

12. Повторите шаги 3–11, чтобы создать второе приложение логики для информирования руководителя о выходе оборудования из строительной зоны. Присвойте этому приложению логики имя `Equipment-Exit`.

## <a name="create-azure-maps-events-subscriptions"></a>Создание подписок на события Azure Maps

Azure Maps поддерживает три типа событий. Сведения о типах событий, поддерживаемых Azure Maps, см. [в этой статье](https://docs.microsoft.com/azure/event-grid/event-schema-azure-maps).  Вам нужно создать две разные подписки на события: для событий входа в геозону и событий выхода из нее.

Выполните следующие действия, чтобы создать подписку на события поступления оборудования в геозону. Создать подписку на события выхода оборудования из геозоны можно аналогичным образом.

1. Перейдите к учетной записи Azure Maps. На панели мониторинга выберите **Подписки**. Щелкните имя нужной подписки и выберите **События** в меню параметров.

    :::image type="content" source="./media/tutorial-geofence/events-tab.png" alt-text="Переход к событиям учетной записи Azure Maps":::

2. Чтобы создать подписку на события, выберите **Подписка на события** на странице событий.

    :::image type="content" source="./media/tutorial-geofence/create-event-subscription.png" alt-text="Создание подписки на события Azure Maps":::

3. На странице **Создание подписки на события** укажите следующее:
    * *Имя* для этой подписки на события.
    * В поле *Схема события* выберите *Схема Сетки событий*.
    * *Имя системного раздела* для этой подписки на события. В нашем примере это `Contoso-Construction`.
    * В разделе *Фильтр по типам событий* выберите тип события `Geofence Entered`.
    * В поле *Тип конечной точки* выберите `Web Hook`.
    * В поле *Конечная точка* вставьте URL-адрес конечной точки HTTP-запроса POST из приложения логики для событий входа, который вы получили ранее. Если вы забыли сохранить это значение, просто переключитесь в окно конструктора приложений логики и скопируйте адрес из шага "Триггер HTTP".

    :::image type="content" source="./media/tutorial-geofence/events-subscription.png" alt-text="Сведения о подписке на события Azure Maps":::

4. Нажмите кнопку **Создать**.

5. Повторите шаги 1–4 для конечной точки приложения логики для событий входа, созданной, как описано в предыдущем разделе. Но теперь на шаге 3 выберите тип события `Geofence Exited`.

## <a name="use-search-geofence-get-api"></a>Использование API Get поиска по геозоне

Теперь мы применим [API Get поиска по геозоне](https://docs.microsoft.com/rest/api/maps/spatial/getgeofence) для отправки уведомлений по электронной почте руководителю строительного объекта о том, что элемент оборудования входит в границы геозоны или покидает ее.

Каждый элемент оборудования имеет собственный идентификатор `deviceId`. В нашем примере будет отслеживаться только один элемент оборудования с уникальным идентификатором `device_1`.

Для ясности на следующей схеме представлены пять расположений этого элемента оборудования с течением времени, начиная с позиции *Начало*, которая не входит в пределы наших геозон. Для работы с этим руководством мы не отправляем запрос к устройству в расположении *Начало*, поэтому это расположение не определено.

При обращении к [API Get поиска по геозоне](https://docs.microsoft.com/rest/api/maps/spatial/getgeofence) с новым расположением оборудования, которое соответствует первому входу оборудования в зону или выходу из нее, Сетка событий вызовет соответствующую конечную точку приложения логики, чтобы отправить руководителю уведомление по электронной почте.

Каждый из следующих пяти разделов выполняет HTTP-запрос GET к API геозон с разными координатами расположения оборудования.

![Схема геозоны в Azure Maps](./media/tutorial-geofence/geofence.png)

### <a name="equipment-location-1-47638237-122132483"></a>Расположение оборудования 1 (47,638237,-122,132483)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос).  Введите **Имя запроса** для запроса. Мы будем использовать имя *Location 1*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите метод HTTP **GET** на вкладке построителя и введите следующий URL-адрес, не забывая заменить `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

   ```HTTP
   https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.638237&lon=-122.1324831&searchBuffer=5&isAsync=True&mode=EnterAndExit
   ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON.

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_1",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.638291,
          "nearestLon": -122.132483
        },
        {
          "deviceId": "device_1",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "2",
          "distance": 999.0,
          "nearestLat": 47.638053,
          "nearestLon": -122.13295
        }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": true
    }
    ```

4. В приведенном выше ответе GeoJSON отрицательное значение расстояния от основной геозоны объекта означает, что оборудование находится в этой геозоне. Положительное значение расстояния от дочерней геозоны означает, что оборудование находится за пределами этой геозоны. Так как это устройство впервые оказалось внутри главной геозоны объекта, параметр `isEventPublished` получит значение `true`, и руководитель объекта получит по электронной почте уведомление о том, что оборудование вошло в пределы геозоны.

### <a name="location-2-4763800-122132531"></a>Расположение 2 (47,63800,-122,132531)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос).  Введите **Имя запроса** для запроса. Мы будем использовать имя *Location 2*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите метод HTTP **GET** на вкладке построителя и введите следующий URL-адрес, не забывая заменить `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

   ```HTTP
   https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udId={udId}&lat=47.63800&lon=-122.132531&searchBuffer=5&isAsync=True&mode=EnterAndExit
   ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON.

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.637997,
          "nearestLon": -122.132399
        },
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "2",
          "distance": 999.0,
          "nearestLat": 47.63789,
          "nearestLon": -122.132809
        }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": false
    }
    ````

4. В приведенном выше ответе GeoJSON видно, что оборудование оставалось в основной геозоне объекта и не входило в дополнительную геозону. Поэтому параметр `isEventPublished` получит значение `false`, и уведомление руководителю не будет отправлено по электронной почте.

### <a name="location-3-4763810783315048-12213336020708084"></a>Расположение 3 (47,63810783315048,-122,13336020708084)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос).  Введите **Имя запроса** для запроса. Мы будем использовать имя *Location 3*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите метод HTTP **GET** на вкладке построителя и введите следующий URL-адрес, не забывая заменить `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

    ```HTTP
      https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.63810783315048&lon=-122.13336020708084&searchBuffer=5&isAsync=True&mode=EnterAndExit
      ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON.

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.638294,
          "nearestLon": -122.133359
        },
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "2",
          "distance": -999.0,
          "nearestLat": 47.638161,
          "nearestLon": -122.133549
        }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": true
    }
    ````

4. В приведенном выше ответе GeoJSON видно, что оборудование оставалось в основной геозоне объекта, но теперь вошло в дополнительную геозону. Это означает, что параметр `isEventPublished` получит значение `true`, и руководителю объекта будет отправлено по электронной почте уведомление о том, что оборудование вошло в дополнительную геозону.

    >[!NOTE]
    >Если оборудование переходит в дополнительную геозону в нерабочее время, событие не публикуется и руководитель не получает уведомлений.  

### <a name="location-4-47637988-1221338344"></a>Расположение 4 (47,637988,-122,1338344)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос).  Введите **Имя запроса** для запроса. Мы будем использовать имя *Location 4*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите метод HTTP **GET** на вкладке построителя и введите следующий URL-адрес, не забывая заменить `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` значением `udid`, которое вы сохранили в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

    ```HTTP
    https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.637988&userTime=2023-01-16&lon=-122.1338344&searchBuffer=5&isAsync=True&mode=EnterAndExit
    ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON.

    ```json
    {
      "geometries": [
        {
          "deviceId": "device_01",
          "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
          "geometryId": "1",
          "distance": -999.0,
          "nearestLat": 47.637985,
          "nearestLon": -122.133907
        }
      ],
      "expiredGeofenceGeometryId": [
        "2"
      ],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": false
    }
    ````

4. В приведенном выше ответе GeoJSON видно, что оборудование оставалось в основной геозоне объекта, но теперь вышло из дополнительной геозоны. Вы также можете заметить, что значение `userTime` превышает значение `expiredTime`, определенное в данных о геозоне. Поэтому параметр `isEventPublished` получает значение `false`, и уведомление по электронной почте руководителю не отправляется.

### <a name="location-547637988-1221338344"></a>Расположение 5(47,637988,-122,1338344)

1. В верхней части приложения Postman выберите элемент **Создать**. В окне **Create New** (Создание) выберите **Request** (Запрос).  Введите **Имя запроса** для запроса. Мы будем использовать имя *Location 4*. Выберите коллекцию, созданную в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data) и щелкните **Save** (Сохранить).

2. Выберите метод HTTP **GET** на вкладке построителя и введите следующий URL-адрес, не забывая заменить `{Azure-Maps-Primary-Subscription-key}` значением первичного ключа подписки, а `{udid}` — значением `udid`, которое вы сохранили в разделе [Отправка данных о геозоне в формате GeoJSON](#upload-geofencing-geojson-data).

    ```HTTP
    https://atlas.microsoft.com/spatial/geofence/json?subscription-key={subscription-key}&api-version=1.0&deviceId=device_01&udid={udid}&lat=47.637988&lon=-122.1338344&searchBuffer=5&isAsync=True&mode=EnterAndExit
    ```

3. Нажмите кнопку **Отправить**. В окне ответа появится следующий текст в формате GeoJSON.

    ```json
    {
      "geometries": [
      {
        "deviceId": "device_01",
        "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
        "geometryId": "1",
        "distance": -999.0,
        "nearestLat": 47.637985,
        "nearestLon": -122.133907
      },
      {
        "deviceId": "device_01",
        "udId": "64f71aa5-bbee-942d-e351-651a6679a7da",
        "geometryId": "2",
        "distance": 999.0,
        "nearestLat": 47.637945,
        "nearestLon": -122.133683
      }
      ],
      "expiredGeofenceGeometryId": [],
      "invalidPeriodGeofenceGeometryId": [],
      "isEventPublished": true
    }
    ````

4. В приведенном выше ответе GeoJSON видно, что оборудование покинуло основную геозону объекта. Это означает, что параметр `isEventPublished` получит значение `true`, и руководителю объекта будет отправлено по электронной почте уведомление о том, что оборудование вышло из геозоны.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Обработка типов содержимого в Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/logic-apps-content-type)

> [!div class="nextstepaction"]
> [Руководство по отправке уведомлений электронной почты о событиях в Центре Интернета вещей Azure с помощью Сетки событий и Logic Apps](https://docs.microsoft.com/azure/event-grid/publish-iot-hub-events-to-logic-apps)

> [!div class="nextstepaction"]
> [Обработчики событий в Сетке событий](https://docs.microsoft.com/azure/event-grid/event-handlers)
