---
title: Добавление слоя тепловой карты в Azure Maps | Документация Майкрософт
description: Добавление слоя тепловой карт в веб-пакет SDK Azure Maps.
author: rbrundritt
ms.author: richbrun
ms.date: 07/29/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: ''
ms.custom: codepen
ms.openlocfilehash: f7115e7c8b95efd0e3bbc8a788528878c2d1f092
ms.sourcegitcommit: 8cf199fbb3d7f36478a54700740eb2e9edb823e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2019
ms.locfileid: "74484309"
---
# <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Тепловая карта, которую также называют картой точек плотности, это тип визуализации данных для представления плотности данных с помощью диапазона цветов. Такие визуализации часто используются для отображения "горячих точек" данных на карте, и они особенно полезны, чтобы преобразовывать для просмотра набор данных больших точек.  Например, отрисовка десятков тысяч точек в представлении Map в виде символов охватывает большую часть области карт и приведет к тому, что многие символы перекрывают друг друга, что затрудняет понимание данных. Если же те же данные будут отображаться на тепловой карте, вы сможете легко заметить области максимальной или относительно низкой плотности относительно других областей карты. Тепловые карты используются в разных сценариях. Вот лишь несколько примеров.

- В формате тепловой карты очень удобно отображать данные о температурах, так как она предоставляет приблизительные значения данных между двумя точками.
- Отображение сведений от датчиков шума в виде тепловой карты не только позволяет оценить уровень шума в точке установки датчика, но и дает некоторое представление о снижении шума на расстоянии. Уровень шума на одном сайте относительно невелик, но близкое расположение таких областей повышает уровень шума в датчиках перекрытия. Возможно, что область с перекрытием имеет более высокие уровни чувствительности к шуму, и таким образом они появятся на тепловой карте.
- Визуализация трассировки GPS, которая включает скорость в виде взвешенной высоты, где интенсивность каждой точки данных зависит от скорости, — это отличный способ узнать, где был ускорен процесс.

> [!TIP]
> Слои тепловой карты по умолчанию преобразовывают координаты всех геометрических объектов в источнике данных. Чтобы ограничить слой таким образом, чтобы он отображал только возможности геометрических точек, задайте для свойства `filter` слоя значение `['==', ['geometry-type'], 'Point']` или `['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]`, если требуется также включить компоненты MultiPoint.

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Heat-Maps-and-Image-Overlays-in-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

## <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Чтобы преобразовать источник данных точек в виде тепловой карты, передайте этот источник данных в экземпляр класса `HeatMapLayer` и добавьте его на карту, как показано в следующем примере.

В следующем коде каждая тепловая точка имеет радиус на 10 пикселей на всех уровнях масштабирования. При добавлении слоя тепловой карт к карте этот пример вставляет его под слоем меток, чтобы улучшить взаимодействие с пользователем, так как метки четко видны над тепловой картой. Данные в этом примере получаются из [программы USGS землетрясения опасные приложения](https://earthquake.usgs.gov/) и представляют значительный землетрясения, произошедшие за последние 30 дней.

```javascript
//Create a data source and add it to the map.
var datasource = new atlas.source.DataSource();
map.sources.add(datasource);

//Load a data set of points, in this case earthquake data from the USGS.
datasource.importDataFromUrl('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson');

//Create a heatmap and add it to the map.
map.layers.add(new atlas.layer.HeatMapLayer(datasource, null, {
  radius: 10,
  opacity: 0.8
}), 'labels');
```

Ниже приведен полный пример выполнения кода описанной выше функциональности.

<br/>

<iframe height='500' scrolling='no' title='Простой слой тепловой карты' src='//codepen.io/azuremaps/embed/gQqdQB/?height=500&theme-id=0&default-tab=js,result&embed-version=2&editable=true' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Изучите фрагмент кода <a href='https://codepen.io/azuremaps/pen/gQqdQB/'>простого слоя тепловой карты</a>, опубликованный для Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="customizing-the-heat-map-layer"></a>Настройка слоя тепловой карты

В предыдущем примере настройка тепловой карты заключалась в установке параметров радиуса и прозрачности. Слой тепловой карты предоставляет несколько параметров для настройки.

* `radius`: Определяет пиксельный радиус для отображения каждой точки данных. Радиус определяется как фиксированное число или выражение. С помощью выражения можно масштабировать радиус на основе масштаба, который представляет собой единообразную пространственное область на карте (например, 5-км радиус).
* `color`: указывает, как раскрасить тепловую карту. Цветовой градиент часто используется для карт рисков и может быть достигнут с помощью `interpolate` выражения. Использование выражения `step` для выделения тепловой карте позволяет разбить плотность на диапазоны, которые более похожи на карту в виде контура или лепестковой диаграммы. Эти цветовые палитры определяют цвета в диапазоне от минимальной до максимальной плотности. Значения цветов для тепловых карт указываются в виде выражения для значения `heatmap-density`. Цвет с индексом 0 в выражении интерполяции или цвет по умолчанию для выражения шага определяет цвет области, в которой нет данных, и может использоваться для определения цвета фона. Многие пользователи предпочитают использовать для этого прозрачный или полупрозрачный черный цвет. Вот несколько примеров выражений для определения цвета.

| Выражение цвета интерполяции | Выражение для ступенчатой палитры | 
|--------------------------------|--------------------------|
| \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'interpolate',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['linear'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;0, 'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'purple',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.5, '#fb00fb',<br/>&nbsp;&nbsp;&nbsp;&nbsp;1, '#00c3ff'<br/>\] | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'step',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'navy',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,25, "Green",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,50, "Yellow",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,75, "Red"<br/>\] | 

- `opacity`: определяет степень прозрачности или прозрачности слоя тепловой карт.
- `intensity`: применяет множитель к весу каждой точки данных, чтобы увеличить общую интенсивность тепловой карты и помогает значительно упростить визуализацию небольших различий в весе точек данных.
- `weight`. по умолчанию все точки данных имеют вес 1, поэтому все точки данных имеют одинаковый вес. Параметр weight используется в качестве множителя. Для него можно использовать фиксированное число или выражение. Если в параметре weight используется число, например 2, плотность каждой точки удваивается, как если бы она была нанесена на карту дважды. Фиксированное число в качестве значения параметра weight изменяет тепловую карту точно так же, как изменение параметра intensity. Однако если используется выражение, вес каждой точки данных может основываться на свойствах каждой точки данных. Например, в данных землетрясения каждая точка данных представляет землетрясение. Важная метрика в каждой точке данных землетрясения — это значение величины. Землетрясения происходят постоянно, но большинство из них имеют низкую магнитуду и практически не заметны. Использование значения величины в выражении для назначения веса каждой точке данных позволит лучше представить более значимые землетрясения в тепловой карте.
- Кроме параметров базового слоя, минимального и максимального масштаба, видимости и фильтра, есть еще параметр `source`, который позволяет обновлять источник данных и параметр `source-layer`, если источник данных является источником векторных фрагментов.

Это средство позволяет проверить разные настройки для слоя тепловой карты.

<br/>

<iframe height='700' scrolling='no' title='Параметры слоя тепловой карты' src='//codepen.io/azuremaps/embed/WYPaXr/?height=700&theme-id=0&default-tab=result' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Просмотрите фрагмент кода с <a href='https://codepen.io/azuremaps/pen/WYPaXr/'>параметрами слоя тепловой карты</a> для службы Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>), размещенный в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="consistent-zoomable-heat-map"></a>Последовательная тепловая схема масштабируемый

По умолчанию радиусы точек данных, отображаемых на уровне тепловой карт, имеют фиксированный пиксельный радиус для всех уровней масштабирования. По мере масштабирования карт данные объединяются, и слой тепловой карт выглядит иначе. `zoom` выражение можно использовать для масштабирования радиуса каждого уровня масштаба таким, чтобы каждая точка данных охватывает одну и ту же физическую область на карте. Это сделает слой тепловой карт более статическим и последовательным. Каждый уровень масштаба на карте имеет вдвое больше пикселей по вертикали и горизонтали, чем предыдущий уровень масштаба. При масштабировании радиуса с каждым уровнем масштабирования будет создана тепловая схема, которая выглядит единообразно на всех уровнях масштабирования. Это можно сделать с помощью `zoom` с выражением Base 2 `exponential interpolation`, как показано в примере ниже. Масштабировать карту, чтобы увидеть, как тепловая схема масштабируется с учетом масштаба.

<br/>

<iframe height="500" style="width: 100%;" scrolling="no" title="Последовательная тепловая схема масштабируемый" src="//codepen.io/azuremaps/embed/OGyMZr/?height=500&theme-id=0&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
См. Azure Maps <a href='https://codepen.io/azuremaps/pen/OGyMZr/'>масштабируемый</a> (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) на <a href='https://codepen.io'>CodePen</a>с помощью пера.
</iframe>

> [!TIP]
> При включенной кластеризации для источника данных, расположенные близко друг к другу точки данных группируются в кластеризованые точки. Число точек в каждом кластере можно использовать в выражении веса для тепловой карты. Такой подход позволяет значительно сократить число отображаемых точек. Число точек в кластере хранится в свойстве `point_count` функции Point, как показано ниже. 
> ```JavaScript
> var layer = new atlas.layer.HeatMapLayer(datasource, null, {
>    weight: ['get', 'point_count']
> });
> ```
> Если радиус кластеризации составляет несколько пикселей, визуальные различия будут минимальными. Больший радиус означает группирование большего числа точек в каждом кластере, что повысит производительность тепловой карты, но одновременно создаст более заметные визуальные различия.

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения о классах и методах, которые используются в этой статье:

> [!div class="nextstepaction"]
> [HeatMapLayer](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.htmlmarker?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"]
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

Дополнительные примеры кода для добавления в карты см. в следующих статьях:

> [!div class="nextstepaction"]
> [Создание источника данных](create-data-source-web-sdk.md)

> [!div class="nextstepaction"]
> [Использование стилистических выражений на основе данных](data-driven-style-expressions-web-sdk.md)