---
title: Добавьте слой тепловой карты на карту Карты Microsoft Azure
description: В этой статье вы узнаете о том, как добавить слой тепловой карты на карту с помощью веб-SDK Microsoft Azure Maps Web SDK.
author: rbrundritt
ms.author: richbrun
ms.date: 07/29/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: ''
ms.custom: codepen
ms.openlocfilehash: 19765bd28f365cc6f6d5b06646896613dd3e3e87
ms.sourcegitcommit: 6397c1774a1358c79138976071989287f4a81a83
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/07/2020
ms.locfileid: "80804560"
---
# <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Тепловая карта, которую также называют картой точек плотности, представляет собой тип визуализации данных. Они используются для представления плотности данных с помощью различных цветов и отображения данных "горячих точек" на карте. Тепловые карты являются отличным способом визуализации наборов данных с большим количеством точек. 

Рендеринг десятков тысяч точек в качестве символов может охватывать большую часть области карты. Этот случай, вероятно, приводит к много символов перекрытия. Что затрудняет получение лучшего понимания данных. Однако визуализация этого набора данных в качестве тепловой карты позволяет легко увидеть плотность и относительную плотность каждой точки данных.

Карты тепла можно использовать в различных сценариях, в ключая:

- **Данные о температуре**: Обеспечивает приближение температуры между двумя точками данных.
- **Данные для датчиков шума**: Показывает не только интенсивность шума, где датчик, но он также может обеспечить понимание рассеивания на расстоянии. Уровень шума на одном участке может быть не высоким. Если зона покрытия шума от нескольких датчиков перекрывается, возможно, что эта перекрывающаяся область может испытывать более высокий уровень шума. Таким образом, перекрытая область будет видна на тепловой карте.
- **GPS след**: Включает в себя скорость в качестве взвешенной карты высоты, где интенсивность каждой точки данных основана на скорости. Например, эта функциональность позволяет увидеть, где транспортное средство превысило скорость.

> [!TIP]
> Слои тепловой карты по умолчанию отображают координаты всех геометрий в источнике данных. Чтобы ограничить слой таким образом, чтобы он отображал только объекты геометрии точек, установите `filter` свойство слоя до `['==', ['geometry-type'], 'Point']`. Если вы хотите также включить функции `filter` MultiPoint, установите свойство слоя. `['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]`

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Heat-Maps-and-Image-Overlays-in-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

## <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Чтобы сделать источник данных точек тепловой картой, `HeatMapLayer` передайте источник данных в экземпляр класса и добавьте его в карту.

В следующем коде каждая точка тепла имеет радиус 10 пикселей на всех уровнях масштабирования. Чтобы обеспечить лучший пользовательский опыт, тепловая карта находится ниже слоя метки. Метки остаются хорошо видимыми. Данные в этой выборке из [USGS Землетрясение Опасности программы](https://earthquake.usgs.gov/). Это для значительных землетрясений, которые произошли в последние 30 дней.

```javascript
//Create a data source and add it to the map.
var datasource = new atlas.source.DataSource();
map.sources.add(datasource);

//Load a dataset of points, in this case earthquake data from the USGS.
datasource.importDataFromUrl('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson');

//Create a heat map and add it to the map.
map.layers.add(new atlas.layer.HeatMapLayer(datasource, null, {
  radius: 10,
  opacity: 0.8
}), 'labels');
```

Вот полный пример кода, приведенного в эксплуатации, который был приведен в истории предыдущего кода.

<br/>

<iframe height='500' scrolling='no' title='Простой слой тепловой карты' src='//codepen.io/azuremaps/embed/gQqdQB/?height=500&theme-id=0&default-tab=js,result&embed-version=2&editable=true' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Изучите фрагмент кода <a href='https://codepen.io/azuremaps/pen/gQqdQB/'>простого слоя тепловой карты</a>, опубликованный для Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="customize-the-heat-map-layer"></a>Настройка слоя тепловой карты

В предыдущем примере настройка тепловой карты заключалась в установке параметров радиуса и прозрачности. Слой тепловой карты предоставляет несколько вариантов настройки, в том числе:

* `radius`: Определяет радиус пикселей, в котором можно визуализировать каждую точку данных. Радиус можно установить как фиксированное число или как выражение. С помощью выражения можно масштабировать радиус на основе уровня зума и представлять последовательную пространственную область на карте (например, радиус 5 миль).
* `color`: Определяет, как раскрашивается тепловая карта. Цветовой градиент является общей чертой тепловых карт. Вы можете достичь эффекта с выражением. `interpolate` Вы также можете `step` использовать выражение для окраски тепловой карты, разбивая плотность визуально на диапазоны, которые напоминают контур или карту стиля радара. Эти цветовые палитры определяют цвета в диапазоне от минимальной до максимальной плотности. 

  Значения цвета для тепловых карт указаны `heatmap-density` как выражение значения. Цвет области, где нет данных, определяется в индексе 0 выражения "Интерполация" или цвете по умолчанию выражения "Stepped". Это значение можно использовать для определения фонового цвета. Часто это значение устанавливается на прозрачный или полупрозрачный черный. 
   
  Вот примеры цветовых выражений:

  | Выражение цвета интерполяции | Шагнул выражение цвета | 
  |--------------------------------|--------------------------|
  | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'interpolate',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['linear'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;0, 'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'purple',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.5, '#fb00fb',<br/>&nbsp;&nbsp;&nbsp;&nbsp;1, '#00c3ff'<br/>\] | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'step',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'navy',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.25, "зеленый",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.50, "желтый",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,75, "красный"<br/>\] |   

- `opacity`: Определяет, насколько непрозрачным или прозрачным является слой тепловой карты.
- `intensity`: Применяет множитель к весу каждой точки данных, чтобы увеличить общую интенсивность тепловой карты. Это приводит к разнице в весе точек данных, что облегчает визуализацию.
- `weight`: По умолчанию все точки данных имеют вес 1 и взвешиваются одинаково. Опция веса действует как множитель, и вы можете установить его как число или выражение. Если число устанавливается в качестве веса, это эквивалентность размещения каждой точки данных на карте дважды. Например, если вес 2, то плотность удваивается. Фиксированное число в качестве значения параметра weight изменяет тепловую карту точно так же, как изменение параметра intensity. 

  Однако, если вы используете выражение, вес каждой точки данных может быть основан на свойствах каждой точки данных. Например, предположим, что каждая точка данных представляет собой землетрясение. Значение величины было важной метрикой для каждой точки данных землетрясения. Землетрясения случаются все время, но большинство из них имеют низкую величину, и не заметили. Используйте значение величины в выражении, чтобы назначить вес каждой точке данных. Используя значение величины для присвоения веса, вы получаете лучшее представление о значении землетрясений в тепловой карте.
- `source`и `source-layer`: Включите вас для обновления источника данных.

Вот инструмент для проверки различных вариантов слоя тепловой карты.

<br/>

<iframe height='700' scrolling='no' title='Параметры слоя тепловой карты' src='//codepen.io/azuremaps/embed/WYPaXr/?height=700&theme-id=0&default-tab=result' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Просмотрите фрагмент кода с <a href='https://codepen.io/azuremaps/pen/WYPaXr/'>параметрами слоя тепловой карты</a> для службы Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>), размещенный в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="consistent-zoomable-heat-map"></a>Последовательная масштабируемая карта тепла

По умолчанию радиусы точек данных, отображаемые в слое тепловой карты, имеют фиксированный радиус пикселей для всех уровней масштабирования. При увеличении карты данные объединяются, а слой тепловой карты выглядит по-другому. 

Используйте `zoom` выражение для масштабирования радиуса для каждого уровня масштабирования, чтобы каждая точка данных покрывала одну и ту же физическую область карты. Это выражение делает слой тепловой карты более статичным и последовательным. Каждый уровень масштабирования карты имеет в два раза больше пикселей вертикально и горизонтально, чем предыдущий уровень масштабирования. 

Масштабирование радиуса таким образом, чтобы он удваивается с каждым уровнем масштабирования, создает тепловую карту, которая выглядит последовательной на всех уровнях масштабирования. Чтобы применить это масштабирование, `zoom` используйте `exponential interpolation` с выражением базы 2, с радиусом пикселя, установленным для минимального `2 * Math.pow(2, minZoom - maxZoom)` уровня масштабирования и масштабируемого радиуса для максимального уровня масштабирования, рассчитанного как показано в следующем образце. Увеличьте масштаб карты, чтобы увидеть, как масштабируется тепловая карта с уровнем масштабирования.

<br/>

<iframe height="500" style="width: 100%;" scrolling="no" title="Последовательная масштабируемая карта тепла" src="//codepen.io/azuremaps/embed/OGyMZr/?height=500&theme-id=0&default-tab=js,result&editable=true" frameborder="no" allowtransparency="true" allowfullscreen="true">
Смотрите карту термопада Pen Consistent по<a href='https://codepen.io/azuremaps'>@azuremaps</a> <a href='https://codepen.io/azuremaps/pen/OGyMZr/'>увеличенной тепловой карте</a> по картам Azure Maps () на <a href='https://codepen.io'>CodePen</a>.
</iframe>

> [!TIP]
> При входной группировке источника данных точки, близкие друг к другу, сгруппируются как кластерная точка. В качестве выражения веса для тепловой карты можно использовать точечное отсчет каждого кластера. Это может значительно сократить количество точек, которые будут отображаться. Количество точек кластера хранится `point_count` в свойстве объекта: 
> ```JavaScript
> var layer = new atlas.layer.HeatMapLayer(datasource, null, {
>    weight: ['get', 'point_count']
> });
> ```
> Если радиус кластеризации составляет всего несколько пикселей, то в рендеринге будет небольшая визуальная разница. Больший радиус группирует больше очков в каждом кластере и улучшает производительность тепловой карты.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о классах и методах, которые используются в этой статье:

> [!div class="nextstepaction"]
> [HeatMapLayer](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.htmlmarker?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"]
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

Дополнительные примеры кода для добавления в карты см. в следующих статьях:

> [!div class="nextstepaction"]
> [Создание источника данных](create-data-source-web-sdk.md)

> [!div class="nextstepaction"]
> [Использование стилистических выражений на основе данных](data-driven-style-expressions-web-sdk.md)
