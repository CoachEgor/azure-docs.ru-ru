---
title: Добавление слоя тепловой карты в Azure Maps | Документация Майкрософт
description: Добавление слоя тепловой карт в веб-пакет SDK Azure Maps.
author: rbrundritt
ms.author: richbrun
ms.date: 07/29/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: ''
ms.custom: codepen
ms.openlocfilehash: b0d07f18682bf39558180753de38a9c5ff106ee3
ms.sourcegitcommit: f4f626d6e92174086c530ed9bf3ccbe058639081
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75408525"
---
# <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Тепловые карты, также известные как карты с плотностью точек, представляют собой тип визуализации данных, используемый для представления плотности данных с помощью диапазона цветов. Они часто используются для отображения «горячих» точек данных на карте и являются отличным способом визуализации наборов данных с большими точками. 

Например, отрисовка десятков тысяч точек в представлении Map в качестве символов охватывает большую часть области карт. Это, скорее всего, приводит к наложению множества символов друг на друга, что затрудняет понимание данных. Однако визуализация этого же набора данных в качестве тепловой карт позволяет легко понять, где находятся точечные данные, и относительное значение плотности в других областях.

Карты рисков можно использовать в различных сценариях, в том числе:

- **Данные температуры**: выводит приблизительные показатели температуры между двумя точками данных.
- **Данные для датчиков шума**: показывает не только интенсивность шума, где находится датчик, но также может предоставить ценные сведения о расположении на расстоянии. Уровень шума на одном сайте может быть невысоким. Но если область действия шума от нескольких датчиков перекрывается, возможно, эта перекрывающаяся область может иметь более высокий уровень шума и, таким образом, будет видна на тепловой карте.
- **Трассировка GPS**: включает скорость как карту взвешенной высоты, где интенсивность каждой точки данных зависит от скорости. Например, это позволяет узнать, где был ускорен процесс.

> [!TIP]
> По умолчанию уровни тепловой карт отображают координаты всех геометрических объектов в источнике данных. Чтобы ограничить слой таким образом, чтобы он отображал только возможности геометрических точек, установите для свойства `filter` слоя значение `['==', ['geometry-type'], 'Point']`. Если вы хотите включить функции MultiPoint, установите для свойства `filter` слоя значение `['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]`.

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Heat-Maps-and-Image-Overlays-in-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

## <a name="add-a-heat-map-layer"></a>Добавление слоя тепловой карты

Чтобы отобразить источник данных точек как тепловую карту, передайте источник данных в экземпляр класса `HeatMapLayer` и добавьте его на карту.

В следующем коде каждая тепловая точка имеет радиус на 10 пикселей на всех уровнях масштабирования. При добавлении слоя тепловой карт к карте этот пример вставляет его под слоем меток, чтобы улучшить взаимодействие с пользователем. Метки четко видны над тепловой картой. Данные в этом примере получаются из [программы USGS землетрясения опасные приложения](https://earthquake.usgs.gov/)и представляют значительный землетрясения, произошедшие за последние 30 дней.

```javascript
//Create a data source and add it to the map.
var datasource = new atlas.source.DataSource();
map.sources.add(datasource);

//Load a dataset of points, in this case earthquake data from the USGS.
datasource.importDataFromUrl('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_week.geojson');

//Create a heatmap and add it to the map.
map.layers.add(new atlas.layer.HeatMapLayer(datasource, null, {
  radius: 10,
  opacity: 0.8
}), 'labels');
```

Ниже приведен полный пример выполнения кода предыдущего кода.

<br/>

<iframe height='500' scrolling='no' title='Простой слой тепловой карты' src='//codepen.io/azuremaps/embed/gQqdQB/?height=500&theme-id=0&default-tab=js,result&embed-version=2&editable=true' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Изучите фрагмент кода <a href='https://codepen.io/azuremaps/pen/gQqdQB/'>простого слоя тепловой карты</a>, опубликованный для Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="customize-the-heat-map-layer"></a>Настройка слоя тепловой карт

В предыдущем примере настройка тепловой карты заключалась в установке параметров радиуса и прозрачности. Слой тепловой карт предоставляет несколько вариантов настройки, включая следующие:

* `radius`: Определяет пиксельный радиус для отображения каждой точки данных. Вы можете задать для радиуса фиксированное число или как выражение. С помощью выражения можно масштабировать радиус в зависимости от уровня масштаба и представить единообразную пространственное область на карте (например, радиус 5 км).
* `color`: указывает, как раскрасить тепловую карту. Цветовой градиент — это общая функция карт рисков, и вы можете добиться результата с помощью `interpolate` выражения. Можно также использовать выражение `step` для выделения тепловой карте, разбивая плотность на диапазоны, похожие на карту в виде расконтурного или лепесткового стиля. Эти цветовые палитры определяют цвета в диапазоне от минимальной до максимальной плотности. 

  Значения цвета для тепловых карт задаются в виде выражения для значения `heatmap-density`. Цвет с индексом 0 в выражении интерполяции или цвет по умолчанию для выражения шага определяет цвет области, в которой нет данных. Его можно использовать для определения цвета фона. Часто это значение равно прозрачному или полупрозрачному черному. 
   
  Ниже приведены примеры выражений цвета.

  | Выражение цвета интерполяции | Выражение пошагового цвета | 
  |--------------------------------|--------------------------|
  | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'interpolate',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['linear'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;0, 'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'purple',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.5, '#fb00fb',<br/>&nbsp;&nbsp;&nbsp;&nbsp;1, '#00c3ff'<br/>\] | \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;'step',<br/>&nbsp;&nbsp;&nbsp;&nbsp;\['heatmap-density'\],<br/>&nbsp;&nbsp;&nbsp;&nbsp;'transparent',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0.01, 'navy',<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,25, "Green",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,50, "Yellow",<br/>&nbsp;&nbsp;&nbsp;&nbsp;0,75, "Red"<br/>\] |   

- `opacity`: определяет степень прозрачности или прозрачности слоя тепловой карт.
- `intensity`: применяет множитель к весу каждой точки данных, чтобы увеличить общую интенсивность тепловой карты. Это позволяет упростить визуализацию мелких различий в весе точек данных.
- `weight`. по умолчанию все точки данных имеют вес 1 и имеют одинаковое взвешенное значение. Параметр Weight выступает в качестве множителя, и его можно задать в виде числа или выражения. Если в качестве веса задано число (например, 2), то это эквивалентно размещению каждой точки данных на карте дважды, таким образом, с удвоением плотности. Фиксированное число в качестве значения параметра weight изменяет тепловую карту точно так же, как изменение параметра intensity. 

  Однако при использовании выражения весовые коэффициенты каждой точки данных могут основываться на свойствах каждой точки данных. Например, предположим, что каждая точка данных представляет землетрясения. Важной метрикой каждой точки данных землетрясения является значение величины. Землетрясения приходится на все время, но в большинстве случаев имеет низкую величину и даже не казалось. Используя значение величины в выражении для назначения веса каждой точке данных, вы получаете лучшее представление о значимости землетрясения в тепловой карте.
- `source` и `source-layer`: позволяют обновлять источник данных.

Ниже приведено средство для тестирования различных параметров слоя тепловой карт.

<br/>

<iframe height='700' scrolling='no' title='Параметры слоя тепловой карты' src='//codepen.io/azuremaps/embed/WYPaXr/?height=700&theme-id=0&default-tab=result' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>Просмотрите фрагмент кода с <a href='https://codepen.io/azuremaps/pen/WYPaXr/'>параметрами слоя тепловой карты</a> для службы Azure Maps (<a href='https://codepen.io/azuremaps'>@azuremaps</a>), размещенный в репозитории <a href='https://codepen.io'>CodePen</a>.
</iframe>

## <a name="consistent-zoomable-heat-map"></a>Последовательная тепловая схема масштабируемый

По умолчанию радиусы точек данных, отображаемых на уровне тепловой карт, имеют фиксированный пиксельный радиус для всех уровней масштабирования. По мере масштабирования карт данные объединяются, и слой тепловой карт выглядит иначе. 

Используйте `zoom` выражение, чтобы масштабировать радиус для каждого уровня масштаба, чтобы каждая точка данных указывала на одну и ту же физическую область на карте. Это делает слой тепловой карт более статическим и последовательным. Каждый уровень масштаба на карте имеет вдвое больше пикселей по вертикали и горизонтали, чем предыдущий уровень масштаба. 

При масштабировании радиуса, чтобы он вдвое соответствовал каждому уровню масштабирования, создает тепловую карту, которая выглядит единообразно на всех уровнях масштабирования. Для этого используйте `zoom` с выражением Base 2 `exponential interpolation`, как показано в следующем примере. Масштабировать карту, чтобы увидеть, как тепловая схема масштабируется с учетом масштаба.

<br/>

<iframe height="500" style="width: 100%;" scrolling="no" title="Последовательная тепловая схема масштабируемый" src="//codepen.io/azuremaps/embed/OGyMZr/?height=500&theme-id=0&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
См. Azure Maps <a href='https://codepen.io/azuremaps/pen/OGyMZr/'>масштабируемый</a> (<a href='https://codepen.io/azuremaps'>@azuremaps</a>) на <a href='https://codepen.io'>CodePen</a>с помощью пера.
</iframe>

> [!TIP]
> При включении кластеризации в источнике данных точки, близкие друг к другу, группируются в виде кластеризованной точки. Количество точек в каждом кластере можно использовать в качестве выражения веса для тепловой карт, а также значительно сократить количество отображаемых точек. Число точек в кластере хранится в свойстве `point_count` функции Point: 
> ```JavaScript
> var layer = new atlas.layer.HeatMapLayer(datasource, null, {
>    weight: ['get', 'point_count']
> });
> ```
> Если радиус кластеризации составляет всего несколько пикселей, то в отрисовке отображается немного визуальное различие. Большая часть радиуса группирует несколько точек в каждый кластер и повышает производительность тепловой карты.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о классах и методах, которые используются в этой статье:

> [!div class="nextstepaction"]
> [HeatMapLayer](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.htmlmarker?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"]
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

Дополнительные примеры кода для добавления в карты см. в следующих статьях:

> [!div class="nextstepaction"]
> [Создание источника данных](create-data-source-web-sdk.md)

> [!div class="nextstepaction"]
> [Использование стилистических выражений на основе данных](data-driven-style-expressions-web-sdk.md)
