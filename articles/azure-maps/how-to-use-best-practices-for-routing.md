---
title: Рекомендации для сервиса маршрутов Azure Maps Карты Microsoft Azure
description: Узнайте, как эффективно вести маршрут, используя службу route от Microsoft Azure Maps.
author: philmea
ms.author: philmea
ms.date: 03/11/2020
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.openlocfilehash: 85ce29d088b8fbd110988db67776d89346215e5a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80335420"
---
# <a name="best-practices-for-azure-maps-route-service"></a>Рекомендации для сервиса Azure Maps Route

API-аДИ маршрутных направлений и матрицы маршрутов в [службе маршрутов](https://docs.microsoft.com/rest/api/maps/route) Azure Maps можно использовать для расчета предполагаемого времени прибытия (ETA) для каждого запрошенного маршрута. ApIs маршрута учитывают такие факторы, как информация о дорожном движении в режиме реального времени и исторические данные о дорожном движении, такие как типичная скорость движения в запрашиваемый день недели и время суток. AA возвращают самые короткие или быстрые маршруты, доступные в несколько пунктов назначения одновременно в последовательности или в оптимизированном порядке, в зависимости от времени или расстояния. Пользователи также могут запросить специализированные маршруты и детали для пешеходов, велосипедистов и коммерческих транспортных средств, таких как грузовики. В этой статье мы поделимся рекомендациями по вызову [службы маршрутов](https://docs.microsoft.com/rest/api/maps/route)Azure Maps, и вы узнаете, как к:

* Выберите между API направления маршрута и API маршрутизации Матрицы
* Запрос исторического и прогнозируемого времени в пути, основанного на данных о трафике в реальном времени и исторических
* Запрос деталей маршрута, таких как время и расстояние, для всего маршрута и каждого этапа маршрута
* Запрос маршрута для коммерческого транспортного средства, как грузовик
* Запрос информации о трафике по маршруту, как пробки и информация о платных
* Запрос маршрута, состоящего из одной или нескольких остановок (точки)
* Оптимизируйте маршрут из одной или нескольких остановок, чтобы получить лучший заказ для посещения каждой остановки (путевой точки)
* Оптимизация альтернативных маршрутов с использованием опорных точек. Например, предложите альтернативные маршруты, которые проходят зарядную станцию электромобиля.
* Воспользуйтесь [службой маршрута](https://docs.microsoft.com/rest/api/maps/route) с помощью веб-SDK Azure Maps Web

## <a name="prerequisites"></a>Предварительные требования

Для вызова aPI-аПО Azure Maps необходимо учетную запись Azure Maps и ключ. Для получения дополнительной информации [см. Создать учетную запись](quick-demo-map-app.md#create-an-account-with-azure-maps) и получить [основной ключ](quick-demo-map-app.md#get-the-primary-key-for-your-account). Основной ключ также известен как основной ключ подписки или ключ подписки.

Для получения информации о проверке подлинности в Azure Maps [см.](./how-to-manage-authentication.md) А для получения дополнительной информации об охвате маршрутной службы см. [Routing Coverage](routing-coverage.md)

В этой статье используется [приложение Postman](https://www.postman.com/downloads/) для создания вызовов REST, но вы можете выбрать любую среду разработки API.

## <a name="choose-between-route-directions-and-matrix-routing"></a>Выбирайте между маршрутными направлениями и маршрутизацией матрицы

AA ApIs направления маршрута возвращает инструкции, включая время в пути и координаты для маршрута маршрута. API Route Matrix позволяет рассчитать время и расстояния в пути для набора маршрутов, которые определяются по местоположению происхождения и назначения. Для каждого данного происхождения Matrix API вычисляет стоимость (время и расстояние в пути) от этого происхождения до каждого данного пункта назначения. Все эти AA позволяют указать такие параметры, как желаемое время отправления, время прибытия и тип транспортного средства, например автомобиль или грузовик. Все они используют данные трафика в реальном времени или прогнозы соответственно для возвращения наиболее оптимальных маршрутов.

Рассмотрите возможность вызова AIS маршрутных направлений, если сценарий:

* Запросите кратчайший или быстрый маршрут движения между двумя или более известными местами, чтобы получить точное время прибытия для ваших транспортных средств доставки.
* Запросить подробное руководство маршрутом, включая геометрию маршрута, для визуализации маршрутов на карте
* Учитывая список местонахождения клиентов, вычислите кратчайший возможный маршрут для посещения каждого места клиента и возвращения к истокам. Этот сценарий широко известен как проблема коммивояжера. Вы можете пройти до 150 точек (остановок) в одном запросе.
* Отправка пакетов запросов в API пакетов маршрутных направлений, используя только один вызов API.

Рассмотрите возможность вызова API для ретричной трассировки, если сценарий:

* Рассчитайте время или расстояние между набором происхождения и пунктов назначения. Например, у вас есть 12 водителей, и вы должны найти ближайший доступный драйвер, чтобы забрать доставку еды из ресторана.
* Сортировать потенциальные маршруты по их фактическому расстоянию или времени. Matrix API возвращает только время и расстояния для каждого происхождения и назначения.
* Кластерные данные, основанные на времени в пути или расстояниях. Например, ваша компания имеет 50 сотрудников, найти всех сотрудников, которые живут в течение 20 минут Drive Time от вашего офиса.

Вот сравнение, чтобы показать некоторые возможности маршрутных направлений и Матрицы AIS:

| API Карты Лазурных АТИз | Максимальное количество запросов в запросе | Избегайте областей | Грузовик и электромобиль, разгром | путевые точки и оптимизация коммивояжера | Точки поддержки |
| :--------------: |  :--------------: |  :--------------: | :--------------: | :--------------: | :--------------: |
| Route — Get Route Directions (Маршрут — получение направлений маршрута) | 1 | | X | X | |
| Направления после маршрута | 1 | X | X | X | X |
| Пакет направлений после маршрута | 700 | | X | X | |
| Route — Post Route Matrix Preview (Маршрут — предварительная версия запроса Post матрицы маршрута) | 700 | | X | | |

Чтобы узнать больше о возможностях маршрутизации электромобилей, смотрите наш учебник о том, как маршрутируеэлектрических [транспортных средств с помощью ноутбуков Azure с Python.](tutorial-ev-routing.md)

## <a name="request-historic-and-real-time-data"></a>Запрос исторических данных и данных в режиме реального времени

По умолчанию служба Route предполагает, что режим путешествия является автомобилем, и время отправления теперь. Он возвращает маршрут на основе условий движения в режиме реального времени, если запрос на расчет маршрута не указывает обратное. Фиксированные временные ограничения движения, такие как "Левые повороты не допускаются с 16:00 до 18:00" фиксируются и будут рассматриваться двигателем для движения. Закрытие дорог, как и дорожные работы, будет рассматриваться, если вы специально не запросите маршрут, который игнорирует текущее движение в прямом эфире. Чтобы проигнорировать текущий `traffic` `false` трафик, установите в запросе API.

Расчет маршрута **travelTimeSeconds** значение включает в себя задержку из-за трафика. Он генерируется за счет использования текущих и исторических данных о времени в пути, когда время отправления установлено до сих пор. Если время вылета установлено в будущем, AIS возвращает прогнозируемое время в пути на основе исторических данных.

Если вы включите в запрос параметр **вычисленийTravelTimeFor'all,** то элемент резюме в ответе будет иметь следующие дополнительные поля, включая исторические условия движения:

| Элемент | Описание|
| :--- | :--- |
| noTrafficTraveltimeInSeconds | Ориентировочное время в пути рассчитывается так, как будто нет задержек на маршруте из-за условий движения, например, из-за заторов |
| historicTrafficTraveltimeInSeconds | Расчетное время в пути, рассчитанное с использованием зависящих от времени исторических данных о трафике |
| liveTrafficIncidentsTraveltimeInSeconds | Расчетное время в пути, рассчитанное с использованием данных о скорости в реальном времени |

Следующие разделы демонстрируют, как совершать звонки на AA Route с использованием обсуждаемых параметров.

### <a name="sample-query"></a>Пример запроса

В первом примере ниже время отъезда устанавливается в будущее, на момент написания.

```http
https://atlas.microsoft.com/route/directions/json?subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&api-version=1.0&query=51.368752,-0.118332:51.385426,-0.128929&travelMode=car&traffic=true&departAt=2025-03-29T08:00:20&computeTravelTimeFor=all
```

Ответ содержит элемент резюме, как и ниже. Поскольку время отправления настроено в будущее, значение **trafficDelayInSeconds** равен нулю. Значение **travelTimeInSeconds** рассчитывается с использованием зависящих от времени исторических данных о трафике. Таким образом, в этом случае значение **travelTimeInSeconds** равно историческомузначенимузначению. **historicTrafficTravelTimeInSeconds**

```json
"summary": {
    "lengthInMeters": 2131,
    "travelTimeInSeconds": 248,
    "trafficDelayInSeconds": 0,
    "departureTime": "2025-03-29T08:00:20Z",
    "arrivalTime": "2025-03-29T08:04:28Z",
    "noTrafficTravelTimeInSeconds": 225,
    "historicTrafficTravelTimeInSeconds": 248,
    "liveTrafficIncidentsTravelTimeInSeconds": 248
},
```

### <a name="sample-query"></a>Пример запроса

Во втором примере ниже, у нас есть запрос на вымывание в режиме реального времени, где время отправления сейчас. Это явно не указано в URL, потому что это значение по умолчанию.

```http
https://atlas.microsoft.com/route/directions/json?subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&api-version=1.0&query=47.6422356,-122.1389797:47.6641142,-122.3011268&travelMode=car&traffic=true&computeTravelTimeFor=all
```

Ответ содержит резюме, приведенное ниже. Из-за заторов значение **trafficDelaysInSeconds** больше нуля. Это также больше, чем **historicTrafficTravelTimeInSeconds**.

```json
"summary": {
    "lengthInMeters": 16637, 
    "travelTimeInSeconds": 2905, 
    "trafficDelayInSeconds": 1604, 
    "departureTime": "2020-02-28T01:00:20+00:00",
    "arrivalTime": "2020-02-28T01:48:45+00:00", 
    "noTrafficTravelTimeInSeconds": 872, 
    "historicTrafficTravelTimeInSeconds": 1976, 
    "liveTrafficIncidentsTravelTimeInSeconds": 2905 
},
```

## <a name="request-route-and-leg-details"></a>Запрос маршрута и детали ноги

По умолчанию служба Route вернет массив координат. Ответ будет содержать координаты, которые составляют `points`путь в названном списке. Ответ на маршрут также включает расстояние от начала маршрута и предполагаемое время, прошедшее. Эти значения могут быть использованы для расчета средней скорости для всего маршрута.

На следующем изображении отображается `points` элемент.

<center>

![список точек](media/how-to-use-best-practices-for-routing/points-list-is-hidden-img.png)

</center>

Расширьте `point` элемент, чтобы увидеть список координат для пути:

<center>

![список точек](media/how-to-use-best-practices-for-routing/points-list-img.png)

</center>

AA AA- ИППодслужбы маршрутных направлений поддерживают различные форматы инструкций, которые могут быть использованы путем указания параметра **instructionsType.** Для форматирования инструкций для простой обработки компьютера используйте **инструкцииType-код .** Используйте **инструкцииType'tagged** для отображения инструкций в качестве текста для пользователя. Кроме того, инструкции могут быть отформатированы как текст, где некоторые элементы инструкции отмечены, и инструкция представлена с особым форматированием. Для получения дополнительной [информации смотрите список поддерживаемых типов инструкций.](https://docs.microsoft.com/rest/api/maps/route/postroutedirections#routeinstructionstype)

При запросе инструкций ответ возвращает новый `guidance`элемент под названием . Элемент `guidance` содержит две части информации: пошагзан направления и обобщенные инструкции.

<center>

![Тип инструкций](media/how-to-use-best-practices-for-routing/instructions-type-img.png)

</center>

Элемент `instructions` имеет пошаговых направления для поездки, `instructionGroups` и обобщил инструкции. Каждая инструкция резюме охватывает сегмент поездки, которые могли бы охватывать несколько дорог. AA могут возвращать детали на участках маршрута. например, диапазон координат пробки или текущая скорость движения.

<center>

![Поверните инструкции по очереди](media/how-to-use-best-practices-for-routing/instructions-turn-by-turn-img.png)

</center>

<center>

![Обобщенные инструкции](media/how-to-use-best-practices-for-routing/instructions-summary-img.png)

</center>

## <a name="request-a-route-for-a-commercial-vehicle"></a>Запрос маршрута для коммерческого транспортного средства

Azure Maps Routing AOUT поддерживает рекламные ролики коммерческих транспортных средств, охватывающие рекламные ролики коммерческих грузовиков. AA считают определенные ограничения. Например, высота и вес транспортного средства, а также если транспортное средство перевозит опасные грузы. Например, если транспортное средство перевозит легковоспламеняющиеся средства, двигатель, вывозящий, избегает определенных туннелей, расположенных вблизи жилых районов.

### <a name="sample-query"></a>Пример запроса

Запрос выборки ниже запрашивает маршрут для коммерческого грузовика. Грузовик перевозит опасные отходы класса 1.

```http
https://atlas.microsoft.com/route/directions/json?subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&api-version=1.0&vehicleWidth=2&vehicleHeight=2&vehicleCommercial=true&vehicleLoadType=USHazmatClass1&travelMode=truck&instructionsType=text&query=51.368752,-0.118332:41.385426,-0.128929
```

API маршрута возвращает направления, которые вмещают габариты грузовика и опасных отходов. Вы можете прочитать инструкции по `guidance` маршруту, расширив элемент.

<center>

![Грузовик с хазотами класса 1](media/how-to-use-best-practices-for-routing/truck-with-hazwaste-img.png)

</center>

### <a name="sample-query"></a>Пример запроса

Изменение класса Hazmat в США, из приведенного выше запроса, приведет к по-другому маршруту для размещения этого изменения.

```http
https://atlas.microsoft.com/route/directions/json?subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&api-version=1.0&vehicleWidth=2&vehicleHeight=2&vehicleCommercial=true&vehicleLoadType=USHazmatClass9&travelMode=truck&instructionsType=text&query=51.368752,-0.118332:41.385426,-0.128929
```

Ответ ниже для грузовика, перевозящего класс 9 опасных материалов, которые являются менее опасными, чем класс 1 опасных материалов. Когда вы `guidance` расширяете элемент для чтения направлений, вы заметите, что направления не то же самое. Есть более маршрут инструкции для грузовика, перевозящего класса 1 опасных материалов.

<center>

![Грузовик с хосотходом класса 9](media/how-to-use-best-practices-for-routing/truck-with-hazwaste9-img.png)

</center>

## <a name="request-traffic-information-along-a-route"></a>Запрос информации о трафике по маршруту

С помощью ApIs Azure Maps Route Direction разработчики могут `sectionType` запрашивать детали для каждого типа раздела, включив параметр в запрос. Например, можно запросить информацию о скорости для каждого сегмента пробки. Обратитесь к [списку значений для ключа sectionType,](https://docs.microsoft.com/rest/api/maps/route/getroutedirections#sectiontype) чтобы узнать о различных деталях, которые вы можете запросить.

### <a name="sample-query"></a>Пример запроса

Следующий запрос устанавливает `sectionType` `traffic`к . Он запрашивает разделы, содержащие информацию о трафике из Сиэтла в Сан-Диего.

```http
https://atlas.microsoft.com/route/directions/json?subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&api-version=1.0&sectionType=traffic&query=47.6062,-122.3321:32.7157,-117.1611
```

Ответ содержит разделы, которые подходят для движения по заданному координат.

<center>

![разделы трафика](media/how-to-use-best-practices-for-routing/traffic-section-type-img.png)

</center>

Эта опция может быть использована для окрашивания секций при визуализации карты, как на рисунке ниже: 

<center>

![разделы трафика](media/how-to-use-best-practices-for-routing/show-traffic-sections-img.png)

</center>

## <a name="calculate-and-optimize-a-multi-stop-route"></a>Рассчитать и оптимизировать маршрут с несколькими остановками

В настоящее время Azure Maps предоставляет две формы оптимизации маршрутов:

* Оптимизация на основе запрашиваемого типа маршрута без изменения порядка путевых точек. Вы можете найти [поддерживаемые типы маршрутов здесь](https://docs.microsoft.com/rest/api/maps/route/postroutedirections#routetype)

* Оптимизация коммивояжера, которая меняет порядок точек для получения наилучшего заказа для посещения каждой остановки

Для маршрутизаний с несколькими остановками в одном запросе маршрута может быть указано до 150 точек пути. Местоположения координат начального и конца могут быть такими же, как и в случае с поездкой туда и обратно. Но для расчета маршрута необходимо предоставить хотя бы одну дополнительную точку. Точки пути могут быть добавлены в запрос между координатами происхождения и назначения.

Если вы хотите оптимизировать лучший заказ для посещения заданных путевых точек, то вам нужно указать **computeBestOrder'true**. Этот сценарий также известен как проблема оптимизации коммивояжера.

### <a name="sample-query"></a>Пример запроса

Следующий запрос запрашивает путь для шести `computeBestOrder` путевых `false`точек, с набором параметра. Это также значение по умолчанию для `computeBestOrder` параметра.

```http
https://atlas.microsoft.com/route/directions/json?api-version=1.0&subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&computeBestOrder=false&query=47.606544,-122.336502:47.759892,-122.204821:47.670682,-122.120415:47.480133,-122.213369:47.615556,-122.193689:47.676508,-122.206054:47.495472,-122.360861
```

В ответе описывается длина пути, которая составит 140 851 метр, и что для этого потребуется 9991 секунда.

<center>

![Неоптимизированный ответ](media/how-to-use-best-practices-for-routing/non-optimized-response-img.png)

</center>

На рисунке ниже иллюстрируется путь, возникающий в результате этого запроса. Этот путь является одним из возможных маршрутов. Это не оптимальный путь, основанный на времени или расстоянии.

<center>

![Неоптимизированное изображение](media/how-to-use-best-practices-for-routing/non-optimized-image-img.png)

</center>

Порядок путевых точек маршрута: 0, 1, 2, 3, 4, 5 и 6.

### <a name="sample-query"></a>Пример запроса

Следующий запрос запрашивает путь для тех же шести точек пути, как и в приведенной выше выборке. На этот `computeBestOrder` раз параметр установлен `true` (оптимизация коммивояжера).

```http
https://atlas.microsoft.com/route/directions/json?api-version=1.0&subscription-key=<Your-Azure-Maps-Primary-Subscription-Key>&computeBestOrder=true&query=47.606544,-122.336502:47.759892,-122.204821:47.670682,-122.120415:47.480133,-122.213369:47.615556,-122.193689:47.676508,-122.206054:47.495472,-122.360861
```

В ответе описывается длина пути, которая должна быть 91 814 метров, и что это займет 7797 секунд, чтобы пройти этот путь. Расстояние и время в пути здесь ниже, потому что API вернул оптимизированный маршрут.

<center>

![Неоптимизированный ответ](media/how-to-use-best-practices-for-routing/optimized-response-img.png)

</center>

На рисунке ниже иллюстрируется путь, возникающий в результате этого запроса.

<center>

![Неоптимизированное изображение](media/how-to-use-best-practices-for-routing/optimized-image-img.png)

</center>

Оптимальный маршрут имеет следующий порядок: 0, 5, 1, 2, 4, 3 и 6.

>[!TIP]
> Оптимизированная информация о порядке путевых точек от службы Routing предоставляет набор индексов. Они исключают индексы происхождения и назначения. Для учета происхождения необходимо приравнить эти значения к 1. Затем добавьте пункт назначения до конца, чтобы получить полный упорядоченный список путевых точек.

## <a name="calculate-and-bias-alternative-routes-using-supporting-points"></a>Рассчитывать и уклонить альтернативные маршруты с использованием опорных точек

Могут возникнуть ситуации, когда требуется реконструировать маршрут для расчета нуля или более альтернативных маршрутов для эталонного маршрута. Например, вы можете показать клиентам альтернативные маршруты, которые проходят ваш розничный магазин. В этом случае необходимо смещение местоположения с помощью точек поддержки. Вот шаги, чтобы смещение местоположения:

1. Рассчитать маршрут как есть и получить путь от ответа маршрута
2. Используйте маршрут, чтобы найти нужные места вдоль или вблизи маршрута. Например, можно использовать [API-файл](https://docs.microsoft.com/rest/api/maps/search/getsearchpoi) Azure Maps Point of Interest или запросить собственные данные в базе данных.  
3. Заказать локации на основе расстояния от начала маршрута
4. Добавьте эти местоположения в качестве вспомогательных точек в новый запрос маршрута в [API Направления Маршрутов Post Routes.](https://docs.microsoft.com/rest/api/maps/route/postroutedirections) Чтобы узнать больше о точках [Post Route Directions API documentation](https://docs.microsoft.com/rest/api/maps/route/postroutedirections#supportingpoints)поддержки, см. 

При вызове [API Направления по почте](https://docs.microsoft.com/rest/api/maps/route/postroutedirections)можно установить минимальное время отклонения или ограничения расстояния, а также точки поддержки. Используйте эти параметры, если вы хотите предложить альтернативные маршруты, но вы также хотите ограничить время в пути. При использовании этих ограничений альтернативные маршруты будут следовать по маршруту отсчета от точки происхождения для заданного времени или расстояния. Другими словами, другие маршруты отличаются от эталонного маршрута в заданных ограничениях.

На рисунке ниже приводится пример визуализации альтернативных маршрутов с определенными ограничениями отклонения времени и расстояния.

<center>

![Альтернативные маршруты](media/how-to-use-best-practices-for-routing/alternative-routes-img.png)

</center>

## <a name="use-the-routing-service-in-a-web-app"></a>Использование службы routing в веб-приложении

Лазурные карты Web SDK предоставляет [модуль службы](https://docs.microsoft.com/javascript/api/azure-maps-rest/?view=azure-maps-typescript-latest). Этот модуль является библиотекой помощников, которая упрощает использование API Azure Maps REST в веб-приложениях или приложениях Node.js с использованием JavaScript или TypeScript. Модуль службы может быть использован для визуализации возвращенных маршрутов на карте. Модуль автоматически определяет, какой API использовать с запросами GET и POST.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше, пожалуйста, смотрите:

> [!div class="nextstepaction"]
> [Служба маршрутного маршрута Azure Maps](https://docs.microsoft.com/rest/api/maps/route)

> [!div class="nextstepaction"]
> [Как использовать модуль службы](https://docs.microsoft.com/azure/azure-maps/how-to-use-services-module)

> [!div class="nextstepaction"]
> [Показать маршрут на карте](https://docs.microsoft.com/azure/azure-maps/map-route)

> [!div class="nextstepaction"]
> [Пакет NPM Карты Лазурного](https://www.npmjs.com/package/azure-maps-rest  )
