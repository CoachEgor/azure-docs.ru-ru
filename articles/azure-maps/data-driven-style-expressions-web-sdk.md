---
title: Выражения стилей, управляемых данными, в веб-SDK Azure Maps Карты Microsoft Azure
description: В этой статье вы узнаете о том, как использовать выражения стилей, управляемых данными, в веб-SDK Microsoft Azure Maps Web SDK.
author: rbrundritt
ms.author: richbrun
ms.date: 4/4/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: cpendleton
ms.custom: codepen
ms.openlocfilehash: 3f15033095b02dd35c2d8d7bda60ca184df64c9a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79475025"
---
# <a name="data-driven-style-expressions-web-sdk"></a>Выражения стиля, управляемые данными (Web SDK)

Выражения позволяют применить бизнес-логику к параметры укладки, которые наблюдают свойства, определенные в каждой форме в источнике данных. Выражения могут фильтровать данные в источнике данных или слое. Выражения могут состоять из условной логики, например, если-заявления. И они могут быть использованы для манипулирования данными с использованием: строки операторов, логических операторов и математических операторов.

Стили, управляемые данными, уменьшают объем кода, необходимого для реализации бизнес-логики вокруг укладки. При использовании со слоями выражения оцениваются во время рендеринга на отдельном потоке. Эта функциональность обеспечивает повышенную производительность по сравнению с оценкой бизнес-логики в потоке uI.

Это видео предоставляет обзор укладки на основе данных в Azure Maps Web SDK.

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Data-Driven-Styling-with-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

Выражения представлены как массивы JSON. Первым элементом выражения в массиве является строка, которая определяет имя оператора выражения. Например, "к" или "дело". Следующие элементы (если таковые имеются) являются аргументами к выражению. Каждый аргумент является либо буквальное значение (строка, `null`число, булейт, или ), или другой массив выражения. Следующий псевдокод определяет основную структуру выражения. 

```javascript
[ 
    expression_operator, 
    argument0, 
    argument1, 
    …
] 
```

Веб-SDK Azure Maps поддерживает множество типов выражений. Выражения могут быть использованы самостоятельно или в сочетании с другими выражениями.

| Тип выражений | Описание |
|---------------------|-------------|
| [Совокупное выражение](#aggregate-expression) | Выражение, определяющее расчет, обрабатываемый по набору `clusterProperties` данных и `DataSource`который может использоваться с опцией . |
| [Булинвыражения](#boolean-expressions) | Выражения boolean обеспечивают комплект выражений boolean операторов для оценивать сравнения boolean. |
| [Выражения цвета](#color-expressions) | Выражения цвета упрощают создание и манипулирование значениями цвета. |
| [Условные выражения](#conditional-expressions) | Условные выражения предоставляют логические операции, похожие на if-statements. |
| [Выражения данных](#data-expressions) | Обеспечивает доступ к данным о свойствах в функции. |
| [Интерполяция и шаг выражения](#interpolate-and-step-expressions) | Интерполяция и выражаемые выражения могут быть использованы для расчета значений по интерполированной кривой или функции шага. |
| [Специфические выражения слоя](#layer-specific-expressions) | Специальные выражения, применимые только к одному слою. |
| [Математические выражения](#math-expressions) | Предоставляет математическим операторам выполнение расчетов на основе данных в рамках выражения. |
| [Выражения оператора строки](#string-operator-expressions) | Выражения оператора строк выполняют операции преобразования на строках, таких как конкатирование и преобразование корпуса. |
| [Введите выражения](#type-expressions) | Выражения типа предоставляют инструменты для тестирования и преобразования различных типов данных, таких как строки, числа и значения boolean. |
| [Переменные связывающие выражения](#variable-binding-expressions) | Переменные связывающие выражения хранят результаты вычисления в переменной и ссылаются в другом месте в выражении несколько раз без перерасчета сохраненного значения. |
| [Увеличить выражение](#zoom-expression) | Извлекает текущий уровень масштабирования карты во время рендера. |

Все примеры в этом документе используют следующую функцию для демонстрации различных способов использования различных типов выражений. 

```javascript
{
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [-122.13284, 47.63699]
    },
    "properties": { 
        "id": 123,
        "entityType": "restaurant",
        "revenue": 12345,
        "subTitle": "Building 40", 
        "temperature": 72,
        "title": "Cafeteria", 
        "zoneColor": "red"
    }
}
```

## <a name="data-expressions"></a>Выражения данных

Выражения данных обеспечивают доступ к данным свойств в объекте. 

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['at', number, array]` | объект | Извлекает элемент из массива. |
| `['geometry-type']` | строка | Получает тип геометрии функции: Point, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon. |
| `['get', string]` | значение | Получает значение свойства из свойств текущей функции. Возвращает нулевую, если запрашиваемое свойство отсутствует. |
| `['get', string, object]` | значение | Получает стоимость свойства от свойств предоставленного объекта. Возвращает нулевую, если запрашиваемое свойство отсутствует. |
| `['has', string]` | Логическое | Определяет, имеют сявру объекта указанное свойство. |
| `['has', string, object]` | Логическое | Определяет, имеют ли свойства объекта указанное свойство. |
| `['id']` | значение | Получает идентификатор функции, если он имеет один. |
| `['length', string | array]` | number | Получает длину строки или массива. |
| `['in', boolean | string | number, array]` | Логическое | Определяет, существует ли элемент в массиве |
| `['in', substring, string]` | Логическое | Определяет, существует ли подстрока в строке |

**Примеры**

Свойства объекта можно получить непосредственно в выражении `get` с помощью выражения. Этот пример использует значение объекта "zoneColor" для определения цветового свойства слоя пузыря. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: ['get', 'zoneColor'] //Get the zoneColor value.
});
```

Приведенный выше пример будет работать нормально, `zoneColor` если все объекты имеют свойство. Если они этого не сделают, цвет, скорее всего, откат к "черным". Чтобы изменить цвет резервного `case` копирования, используйте выражение в сочетании с выражением, `has` чтобы проверить, существует ли свойство. Если свойства не существует, верните запасной цвет.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case', //Use a conditional case expression.

        ['has', 'zoneColor'],   //Check to see if feature has a "zoneColor" property
        ['get', 'zoneColor'],   //If it does, use it.

        'blue'  //If it doesn't, default to blue.
    ]
});
```

Слои пузыря и символа будут отображать координаты всех форм в источнике данных по умолчанию. Такое поведение может выделить вершины полигона или линии. Вариант `filter` слоя можно использовать для ограничения типа геометрии отображаемых `['geometry-type']` объектов, используя выражение в булеане. Следующий пример ограничивает слой пузыря `Point` так, что только объекты отображаются.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['==', ['geometry-type'], 'Point']
});
```

Следующий пример `Point` позволяет `MultiPoint` визуализировать как, так и функции. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]
});
```

Аналогичным образом, контур полигонов будет отображаться в слоях строки. Чтобы отключить это поведение в слое строки, добавьте фильтр, который только позволяет `LineString` и `MultiLineString` функции.  

## <a name="math-expressions"></a>Математические выражения

Математические выражения предоставляют математическим операторам выполнение расчетов на основе данных в рамках выражения.

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['+', number, number, …]` | number | Рассчитывает сумму указанных чисел. |
| `['-', number]` | number | Вычитает 0 по указанному номеру. |
| `['-', number, number]` | number | Вычитает первые числа по второму номеру. |
| `['*', number, number, …]` | number | Умножает указанные числа вместе. |
| `['/', number, number]` | number | Разделяет первый номер на второй номер. |
| `['%', number, number]` | number | Вычисляет остаток при делении первого числа на второе число. |
| `['^', number, number]` | number | Рассчитывает значение первого значения, поднятого на мощность второго числа. |
| `['abs', number]` | number | Вычисляет абсолютное значение заданного числа. |
| `['acos', number]` | number | Вычисляет арккосин указанного числа. |
| `['asin', number]` | number | Вычисляет дугу указанного числа. |
| `['atan', number]` | number | Вычисляет arctangent указанного числа. |
| `['ceil', number]` | number | Округляет число до следующего целого целого целого. |
| `['cos', number]` | number | Вычисляет cos указанного числа. |
| `['e']` | number | Возвращает математическую константу. `e` |
| `['floor', number]` | number | Округляет число вниз к предыдущему целому целостного. |
| `['ln', number]` | number | Высчитывает естественный logarithm указанного числа. |
| `['ln2']` | number | Возвращает математическую константу. `ln(2)` |
| `['log10', number]` | number | Рассчитывает базовый-десять logarithm указанного числа. |
| `['log2', number]` | number | Рассчитывает базу-два logarithm указанного числа. |
| `['max', number, number, …]` | number | Вычисляет максимальное число в указанном наборе чисел. |
| `['min', number, number, …]` | number | Вычисляет минимальное число в указанном наборе чисел. |
| `['pi']` | number | Возвращает математическую константу. `PI` |
| `['round', number]` | number | Округляет число до ближайшего целых рядов. Значения на полпути округлены от нуля. Например, `['round', -1.5]` оценивается до -2. |
| `['sin', number]` | number | Вычисляет синус указанного числа. |
| `['sqrt', number]` | number | Вычисляет квадратный корень заданного числа. |
| `['tan', number]` | number | Вычисляет касательную указанного числа. |

## <a name="aggregate-expression"></a>Совокупное выражение

Совокупное выражение определяет вычисление, обрабатываемый по набору `clusterProperties` данных `DataSource`и который может использоваться с опцией . Выход этих выражений должен быть числом или булеаном. 

Совокупное выражение принимает три значения: значение оператора и начальное значение, а также выражение для извлечения свойства из каждой функции в данных для применения агрегированной операции. Это выражение имеет следующий формат:

```javascript
[operator: string, initialValue: boolean | number, mapExpression: Expression]
```

- оператор: функция выражения, которая затем применяется к против `mapExpression` всех значений, рассчитанных для каждой точки в кластере. Поддерживаемые операторы: 
    - Для чисел: `+`, `*`, `max``min`
    - Для булаев: `all`,`any`
- initialValue: Начальное значение, в котором первое расчетное значение агрегируется по отношению.
- mapExpression: Выражение, которое применяется к каждой точке набора данных.

**Примеры**

Если все объекты в `revenue` наборе данных имеют свойство, то это число. Затем можно рассчитать общую выручку всех точек в кластере, которые создаются из набора данных. Этот расчет выполняется с использованием следующего совокупного выражения:`['+', 0, ['get', 'revenue']]`

## <a name="boolean-expressions"></a>Логические выражения

Выражения boolean обеспечивают комплект выражений boolean операторов для оценивать сравнения boolean.

При сравнении значений сравнение строго набрано. Значения разных типов всегда считаются неравными. Случаи, когда типы, как известно, отличаются во время разбора, считаются недействительными и появляются ошибка разбора. 

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['! ', boolean]` | Логическое | Логическое отрицание. Возвращает, `true` если `false`вход, `false` и если вход `true`. |
| `['!= ', value, value]` | Логическое | Возвращает, `true` если значения ввода не `false` равны, в противном случае. |
| `['<', value, value]` | Логическое | Возвращает, `true` если первый вход строго меньше `false` второго, в противном случае. Аргументы должны быть либо как строки или оба числа. |
| `['<=', value, value]` | Логическое | Возвращает, `true` если первый вход меньше или равен второму, `false` в противном случае. Аргументы должны быть либо как строки или оба числа. |
| `['==', value, value]` | Логическое | Возвращается, `true` если значения ввода `false` равны, в противном случае. Аргументы должны быть либо как строки или оба числа. |
| `['>', value, value]` | Логическое | Возвращает, `true` если первый вход строго больше, `false` чем второй, в противном случае. Аргументы должны быть либо как строки или оба числа. |
| `['>=' value, value]` | Логическое | Возвращает, `true` если первый вход больше или равен второму, `false` в противном случае. Аргументы должны быть либо как строки или оба числа. |
| `['all', boolean, boolean, …]` | Логическое | Возвращает, `true` если все `true`входы, `false` в противном случае. |
| `['any', boolean, boolean, …]` | Логическое | Возвращает, `true` если какой-либо из `true`входов, `false` в противном случае. |

## <a name="conditional-expressions"></a>Условные выражения

Условные выражения предоставляют логические операции, похожие на if-statements.

Следующие выражения выполняют условные логические операции на входных данных. Например, `case` выражение предоставляет логику "если/то/else", в то время как `match` выражение подобно "переключатель-заявление". 

### <a name="case-expression"></a>Выражение дела

Выражение `case` — это тип условного выражения, который обеспечивает логику "если/тогда/else". Этот тип выражения проходит через список условий булеи. Он возвращает выходное значение первого состояния булеана, чтобы оценить истину.

Следующий псевдокод определяет структуру `case` выражения. 

```javascript
[
    'case',
    condition1: boolean, 
    output1: value,
    condition2: boolean, 
    output2: value,
    ...,
    fallback: value
]
```

**Пример**

Следующий пример шагает через различные условия boolean `true`до тех пор пока он не найти одно которое оценивает к, и после этого возвращает то associated значение. Если состояние boolean не `true`оценивается, резервное значение будет возвращено. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case',

        //Check to see if the first boolean expression is true, and if it is, return its assigned result.
        ['has', 'zoneColor'],
        ['get', 'zoneColor'],

        //Check to see if the second boolean expression is true, and if it is, return its assigned result.
        ['all', ['has', ' temperature '], ['>', ['get', 'temperature'], 100]],
        'red',

        //Specify a default value to return.
        'green'
    ]
});
```

### <a name="match-expression"></a>Выражение соответствия

Выражение `match` — это тип условного выражения, обеспечивающий коммутатор-заявление, как логика. Входной может быть любым `['get', 'entityType']` выражением, например, возвращает строку или число. Каждая этикетка должна быть либо одной буквальной стоимости, либо массивом буквальных значений, значения которых должны быть все строки или все цифры. Входные значения совпадают, если какое-либо из значений в массиве совпадает. Каждая этикетка должна быть уникальной. Если тип ввода не соответствует типу меток, результатом будет резервное значение.

Следующий псевдокод определяет структуру `match` выражения. 

```javascript
[
    'match',
    input: number | string,
    label1: number | string | (number | string)[], 
    output1: value,
    label2: number | string | (number | string)[], 
    output2: value,
    ...,
    fallback: value
]
```

**Примеры**

Ниже приводится следующий пример `entityType` свойства объекта point в слое пузыря, который ищет совпадение. Если он находит совпадение, то указанное значение возвращается или возвращает значение резервного копирования.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        'restaurant', 'red',
        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

В следующем примере используется массив для списка набора меток, которые должны вернуть одно и то же значение. Этот подход является гораздо более эффективным, чем перечисление каждой этикетки по отдельности. В этом случае, `entityType` если свойство является «рестораном» или «grocery_store», цвет «красный» будет возвращен.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        ['restaurant', 'grocery_store'], 'red',

        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

В следующем примере используется выражение соответствия для выполнения фильтра типа "в массиве" или "массив содержит". В этом случае выражение фильтрует данные, имеющие значение идентификатора, содеянное в списке разрешенных идентификаторов. При использовании выражений с фильтрами результат должен быть значением Boolean.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: [
        'match',  

        //Get the property to match.
        ['get', 'id'],  

         //List of values to match.
        [24, 53, 98], 

        //If there is a match, return true.
        true,
    
        //Otherwise return false.
        false
    ]
});
```

### <a name="coalesce-expression"></a>Выражение Коалесса

Выражение `coalesce` проходит через набор выражений до получения первого значения, не связанного с нулем, и возвращает это значение. 

Следующий псевдокод определяет структуру `coalesce` выражения. 

```javascript
[
    'coalesce', 
    value1, 
    value2, 
    …
]
```

**Пример**

В следующем примере `coalesce` используется `textField` выражение для установки опции слоя символа. Если `title` свойство отсутствует в функции `null`или установить, выражение `subtitle` будет пытаться искать `null`свойство, если его отсутствует или , то он будет падать обратно в пустую строку. 

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'coalesce',

            //Try getting the title property.
            ['get', 'title'],

            //If there is no title, try getting the subtitle. 
            ['get', 'subtitle'],

            //Default to an empty string.
            ''
        ]
    }
});
```

В следующем примере используется `coalesce` выражение для извлечения первого доступного значка изображения, доступного на спрайте карты, из списка указанных имен изображений.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    iconOptions: {
        image: [
            'coalesce',

            //Try getting the image with id 'missing-image'.
            ['image', 'missing-image'],

            //Specify an image id to fallback to. 
            'marker-blue'
        ]
    }
});
``` 

## <a name="type-expressions"></a>Введите выражения

Выражения типа предоставляют инструменты для тестирования и преобразования различных типов данных, таких как строки, числа и значения boolean.

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['literal', array]`<br/><br/>`['literal', object]` | объект \| массива | Возвращает буквальное значение массива или объекта. Используйте это выражение, чтобы предотвратить оценку массива или объекта как выражения. Это необходимо, когда массив или объект должен быть возвращен выражением. |
| `['image', string]` | строка | Проверяет, загружается ли указанный идентификатор изображения в спрайт изображения карт. Если это так, идентификатор возвращается, в противном случае нулевые возвращается. |
| `['to-boolean', value]` | Логическое | Преобразует входное значение в булеан. Результатом `false` является, когда вход является `0`пустой строкой, `false` `null`, или `NaN`; в `true`противном случае его . |
| `['to-color', value]`<br/><br/>`['to-color', value1, value2…]` | color | Преобразует значение ввода в цвет. Если предусмотрено несколько значений, каждое из них оценивается в порядке до получения первого успешного преобразования. Если ни один из входов не может быть преобразован, выражение является ошибкой. |
| `['to-number', value]`<br/><br/>`['to-number', value1, value2, …]` | number | Преобразует значение ввода в число, если это возможно. Если вход `null` или, `false`результат 0. Если вход, `true`результат 1. Если вход строка— строка, она преобразуется в число, используя функцию строки [ToNumber](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) спецификации языка ECMAScript. Если предусмотрено несколько значений, каждое из них оценивается в порядке до получения первого успешного преобразования. Если ни один из входов не может быть преобразован, выражение является ошибкой. |
| `['to-string', value]` | строка | Преобразует значение ввода в строку. Если вход, `null`результат `""`. Если вход является булеаном, `"true"` результат `"false"`или . Если ввод — это число, он преобразуется в строку, используя функцию номера [ToString](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) спецификации языка ECMAScript. Если вход цвет, он преобразуется в csS RGBA `"rgba(r,g,b,a)"`цветовая строка. В противном случае ввод преобразуется в строку с использованием функции [JSON.stringify](https://tc39.github.io/ecma262/#sec-json.stringify) спецификации языка ECMAScript. |
| `['typeof', value]` | строка | Возвращает строку, описывающую тип данного значения. |

> [!TIP]
> Если сообщение об `Expression name must be a string, but found number instead. If you wanted a literal array, use ["literal", [...]].` ошибке, аналогичное, появляется в консоли браузера, то это означает, что где-то в коде есть выражение с массивом, который не имеет строки для его первого значения. Если вы хотите, чтобы выражение вернуло массив, оберните массив выражением. `literal` В следующем примере `offset` устанавливается опция значка слоя символа, который должен `match` быть массивом, содержащим два числа, используя выражение для выбора между двумя смещенными значениями на основе значения `entityType` свойства объекта.
>
> ```javascript
> var layer = new atlas.layer.SymbolLayer(datasource, null, {
>     iconOptions: {
>         offset: [
>             'match',
>
>             //Get the entityType value.
>             ['get', 'entityType'],
>
>             //If the entity type is 'restaurant', return a different pixel offset. 
>             'restaurant', ['literal', [0, -10]],
>
>             //Default to value.
>             ['literal', [0, 0]]
>         ]
>     }
> });
> ```

## <a name="color-expressions"></a>Выражения цвета

Выражения цвета упрощают создание и манипулирование значениями цвета.

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['rgb', number, number, number]` | color | Создает цветовое значение из *красного,* *зеленого*и `0` `255` *синего* компонентов, которые должны варьироваться между и, и альфа-компонент `1`. Если какой-либо компонент находится вне диапазона, выражение является ошибкой. |
| `['rgba', number, number, number, number]` | color | Создает цветовое значение из *красного,* *зеленого,* `255` *синего* компонентов, которые должны варьироваться между `0` и, и альфа-компонент в пределах `0` диапазона и `1`. Если какой-либо компонент находится вне диапазона, выражение является ошибкой. |
| `['to-rgba']` | \[номер, номер, номер, номер\] | Возвращает четырехэлементный массив, содержащий *красный,* *зеленый,* *синий*и *альфа-компоненты* ввходного цвета, в этом порядке. |

**Пример**

Следующий пример создает значение цвета RGB, `255`которое имеет *красное* значение, и `2.5` *зеленые* и `temperature` *синие* значения, которые рассчитываются путем умножения на значение свойства. По мере изменения температуры, цвет будет меняться на различные оттенки *красного*.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'rgb', //Create a RGB color value.

        255,    //Set red value to 255.

        ['*', 2.5, ['get', 'temperature']], //Multiple the temperature by 2.5 and set the green value.

        ['*', 2.5, ['get', 'temperature']]  //Multiple the temperature by 2.5 and set the blue value.
    ]
});
```

## <a name="string-operator-expressions"></a>Выражения оператора строки

Выражения оператора строк выполняют операции преобразования на строках, таких как конкатирование и преобразование корпуса. 

| Выражение | Возвращаемый тип | Описание |
|------------|-------------|-------------|
| `['concat', string, string, …]` | строка | Конкатирует несколько строк вместе. Каждое значение должно быть строкой. Используйте `to-string` выражение типа для преобразования других типов значений в строку, если это необходимо. |
| `['downcase', string]` | строка | Преобразует заданную строку в нижний регистр. |
| `['upcase', string]` | строка | Преобразует заданную строку в верхний регистр. |

**Пример**

Следующий пример преобразует `temperature` свойство элемента точки в строку, а затем конкатирует "ЗФ" до конца.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: ['concat', ['to-string', ['get', 'temperature']], '°F'],

        //Some additional style options.
        offset: [0, -1.5],
        size: 12,
        color: 'white'
    }
});
```

Вышеупомянутое выражение отображает штифт на карте с текстом "64"F", наложенным на него, как показано на рисунке ниже.

<center>

![Пример](media/how-to-expressions/string-operator-expression.png) выражения оператора строк</center>

## <a name="interpolate-and-step-expressions"></a>Интерполяция и шаг выражения

Интерполяция и выражаемые выражения могут быть использованы для расчета значений по интерполированной кривой или функции шага. Эти выражения принимают в выражении, которое возвращает числовое `['get',  'temperature']`значение в качестве их ввода, например. Значение ввода оценивается по парам входных и выходных значений, чтобы определить значение, которое наилучшим образом соответствует интерполированной кривой или функции шага. Значения вывода называются "остановками". Значения ввода для каждой остановки должны быть числом и быть в порядке возрастания. Значения вывода должны быть числом и массивом чисел или цветом.

### <a name="interpolate-expression"></a>Интерполоматия выражение

Выражение `interpolate` может быть использовано для расчета непрерывного, плавного набора значений путем интерполирования между значениями стопа. Выражение, `interpolate` возвращающее значения цвета, создает градиент цвета, из которого выбираются значения результата.

Существует три типа методов интерполяции, `interpolate` которые могут быть использованы в выражении:
 
* `['linear']`- Интерполирует линейно между парой остановок.
* `['exponential', base]`- Интерполионатирует экспоненциально между остановками. Значение `base` контролирует скорость, с которой увеличивается объем производства. Более высокие значения делают увеличение объема производства более к высокому концу диапазона. Значение, `base` близкое к 1, создает выход, который увеличивается более линейно.
* `['cubic-bezier', x1, y1, x2, y2]`- Интерполяты с использованием [кубической кривой Безье,](https://developer.mozilla.org/docs/Web/CSS/timing-function) определяемой заданными контрольными точками.

Вот пример того, как выглядят эти различные типы интерполяций. 

| Линейная  | Экспоненциальная | Кривая Безье третьего порядка |
|---------|-------------|--------------|
| ![Линейный график интерполяции](media/how-to-expressions/linear-interpolation.png) | ![График экспоненциальной интерполяции](media/how-to-expressions/exponential-interpolation.png) | ![График линии интерполяции Кубик Безье](media/how-to-expressions/bezier-curve-interpolation.png) |

Следующий псевдокод определяет структуру `interpolate` выражения. 

```javascript
[
    'interpolate',
    interpolation: ['linear'] | ['exponential', base] | ['cubic-bezier', x1, y1, x2, y2],
    input: number,
    stopInput1: number, 
    stopOutput1: value1,
    stopInput2: number, 
    stopOutput2: value2, 
    ...
]
```

**Пример**

В следующем примере `linear interpolate` используется `color` выражение для установки свойства `temperature` слоя пузыря на основе свойства элемента точечной. Если `temperature` значение меньше 60, "синий" будет возвращен. Если это между 60 и менее 70, желтый будет возвращен. Если это между 70 и менее 80, "оранжевый" будет возвращен. Если это 80 или больше, "красный" будет возвращен.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['get', 'temperature'],
        50,        
        'blue',
        60,
        'yellow',
        70,
        'orange',
        80,
        'red'
    ]
});
```

Следующее изображение демонстрирует, как цвета выбираются для вышеуказанного выражения.
 
<center>

![Пример](media/how-to-expressions/interpolate-expression-example.png) экспрессии Интерпола</center>

### <a name="step-expression"></a>Выражение шага

Выражение `step` может быть использовано для расчета дискретных, ступенчатых значений результата путем оценки [функции,](http://mathworld.wolfram.com/PiecewiseConstantFunction.html) определяемой остановками. 

Следующий псевдокод определяет структуру `step` выражения. 

```javascript
[
    'step',
    input: number,
    output0: value0,
    stop1: number, 
    output1: value1,
    stop2: number, 
    output2: value2, 
    ...
]
```

Выражения шага возвращают выходное значение стопа непосредственно перед входной стоимостью или первое входной значение, если входные данные меньше первой остановки. 

**Пример**

В следующем примере `step` используется `color` выражение для установки свойства `temperature` слоя пузыря на основе свойства элемента точечной. Если `temperature` значение меньше 60, "синий" будет возвращен. Если это между 60 и менее 70, "желтый" будет возвращен. Если это между 70 и менее 80, "оранжевый" будет возвращен. Если это 80 или больше, "красный" будет возвращен.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'step',
        ['get', 'temperature'],
        'blue',
        60,
        'yellow',
        70,
        'orange',
        80,
        'red'
    ]
});
```

Следующее изображение демонстрирует, как цвета выбираются для вышеуказанного выражения.
 
<center>

![Пример выражения шагов](media/how-to-expressions/step-expression-example.png)
</center>

## <a name="layer-specific-expressions"></a>Выражения, специфизные для слоя

Специальные выражения, которые применяются только к определенным слоям.

### <a name="heat-map-density-expression"></a>Выражение плотности тепловой карты

Выражение плотности тепловой карты извлекает значение плотности тепловой карты `['heatmap-density']`для каждого пикселя в слое тепловой карты и определяется как. Это значение представляет `0` собой `1`число между и . Он используется в сочетании `interpolation` `step` с или выражение для определения градиента цвета, используемого для окраски тепловой карты. Это выражение может быть использовано только в [варианте цвета](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest#color) слоя тепловой карты.

> [!TIP]
> Цвет индекса 0 в экспрессионном выражении или цвете шага по умолчанию определяет цвет области, где нет данных. Цвет индекса 0 может быть использован для определения фонового цвета. Многие пользователи предпочитают использовать для этого прозрачный или полупрозрачный черный цвет.

**Пример**

Этот пример использует выражение интерполяции лайнера для создания плавного градиента цвета для визуализации тепловой карты. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['heatmap-density'],
        0, 'transparent',
        0.01, 'purple',
        0.5, '#fb00fb',
        1, '#00c3ff'
    ]
});
```

В дополнение к использованию гладкого градиента для окраски тепловой карты, `step` цвета могут быть указаны в наборе диапазонов с помощью выражения. Использование `step` выражения для окраски тепловой карты визуально разбивает плотность на диапазоны, напоминающие контур или карту стиля радара.  

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'step',
        ['heatmap-density'],
        'transparent',
        0.01, 'navy',
        0.25, 'navy',
        0.5, 'green',
        0.75, 'yellow',
        1, 'red'
    ]
});
```

Для получения дополнительной информации смотрите документацию [слоя тепловой карты.](map-add-heat-map-layer.md)

### <a name="line-progress-expression"></a>Выражение прогресса строки

Выражение выполнения строки получает прогресс вдоль градиентной линии `['line-progress']`в слое строки и определяется как . Это значение представляет собой число между 0 и 1. Он используется в сочетании `interpolation` `step` с или выражение. Это выражение может быть использовано только при [опции strokeGradient]( https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions?view=azure-iot-typescript-latest#strokegradient) слоя линии. 

> [!NOTE]
> Вариант `strokeGradient` слоя строки требует `lineMetrics` установки источника `true`данных.

**Пример**

Этот пример `['line-progress']` использует выражение для применения градиента цвета к штриху строки.

```javascript
var layer = new atlas.layer.LineLayer(datasource, null, {
    strokeGradient: [
        'interpolate',
        ['linear'],
        ['line-progress'],
        0, "blue",
        0.1, "royalblue",
        0.3, "cyan",
        0.5, "lime",
        0.7, "yellow",
        1, "red"
    ]
});
```

[Смотрите живой пример](map-add-line-layer.md#line-stroke-gradient)

### <a name="text-field-format-expression"></a>Выражение формата текстового поля

Выражение формата текстового поля `textField` может быть `textOptions` использовано с возможностью свойства слоев символов для обеспечения смешанного форматирования текста. Это выражение позволяет указать набор входных строк и параметры форматирования. Для каждой строки ввода в этом выражении могут быть указаны следующие параметры.

 * `'font-scale'`- Определяет коэффициент масштабирования для размера шрифта. Если указано, это значение `size` переопределяет `textOptions` свойство для отдельной строки.
 * `'text-font'`- Определяет одно или несколько семейств шрифтов, которые должны быть использованы для этой строки. Если указано, это значение `font` переопределяет `textOptions` свойство для отдельной строки.
 * `'text-color'`- Определяет цвет для применения к тексту при рендеринге. 

Следующий псевдокод определяет структуру выражения формата текстового поля. 

```javascript
[
    'format', 
    input1: string, 
    options1: { 
        'font-scale': number, 
        'text-font': string[],
        'text-color': color
    },
    input2: string, 
    options2: { 
        'font-scale': number, 
        'text-font': string[] ,
        'text-color': color
    },
    …
]
```

**Пример**

Следующий пример форматирует текстовое поле, добавляя жирный шрифт и `title` масштабируя размер шрифта свойства объекта. Этот пример также `subtitle` добавляет свойство функции на новой строке, с уменьшенным размером шрифта и красным цветом.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'format',

            //Bold the title property and scale its font size up.
            ['get', 'title'],
            {
                'text-font': ['literal', ['StandardFont-Bold']],
                'font-scale': 1.25
            },

            '\n', {},   //Add a new line without any formatting.

            //Scale the font size down of the subtitle property. 
            ['get', 'subtitle'],
            { 
                'font-scale': 0.75, 
                'text-color': 'red' 
            }
        ]
    }
});
```

Этот слой будет отображать функцию точки, показанную на рисунке ниже:
 
<center>

![Изображение функции Point с](media/how-to-expressions/text-field-format-expression.png) отформатированным текстовым полем</center>

### <a name="number-format-expression"></a>Выражение формата чиней

Выражение `number-format` может быть использовано `textField` только с возможностью слоя символа. Это выражение преобразует предоставленное число в отформатированную строку. Это выражение обертывает [функцию Number.toLocalString](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString) JavaScript и поддерживает следующий набор опций.

 * `locale`- Укажите этот вариант для преобразования чисел в строки таким образом, чтобы соответствовать указанному языку. Передайте в эту опцию [тег языка BCP 47.](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation)
 * `currency`- Преобразовать номер в строку, представляющую валюту. Возможные значения [ISO 4217 валютных кодов,](https://en.wikipedia.org/wiki/ISO_4217)таких как "USD" за доллар США, "EUR" за евро, или "CNY" для китайского юаня.
 * `'min-fraction-digits'`- Определяет минимальное количество десятичных мест для включения в строку версии числа.
 * `'max-fraction-digits'`- Определяет максимальное количество десятичных мест для включения в строку версии числа.

Следующий псевдокод определяет структуру выражения формата текстового поля. 

```javascript
[
    'number-format', 
    input: number, 
    options: {
        locale: string, 
        currency: string, 
        'min-fraction-digits': number, 
        'max-fraction-digits': number
    }
]
```

**Пример**

В следующем примере используется `number-format` выражение `revenue` для изменения того, как `textField` свойство объекта отображается в варианте слоя символа, таким образом, что оно отображается значением доллара США.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'number-format', 
            ['get', 'revenue'], 
            { ‘currency’: 'USD' }
        ],

        offset: [0, 0.75]
    }
});
```

Этот слой будет отображать функцию точки, показанную на рисунке ниже:

<center>

![Пример выражения](media/how-to-expressions/number-format-expression.png) формата чиномера</center>

### <a name="image-expression"></a>Выражение изображения

Выражение изображения может быть `image` использовано с `textField` и варианты `fillPattern` слоя символа, и вариант многогонского слоя. Это выражение проверяет, что запрашиваемое изображение существует в стиле, `null`и возвращает либо имя разрешенного изображения, либо, в зависимости от того, находится ли изображение в настоящее время в стиле. Этот процесс проверки синхронный и требует, чтобы изображение было добавлено в стиль, прежде чем запрашивать его в аргументе изображения.

**Пример**

В следующем примере используется `image` выражение для добавления встрокой значка с текстом в сложек символов. 

```javascript
 //Load the custom image icon into the map resources.
map.imageSprite.add('wifi-icon', 'wifi.png').then(function () {

    //Create a data source and add it to the map.
    datasource = new atlas.source.DataSource();
    map.sources.add(datasource);

    //Create a point feature and add it to the data source.
    datasource.add(new atlas.data.Point(map.getCamera().center));

    //Add a layer for rendering point data as symbols.
    map.layers.add(new atlas.layer.SymbolLayer(datasource, null, {
        iconOptions: {
            image: 'none'
        },
        textOptions: {
            //Create a formatted text string that has an icon in it.
            textField: ["format", 'Ricky\'s ', ["image", "wifi-icon"], ' Palace']
        }
    }));
});
```

Этот слой будет отображать текстовое поле в сложек символа, как показано на рисунке ниже:

<center>

![Пример](media/how-to-expressions/image-expression.png) выражения изображения</center>

## <a name="zoom-expression"></a>Увеличить выражение

Выражение `zoom` используется для получения текущего уровня масштабирования карты во время `['zoom']`рендеринга и определяется как . Это выражение возвращает число между минимальным и максимальным диапазоном уровня масштабирования карты. Интерактивные карты Azure Maps для веб-систем и Android поддерживают 25 уровней зума с числом от 0 до 24. Использование `zoom` выражения позволяет динамически модифицировать стили по мере изменения уровня масштабирования карты. Выражение `zoom` может использоваться `interpolate` только `step` с выражениями и выражениями.

**Пример**

По умолчанию радиусы точек данных, отображаемые в слое тепловой карты, имеют фиксированный радиус пикселей для всех уровней масштабирования. По мере увеличения карты данные объединяются, а слой тепловой карты выглядит по-другому. Выражение `zoom` может быть использовано для масштабирования радиуса для каждого уровня масштабирования таким образом, чтобы каждая точка данных покрывала одну и ту же физическую область карты. Это сделает слой тепловой карты более статичным и последовательным. Каждый уровень масштабирования карты имеет в два раза больше пикселей вертикально и горизонтально, чем предыдущий уровень масштабирования. Масштабирование радиуса, так что он удваивается с каждым уровнем зума, создаст тепловую карту, которая выглядит последовательно на всех уровнях масштабирования. Это может быть достигнуто `zoom` с `base 2 exponential interpolation` помощью выражения с выражением, как показано ниже. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    radius: [
        'interpolate',
        ['exponential', 2],
        ['zoom'],
        
        //For zoom level 1 set the radius to 2 pixels.
        10, 2,

        //Between zoom level 1 and 19, exponentially scale the radius from 2 pixels to 10,000 pixels.
        19, 10000
    ]
};
```

[Смотрите живой пример](map-add-heat-map-layer.md#consistent-zoomable-heat-map)

## <a name="variable-binding-expressions"></a>Переменные связывающие выражения

Переменные связывающие выражения хранят результаты расчета в переменной. Таким образом, результаты вычислений могут быть отсылкой в другом месте в выражении несколько раз. Это полезная оптимизация для выражений, которые включают в себя множество вычислений.

| Выражение | Возвращаемый тип | Описание |
|--------------|---------------|--------------|
| \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;"Давайте",<br/>&nbsp;&nbsp;&nbsp;&nbsp;name1: строка,<br/>&nbsp;&nbsp;&nbsp;&nbsp;значение1: любой,<br/>&nbsp;&nbsp;&nbsp;&nbsp;name2: строка,<br/>&nbsp;&nbsp;&nbsp;&nbsp;значение2: любой,<br/>&nbsp;&nbsp;&nbsp;&nbsp;…<br/>&nbsp;&nbsp;&nbsp;&nbsp;childExpression<br/>\] | | Сохраняет одно или несколько значений в `var` качестве переменных для использования выражением в выражении ребенка, возвращающем результат. |
| `['var', name: string]` | any | Ссылки на переменную, `let` которая была создана с помощью выражения. |

**Пример**

В этом примере используется выражение, которое вычисляет доход относительно соотношения температуры, а затем использует `case` выражение для оценки различных операций boolean на этом значении. Выражение `let` используется для хранения дохода относительно коэффициента температуры, так что его нужно вычислить только один раз. Выражение `var` ссылается на эту переменную так часто, как это необходимо без перерасчета.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        //Divide the point features `revenue` property by the `temperature` property and store it in a variable called `ratio`.
        'let', 'ratio', ['/', ['get', 'revenue'], ['get', 'temperature']],
        //Evaluate the child expression in which the stored variable will be used.
        [
            'case',

            //Check to see if the ratio is less than 100, return 'red'.
            ['<', ['var', 'ratio'], 100],
            'red',

            //Check to see if the ratio is less than 200, return 'green'.
            ['<', ['var', 'ratio'], 200],
            'green',

            //Return `blue` for values greater or equal to 200.
            'blue'
        ]
    ]
});
```

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные статьи можно опросмотреть для дополнительных примеров кода, в которых реализованы выражения:

> [!div class="nextstepaction"] 
> [Добавление слоя символов](map-add-pin.md)

> [!div class="nextstepaction"] 
> [Добавить слой пузыря](map-add-bubble-layer.md)

> [!div class="nextstepaction"]
> [Добавление слоя линий](map-add-line-layer.md)

> [!div class="nextstepaction"]
> [Добавление слоя многоугольников](map-add-shape.md)

> [!div class="nextstepaction"] 
> [Добавление слоя тепловой карты](map-add-heat-map-layer.md)

Подробнее о вариантах слоя, поддерживающих выражения:

> [!div class="nextstepaction"] 
> [BubbleLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.bubblelayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [LineLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [ПолигонLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.polygonlayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [SymbolLayerOptions interface](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.symbollayeroptions?view=azure-iot-typescript-latest) (Интерфейс SymbolLayerOptions) 
