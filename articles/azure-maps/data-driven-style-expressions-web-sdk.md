---
title: Управляемые данными выражения стиля в SDK веб-карты Azure | Документация Майкрософт
description: Как использовать выражения стиль на основе данных в SDK веб-карт Azure.
author: rbrundritt
ms.author: richbrun
ms.date: 4/4/2019
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: cpendleton
ms.custom: codepen
ms.openlocfilehash: 3b234ca37783fe557baf307f198de9636b06a382
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60904981"
---
# <a name="data-driven-style-expressions-web-sdk"></a>Выражения стиль на основе данных (веб-пакет SDK)

Выражения позволяют применять бизнес-логику, чтобы параметры стиля, которые наблюдают за свойства, определенные в каждой фигуры в источнике данных. Выражения могут также использоваться для фильтрации данных в источнике данных или уровня. Выражения могут включать условную логику, например операторы if и можно также использовать для управления данными. Строка, логические операторы и математические операторы. 

Стили на основе данных можно уменьшить объем кода, необходимый для реализации бизнес-логики вокруг стилей. При использовании с слои, выражения вычисляются во время отрисовки в отдельном потоке, который позволяет повысить производительность по сравнению с оценки бизнес-логику в UI-потоке.

В следующем видео представлен обзор управляемой данными стилей в SDK веб-карт Azure.

<br/>

<iframe src="https://channel9.msdn.com/Shows/Internet-of-Things-Show/Data-Driven-Styling-with-Azure-Maps/player" width="960" height="540" allowFullScreen frameBorder="0"></iframe>

Выражения, представлены как массивы JSON. Первый элемент в массиве выражения является строка, указывающая имя оператора выражения. Например «+» или «case». Следующие элементы (если таковые имеются) — это аргументы для выражения. Каждый аргумент является литеральное значение (строки, числа, логические значения, или `null`), или другого выражения массива. Следующий псевдокод определяет базовую структуру выражения. 

```javascript
[ 
    expression_operator, 
    argument0, 
    argument1, 
    …
] 
```

SDK веб-карты Azure поддерживает многие типы выражений, которые могут использоваться сами по себе или в сочетании с другими выражениями.

| Тип выражения | Описание |
|---------------------|-------------|
| [Логические выражения](#boolean-expressions) | Логические выражения предоставляют набор логических операторов выражений для вычисления логического сравнения. |
| [Выражения цвета](#color-expressions) | Выражения цвета упрощают создание и управление цветовых значений. |
| [Условные выражения](#conditional-expressions) | Условные выражения предоставляют логических операций, которые похожи на операторы if. |
| [Выражения данных](#data-expressions) | Предоставляет доступ к данным свойства в функции. |
| [Интерполирует и шаг выражения](#interpolate-and-step-expressions) | Интерполирует и шаг выражения могут использоваться для вычисления значений вдоль функцию интерполированных кривой или этапа. |
| [Определенные выражения уровня](#layer-specific-expressions) | Специальные выражения, которые применимы только в один слой. |
| [Математические выражения](#math-expressions) | Предоставляет математические операторы для выполнения вычислений на основе данных в структуре выражение. |
| [Строковые выражения оператора](#string-operator-expressions) | Строковые выражения оператора выполнения операций преобразования на строк, таких как объединение и преобразование регистра. |
| [Тип выражения](#type-expressions) | Тип выражения предоставляют средства для тестирования и преобразование типов данных, таких как строки, числа и логические значения. |
| [Выражения привязки переменной](#variable-binding-expressions) | Выражения привязки переменной let результаты вычислений хранятся в переменной и имеются другие ссылки в выражении несколько раз без необходимости повторного вычисления сохраненное значение. |
| [Выражение масштаба](#zoom-expression) | Возвращает текущий уровень масштаба карты во время отрисовки. |

Все примеры в этом документе будет использовать следующий компонент для демонстрации различных способов в том, что можно использовать различные типы выражений. 

```javascript
{
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [-122.13284, 47.63699]
    },
    "properties": {     
        "entityType": "restaurant",
        "revenue": 12345,
        "subTitle": "Building 40", 
        "temperature": 72,
        "title": "Cafeteria", 
        "zoneColor": "red"
    }
}
```

## <a name="data-expressions"></a>Выражения данных

Выражения данных предоставляют доступ к данным свойства в функции. 

| Expression | Тип возвращаемого значения | Описание |
|------------|-------------|-------------|
| `['at', number, array]` | object | Извлекает элемент из массива. |
| `['geometry-type']` | string | Возвращает геометрический тип компонента: Точка, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon. |
| `['get', string]` | value | Возвращает значение свойства из свойств текущего компонента. Возвращает значение null, если запрошенное свойство отсутствует. |
| `['get', string, object]` | value | Возвращает значение свойства в окне свойств предоставленного объекта. Возвращает значение null, если запрошенное свойство отсутствует. |
| `['has', string]` | Логическое | Определяет, если свойства компонента указанного свойства. |
| `['has', string, object]` | Логическое | Определяет, если свойства объекта указанного свойства. |
| `['id']` | value | Получает идентификатор компонента, если он имеется. |
| `['length', string | array]` | номер | Получает длину строки или массива. |

**Примеры**

Свойства компонента может осуществляться непосредственно в выражении с помощью `get` выражение. В следующем примере значение «zoneColor» компонент используется для указания свойства color пузырьков слоя. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: ['get', 'zoneColor'] //Get the zoneColor value.
});
```

Приведенный выше пример будет работать нормально, если есть все функции точки `zoneColor` свойство, но если их нет, цвет скорее всего вернется к «black». Чтобы изменить цвет резервной `case` выражение может использоваться в сочетании с `has` выражения для проверки, если свойство существует, и в том случае, если он не возвращает резервный цвет вместо этого.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case', //Use a conditional case expression.

        ['has', 'zoneColor'],   //Check to see if feature has a "zoneColor" property
        ['get', 'zoneColor'],   //If it does, use it.

        'blue'  //If it doesn't, default to blue.
    ]
});
```

Слои пузырьковой и символов будут отображаться координаты все фигуры в источнике данных по умолчанию. Это можно сделать, чтобы выделить вершины многоугольника или строки. `filter` Параметр слоя можно использовать для ограничения типа geometry, он отображает с помощью функций `['geometry-type']` выражение в выражении типа boolean. В следующем примере ограничиваются слоя пузырьков, чтобы только `Point` функции подготавливаются к просмотру.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['==', ['geometry-type'], 'Point']
});
```

Следующий пример разрешает оба `Point` и `MultiPoint` функции для отображения. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    filter: ['any', ['==', ['geometry-type'], 'Point'], ['==', ['geometry-type'], 'MultiPoint']]
});
```

Аналогичным образом структуры многоугольников будет отображаться в строке слои. Чтобы отключить это поведение в слой линий, добавьте фильтр, который разрешает только `LineString` и `MultiLineString` функции.  

## <a name="math-expressions"></a>Математические выражения

Математические выражения предоставляют математические операторы для выполнения вычислений на основе данных в структуре выражение.

| Expression | Тип возвращаемого значения | Описание |
|------------|-------------|-------------|
| `['+', number, number, …]` | номер | Вычисляет сумму указанных чисел. |
| `['-', number]` | номер | Вычитает 0 на заданную величину. |
| `['-', number, number]` | номер | Вычитает первого числа на второе число. |
| `['*', number, number, …]` | номер | Перемножает указанных чисел. |
| `['/', number, number]` | номер | Делит первое число на второе число. |
| `['%', number, number]` | номер | Вычисляет остаток при делении первое число на второе число. |
| `['^', number, number]` | номер | Вычисляет значение первое значение, возведенное в степень второго числа. |
| `['abs', number]` | номер | Вычисляет абсолютное значение заданного числа. |
| `['acos', number]` | номер | Вычисляет арккосинус заданного числа. |
| `['asin', number]` | номер | Вычисляет арксинус заданного числа. |
| `['atan', number]` | номер | Вычисляет арктангенс заданного числа. |
| `['ceil', number]` | номер | Округляет число до следующего целым числом. |
| `['cos', number]` | номер | Вычисляет косинус заданного числа. |
| `['e']` | номер | Возвращает Математическая константа `e`. |
| `['floor', number]` | номер | Округляет число вниз до предыдущего целым числом. |
| `['ln', number]` | номер | Вычисляет натуральный логарифм заданного числа. |
| `['ln2']` | номер | Возвращает Математическая константа `ln(2)`. |
| `['log10', number]` | номер | Вычисляет логарифм заданного числа десятичную. |
| `['log2', number]` | номер | Вычисляет логарифм заданного числа base-two. |
| `['max', number, number, …]` | номер | Вычисляет максимальное число в указанном наборе чисел. |
| `['min', number, number, …]` | номер | Вычисляет минимальное число в указанном наборе чисел. |
| `['pi']` | номер | Возвращает Математическая константа `PI`. |
| `['round', number]` | номер | Округляет число до ближайшего целого числа. Промежуточные значения округляются в сторону от нуля. Например `['round', -1.5]` принимает значение -2. |
| `['sin', number]` | номер | Вычисляет синус заданного числа. |
| `['sqrt', number]` | номер | Вычисляет квадратный корень заданного числа. |
| `['tan', number]` | номер | Вычисляет тангенс заданного числа. |
## <a name="boolean-expressions"></a>Логические выражения

Логические выражения предоставляют набор логических операторов выражений для вычисления логического сравнения.

При сравнении значений сравнения является строго типизированным. Всегда считаются неравными значения разных типов. Если известен типы будут отличаться во время синтаксического анализа, считаются недействительными и приведет к ошибке синтаксического анализа. 

| Expression | Тип возвращаемого значения | Описание |
|------------|-------------|-------------|
| `['! ', boolean]` | Логическое | Логическое отрицание. Возвращает `true` Если входные данные `false`, и `false` Если входные данные — `true`. |
| `['!= ', value, value]` | Логическое | Возвращает `true` Если входные значения не равны, `false` в противном случае. |
| `['<', value, value]` | Логическое | Возвращает `true` Если первых входных данных строго меньше второго, `false` в противном случае. Аргументы должны быть либо как строк или оба числа. |
| `['<=', value, value]` | Логическое | Возвращает `true` Если первых входных данных меньше или равно значению второго, `false` в противном случае. Аргументы должны быть либо как строк или оба числа. |
| `['==', value, value]` | Логическое | Возвращает `true` Если входные значения равны, `false` в противном случае. Аргументы должны быть либо как строк или оба числа. |
| `['>', value, value]` | Логическое | Возвращает `true` Если первой входное значение имеет строго больше, чем второй, `false` в противном случае. Аргументы должны быть либо как строк или оба числа. |
| `['>=' value, value]` | Логическое | Возвращает `true` Если первой входное значение имеет больше или равен ему, `false` в противном случае. Аргументы должны быть либо как строк или оба числа. |
| `['all', boolean, boolean, …]` | Логическое | Возвращает `true` Если все входные данные являются `true`, `false` в противном случае. |
| `['any', boolean, boolean, …]` | Логическое | Возвращает `true` Если какой-либо из входных данных `true`, `false` в противном случае. |

## <a name="conditional-expressions"></a>Условные выражения

Условные выражения предоставляют логических операций, которые похожи на операторы if.

Следующие выражения операции условную логику входным данным. Например `case` выражение предоставляет «if/then/else» логику при `match` выражения похож «— оператор switch». 

### <a name="case-expression"></a>Выражение CASE

Объект `case` выражение — тип условного выражения, который предоставляет инструкции if как логика (if/then/else). Этот тип выражения проходит через список логических условий и возвращает выходное значение первого логическое условие, которое имеет значение true.

Следующий псевдокод определяет структуру `case` выражение. 

```javascript
[
    'case',
    condition1: boolean, 
    output1: value,
    condition2: boolean, 
    output2: value,
    ...,
    fallback: value
]
```

**Пример**

Следующий пример проходит через разных логических условий, пока не найдет, результатом которого является `true`, а затем возвращает, связанное значение. Если нет логическое условие принимает значение `true`, возвращается значение резерва. 

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'case',

        //Check to see if the first boolean expression is true, and if it is, return its assigned result.
        ['has', 'zoneColor'],
        ['get', 'zoneColor'],

        //Check to see if the second boolean expression is true, and if it is, return its assigned result.
        ['all', ['has', ' temperature '], ['>', ['get', 'temperature'], 100]],
        'red',

        //Specify a default value to return.
        'green'
    ]
});
```

### <a name="match-expression"></a>Выражение соответствия

Объект `match` выражение — тип условного выражения, предоставляющий инструкцию switch как логика. Входные данные могут быть любым выражением, такие как `['get', 'entityType']` , возвращающий строку или число. Каждая метка должна быть отдельным литеральным значением или массив литеральные значения, значения которого должен быть все строки или все числа. Входные данные соответствуют, если какие-либо значения в массиве совпадают. Каждая метка должна быть уникальной. Если входной тип не совпадает с типом меток, результатом будет значение резерва.

Следующий псевдокод определяет структуру `match` выражение. 

```javascript
[
    'match',
    input: number | string,
    label1: number | string | (number | string)[], 
    output1: value,
    label2: number | string | (number | string)[], 
    output2: value,
    ...,
    fallback: value
]
```

**Примеры**

Следующий пример рассматривает `entityType` свойства компонента точки слоя пузырьков поиск совпадения. Если совпадение найдено, который указан, возвращается значение или возвращает значение резерва.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        'restaurant', 'red',
        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

В следующем примере массив используется список меток, которые должен возвращать то же значение. Это гораздо эффективнее, чем список каждой метки по отдельности. В этом случае если `entityType` свойства является «ресторан» или «grocery_store», «красный» цвет будет возвращаться.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'match',

        //Get the property to match.
        ['get', 'entityType'],

        //List the values to match and the result to return for each match.
        ['restaurant', 'grocery_store'], 'red',

        'park', 'green',

        //Specify a default value to return if no match is found.
        'black'
    ]
});
```

### <a name="coalesce-expression"></a>Выражение объединения

Объект `coalesce` выражение проходит через набор выражений, пока не получается первого значения, отличные от null и возвращает это значение. 

Следующий псевдокод определяет структуру `coalesce` выражение. 

```javascript
[
    'coalesce', 
    value1, 
    value2, 
    …
]
```

**Пример**

В следующем примере используется `coalesce` выражение, чтобы задать `textField` параметр слоя символ. Если `title` из компонента или значение отсутствует свойство `null`, выражение будет затем попробуйте найти `subtitle` свойство, если его отсутствует или `null`, затем вернется к пустой строкой. 

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'coalesce',

            //Try getting the title property.
            ['get', 'title'],

            //If there is no title, try getting the subtitle. 
            ['get', 'subtitle'],

            //Default to an empty string.
            ''
        ]
    }
});
```

## <a name="type-expressions"></a>Тип выражения

Тип выражения предоставляют средства для тестирования и преобразование типов данных, таких как строки, числа и логические значения.

| Expression | Тип возвращаемого значения | Описание |
|------------|-------------|-------------|
| `['literal', array]`<br/><br/>`['literal', object]` | Массив \| объекта | Возвращает значение литерала массива или объекта. Это выражение можно используйте для предотвращения вычисляется как выражение массив или объект. Это необходимо в тех случаях, когда массив или объект должен быть возвращен выражением. |
| `['to-boolean', value]` | Логическое | Преобразует входное значение в логическое значение. В результате `false` при входных данных является пустой строкой, `0`, `false`, `null`, или `NaN`; в противном случае его `true`. |
| `['to-color', value]`<br/><br/>`['to-color', value1, value2…]` | color | Преобразует входное значение цвета. Если указано несколько значений, каждая из них оценивается в порядке до получения первого успешного преобразования. Если ни один из входных данных могут быть преобразованы, выражение является ошибкой. |
| `['to-number', value]`<br/><br/>`['to-number', value1, value2, …]` | номер | Преобразует входное значение в число, если это возможно. Если входные данные `null` или `false`, результат равен 0. Если входные данные `true`, результат равен 1. Если входных данных является строкой, он преобразуется в число с помощью [ToNumber](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) строку функция спецификации языка ECMAScript. Если указано несколько значений, каждая из них оценивается в порядке до получения первого успешного преобразования. Если ни один из входных данных могут быть преобразованы, выражение является ошибкой. |
| `['to-string', value]` | string | Преобразует входное значение в строку. Если входные данные `null`, в результате `""`. Если вход — логическое значение, результат будет `"true"` или `"false"`. Если значение является числом, он преобразуется в строку с помощью [ToString](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) номер функции спецификации языка ECMAScript. Если входное значение цвета, он преобразуется в строку цвета CSS RGBA `"rgba(r,g,b,a)"`. В противном случае входные данные преобразуется в строку с помощью [JSON.stringify](https://tc39.github.io/ecma262/#sec-json.stringify) функция спецификации языка ECMAScript. |
| `['typeof', value]` | string | Возвращает строку, описывающую тип заданного значения. |

> [!TIP]
> Если сообщение об ошибке, аналогичную `Expression name must be a string, but found number instead. If you wanted a literal array, use ["literal", [...]].` отображается в консоли браузера он означает, что где-то в коде, с массивом, который не содержит строку для его первое значение выражения. Если требуется, чтобы выражение для возвращения массива, заключите массив с `literal` выражение. В следующем примере задается значок `offset` параметр уровень символ, который должен быть массив, содержащий два числа, с помощью `match` основано на выражении, чтобы выбрать один из двух значений смещения от значения `entityType` свойство точки функция.
>
> ```javascript
> var layer = new atlas.layer.SymbolLayer(datasource, null, {
>     iconOptions: {
>         offset: [
>             'match',
>
>             //Get the entityType value.
>             ['get', 'entityType'],
>
>             //If there is no title, try getting the subtitle. 
>             'restaurant', ['literal', [0, -10]],
>
>             //Default to value.
>             ['literal', [0, 0]]
>         ]
>     }
> });
> ```

## <a name="color-expressions"></a>Выражения цвета

Выражения цвета упрощают создание и управление цветовых значений.

| Expression | Тип возвращаемого значения | Описание |
|------------|-------------|-------------|
| `['rgb', number, number, number]` | color | Создает значение цвета из *red*, *зеленый*, и *синий* компоненты, которые должно находиться в диапазоне между `0` и `255`и альфа-составляющей `1`. Если какой-либо компонент выходит за пределы диапазона, выражение является ошибкой. |
| `['rgba', number, number, number, number]` | color | Создает значение цвета из *red*, *зеленый*, *синий* компоненты, которые должно находиться в диапазоне между `0` и `255`и альфа-компонент, в пределах диапазона `0` и `1`. Если какой-либо компонент выходит за пределы диапазона, выражение является ошибкой. |
| `['to-rgba']` | \[номер, номер, номер, номер\] | Возвращает массив из четырех элементов, содержит цвет ввода *red*, *зеленый*, *синий*, и *альфа-канал* компонентов в указанном порядке. |

**Пример**

В следующем примере создается и имеет значение цвета RGB *red* значение `255`, и *зеленый* и *синий* значения, которые рассчитываются путем умножения `2.5` по значению `temperature` свойство. При изменении температуры, цвет изменится на различные оттенки *red*.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'rgb', //Create a RGB color value.

        255,    //Set red value to 255.

        ['*', 2.5, ['get', 'temperature']], //Multiple the temperature by 2.5 and set the green value.

        ['*', 2.5, ['get', 'temperature']]  //Multiple the temperature by 2.5 and set the blue value.
    ]
});
```

## <a name="string-operator-expressions"></a>Строковые выражения оператора

Строковые выражения оператора выполнения операций преобразования на строк, таких как объединение и преобразование регистра. 

| Expression | Тип возвращаемого значения | Описание |
|------------|-------------|-------------|
| `['concat', string, string, …]` | string | Сцепляет несколько строк. Каждое значение должно быть строка. Используйте `to-string` введите выражение для преобразования других типов значений в строки, при необходимости. |
| `['downcase', string]` | string | Преобразует указанную строку в нижний регистр. |
| `['upcase', string]` | string | Преобразует указанную строку в верхний регистр. |

**Пример**

В следующем примере выполняется преобразование `temperature` свойство точки компонентов в строку, а затем объединяет «° F» в конец.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: ['concat', ['to-string', ['get', 'temperature']], '°F'],

        //Some additional style options.
        offset: [0, -1.5],
        size: 12,
        color: 'white'
    }
});
```

Приведенное выше выражение отображает ПИН-кода на карте с текстом «64° F» накладывается поверх нее, как показано на рисунке ниже.

<center>

![Пример выражения оператора строки](media/how-to-expressions/string-operator-expression.png) </center>

## <a name="interpolate-and-step-expressions"></a>Интерполирует и шаг выражения

Интерполирует и шаг выражения могут использоваться для вычисления значений вдоль функцию интерполированных кривой или этапа. Эти выражения могут требовать в выражение, возвращающее числовое значение в качестве их входных данных, например `['get',  'temperature']`. Входное значение сравнивается с парами входных и выходных значений, называется «остановка», для определения значения, которое наилучшим образом соответствует функцию интерполированных кривой или шаг. Входные значения для каждой ступени должно быть числом и находящееся в порядке возрастания. Значения выходных данных должны быть число и массив чисел или цвет.

### <a name="interpolate-expression"></a>Выражение интерполяции

`interpolate` Выражение может использоваться для вычисления непрерывной smooth набор значений путем интерполяции между значениями stop. `interpolate` Выражение, возвращающее значения цвета создает градиент цвета, в котором результирующая значения выбираются из.

Существует три типа методов интерполяции, которые могут использоваться в `interpolate` выражение:
 
* `['linear']` -Линейно интерполяции между парой узлов.
* `['exponential', base]` — Выполняет интерполяцию экспоненциально между позициями. `base` Значение определяет скорость, с которой увеличивается выходные данные. Более высокие значения делают выходные данные увеличить более высокий уровень концу диапазона. Объект `base` значение, близкое к 1 формирует вывод, который более линейно увеличивается.
* `['cubic-bezier', x1, y1, x2, y2]` — Выполняет интерполяцию с помощью [кривой Безье третьего порядка](https://developer.mozilla.org/docs/Web/CSS/timing-function) определенный указывает заданного элемента управления.

Ниже приведен пример вида типов интерполяции. 

| Линейная  | Экспоненциальная | Безье третьего порядка |
|---------|-------------|--------------|
| ![Линейная интерполяция graph](media/how-to-expressions/linear-interpolation.png) | ![Экспоненциальное интерполяции graph](media/how-to-expressions/exponential-interpolation.png) | ![Кубические Безье интерполяции graph](media/how-to-expressions/bezier-curve-interpolation.png) |

Следующий псевдокод определяет структуру `interpolate` выражение. 

```javascript
[
    'interpolate',
    interpolation: ['linear'] | ['exponential', base] | ['cubic-bezier', x1, y1, x2, y2],
    input: number,
    stopInput1: number, 
    stopOutput1: value1,
    stopInput2: number, 
    stopOutput2: value2, 
    ...
]
```

**Пример**

В следующем примере используется `linear interpolate` выражение, чтобы задать `color` значение слоя пузырьков в зависимости от `temperature` свойства компонента точки. Если `temperature` значение меньше 60, «blue» возвращается, если между 60 и меньше, чем 70, будет возвращено желтым, если между версиями 70 и менее 80, «orange» возвращается, если возвращается 80 или более поздней версии, «red».

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['get', 'temperature'],
        50,        
        'blue',
        60,
        'yellow',
        70,
        'orange',
        80,
        'red'
    ]
});
```

На следующем рисунке показано, как цвета выбираются для приведенное выше выражение.
 
<center>

![Пример выражения интерполяции](media/how-to-expressions/interpolate-expression-example.png) </center>

### <a name="step-expression"></a>Выражение шага

Объект `step` выражение может использоваться для вычисления значения дискретными, пошаговый результатов, оценивая [функция кусочно-константа](http://mathworld.wolfram.com/PiecewiseConstantFunction.html) определением останавливается. 

Следующий псевдокод определяет структуру `step` выражение. 

```javascript
[
    'step',
    input: number,
    output0: value0,
    stop1: number, 
    output1: value1,
    stop2: number, 
    output2: value2, 
    ...
]
```

Шаг выражения возвращают выходное значение stop непосредственно перед входного значения или Первое входное значение, если входное значение меньше, чем первой остановкой. 

**Пример**

В следующем примере используется `step` выражение, чтобы задать `color` значение слоя пузырьков в зависимости от `temperature` свойства компонента точки. Если `temperature` значение меньше 60, «blue» возвращается, если между 60 и меньше, чем 70, «желтый» возвращается, если между версиями 70 и менее 80, «orange» возвращается, если возвращается 80 или более поздней версии, «red».

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        'step',
        ['get', 'temperature'],
        'blue',
        60,
        'yellow',
        70,
        'orange',
        80,
        'red'
    ]
});
```

На следующем рисунке показано, как цвета выбираются для приведенное выше выражение.
 
<center>

![Пример выражения шага](media/how-to-expressions/step-expression-example.png)
</center>

## <a name="layer-specific-expressions"></a>Определенные выражения уровня

Специальные выражения, которые применяются только к определенным слоям.

### <a name="heat-map-density-expression"></a>Выражение плотность тепловой карты

Выражение тепловой карты плотность извлекает значения плотности тепловой карты для каждого пикселя в слой карты рисков и определяется как `['heatmap-density']`. Это значение является числом в диапазоне от `0` и `1` и используется в сочетании с `interpolation` или `step` выражение для определения цвета градиента, используемого для выделения цветом тепловой карты. Это выражение может использоваться только в [цвета параметр](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest#color) слоя тепловой карты.

> [!TIP]
> Цвет с индексом 0 в выражении интерполяции или цвет по умолчанию цвета шаг определяет цвет области, где нет данных и может использоваться для определения цвета фона. Многие пользователи предпочитают использовать для этого прозрачный или полупрозрачный черный цвет. 

**Пример**

В этом примере использует выражение интерполяции защитную пленку для создания градиента цвета для отображения тепловой карты. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'interpolate',
        ['linear'],
        ['heatmap-density'],
        0, 'transparent',
        0.01, 'purple',
        0.5, '#fb00fb',
        1, '#00c3ff'
    ]
});
```

Помимо использования плавным переходом для выделения цветом тепловую карту, цвета могут задаваться в набор диапазонов с помощью `step` выражение. С помощью `step` выражения для выделения цветом тепловая карта разбивает плотность визуально в диапазоны, поэтому более похожий на карту стиль контура или Лепестковая.  

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    color: [
        'step',
        ['heatmap-density'],
        'transparent',
        0.01, 'navy',
        0.25, 'navy',
        0.5, 'green',
        0.75, 'yellow',
        1, 'red'
    ]
});
```

Дополнительные сведения см. в разделе [Добавление слоя карты рисков](map-add-heat-map-layer.md) документации.

### <a name="line-progress-expression"></a>Выражение линии хода выполнения

Выражение строки хода выполнения извлекает ход выполнения вдоль линии градиента в слой линий, определяется как `['line-progress']`. Это значение является числом от 0 до 1 и используется в сочетании с `interpolation` или `step` выражение. Это выражение может использоваться только с [strokeGradient параметр]( https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions?view=azure-iot-typescript-latest#strokegradient) уровня строки. 

> [!NOTE]
> `strokeGradient` Варианте для слоя линий `lineMetrics` параметр источника данных, чтобы присвоить `true`.

**Пример**

В следующем примере используется `['line-progress']` выражение, чтобы применить градиент цвета для обводки линии.

```javascript
var layer = new atlas.layer.LineLayer(datasource, null, {
    strokeGradient: [
        'interpolate',
        ['linear'],
        ['line-progress'],
        0, "blue",
        0.1, "royalblue",
        0.3, "cyan",
        0.5, "lime",
        0.7, "yellow",
        1, "red"
    ]
});
```

[Реальный пример см. в разделе](map-add-shape.md#line-stroke-gradient)

### <a name="text-field-format-expression"></a>Выражение форматирования текстового поля

Формат текстового поля выражения можно использовать с `textField` параметр слоев символ `textOptions` свойства для обеспечения форматирования смешанного текста. Это выражение позволяет набор входных строк и задавать параметры форматирования. Для каждой входной строки в этом выражении можно указать следующие параметры.

 * `'font-scale'` — Указывает коэффициент масштабирования для размера шрифта. Если указано, это значение будет переопределять `size` свойство `textOptions` для отдельной строки.
 * `'text-font'` — Указывает один или несколько семейств шрифтов, которые должны использоваться для этой строки. Если указано, это значение будет переопределять `font` свойство `textOptions` для отдельной строки.

Следующий псевдокод определяет структуру текстового поля формат выражения. 

```javascript
[
    'format', 
    input1: string, 
    options1: { 
        'font-scale': number, 
        'text-font': string[] 
    },
    input2: string, 
    options2: { 
        'font-scale': number, 
        'text-font': string[] 
    },
    …
]
```

**Пример**

В следующем примере форматируется текстового поля, добавляя полужирного шрифта и масштабировании размер шрифта `title` свойство компонента. В этом примере также добавляется `subtitle` свойство компонента на символ новой строки, с помощью масштабированную вниз размер шрифта.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'format',

            //Bold the title property and scale its font size up.
            ['get', 'title'],
            {
                'text-font': ['literal', ['StandardFont-Bold']],
                'font-scale': 1.25
            },

            '\n', {},   //Add a new line without any formatting.

            //Scale the font size down of the subtitle property. 
            ['get', 'subtitle'],
            { 'font-scale': 0.75 }
        ]
    }
});
```

Этот уровень будет отображаться функция точки, как показано на рисунке ниже:
 
<center>

![Снимок экрана: функции точки с полем форматированного текста](media/how-to-expressions/text-field-format-expression.png) </center>

### <a name="number-format-expression"></a>Выражение, определяющее номер формата

`number-format` Выражение может использоваться только с `textField` параметр слоя символ. Это выражение преобразует указанного числа в форматированную строку. Это выражение создает оболочку для JavaScript [Number.toLocalString](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString) функции и поддерживает следующий набор параметров.

 * `locale` -Укажите этот параметр для преобразования чисел в строки способом, который выравнивается с указанным языком. Передайте [тега языка BCP-47](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation) в этот параметр.
 * `currency` -Чтобы преобразовать число в строку, представляющую денежная единица. Возможные значения: [валюты ISO 4217. коды](https://en.wikipedia.org/wiki/ISO_4217), например «USD» обозначает доллар США, «Евро (€)» для евро или «CNY» для китайского языка юаней (RMB).
 * `'min-fraction-digits'` — Указывает минимальное число десятичных разрядов для включения в строковой версии метода номер.
 * `'max-fraction-digits'` — Указывает максимальное количество десятичных разрядов для включения в строковой версии метода номер.

Следующий псевдокод определяет структуру текстового поля формат выражения. 

```javascript
[
    'number-format', 
    input: number, 
    options: {
        locale: string, 
        currency: string, 
        'min-fraction-digits': number, 
        'max-fraction-digits': number
    }
]
```

**Пример**

В следующем примере используется `number-format` выражения изменять как `revenue` свойства компонента точки и отображается в `textField` параметр символа слоев, то он отображается значение доллар США.

```javascript
var layer = new atlas.layer.SymbolLayer(datasource, null, {
    textOptions: {
        textField: [
            'number-format', 
            ['get', 'revenue'], 
            { ‘currency’: 'USD' }
        ],

        offset: [0, 0.75]
    }
});
```

Этот уровень будет отображаться функция точки, как показано на рисунке ниже:

<center>

![Пример выражения номера формат](media/how-to-expressions/number-format-expression.png) </center>

## <a name="zoom-expression"></a>Выражение масштаба

Объект `zoom` выражение используется для получения текущий масштаб карты во время отрисовки и определяется как `['zoom']`. Это выражение возвращает число в диапазоне минимальный и максимальный масштаб уровня карты. Это выражение позволяет определять стили динамически изменять как изменяется уровень масштаба карты. `zoom` Выражение может использоваться только с `interpolate` и `step` выражения.

**Пример**

По умолчанию радиусы точек данных к просмотру в слое тепловой карты имеют фиксированного значения в пикселях radius для всех уровней масштаба. Как карты развернуто выглядит вместе совокупностями данных и слой тепловой карты. Объект `zoom` выражение можно использовать для масштабирования radius для каждого уровня масштаба, таким образом, что каждая точка данных охватывает одной физической области карты. Это сделает слой карты рисков выглядеть более статические и согласованными. Каждый уровень масштаба карты пиксели в два раза по вертикали и горизонтали как к прежнему масштабу. Таким образом, чтобы он удваивается с каждым уровнем масштабирования, масштабирование радиус создаст тепловая карта, которая выглядит согласованно на всех уровнях масштабирования. Это можно сделать с помощью `zoom` выражение с `base 2 exponential interpolation` выражения, как показано ниже. 

```javascript 
var layer = new atlas.layer.HeatMapLayer(datasource, null, {
    radius: [
        'interpolate',
        ['exponential', 2],
        ['zoom'],
        
        //For zoom level 1 set the radius to 2 pixels.
        10, 2,

        //Between zoom level 1 and 19, exponentially scale the radius from 2 pixels to 10,000 pixels.
        19, 10000
    ]
};
```

[Реальный пример см. в разделе](map-add-heat-map-layer.md#consistent-zoomable-heat-map)

## <a name="variable-binding-expressions"></a>Выражения привязки переменной

Выражения привязки переменной хранить результаты вычисления в переменной, таким образом, чтобы его можно ссылаться в другом месте в выражении несколько раз без необходимости повторного вычисления его. Это полезная оптимизация для выражения, включающие большого объема вычислений

| Expression | Тип возвращаемого значения | Описание |
|--------------|---------------|--------------|
| \[<br/>&nbsp;&nbsp;&nbsp;&nbsp;«let»<br/>&nbsp;&nbsp;&nbsp;&nbsp;Имя1: строка<br/>&nbsp;&nbsp;&nbsp;&nbsp;value1:,<br/>&nbsp;&nbsp;&nbsp;&nbsp;Name2: строка<br/>&nbsp;&nbsp;&nbsp;&nbsp;value2:,<br/>&nbsp;&nbsp;&nbsp;&nbsp;…<br/>&nbsp;&nbsp;&nbsp;&nbsp;childExpression<br/>\] | | Сохраняет одного или нескольких значений как переменные для использования с `var` выражение в дочернее выражение, которое возвращает результат. |
| `['var', name: string]` | любой | Ссылается на переменную, которая была создана с помощью `let` выражение. |

**Пример**

В этом примере используется выражение, которое вычисляет выручку относительно соотношение температуры, а затем используется `case` выражение для вычисления различных логических операций на это значение. `let` Выражение используется для хранения доход по отношению к соотношение температуры, таким образом, ему нужно только один раз вычисляться и `var` выражение так часто, как без необходимости повторного вычисления, он ссылается на эту переменную.

```javascript
var layer = new atlas.layer.BubbleLayer(datasource, null, {
    color: [
        //Divide the point features `revenue` property by the `temperature` property and store it in a variable called `ratio`.
        'let', 'ratio', ['/', ['get', 'revenue'], ['get', 'temperature']],
        //Evaluate the child expression in which the stored variable will be used.
        [
            'case',

            //Check to see if the ratio is less than 100, return 'red'.
            ['<', ['var', 'ratio'], 100],
            'red',

            //Check to see if the ratio is less than 200, return 'green'.
            ['<', ['var', 'ratio'], 200],
            'green',

            //Return `blue` for values greater or equal to 200.
            'blue'
        ]
    ]
});
```

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со следующими статьями, Дополнительные примеры кода для реализации выражения:

> [!div class="nextstepaction"] 
> [Добавление слоя символов](map-add-pin.md)

> [!div class="nextstepaction"] 
> [Добавление слоя пузырьков](map-add-bubble-layer.md)

> [!div class="nextstepaction"] 
> [Добавление фигур](map-add-shape.md)

> [!div class="nextstepaction"] 
> [Добавление слоя карты рисков](map-add-heat-map-layer.md)

Дополнительные сведения о параметрах слоев, которые поддерживают выражения.

> [!div class="nextstepaction"] 
> [BubbleLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.bubblelayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [HeatMapLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.heatmaplayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [LineLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.linelayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [PolygonLayerOptions](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.polygonlayeroptions?view=azure-iot-typescript-latest)

> [!div class="nextstepaction"] 
> [SymbolLayerOptions interface](https://docs.microsoft.com/javascript/api/azure-maps-control/atlas.symbollayeroptions?view=azure-iot-typescript-latest) (Интерфейс SymbolLayerOptions) 
