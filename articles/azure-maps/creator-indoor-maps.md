---
title: Работа со схемами помещений в службе Creator в Azure Maps
description: В этой статье рассматриваются основные понятия, касающиеся служб Creator в Azure Maps.
author: anastasia-ms
ms.author: v-stharr
ms.date: 05/18/2020
ms.topic: conceptual
ms.service: azure-maps
services: azure-maps
manager: philmea
ms.openlocfilehash: d55a0726000a6ed55f049ac4a4146f66421a7085
ms.sourcegitcommit: dabd9eb9925308d3c2404c3957e5c921408089da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2020
ms.locfileid: "86242582"
---
# <a name="creator-for-indoor-maps"></a>Creator для схем помещений

В этой статье описываются основные понятия и средства, которые применяются к службе Creator в Azure Maps. Рекомендуется ознакомиться с этой статьей перед началом работы с API-интерфейсом и пакетом SDK службы Creator в Azure Maps.

Вы можете использовать Creator для разработки приложений с возможностями построения схем на основе данных о схеме помещения. В этой статье описывается процесс передачи, преобразования, создания и использования данных схем. Весь рабочий процесс показан на приведенной ниже схеме.

![Рабочий процесс обработки данных схемы в Creator](./media/creator-indoor-maps/workflow.png)

## <a name="create-azure-maps-creator"></a>Создание ресурса Creator в Azure Maps

Чтобы использовать службы Creator, необходимо создать ресурс Creator в учетной записи Azure Maps. Сведения о создании ресурса Creator в Azure Maps см. в разделе [Управление службой Creator в Azure Maps](how-to-manage-creator.md).

## <a name="upload-a-drawing-package"></a>Отправка пакета рисунков

Creator собирает данные о схеме помещения путем преобразования отправленного пакета рисунков. Пакет рисунков представляет сконструированное или переконструированное здание. Сведения о требованиях к пакету рисунков см. в статье [Требования к пакету рисунков](drawing-requirements.md).

Используйте [API отправки данных в Azure Maps](https://docs.microsoft.com/rest/api/maps/data/uploadpreview), чтобы передать пакет рисунков.  После успешной передачи API-интерфейс отправки данных вернет идентификатор пользовательских данных (`udid`). `udid` будет использоваться на следующем шаге для преобразования переданного пакета в данные схемы помещения.

## <a name="convert-a-drawing-package"></a>Преобразование пакета рисунков

[Служба преобразования Azure Maps](https://docs.microsoft.com/rest/api/maps/conversion) преобразует переданный пакет рисунков в данные схемы помещения. Она также проверяет пакет. Обнаруженные при проверке проблемы делятся на два типа: ошибки и предупреждения. При обнаружении ошибок происходит сбой процесса преобразования. При обнаружении предупреждений, преобразование будет выполнено. Однако рекомендуется просмотреть все предупреждения и устранять указанные в них проблемы. Предупреждение означает, что часть преобразования была пропущена или исправлена автоматически. Если не разрешить проблему, ставшую причиной предупреждения, это может привести к ошибкам в последующих процессах. Дополнительные сведения см. в статье [Ошибки и предупреждения для пакета рисунков](drawing-conversion-error-codes.md).

В случае ошибки служба преобразования предоставляет ссылку на автономное веб-приложение [Визуализатор ошибок рисования в Azure Maps](drawing-error-visualizer.md). Визуализатор ошибок рисования можно использовать для проверки [предупреждений и ошибок в пакете рисования](drawing-conversion-error-codes.md), сообщения о которых были получены в процессе преобразования. После устранения ошибок можно попытаться отправить и преобразовать пакет.

## <a name="create-indoor-map-data"></a>Создание данных схем помещений

Creator в Azure Maps предоставляет три службы.

* [Служба набора данных](https://docs.microsoft.com/rest/api/maps/dataset/createpreview).
Используется для создания набора данных из преобразованных данных пакета рисунков.
* [Служба набора фрагментов](https://docs.microsoft.com/rest/api/maps/tileset/createpreview).
Используется для создания векторного представления набора данных. Приложения могут использовать набор фрагментов для визуального представления набора данных на основе фрагментов.
* [Служба состояний признаков](https://docs.microsoft.com/rest/api/maps/featurestate). Используется для обеспечения поддержки динамической настройки стиля схем. Эта возможность позволяет приложениям отражать события в реальном времени на пространствах, предоставляемых системой Интернета вещей.

### <a name="datasets"></a>Наборы данных

Набор данных — это коллекция признаков схемы помещения. Признак схемы помещения представляет средства, определенные в преобразованном пакете рисунков. После создания набора данных с помощью [службы набора данных](https://docs.microsoft.com/rest/api/maps/dataset/createpreview) можно создать любое количество [наборов фрагментов](#tilesets) или [наборов состояний функции](#feature-statesets).

[Служба набора данных](https://docs.microsoft.com/rest/api/maps/dataset/createpreview) позволяет разработчикам в любое время добавлять или удалять средства в существующем наборе данных. Дополнительные сведения о том, как обновить существующий набор данных с помощью API-интерфейса, см. в разделе о вариантах добавления в статье о [службе наборов данных](https://docs.microsoft.com/rest/api/maps/dataset/createpreview). Пример обновления набора данных см. в разделе [Обслуживание данных](#data-maintenance).

### <a name="tilesets"></a>Наборы фрагментов

Набор фрагментов — это коллекция векторных данных, представляющих ряд однородных фрагментов сетки. Разработчики могут использовать [службу набора фрагментов](https://docs.microsoft.com/rest/api/maps/tileset/createpreview) для создания набора фрагментов из набора данных.

Чтобы отразить различные этапы наполнения содержимым, можно создать несколько наборов фрагментов из одного набора данных. Например, можно создать один набор фрагментов с мебелью и оборудованием, а другой — без них.  Вы можете также создать один набор фрагментов с самыми последними обновлениями данных, а другой — без них.

Помимо векторных данных, набор фрагментов предоставляет метаданные для оптимизации отрисовки схемы. Например, метаданные набора фрагментов содержат предусмотренный для него минимальный и максимальный масштаб. Метаданные также предоставляют ограничивающий прямоугольник, определяющий географический экстент набора фрагментов. Ограничивающий прямоугольник позволяет приложению программно задавать правильную центральную точку. Дополнительные сведения о метаданных набора фрагментов см. в статье [API списка наборов фрагментов](https://docs.microsoft.com/rest/api/maps/tileset/listpreview).

После создания набор фрагментов можно получить с помощью [службы Render V2](#render-v2-service).

Если набор фрагментов устарел и больше не используется, его можно удалить. Дополнительные сведения об удалении набор фрагментов см. в разделе [Обслуживание данных](#data-maintenance).

>[!NOTE]
>Набор фрагментов не зависит от набора данных, из которого он создан. В случае создания набора фрагментов из набора данных при последующем обновлении этого набора данных набора фрагментов не обновляется. Чтобы отразить изменения в наборе данных, необходимо создать новый набор фрагментов. Аналогично, удаление набора фрагментов не влияет на набор данных.

### <a name="feature-statesets"></a>Наборы состояний функции

Наборы состояний функции — это коллекции динамических свойств (*состояний*), назначенных функциям набора данных, таким как комнаты или оборудование. Примером *состояния* может служить температура или вместимость. Каждое *состояние* представляет собой пару "ключ-значение", содержащую имя свойства, значение и метку времени последнего обновления.

[Служба состояний функции](https://docs.microsoft.com/rest/api/maps/featurestate/createstatesetpreview) позволяет создавать наборы состояний функций для наборов данных и управлять ими. Набор состояний определяется одним или несколькими *состояниями* . С каждым признаком, например комнатой, может быть связано одно *состояние*.

Значение каждого *состояния* в наборе состояний может обновляться или извлекаться устройствами Интернета вещей либо другими приложениями.  Например, с помощью [API обновления состояния признаков](https://docs.microsoft.com/rest/api/maps/featurestate/updatestatespreview) устройства, измеряющие использование площади, могут систематически публиковать данные об изменении состояния комнаты.

Приложение может использовать набор состояний функции для динамической отрисовки признаков в здании в соответствии с их текущим состоянием и соответствующим стилем схемы. Дополнительные сведения об использовании наборов состояний функции стиля на схеме для отрисовки см. в разделе [Модуль веб-пакета SDK для схем помещений](#indoor-maps-module).

>[!NOTE]
>Как и в случае с набором фрагментов, изменение набора данных не влияет на имеющийся набор состояний функции и удаление последнего не влияет на набор данных, к которому он присоединен.

## <a name="using-indoor-maps"></a>Использование схем помещений

### <a name="render-v2-service"></a>Служба Render V2

Теперь [API получения фрагмента схемы службы Render V2](https://docs.microsoft.com/rest/api/maps/renderv2/getmaptilepreview) в Azure Maps поддерживает наборы фрагментов Creator.

[API получения фрагмента схемы службы Render V2](https://docs.microsoft.com/rest/api/maps/renderv2/getmaptilepreview) позволяет приложениям запрашивать наборы фрагментов. Затем наборы фрагментов можно интегрировать в элемент управления схемой или пакет SDK. Пример элемента управления схемой, использующего службу Render V2, см. в разделе [Модуль схем помещений](#indoor-maps-module).

### <a name="web-feature-service-api"></a>API-интерфейс Web Feature Service

Наборы данных можно запрашивать с помощью [API-интерфейса Web Feature Service (WFS)](https://docs.microsoft.com/rest/api/maps/wfs). WFS соответствует [признакам API Открытого геопространственного консорциума](http://docs.opengeospatial.org/DRAFTS/17-069r1.html). API-интерфейс WFS позволяет запрашивать функции в самом наборе данных. Например, WFS можно использовать для поиска всех конференц-залов среднего размера на конкретном этаже здания.

### <a name="indoor-maps-module"></a>Модуль схем помещений

[Веб-пакет SDK Azure Maps](https://docs.microsoft.com/azure/azure-maps/) включает в себя модуль схем помещений. Этот модуль предлагает расширенные функциональные возможности для библиотеки *Map Control* в Azure Maps. Модуль схем помещений отрисовывает схемы помещений, созданные в Creator. Он интегрирует мини-приложения, например *средство выбора этажа*, которое помогает пользователям визуализировать различные этажи.

Модуль схем помещений позволяет создавать веб-приложения, которые интегрируют данные схемы помещения в другие [службы Azure Maps](https://docs.microsoft.com/azure/azure-maps/). В числе наиболее распространенных возможностей приложений добавление набора знаний схемы помещений с других карт, например дорожных, фотографических, погодных и транзитных.

Модуль схем помещений также поддерживает динамическую настройку стиля схем. Пошаговое руководство по реализации динамической настройки стиля для набора состояний функции в приложении см. в разделе [об использовании модуля схем помещений](how-to-use-indoor-module.md).

### <a name="azure-maps-integration"></a>Интеграция с Azure Maps

Начиная разрабатывать решения для схем помещений, можно определить способы интеграции имеющихся возможностей Azure Maps. Например, можно реализовать сценарии отслеживания ресурсов или обеспечения безопасности, используя [API-интерфейс геозоны Azure Maps](https://docs.microsoft.com/rest/api/maps/spatial/postgeofence) со схемами помещений Creator. С помощью API геозоны можно, например, определить входит работник в конкретные области помещения или выходит из них. Дополнительные сведения о том, как подключить Azure Maps к данными телеметрии Интернета вещей, доступны [здесь](tutorial-iot-hub-maps.md).

### <a name="data-maintenance"></a>Обслуживание данных

 API перечисления, обновления и удаления ресурсов Creator в Azure Maps позволяет перечислять, обновлять и удалять наборы данных, фрагментов и состояний функции.

>[!NOTE]
>При каждом просмотре списка элементов и принятии решения об их удалении необходимо учитывать влияние этого действия на все зависимые API или приложения. Например, если необходимо удалить набор фрагментов, который в настоящее время используется приложением через [API получения фрагмента схемы службы Render V2](https://docs.microsoft.com/rest/api/maps/renderv2/getmaptilepreview), его удаление приведет к сбою приложения при отрисовке данного набора фрагментов.

### <a name="example-updating-a-dataset"></a>Пример Обновление набора данных

В следующем примере показано, как обновить набор данных, создать новый набор фрагментов и удалить старый.

1. Выполните действия, описанные в разделах [Отправка пакета рисунков](#upload-a-drawing-package) и [Преобразование пакета рисунков](#convert-a-drawing-package), чтобы отправить и преобразовать новый пакет рисунков.

2. Используйте [API создания набора данных](https://docs.microsoft.com/rest/api/maps/dataset/createpreview), чтобы добавить преобразованные данные в существующий набор данных.

3. Используйте [API создания набора фрагментов](https://docs.microsoft.com/rest/api/maps/tileset/createpreview), чтобы создать новый набор фрагментов из обновленного набора данных. Сохраните новый идентификатор набора фрагментов для шага 4.

4. Обновите идентификатор набора фрагментов в приложении, чтобы обеспечить визуализацию обновленных наборов данных кампуса. Если старый набор фрагментов больше не используется, его можно удалить.

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Руководство. Создание схемы помещений в Creator](tutorial-creator-indoor-maps.md)
