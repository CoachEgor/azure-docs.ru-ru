---
title: Управление ресурсами вычислений
description: Узнайте о возможностях горизонтального масштабирования производительности в хранилище данных SQL Azure. Вы можете выполнять горизонтальное масштабирование, настраивая количество единиц использования хранилища данных (DWU), или снижать затраты, приостанавливая работу хранилища данных.
services: sql-data-warehouse
author: kevinvngo
manager: craigg
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.subservice: manage
ms.date: 11/12/2019
ms.author: kevin
ms.reviewer: igorstan
ms.custom: seo-lt-2019
ms.openlocfilehash: 936d92d085420e1386e29a924470b9bac9200d43
ms.sourcegitcommit: 49cf9786d3134517727ff1e656c4d8531bbbd332
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/13/2019
ms.locfileid: "74039089"
---
# <a name="manage-compute-in-azure-sql-data-warehouse"></a>Управление вычислительными ресурсами в хранилище данных SQL Azure
Узнайте об управлении вычислительными ресурсами в хранилище данных SQL Azure. Сократите затраты, приостанавливая работу хранилища данных, или масштабируйте хранилище данных в соответствии потребностями в производительности. 

## <a name="what-is-compute-management"></a>Что такое управление вычислительными ресурсами?
Архитектура хранилища данных SQL разделяет хранилище и вычислительные ресурсы, что позволяет масштабировать их независимо друг от друга. В результате можно масштабировать вычислительные ресурсы в соответствии с потребностями в производительности независимо от хранилища данных. Кроме того, можно приостанавливать и возобновлять работу вычислительных ресурсов. При такой архитектуре [выставление счетов](https://azure.microsoft.com/pricing/details/sql-data-warehouse/) за вычислительные ресурсы и ресурсы хранилища осуществляется отдельно. Если не нужно использовать хранилище данных в течение какого-то времени, то можно сократить затраты, приостановив вычислительные ресурсы. 

## <a name="scaling-compute"></a>Масштабирование вычислительных ресурсов
Вычислительные ресурсы можно масштабировать с помощью параметра [единиц использования хранилища данных](what-is-a-data-warehouse-unit-dwu-cdwu.md), настроенного для хранилища данных. Добавление единиц использования хранилища данных позволяет линейно повышать производительность загрузки и запросов. 

Инструкции по горизонтальному масштабированию приведены в кратких руководствах для [портала Azure](quickstart-scale-compute-portal.md), [PowerShell](quickstart-scale-compute-powershell.md) и [T-SQL](quickstart-scale-compute-tsql.md). Можно также выполнять операции горизонтального масштабирования с помощью [REST API](sql-data-warehouse-manage-compute-rest-api.md#scale-compute).

Чтобы выполнить операцию масштабирования, хранилище данных SQL сначала завершает все входящие запросы, а затем выполняет откат транзакций, чтобы обеспечить согласованное состояние. Масштабирование происходит только после завершения отката транзакций. При операции масштабирования система отключает уровень хранилища от вычислительных узлов, добавляет вычислительные узлы, а затем подключает уровень хранилища к уровню вычислений. Каждое хранилище данных хранится в виде 60 распределений, которые равномерно распределяются между вычислительными узлами. Добавление вычислительных узлов увеличивает вычислительную мощность. При увеличении количества вычислительных узлов количество распределений на каждом вычислительном узле уменьшается, что обеспечивает дополнительную вычислительную мощность для обработки запросов. Точно так же уменьшение количества единиц использования хранилища данных приводит к уменьшению числа вычислительных узлов, и для обработки запросов становится доступно меньше вычислительных ресурсов.

В следующей таблице показано, как изменяется количество распределений на вычислительный узел при изменении количества единиц использования хранилища данных.  DWU6000 предоставляет 60 вычислительных узлов и обеспечивает гораздо более высокую производительность, чем DWU100. 

| Единицы использования хранилища данных  | Число вычислительных узлов | \# распределений на узел |
| -------- | ---------------- | -------------------------- |
| DW100c   | 1                | 60                         |
| DW200c   | 1                | 60                         |
| DW300c   | 1                | 60                         |
| DW400c   | 1                | 60                         |
| DW500c   | 1                | 60                         |
| DW1000c  | 2                | 30                         |
| DW1500c  | 3                | 20                         |
| DW2000c  | 4\.                | 15                         |
| DW2500c  | 5                | 12                         |
| DW3000c  | 6                | 10                         |
| DW5000c  | 10               | 6                          |
| DW6000c  | 12               | 5                          |
| DW7500c  | 15               | 4\.                          |
| DW10000c | 20               | 3                          |
| DW15000c | 30               | 2                          |
| DW30000c | 60               | 1                          |


## <a name="finding-the-right-size-of-data-warehouse-units"></a>Поиск правильного размера единиц использования хранилища данных

Чтобы ознакомиться с преимуществами производительности, обеспечиваемыми горизонтальным масштабированием, особенно для более крупных единиц использования хранилища данных, следует использовать по крайней мере набор данных размером в 1 ТБ. Чтобы найти оптимальное число единиц использования хранилища данных для хранилища данных, попробуйте изменить его масштаб. Выполните несколько запросов с различным количеством единиц использования хранилища данных после загрузки данных. Так как масштабирование выполняется достаточно быстро, попробуйте использовать разные уровни производительности не дольше одного часа. 

Рекомендации по поиску оптимального количества единиц использования хранилища данных:

- Если хранилище данных только создается, начните с небольшого количества единиц использования хранилища данных.  В качестве отправной точки можно использовать DW400 или DW200.
- Отслеживайте производительность приложения, сравнивая ее с количеством выбранных единиц использования хранилища данных.
- Исходя из того, что масштаб изменяется линейно, определите, как необходимо увеличить или уменьшить число единиц использования хранилища данных. 
- Вносите изменения, пока не достигнете уровня производительности, который оптимально отвечает вашим бизнес-требованиям.

## <a name="when-to-scale-out"></a>Когда требуется масштабирование
Горизонтальное масштабирование единиц использования хранилища данных влияет на следующие аспекты производительности:

- Линейное увеличение производительности системы для операций сканирования, агрегирования и инструкций CTAS.
- Увеличение количества модулей чтения и записи при загрузке данных.
- Максимальное количество параллельных запросов и слотов выдачи.

Рекомендации по тому, когда следует использовать горизонтальное масштабирование единиц использования хранилища данных:

- Прежде чем выполнять ресурсоемкую загрузку данных или их преобразование, выполните горизонтальное масштабирование, чтобы быстрее получать доступ к данным.
- Во время рабочих часов наибольшей нагрузки выполните горизонтальное масштабирование, чтобы обработать большое количество одновременных запросов. 

## <a name="what-if-scaling-out-does-not-improve-performance"></a>Что делать, если горизонтальное масштабирование не повышает производительность?

Добавление единиц использования хранилища данных усиливает параллелизм. Если работа равномерно разделена между вычислительными узлами, усиление параллелизма повышает производительность запросов. Если горизонтальное масштабирование не изменяет производительность, этому может быть несколько причин. Возможно, данные неравномерно разделены между распределениями или запросы вызывают много операций перемещения данных. Чтобы изучить проблемы производительности запросов, ознакомьтесь с разделом [Устранение неполадок хранилища данных SQL Azure](sql-data-warehouse-troubleshoot.md#performance). 

## <a name="pausing-and-resuming-compute"></a>Приостановка и возобновление вычислительных ресурсов
Приостановка вычислительных ресурсов приводит к отключению уровня хранилища от вычислительных узлов. Вычислительные ресурсы освобождаются из вашей учетной записи. Пока вычислительные ресурсы приостановлены, плата за их использование не взимается. При возобновлении работы вычислительных ресурсов хранилище подключается к вычислительным узлам и начинает взиматься плата за вычисления. При приостановке работы хранилища данных происходит следующее.

* Вычислительные ресурсы и ресурсы памяти возвращаются в пул доступных ресурсов в центре данных.
* В течение периода приостановки затраты на единицы использования хранилища данных отсутствуют.
* Хранилище данных не затрагивается, и ваши данные остаются без изменений. 
* Хранилище данных SQL отменяет все выполняющиеся и поставленные в очередь операции.

При возобновлении работы хранилища данных происходит следующее.

* Хранилище данных SQL получает вычислительные ресурсы и ресурсы памяти для заданного количества единиц использования хранилища данных.
* Возобновляется оплата единиц использования хранилища данных.
* Данные становятся доступными.
* После подключения хранилища данных к сети необходимо перезапустить запросы рабочей нагрузки.

Чтобы сохранять постоянную доступность хранилища данных, вместо приостановки работы можно уменьшить его размер до минимального. 

Инструкции по приостановке и возобновлению работы приведены в кратких руководствах для [портала Azure](pause-and-resume-compute-portal.md) и [PowerShell](pause-and-resume-compute-powershell.md). Можно также использовать [REST API приостановки](sql-data-warehouse-manage-compute-rest-api.md#pause-compute) или [REST API возобновления](sql-data-warehouse-manage-compute-rest-api.md#resume-compute).

## <a name="drain-transactions-before-pausing-or-scaling"></a>Очистка транзакций перед приостановкой использования и масштабированием вычислительных ресурсов
Мы рекомендуем дождаться завершения текущих транзакций, прежде чем начать приостановку или масштабирование.

В случае приостановки или масштабирования хранилища данных SQL, когда вы отправите запрос на приостановку или масштабирование, остальные ваши запросы будут отменены.  Отмена типичного запроса SELECT выполняется очень быстро и почти не влияет на время, необходимое для приостановки работы или масштабирования экземпляра.  Однако остановка транзакционных запросов, с помощью которых изменяются данные или их структура, занимает длительное время.  **Транзакционные запросы по определению должны полностью завершиться или выполнить откат изменений.**  На откат изменений, выполненных с помощью транзакционных запросов, требуется столько же времени (или даже больше), как и на выполнение самих изменений.  Например, если отменить запрос на удаление строк, который уже выполняется в течение часа, системе понадобится столько же времени, чтобы вставить удаленные строки обратно.  Процесс приостановки работы и масштабирования ресурсов во время выполнения транзакционных запросов займет более длительное время, так как он не начнется, пока не будет выполнен откат изменений.

Дополнительные сведения см. в статьях [Транзакции в хранилище данных SQL](sql-data-warehouse-develop-transactions.md) и [Оптимизация транзакций для хранилища данных SQL](sql-data-warehouse-develop-best-practices-transactions.md).

## <a name="automating-compute-management"></a>Автоматизация управления вычислительными ресурсами
Автоматизация операций управления вычислительным ресурсами описывается в разделе [Использование службы "Функции Azure" для автоматизации управления уровнями вычислений в хранилище данных SQL](manage-compute-with-azure-functions.md).

Каждая операция горизонтального масштабирования, приостановки или возобновления работы может длиться несколько минут. Если операции масштабирования, приостановки и возобновления выполняются автоматически, мы рекомендуем реализовать логику, позволяющую приступать к выполнению другого действия только после завершения определенных операций. Проверка состояния хранилища данных с использованием различных конечных точек позволяет правильно реализовать автоматизацию этих операций. 

Проверка состояния хранилища данных описывается в кратком руководстве для [PowerShell](quickstart-scale-compute-powershell.md#check-data-warehouse-state) или [T-SQL](quickstart-scale-compute-tsql.md#check-data-warehouse-state). Состояние хранилища данных можно также проверить с помощью [REST API](sql-data-warehouse-manage-compute-rest-api.md#check-database-state).


## <a name="permissions"></a>Разрешения

Для масштабирования хранилища данных требуются разрешения, описанные в статье [ALTER DATABASE](/sql/t-sql/statements/alter-database-azure-sql-data-warehouse).  Чтобы приостановить и возобновить работу, нужны разрешения [Участник баз данных SQL](../role-based-access-control/built-in-roles.md#sql-db-contributor), в частности Microsoft.Sql/servers/databases/action.


## <a name="next-steps"></a>Дополнительная информация
Дополнительные сведения об управлении ресурсами вычислений см. в разделе Руководство по управлению [вычислом](manage-compute-with-azure-functions.md) других ресурсов вычислений для отдельных запросов. Дополнительные сведения см. в разделе [Классы ресурсов для управления рабочими нагрузками](resource-classes-for-workload-management.md).
