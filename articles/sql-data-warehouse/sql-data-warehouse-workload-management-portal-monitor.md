---
title: Мониторинг портала управления рабочей нагрузкой
description: Руководство по мониторингу портала управления рабочей нагрузкой в Azure синапсе Analytics.
services: sql-data-warehouse
author: ronortloff
manager: craigg
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.subservice: workload-management
ms.date: 02/04/2020
ms.author: rortloff
ms.reviewer: jrasnick
ms.custom: azure-synapse
ms.openlocfilehash: 69a200d4fda940f072960da9224f84a22db51647
ms.sourcegitcommit: 225a0b8a186687154c238305607192b75f1a8163
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/29/2020
ms.locfileid: "78193804"
---
# <a name="azure-synapse-analytics--workload-management-portal-monitoring-preview"></a>Azure синапсе Analytics — мониторинг портал управления рабочей нагрузки (Предварительная версия)
В этой статье объясняется, как отслеживать использование ресурсов и действий запросов в [группе рабочей нагрузки](sql-data-warehouse-workload-isolation.md#workload-groups) . Дополнительные сведения о настройке обозреватель метрик Azure см. в статье [Приступая к работе с azure обозреватель метрик](../azure-monitor/platform/metrics-getting-started.md) .  Дополнительные сведения о мониторинге потребления системных ресурсов см. в разделе [использование ресурсов](sql-data-warehouse-concept-resource-utilization-query-activity.md#resource-utilization) в документации по мониторингу Azure синапсе Analytics.
Существует две различные категории метрик группы рабочей нагрузки, предоставляемые для мониторинга управления рабочей нагрузкой: выделение ресурсов и действия запросов.  Эти метрики можно разделить и отфильтровать по группе рабочей нагрузки.  Метрики можно разбивать и фильтровать на основе, если они определены системой (группы рабочей нагрузки класса ресурсов) или определяемые пользователем (созданные пользователем с помощью синтаксиса [CREATE Рабочей группы](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest) ).

## <a name="workload-management-metric-definitions"></a>Определения метрик управления рабочей нагрузкой

|Имя метрики                    |Description  |Тип статистической обработки |
|-------------------------------|-------------|-----------------|
|Процент эффективных ресурсов ограничения | *Процент эффективных ресурсов ограничения* — это фиксированное ограничение в процентах ресурсов, доступных группе рабочей нагрузки, принимая во внимание *эффективный процент ресурсов* , выделенный для других групп рабочей нагрузки. Метрика *процента эффективного ресурса Cap* настраивается с помощью параметра `CAP_PERCENTAGE_RESOURCE` в синтаксисе [CREATE Рабочей группы](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest) .  Эффективное значение описывается здесь.<br><br>Например, если группа рабочей нагрузки `DataLoads` создается с `CAP_PERCENTAGE_RESOURCE` = 100, а другая группа рабочей нагрузки создается с эффективным процентом минимальных ресурсов, равным 25%, *процент эффективности ресурса ограничения* для группы рабочей нагрузки `DataLoads` составляет 75%.<br><br>*Процент эффективного ресурса ограничения* определяет верхнюю границу параллелизма (и, таким же, возможную пропускную способность), которую может достичь группа рабочей нагрузки.  Если требуется дополнительная пропускная способность, помимо того, что передается в процентах от метрики *эффективности ресурса ограничения* , либо увеличьте `CAP_PERCENTAGE_RESOURCE`, уменьшите `MIN_PERCENTAGE_RESOURCE` других групп рабочей нагрузки, либо увеличивайте масштаб экземпляра, чтобы добавить дополнительные ресурсы.  Уменьшение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может увеличить параллелизм, но может не повысить общую пропускную способность.| Min, AVG, Max |
|Эффективный процент минимальных ресурсов |*Эффективный* процент минимальных ресурсов — это минимальный процент ресурсов, зарезервированных и изолированных для группы рабочей нагрузки, учитывающих минимальный уровень обслуживания.  Эффективная процентная метрика ресурса min настраивается с помощью параметра `MIN_PERCENTAGE_RESOURCE` в синтаксисе [CREATE Рабочей группы](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest) .  Эффективное значение описывается [здесь](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest#effective-values).<br><br>Используйте тип статистической обработки Sum, если эта метрика имеет нефильтрованный и неразделенный, чтобы отслеживать общую изоляцию рабочей нагрузки, настроенную в системе.<br><br>*Эффективный процент минимальных ресурсов* определяет нижнюю границу гарантированного параллелизма (и, таким же, гарантированную пропускную способность), которую может достичь группа рабочей нагрузки.  Если требуются дополнительные гарантированные ресурсы, помимо тех, которые в настоящее время передаются в *процентах от действующей минимальной* метрики ресурсов, увеличьте значение параметра `MIN_PERCENTAGE_RESOURCE`, настроенного для группы рабочей нагрузки.  Уменьшение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может увеличить параллелизм, но может не повысить общую пропускную способность. |Min, AVG, Max|
|Активные запросы группы рабочей нагрузки  |Эта метрика сообщает об активных запросах в группе рабочей нагрузки.  При использовании этой метрики нефильтрованные и неразделенные отображаются все активные запросы, выполняющиеся в системе.|SUM         |
|Распределение группы рабочей нагрузки по максимальному проценту ресурсов |Эта метрика отображает процент выделения ресурсов относительно *эффективного процента ресурсов* на группу рабочей нагрузки.  Эта метрика обеспечивает эффективное использование группы рабочей нагрузки.<br><br>Рассмотрим группу рабочей нагрузки `DataLoads` с *эффективным процентом ресурсов* , равным 75%, и `REQUEST_MIN_RESOURCE_GRANT_PERCENT`, настроенный на 25%.  *Распределение группы рабочей нагрузки по значению процента максимальных ресурсов* , отфильтрованное до `DataLoads`, будет 33% (25%/75%) значение, если в этой группе рабочей нагрузки был запущен один запрос.<br><br>Используйте эту метрику для обнаружения использования группы рабочей нагрузки.  Значение, близкое к 100%, означает, что используются все ресурсы, доступные для группы рабочей нагрузки.  Кроме того, группа рабочей нагрузки *Метрика запросов в очереди* для одной и той же группы рабочей нагрузки, в которой отображается значение больше нуля, указывает, что группа рабочей нагрузки будет использовать дополнительные ресурсы при выделении.  И наоборот, если эта метрика постоянно низкая, а *Активные запросы группы рабочей нагрузки* имеют низкую нагрузку, группа рабочей нагрузки не используется.  Эта ситуация особенно проблематична, если *процент эффективных ресурсов ограничения* больше нуля, так как это указывает на [недостаточную изоляцию рабочей нагрузки](#underutilized-workload-isolation).|Min, AVG, Max |
|Распределение группы рабочей нагрузки по системным процентам | Эта метрика отображает процент выделения ресурсов относительно всей системы.<br><br>Рассмотрим группу рабочей нагрузки `DataLoads` с `REQUEST_MIN_RESOURCE_GRANT_PERCENT`, настроенным на 25%.  *Распределение группы рабочей нагрузки по процентному* значению, отфильтрованному по `DataLoads`, будет составлять 25% (25%/100%) значение, если в этой группе рабочей нагрузки был запущен один запрос.|Min, AVG, Max |
|Время ожидания запросов группы рабочей нагрузки |Запросы для группы рабочей нагрузки, время ожидания которых истекло.  Время ожидания запросов, сообщаемое этой метрикой, происходит только после начала выполнения запроса (он не включает время ожидания в связи с блокировкой или ожиданиями ресурсов).<br><br>Время ожидания запроса настраивается с помощью параметра `QUERY_EXECUTION_TIMEOUT_SEC` в синтаксисе [CREATE Рабочей группы](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest) .  Увеличение значения может привести к уменьшению числа истечений времени ожидания запроса.<br><br>Рассмотрите возможность увеличения параметра `REQUEST_MIN_RESOURCE_GRANT_PERCENT` для группы рабочей нагрузки, чтобы сократить время ожидания и выделить больше ресурсов для каждого запроса.  Обратите внимание, что увеличение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` сокращает объем параллелизма для группы рабочей нагрузки. |SUM |
|Запросы в очереди группы рабочей нагрузки | Запросы для группы рабочей нагрузки, которые в данный момент ожидают запуска.  Запросы могут быть поставлены в очередь, так как они ожидают ресурсы или блокировки.<br><br>Запросы могут ожидать многочисленных причин.  Если система перегружена и требование параллелизма больше, чем доступно, запросы будут помещаться в очередь.<br><br>Рассмотрите возможность добавления ресурсов в группу рабочей нагрузки путем увеличения параметра `CAP_PERCENTAGE_RESOURCE` в инструкции [CREATE Рабочей группы](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest) .  Если `CAP_PERCENTAGE_RESOURCE` больше, чем метрика *процента эффективного ресурса Cap* , настроенная изоляция рабочей нагрузки для другой группы рабочей нагрузки влияет на ресурсы, выделенные этой группе рабочей нагрузки.  Рассмотрите возможность снижения `MIN_PERCENTAGE_RESOURCE` других групп рабочей нагрузки или увеличения масштаба экземпляра для добавления дополнительных ресурсов. |SUM |

## <a name="monitoring-scenarios-and-actions"></a>Сценарии и действия мониторинга
Ниже приведен ряд конфигураций диаграмм для выделения сведений об использовании метрик управления рабочей нагрузкой для устранения неполадок, а также связанные действия для решения этой проблемы.

### <a name="underutilized-workload-isolation"></a>Недостаточно загруженная изоляция рабочей нагрузки
Рассмотрим следующую группу рабочей нагрузки и конфигурацию классификатора, где создается группа рабочей нагрузки с именем `wgPriority` и *сецео* `membername` сопоставляется с ней с помощью классификатора рабочей нагрузки `wcCEOPriority`.  Для группы рабочей нагрузки `wgPriority` настраивается уровень изоляции "25%" (`MIN_PERCENTAGE_RESOURCE` = 25).  Каждый запрос, отправленный *сецео* , получает 5% системных ресурсов (`REQUEST_MIN_RESOURCE_GRANT_PERCENT` = 5).
```sql
CREATE WORKLOAD GROUP wgPriority 
WITH ( MIN_PERCENTAGE_RESOURCE = 25   
      ,CAP_PERCENTAGE_RESOURCE = 50 
      ,REQUEST_MIN_RESOURCE_GRANT_PERCENT = 5); 

CREATE WORKLOAD CLASSIFIER wcCEOPriority 
WITH ( WORKLOAD_GROUP = 'wgPriority'
      ,MEMBERNAME = 'TheCEO');
```
Приведенная ниже диаграмма настроена следующим образом.<br>
Метрика 1: *процент эффективных минимальных ресурсов* (среднее агрегирование, `blue line`)<br>
Метрика 2: *распределение группы рабочей нагрузки по системным процентам* (СР. агрегирование, `purple line`)<br>
Фильтр: [группа рабочей нагрузки] = `wgPriority`<br>
![ундерутилизед-ВГ. png](media/sql-data-warehouse-workload-management-portal-monitor/underutilized-wg.png) на диаграмме показано, что в среднем используется только 10% для изоляции рабочей нагрузки.  В этом случае значение параметра `MIN_PERCENTAGE_RESOURCE` можно уменьшить в диапазоне от 10 до 15 и разрешить другим рабочим нагрузкам в системе использовать ресурсы.

### <a name="workload-group-bottleneck"></a>Узкие места в группе рабочей нагрузки
Рассмотрим следующую группу рабочей нагрузки и конфигурацию классификатора, в которой создается группа рабочей нагрузки с именем `wgDataAnalyst`, а *аналитик* `membername` сопоставляется с ним с помощью классификатора рабочей нагрузки `wcDataAnalyst`.  Для группы рабочей нагрузки `wgDataAnalyst` настроена 6% изоляции рабочей нагрузки (`MIN_PERCENTAGE_RESOURCE` = 6) и ограничение ресурса 9% (`CAP_PERCENTAGE_RESOURCE` = 9).  Каждый запрос, отправленный *аналитиком* данных, получает 3% системных ресурсов (`REQUEST_MIN_RESOURCE_GRANT_PERCENT` = 3).

```sql
CREATE WORKLOAD GROUP wgDataAnalyst  
WITH ( MIN_PERCENTAGE_RESOURCE = 6   
      ,CAP_PERCENTAGE_RESOURCE = 9 
      ,REQUEST_MIN_RESOURCE_GRANT_PERCENT = 3); 

CREATE WORKLOAD CLASSIFIER wcDataAnalyst 
WITH ( WORKLOAD_GROUP = 'wgDataAnalyst'
      ,MEMBERNAME = 'DataAnalyst');
```
Приведенная ниже диаграмма настроена следующим образом.<br>
Метрика 1: *процент эффективных ресурсов ограничения* (среднее агрегирование, `blue line`)<br>
Метрика 2: *распределение группы рабочей нагрузки по максимальному проценту ресурсов* (среднее агрегирование, `purple line`)<br>
Метрика 3. *Группа рабочей нагрузки запросы в очереди* (агрегирование сумм, `turquoise line`)<br>
Фильтр: [группа рабочей нагрузки] = `wgDataAnalyst`<br>
![нестандартных](media/sql-data-warehouse-workload-management-portal-monitor/bottle-necked-wg.png) диаграмма показывает, что с ограничением в 9% на ресурсы группа рабочей нагрузки имеет 90% + использование (из-за *распределения группы рабочей нагрузки по максимальной метрике процента ресурсов*).  Существует устойчивая очередь запросов, как показано в *группе рабочей нагрузки метрика запросов в очереди*.  В этом случае увеличение `CAP_PERCENTAGE_RESOURCE` до значения, превышающего 9%, позволит одновременно выполнять больше запросов.  Увеличение `CAP_PERCENTAGE_RESOURCE` предполагает наличие достаточного количества доступных ресурсов и не изолируется другими группами рабочей нагрузки.  Убедитесь, что ограничение увеличено, проверив *метрику процента эффективности ресурса ограничения*.  Если требуется дополнительная пропускная способность, рассмотрите возможность увеличения `REQUEST_MIN_RESOURCE_GRANT_PERCENT` до значения, превышающего 3.  Увеличение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может привести к более быстрому выполнению запросов.

## <a name="next-steps"></a>Дальнейшие действия
[Краткое руководство. Настройка изоляции рабочей нагрузки с помощью T-SQL](quickstart-configure-workload-isolation-tsql.md)<br>
[Создание группы рабочей нагрузки (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)<br>
[Создание КЛАССИФИКАТОРа рабочей нагрузки (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-workload-classifier-transact-sql?view=azure-sqldw-latest)<br>
[Наблюдение за использованием ресурсов](sql-data-warehouse-concept-resource-utilization-query-activity.md)

