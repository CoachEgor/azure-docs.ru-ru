---
title: Классификация рабочих нагрузок
description: Руководство по использованию классификации для управления параллелизмом, важностью и ресурсами вычислений для запросов в хранилище данных SQL Azure.
services: sql-data-warehouse
author: ronortloff
manager: craigg
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.subservice: workload-management
ms.date: 05/01/2019
ms.author: rortloff
ms.reviewer: jrasnick
ms.custom: seo-lt-2019
ms.openlocfilehash: 15ca4b9fe3c40b7bf49d86464858747642e3cb5a
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73685386"
---
# <a name="azure-sql-data-warehouse-workload-classification"></a>Классификация рабочих нагрузок хранилища данных SQL Azure

В этой статье описывается процесс классификации рабочих нагрузок хранилища данных SQL для назначения класса ресурсов и важности входящих запросов.

## <a name="classification"></a>классификация;

> [!Video https://www.youtube.com/embed/QcCRBAhoXpM]

Классификация управления рабочей нагрузкой позволяет применять политики рабочей нагрузки к запросам путем назначения [классов ресурсов](resource-classes-for-workload-management.md#what-are-resource-classes) и [важности](sql-data-warehouse-workload-importance.md).

Хотя существует много способов классификации рабочих нагрузок хранилища данных, самая простая и наиболее распространенная классификация — это загрузка и запрос. Данные загружаются с помощью инструкций INSERT, Update и DELETE.  Для запроса данных используется выбор. Решение для хранения данных часто будет иметь политику рабочей нагрузки для действия загрузки, например назначить более высокий класс ресурсов с большим количеством ресурсов. К запросам может применяться другая политика рабочей нагрузки, например низкая важность по сравнению с действиями загрузки.

Можно также выполнить подклассификацию рабочих нагрузок нагрузки и запросов. Подклассификация обеспечивает более полный контроль над рабочими нагрузками. Например, рабочие нагрузки запросов могут состоять из обновлений Куба, запросов панели мониторинга или нерегламентированных запросов. Каждую из этих рабочих нагрузок запроса можно классифицировать с помощью различных классов ресурсов или параметров важности. Кроме того, можно воспользоваться подклассификацией для загрузки. Большие преобразования могут быть назначены большим классам ресурсов. Более высокий уровень важности можно использовать для обеспечения того, чтобы основные данные о продажах были загрузчиком перед данными о погоде или веб-каналом социальных данных.

Не все инструкции классифицируются, так как они не требуют ресурсов или важны для влияния на выполнение.  Инструкции DBCC, операторы BEGIN, COMMIT и ROLLBACK TRANSACTION не классифицируются.

## <a name="classification-process"></a>Процесс классификации

Классификация в хранилище данных SQL достигается сегодня путем назначения пользователям роли, которой назначен соответствующий класс ресурсов, с помощью процедуры [sp_addrolemember](/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql). Эта возможность позволяет определять запросы, которые выходят за пределы имени входа в класс ресурсов. Более мощный метод классификации теперь доступен с синтаксисом [классификатора рабочей нагрузки](/sql/t-sql/statements/create-workload-classifier-transact-sql) .  С помощью этого синтаксиса пользователи хранилища данных SQL могут назначать запросам важность и класс ресурсов.  

> [!NOTE]
> Классификация оценивается на основе каждого запроса. Несколько запросов в одном сеансе можно классифицировать по-разному.

## <a name="classification-precedence"></a>Приоритет классификации

В рамках процесса классификации приоритет определяет, какой класс ресурсов назначен. Классификация, основанная на пользователе базы данных, имеет приоритет над членством в роли. При создании классификатора, который сопоставляет пользователя базы данных с классом ресурсов mediumrc. Затем сопоставьте роль базы данных Role (от которой пользователь a является членом) с классом ресурсов largerc. Классификатор, сопоставляющий пользователя базы данных с классом ресурсов mediumrc, будет иметь приоритет над классификатором, который сопоставляет роль базы данных с классом ресурсов largerc.

Если пользователь является членом нескольких ролей с разными классами ресурсов, назначенными или сопоставленными в нескольких классификаторах, пользователю присваивается наибольшее назначение класса ресурсов.  Это поведение согласуется с существующим поведением при назначении классов ресурсов.

## <a name="system-classifiers"></a>Классификаторы систем

Классификация рабочей нагрузки содержит классификаторы системных нагрузок. Классификаторы систем сопоставляют существующие членства ролей класса ресурсов с выделением ресурсов класса ресурсов с обычной важностью. Не удается удалить классификаторы системы. Для просмотра классификаторов системы можно выполнить следующий запрос:

```sql
SELECT * FROM sys.workload_management_workload_classifiers where classifier_id <= 12
```

## <a name="mixing-resource-class-assignments-with-classifiers"></a>Смешивание назначений классов ресурсов с помощью классификаторов

Классификаторы систем, созданные от вашего имени, предоставляют простой путь для миграции на классификацию рабочих нагрузок. Использование сопоставления ролей класса ресурсов с приоритетом классификации может привести к неправильной классификации при начале создания новых классификаторов с важностью.

Рассмотрим следующие сценарии.

- Имеющееся хранилище данных имеет пользователя базы данных Дбаусер, назначенного роли класса ресурсов largerc. Назначение класса ресурсов выполнялось с помощью процедуры sp_addrolemember.
- Теперь хранилище данных обновляется с помощью управления рабочей нагрузкой.
- Для проверки нового синтаксиса классификации роль базы данных Дбароле (которая является членом Дбаусер) имеет классификатор, созданный для их сопоставления с mediumrc и высокой важностью.
- Когда Дбаусер входит в систему и выполняет запрос, запрос будет назначен largerc. Так как пользователь имеет приоритет над членством в роли.

Чтобы упростить устранение неполадок классификации, рекомендуется удалить сопоставления ролей класса ресурсов при создании классификаторов рабочей нагрузки.  Приведенный ниже код возвращает членство в роли существующего класса ресурсов.  Запустите [sp_droprolemember](/sql/relational-databases/system-stored-procedures/sp-droprolemember-transact-sql) для каждого имени члена, возвращенного из соответствующего класса ресурсов.

```sql
SELECT  r.name AS [Resource Class]
,       m.name AS membername
FROM    sys.database_role_members rm
JOIN    sys.database_principals AS r ON rm.role_principal_id = r.principal_id
JOIN    sys.database_principals AS m ON rm.member_principal_id = m.principal_id
WHERE   r.name IN ('mediumrc','largerc','xlargerc','staticrc10','staticrc20','staticrc30','staticrc40','staticrc50','staticrc60','staticrc70','staticrc80');

--for each row returned run
sp_droprolemember ‘[Resource Class]’, membername
```

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о создании классификатора см. в разделе [Создание классификатора рабочей нагрузки (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-workload-classifier-transact-sql).  
- См. Краткое руководство по созданию классификатора рабочей нагрузки [Создание классификатора рабочей нагрузки](quickstart-create-a-workload-classifier-tsql.md).
- См. статьи с инструкциями по [настройке важности рабочей нагрузки](sql-data-warehouse-how-to-configure-workload-importance.md) , а также об [управлении рабочими нагрузками и наблюдении за](sql-data-warehouse-how-to-manage-and-monitor-workload-importance.md)ними.
- Запросы и назначенную важность см. в разделе [sys.dm_pdw_exec_requests](/sql/relational-databases/system-dynamic-management-views/sys-dm-pdw-exec-requests-transact-sql).