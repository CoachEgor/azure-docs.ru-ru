---
title: Единицы хранилища данных (DWU, Cdwu) в Azure синапсе Analytics (прежнее название — SQL DW)
description: Рекомендации по выбору идеального количества единиц использования хранилища данных (DWU, cDWU) для оптимизации затрат и производительности, а также по изменению количества единиц.
services: sql-data-warehouse
author: mlee3gsd
manager: craigg
ms.service: sql-data-warehouse
ms.topic: conceptual
ms.subservice: design
ms.date: 11/04/2019
ms.author: martinle
ms.reviewer: igorstan
ms.custom: seo-lt-2019
ms.openlocfilehash: f3415522a6ae80723500ba2d38867322fdef0dd7
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73685331"
---
# <a name="data-warehouse-units-dwus-and-compute-data-warehouse-units-cdwus"></a>Единицы использования хранилища данных (DWU) и вычислительные единицы использования хранилища данных (cDWU)

Рекомендации по выбору идеального количества единиц использования хранилища данных (DWU, cDWU) для оптимизации затрат и производительности, а также по изменению количества единиц.

## <a name="what-are-data-warehouse-units"></a>Что такое единицы хранилища данных

Пул SQL представляет коллекцию аналитических ресурсов, которые подготавливаются при использовании [SQL Analytics](sql-data-warehouse-overview-what-is.md#sql-analytics-and-sql-pool-in-azure-synapse). Аналитические ресурсы определяются как сочетание ЦП, памяти и операций ввода-вывода. Эти три ресурса объединены в единицы масштабирования вычислений, которые называются единицами использования хранилища данных (Dwu). Единица DWU представляет собой абстрактный, нормализованный объем вычислительных ресурсов и производительности. Изменение уровня обслуживания изменяет количество DWU, доступных системе, что, в свою очередь, корректирует производительность и стоимость системы.

Для повышения производительности можно увеличить число единиц использования хранилища данных. Для уменьшения производительности уменьшите число единиц хранилища данных. Использование хранилища и операции вычисления оплачиваются отдельно, независимо от изменений количества единиц использования хранилища данных.

Производительность единиц работы с хранилищем данных зависит от этих метрик рабочей нагрузки:

- Скорость, с которой стандартный запрос хранилища данных может сканировать большое количество строк, а затем выполнять комплексное агрегирование. Это требует интенсивного использования операций ввода-вывода и ресурсов ЦП.
- Скорость приема данных в хранилище данных из больших двоичных объектов службы хранилища Azure или Azure Data Lake. Это сетевая операция, которая требует интенсивного использования ресурсов ЦП.
- Скорость, с которой команда t-SQL [`CREATE TABLE AS SELECT`](/sql/t-sql/statements/create-table-as-select-azure-sql-data-warehouse) может копировать таблицу. Эта операция предусматривает чтение данных из хранилища, их распространение в различные узлы устройства и повторную запись в хранилище. Эта операция выполняется ЦП и требует интенсивного использования операций ввода-вывода и сетевых ресурсов.

При увеличении единиц DWU происходит следующее:

- линейное изменение производительности системы для операций сканирования, агрегирования и инструкций CTAS;
- увеличение количества модулей чтения и записи при загрузке с помощью PolyBase;
- увеличение максимального количества параллельных запросов и слотов выдачи.

## <a name="service-level-objective"></a>Целевой уровень обслуживания

Цель уровня обслуживания (SLO) — это параметр масштабируемости, который определяет уровень затрат и производительности хранилища данных. Уровни обслуживания для пула SQL Gen2 измеряются в единицах вычислений с хранилищем данных (cDWU), например DW2000c. Уровни службы пула SQL Gen1 измеряются в DWU, например DW2000.
  > [!NOTE]
  > Пул SQL поколения 2 недавно добавил дополнительные возможности масштабирования для поддержки уровней вычислений как минимум 100 cDWU. Существующие в настоящее время пулы SQL в Gen1, требующие более низких уровней вычислений, теперь могут быть обновлены до Gen2 в регионах, которые в настоящее время доступны без дополнительных затрат.  Если эта возможность пока не доступна для вашего региона, можно обновить хранилище, выполнив геовосстановление в поддерживаемый регион. Дополнительные сведения см. в статье [Оптимизация производительности путем обновления хранилища данных SQL](upgrade-to-latest-generation.md).

В T-SQL параметр SERVICE_OBJECTIVE определяет уровень службы и уровень производительности для пула SQL.

```sql
--Gen1
CREATE DATABASE myElasticSQLDW
WITH
(    SERVICE_OBJECTIVE = 'DW1000'
)
;

--Gen2
CREATE DATABASE myComputeSQLDW
(Edition = 'Datawarehouse'
 ,SERVICE_OBJECTIVE = 'DW1000c'
)
;
```

## <a name="performance-tiers-and-data-warehouse-units"></a>Уровни производительности и единицы использования хранилища данных

Для каждого уровня производительности используются единицы измерения DWU с незначительными различиями. В счете эта разница представлена как единица масштабирования, преобразованная непосредственно в сумму к оплате.

- Пулы Gen1 SQL измеряются в единицах хранилища данных (Dwu).
- Пулы Gen2 SQL измеряются в единицах вычислений с хранилищем данных (Cdwu).

DWU и Cdwu поддерживают масштабирование при увеличении или уменьшении масштаба, а также приостановка вычислений, когда не требуется использовать пул SQL. Все эти операции можно использовать по запросу. Чтобы улучшить уровень производительности, на вычислительных узлах поколения 2 используется локальный кэш на основе диска. При масштабировании или остановке системы кэш становится недействительным. Это значит, что для достижения оптимальной производительности требуется период подготовки кэша.  

По мере увеличения единиц использования хранилища данных вы линейно увеличивайте количество вычислительных ресурсов. Gen2 обеспечивает оптимальную производительность запросов и максимальную масштабируемость. Gen2 системы также используют кэш.

### <a name="capacity-limits"></a>Ограничения емкости

Для каждого сервера SQL (например, myserver.database.windows.net) предусмотрена квота [DTU (единицы передачи данных)](../sql-database/sql-database-what-is-a-dtu.md), которая позволяет применить только определенное число единиц использования хранилища данных. Дополнительные сведения см. в статье об [ограничениях емкости для управления рабочей нагрузкой](sql-data-warehouse-service-capacity-limits.md#workload-management).

## <a name="how-many-data-warehouse-units-do-i-need"></a>Сколько единиц хранилища данных требуется

Оптимальное количество единиц использования хранилища данных существенно зависит от рабочей нагрузки и объема данных, загруженных в систему.

Шаги для поиска оптимального количества единиц DWU рабочей нагрузки:

1. Начните, выбрав меньшее число DWU.
2. Отслеживайте производительность приложения по мере загрузки тестовых данных в систему, сравнивая ее с количеством выбранных DWU.
3. Определите любые дополнительные требования для периодов пиковой активности. Рабочие нагрузки, отображающие значительные пиковые значения и спадов в действии, могут быть часто масштабированы.

SQL Analytics — это масштабируемая система, которая позволяет подготавливать большие объемы вычислений и запрашивать немалым количество данных. Чтобы ознакомиться с реальными возможностями масштабирования, особенно при использовании большого количества DWU, мы рекомендуем во время масштабирования выполнить масштабирование набора данных, чтобы проверить, достаточно ли используется данных для ЦП. Для проверки масштабирования мы рекомендуем использовать как минимум 1 TБ.

> [!NOTE]
>
> Высокий уровень параллелизма только увеличивает производительность обработки запросов, если нагрузку можно разделить между вычислительными узлами. Если обнаружится, что масштабирование не влияет на производительность, вам может потребоваться настроить конструктор таблиц или запросы. Инструкции по настройке запросов см. в статье [Памятка для хранилища данных SQL Azure](sql-data-warehouse-overview-manage-user-queries.md).

## <a name="permissions"></a>Разрешения

Чтобы изменить единицы использования хранилища данных, требуются разрешения, описанные в статье об [инструкции ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql).

Встроенные роли для ресурсов Azure, такие как участник базы данных SQL и участник SQL Server, позволяют изменять параметры DWU.

## <a name="view-current-dwu-settings"></a>для просмотра текущих параметров DWU;

Чтобы просмотреть текущие параметры DWU, сделайте следующее:

1. Откройте обозреватель объектов SQL Server в Visual Studio.
2. Подключитесь к базе данных master, связанной с логическим сервером Базы данных SQL.
3. Выберите в sys.database_service_objectives динамическое административное представление. Пример:

```sql
SELECT  db.name [Database]
,       ds.edition [Edition]
,       ds.service_objective [Service Objective]
FROM    sys.database_service_objectives   AS ds
JOIN    sys.databases                     AS db ON ds.database_id = db.database_id
;
```

## <a name="change-data-warehouse-units"></a>Изменение единиц использования хранилища данных

### <a name="azure-portal"></a>Портал Azure

Чтобы изменить единицы DWU или cDWU, сделайте следующее:

1. Откройте [портал Azure](https://portal.azure.com), откройте нужную базу данных и щелкните **Масштаб**.

2. В колонке **Масштаб** передвиньте ползунок влево или вправо, чтобы изменить число единиц DWU.

3. Щелкните **Сохранить**. Появится сообщение с подтверждением. Щелкните **Да** для подтверждения или **Нет** для отмены.

### <a name="powershell"></a>PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Чтобы изменить DWU или Cdwu, используйте командлет PowerShell [Set-азсклдатабасе](/powershell/module/az.sql/set-azsqldatabase) . В приведенном ниже примере для базы данных MySQLDW, размещенной на сервере MyServer, устанавливается цель уровня обслуживания DW1000.

```Powershell
Set-AzSqlDatabase -DatabaseName "MySQLDW" -ServerName "MyServer" -RequestedServiceObjectiveName "DW1000"
```

Дополнительные сведения см. в статье [Использование командлетов PowerShell и интерфейсов REST API при работе с хранилищем данных SQL](sql-data-warehouse-reference-powershell-cmdlets.md).

### <a name="t-sql"></a>T-SQL

С помощью команды T-SQL можно просмотреть текущие параметры DWU или cDWU, изменить их и сравнить разницу.

Чтобы изменить параметры DWU или cDWU, сделайте следующее:

1. Подключитесь к базе данных master, связанной с логическим сервером Базы данных SQL.
2. Используйте оператор TSQL [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) . В приведенном ниже примере для базы данных MySQLDW устанавливается цель уровня обслуживания DW1000.

```Sql
ALTER DATABASE MySQLDW
MODIFY (SERVICE_OBJECTIVE = 'DW1000')
;
```

### <a name="rest-apis"></a>Интерфейсы API REST

Чтобы изменить число DWU, используйте REST API [создания или обновления базы данных](/rest/api/sql/databases/createorupdate). В следующем примере устанавливается цель уровня обслуживания DW1000 для базы данных MySQLDW, которая размещается на сервере MyServer. Сервер находится в группе ресурсов Azure с именем ResourceGroup1.

```
PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{resource-group-name}/providers/Microsoft.Sql/servers/{server-name}/databases/{database-name}?api-version=2014-04-01-preview HTTP/1.1
Content-Type: application/json; charset=UTF-8

{
    "properties": {
        "requestedServiceObjectiveName": DW1000
    }
}
```

Дополнительные примеры REST API см. в статье [REST API для хранилища данных Azure SQL](sql-data-warehouse-manage-compute-rest-api.md).

## <a name="check-status-of-dwu-changes"></a>Проверка состояния изменений единиц DWU

Изменение количества единиц DWU может занять несколько минут. При выполнении автоматического масштабирования можно реализовать логику, позволяющую приступать к выполнению другого действия только после завершения определенных операций.

Проверка состояния базы данных с использованием различных конечных точек позволяет правильно реализовать автоматизацию этих операций. На портале отображается уведомление о завершении операции и текущее состояние баз данных, однако здесь нельзя проверять состояние программным способом.

Вы не можете проверить состояние базы данных для операций масштабирования с помощью портала Azure.

Чтобы проверить состояние изменений DWU, сделайте следующее:

1. Подключитесь к базе данных master, связанной с логическим сервером Базы данных SQL.

1. Отправьте запрос ниже, чтобы проверить состояние базы данных.

    ```sql
    SELECT    *
    FROM      sys.databases
    ;
    ```
    
1. Отправьте запрос ниже, чтобы проверить состояние операции.

    ```sql
    SELECT    *
    FROM      sys.dm_operation_status
    WHERE     resource_type_desc = 'Database'
    AND       major_resource_id = 'MySQLDW'
    ;
    ```
    
Это динамическое административное представление возвращает сведения о различных операциях управления в пуле SQL, таких как операция и состояние операции, которая либо IN_PROGRESS, либо ЗАВЕРШИЛась.

## <a name="the-scaling-workflow"></a>Масштабирование рабочего процесса

При запуске операции масштабирования система сначала завершает все открытые сеансы и откатывает все открытые транзакции, чтобы обеспечить целостность состояния. Операции масштабирования можно выполнить только после завершения отката транзакций.  

- Для операции масштабирования система отсоединяет все расчетные узлы, подготавливает дополнительные расчетные узлы, а затем повторно подключается к уровню хранилища.
- Для операции уменьшения масштаба система отсоединяет все расчетные узлы, а затем повторно подключает только необходимые узлы к уровню хранилища.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об управлении производительностью см. в разделе [классы ресурсов для управления рабочими нагрузками](resource-classes-for-workload-management.md) и [ограничения памяти и параллелизма] память-параллелизм — limits.md).
