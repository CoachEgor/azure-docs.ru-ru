---
title: Использование записных книжек с Azure Sentinel для охоты на угрозы
description: В этой статье описывается использование записных книжек с возможностями охоты на угрозы Azure Sentinel.
services: sentinel
author: yelevin
ms.author: yelevin
ms.assetid: 1721d0da-c91e-4c96-82de-5c7458df566b
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.topic: conceptual
ms.custom: mvc
ms.date: 11/25/2019
ms.openlocfilehash: bf63d5c8cb46fd791508af40dcefd7b39d4ba9de
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83652027"
---
# <a name="use-jupyter-notebooks-to-hunt-for-security-threats"></a>Использование записных книжек Jupyter для охоты на угрозы безопасности

Основой Azure Sentinel является хранилище данных. Оно сочетает в себе поддержку высокопроизводительных запросов, динамическую схему и возможность масштабирования до огромных объемов данных. Портал Azure и все средства Azure Sentinel используют общий интерфейс API для доступа к этому хранилищу данных. Этот же интерфейс API доступен для внешних средств, таких как записные книжки [Jupyter](https://jupyter.org/) и Python. Хотя многие распространенные задачи можно выполнять на портале, среда Jupyter расширяет возможности работы с данными. Она сочетает в себе полную программируемость с огромной коллекцией библиотек для машинного обучения, визуализации и анализа данных. Эти особенности делают Jupyter привлекательным инструментом для анализа безопасности и охоты на угрозы.

![пример записной книжки](./media/notebooks/sentinel-notebooks-map.png)

Мы включили интерфейс Jupyter в портал Azure, чтобы упростить создание и запуск записных книжек для анализа данных. Библиотека *Kqlmagic* служит посредником, позволяющим брать запросы из Azure Sentinel и выполнять их непосредственно внутри записной книжки. В запросах используется [язык запросов Kusto](https://kusto.azurewebsites.net/docs/query/index.html). В состав Azure Sentinel включено несколько записных книжек, разработанных аналитиками корпорации Майкрософт по безопасности. Некоторые из этих записных книжек созданы для конкретного сценария и могут использоваться "как есть". Другие служат примерами для демонстрации методов и возможностей, которые можно использовать "как есть" или адаптировать для использования в собственных записных книжках. Кроме того, из GitHub сообщества Azure Sentinel можно импортировать другие записные книжки.

Интегрированный интерфейс Jupyter использует [Записные книжки Azure](https://notebooks.azure.com/) для хранения записных книжек, общего доступа к ним и выполнения. Эти записные книжки также можно запускать локально, если на компьютере есть среда Python и Jupyter, или в других средах JupterHub, таких как Azure Databricks.

Записные книжки состоят из двух компонентов:

- интерфейса на основе браузера, в котором вводятся и выполняются запросы и код, а также отображаются результаты выполнения;
- *ядра*, которое отвечает за анализ и выполнение самого кода. 

В Записных книжках Azure этот ядро по умолчанию работает на основе *бесплатных облачных вычислительных ресурсов и хранилища* Azure. Если записные книжки содержат сложные модели машинного обучения или визуализации, рассмотрите возможность использования более мощных выделенных вычислительных ресурсов, например [Виртуальных машин для обработки и анализа данных](https://azure.microsoft.com/services/virtual-machines/data-science-virtual-machines/) (DSVM). Записные книжки в вашей учетной записи остаются частными, пока вы не решите поделиться ими.

В записных книжках Azure Sentinel используются многие популярные библиотеки Python, такие как pandas, matplotlib, bokeh и другие. Кроме того, существует множество других пакетов Python, охватывающих следующие области:

- визуализация и графика;
- обработка и анализ данных;
- статистика и числовые вычисления;
- машинное и глубокое обучение.

Мы также выпустили ряд средств защиты Jupyter с открытым кодом в пакете [msticpy](https://github.com/Microsoft/msticpy/). Этот пакет используется во многих включенных записных книжках. Средства msticpy предназначены специально для создания записных книжек для охоты и исследования угроз. Мы активно работаем над новыми функциями и улучшениями.

Ниже перечислены исходные записные книжки.

- **Направленное исследование — обработка оповещений**: позволяет быстро рассматривать предупреждения, анализируя действия на затронутом узле или узлах.
- **Направленная охота — обозреватель узлов Windows**: позволяет изучать действия с учетной записью, выполнение процессов, сетевые операции и другие события в узле.
- **Интерактивный поиск — обозреватель Office 365**: поиск подозрительных действий Office 365 в нескольких наборах данных Office 365.

[Репозиторий GitHub сообщества Azure Sentinel](https://github.com/Azure/Azure-Sentinel) — это место, где будут публиковаться все будущие записные книжки Azure Sentinel, созданные корпорацией Майкрософт или предоставленные сообществом.

Чтобы использовать записные книжки, необходимо иметь учетную запись в службе "Записные книжки Azure". Дополнительные сведения см. в [кратком руководстве Вход и установление идентификатора пользователя](https://docs.microsoft.com/azure/notebooks/quickstart-sign-in-azure-notebooks) в документации по Записным книжкам Azure. Чтобы создать эту учетную запись, можно использовать команду **Зарегистрируйтесь в Записных книжках Azure** на панели команд на странице **Azure Sentinel — Записные книжки**:

> [!div class="mx-imgBorder"]
>![Команда "Зарегистрируйтесь в Записных книжках Azure"](./media/notebooks/sentinel-azure-sign-up-azure-notebooks.png)

Вы можете запустить записную книжку прямо из Azure Sentinel или клонировать все записные книжки Azure Sentinel в новый проект Записных книжек Azure.

## <a name="run-a-notebook-from-azure-sentinel"></a>Запуск записной книжки из Azure Sentinel
 
1. На портале Azure перейдите в раздел **Azure Sentinel** > **Управление угрозами** > **Записные книжки**, где можно просмотреть записные книжки, предоставляемые Azure Sentinel. 

2. Выберите отдельные записные книжки, чтобы прочитать их описания, узнать необходимые типы данных и источники данных. Пример:
    
    > [!div class="mx-imgBorder"]
    > ![запуск записной книжки](./media/notebooks/sentinel-azure-notebooks-launch.png)

3. Выберите нужную записную книжку, а затем выберите действие **Запустить Записную книжку (предварительная версия)** , чтобы клонировать и настроить записную книжку в новом проекте Записных книжек Azure, связанном с рабочей областью Azure Sentinel. После завершения процесса записная книжка откроется в службе Записных книжек Azure и ее можно будет запустить.

## <a name="clone-azure-sentinel-notebooks-to-a-new-azure-notebooks-project"></a>Клонирование записных книжек Azure Sentinel в новый проект Записных книжек Azure

Эта процедура создает проект Записных книжек Azure, который содержит записные книжки Azure Sentinel. Затем эти записные книжки можно запускать "как есть" или внести в них изменения, а затем запустить.

1. На портале Azure перейдите в раздел **Azure Sentinel** > **Управление угрозами** > **Записные книжки** и на панели команд выберите команду **Клонировать записные книжки**:
  
    > [!div class="mx-imgBorder"]
    >![Команда "Клонировать записные книжки"](./media/notebooks/sentinel-azure-clone-notebooks.png)

2. Когда появится представленное ниже диалоговое окно, выберите команду **Импорт**, чтобы клонировать репозиторий GitHub в проект Записных книжек Azure. Если у вас еще нет учетной записи в службе "Записные книжки Azure", вам будет предложено создать ее и выполнить вход.

   ![Импорт записной книжки](./media/notebooks/sentinel-notebooks-clone.png)

3. В диалоговом окне **Отправка репозитория GitHub** не выбирайте параметр **Клонировать рекурсивно**, так как он относится к связанным репозиториям GitHub. Оставьте имя проекта по умолчанию или введите новое имя. Затем нажмите кнопку **Импорт**, чтобы начать клонирование содержимого GitHub. Этот процесс может занять несколько минут.

   ![Импорт записной книжки](./media/notebooks/sentinel-create-project.png)

4. Откройте только что созданный проект, а затем откройте папку **Notebooks**, чтобы просмотреть записные книжки. Пример:

   ![Импорт репозитория](./media/notebooks/sentinel-open-notebook1.png)

После этого можно запустить записные книжки из службы "Записные книжки Azure". Чтобы вернуться к этим записным книжкам из Azure Sentinel, выберите команду **Перейти к записным книжкам** на панели команд на странице **Azure Sentinel — Записные книжки**:

> [!div class="mx-imgBorder"]
>![Команда "Перейти к записным книжкам"](./media/notebooks/sentinel-azure-to-go-notebooks.png)


## <a name="using-notebooks-to-hunt"></a>Использование записных книжек для охоты на угрозы

В каждой записной книжке приводятся пошаговые инструкции по выполнению поиска или исследования. Библиотеки и другие зависимости, необходимые для записной книжки, можно установить из самой записной книжки или с помощью простой процедуры настройки. Конфигурация, связывающая проект записной книжки с подпиской Azure Sentinel, автоматически подготавливается на предыдущих шагах.

1. Если вы еще не перешли в Записные книжки Azure, можно использовать команду **Перейти к записным книжкам** на панели команд на странице **Azure Sentinel — Записные книжки**:
    
    > [!div class="mx-imgBorder"]
    >![Команда "Перейти к записным книжкам"](./media/notebooks/sentinel-azure-to-go-notebooks.png)
    
    В Записных книжках Azure выберите элемент **Мои проекты**, затем проект, содержащий записные книжки Azure Sentinel, и, наконец, папку **Notebooks**.
    
2. Перед открытием записной книжки учтите, что по умолчанию для выполнения записных книжек используется бесплатная вычислительная среда.
    
   ![выбор записной книжки](./media/notebooks/sentinel-open-notebook2.png)
    
    Если вы настроили использование Виртуальных машин для обработки и анализа данных (DSVM), как описано во введении, выберите DSVM и пройдите проверку подлинности перед открытием первой записной книжки. 

3. Выберите записную книжку, чтобы открыть ее.
    
    При первом открытии записной книжки может быть предложено выбрать версию ядра. Если запрос не появляется, можно выбрать команду **Ядро** >  **Изменить ядро**, а затем выбрать версию не ниже 3.6. Выбранная версия ядра отображается в правом верхнем углу окна записной книжки:
    
   ![выбор записной книжки](./media/notebooks/sentinel-select-kernel.png)

4. Перед внесением каких-либо изменений в скачанную записную книжку рекомендуется создать копию исходной записной книжки и работать с копией. Для этого выберите команду **Файл** > **Создать копию**. Работа с копиями позволяет безопасно обновляться до более новых версий записных книжек, не перезаписывая имеющиеся данные.
    
    Теперь все готово для запуска или редактирования выбранной записной книжки.

Рекомендации

- Для быстрого ознакомления с принципами запроса данных в Azure Sentinel просмотрите записную книжку [GetStarted](https://github.com/Azure/Azure-Sentinel-Notebooks/blob/345cf9f7c8f6137f5af4593a3f9d7568acd6cbc2/DeprecatedNotebooks/Get%20Started.ipynb) в папке **Notebooks**. 

- Дополнительные примеры записных книжек можно найти во вложенной папке **Sample-Notebooks**. Эти примеры записных книжек были сохранены вместе с данными, чтобы упростить просмотр выходных данных. Мы рекомендуем просматривать эти записные книжки в [nbviewer](https://nbviewer.jupyter.org/). 

- Папка **HowTos** содержит записные книжки, в которых демонстрируется, например, указание версии Python по умолчанию, настройка DSVM, создание закладок Azure Sentinel из записной книжки и другие действия.

Предоставленные записные книжки могут служить и полезными средствами, и иллюстрациями и примерами кода, которые можно использовать при разработке собственных записных книжек.

Мы ждем отзывов, предложений, запросов новых функций, разработанных вами записных книжек, отчетов об ошибках, улучшений и дополнений к существующим записным книжкам. Перейдите в [GitHub сообщества Azure Sentinel](https://github.com/Azure/Azure-Sentinel), чтобы опубликовать вопрос или создать вилку и внести свой вклад.

## <a name="next-steps"></a>Дальнейшие действия

Из этой статьи вы узнали, как приступить к использованию записных книжек Jupyter в Azure Sentinel. Ознакомьтесь с дополнительными сведениями об Azure Sentinel в соответствующих статьях.

- [Упреждающая охота за угрозами](hunting.md)
- [Использование закладок для сохранения интересных сведений во время охоты](bookmarks.md)
