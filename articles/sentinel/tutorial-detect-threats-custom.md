---
title: Создание настраиваемых правил аналитики для обнаружения подозрительных угроз с помощью Sentinel Azure | Документация Майкрософт
description: С помощью этого учебника вы узнаете, как создавать пользовательские аналитические правила для обнаружения подозрительных угроз с помощью Sentinel Azure.
services: sentinel
documentationcenter: na
author: rkarlin
manager: rkarlin
editor: ''
ms.service: azure-sentinel
ms.subservice: azure-sentinel
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/23/2019
ms.author: rkarlin
ms.openlocfilehash: 18c11198f6b81e72e371b3ab06ed3a7330078c52
ms.sourcegitcommit: 11265f4ff9f8e727a0cbf2af20a8057f5923ccda
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/08/2019
ms.locfileid: "72023784"
---
# <a name="tutorial-create-custom-analytic-rules-to-detect-suspicious-threats"></a>Учебник. Создание настраиваемых правил аналитики для обнаружения подозрительных угроз

После [подключения источников данных](quickstart-onboard.md) To Azure Sentinel можно создать настраиваемые правила, которые могут искать определенные критерии в среде и создавать инциденты при совпадении критериев, чтобы их можно было исследовать. Этот учебник поможет вам создать настраиваемые правила для обнаружения угроз с помощью Azure Sentinel.

Этот учебник поможет обнаружить угрозы с помощью Azure Sentinel.
> [!div class="checklist"]
> * Создание аналитических правил
> * Автоматизация реагирования на угрозы

## <a name="create-custom-analytic-rules"></a>Создание настраиваемых правил аналитики

Можно создать настраиваемые аналитические правила, которые помогут найти типы угроз и аномалий, подозрительных в вашей среде. Правило гарантирует, что вы будете уведомлены о том, что вы можете рассмотреть, исследовать и исправлять угрозы.

1. В портал Azure в разделе Azure Sentinel выберите **аналитика**.

1. В верхней строке меню выберите **+ создать** и выберите **запланированное правило запроса**. Откроется **Мастер создания настраиваемых правил**.

    ![Создание запланированного запроса](media/tutorial-detect-threats-custom/create-scheduled-query.png)

1. На вкладке **Общие** укажите описательное имя и описание. При необходимости задайте **серьезность предупреждения** . При создании правила его можно включить, что приведет к его немедленному запуску после создания. Если создать его как отключенный, правило будет добавлено на вкладку **активные правила** , и его можно включить там, где это необходимо.

    ![Начать создание настраиваемого аналитического правила](media/tutorial-detect-threats-custom/general-tab.png)

1. На вкладке **Параметры** можно либо написать запрос напрямую, либо создать запрос в log Analytics, а затем вставить его в поле **поискового запроса** . При изменении и настройке запроса Sentinel Azure имитирует результаты запроса в окне **предварительного просмотра результатов** справа. Это позволяет получить представление о том, сколько данных будет создано за определенный интервал времени для создаваемого оповещения. Это значение зависит от того, что задается для **выполнения запроса каждые** и **уточняющих данных из последнего**. Если вы видите, что в среднем оповещение вызывает слишком частое оповещение, вы можете задать количество результатов выше, чтобы оно превышало среднюю базовую базу.

   ![Создание запроса в Azure Sentinel](media/tutorial-detect-threats-custom/settings-tab.png)

   Ниже приведен пример запроса, который выдаст предупреждение при создании аномального числа ресурсов в действии Azure.

    `AzureActivity
    \| where OperationName == "Create or Update Virtual Machine" or OperationName =="Create Deployment"
    \| where ActivityStatus == "Succeeded"
    \| make-series dcount(ResourceId)  default=0 on EventSubmissionTimestamp in range(ago(7d), now(), 1d) by Caller`

   > [!NOTE]
   > Длина запроса должна быть в диапазоне от 1 до 1, 0000 символов и не может содержать "Search \*" или "Union \*".

    1. В разделе **планирование запросов**задайте следующие параметры.

        1.  Задайте параметр **выполнить запрос каждые** , чтобы задать **частоту** запуска запроса, как часто каждые 5 минут или как нечастое выполнение в день.

        1.  Установите **данные подстановки из последней** , чтобы управлять интервалом времени, в течение которого выполняется запрос. Например, он может выполняться каждый час в течение 60 минут.

        1. Вы можете задать для параметра Sentinel Azure **отказаться от выполнения запроса после создания предупреждения** , если вы хотите получать оповещение только один раз после его появлении. Необходимо задать окно, в течение которого запрос должен прерываться до 24 часов.

    1. Определите условия триггера предупреждений в разделе **триггер оповещения**. В разделе **Сопоставление сущностей**можно сопоставить столбцы в запросе с полями сущностей, распознаваемыми в Azure Sentinel. Для каждого поля сопоставьте соответствующий столбец в запросе, созданном в Log Analytics, к соответствующему полю сущности. Каждая сущность содержит несколько полей, например SID и GUID. Сущность можно сопоставлять в соответствии с любыми полями, а не только с сущностью верхнего уровня.

1.  На вкладке **Автоматизация ответов** выберите любой модули PlayBook, который требуется запустить автоматически при создании оповещения настраиваемым правилом. Дополнительные сведения о создании и автоматизации модули PlayBook см. в разделе [реагирование на угрозы](tutorial-respond-threats-playbook.md).

    ![Автоматизация реагирования на угрозы в Azure Sentinel](media/tutorial-detect-threats-custom/response-automation-custom.png)

1. Выберите **проверить** , чтобы проверить все параметры нового правила генерации оповещений, а затем нажмите кнопку **создать, чтобы инициализировать правило оповещения**.

   ![Проверка пользовательского запроса](media/tutorial-detect-threats-custom/review-tab.png)

1.  После создания оповещения в таблицу в разделе **активные правила**добавляется настраиваемое правило. В этом списке можно включить, отключить или удалить каждое правило.

1.  Чтобы просмотреть результаты создаваемых правил генерации оповещений, перейдите на страницу **инциденты** , где можно рассмотреть, [исследовать инциденты](tutorial-investigate-cases.md)и устранить угрозы.


> [!NOTE]
> Оповещения, созданные в Azure Sentinel, доступны через [Microsoft Graph безопасность](https://aka.ms/securitygraphdocs). Дополнительные сведения см. в [документации по Microsoft Graph оповещениями системы безопасности](https://aka.ms/graphsecurityreferencebetadocs).

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как приступить к обнаружению угроз с помощью Sentinel Azure.

Чтобы узнать, как автоматизировать реагирование на угрозы, [Настройте автоматические ответы на угрозы в Azure Sentinel](tutorial-respond-threats-playbook.md).

