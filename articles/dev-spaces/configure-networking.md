---
title: Настройка сетей для Azure Dev Spaces в различных сетевых топологиях
services: azure-dev-spaces
ms.date: 03/17/2020
ms.topic: conceptual
description: Описывает сетевые требования для выполнения пробелов Azure Dev в службах Azure Kubernetes
keywords: Пространства Azure Dev, Dev Spaces, Docker, Kubernetes, Azure, AKS, Azure Kubernetes Service, контейнеры, CNI, kubenet, SDN, сеть
ms.openlocfilehash: 82d046aa36fe9caf6337aa7f58ca0db525062283
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80240572"
---
# <a name="configure-networking-for-azure-dev-spaces-in-different-network-topologies"></a>Настройка сетей для Azure Dev Spaces в различных сетевых топологиях

Пространства Azure Dev работают на кластерах службы Azure Kubernetes (AKS) с конфигурацией сетей по умолчанию. Если требуется изменить конфигурацию сети кластера AKS, например, поместить кластер за брандмауэр, использовать группы сетевой безопасности или использовать сетевые политики, необходимо включить дополнительные соображения для запуска Azure Dev Spaces.

![Конфигурация виртуальной сети](media/configure-networking/virtual-network-clusters.svg)

## <a name="virtual-network-or-subnet-configurations"></a>Конфигурации виртуальной сети или подсети

Ваш кластер AKS может иметь другую виртуальную конфигурацию сети или подсети, чтобы ограничить трафик входа или выход для вашего кластера AKS. Например, кластер может находиться за брандмауэром, например брандмауэром, например, Брандмауэром Azure, или можно использовать группы сетевой безопасности или пользовательские роли для ограничения сетевого трафика.

Azure Dev Spaces имеет определенные требования к сетевому трафику *Ingress и Egress,* а также *к трафику Ingress.* Если вы используете Пространства Azure Dev в кластере AKS с виртуальной конфигурацией сети или подсети, которая ограничивает трафик для вашего кластера AKS, вы должны следовать только следующим требованиям входа и вытекающего трафика для того, чтобы пространства Azure Dev функции должным образом.

### <a name="ingress-and-egress-network-traffic-requirements"></a>Требования к проникновению и выходу сетевого трафика

Пространства Azure Dev нуждаются в проникновении и трафике для следующих F-DN:

| Полное доменное имя.                       | Порт       | Использование      |
|----------------------------|------------|----------|
| cloudflare.docker.com      | HTTPS: 443 | Для получения изображений докеров для пространства Azure Dev |
| gcr.io                     | HTTPS: 443 | Чтобы вытащить изображения руля для пространства Azure Dev |
| storage.googleapis.com     | HTTPS: 443 | Чтобы вытащить изображения руля для пространства Azure Dev |
| azds-.azds.io             | HTTPS: 443 | Для связи с бэкэнд-сервисами Azure Dev Spaces для контроллера Azure Dev Spaces. Точный F'DN можно найти в *dataplaneFqdn* в`USERPROFILE\.azds\settings.json` |

Обновите настройки брандмауэра или безопасности, чтобы сетевой трафик и из всех вышеперечисленных F-DN. Например, если вы используете брандмауэр для защиты сети, вышеуказанные F-DN должны быть добавлены в правило приложения брандмауэра, чтобы разрешить трафик в эти домены и из них.

### <a name="ingress-only-network-traffic-requirements"></a>Вход только требования сетевого трафика

Azure Dev Spaces обеспечивает кuberнетам разгром пространства имен, а также открытый доступ к службам с использованием собственного F-DN. Чтобы обе эти функции работали, обновите брандмауэр или конфигурацию сети, чтобы обеспечить вход на внешний IP-адрес контроллера Azure Dev Spaces в кластер. Кроме того, можно создать [внутренний балансик и][aks-internal-lb] добавить правило NAT в брандмауэре, чтобы перевести общедоступный IP брандмауэра на IP-адреса вашего внутреннего балансоилира нагрузки. Вы также можете использовать [traefik][traefik-ingress] или [NGINX][nginx-ingress] для создания пользовательского контроллера входа.

## <a name="aks-cluster-network-requirements"></a>Требования к кластерной сети AKS

AKS позволяет использовать [сетевые политики][aks-network-policies] для контроля входа и выдвижения трафика между стручками на кластере, а также вывести трафик из стручка. Azure Dev Spaces имеет определенные требования к сетевому трафику *Ingress и Egress,* а также *к трафику Ingress.* Если вы используете Пространства Azure Dev spaces в кластере AKS с сетевыми политиками AKS, необходимо следовать только следующим требованиям входа и вхотливания и выдвижения трафика, чтобы Azure Dev Spaces функционировал должным образом.

### <a name="ingress-and-egress-network-traffic-requirements"></a>Требования к проникновению и выходу сетевого трафика

Пространства Azure Dev позволяют напрямую общаться с капсулой в пространстве разработчиков в кластере для отладки. Чтобы эта функция работала, добавьте сетевую политику, которая позволяет входить и выходить на связь с IP-адресами инфраструктуры Azure Dev Spaces, которые [различаются в зависимости][dev-spaces-ip-auth-range-regions]от региона.

### <a name="ingress-only-network-traffic-requirements"></a>Вход только требования сетевого трафика

Пространства Azure Dev обеспечивают размывание между стручками через пространства имен. Например, пространства имен с включенным пространством Azure Dev могут иметь отношения между родителями и детьми, что позволяет направлять сетевой трафик между стручками между родительскими и детскими пространствами имен. Azure Dev Spaces также предоставляет конечные точки службы, используя свой собственный F-DN. Для настройки различных способов раскрытия служб и того, как она влияет на разгром уровня пространства имен, [см.][endpoint-options]

## <a name="using-azure-cni"></a>Использование Azure CNI

По умолчанию кластеры AKS настроены для использования [kubenet][aks-kubenet] для сетей, который работает с пространствами Azure Dev Spaces. Вы также можете настроить кластер AKS для использования [интерфейса сети контейнеров Azure (CNI).][aks-cni] Чтобы использовать Пространства Azure Dev с Azure CNI в кластере AKS, позвольте вашей виртуальной сети и подсети адреспространства до 10 частных IP-адресов для стручков, развернутых Azure Dev Spaces. Более подробная информация о разрешении частных IP-адресов доступна в [документации AKS Azure CNI.][aks-cni-ip-planning]

## <a name="using-api-server-authorized-ip-ranges"></a>Использование авторизованных диапазонов IP-адресов сервера API

Кластеры AKS позволяют настроить дополнительную безопасность, которая ограничивает, какие IP-адреса могут взаимодействовать с кластерами, например, используя пользовательские виртуальные сети или [обеспечивая доступ к серверу API с помощью авторизованных диапазонов IP.][aks-ip-auth-ranges] Для использования пространства Azure Dev при [использовании][aks-ip-auth-range-create] этой дополнительной безопасности при создании кластера необходимо [разрешить дополнительные диапазоны в зависимости от региона.][dev-spaces-ip-auth-range-regions] Можно также [обновить][aks-ip-auth-range-update] существующий кластер, чтобы позволить эти дополнительные диапазоны. Необходимо также разрешить IP-адрес любых машин разработки, которые подключаются к кластеру AKS для отладки для подключения к серверу API.

## <a name="using-aks-private-clusters"></a>Использование частных кластеров AKS

В настоящее время пространства Azure Dev не поддерживаются [частными кластерами AKS.][aks-private-clusters]

## <a name="using-different-endpoint-options"></a>Использование различных вариантов конечных точек

Azure Dev Spaces имеет возможность разоблачать конечные точки для ваших служб, работающих на AKS. При включении пробелов Azure Dev в кластере у вас есть следующие варианты настройки типа конечных точек для кластера:

* *Публичная* конечная точка, которая является по умолчанию, развертывает контроллер входа с общедоступным IP-адресом. Общедоступный IP-адрес регистрируется в DNS кластера, что позволяет публично получить доступ к вашим службам с помощью URL-адреса. Вы можете просмотреть `azds list-uris`этот URL с помощью .
* *Частная* конечная точка развертывает контроллер входа с частным IP-адресом. С помощью частного IP-адреса балансера нагрузки для кластера можно доступно только внутри виртуальной сети кластера. Частный IP-адрес балансодержателя нагрузки регистрируется в DNS кластера, так что услуги внутри виртуальной сети кластера могут быть доступны с помощью URL-адреса. Вы можете просмотреть `azds list-uris`этот URL с помощью .
* Установка *ни одного* параметра конечных точек не приводит к развертыванию контроллера входа. При отсутствии развертывания контроллера входа [возможности развязывания Azure Dev Spaces][dev-spaces-routing] не будут работать. Дополнительно, вы можете реализовать свой собственный всходная контроллер решение с помощью [traefik][traefik-ingress] или [NGINX][nginx-ingress], который позволит возможности трассировки для работы снова.

Чтобы настроить опцию конечных точек, используйте *-e* или *--конечную точку* при включении пространства Azure Dev в кластере. Пример:

> [!NOTE]
> Конечная точка опции требует, чтобы вы запускали версию Azure CLI 2.2.0 или позже. Чтобы узнать версию, выполните команду `az --version`. Если вам нужно установить или обновить, [см.][azure-cli-install]

```azurecli
az aks use-dev-spaces -g MyResourceGroup -n MyAKS -e private
```

## <a name="client-requirements"></a>Требования к клиенту

Azure Dev Spaces использует инструменты на стороне клиента, такие как расширение Azure Dev Spaces CLI, расширение кода Visual Studio и расширение Visual Studio, для связи с кластером AKS для отладки. Чтобы использовать инструменты для клиентов Azure Dev Spaces, позволяет трафик от машин разработки к *области azds-.azds.io.\** См *DataplaneFqdn* в `USERPROFILE\.azds\settings.json` точном F'DN. При использовании [aPI сервера авторизованных диапазонов IP,][auth-range-section]вы также должны разрешить IP-адрес любых машин разработки, которые подключаются к кластеру AKS для отладки для подключения к серверу API.

## <a name="next-steps"></a>Дальнейшие действия

Узнайте, как в Azure Dev Spaces можно разрабатывать более сложные приложения в нескольких контейнерах и как упростить совместную разработку, используя разные версии и ветви кода в разных средах.

> [!div class="nextstepaction"]
> [Краткое руководство. Коллективная разработка в Kubernetes с использованием Azure Dev Spaces][team-quickstart]

[aks-cni]: ../aks/configure-azure-cni.md
[aks-cni-ip-planning]: ../aks/configure-azure-cni.md#plan-ip-addressing-for-your-cluster
[aks-kubenet]: ../aks/configure-kubenet.md
[aks-internal-lb]: ../aks/internal-lb.md
[aks-ip-auth-ranges]: ../aks/api-server-authorized-ip-ranges.md
[aks-ip-auth-range-create]: ../aks/api-server-authorized-ip-ranges.md#create-an-aks-cluster-with-api-server-authorized-ip-ranges-enabled
[aks-ip-auth-range-update]: ../aks/api-server-authorized-ip-ranges.md#update-a-clusters-api-server-authorized-ip-ranges
[aks-network-policies]: ../aks/use-network-policies.md
[aks-private-clusters]: ../aks/private-clusters.md
[auth-range-section]: #using-api-server-authorized-ip-ranges
[azure-cli-install]: /cli/azure/install-azure-cli
[dev-spaces-ip-auth-range-regions]: https://github.com/Azure/dev-spaces/tree/master/public-ips
[dev-spaces-routing]: how-dev-spaces-works-routing.md
[endpoint-options]: #using-different-endpoint-options
[traefik-ingress]: how-to/ingress-https-traefik.md
[nginx-ingress]: how-to/ingress-https-nginx.md
[team-quickstart]: quickstart-team-development.md