---
title: Принцип работы функции "Локальный процесс с Kubernetes"
services: azure-dev-spaces
ms.date: 06/02/2020
ms.topic: conceptual
description: Описание процессов использования локального процесса с Kubernetes для подключения компьютера разработчика к кластеру Kubernetes
keywords: Локальный процесс с Kubernetes, Azure Dev Spaces, сферами разработки, Docker, Kubernetes, Azure, AKS, служба Kubernetes Azure, контейнеры
ms.openlocfilehash: dd126fc55a86b1de115239a31e5adb7b1d264846
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84974427"
---
# <a name="how-local-process-with-kubernetes-works"></a>Принцип работы функции "Локальный процесс с Kubernetes"

Локальный процесс с Kubernetes позволяет запускать и отлаживать код на компьютере разработчика, сохраняя подключение к кластеру Kubernetes с остальной частью вашего приложения или служб. Например, при наличии большой архитектуры микрослужб с множеством взаимозависимых служб и баз данных репликация этих зависимостей на компьютере разработчика может быть сложной. Кроме того, создание и развертывание кода в кластере Kubernetes для каждого изменения кода во время разработки внутреннего цикла может быть медленным, трудоемким и трудным для использования с отладчиком.

Локальный процесс с Kubernetes позволяет избежать необходимости создавать и развертывать код в кластере, создавая подключение напрямую между компьютером разработчика и кластером. Подключение компьютера разработчика к кластеру во время отладки позволяет быстро тестировать и разрабатывать службы в контексте полного приложения без создания конфигурации DOCKER или Kubernetes.

Локальный процесс с Kubernetes перенаправляет трафик между подключенным кластером Kubernetes и компьютером разработки. Это перенаправление трафика позволяет взаимодействовать с кодом на компьютере разработчика и в службах, работающих в кластере Kubernetes, так, как если бы они находящегося в одном кластере Kubernetes. Локальный процесс с Kubernetes также позволяет реплицировать переменные среды и подключенные тома, доступные для модулей Pod в кластере Kubernetes на компьютере разработчика. Предоставление доступа к переменным среды и подключенным томам на компьютере разработчика позволяет быстро работать с кодом без репликации этих зависимостей вручную.

## <a name="using-local-process-with-kubernetes"></a>Использование локального процесса с Kubernetes

Чтобы использовать локальный процесс с Kubernetes, вам потребуется [Visual Studio Code][vs-code] с [Azure dev Spaces][azds-vs-code] и расширениями [службы Kubernetes Azure][az-aks-vs-code] , установленными и выполняемыми на macOS или Windows 10, а также на [установленной Azure dev Spaces CLI][azds-cli]. Вы также можете использовать [Visual Studio 2019][visual-studio] , работающую в Windows 10, с установленными рабочими нагрузками *ASP.NET и веб-разработка* и *Разработка Azure* и установленным флагом функции *азуредевспацестулс. ЛОКАЛКУБЕРНЕТЕСДЕБУГГИНГ* Preview, а также [установкой Azure dev Spaces CLI][azds-cli]. При использовании локального процесса с Kubernetes для установления подключения к кластеру Kubernetes вы можете перенаправлять весь входящий и исходящий трафик из существующего модуля в кластере на компьютер разработчика.

> [!NOTE]
> При использовании локального процесса с Kubernetes вам будет предложено ввести имя службы для перенаправления на компьютер разработки. Этот параметр является удобным способом для обнаружения типа POD для перенаправления. Все перенаправление между кластером Kubernetes и компьютером разработки предназначено для Pod.

Когда локальный процесс с Kubernetes устанавливает подключение к кластеру, он:

* Предлагает настроить службу для замены в кластере, порт на компьютере разработчика для использования в коде и задачу запуска для кода в виде однократного действия.
* Заменяет контейнер в модуле Pod в кластере удаленным контейнером агента, который перенаправляет трафик на компьютер разработчика.
* Запускает [порт kubectl][kubectl-port-forward] на компьютере разработчика, чтобы перенаправлять трафик с компьютера разработчика на удаленный агент, запущенный в кластере.
* Собирает сведения о среде из кластера с помощью удаленного агента. Эти сведения о среде включают в себя переменные среды, видимые службы, подключения томов и подключения секретов.
* Настраивает среду в Visual Studio или Visual Studio Code, чтобы служба на компьютере разработчика могла обращаться к тем же переменным, что и при выполнении в кластере.  
* Обновляет файл hosts, чтобы сопоставлять службы в кластере с локальными IP-адресами на компьютере разработчика. Эти записи размещаются в файлах, разрешающих выполнение кода на компьютере разработчика для выполнения запросов к другим службам, запущенным в кластере. Чтобы обновить файл hosts, локальный процесс с Kubernetes запросит у администратора на компьютере разработчика доступ к кластеру.
* Запускает выполнение и отладку кода на компьютере разработчика. При необходимости локальный процесс с Kubernetes будет освобождать необходимые порты на компьютере разработчика, останавливая службы или процессы, использующие эти порты в данный момент.

После установления подключения к кластеру можно запускать и выполнять отладку кода на локальном компьютере без использования контейнера, а код может напрямую взаимодействовать с остальной частью кластера. Любой сетевой трафик, получаемый удаленным агентом, перенаправляется на локальный порт, указанный во время подключения, чтобы собственный код мог принять и обработать этот трафик. Переменные среды, тома и секреты из кластера становятся доступными для кода, выполняемого на компьютере разработчика. Кроме того, из-за добавления записей файлов и перенаправления портов на компьютер разработчика локальным процессом с помощью Kubernetes ваш код может отправлять сетевой трафик в службы, запущенные в кластере, используя имена служб из кластера, и этот трафик перенаправляется в службы, запущенные в кластере. Трафик направляется между компьютером разработки и кластером в течение всего времени подключения.

## <a name="diagnostics-and-logging"></a>Диагностика и ведение журнала

При использовании локального процесса с Kubernetes для подключения к кластеру журналы диагностики из кластера регистрируются в [временном каталоге][azds-tmp-dir]компьютера разработчика. С помощью Visual Studio Code можно также использовать команду " *отобразить диагностическую информацию* ", чтобы напечатать текущие переменные среды и записи DNS из кластера.

## <a name="limitations"></a>Ограничения

Локальный процесс с Kubernetes имеет следующие ограничения.

* Локальный процесс с Kubernetes перенаправляет трафик для одной службы на компьютер разработки. Локальный процесс с Kubernetes нельзя использовать для перенаправления нескольких служб одновременно.
* Для подключения к этой службе Служба должна быть создана с помощью одного Pod. Нельзя подключиться к службе с несколькими модулями (например, со службой с репликами).
* Для успешного подключения к модулю Pod может быть запущен только один контейнер для локального процесса с Kubernetes. Локальный процесс с Kubernetes не может подключаться к службам с модулями Pod, имеющими дополнительные контейнеры, например контейнеры расширения, добавленные в сети служб.
* Локальный процесс с Kubernetes требует повышенных разрешений для запуска на компьютере разработчика, чтобы изменить файл hosts.

## <a name="next-steps"></a>Дальнейшие шаги

Чтобы приступить к использованию локального процесса с Kubernetes для подключения к локальному компьютеру разработки к кластеру, см. статью [использование локального процесса с Kubernetes с Visual Studio Code][local-process-kubernetes-vs-code] и [использование локального процесса с Kubernetes в Visual Studio][local-process-kubernetes-vs].

[azds-cli]: how-to/install-dev-spaces.md#install-the-client-side-tools
[azds-tmp-dir]: troubleshooting.md#before-you-begin
[azds-vs-code]: https://marketplace.visualstudio.com/items?itemName=azuredevspaces.azds
[azure-cli]: /cli/azure/install-azure-cli?view=azure-cli-latest
[az-aks-vs-code]: https://marketplace.visualstudio.com/items?itemName=ms-kubernetes-tools.vscode-aks-tools
[local-process-kubernetes-vs-code]: how-to/local-process-kubernetes-vs-code.md
[local-process-kubernetes-vs]: how-to/local-process-kubernetes-visual-studio.md
[how-it-works-routing]: how-dev-spaces-works-routing.md
[kubectl-port-forward]: https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward
[visual-studio]: https://www.visualstudio.com/vs/
[vs-code]: https://code.visualstudio.com/download