---
title: Коллективная разработка с помощью .NET Core и Visual Studio
services: azure-dev-spaces
ms.custom: vs-azure
ms.workload: azure-vs
author: DrEsteban
ms.author: stevenry
ms.date: 12/09/2018
ms.topic: tutorial
description: В этом руководстве описано, как использовать Azure Dev Spaces и Visual Studio для командной разработки в приложении .NET Core в службе Azure Kubernetes
keywords: 'Docker, Kubernetes, Azure, AKS, Azure Kubernetes Service, containers, Helm, service mesh, service mesh routing, kubectl, k8s '
ms.openlocfilehash: c84c77fe7a425318700903427ff1c4aaa4e73a11
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82166042"
---
# <a name="team-development-using-net-core-and-visual-studio-with-azure-dev-spaces"></a>Коллективная разработка с помощью Azure Dev Spaces в .NET Core и Visual Studio

Из этого руководства вы узнаете, как команда разработчиков может одновременно работать в одном кластере Kubernetes с помощью сред Dev Spaces.

## <a name="learn-about-team-development"></a>Сведения о коллективной разработке

До сих пор вы запускали код приложения, как если бы вы были единственным разработчиком, работающим над этим приложением. В этом разделе вы узнаете, как Azure Dev Spaces упрощает разработку в команде:
* По мере необходимости для работы в одной среде можно объединить команды разработчиков, которые работают в общем пространстве разработки или в различных пространствах.
* Поддерживает изолированную итерацию кода каждым разработчиком без воздействия на работу команды.
* Позволяет выполнять комплексное тестирование кода перед его фиксацией без необходимости создавать макеты или моделировать зависимости.

### <a name="challenges-with-developing-microservices"></a>Сложности при разработке микрослужб
На данный момент пример вашего приложения несложный. Но в реальном мире проблемы появятся по мере увеличения количества служб и участников команды разработки.

* На компьютере разработки может не хватить ресурсов для запуска всех необходимых служб одновременно.
* Некоторые службы могут быть общедоступными. Например, службе может потребоваться конечная точка, которая отвечает на веб-перехватчик.
* Если вы хотите запустить подмножество служб, необходимо знать полную иерархию зависимостей между всеми службами. Определить эту иерархию может быть сложно, особенно по мере увеличения количества служб.
* Некоторые разработчики прибегают к моделированию или макетированию многих зависимостей служб. Этот подход может помочь, но управление этими макетами может вскоре повлиять на стоимость разработки. Кроме того, при этом подходе ваша среда несколько отлична от рабочей, что может приводить к появлению незначительных ошибок.
* По этой причине выполнение любого типа интеграционного тестирования становится затруднительным. Фактически интеграционное тестирование можно выполнить только после фиксации, что означает, что вы обнаружите проблемы позже в цикле разработки.

    ![](media/common/microservices-challenges.png)

### <a name="work-in-a-shared-dev-space"></a>Работа в общей среде разработки
С помощью Azure Dev Spaces можно настроить *общую среду разработки* в Azure. Каждый разработчик может сосредоточиться только на своей части приложения и может итеративно разрабатывать *код до фиксации* в среде разработки, в которой уже содержатся все другие службы и облачные ресурсы, от которых зависят сценарии. Зависимости всегда актуальны, и разработчикам следует работать также, как в рабочей среде.

### <a name="work-in-your-own-space"></a>Работа в собственном пространстве
При разработке кода для службы и перед его фиксацией он будет содержать большое количество ошибок. Вы будете итеративно корректировать, тестировать его и экспериментировать с решениями. Azure Dev Spaces предоставляет концепцию **пространства**, которое позволяет работать изолированно, не мешая работе участников вашей команды.

## <a name="use-dev-spaces-for-team-development"></a>Использование среды Dev Spaces для групп разработчиков
Продемонстрируем эти идеи на конкретном примере с помощью нашего примера приложения *webfrontend* -> *mywebapi*. Представим сценарий, в котором разработчику Василию нужно внести изменения *только* в службу *mywebapi*. *webfrontend* не нужно изменять в рамках этого обновления.

_Без_ использования сред Dev Spaces у Василия было бы несколько способов разработки и тестирования его обновления, ни один из которых не идеален.
* Запустить все компоненты локально, для чего требуется более мощный компьютер разработки с установленным Docker и, возможно, MiniKube.
* Запустить все компоненты в изолированном пространстве имен в кластере Kubernetes. Так как *webfrontend* не изменяется, использование изолированного пространства имен — это пустая трата ресурсов кластера.
* Запустить только *mywebapi* и вызвать REST вручную для тестирования. Этот тип тестирования не дает возможность проверки полного сквозного потока.
* Добавить код, ориентированный на разработку, в *webfrontend*, что позволит разработчику отправлять запросы в другой экземпляр *mywebapi*. Добавление такого кода усложняет работу службы *webfrontend*.

### <a name="set-up-your-baseline"></a>Настройка базового плана
Сначала нужно развернуть базовый план служб. Это развертывание будет представлять собой "последнее работоспособное", поэтому можно легко сравнить поведение локального кода с проверяемой версией. Затем создадим дочернее пространство на основе этого базового плана, чтобы протестировать изменения в *mywebapi* в контексте большего приложения.

1. Клонируйте [пример приложения Dev Spaces](https://github.com/Azure/dev-spaces): `git clone https://github.com/Azure/dev-spaces && cd dev-spaces`
1. Извлеките удаленную ветвь *azds_updates*: `git checkout -b azds_updates origin/azds_updates`
1. Закройте все сеансы отладки (F5) для обеих служб, но оставьте проекты открытыми в окнах Visual Studio.
1. Переключитесь в окно Visual Studio, в котором есть проект _mywebapi_.
1. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите **Свойства**.
1. Выберите вкладку **Отладка** слева, чтобы отобразить параметры Azure Dev Spaces.
1. Выберите **Изменить**, чтобы создать пространство, которое будет использоваться в службе при нажатии клавиш F5 или Ctrl+F5.
1. В раскрывающемся списке пространства выберите **\<Create New Space…\>** (Создать пространство…).
1. Убедитесь, что родительскому пространству присвоено значение **\<none\>** , и введите имя **dev** для пространства. Щелкните ОК.
1. Нажмите сочетание клавиш Ctrl+F5, чтобы запустить _mywebapi_ без подключенного отладчика.
1. Переключитесь в окно Visual Studio с проектом _webfrontend_ и нажмите сочетание клавиш CTRL+F5, чтобы запустить и его.

> [!Note]
> Иногда необходимо обновить браузер после того, как веб-страница изначально отобразится после нажатия клавиш CTRL+F5.

> [!TIP]
> Описанные выше шаги позволяют вручную настроить базовый план, но мы рекомендуем командам использовать CI/CD для автоматического обновления базового плана с помощью зафиксированного кода.
>
> Ознакомьтесь с руководством [по настройке CI/CD в Azure DevOps](how-to/setup-cicd.md), чтобы создать рабочий процесс, как на следующей схеме.
>
> ![Пример схемы CI/CD](media/common/ci-cd-complex.png)

Любой пользователь, который открывает общедоступный URL-адрес и переходит к веб-приложению, будет вызывать написанный вами путь кода, который проходит через обе службы, используя пространство по умолчанию _dev_. Предположим, вы хотите продолжить разработку *mywebapi*. Как это можно сделать, не вмешиваясь в работу других разработчиков, которые используют это же пространство разработки? Чтобы сделать это, настройте собственное пространство.

### <a name="create-a-new-dev-space"></a>Создание пространства разработки
В среде Visual Studio можно создать дополнительные пространства, которые будут использоваться при нажатии клавиш CTRL+F5 или F5 при работе со службой. Вы можете назвать пространство любым именем (например, _sprint4_ или _demo_).

Для создания пространства выполните следующие действия:
1. Переключитесь в окно Visual Studio, в котором есть проект *mywebapi*.
2. В **обозревателе решений** щелкните проект правой кнопкой мыши и выберите **Свойства**.
3. Выберите вкладку **Отладка** слева, чтобы отобразить параметры Azure Dev Spaces.
4. Здесь можно изменить или создать кластер и/или пространство, которое будет использоваться при нажатии клавиш CTRL+F5 или F5. *Убедитесь, что выбрано ранее созданное пространство Azure Dev Space*.
5. В раскрывающемся списке пространства выберите **\<Create New Space…\>** (Создать пространство…).

    ![](media/get-started-netcore-visualstudio/Settings.png)

6. В диалоговом окне **Добавление рабочей среды** в качестве родительского пространства укажите **dev** и введите имя нового пространства. Вы можете использовать свое имя (например, "scott") для нового пространства, чтобы люди, которые работают в одной среде с вами, могли идентифицировать ваше пространство. Нажмите кнопку **ОК**.

    ![](media/get-started-netcore-visualstudio/AddSpace.png)

7. Теперь вы должны увидеть свой кластер AKS и новое пространство, выбранное на странице свойств проекта.

    ![](media/get-started-netcore-visualstudio/Settings2.png)

### <a name="update-code-for-mywebapi"></a>Обновление кода *mywebapi*

1. В проекте *mywebapi* измените код метода `string Get(int id)` в файле `Controllers/ValuesController.cs` следующим образом:
 
    ```csharp
    [HttpGet("{id}")]
    public string Get(int id)
    {
        return "mywebapi now says something new";
    }
    ```

2. Установите точку останова в этом обновленном блоке кода (это может быть точка, созданная ранее).
3. Нажмите F5, чтобы запустить службу _mywebapi_. При этом служба будет запущена в вашем кластере с использованием выбранного пространства. В данном случае выбранным пространством является _scott_.

Ниже приведена схема, которая поможет вам понять, как работают разные пространства. Путь фиолетового цвета отображает запрос через пространство _dev_, которое используется по умолчанию, если к URL-адресу не добавлено пространство. Путь розового цвета отображает запрос через пространство _dev/scott_.

![](media/common/Space-Routing.png)

Эта встроенная возможность Azure Dev Spaces позволяет выполнять комплексное тестирование кода в общей среде, не требуя от каждого разработчика повторно создавать множество служб в своем пространстве. Для такой маршрутизации требуется, чтобы заголовки распространения передавались в код приложения, как показано на предыдущем шаге этого руководства.

### <a name="test-code-running-in-the-_devscott_-space"></a>Тестирование кода, выполняемого в пространстве _dev/scott_
Чтобы проверить свою новую версию *mywebapi* в сочетании с *webfrontend*, перейдите в браузере по URL-адресу общедоступной точки доступа для *webfrontend* (например, `http://dev.webfrontend.123456abcdef.eus.azds.io`), а затем перейдите на страницу About (Сведения). Вы увидите исходное сообщение "Hello from webfrontend and Hello from mywebapi".

Теперь добавьте часть "scott.s" в URL-адрес, чтобы получилось http\:/scott.s.dev.webfrontend.123456abcdef.eus.azds.io, и обновите браузер. Должна сработать точка останова, заданная в проекте *mywebapi*. Нажмите клавишу F5, чтобы продолжить. В браузере вы должны увидеть новое сообщение "Hello from webfrontend and mywebapi now says something new". Это происходит, так как путь к обновленному коду в *mywebapi* используется в пространстве _dev/scott_.

При наличии среды _dev_, которая всегда содержит последние изменения, и при условии, что приложение настроено для использования маршрутизации на основе среды DevSpace, как описано в этом разделе руководства, станет понятнее, как Dev Spaces может быть очень полезной при тестировании новых функций в контексте более крупного приложения. Вместо того чтобы развернуть _все_ службы в частной среде, вы можете создать частную среду, которая является производной от среды _dev_ и будет включать только те службы, с которыми вы фактически работаете. Инфраструктура маршрутизации Dev Spaces будет обрабатывать все остальное за счет использования всех доступных служб частной среды и по умолчанию применять последнюю версию, выполняемую в среде _dev_. Тем не менее _несколько_ разработчиков могут одновременно активно создавать разные службы в собственной среде, не нарушая работу друг друга.

### <a name="well-done"></a>Все готово!
Вы выполнили руководство по началу работы. Вы ознакомились с выполнением следующих задач:

> [!div class="checklist"]
> * Настройка Azure Dev Spaces с помощью управляемого кластера Kubernetes в Azure.
> * итеративная разработка кода в контейнерах;
> * независимая разработка двух отдельных служб и вызов другой службы с помощью обнаружения службы DNS Kubernetes;
> * эффективная разработка и тестирование кода в среде командной работы.
> * определение базовых функций с помощью Dev Spaces для простой проверки отдельных изменений в контексте более крупного приложения для микрослужб.

Теперь, после ознакомления с Azure Dev Spaces, [предоставьте доступ к пространству разработки своему сотруднику](how-to/share-dev-spaces.md) и покажите ему, как просто работать вместе.

## <a name="clean-up"></a>Очистка
Чтобы полностью удалить экземпляр Azure Dev Spaces из кластера, включая все среды разработки и работающие службы, используйте команду `az aks remove-dev-spaces`. Не забывайте, что это действие необратимо. Позднее вы сможете снова добавить в кластер поддержку Azure Dev Spaces, но в этом случае вам придется начать работу с нуля. Прежние службы и среды не будут восстановлены.

С помощью приведенного ниже примера кода можно вывести список контроллеров Azure Dev Spaces в активной подписке, а затем удалить контроллер Azure Dev Spaces, связанный с кластером AKS myaks в группе ресурсов myaks-rg.

```cmd
azds controller list
```

```azurecli
az aks remove-dev-spaces --name myaks --resource-group myaks-rg
```
