---
title: Как работает подключение компьютера разработки к кластеру AKS
services: azure-dev-spaces
ms.date: 03/24/2020
ms.topic: conceptual
description: Описывает процессы использования Пространства Azure Dev для подключения компьютера разработки к кластеру службы Azure Kubernetes
keywords: Пространства Azure Dev, Dev Spaces, Докер, Кубернетес, Лазурный берег, AKS, служба Azure Kubernetes, контейнеры
ms.openlocfilehash: a74a5a623006ccd64441023c2c4bc9ad3dcb517e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80241716"
---
# <a name="how-connecting-your-development-computer-to-your-aks-cluster-works"></a>Как работает подключение компьютера разработки к кластеру AKS

С помощью Azure Dev Spaces можно подключить компьютер разработки к кластеру AKS, что позволяет запускать и отлажовать код на компьютере разработки, как если бы он работал на кластере. Пространства Azure Dev перенаправляют трафик между подключенным кластером AKS, запустив стручок на кластере, который действует как удаленный агент для перенаправления трафика между машиной разработки и кластером. Это перенаправление трафика позволяет коду на компьютере разработки и службам, работающим в кластере AKS, общаться так, как если бы они находились в одном кластере AKS. Это соединение также позволяет запускать и отлажовать код с или без контейнера на компьютере разработки. Подключение компьютера разработки к кластеру позволяет быстро разрабатывать приложение и выполнять сквозное тестирование.

## <a name="connecting-to-your-cluster"></a>Подключение к кластеру

Вы подключаетесь к существующему кластеру AKS с помощью [Visual Studio Code][vs-code] с расширением [Azure Dev Spaces,][azds-vs-code] установленным на MacOS или Windows 10. Когда вы устанавливаете соединение, у вас есть возможность перенаправить весь трафик на и из нового или существующего стручка в кластере на компьютер разработки.

> [!NOTE]
> При использовании Visual Studio Code для подключения к кластеру расширение Azure Dev Spaces дает возможность перенаправить службу на компьютер разработки. Эта опция является удобным способом для определения стручка для перенаправления. Все перенаправление между кластером AKS и компьютером разработки предназначено для капсулы.

Подключение к кластеру не требует включения пространства Azure Dev spaces в кластере. Вместо этого, когда расширение Azure Dev Spaces устанавливает подключение к кластеру, оно:

* Заменяет контейнер в капсуле на кластере AKS с помощью контейнера удаленного агента, который перенаправляет трафик на компьютер разработки. При перенаправлении нового стручка Azure Dev Spaces создает новую стручок в кластере AKS с помощью удаленного агента.
* Запускает [порт kubectl вперед][kubectl-port-forward] на компьютере разработки для переадресации трафика с компьютера разработки на удаленный агент, работающий в кластере.
* Собирает информацию о среде из кластера с помощью удаленного агента. Эта информация о среде включает переменные среды, видимые службы, объемные крепления и тайные крепления.
* Настройка среды в терминале Visual Studio Code, чтобы служба на компьютере разработки мог получить доступ к тем же переменным, как если бы она работала в кластере.  
* Обновляет файл хостов для отображения служб в кластере AKS на локальные IP-адреса на компьютере разработки. Эти записи файлов хостов позволяют коду, работаемому на компьютере разработки, делать запросы другим службам, работающим в кластере. Для обновления файла хостов Azure Dev Spaces запрашивает доступ администратора на компьютере разработки при подключении к кластеру.

Если в кластере включены пространства Azure Dev Spaces, у вас также есть возможность использовать [перенаправление трафика, предлагаемое Azure Dev Spaces.][how-it-works-routing] Перенаправление трафика, предлагаемое Azure Dev Spaces, позволяет подключиться к копии службы, работая в пространстве для разработчиков детей. Использование пространства для разработки ребенка помогает вам избежать нарушения других, работающих в пространстве родительского разработчика, так как вы только перенаправляете трафик, ориентированный на экземпляр детского пространства вашей службы, оставляя экземпляр родительского пространства службы неизмененным.

После подключения к кластеру трафик направляется на компьютер разработки независимо от того, работает ли служба на компьютере разработки.

## <a name="running-code-on-your-development-computer"></a>Запуск кода на компьютере разработки

После установления подключения к кластеру AKS можно запустить любой код на компьютере без контейнеризации. Любой сетевой трафик, который получает удаленный агент, перенаправляется в местный порт, указанный во время соединения, чтобы ваш родной код мог принимать и обрабатывать этот трафик. Переменные среды, объемы и секреты из кластера доступны для кода, работающегося на компьютере разработки. Кроме того, из-за записи файлов хостов и переадресации портов, добавленных на компьютер разработчика Azure Dev Spaces, код может отправлять сетевой трафик службам, работающим в кластере, используя имена служб из кластера, и трафик перенаправляется в службы, работающие в кластере.

Поскольку ваш код работает на компьютере разработки, у вас есть гибкость, чтобы использовать любой инструмент, который обычно используется для разработки для запуска кода и отладки его. Трафик направляется между компьютером разработки и кластером все время подключения. Это постоянное соединение позволяет запускать, останавливать и перезапускать код столько, сколько вам нужно, без необходимости восстановления соединения.

Кроме того, Azure Dev Spaces предоставляет способ репликации переменных среды и установленных файлов, доступных для стручков в кластере AKS в компьютере разработки через файл *azds-local.env.* Вы также можете использовать этот файл для создания новых переменных среды и объемных креплений.

## <a name="additional-configuration-with-azds-localenv"></a>Дополнительная конфигурация с azds-local.env

Файл *azds-local.env* позволяет воспроизводить переменные среды и установленные файлы, доступные вашим стручкам в кластере AKS. Вы можете указать следующие действия в файле *azds-local.env:*

* Скачать объем и установить путь к этому объему в качестве переменной среды.
* Скачать отдельный файл или набор файлов из тома и смонтировать его на компьютере разработки.
* Сделайте службу доступной независимо от кластера, к который вы подключены.

Вот пример *файла azds-local.env:*

```
# This downloads the "whitelist" volume from the container,
# saves it to a temporary directory on your development computer,
# and sets the full path to an environment variable called WHITELIST_PATH.

WHITELIST_PATH=${volumes.whitelist}/whitelist

# This downloads a file from the container's 'default-token-<any>' mount directory 
# to /var/run/secrets/kubernetes.io/serviceaccount on your development computer.

KUBERNETES_IN_CLUSTER_CONFIG_OVERWRITE=${volumes.default-token-*|/var/run/secrets/kubernetes.io/serviceaccount}

# This makes the myapp1 service available to your development computer
# regardless of the AKS cluster you are connected to and
# sets the local IP to an environment variable called MYAPP1_SERVICE_HOST.

# If the myapp1 service is made available in this way, 
# you can also access it using "myapp1" and "myapp1.svc.cluster.local"
# in addition to the IP in the MYAPP1_SERVICE_HOST environment variable.

MYAPP1_SERVICE_HOST=${services.myapp1}

# This makes the service myapp2 in namespace mynamespace available to your 
# development computer regardless of the AKS cluster you are connected to and
# sets the local IP to an environment variable called MYAPP2_SERVICE_HOST.

MYAPP2_SERVICE_HOST=${services.mynamespace.myapp2}
```

Файл *azds-local.env* по умолчанию не создается автоматически, поэтому необходимо вручную создать файл в корне проекта.

## <a name="diagnostics-and-logging"></a>Диагностика и ведение журнала

При подключении к кластеру AKS диагностические журналы из кластера регистрируются во [временный каталог][azds-tmp-dir]компьютера разработки. Используя Visual Studio Code, вы также можете использовать команду *show diagnostic info* для печати текущих переменных среды и записей DNS из кластера AKS.

## <a name="next-steps"></a>Дальнейшие действия

Для начала подключения локального компьютера разработки к кластеру AKS [см.][connect]

[azds-tmp-dir]: troubleshooting.md#before-you-begin
[azds-vs-code]: https://marketplace.visualstudio.com/items?itemName=azuredevspaces.azds
[connect]: how-to/connect.md
[how-it-works-routing]: how-dev-spaces-works-routing.md
[kubectl-port-forward]: https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward
[vs-code]: https://code.visualstudio.com/download
