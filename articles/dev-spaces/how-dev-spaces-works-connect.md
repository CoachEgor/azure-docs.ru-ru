---
title: Как работает подключение компьютера разработчика к кластеру AKS
services: azure-dev-spaces
ms.date: 03/24/2020
ms.topic: conceptual
description: Описание процессов, использующих Azure Dev Spaces для подключения компьютера разработчика к кластеру службы Azure Kubernetes.
keywords: Azure Dev Spaces, пространства разработки, Docker, Kubernetes, Azure, AKS, служба Kubernetes Azure, контейнеры
ms.openlocfilehash: a74a5a623006ccd64441023c2c4bc9ad3dcb517e
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80241716"
---
# <a name="how-connecting-your-development-computer-to-your-aks-cluster-works"></a>Как работает подключение компьютера разработчика к кластеру AKS

С Azure Dev Spaces можно подключить компьютер разработчика к кластеру AKS, что позволит запускать и отлаживать код на компьютере разработчика, как если бы он был запущен в кластере. Azure Dev Spaces перенаправляет трафик между подключенным кластером AKS, запуская в кластере модуль, который выступает в качестве удаленного агента для перенаправления трафика между компьютером разработки и кластером. Это перенаправление трафика позволяет взаимодействовать с кодом на компьютере разработчика и в службах, работающих в кластере AKS, так, будто они находятся в одном кластере AKS. Это подключение также позволяет запускать и отлаживать код с контейнером на компьютере разработчика или без него. Подключение компьютера разработчика к кластеру поможет быстро разработать приложение и выполнить комплексное тестирование.

## <a name="connecting-to-your-cluster"></a>Подключение к кластеру

Вы подключаетесь к существующему кластеру AKS с помощью [Visual Studio Code][vs-code] с установленным расширением [Azure dev Spaces][azds-vs-code] , которое выполняется в MacOS или Windows 10. При установлении подключения вы можете перенаправлять весь входящий и исходящий трафик нового или существующего модуля в кластере на компьютер разработчика.

> [!NOTE]
> При использовании Visual Studio Code для подключения к кластеру расширение Azure Dev Spaces предоставляет возможность перенаправления службы на компьютер разработчика. Этот параметр является удобным способом для обнаружения типа POD для перенаправления. Все перенаправление между кластером AKS и компьютером разработки предназначено для Pod.

Для подключения к кластеру не требуется включать Azure Dev Spaces в кластере. Вместо этого, когда расширение Azure Dev Spaces устанавливает подключение к кластеру, оно:

* Заменяет контейнер в модуле Pod в кластере AKS удаленным контейнером агента, который перенаправляет трафик на компьютер разработчика. При перенаправлении нового Pod Azure Dev Spaces создает в кластере AKS новый Pod с удаленным агентом.
* Запускает [порт kubectl][kubectl-port-forward] на компьютере разработчика, чтобы перенаправлять трафик с компьютера разработчика на удаленный агент, запущенный в кластере.
* Собирает сведения о среде из кластера с помощью удаленного агента. Эти сведения о среде включают в себя переменные среды, видимые службы, подключения томов и подключения секретов.
* Настраивает среду в Visual Studio Code терминале, чтобы служба на компьютере разработки могла обращаться к тем же переменным, что и при выполнении в кластере.  
* Обновляет файл hosts, чтобы сопоставлять службы в кластере AKS с локальными IP-адресами на компьютере разработчика. Эти записи размещаются в файлах, разрешающих выполнение кода на компьютере разработчика для выполнения запросов к другим службам, запущенным в кластере. Чтобы обновить файл hosts, Azure Dev Spaces запросит у администратора на компьютере разработчика доступ к кластеру.

Если в кластере Azure Dev Spaces включен, можно также использовать [Перенаправление трафика, предлагаемое Azure dev Spaces][how-it-works-routing]. Перенаправление трафика, предлагаемое Azure Dev Spaces, позволяет подключиться к копии службы, работающей в дочернем пространстве разработки. Использование дочернего пространства разработки помогает избежать нарушения работы других пользователей в родительском пространстве разработки, так как вы перенаправляете только трафик, предназначенный для экземпляра службы дочернего пространства, оставляя экземпляр родительского пространства службы неизменным.

После подключения к кластеру трафик направляется на компьютер разработчика независимо от того, работает ли служба на компьютере разработчика.

## <a name="running-code-on-your-development-computer"></a>Выполнение кода на компьютере разработчика

После установления подключения к кластеру AKS можно запускать любой код на компьютере без контейнера. Любой сетевой трафик, получаемый удаленным агентом, перенаправляется на локальный порт, указанный во время подключения, чтобы собственный код мог принять и обработать этот трафик. Переменные среды, тома и секреты из кластера становятся доступными для кода, выполняемого на компьютере разработчика. Кроме того, из-за добавления записей файлов и перенаправления портов на компьютер разработчика Azure Dev Spaces код может отправлять сетевой трафик в службы, работающие в кластере, используя имена служб из кластера, и этот трафик перенаправляется в службы, запущенные в кластере.

Поскольку код выполняется на компьютере разработчика, вы можете использовать любой инструмент, который обычно используется для разработки, для выполнения кода и его отладки. Трафик направляется между компьютером разработки и кластером в течение всего времени подключения. Это постоянное подключение позволяет запускать, прекращать и перезапускать код так же, как вам нужно без повторного создания подключения.

Кроме того, Azure Dev Spaces предоставляет способ репликации переменных среды и подключенных файлов, доступных для модулей Pod в кластере AKS на компьютере разработчика с помощью файла *аздс-локал. env* . Этот файл также можно использовать для создания новых переменных среды и подключений томов.

## <a name="additional-configuration-with-azds-localenv"></a>Дополнительная настройка с помощью аздс-локал. env

Файл *аздс-локал. env* позволяет реплицировать переменные среды и подключенные файлы, доступные для модулей Pod в кластере AKS. В файле *аздс-локал. env* можно указать следующие действия.

* Скачайте том и задайте путь к этому тому в качестве переменной среды.
* Скачайте отдельный файл или набор файлов с тома и подключите его на компьютере разработчика.
* Сделать службу доступной независимо от кластера, к которому вы подключены.

Ниже приведен пример файла *аздс-локал. env* :

```
# This downloads the "whitelist" volume from the container,
# saves it to a temporary directory on your development computer,
# and sets the full path to an environment variable called WHITELIST_PATH.

WHITELIST_PATH=${volumes.whitelist}/whitelist

# This downloads a file from the container's 'default-token-<any>' mount directory 
# to /var/run/secrets/kubernetes.io/serviceaccount on your development computer.

KUBERNETES_IN_CLUSTER_CONFIG_OVERWRITE=${volumes.default-token-*|/var/run/secrets/kubernetes.io/serviceaccount}

# This makes the myapp1 service available to your development computer
# regardless of the AKS cluster you are connected to and
# sets the local IP to an environment variable called MYAPP1_SERVICE_HOST.

# If the myapp1 service is made available in this way, 
# you can also access it using "myapp1" and "myapp1.svc.cluster.local"
# in addition to the IP in the MYAPP1_SERVICE_HOST environment variable.

MYAPP1_SERVICE_HOST=${services.myapp1}

# This makes the service myapp2 in namespace mynamespace available to your 
# development computer regardless of the AKS cluster you are connected to and
# sets the local IP to an environment variable called MYAPP2_SERVICE_HOST.

MYAPP2_SERVICE_HOST=${services.mynamespace.myapp2}
```

Файл *аздс-локал. env* по умолчанию не создается автоматически, поэтому необходимо вручную создать файл в корне проекта.

## <a name="diagnostics-and-logging"></a>Диагностика и ведение журнала

При подключении к кластеру AKS журналы диагностики из кластера записываются в [временный каталог][azds-tmp-dir]компьютера разработки. С помощью Visual Studio Code можно также использовать команду " *отобразить диагностическую информацию* ", чтобы напечатать текущие переменные среды и записи DNS из кластера AKS.

## <a name="next-steps"></a>Дальнейшие шаги

Чтобы приступить к подключению локального компьютера разработки к кластеру AKS, см. статью [Подключение компьютера разработчика к кластеру AKS][connect].

[azds-tmp-dir]: troubleshooting.md#before-you-begin
[azds-vs-code]: https://marketplace.visualstudio.com/items?itemName=azuredevspaces.azds
[connect]: how-to/connect.md
[how-it-works-routing]: how-dev-spaces-works-routing.md
[kubectl-port-forward]: https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward
[vs-code]: https://code.visualstudio.com/download
