---
title: Как работает настройка кластера для пространства Azure Dev
services: azure-dev-spaces
ms.date: 03/24/2020
ms.topic: conceptual
description: Описывает, как работает создание кластера службы Azure Kubernetes для пространства Azure Dev
keywords: Пространства Azure Dev, Dev Spaces, Докер, Кубернетес, Лазурный берег, AKS, служба Azure Kubernetes, контейнеры
ms.openlocfilehash: 00f8262f3008ce9ba82726960f78d18395458a2a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80241729"
---
# <a name="how-setting-up-a-cluster-for-azure-dev-spaces-works"></a>Как работает настройка кластера для пространства Azure Dev

Azure Dev Spaces предоставляет вам множество способов быстрой итерации и отладки приложений Kubernetes и совместной работы с вашей командой в кластере Azure Kubernetes Service (AKS). Один из способов — включить пробелы Azure Dev в кластере AKS, чтобы вы [могли запускать службы непосредственно в кластере][how-it-works-up] и использовать [дополнительные возможности сетей и реуктораций.][how-it-works-routing] В этой статье описывается, что происходит при подготовке кластера и вводе пробелов Azure Dev Spaces.

## <a name="prepare-your-aks-cluster"></a>Подготовьте кластер AKS

Чтобы подготовить кластер AKS для Dev Spaces, проверьте, что кластер AKS находится в регионе, [поддерживаемом Пространствами Azure Dev Spaces,][supported-regions] и вы работаете под управлением Kubernetes 1.10.3 или позже. Чтобы включить пробелы Azure Dev в вашем кластере с портала Azure, перейдите к кластеру, нажмите *Dev Spaces,* измените *используйте пробелы Dev* *для Yes*и нажмите *Кнопка*. Вы также можете включить пространства Azure Dev из `az aks use-dev-spaces`Azure CLI, запустив.

Пример омичения кластера AKS для Dev Spaces можно ознакомьтесь с [быстрым запуском разработки группы.][quickstart-team]

Когда пробелы Azure Dev включены в кластер AKS, он устанавливает контроллер для кластера. Контроллер находится за пределами кластера AKS. Он управляет поведением и коммуникацией между инструментарием со стороны клиента и кластером AKS. Как только он включен, вы можете взаимодействовать с контроллером с помощью инструмента со стороны клиента.

Контроллер выполняет следующие действия:

* Управляет созданием и выбором пространства разработчиков.
* Устанавливает диаграмму helm приложения и создает объекты Kubernetes.
* Создает изображение контейнера приложения.
* Развертывает приложение в AKS.
* Делает постепенные сборки и перезагрузки при изменении исходного кода.
* Управляет журналами и http-трассировками.
* Форварды stdout и stderr к клиенту стороне инструмента.
* Настраивает на себя для приложений в пространстве, а также в родительских и детских пространствах.

Контроллер является отдельным ресурсом Azure за пределами кластера и выполняет следующие вопросы для ресурсов в кластере:

* Создает или обозначает пространство имен Kubernetes для использования в качестве пространства разработчиков.
* Удаляет любое пространство имен Kubernetes под названием *azds,* если оно существует, и создает новое.
* Развертывает конфигурацию веб-крючка Kubernetes.
* Развертывает сервер приема веб-крючка.

Он использует тот же принцип службы, который используется кластером AKS для вызова вызовов служб другим компонентам Azure Dev Spaces.

![Пространства Azure Dev готовят кластер](media/how-dev-spaces-works/prepare-cluster.svg)

Для использования пространства Azure Dev должно быть по крайней мере одно пространство разработчиков. Пространства Azure Dev используют пространства имен Kubernetes в кластере AKS для пространства разработчиков. Когда контроллер устанавливается, он побуждает вас создать новое пространство имен Kubernetes или выбрать существующее пространство имен для использования в качестве первого пространства разработчиков. По умолчанию контроллер предлагает обновить существующее пространство имен Kubernetes *по умолчанию* до вашего первого пространства разработчиков.

Когда пространство имен обозначено как пространство разработчиков, контроллер добавляет *azds.io/space=true* этикетку к этому пространству имен, чтобы идентифицировать его как пространство разработчиков. Начальное пространство разработчиков, создаваемых или обозначаемых, выбирается по умолчанию после подготовки кластера. При выборе пространства оно используется пространствами Azure Dev для создания новых рабочих нагрузок.

Вы можете использовать инструменты на стороне клиента для создания новых пространств разработчиков и удаления существующих пространств разработчиков. Из-за ограничения в Kubernetes пространство разработчиков *по умолчанию* не может быть удалено. Контроллер также удаляет все существующие пространства имен Kubernetes, названные *azds,* чтобы избежать конфликтов с `azds` командой, используемой инструментарием со стороны клиента.

Сервер приема веб-крючка Kubernetes используется для впрыска стручков с тремя контейнерами во время развертывания для приборов: контейнер devspaces-прокси, контейнер devspaces-proxy-init и контейнер devspaces-build. **Все три этих контейнера работают с корневым доступом в кластере AKS.** Они также используют тот же принцип службы, который используется кластером AKS для вызова вызовов служб другим компонентам Azure Dev Spaces.

![Сервер приема в веб-крюк Azure Dev Spaces Kubernetes](media/how-dev-spaces-works/kubernetes-webhook-admission-server.svg)

Контейнер devspaces-прокси - это входная машина, которая обрабатывает весь трафик TCP в контейнер приложения и выходит из нее и помогает выполнять правила. Контейнер devspaces-proxy перенаправляет http-сообщения, если используются определенные пробелы. Например, он может помочь в маршруте http-сообщений между приложениями в родительских и детских пространствах. Все не-HTTP трафик проходит через devspaces-прокси неизменены. Контейнер devspaces-прокси также регистрирует все входящие и исходящие http-сообщения и отправляет их в инструменты на стороне клиента в качестве следов. Эти следы могут быть просмотрены разработчиком для проверки поведения приложения.

Контейнер devspaces-proxy-init — это [контейнер init,](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/) который добавляет дополнительные правила реуктора, основанные на пространственной иерархии, в контейнер приложения. Он добавляет правила разгрома, обновляя конфигурацию файла и iptables контейнера приложения */etc/resolv.conf* перед его запуском. Обновления на */etc/resolv.conf* позволяют разрешать DNS служб в родительских пространствах. Обновления конфигурации iptables гарантируют, что весь трафик TCP в контейнер приложения и из его нее направляется, хотя devspaces-прокси. Все обновления от devspaces-прокси-ина происходят в дополнение к правилам, которые добавляет Kubernetes.

Контейнер devspaces-build является контейнером init и имеет исходный код проекта и розетку Docker. Исходный код проекта и доступ к Docker позволяют контейнеру приложений быть построеннепосредственно стручка.

> [!NOTE]
> Пространства Azure Dev используют тот же узел для создания контейнера приложения и его запуска. В результате Azure Dev Spaces не нуждается во внешнем реестре контейнеров для создания и запуска приложения.

Сервер приема веб-хуков Kubernetes прислушивается к любому новому стручок, созданный в кластере AKS. Если этот стручок развернут в любом пространстве имен с *azds.io/space=true* этикетке, он вводит этот стручок с дополнительными контейнерами. Контейнер для сборки devspaces вводится только в том случае, если контейнер приложения запущен с помощью инструмента со стороны клиента.

После того как вы подготовили кластер AKS, вы можете использовать инструменты на стороне клиента для подготовки и запуска кода в вашем пространстве разработчиков.

## <a name="client-side-tooling"></a>Инструментирование стороны клиента

Инструментирование на стороне клиента позволяет пользователю:
* Создание файла конфигурации Dockerfile, Helm и azure Dev Spaces для приложения.
* Создание родительских и детских пространств разработчиков.
* Сообщите контроллеру, чтобы он построил и запустит приложение.

В то время как приложение работает, клиент стороне инструмента также:
* Получает и отображает stdout и stderr из приложения, работая в AKS.
* Использует [порт-вперед,](https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/) чтобы разрешить доступ к\/веб-приложению с помощью http:/localhost.
* Прикрепляет отладчик к запущенному приложению в AKS.
* Синхронизирует исходный код с вашим пространством разработчиков при обнаружении изменений для дополнительных сборок, что позволяет быстро итерировать.
* Позволяет подключить машину разработчика непосредственно к кластеру AKS.

Инструментирование на стороне клиента из командной строки `azds` можно использовать как часть команды. Вы также можете использовать инструменты на стороне клиента с:

* Визуальный студийный код с использованием [расширения Azure Dev Spaces](https://marketplace.visualstudio.com/items?itemName=azuredevspaces.azds).
* Визуальная студия с [визуальными инструментами студии для Kubernetes](https://aka.ms/get-vsk8stools).

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать больше об использовании инструмента со стороны клиента для подготовки и запуска кода в вашем пространстве разработчиков, см. [Как работает подготовка проекта для Azure Dev Spaces.][how-it-works-prep]

Для начала использования Azure Dev Spaces для разработки команд можно увидеть [разработку группы в quickstart Azure Dev Spaces.][quickstart-team]

[how-it-works-prep]: how-dev-spaces-works-prep.md
[how-it-works-routing]: how-dev-spaces-works-routing.md
[how-it-works-up]: how-dev-spaces-works-up.md
[supported-regions]: https://azure.microsoft.com/global-infrastructure/services/?products=kubernetes-service
[quickstart-team]: quickstart-team-development.md