---
title: Как работает routing с пространствами Azure Dev
services: azure-dev-spaces
ms.date: 03/24/2020
ms.topic: conceptual
description: Описывает процессы, которые питают пространства Azure Dev spaces, и как работает routing
keywords: Пространства Azure Dev, Dev Spaces, Докер, Кубернетес, Лазурный берег, AKS, служба Azure Kubernetes, контейнеры
ms.openlocfilehash: e9bc1875c053335da6a8e2603406bcdb34a6dd04
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80241391"
---
# <a name="how-routing-works-with-azure-dev-spaces"></a>Как работает routing с пространствами Azure Dev

Azure Dev Spaces предоставляет вам множество способов быстрой итерации и отладки приложений Kubernetes и совместной работы с вашей командой в кластере Azure Kubernetes Service (AKS). После запуска проекта в пространстве разработчиков Azure Dev Spaces предоставляет дополнительные возможности сетей и реукторов для вашего проекта.

В этой статье описывается, как работают с Dev Spaces.

## <a name="how-routing-works"></a>Как работает routing

Пространство разработчиков построено поверх AKS и использует те же [сетевые концепции.](../aks/concepts-network.md) Azure Dev Spaces также имеет централизованную службу *ingressmanager* и развертывает свой собственный контроллер ingress в кластер akS. Служба *ingressmanager* отслеживает кластеры AKS с пробелами разработчиков и дополняет контроллер Azure Dev Spaces Ingress Controller в кластере с объектами Ingress для реаутирования в стручки приложений. Контейнер devspaces-прокси в каждой `azds-route-as` капсуле добавляет заголовок HTTP для трафика HTTP в пространство разработчиков на основе URL. Например, запрос на *http://azureuser.s.default.serviceA.fedcba09...azds.io* URL получит заголовок `azds-route-as: azureuser`HTTP с помощью: Контейнер devspaces-proxy не добавит `azds-route-as` заголовок, если он уже присутствует.

Когда запрос HTTP поступает в службу из-за пределов кластера, запрос переходит к контроллеру Ingress. Контроллер Ingress направляет запрос непосредственно в соответствующий модуль на основе объектов и правил Ingress. Контейнер devspaces-прокси в стручке получает `azds-route-as` запрос, добавляет заголовок на основе URL, а затем направляет запрос в контейнер приложения.

Когда запрос HTTP поступает в службу из другой службы в кластере, запрос сначала проходит через контейнер devspaces-прокси-сервер службы вызова. Контейнер devspaces-прокси просматривает запрос HTTP `azds-route-as` и проверяет заголовок. На основе заголовка контейнер devspaces-proxy будет искать IP-адрес службы, связанный со значением заголовка. При обнаружении IP-адреса контейнер devspaces-proxy перенаправляет запрос на этот IP-адрес. Если IP-адрес не найден, контейнер devspaces-proxy направляет запрос в контейнер родительского приложения.

Например, *приложения serviceA* и *serviceB* развертываются в пространстве родительского разработчика, называемом *по умолчанию.* *serviceA* полагается на *сервисB* и делает HTTP звонки на него. Azure User создает пространство для разработки ребенка на основе пространства *по умолчанию,* называемого *azureuser.* Пользователь Azure также развертывает свою собственную версию *serviceA* в своем детском пространстве. При запросе на: *http://azureuser.s.default.serviceA.fedcba09...azds.io*

![Зона Лазурных пространств](media/how-dev-spaces-works/routing.svg)

1. Контроллер Ingress ищет IP для стручка, связанного с URL-, который является *serviceA.azureuser*.
1. Контроллер Ingress находит IP для стручка в пространстве разработчиков Azure User и направляет запрос на стручок *serviceA.azureuser.*
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* получает запрос и добавляет `azds-route-as: azureuser` в качестве заголовка HTTP.
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* направляет запрос в контейнер *приложения serviceA* в стручке *serviceA.azureuser.*
1. Приложение *serviceA* в сервисном стручке *serviceA.azureuser* делает звонок в *сервисB.* Приложение *serviceA* также содержит код `azds-route-as` для сохранения существующего `azds-route-as: azureuser`заголовка, который в данном случае является .
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* получает запрос и ищет IP *serviceB* на основе значения `azds-route-as` заголовка.
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* не находит IP для *serviceB.azureuser.*
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* ищет IP для *serviceB* в родительском пространстве, которое является *serviceB.default*.
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* находит IP для *serviceB.default* и направляет запрос в стручок *serviceB.default.*
1. Контейнер devspaces-прокси в стручке *serviceB.default* получает запрос и направляет запрос в контейнер приложения *serviceB* в стручок *приложения serviceB.default.*
1. Приложение *serviceB* в *сервисеB.default* pod возвращает ответ на стручок *serviceA.azureuser.*
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* получает ответ и направляет ответ на контейнер *приложения serviceA* в стручке *serviceA.azureuser.*
1. Приложение *serviceA* получает ответ, а затем возвращает свой собственный ответ.
1. Контейнер devspaces-прокси в стручке *serviceA.azureuser* получает ответ от контейнера приложения *serviceA* и направляет ответ исходного вызываемого абонента за пределами кластера.

Все остальные TCP трафик, который не HTTP проходит через контроллер Ingress и devspaces-прокси контейнеры неизменены.

## <a name="sharing-a-dev-space"></a>Совместное использование пространства разработчиков

При работе с командой можно [совместно разработать пространство разработчиков по всей команде](how-to/share-dev-spaces.md) и создать производные пространства разработчиков. Пространство разработчиков может быть использовано любым лицом, предоставляющим доступ к группе ресурсов пространства разработчиков.

Вы также можете создать новое пространство разработчиков, которое происходит от другого пространства разработчиков. При создании производного пространства разработчиков *azds.io/parent-space=PARENT-SPACE-NAME* метка добавляется в пространство имени производного пространства dev. Кроме того, все приложения из родительского пространства разработчиков совместно с производным пространством разработчиков. При развертывании обновленной версии приложения в производное пространство разработчиков оно будет существовать только в производном пространстве разработчиков, а пространство родительского разработчика останется незатронутым. Вы можете иметь максимум три уровня производных девиантных пространств или *бабушки и дедушки* пространств.

Полученное пространство разработчиков также разумно будет направлять запросы между собственными приложениями и приложениями, совместно распространяемыми от его родителя. Маршрутная работа работает, пытаясь направить запрос в приложение в производное пространство разработчиков и отскакивая к общему приложению из родительского пространства разработчиков. Если приложение не находится в родительском пространстве, то это будет обратно в общее приложение в пространстве бабушки и дедушки.

Пример:
* По *умолчанию* пространства разработчиков есть *приложения serviceA* и *serviceB.*
* *Лазурный лазурик* пространства разработчиков происходит от *значения по умолчанию.*
* Обновленная версия *serviceA* развернута в *azureuser.*

При использовании *azureuser*все запросы на *serviceA* будут направляться в обновленную версию в *azureuser.* Запрос на *обслуживаниеB* сначала попытается быть направлен на *лазурную* версию *serviceB.* Поскольку он не существует, он будет направлен в версию *службы* *по умолчанию.* Если *версия azureuser* *serviceA* удалена, все запросы на *serviceA* будут обратно использовать версию *serviceA* *по умолчанию.*

## <a name="next-steps"></a>Дальнейшие действия

Чтобы увидеть некоторые примеры того, как Azure Dev Spaces использует скорость итерации и разработки, см., [как работает подключение машины разработки к пространству разработчиков,][how-it-works-connect]как работает [удаленная отладка кода с Azure Dev Spaces][how-it-works-remote-debugging]и Служба [действий GitHub & Azure Kubernetes.][pr-flow]

Для начала использования в области поиска с помощью Azure Dev Spaces для разработки команд можно увидеть [разработку группы в quickstart Azure Dev Spaces.][quickstart-team]

[helm-upgrade]: https://helm.sh/docs/intro/using_helm/#helm-upgrade-and-helm-rollback-upgrading-a-release-and-recovering-on-failure
[how-it-works-connect]: how-dev-spaces-works-connect.md
[how-it-works-remote-debugging]: how-dev-spaces-works-remote-debugging.md
[pr-flow]: how-to/github-actions.md
[quickstart-team]: quickstart-team-development.md
[troubleshooting]: troubleshooting.md