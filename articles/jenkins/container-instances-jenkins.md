---
title: Сборка Jenkins на экземпляре контейнера
description: Узнайте, как настроить сервер Jenkins для выполнения заданий сборки по запросу в службе "экземпляры контейнеров Azure".
ms.topic: article
ms.date: 08/31/2018
ms.openlocfilehash: 8bb84895fb581053248fbad326ea7b2c8d1873a2
ms.sourcegitcommit: f15f548aaead27b76f64d73224e8f6a1a0fc2262
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/26/2020
ms.locfileid: "77617974"
---
# <a name="use-azure-container-instances-as-a-jenkins-build-agent"></a>Использование Экземпляров контейнеров Azure в качестве агента сборки Jenkins

Экземпляры контейнеров Azure (ACI) предоставляют доступную по требованию изолированную среду выполнения с накапливаемыми ресурсами для контейнерных рабочих нагрузок. Эти характеристики делают ACI отличной платформой для масштабного выполнения заданий сборки Jenkins. В этой статье описано, как развертывать и использовать сервер Jenkins, для которого целевым объектом сборки указаны экземпляры контейнеров Azure.

Дополнительные сведения о службе "экземпляры контейнеров Azure" см. в статье о службе " [экземпляры контейнеров Azure](../container-instances/container-instances-overview.md)".

## <a name="deploy-a-jenkins-server"></a>Развертывание сервера Jenkins

1. На портале Azure выберите **Создать ресурс** и выполните поиск по строке **Jenkins**. Выберите предложения Jenkins, издателем для которого указана корпорация **Майкрософт**, и щелкните **Создать**.

2. Введите следующие сведения в форму **Основные сведения**, а затем щелкните **ОК**.

   - **Имя**. Введите имя для развертывания Jenkins.
   - **Имя пользователя**. Введите имя администратора для виртуальной машины Jenkins.
   - **Тип проверки подлинности**. Рекомендуем использовать для проверки подлинности открытый ключ SSH. Если вы выберете этот вариант, вставьте открытый ключ SSH для входа в виртуальную машину Jenkins.
   - **Подписка**— выберите подписку Azure.
   - **Группа ресурсов.** Создайте группу ресурсов или выберите существующую.
   - **Расположение**. Выберите расположение для сервера Jenkins.

   ![Основные параметры для развертывания Jenkins на портале](./media/container-instances-jenkins/jenkins-portal-01.png)

3. В форме **Дополнительные параметры** заполните следующие данные:

   - **Размер**. Выберите соответствующий вариант для виртуальной машины Jenkins.
   - **Тип диска виртуальной машины**. Выберите для сервера Jenkins один из двух вариантов: **HDD** (жесткий диск) или **SSD** (твердотельный накопитель).
   - **Виртуальная сеть**. Выберите стрелку, если необходимо изменить параметры по умолчанию.
   - **Подсети**. Выберите стрелку, проверьте информацию и щелкните **ОК**.
   - **Общедоступный IP-адрес**. Выберите стрелку, чтобы присвоить IP-адресу произвольное имя, настроите SKU и способ назначения.
   - **Метка доменного имени**. Укажите это значение, чтобы создать полный URL-адрес для виртуальной машины Jenkins.
   - **Тип выпуска Jenkins**.Выберите один из следующих вариантов: **LTS**, **Weekly build** или **Azure Verified**.

   ![Дополнительные параметры для развертывания Jenkins на портале](./media/container-instances-jenkins/jenkins-portal-02.png)

4. Для интеграции субъекта-службы выберите **Авто (MSI)** , чтобы [управляемые удостоверения для ресурсов Azure](../active-directory/managed-identities-azure-resources/overview.md) автоматически создали удостоверение проверки подлинности для экземпляра Jenkins. Выберите режим **Вручную**, если вы можете предоставить собственные учетные данные для субъекта-службы.

5. Облачные агенты настраивают облачную платформу для заданий сборки Jenkins. Для работы с этой статьей выберите **ACI**. Облачный агент ACI запускает каждое задание сборки Jenkins в отдельном экземпляре контейнера.

   ![Параметры интеграции с облаком для развертывания Jenkins на портале](./media/container-instances-jenkins/jenkins-portal-03.png)

6. Когда вы завершите настройку интеграции, щелкните **ОК**, а затем еще раз **ОК** на странице со сводной информацией о проверке. Выберите **Создать** на странице сводной **информации об условиях использования**. Развертывание сервера Jenkins занимает несколько минут.

## <a name="configure-jenkins"></a>Настройка Jenkins

1. На портале Azure перейдите к группе ресурсов Jenkins, выберите виртуальную машину Jenkins и запишите ее DNS-имя.

   ![DNS-имя в сведениях о виртуальной машине Jenkins](./media/container-instances-jenkins/jenkins-portal-fqdn.png)

2. Откройте в браузере страницу с DNS-именем виртуальной машины Jenkins и скопируйте полученную строку SSH.

   ![Инструкции по входу в Jenkins со строкой SSH](./media/container-instances-jenkins/jenkins-portal-04.png)

3. Откройте сеанс терминала в системе разработки и вставьте в него строку SSH, полученную на последнем шаге. Вместо строки `username` укажите имя пользователя, которое вы выбрали при развертывании сервера Jenkins.

4. После подключения сеанса введите следующую команду, чтобы получить исходный пароль администратора:

   ```bash
   sudo cat /var/lib/jenkins/secrets/initialAdminPassword
   ```

5. Завершите сеанс SSH и отключите туннель, а затем перейдите по адресу `http://localhost:8080` в браузере. Вставьте исходный пароль администратора в поле, а затем выберите **Продолжить**.

   ![Экран разблокировки Jenkins с полем для пароля администратора](./media/container-instances-jenkins/jenkins-portal-05.png)

6. Выберите действие **Установить предлагаемые подключаемые модули**, чтобы установить все рекомендуемые подключаемые модули Jenkins.

   ![Экран настройки Jenkins с выбранным вариантом установки предлагаемых подключаемых модулей](./media/container-instances-jenkins/jenkins-portal-06.png)

7. Создайте учетную запись администратора. Эта учетная запись потребуется для входа на экземпляр Jenkins и работы с ним.

   ![Экран создания первого администратора с заполненными учетными данными](./media/container-instances-jenkins/jenkins-portal-07.png)

8. Когда все будет готово, выберите **Сохранить и завершить**, а затем **Начать работу с Jenkins**, чтобы завершить процесс настройки.

Итак, конфигурация Jenkins завершена, и можно переходить к сборке и развертыванию кода. В этом примере для демонстрации сборки Jenkins на экземплярах контейнера Azure используется простое приложение Java.

## <a name="create-a-build-job"></a>Создание задания сборки

Теперь для демонстрации сборки Jenkins в экземпляре контейнера Azure необходимо создать задание сборки Jenkins.

1. Выберите **Новый элемент**, присвойте проекту сборки имя, например **aci-demo**, затем выберите тип **Универсальный проект** и щелкните **ОК**.

   ![Поле для ввода имени задания сборки и список типов проектов](./media/container-instances-jenkins/jenkins-new-job.png)

2. В разделе **Общие** проверьте, что установлен флажок **Ограничения для запуска этого проекта**. В поле выражения метки введите **linux**. Такая конфигурация гарантирует, что это задание сборки будет выполняться только в облаке экземпляров контейнеров Azure.

   ![Вкладка "Общие" с данными конфигурации](./media/container-instances-jenkins/jenkins-job-01.png)

3. В разделе **Сборка** выберите действие **Добавить шаг сборки** и щелкните **Выполнить оболочку**. Введите `echo "aci-demo"` в качестве команды.

   ![Вкладка сборки с выделенными значениями для шага создания](./media/container-instances-jenkins/jenkins-job-02.png)

5. Нажмите кнопку **Сохранить**.

## <a name="run-the-build-job"></a>Запустите задание сборки.

Чтобы проверить задание сборки и увидеть, как экземпляры контейнеров Azure используются в качестве платформы сборки, запустите сборку вручную.

1. Выберите **Начать сборку**, чтобы начать сборку. Запуск задания может занять несколько минут. Вы должны увидеть состояние, аналогичное показанному ниже:

   ![Сведения в журнале сборки с состоянием задания](./media/container-instances-jenkins/jenkins-job-status.png)

2. Пока выполняется задание, откройте портал Azure и найдите группу ресурсов Jenkins. Здесь вы увидите, что создан новый экземпляр контейнера. Внутри этого экземпляра выполняется задание Jenkins.

   ![Экземпляр контейнера в группе ресурсов](./media/container-instances-jenkins/jenkins-aci.png)

3. Если Jenkins выполняет больше заданий, чем настроенное число исполнителей Jenkins (по умолчанию 2), он создает несколько экземпляров контейнера.

   ![Созданные экземпляры контейнеров](./media/container-instances-jenkins/jenkins-aci-multi.png)

4. После завершения всех заданий сборки все экземпляры контейнеров удаляются.

   ![Группа ресурсов с экземпляром контейнеров удалена](./media/container-instances-jenkins/jenkins-aci-none.png)

## <a name="troubleshooting-the-jenkins-plugin"></a>Устранение неполадок подключаемого модуля Jenkins

Если вы столкнулись с ошибками, которые касаются подключаемых модулей Jenkins, сообщите о проблеме конкретного компонента в [JENKS JIRA](https://issues.jenkins-ci.org/).

## <a name="next-steps"></a>Следующие шаги

> [!div class="nextstepaction"]
> [Развертывание в службе приложений Azure с использованием подключаемого модуля Jenkins](java-deploy-webapp-tutorial.md)