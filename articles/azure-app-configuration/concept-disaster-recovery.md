---
title: 'Конфигурация приложений Azure: устойчивость и аварийное восстановление | Документация Майкрософт'
description: Общие сведения о реализации устойчивости и аварийного восстановления с помощью Конфигурации приложений Azure.
services: azure-app-configuration
documentationcenter: ''
author: yegu-ms
manager: maiye
editor: ''
ms.service: azure-app-configuration
ms.devlang: na
ms.topic: overview
ms.workload: tbd
ms.date: 05/29/2019
ms.author: yegu
ms.openlocfilehash: 39e7a62899a7d1d6feb5bfd3b45ad4adc3c996a0
ms.sourcegitcommit: 51a7669c2d12609f54509dbd78a30eeb852009ae
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/30/2019
ms.locfileid: "66394073"
---
# <a name="resiliency-and-disaster-recovery"></a>Устойчивость и аварийное восстановление

В настоящее время Конфигурация приложений Azure — это региональная служба. Каждое хранилище конфигураций создается в определенном регионе Azure. Региональный сбой повлияет на все хранилища в затронутом регионе. Конфигурация приложений не предоставляет автоматическую отработку отказа в другой регион. Эта статья содержит общие рекомендации по использованию нескольких хранилищ конфигураций в различных регионах Azure, позволяющие увеличить географическую устойчивость приложения.

## <a name="high-availability-architecture"></a>Архитектура с высоким уровнем доступности

Чтобы реализовать межрегиональную избыточность, необходимо создать несколько хранилищ конфигураций приложения в разных регионах. При такой конфигурации у приложения будет по крайней мере одно дополнительное хранилище конфигураций, на которое можно будет переключиться, если основное хранилище станет недоступным. Ниже показана схема топологии взаимодействия приложения и его основного и дополнительного хранилищ конфигураций.

![Геоизбыточные хранилища](./media/geo-redundant-app-configuration-stores.png)

Приложение будет загружать конфигурацию из основного и дополнительного хранилищ в параллельном режиме. Это значительно повышает вероятность успешного получения данных конфигурации. Вы ответственны за синхронизацию данных в обоих хранилищах. В следующих разделах объясняется, как внедрить географическую устойчивость в приложение.

## <a name="failover-between-configuration-stores"></a>Отработка отказа между хранилищами конфигураций

С технической точки зрения приложение не выполняет отработку отказа. Оно пытается получить одинаковый набор данных конфигурации из двух хранилищ конфигураций одновременно. Вам следует упорядочить код таким образом, чтобы он сначала загружал данные из дополнительного хранилища, а затем — из основного. Такой подход гарантирует, что данные конфигурации в основном хранилище будут иметь приоритет всегда, когда они доступны. Фрагмент кода ниже демонстрирует, как это можно реализовать в .NET Core.

```csharp
public static IWebHostBuilder CreateWebHostBuilder(string[] args) =>
    WebHost.CreateDefaultBuilder(args)
        .ConfigureAppConfiguration((hostingContext, config) =>
        {
            var settings = config.Build();
            config.AddAzureAppConfiguration(settings["ConnectionString_SecondaryStore"], optional: true)
                  .AddAzureAppConfiguration(settings["ConnectionString_PrimaryStore"], optional: true);
        })
        .UseStartup<Startup>();
    }
```

Обратите внимание на параметр `optional`, передаваемый в функцию `AddAzureAppConfiguration`. Если для него задано значение `true`, то этот параметр не дает приложению продолжить работу при сбое, когда функции не удается загрузить данные конфигурации.

## <a name="synchronization-between-configuration-stores"></a>Синхронизация хранилищ конфигураций

Важно, чтобы все геоизбыточные хранилища конфигураций содержали одинаковый набор данных. Можно использовать функцию **экспорта** в Конфигурации приложений,чтобы копировать данные из основного хранилища в дополнительное хранилище по запросу. Эта функция доступна на портале Azure и в интерфейсе командной строки.

На портале Azure можно отправить изменение в другое хранилище конфигураций, выполнив следующие действия.

1. Перейдите на вкладку **Импорт или экспорт**, выберите **Экспорт**, выберите службу **Конфигурация приложений** для параметра **Цель** и щелкните нажмите кнопку **Выбор ресурса**.

2. В новой колонке, которая откроется, укажите подписку, группу ресурсов и имя ресурса для дополнительного хранилища, после чего нажмите кнопку **Применить**.

3. Пользовательский интерфейс обновится, и вы сможете выбрать, какие данные конфигурации следует экспортировать в дополнительное хранилище. Можно оставить значение времени по умолчанию и задать для параметров **Из метки** и **В метку** одинаковое значение. Нажмите кнопку **Применить**.

4. Повторите описанные выше действия для всех изменений конфигурации.

Процесс экспорта можно автоматизировать с помощью Azure CLI. Приведенная ниже команда экспортирует одно изменение конфигурации из основного хранилища в дополнительное.

    az appconfig kv export --destination appconfig --name {PrimaryStore} --label {Label} --dest-name {SecondaryStore} --dest-label {Label}

## <a name="next-steps"></a>Дополнительная информация

В этой статье вы узнали, как расширить возможности приложения, чтобы достичь географической устойчивости во время выполнения для Конфигурации приложений. Кроме того, можно внедрить данные конфигурации из Конфигурации приложений на этапе сборки или развертывания. Дополнительную информацию см. в разделе [Интеграция с конвейером CI/CD](./integrate-ci-cd-pipeline.md).

