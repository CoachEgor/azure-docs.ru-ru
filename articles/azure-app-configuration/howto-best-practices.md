---
title: Лучшие практики azure App Configuration Документы Майкрософт
description: Узнайте, как наилучшим образом использовать конфигурацию приложений Azure
services: azure-app-configuration
documentationcenter: ''
author: lisaguthrie
manager: maiye
editor: ''
ms.assetid: ''
ms.service: azure-app-configuration
ms.topic: conceptual
ms.date: 05/02/2019
ms.author: lcozzens
ms.custom: mvc
ms.openlocfilehash: df56f53b64a35737700529b80c004efeb31eaabc
ms.sourcegitcommit: 8a9c54c82ab8f922be54fb2fcfd880815f25de77
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80348664"
---
# <a name="azure-app-configuration-best-practices"></a>Лучшие практики конфигурации приложений Azure

В этой статье рассматриваются общие шаблоны и рекомендации при использовании конфигурации приложений Azure.

## <a name="key-groupings"></a>Ключевые группировки

Конфигурация приложения предоставляет два варианта для организации ключей:

* Ключевые префиксы
* Метки

Вы можете использовать один или оба варианта для группы ключей.

*Ключевые префиксы* являются начальной частью ключей. Логически можно сгруппировать набор ключей, используя ту же префикс в их именах. Префиксы могут содержать несколько компонентов, `/`соединенных делимитером, таких как, подобно пути URL, для формирования пространства имен. Такие иерархии полезны при хранении ключей для многих приложений, служб компонентов и сред в одном магазине конфигурации приложений.

Важно иметь в виду, что ключи — это ссылки кода приложения для получения значений соответствующих настроек. Ключи не должны меняться, иначе вам придется изменять код каждый раз, когда это происходит.

*Этикетки* являются атрибутом на ключах. Они используются для создания вариантов ключа. Например, можно присвоить метки нескольким версиям ключа. Версия может быть итерацией, средой или какой-либо другой контекстуальной информацией. Приложение может запросить совершенно другой набор ключевых значений, указав другую метку. В результате все ключевые ссылки остаются неизменными в коде.

## <a name="key-value-compositions"></a>Композиции с ключевыми значениями

Конфигурация приложений рассматривает все сохраненные при нем ключи как независимые сущности. Конфигурация приложений не пытается сделать вывод о какой-либо связи между ключами или унаследовать ключевые значения на основе их иерархии. Однако можно агрегировать несколько наборов ключей, используя метки в сочетании с правильной укладкой конфигурации в кодприложения.

Давайте рассмотрим пример. Предположим, у вас есть параметр под названием **Asset1,** значение которого может варьироваться в зависимости от среды разработки. Вы создаете ключ под названием "Asset1" с пустой этикеткой и этикеткой под названием "Развитие". В первом метке вы размещаете значение по умолчанию для **Asset1**и ставите определенное значение для "Развития" в последнем.

В коде сначала вы извлекаете ключевые значения без каких-либо меток, а затем во второй раз получаете тот же набор ключевых значений с меткой "Разработка". При извлечении значений во второй раз предыдущие значения ключей перезаписаны. Конфигурация конфигурации .NET Core позволяет «стек» несколько наборов данных конфигурации друг на друга. Если ключ существует в нескольких наборах, используется последний набор, содержащий его. С помощью современной платформы программирования, такой как .NET Core, вы получаете эту возможность укладки бесплатно, если вы используете поставщика конфигурации для доступа к конфигурации приложений. Следующий фрагмент кода показывает, как можно реализовать укладку в приложении .NET Core:

```csharp
// Augment the ConfigurationBuilder with Azure App Configuration
// Pull the connection string from an environment variable
configBuilder.AddAzureAppConfiguration(options => {
    options.Connect(configuration["connection_string"])
           .Select(KeyFilter.Any, LabelFilter.Null)
           .Select(KeyFilter.Any, "Development");
});
```

[Использование меток для включения различных конфигураций для различных сред](./howto-labels-aspnet-core.md) является полным примером.

## <a name="app-configuration-bootstrap"></a>Загрузка конфигурации приложений

Чтобы получить доступ к магазину конфигурации приложений, можно использовать строку подключения, которая доступна на портале Azure. Поскольку строки соединения содержат информацию о учетных данных, они считаются секретами. Эти секреты должны храниться в Хранилище ключей Azure, и ваш код должен быть проверен на Key Vault, чтобы получить их.

Лучшим вариантом является использование функции управляемых идентификационных данных в Active Directory Azure. С управляемыми удостоверениями, вам нужно только URL-адрес endpoint конфигурации App, чтобы загружать доступ к вашему магазину конфигурации приложений. Url можно вставлять в код приложения (например, в файл *appsettings.json).* Подробнее о графических данных можно узнать о [графических данных.](howto-integrate-azure-managed-service-identity.md)

## <a name="app-or-function-access-to-app-configuration"></a>Доступ к конфигурации приложения или функции

Вы можете предоставить доступ к конфигурации приложений для веб-приложений или функций, используя любой из следующих методов:

* Через портал Azure введите строку подключения к магазину конфигурации приложений в настройках приложения Службы app.
* Храните строку подключения к магазину конфигурации приложений в Key Vault и [переосвяите ее из Службы Приложения.](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references)
* Используйте управляемые идентификаторы Azure для доступа к магазину конфигурации приложений. Для получения дополнительной информации [см. Интеграция с управляемыми идентификаторами Azure.](howto-integrate-azure-managed-service-identity.md)
* Нажмите конфигурацию от конфигурации приложения к службе приложений. Конфигурация приложений обеспечивает функцию экспорта (на портале Azure и Azure CLI), которая отправляет данные непосредственно в службу приложений. С помощью этого метода вам не нужно менять код приложения вообще.

## <a name="reduce-requests-made-to-app-configuration"></a>Сокращение запросов, сделанных в конфигурацию приложений

Чрезмерные запросы на конфигурацию приложения могут привести к заслонке или избытку. Чтобы уменьшить количество сделанных запросов:

* Увеличьте тайм-аут обновления, особенно если значения конфигурации не часто меняются. Укажите новый тайм-аут обновления с помощью [ `SetCacheExpiration` метода.](/dotnet/api/microsoft.extensions.configuration.azureappconfiguration.azureappconfigurationrefreshoptions.setcacheexpiration)

* Смотреть один *значок дозорного,* а не смотреть отдельные ключи. Обновите всю конфигурацию только в том случае, если ключ дозорного изменяется. Например, [воспользуйтесь динамической конфигурацией в приложении ASP.NET Core.](enable-dynamic-configuration-aspnet-core.md)

* Используйте Azure Event Grid для получения уведомлений при изменении конфигурации, а не постоянно опросдля для любых изменений. Для получения дополнительной информации о [знакомс](./howto-app-configuration-event.md)

## <a name="importing-configuration-data-into-app-configuration"></a>Импорт данных конфигурации в конфигурацию приложения

Конфигурация приложений предлагает возможность массового [импорта](https://aka.ms/azconfig-importexport1) параметров конфигурации из текущих файлов конфигурации с помощью портала Azure или CLI. Вы также можете использовать те же параметры для экспорта значений из конфигурации приложений, например между соответствующими магазинами. Если вы хотите настроить постоянную синхронизацию с репо GitHub, вы можете использовать наше [действие GitHub,](https://aka.ms/azconfig-gha2) чтобы продолжить использование существующих методов управления исходными данными, получая при этом преимущества конфигурации приложения.

## <a name="next-steps"></a>Дальнейшие действия

* [Ключи и значения](./concept-key-value.md)
