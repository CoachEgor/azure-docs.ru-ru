---
title: Используйте фильтры функций для включения функции для подмножества пользователей
titleSuffix: Azure App Configuration
description: Узнайте, как использовать фильтры функций для включения функции для подмножества пользователей
ms.service: azure-app-configuration
author: lisaguthrie
ms.author: lcozzens
ms.topic: conceptual
ms.date: 3/9/2020
ms.openlocfilehash: 181c97615985283011834dcf9145810b1563fb4a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80057002"
---
# <a name="use-feature-filters-to-enable-a-feature-for-a-subset-of-users"></a>Используйте фильтры функций для включения функции для подмножества пользователей

Функциональные флаги позволяют активировать или деактивировать функциональность в приложении. Простой флаг функции либо на или выключенном. Приложение всегда ведет себя одинаково. Например, можно выкатить новую функцию за флагом функции. Когда флаг функции включен, все пользователи видят новую функцию. Отключение флага функции скрывает новую функцию.

В отличие от этого, _условный флаг функции_ позволяет включенили или динамически отключать флаг объекта. Приложение может вести себя по-разному, в зависимости от критериев флага функции. Предположим, что сначала вы хотите показать свою новую функцию небольшому подмножею пользователей. Условный флаг функции позволяет включить флаг функции для некоторых пользователей, отключая его для других. _Фильтры функций_ определяют состояние флага функции каждый раз, когда он оценивается.

Библиотека `Microsoft.FeatureManagement` включает в себя два фильтра функции:

- `PercentageFilter`позволяет флаг функции на основе процента.
- `TimeWindowFilter`позволяет флаг утилизания в течение определенного периода времени.

Вы также можете создать свой собственный фильтр функций, который реализует [интерфейс Microsoft.FeatureManagement.IFeatureFilter.](/dotnet/api/microsoft.featuremanagement.ifeaturefilter)

## <a name="registering-a-feature-filter"></a>Регистрация фильтра функций

Вы регистрируете фильтр функции, позвонив в `AddFeatureFilter` метод, указывая имя фильтра функции. Например, следующие регистры `PercentageFilter`кода:

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
    services.AddFeatureManagement().AddFeatureFilter<PercentageFilter>();
}
```

## <a name="configuring-a-feature-filter-in-azure-app-configuration"></a>Настройка фильтра функций в конфигурации приложений Azure

Некоторые фильтры функций имеют дополнительные настройки. Например, `PercentageFilter` активирует функцию на основе процента. В нем есть параметр, определяющий процент для использования.

Эти параметры можно настроить для флагов функций, определенных в конфигурации приложений Azure. Например, выполните следующие действия, чтобы включить `PercentageFilter` флаг функции для 50% запросов в веб-приложение:

1. Следуйте инструкциям в [квикстарте: Добавьте флаги функций в приложение ASP.NET Core](./quickstart-feature-flag-aspnet-core.md) для создания веб-приложения с флагом функции.

1. На портале Azure перейдите в магазин конфигурации и нажмите **«Менеджер функций».**

1. Нажмите на контекстное меню для флага *бета-версии,* созданного в quickstart. Щелкните **Правка**.

    > [!div class="mx-imgBorder"]
    > ![Флаг edit Beta](./media/edit-beta-feature-flag.png)

1. На экране **edit** выберите кнопку **On** radio, если она еще не выбрана. Затем нажмите кнопку **Добавить фильтр.** (На **On** радио кнопки этикетка будет меняться, чтобы читать **Условный**.)

1. В поле **Key** введите *Microsoft.Percentage*.

    > [!div class="mx-imgBorder"]
    > ![Добавление фильтра функций](./media/feature-flag-add-filter.png)

1. Нажмите на контекстное меню рядом с ключом фильтра функции. Нажмите **Параметры отсеиваемого**.

    > [!div class="mx-imgBorder"]
    > ![Оторитепараметры фильтра функций](./media/feature-flag-edit-filter-parameters.png)

1. Навистите под заголовком **"Имя",** чтобы текстовые ящики отображались в сетке. Введите **имя** *значения* и **значение** 50. Поле **значения** указывает процент запросов, для которых для включения фильтра объекта.

    > [!div class="mx-imgBorder"]
    > ![Установка параметров фильтра функций](./media/feature-flag-set-filter-parameters.png)

1. Нажмите **Применить,** чтобы вернуться к экрану **флага функции Edit.** Затем нажмите **Применить** еще раз, чтобы сохранить настройки флага функции.

1. **Состояние** флага функции теперь отображается как *условное*. Это состояние указывает на то, что флаг объекта будет включен или отключен на основе запроса, основываясь на критериях, применяемых фильтром функций.

    > [!div class="mx-imgBorder"]
    > ![Условный флаг функции](./media/feature-flag-filter-enabled.png)

## <a name="feature-filters-in-action"></a>Фильтры функций в действии

Чтобы увидеть эффекты этого флага функции, запустите приложение и нажмите кнопку **Обновления** в вашем браузере несколько раз. Вы увидите, что *элемент бета-версии* отображается на панели инструментов примерно в 50% случаев. Это скрыто в остальное время, потому что `PercentageFilter` деактивирует функцию *бета-версии* для подмножества запросов. Следующее видео показывает это поведение в действии.

> [!div class="mx-imgBorder"]
> ![ПроцентФильтр в действии](./media/feature-flags-percentagefilter.gif)

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Общие сведения об управлении функциями](./concept-feature-management.md)
