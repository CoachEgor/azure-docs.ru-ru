---
title: Использование фильтров компонентов для включения функции для подмножества пользователей
titleSuffix: Azure App Configuration
description: Узнайте, как использовать фильтры компонентов, чтобы включить функцию для подмножества пользователей.
ms.service: azure-app-configuration
author: lisaguthrie
ms.topic: conceptual
ms.date: 3/9/2020
ms.author: lcozzens
ms.openlocfilehash: b01a22d5a7068ee49e718a66432f52a8f6ef02ac
ms.sourcegitcommit: f97d3d1faf56fb80e5f901cd82c02189f95b3486
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2020
ms.locfileid: "79126499"
---
# <a name="use-feature-filters-to-enable-a-feature-for-a-subset-of-users"></a>Использование фильтров компонентов для включения функции для подмножества пользователей

Флаги компонентов позволяют активировать или деактивировать функциональные возможности в приложении. Простой флаг функции имеет значение ON или OFF. Приложение всегда ведет себя таким же образом. Например, можно развернуть новую функцию, которая находится за функциональным флагом. При включении флага компонента все пользователи видят новую функцию. Отключение флага компонента скрывает новую функцию.

Напротив, _Условный флаг функции_ позволяет динамически включать или отключать флаг функции. Приложение может вести себя по-разному в зависимости от условий флага компонента. Предположим, что вы хотите, чтобы новая функция отображалась небольшому числу пользователей. Условный флаг функции позволяет включить флаг компонента для некоторых пользователей, одновременно отключив его для других. _Фильтры компонентов_ определяют состояние флага компонента каждый раз, когда он оценивается.

Библиотека `Microsoft.FeatureManagement` содержит два фильтра компонентов:

- `PercentageFilter` включает флаг компонента на основе процента.
- `TimeWindowFilter` включает флаг компонента в течение заданного периода времени.

Можно также создать собственный фильтр компонентов, реализующий [интерфейс Microsoft. феатуреманажемент. ифеатурефилтер](/dotnet/api/microsoft.featuremanagement.ifeaturefilter).

## <a name="registering-a-feature-filter"></a>Регистрация фильтра компонентов

Вы регистрируете фильтр компонентов, вызывая метод `AddFeatureFilter`, указывая имя фильтра компонентов. Например, следующий код регистрирует `PercentageFilter`:

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddControllersWithViews();
    services.AddFeatureManagement().AddFeatureFilter<PercentageFilter>();
}
```

## <a name="configuring-a-feature-filter-in-azure-app-configuration"></a>Настройка фильтра компонентов в конфигурации приложения Azure

Некоторые фильтры компонентов имеют дополнительные параметры. Например, `PercentageFilter` активирует компонент на основе процента. Он имеет параметр, определяющий процент использования.

Эти параметры можно настроить для флагов компонентов, определенных в конфигурации приложения Azure. Например, выполните следующие действия, чтобы использовать `PercentageFilter` для включения флага компонента для 50% запросов к веб-приложению:

1. Следуйте инструкциям в [кратком руководстве: Добавление флагов компонентов в ASP.NET Core приложение](./quickstart-feature-flag-aspnet-core.md) для создания веб-приложения с флагом функции.

1. В портал Azure перейдите к хранилищу конфигураций и щелкните **Диспетчер компонентов**.

1. Щелкните контекстное меню для флага *бета-версии* , созданного в кратком руководстве. Нажмите кнопку **Изменить**.

    > [!div class="mx-imgBorder"]
    > ![изменить флаг бета-версии](./media/edit-beta-feature-flag.png)

1. На экране **редактирования** выберите переключатель **вкл** ., если он еще не выбран. Затем нажмите кнопку **Добавить фильтр** . (Метка **на** переключателе будет изменена на " **условие**чтения".)

1. В поле **ключ** введите *Microsoft. Percentage*.

    > [!div class="mx-imgBorder"]
    > ![добавить фильтр компонентов](./media/feature-flag-add-filter.png)

1. Щелкните контекстное меню рядом с ключом фильтра компонентов. Нажмите кнопку **изменить параметры**.

    > [!div class="mx-imgBorder"]
    > ![изменить параметры фильтра компонентов](./media/feature-flag-edit-filter-parameters.png)

1. Наведите указатель мыши под заголовком **имя** , чтобы в сетке появились текстовые поля. Введите **имя** *и* **значение** 50. В поле **значение** указывается процент запросов, для которых включается фильтр компонентов.

    > [!div class="mx-imgBorder"]
    > ![задать параметры фильтра компонентов](./media/feature-flag-set-filter-parameters.png)

1. Нажмите кнопку **Применить** , чтобы вернуться на экран **изменение флага функции** . Затем нажмите кнопку **Применить** еще раз, чтобы сохранить настройки флага функции.

1. **Состояние** флага компонента теперь отображается как *условное*. Это состояние означает, что флаг компонента будет включен или отключен для каждого запроса в зависимости от критериев, принудительно примененных фильтром компонентов.

    > [!div class="mx-imgBorder"]
    > ![условный флаг функции](./media/feature-flag-filter-enabled.png)

## <a name="feature-filters-in-action"></a>Фильтры компонентов в действии

Чтобы увидеть влияние этого флага функции, запустите приложение и нажмите кнопку **Обновить** в браузере несколько раз. Вы увидите, что *бета-версия* элемента отображается на панели инструментов около 50% времени. Он скрывает оставшуюся часть времени, поскольку `PercentageFilter` деактивирует *бета-* функцию для подмножества запросов. В следующем видео показано это поведение в действии.

> [!div class="mx-imgBorder"]
> ![Перцентажефилтер в действии](./media/feature-flags-percentagefilter.gif)

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Обзор управления функциями](./concept-feature-management.md)