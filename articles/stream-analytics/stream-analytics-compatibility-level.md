---
title: Общие сведения об уровне совместимости заданий Azure Stream Analytics
description: Узнайте, как установить уровень совместимости для задания Azure Stream Analytics и основные изменения в последнем уровне совместимости.
author: mamccrea
ms.author: mamccrea
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 5/2/2019
ms.openlocfilehash: a6e5cd69a0655bf8235bf5755ab596ca2bde0387
ms.sourcegitcommit: a52f17307cc36640426dac20b92136a163c799d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2019
ms.locfileid: "68716158"
---
# <a name="compatibility-level-for-azure-stream-analytics-jobs"></a>Уровень совместимости заданий Azure Stream Analytics

В этой статье описывается параметр уровня совместимости в Azure Stream Analytics. Stream Analytics — это управляемая служба с обычными обновлениями функций и повышением производительности. Большинство обновлений среды выполнения службы автоматически становятся доступными для конечных пользователей. 

Однако некоторые новые функции в службе могут привести к существенным изменениям, таким как изменение поведения существующего задания или изменение способа использования данных в выполняющихся заданиях. Можно предотвратить выполнение существующих заданий Stream Analytics без существенных изменений, оставляя параметр уровня совместимости ниже. Когда вы будете готовы к работе с последними поведениями среды выполнения, вы можете принять участие в этой функции, вызывая уровень совместимости. 

## <a name="choose-a-compatibility-level"></a>Выбор уровня совместимости

Уровень совместимости управляет поведением во время выполнения задания Stream Analytics. 

В настоящее время Azure Stream Analytics поддерживает три уровня совместимости:

* 1,0 — предыдущее поведение
* 1,1 — поведение по умолчанию
* 1,2 (Предварительная версия) — самое новое поведение с самыми последними улучшениями в оценке

Исходный уровень совместимости 1,0 был введен во время общей доступности Azure Stream Analytics несколько лет назад.

При создании нового Stream Analytics задания рекомендуется создать его с использованием последнего уровня совместимости. Приступите к разработке заданий, посвященной последним поведениям, чтобы избежать добавления изменений и сложности позже.

## <a name="set-the-compatibility-level"></a>Установка уровня совместимости

Можно задать уровень совместимости для задания Stream Analytics в портал Azure или с помощью [вызова REST API задания](/rest/api/streamanalytics/stream-analytics-job).

Чтобы обновить уровень совместимости задания в портал Azure:

1. Используйте [портал Azure](https://portal.azure.com) , чтобы перейти к заданию Stream Analytics.
2. Перед обновлением уровня совместимости следует прерывать задание. Если задание выполняется, уровень совместимости обновить не удастся.
3. Под заголовком **Настройка** выберите **уровень совместимости**.
4. Выберите нужное значение уровня совместимости.
5. Нажмите кнопку **сохранить** в нижней части страницы.

![Уровень совместимости Stream Analytics на портале Azure](media/stream-analytics-compatibility-level/stream-analytics-compatibility.png)

При обновлении уровня совместимости компилятор T-SQL проверяет задание с помощью синтаксиса, отвечающего выбранному уровню совместимости.

## <a name="compatibility-level-12-preview"></a>Уровень совместимости 1,2 (Предварительная версия)

На уровне совместимости 1,2 появились следующие основные изменения:

### <a name="geospatial-functions"></a>Геопространственные функции

**Предыдущие уровни:** Azure Stream Analytics использовались вычисления географического объекта.

**уровень 1,2:** Azure Stream Analytics позволяет вычислять геометрические географические координаты. В сигнатуре геопространственных функций нет изменений. Однако их семантика немного отличается, что позволяет более точно выполнять вычисления, чем раньше.

Azure Stream Analytics поддерживает индексирование геопространственных ссылочных данных. Ссылочные данные, содержащие геопространственные элементы, можно индексировать для более быстрого вычисления соединений.

Обновленные геопространственные функции обеспечивают полную выразительность геообъектного геопространственного формата (WKT). Можно указать другие геопространственные компоненты, которые ранее не поддерживались в геоjson.

Дополнительные сведения см. [в разделе обновления геопространственных функций в Azure Stream Analytics — облако и IOT Edge](https://azure.microsoft.com/blog/updates-to-geospatial-functions-in-azure-stream-analytics-cloud-and-iot-edge/).

### <a name="parallel-query-execution-for-input-sources-with-multiple-partitions"></a>Параллельное выполнение запросов для источников входных данных с несколькими секциями

**Предыдущие уровни:** Запросы Azure Stream Analytics требовали использования предложения PARTITION BY для параллельной обработки запросов во входных секциях источника.

**уровень 1,2:** Если логика запроса может быть параллельна во входных исходных секциях, Azure Stream Analytics создает отдельные экземпляры запросов и параллельно выполняет вычисления.

### <a name="native-bulk-api-integration-with-cosmosdb-output"></a>Собственная интеграция с массовым API с выходными данными CosmosDB

**Предыдущие уровни:** Поведение Upsert было *вставлено или объединено*.

**уровень 1,2:** Собственная интеграция с массовым интерфейсом API с выходными данными CosmosDB увеличивает пропускную способность и позволяет эффективно обрабатывать запросы на регулирование. Дополнительные сведения см. [на странице Azure Stream Analytics Output to Azure Cosmos DB](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-documentdb-output#improved-throughput-with-compatibility-level-12).

Поведение Upsert — *Вставить или заменить*.

### <a name="datetimeoffset-when-writing-to-sql-output"></a>DateTimeOffset при записи в выходные данные SQL

**Предыдущие уровни:** Типы [DateTimeOffset](https://docs.microsoft.com/sql/t-sql/data-types/datetimeoffset-transact-sql?view=sql-server-2017) были изменены в формате UTC.

**уровень 1,2:** DateTimeOffset больше не корректируется.

### <a name="long-when-writing-to-sql-output"></a>Long при записи в выходные данные SQL

**Предыдущие уровни:** Значения были усечены на основе целевого типа.

**уровень 1,2:** Значения, которые не помещаются в целевой тип, обрабатываются в соответствии с политикой исходящих ошибок.

### <a name="record-and-array-serialization-when-writing-to-sql-output"></a>Сериализация записей и массивов при записи в выходные данные SQL

**Предыдущие уровни:** Записи были записаны как "Record", а массивы были записаны как "Array".

**уровень 1,2:** Записи и массивы сериализуются в формате JSON.

### <a name="strict-validation-of-prefix-of-functions"></a>Жесткое подтверждение префикса функций

**Предыдущие уровни:** Отсутствует определенная проверка префиксов функций.

**уровень 1,2:** Azure Stream Analytics имеет определенную проверку префиксов функций. Добавление префикса к встроенной функции приводит к ошибке. Например,`myprefix.ABS(…)` не поддерживается.

Добавление префикса к встроенным статистическим выражениям также приводит к ошибке. Например, `myprefix.SUM(…)` не поддерживается.

Использование префикса "System" для любых определяемых пользователем функций приводит к ошибке.

### <a name="disallow-array-and-object-as-key-properties-in-cosmos-db-output-adapter"></a>Запретить использование массивов и объектов в качестве ключевых свойств в выходном адаптере Cosmos DB

**Предыдущие уровни:** Типы массивов и объектов поддерживались как ключевые свойства.

**уровень 1,2:** Типы массивов и объектов больше не поддерживаются в качестве ключевого свойства.

## <a name="compatibility-level-11"></a>Уровень совместимости 1,1

На уровне совместимости 1.1 представлены следующие основные изменения:

### <a name="service-bus-xml-format"></a>Формат XML служебной шины

**уровень 1,0:** Azure Stream Analytics использует DataContractSerializer, поэтому в содержимое сообщения включены XML-теги. Пример:

`@\u0006string\b3http://schemas.microsoft.com/2003/10/Serialization/\u0001{ "SensorId":"1", "Temperature":64\}\u0001`

**уровень 1,1:** Содержимое сообщения напрямую содержит поток без дополнительных тегов. Например: `{ "SensorId":"1", "Temperature":64}`

### <a name="persisting-case-sensitivity-for-field-names"></a>Сохранение чувствительности к регистру для имен полей

**уровень 1,0:** Имена полей преобразовывались в нижний регистр при обработке с помощью подсистемы Azure Stream Analytics.

**уровень 1,1.** учет регистра учитывается в именах полей, когда они обрабатываются подсистемой Azure Stream Analytics.

> [!NOTE]
> Возможность учета регистра еще не доступна для заданий Stream Analytics, размещенных с использованием среды IoT Edge. Поэтому, если задание размещено в IoT Edge, все имена полей преобразуются в нижний регистр.

### <a name="floatnandeserializationdisabled"></a>флоатнандесериализатиондисаблед

**уровень 1,0:** Команда CREATE TABLE не фильтрует события со значением NaN (не число, например Infinity, -Infinity) в типе столбца FLOAT, так как они не соответствуют задокументированному диапазону этих номеров.

**уровень 1,1:** Команда CREATE TABLE позволяет задать жесткую схему. Обработчик Stream Analytics проверяет соответствие данных этой схеме. С помощью этой модели команда может фильтровать события со значениями NaN.

### <a name="disable-automatic-upcast-for-datetime-strings-in-json"></a>Отключить автоматическое восходящее преобразование для строк DateTime в JSON

**уровень 1,0:** Анализатор JSON выполнял автоматическое восходящее приведение типа строковых значений с информацией о дате, времени, часовом поясе к типу DateTime, а затем преобразовывал его в UTC. Это привело к потере сведений о часовом поясе.

**уровень 1,1:** Автоматическое восходящее приведение типа строковых значений с информацией о дате, времени, часовом поясе к типу DateTime больше не используется. В результате информация о часовом поясе сохраняется.

## <a name="next-steps"></a>Следующие шаги

* [Устранение неполадок с входными подключениями](stream-analytics-troubleshoot-input.md)
* [Stream Analytics работоспособности ресурсов](stream-analytics-resource-health.md)
