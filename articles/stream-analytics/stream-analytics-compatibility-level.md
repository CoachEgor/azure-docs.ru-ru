---
title: Уровни совместимости аналитики Лазурного потока
description: Узнайте, как установить уровень совместимости для задания Azure Stream Analytics и основные изменения в последнем уровне совместимости.
author: mamccrea
ms.author: mamccrea
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 03/10/2020
ms.openlocfilehash: 8f22b1ff97826dc318794aca58973b1276e74209
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79087856"
---
# <a name="compatibility-level-for-azure-stream-analytics-jobs"></a>Уровень совместимости заданий Azure Stream Analytics

В этой статье описывается параметр уровня совместимости в azure Stream Analytics. Stream Analytics — это управляемый сервис с регулярными обновлениями функций и повышением производительности. Большинство обновлений времени выполнения службы автоматически становятся доступными для конечных пользователей. 

Однако некоторые новые функциональные возможности в службе могут внести существенные изменения, такие как изменение поведения существующего задания или изменение способа использования данных в запущенных заданиях. Вы можете сохранить существующие задания Stream Analytics без существенных изменений, оставив пониженный уровень совместимости. Когда вы будете готовы к последнему поведению в течение выполнения, вы можете отказаться от участия в программе, повысив уровень совместимости. 

## <a name="choose-a-compatibility-level"></a>Выберите уровень совместимости

Уровень совместимости управляет поведением во время выполнения задания Stream Analytics. 

В настоящее время Azure Stream Analytics поддерживает три уровня совместимости:

* 1.0 - Исходный уровень совместимости, введенный во время общей доступности Azure Stream Analytics несколько лет назад.
* 1.1 - Предыдущее поведение
* 1.2 - Новейшее поведение с самыми последними улучшениями

При создании нового задания Stream Analytics лучше всего создать его с помощью последнего уровня совместимости. Начните проектирование работы, опираясь на последние поведения, чтобы избежать дополнительных изменений и сложности в дальнейшем.

## <a name="set-the-compatibility-level"></a>Установка уровня совместимости

Уровень совместимости для задания Stream Analytics можно установить на портале Azure или с помощью [вызова REST API-вызова для создания.](/rest/api/streamanalytics/stream-analytics-job)

Чтобы обновить уровень совместимости задания на портале Azure:

1. Используйте [портал Azure,](https://portal.azure.com) чтобы найти место для выполнения задания Stream Analytics.
2. **Остановите** работу перед обновлением уровня совместимости. Если задание выполняется, уровень совместимости обновить не удастся.
3. Под заголовком **Настройка** выберите **уровень совместимости.**
4. Выберите значение уровня совместимости, которое вы хотите.
5. Выберите **Сохранить** в нижней части страницы.

![Уровень совместимости Stream Analytics на портале Azure](media/stream-analytics-compatibility-level/stream-analytics-compatibility.png)

При обновлении уровня совместимости T-компилятор проверяет задание синтаксисом, который соответствует выбранному уровню совместимости.

## <a name="compatibility-level-12"></a>Уровень совместимости 1.2

Следующие существенные изменения вносятся в уровень совместимости 1.2:

###  <a name="amqp-messaging-protocol"></a>Протокол обмена сообщениями АМЗП

**1.2 уровень**: Azure Stream Analytics использует расширенный протокол [очередей сообщений (АМЗП)](../service-bus-messaging/service-bus-amqp-overview.md) для записи в очереди и темы служебных автобусов. AMQP позволяет создавать кроссплатформенные гибридные приложения, использующие протокол открытого стандарта.

### <a name="geospatial-functions"></a>Геопространственные функции

**Предыдущие уровни:** Аналитика Azure Stream использовала расчеты географии.

**1.2 уровень:** Аналитика Azure Stream Analytics позволяет вычислять геометрические прогнозируемые геокоординаты. Подпись геопространственных функций не изменилась. Однако их семантика немного отличается, что позволяет более точно вычислять, чем раньше.

Azure Stream Analytics поддерживает индексирование геопространственных справочных данных. Справочные данные, содержащие геопространственные элементы, могут быть проиндексированы для более быстрого расчета соединения.

Обновленные геопространственные функции привносят полную выразительность известного текстового (WKT) геопространственного формата. Можно указать другие геопространственные компоненты, которые ранее не поддерживались GeoJson.

Для получения дополнительной информации смотрите [обновления геопространственных функций в Azure Stream Analytics - Облако и IoT Edge](https://azure.microsoft.com/blog/updates-to-geospatial-functions-in-azure-stream-analytics-cloud-and-iot-edge/).

### <a name="parallel-query-execution-for-input-sources-with-multiple-partitions"></a>Параллельное выполнение запроса для входных источников с несколькими разделами

**Предыдущие уровни:** Запросы Azure Stream Analytics требовали использования положения PARTITION BY для параллелиизации обработки запросов между разделами исходных вод ввода.

**1.2 уровень:** Если логику запроса можно параллелью между разделами исходного кода ввода, Azure Stream Analytics создает отдельные экземпляры запросов и выполняет вычисления параллельно.

### <a name="native-bulk-api-integration-with-cosmosdb-output"></a>Интеграция родного массивного API с выходом CosmosDB

**Предыдущие уровни:** Поведение upsert было *вставкой или слиянием.*

**1.2 уровень:** Интеграция Родных Массовых API с выходом CosmosDB максимизирует пропускную мощность и эффективно обрабатывает запросы на регулирование. Для получения дополнительной информации смотрите [выход Azure Stream Analytics на страницу Azure Cosmos DB.](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-documentdb-output#improved-throughput-with-compatibility-level-12)

Поведение upsert *вставляется или заменяется.*

### <a name="datetimeoffset-when-writing-to-sql-output"></a>DateTimeOffset при записи на выходе S'L

**Предыдущие уровни:** [Типы DateTimeOffset](https://docs.microsoft.com/sql/t-sql/data-types/datetimeoffset-transact-sql?view=sql-server-2017) были скорректированы с UTC.

**1.2 уровень:** DateTimeOffset больше не корректируется.

### <a name="long-when-writing-to-sql-output"></a>Долго при написании на выходе S'L

**Предыдущие уровни:** Значения были усечены в зависимости от целевого типа.

**1.2 уровень:** Значения, не вписывающиеся в целевой тип, обрабатываются в соответствии с политикой ошибки вывода.

### <a name="record-and-array-serialization-when-writing-to-sql-output"></a>Запись и сериализация массивов при записи на выходе S'L

**Предыдущие уровни:** Записи были написаны как "Запись" и массивы были написаны как "Array".

**1.2 уровень:** Записи и массивы сериализуются в формате JSON.

### <a name="strict-validation-of-prefix-of-functions"></a>Строгая проверка префикса функций

**Предыдущие уровни:** Не было строгой проверки приставки функций.

**1.2 уровень:** Аналитика Azure Stream имеет строгую проверку префиксов функций. Добавление приставки к встроенной функции приводит к ошибке. Например,`myprefix.ABS(…)` не поддерживается.

Добавление приставки к встроенным агрегатам также приводит к ошибке. Например, `myprefix.SUM(…)` не поддерживается.

Использование приставки "система" для любых пользовательских функций приводит к ошибке.

### <a name="disallow-array-and-object-as-key-properties-in-cosmos-db-output-adapter"></a>Запретить массив и объект в качестве ключевых свойств в адаптере вывода Cosmos DB

**Предыдущие уровни:** Типы массивов и объектов были поддержаны в качестве ключевого свойства.

**1.2 уровень:** Типы массивов и объектов больше не поддерживаются в качестве ключевого свойства.

## <a name="compatibility-level-11"></a>Уровень совместимости 1.1

На уровне совместимости 1.1 представлены следующие основные изменения:

### <a name="service-bus-xml-format"></a>Формат служебной шины XML

**1.0 уровень:** Azure Stream Analytics использовала DataContractSerializer, поэтому содержимое сообщений включало метки XML. Пример:

`@\u0006string\b3http://schemas.microsoft.com/2003/10/Serialization/\u0001{ "SensorId":"1", "Temperature":64\}\u0001`

**1.1 уровень:** Содержимое сообщения содержит поток непосредственно без каких-либо дополнительных тегов. Например: `{ "SensorId":"1", "Temperature":64}`

### <a name="persisting-case-sensitivity-for-field-names"></a>Учет регистра в именах полей

**1.0 уровень:** Названия полей были изменены на более низкие при обработке движком Azure Stream Analytics.

**1.1 уровень:** чувствительность к случаям сохраняется для названий полей при обработке движком Azure Stream Analytics.

> [!NOTE]
> Возможность учета регистра еще не доступна для заданий Stream Analytics, размещенных с использованием среды IoT Edge. Поэтому, если задание размещено в IoT Edge, все имена полей преобразуются в нижний регистр.

### <a name="floatnandeserializationdisabled"></a>FloatNaNDeserializationDisabled

**1.0 уровень:** Команда CREATE TABLE не фильтровала события с помощью NaN (Not-a-Number. например Infinity, -Infinity) в типе столбца FLOAT, так как они не соответствуют задокументированному диапазону этих номеров.

**1.1 уровень:** CREATE TABLE позволяет указать сильную схему. Обработчик Stream Analytics проверяет соответствие данных этой схеме. С помощью этой модели команда может фильтровать события со значениями NaN.

### <a name="disable-automatic-upcast-for-datetime-strings-in-json"></a>Отключить автоматическую переподготовку для строк времени передачи даты в JSON

**1.0 уровень:** Parser JSON автоматически перекачка значений строки с датой/временем/зоной информации для типа DateTime, а затем преобразовывать его в UTC. Такое поведение привело к потере информации о часовом поясе.

**1.1 уровень:** Больше нет автоматического перевоспитания значений строки с информацией о дате/времени/зоне к типу DateTime. В результате информация о часовом поясе сохраняется.

## <a name="next-steps"></a>Дальнейшие действия

* [Устранение неполадок с входными подключениями](stream-analytics-troubleshoot-input.md)
* [Здоровье ресурсов Stream Analytics](stream-analytics-resource-health.md)
