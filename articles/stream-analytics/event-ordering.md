---
title: Настройка событий, упорядочения политики для Azure Stream Analytics
description: В этой статье описывается по настройке даже порядок параметров в Stream Analytics
services: stream-analytics
author: sidram
ms.author: sidram
ms.reviewer: mamccrea
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 03/12/2019
ms.openlocfilehash: 47a8ee2c03e67d4fd9b34888430ed0cc702205f6
ms.sourcegitcommit: a52d48238d00161be5d1ed5d04132db4de43e076
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67273177"
---
# <a name="configuring-event-ordering-policies-for-azure-stream-analytics"></a>Настройка событий, упорядочения политики для Azure Stream Analytics

В этой статье описывается настройка и использование позднее прибытие и политики ожидания неупорядоченных событий в Azure Stream Analytics. Эти политики применяются только в том случае, если вы используете [TIMESTAMP BY](https://docs.microsoft.com/stream-analytics-query/timestamp-by-azure-stream-analytics) предложение в запросе.

## <a name="event-time-and-arrival-time"></a>Время события и время получения

К заданию Stream Analytics может обрабатывать события, на основе *время события* или *время получения*. **Время события/приложения** — это метка времени в полезных данных события (если было создано событие). **Время получения** — отметка времени после получения события в источнике входных данных (событий концентраторов и Интернета вещей центр/хранилище BLOB-объектов). 

По умолчанию, Stream Analytics обрабатывает события по *время получения*, но вы можете выбрать для обработки события по *время события* с помощью [TIMESTAMP BY](https://docs.microsoft.com/stream-analytics-query/timestamp-by-azure-stream-analytics) предложение в запросе. Позднее прибытия и неупорядоченного политики применимы только в том случае, если обработки событий по времени события. Необходимо учитывайте требования задержку и правильность для вашего сценария, при настройке этих параметров. 

## <a name="what-is-late-arrival-policy"></a>Что такое политика позднее поступления?

Иногда события поступающие с опозданием из-за различных причин. Например, событие, которое приходит 40 секунд позднее будет иметь время события = 00:10:00 и прибытия время = 00:10:40. Если настроена политика обработки позднее поступления до 15 секунд, любое событие, которое поступает позже, чем 15 секунд будут либо удалены (не обработан службой Stream Analytics) или после настройки времени событий. В приведенном выше примере события, поступившие 40 секунд (или больше чем набор политик), его время события будет впоследствии скорректирована до достижения максимального позднего прибытия политики 00:10:25 (время получения – поздней значение политики поступления). Позднее прибытие политика по умолчанию — 5 секунд.

## <a name="what-is-out-of-order-policy"></a>Что такое политика неупорядоченного? 

События могут поступать не по порядку также. После времени события настраивается на основе политики с поздним прибытия, также можно автоматически удалять или изменять события, которые являются неупорядоченного. Если задать эту политику 8 секундам, все события, поступающие не по порядку, но в пределах 8-секундного окна, корректируется по времени события. События, поступающие позже будет быть удаляются или корректируются для параметра максимального неупорядоченного политики. Политика неупорядоченного по умолчанию — 0 секунд. 

## <a name="adjust-or-drop-events"></a>Изменить или удалить события

Если поступления событий поздно или неупорядоченного на основе политик, которые вы настроили, можно удалять такие события (не обработан службой Stream Analytics) или изменить время события.

Сообщите нам ознакомиться с примером эти политики в действии.
<br> **Позднее прибытие политики:** 15 секунд
<br> **Политика ожидания порядке:** 8 секунд

| Нет событий. | Время события | Время получения | System.Timestamp | Объяснение |
| --- | --- | --- | --- | --- |
| **1** | 00:10:00  | 00:10:40  | 00:10:25  | Событие попасть позднее, так и вне погрешность. Поэтому время события возвращает настраивается максимальный интервал поступления.  |
| **2** | 00:10:30 | 00:10:41  | 00:10:30  | Событие попасть позднее, но в пределах погрешность. Чтобы не получить корректируется, время события.  |
| **3** | 00:10:42 | 00:10:42 | 00:10:42 | Событие получен вовремя. Корректировка не требуется.  |
| **4** | 00:10:38  | 00:10:43  | 00:10:38 | Событие попасть из неупорядоченные, но в пределах 8 секунд. Таким образом получить минимальный время события. Для целей аналитики это событие будет считаться как предыдущее событие число 4.  |
| **5** | 00:10:35 | 00:10:45  | 00:10:37 | Событие попасть из неупорядоченные так и вне погрешность 8 секунд. Таким образом время события корректируется максимальный отклонения неупорядоченного. |

## <a name="can-these-settings-delay-output-of-my-job"></a>Эти параметры, которую могут вызвать задержку выходных данных моей работы? 

Да. По умолчанию неупорядоченного политика имеет значение ноль (00 минут и 00 секунд). Если изменить значение по умолчанию, первые выходные данные вашего задания отложенного на это значение (или более поздней). 

Если одна из секций входных данных не получает событий, следует ожидать выходных данных, чтобы быть задержано из-за параметра политики позднее прибытия. Чтобы узнать причину, прочтите ошибка InputPartition разделе ниже. 

## <a name="i-see-lateinputevents-messages-in-my-activity-log"></a>Я вижу LateInputEvents сообщений в моем журнала действий

Эти сообщения отображаются, чтобы сообщить о том, что события позднее прибытия и удаляются или корректируются в соответствии с вашей конфигурацией. Эти сообщения можно пропустить, если позднее прибытие политика настроена соответствующим образом. 

Приведен пример этого сообщения: <br>
<code>
{"message Time":"2019-02-04 17:11:52Z","error":null,
"message":"First Occurred: 02/04/2019 17:11:48 | Resource Name: ASAjob | Message: Source 'ASAjob' had 24 data errors of kind 'LateInputEvent' between processing times '2019-02-04T17:10:49.7250696Z' and '2019-02-04T17:11:48.7563961Z'. Input event with application timestamp '2019-02-04T17:05:51.6050000' and arrival time '2019-02-04T17:10:44.3090000' was sent later than configured tolerance.","type":"DiagnosticMessage","correlation ID":"49efa148-4asd-4fe0-869d-a40ba4d7ef3b"} 
</code>

## <a name="i-see-inputpartitionnotprogressing-in-my-activity-log"></a>Я вижу InputPartitionNotProgressing в моей журнала действий

Источника входных данных (концентратора событий центра и Интернета вещей) скорее всего, содержит несколько секций. Azure Stream Analytics создает выходные данные для отметке времени t1, только после всех секций, которые будут объединены по крайней мере за время t1. Например, предположим, что запрос выполняет чтение из секции концентратора событий с двумя разделами. Одна из секций, P1, есть события до времени t1. Второй раздел, P2, есть события до времени t1 + x. Выходные данные выводятся до времени t1. Однако если предложением PartitionId раздел явные, оба раздела работают независимо друг от друга. 

Когда используется несколько секций из одного входного потока объединяются, поступления — это максимальное количество времени, которое каждая секция ожидает новых данных. Если существует только одна секция в концентраторе событий, или если центр Интернета вещей не получает входные данные, временную шкалу для этого раздела не выполняется до достижения позднее пороговое значение отклонения прибытия. Это задерживает выходных данных с поздним пороговое значение отклонения прибытия. В таких случаях может появиться следующее сообщение:
<br><code>
{"message Time":"2/3/2019 8:54:16 PM UTC","message":"Input Partition [2] does not have additional data for more than [5] minute(s). Partition will not progress until either events arrive or late arrival threshold is met.","type":"InputPartitionNotProgressing","correlation ID":"2328d411-52c7-4100-ba01-1e860c757fc2"} 
</code><br><br>
Это сообщение, чтобы сообщить о том, что по крайней мере одну секцию в входных данных пуста и приведет к задержке выходных данных с поздним прибытия пороговое значение. Чтобы избежать этого, рекомендуется, вы либо:  
1. Убедитесь, что все секции концентратора событий центра и Интернета вещей получения входных данных. 
2. Используйте Partition by PartitionID предложение в запросе. 

## <a name="next-steps"></a>Дальнейшие действия
* [Рекомендации по обработке по времени](stream-analytics-time-handling.md)
* [Метрики, доступные в Stream Analytics](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-monitoring#metrics-available-for-stream-analytics)
