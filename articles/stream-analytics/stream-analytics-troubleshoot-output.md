---
title: Устранение неполадок с выходными данными в Azure Stream Analytics
description: В этой статье описаны методы устранения неполадок с выходными подключениями в заданиях Azure Stream Analytics.
author: sidram
ms.author: sidram
ms.reviewer: mamccrea
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 03/31/2020
ms.custom: seodec18
ms.openlocfilehash: bee40bc30a0ffbdacf8cc7bf88d1512c4fc43fa4
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82147948"
---
# <a name="troubleshoot-azure-stream-analytics-outputs"></a>Устранение неполадок с выходными данными в Azure Stream Analytics

В этой статье описаны распространенные проблемы с Azure Stream Analytics выходными подключениями и способы устранения проблем с выходными данными. Во многих действиях по устранению неполадок необходимо включить ресурсы и другие журналы диагностики для задания Stream Analytics. Если журналы ресурсов не включены, см. раздел [Устранение неполадок Azure Stream Analytics с помощью журналов ресурсов](stream-analytics-job-diagnostic-logs.md).

## <a name="the-job-doesnt-produce-output"></a>Задание не создает выходные данные

1. Проверьте подключение к портам вывода с помощью кнопки **Проверить подключение** для всех выходных данных.
1. Просмотрите [метрики мониторинга](stream-analytics-monitoring.md) на вкладке **монитор** . Так как значения суммируются, метрики откладываются на несколько минут.

   * Если значение **входных событий** больше нуля, задание может считывать входные данные. Если значение **входных событий** не больше нуля, возникает ошибка с входными данными задания. Дополнительные сведения см. в разделе [Устранение неполадок входных соединений](stream-analytics-troubleshoot-input.md) .
   * Если значение **ошибки преобразования данных** больше нуля и увеличиваться, см. Дополнительные сведения об ошибках преобразования данных [Azure Stream Analytics данных](data-errors.md) .
   * Если значение **ошибки времени выполнения** больше нуля, задание получает данные, но при обработке запроса выдает ошибки. Чтобы найти ошибки, перейдите в раздел [журналы аудита](../azure-resource-manager/management/view-activity-logs.md)и отфильтруйте состояние **сбоя** .
   * Если значение **входных событий** больше нуля, а значение **выходного события** равно нулю, то выполняется одно из следующих условий:
      * Обработка запроса привела к нулевым выходным событиям.
      * События или поля могут быть неправильно сформированы, что приводит к нулевому выходу после обработки запроса.
      * Заданию не удалось передать данные в приемник выходных данных из-за проблем с подключением или аутентификацией.

   В сообщениях журнала операций описываются дополнительные сведения, включая то, что происходит, за исключением случаев, когда логика запроса фильтрует все события. Если обработка нескольких событий приводит к возникновению ошибок, то ошибки вычисляются каждые 10 минут.

## <a name="the-first-output-is-delayed"></a>Первый выход отложен

При запуске задания Stream Analytics считываются входные события. Однако в некоторых обстоятельствах может воздержаться задержка в выходных данных.

Большие значения времени в элементах темпоральных запросов могут приводить к задержке выходных данных. Чтобы получить правильные выходные данные в больших окнах времени, задание потоковой передачи считывает данные из последнего времени, чтобы заполнить временное окно. Данные могут быть не более семи дней назад. Выходные данные не создаются до тех пор, пока не будут считаны необработанные входные события. Эта проблема может возникнуть, когда система обновляет задания потоковой передачи. Когда происходит обновление, задание перезапускается. Такие обновления обычно происходят один раз каждые несколько месяцев.

Используйте осторожность при проектировании Stream Analytics запроса. Если для временных элементов в синтаксисе запроса задания используется большое окно времени, это может привести к задержке в первом выводе при запуске или перезапуске задания. Большое временное окно считается более чем через несколько часов, до семи дней.

Одним из способов устранения этой первой выходной задержки является использование методов параллелизации запросов, таких как секционирование данных. Или можно добавить дополнительные единицы потоковой передачи, чтобы повысить пропускную способность до тех пор, пока задание не будет перехватываться.  Дополнительные сведения см. в разделе [рекомендации по созданию Stream Analyticsных заданий](stream-analytics-concepts-checkpoint-replay.md).

Эти факторы влияют на временные шкалы первого выхода:

* Использование оконных статистических выражений, таких как предложение GROUP BY для "переворачивающегося", прыгающее» и скользящего окна:

  * Для статистических выражений в окне "переворачивающегося" или прыгающее» результаты создаются в конце интервала окна.
  * Для скользящего окна Результаты создаются, когда событие входит в скользящее окно или выходит из него.
  * Если вы планируете использовать большой размер окна, например более одного часа, лучше выбрать прыгающее» или скользящее окно. Эти типы окон позволяют чаще видеть выходные данные.

* Использование временных соединений, например JOIN с DATEDIFF:
  * Соответствует Generate, как только обе стороны сопоставленных событий поступают.
  * Данные, для которых отсутствует совпадение, например левое ВНЕШНее соединение, создаются в конце окна DATEDIFF для каждого события в левой части.

* Использование временных аналитических функций, таких как «FIRST», «LAST» и «LAG» с ОГРАНИЧЕНИЕм ДЛИТЕЛЬности:
  * Для аналитических функций выходные данные формируются для каждого события. Нет задержки.

## <a name="the-output-falls-behind"></a>Выходные данные попадают в пределы

Во время нормальной работы задания выходные данные могут иметь больше и больше периодов задержки. Если выходные данные не изменяются, можно выявить основные причины, изучив следующие факторы:

* регулируется ли подчиненный приемник:
* регулируется ли вышестоящий источник данных;
* потребляет ли логика обработки в запросе много вычислительных ресурсов.

Чтобы просмотреть сведения о выходных данных, выберите задание потоковой передачи в портал Azure, а затем щелкните **схема задания**. Для каждого входа имеется метрика событий невыполненной работы на секцию. Если метрика продолжает расти, это означает, что системные ресурсы ограничены. Увеличение вероятности из-за регулирования приемника выходных данных или высокой загрузки ЦП. Дополнительные сведения см. [в разделе Отладка на основе данных с помощью схемы задания](stream-analytics-job-diagram-with-metrics.md).

## <a name="key-violation-warning-with-azure-sql-database-output"></a>Предупреждение о нарушении ключа с выходными данными службы "База данных SQL Azure"

Когда вы настраиваете базу данных SQL Azure в качестве выходных данных для Stream Analytics задания, она выполняет операции по удаленному добавлению записей в целевую таблицу. В общем случае Azure Stream Analytics гарантирует доставку в приемник выходных данных [по крайней мере один раз](https://docs.microsoft.com/stream-analytics-query/event-delivery-guarantees-azure-stream-analytics) . Вы по-прежнему можете выполнить [точную доставку]( https://blogs.msdn.microsoft.com/streamanalytics/2017/01/13/how-to-achieve-exactly-once-delivery-for-sql-output/) в выходные данные SQL, если в таблице SQL определено ограничение UNIQUE.

При настройке ограничений уникального ключа в таблице SQL Azure Stream Analytics удаляет повторяющиеся записи. Он разделяет данные на пакеты и рекурсивно вставляет пакеты до тех пор, пока не будет найдена Одна повторяющаяся запись. Процесс разбиения и вставки пропускает дубликаты по одному за раз. Для задания потоковой передачи, имеющего много повторяющихся строк, процесс является неэффективным и занимает много времени. Если в журнале действий отображается несколько предупреждающих сообщений о нарушении ключа, скорее всего, выходные данные SQL будут замедлять работу всего задания.

Чтобы устранить эту проблему, [Настройте индекс]( https://docs.microsoft.com/sql/t-sql/statements/create-index-transact-sql) , который вызывает нарушение ключа, включив параметр IGNORE_DUP_KEY. Этот параметр позволяет SQL игнорировать дублирующиеся значения во время операций вставки. База данных SQL Azure просто выдает предупреждающее сообщение, а не ошибку. В результате Azure Stream Analytics больше не создает ошибки нарушения первичного ключа.

Если IGNORE_DUP_KEY настраивается для нескольких типов индексов, обратите внимание на следующее:

* Нельзя задать IGNORE_DUP_KEY для первичного ключа или ограничения UNIQUE, использующего инструкцию ALTER INDEX. Необходимо удалить индекс и создать его заново.  
* IGNORE_DUP_KEY можно задать с помощью инструкции ALTER INDEX для уникального индекса. Этот экземпляр отличается от ограничения ПЕРВИЧного ключа и УНИКАЛЬности и создается с помощью определения индекса или индекса.  
* Параметр IGNORE_DUP_KEY не применяется к индексам хранилища столбцов, так как на них нельзя обеспечить уникальность.  

## <a name="column-names-are-lowercase-in-azure-stream-analytics-10"></a>Имена столбцов в Azure Stream Analytics строчными буквами (1,0)

При использовании исходного уровня совместимости (1,0) Azure Stream Analytics преобразует имена столбцов в нижний регистр. Это поведение было исправлено на более поздних уровнях совместимости. Чтобы сохранить регистр, перейдите на уровень совместимости 1,1 или более поздней. Дополнительные сведения см. в разделе [уровень совместимости для заданий Stream Analytics](https://docs.microsoft.com/azure/stream-analytics/stream-analytics-compatibility-level).

## <a name="get-help"></a>Получить справку

Для получения дополнительной помощи посетите наш [Azure Stream Analytics Форум](https://social.msdn.microsoft.com/Forums/azure/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие шаги

* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://docs.microsoft.com/stream-analytics-query/stream-analytics-query-language-reference)
* [Справочник REST API по управлению Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
