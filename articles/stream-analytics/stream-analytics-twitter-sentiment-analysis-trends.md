---
title: Анализ тональности в Twitter в режиме реального времени с помощью Azure Stream Analytics
description: В этой статье объясняется, как с помощью Stream Analytics анализировать тональность данных Twitter в режиме реального времени. Пошаговое руководство с шагами от создания событий до отображения данных на динамической панели мониторинга.
services: stream-analytics
author: mamccrea
ms.author: mamccrea
ms.reviewer: jasonh
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 02/10/2020
ms.openlocfilehash: 4b265bb574895e4728ad93ee25c9dad0da226ea4
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80240301"
---
# <a name="real-time-twitter-sentiment-analysis-in-azure-stream-analytics"></a>Анализ тональности в Twitter в режиме реального времени в Azure Stream Analytics

В этой статье рассказывается, как создать решение для анализа тональности социальных сетей, применяя события Twitter в реальном времени к концентраторам событий Azure. Вы пишете запрос Azure Stream Analytics для анализа данных и сохранения результатов для последующего использования или создания панели мониторинга [Power BI](https://powerbi.com/) для получения аналитических сведений в режиме реального времени.

Средства аналитики для социальных сетей помогают организациям определить популярные темы, Темы тенденций — это темы и отношение, которые содержат большое количество записей на социальных носителях. Анализ тональностиности, который также называется *интеллектуальным анализа данных*, использует средства анализа социальных сетей для определения отношение в отношении продукта или идеи. 

Анализ тенденций Twitter в режиме реального времени — это отличный пример средства аналитики, поскольку модель подписки на хэш-Теги позволяет ожидать определенные ключевые слова (хэш-Теги) и разрабатывать тональности-канал.

## <a name="scenario-social-media-sentiment-analysis-in-real-time"></a>Сценарий: анализ тональности в социальной сети в режиме реального времени

У организации есть новостной веб-сайт. Она хочет получить конкурентное преимущество, мгновенно предлагая читателям содержимое, которое будет им интересно. Организация выполняет анализ социальных сетей по темам, которые интересуют их читателей, анализируя тональность данных Twitter в режиме реального времени.

Чтобы определять наиболее популярные темы в Twitter в режиме реального времени, организации необходимо анализировать количество твитов и тональность по ключевым темам.

## <a name="prerequisites"></a>Предварительные условия

В этом пошаговом руководство вы используете клиентское приложение, которое подключается к Twitter и ищет твиты, имеющие определенные хэш-Теги (которые можно задать). Чтобы запустить приложение и проанализировать твиты с помощью Azure Stream Analytics, необходимо иметь следующее:

* Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/free/).

* Учетная запись [Twitter](https://twitter.com) .

* Приложение Твиттерклиенткоре, которое считывает веб-канал Twitter. Чтобы получить это приложение, скачайте [твиттерклиенткоре](https://github.com/Azure/azure-stream-analytics/tree/master/DataGenerators/TwitterClientCore).

* Установите [.NET Core CLI](https://docs.microsoft.com/dotnet/core/tools/?tabs=netcore2x) версию 2.1.0.

## <a name="create-an-event-hub-for-streaming-input"></a>Создание концентратора событий для потоковой передачи данных

Пример приложения создает события и передает их в концентратор событий Azure. Концентраторы событий Azure являются предпочтительным методом приема событий для Stream Analytics. Дополнительные сведения см. в статье [Что такое Центры событий?](../event-hubs/event-hubs-what-is-event-hubs.md).

### <a name="create-an-event-hub-namespace-and-event-hub"></a>Создание пространства имен концентраторов событий и концентратора событий
В этом разделе вы создадите пространство имен концентратора событий и добавите концентратор событий в это пространство имен. Пространства имен концентратора событий используются для логической группировки связанных экземпляров шины событий. 

1. Войдите в портал Azure и выберите **создать ресурс**. Этого. выполните поиск по запросу **концентраторов событий** и выберите **создать**.

2. На странице **Создание пространства имен** введите имя пространства имен. Для пространства имен можно использовать любое имя, но имя должно быть допустимым для URL-адреса и должно быть уникальным в Azure. 
    
3. Выберите ценовую категорию и подписку, а затем создайте или выберите группу ресурсов. Затем выберите расположение и щелкните **создать**. 
 
4. После завершения развертывания пространства имен перейдите к группе ресурсов и найдите пространство имен концентратора событий в списке ресурсов Azure. 

5. В новом пространстве имен выберите ** + &nbsp;концентратор событий**. 

6. Назовите новый концентратор событий *соЦиалтвиттер-EH*. Вы можете использовать другое имя. В таком случае запишите его, так как это имя понадобится вам позже. Другие параметры концентратора событий указывать не нужно.
 
7. Щелкните **Создать**.

### <a name="grant-access-to-the-event-hub"></a>Предоставление доступа к концентратору событий

Чтобы процесс мог отправить данные в концентратор событий, концентратору событий требуется политика, которая разрешает доступ. Политика доступа создает строку подключения, которая включает сведения об авторизации.

1.  На панели навигации в левой части пространства имен концентраторов событий выберите **концентраторы событий**, расположенные в разделе **сущности** . Затем выберите только что созданный концентратор событий.

2.  На панели навигации слева выберите **политики общего доступа** , расположенные в разделе **Параметры**.

    >[!NOTE]
    >Для пространства имен концентратора событий и концентратора событий существует параметр политики общего доступа. Убедитесь, что вы работаете в контексте концентратора событий, а не общего пространства имен концентратора событий.

3.  На странице Политика доступа выберите **+ Добавить**. Затем введите *соЦиалтвиттер-Access* для **имени политики** и установите флажок **Manage (Управление** ).
 
4.  Щелкните **Создать**.

5.  После развертывания политики выберите политику из списка политик общего доступа.

6.  Найдите поле **строка подключения первичный ключ** и нажмите кнопку Копировать рядом со строкой подключения.
 
7.  Вставьте строку подключения в текстовый редактор. Эта строка подключения необходима для следующего раздела после внесения небольших изменений.

   Строка подключения выглядит следующим образом:
   
   ```
   Endpoint=sb://EVENTHUBS-NAMESPACE.servicebus.windows.net/;SharedAccessKeyName=socialtwitter-access;SharedAccessKey=Gw2NFZw6r...FxKbXaC2op6a0ZsPkI=;EntityPath=socialtwitter-eh
   ```

   Обратите внимание, что строка подключения содержит несколько пар "ключ — значение", которые разделены точкой с запятой: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey` и `EntityPath`.  

   > [!NOTE]
   > В целях безопасности в примере были удалены части строки подключения.

## <a name="configure-and-start-the-twitter-client-application"></a>Настройка и запуск клиентского приложения Twitter

Клиентское приложение получает события твитов непосредственно из Twitter. Для этого ему нужно разрешение на вызов интерфейсов API потоковой передачи Twitter. Чтобы настроить это разрешение, создайте приложение в Twitter, которое формирует уникальные учетные данные (например, маркер OAuth). Затем можно настроить в клиентском приложении использование этих учетных данных при вызовах API. 

### <a name="create-a-twitter-application"></a>Создание приложения Twitter
Если у вас еще нет приложения Twitter, которое можно использовать для этого руководства, можно создать его. У вас уже должна быть учетная запись Twitter.

> [!NOTE]
> Конкретный процесс в Twitter для создания приложения и получения ключей, секретов и маркеров может измениться. Если эти инструкции не совпадают с тем, что отображается на сайте Twitter, обратитесь к документации разработчика Twitter.

1. В веб-браузере перейдите в [Twitter для разработчиков](https://developer.twitter.com/en/apps), создайте учетную запись разработчика и выберите **создать приложение**. Может появиться сообщение о том, что требуется подать заявку на учетную запись разработчика Twitter. Вы можете сделать это, а после утверждения приложения вы увидите электронное сообщение с подтверждением. Чтобы получить утверждения учетной записи разработчика, может потребоваться несколько дней.

   ![Сведения о приложении Twitter](./media/stream-analytics-twitter-sentiment-analysis-trends/provide-twitter-app-details.png "Сведения о приложении Twitter")

2. На странице **Create an application** (Создание приложения) укажите сведения для нового приложения, а затем выберите **Create your Twitter application** (Создать приложение Twitter).

   ![Сведения о приложении Twitter](./media/stream-analytics-twitter-sentiment-analysis-trends/provide-twitter-app-details-create.png "Сведения о приложении Twitter")

3. На странице приложения перейдите на вкладку **Keys and Tokens** (Ключи и маркеры) и скопируйте значения **ключа API потребителя** и **секретного ключа API потребителя**. Также выберите **Создать** в **маркере доступа и секрете маркера доступа**, чтобы сгенерировать маркеры доступа. Скопируйте значения **маркера доступа** и **секрета маркера доступа**.

   Сохраните значения, полученные для приложения Twitter. Значения понадобятся позже.

> [!NOTE]
> Ключи и секреты для приложения Twitter предоставляют доступ к вашей учетной записи Twitter. Относитесь к этим сведениям как к конфиденциальным, так же как к паролю Twitter. Например, не внедряйте эти сведения в приложения, которые предоставляете другим пользователям. 

### <a name="configure-the-client-application"></a>Настройка клиентского приложения

Мы создали клиентское приложение, которое будет подключаться к Twitter с помощью [API потоковой передачи Twitter](https://dev.twitter.com/streaming/overview) и собирать события Twitter в темах из определенного набора.

Перед запуском предоставьте приложению сведения, такие как ключи Twitter и строка подключения к концентратору событий.

1. Убедитесь, что вы скачали приложение [твиттерклиенткоре](https://github.com/Azure/azure-stream-analytics/tree/master/DataGenerators/TwitterClientCore) , как указано в предварительных требованиях.

2. Откройте файл *app. config* с помощью текстового редактора. Внесите следующие изменения в `<appSettings>` элемент:

   * Задайте `oauth_consumer_key` значение ключа потребителя Twitter (ключ API). 
   * Задайте `oauth_consumer_secret` значение секрета потребителя Twitter (секретный ключ API).
   * Задайте `oauth_token` маркер доступа Twitter.
   * Задайте `oauth_token_secret` секрет маркера доступа Twitter.
   * Задайте для `EventHubNameConnectionString` значение строки подключения.
   * Задайте `EventHubName` для имя концентратора событий (это значение пути сущности).

3. Откройте командную строку и перейдите в каталог, где находится приложение Твиттерклиенткоре. Выполните команду `dotnet build` , чтобы выполнить сборку проекта. Затем используйте команду `dotnet run` для запуска приложения. Приложение отправляет твиты в концентратор событий.

## <a name="create-a-stream-analytics-job"></a>Создание задания Stream Analytics

Теперь, когда у нас есть поток событий-твитов из Twitter в режиме реального времени, можно настроить задание Stream Analytics, чтобы анализировать эти события в режиме реального времени.

1. В портал Azure перейдите к группе ресурсов и выберите **+ Добавить**. Затем выполните поиск по **Stream Analyticsному заданию** и выберите **создать**.

2. Назовите задание `socialtwitter-sa-job` и укажите подписку, группу ресурсов и расположение.

    Мы рекомендуем поместить задание и концентратор событий в одном регионе, чтобы достичь оптимальной производительности и не оплачивать передачу данных между регионами.

3. Щелкните **Создать**. Затем перейдите к своему заданию после завершения развертывания.

## <a name="specify-the-job-input"></a>Указание входных данных для задания

1. В Stream Analytics задании выберите **входные данные** в меню слева в разделе **топология задания**.

2. ** +Выберите &nbsp;добавить поток вход** > **концентратора событий**. Заполните **новую форму ввода** следующими сведениями:

   |**Параметр**  |**Рекомендуемое значение**  |**Описание**  |
   |---------|---------|---------|
   |Псевдоним входных данных| *TwitterStream* | Введите псевдоним для входных данных. |
   |Подписка  | \<Ваша подписка\> |  Выберите подписку Azure, которую нужно использовать. |
   |пространство имен концентратора событий; | *ASA — Twitter — eventhub* |
   |имя концентратора событий; | *соЦиалтвиттер-EH* | Выберите *использовать существующий*. Затем выберите созданный концентратор событий.|
   |Тип сжатия события| GZip | Тип сжатия данных.|

   Оставьте остальные значения по умолчанию и нажмите кнопку **сохранить**.

## <a name="specify-the-job-query"></a>Указание запроса задания

Stream Analytics поддерживает простую декларативную модель запроса для описания преобразований. Дополнительные сведения о языке см. в разделе [Справочник по языку запросов Azure Stream Analytics](https://docs.microsoft.com/stream-analytics-query/stream-analytics-query-language-reference). Это руководство поможет вам создать и протестировать несколько запросов к данным Twitter.

Чтобы сравнить количество упоминаний по разным темам, воспользуемся [переворачивающимся окном](https://docs.microsoft.com/stream-analytics-query/tumbling-window-azure-stream-analytics). Это позволит получать количество упоминаний по теме каждые 5 секунд.

1. В разделе **Обзор**задания выберите **изменить запрос** в верхней правой части окна запроса. Azure перечисляет входные и выходные данные, настроенные для задания, и позволяет создать запрос для преобразования входного потока при его отправке в выходные данные.

2. Измените запрос в редакторе запросов на следующий:

   ```sql
   SELECT *
   FROM TwitterStream
   ```

3. Данные событий из сообщений должны появиться в окне **предварительного просмотра ввода** под запросом. Убедитесь, что для **представления** задано значение **JSON**. Если данные не отображаются, убедитесь, что ваш генератор данных отправляет события в концентратор событий и вы выбрали **gzip** в качестве типа сжатия для входных данных.

4. Выберите **тестовый запрос** и обратите внимание на результаты в окне **Результаты теста** под запросом.

5. Измените запрос в редакторе кода на следующий и выберите **тестовый запрос**:

   ```sql
   SELECT System.Timestamp as Time, text
   FROM TwitterStream
   WHERE text LIKE '%Azure%'
   ```

6. Этот запрос возвращает все твиты, содержащие ключевое слово *Azure*.

## <a name="create-an-output-sink"></a>Создание приемника выходных данных

Вы определили поток событий, входные данные концентратора событий для приема событий и запрос для преобразования потока. Последний этап — определить приемник выходных данных задания.  

В этом пошаговом руководство вы запишете Агрегированные события твитов из запроса задания в хранилище BLOB-объектов Azure.  Кроме того, в зависимости от потребностей приложения можно передать результаты в базу данных SQL Azure, хранилище таблиц Azure, Центры событий или Power BI.

## <a name="specify-the-job-output"></a>Указание выходных данных для задания

1. В разделе **топология задания** в меню навигации слева выберите **выходные данные**. 

2. На странице **выходные данные** щелкните ** + &nbsp;добавить** и **хранилище BLOB-объектов/Data Lake Storage 2-го поколения**.

   * **Выходной псевдоним**: используйте имя `TwitterStream-Output`. 
   * **Параметры импорта**: выберите **выбрать хранилище из подписок**.
   * **Учетная запись хранения**. Затем выберите учетную запись хранения.
   * **Контейнер**. Выберите **создать** и введите `socialtwitter`.
   
4. Нажмите кнопку **Сохранить**.   

## <a name="start-the-job"></a>Запустите задание

Входные данные для задания, запрос и выходные данные указаны. Теперь можно запустить задание Stream Analytics

1. Убедитесь, что приложение Твиттерклиенткоре работает. 

2. В разделе Обзор задания выберите **Запуск**.

3. На странице **Запуск задания** в поле **время начала для выходных данных задания**выберите **сейчас** и нажмите кнопку **запустить**.

## <a name="get-support"></a>Получение поддержки
Для получения дополнительной помощи посетите наш [Azure Stream Analytics Форум](https://social.msdn.microsoft.com/Forums/azure/home?forum=AzureStreamAnalytics).

## <a name="next-steps"></a>Дальнейшие шаги
* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Приступая к работе с Azure Stream Analytics](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://docs.microsoft.com/stream-analytics-query/stream-analytics-query-language-reference)
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
