---
title: Анализ тональности в Twitter в режиме реального времени с помощью Azure Stream Analytics
description: В этой статье объясняется, как с помощью Stream Analytics анализировать тональность данных Twitter в режиме реального времени. Пошаговое руководство с шагами от создания событий до отображения данных на динамической панели мониторинга.
services: stream-analytics
author: mamccrea
ms.author: mamccrea
ms.reviewer: jasonh
ms.service: stream-analytics
ms.topic: conceptual
ms.date: 02/10/2020
ms.openlocfilehash: 4b265bb574895e4728ad93ee25c9dad0da226ea4
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80240301"
---
# <a name="real-time-twitter-sentiment-analysis-in-azure-stream-analytics"></a>Анализ тональности в Twitter в режиме реального времени в Azure Stream Analytics

Эта статья научит вас, как создать решение для анализа настроений в социальных сетях, вневедя события Twitter в центры событий Azure. Вы пишете запрос Azure Stream Analytics для анализа данных и хранения результатов для последующего использования или создания панели мониторинга [Power BI](https://powerbi.com/) для предоставления аналитических данных в режиме реального времени.

Средства аналитики для социальных сетей помогают организациям определить популярные темы, Тенденции темы темы и отношения, которые имеют большой объем сообщений в социальных медиа. Анализ настроений, который также называется *майнингом мнений,* использует инструменты аналитики социальных сетей для определения отношения к продукту или идее. 

Анализ трендов Twitter в реальном времени является отличным примером инструмента аналитики, поскольку модель подписки хэштегов позволяет слушать определенные ключевые слова (хэштеги) и разрабатывать анализ настроений канала.

## <a name="scenario-social-media-sentiment-analysis-in-real-time"></a>Сценарий: анализ тональности в социальной сети в режиме реального времени

У организации есть новостной веб-сайт. Она хочет получить конкурентное преимущество, мгновенно предлагая читателям содержимое, которое будет им интересно. Организация выполняет анализ социальных сетей по темам, которые интересуют их читателей, анализируя тональность данных Twitter в режиме реального времени.

Чтобы определять наиболее популярные темы в Twitter в режиме реального времени, организации необходимо анализировать количество твитов и тональность по ключевым темам.

## <a name="prerequisites"></a>Предварительные требования

В этом руководстве вы используете клиентское приложение, которое подключается к Twitter и ищет твиты с определенными хэштегами (которые вы можете установить). Для запуска приложения и анализа твитов с помощью аналитики потоковой передачи Azure необходимо иметь следующее:

* Если у вас нет подписки На Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/).

* Учетная запись [Twitter.](https://twitter.com)

* Приложение TwitterClientCore, которое читает ленту Twitter. Чтобы получить это приложение, скачать [TwitterClientCore](https://github.com/Azure/azure-stream-analytics/tree/master/DataGenerators/TwitterClientCore).

* Установите версию [.NET Core CLI](https://docs.microsoft.com/dotnet/core/tools/?tabs=netcore2x) 2.1.0.

## <a name="create-an-event-hub-for-streaming-input"></a>Создание концентратора событий для потокового ввода

Пример приложения создает события и передает их в концентратор событий Azure. Концентраторы событий Azure являются предпочтительным методом приема событий для Stream Analytics. Дополнительные сведения см. в статье [Что такое Центры событий?](../event-hubs/event-hubs-what-is-event-hubs.md).

### <a name="create-an-event-hub-namespace-and-event-hub"></a>Создание пространства имен концентраторов событий и концентратора событий
В этом разделе вы создаете пространство имен концентратора событий и добавляете концентратор событий в это пространство имен. Пространства имен концентратора событий используются для логической группировки связанных экземпляров шины событий. 

1. Войдите на портал Azure и выберите **Создать ресурс.** Затем. поиск **концентратов событий** и выберите **Создать**.

2. На странице **«Создайте пространство имен»** введите имя пространства имен. Для пространства имен можно использовать любое имя, но имя должно быть действительным для URL-адреса, и оно должно быть уникальным в Azure. 
    
3. Выберите уровень ценообразования и подписку, а также создайте или выберите группу ресурсов. Затем выберите место и выберите **Создать**. 
 
4. Когда пространство имен завершит развертывание, перейдите к группе ресурсов и найдите пространство поиска концентратора событий в списке ресурсов Azure. 

5. Из нового пространства имен выберите ** + &nbsp;концентратор событий.** 

6. Назовите новый центр событий *socialtwitter-eh*. Вы можете использовать другое имя. В таком случае запишите его, так как это имя понадобится вам позже. Другие параметры концентратора событий указывать не нужно.
 
7. Выберите **Создать**.

### <a name="grant-access-to-the-event-hub"></a>Предоставление доступа к концентратору событий

Перед тем, как процесс может отправить данные в концентратор событий, концентратору событий нужна политика, позволяющая получить доступ. Политика доступа создает строку подключения, которая включает сведения об авторизации.

1.  В панели навигации на левой стороне пространства имен концентраторов событий выберите **концентраторы событий,** которые расположены в разделе **Entities.** Затем выберите только что созданный концентратор событий.

2.  В панели навигации на левой стороне выберите **политики общего доступа, расположенные** в **настройках.**

    >[!NOTE]
    >Для пространства имен концентратора событий и для концентратора событий используется параметр общих политик доступа. Убедитесь, что вы работаете в контексте концентратора событий, а не общего пространства имен концентратора событий.

3.  На странице политики доступа выберите **и добавьте**. Затем введите *socialtwitter-доступ* для **имени политики** и проверьте флажок **Управления.**
 
4.  Выберите **Создать**.

5.  После развертывания политики выберите политику из списка общих политик доступа.

6.  Найдите поле с пометкой **строки Connection primary-key** и выберите кнопку копирования рядом со строкой соединения.
 
7.  Вставьте строку подключения в текстовый редактор. Вам нужна эта строка соединения для следующего раздела после того, как вы внесете небольшие ветки.

   Строка подключения выглядит следующим образом:
   
   ```
   Endpoint=sb://EVENTHUBS-NAMESPACE.servicebus.windows.net/;SharedAccessKeyName=socialtwitter-access;SharedAccessKey=Gw2NFZw6r...FxKbXaC2op6a0ZsPkI=;EntityPath=socialtwitter-eh
   ```

   Обратите внимание, что строка подключения содержит несколько пар "ключ — значение", которые разделены точкой с запятой: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey` и `EntityPath`.  

   > [!NOTE]
   > В целях безопасности в примере были удалены части строки подключения.

## <a name="configure-and-start-the-twitter-client-application"></a>Настройка и запуск клиентского приложения Twitter

Клиентское приложение получает события твитов непосредственно из Twitter. Для этого ему нужно разрешение на вызов интерфейсов API потоковой передачи Twitter. Чтобы настроить это разрешение, создайте приложение в Twitter, которое формирует уникальные учетные данные (например, маркер OAuth). Затем можно настроить в клиентском приложении использование этих учетных данных при вызовах API. 

### <a name="create-a-twitter-application"></a>Создание приложения Twitter
Если у вас еще нет приложения Twitter, которое можно использовать для этого руководства, вы можете создать его. У вас уже должна быть учетная запись Twitter.

> [!NOTE]
> Конкретный процесс в Twitter для создания приложения и получения ключей, секретов и маркеров может измениться. Если эти инструкции не совпадают с тем, что отображается на сайте Twitter, обратитесь к документации разработчика Twitter.

1. Из веб-браузера перейдите в [Twitter для разработчиков,](https://developer.twitter.com/en/apps)создайте учетную запись разработчика и выберите **Создать приложение.** Может появиться сообщение о том, что требуется подать заявку на учетную запись разработчика Twitter. Не стесняйтесь сделать это, и после того, как ваша заявка была одобрена, вы должны увидеть подтверждение электронной почты. Чтобы получить утверждения учетной записи разработчика, может потребоваться несколько дней.

   ![Сведения о приложении Twitter](./media/stream-analytics-twitter-sentiment-analysis-trends/provide-twitter-app-details.png "Сведения о приложении Twitter")

2. На странице **Create an application** (Создание приложения) укажите сведения для нового приложения, а затем выберите **Create your Twitter application** (Создать приложение Twitter).

   ![Сведения о приложении Twitter](./media/stream-analytics-twitter-sentiment-analysis-trends/provide-twitter-app-details-create.png "Сведения о приложении Twitter")

3. На странице приложения перейдите на вкладку **Keys and Tokens** (Ключи и маркеры) и скопируйте значения **ключа API потребителя** и **секретного ключа API потребителя**. Также выберите **Создать** в **маркере доступа и секрете маркера доступа**, чтобы сгенерировать маркеры доступа. Скопируйте значения **маркера доступа** и **секрета маркера доступа**.

   Сохраните значения, полученные для приложения Twitter. Значения нужны позже.

> [!NOTE]
> Ключи и секреты для приложения Twitter предоставляют доступ к вашей учетной записи Twitter. Относитесь к этим сведениям как к конфиденциальным, так же как к паролю Twitter. Например, не внедряйте эти сведения в приложения, которые предоставляете другим пользователям. 

### <a name="configure-the-client-application"></a>Настройка клиентского приложения

Мы создали клиентское приложение, которое будет подключаться к Twitter с помощью [API потоковой передачи Twitter](https://dev.twitter.com/streaming/overview) и собирать события Twitter в темах из определенного набора.

Перед запуском предоставьте приложению сведения, такие как ключи Twitter и строка подключения к концентратору событий.

1. Убедитесь, что вы скачали приложение [TwitterClientCore,](https://github.com/Azure/azure-stream-analytics/tree/master/DataGenerators/TwitterClientCore) указанное в предварительных условиях.

2. Используйте текстовый редактор, чтобы открыть файл *App.config.* Внести следующие `<appSettings>` изменения в элемент:

   * Установить `oauth_consumer_key` на ключ потребителя Twitter (ключ API). 
   * Установить `oauth_consumer_secret` на Twitter Consumer Secret (Секретный ключ API).
   * Установите `oauth_token` в токен доступа Twitter.
   * Установите `oauth_token_secret` секрет токена доступа Twitter.
   * Задайте для `EventHubNameConnectionString` значение строки подключения.
   * Установите `EventHubName` к имени концентратора событий (то есть значение пути сущности).

3. Откройте командную строку и перейдите в каталог, где находится ваше приложение TwitterClientCore. Используйте `dotnet build` команду для построения проекта. Затем используйте `dotnet run` команду для запуска приложения. Приложение отправляет твиты в концентратор событий.

## <a name="create-a-stream-analytics-job"></a>Создание задания Stream Analytics

Теперь, когда у нас есть поток событий-твитов из Twitter в режиме реального времени, можно настроить задание Stream Analytics, чтобы анализировать эти события в режиме реального времени.

1. На портале Azure перейдите в группу ресурсов и выберите **: добавить**. Затем ищите **работу Stream Analytics** и выберите **Create.**

2. Назовите задание `socialtwitter-sa-job` и укажите подписку, группу ресурсов и расположение.

    Мы рекомендуем поместить задание и концентратор событий в одном регионе, чтобы достичь оптимальной производительности и не оплачивать передачу данных между регионами.

3. Выберите **Создать**. Затем перейдите к работе, когда развертывание закончено.

## <a name="specify-the-job-input"></a>Указание входных данных для задания

1. В заданиях Stream Analytics выберите **входы** из левого меню в рамках **топологии вакансий.**

2. Выберите >  ** + &nbsp;Концентратор ввода потока потока.****Event Hub** Заполните **новую входную** форму со следующей информацией:

   |**Параметр**  |**Рекомендуемое значение**  |**Описание**  |
   |---------|---------|---------|
   |Псевдоним входных данных| *TwitterStream* | Введите псевдоним для ввода. |
   |Подписка  | \<Ваша подписка\> |  Выберите подписку Azure, которую нужно использовать. |
   |пространство имен концентратора событий; | *asa-twitter-eventhub* |
   |имя концентратора событий; | *socialtwitter-eh* | Выберите *Использование существующих*. Затем выберите созданный концентратор событий.|
   |Тип сжатия событий| GZip | Тип сжатия данных.|

   Оставьте оставшиеся значения по умолчанию и выберите **Сохранить.**

## <a name="specify-the-job-query"></a>Указание запроса задания

Stream Analytics поддерживает простую декларативную модель запроса для описания преобразований. Дополнительные сведения о языке см. в разделе [Справочник по языку запросов Azure Stream Analytics](https://docs.microsoft.com/stream-analytics-query/stream-analytics-query-language-reference). Это руководство поможет автору и протестировать несколько запросов по данным Twitter.

Чтобы сравнить количество упоминаний по разным темам, воспользуемся [переворачивающимся окном](https://docs.microsoft.com/stream-analytics-query/tumbling-window-azure-stream-analytics). Это позволит получать количество упоминаний по теме каждые 5 секунд.

1. В **обзоре**работы выберите **запрос Edit** в правом верхнем правом верхнем рядом с полем запроса. Azure перечисляет входные данные и выводы, настроенные для задания, и позволяет создать запрос для преобразования вхотворного потока при отправке в вывод.

2. Измените запрос в редакторе запроса на следующее:

   ```sql
   SELECT *
   FROM TwitterStream
   ```

3. Данные событий из сообщений должны отображаться в окне **предварительного просмотра ввода** под вашим запросом. Убедитесь, что **представление** настроено на **JSON.** Если вы не видите никаких данных, убедитесь, что генератор данных отправляет события в концентратор событий и что вы выбрали **ГИП** в качестве типа сжатия для ввода.

4. Выберите **запрос теста** и обратите внимание на результаты в окне **результатов теста** ниже вашего запроса.

5. Измените запрос в редакторе кода на следующий и выберите **запрос теста:**

   ```sql
   SELECT System.Timestamp as Time, text
   FROM TwitterStream
   WHERE text LIKE '%Azure%'
   ```

6. Этот запрос возвращает все твиты, которые включают ключевое слово *Azure.*

## <a name="create-an-output-sink"></a>Создание приемника выходных данных

Вы определили поток событий, входные данные концентратора событий для приема событий и запрос для преобразования потока. Последний этап — определить приемник выходных данных задания.  

В этом руководстве вы пишете агрегированные события твита из запроса задания в хранилище Azure Blob.  Кроме того, в зависимости от потребностей приложения можно передать результаты в базу данных SQL Azure, хранилище таблиц Azure, Центры событий или Power BI.

## <a name="specify-the-job-output"></a>Указание выходных данных для задания

1. В разделе **Топология вакансий** в левом меню навигации выберите **выходы.** 

2. На странице **Выходов** нажмите ** + &nbsp;Добавить** и **Blob хранения / данных озера хранения Gen2**:

   * **Выходной псевдоним**: используйте имя `TwitterStream-Output`. 
   * **Параметры импорта**: **Выберите хранилище из подписки.**
   * **Учетная запись хранения**. Затем выберите учетную запись хранения.
   * **Контейнер**. Выберите Создать `socialtwitter` **новый** и ввести .
   
4. Нажмите кнопку **Сохранить**.   

## <a name="start-the-job"></a>Запустите задание

Входные данные для задания, запрос и выходные данные указаны. Теперь можно запустить задание Stream Analytics

1. Убедитесь, что приложение TwitterClientCore работает. 

2. В обзоре задания выберите **Start**.

3. На странице **работы «Пуск»** для **вывода вакансии —** выберите **сейчас,** а затем выберите **«Старт».**

## <a name="get-support"></a>Получение поддержки
Для получения дополнительной помощи попробуйте наш [форум Azure Stream Analytics.](https://social.msdn.microsoft.com/Forums/azure/home?forum=AzureStreamAnalytics)

## <a name="next-steps"></a>Дальнейшие действия
* [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
* [Начало использования аналитики потоков Azure](stream-analytics-real-time-fraud-detection.md)
* [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
* [Справочник по языку запросов Azure Stream Analytics](https://docs.microsoft.com/stream-analytics-query/stream-analytics-query-language-reference)
* [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
