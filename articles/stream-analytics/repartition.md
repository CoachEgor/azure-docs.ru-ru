---
title: Используйте перепланировку для оптимизации заданий Azure Stream Analytics
description: В этой статье описывается, как использовать перегородку для оптимизации заданий Azure Stream Analytics, которые не могут быть параллелизированы.
ms.service: stream-analytics
author: mamccrea
ms.author: mamccrea
ms.date: 09/19/2019
ms.topic: conceptual
ms.custom: mvc
ms.openlocfilehash: c70cfb6c1626908a2ba4e707a890f6dc7481c51a
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75732388"
---
# <a name="use-repartitioning-to-optimize-processing-with-azure-stream-analytics"></a>Используйте перепартиу для оптимизации обработки с помощью аналитики ПотоковОй информации Azure Stream

В этой статье показано, как использовать перераздел для масштабирования запроса Azure Stream Analytics для сценариев, которые не могут быть полностью [параллельны.](stream-analytics-scale-jobs.md)

Возможно, вы не сможете использовать [параллелизацию,](stream-analytics-parallelization.md) если:

* Вы не контролируете ключ раздела для входной потока.
* Ваш источник "спреи" входных через несколько разделов, которые позже должны быть объединены.

Повторная отмена или перестановка требуется при обработке данных в потоке, который не отослал в соответствии с естественной схемой ввода, такой как **PartitionId** для концентраторов событий. При переделке каждый осколок может быть обработан независимо, что позволяет линейно масштабировать потоковый конвейер.

## <a name="how-to-repartition"></a>Как перегородка

Чтобы переразделить его, используйте ключевое слово **INTO** после заявления **PARTITION BY** в запросе. Следующий пример разрезает данные **DeviceID** на количество разделов 10. Хэширование **DeviceID** используется для определения того, какой раздел должен принимать, какой подпоток. Данные сбрасываются независимо для каждого разделитого потока, при условии, что выход поддерживает разделительные записи и имеет 10 разделов.

```sql
SELECT * 
INTO output
FROM input
PARTITION BY DeviceID 
INTO 10
```

Следующий пример запроса объединяет два потока переразделенных данных. При соединении двух потоков переразделенных данных потоки должны иметь один и тот же ключ раздела и считать. Результатом является поток, который имеет ту же схему раздела.

```sql
WITH step1 AS (SELECT * FROM input1 PARTITION BY DeviceID INTO 10),
step2 AS (SELECT * FROM input2 PARTITION BY DeviceID INTO 10)

SELECT * INTO output FROM step1 PARTITION BY DeviceID UNION step2 PARTITION BY DeviceID
```

Схема вывода должна соответствовать ключу схемы потока и считаться так, чтобы каждый подстрим мог быть промыт независимо. Поток также может быть объединен и повторно разделен другой схемой перед промывкой, но следует избегать этого метода, поскольку он увеличивает общую задержку обработки и увеличивает использование ресурсов.

## <a name="streaming-units-for-repartitions"></a>Потоковые единицы для перегородок

Экспериментируйте и наблюдайте за использованием ресурсов вашей работы, чтобы определить точное количество необходимых разделов. Количество [потоковых единиц (SU)](stream-analytics-streaming-unit-consumption.md) должно быть скорректировано в соответствии с физическими ресурсами, необходимыми для каждого раздела. В целом для каждого раздела требуется шесть SUS. При недостаточности ресурсов, назначенных на задание, система применяет перепартиу только в том случае, если это выгодно.

## <a name="repartitions-for-sql-output"></a>Переделы для вывода СЗЛ

При использовании базы данных S'L для вывода данных используйте явное перевыделение, чтобы соответствовать оптимальному количеству разделов, чтобы максимизировать пропускную мощность. Так как S'L лучше всего работает с восемью авторами, перераспределение потока до восьми до промывки, или где-то дальше вверх по течению, может принести пользу производительности работы. 

При наличии более чем 8 секций входных данных может быть нецелесообразно использовать наследование схемы секционирования входных данных. Рассмотрите возможность использования [INTO](/stream-analytics-query/into-azure-stream-analytics#into-shard-count) в запросе для явного указания количества авторов выходных данных. 

Следующий пример читается из ввода, независимо от того, естественно, разделены, и переделывает поток в десять раз в зависимости от размера DeviceID и сбрасывает данные на выходе. 

```sql
SELECT * INTO [output] FROM [input] PARTITION BY DeviceID INTO 10
```

Дополнительные сведения см. в статье [Вывод данных Azure Stream Analytics в базу данных SQL Azure](stream-analytics-sql-output-perf.md).


## <a name="next-steps"></a>Дальнейшие действия

* [Приступая к работе с Azure Stream Analytics: выявление мошенничества в режиме реального времени](stream-analytics-introduction.md)
* [Использование параллелизации запросов в Azure Stream Analytics](stream-analytics-parallelization.md)
