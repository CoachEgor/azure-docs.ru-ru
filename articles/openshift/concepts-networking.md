---
title: Основные понятия — схема сети для Azure Red Hat на OpenShift 4
description: Схема сети и общие сведения о сети Azure Red Hat OpenShift
author: sakthi-vetrivel
ms.author: suvetriv
ms.topic: tutorial
ms.service: container-service
ms.date: 06/22/2020
ms.openlocfilehash: fb81405e85d6e2653e0cf6c007c363493992161a
ms.sourcegitcommit: e71da24cc108efc2c194007f976f74dd596ab013
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/29/2020
ms.locfileid: "87419977"
---
# <a name="networking-in-azure-red-hat-on-openshift-4"></a>Сеть в Azure Red Hat на OpenShift 4

В этом руководстве описываются общие сведения о сетях в Azure Red Hat на базе кластеров OpenShift 4, а также приводятся схема и список важных конечных точек.

Дополнительные сведения об основных понятиях, связанных с сетями в OpenShift, см. в [документации по сетям в Azure Red Hat OpenShift 4](https://docs.openshift.com/aro/4/networking/understanding-networking.html).

## <a name="networking-concepts-in-azure-red-hat-openshift"></a>Основные понятия, связанные с сетями в Azure Red Hat OpenShift

![Схема сети в Azure Red Hat OpenShift 4](./media/concepts-networking/aro4-networking-diagram.png)

При развертывании Azure Red Hat на OpenShift 4 весь кластер размещается в виртуальной сети. В этой виртуальной сети главные и рабочие узлы находятся в собственных подсетях. В каждой подсети используются общедоступная и внутренняя подсистемы балансировки нагрузки.

## <a name="explanation-of-endpoints"></a>Объяснение концепции конечных точек

В следующем списке перечислены важные конечные точки в кластере Azure Red Hat OpenShift.

* **aro-pls**
    * Это конечная точка Приватного канала Azure, которая используется специалистами по обеспечению надежности сайтов корпорации Майкрософт и компании Red Hat для упрощения операций управления кластером.
* **aro-internal-lb**
    * Эта конечная точка распределяет трафик на сервер API. Главные узлы для этой подсистемы балансировки нагрузки находятся во внутреннем пуле.
* **aro-public-lb**
    * Если API является общедоступным, эта конечная точка направляет и распределяет трафик на сервер API. Эта конечная точка назначает общедоступный IP-адрес для исходящих подключений, чтобы главные серверы могли обращаться к Azure Resource Manager и сообщать о работоспособности кластера.
* **aro-internal**
    * Эта конечная точка распределяет внутренний трафик службы. Рабочие узлы для этой подсистемы балансировки нагрузки находятся во внутреннем пуле.
    * По умолчанию эта подсистема балансировки нагрузки не создается. Она создается только при создании службы типа LoadBalancer с правильными заметками. Например, так: service.beta.kubernetes.io/azure-load-balancer-internal: "true".
* **Политики сети (для входящего трафика)**
    * Поддерживается в составе OpenShift SDN.
    * По умолчанию включены, применение настраивается клиентами.
    * Соответствуют NetworkPolicy версии 1, но пока не поддерживают типы "Egress and IPBlock" (исходящий трафик и блокировка по IP-адресам).
    * **aro**
    * Эта конечная точка распределяет трафик на сервер API. Главные узлы для этой подсистемы балансировки нагрузки находятся во внутреннем пуле.
  * **aro-internal-lb**
    * Эта конечная точка используется для любого общедоступного трафика. Когда вы создаете приложение и маршрут, именно этот путь назначается для входящего трафика.
    * Эта подсистема балансировки нагрузки также применяется к исходящим подключениям к Интернету из любого pod, запущенного на рабочих узлах с использованием правил исходящего трафика Azure Load Balancer.
        * В настоящее время правила для исходящего трафика настроить невозможно. Они выделяют каждому узлу 1024 TCP-порта.
        * DisableOutboundSnat не настраивается в правилах LB, а значит объекты pod могут получить любой исходящий IP-адрес и любой общедоступный IP-адрес, настроенный для этого Azure Load Balancer.
        * Как следствие двух предыдущих правил временные порты SNAT можно добавить только путем добавления общедоступных служб типа LoadBalancer в АRО.
* **Политики сети (для исходящего трафика)**
    * Политики для исходящего трафика поддерживаются с помощью функции брандмауэра исходящего трафика в OpenShift.
    * Только один экземпляр на каждое пространство имен или проект.
    * Политики исходящего трафика не поддерживаются для пространства имен "default".
    * Правила политики исходящего трафика оцениваются поочередно (от первого до последнего).
    * **aro-outbound-pip**
        * Эта конечная точка служит общедоступным IP-адресом для рабочих узлов.
        * Эта конечная точка позволяет добавить в список разрешения служб конкретный IP-адрес для исходящих подключений из кластера Azure Red Hat OpenShift.
* **aro-node-nsg**
    * Когда вы предоставляете доступ к службе, API создает в этой группе безопасности сети правило, которое позволяет пропускать трафик на узлы.
    * По умолчанию эта группа безопасности сети разрешает весь исходящий трафик. В настоящее время ограничить исходящий трафик можно только уровнем управления Azure Red Hat OpenShift.
* **aro-controlplane-nsg**
    * Эта конечная точка разрешает входящий трафик для главных узлов только через порт 6443.
* **Реестр контейнеров Azure**
    * Это реестр контейнеров, который предоставляется и используется корпорацией Майкрософт для внутренних целей.
        * Этот реестр предоставляет образы платформы узла и компоненты кластера. Например, сюда относятся контейнеры мониторинга или ведения журналов.
        * Он не предназначен для использования клиентами Azure Red Hat OpenShift.  
        * Только для чтения.
        * Подключения к этому реестру осуществляются через конечную точку службы (внутреннее взаимодействие между службами Azure).
        * По умолчанию этот внутренний реестр недоступен за пределами кластера.
* **Приватный канал**
    * Разрешает сетевое подключение к кластеру из плоскости управления для управления кластером.
    * Специалисты по надежности сайта корпорации Майкрософт и компании Red Hat помогут вам управлять кластером.

## <a name="networking-basics-in-openshift"></a>Основные сведения о сетях в OpenShift

В OpenShift используется программно-определяемая сеть (SDN) для настройки наложенной сети с помощью OVS (Open vSwitch), которая представляет собой реализацию OpenFlow на основе спецификации CNI (сетевого интерфейса контейнера). SDN поддерживает разные подключаемые модули, и в Azure Red Hat на OpenShift 4 используется подключаемый модуль Network Policy (Сетевая политика). Все сетевые подключения управляются через SDN, поэтому для взаимодействия между разными pod не придется создавать дополнительных маршрутов в виртуальных сетях.

## <a name="azure-red-hat-openshift-networking-specifics"></a>Характеристики сети Azure Red Hat OpenShift

Следующие возможности характерны для Azure Red Hat OpenShift:
* Поддерживается использование собственной виртуальной сети.
* Есть возможность настраивать CIDR для pod и сети службы.
* Главные и рабочие узлы находятся в разных подсетях.
* Для главных и рабочих узлов требуются подсети виртуальной сети размером не менее /27.
* Для pod нужно использовать CIDR размером не менее /18 (IP-адреса сети pod не маршрутизируются и используются только в пределах OpenShift SDN).
* Каждому узлу для размещения pod выделяется подсеть размера /23 (512 IP-адресов). Это значение невозможно изменить.
* Вы не можете подключить pod к нескольким сетям.
* Вы не можете настроить статический IP-адрес для исходящего трафика. (Это возможность OpenShift. Дополнительные сведения см. в [документации по настройке IP-адресов для исходящего трафика](https://docs.openshift.com/aro/4/networking/openshift_sdn/assigning-egress-ips.html)).

## <a name="network-settings"></a>Параметры сети

В Azure Red Hat OpenShift 4 доступны следующие параметры сети:

* **Видимость API** — задается при выполнении команды [az aro create](tutorial-create-cluster.md#create-the-cluster):
    * "Public" обозначает, что сервер API доступен для внешних сетей;
    * "Private" обозначает, что серверу API назначается частный IP-адрес из подсети главных узлов, который доступен только из подключенных сетей (одноранговые виртуальные сети, другие подсети в том же кластере). От имени клиента создается частная зона DNS.
* **Видимость входящего трафика** — задается при выполнении команды [az aro create](tutorial-create-cluster.md#create-the-cluster).
    * Маршруты Public (Общедоступные) по умолчанию обозначают общедоступный Azure Load Balancer (цен. категория "Стандартный"), но это можно изменить;
    * Маршруты Private (Частные) по умолчанию обозначают внутренние подсистемы балансировки нагрузки, но это можно изменить.

## <a name="network-security-groups"></a>Группы безопасности сети
Группы безопасности сети будут создаваться в группе ресурсов для узлов, которая заблокирована. Группы безопасности сети назначаются непосредственно подсетям, а не сетевым адаптерам узлов. Группы безопасности сети являются неизменяемыми, то есть у вас нет разрешений на их изменение. 

На даже при общедоступном сервере API вы не можете создавать группы безопасности сети и назначать их сетевым адаптерам.

## <a name="domain-forwarding"></a>Переадресация домена
Azure Red Hat OpenShift использует CoreDNS. Вы можете настроить переадресацию домена (подробнее см. в [документации по использованию перенаправления DNS](https://docs.openshift.com/aro/4/networking/dns-operator.html#nw-dns-forward_dns-operator)).

В настоящее время вы не можете использовать собственные DNS-службы в виртуальных сетях.


Дополнительные сведения об исходящем трафике и о возможностях, которые Azure Red Hat OpenShift поддерживает для исходящего трафика, см. в [документации по политикам поддержки](support-policies-v4.md).
