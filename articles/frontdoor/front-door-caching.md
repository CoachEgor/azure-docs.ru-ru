---
title: Внешняя дверца Azure — кэширование | Документация Майкрософт
description: Эта статья поможет вам понять, как передняя дверца Azure отслеживает работоспособность ваших серверов.
services: frontdoor
documentationcenter: ''
author: duongau
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/10/2018
ms.author: duau
ms.openlocfilehash: aada5b976721fdfed31131095f7f2b12aefefea9
ms.sourcegitcommit: 70ee014d1706e903b7d1e346ba866f5e08b22761
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/11/2020
ms.locfileid: "90024287"
---
# <a name="caching-with-azure-front-door"></a>Кэширование с помощью передней дверцы Azure
В данном документе описывается поведение Front Door с правилами маршрутизации, в которых включено кэширование. Передняя дверца — это современная сеть доставки содержимого (CDN), а также динамическое ускорение сайтов и балансировка нагрузки. Кроме того, она поддерживает поведение кэширования так же, как и любые другие сети CDN.

## <a name="delivery-of-large-files"></a>Доставка больших файлов
Передняя дверца Azure предоставляет большие файлы без ограничения на размер файла. Front Door использует метод фрагментирования объекта. При запросе большого файла Front Door получает небольшие фрагменты этого файла из серверной части. После получения запроса полного файла или диапазона байтов среда Front Door запрашивает файл из серверной части в виде фрагментов по 8 МБ каждый.

</br>После того как фрагмент поступает в среду Front Door, он кэшируется и немедленно отправляется пользователю. Одновременно Front Door предварительно загружает следующий фрагмент. Эта предварительная загрузка гарантирует, что всегда будет загружен следующий фрагмент содержимого (по сравнению с тем фрагментом, который просматривает пользователь), что позволяет снизить задержку. Этот процесс продолжается до тех пор, пока не будет скачан весь файл (если он запрашивался), пока не будут скачаны все запрошенные диапазоны байт (если они запрашивались) или пока клиент не завершит соединение.

</br>Дополнительные сведения о запросе диапазона байтов см. в разделе [RFC 7233](https://web.archive.org/web/20171009165003/http://www.rfc-base.org/rfc-7233.html).
Front Door кэширует все фрагменты по мере их получения, и поэтому не требуется сохранять весь файл в кэш Front Door. Последующие запросы файла или диапазонов байтов обслуживаются из кэша. Если в кэше отсутствуют некоторые фрагменты файла, запрошенные недостающие фрагменты предварительно загружаются из серверной части. В основе этой оптимизации лежит поддержка запросов на диапазоны байтов серверной частью. Если серверная часть не поддерживает такие запросы, эта оптимизация будет неэффективной.

## <a name="file-compression"></a>Сжатие файла
Front Door может динамически сжимать содержимое на границе, что позволяет сократить время и размер ответов, возвращаемых в клиенты. Все файлы могут быть сжаты. Однако должен использоваться файл типа MIME, подходящего для сжатия. В настоящее время Front Door не позволяет изменение этого списка. Текущий список приведен ниже.</br>
- "application/eot"
- "application/font"
- "application/font-sfnt"
- "application/javascript"
- "application/json"
- "application/opentype"
- "application/otf"
- "application/pkcs7-mime"
- "application/truetype"
- "application/ttf",
- "application/vnd.ms-fontobject"
- "application/xhtml+xml"
- "application/xml"
- "application/xml+rss"
- "application/x-font-opentype"
- "application/x-font-truetype"
- "application/x-font-ttf"
- "application/x-httpd-cgi"
- "application/x-mpegurl"
- "application/x-opentype"
- "application/x-otf"
- "application/x-perl"
- "application/x-ttf"
- "application/x-javascript"
- "font/eot"
- "font/ttf"
- "font/otf"
- "font/opentype"
- "image/svg+xml"
- "text/css"
- "text/csv"
- "text/html"
- "text/javascript"
- "text/js", "text/plain"
- "text/richtext"
- "text/tab-separated-values"
- "text/xml"
- "text/x-script"
- "text/x-component"
- "text/x-java-source"

Кроме того, размер файла должен составлять от 1 КБ до 8 МБ включительно.

Эти профили поддерживают следующие алгоритмы сжатия:
- [Gzip (GNU Zip)](https://en.wikipedia.org/wiki/Gzip)
- [Brotli](https://en.wikipedia.org/wiki/Brotli)

Если запрос поддерживает сжатие gzip и Brotli, предпочтение отдается Brotli.</br>
Если в запросе ресурса указано сжатие и запрос приводит к промаху кэша, Front Door выполняет сжатие ресурса прямо на сервере POP. После этого сжатый файл используется из кэша. Полученный элемент возвращается со значением transfer-encoding: chunked.

## <a name="query-string-behavior"></a>Поведение строк запросов
С помощью Front Door можно управлять способом кэширования файлов для веб-запроса, который содержит строку запроса. В веб-запросе строка запроса — это часть запроса, которая следует после вопросительного знака (?). Строка запроса может содержать одну или несколько пар "ключ-значение", в которых имя поля и его значение разделяются знаком равенства (=). Каждая пара "ключ-значение" разделяется знаком амперсанда (&). Например, `http://www.contoso.com/content.mov?field1=value1&field2=value2`. Если в строке запроса имеется несколько пар "ключ-значение", их порядок не имеет значения.
- **Пропуск строк запросов**. Режим по умолчанию. В этом режиме Front Door передает строки запросов от запрашивающей стороны в серверную часть по первому запросу и кэширует ресурс. Все последующие запросы к этому ресурсу, которые обслуживаются в среде Front Door, будут пропускать строки запроса до истечения срока действия кэшированного ресурса.

- **Кэширование каждого уникального URL-адреса**. В этом режиме каждый запрос с уникальным URL-адресом, включая строку запроса, считается уникальным ресурсом с собственным кэшем. Например, ответ серверной части для запроса к `www.example.ashx?q=test1` сохраняется в кэше в среде Front Door и возвращается для последующих кэшей с этой же строкой запроса. Запрос к `www.example.ashx?q=test2` будет кэшироваться как отдельный ресурс с собственным сроком существования.

## <a name="cache-purge"></a>Очистка кэша

Передняя дверца кэширует ресурсы, пока не истечет срок жизни (TTL) ресурса. После истечения срока жизни ресурса, когда клиент запрашивает ресурс, среда передней дверцы извлекает новую обновленную копию ресурса для обслуживания запроса клиента и сохраняет обновление кэша.

Лучший способ убедиться, что пользователи всегда получают последнюю версию ресурсов — изменять версию ресурсов при каждом обновлении и публиковать их в виде нового URL-адреса. Front Door будет незамедлительно получать ресурсы для следующих клиентских запросов. Иногда может потребоваться очистить кэшированное содержимое со всех пограничных узлов и сделать так, чтобы узлы получили новые обновленные ресурсы. Это может быть вызвано обновлениями веб-приложения или быстрого обновления ресурсов, которые содержат неверные сведения.

Выберите ресурсы, которые необходимо удалить из граничных узлов. Чтобы очистить все ресурсы, выберите **Очистить все**. В противном случае в поле **путь**введите путь к каждому ресурсу, который требуется очистить.

Эти форматы поддерживаются в списках путей для очистки:

- **Очистка одного пути**. Очистите отдельные активы, указав полный путь к ресурсу (без протокола и домена) с расширением файла, например/pictures/strasbourg.png;
- **Очистка по подстановочным знакам.** В качестве подстановочного знака можно использовать звездочку (\*). Очистите все папки, вложенные папки и файлы в конечной точке с помощью \* пути или удалите все вложенные папки и файлы в указанной папке, указав папку, а затем/ \* , например,/pictures/ \* .
- **Очистка корневого домена.** Очищает содержимое в корне конечной точки, в пути которой есть знак "/".

> [!NOTE]
> **Очистка доменов с подстановочными знаками**. Указание кэшированных путей для очистки, как описано в этом разделе, не применяется к доменам с подстановочными знаками, связанным с передней дверцей. Сейчас мы не поддерживаем напрямую очищать домены с подстановочными знаками. Можно удалить пути из конкретных поддоменов, указав Этот поддомен указанной и путь очистки. Например, если у моей передней дверцы есть `*.contoso.com` , можно очистить активы своего поддомена `foo.contoso.com` , введя `foo.contoso.com/path/*` . В настоящее время указание имен узлов в пути очистки содержимого — это имитед поддомены доменов с подстановочными знаками, если это применимо.
>

При очистке кэша во Front Door не учитывается регистр. Кроме того, эти операции не зависят от запроса. Это означает, что при очистке URL-адреса будут очищены все его разновидности в строках запроса. 

## <a name="cache-expiration"></a>Срок действия кэша
Используется следующий порядок заголовков, чтобы определить, как долго элемент будет хранится в кэше:</br>
1. Cache-Control: s-maxage=\<seconds>
2. Cache-Control: max-age =\<seconds>
3. Истекает \<http-date>

Заголовки ответов Cache-Control, указывающие, что ответ не будет кэшироваться, например Cache-Control: закрытый, Cache-Control: un-Cache и Cache-Control: No-Store, не учитывается. Тем не менее при отправке нескольких запросов на лету к серверу POP для одного и того же URL-адреса они могут вернуть одинаковый ответ. Если нет управления кэшем, поведение по умолчанию заключается в том, что АФД кэширует ресурс в течение X-интервала времени, в течение которого X выбирается случайным образом в диапазоне от 1 до 3 дней.

## <a name="request-headers"></a>Заголовки запроса

Следующие заголовки запроса не будет перенаправляться к серверной части при использовании кэширования.
- Content-Length
- Transfer-Encoding

## <a name="cache-duration"></a>Длительность кэширования

Длительность кэширования может быть настроена как в конструкторе передней дверцы, так и в обработчике правил. Продолжительность кэша, заданная в конструкторе Frontdoor, является минимальной длительностью кэширования. Это переопределение не будет работать, если заголовок элемента управления кэша из источника имеет больший срок жизни, чем значение переопределения. 

Продолжительность кэша, заданная с помощью обработчика правил, является истинным переопределением кэша, что означает, что оно будет использовать переопределяемое значение независимо от заголовка ответа источника.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [создании Front Door](quickstart-create-front-door.md).
- Дополнительные сведения о том, [как работает Front Door](front-door-routing-architecture.md).
