---
title: Устранение проблем с конфигурацией передней дверцы Azure
description: В этом руководстве вы узнаете, как самостоятельно устранить некоторые из распространенных проблем, с которыми вы можете столкнуться при использовании Front Door.
services: frontdoor
documentationcenter: ''
author: sharad4u
editor: ''
ms.service: frontdoor
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 09/22/2018
ms.author: sharadag
ms.openlocfilehash: 40809fae312401cb62fabb10140b9bb7f60e3715
ms.sourcegitcommit: 3bf69c5a5be48c2c7a979373895b4fae3f746757
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2020
ms.locfileid: "88234777"
---
# <a name="troubleshooting-common-routing-issues"></a>Устранение распространенных проблем маршрутизации

В этой статье описывается, как устранять некоторые распространенные проблемы маршрутизации, которые могут возникнуть при настройке передней дверцы Azure.

## <a name="503-response-from-front-door-after-a-few-seconds"></a>503. ответ от передней дверцы через несколько секунд

### <a name="symptom"></a>Симптом

- Обычные запросы, отправляемые на серверную часть, не проходящие через переднюю дверцу, завершаются с ошибкой, но при переходе через переднюю дверь возникает ошибка 503.

- Ошибка с передней дверцы появляется через несколько секунд (обычно около 30 секунд).

### <a name="cause"></a>Причина

Эта проблема возникает, когда Серверная часть выходит за пределы периода ожидания (по умолчанию 30 секунд), чтобы получить запрос от передней дверцы или если это время превышает это значение времени ожидания для отправки ответа на запрос от передней дверцы. 

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

- Отправьте запрос непосредственно в серверную часть (не пройдите через переднюю дверцу) и посмотрите, как обычно занимает время ответа серверной стороны.
- Отправьте запрос через переднюю дверь и посмотрите, отображаются ли ответы 503. В противном случае это может не быть проблемой времени ожидания. Обратитесь в службу поддержки.
- Если при переходе через переднюю дверь возникает код ответа ошибки 503, настройте поле Сендрецеиветимеаут для своей передней дверцы, чтобы продлить время ожидания по умолчанию — до 4 минут (240 секунд). Параметр находится под `backendPoolSettings` именем и называется `sendRecvTimeoutSeconds` . 

## <a name="requests-sent-to-the-custom-domain-returns-400-status-code"></a>Запросы, отправленные в пользовательский домен, возвращают код состояния 400

### <a name="symptom"></a>Симптом

- Вы создали переднюю дверь, но запрос к домену или ведущему узлу возвращает код состояния HTTP 400.

- Вы создали сопоставление DNS личного домена с настроенным интерфейсным узлом. Тем не менее при отправке запроса на имя узла личного домена возвращается код состояния HTTP 400 и трафик не перенаправляется на настроенные внутренние серверы.

### <a name="cause"></a>Причина

Эта проблема может произойти, если вы не настроили правило маршрутизации для личного домена, который был добавлен в качестве интерфейсного узла. Необходимо явно добавить правило маршрутизации для этого интерфейсного узла, даже если оно уже было настроено для интерфейсного узла в поддомене Front Door (*.azurefd.net), с которым настроено сопоставление DNS для личного домена.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

Добавьте правило маршрутизации из личного домена в требуемый внутренний пул.

## <a name="front-door-is-not-redirecting-http-to-https"></a>Передняя дверца не перенаправляет HTTP на HTTPS

### <a name="symptom"></a>Симптом

Передняя дверца имеет правило маршрутизации, которое сообщает о перенаправлении HTTP в HTTPS, но доступ к домену по-прежнему поддерживает протокол HTTP в качестве протокола.

### <a name="cause"></a>Причина

Такое поведение может произойти, если вы неправильно настроили правила маршрутизации для своей передней дверцы. По сути, текущая конфигурация не зависит и может иметь конфликтующие правила.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

## <a name="request-to-frontend-hostname-returns-404-status-code"></a>Запрос к интерфейсному узлу возвращает код состояния 404

### <a name="symptom"></a>Симптом

- Вы создали службу Front Door, затем настроили интерфейсный узел, внутренний пул как минимум с одним внутренним сервером и правило маршрутизации, которое подключает интерфейсный узел к внутреннему пулу. По-видимому, содержимое недоступно при отправке запроса к настроенному интерфейсному узлу, так как возвращается код состояния HTTP 404.

### <a name="cause"></a>Причина

Данный симптом мог возникнуть по нескольким причинам.

- Серверная часть не является общедоступной серверной частью и не видна для передней дверцы.
- Серверная часть настроена неправильно, что приводит к тому, что на передней дверце отправляется неверный запрос (то есть серверный компонент принимает только протокол HTTP, но вы не проверите разрешение HTTPS, поэтому фронтальная дверца пытается перенаправить HTTPS-запросы).
- Внутренний сервер отклоняет заголовок узла, который был переслан вместе с запросом на внутренний сервер.
- Конфигурация внутреннего сервера не полностью развернута.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

1. Время развертывания
   - Убедитесь, что прошло около 10 минут, необходимых для развертывания конфигурации.

2. Проверка параметров внутреннего сервера
    - Перейдите во внутренний пул, в который должен быть перенаправлен запрос (он зависит от настройки правила маршрутизации), и убедитесь, что _тип узла внутреннего сервера_ и имя узла внутреннего сервера указаны правильно. Если внутренний сервер является настраиваемым узлом, убедитесь, что он указан правильно. 

    - Проверьте порты HTTP и HTTPS. В большинстве случаев порты 80 и 443 (соответственно) указаны правильно и изменения не потребуются. Тем не менее существует вероятность того, что внутренний сервер настроен иначе и ожидает передачи данных через другой порт.

        - Проверьте _заголовок узла внутреннего сервера_, настроенный для внутренних серверов, на которые должен перенаправляться трафик интерфейсного узла. В большинстве случаев этот заголовок должен совпадать с _именем узла внутреннего сервера_. Тем не менее неправильное значение может привести к отображению различных кодов состояния HTTP 4xx, если внутренний сервер ожидает другое значение. Если вы указываете IP-адрес внутреннего сервера, может потребоваться задать имя узла внутреннего сервера в качестве _заголовка узла внутреннего сервера_.


3. Проверка параметров правила маршрутизации
    - Перейдите к правилу маршрутизации, которое должно направлять трафик по рассматриваемому имени интерфейсного узла во внутренний пул. Убедитесь, что принимаемые протоколы настроены правильно. Если это не так, убедитесь, что протокол, который Front Door будет использовать при пересылке запроса, настроен правильно. Поле _принятые протоколы_ определяет, какие запросы должна принять Передняя дверца, а _протокол переадресации_ определяет, какой протокол должен использоваться для пересылки запроса в серверную часть.
         - Например, если внутренний сервер принимает только HTTP-запросы, приведенная ниже конфигурация будет допустимой.
            - _Accepted protocols_ (Принимаемые протоколы): HTTP и HTTPS. _Forwarding protocol_ (Протокол пересылки): HTTP. Соответствующий запрос не будет выполнен, так как протокол HTTPS разрешен, и если поступит HTTPS-запрос, служба Front Door попытается переслать его с помощью протокола HTTPS.

            - _Accepted protocols_ (Принимаемые протоколы): HTTP. _Протокол пересылки_ является либо запросом соответствия, либо HTTP.

    - Параметр _Url Rewrite_ (Перезапись URL-адресов) отключен по умолчанию. Его следует использовать только в том случае, если требуется сузить область размещенных на внутреннем сервере ресурсов, которые требуется сделать доступными. Если этот параметр отключен, служба Front Door будет пересылать запросы по полученному пути. Вполне возможно, что это поле настроено неправильно и Front Door запрашивает ресурс на внутреннем сервере, который недоступен, возвращая код состояния HTTP 404.

