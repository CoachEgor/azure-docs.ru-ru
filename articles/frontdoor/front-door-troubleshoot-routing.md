---
title: Проблемы с устранением проблем с конфигурацией передней двери Azure
description: В этом руководстве вы узнаете, как самостоятельно устранить некоторые из распространенных проблем, с которыми вы можете столкнуться при использовании Front Door.
services: frontdoor
documentationcenter: ''
author: sharad4u
editor: ''
ms.service: frontdoor
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/22/2018
ms.author: sharadag
ms.openlocfilehash: 962c884eb8adc05e5d50b6b254d5c3f0b18af556
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79471512"
---
# <a name="troubleshooting-common-routing-issues"></a>Устранение распространенных проблем маршрутизации

В этой статье описывается, как устранить некоторые из распространенных проблем с зоной конечной связи, с которыми вы можете столкнуться для конфигурации передней двери Azure.

## <a name="503-response-from-front-door-after-a-few-seconds"></a>503 ответ от передней двери через несколько секунд

### <a name="symptom"></a>Симптом

- Регулярные запросы, отправленные на ваш бэкэнд, не проходя через front Door, преуспевают, но происходит через Front Door приводит к 503 ответам на ошибку.

- Сбой от передней двери показывает через несколько секунд (обычно примерно через 30 секунд)

### <a name="cause"></a>Причина

Этот симптом происходит, когда любой бэкэнд выходит за рамки конфигурации тайм-аута (по умолчанию составляет 30 секунд), чтобы получить запрос от Front Door или если он принимает за это значение тайм-аута, чтобы отправить ответ на запрос от передней двери. 

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

- Отправить запрос на бэкэнд непосредственно (без прохождения через переднюю дверь) и посмотреть, что это обычное время, необходимое для вашего бэкэнда, чтобы ответить.
- Отправьте запрос через Front Door и посмотреть, если вы видите какие-либо 503 ответов. Если нет, то это не может быть тайм-аут вопрос. Пожалуйста, обратитесь в службу поддержки.
- Если переход через Front Door приводит к 503 код ответа на ошибку, а затем настроить поле sendReceiveTimeout для передней двери, чтобы продлить тайм-аут по умолчанию до 4 минут (240 секунд). Настройка находится `backendPoolSettings` под и `sendRecvTimeoutSeconds`называется . 

## <a name="requests-sent-to-the-custom-domain-returns-400-status-code"></a>Запросы, отправленные на пользовательский домен, возвращают 400 Код статуса

### <a name="symptom"></a>Симптом

- Вы создали переднюю дверь, но запрос на домен или передний хост возвращает код статуса HTTP 400.

- Вы создали сопоставление DNS личного домена с настроенным интерфейсным узлом. Тем не менее при отправке запроса на имя узла личного домена возвращается код состояния HTTP 400 и трафик не перенаправляется на настроенные внутренние серверы.

### <a name="cause"></a>Причина

Эта проблема может произойти, если вы не настроили правило маршрутизации для личного домена, который был добавлен в качестве интерфейсного узла. Необходимо явно добавить правило маршрутизации для этого интерфейсного узла, даже если оно уже было настроено для интерфейсного узла в поддомене Front Door (*.azurefd.net), с которым настроено сопоставление DNS для личного домена.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

Добавьте правило маршрутизации из личного домена в требуемый внутренний пул.

## <a name="front-door-is-not-redirecting-http-to-https"></a>Передняя дверь не перенаправляет HTTPНА на HTTPS

### <a name="symptom"></a>Симптом

Передняя дверь имеет правило направления, которое говорит перенаправить HTTP НА HTTPS, но доступ к домену по-прежнему поддерживает HTTP в качестве протокола.

### <a name="cause"></a>Причина

Такое поведение может произойти, если вы неправильно настроили правила реуктора для передней двери. В принципе, текущая конфигурация не является конкретной и может иметь противоречивые правила.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

## <a name="request-to-frontend-hostname-returns-404-status-code"></a>Запрос к интерфейсному узлу возвращает код состояния 404

### <a name="symptom"></a>Симптом

- Вы создали службу Front Door, затем настроили интерфейсный узел, внутренний пул как минимум с одним внутренним сервером и правило маршрутизации, которое подключает интерфейсный узел к внутреннему пулу. По-видимому, содержимое недоступно при отправке запроса к настроенному интерфейсному узлу, так как возвращается код состояния HTTP 404.

### <a name="cause"></a>Причина

Данный симптом мог возникнуть по нескольким причинам.

- Бэкэнд не является публичным лицом бэкэнда и не виден передней двери.
- Бэкэнд неправильно настроен, что приводит к тому, что Front Door отправляет неправильный запрос (т.е. ваш бэкэнд принимает только HTTP, но вы не беспрепятственно позволяет HTTPS так Front Door пытается направить httpS запросы).
- Внутренний сервер отклоняет заголовок узла, который был переслан вместе с запросом на внутренний сервер.
- Конфигурация внутреннего сервера не полностью развернута.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

1. Время развертывания
   - Убедитесь, что прошло около 10 минут, необходимых для развертывания конфигурации.

2. Проверка параметров внутреннего сервера
    - Перейдите во внутренний пул, в который должен быть перенаправлен запрос (он зависит от настройки правила маршрутизации), и убедитесь, что _тип узла внутреннего сервера_ и имя узла внутреннего сервера указаны правильно. Если внутренний сервер является настраиваемым узлом, убедитесь, что он указан правильно. 

    - Проверьте порты HTTP и HTTPS. В большинстве случаев порты 80 и 443 (соответственно) указаны правильно и изменения не потребуются. Тем не менее существует вероятность того, что внутренний сервер настроен иначе и ожидает передачи данных через другой порт.

        - Проверьте _заголовок узла внутреннего сервера_, настроенный для внутренних серверов, на которые должен перенаправляться трафик интерфейсного узла. В большинстве случаев этот заголовок должен совпадать с _именем узла внутреннего сервера_. Тем не менее неправильное значение может привести к отображению различных кодов состояния HTTP 4xx, если внутренний сервер ожидает другое значение. Если вы указываете IP-адрес внутреннего сервера, может потребоваться задать имя узла внутреннего сервера в качестве _заголовка узла внутреннего сервера_.


3. Проверка параметров правила маршрутизации
    - Перейдите к правилу маршрутизации, которое должно направлять трафик по рассматриваемому имени интерфейсного узла во внутренний пул. Убедитесь, что принимаемые протоколы настроены правильно. Если это не так, убедитесь, что протокол, который Front Door будет использовать при пересылке запроса, настроен правильно. Поле _принятых протоколов_ определяет, какие запросы должна принять Front Door, и _протокол переадресов_ определяет, какой протокол Front Door должен использовать для переадресосения запроса в бэкэнд.
         - Например, если внутренний сервер принимает только HTTP-запросы, приведенная ниже конфигурация будет допустимой.
            - _Accepted protocols_ (Принимаемые протоколы): HTTP и HTTPS. _Forwarding protocol_ (Протокол пересылки): HTTP. Соответствующий запрос не будет выполнен, так как протокол HTTPS разрешен, и если поступит HTTPS-запрос, служба Front Door попытается переслать его с помощью протокола HTTPS.

            - _Accepted protocols_ (Принимаемые протоколы): HTTP. _Forwarding protocol_ (Протокол пересылки): соответствующий запрос или HTTPS.

    - Параметр _Url Rewrite_ (Перезапись URL-адресов) отключен по умолчанию. Его следует использовать только в том случае, если требуется сузить область размещенных на внутреннем сервере ресурсов, которые требуется сделать доступными. Если этот параметр отключен, служба Front Door будет пересылать запросы по полученному пути. Вполне возможно, что это поле настроено неправильно и Front Door запрашивает ресурс на внутреннем сервере, который недоступен, возвращая код состояния HTTP 404.

