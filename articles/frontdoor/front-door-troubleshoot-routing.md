---
title: Устранение проблем с конфигурацией передней дверцы Azure
description: В этом руководстве вы узнаете, как самостоятельно устранить некоторые из распространенных проблем, с которыми вы можете столкнуться при использовании Front Door.
services: frontdoor
documentationcenter: ''
author: duongau
editor: ''
ms.service: frontdoor
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 09/30/2020
ms.author: duau
ms.openlocfilehash: 8e810a31fab4457e47329e37f54b16e6f488c9da
ms.sourcegitcommit: 2a8a53e5438596f99537f7279619258e9ecb357a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2020
ms.locfileid: "94337633"
---
# <a name="troubleshooting-common-routing-issues"></a>Устранение распространенных проблем маршрутизации

В этой статье описывается, как устранять некоторые распространенные проблемы маршрутизации, которые могут возникнуть при настройке передней дверцы Azure.

## <a name="503-response-from-front-door-after-a-few-seconds"></a>503. ответ от передней дверцы через несколько секунд

### <a name="symptom"></a>Симптом

* Обычные запросы, отправляемые на серверную часть, не проходящие через переднюю дверцу, завершаются с ошибкой, но при переходе через переднюю дверь возникает ошибка 503.
* Ошибка с передней дверцы появляется через несколько секунд (обычно около 30 секунд).

### <a name="cause"></a>Причина

Причиной этой проблемы может быть одно из двух действий:
 
* Серверная часть занимает больше времени, чем настроенное время ожидания (по умолчанию 30 секунд), чтобы получить запрос от передней дверцы.
* Время, необходимое для отправки ответа на запрос от передней дверцы, занимает больше времени, чем значение времени ожидания. 

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

* Отправьте запрос непосредственно в серверную часть (не пройдите через переднюю дверцу) и посмотрите, как обычно занимает время ответа серверной стороны.
* Отправьте запрос через переднюю дверцу и посмотрите, получаете ли вы ответы 503. В противном случае проблема может быть не связана с истечением времени ожидания. Обратитесь в службу поддержки.
* При проходе через переднюю дверь в коде ответа ошибки 503 настройте `sendReceiveTimeout` поле для своей передней дверцы. Время ожидания по умолчанию можно продлить до 4 минут (240 секунд). Параметр находится под `backendPoolSettings` именем и называется `sendRecvTimeoutSeconds` . 

## <a name="requests-sent-to-the-custom-domain-returns-400-status-code"></a>Запросы, отправленные в пользовательский домен, возвращают код состояния 400

### <a name="symptom"></a>Симптом

* Вы создали переднюю дверь, но запрос к домену или ведущему узлу возвращает код состояния HTTP 400.
* Вы создали сопоставление DNS для пользовательского домена с настроенным интерфейсным узлом. Однако при отправке запроса на имя узла пользовательского домена возвращается код состояния HTTP 400. Который не отображается для маршрутизации в настроенную серверную часть.

### <a name="cause"></a>Причина

Эта проблема возникает, если вы не настроили правило маршрутизации для личного домена, который был добавлен в качестве внешнего узла. Для этого внешнего узла необходимо явно добавить правило маршрутизации. Даже если он уже был настроен для внешнего узла в поддоменом "Front дверь" (*. azurefd.net).

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

Добавьте правило маршрутизации для пользовательского домена, чтобы направить трафик в выбранный внутренний пул.

## <a name="front-door-doesnt-redirect-http-to-https"></a>Передняя дверь не перенаправляет HTTP на HTTPS

### <a name="symptom"></a>Симптом

Передняя дверца имеет правило маршрутизации, которое сообщает о перенаправлении HTTP в HTTPS, но доступ к домену по-прежнему поддерживает протокол HTTP в качестве протокола.

### <a name="cause"></a>Причина

Такое поведение может произойти, если вы не настроили правила маршрутизации правильно для вашей передней дверцы. По сути, текущая конфигурация не зависит и может иметь конфликтующие правила.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

## <a name="request-to-frontend-hostname-returns-404-status-code"></a>Запрос к интерфейсному узлу возвращает код состояния 404

### <a name="symptom"></a>Симптом

 Вы создали переднюю дверь, настроив интерфейсный узел, внутренний пул, содержащий по крайней мере одну серверную часть и правило маршрутизации, которое подключает интерфейсный узел к внутреннему пулу. Содержимое недоступно при выполнении запроса к настроенному интерфейсному узлу в результате возвращается код состояния HTTP 404.

### <a name="cause"></a>Причина

Данный симптом мог возникнуть по нескольким причинам.

* Серверная часть не является общедоступной серверной частью и невидима для передней дверцы.
* Серверная часть неправильно настроена из-за того, что передняя дверца отправляет неправильный запрос. Другими словами, серверная часть принимает только протокол HTTP и вы не проверите разрешение HTTPS. Так что передняя дверца пытается пересылать HTTPS-запросы.
* Внутренний сервер отклоняет заголовок узла, который был переслан вместе с запросом на внутренний сервер.
* Конфигурация серверной части еще не полностью развернута.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

1. Время развертывания
   * Убедитесь, что вы ожидали около 10 минут для развертывания конфигурации.

2. Проверка параметров внутреннего сервера
    * Перейдите к внутреннему пулу, к которому должен быть маршрутизации запрос (зависит от того, как настроено правило маршрутизации). Убедитесь в правильности *типа внутреннего узла* и имени узла внутреннего сервера. Если серверная часть является пользовательским узлом, убедитесь, что она правильно написана. 

    * Проверьте порты HTTP и HTTPS. В большинстве случаев 80 и 443 (соответственно) являются правильными, и никакие изменения не требуются. Однако существует вероятность, что серверная часть не настроена таким образом и прослушивает другой порт.

        * Проверьте _заголовок узла внутреннего сервера_ , настроенный для внутренних серверов, на которые должен перенаправляться трафик интерфейсного узла. В большинстве случаев этот заголовок должен совпадать с *именем узла внутреннего сервера*. Тем не менее неправильное значение может привести к отображению различных кодов состояния HTTP 4xx, если внутренний сервер ожидает другое значение. Если вы указываете IP-адрес внутреннего сервера, может потребоваться задать имя узла внутреннего сервера в качестве *заголовка узла внутреннего сервера*.

3. Проверьте параметры правила маршрутизации.
    * Перейдите к правилу маршрутизации, которое должно направлять трафик по рассматриваемому имени интерфейсного узла во внутренний пул. Убедитесь, что принятые протоколы правильно настроены при пересылке запроса. Поле *принятые протоколы* определяет, какие запросы должна принимать Передняя дверца. *Протокол переадресации* определяет, какую переднюю дверцу протокола следует использовать для пересылки запроса в серверную часть.
         * Например, если внутренний сервер принимает только HTTP-запросы, приведенная ниже конфигурация будет допустимой.
            * *Accepted protocols* (Принимаемые протоколы): HTTP и HTTPS. *Forwarding protocol* (Протокол пересылки): HTTP. Запрос Match не будет работать, так как HTTPS является разрешенным протоколом и если запрос пришел в качестве HTTPS, а передняя дверца попытается переслать ее с помощью HTTPS.

            * *Accepted protocols* (Принимаемые протоколы): HTTP. *Протокол пересылки* является либо запросом соответствия, либо HTTP.
    - По умолчанию *переопределение URL-адреса* отключено. Это поле используется только в том случае, если необходимо ограничить область ресурсов, размещенных на внутреннем сервере, которые необходимо сделать доступными. Если этот параметр отключен, служба Front Door будет пересылать запросы по полученному пути. Это поле можно неправильно настроить. Так что когда интерфейсная дверца запрашивает ресурс из серверной части, который недоступен, он возвращает код состояния HTTP 404.

## <a name="request-to-frontend-host-name-returns-411-status-code"></a>Запрос к имени внешнего узла возвращает код состояния 411

### <a name="symptom"></a>Симптом

Вы создали службу Front Door, затем настроили интерфейсный узел, внутренний пул как минимум с одним внутренним сервером и правило маршрутизации, которое подключает интерфейсный узел к внутреннему пулу. Содержимое не будет доступно при отправке запроса на настроенный интерфейсный узел, так как возвращается код состояния HTTP 411.

Ответы на эти запросы могут также содержать HTML-страницу ошибок в тексте ответа, который содержит пояснительную инструкцию. Пример: `HTTP Error 411. The request must be chunked or have a content length`

### <a name="cause"></a>Причина

Существует несколько возможных причин этого симптома. Однако общая причина заключается в том, что HTTP-запрос не полностью совместим с RFC. 

Примером несоответствия является `POST` запрос, отправленный без `Content-Length` `Transfer-Encoding` заголовка или (например, с помощью `curl -X POST https://example-front-door.domain.com` ). Этот запрос не соответствует требованиям, заданным в [RFC 7230](https://tools.ietf.org/html/rfc7230#section-3.3.2) , и будет заблокирован передней дверцей с ответом HTTP 411.

Это поведение отделено от функций WAF передней дверцы. В настоящее время отключить это поведение невозможно. Все HTTP-запросы должны соответствовать требованиям, даже если функция WAF не используется.

### <a name="troubleshooting-steps"></a>Действия по устранению неполадок

- Убедитесь, что ваши запросы соответствуют требованиям, заданным в соответствующих документах RFC.

- Запишите текст сообщения в формате HTML, возвращаемый в ответ на запрос, так как они часто объясняют, *как* запрос не соответствует требованиям.
