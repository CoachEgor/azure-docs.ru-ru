---
title: Мониторинг метрик и журналов в передней дверце Azure | Документация Майкрософт
description: В этой статье описываются различные показатели и журналы доступа, поддерживаемые интерфейсом передней дверцы Azure.
services: frontdoor
documentationcenter: ''
author: duongau
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/28/2020
ms.author: duau
ms.openlocfilehash: a1e77b5f669d1b492f2d71063a6c77bec1178696
ms.sourcegitcommit: 3792cf7efc12e357f0e3b65638ea7673651db6e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91449272"
---
# <a name="monitoring-metrics-and-logs-in-azure-front-door"></a>Мониторинг метрик и журналов в передней дверце Azure

С помощью передней дверцы Azure можно отслеживать ресурсы следующими способами.

- **Метрики**. В настоящее время Передняя дверца Azure имеет восемь метрик для просмотра счетчиков производительности.
- **Журналы**. Журналы действий и диагностики позволяют сохранять и использовать данные о производительности, доступе и других данных в ресурсе для мониторинга.

### <a name="metrics"></a>Метрики

Метрики — это функция для некоторых ресурсов Azure, позволяющая просматривать счетчики производительности на портале. Ниже перечислены доступные метрики передней дверцы.

| Метрика | Отображаемое имя метрики | Единица измерения | Измерения | Описание |
| --- | --- | --- | --- | --- |
| RequestCount | Число запросов | Count | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Число клиентских запросов, обслуженных службой Front Door.  |
| RequestSize | Размер запроса | Байты | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Число байт, отправленных в качестве запросов от клиентов в службу Front Door. |
| ResponseSize | Размер ответа | Байты | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Число байт, отправленных клиентам в качестве ответов из службы Front Door. |
| TotalLatency | Total Latency (Общая задержка) | Миллисекунды | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Время, вычисленное на основе запроса клиента, полученного с помощью передней дверцы, до тех пор, пока клиент не подтвердил последний байт ответа от передней дверцы. |
| BackendRequestCount | Число запросов к серверному компоненту | Count | HttpStatus</br>HttpStatusGroup</br>Серверная часть | Число запросов, отправленных из службы Front Door к серверным частям. |
| BackendRequestLatency | Backend Request Latency (Задержка запросов к серверным частям) | Миллисекунды | Серверная часть | Время с момента отправки запроса службой Front Door к серверной части до получения Front Door последнего байта ответа от серверной части. |
| BackendHealthPercentage | Работоспособность серверного компонента (в процентах) | Процент | Серверная часть</br>BackendPool | Процент успешных проб работоспособности от службы Front Door к серверным частям. |
| WebApplicationFirewallRequestCount | Web Application Firewall Request Count (Число запросов к брандмауэру веб-приложения) | Count | PolicyName</br>RuleName</br>Действие | Количество клиентских запросов, обрабатываемых механизмом безопасности на прикладном уровне службы Front Door. |

## <a name="activity-logs"></a><a name="activity-log"></a>Журналы действий

Журналы действий содержат сведения об операциях, выполняемых на передней дверце. Они также определяют, что и когда для любых операций записи (размещение, публикация или удаление), сделанных на передней дверце.

>[!NOTE]
>Журналы действий не включают операции чтения (Get). Они также не включают операции, выполняемые с помощью портал Azure или исходного API управления.

Доступ к журналам действий осуществляется на передней дверце или во всех журналах ресурсов Azure в Azure Monitor. Чтобы просмотреть журналы действий, сделайте следующее:

1. Выберите экземпляр передней дверцы.
2. Выберите **Журнал действий**.

    :::image type="content" source="./media/front-door-diagnostics/activity-log.png" alt-text="Журнал действий":::

3. Выберите область фильтрации и нажмите кнопку **Применить**.

## <a name="diagnostic-logs"></a><a name="diagnostic-logging"></a>Журналы диагностики
Журналы диагностики содержат подробные сведения об операциях и ошибках, которые важны для аудита и устранения неполадок. Журналы диагностики отличаются от журналов действий.

Журналы действий предоставляют подробные сведения об операциях, выполняемых в ресурсах Azure. Журналы диагностики позволяют получить представление об операциях, выполненных ресурсом. Дополнительные сведения см. в разделе [Azure Monitor журналов диагностики](../azure-monitor/platform/platform-logs-overview.md).

:::image type="content" source="./media/front-door-diagnostics/diagnostic-log.png" alt-text="Журнал действий":::

Чтобы настроить журналы диагностики для передней дверцы, сделайте следующее:

1. Выберите свою переднюю дверцу Azure.

2. Выберите **параметры диагностики**.

3. Выберите **Включить диагностику**. Архивация журналов диагностики вместе с метриками в учетную запись хранения, потоковая передача в концентратор событий или отправка в журналы Azure Monitor.

В настоящее время Передняя дверца предоставляет журналы диагностики (в пакетном режиме каждый час). Журналы диагностики предоставляют отдельные запросы API с каждой записью, имеющей следующую схему:

| Свойство  | Описание |
| ------------- | ------------- |
| баккендхостнаме | Если запрос перенаправляется на серверную часть, это поле представляет имя узла внутреннего сервера. Это поле будет пустым, если запрос был перенаправлен или перенаправлен в Региональный кэш (если для правила маршрутизации включено кэширование). |
| качестатус | В сценариях кэширования это поле определяет попадание или промахи кэша на POP |
| ClientIp | IP-адрес отправившего запрос клиента. Если в запросе был указан заголовок X-Forwardd-for, то IP-адрес клиента выбирается из этого же. |
| клиентпорт | IP-порт клиента, который сделал запрос. |
| HttpMethod | Метод HTTP, используемый для запроса. |
| HttpStatusCode | Код состояния HTTP, полученный от прокси-сервера. |
| HttpStatusDetails | Итоговое состояние запроса. Пояснения к этому строковому значению есть в ссылочной таблице "Состояние". |
| HttpVersion | Тип запроса или подключения. |
| POP | Короткое имя края, где был выданный запрос. |
| RequestBytes | Размер сообщения с HTTP-запросом в байтах, включая заголовки и текст запроса. |
| RequestUri | URI полученного запроса. |
| ResponseBytes | Количество байтов, отправленных внутренним сервером в качестве ответа.  |
| раутингруленаме | Имя правила маршрутизации, которому соответствует запрос. |
| рулесенгинематчнамес | Имена правил, соответствующих запросу. |
| SecurityProtocol | Версия протокола TLS/SSL, которая использовалась в запросе. Содержит значение NULL, если шифрование не использовалось. |
| сенттуригиншиелд | Логическое поле, представляющее, было ли промах кэша в первой среде, и запрос был отправлен в Региональный кэш. Пропускать это поле, если правило маршрутизации является перенаправлением или если не включено кэширование. |
| TimeTaken | Время в секундах с первого байта запроса в переднюю дверь до последнего байта ответа. |
| TrackingReference | Это уникальная эталонная строка, которая идентифицирует обслуженный Front Door запрос. Она же отправляется клиенту в заголовке X-Azure-Ref. Эта строка нужна для поиска в журналах доступа сведений о конкретном запросе. |
| UserAgent | Тип браузера, используемый клиентом. |

**Примечание.** Для различных конфигураций маршрутизации и поведений трафика некоторые поля, такие как Баккендхостнаме, Качестатус, Сенттуригиншиелд и POP, могут реагировать на различные значения. В приведенной ниже таблице описаны различные значения, эти поля будут представлены в различных сценариях.

| Сценарии | Число записей в журнале | POP | баккендхостнаме | сенттуригиншиелд | качестатус |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| Правило маршрутизации без включенного кэширования | 1 | Код POP пограничных точек | Серверная часть, где был перенаправлен запрос | False | CONFIG_NOCACHE |
| Правило маршрутизации с включенным кэшированием. Попадание в кэш в точке подключения на границе | 1 | Код POP пограничных точек | Empty | False | ПРОИЗВОДИТСЯ |
| Правило маршрутизации с включенным кэшированием. Промах кэша на пограничных устройствах, но попадание в кэш во всплывающем окне родительского кэша | 2 | 1. пограничных точек кода</br>2. код POP родительского кэша | 1. имя узла POP родительского кэша</br>2. пусто | 1. true</br>2. false | 1. ПРОМАХ</br>2. PARTIAL_HIT |
| Правило маршрутизации с включенным кэшированием. Промахи кэша в корне и в родительском кэше | 2 | 1. пограничных точек кода</br>2. код POP родительского кэша | 1. имя узла POP родительского кэша</br>2. Серверная часть, помогающая заполнять кэш | 1. true</br>2. false | 1. ПРОМАХ</br>2. ПРОМАХИ |

## <a name="next-steps"></a>Дальнейшие действия

- [Создание профиля Front Door](quickstart-create-front-door.md)
- [Принцип работы передней дверцы](front-door-routing-architecture.md)
