---
title: Мониторинг метрик и журналов в передней дверце Azure | Документация Майкрософт
description: В этой статье описываются различные показатели и журналы доступа, поддерживаемые интерфейсом передней дверцы Azure.
services: frontdoor
documentationcenter: ''
author: sharad4u
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/18/2018
ms.author: sharadag
ms.openlocfilehash: b935355cce36a6e26b168db286ab40248f8f0f68
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "79471733"
---
# <a name="monitoring-metrics-and-logs-in-azure-front-door"></a>Мониторинг метрик и журналов в передней дверце Azure

С помощью передней дверцы Azure можно отслеживать ресурсы следующими способами.

- **Метрики**. В настоящее время Передняя дверца Azure содержит семь метрик для просмотра счетчиков производительности.
- **Журналы**. Журналы действий и диагностики позволяют сохранять и использовать данные о производительности, доступе и других данных в ресурсе для мониторинга.

### <a name="metrics"></a>Метрики

Метрики — это функция для некоторых ресурсов Azure, позволяющая просматривать счетчики производительности на портале. Ниже перечислены доступные метрики передней дверцы.

| Метрика | Отображаемое имя метрики | Единицы | Измерения | Описание |
| --- | --- | --- | --- | --- |
| RequestCount | Число запросов | Счетчик | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Число клиентских запросов, обслуженных службой Front Door.  |
| RequestSize | Размер запроса | Байты | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Число байт, отправленных в качестве запросов от клиентов в службу Front Door. |
| ResponseSize | Размер ответа | Байты | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Число байт, отправленных клиентам в качестве ответов из службы Front Door. |
| TotalLatency | Total Latency (Общая задержка) | Миллисекунды | HttpStatus</br>HttpStatusGroup</br>ClientRegion</br>ClientCountry | Время, вычисленное на основе запроса клиента, полученного с помощью передней дверцы, до тех пор, пока клиент не подтвердил последний байт ответа от передней дверцы. |
| BackendRequestCount | Число запросов к серверному компоненту | Счетчик | HttpStatus</br>HttpStatusGroup</br>Серверная часть | Число запросов, отправленных из службы Front Door к серверным частям. |
| BackendRequestLatency | Backend Request Latency (Задержка запросов к серверным частям) | Миллисекунды | Серверная часть | Время с момента отправки запроса службой Front Door к серверной части до получения Front Door последнего байта ответа от серверной части. |
| BackendHealthPercentage | Работоспособность серверного компонента (в процентах) | Процент | Серверная часть</br>BackendPool | Процент успешных проб работоспособности от службы Front Door к серверным частям. |
| WebApplicationFirewallRequestCount | Web Application Firewall Request Count (Число запросов к брандмауэру веб-приложения) | Счетчик | PolicyName</br>RuleName</br>Действие | Количество клиентских запросов, обрабатываемых механизмом безопасности на прикладном уровне службы Front Door. |

## <a name="activity-logs"></a><a name="activity-log"></a>Журналы действий

Журналы действий содержат сведения об операциях, выполняемых на передней дверце. Они также определяют, что и когда для любых операций записи (размещение, публикация или удаление), сделанных на передней дверце.

>[!NOTE]
>Журналы действий не включают операции чтения (Get). Они также не включают операции, выполняемые с помощью портал Azure или исходного API управления.

Доступ к журналам действий осуществляется на передней дверце или во всех журналах ресурсов Azure в Azure Monitor. Чтобы просмотреть журналы действий, сделайте следующее:

1. Выберите экземпляр передней дверцы.
2. Выберите **Журнал действий**.

    ![Журнал действий](./media/front-door-diagnostics/activity-log.png)

3. Выберите область фильтрации и нажмите кнопку **Применить**.

## <a name="diagnostic-logs"></a><a name="diagnostic-logging"></a>Журналы диагностики
Журналы диагностики содержат подробные сведения об операциях и ошибках, которые важны для аудита и устранения неполадок. Журналы диагностики отличаются от журналов действий.

Журналы действий предоставляют подробные сведения об операциях, выполняемых в ресурсах Azure. Журналы диагностики позволяют получить представление об операциях, которые выполнял ваш ресурс. Дополнительные сведения см. в разделе [Azure Monitor журналов диагностики](../azure-monitor/platform/platform-logs-overview.md).

![Журналы диагностики](./media/front-door-diagnostics/diagnostic-log.png)

Чтобы настроить журналы диагностики для передней дверцы, сделайте следующее:

1. Выберите свою переднюю дверцу Azure.

2. Выберите **параметры диагностики**.

3. Выберите **Включить диагностику**. Архивация журналов диагностики вместе с метриками в учетную запись хранения, потоковая передача в концентратор событий или отправка в журналы Azure Monitor.

В настоящее время Передняя дверца предоставляет журналы диагностики (в пакетном режиме каждый час). Журналы диагностики предоставляют отдельные запросы API с каждой записью, имеющей следующую схему:

| Свойство  | Описание: |
| ------------- | ------------- |
| баккендхостнаме | Если запрос перенаправляется на серверную часть, это поле представляет имя узла внутреннего сервера. Это поле будет пустым, если запрос был перенаправлен или перенаправлен в Региональный кэш (если для правила маршрутизации включено кэширование). |
| качестатус | В сценариях кэширования это поле определяет попадание или промахи кэша на POP |
| ClientIp | IP-адрес отправившего запрос клиента. Если в запросе был указан заголовок X-Forwardd-for, то IP-адрес клиента выбирается из этого же. |
| клиентпорт | IP-порт клиента, который сделал запрос. |
| HttpMethod | Метод HTTP, используемый для запроса. |
| HttpStatusCode | Код состояния HTTP, возвращенный прокси-сервером. |
| хттпстатусдетаилс | Итоговое состояние запроса. Значение этого строкового значения можно найти в таблице ссылок на состояние. |
| HttpVersion | Тип запроса или соединения. |
| POP | Короткое имя края, где был выданный запрос. |
| рекуестбитес | Размер сообщения HTTP-запроса в байтах, включая заголовки запроса и текст запроса. |
| RequestUri | URI полученного запроса. |
| респонсебитес | Байт, отправленный внутренним сервером в качестве ответа.  |
| раутингруленаме | Имя правила маршрутизации, которому соответствует запрос. |
| Экземпляр SecurityProtocol | Версия протокола TLS/SSL, используемая запросом, или значение null, если шифрование отсутствует. |
| сенттуригиншиелд | Логическое поле, представляющее, было ли промах кэша в первой среде, и запрос был отправлен в Региональный кэш. Пропускать это поле, если правило маршрутизации является перенаправлением или если не включено кэширование. |
| TimeTaken | Продолжительность времени, затраченного на выполнение действия, в миллисекундах. |
| траккингреференце | Уникальная строка ссылки, определяющая запрос, обслуживаемый передней дверцей, который также отправляется клиенту в виде заголовка X-Azure-ref. Требуется для поиска сведений в журналах доступа для конкретного запроса. |
| UserAgent | Тип браузера, который использовался клиентом. |

**Примечание.** Для различных конфигураций маршрутизации и поведений трафика некоторые поля, такие как Баккендхостнаме, Качестатус, Сенттуригиншиелд и POP, могут реагировать на различные значения. В приведенной ниже таблице описаны различные значения, эти поля будут представлены в различных сценариях.

| Сценарии | Число записей в журнале | POP | баккендхостнаме | сенттуригиншиелд | качестатус |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| Правило маршрутизации без включенного кэширования | 1 | Код POP пограничных точек | Серверная часть, где был перенаправлен запрос | False | CONFIG_NOCACHE |
| Правило маршрутизации с включенным кэшированием. Попадание в кэш в точке подключения на границе | 1 | Код POP пограничных точек | Пусто | False | ПРОИЗВОДИТСЯ |
| Правило маршрутизации с включенным кэшированием. Промах кэша на пограничных устройствах, но попадание в кэш во всплывающем окне родительского кэша | 2 | 1. пограничных точек кода</br>2. код POP родительского кэша | 1. имя узла POP родительского кэша</br>2. пусто | 1. true</br>2. false | 1. ПРОМАХ</br>2. PARTIAL_HIT |
| Правило маршрутизации с включенным кэшированием. Промахи кэша в корне и в родительском кэше | 2 | 1. пограничных точек кода</br>2. код POP родительского кэша | 1. имя узла POP родительского кэша</br>2. Серверная часть, помогающая заполнять кэш | 1. true</br>2. false | 1. ПРОМАХ</br>2. ПРОМАХИ |


## <a name="next-steps"></a>Дальнейшие шаги

- [Создание профиля Front Door](quickstart-create-front-door.md)
- [Принцип работы передней дверцы](front-door-routing-architecture.md)
