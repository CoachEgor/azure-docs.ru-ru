---
title: Настраиваемое правило брандмауэра веб-приложения для передней дверцы Azure
description: Узнайте, как использовать настраиваемые правила брандмауэра веб-приложения (WAF), защищая веб-приложения от вредоносных атак.
author: KumudD
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/07/2019
ms.author: kumud
ms.reviewer: tyao
ms.openlocfilehash: 344e04985c52945b2917d3b5f616d5fca6051ab9
ms.sourcegitcommit: bc3a153d79b7e398581d3bcfadbb7403551aa536
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2019
ms.locfileid: "68839775"
---
#  <a name="custom-rules-for-web-application-firewall-with-azure-front-door"></a>Пользовательские правила для брандмауэра веб-приложения с помощью передней дверцы Azure
Брандмауэр веб-приложения Azure (WAF) со службой "Передняя дверца" позволяет управлять доступом к веб-приложениям на основе определенных условий. Настраиваемое правило WAF состоит из номера приоритета, типа правила, условий соответствия и действия. Существует два типа настраиваемых правил: правила соответствия и правила ограничения скорости. Правило соответствия управляет доступом на основе набора условий сопоставления, в то время как правило ограничения скорости управляет доступом на основе условий сопоставления и скорости входящих запросов. Вы можете отключить пользовательское правило, чтобы предотвратить его оценку, но сохранить конфигурацию. 

## <a name="priority-match-conditions-and-action-types"></a>Приоритет, условия соответствия и типы действий
Вы можете управлять доступом с помощью настраиваемого правила WAf, определяющего номер приоритета, тип правила, массив условий соответствия и действие. 

- **Priority** — уникальное целое число, описывающее порядок вычисления правил WAF. Правила с более низкими значениями приоритета оцениваются до правил с более высокими значениями. Номера приоритета должны быть уникальными среди всех настраиваемых правил.

- **Действие:** определяет способ маршрутизации запроса при сопоставлении правила WAF. Можно выбрать одно из следующих действий, которое будет применено, если запрос соответствует настраиваемому правилу.

    - *Allow* -WAF пересылает заявку на серверную части, записывает запись в журналы WAF и завершает работу.
    - *Блокировка* запроса заблокирована, WAF отправляет клиенту ответ, не перенаправляя запрос на серверную части. WAF регистрирует запись в журналах WAF.
    - *Log* -WAF регистрирует запись в журналах WAF и продолжит оценку следующего правила.
    - *Redirect* -WAF перенаправляет запрос на указанный URI, записывает запись в журналы WAF и завершает работу.

- **Условие соответствия:** определяет переменную соответствия, оператор и значение match. Каждое правило может содержать несколько условий соответствия. Условие соответствия может основываться на географическом расположении, IP-адресах клиента (CIDR), размере или совпадении строк. Совпадение строк может состоять из списка переменных соответствия.
  - **Сопоставить переменную:**
    - рекуестмесод
    - QueryString
    - Аргументы
    - RequestUri
    - RequestHeader
    - RequestBody
    - Файлы cookie
  - **Станции**
    - Any: часто используется для определения действия по умолчанию, если правила не совпадают. Any является оператором Match ALL.
    - Равные
    - Содержит
    - LessThan: ограничение размера
    - GreaterThan: ограничение размера
    - LessThanOrEqual: ограничение размера
    - GreaterThanOrEqual: ограничение размера
    - Начинается с
    - EndsWith
    - Регулярное выражение
  
  - **Регулярное выражение** не поддерживает следующие операции: 
    - Обратные ссылки и захват частей выражений
    - Произвольные утверждения нулевой ширины
    - Ссылки на подпрограммы и рекурсивные шаблоны
    - Условные шаблоны
    - Команды управления поиском с возвратом
    - Директива \c с одним байтом
    - Директива сопоставления для новой строки \r
    - Директива инициализации \K Start from Match
    - Выноски и встроенный код
    - Атомарное группирование и более обладающие кванторы

  - **Инвертировать [необязательно]:** Можно задать условие *отрицания* , равное true, если результат условия должен быть инвертирован.
      
  - **Преобразование [необязательно]:** Список строк с именами преобразований, которые необходимо выполнить до попытки сопоставления. Это могут быть следующие преобразования:
     - Верхний регистр 
     - Нижний регистр
     - Trim
     - ремовенуллс
     - урлдекоде
     - UrlEncode
     
   - **Значение соответствия:** Поддерживаемые значения метода HTTP-запроса включают:
     - GET
     - ПОМЕСТИТЬ
     - PUT
     - HEAD
     - DELETE
     - СКРЫТЬ
     - БЛОКИРОВАН
     - ПРОФИЛЯ
     - OPTIONS
     - ИСПОЛЬЗУЮТСЯ
     - PROPPATCH
     - MKCOL
     - КОПИИ
     - ПОМЕСТИТЬ

## <a name="examples"></a>Примеры

### <a name="waf-custom-rules-example-based-on-http-parameters"></a>Пример настраиваемых правил WAF на основе параметров HTTP

Ниже приведен пример, в котором показана конфигурация пользовательского правила с двумя условиями соответствия. Запросы относятся к указанному сайту, как определено в источнике ссылок, а строка запроса не содержит "Password".

```
# http rules example
{
  "name": "AllowFromTrustedSites",
  "priority": 1,
  "ruleType": "MatchRule",
  "matchConditions": [
    {
      "matchVariable": "RequestHeader",
      "selector": "Referer",
      "operator": "Equal",
      "negateCondition": false,
      "matchValue": [
        "www.mytrustedsites.com/referpage.html"
      ]
    },
    {
      "matchVariable": "QueryString",
      "operator": "Contains",
      "matchValue": [
        "password"
      ],
      "negateCondition": true
    }
  ],
  "action": "Allow",
  "transforms": []
}

```
Пример конфигурации для блокировки метода "постановки" показан ниже:

``` 
# http Request Method custom rules
{
  "name": "BlockPUT",
  "priority": 2,
  "ruleType": "MatchRule",
  "matchConditions": [
    {
      "matchVariable": "RequestMethod",
      "selector": null,
      "operator": "Equal",
      "negateCondition": false,
      "matchValue": [
        "PUT"
      ]
    }
  ],
  "action": "Block",
  "transforms": []
}
```

### <a name="size-constraint"></a>Ограничение размера

Вы можете создать пользовательское правило, задающее ограничение размера для части входящего запроса. Например, приведенное ниже правило блокирует URL-адрес, длина которого превышает 100 символов.

```
# http parameters size constraint
{
  "name": "URLOver100",
  "priority": 5,
  "ruleType": "MatchRule",
  "matchConditions": [
    {
      "matchVariable": "RequestUri",
      "selector": null,
      "operator": "GreaterThanOrEqual",
      "negateCondition": false,
      "matchValue": [
        "100"
      ]
    }
  ],
  "action": "Block",
  "transforms": []
}
```

## <a name="next-steps"></a>Следующие шаги
- Дополнительные сведения о [брандмауэре веб-приложения](waf-overview.md)
- Дополнительные сведения о [создании Front Door](quickstart-create-front-door.md).

