---
title: Web application брандмауэра настраиваемое правило для входной двери Azure
description: Сведения об использовании правил брандмауэра веб приложения (WAF) пользовательских Защита веб-приложений от атак злоумышленников.
author: KumudD
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/07/2019
ms.author: kumud;tyao
ms.openlocfilehash: 744c6fb9235c9daa2d5239ef9fd13679db943650
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61459714"
---
#  <a name="custom-rules-for-web-application-firewall-with-azure-front-door"></a>Настраиваемые правила для брандмауэра веб-приложения с помощью передовой Azure
Брандмауэр Azure веб-приложения (WAF) со службой двери позволяет управлять доступом к веб-приложений на основе заданных вами условий. Настраиваемое правило WAF состоит из номер приоритета, тип правила, условия соответствия и действие. Существует два вида настраиваемых правил: соответствует правилам и правила ограничения частоты. Правило соответствия можно управлять доступом на основе сопоставления условий правила ограничения частоты управляет доступом на основе сопоставления условий и скорости входящих запросов. Может отключить настраиваемое правило для предотвращения его оценки, но по-прежнему сохранить конфигурацию. В этой статье рассматриваются правила соответствия, основанные на параметрах http.

## <a name="priority-match-conditions-and-action-types"></a>Приоритет, условия соответствия и типы действий
Вы можете управлять доступом с помощью настраиваемого правила WAf, определяющий номер приоритета, тип правила, условия соответствия и действие. 

- **Приоритет:** — уникальное целое число, описывающий порядок выполнения правил WAF. Правила с более низкие значения, проверяются перед правилами с более высоким значением

- **Действие:** определяет способ маршрутизации запроса при сопоставлении правила WAF. Можно выбрать один из под действия должны применяться, если запрос соответствует настраиваемое правило.

    - *Разрешить* -WAF перенаправляет приступил к серверной части, ведет запись в журналы WAF и завершает работу.
    - *Блок* -запрос блокирован, WAF отправляет ответ клиенту, если Пересылка запроса на серверной стороне. WAF регистрирует запись в журналы WAF.
    - *Журнал* -журналы WAF, запись в WAF заносит в журнал и продолжает оценить следующее правило.
    - *Перенаправления* -WAF перенаправляет запрос на указанный универсальный код ресурса, регистрирует запись в журналы WAF и завершает работу.

- **Условие соответствия:** определяет переменную match, оператор и соответствует значению. Каждое правило может содержать несколько условий соответствия. Условие соответствия могут основываться на ниже *соответствует переменные*:
    - RemoteAddr (IP-адрес клиента)
    - requestMethod
    - QueryString
    - PostArgs
    - requestUri
    - RequestHeader
    - RequestBody

- **Оператор:** список включает в себя следующие:
    - Любой: часто используется для определения действие по умолчанию, если правила не совпадают. Любой оператор all совпадает.
    - IPMatch: ограничения IP-адресов для переменной RemoteAddr определить
    - GeoMatch: географическая Фильтрация для переменной RemoteAddr определить
    - Равные
    - Содержит
    - LessThan: ограничение размера
    - GreaterThan: ограничение размера
    - LessThanOrEqual: ограничение размера
    - GreaterThanOrEqual: ограничение размера
    - Начинается с
     - endsWith

Можно задать *negate* условия значение true, если результат вычисления условия должно быть инвертирована.

*Соответствует значению* определяет список возможных значений.
Поддерживает метод HTTP-запроса, значениям относятся:
- GET
- POST
- PUT
- HEAD
- DELETE
- БЛОКИРОВКИ
- РАЗБЛОКИРОВАТЬ
- ПРОФИЛЬ
- OPTIONS
- PROPFIND
- PROPPATCH
- MKCOL
- КОПИРОВАНИЕ
- ПЕРЕМЕЩЕНИЕ

## <a name="examples"></a>Примеры

### <a name="waf-custom-rules-example-based-on-http-parameters"></a>Пример настраиваемых правил WAF, на основе параметров http

Ниже приведен пример, в котором показана конфигурация настраиваемого правила с два условия соответствия. Запросов, поступивших с указанного сайта, в соответствии с определением источника ссылки, и строка запроса не содержит «password».

```
# http rules example
{
  "name": "AllowFromTrustedSites",
  "priority": 1,
  "ruleType": "MatchRule",
  "matchConditions": [
    {
      "matchVariable": "RequestHeader",
      "selector": "Referer",
      "operator": "Equal",
      "negateCondition": false,
      "matchValue": [
        "www.mytrustedsites.com/referpage.html"
      ]
    },
    {
      "matchVariable": "QueryString",
      "operator": "Contains",
      "matchValue": [
        "password"
      ],
      "negateCondition": true
    }
  ],
  "action": "Allow",
  "transforms": []
}

```
Показан пример конфигурации для блокировки метод «PUT», как показано ниже:

``` 
# http Request Method custom rules
{
  "name": "BlockPUT",
  "priority": 2,
  "ruleType": "MatchRule",
  "matchConditions": [
    {
      "matchVariable": "RequestMethod",
      "selector": null,
      "operator": "Equal",
      "negateCondition": false,
      "matchValue": [
        "PUT"
      ]
    }
  ],
  "action": "Block",
  "transforms": []
}
```

### <a name="size-constraint"></a>Ограничение размера

Вы может создать настраиваемое правило, указывающее ограничение размера на часть входящего запроса. Например ниже правило блокирует URL-адрес, длина которого превышает 100 символов.

```
# http parameters size constraint
{
  "name": "URLOver100",
  "priority": 5,
  "ruleType": "MatchRule",
  "matchConditions": [
    {
      "matchVariable": "RequestUri",
      "selector": null,
      "operator": "GreaterThanOrEqual",
      "negateCondition": false,
      "matchValue": [
        "100"
      ]
    }
  ],
  "action": "Block",
  "transforms": []
}
```

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о [брандмауэр веб-приложения](waf-overview.md)
- Дополнительные сведения о [создании Front Door](quickstart-create-front-door.md).

