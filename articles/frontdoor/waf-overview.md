---
title: Что такое брандмауэр веб-приложения Azure для передней дверцы Azure? (предварительная версия)
description: Узнайте, как брандмауэр веб-приложения Azure для службы "Передняя дверца Azure" защищает ваши веб-приложения от вредоносных атак.
services: frontdoor
documentationcenter: ''
author: KumudD
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/31/2019
ms.author: kumud
ms.reviewer: tyao
ms.openlocfilehash: 624a5af59a39cb0ebf647f549f3a40ed56f78b9e
ms.sourcegitcommit: d47a30e54c5c9e65255f7ef3f7194a07931c27df
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73549221"
---
# <a name="what-is-azure-web-application-firewall-for-azure-front-door"></a>Что такое брандмауэр веб-приложения Azure для передней дверцы Azure?

Брандмауэр веб-приложения Azure (WAF) обеспечивает централизованную защиту веб-приложений, которые доставляются на глобальном уровне с помощью Azure Front Door. Он разработан и предназначен для защиты веб-служб от распространенных эксплойтов и уязвимостей, обеспечения высокой доступности службы для пользователей и соблюдения требований соответствия.


Веб-приложения все чаще являются целями вредоносных атак, таких как отказ в обслуживании, атаки путем внедрения кода SQL и атаки с использованием межузловых сценариев. Эти вредоносные атаки могут вызвать сбой службы и потерю данных, стать важной угрозой для владельцев веб-приложений.

Предотвращение таких атак в коде приложения может быть сложной задачей, требующей неукоснительного обслуживания, установки исправлений и мониторинга на различных уровнях топологии приложения. Централизованный брандмауэр веб-приложения значительно упрощает управление безопасностью и помогает администраторам защищать приложение от угроз вторжения. Кроме того, решение WAF может быстрее реагировать на угрозу безопасности путем исправления известной уязвимости в центральном расположении, а не для защиты каждого отдельного веб-приложения.

WAF для Front дверь — это глобальное и централизованное решение. Он разворачивается в расположениях в сети периметра Azure, и каждый входящий запрос веб-приложения с поддержкой WAF, доставленного с помощью передней дверцы, проверяется на границе сети. Это позволяет WAF избежать вредоносных атак, близких к источникам атак, до того, как они вводят виртуальную сеть и обеспечивают глобальную защиту в масштабе без ущерба для производительности. Политику WAF можно легко связать с любым профилем передней дверцы в подписке, а новые правила можно развернуть за несколько минут, что позволит быстро реагировать на изменения шаблонов угроз.

![Брандмауэр веб-приложения Azure](./media/waf-overview/web-application-firewall-overview.png)

Azure WAF также можно включить с помощью шлюза приложений. Дополнительные сведения см. в разделе [брандмауэр веб-приложения](../application-gateway/waf-overview.md).

## <a name="waf-policy-and-rules"></a>Политика и правила WAF

Вы можете настроить политику WAF и связать ее с одной или несколькими внешними интерфейсами передней дверцы для защиты. Политика WAF состоит из двух типов правил безопасности:

- Настраиваемые правила, созданные клиентом.

- управляемые наборы правил, которые являются коллекцией предварительно настроенных наборов правил, управляемых Azure.

Если оба этих параметра существуют, то перед обработкой правил в наборе управляемых правил обрабатываются пользовательские правила. Правило относится к условию соответствия, приоритету и действию. Поддерживаются следующие типы действий: разрешение, блокировка, журнал и перенаправление. Можно создать полностью настраиваемую политику, удовлетворяющую конкретным требованиям к защите приложений, комбинируя управляемые и настраиваемые правила.

Правила в политике обрабатываются в порядке приоритета, где приоритет — это уникальное целое число, определяющее порядок обработки правил. Меньшее целое значение обозначает более высокий приоритет, и они оцениваются перед правилами с более высоким целочисленным значением. После сопоставления правила к запросу применяется соответствующее действие, определенное в правиле. После обработки такого соответствия правила с более низким приоритетом не обрабатываются дальше.

Веб-приложение, доставленное с помощью передней дверцы, может иметь только одну связанную с ней политику WAF. Однако вы можете использовать конфигурацию передней дверцы без связанных с ней политик WAF. Если политика WAF установлена, она реплицируется во все наши граничные расположения для обеспечения согласованности политик безопасности по всему миру.

## <a name="waf-modes"></a>Режимы WAF

Политику WAF можно настроить для запуска в следующих двух режимах:

- **Режим обнаружения:** При запуске в режиме обнаружения WAF не принимает никаких других действий, кроме мониторов, и записывает в журнал запрос и соответствующее правило WAF в журналы WAF. Вы можете включить диагностику ведения журнала для передней дверцы (при использовании портала это можно сделать, перейдя к разделу **Диагностика** в портал Azure).

- **Режим предотвращения:** Если настроено выполнение в режиме предотвращения, WAF выполняет указанное действие, если запрос соответствует правилу, и если найдено соответствие, последующие правила с низким приоритетом не оцениваются. Все совпадающие запросы также регистрируются в журналах WAF.

## <a name="waf-actions"></a>Действия WAF

Клиенты WAF могут выбрать Запуск из одного из действий, если запрос соответствует условиям правила:

- **Разрешить:**  Запрос проходит через WAF и перенаправляется в серверную части. Никакие другие правила с низким приоритетом не могут блокировать этот запрос.
- **Блокировка:** Запрос блокируется, и WAF отправляет клиенту ответ, не перенаправляя запрос на серверную части.
- **Журнал:**  Запрос записывается в журналы WAF, а WAF — на анализ правил с низким приоритетом.
- **Перенаправление:** WAF перенаправляет запрос по указанному универсальному коду ресурса (URI). Указанный URI является параметром уровня политики. После настройки все запросы, соответствующие действию **перенаправления** , будут отправлены на этот универсальный код ресурса (URI).

## <a name="waf-rules"></a>Правила WAF

Политика WAF может состоять из двух типов правил безопасности — настраиваемых правил, созданных клиентами и управляемыми наборами правил, которые управляются предварительно настроенными правилами Azure.

### <a name="custom-authored-rules"></a>Пользовательские созданные правила

Настраиваемые правила WAF можно настроить следующим образом.

- Список **разрешений IP-адресов и список блокировок:** Можно настроить настраиваемые правила для управления доступом к веб-приложениям на основе списка IP-адресов клиентов или диапазонов IP-адресов. Поддерживаются типы адресов IPv4 и IPv6. Этот список можно настроить, чтобы заблокировать или разрешить запросы, в которых исходный IP-адрес соответствует IP-адресу в списке. IP-адрес клиента может отличаться от IP-адреса, WAF, например, когда клиент обращается к WAF через прокси-сервер. [Правила ограничения IP-](https://docs.microsoft.com/azure/frontdoor/waf-front-door-configure-ip-restriction) адресов можно создать на основе IP-адресов клиентов (ремотеаддр) или IP-адреса, отображаемых WAF (соккетаддр). Настройка правила ограничения IP-адресов Соккетаддр в настоящее время поддерживается с помощью PowerShell и Azure CLI.

- **Управление доступом на основе географических объектов:** Можно настроить настраиваемые правила для управления доступом к веб-приложениям на основе кода страны, связанного с IP-адресом клиента.

- **Управление доступом на основе параметров http:** Можно настроить настраиваемые правила на основе строк, соответствующих параметрам запроса HTTP/HTTPS, таким как строки запроса, аргументы POST, URI запроса, заголовок запроса и текст запроса.

- **Управление доступом на основе метода запроса:** Вы можете настроить настраиваемые правила на основе метода HTTP-запроса запроса, например GET, WHERE или HEAD.

- **Ограничение размера:** Настраиваемые правила можно настроить на основе длины отдельных частей запроса, таких как строка запроса, URI или текст запроса.

- **Правила ограничения скорости:** Правило управления скоростью позволяет ограничить аномальный высокий трафик от любого IP-адреса клиента. Вы можете настроить пороговое значение числа веб-запросов, разрешенных с IP-адреса клиента в течение одной минуты. Обратите внимание, что дополнительные запросы выше порогового значения могут быть доступны при обновлении счетчика запросов. Ограничение скорости можно сочетать с дополнительными условиями соответствия, такими как параметры HTTP (S), соответствующие параметру управления скоростью.

### <a name="azure-managed-rule-sets"></a>Наборы правил, управляемые Azure

Наборы правил, управляемые Azure, обеспечивают простой способ развертывания защиты от общего набора угроз безопасности. Поскольку такие наборы правил управляются Azure, правила обновляются по мере необходимости для защиты от новых подписей атак. В общедоступной предварительной версии набор правил по умолчанию, управляемый Azure, включает правила для следующих категорий угроз:

- Межсайтовые сценарии
- Атаки Java
- Включение локального файла
- Атаки путем внедрения PHP
- Удаленное выполнение команды
- Включение удаленного файла
- С фиксацией сеанса
- Защита от внедрения кода SQL.
- Злоумышленники протоколов

Номер версии набора правил по умолчанию будет увеличиваться при добавлении подписей новых атак в набор правил.
Набор правил по умолчанию включен в режиме обнаружения в политиках WAF по умолчанию. Вы можете отключить или включить отдельные правила в наборе правил по умолчанию в соответствии с требованиями приложения. Можно также задать определенные действия (разрешение/Блокировка, перенаправление/журнал) для каждого правила. Действие по умолчанию — блокировать. Кроме того, настраиваемые правила можно настроить в той же политике WAF, если вы хотите обойти какие-либо предварительно настроенные правила в наборе правил по умолчанию.
Пользовательские правила всегда применяются до оценки правил в наборе правил по умолчанию. Если запрос соответствует настраиваемому правилу, применяется соответствующее действие правила, и запрос либо блокируется, либо передается в серверную часть, без вызова каких-либо дополнительных настраиваемых правил или правил в наборе правил по умолчанию. Кроме того, имеется возможность удалить набор правил по умолчанию из политик WAF.


### <a name="bot-protection-rule-preview"></a>Правило защиты Bot (Предварительная версия)

Можно включить управляемый набор правил защиты Bot, чтобы ваша WAF могла выполнять пользовательские действия с запросами от известных категорий Bot.
Поддерживаются три категории Bot: неправильный программы-роботы, хороший программы-роботы и неизвестный программы-роботы. В категории Bad программы-роботы (неплохая категория) одно правило обнаруживает вредоносную программы-роботы на основе IP-репутации адресов клиени. Репутация IP-адресов поступают из канала аналитики угроз Майкрософт. [Intelligent Security Graph](https://www.microsoft.com/security/operations/intelligence) включает аналитику угроз Майкрософт и используется несколькими службами, включая центр безопасности Azure. Кроме того, запросы, которые представляют собой известные поисковые системы, также обнаруживаются как вредоносные.
Хорошие программы-роботы — проверенные ядра сеакрх. Неизвестные категории: запросы определяются как программы-роботы, но с неизвестными намерения. Вы можете задать пользовательские действия для блокировки, разрешения, записи в журнал или перенаправления для различных категорий программы-роботы.

![Набор правил защиты Bot](./media/waf-front-door-configure-bot-protection/BotProtect2.png)

> [!IMPORTANT]
> Набор правил защиты Bot в настоящее время находится в общедоступной предварительной версии и предоставляется с соглашением об уровне обслуживания предварительной версии. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.  См. [дополнительные условия использования для предварительных версий Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Если включена защита с ленты, входящие запросы, соответствующие правилам Bot, регистрируются в журнале Фронтдурвебаппликатионфиревалллог. Вы можете получить доступ к журналам WAF из учетной записи хранения, концентратора событий или log Analytics. 

## <a name="configuration"></a>Конфигурация

Настройка и развертывание всех типов правил WAF полностью поддерживается с помощью портал Azure, интерфейсов API, Azure Resource Manager шаблонов и Azure PowerShell.

## <a name="monitoring"></a>Мониторинг

Мониторинг WAF на передней дверце интегрирован с Azure Monitor для отслеживания оповещений и легкого мониторинга тенденций трафика.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [настроить WAF политику для работы с передней дверцей с помощью портал Azure](waf-front-door-create-portal.md)
