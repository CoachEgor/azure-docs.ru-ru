---
title: Обзор журналов и метрик Брандмауэра Azure
description: Работу брандмауэра Azure можно отслеживать с помощью журналов брандмауэра. Также журналы действий можно использовать для аудита операций на ресурсах брандмауэра Azure.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: article
ms.date: 01/22/2020
ms.author: victorh
ms.openlocfilehash: 89c6700d5df3bcef1332121c3cf7d8f720fe054c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76315037"
---
# <a name="azure-firewall-logs-and-metrics"></a>Журналы и метрики Брандмауэра Azure

Работу брандмауэра Azure можно отслеживать с помощью журналов брандмауэра. Также журналы действий можно использовать для аудита операций на ресурсах брандмауэра Azure.

Доступ к некоторым из этих журналов можно получить через портал. Журналы можно передавать в [Журналы Azure Monitor](../azure-monitor/insights/azure-networking-analytics.md), службу хранилища, Центры событий, а затем анализировать в Журналах Azure Monitor или при помощи различных инструментов, таких как Excel и Power BI.

Метрика является легкой и может поддерживать сценарии в режиме реального времени, что делает их полезными для оповещения и быстрого обнаружения проблем.

## <a name="diagnostic-logs"></a>Журналы диагностики

 Для брандмауэра Azure доступны следующие журналы диагностики.

* **Журнал правил приложений**

   Запись правил приложения сохраняется в учетной записи хранения, передается в концентраторы событий и/или отправляется в журналы Azure Monitor только в том случае, если вы включили его для каждого брандмауэра Azure. Результаты каждого нового подключения, которое соответствует одному из настроенных правил приложения, находятся в журнале принятого или отклоненного подключения. Данные регистрируются в журнале в формате JSON, как показано в примере ниже.

   ```
   Category: application rule logs.
   Time: log timestamp.
   Properties: currently contains the full message.
   note: this field will be parsed to specific fields in the future, while maintaining backward compatibility with the existing properties field.
   ```

   ```json
   {
    "category": "AzureFirewallApplicationRule",
    "time": "2018-04-16T23:45:04.8295030Z",
    "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupName}/PROVIDERS/MICROSOFT.NETWORK/AZUREFIREWALLS/{resourceName}",
    "operationName": "AzureFirewallApplicationRuleLog",
    "properties": {
        "msg": "HTTPS request from 10.1.0.5:55640 to mydestination.com:443. Action: Allow. Rule Collection: collection1000. Rule: rule1002"
    }
   }
   ```

* **Журнал правил сети**

   Системы правил Сети сохраняются в учетной записи хранения, передаются в концентраторы событий и/или отправляются в журналы Azure Monitor только в том случае, если вы включили его для каждого брандмауэра Azure. Каждое новое подключение, которое соответствует одному из настроенных правил сети, регистрируется в журнале как принятое или отклоненное подключение. Данные регистрируются в журнале в формате JSON, как показано в примере ниже.

   ```
   Category: network rule logs.
   Time: log timestamp.
   Properties: currently contains the full message.
   note: this field will be parsed to specific fields in the future, while maintaining backward compatibility with the existing properties field.
   ```

   ```json
  {
    "category": "AzureFirewallNetworkRule",
    "time": "2018-06-14T23:44:11.0590400Z",
    "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupName}/PROVIDERS/MICROSOFT.NETWORK/AZUREFIREWALLS/{resourceName}",
    "operationName": "AzureFirewallNetworkRuleLog",
    "properties": {
        "msg": "TCP request from 111.35.136.173:12518 to 13.78.143.217:2323. Action: Deny"
    }
   }

   ```

Существует три способа хранения журналов:

* **Учетная запись хранения** лучше всего подходит для длительного хранения журналов и их просмотра по мере необходимости.
* **Центры событий** — это отличный вариант для интеграции с другими инструментами управления событиями и сведениями о безопасности (SEIM), позволяющий получать оповещения о ваших ресурсах.
* **Журналы Azure Monitor:** журналы Azure Monitor лучше всего использовать для общего мониторинга приложения в режиме реального времени или для просмотра тенденций.

## <a name="activity-logs"></a>Журналы действий

   Записи этого журнала собираются по умолчанию, и их можно просмотреть на портале Azure.

   Для просмотра всех операций, представленных в подписке Azure, можно использовать [журналы активности Azure](../azure-resource-manager/management/view-activity-logs.md) (ранее известные как журналы эксплуатации и аудита).

## <a name="metrics"></a>Метрики

Метрики в Azure Monitor являются числовыми значениями, описывающие некоторые аспекты системы в определенное время. Метрики собираются каждую минуту и полезны для оповещения, поскольку их можно часто отбирать. Оповещение может быть уволено быстро с относительно простой логикой.

Для Брандмауэра Azure доступны следующие метрики:

- **Правила применения хит кол** - количество раз, когда приложение правило было поражено.

    Единица: кол

- **Сетевые правила хит кол** - количество раз сетевое правило было поражено.

    Единица: кол

- **Обработка данных** - Количество данных, пересекающих брандмауэр.

    Единица: байты

- **Состояние работоспособности брандмауэра** - указывает на работоспособность брандмауэра на основе доступности порта SNAT.

    Единица: процент

   Эта метрика имеет два измерения:
  - Статус: Возможные значения *здоровые,* *деградированные,* *нездоровые*.
  - Причина: указывает причину соответствующего состояния брандмауэра. 

     Если порты SNAT используются > 95%, они считаются исчерпанными, а здоровье 50% со статусом **«Деградированный** и разумный**порт SNAT».** Брандмауэр сохраняет обработку трафика, и существующие соединения не затрагиваются. Однако новые соединения не могут устанавливаться с перерывами.

     Если порты SNAT используются < 95%, то брандмауэр считается здоровым, а здоровье отображается как 100%.

     Если использование портов SNAT не сообщается, работоспособность отображается как 0%. 

- **Использование порта SNAT** - Процент портов SNAT, которые были использованы брандмауэром.

    Единица: процент

   При добавлении большего числа общедоступных IP-адресов в брандмауэрдоступно доступно больше портов SNAT, что снижает использование портов SNAT. Кроме того, когда брандмауэр масштабируется по разным причинам (например, процессор или пропускная часть), также становятся доступными дополнительные порты SNAT. Таким образом, эффективно, данный процент использования sNAT портов может пойти вниз без добавления каких-либо публичных IP-адресов, только потому, что служба масштабируется. Вы можете непосредственно контролировать количество общедоступных IP-адресов, доступных для увеличения доступных портов в брандмауэре. Но вы не можете непосредственно контролировать масштабирование брандмауэра. В настоящее время порты SNAT добавляются только для первых пяти публичных IP-адресов.   


## <a name="next-steps"></a>Дальнейшие действия

- См. дополнительные сведения об [отслеживании метрик и журналов Брандмауэра Azure](tutorial-diagnostics.md).

- Чтобы узнать больше о метриках [Metrics in Azure Monitor](../azure-monitor/platform/data-platform-metrics.md)в Azure Monitor, см.
