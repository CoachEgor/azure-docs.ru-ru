---
title: Общие сведения о журналах и метриках брандмауэра Azure
description: Работу брандмауэра Azure можно отслеживать с помощью журналов брандмауэра. Также журналы действий можно использовать для аудита операций на ресурсах брандмауэра Azure.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: article
ms.date: 08/25/2020
ms.author: victorh
ms.openlocfilehash: 51804a9f98bfa17dcfbeb90a268b91b2d28dbbde
ms.sourcegitcommit: ac7ae29773faaa6b1f7836868565517cd48561b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/25/2020
ms.locfileid: "88827228"
---
# <a name="azure-firewall-logs-and-metrics"></a>Журналы и метрики Брандмауэра Azure

Работу брандмауэра Azure можно отслеживать с помощью журналов брандмауэра. Также журналы действий можно использовать для аудита операций на ресурсах брандмауэра Azure.

Доступ к некоторым из этих журналов можно получить через портал. Журналы можно отправлять в [Azure Monitor журналы](../azure-monitor/insights/azure-networking-analytics.md), хранилище и концентраторы событий, а также анализировать в журналах Azure Monitor или с помощью различных средств, таких как Excel и Power BI.

Метрики являются упрощенными и могут поддерживать сценарии практически в реальном времени, что позволяет использовать их для оповещений и быстрого обнаружения проблем.

## <a name="diagnostic-logs"></a>Журналы диагностики

 Для брандмауэра Azure доступны следующие журналы диагностики.

* **Журнал правил приложений**

   Журнал правил приложений сохраняется в учетной записи хранения, передается в концентраторы событий и (или) отправляются в журналы Azure Monitor, только если вы включили его для каждого брандмауэра Azure. Результаты каждого нового подключения, которое соответствует одному из настроенных правил приложения, находятся в журнале принятого или отклоненного подключения. Данные регистрируются в журнале в формате JSON, как показано в примере ниже.

   ```
   Category: application rule logs.
   Time: log timestamp.
   Properties: currently contains the full message.
   note: this field will be parsed to specific fields in the future, while maintaining backward compatibility with the existing properties field.
   ```

   ```json
   {
    "category": "AzureFirewallApplicationRule",
    "time": "2018-04-16T23:45:04.8295030Z",
    "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupName}/PROVIDERS/MICROSOFT.NETWORK/AZUREFIREWALLS/{resourceName}",
    "operationName": "AzureFirewallApplicationRuleLog",
    "properties": {
        "msg": "HTTPS request from 10.1.0.5:55640 to mydestination.com:443. Action: Allow. Rule Collection: collection1000. Rule: rule1002"
    }
   }
   ```

* **Журнал правил сети**

   Журнал сетевых правил сохраняется в учетной записи хранения, передается в концентраторы событий и (или) отправляются в журналы Azure Monitor, только если вы включили его для каждого брандмауэра Azure. Каждое новое подключение, которое соответствует одному из настроенных правил сети, регистрируется в журнале как принятое или отклоненное подключение. Данные регистрируются в журнале в формате JSON, как показано в примере ниже.

   ```
   Category: network rule logs.
   Time: log timestamp.
   Properties: currently contains the full message.
   note: this field will be parsed to specific fields in the future, while maintaining backward compatibility with the existing properties field.
   ```

   ```json
  {
    "category": "AzureFirewallNetworkRule",
    "time": "2018-06-14T23:44:11.0590400Z",
    "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupName}/PROVIDERS/MICROSOFT.NETWORK/AZUREFIREWALLS/{resourceName}",
    "operationName": "AzureFirewallNetworkRuleLog",
    "properties": {
        "msg": "TCP request from 111.35.136.173:12518 to 13.78.143.217:2323. Action: Deny"
    }
   }

   ```

Существует три способа хранения журналов:

* **Учетная запись хранения** лучше всего подходит для длительного хранения журналов и их просмотра по мере необходимости.
* **Центры событий** — это отличный вариант для интеграции с другими инструментами управления событиями и сведениями о безопасности (SEIM), позволяющий получать оповещения о ваших ресурсах.
* **Журналы Azure Monitor**. журналы Azure Monitor лучше использовать для общего мониторинга приложения в режиме реального времени или для анализа тенденций.

## <a name="activity-logs"></a>Журналы действий

   Записи этого журнала собираются по умолчанию, и их можно просмотреть на портале Azure.

   [Журналы действий Azure](../azure-resource-manager/management/view-activity-logs.md) (ранее известные как операционные журналы и журналы аудита) можно использовать для просмотра всех операций, отправленных в подписку Azure.

## <a name="metrics"></a>Метрики

Метрики в Azure Monitor представляют собой числовые значения, которые описывают некоторый аспект системы в определенный момент времени. Метрики собираются каждую минуту и полезны для оповещений, так как их можно часто выдавать. Предупреждение может быть быстро запущено с относительно простой логикой.

Для брандмауэра Azure доступны следующие метрики.

- Число **попаданий правил приложения** — количество попаданий в правило приложения.

    Единица измерения: количество

- **Число попаданий сетевых правил** — количество попаданий в сетевое правило.

    Единица измерения: количество

- **Обработанные данные** — сумма данных, проходящих через брандмауэр в течение заданного временного периода.

    Единица: байт

- **Пропускная способность** для передачи данных в брандмауэре в секунду.

    Единица: бит в секунду

- **Состояние работоспособности брандмауэра** — указывает работоспособность брандмауэра на основе доступности порта SNAT.

    Единица: процент

   В этой метрике есть два измерения.
  - Состояние. Возможные значения: *Исправен*, *пониженный*, *неработоспособный*.
  - Причина: указывает причину соответствующего состояния брандмауэра. 

     Если порты SNAT используются > 95%, они считаются исчерпанными, а работоспособность — 50% с состоянием "**снижено работоспособность** " и "причина" —**порт SNAT**. Брандмауэр продолжает обрабатывать трафик, и существующие подключения не затрагиваются. Но возможны временные проблемы с установкой новых подключений.

     Если порты SNAT используются < 95%, брандмауэр считается работоспособным, а работоспособность отображается как 100%.

     Если сведения об использовании портов SNAT отсутствуют, отображается состояние работоспособности 0 %. 

- **Использование портов SNAT** — процент портов SNAT, используемых брандмауэром.

    Единица: процент

   Добавив дополнительные общедоступные IP-адреса для брандмауэра, вы сделаете доступными больше портов SNAT и снизите уровень их использования. Кроме того, дополнительные порты SNAT станут доступными при масштабировании брандмауэра по любой другой причине (например, для оптимизации работы ЦП или пропускной способности сети). Таким образом, заданный процент использования портов SNAT может быть отключен без добавления общедоступных IP-адресов, так как служба масштабируется. Можно напрямую управлять количеством доступных общедоступных IP-адресов, чтобы увеличить число доступных портов в брандмауэре. Но вы не можете напрямую управлять масштабированием брандмауэра.


## <a name="next-steps"></a>Дальнейшие действия

- См. дополнительные сведения об [отслеживании метрик и журналов Брандмауэра Azure](tutorial-diagnostics.md).

- Дополнительные сведения о метриках в Azure Monitor см. в разделе [метрики в Azure Monitor](../azure-monitor/platform/data-platform-metrics.md).
