---
title: Общие сведения о журналах и метриках брандмауэра Azure
description: Работу брандмауэра Azure можно отслеживать с помощью журналов брандмауэра. Также журналы действий можно использовать для аудита операций на ресурсах брандмауэра Azure.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: article
ms.date: 01/22/2020
ms.author: victorh
ms.openlocfilehash: 89c6700d5df3bcef1332121c3cf7d8f720fe054c
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "76315037"
---
# <a name="azure-firewall-logs-and-metrics"></a>Журналы и метрики Брандмауэра Azure

Работу брандмауэра Azure можно отслеживать с помощью журналов брандмауэра. Также журналы действий можно использовать для аудита операций на ресурсах брандмауэра Azure.

Доступ к некоторым из этих журналов можно получить через портал. Журналы можно передавать в [Журналы Azure Monitor](../azure-monitor/insights/azure-networking-analytics.md), службу хранилища, Центры событий, а затем анализировать в Журналах Azure Monitor или при помощи различных инструментов, таких как Excel и Power BI.

Метрики являются упрощенными и могут поддерживать сценарии практически в реальном времени, что позволяет использовать их для оповещений и быстрого обнаружения проблем.

## <a name="diagnostic-logs"></a>Журналы диагностики

 Для брандмауэра Azure доступны следующие журналы диагностики.

* **Журнал правил приложений**

   Журнал правил приложений сохраняется в учетной записи хранения, передается в концентраторы событий и (или) отправляются в журналы Azure Monitor, только если вы включили его для каждого брандмауэра Azure. Результаты каждого нового подключения, которое соответствует одному из настроенных правил приложения, находятся в журнале принятого или отклоненного подключения. Данные регистрируются в журнале в формате JSON, как показано в примере ниже.

   ```
   Category: application rule logs.
   Time: log timestamp.
   Properties: currently contains the full message.
   note: this field will be parsed to specific fields in the future, while maintaining backward compatibility with the existing properties field.
   ```

   ```json
   {
    "category": "AzureFirewallApplicationRule",
    "time": "2018-04-16T23:45:04.8295030Z",
    "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupName}/PROVIDERS/MICROSOFT.NETWORK/AZUREFIREWALLS/{resourceName}",
    "operationName": "AzureFirewallApplicationRuleLog",
    "properties": {
        "msg": "HTTPS request from 10.1.0.5:55640 to mydestination.com:443. Action: Allow. Rule Collection: collection1000. Rule: rule1002"
    }
   }
   ```

* **Журнал правил сети**

   Журнал сетевых правил сохраняется в учетной записи хранения, передается в концентраторы событий и (или) отправляются в журналы Azure Monitor, только если вы включили его для каждого брандмауэра Azure. Каждое новое подключение, которое соответствует одному из настроенных правил сети, регистрируется в журнале как принятое или отклоненное подключение. Данные регистрируются в журнале в формате JSON, как показано в примере ниже.

   ```
   Category: network rule logs.
   Time: log timestamp.
   Properties: currently contains the full message.
   note: this field will be parsed to specific fields in the future, while maintaining backward compatibility with the existing properties field.
   ```

   ```json
  {
    "category": "AzureFirewallNetworkRule",
    "time": "2018-06-14T23:44:11.0590400Z",
    "resourceId": "/SUBSCRIPTIONS/{subscriptionId}/RESOURCEGROUPS/{resourceGroupName}/PROVIDERS/MICROSOFT.NETWORK/AZUREFIREWALLS/{resourceName}",
    "operationName": "AzureFirewallNetworkRuleLog",
    "properties": {
        "msg": "TCP request from 111.35.136.173:12518 to 13.78.143.217:2323. Action: Deny"
    }
   }

   ```

Существует три способа хранения журналов:

* **Учетная запись хранения** лучше всего подходит для длительного хранения журналов и их просмотра по мере необходимости.
* **Центры событий** — это отличный вариант для интеграции с другими инструментами управления событиями и сведениями о безопасности (SEIM), позволяющий получать оповещения о ваших ресурсах.
* **Журналы Azure Monitor**. журналы Azure Monitor лучше использовать для общего мониторинга приложения в режиме реального времени или для анализа тенденций.

## <a name="activity-logs"></a>Журналы действий

   Записи этого журнала собираются по умолчанию, и их можно просмотреть на портале Azure.

   [Журналы действий Azure](../azure-resource-manager/management/view-activity-logs.md) (ранее известные как операционные журналы и журналы аудита) можно использовать для просмотра всех операций, отправленных в подписку Azure.

## <a name="metrics"></a>Метрики

Метрики в Azure Monitor представляют собой числовые значения, которые описывают некоторый аспект системы в определенный момент времени. Метрики собираются каждую минуту и полезны для оповещений, так как их можно часто выдавать. Предупреждение может быть быстро запущено с относительно простой логикой.

Для брандмауэра Azure доступны следующие метрики.

- Число **попаданий правил приложения** — количество попаданий в правило приложения.

    Единица измерения: количество

- **Число попаданий сетевых правил** — количество попаданий в сетевое правило.

    Единица измерения: количество

- **Обработанные данные** — объем данных, проходящих через брандмауэр.

    Единица: байт

- **Состояние работоспособности брандмауэра** — указывает работоспособность брандмауэра на основе доступности порта SNAT.

    Единица: процент

   Эта метрика имеет два измерения:
  - Состояние. Возможные значения: *Исправен*, *пониженный*, *неработоспособный*.
  - Причина: указывает причину соответствующего состояния брандмауэра. 

     Если порты SNAT используются > 95%, они считаются исчерпанными, а работоспособность — 50% с состоянием "**снижено работоспособность** " и "причина" —**порт SNAT**. Брандмауэр сохраняет трафик обработки и существующие подключения не затрагиваются. Однако новые подключения могут быть не установлены периодически.

     Если порты SNAT используются < 95%, брандмауэр считается работоспособным, а работоспособность отображается как 100%.

     Если не сообщается об использовании портов SNAT, состояние работоспособности отображается как 0%. 

- **Использование портов SNAT** — процент портов SNAT, используемых брандмауэром.

    Единица: процент

   При добавлении дополнительных общедоступных IP-адресов в брандмауэр становятся доступными дополнительные порты SNAT, уменьшающие использование портов SNAT. Кроме того, когда брандмауэр масштабируется по разным причинам (например, ЦП или пропускная способность), также становятся доступны дополнительные порты SNAT. Таким образом, заданный процент использования портов SNAT может быть отключен без добавления общедоступных IP-адресов, так как служба масштабируется. Можно напрямую управлять количеством доступных общедоступных IP-адресов, чтобы увеличить число доступных портов в брандмауэре. Но вы не можете напрямую управлять масштабированием брандмауэра. В настоящее время порты SNAT добавляются только для первых пяти общедоступных IP-адресов.   


## <a name="next-steps"></a>Дальнейшие шаги

- См. дополнительные сведения об [отслеживании метрик и журналов Брандмауэра Azure](tutorial-diagnostics.md).

- Дополнительные сведения о метриках в Azure Monitor см. в разделе [метрики в Azure Monitor](../azure-monitor/platform/data-platform-metrics.md).
