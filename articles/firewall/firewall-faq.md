---
title: Часто задаваемые вопросы о службе "Брандмауэр Azure"
description: 'Брандмауэр Azure: вопросы и ответы Управляемая облачная служба сетевой безопасности, которая защищает ресурсы виртуальной сети Azure.'
services: firewall
author: vhorne
ms.service: firewall
ms.topic: conceptual
ms.date: 07/23/2020
ms.author: victorh
ms.openlocfilehash: bd849a413d718ba5a25839c50c63ec2ad39be440
ms.sourcegitcommit: 0e8a4671aa3f5a9a54231fea48bcfb432a1e528c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/24/2020
ms.locfileid: "87128103"
---
# <a name="azure-firewall-faq"></a>Часто задаваемые вопросы о службе "Брандмауэр Azure"

## <a name="what-is-azure-firewall"></a>Что такое Брандмауэр Azure?

Брандмауэр Azure — это управляемая облачная служба сетевой безопасности, которая защищает ресурсы виртуальной сети Azure. Брандмауэр разработан как служба с полным отслеживанием состояния со встроенной высокой доступностью и неограниченной облачной масштабируемостью. Вы можете централизованно создавать, применять и регистрировать политики приложений и сетевых подключений в подписках и виртуальных сетях.

## <a name="what-capabilities-are-supported-in-azure-firewall"></a>Характеристики и функции Брандмауэра Azure:

Дополнительные сведения о функциях брандмауэра Azure см. в статье [Функции службы "Брандмауэр Azure"](features.md).

## <a name="what-is-the-typical-deployment-model-for-azure-firewall"></a>Что такое типичная модель развертывания для службы "Брандмауэр Azure"?

Хотя службу "Брандмауэр Azure" можно развернуть в любой виртуальной сети, клиенты обычно развертывают ее в центральной виртуальной сети и устанавливать пиринг к ней в звездообразной модели. Затем вы можете установить маршрут по умолчанию из пиринговых виртуальных сетей, чтобы указать на эту центральную виртуальную сеть брандмауэра. Пиринг глобальной виртуальной сети поддерживается, но не рекомендуется из-за потенциальных проблем с производительностью и задержками в разных регионах. Для достижения максимальной производительности разверните один брандмауэр для каждого региона.

Преимуществом этой модели является возможность централизованно влиять на несколько периферийных виртуальных сетей, находящихся в разных подписках. Она также помогает сократить затраты, так как вам не нужно развертывать брандмауэр в каждой виртуальной сети отдельно. Экономию и соответствующие затраты на пиринг следует сравнивать на основе шаблонов трафика клиента.

## <a name="how-can-i-install-the-azure-firewall"></a>Как установить службу "Брандмауэр Azure"?

Службу "Брандмауэр Azure" можно настроить с помощью портала Azure, PowerShell, REST API или шаблонов. См. [Учебник. по развертыванию и настройке службы "Брандмауэр Azure" с помощью портала Azure](tutorial-firewall-deploy-portal.md).

## <a name="what-are-some-azure-firewall-concepts"></a>Каковы некоторые концепции службы "Брандмауэр Azure"?

Служба "Брандмауэр Azure" поддерживает правила и коллекции правил. Коллекция правил — это набор правил с одинаковым порядком и приоритетом. Коллекции правил выполняются в порядке их важности. Коллекции правил сети имеют более высокий приоритет, чем коллекции правил приложения, и выполнение всех правил прекращается.

Есть три типа коллекций правил:

* *Правила приложений*. Этот тип позволяет настроить полные доменные имена (FQDN), к которым можно получить доступ из подсети.
* *Правила сети*. Этот тип позволяет настраивать правила, содержащие адреса источников, протоколы, порты назначения и адреса назначения.
* *Правила преобразования сетевых адресов*. Этот тип позволяет настраивать правила DNAT, разрешающие входящие подключения к Интернету.

## <a name="does-azure-firewall-support-inbound-traffic-filtering"></a>Поддерживает ли служба "Брандмауэр Azure" фильтрацию входящего трафика?

Брандмауэр Azure поддерживает фильтрацию входящего и исходящего трафика. Реализована защита входящего трафика, обычно использующего протоколы, отличные от HTTP/S. Например, RDP, SSH, FTP. Для лучшей защиты входящего трафика HTTP/S используйте брандмауэр веб-приложения, такой как [брандмауэр веб-приложения Azure (WAF)](../web-application-firewall/overview.md).

## <a name="which-logging-and-analytics-services-are-supported-by-the-azure-firewall"></a>Какие службы ведения журнала и аналитики поддерживаются в службе "Брандмауэр Azure"?

Служба "Брандмауэр Azure" интегрирована с Azure Monitor для возможности просмотра и анализа журналов Брандмауэра. Журналы могут отправляться в Log Analytics, службу хранилища Azure или Центры событий. Их можно анализировать в Log Analytics или с помощью различных инструментов, таких как Excel и Power BI. Дополнительные сведения см. в статье [Учебник. Мониторинг журналов и метрик Брандмауэра Azure](tutorial-diagnostics.md).

## <a name="how-does-azure-firewall-work-differently-from-existing-services-such-as-nvas-in-the-marketplace"></a>Как работа службы "Брандмауэр Azure" отличается от работы имеющихся на рынке служб, например виртуальных сетевых модулей?

Служба "Брандмауэр Azure" — это базовая служба брандмауэра, которая поддерживает определенные сценарии клиентов. Предполагается, что вы будете использовать сторонние виртуальные сетевые модули и Брандмауэр Azure. Их совместное использование является приоритетной задачей.

## <a name="what-is-the-difference-between-application-gateway-waf-and-azure-firewall"></a>Какова разница между WAF шлюза приложений и службой "Брандмауэр Azure"?

Брандмауэр веб-приложения (WAF) — это компонент шлюза приложений, обеспечивающий централизованную входящую защиту веб-приложений от распространенных эксплойтов и уязвимостей. Брандмауэр Azure обеспечивает защиту входящего трафика для протоколов, отличных от HTTP/S (таких как RDP, SSH, FTP), защиту исходящего трафика сетевого уровня для всех портов и протоколов и защиту уровня приложения для исходящего трафика HTTP/S.

## <a name="what-is-the-difference-between-network-security-groups-nsgs-and-azure-firewall"></a>Какова разница между группами безопасности сети (NSG) и службой "Брандмауэр Azure"?

Служба "Брандмауэр Azure" дополняет функции группы безопасности сети. Вместе эти два компонента обеспечивают эшелонированную защиту сети. Группы безопасности сети предоставляют распределенную фильтрацию трафика сетевого уровня для ограничения отправки трафика на ресурсы в виртуальных сетях в каждой подписке. Служба "Брандмауэр Azure" — это полностью автономный, централизованный сетевой брандмауэр как услуга, обеспечивающий защиту на уровне сети и приложений в различных подписках и виртуальных сетях.

## <a name="are-network-security-groups-nsgs-supported-on-the-azurefirewallsubnet"></a>Поддерживаются ли группы безопасности сети в AzureFirewallSubnet?

Брандмауэр Azure — это управляемая служба с несколькими уровнями защиты, которая включает защиту платформы с помощью групп NSG уровня NIC (недоступно для просмотра).  Группы NSG уровня подсети не требуются в AzureFirewallSubnet, поэтому они отключены, чтобы не прерывать работу службы.

## <a name="how-do-i-set-up-azure-firewall-with-my-service-endpoints"></a>Как настроить службу "Брандмауэр Azure" для использования с конечными точками служб?

Для обеспечения безопасного доступа к службам PaaS рекомендуем использовать конечные точки. Вы можете включить конечные точки служб в подсети службы "Брандмауэр Azure" и отключить их в подключенных периферийных виртуальных сетях. Таким образом, вы получаете преимущества обеих функций: безопасность конечной точки службы и централизованное ведение журналов всего трафика.

## <a name="what-is-the-pricing-for-azure-firewall"></a>Каковы цены на службу "Брандмауэр Azure"?

См. статью [Цены на Брандмауэр Azure](https://azure.microsoft.com/pricing/details/azure-firewall/).

## <a name="how-can-i-stop-and-start-azure-firewall"></a>Как запустить и остановить Брандмауэр Azure?

Вы можете использовать методы Azure PowerShell *deallocate* и *allocate*.

Пример:

```azurepowershell
# Stop an existing firewall

$azfw = Get-AzFirewall -Name "FW Name" -ResourceGroupName "RG Name"
$azfw.Deallocate()
Set-AzFirewall -AzureFirewall $azfw
```

```azurepowershell
# Start a firewall

$azfw = Get-AzFirewall -Name "FW Name" -ResourceGroupName "RG Name"
$vnet = Get-AzVirtualNetwork -ResourceGroupName "RG Name" -Name "VNet Name"
$publicip = Get-AzPublicIpAddress -Name "Public IP Name" -ResourceGroupName " RG Name"
$azfw.Allocate($vnet,$publicip)
Set-AzFirewall -AzureFirewall $azfw
```

> [!NOTE]
> Необходимо переместить брандмауэр или общедоступный IP-адрес в исходную группу ресурсов или подписку.

## <a name="what-are-the-known-service-limits"></a>Каковы известные ограничения службы?

Сведения об ограничениях службы "Брандмауэр Azure" см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-resource-manager/management/azure-subscription-service-limits.md#azure-firewall-limits).

## <a name="can-azure-firewall-in-a-hub-virtual-network-forward-and-filter-network-traffic-between-two-spoke-virtual-networks"></a>Может ли Брандмауэр Azure, подключенный к концентратору виртуальной сети, передавать и фильтровать трафик, проходящий между двумя периферийными зонами виртуальной сети?

Да, подключенный к концентратору виртуальной сети Брандмауэр Azure может маршрутизировать и фильтровать трафик, которым обмениваются две периферийные зоны виртуальной сети. Чтобы такой сценарий был работоспособным, пользователю нужно задать маршруты к Брандмауэру Azure в качестве шлюза по умолчанию для подсетей каждой из периферийных виртуальных сетей.

## <a name="can-azure-firewall-forward-and-filter-network-traffic-between-subnets-in-the-same-virtual-network-or-peered-virtual-networks"></a>Может ли Брандмауэр Azure передавать и фильтровать трафик, проходящий между подсетями одной виртуальной сети или пиринговыми виртуальными сетями?

Да. Однако требуется уделить дополнительное внимание настройке определяемого пользователем маршрута для перенаправления трафика между подсетями в одной виртуальной сети. Хотя для определяемого пользователем маршрута достаточно использовать диапазон адресов виртуальной сети в качестве целевого префикса, при этом весь трафик с одного компьютера на другой также передается в одной и той же подсети через экземпляр Брандмауэра Azure. Чтобы избежать этого, добавьте маршрут для подсети в определяемый пользователем маршрут с типом следующего прыжка — **виртуальная сеть**. Управление этими маршрутами может быть весьма трудоемким и подвержено ошибкам. Для сегментации внутренней сети рекомендуется использовать группы безопасности сети, для которых не требуются определяемые пользователем маршруты.

## <a name="does-azure-firewall-outbound-snat-between-private-networks"></a>Использует ли Брандмауэр Azure исходящие данные SNAT для частных сетей?

Брандмауэр Azure не использует SNAT, в то время когда назначенный IP-адрес является IP-адресом частного диапазона согласно [IANA RFC 1918](https://tools.ietf.org/html/rfc1918). Если для частных сетей в организации используются общедоступные IP-адреса, брандмауэр Azure использует SNAT трафика для одного из своих частных IP-адресов AzureFirewallSubnet. В настройках Брандмауэра Azure можно указать, что **не нужно** использовать SNAT для диапазона общедоступный IP-адресов. Дополнительные сведения см. в статье об [использовании SNAT для диапазонов частных IP-адресов в Брандмауэре Azure](snat-private-range.md).

## <a name="is-forced-tunnelingchaining-to-a-network-virtual-appliance-supported"></a>Поддерживается ли принудительное туннелирование или связывание к сетевому виртуальному модулю?

Принудительное туннелирование поддерживается при создании брандмауэра. Вы не можете настроить имеющийся брандмауэр для принудительного туннелирования. Дополнительные сведения см. в статье [Azure Firewall forced tunneling](forced-tunneling.md) (Принудительное туннелирование в Брандмауэре Azure). 

Брандмауэр Azure должен быть напрямую подключен к Интернету. Если сеть AzureFirewallSubnet использует стандартный маршрут к локальной сети через BGP, установите пользовательский маршрут 0.0.0.0/0 и задайте для параметра **NextHopType** значение **Интернет**, чтобы обеспечить прямое подключение к Интернету.

Если для вашей конфигурации требуется принудительное туннелирование в локальной сети и вы можете определить префиксы целевых IP-адресов для назначений в Интернете, эти диапазоны можно настроить с помощью локальной сети в качестве следующего прыжка через определяемый пользователем маршрут в AzureFirewallSubnet. Для определения этих маршрутов можно также использовать BGP.

## <a name="are-there-any-firewall-resource-group-restrictions"></a>Существуют ли какие-либо ограничения для групп ресурсов брандмауэра?

Да. Брандмауэр, виртуальная сеть и общедоступный IP-адрес должны относиться к одной группе ресурсов.

## <a name="when-configuring-dnat-for-inbound-internet-network-traffic-do-i-also-need-to-configure-a-corresponding-network-rule-to-allow-that-traffic"></a>Настраивая DNAT для входящего Интернет-трафика, нужно ли также настроить соответствующее правило сети для разрешения этого трафика?

Нет. Правила NAT позволяют неявно добавить соответствующее правило сети, чтобы разрешить преобразованный трафик. Чтобы переопределить эту реакцию, явно добавьте коллекцию правил сети с запрещающими правилами, которые соответствуют преобразованному трафику. Дополнительные сведения о логике обработки правил Брандмауэра Azure см. в [соответствующей статье](rule-processing.md).

## <a name="how-do-wildcards-work-in-an-application-rule-target-fqdn"></a>Как в целевом FQDN правила приложения работают подстановочные знаки?

Если вы настраиваете * **.contoso.com**, он разрешает *любое значение*.contoso.com, но не contoso.com (вершина домена). Если вы хотите разрешить вершину домена, вы должны явным образом настроить его как целевое FQDN.

## <a name="what-does-provisioning-state-failed-mean"></a>Что означает *Состояние подготовки: сбой*?

Каждый раз, когда применяется изменение конфигурации, Брандмауэр Azure пытается обновить все базовые серверные экземпляры. В редких случаях один из этих серверных экземпляров может не обновиться с использованием новой конфигурации, и процесс обновления остановится со сбоем состояния подготовки. Брандмауэр Azure по-прежнему продолжает работать, но применяемая конфигурация может находиться в несогласованном состоянии, в котором некоторые экземпляры имеют предыдущую конфигурацию, а другие — обновленный набор правил. В таких ситуациях попробуйте обновить конфигурацию еще раз, пока операция не будет выполнена успешно и состояние подготовки брандмауэра не изменится на *Успешно*.

## <a name="how-does-azure-firewall-handle-planned-maintenance-and-unplanned-failures"></a>Как Брандмауэр Azure обрабатывает плановое обслуживание и незапланированные сбои?
Брандмауэр Azure состоит из нескольких узлов серверной части с конфигурацией "активный — активный".  Для любого планового обслуживания у нас есть логика фильтрации подключений для постепенного обновления узлов.  Обновления планируются в нерабочее время для каждого из регионов Azure, чтобы свести к минимуму риск сбоев.  При обработке незапланированных сбоев мы создаем узел для замены неисправного узла.  Подключение к новому узлу обычно восстанавливается в течение 10 секунд с момента сбоя.

## <a name="how-does-connection-draining-work"></a>Как работает фильтрация подключений?

Для любого планового обслуживания логика фильтрации подключений постепенно обновляет узлы серверной части. Брандмауэр Azure ожидает закрытия имеющихся подключений в течение 90 секунд. При необходимости клиенты могут автоматически восстановить подключение с другим узлом серверной части.

## <a name="is-there-a-character-limit-for-a-firewall-name"></a>Существует ли ограничение количества символов в имени брандмауэра?

Да. Для имени брандмауэра существует ограничение в 50 символов.

## <a name="why-does-azure-firewall-need-a-26-subnet-size"></a>Зачем Брандмауэру Azure нужен размер подсети /26?

Брандмауэр Azure должен предоставлять больше экземпляров виртуальных машин по мере их масштабирования. Диапазон IP-адресов /26 гарантирует, что в брандмауэре достаточно IP-адресов, доступных для масштабирования.

## <a name="does-the-firewall-subnet-size-need-to-change-as-the-service-scales"></a>Нужно ли менять размер подсети брандмауэра по мере масштабирования службы?

Нет. Для Брандмауэра Azure не нужна подсеть больше /26.

## <a name="how-can-i-increase-my-firewall-throughput"></a>Как я могу увеличить пропускную способность брандмауэра?

Исходная пропускная способность Брандмауэра Azure составляет 2,5–3 Гбит/с и масштабируется до 30 Гбит/с. Он масштабируется автоматически в зависимости от загрузки ЦП и пропускной способности.

## <a name="how-long-does-it-take-for-azure-firewall-to-scale-out"></a>Сколько времени занимает масштабирование Брандмауэра Azure?

Брандмауэр Azure масштабируется постепенно, когда средняя пропускная способность или загрузка ЦП составляет 60 %. Процесс масштабирования занимает от пяти до семи минут. При тестировании производительности обязательно выполните тестирование по крайней мере с 10 до 15 минут и запустите новые подключения, чтобы воспользоваться преимуществами только что созданных узлов брандмауэра.

## <a name="does-azure-firewall-allow-access-to-active-directory-by-default"></a>Разрешает ли Брандмауэр Azure доступ к Active Directory по умолчанию?

Нет. Брандмауэр Azure блокирует доступ к Active Directory по умолчанию. Чтобы разрешить доступ, настройте тег службы AzureActiveDirectory. Дополнительные сведения см. в статье [Теги службы Брандмауэра Azure](service-tags.md).

## <a name="can-i-exclude-a-fqdn-or-an-ip-address-from-azure-firewall-threat-intelligence-based-filtering"></a>Можно ли исключить FQDN или IP-адрес из фильтрации на основе аналитики угроз Брандмауэра Azure?

Да, для этого вы можете использовать Azure PowerShell:

```azurepowershell
# Add a Threat Intelligence Whitelist to an Existing Azure Firewall

## Create the Whitelist with both FQDN and IPAddresses

$fw = Get-AzFirewall -Name "Name_of_Firewall" -ResourceGroupName "Name_of_ResourceGroup"
$fw.ThreatIntelWhitelist = New-AzFirewallThreatIntelWhitelist `
   -FQDN @("fqdn1", "fqdn2", …) -IpAddress @("ip1", "ip2", …)

## Or Update FQDNs and IpAddresses separately

$fw = Get-AzFirewall -Name $firewallname -ResourceGroupName $RG
$fw.ThreatIntelWhitelist.IpAddresses = @($fw.ThreatIntelWhitelist.IpAddresses + $ipaddresses )
$fw.ThreatIntelWhitelist.fqdns = @($fw.ThreatIntelWhitelist.fqdns + $fqdns)


Set-AzFirewall -AzureFirewall $fw
```

## <a name="why-can-a-tcp-ping-and-similar-tools-successfully-connect-to-a-target-fqdn-even-when-no-rule-on-azure-firewall-allows-that-traffic"></a>Почему проверка связи по протоколу TCP и другие подобные средства могут успешно подключаться к целевому FQDN, даже если в Брандмауэре Azure нет ни одного правила для этого трафика?

Проверка связи по протоколу TCP фактически не подключается к целевому FQDN. Это происходит потому, что прозрачный прокси-сервер Брандмауэра Azure прослушивает исходящий трафик порта 80/443. Проверка связи по протоколу TCP устанавливает подключение с брандмауэром, который затем удаляет пакет и регистрирует подключение. Такое поведение не влияет на безопасность. Однако во избежание путаницы мы изучаем возможные изменения в этом поведении.

## <a name="are-there-limits-for-the-number-of-ip-addresses-supported-by-ip-groups"></a>Существуют ли ограничения на число IP-адресов, поддерживаемых группами IP-адресов?

Да. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-resource-manager/management/azure-subscription-service-limits.md#azure-firewall-limits).

## <a name="can-i-move-an-ip-group-to-another-resource-group"></a>Можно ли переместить группу IP-адресов в другую группу ресурсов?

Нет, в настоящее время перемещение IP-группы в другую группу ресурсов не поддерживается.

## <a name="what-is-the-tcp-idle-timeout-for-azure-firewall"></a>Каково время ожидания простоя TCP для брандмауэра Azure?

Стандартное поведение сетевого брандмауэра заключается в том, чтобы обеспечить активность TCP-подключений и немедленно закрыть их в случае отсутствия активности. Время ожидания простоя TCP брандмауэра Azure составляет четыре минуты. Этот параметр не настраивается. Если период бездействия превышает значение времени ожидания, то нет никакой гарантии, что сеанс TCP или HTTP сохраняется. Распространенной практикой является проверка активности TCP. Такой подход позволяет поддерживать подключения активными в течение более длительного периода. Дополнительные сведения см. в [примерах .NET](https://docs.microsoft.com/dotnet/api/system.net.servicepoint.settcpkeepalive?redirectedfrom=MSDN&view=netcore-3.1#System_Net_ServicePoint_SetTcpKeepAlive_System_Boolean_System_Int32_System_Int32_).

## <a name="can-i-deploy-azure-firewall-without-a-public-ip-address"></a>Можно ли развернуть брандмауэр Azure без общедоступного IP-адреса?

Нет, в настоящее время необходимо развернуть брандмауэр Azure с общедоступным IP-адресом.

## <a name="where-does-azure-firewall-store-customer-data"></a>Где в брандмауэре Azure хранятся данные о клиентах?

Брандмауэр Azure не может переместить или сохранить данные клиента вне региона, в котором он развернут.