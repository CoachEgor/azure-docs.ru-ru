---
title: Настройка правил брандмауэра Azure приложения с помощью полных доменных имен SQL
description: В этой статье вы узнаете, как настроить SQL полные доменные имена в правилах брандмауэра Azure приложения.
services: firewall
author: vhorne
ms.service: firewall
ms.topic: article
ms.date: 7/11/2019
ms.author: victorh
ms.openlocfilehash: e188a5dda8f936ad369aa2b9222bc726bb0d6a5e
ms.sourcegitcommit: 1572b615c8f863be4986c23ea2ff7642b02bc605
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2019
ms.locfileid: "67786583"
---
# <a name="configure-azure-firewall-application-rules-with-sql-fqdns"></a>Настройка правил брандмауэра Azure приложения с помощью полных доменных имен SQL

> [!IMPORTANT]
> Azure правила брандмауэра приложения с помощью полных доменных имен SQL в настоящее время находится в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Теперь можно настроить правила брандмауэра Azure приложения с помощью SQL полные доменные имена. Это позволяет ограничить доступ из виртуальных сетей к только заданные экземпляры SQL server.

С полным SQL вы можете фильтровать трафик:

- Из виртуальных сетей в базу данных Azure SQL или хранилища данных Azure SQL. Пример: Предоставление доступа только для *sql server1.database.windows.net*.
- Из локальных экземпляров управляемых SQL Azure или SQL IaaS, работающих в виртуальных сетях.
- Из периферийной зоне для топологией экземпляров управляемых SQL Azure или SQL IaaS, работающих в виртуальных сетях.

В общедоступной предварительной версии поддерживается полное доменное имя SQL фильтрации в [режим прокси-сервера](https://docs.microsoft.com/azure/sql-database/sql-database-connectivity-architecture#connection-policy) только (порт 1433). Если вы используете SQL в режиме перенаправления по умолчанию, можно отфильтровать доступа пометив его тегом службы SQL как часть [правила сети](overview.md#network-traffic-filtering-rules).
Если вы используете порты не по умолчанию для трафика SQL IaaS, можно настроить эти порты в правилах брандмауэра приложения.

> [!NOTE]
> Правила приложения с помощью полных доменных имен SQL сейчас доступна во всех регионах с помощью Azure CLI, REST и шаблоны. Пользовательском интерфейсе портала постепенно добавляемый регионы и будут доступны во всех регионах после завершения развертывания.

## <a name="configure-using-azure-cli"></a>Настройка с помощью Azure CLI

1. Развертывание [брандмауэр Azure с помощью Azure CLI](deploy-cli.md).
2. При фильтрации трафика для базы данных SQL Azure, хранилище данных SQL или управляемый экземпляр SQL, установите режим подключения SQL **прокси-сервера**. Чтобы узнать, как переключиться в режим подключения SQL, см. в разделе [архитектура подключений к SQL Azure](https://docs.microsoft.com/azure/sql-database/sql-database-connectivity-architecture#change-azure-sql-database-connection-policy). 

   > [!NOTE]
   > SQL *прокси* режим может привести к дополнительные задержки по сравнению с *перенаправления*. Если вы хотите продолжать использовать режим перенаправления, который используется по умолчанию для клиентов, подключающихся в Azure, можно отфильтровать доступа с помощью SQL [тег службы](service-tags.md) в брандмауэре [правила сети](tutorial-firewall-deploy-portal.md#configure-a-network-rule).

3. Настройте правила приложения с полным доменным ИМЕНЕМ SQL, чтобы разрешить доступ к SQL server:

   ```azurecli
   az network firewall application-rule create \
   -g FWRG \
   -f azfirewall \
   -c FWAppRules \
   -n srule \
   --protocols mssql=1433 \
   --source-addresses 10.0.0.0/24 \
   --target-fqdns sql-serv1.database.windows.net
   ```

## <a name="configure-using-the-azure-portal"></a>Настройка с помощью портала Azure
1. Развертывание [брандмауэр Azure с помощью Azure CLI](deploy-cli.md).
2. При фильтрации трафика для базы данных SQL Azure, хранилище данных SQL или управляемый экземпляр SQL, установите режим подключения SQL **прокси-сервера**. Чтобы узнать, как переключиться в режим подключения SQL, см. в разделе [архитектура подключений к SQL Azure](../sql-database/sql-database-connectivity-architecture.md#change-azure-sql-database-connection-policy). 

   > [!NOTE]
   > SQL *прокси* режим может привести к дополнительные задержки по сравнению с *перенаправления*. Если вы хотите продолжать использовать режим перенаправления, который используется по умолчанию для клиентов, подключающихся в Azure, можно отфильтровать доступа с помощью SQL [тег службы](service-tags.md) в брандмауэре [правила сети](tutorial-firewall-deploy-portal.md#configure-a-network-rule).
3. Добавить правило приложения, используя соответствующий протокол, порт и полное доменное имя SQL, а затем выберите **Сохранить**.
   ![правила приложения с полным доменным ИМЕНЕМ SQL](media/sql-fqdn-filtering/application-rule-sql.png)
4. Доступ из виртуальной машины в виртуальной сети, который фильтрует трафик через брандмауэр SQL. 
5. Убедитесь, что [в журналах брандмауэра Azure](log-analytics-samples.md) Показать трафик разрешается.

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения о прокси-сервера SQL и перенаправления режимы, см. в разделе [архитектура подключений к базе данных Azure SQL](../sql-database/sql-database-connectivity-architecture.md).