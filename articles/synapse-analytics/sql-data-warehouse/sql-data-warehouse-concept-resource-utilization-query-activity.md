---
title: Управляемость и мониторинг — активность запросов, использование ресурсов
description: Узнайте, какие возможности доступны для мониторинга Azure синапсе Analytics и управления им. Используйте портал Azure и динамические административные представления (DMV), чтобы понять действия запросов и использование ресурсов хранилища данных.
services: synapse-analytics
author: kevinvngo
manager: craigg-msft
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 04/09/2020
ms.author: kevin
ms.reviewer: jrasnick
ms.custom: azure-synapse
ms.openlocfilehash: d38c0df45da3a751a456846813543a4ce5de98eb
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81416218"
---
# <a name="monitoring-resource-utilization-and-query-activity-in-azure-synapse-analytics"></a>Мониторинг использования ресурсов и действий запросов в Azure синапсе Analytics

Azure синапсе Analytics предоставляет широкие возможности мониторинга в портал Azure для получения ценных сведений о рабочей нагрузке хранилища данных. Портал Azure — рекомендуемый инструмент мониторинга хранилища данных, так как он предоставляет настраиваемые периоды хранения, оповещения, рекомендации, индивидуальные диаграммы и панели мониторинга для метрик и журналов. Портал также позволяет интегрировать другие службы мониторинга Azure, такие как Azure Monitor (журналы) с log Analytics, для обеспечения комплексного мониторинга для не только хранилища данных, но и всей платформы Azure Analytics для интегрированного мониторинга. В этой документации описываются возможности мониторинга, доступные для оптимизации и управления платформой аналитики с помощью аналитики SQL.

## <a name="resource-utilization"></a>Использование ресурсов

В портал Azure для SQL Analytics доступны следующие метрики. Эти метрики отслеживаются с помощью [Azure Monitor](../../azure-monitor/platform/data-collection.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json#metrics).

| Имя метрики             | Описание                                                  | Тип статистической обработки |
| ----------------------- | ------------------------------------------------------------ | ---------------- |
| Процент использования ЦП          | Загрузка ЦП во всех узлах хранилища данных      | AVG, min, Max    |
| Процент операций ввода/вывода данных      | Использование операций ввода-вывода во всех узлах хранилища данных       | AVG, min, Max    |
| Процент памяти       | Использование памяти (SQL Server) на всех узлах хранилища данных | AVG, min, Max   |
| Активные запросы          | Число активных запросов, выполненных в системе             | SUM              |
| Запросы в очереди          | Число запросов в очереди, ожидающих начала выполнения          | SUM              |
| Успешные подключения  | Число успешных подключений к базе данных (имена для входа) | Сумма, количество       |
| Неудачные подключения      | Число неудачных подключений к базе данных (имен входа) | Сумма, количество       |
| Заблокировано брандмауэром     | Количество заблокированных операций входа в хранилище данных     | Сумма, количество       |
| Лимит DWU               | Целевой уровень обслуживания хранилища данных                | AVG, min, Max    |
| DWU percentage          | Максимальная разница между процентом использования ЦП и процентом операций ввода-вывода данных        | AVG, min, Max    |
| DWU used                | Лимит DWU * процент DWU                                   | AVG, min, Max    |
| Cache hit percentage (Процент попаданий в кэш)    | (попадания в кэш / промахи кэша) * 100, где попадания в кэш — это сумма всех попаданий сегментов columnstore в локальный кэш SSD, а промах кэша — это промахи сегментов columnstore в локальный кэш SSD, суммированные по всем узлам | AVG, min, Max    |
| Cache used percentage (Процент использования кэша)   | (кэш использований / кэш емкости) * 100, где кэш использований представляет собой сумму всех байтов в локальном кэше SSD на всех узлах, а кэш емкости — сумму объема локального диска SSD, кэшированную на всех узлах. | AVG, min, Max    |
| Local tempdb percentage (Процент использования локальной базы данных tempdb) | Использование локальной базы данных tempdb на всех вычислительных узлах (значения генерируются каждые пять минут) | AVG, min, Max    |
| Размер хранилища данных (ГБ) | Общий размер базы данных. Сюда входят использованные, зарезервированные и нераспределенные пространства. Нераспределенное пространство хранится для базы данных с целью оптимизации производительности запросов и нагрузки. | SUM |
| Размер аварийного восстановления (ГБ) | Общий размер географической резервной копии, создаваемой каждые 24 часа | SUM |
| Размер хранилища моментальных снимков (ГБ) | Общий размер моментальных снимков, предпринятых для предоставления точек восстановления базы данных. Сюда входят автоматические и определяемые пользователем моментальные снимки. | SUM |

Вопросы, которые следует учитывать при просмотре метрик и настройке оповещений:

- DWU использует только **высокоуровневое представление использования** в пуле SQL и не является исчерпывающим индикатором использования. Чтобы определить, следует ли увеличивать или уменьшать масштаб, учитывайте все факторы, на которые может повлиять DWU, такие как параллелизм, память, tempdb и Адаптивная емкость кэша. Мы рекомендуем [запускать рабочую нагрузку с различными параметрами DWU](sql-data-warehouse-manage-compute-overview.md#finding-the-right-size-of-data-warehouse-units) , чтобы определить, что лучше соответствует вашим бизнес-целям.
- Ошибки и успешные подключения выводятся для определенного хранилища данных, а не для логического сервера.
- Процент использования памяти отражает использование, даже если хранилище данных находится в состоянии простоя. оно не отражает потребление памяти активной рабочей нагрузки. Используйте и отследите эту метрику вместе с другими пользователями (базой данных tempdb, кэшем Gen2), чтобы сделать целостное решение о том, что масштабирование для дополнительной емкости кэша увеличит производительность рабочей нагрузки в соответствии с вашими требованиями.

## <a name="query-activity"></a>Действие запроса

Для программного интерфейса при мониторинге SQL Analytics с помощью T-SQL служба предоставляет набор динамических административных представлений (DMV). Эти представления полезны в том случае, если вы активно устраняете неполадки и выявляете узкие места производительности в рабочей нагрузке.

Чтобы просмотреть список динамических административных представлений, относящихся к синапсе SQL, обратитесь к этой [документации](../sql/reference-tsql-system-views.md#sql-pool-dynamic-management-views-dmvs). 

## <a name="metrics-and-diagnostics-logging"></a>Метрики и журналы диагностики 

И метрики, и журналы можно экспортировать в Azure Monitor, в частности в компоненте [журналов Azure Monitor](../../azure-monitor/log-query/log-query-overview.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json) , и программно получить доступ к ним можно через [запросы журнала](../../azure-monitor/log-query/get-started-portal.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json). Задержка в журнале для аналитики SQL составляет примерно 10-15 минут. Дополнительные сведения о факторах, влияющих на задержку, см. в следующей документации.

## <a name="next-steps"></a>Дальнейшие шаги

В следующем пошаговом руководство описаны распространенные сценарии и варианты использования при мониторинге хранилища данных и управлении им.

- [Мониторинг рабочей нагрузки с помощью динамических административных представлений](sql-data-warehouse-manage-monitor.md)
