---
title: Мониторинг портала управления рабочей нагрузкой
description: Руководство по мониторингу портала управления рабочей нагрузкой в Azure Synapse Analytics.
services: synapse-analytics
author: ronortloff
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 02/04/2020
ms.author: rortloff
ms.reviewer: jrasnick
ms.custom: azure-synapse
ms.openlocfilehash: b1f21a996f7394def4d6b1e8bde9a5ccdf703dbb
ms.sourcegitcommit: d597800237783fc384875123ba47aab5671ceb88
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80632426"
---
# <a name="azure-synapse-analytics--workload-management-portal-monitoring-preview"></a>Аналитика Azure Synapse - Мониторинг портала управления рабочей нагрузкой (Предварительный просмотр)

В этой статье объясняется, как контролировать использование ресурсов [группы рабочих](sql-data-warehouse-workload-isolation.md#workload-groups) и активность запросов.
Подробную информацию о том, как настроить Explorer Azure Metrics Explorer, можно найти статью [Azure Metrics Explorer.](../../azure-monitor/platform/metrics-getting-started.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json)  Подробнее о том, как контролировать потребление ресурсов системы, можно ознакомиться в разделе [«Использование ресурсов ресурсов»](sql-data-warehouse-concept-resource-utilization-query-activity.md#resource-utilization) в документации Azure Synapse Analytics Monitoring.
Для мониторинга управления рабочей нагрузкой предусмотрены две различные категории групп рабочей нагрузки: распределение ресурсов и деятельность по запросу.  Эти показатели могут быть разделены и отфильтрованы рабочей группой.  Метрики могут быть разделены и отфильтрованы на основе, если они определяются системой (группы рабочей нагрузки класса ресурсов) или пользовательскими (созданными пользователем с помощью синтаксиса [CREATE WORKLOAD GROUP).](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)

## <a name="workload-management-metric-definitions"></a>Определения метрик управления рабочей нагрузкой

|Имя метрики                    |Описание  |Тип статистической обработки |
|-------------------------------|-------------|-----------------|
|Эффективный процент ресурсов крышки | *Эффективный процент ресурсов ограничения* является жестким ограничением на процент ресурсов, доступных группе рабочей нагрузки, с учетом *процентного показателя ресурсов,* выделяемого для других групп рабочей нагрузки. Метрика *эффективного ресурсного процента крышки* настроена с использованием `CAP_PERCENTAGE_RESOURCE` параметра в синтаксисе CREATE [WORKLOAD GROUP.](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)  Эффективное значение описано здесь.<br><br>Например, если рабочая `DataLoads` группа `CAP_PERCENTAGE_RESOURCE` создается с 100 евро, а другая рабочая группа создается с процентом эффективного ресурса мин 25%, *процент ресурсов эффективного ограничения* для группы `DataLoads` рабочей нагрузки составляет 75%.<br><br>*Эффективный процент ресурсов крышки* определяет верхнюю границу параллелизма (и, следовательно, потенциальной пропускной выхажий) рабочей группы.  Если требуется дополнительная пропускная информация сверх того, о чем `CAP_PERCENTAGE_RESOURCE`в `MIN_PERCENTAGE_RESOURCE` настоящее время сообщается в метрике *процент эффективного ограничения,* либо увеличьте, уменьшите другие группы рабочей нагрузки, либо увеличьте экземпляр, чтобы добавить больше ресурсов.  Уменьшение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может увеличить параллелизм, но не может увеличить общую пропускную плату.| Мин, Авг, Макс |
|Эффективный мин-процент ресурсов |*Эффективный мин-процент ресурсов* — это минимальный процент зарезервированных ресурсов и изолированных для группы рабочей нагрузки с учетом минимального уровня обслуживания.  Процент эффективного мин-процента настроен с `MIN_PERCENTAGE_RESOURCE` использованием параметра в синтаксисе [CREATE WORKLOAD GROUP.](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)  Эффективное значение описано [здесь](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest#effective-values).<br><br>Используйте тип агрегации суммы, когда эта метрика нефильтрована и не разделена, чтобы контролировать общую изоляцию рабочей нагрузки, настроенную на систему.<br><br>*Эффективный мин-процент ресурсов* определяет нижнюю границу гарантированной параллелизма (и, таким образом, гарантированной пропускной состав) рабочей группы.  Если необходимы дополнительные гарантированные ресурсы сверх того, о чем в настоящее время сообщается в метрике *процент эффективного* мин,увеличьте `MIN_PERCENTAGE_RESOURCE` параметр, настроенный для группы рабочей нагрузки.  Уменьшение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может увеличить параллелизм, но не может увеличить общую пропускную плату. |Мин, Авг, Макс|
|Активные запросы группы рабочей нагрузки  |Этот метрики отчитываются об активных запросах в группе рабочей нагрузки.  Использование этой метрики нефильтрованное и неразделенное отображает все активные запросы, работающие в системе.|SUM         |
|Распределение группы рабочей нагрузки на максимальный процент ресурсов |Эта метрика отображает процентное распределение ресурсов по отношению к *проценту ресурсов эффективного ограничения* на рабочую группу.  Этот показатель обеспечивает эффективное использование рабочей группы.<br><br>Рассмотрим рабочую `DataLoads` группу с *процентом ресурса Эффективного ограничения* 75% и настроенной `REQUEST_MIN_RESOURCE_GRANT_PERCENT` на 25%.  *Распределение рабочей группы по максимальной* `DataLoads` стоимости ресурса отфильтровано бы 33% (25% / 75%) если в этой рабочей группе работает один запрос.<br><br>Используйте эту метрику для определения использования рабочей группы.  Значение, близкое к 100%, указывает на то, что используются все ресурсы, доступные для группы рабочей нагрузки.  Кроме того, *метрика запросов группы рабочей нагрузки* в очереди для той же группы рабочей нагрузки, показывающая значение, превышающее ноль, будет означать, что группа рабочей нагрузки будет использовать дополнительные ресурсы в случае выделения.  И наоборот, если этот показатель стабильно низок, а *активные запросы группы рабочей нагрузки* низки, группа рабочей нагрузки не используется.  Эта ситуация является особенно проблематичной, если *эффективный процент ресурсов крышки* больше нуля, так как это указывает на [недостаточно используемую изоляцию рабочей нагрузки.](#underutilized-workload-isolation)|Мин, Авг, Макс |
|Распределение группрабочей рабочей нагрузки по системным процентам | Эта метрика отображает процентное распределение ресурсов по отношению ко всей системе.<br><br>Рассмотрим рабочую `DataLoads` группу с настроенной `REQUEST_MIN_RESOURCE_GRANT_PERCENT` на 25%.  *Распределение группы рабочей нагрузки по системе процентная* стоимость фильтруется `DataLoads` будет 25% (25% / 100%) если в этой рабочей группе работает один запрос.|Мин, Авг, Макс |
|Тайм-ауты группы рабочей нагрузки |Запросы для группы рабочей нагрузки, которые приурочены.  Тайм-ауты запросов, о которых сообщает эта метрика, — это только после того, как запрос начал выполнять (он не включает время ожидания из-за блокировки или ожидания ресурса).<br><br>Тайм-аут запроса настраивается `QUERY_EXECUTION_TIMEOUT_SEC` с использованием параметра в синтаксисе [CREATE WORKLOAD GROUP.](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)  Увеличение значения может уменьшить количество тайм-аутов запросов.<br><br>Рассмотрите `REQUEST_MIN_RESOURCE_GRANT_PERCENT` возможность увеличения параметра для рабочей группы, чтобы уменьшить количество тайм-аутов и выделить больше ресурсов на запрос.  Обратите внимание, что увеличение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` уменьшает количество параллелизма для рабочей группы. |SUM |
|Запросы группрабочей рабочей нагрузки в очереди | Запросы для группы рабочей нагрузки, которые в настоящее время стоят в очереди, ожидая начала выполнения.  Запросы могут быть очереди, потому что они ждут ресурсов или замков.<br><br>Запросы могут ждать по многим причинам.  Если система перегружена и спрос на параллели больше, чем доступен, запросы будут стоять в очереди.<br><br>Рассмотрите возможность добавления дополнительных `CAP_PERCENTAGE_RESOURCE` ресурсов в группу рабочей нагрузки путем увеличения параметра в заявлении [CREATE WORKLOAD GROUP.](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)  Если `CAP_PERCENTAGE_RESOURCE` показатель *процентного созыва эффективного ограничения ресурсов* превышает метрику, то настроенная изоляция рабочей нагрузки для другой группы рабочей нагрузки влияет на ресурсы, выделенные этой группе рабочей нагрузки.  Рассмотрите `MIN_PERCENTAGE_RESOURCE` возможность снижения других групп рабочей нагрузки или масштабируйте экземпляр, чтобы добавить больше ресурсов. |SUM |

## <a name="monitoring-scenarios-and-actions"></a>Мониторинг сценариев и действий

Ниже приведенряды конфигурации диаграмм, чтобы выделить использование метрикуправления рабочей нагрузкой для устранения неполадок наряду с сопутствующими действиями по решению проблемы.

### <a name="underutilized-workload-isolation"></a>Недоиспользованная изоляция рабочей нагрузки

Рассмотрим следующую конфигурацию рабочей группы и `wgPriority` классификатора, в которой создается названная группа рабочей нагрузки и отображается *TheCEO* `membername` с помощью классификатора рабочей `wcCEOPriority` нагрузки.  Рабочая `wgPriority` группа имеет 25% изоляции рабочей`MIN_PERCENTAGE_RESOURCE` нагрузки, настроенной для нее (No 25).  Каждому запросу, представленному *TheCEO,* дается`REQUEST_MIN_RESOURCE_GRANT_PERCENT` 5% системных ресурсов (No 5).

```sql
CREATE WORKLOAD GROUP wgPriority
WITH ( MIN_PERCENTAGE_RESOURCE = 25
      ,CAP_PERCENTAGE_RESOURCE = 50
      ,REQUEST_MIN_RESOURCE_GRANT_PERCENT = 5);

CREATE WORKLOAD CLASSIFIER wcCEOPriority
WITH ( WORKLOAD_GROUP = 'wgPriority'
      ,MEMBERNAME = 'TheCEO');
```

Приведенная ниже диаграмма настроена следующим образом:<br>
Метрика 1: *Эффективный мин-процент ресурсов* `blue line`(Авг агрегация, )<br>
Метрика 2: *Распределение групп рабочей нагрузки по системным процентам* (агрегация Avg, `purple line`)<br>
Фильтр: «Рабочая группа»`wgPriority`<br>
![underutilized-wg.png](./media/sql-data-warehouse-workload-management-portal-monitor/underutilized-wg.png) Диаграмма показывает, что с 25% изоляции рабочей нагрузки, только 10% используется в среднем.  В этом случае `MIN_PERCENTAGE_RESOURCE` значение параметра может быть снижено до 10 или 15 и позволить другим рабочим нагрузкам в системе потреблять ресурсы.

### <a name="workload-group-bottleneck"></a>Узкое место группы рабочей нагрузки

Рассмотрим следующую конфигурацию рабочей группы и `wgDataAnalyst` классификатора, в которой создается `wcDataAnalyst` названная группа рабочей нагрузки и отображается *DataAnalyst* `membername` с помощью классификатора рабочей нагрузки.  Рабочая `wgDataAnalyst` группа имеет 6% изоляции рабочей`MIN_PERCENTAGE_RESOURCE` нагрузки, настроенной для нее (No 6) и ограничение ресурсов в 9% (No`CAP_PERCENTAGE_RESOURCE` 9).  На каждый запрос, представленный *DataAnalyst,* дается`REQUEST_MIN_RESOURCE_GRANT_PERCENT` 3% системных ресурсов (No 3).

```sql
CREATE WORKLOAD GROUP wgDataAnalyst  
WITH ( MIN_PERCENTAGE_RESOURCE = 6
      ,CAP_PERCENTAGE_RESOURCE = 9
      ,REQUEST_MIN_RESOURCE_GRANT_PERCENT = 3);

CREATE WORKLOAD CLASSIFIER wcDataAnalyst
WITH ( WORKLOAD_GROUP = 'wgDataAnalyst'
      ,MEMBERNAME = 'DataAnalyst');
```

Приведенная ниже диаграмма настроена следующим образом:<br>
Метрика 1: *Эффективный процент ресурсов крышки* (агрегация Avg, `blue line`)<br>
Метрика 2: *Распределение группрабочей рабочей нагрузки по максимальному проценту ресурсов* (агрегация Avg, `purple line`)<br>
Метрика 3: *Запросы группы рабочей нагрузки* в очереди (Агрегация сумм, `turquoise line`)<br>
Фильтр: «Рабочая группа»`wgDataAnalyst`<br>
![бутылка шеи-Wg](./media/sql-data-warehouse-workload-management-portal-monitor/bottle-necked-wg.png) Диаграмма показывает, что с 9% крышкой на ресурсы, рабочая нагрузка группа 90% "используется (от *распределения группы рабочей нагрузки по максимальной метрики процент ресурсов).*  Существует устойчивая очередь запросов, как показано из *группы рабочей нагрузки в очереди запросов метрики.*  В этом случае `CAP_PERCENTAGE_RESOURCE` увеличение значения выше 9% позволит выполнять одновременно больше запросов.  Увеличение `CAP_PERCENTAGE_RESOURCE` предполагает, что имеется достаточно ресурсов, а не изолированы другими группами рабочей нагрузки.  Проверить крышку увеличилось путем проверки *Эффективное ограничение ресурса процент метрики.*  Если больше пропускной результат желательно, `REQUEST_MIN_RESOURCE_GRANT_PERCENT` также рассмотреть вопрос об увеличении до значения больше, чем 3.  Увеличение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может позволить запросы работать быстрее.

## <a name="next-steps"></a>Дальнейшие действия

- [Быстрый запуск: Настройка изоляции рабочей нагрузки с помощью T-S'L](quickstart-configure-workload-isolation-tsql.md)<br>
- [CREATE WORKLOAD GROUP (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-workload-group-transact-sql?view=azure-sqldw-latest)<br>
- [Классификатор CREATE WORKLOAD (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/create-workload-classifier-transact-sql?view=azure-sqldw-latest)<br>
- [Мониторинг использования ресурсов](sql-data-warehouse-concept-resource-utilization-query-activity.md)
