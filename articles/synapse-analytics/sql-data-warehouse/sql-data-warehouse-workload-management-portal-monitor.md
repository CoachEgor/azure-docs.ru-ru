---
title: Мониторинг портала управления рабочей нагрузкой
description: Руководство по мониторингу портала управления рабочей нагрузкой в Azure синапсе Analytics.
services: synapse-analytics
author: ronortloff
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 02/04/2020
ms.author: rortloff
ms.reviewer: jrasnick
ms.custom: azure-synapse
ms.openlocfilehash: a79e6fb2be717b5ecee243b26824039630e1a416
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80744290"
---
# <a name="azure-synapse-analytics--workload-management-portal-monitoring-preview"></a>Azure синапсе Analytics — мониторинг портал управления рабочей нагрузки (Предварительная версия)

В этой статье объясняется, как отслеживать использование ресурсов и действий запросов в [группе рабочей нагрузки](sql-data-warehouse-workload-isolation.md#workload-groups) .
Дополнительные сведения о настройке обозреватель метрик Azure см. в статье [Приступая к работе с azure обозреватель метрик](../../azure-monitor/platform/metrics-getting-started.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json) .  Дополнительные сведения о мониторинге потребления системных ресурсов см. в разделе [использование ресурсов](sql-data-warehouse-concept-resource-utilization-query-activity.md#resource-utilization) в документации по мониторингу Azure синапсе Analytics.
Существует две различные категории метрик группы рабочей нагрузки, предоставляемые для мониторинга управления рабочей нагрузкой: выделение ресурсов и действия запросов.  Эти метрики можно разделить и отфильтровать по группе рабочей нагрузки.  Метрики можно разбивать и фильтровать на основе, если они определены системой (группы рабочей нагрузки класса ресурсов) или определяемые пользователем (созданные пользователем с помощью синтаксиса [CREATE Рабочей группы](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest) ).

## <a name="workload-management-metric-definitions"></a>Определения метрик управления рабочей нагрузкой

|Имя метрики                    |Описание  |Тип статистической обработки |
|-------------------------------|-------------|-----------------|
|Процент эффективных ресурсов ограничения | *Процент эффективных ресурсов ограничения* — это фиксированное ограничение в процентах ресурсов, доступных группе рабочей нагрузки, принимая во внимание *эффективный процент ресурсов* , выделенный для других групп рабочей нагрузки. Метрика *процента эффективного ресурса Cap* настраивается с `CAP_PERCENTAGE_RESOURCE` помощью параметра в синтаксисе [CREATE Рабочей группы](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest) .  Эффективное значение описывается здесь.<br><br>Например, если `DataLoads` группа рабочей нагрузки создается с `CAP_PERCENTAGE_RESOURCE` = 100, а другая группа рабочей нагрузки создается с эффективным процентом минимальных ресурсов, равным 25%, *процент эффективности ресурса ограничения* для группы `DataLoads` рабочей нагрузки составляет 75%.<br><br>*Процент эффективного ресурса ограничения* определяет верхнюю границу параллелизма (и, таким же, возможную пропускную способность), которую может достичь группа рабочей нагрузки.  Если требуется дополнительная пропускная способность, помимо того, что в настоящее время сообщается в *процентах* от `CAP_PERCENTAGE_RESOURCE`метрики процента `MIN_PERCENTAGE_RESOURCE` , увеличьте, уменьшите количество других групп рабочей нагрузки или увеличивайте масштаб экземпляра, чтобы добавить дополнительные ресурсы.  Уменьшение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может увеличить параллелизм, но может не повысить общую пропускную способность.| Min, AVG, Max |
|Эффективный процент минимальных ресурсов |*Эффективный* процент минимальных ресурсов — это минимальный процент ресурсов, зарезервированных и изолированных для группы рабочей нагрузки, учитывающих минимальный уровень обслуживания.  Эффективная процентная метрика ресурса min настраивается `MIN_PERCENTAGE_RESOURCE` с помощью параметра в синтаксисе [CREATE Рабочей группы](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest) .  Эффективное значение описывается [здесь](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest#effective-values).<br><br>Используйте тип статистической обработки Sum, если эта метрика имеет нефильтрованный и неразделенный, чтобы отслеживать общую изоляцию рабочей нагрузки, настроенную в системе.<br><br>*Эффективный процент минимальных ресурсов* определяет нижнюю границу гарантированного параллелизма (и, таким же, гарантированную пропускную способность), которую может достичь группа рабочей нагрузки.  Если требуются дополнительные гарантированные ресурсы, за исключением того, что в настоящее время сообщается о *действующей процентной метрике минимальных ресурсов* , увеличьте `MIN_PERCENTAGE_RESOURCE` параметр, настроенный для группы рабочей нагрузки.  Уменьшение `REQUEST_MIN_RESOURCE_GRANT_PERCENT` может увеличить параллелизм, но может не повысить общую пропускную способность. |Min, AVG, Max|
|Активные запросы группы рабочей нагрузки  |Эта метрика сообщает об активных запросах в группе рабочей нагрузки.  При использовании этой метрики нефильтрованные и неразделенные отображаются все активные запросы, выполняющиеся в системе.|SUM         |
|Распределение группы рабочей нагрузки по максимальному проценту ресурсов |Эта метрика отображает процент выделения ресурсов относительно *эффективного процента ресурсов* на группу рабочей нагрузки.  Эта метрика обеспечивает эффективное использование группы рабочей нагрузки.<br><br>Рассмотрим группу `DataLoads` рабочей нагрузки с *эффективным процентом ресурсов с ограничением* в 75% `REQUEST_MIN_RESOURCE_GRANT_PERCENT` и настройкой 25%.  *Распределение группы рабочей нагрузки по значению процента максимальных ресурсов* , отфильтрованное до `DataLoads` 33% (25%/75%) значение, если в этой группе рабочей нагрузки был запущен один запрос.<br><br>Используйте эту метрику для обнаружения использования группы рабочей нагрузки.  Значение, близкое к 100%, означает, что используются все ресурсы, доступные для группы рабочей нагрузки.  Кроме того, группа рабочей нагрузки *Метрика запросов в очереди* для одной и той же группы рабочей нагрузки, в которой отображается значение больше нуля, указывает, что группа рабочей нагрузки будет использовать дополнительные ресурсы при выделении.  И наоборот, если эта метрика постоянно низкая, а *Активные запросы группы рабочей нагрузки* имеют низкую нагрузку, группа рабочей нагрузки не используется.  Эта ситуация особенно проблематична, если *процент эффективных ресурсов ограничения* больше нуля, так как это указывает на [недостаточную изоляцию рабочей нагрузки](#underutilized-workload-isolation).|Min, AVG, Max |
|Распределение группы рабочей нагрузки по системным процентам | Эта метрика отображает процент выделения ресурсов относительно всей системы.<br><br>Рассмотрим группу `DataLoads` рабочей нагрузки с `REQUEST_MIN_RESOURCE_GRANT_PERCENT` настроенным 25%.  *Распределение группы рабочей нагрузки по значению системного процента,* отфильтрованное до `DataLoads` 25% (25%/100%) значение, если в этой группе рабочей нагрузки был запущен один запрос.|Min, AVG, Max |
|Время ожидания запросов группы рабочей нагрузки |Запросы для группы рабочей нагрузки, время ожидания которых истекло.  Время ожидания запросов, сообщаемое этой метрикой, происходит только после начала выполнения запроса (он не включает время ожидания в связи с блокировкой или ожиданиями ресурсов).<br><br>Время ожидания запроса настраивается `QUERY_EXECUTION_TIMEOUT_SEC` с помощью параметра в синтаксисе [CREATE Рабочей группы](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest) .  Увеличение значения может привести к уменьшению числа истечений времени ожидания запроса.<br><br>Рассмотрите возможность `REQUEST_MIN_RESOURCE_GRANT_PERCENT` увеличения параметра для группы рабочей нагрузки, чтобы сократить время ожидания и выделить больше ресурсов для каждого запроса.  Обратите внимание `REQUEST_MIN_RESOURCE_GRANT_PERCENT` , что увеличение сокращает объем параллелизма для группы рабочей нагрузки. |SUM |
|Запросы в очереди группы рабочей нагрузки | Запросы для группы рабочей нагрузки, которые в данный момент ожидают запуска.  Запросы могут быть поставлены в очередь, так как они ожидают ресурсы или блокировки.<br><br>Запросы могут ожидать многочисленных причин.  Если система перегружена и требование параллелизма больше, чем доступно, запросы будут помещаться в очередь.<br><br>Рассмотрите возможность добавления ресурсов в группу рабочей нагрузки путем увеличения `CAP_PERCENTAGE_RESOURCE` параметра в инструкции [CREATE Рабочей группы](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest) .  Если `CAP_PERCENTAGE_RESOURCE` значение больше, чем метрика *процента эффективного ресурса Cap* , настроенная изоляция рабочей нагрузки для другой группы рабочей нагрузки влияет на ресурсы, выделенные этой группе рабочей нагрузки.  Рассмотрите возможность `MIN_PERCENTAGE_RESOURCE` снижения количества других групп рабочей нагрузки или увеличения масштаба экземпляра для добавления дополнительных ресурсов. |SUM |

## <a name="monitoring-scenarios-and-actions"></a>Сценарии и действия мониторинга

Ниже приведен ряд конфигураций диаграмм для выделения сведений об использовании метрик управления рабочей нагрузкой для устранения неполадок, а также связанные действия для решения этой проблемы.

### <a name="underutilized-workload-isolation"></a>Недостаточно загруженная изоляция рабочей нагрузки

Рассмотрим следующую группу рабочей нагрузки и конфигурацию классификатора, где создается группа рабочей `wgPriority` нагрузки с именем и *сецео* `membername` , с помощью классификатора `wcCEOPriority` рабочей нагрузки.  Для `wgPriority` группы рабочей нагрузки настроена конфигурация нагрузки 25% (`MIN_PERCENTAGE_RESOURCE` = 25).  Каждый запрос, отправленный *сецео* , получает 5% системных ресурсов (`REQUEST_MIN_RESOURCE_GRANT_PERCENT` = 5).

```sql
CREATE WORKLOAD GROUP wgPriority
WITH ( MIN_PERCENTAGE_RESOURCE = 25
      ,CAP_PERCENTAGE_RESOURCE = 50
      ,REQUEST_MIN_RESOURCE_GRANT_PERCENT = 5);

CREATE WORKLOAD CLASSIFIER wcCEOPriority
WITH ( WORKLOAD_GROUP = 'wgPriority'
      ,MEMBERNAME = 'TheCEO');
```

Приведенная ниже диаграмма настроена следующим образом.<br>
Метрика 1: *процент эффективных минимальных ресурсов* (среднее `blue line`агрегирование,)<br>
Метрика 2: *распределение группы рабочей нагрузки по системным процентам* (СР. агрегирование, `purple line`)<br>
Фильтр: [группа рабочей нагрузки] =`wgPriority`<br>
![ундерутилизед-ВГ. png](./media/sql-data-warehouse-workload-management-portal-monitor/underutilized-wg.png) на диаграмме показано, что в среднем используется только 10% изоляции рабочей нагрузки.  В этом случае значение `MIN_PERCENTAGE_RESOURCE` параметра можно уменьшить от 10 до 15 и разрешить другим рабочим нагрузкам в системе использовать ресурсы.

### <a name="workload-group-bottleneck"></a>Узкие места в группе рабочей нагрузки

Рассмотрим следующую группу рабочей нагрузки и конфигурацию классификатора, в которой создается группа `wgDataAnalyst` рабочей нагрузки с именем и с помощью классификатора `wcDataAnalyst` рабочей нагрузки сопоставляется *аналитика* `membername` .  Для `wgDataAnalyst` группы рабочей нагрузки настроена 6% изоляции рабочей нагрузки (`MIN_PERCENTAGE_RESOURCE` = 6), а ограничение ресурса — 9% (`CAP_PERCENTAGE_RESOURCE` = 9).  Каждый запрос, отправленный *аналитиком* данных, получает 3% системных ресурсов (`REQUEST_MIN_RESOURCE_GRANT_PERCENT` = 3).

```sql
CREATE WORKLOAD GROUP wgDataAnalyst  
WITH ( MIN_PERCENTAGE_RESOURCE = 6
      ,CAP_PERCENTAGE_RESOURCE = 9
      ,REQUEST_MIN_RESOURCE_GRANT_PERCENT = 3);

CREATE WORKLOAD CLASSIFIER wcDataAnalyst
WITH ( WORKLOAD_GROUP = 'wgDataAnalyst'
      ,MEMBERNAME = 'DataAnalyst');
```

Приведенная ниже диаграмма настроена следующим образом.<br>
Метрика 1: *процент эффективных ресурсов ограничения* (среднее агрегирование, `blue line`)<br>
Метрика 2: *распределение группы рабочей нагрузки по максимальному проценту ресурсов* (среднее агрегирование, `purple line`)<br>
Метрика 3. *Группа рабочей нагрузки запросы в очереди* (агрегирование сумм, `turquoise line`)<br>
Фильтр: [группа рабочей нагрузки] =`wgDataAnalyst`<br>
![«бутылки-WG](./media/sql-data-warehouse-workload-management-portal-monitor/bottle-necked-wg.png) ». на диаграмме показано, что при наличии 9% ограничения на ресурсы группа рабочей нагрузки имеет 90% + использование (из *группы рабочей нагрузки с распределением по максимальной процентной метрике ресурсов*).  Существует устойчивая очередь запросов, как показано в *группе рабочей нагрузки метрика запросов в очереди*.  В этом случае увеличение `CAP_PERCENTAGE_RESOURCE` до значения, превышающего 9%, позволит выполнять больше запросов одновременно.  Чтобы увеличить `CAP_PERCENTAGE_RESOURCE` уровень, предполагается, что доступно достаточно ресурсов и они не изолированы другими группами рабочей нагрузки.  Убедитесь, что ограничение увеличено, проверив *метрику процента эффективности ресурса ограничения*.  Если требуется дополнительная пропускная способность, следует также `REQUEST_MIN_RESOURCE_GRANT_PERCENT` увеличить значение до значения, превышающего 3.  `REQUEST_MIN_RESOURCE_GRANT_PERCENT` Увеличение позволяет ускорить выполнение запросов.

## <a name="next-steps"></a>Дальнейшие шаги

- [Краткое руководство. Настройка изоляции рабочих нагрузок с помощью T-SQL](quickstart-configure-workload-isolation-tsql.md)<br>
- [CREATE WORKLOAD GROUP (Transact-SQL)](/sql/t-sql/statements/create-workload-group-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest)<br>
- [Классификатор CREATE WORKLOAD (Transact-SQL)](/sql/t-sql/statements/create-workload-classifier-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest)<br>
- [Наблюдение за использованием ресурсов](sql-data-warehouse-concept-resource-utilization-query-activity.md)
