---
title: Использование хранимых процедур
description: Советы по разработке решений путем внедрения сохраненных процедур в пуле Synapse S'L.
services: synapse-analytics
author: XiaoyuMSFT
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 04/02/2019
ms.author: xiaoyul
ms.reviewer: igorstan
ms.openlocfilehash: 3ffdf7a66c2562b43fc2ed02bb088ab1095118fb
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81416155"
---
# <a name="using-stored-procedures-in-synapse-sql-pool"></a>Использование сохраненных процедур в пуле Synapse S'L

В этой статье содержатся советы по разработке решений для пула S'L путем внедрения сохраненных процедур.

## <a name="what-to-expect"></a>Основные принципы

Бассейн s'L поддерживает многие функции T-S'L, которые используются в сервере S'L. Что более важно, в нем есть специальные функции горизонтального масштабирования, с помощью которых можно максимально увеличить производительность решения.

Кроме того, чтобы помочь вам сохранить масштаб и производительность пула S'L, есть дополнительные функции и функциональные возможности, которые имеют поведенческие различия.

## <a name="introducing-stored-procedures"></a>Введение в хранимые процедуры

Сохраненные процедуры — это отличный способ инкапсулировать ваш код S'L, который хранится рядом с данными пула S'L. Сохраненные процедуры также помогают разработчикам модульизировать свои решения, инкапсулируя код в управляемые единицы, тем самым облегчая большую возможность повторного использования кода. Каждая хранимая процедура может также принимать параметры, что делает их еще более гибкими.

Пул саЗЛ обеспечивает упрощенную и упорядоченную реализацию процедуры хранения. Самое большое отличие по сравнению с сервером S'L является то, что сохраненная процедура не является предварительно скомпилированным кодом.

Как правило, для складов данных время компиляции невелико по сравнению со временем, заданным для выполнения запросов в отношении больших объемов данных. Гораздо важнее обеспечить правильную оптимизацию кода процедуры хранения для больших запросов.

> [!TIP]
> Цель — сэкономить часы, минуты и секунды, но не миллисекунды. Таким образом, полезно думать о сохраненных процедурах в качестве контейнеров для логики S'L.

При выполнении сохраненной процедуры пул s'L разбирается, переводится и оптимизируется в момент выполнения. Во время этого процесса каждая инструкция преобразуется в распределенные запросы. Код SQL, который выполняется с данными, отличается от отправляемого запроса.

## <a name="nesting-stored-procedures"></a>Вложенные хранимые процедуры

Когда хранимые процедуры вызывают другие хранимые процедуры или выполняют динамический код SQL, то внутреннюю хранимую процедуру или код вызова называют вложенными.

Бассейн S'L поддерживает максимум восемь уровней гнездования. В отличие от этого, уровень гнезда в сервере S'L составляет 32.

Вызов хранимой процедуры верхнего уровня считается 1 уровнем вложенности.

```sql
EXEC prc_nesting
```

Если хранимая процедура также выполняет еще один вызов EXEC, уровень вложенности увеличится до 2.

```sql
CREATE PROCEDURE prc_nesting
AS
EXEC prc_nesting_2  -- This call is nest level 2
GO
EXEC prc_nesting
```

Если вторая процедура затем выполняет какой-либо динамический SQL-запрос, уровень вложенности увеличится до 3.

```sql
CREATE PROCEDURE prc_nesting_2
AS
EXEC sp_executesql 'SELECT 'another nest level'  -- This call is nest level 2
GO
EXEC prc_nesting
```

В настоящее время пул S'L не [поддерживается@NESTLEVEL](/sql/t-sql/functions/nestlevel-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest). Таким образом, необходимо отслеживать уровень гнезда. Маловероятно, что вы превысите предел уровня восьми гнезд. Но, если вы делаете, вам нужно переработать код, чтобы соответствовать уровням вложенирования в пределах этого предела.

## <a name="insertexecute"></a>INSERT..EXECUTE

Пулс S'L не позволяет потреблять набор результатов сохраненной процедуры с выпиской INSERT. Существует, однако, альтернативный подход, который вы можете использовать. Например, см. статью о [временных таблицах](sql-data-warehouse-tables-temporary.md).

## <a name="limitations"></a>Ограничения

Существуют некоторые аспекты процедур хранения «Трансакт-СЗЛ», которые не реализованы в пуле S'L, которые следующие:

* временные хранимые процедуры;
* нумерованные хранимые процедуры;
* расширенные хранимые процедуры;
* хранимые процедуры CLR;
* возможность шифрования;
* возможность репликации;
* параметры с табличным значением;
* параметры только для чтения;
* параметры по умолчанию;
* контекст выполнения;
* инструкция Return.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные советы по разработке см. в статье [Проектные решения и методики программирования для хранилища данных SQL](sql-data-warehouse-overview-develop.md).
