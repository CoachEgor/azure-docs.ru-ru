---
title: Управление ресурсами вычислений для пула SQL
description: Сведения о возможностях масштабирования производительности в пуле SQL Azure синапсе Analytics. Вы можете выполнять горизонтальное масштабирование, настраивая количество единиц использования хранилища данных (DWU), или снижать затраты, приостанавливая работу хранилища данных.
services: synapse-analytics
author: ronortloff
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: sql-dw
ms.date: 11/12/2019
ms.author: rortloff
ms.reviewer: igorstan
ms.custom: seo-lt-2019, azure-synapse
ms.openlocfilehash: 90815d52e6884efe6cff9a7860c093b4b5c1bc94
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "85204547"
---
# <a name="manage-compute-in-azure-synapse-analytics-data-warehouse"></a>Управление расчетами в хранилище данных аналитики Azure синапсе

Сведения об управлении ресурсами вычислений в пуле SQL Azure синапсе Analytics. Снижение затрат путем приостановки пула SQL или масштабирования хранилища данных в соответствии с требованиями к производительности.

## <a name="what-is-compute-management"></a>Что такое управление вычислительными ресурсами?

Архитектура хранилища данных разделяет хранилище и вычисление, позволяя независимо масштабировать их. В результате можно масштабировать вычислительные ресурсы в соответствии с потребностями в производительности независимо от хранилища данных. Кроме того, можно приостанавливать и возобновлять работу вычислительных ресурсов. При такой архитектуре [выставление счетов](https://azure.microsoft.com/pricing/details/sql-data-warehouse/) за вычислительные ресурсы и ресурсы хранилища осуществляется отдельно. Если не нужно использовать хранилище данных в течение какого-то времени, то можно сократить затраты, приостановив вычислительные ресурсы.

## <a name="scaling-compute"></a>Масштабирование вычислительных ресурсов

Масштабное вычисление можно масштабировать, изменив параметр [единиц хранения данных](what-is-a-data-warehouse-unit-dwu-cdwu.md) для пула SQL. Добавление единиц использования хранилища данных позволяет линейно повышать производительность загрузки и запросов.

Инструкции по горизонтальному масштабированию приведены в кратких руководствах для [портала Azure](quickstart-scale-compute-portal.md), [PowerShell](quickstart-scale-compute-powershell.md) и [T-SQL](quickstart-scale-compute-tsql.md). Можно также выполнять операции горизонтального масштабирования с помощью [REST API](sql-data-warehouse-manage-compute-rest-api.md#scale-compute).

Для выполнения операции масштабирования пул SQL сначала прерывает все входящие запросы, а затем выполняет откат транзакций для обеспечения стабильного состояния. Масштабирование происходит только после завершения отката транзакций. Для операции масштабирования система отсоединяет уровень хранилища от ресурсов вычислений, добавляет к нему кластерные узлы, а затем повторно присоединяет уровень хранилища к слою вычислений. Каждый пул SQL хранится как дистрибутивы 60, которые равномерно распределяются по узлам вычислений. Добавление дополнительных вычислений увеличивает мощность вычислений. По мере увеличения количества единиц вычислений количество распределений на один и тот же узел уменьшается, что обеспечивает дополнительную мощность вычислений для запросов. Аналогичным образом, уменьшение количества единиц использования хранилища данных сокращает число узлов вычислений, что сокращает количество ресурсов вычислений для запросов.

В следующей таблице показано, как изменяется количество распределений на вычислительный узел при изменении количества единиц использования хранилища данных.  DW30000c предоставляет 60 Вычисленийных узлов и достигает значительно большей производительности запросов, чем DW100c.

| Единицы использования хранилища данных  | \# число узлов вычислений | \# распределений на узел |
| -------- | ---------------- | -------------------------- |
| DW100c   | 1                | 60                         |
| DW200c   | 1                | 60                         |
| DW300c   | 1                | 60                         |
| DW400c   | 1                | 60                         |
| DW500c   | 1                | 60                         |
| DW1000c  | 2                | 30                         |
| DW1500c  | 3                | 20                         |
| DW2000c  | 4                | 15                         |
| DW2500c  | 5                | 12                         |
| DW3000c  | 6                | 10                         |
| DW5000c  | 10               | 6                          |
| DW6000c  | 12               | 5                          |
| DW7500c  | 15               | 4                          |
| DW10000c | 20               | 3                          |
| DW15000c | 30               | 2                          |
| DW30000c | 60               | 1                          |

## <a name="finding-the-right-size-of-data-warehouse-units"></a>Поиск правильного размера единиц использования хранилища данных

Чтобы ознакомиться с преимуществами производительности, обеспечиваемыми горизонтальным масштабированием, особенно для более крупных единиц использования хранилища данных, следует использовать по крайней мере набор данных размером в 1 ТБ. Чтобы найти оптимальное количество единиц использования хранилища данных для пула SQL, попробуйте увеличить масштаб. Выполните несколько запросов с различным количеством единиц использования хранилища данных после загрузки данных. Так как масштабирование выполняется достаточно быстро, попробуйте использовать разные уровни производительности не дольше одного часа.

Рекомендации по поиску оптимального количества единиц использования хранилища данных:

- Для пула SQL в среде разработки Начните с выбора меньшего количества единиц использования хранилища данных.  Хорошей отправной точкой является DW400c или DW200c.
- Отслеживайте производительность приложения, сравнивая ее с количеством выбранных единиц использования хранилища данных.
- Исходя из того, что масштаб изменяется линейно, определите, как необходимо увеличить или уменьшить число единиц использования хранилища данных.
- Вносите изменения, пока не достигнете уровня производительности, который оптимально отвечает вашим бизнес-требованиям.

## <a name="when-to-scale-out"></a>Когда требуется масштабирование

Горизонтальное масштабирование единиц использования хранилища данных влияет на следующие аспекты производительности:

- Линейное увеличение производительности системы для операций сканирования, агрегирования и инструкций CTAS.
- Увеличение количества модулей чтения и записи при загрузке данных.
- Максимальное количество параллельных запросов и слотов выдачи.

Рекомендации по тому, когда следует использовать горизонтальное масштабирование единиц использования хранилища данных:

- Прежде чем выполнять ресурсоемкую загрузку данных или их преобразование, выполните горизонтальное масштабирование, чтобы быстрее получать доступ к данным.
- Во время рабочих часов наибольшей нагрузки выполните горизонтальное масштабирование, чтобы обработать большое количество одновременных запросов.

## <a name="what-if-scaling-out-does-not-improve-performance"></a>Что делать, если горизонтальное масштабирование не повышает производительность?

Добавление единиц использования хранилища данных усиливает параллелизм. Если работа равномерно разделена между вычислительными узлами, усиление параллелизма повышает производительность запросов. Если горизонтальное масштабирование не изменяет производительность, этому может быть несколько причин. Возможно, данные неравномерно разделены между распределениями или запросы вызывают много операций перемещения данных. Чтобы изучить проблемы производительности запросов, ознакомьтесь с разделом [Устранение неполадок хранилища данных SQL Azure](sql-data-warehouse-troubleshoot.md#performance).

## <a name="pausing-and-resuming-compute"></a>Приостановка и возобновление вычислительных ресурсов

Приостановка вычислительных ресурсов приводит к отключению уровня хранилища от вычислительных узлов. Ресурсы вычислений освобождаются от вашей учетной записи. Пока вычислительные ресурсы приостановлены, плата за их использование не взимается. При возобновлении работы вычислительных ресурсов хранилище подключается к вычислительным узлам и начинает взиматься плата за вычисления.
При приостановке пула SQL:

- Вычислительные ресурсы и ресурсы памяти возвращаются в пул доступных ресурсов в центре данных.
- В течение периода приостановки затраты на единицы использования хранилища данных отсутствуют.
- Хранилище данных не затрагивается, и ваши данные остаются без изменений.
- Все операции, выполняемые или поставленные в очередь, отменены.

При возобновлении пула SQL:

- Пул SQL получает ресурсы вычислений и памяти для параметра "единицы хранилища данных".
- Возобновляется оплата единиц использования хранилища данных.
- Данные становятся доступными.
- После подключения пула SQL к сети необходимо перезапустить запросы рабочей нагрузки.

Если вы всегда хотите, чтобы пул SQL был доступен, рассмотрите возможность его масштабирования до наименьшего размера, а не приостановки.

Инструкции по приостановке и возобновлению работы приведены в кратких руководствах для [портала Azure](pause-and-resume-compute-portal.md) и [PowerShell](pause-and-resume-compute-powershell.md). Можно также использовать [REST API приостановки](sql-data-warehouse-manage-compute-rest-api.md#pause-compute) или [REST API возобновления](sql-data-warehouse-manage-compute-rest-api.md#resume-compute).

## <a name="drain-transactions-before-pausing-or-scaling"></a>Очистка транзакций перед приостановкой использования и масштабированием вычислительных ресурсов

Мы рекомендуем дождаться завершения текущих транзакций, прежде чем начать приостановку или масштабирование.

При приостановке или масштабировании пула SQL в фоновом режиме запросы отменяются при инициации запроса на приостановку или масштабирование. Отмена типичного запроса SELECT выполняется очень быстро и почти не влияет на время, необходимое для приостановки работы или масштабирования экземпляра.  Однако остановка транзакционных запросов, с помощью которых изменяются данные или их структура, занимает длительное время. **Транзакционные запросы по определению должны полностью завершиться или выполнить откат изменений.**  На откат изменений, выполненных с помощью транзакционных запросов, требуется столько же времени (или даже больше), как и на выполнение самих изменений. Например, если отменить запрос на удаление строк, который уже выполняется в течение часа, системе понадобится столько же времени, чтобы вставить удаленные строки обратно. Процесс приостановки работы и масштабирования ресурсов во время выполнения транзакционных запросов займет более длительное время, так как он не начнется, пока не будет выполнен откат изменений.

Дополнительные сведения см. в статьях [Транзакции в хранилище данных SQL](sql-data-warehouse-develop-transactions.md) и [Оптимизация транзакций для хранилища данных SQL](sql-data-warehouse-develop-best-practices-transactions.md).

## <a name="automating-compute-management"></a>Автоматизация управления вычислительными ресурсами

Автоматизация операций управления вычислительным ресурсами описывается в разделе [Использование службы "Функции Azure" для автоматизации управления уровнями вычислений в хранилище данных SQL](manage-compute-with-azure-functions.md).

Каждая операция горизонтального масштабирования, приостановки или возобновления работы может длиться несколько минут. Если операции масштабирования, приостановки и возобновления выполняются автоматически, мы рекомендуем реализовать логику, позволяющую приступать к выполнению другого действия только после завершения определенных операций. Проверка состояния пула SQL с помощью различных конечных точек позволяет правильно реализовать автоматизацию таких операций.

Чтобы проверить состояние пула SQL, ознакомьтесь с кратким руководством по [PowerShell](quickstart-scale-compute-powershell.md#check-data-warehouse-state) или [T-SQL](quickstart-scale-compute-tsql.md#check-data-warehouse-state) . Состояние пула SQL также можно проверить с помощью [REST API](sql-data-warehouse-manage-compute-rest-api.md#check-database-state).

## <a name="permissions"></a>Разрешения

Для масштабирования пула SQL требуются разрешения, описанные в разделе [ALTER DATABASE](/sql/t-sql/statements/alter-database-azure-sql-data-warehouse?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest).  Чтобы приостановить и возобновить работу, нужны разрешения [Участник баз данных SQL](../../role-based-access-control/built-in-roles.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json#sql-db-contributor), в частности Microsoft.Sql/servers/databases/action.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об управлении ресурсами вычислений см. в разделе Руководство по управлению [вычислом](manage-compute-with-azure-functions.md) других ресурсов вычислений для отдельных запросов. Дополнительные сведения см. в разделе [Классы ресурсов для управления рабочими нагрузками](resource-classes-for-workload-management.md).
