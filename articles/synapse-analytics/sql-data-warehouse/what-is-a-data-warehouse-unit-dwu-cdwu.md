---
title: Единицы хранилища данных (DWUs) в Azure Synapse Analytics (ранее S'L DW)
description: Рекомендации по выбору идеального количества единиц хранилища данных (DWUs) для оптимизации цен и производительности, а также как изменить количество единиц.
services: synapse-analytics
author: mlee3gsd
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 11/22/2019
ms.author: martinle
ms.reviewer: igorstan
ms.custom: seo-lt-2019
ms.openlocfilehash: 62cf1f369cbde372e82e7c3ffe26473f09668bc7
ms.sourcegitcommit: bd5fee5c56f2cbe74aa8569a1a5bce12a3b3efa6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2020
ms.locfileid: "80742544"
---
# <a name="data-warehouse-units-dwus"></a>Единицы хранилища данных (DWUs)

Рекомендации по выбору идеального количества единиц хранилища данных (DWUs) для оптимизации цен и производительности, а также как изменить количество единиц.

## <a name="what-are-data-warehouse-units"></a>Что такое единицы хранилища данных

[Бассейн Synapse S'L](sql-data-warehouse-overview-what-is.md#synapse-sql-pool-in-azure-synapse) представляет собой набор аналитических ресурсов, которые в настоящее время подготовлены. Аналитические ресурсы определяются как сочетание процессора, памяти и иомы.

Эти три ресурса объединяются в единицы вычислительной шкалы, называемые единицами хранилища данных (DWUs). Единица DWU представляет собой абстрактный, нормализованный объем вычислительных ресурсов и производительности.

Изменение уровня обслуживания изменяет количество DWUs, доступных для системы, что, в свою очередь, корректирует производительность и стоимость вашей системы.

Для повышения производительности можно увеличить количество единиц хранилища данных. Для снижения производительности сократите единицы хранилища данных. Использование хранилища и операции вычисления оплачиваются отдельно, независимо от изменений количества единиц использования хранилища данных.

Производительность для единиц хранилища данных основана на следующих метриках рабочей нагрузки:

- Как быстро стандартный запрос пула S'L может сканировать большое количество строк, а затем выполнять сложную агрегацию. Это требует интенсивного использования операций ввода-вывода и ресурсов ЦП.
- Как быстро пул S'L может глотать данные из Azure Storage Blobs или Azure Data Lake. Это сетевая операция, которая требует интенсивного использования ресурсов ЦП.
- Как быстро [`CREATE TABLE AS SELECT`](/sql/t-sql/statements/create-table-as-select-azure-sql-data-warehouse) команда T-S'L может скопировать таблицу. Эта операция предусматривает чтение данных из хранилища, их распространение в различные узлы устройства и повторную запись в хранилище. Эта операция выполняется ЦП и требует интенсивного использования операций ввода-вывода и сетевых ресурсов.

При увеличении единиц DWU происходит следующее:

- линейное изменение производительности системы для операций сканирования, агрегирования и инструкций CTAS;
- увеличение количества модулей чтения и записи при загрузке с помощью PolyBase;
- увеличение максимального количества параллельных запросов и слотов выдачи.

## <a name="service-level-objective"></a>Целевой уровень обслуживания

Цель уровня обслуживания (SLO) — это параметр масштабируемости, определяющий стоимость и уровень производительности пула S'L. Уровни обслуживания для пула Gen2 S'L измеряются в единицах хранилища данных (DWU), например DW2000c.

В t-S'L настройки SERVICE_OBJECTIVE определяют уровень обслуживания вашего пула S'L.

```sql
CREATE DATABASE mySQLDW
( EDITION = 'Datawarehouse'
 ,SERVICE_OBJECTIVE = 'DW1000c'
)
;
```

## <a name="capacity-limits"></a>Ограничения емкости

Для каждого сервера SQL (например, myserver.database.windows.net) предусмотрена квота [DTU (единицы передачи данных)](../../sql-database/sql-database-service-tiers-dtu.md?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json), которая позволяет применить только определенное число единиц использования хранилища данных. Дополнительные сведения см. в статье об [ограничениях емкости для управления рабочей нагрузкой](sql-data-warehouse-service-capacity-limits.md#workload-management).

## <a name="how-many-data-warehouse-units-do-i-need"></a>Сколько единиц хранилища данных мне нужно

Оптимальное количество единиц использования хранилища данных существенно зависит от рабочей нагрузки и объема данных, загруженных в систему.

Шаги для поиска оптимального количества единиц DWU рабочей нагрузки:

1. Начните, выбрав меньшее число DWU.
2. Отслеживайте производительность приложения по мере загрузки тестовых данных в систему, сравнивая ее с количеством выбранных DWU.
3. Определите любые дополнительные требования для периодов пиковой активности. Рабочие нагрузки, которые показывают значительные пики и впадины в активности, возможно, потребуется часто масштабировать.

Пул сс-L — это масштабная система, которая может предоставлять огромные объемы вычислений и запросов в больших количествах данных.

Чтобы ознакомиться с реальными возможностями масштабирования, особенно при использовании большого количества DWU, мы рекомендуем во время масштабирования выполнить масштабирование набора данных, чтобы проверить, достаточно ли используется данных для ЦП. Для проверки масштабирования мы рекомендуем использовать как минимум 1 TБ.

> [!NOTE]
>
> Высокий уровень параллелизма только увеличивает производительность обработки запросов, если нагрузку можно разделить между вычислительными узлами. Если обнаружится, что масштабирование не влияет на производительность, вам может потребоваться настроить конструктор таблиц или запросы. Инструкции по настройке запросов см. в статье [Памятка для хранилища данных SQL Azure](cheat-sheet.md).

## <a name="permissions"></a>Разрешения

Чтобы изменить единицы использования хранилища данных, требуются разрешения, описанные в статье об [инструкции ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest).

Встроенные роли для ресурсов Azure, такие как участник базы данных SQL и участник SQL Server, позволяют изменять параметры DWU.

## <a name="view-current-dwu-settings"></a>для просмотра текущих параметров DWU;

Чтобы просмотреть текущие параметры DWU, сделайте следующее:

1. Откройте обозреватель объектов SQL Server в Visual Studio.
2. Подключитесь к базе данных master, связанной с логическим сервером Базы данных SQL.
3. Выберите в sys.database_service_objectives динамическое административное представление. Например:

```sql
SELECT  db.name [Database]
,        ds.edition [Edition]
,        ds.service_objective [Service Objective]
FROM    sys.database_service_objectives   AS ds
JOIN    sys.databases                     AS db ON ds.database_id = db.database_id
;
```

## <a name="change-data-warehouse-units"></a>Изменение единиц использования хранилища данных

### <a name="azure-portal"></a>Портал Azure

Чтобы изменить DWUs:

1. Откройте [портал Azure](https://portal.azure.com), затем откройте нужную базу данных и щелкните **Масштаб**.

2. В колонке **Масштаб** передвиньте ползунок влево или вправо, чтобы изменить число единиц DWU.

3. Выберите команду **Сохранить**. Появится окно подтверждения. Щелкните **Да** для подтверждения или **Нет** для отмены.

### <a name="powershell"></a>PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Чтобы изменить DWUs, используйте [Set-AzSqlDatabase](/powershell/module/az.sql/set-azsqldatabase) PowerShell cmdlet. В следующем примере приводится цель уровня обслуживания DW1000c для базы данных MyS'LDW, размещенной на сервере MyServer.

```Powershell
Set-AzSqlDatabase -DatabaseName "MySQLDW" -ServerName "MyServer" -RequestedServiceObjectiveName "DW1000c"
```

Дополнительные сведения см. в статье [Использование командлетов PowerShell и интерфейсов REST API при работе с хранилищем данных SQL](sql-data-warehouse-reference-powershell-cmdlets.md).

### <a name="t-sql"></a>T-SQL

С помощью T-S'L вы можете просматривать текущие настройки DWU, изменять настройки и проверять ход выполнения.

Изменение DWU:

1. Подключитесь к базе данных master, связанной с логическим сервером Базы данных SQL.
2. Используйте оператор TSQL [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json&view=azure-sqldw-latest). В следующем примере приводится цель уровня обслуживания DW1000c для базы данных MySLDW.

```Sql
ALTER DATABASE MySQLDW
MODIFY (SERVICE_OBJECTIVE = 'DW1000c')
;
```

### <a name="rest-apis"></a>Интерфейсы REST API

Чтобы изменить число DWU, используйте REST API [создания или обновления базы данных](/rest/api/sql/databases/createorupdate). В следующем примере приводится цель уровня обслуживания DW1000c для базы данных MyS'LDW, которая размещается на сервере MyServer. Сервер находится в группе ресурсов Azure с именем ResourceGroup1.

```
PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{resource-group-name}/providers/Microsoft.Sql/servers/{server-name}/databases/{database-name}?api-version=2014-04-01-preview HTTP/1.1
Content-Type: application/json; charset=UTF-8

{
    "properties": {
        "requestedServiceObjectiveName": DW1000c
    }
}
```

Дополнительные примеры REST API см. в статье [REST API для хранилища данных Azure SQL](sql-data-warehouse-manage-compute-rest-api.md).

## <a name="check-status-of-dwu-changes"></a>Проверка состояния изменений единиц DWU

Изменение количества единиц DWU может занять несколько минут. При выполнении автоматического масштабирования можно реализовать логику, позволяющую приступать к выполнению другого действия только после завершения определенных операций.

Проверка состояния базы данных с использованием различных конечных точек позволяет правильно реализовать автоматизацию этих операций. На портале отображается уведомление о завершении операции и текущее состояние баз данных, однако здесь нельзя проверять состояние программным способом.

Вы не можете проверить состояние базы данных для операций масштабирования с помощью портала Azure.

Чтобы проверить состояние изменений DWU, сделайте следующее:

1. Подключитесь к базе данных master, связанной с логическим сервером Базы данных SQL.

1. Отправьте запрос ниже, чтобы проверить состояние базы данных.

    ```sql
    SELECT    *
    FROM      sys.databases
    ;
    ```

1. Отправьте запрос ниже, чтобы проверить состояние операции.

    ```sql
    SELECT    *
    FROM      sys.dm_operation_status
    WHERE     resource_type_desc = 'Database'
    AND       major_resource_id = 'MySQLDW'
    ;
    ```

Этот DMV возвращает информацию о различных операциях управления в вашем пуле S'L, таких как операция и состояние операции, которая либо IN_PROGRESS, либо COMPLETED.

## <a name="the-scaling-workflow"></a>Масштабирование рабочего процесса

При запуске операции масштабирования система сначала убивает все открытые сеансы, откатив все открытые транзакции для обеспечения согласованного состояния. Операции масштабирования можно выполнить только после завершения отката транзакций.  

- Для операции масштабирования система отсоединяет все вычислительные узлы, проветривает дополнительные вычислительные узлы, а затем прикрепляется к уложенк.
- Для операции с уменьшению масштаба система отсоединяет все вычислительные узлы, а затем прикрепляет только необходимые узлы к уму.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об управлении производительностью см. в статьях [Классы ресурсов для управления рабочими нагрузками](resource-classes-for-workload-management.md) и [Memory and concurrency limits for Azure SQL Data Warehouse](memory-concurrency-limits.md) (Ограничения памяти и параллелизма для хранилища данных SQL Azure).
