---
title: Резервное копирование и восстановление - снимки, гео-излишние
description: Узнайте, как работает резервное копирование и восстановление в пуле Azure Synapse Analytics S'L. Используйте резервные ожидания для восстановления хранилища данных в точке восстановления в основной области. Геоизбыточные резервные копии можно использовать для восстановления в другом географическом регионе.
services: synapse-analytics
author: kevinvngo
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 03/04/2020
ms.author: anjangsh
ms.reviewer: igorstan
ms.custom: seo-lt-2019"
ms.openlocfilehash: ae53380572e753a8bcfa20fcd165fa015766263e
ms.sourcegitcommit: 8a9c54c82ab8f922be54fb2fcfd880815f25de77
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80349267"
---
# <a name="backup-and-restore-in-azure-synapse-sql-pool"></a>Резервное копирование и восстановление в бассейне Azure Synapse S'L

Узнайте, как использовать резервную и восстановительную часть в пуле Azure Synapse S'L. Используйте точки восстановления пула S'L, чтобы восстановить или скопировать хранилище данных в предыдущее состояние в основном регионе. а для восстановления в другом географическом регионе — геоизбыточные резервные копии хранилища данных.

## <a name="what-is-a-data-warehouse-snapshot"></a>Что такое моментальный снимок хранилища данных

*Моментальный снимок хранилища данных* создает точку восстановления, которую можно использовать для восстановления или копирования хранилища до предыдущего состояния.  Поскольку пул S'L является распределенной системой, моментальный снимок хранилища данных состоит из многих файлов, которые находятся в хранилище Azure. Моментальные снимки фиксируют добавочные изменения в данных, содержащихся в хранилище данных.

*Восстановление хранилища данных* означает создание хранилища данных из точки восстановления существующего или удаленного хранилища данных. Восстановление хранилища данных является важной частью любой стратегии непрерывности бизнес-процессов и аварийного восстановления, так как позволяет воссоздать данные после случайного повреждения или удаления. Хранилище данных также является эффективном механизмом для создания копий вашего хранилища данных в целях тестирования или разработки.  Коэффициенты восстановления пула могут варьироваться в зависимости от размера базы данных и местоположения исходного и целевого хранилища данных. 

## <a name="automatic-restore-points"></a>Точки автоматического восстановления

Снимки — это встроенная функция службы, которая создает точки восстановления. Ее не нужно включать специально. Тем не менее, пул S'L должен находиться в активном состоянии для создания точек восстановления. Если пул S'L часто приостанавливается, автоматические точки восстановления могут быть не созданы, поэтому не забудьте создать определенную пользователем точку восстановления перед приостановкой пула S'L. Автоматические точки восстановления в настоящее время не могут быть удалены пользователями, поскольку служба использует эти точки восстановления для поддержания SLAs для восстановления.

Снимки хранилища данных принимаются в течение дня, создавая точки восстановления, которые доступны в течение семи дней. Этот срок нельзя изменить. Пул S'L поддерживает восьмичасовую цель точки восстановления (RPO). Вы можете восстановить хранилище данных в основном регионе до любого из моментальных снимков, доступных за последние семь дней.

Чтобы узнать, когда начинается последний снимок, запустите этот запрос в пуле онлайн-сезл.

```sql
select   top 1 *
from     sys.pdw_loader_backup_runs
order by run_id desc
;
```

## <a name="user-defined-restore-points"></a>Определяемые пользователем точки восстановления

Эта функция позволяет вручную запускать снимки для создания точек восстановления хранилища данных до и после больших изменений. Эта возможность гарантирует, что точки восстановления логически согласованы, что обеспечивает дополнительную защиту данных в случае каких-либо перерывов рабочей нагрузки или ошибок пользователей для быстрого времени восстановления. Пользовательские точки восстановления доступны в течение семи дней и автоматически удаляются от вашего имени. Пользователь не может самостоятельно изменить срок хранения пользовательских точек восстановления. Только **42 пользовательские точки восстановления** предоставляются в любой момент времени, поэтому лишние точки восстановления должны быть [удалены](https://go.microsoft.com/fwlink/?linkid=875299) перед созданием новой точки. Вы можете активировать моментальные снимки для создания пользовательских точек восстановления с помощью [PowerShell](https://docs.microsoft.com/powershell/module/az.sql/new-azsqldatabaserestorepoint#examples) или портала Azure.

> [!NOTE]
> Если вам требуется хранить точки восстановления более 7 дней, проголосуйте за эту возможность [здесь](https://feedback.azure.com/forums/307516-sql-data-warehouse/suggestions/35114410-user-defined-retention-periods-for-restore-points). Вы также можете создать пользовательскую точку восстановления и восстановить ее из вновь созданной точки в новом хранилище данных. После восстановления у вас есть пул S'L онлайн и можете приостановить его на неопределенный срок, чтобы сэкономить затраты на вычисления. Хранение приостановленной базы данных оплачивается по расценкам службы хранилища Azure уровня "Премиум". Если вам нужна активная копия восстановленного хранилища данных, вы можете возобновить ее, что займет всего несколько минут.

### <a name="restore-point-retention"></a>Хранение точки восстановления

Ниже перечислены сведения о периодах хранения точек восстановления:

1. Пул с помощью s'L удаляет точку восстановления, когда она попадает в 7-дневный период удержания **и** когда есть по крайней мере 42 общих точек восстановления (включая как пользовательские, так и автоматические).
2. Снимки не при паузе в пуле S'L.
3. Возраст точки восстановления измеряется абсолютными календарными днями с момента принятия точки восстановления, в том числе при приостановке работы пула S'L.
4. В любой момент времени пул S'L гарантированно сможет хранить до 42 точек восстановления, определенных пользователем, и 42 автоматических точек восстановления, пока эти точки восстановления не достигли 7-дневного периода удержания
5. Если снимок сделан, пул S'L приостанавливается более чем на 7 дней, а затем возобновляется, точка восстановления будет сохраняться до тех пор, пока не будет 42 точек полного восстановления (включая как пользовательские, так и автоматические)

### <a name="snapshot-retention-when-a-sql-pool-is-dropped"></a>Сохранение моментальных снимков при удалении пула S'L

При падении пула S'L создается и сохраняется окончательный моментальный снимок в течение семи дней. Можно восстановить пул S'L в окончательную точку восстановления, созданную при удалении. Если пул S'L отбрасывается в приостановленном состоянии, снимок не делается. В этом сценарии не забудьте создать определяемую пользователем точку восстановления, прежде чем сбросить пул S'L.

> [!IMPORTANT]
> Когда вы удаляете экземпляр логического сервера SQL Server, все относящиеся к этому экземпляру базы данных также удаляются без возможности восстановления. Удаленный сервер восстановить невозможно.

## <a name="geo-backups-and-disaster-recovery"></a>Геоархивы и аварийное восстановление

Гео-резервное копирование создается один раз в день в [парном центре обработки данных.](../../best-practices-availability-paired-regions.md) Целевая точка восстановления для геовосстановления составляет 24 часа. Можно восстановить гео-поддержку на сервере в любом другом регионе, где поддерживается пул S'L. Геоархивация гарантирует, что вы сможете восстановить хранилище данных даже при отсутствии доступа к точкам восстановления, размещенным в основном регионе.

> [!NOTE]
> Если требуется более короткий интервал для геоархивации, [проголосуйте за эту возможность](https://feedback.azure.com/forums/307516-sql-data-warehouse). Вы также можете создать пользовательскую точку восстановления и восстановить ее из вновь созданной точки в новом хранилище данных в другом регионе. После восстановления вы получаете хранилище данных в сети и можете приостановить его на неограниченное время для экономии вычислительных ресурсов. Хранение приостановленной базы данных оплачивается по расценкам службы хранилища Azure уровня "Премиум". Если вам нужна активная копия хранилища данных, вы можете возобновить ее, что займет всего несколько минут.

## <a name="backup-and-restore-costs"></a>Стоимость резервного копирования и восстановления

Можно заметить, что в счете на оплату Azure содержится строка для обычного хранилища и хранилища аварийного восстановления. Плата за хранение — это общая стоимость хранения данных в основном регионе наряду с постепенными изменениями, полученными при снимках. Дополнительные сведения о том, как начисляется плата за моментальные снимки, см. [в этом разделе](https://docs.microsoft.com/rest/api/storageservices/Understanding-How-Snapshots-Accrue-Charges?redirectedfrom=MSDN#snapshot-billing-scenarios). Плата за использование геоизбыточного хранилища охватывает стоимость хранения геоархивов.  

Общая стоимость основного хранилища данных и изменений моментальных снимков за последние семь дней округляется до ближайшего терабайта. Например, если объем хранилища данных составляет 1,5 ТБ, а под моментальные снимки задействовано 100 ГБ, плата взимается за 2 ТБ данных по тарифам хранилища Azure класса Premium.

При использовании геоизбыточного хранилища плата за хранилище взимается отдельно. Геоизбыточное хранилище оплачивается по стандартному тарифу для географически избыточного хранилища с доступом на чтение (RA-GRS).

Для получения дополнительной информации о ценах [Azure Synapse pricing](https://azure.microsoft.com/pricing/details/sql-data-warehouse/gen2/)На Azure Synapse см. При восстановлении в разных регионах плата за вывоз данных не взимается.

## <a name="restoring-from-restore-points"></a>Восстановление из точек восстановления

Каждый моментальный снимок создает точку восстановления, которая представляет время начала создания моментального снимка. Для восстановления хранилища данных следует выбрать точку восстановления и выполнить команду restore.  

Можно сохранить восстановленное и текущее хранилища данных либо удалить один из них. Если вы хотите заменить текущий хранилище данных восстановленным хранилищем данных, его можно переименовать с помощью [ALTER DATABASE (s'L pool)](/sql/t-sql/statements/alter-database-azure-sql-data-warehouse) с опцией MODIFY NAME.

Для восстановления хранилища данных [см.](sql-data-warehouse-restore-points.md#create-user-defined-restore-points-through-the-azure-portal)

Чтобы восстановить удаленное или приостановленное хранилище данных, вы можете [создать запрос в службу поддержки](sql-data-warehouse-get-started-create-support-ticket.md).

## <a name="cross-subscription-restore"></a>Восстановление поперечной подписки

Если вам нужно непосредственно восстановить по подписке, проголосуйте за эту возможность [здесь](https://feedback.azure.com/forums/307516-sql-data-warehouse/suggestions/36256231-enable-support-for-cross-subscription-restore). Восстановление другого логического сервера и ["Перемещение"](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-move-resources) сервера через подписки для выполнения перекрестного восстановления подписки. 

## <a name="geo-redundant-restore"></a>Геоизбыточное восстановление

Вы можете [восстановить свой пул s'L](sql-data-warehouse-restore-from-geo-backup.md#restore-from-an-azure-geographical-region-through-powershell) в любом регионе, поддерживающем пул S'L на выбранном вами уровне производительности.

> [!NOTE]
> Чтобы выполнить географически избыточное восстановление, необходимо отказаться от этой функции.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о планировании на случай аварий см. в [обзоре обеспечения непрерывности бизнес-процессов](../../sql-database/sql-database-business-continuity.md)
