---
title: Использование хранимых процедур
description: Советы по внедрению сохраненных процедур в пуле Synapse S'L (хранилище данных) для разработки решений.
services: synapse-analytics
author: XiaoyuMSFT
manager: craigg
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 04/15/2020
ms.author: xiaoyul
ms.reviewer: igorstan
ms.openlocfilehash: a431df1ff4ef0984d1197933e7ca78979fa23089
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81430985"
---
# <a name="using-stored-procedures-in-sql-pool"></a>Использование сохраненных процедур в пуле S'L

Советы по внедрению сохраненных процедур в пуле Synapse S'L (хранилище данных) для разработки решений.

## <a name="what-to-expect"></a>Основные принципы

Бассейн s'L поддерживает многие функции T-S'L, которые используются в сервере S'L. Что более важно, в нем есть специальные функции горизонтального масштабирования, с помощью которых можно максимально увеличить производительность решения.

Тем не менее, для поддержания масштаба и производительности пула S'L есть также некоторые функции и функциональные возможности, которые имеют поведенческие различия и другие, которые не поддерживаются.

## <a name="introducing-stored-procedures"></a>Введение в хранимые процедуры

Хранимые процедуры — это отличный метод инкапсуляции кода SQL, при котором он хранится близко к данным в хранилище данных. Инкапсуляция кода в хранимые процедуры управляемых элементов помогает разработчикам добиться модульности своих решений и упрощает многократное использование кода. Каждая хранимая процедура может также принимать параметры, что делает их еще более гибкими.

Пул саЗЛ обеспечивает упрощенную и упорядоченную реализацию процедуры хранения. Главное отличие от SQL Server — хранимая процедура не является предварительно скомпилированным кодом. В хранилищах данных время компиляции мало по сравнению со временем, которое требуется для выполнения запросов к большим объемам данных. Более важно убедиться, что код хранимой процедуры правильно оптимизирован для больших запросов. Цель — сэкономить часы, минуты и секунды, но не миллисекунды. Поэтому удобнее считать хранимые процедуры контейнерами для логики SQL.

При выполнении сохраненной процедуры пул s'L разбирается, переводится и оптимизируется в момент выполнения. Во время этого процесса каждая инструкция преобразуется в распределенные запросы. Код SQL, который выполняется с данными, отличается от отправляемого запроса.

## <a name="nesting-stored-procedures"></a>Вложенные хранимые процедуры

Когда хранимые процедуры вызывают другие хранимые процедуры или выполняют динамический код SQL, то внутреннюю хранимую процедуру или код вызова называют вложенными.

Бассейн S'L поддерживает максимум восемь уровней гнездования. Это немного отличается от SQL Server. Уровень вложенности в SQL Server — 32.

Вызов хранимой процедуры верхнего уровня считается 1 уровнем вложенности.

```sql
EXEC prc_nesting
```

Если хранимая процедура также выполняет еще один вызов EXEC, уровень вложенности увеличится до 2.

```sql
CREATE PROCEDURE prc_nesting
AS
EXEC prc_nesting_2  -- This call is nest level 2
GO
EXEC prc_nesting
```

Если вторая процедура затем выполняет какой-либо динамический SQL-запрос, уровень вложенности увеличится до 3.

```sql
CREATE PROCEDURE prc_nesting_2
AS
EXEC sp_executesql 'SELECT 'another nest level'  -- This call is nest level 2
GO
EXEC prc_nesting
```

> [!NOTE]
> В настоящее время пул S'L не [поддерживается@NESTLEVEL](/sql/t-sql/functions/nestlevel-transact-sql?toc=/azure/synapse-analytics/toc.json&bc=/azure/synapse-analytics/breadcrumb/toc.json&view=azure-sqldw-latest). Необходимо отслеживать уровень вложенности. Маловероятно, что вы превысите восемь уровней вложенности, но если вы это сделаете, вам нужно переписать свой код, чтобы он соответствовал уровням вложенности в этих пределах.

## <a name="insertexecute"></a>INSERT..EXECUTE

Пулс S'L не позволяет потреблять набор результатов сохраненной процедуры с выпиской INSERT. Однако существует другой подход, которым можно воспользоваться. Например, см. статью о [временных таблицах](develop-tables-temporary.md).

## <a name="limitations"></a>Ограничения

Существуют некоторые аспекты процедур хранения «Трансакт-СЗЛ», которые не реализованы в пуле S'L.

К ним относятся:

* временные хранимые процедуры;
* нумерованные хранимые процедуры;
* расширенные хранимые процедуры;
* хранимые процедуры CLR;
* возможность шифрования;
* возможность репликации;
* параметры с табличным значением;
* параметры только для чтения;
* параметры по умолчанию;
* контекст выполнения;
* инструкция Return.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные советы по разработке см. в статье [Проектные решения и методики программирования для хранилища данных SQL](develop-overview.md).
