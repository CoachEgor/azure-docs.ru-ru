---
title: SQL по запросу (предварительная версия)
description: Сведения об использовании SQL по запросу в Azure Synapse Analytics.
services: synapse analytics
author: filippopovic
ms.service: synapse-analytics
ms.topic: overview
ms.date: 04/15/2020
ms.author: fipopovi
ms.reviewer: jrasnick
ms.openlocfilehash: 8d4de424d5d4d6da1ee80e04b35e63ae29df57c8
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81421308"
---
# <a name="sql-on-demand-preview-in-azure-synapse-analytics"></a>Использование SQL по запросу (предварительная версия) в Azure Synapse Analytics 

В каждой рабочей области Azure Synapse Analytics (предварительная версия) есть конечные точки SQL по запросу (предварительная версия), с помощью которых можно запрашивать данные из озера данных.

SQL по запросу — это служба для создания запросов к данным в озере данных. Она позволяет обращаться к данным с помощью следующих функциональных возможностей:
 
- знакомый синтаксис T-SQL для запрашивания данных на месте без копирования или загрузки в специальное хранилище; 
- интегрированное подключение через интерфейс T-SQL, который содержит широкий спектр средств для бизнес-аналитики и ad-hoc-запросов, а также самые популярные драйверы. 

SQL по запросу — это распределенная система обработки данных, которая рассчитана на огромный масштаб данных и вычислений. SQL по запросу позволяет проанализировать большие данные за несколько секунд или минут в зависимости от конкретной рабочей нагрузки. Благодаря встроенным механизмам отказоустойчивости при выполнении запросов система обеспечивает высокую надежность и успешное выполнение даже для длительных запросов по большим наборам данных.

SQL по запросу работает без сервера, то есть вам не нужно настраивать инфраструктуру или обслуживать кластеры. Конечная точка по умолчанию для этой службы предоставляется в каждой рабочей области Azure Synapse, поэтому вы можете отправлять запросы к данным сразу после создания рабочей области. Плата за резервирование ресурсов не взимается — вы оплачиваете только данные, просканированные выполненными запросами, то есть применяется чистая модель оплаты по мере использования.  

При использовании Spark в конвейере данных вы можете [обращаться к любым созданным таблицам Spark](develop-storage-files-spark-tables.md) непосредственно из SQL по запросу, чтобы выполнить подготовку, очистку или обогащение данных. Используйте [Приватный канал](../security/how-to-connect-to-workspace-with-private-links.md), чтобы предоставить конечную точку SQL по запросу в [виртуальной сети управляемой рабочей области](../security/synapse-workspace-managed-vnet.md).  

## <a name="who-is-sql-on-demand-for"></a>Предназначение SQL по запросу

Если вам нужно исследовать данные в озере данных, получить на их основе ценную информацию или оптимизировать существующий конвейер преобразования данных, вы можете с пользой применить SQL по запросу. Эта служба полезна в следующих случаях.

- Простое обнаружение и исследование позволяет быстро принимать решения о том, как извлечь полезные сведения из данных в разных форматах (Parquet, CSV, JSON), сохраненных в озере данных, и планировать соответствующие действия.
- Логическое хранилище данных обеспечивает реляционную абстракцию для необработанных или разнородных данных, не требуя их перемещения и (или) преобразования, что позволяет постоянно сохранять актуальность представления данных.
- Преобразование данных обеспечивает простой, масштабируемый и производительный способ обработки данных в озере данных с использованием T-SQL для передачи в другие средства (например, средства бизнес-аналитики), или в реляционные хранилища данных (базы данных SQL Synapse, Базу данных SQL Azure и т. п.).

SQL по запросу обеспечивает преимущества различным специалистам.

- Специалисты по инжинирингу данных могут с помощью этой службы исследовать озера данных, преобразовывать и подготавливать данные в них, а также упрощать конвейеры преобразования данных. Дополнительные сведения см. в [этом руководстве](tutorial-data-analyst.md).
- Специалисты по обработке и анализу данных могут быстро оценить содержимое и структуру данных в озере данных благодаря таким функциям, как OPENROWSET и автоматический вывод схемы.
- Аналитики могут [исследовать данные и таблицы Spark](develop-storage-files-spark-tables.md), созданные специалистами по инжинирингу, обработке и анализу данных, используя знакомый им язык T-SQL или любые привычные инструменты, способные подключаться к SQL по запросу.
- Специалисты по бизнес-аналитике могут быстро [создавать отчеты Power BI на основе данных в озере данных](tutorial-connect-power-bi-desktop.md) и таблицах Spark.

## <a name="what-do-i-need-to-do-to-start-using-it"></a>Что нужно сделать, чтобы начать работу с этой службой?

Конечная точка SQL по запросу есть в каждой рабочей области Azure Synapse. Вы можете создать рабочую область и тут же начать выполнять запросы к данным, используя привычные средства.

## <a name="client-tools"></a>Клиентские средства

SQL по запросу позволяет применять для работы с озером данных существующие средства ad-hoc-запросов, SQL-запросов и бизнес-аналитики. Благодаря поддержке знакомого синтаксиса T-SQL любое средство SQL, которое способно создавать TDS-подключения, может по требованию [подключиться к SQL Synapse и выполнять запросы](connect-overview.md). Вы можете подключаться к Azure Data Studio, чтобы выполнять ad-hoc-запросы, или к Power BI, чтобы за считаные минуты получать ценные сведения.

## <a name="is-full-t-sql-supported"></a>Полностью ли поддерживается T-SQL?

SQL по запросу предоставляет для запросов контактную зону T-SQL, которая немного расширена и дополнена по некоторым аспектам, чтобы поддерживать запросы по частично структурированным и неструктурированным данным. Более того, некоторые аспекты языка T-SQL не поддерживаются из-за особенностей архитектуры SQL по запросу (например, не поддерживаются функциональные возможности DML).

- Рабочую нагрузку можно упорядочить на основе знакомых понятий.
- Базы данных. Конечная точка SQL по запросу может использовать несколько баз данных.
- Схемы. В базе данных может содержаться одна или несколько групп владения объектами, которые называются схемами.
- Представления
- Внешние ресурсы. Сюда относятся источники данных, форматы файлов и таблицы.

Для обеспечения безопасности можно применить следующие средства:

- Имена входа и пользователи
- учетные данные для контроля доступа к учетным записям хранения;
- предоставление, запрет и отмена разрешений на уровне объектов.
- Интеграция Azure Active Directory

Поддерживаемые аспекты T-SQL.

- Поддерживается полная контактная зона операции [SELECT](/sql/t-sql/queries/select-transact-sql?toc=/azure/synapse-analytics/toc.json&bc=/azure/synapse-analytics/breadcrumb/toc.json&view=azure-sqldw-latest), включая большинство функций SQL.
- CETAS (CREATE EXTERNAL TABLE AS SELECT).
- Инструкции DDL, относящиеся только к представлениям и безопасности.

SQL по запросу не имеет локального хранилища и хранит в базах данных только объекты метаданных. Это означает, что не поддерживаются аспекты T-SQL, связанные со следующими понятиями:

- Таблицы
- Триггеры
- материализованные представления;
- инструкции DDL, кроме связанных с представлениями и безопасностью.
- Инструкции языка DML

### <a name="extensions"></a>Модули

Чтобы обеспечить беспроблемное выполнение запросов "на месте" по данным, которые хранятся в файлах озера данных, существующая функция [OPENROWSET](/sql/t-sql/functions/openrowset-transact-sql?toc=/azure/synapse-analytics/toc.json&bc=/azure/synapse-analytics/breadcrumb/toc.json&view=azure-sqldw-latest) в SQL по запросу дополнена следующими возможностями:

[Запрашивание нескольких файлов или папок](develop-storage-files-overview.md#query-multiple-files-or-folders)

[Формат PARQUET](develop-storage-files-overview.md#parquet-file-format)

[Дополнительные параметры для текстов с разделителями (признак конца поля, признак конца строки, escape-символ)](develop-storage-files-overview.md#additional-options-for-working-with-delimited-text)

[Считывание выбранного подмножества столбцов](develop-storage-files-overview.md#read-a-chosen-subset-of-columns)

[Вывод схемы](develop-storage-files-overview.md#schema-inference)

[Функция filename](develop-storage-files-overview.md#filename-function)

[Функция filepath](develop-storage-files-overview.md#filepath-function)

[Работа со сложными типами, а также вложенными и повторяющимися структурами данных](develop-storage-files-overview.md#work-with-complex-types-and-nested-or-repeated-data-structures)

## <a name="security"></a>Безопасность

SQL по запросу предоставляет механизмы для защиты доступа к данным.

### <a name="azure-active-directory-integration-and-multi-factor-authentication"></a>Интеграция Azure Active Directory и Многофакторная идентификация

SQL по запросу позволяет централизованно управлять удостоверениями пользователя базы данных и другими службами Майкрософт благодаря [интеграции с Azure Active Directory](../../sql-database/sql-database-Azure AD-authentication.md?toc=/azure/synapse-analytics/toc.json&bc=/azure/synapse-analytics/breadcrumb/toc.json). Эта возможность упрощает управление разрешениями и повышает уровень безопасности. Azure Active Directory (Azure AD) поддерживает [многофакторную идентификацию](../../sql-database/sql-database-ssms-mfa-authentication-configure.md?toc=/azure/synapse-analytics/toc.json&bc=/azure/synapse-analytics/breadcrumb/toc.json) (MFA) для повышения безопасности данных и приложений, обеспечивая процесс единого входа.

#### <a name="authentication"></a>Аутентификация

Проверкой подлинности в SQL по запросу именуется процесс подтверждения личности пользователя при подключении к конечной точке. Поддерживаются два типа проверки подлинности.

- **Аутентификация SQL**

  Это метод аутентификации с использованием имени пользователя и пароля.

- **Аутентификация Azure Active Directory**.

  Этот метод проверки подлинности использует удостоверения, управляемые Azure Active Directory. Для пользователей Azure AD можно включить многофакторную проверку подлинности. [По возможности](/sql/relational-databases/security/choose-an-authentication-mode?toc=/azure/synapse-analytics/toc.json&bc=/azure/synapse-analytics/breadcrumb/toc.json&view=azure-sqldw-latest) используйте проверку подлинности Active Directory (встроенная безопасность).

#### <a name="authorization"></a>Авторизация

Процесс проверки подлинности включает в себя набор действий, которые пользователь может выполнять в базе данных в SQL по запросу. Этот набор действий определяется принадлежностью учетной записи пользователя к ролям базы данных и наличием разрешений на уровне объектов.

Если используется проверка подлинности SQL, пользователь SQL существует только в SQL по запросу, а его разрешения действуют только для объектов SQL по запросу. Невозможно напрямую предоставить пользователю SQL доступ к защищаемым объектам в других службах (например, в службе хранилища Azure), так как этот пользователь существует только в SQL по запросу. Пользователь SQL должен использовать для доступа к файлам один из [поддерживаемых типов авторизации](develop-storage-files-storage-access-control.md#supported-storage-authorization-types).

Если используется проверка подлинности Azure AD, пользователь может входить в SQL по запросу и другие службы (например, в службу хранилища Azure) и эти службы могут предоставлять ему разрешения.

### <a name="access-to-storage-accounts"></a>Доступ к учетным записям хранения

Пользователь, выполнивший вход в службу SQL по запросу, должен иметь права на доступ и выполнение запросов к файлам в службе хранилища Azure. SQL по запросу поддерживает следующие типы авторизации:

- **Подписанный URL-адрес (SAS)** предоставляет делегированный доступ к ресурсам в учетной записи хранения. С помощью SAS можно предоставить клиентам доступ к ресурсам в учетной записи хранения, не предоставляя общий доступ к ключам учетной записи. SAS обеспечивает детализированный контроль над типом доступа, который вы предоставляете клиентам с SAS: период действия, предоставленные разрешения, допустимый диапазон IP-адресов, допустимый протокол (HTTPS или HTTP).

- **Удостоверение пользователя** используется для типа авторизации "транзитная проверка подлинности", при которой удостоверение пользователя Azure AD, выполнившего вход в SQL по запросу, применяется для авторизации доступа к данным. Перед обращением к данным администратор службы хранилища Azure должен предоставить пользователю Azure AD разрешения на доступ к данным. При авторизации этого типа задействуется пользователь Azure AD, который вошел в SQL по запросу, поэтому она не поддерживается для типов пользователей SQL.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о подключении к конечным точкам и запрашивании файлов см. в следующих статьях: 
- [Подключение к конечной точке](connect-overview.md)
- [Запрос по файлам](develop-storage-files-overview.md)
