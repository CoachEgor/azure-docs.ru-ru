---
title: Архитектура Azure Synapse Analytics
description: Узнайте, как в Azure Synapse Analytics с помощью массового параллелизма (MPP) и возможностей службы хранилища Azure можно достичь высокой эффективности и масштабируемости.
services: synapse-analytics
author: mlee3gsd
manager: rothja
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 04/15/2020
ms.author: martinle
ms.reviewer: igorstan
ms.openlocfilehash: d073bc82b3a9e42e443caa5d3e7855fd4eb5b98b
ms.sourcegitcommit: fdec8e8bdbddcce5b7a0c4ffc6842154220c8b90
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83658910"
---
# <a name="azure-synapse-sql-architecture"></a>Архитектура Azure Synapse Analytics 

В этой статье описываются компоненты архитектуры Synapse SQL.

[!INCLUDE [preview](../includes/note-preview.md)]

## <a name="synapse-sql-architecture-components"></a>Компоненты архитектуры Synapse SQL

Synapse SQL использует архитектуру с горизонтальным увеличением масштаба для распределения вычислительной обработки данных на нескольких узлах. Вычислительные ресурсы отделены от ресурсов хранилища, что дает возможность масштабировать вычислительные ресурсы независимо от данных в системе. 

В пуле SQL единица масштабирования представляет собой абстракцию вычислительной мощности, известную как [единица использования хранилища данных](resource-consumption-models.md). 

В службе SQL по запросу, не зависящей от сервера, масштабирование выполняется автоматически в соответствии с требованиями к ресурсам в запросе. По мере того, как топология изменяется с течением времени из-за добавления, удаления узлов или отработки отказа, она адаптируется к этим изменениям и гарантирует, что запросу будет выделено достаточно ресурсов для успешного выполнения. Например, на приведенном ниже рисунке показана служба SQL по запросу, использующая 4 вычислительных узла для выполнения запроса.

![Архитектура Synapse SQL](./media//overview-architecture/sql-architecture.png)

В Synapse SQL используется архитектура на основе узлов. Приложения подключаются к управляющему узлу и выполняют команды T-SQL. Этот узел представляет собой единую точку входа для Synapse SQL. 

Управляющий узел пула SQL использует подсистему MPP, которая оптимизирует запросы для параллельной обработки, а затем перенаправляет операции на вычислительные узлы, чтобы обеспечить параллельную работу. 

Управляющий узел SQL по запросу использует подсистему распределенной обработки запросов (DQP) для оптимизации и организации распределенного выполнения запросов пользователей, разбивая их на запросы меньшего размера, которые будут выполняться на вычислительных узлах. Каждый меньший запрос называется задачей и представляет единицу распределенного выполнения. Он считывает файлы из хранилища, объединяет результаты из других задач и группирует или упорядочивает данные, полученные из других задач. 

Вычислительные узлы хранят все данные пользователей в службе хранилища Azure и выполняют параллельные запросы. Служба перемещения данных (DMS) представляет собой внутреннюю службу на уровне системы, которая перемещает данные между узлами, что необходимо для выполнения параллельных запросов и возвращения точных результатов. 

Благодаря тому, что хранилище и вычислительные узлы не связаны, использование Synapse SQL может дать преимущества независимого объема вычислительной мощности от потребностей хранилища. Масштабирование SQL по запросу выполняется автоматически, в то время как в пуле SQL возможно следующее:

* увеличение или уменьшение вычислительной мощности в пуле SQL (хранилище данных) без перемещения данных;
* приостановка вычислений без изменения данных (вы платите только за хранилище);
* возобновление вычислений во время рабочих часов.

## <a name="azure-storage"></a>Хранилище Azure

В Synapse SQL используется служба хранилища Azure для безопасного хранения данных пользователя. Так как ваши данные хранятся в службе хранилища Azure и управляются ею, предусмотрена отдельная плата за использование хранилища. 

SQL по запросу позволяет запрашивать файлы в озере данных в режиме только для чтения, тогда как пул SQL позволяет и принимать данные. Когда данные принимаются в пул SQL, для оптимизации производительности системы они сегментируются по **распределениям**. При определении таблицы вы можете выбрать шаблон сегментирования, который будет использоваться для распределения данных. Поддерживаются следующие шаблоны сегментирования:

* Хэш
* Циклический перебор
* Репликация

## <a name="control-node"></a>Управляющий узел

Управляющий узел в этой архитектуре отвечает за все решения. Это внешний интерфейс, который взаимодействует со всеми приложениями и подключениями. 

В пуле SQL подсистема MPP запускается на управляющем узле, чтобы оптимизировать и координировать параллельные запросы. При отправке запроса T-SQL в пул SQL управляющий узел преобразует его в запросы, которые будут выполняться на каждом вычислительном узле в параллельном режиме.

В SQL по запросу на управляющем узле выполняется подсистема DQP, которая оптимизирует и организовывает распределенное выполнение запросов пользователей, разбивая их на запросы меньшего размера, которые будут выполняться на вычислительных узлах. Она также назначает наборы файлов, которые будут обрабатываться каждым узлом.

## <a name="compute-nodes"></a>Вычислительные узлы

Вычислительные узлы обеспечивают вычислительную мощность. 

В пуле SQL распределения сопоставляются с вычислительными узлами для обработки. Когда вы оплачиваете использование дополнительных вычислительных ресурсов, пул повторно сопоставляет распределения с доступными вычислительными узлами. Число вычислительных узлов находится в диапазоне от 1 до 60 и определяется уровнем обслуживания пула SQL. У каждого вычислительного узла есть идентификатор узла, который видно в представлениях системы. Идентификатор вычислительного узла можно увидеть в столбце node_id в системных представлениях, имена которых начинаются с sys.pdw_nodes. Список системных представлений см. в [системном представлении MPP](/sql/relational-databases/system-catalog-views/sql-data-warehouse-and-parallel-data-warehouse-catalog-views?view=azure-sqldw-latest).

В SQL по запросу каждому вычислительному узлу назначается задача и набор файлов для выполнения этой задачи. Задача — это единица распределенного выполнения запроса, которая фактически является частью отправленного пользователем запроса. Используется автомасштабирование, чтобы для выполнения запроса пользователя предоставлялось достаточное количество вычислительных узлов.

## <a name="data-movement-service"></a>Служба перемещения данных

Служба перемещения данных (DMS) — это технология перемещения данных в пуле SQL, которая координирует перемещение данных между вычислительными узлами. Некоторым запросам требуется перемещение данных, чтобы параллельные запросы вернули точные результаты. При необходимости перемещения данных DMS гарантирует, что нужные данные окажутся в нужном расположении.

> [!VIDEO https://www.youtube.com/embed/PlyQ8yOb8kc]

## <a name="distributions"></a>Дистрибутивы

Распределение представляет собой базовую единицу хранения и обработки параллельных запросов, выполняемых для распределенных данных в пуле SQL. При выполнении запроса в пуле SQL формируются 60 меньших запросов, которые выполняются параллельно. 

Каждый из этих 60 небольших запросов выполняется в одном из распределений данных. Каждый вычислительный узел управляет одним или несколькими из 60 распределений. Пул SQL с максимальным количеством вычислительных ресурсов содержит одно распределение на каждом вычислительном узле. Пул SQL с минимальным количеством вычислительных ресурсов содержит все распределения на одном вычислительном узле. 

## <a name="hash-distributed-tables"></a>Таблицы с хэш-распределением
С помощью распределенной хэш-таблицы можно обеспечить наибольшую производительность запроса для операций объединения и агрегирования для больших таблиц. 

Чтобы сегментировать данные в распределенную хэш-таблицу, в пуле SQL используется хэш-функция для детерминированного назначения каждой строки отдельному распределению. В определении таблицы один из столбцов определяется как столбец распределения. Хэш-функция использует значения в столбце распределения для присвоения каждой строки распределению.

На следующей схеме показано, как полная (нераспределенная) таблица хранится в качестве хэш-распределенной. 

![Распределенная таблица](media//overview-architecture/hash-distributed-table.png "Распределенная таблица") 

* Каждая строка относится к одному распределению. 
* Детерминированный хэш-алгоритм присваивает каждую строку одному распределению. 
* Количество строк таблицы в распределении зависит от размеров таблиц (как показано на схеме).

Существуют влияющие на производительность факторы, которые учитываются при выборе столбца распределения. Например, определенность, неравномерное смещение данных и типы запросов, выполняемых в системе.

## <a name="round-robin-distributed-tables"></a>Таблицы с распределением методом циклического перебора

Таблица с распределением методом циклического перебора — это самая простая таблица для создания и обеспечения высокой производительности, если ее использовать как промежуточную таблицу для нагрузок.

В таблице с распределением методом циклического перебора данные распределяются равномерно, но без какой-либо последующей оптимизации. Распределение сначала выбирается случайным образом, а затем буферы строк назначаются распределениям последовательно. Вы можете быстро загрузить данные в таблицу с распределением методом циклического перебора, но производительность запроса будет лучше, если использовать распределенные хэш-таблицы. Для объединения таблиц с распределением методом циклического перебора требуется перегруппировка данных, что требует дополнительного времени.

## <a name="replicated-tables"></a>Реплицированные таблицы
Реплицированная таблица обеспечивает наилучшую производительность запросов для небольших таблиц.

Полная копия реплицированной таблицы хранится на каждом вычислительном узле. В результате репликация таблицы устраняет необходимость передавать данные между вычислительными узлами перед операциями соединения или агрегирования. Реплицированные таблицы лучше всего использовать для небольших таблиц. При записи данных требуются дополнительное хранилище и дополнительные расходы, что делает использование больших таблиц нецелесообразным. 

На следующей схеме представлена реплицированная таблица, которая кэшируется при первом распределении на каждом вычислительном узле. 

![Реплицированная таблица](media/overview-architecture/replicated-table.png "Реплицированная таблица") 

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы уже немного изучили Synapse SQL, узнайте о том, как [создать пул SQL](../quickstart-create-sql-pool-portal.md) и [загрузить пример данных](../sql-data-warehouse/sql-data-warehouse-load-from-azure-blob-storage-with-polybase.md) (./sql-data-warehouse-load-sample-databases.md). Или приступите к использованию [SQL по запросу](../quickstart-sql-on-demand.md). Если вы раньше не работали с Azure, используйте [глоссарий Azure Глоссарий](../../azure-glossary-cloud-terminology.md) , чтобы узнать значение новых терминов. 
