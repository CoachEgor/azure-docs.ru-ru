---
title: Архитектура SQL Azure синапсе
description: Узнайте, как Azure синапсе SQL сочетает массовую параллельную обработку (MPP) с хранилищем Azure для достижения высокой производительности и масштабируемости.
services: synapse-analytics
author: mlee3gsd
manager: rothja
ms.service: synapse-analytics
ms.topic: conceptual
ms.subservice: ''
ms.date: 04/15/2020
ms.author: martinle
ms.reviewer: igorstan
ms.openlocfilehash: 570e84b3a545736aad6983c7f0d8c0f0296ca589
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81431817"
---
# <a name="azure-synapse-sql-architecture"></a>Архитектура SQL Azure синапсе 

В этой статье описываются компоненты архитектуры синапсе SQL.

[!INCLUDE [preview](../includes/note-preview.md)]

## <a name="synapse-sql-architecture-components"></a>Компоненты архитектуры SQL синапсе

Синапсе SQL использует архитектуру масштабирования для распределения вычислительной обработки данных между несколькими узлами. Расчеты отделены от хранилища, что позволяет масштабировать вычисление независимо от данных в системе. 

Для пула SQL единица масштабирования является абстракцией вычислений, которая называется [единицей хранилища данных](resource-consumption-models.md). 

Для SQL по требованию, не зависящего от сервера, масштабирование выполняется автоматически в соответствии с требованиями к ресурсам запроса. По мере изменения топологии с течением времени путем добавления, удаления узлов или отработки отказа она адаптируется к изменениям и гарантирует, что запрос будет иметь достаточно ресурсов и успешно завершил работу. Например, на приведенном ниже рисунке показана поддержка SQL по запросу с использованием 4 вычислительных узла для выполнения запроса.

![Архитектура Synapse SQL](./media//overview-architecture/sql-architecture.png)

Синапсе SQL использует архитектуру на основе узлов. Приложения подключаются и выдают команды T-SQL управляющему узлу, который является единственной точкой входа для синапсе SQL. 

Узел управления пулом SQL использует подсистему MPP для оптимизации запросов для параллельной обработки, а затем передает операции вычислительным узлам для параллельной работы. 

Управляющий узел SQL по запросу использует механизм распределенных запросов (ДКП) для оптимизации и управления распределенным выполнением запросов пользователей, разбивая его на запросы меньшего размера, которые будут выполняться на вычислительных узлах. Каждый маленький запрос называется Task и представляет распределенную единицу выполнения. Он считывает файлы из хранилища, объединяет результаты из других задач, группирует или упорядочивает данные, полученные из других задач. 

Вычислительные узлы хранят все данные пользователей в службе хранилища Azure и выполняют параллельные запросы. Служба перемещения данных (DMS) представляет собой внутреннюю службу на уровне системы, которая перемещает данные между узлами, что необходимо для выполнения параллельных запросов и возвращения точных результатов. 

В случае с несвязанным хранилищем и вычислением при использовании синапсе SQL один может выиграть от независимого размера энергопотребления, независимо от потребностей хранилища. Масштабирование SQL по запросу выполняется автоматически, в то время как для пула SQL один может:

* Увеличение или уменьшение мощности вычислений в пуле SQL (хранилище данных) без перемещения данных.
* приостановка вычислений без изменения данных (вы платите только за хранилище);
* возобновление вычислений во время рабочих часов.

## <a name="azure-storage"></a>Хранилище Azure

Синапсе SQL использует службу хранилища Azure для защиты данных пользователей. Так как ваши данные хранятся и управляются службой хранилища Azure, за использование хранилища взимается отдельная плата. 

SQL по запросу позволяет запрашивать файлы в Data Lake в режиме только для чтения, тогда как пул SQL позволяет получать данные. При приеме данных в пул SQL данные сегментированы на **распределения** , чтобы оптимизировать производительность системы. При определении таблицы вы можете выбрать шаблон сегментирования, который будет использоваться для распределения данных. Поддерживаются следующие шаблоны сегментирования:

* Хэш
* Циклический перебор
* Репликация

## <a name="control-node"></a>Управляющий узел

Управляющий узел является мозгом архитектуры. Это внешний интерфейс, который взаимодействует со всеми приложениями и подключениями. 

В пуле SQL обработчик MPP выполняется на управляющем узле для оптимизации и координации параллельных запросов. При отправке запроса T-SQL в пул SQL управляющий узел преобразует его в запросы, выполняемые для каждого распределения параллельно.

В SQL по запросу ядро ДКП работает на узле управления, чтобы оптимизировать и координировать распределенное выполнение запросов пользователей, разделив его на запросы меньшего размера, которые будут выполняться на вычислительных узлах. Он также назначает наборы файлов, которые будут обрабатываться каждым узлом.

## <a name="compute-nodes"></a>Вычислительные узлы

Вычислительные узлы обеспечивают вычислительную мощность. 

В пуле SQL распределения сопоставляются с вычислительными узлами для обработки. По мере того как вы платите за дополнительные ресурсы вычислений, пул повторно сопоставляет дистрибутивы с доступными вычисленными узлами. Число расчетных узлов в диапазоне от 1 до 60 и определяется уровнем обслуживания для пула SQL. У каждого вычислительного узла есть идентификатор узла, который видно в представлениях системы. Идентификатор вычислительного узла можно увидеть в столбце node_id в системных представлениях, имена которых начинаются с sys.pdw_nodes. Список системных представлений см. в [системном представлении MPP](/sql/relational-databases/system-catalog-views/sql-data-warehouse-and-parallel-data-warehouse-catalog-views?view=azure-sqldw-latest).

В SQL по запросу каждому расчетному узлу назначается задача и набор файлов для выполнения задачи. Задача — это распределенная единица выполнения запросов, которая фактически является частью отправленного пользователем запроса. Автоматическое масштабирование действует, чтобы убедиться, что для выполнения запроса пользователя используется достаточное количество вычислений.

## <a name="data-movement-service"></a>Служба перемещения данных

Служба перемещения данных (DMS) — это технология передачи данных в пуле SQL, которая координирует перемещение данных между вычисленными узлами. Некоторым запросам требуется перемещение данных, чтобы параллельные запросы вернули точные результаты. При необходимости перемещения данных DMS гарантирует, что нужные данные окажутся в нужном расположении.

> [!VIDEO https://www.youtube.com/embed/PlyQ8yOb8kc]

## <a name="distributions"></a>Дистрибутивы

Распределение — это базовая единица хранения и обработки для параллельных запросов, выполняемых на распределенных данных в пуле SQL. Когда пул SQL выполняет запрос, работа делится на 60 небольших запросов, выполняемых параллельно. 

Каждый из этих 60 небольших запросов выполняется в одном из распределений данных. Каждый вычислительный узел управляет одним или несколькими из 60 распределений. Пул SQL с максимальными ресурсами вычислений имеет по одному распределению на каждый узел вычислений. Пул SQL с минимальными ресурсами вычислений имеет все распределения на одном кластерном узле. 

## <a name="hash-distributed-tables"></a>Таблицы с хэш-распределением
С помощью распределенной хэш-таблицы можно обеспечить наибольшую производительность запроса для операций объединения и агрегирования для больших таблиц. 

Для сегментирования данных в распределенную хэш-таблицу пул SQL использует хэш-функцию для детерминированного назначения каждой строки одному распределению. В определении таблицы один из столбцов определяется как столбец распределения. Хэш-функция использует значения в столбце распределения для присвоения каждой строки распределению.

На следующей схеме показано, как полная (нераспределенная) таблица хранится в качестве хэш-распределенной. 

![Распределенная таблица](media//overview-architecture/hash-distributed-table.png "Распределенная таблица") 

* Каждая строка относится к одному распределению. 
* Детерминированный хэш-алгоритм присваивает каждую строку одному распределению. 
* Количество строк таблицы в распределении зависит от размеров таблиц (как показано на схеме).

Существуют влияющие на производительность факторы, которые учитываются при выборе столбца распределения. Например, определенность, неравномерное смещение данных и типы запросов, выполняемых в системе.

## <a name="round-robin-distributed-tables"></a>Таблицы с распределением методом циклического перебора

Таблица с распределением методом циклического перебора — это самая простая таблица для создания и обеспечения высокой производительности, если ее использовать как промежуточную таблицу для нагрузок.

В таблице с распределением методом циклического перебора данные распределяются равномерно, но без какой-либо последующей оптимизации. Распределение сначала выбирается случайным образом, а затем буферы строк назначаются распределениям последовательно. Вы можете быстро загрузить данные в таблицу с распределением методом циклического перебора, но производительность запроса будет лучше, если использовать распределенные хэш-таблицы. Для соединений с таблицами с циклическим перебором требуются данные перегруппировка, что занимает дополнительное время.

## <a name="replicated-tables"></a>Реплицированные таблицы
Реплицированная таблица обеспечивает наилучшую производительность запросов для небольших таблиц.

Полная копия реплицированной таблицы хранится на каждом вычислительном узле. В результате репликация таблицы устраняет необходимость передавать данные между вычислительными узлами перед операциями соединения или агрегирования. Реплицированные таблицы лучше всего использовать для небольших таблиц. Требуется дополнительное хранилище, и при записи данных возникают дополнительные издержки, которые делают большие таблицы непрактичными. 

На приведенной ниже схеме показана реплицированная таблица, которая кэшируется в первом распределении на каждом из этих кластерных узлов. 

![Реплицированная таблица](media/overview-architecture/replicated-table.png "Реплицированная таблица") 

## <a name="next-steps"></a>Дальнейшие шаги

Теперь, когда вы уже знакомы с синапсе SQL, Узнайте, как быстро [создать пул SQL](../quickstart-create-sql-pool.md) и [загрузить демонстрационные данные](../sql-data-warehouse/sql-data-warehouse-load-from-azure-blob-storage-with-polybase.md) (./SQL-Data-Warehouse-Load-Sample-databases.md). Или начните [использовать SQL по запросу](../quickstart-sql-on-demand.md). Если вы раньше не работали с Azure, используйте [глоссарий Azure](../../azure-glossary-cloud-terminology.md), чтобы узнать значение новых терминов. 
