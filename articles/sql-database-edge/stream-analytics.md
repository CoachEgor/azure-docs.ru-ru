---
title: Использование пакетов DAC базы данных SQL и заданий Stream Analytics с помощью границы базы данных SQL Azure | Документация Майкрософт
description: Сведения об использовании заданий Stream Analytics в границе базы данных SQL
keywords: Пограничная база данных SQL, Stream Analytics, SqlPackage
services: sql-database-edge
ms.service: sql-database-edge
ms.topic: conceptual
author: SQLSourabh
ms.author: sourabha
ms.reviewer: sstein
ms.date: 11/04/2019
ms.openlocfilehash: 21a8bb6953fd879b17816361f536596571678697
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2020
ms.locfileid: "74384161"
---
# <a name="using-sql-database-dac-packages-and-stream-analytics-jobs-with-sql-database-edge"></a>Использование пакетов DAC базы данных SQL и заданий Stream Analytics с помощью границы базы данных SQL

Предварительная версия базы данных SQL Azure — это оптимизированное реляционное ядро СУБД, предназначенное для развертывания IoT и пограничных развертываний. Он основан на последних версиях Microsoft SQL Server ядро СУБД, которые обеспечивают ведущие в отрасли функции повышения производительности, безопасности и обработки запросов. Наряду с ведущими в отрасли возможностями управления реляционными базами данных SQL Server, служба "база данных SQL Azure" предоставляет встроенную потоковую возможность для аналитики в реальном времени и сложной обработки событий.

Служба "база данных SQL Azure" также предоставляет собственную реализацию SqlPackage. exe, которая позволяет развертывать пакет [DAC базы данных SQL](https://docs.microsoft.com/sql/relational-databases/data-tier-applications/data-tier-applications) во время развертывания пограничной базы данных SQL.

Граница базы данных SQL Azure предоставляет два необязательных `module twin's desired properties` параметра с помощью параметра модуля IOT Edge:

```json
{
    "properties.desired":
    {
        "SqlPackage": "<Optional_DACPAC_ZIP_SAS_URL>",
        "ASAJobInfo": "<Optional_ASA_Job_ZIP_SAS_URL>"
    }
}
```

|Поле | Описание |
|------|-------------|
| SqlPackage | Универсальный код ресурса (URI) хранилища BLOB-объектов Azure для ZIP-файла, содержащего пакет DAC базы данных SQL.
| асажобинфо | Универсальный код ресурса (URI) хранилища BLOB-объектов Azure для задания ASA ребра. Дополнительные сведения см. [в разделе Публикация задания ASA ребра для базы данных SQL](/azure/sql-database-edge/stream-analytics#using-streaming-jobs-with-sql-database-edge).

## <a name="using-sql-database-dac-packages-with-sql-database-edge"></a>Использование пакетов DAC базы данных SQL с границей базы данных SQL

Чтобы использовать пакет DAC базы данных SQL (*. dacpac) с границей базы данных SQL, сделайте следующее:

1. Создание или извлечение пакета DAC для базы данных SQL. Сведения о том, как создать пакет DAC для существующей базы данных SQL Server, см. в разделе [Извлечение DAC из базы данных](/sql/relational-databases/data-tier-applications/extract-a-dac-from-a-database/) .

2. Заархивировать файл *. dacpac и передать его в учетную запись хранилища BLOB-объектов Azure. Дополнительные сведения о загрузке файлов в хранилище BLOB-объектов Azure см. [в разделе Отправка, скачивание и вывод списка больших двоичных объектов с помощью портал Azure](../storage/blobs/storage-quickstart-blobs-portal.md).

3. Создайте подпись общего доступа для ZIP-файла с помощью портал Azure. Дополнительные сведения см. в статье [Делегирование доступа с помощью подписанных URL-адресов (SAS)](../storage/common/storage-sas-overview.md).

4. Обновите конфигурацию модуля ребра базы данных SQL, включив в нее универсальный код ресурса (URI) общего доступа для пакета DAC. Чтобы обновить модуль ребра базы данных SQL, выполните следующие действия:

    1. В портал Azure перейдите к своему развертыванию центра Интернета вещей.

    2. В левой области щелкните **IoT Edge**.

    3. На странице **IOT Edge** найдите и выберите центр Интернета вещей, в котором развернут модуль Microsoft Database ребра.

    4. На странице устройства **IOT Edge устройство** выберите **задать модуль**.

    5. На странице **Установка модулей** выберите **настроить** для модуля SQL Database ребра.

    6. В области **IOT Edge пользовательские модули** выберите **задать требуемые свойства модуля двойника**. Обновите требуемые свойства, чтобы включить универсальный код `SQLPackage` ресурса (URI) для параметра, как показано в следующем примере.

        > [!NOTE]
        > Универсальный код ресурса SAS в следующем JSON — это лишь пример. Замените универсальный код ресурса (URI) фактическим кодом URI из развертывания.

        ```json
            {
                "properties.desired":
                {
                    "SqlPackage": "https://StorageAccountName.blob.core.windows.net/SQLpackageFiles/MeasurementsDB.zip?sp=r&st=2019-09-01T00:00:00Z&se=2019-09-30T00:00:00Z&spr=https&sv=2019-02-02&sr=b&sig=Uh8X0E50qzlxkiKVBJKU3ccVQYwF235qTz7AXp4R3gI%3D",
                }
            }
        ```

    7. Щелкните **Сохранить**.

    8. На странице **Установка модулей** нажмите кнопку **Далее**.

    9. На странице **Установка модулей** выберите **Далее** , а затем — **Отправить**.

5. После обновления модуля файл пакета приложения уровня данных загружается, распаковаться и развертывается для экземпляра SQL Server с пограничным экземпляром.

## <a name="using-streaming-jobs-with-sql-database-edge"></a>Использование заданий потоковой передачи с границей базы данных SQL

В качестве границы базы данных SQL Azure имеется собственная реализация среды выполнения Stream Analytics. Эта реализация позволяет создать задание Azure Stream Analytics ребра и развернуть это задание как задание пограничной потоковой передачи базы данных SQL. Чтобы создать Stream Analytics пограничных заданий, выполните следующие действия.

1. Перейдите к портал Azure с помощью [URL-адреса](https://portal.azure.com/?microsoft_azure_streamanalytics_edgeadapterspreview=true)для предварительного просмотра. Этот URL-адрес предварительной версии позволяет настроить выходные данные базы данных SQL для Stream Analytics пограничных заданий.

2. Создайте новое **Azure Stream Analytics на IOT Edge** задание. Выберите среду размещения, предназначенную для **пограничной**среды.

3. Определите входные и выходные данные для задания Azure Stream Analytics. Все выходные данные SQL, которые вы настраиваете здесь, привязываются к одной таблице в базе данных. Если необходимо передавать данные в несколько таблиц, необходимо создать несколько выходных данных SQL. Выходные данные SQL можно настроить так, чтобы они указывали на разные базы данных.

    **Входные данные**. Выберите EdgeHub в качестве входных данных для задания ребра и укажите сведения о ресурсе.

    **Выходные данные**. Выберите в качестве выходного файла базу данных SQL. Выберите **параметр указать параметры базы данных SQL вручную**. Укажите сведения о конфигурации для базы данных и таблицы.

    |Поле      | Описание |
    |---------------|-------------|
    |Псевдоним выходных данных | Имя выходного псевдонима.|
    |База данных | Имя базы данных SQL. Оно должно быть допустимым именем базы данных, которая существует в экземпляре SQL Server с ребром.|
    |Имя сервера | Имя (или IP-адрес) и сведения об номере порта для экземпляра SQL. Для развертывания с пограничным развертыванием базы данных SQL в качестве имени сервера можно использовать **TCP:., 1433** .|
    |Имя пользователя | Учетная запись входа SQL, которая имеет доступ к базе данных, которую вы указали ранее, с помощью модуля чтения данных и модуля записи данных.|
    |Пароль | Пароль для учетной записи входа SQL, указанной ранее.|
    |Таблица | Имя таблицы, которая будет выводиться для задания потоковой передачи.|
    |Наследование секционирования| Включает наследование схемы секционирования предыдущего шага запроса или входных данных. Если этот параметр включен, вы можете видеть лучшую пропускную способность при записи в дисковую таблицу и иметь полностью параллельную топологию для задания.|
    |Размер пакета| Максимальное число записей, отправляемых при каждой транзакции с массовыми вставками.|

    Ниже приведен пример конфигурации ввода-вывода.

    ```txt
        Input:
            Input from EdgeHub
            Input alias: input
            Event serialization format: JSON
            Encoding: UTF-8
            Event compression type: None

        Output:
            Output alias: output
            Database:  MeasurementsDB
            Server name: tcp:.,1433
            Username: sa
            Password: <Password>
            Table: TemperatureMeasurements
            Inherit Partitioning: Merge all input partitions into a single writer
            Max batch count: 10000
    ```

    > [!NOTE]
    > Дополнительные сведения о выходном адаптере SQL для Azure Stream Analytics см. в разделе [Azure Stream Analytics Output to SQL Azure Database](../stream-analytics/stream-analytics-sql-output-perf.md).

4. Определите запрос задания ASA для задания ребра. Этот запрос должен использовать определенные псевдонимы ввода-вывода в качестве входных и выходных имен в запросе. Дополнительные сведения см. в разделе [Справочник по языку запросов Stream Analytics](https://docs.microsoft.com/stream-analytics-query/stream-analytics-query-language-reference).

5. Задайте параметры учетной записи хранения для задания ребра. Учетная запись хранения используется в качестве целевого объекта публикации для задания ребра.

6. В разделе **Настройка**выберите **опубликовать**, а затем нажмите кнопку **опубликовать** . Сохраните URI SAS для использования с модулем SQL Database ребра.

### <a name="deploy-the-stream-analytics-edge-job-to-sql-database-edge"></a>Развертывание задания Stream Analytics ребра в границе базы данных SQL

Чтобы развернуть задание потоковой передачи в модуле базы данных SQL, обновите конфигурацию модуля ребра базы данных SQL, включив в нее URI SAS для задания потоковой передачи из предыдущего шага. Чтобы обновить модуль ребра базы данных SQL:

1. В портал Azure перейдите к своему развертыванию центра Интернета вещей.

2. В левой области щелкните **IoT Edge**.

3. На странице **IOT Edge** найдите и выберите центр Интернета вещей, в котором развернут модуль Microsoft Database ребра.

4. На странице устройства **IOT Edge устройство** выберите **задать модуль**.

5. На странице **Установка модулей** выберите **настроить** для модуля SQL Database ребра.

6. В области **IOT Edge пользовательские модули** выберите **задать требуемые свойства модуля двойника**. Обновите требуемые свойства, чтобы включить универсальный код `ASAJobInfo` ресурса (URI) для параметра, как показано в следующем примере.

    > [!NOTE]
    > Универсальный код ресурса SAS в следующем JSON — это лишь пример. Замените универсальный код ресурса (URI) фактическим кодом URI из развертывания.

    ```json
        {
            "properties.desired":
            {
                "ASAJobInfo": "https://storageAccountName.blob.core.windows.net/asajobs/ASAEdgeJobs/5a9b34db-7a5c-4606-adae-4c8609eaa1c7/d85b5aa6-4d38-4703-bb34-af7f0bd7916d/ASAEdgeJobDefinition.zip?sv=2018-03-28&sr=b&sig=HH%2BFMsEy378RaTxIy2Xo6rM6wDaqoBaZ5zFDBqdZiS0%3D&st=2019-09-01T22%3A24%3A34Z&se=2019-09-30T22%3A34%3A34Z&sp=r"   
            }
        }
    ```

7. Щелкните **Сохранить**.

8. На странице **Установка модулей** нажмите кнопку **Далее**.

9. На странице **Установка модулей** выберите **Далее** , а затем — **Отправить**.

10. После обновления модуля файл задания Stream Analytics будет скачан, распакован и развернут для экземпляра SQL Server с пограничным экземпляром.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о ценах и доступности см. на странице с [пограничными базами данных SQL Azure](https://azure.microsoft.com/services/sql-database-edge/).
- Запрос на включение границы базы данных SQL Azure для вашей подписки.
- Чтобы приступить к работе, см. статью [развертывание базы данных SQL с помощью портал Azure](deploy-portal.md).
