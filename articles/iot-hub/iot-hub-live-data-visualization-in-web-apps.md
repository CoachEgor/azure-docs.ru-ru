---
title: Визуализация данных в реальном времени от датчиков из центра Интернета вещей в веб-приложения | Документация Майкрософт
description: Используйте веб-приложение для визуализации данных о температуре и влажности, собранных с датчиков и переданных в центр Интернета вещей.
author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.tgt_pltfrm: arduino
ms.date: 05/31/2019
ms.author: robinsh
ms.openlocfilehash: 22b15a95e529d4f09560e9b7e59d9f78f70651bc
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66476007"
---
# <a name="visualize-real-time-sensor-data-from-your-azure-iot-hub-in-a-web-application"></a>Визуализация данных датчиков в реальном времени из центра Интернета вещей в веб-приложения

![Комплексная схема](./media/iot-hub-live-data-visualization-in-web-apps/1_iot-hub-end-to-end-diagram.png)

[!INCLUDE [iot-hub-get-started-note](../../includes/iot-hub-get-started-note.md)]

## <a name="what-you-learn"></a>Что вы узнаете

В этом руководстве вы узнаете, как визуализировать данные датчиков в реальном времени, получает центр Интернета вещей с node.js веб-приложения на локальном компьютере. После выполнения веб-приложение локально, при необходимости можно выполнить действия для размещения веб-приложения в службе приложений Azure. Если вы хотите визуализировать данные, поступающие с датчиков в реальном времени, в Центре Интернета вещей с помощью Power BI, см. сведения в [этой статье](iot-hub-live-data-visualization-in-power-bi.md).

## <a name="what-you-do"></a>Что нужно сделать

* Добавление группы потребителей в центр Интернета вещей, веб-приложение будет использовать для чтения данных датчиков
* Скачайте код веб-приложения из GitHub
* Изучите код веб-приложения
* Настройка переменных среды для размещения центра Интернета вещей артефакты, необходимые для веб-приложения
* Запуск веб-приложения на компьютере разработки
* Откройте веб-страницу для просмотра в режиме реального времени данные о температуре и влажности от центра Интернета вещей
* (Необязательно) Использование интерфейса командной строки Azure для размещения веб-приложения в службе приложений Azure

## <a name="what-you-need"></a>Необходимые элементы

* Завершить [онлайн-симулятор Raspberry Pi](iot-hub-raspberry-pi-web-simulator-get-started.md) руководства или одним из руководств устройства; например, [Raspberry Pi с помощью node.js](iot-hub-raspberry-pi-kit-node-get-started.md). Они охватывают следующие требования:

  * активная подписка Azure;
  * Центр Интернета вещей в подписке;
  * клиентское приложение, которое отправляет сообщения в Центр Интернета вещей.

* [Скачайте Git](https://www.git-scm.com/downloads).

* В этой статье предполагается, что компьютер для разработки Windows; Тем не менее можно легко выполнить эти действия в системе Linux в основной оболочке.

[!INCLUDE [cloud-shell-try-it.md](../../includes/cloud-shell-try-it.md)]

Выполните следующую команду, чтобы добавить расширение Интернета вещей Microsoft Azure для Azure CLI в экземпляр Cloud Shell. Расширение Интернета вещей добавляет в Azure CLI специальные команды Центра Интернета вещей, IoT Edge и службы подготовки устройств Интернета вещей (DPS).

```azurecli-interactive
az extension add --name azure-cli-iot-ext
```

## <a name="add-a-consumer-group-to-your-iot-hub"></a>Добавление группы потребителей в Центр Интернета вещей

[Группы потребителей](https://docs.microsoft.com/azure/event-hubs/event-hubs-features#event-consumers) предоставляют независимых представлений в поток событий, приложений и служб Azure независимо друг от друга получать данные от одну и ту же конечную точку концентратора событий. В этом разделе описано добавление группы потребителей встроенную конечную точку центра Интернета вещей, веб-приложение будет использовать для считывания данных.

Выполните следующую команду, чтобы добавить группу потребителей во встроенную конечную точку центра Интернета вещей:

```azurecli-interactive
az iot hub consumer-group create --hub-name YourIoTHubName --name YourConsumerGroupName
```

Примечание вниз выбранное вами имя, он вам понадобится далее в этом руководстве.

## <a name="get-a-service-connection-string-for-your-iot-hub"></a>Получите строку подключения службы для центра Интернета вещей

Центры Интернета вещей создаются с помощью нескольких политик доступа по умолчанию. Одна политика — **службы** политику, которая предоставляет достаточные разрешения для службы для чтения и записи конечные точки центра Интернета вещей. Выполните следующую команду, чтобы получить строку подключения для центра Интернета вещей, который придерживается политики службы:

```azurecli-interactive
az iot hub show-connection-string --hub-name YourIotHub --policy-name service
```

Строка подключения должна выглядеть следующим образом:

```javascript
"HostName={YourIotHubName}.azure-devices.net;SharedAccessKeyName=service;SharedAccessKey={YourSharedAccessKey}"
```

Запишите строку подключения службы, он вам понадобится далее в этом руководстве.

## <a name="download-the-web-app-from-github"></a>Скачайте веб-приложения из GitHub

Откройте окно командной строки и введите следующие команды, чтобы загрузить пример из GitHub и перейдите в каталог образца:

```cmd
git clone https://github.com/Azure-Samples/web-apps-node-iot-hub-data-visualization.git
cd web-apps-node-iot-hub-data-visualization
```

## <a name="examine-the-web-app-code"></a>Изучите код веб-приложения

В каталоге web-apps-node-iot-hub-data-visualization откройте веб-приложение в любом редакторе. Ниже показана структура файла, просматривать в VS Code:

![Структура файла веб-приложения](./media/iot-hub-live-data-visualization-in-web-apps/web-app-files.png)

Отвлекитесь и просмотрите следующие файлы:

* **Server.js** представляет собой скрипт со стороны службы, который инициализирует веб-сокета и класс-оболочку, концентратор событий. Он предоставляет обратный вызов к классу-оболочке концентратора событий, в классе используется для передачи входящих сообщений на веб-сокет.

* **События hub-reader.js** представляет собой скрипт со стороны службы, который подключается к встроенной конечной точки центра Интернета вещей с помощью указанного соединения строки и группой потребителей. Он извлекает DeviceId и EnqueuedTimeUtc из метаданных для входящих сообщений и затем передает сообщения с помощью метода обратного вызова, зарегистрированных server.js.

* **Диаграммы, устройства, data.js** — это клиентский сценарий, который ожидает передачи данных через веб-сокета, отслеживает каждый идентификатор устройства и сохраняет последние 50 точек входящих данных для каждого устройства. Затем он привязывает данные выбранного устройства на объект диаграммы.

* **Index.HTML** обрабатывает макет пользовательского интерфейса для веб-страницы и ссылки на необходимые скрипты для логику на стороне клиента.

## <a name="configure-environment-variables-for-the-web-app"></a>Настройка переменных среды для веб-приложения

Чтобы считать данные из центра Интернета вещей, веб-приложению строку подключения центра Интернета вещей и имя группы потребителей, следует прочитать. Он возвращает эти строки из среды процесса в следующие строки в файл server.js:

```javascript
const iotHubConnectionString = process.env.IotHubConnectionString;
const eventHubConsumerGroup = process.env.EventHubConsumerGroup;
```

Задайте переменные среды, в окне командной строки, выполнив следующие команды. Замените значения заполнителей строкой подключения службы для центра Интернета вещей и имя группы потребителей, который вы создали ранее. Не заключайте в кавычки строки.

```cmd
set IotHubConnectionString=YourIoTHubConnectionString
set EventHubConsumerGroup=YourConsumerGroupName
```

## <a name="run-the-web-app"></a>Запуск веб-приложения

1. Убедитесь, что устройство работает и отправки данных.

2. В окне командной строки выполните приведенный ниже, чтобы скачать и установить указанные в ссылках пакеты и запустить веб-сайт:

   ```cmd
   npm install
   npm start
   ```

3. Вы должны увидеть выходные данные консоли, которое указывает, что веб-приложение успешно подключено к центру Интернета вещей и прослушивает порт 3000:

   ![Веб-приложения к работе в консоли](./media/iot-hub-live-data-visualization-in-web-apps/web-app-console-start.png)

## <a name="open-a-web-page-to-see-data-from-your-iot-hub"></a>Откройте веб-страницу, чтобы просмотреть данные из центра Интернета вещей

Откройте в браузере `http://localhost:3000`.

В **выберите устройство** выберите устройство, чтобы увидеть выполнение построения последнего 50 точек данных температуры и влажности, отправляемые устройством в центр Интернета вещей.

![Страница веб-приложения с данными о температуре и влажности, полученными в реальном времени](./media/iot-hub-live-data-visualization-in-web-apps/web-page-output.png)

Кроме того, вы должны увидеть результат в консоли, где показаны сообщения, которые передает веб-приложения для браузера клиента:  

![Веб-приложения широковещательных вывод на консоль](./media/iot-hub-live-data-visualization-in-web-apps/web-app-console-broadcast.png)

## <a name="host-the-web-app-in-app-service"></a>Узел веб-приложение в службе приложений

[Функции веб-приложений службы приложений Azure](https://docs.microsoft.com/azure/app-service/overview) предоставляет платформу как услугу (PAAS) для размещения веб-приложений. Веб-приложений, размещенных в службе приложений Azure можно обеспечить мощные возможности Azure, как повысить уровень безопасности, балансировки нагрузки, и масштабирования, как, а также Azure и ее партнеров DevOps решений, таких как непрерывное развертывание, управление пакетами и т. д. Служба приложений Azure поддерживает веб-приложения разработаны во многих популярных языках и развернуты в инфраструктуре Windows или Linux.

В этом разделе вы подготовить веб-приложения в службе приложений и развернуть свой код с помощью команд Azure CLI. Можно найти сведения о командах в [az webapp](https://docs.microsoft.com/cli/azure/webapp?view=azure-cli-latest) документации. Прежде чем начать, убедитесь, что Вы завершили шаги по [добавьте группу ресурсов в центр Интернета вещей](#add-a-consumer-group-to-your-iot-hub), [получить строку подключения службы для центра Интернета вещей](#get-a-service-connection-string-for-your-iot-hub), и [загрузить веб-приложения из GitHub](#download-the-web-app-from-github).

1. [План службы приложений](https://docs.microsoft.com/azure/app-service/overview-hosting-plans) определяет набор вычислительных ресурсов для приложения, размещенного в службе приложений для запуска. В этом руководстве мы используем уровень Developer и Free для размещения веб-приложения. С уровня "бесплатный" веб-приложения выполняется на общих ресурсах Windows с другими приложениями службы приложений, включая приложения других клиентов. Azure также предлагает планы службы приложений для развертывания веб-приложений на платформе Linux вычислительные ресурсы. Этот шаг можно пропустить, если у вас уже есть план службы приложений, который вы хотите использовать.

   Чтобы создать план службы приложений с помощью Windows уровня "бесплатный", выполните следующую команду. Используйте ту же группу ресурсов центра Интернета вещей находится в. Имя плана службы может содержать верхнего и нижнего регистров, цифры и дефисы.

   ```azurecli-interactive
   az appservice plan create --name <app service plan name> --resource-group <your resource group name> --sku FREE
   ```

2. Теперь можно Подготовьте веб-приложения в плане службы приложений. `--deployment-local-git` Параметр включает код веб-приложения и развертывания из репозитория Git на локальном компьютере. Имя вашего веб-приложения должно быть глобально уникальным и может содержать верхнего и нижнего регистров, цифры и дефисы.

   ```azurecli-interactive
   az webapp create -n <your web app name> -g <your resource group name> -p <your app service plan name> --deployment-local-git
   ```

3. Теперь добавьте параметры приложения для переменных среды, которые указывают на строку подключения центра Интернета вещей и группа потребителей концентратора событий. Отдельные параметры разделяются пробелами в `-settings` параметра. Используйте строку подключения службы для центра Интернета вещей и группы потребителей, который вы создали ранее в этом руководстве. Не заключения в кавычки значения.

   ```azurecli-interactive
   az webapp config appsettings set -n <your web app name> -g <your resource group name> --settings EventHubConsumerGroup=<your consumer group> IotHubConnectionString=<your IoT hub connection string>
   ```

4. Включить веб-сокеты протокола для веб-приложения и установите веб-приложения для получения HTTPS только запросов (HTTP-запросы перенаправляются на HTTPS).

   ```azurecli-interactive
   az webapp config set -n <your web app name> -g <your resource group name> --web-sockets-enabled true
   az webapp update -n <your web app name> -g <your resource group name> --https-only true
   ```

5. Чтобы развернуть код в службе приложений, вы используете вашей [учетные данные уровня пользователя развертывания](https://docs.microsoft.com/azure/app-service/deploy-configure-credentials). Учетные данные уровня пользователя развертывания отличаются от учетных данных Azure и используются для локального Git и FTP-развертывания для веб-приложения. После установки они допустимым для всех приложений службы приложений во всех подписках в учетной записи Azure. Если ранее вы задали учетные данные развертывания на уровне пользователя, их можно использовать.

   Если вы еще не установили ранее учетные данные развертывания на уровне пользователя или вы не помните свой пароль, выполните следующую команду. Имя пользователя развертывания должно быть уникальным в пределах Azure, и он не должен содержать "@" символ для локального репозитория Git Push-уведомлений. Когда появится запрос, введите и подтвердите новый пароль. Пароль должен содержать не менее восьми символов и включать два из трех следующих элементов: буквы, цифры и символы.

   ```azurecli-interactive
   az webapp deployment user set --user-name <your deployment user name>
   ```

6. Получите Git URL-адрес, используемый для передачи кода до службы приложений.

   ```azurecli-interactive
   az webapp deployment source config-local-git -n <your web app name> -g <your resource group name>
   ```

7. Добавьте удаленный клона, ссылающийся на репозиторий Git для веб-приложения в службе приложений. Для \<URL-адрес клона Git\>, используйте URL-адрес, возвращаемый на предыдущем шаге. Выполните следующую команду в окне командной строки.

   ```cmd
   git remote add webapp <Git clone URL>
   ```

8. Чтобы развернуть код в службе приложений, введите следующую команду в окне командной строки. Если запрашиваются учетные данные, введите учетные данные развертывания на уровне пользователя, созданной на шаге 5. Убедитесь, что вы отправляете в главную ветвь удаленной службы приложений.

    ```cmd
    git push webapp master:master
    ```

9. Ход выполнения развертывания будет обновляться в окне командной строки. Успешное развертывание будет заканчиваться строки, аналогичные приведенным ниже:

    ```cmd
    remote:
    remote: Finished successfully.
    remote: Running post deployment command(s)...
    remote: Deployment successful.
    To https://contoso-web-app-3.scm.azurewebsites.net/contoso-web-app-3.git
    6b132dd..7cbc994  master -> master
    ```

10. Выполните следующую команду, чтобы запросить состояние веб-приложения и убедитесь, что он выполняется:

    ```azurecli-interactive
    az webapp show -n <your web app name> -g <your resource group name> --query state
    ```

11. Откройте браузер и перейдите по адресу `https://<your web app name>.azurewebsites.net`. Веб-страницу, аналогичную тот, который видели при запуске веб-приложение локально отображает. Предположим, что устройства под управлением и отправляют данные, вы увидите выполнение график 50 последних температуры и влажности показания отправленного устройством.

## <a name="troubleshooting"></a>Устранение неполадок

Если вам встретится все проблемы с этим примером, повторите действия, описанные в следующих разделах. Если у вас по-прежнему есть проблемы, отправьте нам отзыв в нижней части этого раздела.

### <a name="client-issues"></a>Проблемы с клиентом

* Если устройство не отображается в списке или не graph рисуется, убедитесь, что код устройства выполняется на устройстве.

* В браузере откройте средства разработчика (многие обозреватели F12 ключ будет открыть) и найти консоль. Найдите все предупреждения или ошибки, не.

* Можно выполнять отладку клиентского скрипта в /js/chat-device-data.js.

### <a name="local-website-issues"></a>Проблемы локального веб-сайта

* Просмотрите выходные данные в окно, где вы запустили узел для выходных данных консоли.

* Отладка кода сервера, а именно server.js и /scripts/event-hub-reader.js.

### <a name="azure-app-service-issues"></a>Проблемы с Azure службы приложений

* На портале Azure перейдите к веб-приложения. В разделе **мониторинг** в левой области выберите **журналы службы приложений**. Включить **ведение журнала приложения (файловая система)** , задать **уровень** для ошибки, а затем выберите **Сохранить**. Затем откройте **поток журналов** (в разделе **мониторинг**).

* Из веб-приложения на портале Azure в разделе **средства разработки** выберите **консоли** и проверки версии node и npm с `node -v` и `npm -v`.

* Если появится сообщение об ошибке, не поиск пакета, может выполнить шаги по порядку. При развертывании сайта (с `git push`) запускается служба приложений `npm install`, выполняющемуся на основе текущей версии узла он настроил. Если это изменилось в конфигурации позже, нужно будет бессмысленным изменения в код и отправить еще раз.

## <a name="next-steps"></a>Дальнейшие действия

Вы успешно использовали веб-приложение для визуализации данных датчика, полученных в реальном времени, из Центра Интернета вещей.

Еще один способ визуализации данных из центра Интернета вещей Azure, см. в разделе [используйте Power BI для визуализации данных датчиков в реальном времени из центра Интернета вещей](iot-hub-live-data-visualization-in-power-bi.md).

[!INCLUDE [iot-hub-get-started-next-steps](../../includes/iot-hub-get-started-next-steps.md)]
