---
title: Устранение неполадок Azure IoT концентратор ошибка 401003 IoTHubнесанкционированный
description: Понять, как исправить ошибку 401003 IoTHubНесанкционированно
author: jlian
manager: briz
ms.service: iot-hub
services: iot-hub
ms.topic: troubleshooting
ms.date: 01/30/2020
ms.author: jlian
ms.openlocfilehash: d0a9f643516af5945037acb3dd1da24b06944171
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79284412"
---
# <a name="401003-iothubunauthorized"></a>401003 IoTHubUnauthorized

В этой статье описаны причины и решения **для 401003 IoTHubнесанкционированные** ошибки.

## <a name="symptoms"></a>Симптомы

### <a name="symptom-1"></a>Симптом 1

В диагностических журналах вы видите шаблон отключения устройств с **401003 IoTHubUnauthorized,** а затем **404104 DeviceConnectionClosedRemoteRemoteLy удаленно**, а затем успешно подключается вскоре после этого.

### <a name="symptom-2"></a>Симптом 2

Запросы в IoT Концентратор не сравниваются с одним из следующих сообщений об ошибках:

* Отсутствует заголовок авторизации
* IotHub\*' не содержит указанного\*устройства '
* Правило авторизации '\*не позволяет\*доступ к '
* Проверка подлинности для этого устройства, обновление токена или сертификата и повторное подключение
* Отпечаток пальца не соответствует конфигурации: Thumbprint: SHA1Hash\*, SHA2Hash ;\* Конфигурация: PrimaryThumbprint ,\*Вторичныйотбиймотпринт\*

## <a name="cause"></a>Причина

### <a name="cause-1"></a>Причина 1

В случае, если в случае сиюнт, некоторые SDK полагаются на IoT Hub, чтобы выпустить отключение, когда срок действия токена SAS истекает, чтобы знать, когда его обновить. Сооо 

1. Срок действия токена SAS истекает
1. IoT концентратор замечает истечение срока действия и отключает устройство с **помощью 401003 IoTHubUnauthorized**
1. Устройство завершает отключение с **404104 DeviceConnectionClosedУдаленно**
1. IoT SDK создает новый токен SAS
1. Устройство успешно подключается к Концентратору IoT

### <a name="cause-2"></a>Причина 2

IoT Концентратор не может проверить подлинность заголовка, правила или ключа auth.

## <a name="solution"></a>Решение

### <a name="solution-1"></a>Решение 1

При использовании IoT SDK для подключения с помощью строки подключения устройства не требуется никаких действий. IoT SDK регенерирует новый токен для повторного подключения на истечение срока действия токенов SAS. 

Если объем ошибок вызывает озабоченность, переключитесь на C SDK, который обновляет токен SAS до истечения срока действия. Кроме того, для АМЗП токен SAS может обновляться без отключения.

### <a name="solution-2"></a>Решение 2

В общем, представленное сообщение об ошибке должно объяснить, как исправить ошибку. Если по какой-либо причине у вас нет доступа к деталям сообщения об ошибке, убедитесь:

- SAS или другой маркер безопасности, который вы используете, не истек. 
- Учетные данные авторизации хорошо сформированы для протокола, который вы используете. Чтобы узнать больше, смотрите [элемент управления доступом Концентраторio](iot-hub-devguide-security.md).
- Используемое правило авторизации имеет запрошенное разрешение на операцию.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы упростить аутентификации к hub IoT, рекомендуем использовать [SDK Azure IoT.](iot-hub-devguide-sdks.md)