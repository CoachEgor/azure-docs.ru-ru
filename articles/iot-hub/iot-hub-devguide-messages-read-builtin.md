---
title: Общие сведения о встроенной конечной точке Центра Интернета вещей Azure | Документация Майкрософт
description: В этом руководстве разработчика описано, как читать сообщения, отправляемые с устройства в облако, с помощью встроенной конечной точки, совместимой с концентратором событий.
author: wesmc7777
manager: philmea
ms.author: wesmc
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.custom: amqp
ms.openlocfilehash: 169d926e466559bc83ba64ce9e976e0d725f614d
ms.sourcegitcommit: ffc6e4f37233a82fcb14deca0c47f67a7d79ce5c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81729990"
---
# <a name="read-device-to-cloud-messages-from-the-built-in-endpoint"></a>Чтение сообщений, пересылаемых с устройства в облако, из встроенной конечной точки

По умолчанию сообщения направляются во встроенную конечную точку, доступную для службы (**/messages/events**), которая совместима с [Центрами событий](https://azure.microsoft.com/documentation/services/event-hubs/). Сейчас эта конечная точка предоставляется только по протоколу [AMQP](https://www.amqp.org/) на порте 5671. Центр Интернета вещей позволяет управлять встроенной конечной точкой обмена сообщениями **messages/events**, совместимой с концентраторами событий, с помощью приведенных ниже свойств.

| Свойство.            | Описание |
| ------------------- | ----------- |
| **Количество разделов** | Это свойство задается во время создания, чтобы определить количество [разделов](../event-hubs/event-hubs-features.md#partitions) для приема событий, отправляемых с устройства в облако. |
| **Время хранения**  | Это свойство задает время в днях, в течение которого сообщения хранятся в Центре Интернета вещей. Значение по умолчанию — один день, но это значение можно увеличить до семи дней. |

IoT Концентратор позволяет хранить данные во встроенных концентрах событий не более 7 дней. Вы можете установить время удержания во время создания концентратора IoT. Время хранения данных в Концентраторе IoT зависит от уровня концентратора IoT и типа единицы. С точки зрения размера встроенные концентраторы событий могут сохранять сообщения максимального размера сообщения до не менее 24 часов квоты. Например, для 1 единицы S1 IoT Hub обеспечивает достаточное количество хранилищ для хранения не менее 400K сообщений размером 4k каждый. Если ваши устройства отправляют меньшесообщений, они могут храниться дольше (до 7 дней) в зависимости от того, сколько памяти потребляется. Мы гарантируем сохранение данных для указанного времени хранения как минимум. Срок действия сообщений истекает и будет недоступен по истечении времени хранения. 

Центр Интернета вещей также предоставляет возможность управлять группами потребителей во встроенной конечной точке, которая получает сообщения, отправляемые с устройства в облако. Вы можете иметь до 20 групп потребителей для каждого Концентратора IoT.

Если вы используете [маршрутизирование сообщений](iot-hub-devguide-messages-d2c.md) и включен [маршрут резервного](iot-hub-devguide-messages-d2c.md#fallback-route) копирования, все сообщения, не совпадающие с запросом на любом маршруте, переходят в встроенную конечную точку. Если вы отпустите этот запасной маршрут, сообщения, не совпадающие с запросом, будут удалены.

Период хранения можно изменить на [портале Azure](https://portal.azure.com) или программно (с помощью [интерфейсов REST API поставщика ресурсов Центра Интернета вещей](/rest/api/iothub/iothubresource)).

Центр Интернета вещей предоставляет встроенную конечную точку **messages/events**, с помощью которой внутренние службы считывают сообщения, отправляемые в Центр с устройства в облако. Эта конечная точка совместима с концентраторами событий, поэтому можно использовать любой из механизмов для чтения сообщений, который поддерживает служба "Центры событий".

## <a name="read-from-the-built-in-endpoint"></a>Считывание данных из встроенной конечной точки

Некоторые интеграции продуктов и SDK-центры событий знают о концентраторе IoT и позволяют использовать строку подключения к встроенной конечной точке концентратора IoT.

При использовании SDK-центров событий или интеграций продуктов, не совместимых с IoT Hub, требуется конечная точка, совместимая с Event Hub, и имя, совместимое с Event Hub. Вы можете получить эти значения с портала следующим образом:

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к концентратору IoT.

2. Щелкните **Встроенные конечные точки**.

3. Раздел **События** содержит следующие значения: **Разделы**, **Событие концентратор-совместимое имя**, Событие **концентратор-совместимый конечная точка**, Время **удержания**, и **группы потребителей**.

    ![Параметры отправки сообщений с устройства в облако](./media/iot-hub-devguide-messages-read-builtin/eventhubcompatible.png)

На портале поле конечных точек, совместимых с Event Hub, содержит полную строку соединения Концентраторов событий, которая выглядит следующим образом: **Endpoint'sb://abcd1234namespace.servicebus.windows.net/; SharedAccessKeyName-iothubowner; SharedAccessKey'keykeykeykeykeykey'; EntityПат-иотхуб-эхуб-абхд-1234-123456**. Если SDK, который вы используете, требует других значений, то они будут:

| Имя | Значение |
| ---- | ----- |
| Конечная точка | sb://abcd1234namespace.servicebus.windows.net/ |
| Имя узла | abcd1234namespace.servicebus.windows.net |
| Пространство имен | abcd1234namespace |

Затем можно использовать любую политику общего доступа с разрешениями **ServiceConnect**, которые позволяют подключаться к указанному концентратору событий.

SDKs, которые можно использовать для подключения к встроенной конечной точке концентратора событий, которую предоставляет IoT Hub, включают:

| Язык | SDK | Пример | Примечания |
| -------- | --- | ------ | ----- |
| .NET | https://github.com/Azure/azure-event-hubs-dotnet | [Краткое руководство](quickstart-send-telemetry-dotnet.md) | Использование совместимой с событиями информации |
 Java | https://github.com/Azure/azure-event-hubs-java | [Краткое руководство](quickstart-send-telemetry-java.md) | Использование совместимой с событиями информации |
| Node.js | https://github.com/Azure/azure-event-hubs-node | [Краткое руководство](quickstart-send-telemetry-node.md) | Использует строку соединения IoT Концентратор |
| Python | https://github.com/Azure/azure-event-hubs-python | https://github.com/Azure/azure-event-hubs-python/blob/master/examples/iothub_recv.py | Использует строку соединения IoT Концентратор |

Интеграции продукта, которые можно использовать со встроенной конечней точкой, совместимой с Event Hub, которую предоставляет IoT Hub, включают:

* [Функции Azure](https://docs.microsoft.com/azure/azure-functions/). Смотрите [данные обработки данных из концентратора IoT с функциями Azure.](https://azure.microsoft.com/resources/samples/functions-js-iot-hub-processing/)
* [Аналитика потоков Azure](https://docs.microsoft.com/azure/stream-analytics/). Просмотрите [данные Stream как ввод в Stream Analytics.](../stream-analytics/stream-analytics-define-inputs.md#stream-data-from-iot-hub)
* [Исследования временных рядов](https://docs.microsoft.com/azure/time-series-insights/). Добавьте [источник событий концентратора IoT в среду Time Series Insights.](../time-series-insights/time-series-insights-how-to-add-an-event-source-iothub.md)
* [Воронка Apache Storm](../hdinsight/storm/apache-storm-develop-csharp-event-hub-topology.md). Вы можете просмотреть [источник воронки](https://github.com/apache/storm/tree/master/external/storm-eventhubs) на портале GitHub.
* [интеграция Apache Spark.](../hdinsight/spark/apache-spark-eventhub-streaming.md)
* [Azure Databricks](https://docs.microsoft.com/azure/azure-databricks/).

## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о конечных точках Центра Интернета вещей см. в статье [Руководство. Конечные точки Центра Интернета вещей](iot-hub-devguide-endpoints.md).

* В [кратких руководствах](quickstart-send-telemetry-node.md) рассказывается, как отправлять сообщения с имитированных устройств в облако и читать их из встроенной конечной точки. 

Дополнительные сведения см. в руководстве [Настройка маршрутизации сообщений с Центром Интернета вещей](tutorial-routing.md).

* Сведения о перенаправлении сообщений, отправляемых с устройства в облако, на пользовательские конечные точки см. в статье [Использование правил маршрутизации и пользовательских конечных точек для сообщений, отправляемых с устройства в облако](iot-hub-devguide-messages-read-custom.md).
