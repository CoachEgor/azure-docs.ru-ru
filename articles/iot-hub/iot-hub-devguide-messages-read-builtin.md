---
title: Общие сведения о встроенной конечной точке Центра Интернета вещей Azure | Документация Майкрософт
description: В этом руководстве разработчика описано, как читать сообщения, отправляемые с устройства в облако, с помощью встроенной конечной точки, совместимой с концентратором событий.
author: wesmc7777
manager: philmea
ms.author: wesmc
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 08/08/2019
ms.openlocfilehash: e7b8f8a33b741a8dcf2d1a68ae3cf86d6e3687eb
ms.sourcegitcommit: 78ebf29ee6be84b415c558f43d34cbe1bcc0b38a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2019
ms.locfileid: "68950412"
---
# <a name="read-device-to-cloud-messages-from-the-built-in-endpoint"></a>Чтение сообщений, пересылаемых с устройства в облако, из встроенной конечной точки

По умолчанию сообщения направляются во встроенную конечную точку, доступную для службы ( **/messages/events**), которая совместима с [Центрами событий](https://azure.microsoft.com/documentation/services/event-hubs/). Сейчас эта конечная точка предоставляется только по протоколу [AMQP](https://www.amqp.org/) на порте 5671. Центр Интернета вещей позволяет управлять встроенной конечной точкой обмена сообщениями **messages/events**, совместимой с концентраторами событий, с помощью приведенных ниже свойств.

| Свойство            | Описание |
| ------------------- | ----------- |
| **Количество секций** | Это свойство задается во время создания, чтобы определить количество [разделов](../event-hubs/event-hubs-features.md#partitions) для приема событий, отправляемых с устройства в облако. |
| **Время хранения**  | Это свойство задает время в днях, в течение которого сообщения хранятся в Центре Интернета вещей. Значение по умолчанию — один день, но это значение можно увеличить до семи дней. |

Центр Интернета вещей допускает хранение данных в встроенных концентраторах событий не более 7 дней. Время хранения можно задать во время создания центра Интернета вещей. Время хранения данных в центре Интернета вещей зависит от уровня центра Интернета вещей и типа устройства. С точки зрения размера встроенные концентраторы событий могут хранить сообщения с максимальным размером не менее 24 часов квот. Например, для 1 центра Интернета вещей типа S1 предоставляет достаточно места для хранения по крайней мере 400 тыс. сообщений размером в 4 КБ. Если устройства отправляют небольшие сообщения, они могут храниться дольше (до 7 дней) в зависимости от объема используемого хранилища. Мы гарантируем сохранение данных за указанное время хранения как минимум.

Центр Интернета вещей также предоставляет возможность управлять группами потребителей во встроенной конечной точке, которая получает сообщения, отправляемые с устройства в облако. Для каждого центра Интернета вещей можно использовать до 20 групп потребителей.

Если вы используете [маршрутизацию сообщений](iot-hub-devguide-messages-d2c.md) и включен [резервный маршрут](iot-hub-devguide-messages-d2c.md#fallback-route) , все сообщения, которые не соответствуют запросу по маршруту, переходят во встроенную конечную точку. Если отключить этот резервный маршрут, то сообщения, не соответствующие ни одному из запросов, будут удалены.

Период хранения можно изменить на [портале Azure](https://portal.azure.com) или программно (с помощью [интерфейсов REST API поставщика ресурсов Центра Интернета вещей](/rest/api/iothub/iothubresource)).

Центр Интернета вещей предоставляет встроенную конечную точку **messages/events**, с помощью которой внутренние службы считывают сообщения, отправляемые в Центр с устройства в облако. Эта конечная точка совместима с концентраторами событий, поэтому можно использовать любой из механизмов для чтения сообщений, который поддерживает служба "Центры событий".

## <a name="read-from-the-built-in-endpoint"></a>Считывание данных из встроенной конечной точки

Некоторые интеграции продукта и пакеты SDK концентраторов событий знают о центре Интернета вещей и позволяют использовать строку подключения службы центра Интернета вещей для подключения к встроенной конечной точке.

При использовании пакетов SDK концентраторов событий или интеграции продуктов, которые не знаются с центром Интернета вещей, необходимо иметь совместимую с концентратором событий конечную точку и имя, совместимое с концентратором событий. Эти значения можно получить на портале следующим образом:

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему Центру Интернета вещей.

2. Щелкните **Встроенные конечные точки**.

3. Раздел **событий** содержит следующие значения. **Секции**, **имя**, совместимое с концентратором событий, **Конечная точка, совместимая с концентратором событий**, **время хранения**и **группы потребителей**.

    ![Параметры раздела "Из устройства в облако"](./media/iot-hub-devguide-messages-read-builtin/eventhubcompatible.png)

На портале поле Конечная точка, совместимое с концентратором событий, содержит полную строку подключения концентраторов событий, которая выглядит следующим образом: **Endpoint=sb://abcd1234namespace.servicebus.windows.net/;SharedAccessKeyName=iothubowner;SharedAccessKey=keykeykeykeykeykey=;EntityPath=iothub-ehub-abcd-1234-123456**. Если для пакета SDK, который вы используете, требуются другие значения, они будут выглядеть следующим образом:

| Название | Значение |
| ---- | ----- |
| Конечная точка | sb://abcd1234namespace.servicebus.windows.net/ |
| Имя узла | abcd1234namespace.servicebus.windows.net |
| Пространство имен | abcd1234namespace |

Затем можно использовать любую политику общего доступа с разрешениями **ServiceConnect**, которые позволяют подключаться к указанному концентратору событий.

Пакеты SDK, которые можно использовать для подключения к встроенной конечной точке, совместимой с концентратором событий, которые предоставляет центр Интернета вещей:

| Язык | SDK | Пример | Примечания |
| -------- | --- | ------ | ----- |
| .NET | https://github.com/Azure/azure-event-hubs-dotnet | [Краткое руководство](quickstart-send-telemetry-dotnet.md) | Использует сведения, совместимые с концентраторами событий |
 Java | https://github.com/Azure/azure-event-hubs-java | [Краткое руководство](quickstart-send-telemetry-java.md) | Использует сведения, совместимые с концентраторами событий |
| Node.js | https://github.com/Azure/azure-event-hubs-node | [Краткое руководство](quickstart-send-telemetry-node.md) | Использует строку подключения центра Интернета вещей |
| Python | https://github.com/Azure/azure-event-hubs-python | https://github.com/Azure/azure-event-hubs-python/blob/master/examples/iothub_recv.py | Использует строку подключения центра Интернета вещей |

Интеграции продукта, которые можно использовать со встроенной конечной точкой, совместимой с концентраторами событий, включают в себя:

* [Функции Azure](https://docs.microsoft.com/azure/azure-functions/). См. статью [обработка данных из центра Интернета вещей с помощью функций Azure](https://azure.microsoft.com/resources/samples/functions-js-iot-hub-processing/).
* [Azure Stream Analytics](https://docs.microsoft.com/azure/stream-analytics/). См. раздел [потоковые данные в качестве входных данных в Stream Analytics](../stream-analytics/stream-analytics-define-inputs.md#stream-data-from-iot-hub).
* [Аналитика временных рядов](https://docs.microsoft.com/azure/time-series-insights/). См. раздел [Добавление источника событий центра Интернета вещей в среду "аналитика временных рядов](../time-series-insights/time-series-insights-how-to-add-an-event-source-iothub.md)".
* [Воронка Apache Storm](../hdinsight/storm/apache-storm-develop-csharp-event-hub-topology.md). Вы можете просмотреть [источник воронки](https://github.com/apache/storm/tree/master/external/storm-eventhubs) на портале GitHub.
* [интеграция Apache Spark.](../hdinsight/spark/apache-spark-eventhub-streaming.md)
* [Azure Databricks](https://docs.microsoft.com/azure/azure-databricks/).

## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о конечных точках Центра Интернета вещей см. в статье [Руководство. Конечные точки Центра Интернета вещей](iot-hub-devguide-endpoints.md).

* В [кратких руководствах](quickstart-send-telemetry-node.md) рассказывается, как отправлять сообщения с имитированных устройств в облако и читать их из встроенной конечной точки. 

Дополнительные сведения см. в руководстве [Настройка маршрутизации сообщений с Центром Интернета вещей](tutorial-routing.md).

* Сведения о перенаправлении сообщений, отправляемых с устройства в облако, на пользовательские конечные точки см. в статье [Использование правил маршрутизации и пользовательских конечных точек для сообщений, отправляемых с устройства в облако](iot-hub-devguide-messages-read-custom.md).
