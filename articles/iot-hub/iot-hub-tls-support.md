---
title: Поддержка протокола TLS в Центре Интернета вещей Azure
description: Рекомендации по использованию безопасных TLS-подключений для связи устройств и служб с Центром Интернета вещей
services: iot-hub
author: jlian
ms.service: iot-fundamentals
ms.topic: conceptual
ms.date: 09/01/2020
ms.author: jlian
ms.openlocfilehash: 08ecb766a1a9bd7ff75bf97647be811577212eb5
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "90006046"
---
# <a name="tls-support-in-iot-hub"></a>Поддержка протокола TLS в Центре Интернета вещей

Центр Интернета вещей использует протокол TLS для защиты подключений от устройств и служб Интернета вещей. Сейчас поддерживаются три версии протокола TLS: 1.0, 1.1 и 1.2.

Протоколы TLS 1.0 и 1.1 считаются устаревшими, и в будущем их использование будет прекращено. Дополнительные сведения см. в статье [Устаревшие протоколы TLS 1.0 и 1.1 для центра Интернета вещей](iot-hub-tls-deprecating-1-0-and-1-1.md). При подключении к центру Интернета вещей настоятельно рекомендуется использовать версию TLS 1.2.

## <a name="tls-12-enforcement-available-in-select-regions"></a>Принудительное применение TLS 1,2 доступно в выбранных регионах

Для повышения безопасности настройте центры Интернета вещей, разрешающие *только* подключения клиентов, использующие TLS версии 1,2, и принудительное использование комплектов [шифров](#cipher-suites). Эта функция поддерживается только в следующих регионах:

* Восточная часть США
* Центрально-южная часть США
* западная часть США 2
* US Gov (Аризона)
* US Gov (Вирджиния)

Для этой цели подготовьте новый Центр Интернета вещей в любом из поддерживаемых регионов и задайте для свойства `minTlsVersion` значение `1.2` в спецификации ресурса Центра Интернета вещей в шаблоне Azure Resource Manager:

```json
{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "resources": [
        {
            "type": "Microsoft.Devices/IotHubs",
            "apiVersion": "2020-01-01",
            "name": "<provide-a-valid-resource-name>",
            "location": "<any-of-supported-regions-below>",
            "properties": {
                "minTlsVersion": "1.2"
            },
            "sku": {
                "name": "<your-hubs-SKU-name>",
                "tier": "<your-hubs-SKU-tier>",
                "capacity": 1
            }
        }
    ]
}
```

Созданный с такой конфигурацией ресурс Центра Интернета вещей будет отклонять попытки подключения от устройств и служб с использованием TLS версий 1.0 и 1.1. Аналогичным образом, подтверждение TLS отклоняется, если в `ClientHello` сообщении не перечислены [рекомендованные шифры](#cipher-suites).

> [!NOTE]
> Свойство `minTlsVersion` доступно только для чтения. После создания ресурса Центра Интернета вещей изменить это свойство нельзя. Поэтому важно заранее убедиться, что *все* ваши устройства и службы Интернета вещей совместимы с TLS 1.2 и [рекомендуемыми шифрами](#cipher-suites).
> 
> После отработки отказа свойство `minTlsVersion` Центра Интернета вещей останется в силе в регионе, географически связанном с исходным.

## <a name="cipher-suites"></a>Комплекты шифров

Центры Интернета вещей, настроенные на прием только TLS 1,2, также будут применять следующие Рекомендуемые комплекты шифров:

* `TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256`
* `TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384`
* `TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256`
* `TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384`

Для центров Интернета вещей, для которых не настроено принудительное применение TLS 1,2, TLS 1,2 по-прежнему работает со следующими комплектами шифров:

* `TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256`
* `TLS_DHE_RSA_WITH_AES_256_GCM_SHA384`
* `TLS_DHE_RSA_WITH_AES_128_GCM_SHA256`
* `TLS_RSA_WITH_AES_256_GCM_SHA384`
* `TLS_RSA_WITH_AES_128_GCM_SHA256`
* `TLS_RSA_WITH_AES_256_CBC_SHA256`
* `TLS_RSA_WITH_AES_128_CBC_SHA256`
* `TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA`
* `TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA`
* `TLS_RSA_WITH_AES_256_CBC_SHA`
* `TLS_RSA_WITH_AES_128_CBC_SHA`
* `TLS_RSA_WITH_3DES_EDE_CBC_SHA`

Клиент может предложить список более высоких комплектов шифров для использования во время `ClientHello` . Однако некоторые из них могут не поддерживаться центром Интернета вещей (например, `ECDHE-ECDSA-AES256-GCM-SHA384` ). В этом случае центр Интернета вещей попытается выполнить предпочтение клиента, но в конечном итоге согласовывать комплект шифров с `ServerHello` .

## <a name="use-tls-12-in-your-iot-hub-sdks"></a>Использование TLS 1.2 в пакетах SDK для Центра Интернета вещей

Используйте приведенные ниже ссылки, чтобы настроить TLS 1.2 и разрешенные шифры в пакетах SDK для клиента Центра Интернета вещей.

| Язык | Версии, поддерживающие TLS 1.2 | Документация |
|----------|------------------------------------|---------------|
| C        | Тег 2019-12-11 или более новый            | [Ссылка](https://aka.ms/Tls_C_SDK_IoT) |
| Python   | Версия 2.0.0 или более новая             | [Ссылка](https://aka.ms/Tls_Python_SDK_IoT) |
| C#       | Версия 1.21.4 или более новая            | [Ссылка](https://aka.ms/Tls_CSharp_SDK_IoT) |
| Java     | Версия 1.19.0 или более новая            | [Ссылка](https://aka.ms/Tls_Java_SDK_IoT) |
| Node.js   | Версия 1.12.2 или более новая            | [Ссылка](https://aka.ms/Tls_Node_SDK_IoT) |


## <a name="use-tls-12-in-your-iot-edge-setup"></a>Использование TLS 1.2 в конфигурации IoT Edge

Устройства IoT Edge можно настроить для использования TLS 1.2 при обмене данными с Центром Интернета вещей. Дополнительные сведения см. [на странице документации IoT Edge](https://github.com/Azure/iotedge/blob/master/edge-modules/edgehub-proxy/README.md).

## <a name="device-authentication"></a>Проверка подлинности устройства

После успешного подтверждения TLS центр Интернета вещей может проверить подлинность устройства с помощью симметричного ключа или сертификата X. 509. Для проверки подлинности на основе сертификата это может быть любой сертификат X. 509, включая ECC. Центр Интернета вещей проверяет сертификат по отпечатку или предоставленному центру сертификации. Центр Интернета вещей пока не поддерживает взаимную проверку подлинности на основе X. 509 (mTLS). Дополнительные сведения см. в разделе [Поддерживаемые сертификаты X. 509](iot-hub-devguide-security.md#supported-x509-certificates).
