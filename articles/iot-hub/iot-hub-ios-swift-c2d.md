---
title: Отправка сообщений из облака на устройство с помощью Центра Интернета вещей Azure (iOS) | Документация Майкрософт
description: Сведения об отправке сообщений из облака на устройство из Центра Интернета вещей Azure с помощью пакетов SDK для Интернета вещей Azure для iOS.
author: kgremban
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 04/19/2018
ms.author: kgremban
ms.openlocfilehash: e7e8d12af92a566753d8f3d7baf5019bae44de2c
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60398949"
---
# <a name="send-cloud-to-device-messages-with-iot-hub-ios"></a>Отправка сообщений из облака на устройство с помощью Центра Интернета вещей (iOS)

[!INCLUDE [iot-hub-selector-c2d](../../includes/iot-hub-selector-c2d.md)]

Центр Интернета вещей Azure — это полностью управляемая служба, которая обеспечивает надежный и защищенный двунаправленный обмен данными между миллионами устройств и серверной частью решения. В руководстве по [отправке данных телеметрии с устройства в Центр Интернета вещей (Swift)](quickstart-send-telemetry-ios.md) показано, как создать Центр Интернета вещей, подготовить в нем удостоверение устройства и написать код приложения для имитации устройства, которое отправляет сообщения из устройства в облако.

В этой статье описаны следующие процессы.

* Отправка сообщений, передаваемых из облака на устройство, из серверной части решения на одно устройство через Центр Интернета вещей.

* Получение на устройстве сообщений, передаваемых из облака на устройство.

* Запрос из серверной части решения подтверждения доставки (*отзыва*) для сообщений, отправленных на устройство из Центра Интернета вещей.

Дополнительные сведения о сообщениях, отправляемых из облака на устройство, см. в статье [Отправка сообщений с устройства в облако и из облака на устройство с помощью Центра Интернета вещей](iot-hub-devguide-messaging.md).

С помощью этой статьи вы запустите два проекта Swift iOS:

* приложение **sample-device**, которое вы создали при работе с руководством по [отправке данных телеметрии с устройства в Центр Интернета вещей (Swift)](quickstart-send-telemetry-ios.md) и которое подключается к Центру Интернета вещей и получает сообщения из облака на устройство;

* **sample-service**, которое отправляет сообщение из облака в приложение виртуального устройства с помощью Центра Интернета вещей, а затем получает подтверждение о его доставке.

> [!NOTE]
> В Центре Интернета вещей реализована поддержка для пакетов SDK для многих платформ устройств и языков (включая C, Java и Javascript). Эти пакеты работают на основе пакетов SDK для устройств Azure IoT. Пошаговые указания по связыванию устройства с кодом из этого руководства, а также по подключению к Центру Интернета вещей Azure см. в [центре разработчиков для Интернета вещей Azure](https://www.azure.com/develop/iot).

Для работы с этим учебником требуется:

- Активная учетная запись Azure. Если ее нет, можно создать [бесплатную учетную запись](https://azure.microsoft.com/pricing/free-trial/) всего за несколько минут.

- действующий Центр Интернета вещей в Azure; 

- пример кода из [примеров Azure](https://github.com/Azure-Samples/azure-iot-samples-ios/archive/master.zip);

- последняя версия [XCode](https://developer.apple.com/xcode/), выполняющая последнюю версию пакета SDK для iOS. Это краткое руководство протестировано с использованием версий XCode 9.3 и iOS 11.3;

- последняя версия [CocoaPods](https://guides.cocoapods.org/using/getting-started.html).

## <a name="simulate-an-iot-device"></a>Имитация устройства Интернета вещей

В этом разделе вы подготовите имитацию устройства iOS под управлением приложения Swift, которое будет получать сообщения из облака на устройство через Центр Интернета вещей. 

Это пример устройства, которое вы создали, работая со статьей [отправке данных телеметрии с устройства в Центр Интернета вещей (Swift)](quickstart-send-telemetry-ios.md). Если он у вас уже есть, можете пропустить этот раздел.

### <a name="install-cocoapods"></a>Установка CocoaPods

CocoaPods управляет зависимостями проектов iOS, которые используют сторонние библиотеки.

В окне терминала перейдите в папку Azure-IoT-Samples-iOS, скачанную на этапе подготовки. Перейдите к примеру проекта:

```sh
cd quickstart/sample-device
```

Убедитесь, что XCode закрыт, а затем выполните следующую команду, чтобы установить CocoaPods, объявленный в файле **podfile**:

```sh
pod install
```

Вместе с установкой модулей, необходимых для проекта, команда установки также создает файл рабочей области XCode, который уже настроен для использования pod с зависимостями. 

### <a name="run-the-sample-device-application"></a>Запуск примера приложения устройства 

1. Получите строку подключения к устройству. Эту строку можно скопировать на [портале Azure](https://portal.azure.com) из колонки сведений об устройстве или получить с помощью следующей команды CLI. 

    ```azurecli-interactive
    az iot hub device-identity show-connection-string --hub-name {YourIoTHubName} --device-id {YourDeviceID} --output table
    ```

1. Откройте пример рабочей области в XCode.

   ```sh
   open "MQTT Client Sample.xcworkspace"
   ```

2. Разверните проект **Пример клиента MQTT**, а затем папку с таким же именем.  

3. Откройте **ViewController.swift** для редактирования в XCode. 

4. Найдите переменную **connectionString** и замените ее значение строкой подключения к устройству, которую вы скопировали на первом шаге.

5. Сохраните изменения. 

6. Выполните проект в эмуляторе устройства, нажав кнопку **Сборка и запуск** или клавиши **COMMAND+R**. 

   ![Запуск проекта](media/iot-hub-ios-swift-c2d/run-sample.png)

## <a name="simulate-a-service-device"></a>Эмуляция устройства службы

В этом разделе вы подготовите эмуляцию второго устройства iOS с приложением Swift, которое отправляет сообщения из облака на устройство через Центр Интернета вещей. Такая конфигурация удобна для сценариев Интернета вещей, в которых устройство iPhone или iPad выполняет роль контроллера для других устройств под управлением iOS, подключенных к Центру Интернета вещей. 

### <a name="install-cocoapods"></a>Установка CocoaPods

CocoaPods управляет зависимостями проектов iOS, которые используют сторонние библиотеки.

Перейдите в папку примеров Интернета вещей Azure для iOS, которую вы скачали на этапе подготовки. Перейдите к примеру проекта службы:

```sh
cd quickstart/sample-service
```

Убедитесь, что XCode закрыт, а затем выполните следующую команду, чтобы установить CocoaPods, объявленный в файле **podfile**:

```sh
pod install
```

Вместе с установкой модулей, необходимых для проекта, команда установки также создает файл рабочей области XCode, который уже настроен для использования pod с зависимостями.

### <a name="run-the-sample-service-application"></a>Запуск примера приложения службы

1. Получите строку подключения к службе для Центра Интернета вещей. Эту строку можно скопировать на [портале Azure](https://portal.azure.com) из политики **iothubowner** в колонке **Политики общего доступ**а или получить с помощью следующей команды CLI.  

    ```azurecli-interactive
    az iot hub show-connection-string --name {YourIoTHubName} --output table
    ```

2. Откройте пример рабочей области в XCode.

   ```sh
   open AzureIoTServiceSample.xcworkspace
   ```

3. Разверните проект **AzureIoTServiceSample**, а затем разверните папку с тем же именем.  

4. Откройте **ViewController.swift** для редактирования в XCode. 

5. Найдите переменную **connectionString** и замените ее значение строкой подключения к службе, которую вы скопировали ранее.

6. Сохраните изменения. 

7. В Xcode измените параметры эмулятора, чтобы это устройство iOS отличалось от того, на котором выполняется устройство Интернета вещей. XCode не может выполнять несколько эмуляторов одного типа. 

   ![Изменение эмулируемого устройства](media/iot-hub-ios-swift-c2d/change-device.png)

8. Выполните проект в эмуляторе устройства, нажав кнопку **Сборка и запуск** или клавиши **COMMAND+R**. 

   ![Запуск проекта](media/iot-hub-ios-swift-c2d/run-app.png)

## <a name="send-a-cloud-to-device-message"></a>Отправка сообщения из облака на устройство

Теперь вы готовы выполнять два приложения для отправки и получения сообщений из облака на устройство.

1. В приложении **пример приложения iOS**, которое работает на эмулированном устройстве Интернета вещей, щелкните **Запустить**. Приложение сразу начинает отправлять сообщения из устройства в облако, а также прослушивать поступающие сообщения из облака. 

   ![Просмотр примера приложения для устройства Интернета вещей](media/iot-hub-ios-swift-c2d/view-d2c.png)

2. В приложении **Пример клиента службы Центра Интернета вещей**, которое выполняется на имитированном устройстве службы, введите идентификатор того устройства Интернета вещей, на которое вы хотите отправить сообщение. 

3. Создайте сообщение с открытым текстом и щелкните **Отправить**. 

    При нажатии кнопки отправки одновременно выполняются несколько действий. Пример службы отправляет сообщение в Центр Интернета вещей, доступ к которому предоставляет указанная вами строка подключения. Центр Интернета вещей проверяет идентификатор устройства, отправляет сообщение на целевое устройство и возвращает подтверждающее уведомление на исходное устройство. Приложение, работающее на эмулированном устройстве Интернета вещей, проверяет сообщения от Центра Интернета вещей и выводит на экран самое свежее из них.

    Полученный результат должен выглядеть примерно так:

   ![Просмотр сообщений из облака на устройство](media/iot-hub-ios-swift-c2d/view-c2d.png)


## <a name="next-steps"></a>Дальнейшие действия

В этом учебнике вы научились отправлять и получать сообщения с облака на устройство. 

Примеры комплексных решений, в которых используется центр Интернета вещей, см. в [Документации по акселераторам решений Интернета вещей](https://azure.microsoft.com/documentation/suites/iot-suite/).

Дополнительные сведения о разработке решений с помощью Центра Интернета вещей см. в [руководстве разработчика для Центра Интернета вещей](iot-hub-devguide.md).
