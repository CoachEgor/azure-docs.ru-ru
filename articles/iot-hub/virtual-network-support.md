---
title: Поддержка центра Azure IoT для виртуальных сетей
description: Как использовать шаблон подключения виртуальных сетей с IoT Концентратор
services: iot-hub
author: rezasherafat
ms.service: iot-fundamentals
ms.topic: conceptual
ms.date: 03/13/2020
ms.author: rezas
ms.openlocfilehash: 34f66c13b0e7eb7092332a48744f9abfd8f0db80
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79501434"
---
# <a name="iot-hub-support-for-virtual-networks"></a>Поддержка ioT концентратора для виртуальных сетей

В этой статье представлен шаблон подключения VNET и подробно рассказывается о том, как настроить личный опыт подключения к концентратору IoT через принадлежащий клиенту Azure VNET.

> [!NOTE]
> Функции IoT Hub, описанные в этой статье, в настоящее время доступны для концентраторов IoT, [созданных с управляемой идентификацией службы](#create-an-iot-hub-with-managed-service-identity) в следующих регионах: Восточная часть США, южная центральная часть США и Западная часть США 2.


## <a name="introduction"></a>Вступление

По умолчанию хост-имена IoT Hub отображаются в общедоступной конечной точке с общедоступным IP-адресом через Интернет. Как показано на рисунке ниже, эта публичная конечная точка IoT Hub распределяется между концентраторами, принадлежащими различным клиентам, и может быть доступна устройствами IoT как в широких сетях, так и в электрических сетях.

Некоторые функции Концентратора IoT, включая [разгром сообщений,](./iot-hub-devguide-messages-d2c.md) [загрузку файлов](./iot-hub-devguide-file-upload.md)и [импорт/экспорт объемных устройств,](./iot-hub-bulk-identity-mgmt.md) также требуют подключения от Концентратора IoT к ресурсу Azure, принадлежащему клиенту, через общедоступную точку. Как показано ниже, эти пути подключения в совокупности представляют собой трафик от IoT Hub к ресурсам клиентов.
![Публичная конечная точка IoT Концентратора](./media/virtual-network-support/public-endpoint.png)


По ряду причин клиенты могут захотеть ограничить подключение к своим ресурсам Azure (включая IoT Hub) через VNET, которым они владеют и эксплуатируют. Эти причины включают в себя:

* Введение дополнительных уровней безопасности через изоляцию сетевого уровня для вашего концентратора IoT, предотвращая доступ к концентратору через общедоступный Интернет.

* Включение частного опыта подключения из ваших локальной сети активов, обеспечивающих передачу данных и трафика непосредственно в магистральной сети Azure.

* Предотвращение эксфильтрационных атак из чувствительных сетей. 

* После установленных шаблонов подключения в масштабах всей Azure с использованием [частных конечных точек.](../private-link/private-endpoint-overview.md)


В этой статье описывается, как достичь этих целей с помощью [частных конечных точек](../private-link/private-endpoint-overview.md) для входа в концентратор IoT, так как использование Azure доверенное исключение служб первой стороны для подключения из Концентратора IoT в другие ресурсы Azure.


## <a name="ingress-connectivity-to-iot-hub-using-private-endpoints"></a>Подключение к IoT Hub с использованием частных конечных точек

Частная конечная точка — это частный IP-адрес, выделенный внутри принадлежащего клиенту VNET, с помощью которого можно дотянуться с ресурсом Azure. Имея частную конечную точку для вашего концентратора IoT, вы сможете разрешить службам, работающим внутри VNET, достичь Концентратора IoT, не требуя отправки трафика в публичную конечную точку IoT Hub. Аналогичным образом, устройства, работающие в вашем помещении, могут использовать [Virtual Private Network (VPN)](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) или [ExpressRoute](https://azure.microsoft.com/services/expressroute/) Private Peering для подключения к VNET в Azure, а затем к вашему концентратору IoT (через его частную конечную точку). В результате клиенты, желающие ограничить подключение к общедоступным конечным точкам концентратора IoT (или, возможно, полностью заблокировать его), могут достичь этой цели, используя [правила брандмауэра IoT Hub,](./iot-hub-ip-filtering.md) сохраняя при этом подключение к своему концентратору с помощью частной конечной точки.

> [!NOTE]
> Основное внимание в этой установке уделяется устройствам внутри внутренней сети. Эта настройка не рекомендуется для устройств, развернутых в широкой сети.

![Публичная конечная точка IoT Концентратора](./media/virtual-network-support/virtual-network-ingress.png)

Прежде чем приступить к работе, убедитесь, что следующие предпосылки выполнены:

* Ваш концентратор IoT должен быть оснащен [управляемой идентификацией службы.](#create-an-iot-hub-with-managed-service-identity)

* Ваш концентратор IoT должен быть подготовлен в одном из [поддерживаемых регионов.](#regional-availability-private-endpoints)

* Вы создали Azure VNET с подсетью, в которой будет создана частная конечная точка. Для получения более подробной информации смотрите [создание виртуальной сети с использованием Azure CLI.](../virtual-network/quick-create-cli.md)

* Для устройств, работающих внутри закрытых сетей, установите [виртуальную частную сеть (VPN)](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) или [ExpressRoute](https://azure.microsoft.com/services/expressroute/) private, вглядываясь в ваш Azure VNET.


### <a name="regional-availability-private-endpoints"></a>Региональная доступность (частные конечные точки)

Частные конечные точки, поддерживаемые в IoT Hub, созданных в следующих регионах:

* Восточная часть США

* Центрально-южная часть США

* западная часть США 2


### <a name="set-up-a-private-endpoint-for-iot-hub-ingress"></a>Настройка частной конечной точки для входа концентратора IoT

Чтобы настроить частную конечную точку, выполните следующие действия:

1. Запустите следующую команду Azure CLI для перерегистрации поставщика Azure IoT Hub с подпиской:

    ```azurecli-interactive
    az provider register --namespace Microsoft.Devices --wait --subscription  <subscription-name>
    ```

2. Перейдите на вкладку **Приватная конечная точка на** портале IoT Hub (эта вкладка доступна **+** только для концентраторов IoT в [поддерживаемых регионах)](#regional-availability-private-endpoints)и нажмите на знак, чтобы добавить новую частную конечную точку.

3. Предоставьте подписку, группу ресурсов, имя и регион для создания новой частной конечной точки (в идеале частная конечная точка должна быть создана в том же регионе, что и ваш концентратор; см. [раздел региональной доступности](#regional-availability-private-endpoints) для более подробной информации).

4. Нажмите **далее: Ресурс**и предоставьте подписку на ресурс IoT Hub, а также выберите **"Microsoft.Devices/IotHubs"** в качестве типа ресурса, имя IoT Hub как **ресурс**а **также iotHub** в качестве целевого субресурса.

5. Нажмите **далее: Конфигурация** и обеспечить виртуальную сеть и подсеть для создания частной точки конца дюйма При желании выберите опцию интеграции с частной DNS-зоной Azure.

6. Нажмите **далее: Теги**и опционально предоставьте любые теги для вашего ресурса.

7. Нажмите **Обзор и создать** для создания вашего частного ресурса конечных точек.


### <a name="pricing-private-endpoints"></a>Ценообразование (частные конечные точки)

Дополнительные сведения о ценах см. на [странице цен на службу "Приватный канал" Azure](https://azure.microsoft.com/pricing/details/private-link).


## <a name="egress-connectivity-from-iot-hub-to-other-azure-resources"></a>Подключение к выходу из концентратора IoT в другие ресурсы Azure

IoT концентратору необходим доступ к хранилищу Azure blob, концентратам событий, ресурсам шины обслуживания для [передачи сообщений,](./iot-hub-devguide-messages-d2c.md) [загрузке файлов](./iot-hub-devguide-file-upload.md)и [массовому импорту/экспорту устройств,](./iot-hub-bulk-identity-mgmt.md)что обычно происходит над общедоступной конечной точкой ресурсов. В случае, если вы привяжете учетную запись хранения, концентраторы событий или ресурс шины обслуживания к VNET, рекомендуемая конфигурация блокирует подключение к ресурсу по умолчанию. Следовательно, это будет препятствовать функциональности IoT концентратора, который требует доступа к этим ресурсам.

Чтобы облегчить эту ситуацию, необходимо включить подключение с ресурса IoT Hub к учетной записи хранения, концентратам событий или ресурсам автобусов обслуживания через опцию **доверенных служб Первой стороны Azure.**

Необходимые условия таковы:

* Ваш концентратор IoT должен быть подготовлен в одном из [поддерживаемых регионов.](#regional-availability-trusted-microsoft-first-party-services)

* Ваш концентратор IoT должен быть назначен итого управляемого сервиса во время подготовки концентратора. Следуйте инструкциям о том, как [создать концентратор с управляемой итог службы.](#create-an-iot-hub-with-managed-service-identity)


### <a name="regional-availability-trusted-microsoft-first-party-services"></a>Региональная доступность (доверенные службы первой партии Майкрософт)

Azure доверила первое исключение для обслуживания групп, чтобы обойти ограничения брандмауэра для хранения, узлов событий и ресурсов автобусов обслуживания, поддерживается только для концентраторов IoT в следующих регионах:

* Восточная часть США

* Центрально-южная часть США

* западная часть США 2


### <a name="pricing-trusted-microsoft-first-party-services"></a>Ценообразование (доверенные службы первой партии Microsoft)

Доверенная функция исключения первых партийных служб Microsoft бесплатна в концентрах IoT в [поддерживаемых регионах.](#regional-availability-trusted-microsoft-first-party-services) Сборы за подготовленные учетные записи хранения, концентраторы событий или ресурсы служебных автобусов применяются отдельно.


### <a name="create-an-iot-hub-with-managed-service-identity"></a>Создание концентратора IoT с интилитацией управляемых служб

Итика управляемой службы может быть назначена концентратору во время подготовки ресурсов (эта функция в настоящее время не поддерживается для существующих концентраторов), что требует от концентратора IoT использовать TLS 1.2 в качестве минимальной версии. Для этого необходимо использовать шаблон ресурсов ARM ниже:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Devices/IotHubs",
      "apiVersion": "2020-03-01",
      "name": "<provide-a-valid-resource-name>",
      "location": "<any-of-supported-regions>",
      "identity": {
        "type": "SystemAssigned"
      },
      "properties": {
        "minTlsVersion": "1.2"
      },
      "sku": {
        "name": "<your-hubs-SKU-name>",
        "tier": "<your-hubs-SKU-tier>",
        "capacity": 1
      }
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2018-02-01",
      "name": "updateIotHubWithKeyEncryptionKey",
      "dependsOn": [
        "<provide-a-valid-resource-name>"
      ],
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "0.9.0.0",
          "resources": [
            {
              "type": "Microsoft.Devices/IotHubs",
              "apiVersion": "2020-03-01",
              "name": "<provide-a-valid-resource-name>",
              "location": "<any-of-supported-regions>",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "minTlsVersion": "1.2"
              },
              "sku": {
                "name": "<your-hubs-SKU-name>",
                "tier": "<your-hubs-SKU-tier>",
                "capacity": 1
              }
            }
          ]
        }
      }
    }
  ]
}
```

После замены значений для `name`ресурса `location` `SKU.name` можно `SKU.tier`использовать Azure CLI для развертывания ресурса в существующей группе ресурсов с использованием:

```azurecli-interactive
az group deployment create --name <deployment-name> --resource-group <resource-group-name> --template-file <template-file.json>
```

После создания ресурса можно получить удостоверение управляемой службы, назначенное концентратору, с помощью Azure CLI:

```azurecli-interactive
az resource show --resource-type Microsoft.Devices/IotHubs --name <iot-hub-resource-name> --resource-group <resource-group-name>
```

После того, как IoT Концентратор с управляемой идентификатор службы provisioned, следуйте соответствующему разделу для настройки конечных точек трассировки для [учетных записей хранения,](#egress-connectivity-to-storage-account-endpoints-for-routing) [узлов событий](#egress-connectivity-to-event-hubs-endpoints-for-routing)и ресурсов [шины обслуживания,](#egress-connectivity-to-service-bus-endpoints-for-routing) или для настройки [загрузки файлов](#egress-connectivity-to-storage-accounts-for-file-upload) и массового [импорта/экспорта устройств.](#egress-connectivity-to-storage-accounts-for-bulk-device-importexport)


### <a name="egress-connectivity-to-storage-account-endpoints-for-routing"></a>Подключение к конечному пункту учетной записи хранилища для разгрома

Концентратор IoT можно настроить для направления сообщений на учетную запись хранения, принадлежащую клиенту. Чтобы позволить функциональности разгрома получить доступ к учетной записи хранилища во время ограничения брандмауэра, концентратор Уот должен иметь управляемую идентификацию службы (см., как [создать концентратор с управляемой интилитацией службы).](#create-an-iot-hub-with-managed-service-identity) После того, как будет подготовлена идентированная учетная запись управляемой службы, выполните ниже те шаги, чтобы дать RBAC разрешение ресурсной идентификации вашего концентратора для доступа к учетной записи хранилища.

1. На портале Azure перейдите на вкладку управления доступом учетной записи **(IAM)** учетной записи и нажмите **«Добавить»** под **разделом «Добавить назначение ролей».**

2. Выберите **Assigning access to** **Вкачестве** **пользователя,** **группы или службы Пользователя, группы или службы** И выберите имя ресурса IoT Hub в списке отсева. Нажмите кнопку **Сохранить**.

3. Перейдите на вкладку **Firewalls и виртуальных сетей** в учетной записи хранилища и включите **возможность доступа из выбранных сетей.** В списке **исключений** проверьте поле для **служб Microsoft Allow, чтобы получить доступ к этой учетной записи хранилища.** Нажмите кнопку **Сохранить**.

4. На странице ресурса Концентратора IoT перейдите на вкладку **«Сообщение».**

5. Перейдите в **раздел пользовательских конечных точек** и нажмите **Добавить**. Выберите **хранилище** в качестве типа конечных точек.

6. На странице, которая появляется, укажите имя для вашей конечной точки, выберите контейнер, который вы собираетесь использовать в вашем хранилище капли, обеспечить кодирование, и формат имени файла. Выберите **систему, назначенную** в качестве **типа аутентификации** в конечную точку хранилища. Нажмите кнопку **Создать**.

Теперь ваша конечная точка пользовательского хранилища настроена для использования назначенной системой концентратора и имеет разрешение на доступ к ресурсу хранения, несмотря на ограничения брандмауэра. Теперь эту конечную точку можно использовать для настройки правила смиливания.


### <a name="egress-connectivity-to-event-hubs-endpoints-for-routing"></a>Подключение к конечным точкам концентраторов событий для разгрома

Концентратор IoT можно настроить для направления сообщений в пространство имен центров событий, принадлежащее клиенту. Чтобы позволить функциональности разгрома получить доступ к ресурсу концентраторов событий, в то время как ограничения брандмауэра действуют, концентратор IoT должен иметь управляемую идентификацию службы (см., как [создать концентратор с управляемой интектором службы).](#create-an-iot-hub-with-managed-service-identity) После того, как будет подготовлена идентированная удостоверение управляемой службы, выполните ниже те шаги, чтобы дать rBAC разрешение ресурсной идентификации вашего концентратора для доступа к концентратам событий.

1. На портале Azure перейдите на вкладку управления **доступом (IAM)** к центров событий и нажмите **«Добавить»** под **разделом «Добавить назначение ролей».**

2. Выберите **отправителя данных концентратов событий** в качестве **роли,** **пользователя, группы или службы Azure, как** **назначение доступа к** и выберите имя ресурса Концентратора IoT в списке отсева. Нажмите кнопку **Сохранить**.

3. Перейдите к **вкладке Firewalls и виртуальных сетей** в концентратах событий и включите **возможность доступа из выбранных сетей.** В списке **исключений** проверьте поле для **служб Microsoft Allow, которые будут доступны для доступа к концентратам событий.** Нажмите кнопку **Сохранить**.

4. На странице ресурса Концентратора IoT перейдите на вкладку **«Сообщение».**

5. Перейдите в **раздел пользовательских конечных точек** и нажмите **Добавить**. Выберите **концентраторы событий** в качестве типа конечных точек.

6. На странице, которая появляется, укажите имя для вашей конечной точки, выберите пространство имен и экземпляра концентраторов событий и нажмите кнопку **«Создание».**

Теперь конечная точка пользовательских концентратов событий настроена для использования назначенной системой концентратора и имеет разрешение на доступ к ресурсу концентратов событий, несмотря на ограничения брандмауэра. Теперь эту конечную точку можно использовать для настройки правила смиливания.


### <a name="egress-connectivity-to-service-bus-endpoints-for-routing"></a>Подключение к сети в конечные точки обслуживания автобуса для разгрома

Концентратор IoT может быть настроен для направления сообщений в пространство имен, находящихся в принадлежащем клиенту, в эксплуатацию. Чтобы позволить функциональности routing получить доступ к ресурсу шины обслуживания, в то время как ограничения брандмауэра на месте, ваш концентратор IoT должен иметь управляемую идентификацию службы (см., как [создать концентратор с управляемой интектором службы).](#create-an-iot-hub-with-managed-service-identity) После того, как будет подготовлена идентированная удостоверение управляемой службы, выполните ниже те шаги, чтобы дать rBAC разрешение ресурсной идентификации вашего концентратора для доступа к вашему сервис-автобусу.

1. На портале Azure перейдите на вкладку управления доступом вашего автобуса **(IAM)** и нажмите **«Добавить»** под **разделом «Добавить назначение ролей».**

2. Выберите **диспетчера данных службв** в качестве **роли** **пользователя, группы или службы пользователя Azure AD,** как **назначение доступа к** и выберите имя ресурса Концентри IoT в списке выпадающих. Нажмите кнопку **Сохранить**.

3. Перейдите к **вкладке Firewalls и виртуальных сетей** в вашем сервисном автобусе и включите **доступ из выбранных сетей.** В списке **исключений** проверьте поле для **доступных служб Майкрософт для доступа к этому сервису.** Нажмите кнопку **Сохранить**.

4. На странице ресурса Концентратора IoT перейдите на вкладку **«Сообщение».**

5. Перейдите в **раздел пользовательских конечных точек** и нажмите **Добавить**. Выберите в качестве типа конечных точек **очередь в автобус службы** или тему автобуса **обслуживания** (по мере необходимости).

6. На странице, которая появляется, укажите имя для вашей конечной точки, выберите пространство имени автобуса обслуживания и очередь или тему (при необходимости). Нажмите кнопку **Создать**.

Теперь ваша конечная точка пользовательского автобуса службы настроена для использования назначенной системой вашего концентратора удостоверения личности, и у нее есть разрешение на доступ к ресурсу шины обслуживания, несмотря на ограничения брандмауэра. Теперь эту конечную точку можно использовать для настройки правила смиливания.


### <a name="egress-connectivity-to-storage-accounts-for-file-upload"></a>Подключение к учетным записям хранения для загрузки файлов

Функция загрузки файлов IoT Hub позволяет устройствам загружать файлы на учетную запись хранения, принадлежащую клиенту. Чтобы загрузить файл в работу, оба устройства и Концентратор IoT должны иметь подключение к учетной записи хранилища. Если ограничения брандмауэра действуют в учетной записи хранилища, для получения подключения необходимо использовать любой из механизма поддерживаемой учетной записи хранилища (включая [частные конечные точки,](../private-link/create-private-endpoint-storage-portal.md) [конечные точки обслуживания](../virtual-network/virtual-network-service-endpoints-overview.md) или [прямую конфигурацию брандмауэра).](../storage/common/storage-network-security.md) Аналогичным образом, если в учетной записи хранилища действуют ограничения на брандмауэр, концентратор IoT должен быть настроен для доступа к ресурсу хранилища через надежное исключение служб Майкрософт. Для этого ваш концентратор IoT должен иметь удостоверение службы с управлением (см., как [создать концентратор с итог управляемой службы).](#create-an-iot-hub-with-managed-service-identity) После того, как будет подготовлена идентированная учетная запись управляемой службы, выполните ниже те шаги, чтобы дать RBAC разрешение ресурсной идентификации вашего концентратора для доступа к учетной записи хранилища.

1. На портале Azure перейдите на вкладку управления доступом учетной записи **(IAM)** учетной записи и нажмите **«Добавить»** под **разделом «Добавить назначение ролей».**

2. Выберите **Assigning access to** **Вкачестве** **пользователя,** **группы или службы Пользователя, группы или службы** И выберите имя ресурса IoT Hub в списке отсева. Нажмите кнопку **Сохранить**.

3. Перейдите на вкладку **Firewalls и виртуальных сетей** в учетной записи хранилища и включите **возможность доступа из выбранных сетей.** В списке **исключений** проверьте поле для **служб Microsoft Allow, чтобы получить доступ к этой учетной записи хранилища.** Нажмите кнопку **Сохранить**.

4. На странице ресурса IoT Hub перейдите на вкладку **Загрузить файл.**

5. На странице, которая появляется, выберите контейнер, который вы собираетесь использовать в вашем хранилище капли, настроить **настройки уведомления файла**, **SAS TTL**, **по умолчанию TTL** и **Максимальная поставка рассчитывать** по желанию. Выберите **систему, назначенную** в качестве **типа аутентификации** в конечную точку хранилища. Нажмите кнопку **Создать**.

Теперь конечная точка хранения для загрузки файлов настроена на использование назначенной системой концентратора и имеет разрешение на доступ к ресурсу хранения, несмотря на ограничения брандмауэра.


### <a name="egress-connectivity-to-storage-accounts-for-bulk-device-importexport"></a>Подключение к хранению накопителя хищных устройств учитывает импорт/экспорт оптовых устройств

IoT Концентратор поддерживает функциональность [для импорта/экспорта](./iot-hub-bulk-identity-mgmt.md) устройств навалом от/к каплей хранения, предоставленной заказчиком. Для того чтобы функция функции массового импорта/экспорта навалом функционировала, оба устройства и концентратор IoT должны иметь подключение к учетной записи хранилища.

Эта функциональность требует подключения от Концентратора IoT к учетной записи хранилища. Чтобы получить доступ к ресурсу шины обслуживания, пока действуют ограничения брандмауэра, концентратору IoT необходимо иметь управляемую идентификацию службы (см., как [создать концентратор с управляемой интилитацией службы).](#create-an-iot-hub-with-managed-service-identity) После того, как будет подготовлена идентированная удостоверение управляемой службы, выполните ниже те шаги, чтобы дать rBAC разрешение ресурсной идентификации вашего концентратора для доступа к вашему сервис-автобусу.

1. На портале Azure перейдите на вкладку управления доступом учетной записи **(IAM)** учетной записи и нажмите **«Добавить»** под **разделом «Добавить назначение ролей».**

2. Выберите **Assigning access to** **Вкачестве** **пользователя,** **группы или службы Пользователя, группы или службы** И выберите имя ресурса IoT Hub в списке отсева. Нажмите кнопку **Сохранить**.

3. Перейдите на вкладку **Firewalls и виртуальных сетей** в учетной записи хранилища и включите **возможность доступа из выбранных сетей.** В списке **исключений** проверьте поле для **служб Microsoft Allow, чтобы получить доступ к этой учетной записи хранилища.** Нажмите кнопку **Сохранить**.

Теперь можно использовать API Azure IoT REST для создания рабочих мест для [экспорта импорта](https://docs.microsoft.com/rest/api/iothub/service/jobclient/getimportexportjobs) для получения информации о том, как использовать функцию импорта/экспорта навалом. Обратите внимание, что вам `storageAuthenticationType="identityBased"` нужно будет предоставить в вашем органе запроса и использовать `inputBlobContainerUri="https://..."` и `outputBlobContainerUri="https://..."` как ввод и выходные URL вашей учетной записи хранения, соответственно.


Azure IoT Hub SDK также поддерживает эту функциональность в менеджере реестра клиентов службы. Следующий фрагмент кода показывает, как инициировать работу импорта или экспортировать работу в использовании SDK C.

```csharp
// Call an import job on the IoT Hub
JobProperties importJob = 
await registryManager.ImportDevicesAsync(
  JobProperties.CreateForImportJob(inputBlobContainerUri, outputBlobContainerUri, null, StorageAuthenticationType.IdentityBased), 
  cancellationToken);

// Call an export job on the IoT Hub to retrieve all devices
JobProperties exportJob = 
await registryManager.ExportDevicesAsync(
    JobProperties.CreateForExportJob(outputBlobContainerUri, true, null, StorageAuthenticationType.IdentityBased),
    cancellationToken);
```


Использовать эту ограниченную по регионам версию SDK Azure IoT с виртуальной сетевой поддержкой для C-, Java и Node.js:

1. Создайте переменную `EnableStorageIdentity` среды, `1`названную и установите ее значение.

2. Скачать SDK: [Java](https://aka.ms/vnetjavasdk) | [C е](https://aka.ms/vnetcsharpsdk) | [Node.js](https://aka.ms/vnetnodesdk)
 
Для Python загрузите нашу ограниченную версию с GitHub.

1. Перейдите на [страницу релиза GitHub](https://aka.ms/vnetpythonsdk).

2. Скачать следующий файл, который вы найдете в нижней части страницы релиза под заголовком **названных активов.**
    > *azure_iot_hub-2.2.0_limited-py2.py3-none-any.whl*

3. Откройте терминал и перейдите в папку с загруженным файлом.

4. Выполнить следующую команду для установки Службы Python SDK с поддержкой виртуальных сетей:
    > установка пипса ./azure_iot_hub-2.2.0_limited-py2.py3-none-any.whl


## <a name="next-steps"></a>Дальнейшие действия

Используйте ссылки ниже, чтобы узнать больше о функциях IoT концентратора:

* [Маршрутизация сообщений](./iot-hub-devguide-messages-d2c.md)
* [Передача файла](./iot-hub-devguide-file-upload.md)
* [Массовый импорт/экспорт устройств](./iot-hub-bulk-identity-mgmt.md) 
