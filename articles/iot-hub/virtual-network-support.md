---
title: Поддержка виртуальных сетей в центре Интернета вещей Azure
description: Использование шаблона подключения к виртуальным сетям с помощью центра Интернета вещей
services: iot-hub
author: jlian
ms.service: iot-fundamentals
ms.topic: conceptual
ms.date: 04/28/2020
ms.author: jlian
ms.openlocfilehash: c0d01ae6507864373a79282476846d6f96adf83b
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82231447"
---
# <a name="iot-hub-support-for-virtual-networks"></a>Поддержка виртуальных сетей в центре Интернета вещей

В этой статье рассказывается о шаблоне подключения к виртуальной сети и подробно описано, как настроить частное подключение к центру Интернета вещей с помощью виртуальной сети Azure, принадлежащей клиенту.

> [!NOTE]
> Функции центра Интернета вещей, описанные в этой статье, сейчас доступны для центров Интернета вещей, [созданных с помощью управляемого удостоверения службы](#create-an-iot-hub-with-managed-service-identity) , в следующих регионах: Восточная часть США, Юго-Центральный регион США и Западная часть США 2.


## <a name="introduction"></a>Введение

По умолчанию имена узлов центра Интернета вещей сопоставляются с общедоступной конечной точкой с общедоступным IP-адресом через Интернет. Как показано на рисунке ниже, общедоступная конечная точка центра Интернета вещей совместно используется концентраторами, принадлежащими разным клиентам, и к ним могут обращаться устройства Интернета вещей по глобальным сетям, а также к локальным сетям.

Некоторые функции центра Интернета вещей, включая [маршрутизацию сообщений](./iot-hub-devguide-messages-d2c.md), [передачу файлов](./iot-hub-devguide-file-upload.md)и [Импорт/экспорт устройств](./iot-hub-bulk-identity-mgmt.md) , аналогично необходимы для подключения из центра Интернета вещей к ресурсу Azure, принадлежащему клиенту, через общедоступную конечную точку. Как показано ниже, эти пути подключения собираются исходящий трафик из центра Интернета вещей в ресурсы клиента.
![Общедоступная конечная точка центра Интернета вещей](./media/virtual-network-support/public-endpoint.png)


По нескольким причинам клиентам может потребоваться ограничить возможности подключения к своим ресурсам Azure (включая центр Интернета вещей) через виртуальную сеть, которую они владеют и используют. К таким причинам относятся:

* Предоставление дополнительных уровней безопасности с помощью изоляции на уровне сети для центра Интернета вещей за счет предотвращения подключения к концентратору через общедоступный Интернет.

* Включение частного подключения из локальных сетевых ресурсов, гарантирующих передачу данных и трафика непосредственно в магистральную сеть Azure.

* Предотвращение атак утечка из конфиденциальных локальных сетей. 

* После установки шаблонов подключения на уровне Azure с помощью [частных конечных точек](../private-link/private-endpoint-overview.md).


В этой статье описывается, как достичь этих целей с помощью [частных конечных точек](../private-link/private-endpoint-overview.md) для входящего подключения к центру Интернета вещей, так как для исходящего подключения из центра Интернета вещей к другим ресурсам Azure используется исключение служб Azure Trusted First.


## <a name="ingress-connectivity-to-iot-hub-using-private-endpoints"></a>Входящее подключение к центру Интернета вещей с помощью частных конечных точек

Частная конечная точка — это частный IP-адрес, выделенный внутри виртуальной сети клиента, с помощью которого ресурс Azure становится доступным. Имея закрытую конечную точку для центра Интернета вещей, вы сможете разрешить службам, работающим внутри виртуальной сети, связаться с центром Интернета вещей, не требуя передачи трафика в общедоступную конечную точку центра Интернета вещей. Аналогичным образом устройства, которые работают в локальной среде, могут использовать [VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) или частный пиринг [ExpressRoute](https://azure.microsoft.com/services/expressroute/) для получения подключения к виртуальной сети в Azure и последующего использования в центре Интернета вещей (через свою закрытую конечную точку). В результате клиенты, желающие ограничить возможности подключения к общедоступным конечным точкам центра Интернета вещей (или, возможно, полностью заблокировать ее), могут достичь этой цели с помощью [правил брандмауэра центра Интернета вещей](./iot-hub-ip-filtering.md) , сохраняя подключение к концентратору с помощью частной конечной точки.

> [!NOTE]
> Основной задачей этой установки является наличие устройств в локальной сети. Эта установка не рекомендуется для устройств, развернутых в глобальной сети.

![Общедоступная конечная точка центра Интернета вещей](./media/virtual-network-support/virtual-network-ingress.png)

Перед продолжением убедитесь, что выполнены следующие необходимые условия.

* Центр Интернета вещей должен быть подготовлен с помощью [управляемого удостоверения службы](#create-an-iot-hub-with-managed-service-identity).

* Центр Интернета вещей должен быть подготовлен в одном из [поддерживаемых регионов](#regional-availability-private-endpoints).

* Вы подготовили ВИРТУАЛЬную сеть Azure к подсети, в которой будет создана частная конечная точка. Дополнительные сведения см. [в статье Создание виртуальной сети с помощью Azure CLI](../virtual-network/quick-create-cli.md) .

* Для устройств, которые работают в локальных сетях, настройте частный пиринг [виртуальной частной сети (VPN)](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) или частного пиринга [ExpressRoute](https://azure.microsoft.com/services/expressroute/) в виртуальной сети Azure.


### <a name="regional-availability-private-endpoints"></a>Доступность по регионам (частные конечные точки)

Частные конечные точки, поддерживаемые в центре Интернета вещей, созданы в следующих регионах:

* Восточная часть США

* Центрально-южная часть США

* западная часть США 2


### <a name="set-up-a-private-endpoint-for-iot-hub-ingress"></a>Настройка частной конечной точки для входящего трафика центра Интернета вещей

Чтобы настроить частную конечную точку, выполните следующие действия.

1. Выполните следующую команду Azure CLI, чтобы повторно зарегистрировать поставщик центра Интернета вещей Azure в своей подписке:

    ```azurecli-interactive
    az provider register --namespace Microsoft.Devices --wait --subscription  <subscription-name>
    ```

2. Перейдите на вкладку **подключения к частной конечной точке** на портале Центра Интернета вещей (Эта вкладка доступна только в центрах Интернета вещей в [поддерживаемых регионах](#regional-availability-private-endpoints)) и щелкните знак **+** , чтобы добавить новую закрытую конечную точку.

3. Укажите подписку, группу ресурсов, имя и регион для создания новой частной конечной точки в (в идеале частная конечная точка должна быть создана в том же регионе, что и центр. Дополнительные сведения см. в [разделе о региональных доступности](#regional-availability-private-endpoints) .)

4. Щелкните **Далее: ресурс**и укажите подписку для ресурса центра Интернета вещей и выберите **"Microsoft. Devices/IotHubs"** в качестве типа ресурса, имя центра Интернета вещей в качестве **ресурса**и **iotHub** в качестве целевого подресурса.

5. Щелкните **Далее: Настройка** и укажите виртуальную сеть и подсеть для создания частной конечной точки в. При необходимости выберите параметр для интеграции с частной зоной DNS Azure.

6. Нажмите кнопку **Далее: Теги**и при необходимости укажите теги для ресурса.

7. Щелкните **Просмотр + создать** , чтобы создать ресурс частной конечной точки.


### <a name="pricing-private-endpoints"></a>Цены (частные конечные точки)

Дополнительные сведения о ценах см. на [странице цен на службу "Приватный канал" Azure](https://azure.microsoft.com/pricing/details/private-link).


## <a name="egress-connectivity-from-iot-hub-to-other-azure-resources"></a>Исходящие подключения из центра Интернета вещей к другим ресурсам Azure

Для центра Интернета вещей требуется доступ к хранилищу BLOB-объектов Azure, концентраторам событий, ресурсам служебной шины для [маршрутизации сообщений](./iot-hub-devguide-messages-d2c.md), [отправке файлов](./iot-hub-devguide-file-upload.md)и [групповому импорту и экспорту устройств](./iot-hub-bulk-identity-mgmt.md), которые обычно выполняются через общедоступную конечную точку ресурсов. В случае привязки учетной записи хранения, концентраторов событий или ресурса служебной шины к виртуальной сети Рекомендуемая конфигурация будет блокировать подключение к ресурсу по умолчанию. Следовательно, это повлияет на функциональность центра Интернета вещей, которая требует доступа к этим ресурсам.

Чтобы решить эту проблему, необходимо включить подключение из ресурса центра Интернета вещей к учетной записи хранения, концентраторов событий или ресурсов служебной шины с помощью параметра **Доверенные службы Azure First** .

Необходимые условия таковы:

* Центр Интернета вещей должен быть подготовлен в одном из [поддерживаемых регионов](#regional-availability-trusted-microsoft-first-party-services).

* Центру Интернета вещей необходимо назначить управляемое удостоверение службы во время подготовки концентратора. Следуйте инструкциям по [созданию концентратора с управляемым удостоверением службы](#create-an-iot-hub-with-managed-service-identity).


### <a name="regional-availability-trusted-microsoft-first-party-services"></a>Доступность по регионам (Доверенные службы Microsoft First)

Исключение служб Azure Trusted First для обхода ограничений брандмауэра в службе хранилища Azure, концентраторы событий и ресурсы служебной шины поддерживаются только для центров Интернета вещей в следующих регионах:

* Восточная часть США

* Центрально-южная часть США

* западная часть США 2


### <a name="pricing-trusted-microsoft-first-party-services"></a>Цены (Доверенные службы первого производителя Майкрософт)

Надежная функция исключения сторонних служб Майкрософт бесплатно взимается в центрах Интернета вещей в [поддерживаемых регионах](#regional-availability-trusted-microsoft-first-party-services). Плата за подготовленные учетные записи хранения, концентраторы событий или ресурсы служебной шины применяются отдельно.


### <a name="create-an-iot-hub-with-managed-service-identity"></a>Создание центра Интернета вещей с управляемым удостоверением службы

Управляемое удостоверение службы может быть назначено концентратору во время подготовки ресурсов (в настоящее время эта функция не поддерживается для существующих концентраторов), что требует, чтобы центр Интернета вещей использовал TLS 1,2 в качестве минимальной версии. Для этой цели необходимо использовать шаблон ресурсов ARM ниже:

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Devices/IotHubs",
      "apiVersion": "2020-03-01",
      "name": "<provide-a-valid-resource-name>",
      "location": "<any-of-supported-regions>",
      "identity": {
        "type": "SystemAssigned"
      },
      "properties": {
        "minTlsVersion": "1.2"
      },
      "sku": {
        "name": "<your-hubs-SKU-name>",
        "tier": "<your-hubs-SKU-tier>",
        "capacity": 1
      }
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2018-02-01",
      "name": "updateIotHubWithKeyEncryptionKey",
      "dependsOn": [
        "<provide-a-valid-resource-name>"
      ],
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "0.9.0.0",
          "resources": [
            {
              "type": "Microsoft.Devices/IotHubs",
              "apiVersion": "2020-03-01",
              "name": "<provide-a-valid-resource-name>",
              "location": "<any-of-supported-regions>",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "minTlsVersion": "1.2"
              },
              "sku": {
                "name": "<your-hubs-SKU-name>",
                "tier": "<your-hubs-SKU-tier>",
                "capacity": 1
              }
            }
          ]
        }
      }
    }
  ]
}
```

`name`После замены значений для ресурса `location`, `SKU.name` и `SKU.tier`можно использовать Azure CLI для развертывания ресурса в существующей группе ресурсов с помощью:

```azurecli-interactive
az deployment group create --name <deployment-name> --resource-group <resource-group-name> --template-file <template-file.json>
```

После создания ресурса можно получить управляемое удостоверение службы, назначенное концентратору, с помощью Azure CLI:

```azurecli-interactive
az resource show --resource-type Microsoft.Devices/IotHubs --name <iot-hub-resource-name> --resource-group <resource-group-name>
```

После подготовки центра Интернета вещей с управляемым удостоверением службы следуйте указаниям в соответствующем разделе, чтобы настроить конечные точки маршрутизации для [учетных записей хранения](#egress-connectivity-to-storage-account-endpoints-for-routing), [концентраторов событий](#egress-connectivity-to-event-hubs-endpoints-for-routing)и ресурсов [служебной шины](#egress-connectivity-to-service-bus-endpoints-for-routing) , а также для настройки [отправки файлов](#egress-connectivity-to-storage-accounts-for-file-upload) и [импорта и экспорта устройств](#egress-connectivity-to-storage-accounts-for-bulk-device-importexport).


### <a name="egress-connectivity-to-storage-account-endpoints-for-routing"></a>Исходящие подключения к конечным точкам учетной записи хранения для маршрутизации

Центр Интернета вещей можно настроить для маршрутизации сообщений в учетную запись хранения, принадлежащую заказчику. Чтобы разрешить функции маршрутизации доступ к учетной записи хранения при наличии ограничений брандмауэра, центр Интернета вещей должен иметь управляемое удостоверение службы (см. раздел [Создание концентратора с управляемым удостоверением службы](#create-an-iot-hub-with-managed-service-identity)). После подготовки управляемого удостоверения службы выполните следующие действия, чтобы предоставить разрешение RBAC для удостоверения ресурса центра для доступа к учетной записи хранения.

1. В портал Azure перейдите на вкладку **Управление доступом (IAM)** учетной записи хранения и нажмите кнопку **Добавить** в разделе **Добавление назначения роли** .

2. Выберите **участник данных BLOB-объекта хранилища** в качестве **роли**, **пользователя Azure AD, группы или субъекта-службы** в качестве **назначения доступа** и выберите имя ресурса центра Интернета вещей в раскрывающемся списке. Нажмите кнопку **Сохранить** .

3. Перейдите на вкладку **брандмауэры и виртуальные сети** в учетной записи хранения и включите параметр **Разрешить доступ из выбранных сетей** . В списке **исключения** установите флажок **разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения**. Нажмите кнопку **Сохранить** .

4. На странице ресурсов центра Интернета вещей перейдите на вкладку **Маршрутизация сообщений** .

5. Перейдите к разделу **пользовательские конечные точки** и нажмите кнопку **Добавить**. Выберите **хранилище** в качестве типа конечной точки.

6. На странице, которая отображается, укажите имя конечной точки, выберите контейнер, который вы хотите использовать в хранилище BLOB-объектов, укажите кодировку и формат имени файла. Выберите **система, назначенная** в качестве **типа проверки подлинности** для конечной точки хранилища. Нажмите кнопку **Создать** .

Теперь ваша конечная точка настраиваемого хранилища настроена на использование удостоверения системы, назначенного концентратору, и имеет разрешение на доступ к ресурсу хранилища, несмотря на ограничения брандмауэра. Теперь эту конечную точку можно использовать для настройки правила маршрутизации.


### <a name="egress-connectivity-to-event-hubs-endpoints-for-routing"></a>Исходящие подключения к конечным точкам концентраторов событий для маршрутизации

Центр Интернета вещей можно настроить для маршрутизации сообщений в пространство имен концентраторов событий, принадлежащее заказчику. Чтобы разрешить функции маршрутизации доступ к ресурсу концентраторов событий при наличии ограничений брандмауэра, центр Интернета вещей должен иметь управляемое удостоверение службы (см. раздел [Создание концентратора с управляемым удостоверением службы](#create-an-iot-hub-with-managed-service-identity)). После подготовки управляемого удостоверения службы выполните приведенные ниже действия, чтобы предоставить разрешение RBAC для удостоверения ресурса центра, чтобы получить доступ к концентраторам событий.

1. В портал Azure перейдите на вкладку **Управление доступом к концентратору событий (IAM)** и нажмите кнопку **Добавить** в разделе **Добавление назначения роли** .

2. Выберите **отправитель данных концентраторов событий** в качестве **роли**, **пользователя Azure AD, группы или субъекта-службы** в качестве **назначения доступа** и выберите имя ресурса центра Интернета вещей в раскрывающемся списке. Нажмите кнопку **Сохранить** .

3. Перейдите на вкладку **брандмауэры и виртуальные сети** в области концентраторы событий и включите параметр **Разрешить доступ из выбранных сетей** . В списке **исключения** установите флажок **разрешить доверенным службам Майкрософт доступ к концентраторам событий**. Нажмите кнопку **Сохранить** .

4. На странице ресурсов центра Интернета вещей перейдите на вкладку **Маршрутизация сообщений** .

5. Перейдите к разделу **пользовательские конечные точки** и нажмите кнопку **Добавить**. В качестве типа конечной точки выберите **концентраторы событий** .

6. На отображенной странице Укажите имя конечной точки, выберите пространство имен и экземпляр концентраторов событий и нажмите кнопку **создать** .

Теперь ваша конечная точка концентраторов событий настроена на использование назначенного системой удостоверения системы и имеет разрешение на доступ к ресурсу концентраторов событий, несмотря на ограничения брандмауэра. Теперь эту конечную точку можно использовать для настройки правила маршрутизации.


### <a name="egress-connectivity-to-service-bus-endpoints-for-routing"></a>Исходящие подключения к конечным точкам служебной шины для маршрутизации

Центр Интернета вещей можно настроить для маршрутизации сообщений в пространство имен служебной шины, принадлежащее заказчику. Чтобы разрешить функции маршрутизации доступ к ресурсу служебной шины при наличии ограничений брандмауэра, центр Интернета вещей должен иметь управляемое удостоверение службы (см. раздел [Создание концентратора с управляемым удостоверением службы](#create-an-iot-hub-with-managed-service-identity)). После подготовки управляемого удостоверения службы выполните следующие действия, чтобы предоставить разрешение RBAC для удостоверения ресурса центра, чтобы получить доступ к служебной шине.

1. В портал Azure перейдите на вкладку **Управление доступом (IAM)** служебной шины и нажмите кнопку **Добавить** в разделе **Добавление назначения роли** .

2. Выберите **отправитель данных служебной шины** в качестве **роли**, **пользователя Azure AD, группы или субъекта-службы** в качестве **назначения доступа** и выберите имя ресурса центра Интернета вещей в раскрывающемся списке. Нажмите кнопку **Сохранить** .

3. Перейдите на вкладку **брандмауэры и виртуальные сети** в служебной шине и включите параметр **Разрешить доступ из выбранных сетей** . В списке **исключения** установите флажок **разрешить доверенным службам Майкрософт доступ к этой служебной шине**. Нажмите кнопку **Сохранить** .

4. На странице ресурсов центра Интернета вещей перейдите на вкладку **Маршрутизация сообщений** .

5. Перейдите к разделу **пользовательские конечные точки** и нажмите кнопку **Добавить**. В качестве типа конечной точки выберите пункт **очередь служебной шины** или **раздел служебной шины** (как применимо).

6. На странице, которая отображается, укажите имя конечной точки, выберите пространство имен служебной шины и очередь или раздел (как применимо). Нажмите кнопку **Создать** .

Теперь ваша Настраиваемая конечная точка служебной шины настроена на использование назначенного системой удостоверения системы и имеет разрешение на доступ к ресурсу служебной шины, несмотря на ограничения брандмауэра. Теперь эту конечную точку можно использовать для настройки правила маршрутизации.


### <a name="egress-connectivity-to-storage-accounts-for-file-upload"></a>Исходящие подключения к учетным записям хранения для передачи файлов

Функция отправки файлов в центре Интернета вещей позволяет устройствам передавать файлы в учетную запись хранения, принадлежащую заказчику. Чтобы разрешить функцию отправки файла, устройства и центр Интернета вещей должны иметь подключение к учетной записи хранения. Если в учетной записи хранения используются ограничения брандмауэра, устройствам необходимо использовать любой поддерживаемый механизм учетной записи хранения (включая [частные конечные точки](../private-link/create-private-endpoint-storage-portal.md), [конечные точки службы](../virtual-network/virtual-network-service-endpoints-overview.md) или [конфигурацию брандмауэра](../storage/common/storage-network-security.md)) для получения подключения. Аналогично, если в учетной записи хранения установлены ограничения брандмауэра, центр Интернета вещей должен быть настроен для доступа к ресурсу хранилища через исключение доверенных служб Майкрософт. Для этой цели центр Интернета вещей должен иметь управляемое удостоверение службы (см. раздел [Создание концентратора с управляемым удостоверением службы](#create-an-iot-hub-with-managed-service-identity)). После подготовки управляемого удостоверения службы выполните следующие действия, чтобы предоставить разрешение RBAC для удостоверения ресурса центра для доступа к учетной записи хранения.

1. В портал Azure перейдите на вкладку **Управление доступом (IAM)** учетной записи хранения и нажмите кнопку **Добавить** в разделе **Добавление назначения роли** .

2. Выберите **участник данных BLOB-объекта хранилища** в качестве **роли**, **пользователя Azure AD, группы или субъекта-службы** в качестве **назначения доступа** и выберите имя ресурса центра Интернета вещей в раскрывающемся списке. Нажмите кнопку **Сохранить** .

3. Перейдите на вкладку **брандмауэры и виртуальные сети** в учетной записи хранения и включите параметр **Разрешить доступ из выбранных сетей** . В списке **исключения** установите флажок **разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения**. Нажмите кнопку **Сохранить** .

4. На странице ресурсов центра Интернета вещей перейдите к вкладке **Отправка файла** .

5. На странице, которая отображается, выберите контейнер, который вы планируете использовать в хранилище BLOB-объектов, настройте **Параметры уведомления о файлах**, **срок жизни SAS**, **значение TTL по умолчанию** и **Максимальное число доставок** по желанию. Выберите **система, назначенная** в качестве **типа проверки подлинности** для конечной точки хранилища. Нажмите кнопку **Создать** .

Теперь конечная точка хранилища для отправки файлов настроена на использование назначенного системой удостоверения системы и имеет разрешение на доступ к ресурсу хранилища, несмотря на ограничения брандмауэра.


### <a name="egress-connectivity-to-storage-accounts-for-bulk-device-importexport"></a>Исходящие подключения к учетным записям хранения для импорта и экспорта устройств

Центр Интернета вещей поддерживает функции [импорта и экспорта](./iot-hub-bulk-identity-mgmt.md) сведений об устройствах в набор данных, предоставленный клиентом, или в него. Чтобы разрешить функцию неполного импорта и экспорта, устройства и центр Интернета вещей должны иметь подключение к учетной записи хранения.

Эта функция требует подключения из центра Интернета вещей к учетной записи хранения. Чтобы получить доступ к ресурсу служебной шины при наличии ограничений брандмауэра, центр Интернета вещей должен иметь управляемое удостоверение службы (см. раздел [Создание концентратора с управляемым удостоверением службы](#create-an-iot-hub-with-managed-service-identity)). После подготовки управляемого удостоверения службы выполните следующие действия, чтобы предоставить разрешение RBAC для удостоверения ресурса центра, чтобы получить доступ к служебной шине.

1. В портал Azure перейдите на вкладку **Управление доступом (IAM)** учетной записи хранения и нажмите кнопку **Добавить** в разделе **Добавление назначения роли** .

2. Выберите **участник данных BLOB-объекта хранилища** в качестве **роли**, **пользователя Azure AD, группы или субъекта-службы** в качестве **назначения доступа** и выберите имя ресурса центра Интернета вещей в раскрывающемся списке. Нажмите кнопку **Сохранить** .

3. Перейдите на вкладку **брандмауэры и виртуальные сети** в учетной записи хранения и включите параметр **Разрешить доступ из выбранных сетей** . В списке **исключения** установите флажок **разрешить доверенным службам Майкрософт доступ к этой учетной записи хранения**. Нажмите кнопку **Сохранить** .

Теперь вы можете использовать REST API Интернета вещей Azure для [создания заданий импорта](https://docs.microsoft.com/rest/api/iothub/service/jobclient/getimportexportjobs) и получения сведений об использовании функций полного импорта и экспорта. Обратите внимание, что необходимо предоставить `storageAuthenticationType="identityBased"` в тексте запроса и использовать `inputBlobContainerUri="https://..."` и `outputBlobContainerUri="https://..."` в качестве URL-адреса ввода и вывода вашей учетной записи хранения соответственно.


Пакет SDK для центра Интернета вещей Azure также поддерживает эту функцию в диспетчере реестра клиента службы. В следующем фрагменте кода показано, как инициировать задание импорта или задание экспорта с помощью пакета SDK для C#.

```csharp
// Call an import job on the IoT Hub
JobProperties importJob = 
await registryManager.ImportDevicesAsync(
  JobProperties.CreateForImportJob(inputBlobContainerUri, outputBlobContainerUri, null, StorageAuthenticationType.IdentityBased), 
  cancellationToken);

// Call an export job on the IoT Hub to retrieve all devices
JobProperties exportJob = 
await registryManager.ExportDevicesAsync(
    JobProperties.CreateForExportJob(outputBlobContainerUri, true, null, StorageAuthenticationType.IdentityBased),
    cancellationToken);
```


Чтобы использовать эту версию пакетов SDK для Azure IoT с ограниченным регионом с поддержкой виртуальных сетей для C#, Java и Node. js:

1. Создайте переменную среды с `EnableStorageIdentity` именем и задайте для `1`нее значение.

2. Скачать пакет SDK: [Java](https://aka.ms/vnetjavasdk) | [C#](https://aka.ms/vnetcsharpsdk) | [node. js](https://aka.ms/vnetnodesdk)
 
Для Python Скачайте ограниченную версию с сайта GitHub.

1. Перейдите на [страницу выпуска GitHub](https://aka.ms/vnetpythonsdk).

2. Скачайте следующий файл, который находится в нижней части страницы выпуска под заголовком именованные **ресурсы**.
    > *azure_iot_hub-2.2.0_limited-py2. PY3-None-Any. WHL*

3. Откройте терминал и перейдите в папку с скачанным файлом.

4. Выполните следующую команду, чтобы установить пакет SDK для службы Python с поддержкой виртуальных сетей.
    > PIP install./azure_iot_hub-2.2.0_limited-py2. PY3-None-Any. WHL


## <a name="next-steps"></a>Следующие шаги

Воспользуйтесь приведенными ниже ссылками, чтобы узнать больше о функциях центра Интернета вещей:

* [Маршрутизация сообщений](./iot-hub-devguide-messages-d2c.md)
* [Передача файла](./iot-hub-devguide-file-upload.md)
* [Импорт и экспорт устройств](./iot-hub-bulk-identity-mgmt.md) 
