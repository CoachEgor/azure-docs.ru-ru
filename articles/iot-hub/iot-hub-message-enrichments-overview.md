---
title: Общие сведения о усовершенствования сообщений центра Интернета вещей Azure
description: Общие сведения о усовершенствования сообщений для сообщений центра Интернета вещей Azure
author: robinsh
manager: philmea
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 05/10/2019
ms.author: robinsh
ms.openlocfilehash: 6ddfd90956fde0c57e14083a3704cbf365456c75
ms.sourcegitcommit: 4cdd4b65ddbd3261967cdcd6bc4adf46b4b49b01
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2019
ms.locfileid: "66735165"
---
# <a name="message-enrichments-for-device-to-cloud-iot-hub-messages-preview"></a>Усовершенствования сообщения для сообщения центра Интернета вещей устройства в облако (Предварительная версия)

*Усовершенствования сообщений* — это способность в центре Интернета вещей *метка* сообщения с дополнительной информацией, прежде чем сообщения отправляются к указанной конечной точке. Одна из причин для использования усовершенствования сообщение — для включения данных, который может использоваться для упрощения последующей обработки. Например обогащение сообщений телеметрии устройств с тегом двойника устройства можно уменьшить нагрузку на клиентов совершить двойника устройства, вызовы API для получения этих сведений.

![Усовершенствования поток сообщений](./media/iot-hub-message-enrichments-overview/message-enrichments-flow.png)

Обогащение сообщения имеет три основных элемента:

* Обогащение имя или ключ

* Значение

* Один или несколько [конечные точки](iot-hub-devguide-endpoints.md) для которой должен применяться обогащение.

Ключ может быть любая строка.

Значение может быть любой из следующих примеров:

* Любой статическую строку. Динамические значения, такие как условия, логика, операции и функции не допускаются. Например если вы разрабатываете приложения SaaS, который используется несколько клиентов, можно назначить идентификатор для каждого клиента и освободить этот идентификатор в приложении. При запуске приложения, центр Интернета вещей будет отметки устройства сообщения телеметрии с идентификатором клиента, что позволяет обрабатывать сообщения по-разному для каждого клиента.

* Сведения из "двойника" устройства, такие как путь к нему. Примеры *$twin.tags.field* и *$twin.tags.latitude*.

* Имя центра Интернета вещей, отправляющий сообщение. Это значение равно *$iothubname*.

## <a name="applying-enrichments"></a>Применение усовершенствования

Сообщения могут поступать из любого источника данных, поддерживаемых [маршрутизации сообщений центра Интернета вещей](iot-hub-devguide-messages-d2c.md), включая в следующих примерах:

* Данные телеметрии устройства, например температуры и давления
* уведомления об изменении двойника устройства--изменения в двойнике устройства
* события жизненного цикла устройства, например при создании или удалении устройства

Можно добавить усовершенствования, которые будут во встроенную конечную точку центра Интернета вещей сообщения или сообщения, направляемые в пользовательские конечные точки, например хранилища BLOB-объектов Azure, в очередь служебной шины или раздел служебной шины.

Можно также добавить усовершенствования для сообщений, которые публикуются "Сетка событий", выбрав конечную точку как "Сетка событий". Дополнительные сведения см. в разделе [центра Интернета вещей и "Сетка событий"](iot-hub-event-grid.md).

Усовершенствования применяются каждой конечной точки. Если указать пять усовершенствования колонтитулов для конкретной конечной точки, все сообщения, отправляемые этой конечной точки имеют же пять усовершенствования.

Опробовать усовершенствования сообщений см. в разделе [руководстве усовершенствования сообщения](tutorial-message-enrichments.md)

## <a name="limitations"></a>Ограничения

* Вы можете добавить до 10 усовершенствования для центра Интернета вещей для этих центров уровня "стандартный" или "базовый". Для центров Интернета вещей уровня "бесплатный" можно добавить до 2 усовершенствования.

* В некоторых случаях если применяется обогащение со значением тега или свойства в двойнике устройства, значение, будут помечены как строковое значение. Например если значение обогащение присвоено $twin.tags.field, сообщения будут помечены этим со строкой «$twin.tags.field» вместо того, чтобы значение этого поля из "двойника". Это происходит в следующих случаях:

   * Центр Интернета вещей находится в уровень "базовый". Центры Интернета вещей уровня "базовый" не поддерживают двойников устройств.

   * Центр Интернета вещей уровня "стандартный", но устройства, отправляющего сообщение имеет не двойника устройства.

   * — Центр Интернета вещей уровня "стандартный", но путь двойника устройства, используемое в качестве значения обогащение не существует. Например если $twin.tags.location присваивается значение обогащение и двойника устройства отсутствует расположение свойства в разделе теги, сообщение записывается со строкой «$twin.tags.location». 

* Обновления двойника устройства может занять до пяти минут отобразятся в соответствующее значение обогащение.

* Общий размер сообщений, включая усовершенствования, не может превышать 256 КБ. Если размер сообщения превышает 256 КБ, в центр Интернета вещей будет удалить сообщение. Можно использовать [метрики центра Интернета вещей](iot-hub-metrics.md) для диагностики и устранения ошибок, когда сообщения будут удалены. Например можно отслеживать d2c.telemetry.egress.invalid.

## <a name="pricing"></a>Цены

Усовершенствования сообщения доступны без дополнительной платы. В настоящее время плата взимается при отправке сообщения в центр Интернета вещей. Плата взимается только один раз для данного сообщения, даже если сообщение отправляется несколько конечных точек.

## <a name="availability"></a>Доступность

Эта возможность доступна в предварительной версии и доступна во всех регионах, за исключением восточной части США, Западная часть США, Западная Европа, [Azure для государственных организаций](/azure/azure-government/documentation-government-welcome), [21Vianet в Azure для Китая](/azure/china/china-welcome), и [Azure для Германии](https://azure.microsoft.com/global-infrastructure/germany/).

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со следующими статьями, Дополнительные сведения о маршрутизации сообщений в центр Интернета вещей:

* [Используйте маршрутизацию сообщений центра Интернета вещей для отправки сообщений с устройства в облако в разные конечные точки](iot-hub-devguide-messages-d2c.md)

* [Учебник. Маршрутизацией центра Интернета вещей](tutorial-routing.md)