---
title: Протоколы и порты связи Центра Интернета вещей Azure | Документы Майкрософт
description: Руководство разработчика включает описание поддерживаемых протоколов связи для отправки данных с устройства в облако и из облака в устройство, а также номера портов, которые должны быть открыты.
author: robinsh
manager: philmea
ms.author: robinsh
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 01/29/2018
ms.openlocfilehash: 6d1ab50e471c9c603c7886130375dc74e9b2a755
ms.sourcegitcommit: 7b25c9981b52c385af77feb022825c1be6ff55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79284633"
---
# <a name="reference---choose-a-communication-protocol"></a>Справочник — выбор протокола связи

Центр Интернета вещей позволяет устройствам использовать следующие протоколы для обмена данными на стороне устройства:

* [MQTT](https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.pdf)
* MQTT через WebSocket
* [AMQP](https://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-complete-v1.0-os.pdf)
* AMQP через WebSocket
* HTTPS

Сведения о поддержке протоколов, используемых компонентами Центра Интернета вещей, см. [Руководство по обмену данными между устройством и облаком](iot-hub-devguide-d2c-guidance.md) и [руководстве по обмену данными между облаком и устройством](iot-hub-devguide-c2d-guidance.md).

Ниже в таблице приведены общие рекомендации по выбору протокола.

| Протокол | Когда следует выбрать этот протокол |
| --- | --- |
| MQTT <br> MQTT через WebSocket |Используйте для всех устройств, которые не требуют подключения одновременно нескольких устройств (на каждом из которых используются собственные учетные данные) с помощью одного TLS-соединения. |
| AMQP <br> AMQP через WebSocket |Используйте на собственных или облачных шлюзах, чтобы воспользоваться преимуществами мультиплексирования подключений на устройствах. |
| HTTPS |Используйте для устройств, которые не поддерживают другие протоколы. |

При выборе протокола для связи на стороне устройства учитывайте следующие факторы:

* **Шаблон сообщения из облака на устройство**. Протокол HTTPS не позволяет отправлять данные по инициативе сервера. Таким образом, при использовании протокола HTTPS устройства опрашивают Центр Интернета вещей на предмет наличия сообщений из облака на устройство. Этот подход неэффективен для устройства и Центра Интернета вещей. Согласно текущим рекомендациям для протокола HTTPS каждое устройство должно выполнять опрос не реже, чем раз в 25 минут. Протоколы MQTT и AMQP поддерживают отправку сообщений по инициативе сервера при получении сообщений из облака на устройство. Они позволяют незамедлительно передавать сообщения из Центра Интернета вещей на устройство. Если задержка доставки является проблемой, лучше использовать протокол MQTT или AMQP. Для редко подключаемых устройств также подходит протокол HTTPS.

* **Шлюзы поля**. Протоколы MQTT и HTTPS не позволяют подключать по TLS-соединению одновременно несколько устройств (на каждом из которых используются собственные учетные данные). Эти протоколы не вполне подходят для [ситуаций с использованием полевого шлюза](iot-hub-devguide-endpoints.md#field-gateways), так как требуют отдельного TLS-подключения между полевым шлюзом и Центром Интернета вещей для каждого подключенного устройства.

* **Устройства с небольшим количеством ресурсов**. Библиотеки MQTT и HTTPS уступают по объему библиотекам AMQP, а значит, только их можно использовать для устройств с ограниченными ресурсами (например, если размер ОЗУ меньше 1 МБ).

* **Обход сети**. Стандартный протокол AMQP использует порт 5671, а MQTT ожидает передачи данных на порту 8883. Использование этих портов может вызвать проблемы в сетях, закрытых для протоколов, отличных от HTTPS. В этом сценарии следует использовать протокол MQTT через WebSockets, AMQP через WebSockets или HTTPS.

* **Объем полезных данных**. MQTT и AMQP — это двоичные протоколы, позволяющие передавать более компактные полезные данные, чем HTTPS.

> [!WARNING]
> При использовании протокола HTTPS каждое устройство должно опрашивать сообщения, отправляемые из облака на устройство, не более чем один раз каждые 25 минут. В процессе разработки каждое устройство может опрашиваться чаще, если это необходимо.

## <a name="port-numbers"></a>Номера портов

Устройства могут взаимодействовать с Центром Интернета вещей в Azure с использованием различных протоколов. Как правило, выбор протокола определяется конкретными требованиями решения. В следующей таблице перечислены исходящие порты, которые должны быть открыты, чтобы устройство могло воспользоваться определенным протоколом.

| Протокол | Порт |
| --- | --- |
| MQTT |8883 |
| MQTT через WebSocket |443 |
| AMQP |5671 |
| AMQP через WebSocket |443 |
| HTTPS |443 |

После создания Центра Интернета вещей в регионе Azure IP-адрес центра остается неизменным в течение всего времени его существования. Однако для обеспечения качества обслуживания при перемещении корпорацией Майкрософт Центра Интернета вещей в другую единицу масштабирования центру назначается новый IP-адрес.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о реализации Центром Интернета вещей протокола MQTT см. в статье [Взаимодействие с Центром Интернета вещей с помощью протокола MQTT](iot-hub-mqtt-support.md).
