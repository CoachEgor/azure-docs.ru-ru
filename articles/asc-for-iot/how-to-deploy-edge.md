---
title: Развертывание центра безопасности Azure для IoT Edge модуля (Предварительная версия) | Документация Майкрософт
description: Узнайте, как развернуть центр безопасности Azure для агента безопасности IoT на IoT Edge.
services: asc-for-iot
ms.service: asc-for-iot
documentationcenter: na
author: mlottner
manager: rkarlin
editor: ''
ms.assetid: 32a9564d-16fd-4b0d-9618-7d78d614ce76
ms.subservice: asc-for-iot
ms.devlang: na
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/23/2019
ms.author: mlottner
ms.openlocfilehash: 4e568d2322088d9f6f6b4f9ad6e4b3cd98f25a47
ms.sourcegitcommit: aebe5a10fa828733bbfb95296d400f4bc579533c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/05/2019
ms.locfileid: "70376061"
---
# <a name="deploy-a-security-module-on-your-iot-edge-device"></a>Развертывание модуля безопасности на устройстве IoT Edge

> [!IMPORTANT]
> Центр безопасности Azure для центра Интернета вещей IoT Edge поддержка устройств в настоящее время доступна в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

**Центр безопасности Azure для модуля IOT** предоставляет комплексное решение по обеспечению безопасности для устройств IOT Edge.
Модуль безопасности собирает, объединяет и анализирует необработанные данные безопасности из операционной системы и системы контейнеров в виде рекомендаций и оповещений о безопасности.
Дополнительные сведения см. в разделе [модуль безопасности для IOT Edge](security-edge-architecture.md).

В этой статье вы узнаете, как развернуть модуль безопасности на устройстве IoT Edge.

## <a name="deploy-security-module"></a>Развертывание модуля безопасности

Выполните следующие действия, чтобы развернуть модуль безопасности Azure для центра Интернета вещей для IoT Edge.

### <a name="prerequisites"></a>Предварительные требования

- В центре Интернета вещей убедитесь, что устройство [зарегистрировано как устройство IOT Edge](https://docs.microsoft.com/azure/iot-edge/how-to-register-device-portal).

- Центр безопасности Azure для модуля IoT Edge требует, чтобы на устройстве IoT Edge была установлена [платформа для аудита](https://linux.die.net/man/8/auditd) .

    - Установите платформу, выполнив на устройстве IoT Edge следующую команду:
   
      `sudo apt-get install auditd audispd-plugins`
   
    - Проверьте, активен ли аудит, выполнив следующую команду:
   
      `sudo systemctl status auditd`
      
        Ожидаемый ответ — `active (running)`. 

### <a name="deployment-using-azure-portal"></a>Развертывание с помощью портал Azure

1. В портал Azure откройте **Marketplace**.

1. Выберите **"Интернет вещей"** , а затем найдите **Центр безопасности Azure для Интернета вещей** и выберите его.

   ![Выбор центра безопасности Azure для Интернета вещей](media/howto/edge-onboarding-8.png)

1. Нажмите кнопку **создать** , чтобы настроить развертывание. 

1. Выберите **подписку** Azure центра Интернета вещей, а затем выберите **центр Интернета вещей**.<br>Выберите **развернуть на устройстве** для использования с одним устройством или выберите **развернуть в масштабе** для выбора нескольких устройств и нажмите кнопку **создать**. Дополнительные сведения о развертывании в масштабе см. [в разделе Развертывание](https://docs.microsoft.com/azure/iot-edge/how-to-deploy-monitor). 

    >[!Note] 
    >Если выбран параметр **развернуть в масштабе**, добавьте имя и сведения об устройстве, прежде чем перейти к вкладке **Add modules (Добавление модулей** ) в следующих инструкциях.     

Создание IoT Edge развертывания для центра безопасности Azure для Интернета вещей состоит из трех этапов. В следующих разделах описан каждый из этих шагов. 

#### <a name="step-1-add-modules"></a>Шаг 1. Добавить модули

1. На вкладке **Добавление модулей** в области **модули развертывания** щелкните **азуресекуритицентерфориот**. 
   
1. Измените **имя** на **азуреиотсекурити**.
1. Измените **URI образа** на **MCR.Microsoft.com/ascforiot/azureiotsecurity:0.0.3**.
1. Убедитесь, что для параметра **создать контейнер** задано значение:      
    ``` json
    {
        "NetworkingConfig": {
            "EndpointsConfig": {
                "host": {}
            }
        },
        "HostConfig": {
            "Privileged": true,
            "NetworkMode": "host",
            "PidMode": "host",
            "Binds": [
                "/:/host"
            ]
        }
    }    
    ```
1. Убедитесь, что выбран параметр **задать требуемые свойства двойникаа модуля** , и измените объект конфигурации на:
      
    ``` json
      "properties.desired": {
        "azureiot*com^securityAgentConfiguration^1*0*0": {
        }
      }
      ```

1. Нажмите кнопку **Сохранить**.
1. Прокрутите вкладку вниз и выберите **настроить дополнительные параметры среды выполнения ребра**.
   
   
1. Измените **изображение** в разделе **концентратора ребра** на **MCR.Microsoft.com/ascforiot/edgehub:1.0.9-Preview**.

   >[!Note]
   > В центре безопасности Azure для модуля IoT требуется разветвленная версия центра IoT Edge, основанная на пакете SDK версии 1,20.
   > Изменяя образ центра IoT Edge, вы указываете устройству IoT Edge заменить последний стабильный выпуск на разветвленную версию центра IoT Edge, которая официально не поддерживается службой IoT Edge.

1. Убедитесь, что для **параметра создать** задано значение: 
         
    ``` json
    {
      "HostConfig": {
        "PortBindings": {
          "8883/tcp": [{"HostPort": "8883"}],
          "443/tcp": [{"HostPort": "443"}],
          "5671/tcp": [{"HostPort": "5671"}]
        }
      }
    }
    ```
      
1. Нажмите кнопку **Сохранить**.
   
1. Нажмите кнопку **Далее**.

#### <a name="step-2-specify-routes"></a>Шаг 2. Укажите маршруты 

1. На вкладке **указать маршруты** убедитесь, что у вас есть маршрут (явный или неявный), который будет пересылать сообщения из модуля **азуреиотсекурити** в **$upstream**. 
1. Нажмите кнопку **Далее**.

    ~~~Default implicit route
    "route": "FROM /messages/* INTO $upstream" 
    ~~~

    ~~~Explicit route
    "ASCForIoTRoute": "FROM /messages/modules/azureiotsecurity/* INTO $upstream"
    ~~~

#### <a name="step-3-review-deployment"></a>Шаг 3. Проверка развертывания

- На вкладке **Проверка развертывания** просмотрите сведения о развертывании, а затем нажмите кнопку **Отправить** , чтобы завершить развертывание.

## <a name="diagnostic-steps"></a>Этапы диагностики

При возникновении проблемы журналы контейнеров — это лучший способ узнать состояние устройства модуля безопасности IoT Edge. Для сбора сведений используйте команды и инструменты, приведенные в этом разделе.

### <a name="verify-the-required-containers-are-installed-and-functioning-as-expected"></a>Убедитесь, что необходимые контейнеры установлены и работают должным образом.

1. На устройстве IoT Edge выполните следующую команду:
    
     `sudo docker ps`
   
1. Убедитесь, что выполняются следующие контейнеры:
   
   | Название | ЭСКИЗ |
   | --- | --- |
   | азуреиотсекурити | mcr.microsoft.com/ascforiot/azureiotsecurity:0.0.3 |
   | edgeHub | mcr.microsoft.com/ascforiot/edgehub:1.0.9-preview |
   | edgeAgent | mcr.microsoft.com/azureiotedge-agent:1.0 |
   
   Если минимальный необходимый контейнер отсутствует, проверьте, соответствует ли манифест развертывания IoT Edge рекомендуемым параметрам. Дополнительные сведения см. в разделе [Развертывание модуля IOT Edge](#deployment-using-azure-portal).

### <a name="inspect-the-module-logs-for-errors"></a>Проверка журналов модулей на наличие ошибок
   
1. На устройстве IoT Edge выполните следующую команду:

   `sudo docker logs azureiotsecurity`
   
1. Для получения более подробных журналов добавьте следующую переменную среды в развертывание модуля **азуреиотсекурити** : `logLevel=Debug`.

## <a name="next-steps"></a>Следующие шаги

Чтобы узнать больше о параметрах конфигурации, перейдите к руководству по настройке модуля. 
> [!div class="nextstepaction"]
> [Руководство по настройке модуля](./how-to-agent-configuration.md)
