---
title: Рекомендации по обеспечению безопасности сети — Microsoft Azure
description: В этой статье представлены рекомендации по обеспечению безопасности сети с помощью встроенных возможностей Azure.
services: security
author: TerryLanfear
manager: barbkess
editor: TomShinder
ms.assetid: 7f6aa45f-138f-4fde-a611-aaf7e8fe56d1
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/28/2019
ms.author: TomSh
ms.openlocfilehash: 5bec7db1c4409165242416df16e437b121381b49
ms.sourcegitcommit: 8a681ba0aaba07965a2adba84a8407282b5762b2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2019
ms.locfileid: "64872560"
---
# <a name="azure-network-security-best-practices"></a>Рекомендации по обеспечению безопасности в сети Azure
В этой статье рассматриваются рекомендации по обеспечению безопасности сети Azure. Эти рекомендации основываются на нашем опыте работы с сетью Azure и отзывах клиентов.

По каждой рекомендации объясняется следующее.

* суть рекомендации;
* почему необходимо применять эту рекомендацию;
* что может случиться, если не применить эту рекомендацию;
* возможные альтернативы рекомендации;
* как научиться применять эту рекомендацию.

В этой статье изложено общепринятое мнение по рассматриваемому вопросу, а также представлены возможности и компоненты платформы Azure, доступные на момент ее написания. Со временем мнения и технологии меняются. Поэтому эта статья будет постоянно обновляться, чтобы отражать эти изменения.

## <a name="logically-segment-subnets"></a>логическое сегментирование подсетей;
Виртуальные сети Azure похожи на локальную сеть. Виртуальная сеть Azure представляет собой сеть с пространством частных IP-адресов, в которой можно разместить все виртуальные машины Azure. Доступны пространства частных IP-адресов в диапазонах класса A (10.0.0.0/8), класса B (172.16.0.0/12) и класса C (192.168.0.0/16).

Далее приведены рекомендации по логическому сегментированию подсетей.

**Рекомендация**. Сегментируйте большое адресное пространство на подсети.   
**Сведения**. Чтобы создать подсети используйте принципы подсети на основе [CIDR](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing).

**Рекомендация**. Создайте элементы управления доступом сети между подсетями. Маршрутизация между подсетями осуществляется автоматически, а таблицы маршрутизации не нужно настраивать вручную. По умолчанию между подсетями, создаваемыми в виртуальной сети Azure, нет элементов управления доступом к сети.   
**Сведения**. Используйте [группу безопасности сети](../virtual-network/virtual-networks-nsg.md) (NSG). Группы безопасности сети — это простые устройства проверки пакетов с отслеживанием состояния, использующие 5 кортежей (исходный IP-адрес, порт источника, IP-адрес назначения, порт назначения и протокол уровня 4), чтобы создать правила, разрешающие или запрещающие передачу сетевого трафика. Можно разрешить или запретить перемещение исходящего и входящего трафика по одному или нескольким IP-адресам или даже между подсетями.

При использовании групп безопасности сети для управления доступом к сети между подсетями ресурсы, которые относятся к одной зоне или роли безопасности, можно помещать в соответствующие подсети.

## <a name="control-routing-behavior"></a>управление поведением маршрутизации;
Виртуальная машина, размещенная в виртуальной сети Azure, может подключаться к любой другой виртуальной машине в той же виртуальной сети, даже если другие виртуальные машины находятся в разных подсетях. Такой тип связи возможен, так как существует набор системных маршрутов, включенных по умолчанию. Благодаря этим маршрутам по умолчанию виртуальные машины в одной виртуальной сети могут подключаться друг к другу и к Интернету (исходящая связь поддерживается только через Интернет).

Хотя системные маршруты по умолчанию и используются в различных сценариях развертывания, в некоторых случаях требуется настроить конфигурацию маршрутизации. Можно настроить адрес для перехода, который позволяет достичь определенного места назначения.

При развертывании устройства безопасности для виртуальной сети рекомендуется настраивать [определяемые пользователем маршруты](../virtual-network/virtual-networks-udr-overview.md). Мы рассмотрим этот вопрос в разделе о [защите критически важных ресурсов служб Azure в пределах отдельных виртуальных сетей](azure-security-network-security-best-practices.md#secure-your-critical-azure-service-resources-to-only-your-virtual-networks).

> [!NOTE]
> Настраивать пользовательские маршруты необязательно. Как правило, подойдут системные маршруты по умолчанию.
>
>

## <a name="enable-forced-tunneling"></a>Включение принудительного туннелирования
Чтобы лучше понять, что такое принудительное туннелирование, следует разобраться с раздельным туннелированием. Самый распространенный пример раздельного туннелирования — VPN-подключения. Представьте, что вы устанавливаете VPN-подключение из гостиничного номера к корпоративной сети. Это подключение позволяет получить доступ к корпоративным ресурсам. Весь обмен данными с корпоративной сетью выполняется через туннель VPN.

Что же произойдет, если вы захотите подключиться к ресурсам в Интернете? Если раздельное туннелирование включено, такое подключение проходит непосредственно через Интернет, а не через туннель VPN. Некоторые специалисты в области безопасности считают это потенциальной угрозой. Они рекомендуют отключить раздельное туннелирование и выполнять все подключения, предназначенные для доступа к Интернету и корпоративным ресурсам, через туннель VPN. Преимущество отключения раздельного туннелирования в том, что подключения к Интернету осуществляются через устройства безопасности корпоративной сети. Но он не работает, если VPN-клиент подключен к Интернету за пределами туннеля VPN.

Теперь вернемся к виртуальным машинам в виртуальной сети Azure. По маршрутам по умолчанию в виртуальной сети Azure виртуальные машины могут передавать трафик в Интернет. Это также может представлять угрозу безопасности, так как при таких исходящих подключениях виртуальная машина подвергается большей опасности и этим могут воспользоваться злоумышленники. Поэтому при распределенном подключении между виртуальной сетью Azure и локальной сетью на виртуальных машинах рекомендуется [включить принудительное туннелирование](../vpn-gateway/vpn-gateway-forced-tunneling-rm.md). Распределенное подключение будет рассмотрено позже в разделе рекомендаций.

Если вы не установили распределенное подключение, обязательно воспользуйтесь группами безопасности сети (рассмотрены выше) или виртуальными сетевыми устройствами безопасности Azure (рассмотрены выше), чтобы предотвратить исходящие подключения к Интернету из виртуальных машин Azure.

## <a name="use-virtual-network-appliances"></a>Использование виртуальных сетевых устройств
Группы безопасности сети и определяемые пользователем маршруты могут в некоторой степени обеспечить безопасность сети на уровнях сети и транспорта в [модели OSI](https://en.wikipedia.org/wiki/OSI_model). Но иногда может потребоваться обеспечить безопасность на более высоких уровнях стека. В таких случаях рекомендуется развернуть виртуальные сетевые устройства безопасности, предоставляемые партнерами Azure.

Сетевые устройства безопасности Azure могут обеспечить более высокий уровень безопасности по сравнению с тем, который обеспечивают элементы управления уровня сети. Ниже перечислены некоторые возможности обеспечения сетевой безопасности виртуальных сетевых устройств безопасности:


* использование брандмауэров;
* обнаружение и предотвращение атак;
* управление уязвимостями;
* управление приложениями;
* сетевое обнаружение аномалий;
* использование веб-фильтров;
* использование антивирусных программ;
* защита от ботнетов.

Чтобы найти доступные виртуальные сетевые устройства безопасности Azure, посетите страницу [Azure Marketplace](https://azure.microsoft.com/marketplace/) и введите в поле поиска слова security и network security.

## <a name="deploy-perimeter-networks-for-security-zones"></a>Развертывание сетей периметра для зон безопасности
[Сеть периметра](https://docs.microsoft.com/azure/best-practices-network-security) (также называемая ДМЗ) — это сегмент физической или логической сети, который обеспечивает дополнительный уровень безопасности между ресурсами и Интернетом. Специализированные устройства управления сетевым доступом на границе сети периметра разрешают передавать в виртуальную сеть только нужный трафик.

Сети периметра полезны, так как компоненты для управления, мониторинга, ведения журналов и отчетности элементов управления доступом к сети можно разместить в устройствах на границе виртуальной сети Azure. Здесь обычно включается защита от атак DDoS, системы предотвращения и обнаружения атак, правила и политики брандмауэра, веб-фильтры, антивредоносные программы для сети и многое другое. Сетевые устройства безопасности расположены между Интернетом и виртуальной сетью Azure. В каждой из этих сетей есть интерфейсы этих устройств.

Несмотря на то, что это базовая архитектура сети периметра, существует много других различных архитектур, например сеть периметра с двумя, тремя или несколькими межсетевыми экранами.

Для всех развертываний, требующих высокого уровня безопасности, рекомендуется развернуть сеть периметра, чтобы повысить уровень безопасности сети для ресурсов Azure.

## <a name="avoid-exposure-to-the-internet-with-dedicated-wan-links"></a>Обеспечение безопасности в Интернете с помощью выделенных подключений глобальной сети
Во многих организациях используется гибридная ИТ-среда. При этом некоторые информационные ресурсы компании находятся в среде Azure, а остальные — в локальной среде. Во многих случаях некоторые компоненты службы выполняются в Azure, а другие локально.

В гибридной ИТ-среде обычно используется распределенное подключение. При таком подключении корпоративные локальные сети могут подключаться к виртуальным сетям Azure. Доступно два варианта распределенного подключения.

* **VPN-подключение типа "сеть – сеть"**. Это доверенная, надежная и установленная технология, но подключение выполняется через Интернет. Пропускная способность ограничена до 200 Мбит/с. В некоторых сценариях VPN-подключение типа "сеть — сеть" является наиболее предпочтительным вариантом и рассматривается далее в разделе [Отключение доступа к виртуальным машинам по протоколам RDP или SSH](#disable-rdpssh-access-to-virtual-machines).
* **Azure ExpressRoute**. Мы рекомендуем использовать [ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-introduction) для кроссплатформенных возможностей подключений. ExpressRoute — это выделенный канал связи в глобальной сети для локальной среды или поставщика услуг размещения Exchange. Так как это телекоммуникационное подключение, данные не проходят через Интернет и, таким образом, не подвергаются потенциальному риску при обмене данными через Интернет.

## <a name="optimize-uptime-and-performance"></a>Оптимизация времени работоспособности и производительности
Если служба не работает, данные недоступны. Если из-за низкой производительности данные становятся непригодными к использованию, их можно считать недоступными. С точки зрения безопасности необходимо сделать все возможное, чтобы оптимизировать работоспособность и производительность служб.

Самый популярный и эффективный метод — использовать балансировку нагрузки. Балансировка нагрузки — это метод распределения сетевого трафика между серверами, которые входят в состав службы. Например, при наличии в службе внешних веб-серверов трафик можно распределять между ними, используя балансировку нагрузки.

Такое распределение трафика повышает доступность, так как если один из серверов станет недоступным, то подсистема балансировки нагрузки перестанет отправлять трафик на него, перенаправляя его к доступным серверам. Балансировка нагрузки также позволяет повысить производительность, так как нагрузка на процессор, сеть и память при обслуживании запросов распределяется по всем серверам с балансировкой нагрузки.

Балансировку нагрузки рекомендуется применять при любой возможности и по необходимости в службах. Ниже приведены сценарии, как на уровне виртуальной сети Azure, так и на глобальном уровне. Также приведены доступные возможности балансировки нагрузки.

**Сценарий**. У вас есть приложение, которое:

- Требует запросов от сеанса одного пользователя или клиента для получения доступа к одной серверной виртуальной машине. Примерами являются приложения корзины для покупок и почтовые веб-серверы.
- Принимает только безопасное подключение, поэтому незашифрованный обмен данными на серверах не является приемлемым вариантом.
- Требует несколько HTTP-запросов к одному и тому же долгосрочному подключению TCP для маршрутизации или распределения нагрузки на другие внутренние серверы.

**Параметр балансировки нагрузки**. Использование [Шлюза приложений Azure](../application-gateway/application-gateway-introduction.md) — балансировщика нагрузки веб-трафика протокола HTTP. Шлюз приложений поддерживает сквозное шифрование SSL и [прерывание SSL-подключений](../application-gateway/application-gateway-introduction.md). Веб-серверы можно избавить от нагрузки шифрования и расшифровки, а также от незашифрованного трафика, поступающего на внутренние веб-серверы.

**Сценарий**. Необходимо равномерно распределить входящие подключения из Интернета между серверами в виртуальной сети Azure. Это сценарии, в которых:

- имеются приложения без отслеживания состояния, которые принимают входящие запросы из Интернета;
- не требуются прикрепленные сеансы или разгрузка SSL. Прикрепленные сеансы — это метод, используемый с балансировкой нагрузки приложения для достижения сходства сервера.

**Параметр балансировки нагрузки**. Использование портала Azure для [создания внешнего балансировщика нагрузки](../load-balancer/quickstart-create-basic-load-balancer-portal.md), который распределяет входящие запросы между несколькими виртуальными машинами для обеспечения более высокого уровня доступности.

**Сценарий**. Необходимо распределить нагрузку подключений с виртуальных машин, которые не находятся в Интернете. В большинстве случаев подключения, которые принимаются для балансировки нагрузки, инициируются устройствами в виртуальной сети Azure, такими как экземпляры SQL Server или внутренние веб-серверы.   
**Параметр балансировки нагрузки**. Использование портала Azure для [создания внутреннего балансировщика нагрузки](../load-balancer/quickstart-create-basic-load-balancer-powershell.md), который распределяет входящие запросы между несколькими виртуальными машинами для обеспечения более высокого уровня доступности.

**Сценарий**. Требуется глобальная балансировка нагрузки по следующим причинам:

- наличие облачного решения, которое широко распространено в нескольких регионах и требует максимально возможного уровня бесперебойной работы (доступности);
- требуется максимально возможный уровень бесперебойной работы, гарантирующий доступность службы даже в случае отсутствия доступа ко всему центру обработки данных.

**Параметр балансировки нагрузки**. Использование диспетчера трафика Azure. Диспетчер трафика позволяет равномерно распределять подключения между службами на основе сведений о расположении пользователя.

Например, если пользователь из стран ЕС обращается к вашей службе, подключение направляется к службам, расположенным в центре обработки данных в соответствующей стране. Эта возможность глобальной балансировки нагрузки в диспетчере трафика обеспечивает повышение производительности, так как подключиться к ближайшему центру обработки данных можно гораздо быстрее.

## <a name="disable-rdpssh-access-to-virtual-machines"></a>Отключение доступа по протоколу RDP или SSH к виртуальным машинам Azure
К виртуальным машинам Azure можно получить доступ по протоколам [удаленного рабочего стола](https://en.wikipedia.org/wiki/Remote_Desktop_Protocol) (RDP) и [Secure Shell](https://en.wikipedia.org/wiki/Secure_Shell) (SSH). Эти протоколы позволяют управлять виртуальными машинами из удаленных расположений и обычно применяются при вычислениях в центре обработки данных.

Потенциальная угроза безопасности при использовании этих протоколов в Интернете — [атаки методом подбора](https://en.wikipedia.org/wiki/Brute-force_attack), которые осуществляются, чтобы получить доступ к виртуальным машинам Azure. Получив доступ к виртуальной машине, злоумышленник может использовать ее в качестве базы для компрометации других компьютеров в виртуальной сети или даже для осуществления атаки на сетевые устройства за пределами среды Azure.

Рекомендуется отключить доступ к виртуальным машинам Azure из Интернета по протоколам RDP и SSH. Кроме таких типов доступа, к этим виртуальным машинам можно подключиться для удаленного управления и другими способами.

**Сценарий**. Предоставление одному пользователю возможности подключения к виртуальной сети Azure через Интернет.   
**Вариант**. [VPN типа "точка — сеть"](../vpn-gateway/vpn-gateway-point-to-site-create.md) — другое название для VPN-подключения с помощью клиента или сервера для удаленного доступа. Установив подключение типа "точка — сеть", пользователь сможет подключаться к любой виртуальной машине в виртуальной сети Azure, доступ к которой осуществляется с использованием VPN-подключения типа "точка — сеть", по протоколу удаленного рабочего стола или SSH. При этом предполагается, что пользователь уполномочен для доступа к этим виртуальным машинам.

VPN-подключение типа "точка — сеть" безопаснее, чем прямое подключение по протоколу удаленного рабочего стола или SSH, так как перед подключением к виртуальной машине пользователь должен пройти аутентификацию дважды. Во-первых, пользователю нужно пройти проверку подлинности (и получить авторизацию) для установки VPN-подключения типа "точка — сеть". Во-вторых, пользователю нужно пройти проверку подлинности (и получить авторизацию) для установки сеанса подключения по протоколу RDP или SSH.

**Сценарий**. Предоставление пользователям в локальной сети возможности подключения к виртуальным машинам в виртуальной сети Azure.   
**Вариант**. При [VPN-подключении типа "сеть — сеть"](../vpn-gateway/vpn-gateway-site-to-site-create.md) устанавливается связь между сетями через Интернет. Это подключение можно использовать, чтобы установить связь между локальной сетью и виртуальной сетью Azure. Пользователи в локальной сети выполняют VPN-подключение типа "сеть — сеть" по протоколу RDP или SSH. Не требуется разрешать прямой доступ по протоколу RDP или SSH через Интернет.

**Сценарий**. Использование выделенной ссылки глобальной сети для предоставления возможности, аналогичной VPN-подключению типа "сеть — сеть".   
**Вариант**. Используйте [ExpressRoute](https://azure.microsoft.com/documentation/services/expressroute/). Эта технология предоставляет функциональность, аналогичную VPN-подключению типа "сеть — сеть". Основные различия:

- при использовании выделенного подключения глобальной сети данные не передаются через Интернет, а
- само подключение обычно отличается повышенной стабильностью и производительностью.

## <a name="secure-your-critical-azure-service-resources-to-only-your-virtual-networks"></a>Защита критически важных ресурсов служб Azure в пределах отдельных виртуальных сетей
Конечные точки служб виртуальной сети расширяют пространство частных адресов и возможности идентификации вашей виртуальной сети в службах Azure благодаря прямому соединению. Конечные точки позволяют защищать критически важные ресурсы служб Azure в пределах отдельных виртуальных сетей. Трафик, поступающий из виртуальной сети в службу Azure, всегда остается в магистральной сети Microsoft Azure.

Конечные точки служб обеспечивают следующие преимущества.

- **Повышение уровня безопасности для ресурсов служб Azure**. Благодаря конечным точкам служб можно обеспечить защиту ресурсов служб Azure в виртуальной сети. Защита ресурсов служб в виртуальной сети повышает безопасность, полностью исключая открытый доступ из Интернета к этим ресурсам и разрешая трафик только из виртуальной сети.
- **Оптимальная маршрутизация трафика службы Azure из виртуальной сети**. По всем маршрутам в виртуальной сети, по которым к локальным или виртуальным модулям принудительно направляется интернет-трафик (процесс принудительного туннелирования), также принудительно направляется трафик служб Azure. Конечные точки служб обеспечивают оптимальную маршрутизацию трафика Azure.

  Конечные точки всегда направляют трафик служб непосредственно из виртуальной сети в службу в магистральной сети Azure. Так как трафик не покидает пределы магистральной сети, это позволяет и дальше выполнять аудит и мониторинг исходящего интернет-трафика из виртуальных сетей при помощи принудительного туннелирования без воздействия на трафик служб. Ознакомьтесь со сведениями об [определяемых пользователем маршрутах и принудительном туннелировании](../virtual-network/virtual-networks-udr-overview.md).

- **Простота настройки и управления**. Вам больше не требуются зарезервированные общедоступные IP-адреса в виртуальных сетях для защиты ресурсов Azure при помощи брандмауэра для IP-адресов. Для настройки конечных точек служб не нужны устройства NAT или шлюзы. Чтобы настроить конечную точку службы, достаточно щелкнуть подсеть. Обслуживание конечных точек не требует дополнительных расходов.

Дополнительные сведения о конечных точках службы и службах и регионах Azure, для которых доступны конечные точки, см. в статье [Конечные точки службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).

## <a name="next-step"></a>Дальнейшие действия
Дополнительные рекомендации по обеспечению безопасности, используемые при разработке, развертывании облачных решений и управлении ими с помощью Azure, см. в статье [Рекомендации и шаблоны для обеспечения безопасности в Azure](security-best-practices-and-patterns.md).
