---
title: Рекомендации по обеспечению безопасности баз данных Azure | Документация Майкрософт
description: В этой статье представлены рекомендации по безопасности баз данных Azure.
services: security
documentationcenter: na
author: unifycloud
manager: barbkess
editor: tomsh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/20/2018
ms.author: tomsh
ms.openlocfilehash: 3e244f89904ce9aca161ed1ea435f4137e42bc5d
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60587533"
---
# <a name="azure-database-security-best-practices"></a>Рекомендации по обеспечению безопасности базы данных Azure
При управлении базами данных безопасность имеет первостепенное значение и всегда была приоритетной задачей для [Базы данных SQL Azure](https://docs.microsoft.com/azure/sql-database/). Вы можете обеспечить надежную защиту баз данных, чтобы удовлетворить большинство нормативных требований или требований безопасности, включая стандарты HIPAA, ISO 27001/27002 и PCI DSS (уровень 1). Текущий список сертификатов соответствия требованиям безопасности доступен на [сайте Центра управления безопасностью Майкрософт](https://azure.microsoft.com/support/trust-center/services/). В зависимости от нормативных требований базы данных можно также разместить в определенных центрах обработки данных.

В этой статье мы рассмотрим рекомендации по обеспечению безопасности баз данных Azure. В основе рекомендаций лежит наш опыт в области защиты баз данных в Azure, а также отзывы клиентов.

Для каждой рекомендации будет предоставлено объяснение следующих аспектов:

-   суть рекомендации;
-   почему необходимо применять эту рекомендацию;
-   что может случиться, если не применить эту рекомендацию;
-   как научиться применять эту рекомендацию.

В этой статье изложено общепринятое мнение по рассматриваемому вопросу, а также представлены возможности и компоненты платформы Azure, доступные на момент ее написания. Со временем мнения и технологии меняются. Поэтому эта статья будет постоянно обновляться, чтобы отражать эти изменения.

## <a name="use-firewall-rules-to-restrict-database-access"></a>Использование правил брандмауэра для ограничения доступа к базе данных
База данных SQL Microsoft Azure предоставляет службу реляционной базы данных для приложений Azure и других веб-приложений. Чтобы обеспечить безопасность доступа, База данных SQL управляет доступом с помощью:

- правил брандмауэра, которые ограничивают подключения по IP-адресу;
- механизмов аутентификации, требующих подтверждения подлинности пользователей;
- механизмов авторизации, позволяющих предоставить пользователям доступ только к определенным действиям и данным.

Брандмауэр запрещает любой доступ к серверу базы данных, пока вы не укажете компьютеры, у которых есть разрешение на доступ. Брандмауэр предоставляет доступ к базам данным на основе исходного IP-адреса каждого запроса.

На следующем рисунке показано, где выполняется настройка брандмауэра для сервера в Базе данных SQL.

![Правила файрволла](./media/azure-database-security-best-practices/azure-database-security-best-practices-Fig1.png)

Служба базы данных SQL Azure доступна только на TCP-порте 1433. Для получения доступа к базе данных Azure со своего компьютера убедитесь, что брандмауэр клиентского компьютера пропускает исходящие подключения по протоколу TCP через порт 1433. Блокируйте входящие подключения через TCP-порт 1433 с помощью правил брандмауэра, если эти подключения не нужны другим приложениям.

В рамках процесса подключения все подключения от виртуальных машин Azure будут перенаправлены на IP-адрес и порт, уникальные для каждой рабочей роли. Номер порта находится в диапазоне от 11000 до 11999. Дополнительные сведения о TCP-портах см. в статье [Порты для ADO.NET 4.5, отличные от порта 1433](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).

Дополнительные сведения о правилах брандмауэра см. в статье [Обзор правил брандмауэра базы данных SQL Azure](../sql-database/sql-database-firewall-configure.md).

> [!Note]
> Помимо правил фильтрации IP-адресов брандмауэр управляет правилами виртуальной сети. Правила виртуальной сети основаны на конечных точках служб для виртуальной сети. В некоторых случаях предпочтительнее использовать правила виртуальной сети, а не правила фильтрации IP-адресов. Чтобы узнать больше, ознакомьтесь со статьей [Использование конечных точек служб и правил виртуальной сети для Базы данных SQL Azure и Хранилища данных SQL](../sql-database/sql-database-vnet-service-endpoint-rule-overview.md).

## <a name="enable-database-authentication"></a>Включение проверки подлинности базы данных
База данных SQL поддерживает два типа аутентификации: SQL Server и Azure AD.

### <a name="sql-server-authentication"></a>*Аутентификация SQL Server*

Это дает такие преимущества:

- Позволяет Базе данных SQL поддерживать среды с несколькими операционными системами, где все пользователи не проходят аутентификацию с помощью домена Windows.
- Позволяет Базе данных SQL поддерживать более старые приложения и приложения, поставляемые партнерами, для которых требуется аутентификация SQL Server.
- Позволяет пользователям устанавливать соединения из неизвестных или недоверенных доменов. Например, приложение, в котором клиенты подключаются с помощью назначенных учетных данных SQL Server для получения состояния их заказов.
- Позволяет Базе данных SQL поддерживать веб-приложения, в которых пользователи создают собственные удостоверения.
- Позволяет разработчикам программного обеспечения распространять свои приложения с помощью сложной иерархии разрешений на основе известных, заранее установленных учетных данных SQL Server.

> [!NOTE]
> Для аутентификации SQL Server не используются процедуры обеспечения безопасности Kerberos.

Если вы используете аутентификацию SQL Server, вам потребуется:

- самостоятельно управлять надежными учетными данными;
- защитить учетные данные в строке подключения;
- (потенциально) защитить учетные данные, передаваемые по сети с веб-сервера в базу данных. Дополнительные сведения см. в разделе [Практическое руководство. Подключение к SQL Server с помощью проверки подлинности SQL в ASP.NET 2.0](/previous-versions/msp-n-p/ff648340(v=pandp.10)).

### <a name="azure-active-directory-ad-authentication"></a>*Аутентификация Azure Active Directory (AD)*
Аутентификация Azure AD — это механизм подключения к службам "База данных SQL Azure" и [Хранилище данных SQL](../sql-data-warehouse/sql-data-warehouse-overview-what-is.md) с помощью удостоверений в Azure AD. С помощью аутентификации Azure AD можно централизованно управлять удостоверениями пользователей базы данных и другими службами Майкрософт. Централизованное управление удостоверениями позволяет использовать единое расположение для управления пользователями и упрощает управление разрешениями.

> [!NOTE]
> Мы рекомендуем использовать аутентификацию Azure AD при использовании проверки подлинности SQL Server.

Это дает такие преимущества:

- наличие альтернативного варианта проверки подлинности SQL Server;
- предотвращение распространения удостоверений пользователей на серверах базы данных;
- возможность смены паролей в одном месте;
- клиенты могут управлять разрешениями базы данных с помощью внешних групп (Azure AD);
- возможность исключить хранение паролей с помощью встроенной проверки подлинности Windows и других видов проверки подлинности, поддерживаемых Azure Active Directory;
- для аутентификации удостоверений на уровне базы данных используются данные пользователей автономной базы данных;
- поддержка аутентификации на основе маркеров для приложений, подключающихся к Базе данных SQL;
- поддерживает аутентификацию с использованием AD FS (федерация доменов) или собственную аутентификацию с помощью имени пользователя и пароля для локального экземпляра Azure Active Directory без синхронизации домена;
- Azure AD поддерживает подключения из SQL Server Management Studio, использующие универсальную аутентификацию Active Directory, в том числе Многофакторную идентификацию. MFA обеспечивает надежную аутентификацию с использованием ряда вариантов проверки посредством телефонного звонка, текстового сообщения, смарт-карты с ПИН-кодом или уведомления в мобильном приложении. Дополнительные сведения см. в статье [Универсальная проверка подлинности для Базы данных SQL и Хранилища данных SQL (поддержка SSMS для MFA)](../sql-database/sql-database-ssms-mfa-authentication.md).

Для настройки и использования аутентификации Azure AD выполните следующие действия.

- Создайте и заполните каталог Azure AD.
- Необязательно: Свяжите или измените экземпляр Active Directory, который сейчас связан с вашей подпиской Azure.
- Создайте учетную запись администратора Azure Active Directory для Базы данных SQL или [Хранилища данных SQL Azure](https://azure.microsoft.com/services/sql-data-warehouse/).
- Настройте клиентские компьютеры.
- Создайте учетные записи пользователей автономной базы данных в базе данных, сопоставленной с удостоверениями Azure AD.
- Подключитесь к базе данных с помощью удостоверений Azure AD.

Дополнительные сведения см. в статье [Использование аутентификации Azure Active Directory для аутентификации с помощью Базы данных SQL, Управляемого экземпляра или Хранилища данных SQL](../sql-database/sql-database-aad-authentication.md).

## <a name="protect-your-data-by-using-encryption-and-row-level-security"></a>Защита данных с помощью шифрования и защиты на уровне строк
[Прозрачное шифрование данных в Базе данных SQL Azure](../sql-database/transparent-data-encryption-azure-sql.md) помогает защитить данные на диске и защищает от несанкционированного доступа к оборудованию. Выполняется шифрование и расшифровка базы данных, связанных резервных копий и неактивных файлов журналов транзакций в реальном времени без необходимости изменения приложения. При использовании прозрачного шифрования данных хранилище всей базы данных шифруется с помощью симметричного ключа, который называется ключом шифрования базы данных.

Даже если хранилище данных зашифровано, нужно зашифровать и базу данных. Такой подход обеспечивает эшелонированную защиту ваших данных. Если вы используете Базу данных SQL Azure и хотите защитить конфиденциальные данные (например, номера кредитных карт или социального страхования), то вы можете использовать для шифрования базы данных 256-разрядное шифрование AES, прошедшее проверку по стандарту FIPS 140-2. Это шифрование соответствует требованиям различных отраслевых стандартов (например, HIPAA и PCI).

Файлы, относящиеся к [расширению буферного пула (BPE)](https://docs.microsoft.com/sql/database-engine/configure-windows/buffer-pool-extension), не шифруются при применении к базе данных прозрачного шифрования данных. Для защиты этих файлов следует применить средства шифрования на уровне файловой системы, например [BitLocker](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732774(v=ws.11)) или [шифрованную файловую систему (EFS)](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc749610(v%3dws.10)).

Так как авторизованные пользователи, например администратор службы безопасности или администратор базы данных, имеют доступ к данным даже при использовании прозрачного шифрования, следует соблюдать ряд рекомендаций:

- включать аутентификацию SQL Server на уровне базы данных;
- выполнять аутентификацию Azure AD с использованием [ролей RBAC](../role-based-access-control/overview.md);
- использовать раздельные учетные записи для аутентификации пользователей и приложений (это позволит ограничить разрешения, предоставляемые пользователям и приложениям, и снизить риск вредоносного действия);
- Реализация безопасности на уровне базы данных с использованием предопределенных ролей базы данных (например, db_datareader и db_datawriter). Вы также можете создать для приложения пользовательские роли, которые предоставляют явные разрешения по отношению к выбранным объектам базы данных.

Другие способы защиты данных включают следующее:

- [Шифрование на уровне ячейки](/sql/relational-databases/security/encryption/encrypt-a-column-of-data) для шифрования определенных столбцов или даже ячеек данных с использованием разных ключей шифрования.
- [Always Encrypted](/sql/relational-databases/security/encryption/always-encrypted-database-engine) позволяет клиентам шифровать конфиденциальные данные в клиентских приложениях, не раскрывая ключи шифрования в ядре СУБД (База данных SQL или SQL Server). Таким образом, Always Encrypted разделяет пользователей на владельцев данных (которые могут просматривать их) и управляющих данными (но без доступа к ним).
- [Безопасность на уровне строк](/sql/relational-databases/security/row-level-security) позволяет пользователям управлять доступом к строкам в таблице базы данных в зависимости от характеристик пользователя, выполняющего запрос. (Например, это может быть членство в группе или контекст выполнения).

Организации, не использующие шифрование на уровне базы данных, могут быть более уязвимы для атак, нацеленных на компрометацию данных в базах данных SQL.

Дополнительные сведения о прозрачном шифровании данных в Базе данных SQL см. в [этой статье](https://msdn.microsoft.com/library/0bf7e8ff-1416-4923-9c4c-49341e208c62.aspx).

## <a name="enable-database-auditing"></a>Включение аудита базы данных
Аудит экземпляра ядра СУБД SQL Server или отдельной базы данных включает в себя отслеживание и ведение журнала событий. Для SQL Server можно создать аудиты, содержащие спецификации для событий на уровне сервера и спецификации для событий на уровне базы данных. Прошедшие аудит события могут записываться в журналы событий или файлы аудита.

Для SQL Server есть несколько уровней аудита в зависимости от нормативных или стандартных требований для вашей установки. Подсистема аудита SQL Server предоставляет инструменты и процессы, необходимые для включения, хранения и просмотра аудитов на различных объектах серверов и баз данных.

[Аудит Базы данных SQL Azure](../sql-database/sql-database-auditing.md) позволяет отслеживать события базы данных и записывать их в журнал аудита в учетной записи хранения Azure.

Аудит может помочь вам соблюсти стандарты, проанализировать работу с базой данных и найти расхождения и аномалии, которые могут указывать на бизнес-проблемы или нарушения безопасности. Аудит способствует соблюдению стандартов соответствия, но не гарантирует их выполнение.

Дополнительные сведения об аудите базы данных и его включении см. в статье [Приступая к работе с аудитом базы данных SQL](../sql-database/sql-database-auditing.md).

## <a name="enable-database-threat-detection"></a>Обнаружение угроз для базы данных
Защита от угроз выходит за пределы обнаружения. Защита от угроз для базы данных включает:

- Обнаружение и классификацию наиболее важных конфиденциальных данных, чтобы вы могли защитить их.
- Реализацию конфигураций безопасности в базе данных, чтобы вы могли защитить базу данных.
- Обнаружение и реагирование на потенциальные угрозы по мере их появления, чтобы вы могли быстро реагировать на них и устранять их.

**Рекомендация**. Обнаруживайте, классифицируйте и помечайте конфиденциальные данные в базах данных.   
**Сведения**. Классифицируйте данные в базе данных SQL, включив набор служб [Обнаружение и классификация данных](../sql-database/sql-database-data-discovery-and-classification.md) в Базе данных SQL Azure. Эта функция позволяет отслеживать доступ к конфиденциальным данным на панели мониторинга Azure и скачивать отчеты.

**Рекомендация**. Отслеживайте уязвимости базы данных, чтобы иметь возможность заблаговременно повысить безопасность базы данных.   
**Сведения**. Используйте службу [Оценка уязвимостей](../sql-database/sql-vulnerability-assessment.md) Базы данных SQL Azure, которая сканирует систему на наличие потенциальных уязвимостей базы данных. Эта служба использует базу знаний правил, которые помечают уязвимости системы безопасности и указывают на отклонения от рекомендаций, в том числе на неправильные настройки, избыточные разрешения и незащищенные конфиденциальные данные.

Эти правила основаны на рекомендациях корпорации Майкрософт и направлены на проблемы безопасности, представляющие большую опасность для базы данных и ее ценных данных. Они охватывают как проблемы на уровне базы данных, так и проблемы безопасности на уровне сервера, такие как настройки брандмауэра сервера и разрешения на уровне сервера. В этих правилах также представлены многие требования контролирующих органов, что позволяет соблюдать их.

**Рекомендация**. Включите функцию обнаружения угроз.  
**Сведения**.  Включите службу [Обнаружение угроз](../sql-database/sql-database-threat-detection.md) Базы данных SQL Azure для получения оповещений системы безопасности и рекомендаций о том, как исследовать и устранить угрозы. Вы получаете оповещения о подозрительных действиях с базами данных, потенциальных уязвимостях, атаках путем внедрения кода SQL и аномальных закономерностей в доступе к базам данных и шаблонам запросов.

[Служба "Расширенная защита от угроз"](../sql-database/sql-advanced-threat-protection.md) представляет собой унифицированный пакет расширенных возможностей безопасности SQL. Он включает в себя службы, указанные ранее. Обнаружение и классификация данных, оценка уязвимостей и обнаружение угроз. Эта служба предоставляет единый центр для включения этих возможностей и управления ими.

Включение этих возможностей поможет вам:

- Соблюдать стандарты конфиденциальности данных и нормативных требований.
- Управлять доступом к базам данных и усилить их безопасность.
- Отслеживать динамическую среду базы данных, в которой сложно отслеживать изменения.
- Выявить потенциальные угрозы и реагировать на них.

Кроме того, служба обнаружения угроз интегрирует оповещения с центром безопасности Azure для полного представления состояния безопасности всех ресурсов Azure.

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные рекомендации по обеспечению безопасности, используемые при разработке, развертывании облачных решений и управлении ими с помощью Azure, см. в статье [Рекомендации и шаблоны для обеспечения безопасности в Azure](security-best-practices-and-patterns.md).

Ниже приведены ресурсы, с помощью которых можно получить общие сведения о службах безопасности Azure и связанных службах Майкрософт.
* [Блог команды безопасности Azure](https://blogs.msdn.microsoft.com/azuresecurity/). Благодаря этому блогу вы будете в курсе последних новостей о безопасности Azure.
* [Microsoft Security Response Center](https://technet.microsoft.com/library/dn440717.aspx). Это место, куда можно сообщать об уязвимостях, в том числе о проблемах Azure. Это также можно сделать по почте, отправив сообщение по адресу secure@microsoft.com.
