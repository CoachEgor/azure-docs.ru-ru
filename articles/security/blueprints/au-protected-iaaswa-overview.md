---
title: Схема безопасности и соответствия требованиям Azure. Веб-приложение IaaS для среды AU-PROTECTED
description: Схема безопасности и соответствия требованиям Azure. Веб-приложение IaaS для среды AU-PROTECTED
services: security
author: meladie
ms.assetid: f53a25c4-1c75-42d6-a0e7-a91661673891
ms.service: security
ms.topic: article
ms.date: 08/23/2018
ms.author: meladie
ms.openlocfilehash: 3c82a88ea15b52672f9bed428e2e7af40a65309c
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60610199"
---
# <a name="azure-security-and-compliance-blueprint---iaas-web-application-for-australia-protected"></a>Схема безопасности и соответствия требованиям Azure. Веб-приложение IaaS для среды AU-PROTECTED

## <a name="overview"></a>Обзор
Эта схема безопасности и соответствия требованиям Azure содержит рекомендации по развертыванию среды IaaS (инфраструктура как услуга) для сбора, хранения и извлечения защищенных данных правительства Австралии (AU-PROTECTED) в соответствии с целями Руководства правительства Австралии по информационной безопасности (далее ISM), подготовленного австралийским управлением радиотехнической обороны (далее ASD). Эта схема представляет эталонную архитектуру и демонстрирует правильную обработку конфиденциальных правительственных данных в безопасной, совместимой многоуровневой среде.

Представленные здесь эталонная архитектура, руководство по реализации и модель обнаружения угроз могут использоваться клиентами как схема реализации собственных процессов планирования и аккредитации систем для развертывания рабочих нагрузок в Azure в соответствии с требованиями ASD. Клиенты могут внедрить VPN-шлюз Azure или ExpressRoute для доступа к федеративным службам и интеграции локальных ресурсов с ресурсами Azure. Клиентам необходимо учитывать влияние локальных ресурсов на безопасность. Для обеспечения соответствия всем требованиям необходима дополнительная настройка, так как эти требования могут быть разными в зависимости от специфики реализации для каждого клиента.

Соответствие требованиям ASD включает обязательный аудит системы зарегистрированным экспертом по информационной безопасности. Клиенты несут ответственность за выполнение надлежащей оценки безопасности и соответствия любого решения, созданного с использованием этой архитектуры, так как требования могут варьироваться в зависимости от специфики реализации каждого клиента.

## <a name="architecture-diagram-and-components"></a>Схема и компоненты архитектуры
Это решение позволяет развернуть эталонную архитектуру для веб-приложения IaaS с внутренним сервером SQL Server. Архитектура включает веб-уровень, уровень данных, инфраструктуру Active Directory, шлюз приложений и Load Balancer. Виртуальные машины, развернутые на веб-уровне и уровне данных, настраиваются в группе доступности, а экземпляры SQL Server — в группе доступности AlwaysOn. Это обеспечивает высокий уровень доступности. Виртуальные машины присоединены к доменам, а с помощью политик группы Active Directory обеспечивается безопасность и соответствие конфигурациям на уровне операционной системы. Управляющий узел-бастион предоставляет безопасное подключение для администраторов, позволяющее получить доступ к развернутым ресурсам.

Архитектура предоставляет безопасную гибридную среду, которая расширяет локальную среду в Azure, позволяя корпоративным пользователям из частной локальной сети организации или из Интернета безопасно получать доступ к сетевым рабочим нагрузкам. Клиент несет полную ответственность за все аспекты безопасности, эксплуатации и соответствия для всех локальных решений.

Ресурсы Azure, которые входят в такие решения, могут подключаться к локальной сети или к центру размещения центра обработки данных (например, CDC в Канберре) через VPN IPSec с VPN-шлюзом Azure или через ExpressRoute. Решение о выборе VPN следует принимать с учетом классификации передаваемых данных и используемого сетевого пути. Клиентам, которые используют крупномасштабные и критически важные рабочие нагрузки с требованиями для больших данных, мы рекомендуем применять гибридную сетевую архитектуру с подключением частной сети к облачным службам Azure через ExpressRoute. Ознакомьтесь с разделом советов и рекомендаций, чтобы получить дополнительные сведения о механизмах подключения к Azure.

Следует использовать федерацию с Azure Active Directory, чтобы пользователи могли проходить проверку подлинности с использованием локальных учетных данных и получали доступ ко всем облачным ресурсам через локальную инфраструктуру служб федерации Active Directory. Службы федерации Active Directory позволяют реализовать защищенную упрощенную федерацию удостоверений и единый вход для такой гибридной среды. Ознакомьтесь с разделом советов и рекомендаций, чтобы получить дополнительные сведения о настройке Azure Active Directory.

В решении используются учетные записи хранения Azure, в которых клиенты могут настроить использование Шифрования службы хранилища, чтобы обеспечить конфиденциальность неактивных данных. Для обеспечения устойчивости Azure хранит три копии данных в выбранном клиентом регионе. Регионы Azure развертываются парами для обеспечения дополнительной устойчивости, а хранилище с географической избыточностью гарантирует репликацию данных в другой регион, где также создаются три копии. Такая схема позволяет избежать потери данных даже при серьезных неполадках в основном расположении хранения данных клиента.

Для повышения уровня безопасности все ресурсы в этом решении управляются как группа ресурсов с помощью Azure Resource Manager. Управление доступом на основе ролей Azure Active Directory используется для управления доступом к развернутым ресурсам и ключам в Azure Key Vault. Мониторинг работоспособности системы осуществляется через центр безопасности Azure и Azure Monitor. Клиенты могут настроить обе службы мониторинга для ведения журналов и отображения работоспособности системы на единой панели мониторинга с удобной навигацией. Шлюз приложений Azure настраивается как брандмауэр в режиме предотвращения и разрешает передачу трафика по протоколу TLS версии не ниже 1.2.

![Эталонная архитектура веб-приложения IaaS для среды AU-PROTECTED](images/au-protected-iaaswa-architecture.png?raw=true "Схема эталонной архитектуры веб-приложения IaaS для среды AU-PROTECTED") 

Это решение использует следующие службы Azure. Дополнительные сведения содержатся в разделе [Deployment architecture](#deployment-architecture) (Архитектура развертывания).

- Группы доступности
    - (1) узлы кластера SQL;
    - (1) Веб-службы и службы IIS.
- Azure Active Directory
- Шлюз приложений Azure
    - (1) Брандмауэр веб-приложения
        - режим брандмауэра — предотвращение;
        - Набор правил: OWASP 3.0
        - Порт прослушивания: 443
- Облако-свидетель Azure.
- Хранилище ключей Azure
- Azure Load Balancer
- Azure Monitor
- Azure Resource Manager
- Центр безопасности Azure
- Журналы Azure Monitor
- Хранилище Azure
- Виртуальные машины Azure
    - (1) управляющий узел или узел бастион (Windows Server 2016 Datacenter);
    - (2) узел кластера SQL Server (SQL Server 2017 в Windows Server 2016);
    - (2) Веб-службы и службы IIS (Windows Server 2016 Datacenter).
- Виртуальная сеть Azure
    - (4) Группы безопасности сети
    - Наблюдатель за сетями Azure
- Хранилище служб восстановления

В эту схему включены службы Azure, которые не сертифицированы для использования с данными защищенной категории (Protected) по классификации Национального центра кибербезопасности Австралии (ACSC). Все службы, включенные в эту эталонную архитектуру, были сертифицированы ACSC на уровне меток ограничения распространения (DLM). Корпорация Майкрософт рекомендует клиентам изучить опубликованные отчеты о безопасности и результаты аудита, связанные с такими службами Azure, чтобы на основе используемой платформы управления рисками оценить их пригодность для внутренней аккредитации и применения с данными защищенной категории.

## <a name="deployment-architecture"></a>Архитектура развертывания
В следующем разделе подробно описываются компоненты развертывания и реализации.

**Узел-бастион**. Узел-бастион является единой точкой входа, которая позволяет пользователям получать доступ к ресурсам, развернутым в этой среде. Узел-бастион предоставляет безопасное подключение к развернутым ресурсам, разрешая только удаленный трафик с общедоступных IP-адресов из надежного списка. Для разрешения трафика по протоколу удаленного рабочего стола (RDP) источник трафика должен быть определен в группе безопасности сети.

Это решение создает виртуальную машину в виде присоединенного к домену узла-бастиона со следующими настройками:
-   [расширение защиты от вредоносных программ](https://docs.microsoft.com/azure/security/azure-security-antimalware);
-   [Расширение системы диагностики Azure](https://docs.microsoft.com/azure/virtual-machines/virtual-machines-windows-extensions-diagnostics-template)
-   [шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption) с помощью хранилища ключей Azure Key Vault;
-   [политика автоматического завершения работы](https://azure.microsoft.com/blog/announcing-auto-shutdown-for-vms-using-azure-resource-manager/) для уменьшения степени использования ресурсов виртуальной машины во время простоя.

### <a name="virtual-network"></a>Виртуальная сеть
Архитектура определяет частную виртуальную сеть с пространством адресов 10.200.0.0/16.

**Группы безопасности сети**. Решение развертывает ресурсы в архитектуре с отдельной веб-подсетью, подсетью базы данных, подсетью Active Directory и подсетью управления внутри виртуальной сети. Подсети логически разделены правилами групп безопасности сети, применяемыми к отдельным подсетям, которые настроены таким образом, чтобы между подсетями проходил только трафик, который необходим для работы функций системы и управления.

См. конфигурацию [групп безопасности сети](https://github.com/Azure/fedramp-iaas-webapp/blob/master/nestedtemplates/virtualNetworkNSG.json), развертываемых с этим решением. Организации могут настроить группы безопасности сети, изменив файл, приведенный выше, с использованием [этой документации](https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg) в качестве руководства.

Каждая из подсетей имеет выделенную группу безопасности сети:
- 1 группа безопасности сети для шлюза приложений (LBNSG)
- 1 группа безопасности сети для узла-бастиона (MGTNSG)
- 1 группа безопасности сети для серверов SQL Server и облака-свидетеля (SQLNSG)
- 1 группа безопасности сети для веб-уровня (WEBNSG)

### <a name="data-in-transit"></a>Передаваемые данные
Azure по умолчанию шифрует весь обмен данными в центрах обработки данных в обоих направлениях. 

Для данных защищенной категории при передаче из сетей, принадлежащих клиенту, эта архитектура использует Интернет или ExpressRoute с VPN-шлюзом и протоколом IPSEC.

Кроме того все транзакции в Azure на портале управления Azure происходит через HTTPS с использованием TLS 1.2.

### <a name="data-at-rest"></a>Неактивные данные
Архитектура защищает неактивные данные, используя шифрование, аудит базы данных и другие меры.

**Служба хранилища Azure**. Для выполнения требований к шифрованию неактивных данных во всей [службе хранилища Azure](https://azure.microsoft.com/services/storage/) используется [шифрование службы хранилища](https://docs.microsoft.com/azure/storage/storage-service-encryption). Это помогает защищать и охранять данные в рамках корпоративных обязательств по безопасности и соответствию требованиям, определенным в Руководстве правительства Австралии по информационной безопасности (ISM).

**Шифрование дисков Azure**. Служба [Шифрование дисков Azure](https://docs.microsoft.com/azure/security/azure-security-disk-encryption) использует компонент BitLocker в Windows, чтобы обеспечить шифрование томов для дисков данных. Решение интегрируется с Azure Key Vault, что помогает управлять ключами шифрования дисков.

**SQL Server**. В экземпляре SQL Server используются следующие меры безопасности базы данных.
-   [Аудит SQL Server](https://docs.microsoft.com/sql/relational-databases/security/auditing/sql-server-audit-database-engine?view=sql-server-2017) отслеживает события базы данных и записывает их в журналы аудита.
-   [Прозрачное шифрование данных](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption?view=sql-server-2017) выполняет шифрование и дешифрование базы данных в реальном времени, связанных с ней резервных копий и файлов журнала транзакций для защиты неактивной информации. Прозрачное шифрование данных позволяет защитить сохраненные данные от несанкционированного доступа.
-   [Правила брандмауэра](https://docs.microsoft.com/azure/sql-database/sql-database-firewall-configure) предотвращают любой доступ к серверам баз данных без надлежащих разрешений. Брандмауэр предоставляет доступ к базам данным на основе исходного IP-адреса каждого запроса.
-   [Зашифрованные столбцы](https://docs.microsoft.com/sql/relational-databases/security/encryption/always-encrypted-wizard?view=sql-server-2017) гарантируют, что конфиденциальные данные никогда не отобразятся как открытый текст внутри системы баз данных. После включения шифрования данных получить доступ к данным в виде открытого текста смогут только клиентские приложения и серверы приложений, у которых есть доступ к ключам.
- [Динамическое маскирование данных](https://docs.microsoft.com/sql/relational-databases/security/dynamic-data-masking?view=sql-server-2017) ограничивает возможность раскрытия конфиденциальных данных, маскируя их для непривилегированных пользователей или приложений. Динамическое маскирование данных может автоматически обнаруживать потенциально конфиденциальные данные и предлагать применение соответствующих масок. Это помогает сократить доступ, так что конфиденциальные данные не извлекаются из базы данных с помощью несанкционированного доступа. **Клиенты несут ответственность за настройку параметров динамического маскирования данных в соответствии со своей схемой базы данных.**

### <a name="identity-management"></a>Управление удостоверениями
Клиенты могут использовать локальные службы федерации Active Directory для федерации с [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) (поддерживается корпорацией Майкрософт как мультитенантный облачный каталог и служба управления удостоверениями). [Azure Active Directory Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect) интегрирует локальные каталоги с Azure Active Directory. Для всех пользователей этого решения требуются учетные записи Azure Active Directory. Федеративный вход позволяет пользователям входить в Azure Active Directory и получать доступ к ресурсам Azure с использованием локальных учетных данных.

Кроме того, следующие функции Azure Active Directory помогают управлять доступом к данным в среде Azure:
- Аутентификация приложения выполняется с использованием Azure Active Directory. Дополнительные сведения см. в статье [Интеграция приложений с Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/active-directory-integrating-applications).
- [Управление доступом на основе ролей Azure](https://docs.microsoft.com/azure/active-directory/role-based-access-control-configure) позволяет администраторам определять детальные разрешения доступа, предоставляя его ровно в той мере, которая необходима пользователям для выполнения работы. Вместо предоставления каждому пользователю неограниченных разрешений на ресурсы Azure администраторы могут разрешить только определенные действия для доступа к данным. Доступ к подписке есть только у администратора подписки.
- [Azure Active Directory Privileged Identity Management](https://docs.microsoft.com/azure/active-directory/active-directory-privileged-identity-management-getting-started) позволяет клиентам свести к минимуму число пользователей, имеющих доступ к определенной информации. Администраторы могут использовать Azure Active Directory Privileged Identity Management для обнаружения, ограничения и отслеживания привилегированных удостоверений, а также их доступа к ресурсам. Эту функцию можно также задействовать для получения административного JIT-доступа по требованию, когда это необходимо.
- [Защита идентификации Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-identityprotection) выявляет потенциальные уязвимости, затрагивающие удостоверения организации, настраивает автоматическое реагирование на обнаруженные подозрительные действия, связанные с удостоверениями организации, и исследует подозрительные инциденты для принятия соответствующих мер по их устранению.

**Многофакторная идентификация Azure**. Реализует многофакторную идентификацию для защиты удостоверений. Служба [Многофакторная идентификация Azure](https://azure.microsoft.com/services/multi-factor-authentication/) — это простое в использовании, масштабируемое и надежное решение, которое предоставляет дополнительный способ проверки подлинности для защиты пользователей. Многофакторная идентификация Azure использует возможности облака и интегрируется с локальной средой Active Directory и пользовательскими приложениями. Такая защита подходит даже для критически важных сценариев с большими объемами операций.

### <a name="security"></a>Безопасность
**Управление секретами**. Для управления ключами и секретами в решении используется [Azure Key Vault](https://azure.microsoft.com/services/key-vault/). Хранилище ключей Azure помогает защитить криптографические ключи и секреты, используемые облачными приложениями и службами. Следующие возможности Azure Key Vault помогают клиентам защитить эти данные и получить доступ к ним:

- Политики расширенного доступа настраиваются по мере необходимости.
- Политики доступа к Key Vault определены с минимальными необходимыми разрешениями на использование ключей и секретов.
- Все ключи и секреты в Key Vault имеют срок действия.
- Все ключи в Key Vault защищены специализированными аппаратными модулями безопасности. Тип ключа — 2048-разрядный ключ RSA, защищенный аппаратным модулем безопасности.
- Всем пользователям или идентификаторам предоставляются минимальные необходимые разрешения с помощью управления доступом на основе ролей.
- Для журналов диагностики хранилища ключей включен срок хранения не менее 365 дней.
- Допустимые операции шифрования для ключей доступны только тем пользователям, которым они нужны.
- Решение интегрируется с Azure Key Vault, чтобы обеспечить управление секретами и ключами шифрования диска виртуальной машины IaaS.

**Управление исправлениями**. Виртуальные машины Windows, развернутые как часть этой эталонной архитектуры, настраиваются по умолчанию для получения автоматических обновлений из службы Центра обновления Windows. Это решение также включает службу [автоматизации Azure](https://docs.microsoft.com/azure/automation/automation-intro), с помощью которой можно создавать обновленные развертывания для исправления виртуальных машин при необходимости.

**Защита от вредоносных программ**. [Microsoft Antimalware](https://docs.microsoft.com/azure/security/azure-security-antimalware) для виртуальных машин Azure предоставляет возможности защиты в реальном времени для обнаружения и удаления вирусов, шпионских и других вредоносных программ. Вы можете настроить оповещения о попытках установки или выполнения вредоносных или нежелательных программ на защищенных виртуальных машинах.

**Центр безопасности Azure**. С помощью [Центра безопасности Azure](https://docs.microsoft.com/azure/security-center/security-center-intro) клиенты могут централизованно применять политики безопасности и управлять ими в рабочих нагрузках, ограничивать подверженность системы к угрозам, а также выявлять атаки и реагировать на них. Кроме того, центр безопасности Azure обращается к существующей конфигурации служб Azure и предоставляет конфигурацию и рекомендации по службам для повышения уровня безопасности и защиты данных.

В центре безопасности Azure используются различные возможности обнаружения, чтобы оповещать клиентов о потенциальных атаках на их среды. Эти оповещения содержат важные сведения о причине их активации, ресурсах, на которые нацелена атака, и ее источнике. Центр безопасности Azure имеет ряд предопределенных [оповещений безопасности](https://docs.microsoft.com/azure/security-center/security-center-alerts-type), которые активируются при возникновении угрозы или подозрительной активности. [Настраиваемые правила генерации оповещений](https://docs.microsoft.com/azure/security-center/security-center-custom-alert) в центре безопасности Azure позволяют клиентам определять новые оповещения безопасности на основе данных, собранных из их среды.

Центр безопасности Azure предоставляет приоритетные оповещения безопасности и инциденты, упрощая процедуры обнаружения и устранения потенциальных проблем безопасности. Для каждой обнаруженной угрозы создается [отчет об исследовании угроз](https://docs.microsoft.com/azure/security-center/security-center-threat-report). Это позволяет командам реагирования на инциденты расследовать и устранять угрозы.

Кроме того, эта эталонная архитектура использует [оценку уязвимости](https://docs.microsoft.com/azure/security-center/security-center-vulnerability-assessment-recommendations) в центре безопасности Azure. После настойки агент партнера (например, Qualys) начнет отправку сведений об уязвимостях на платформу управления партнера. В свою очередь платформа управления партнера предоставляет данные мониторинга уязвимости и работоспособности в центре безопасности Azure, что позволяет клиентам быстро идентифицировать уязвимые виртуальные машины.

**Шлюз приложений Azure**. Архитектура снижает риск уязвимостей безопасности с помощью шлюза приложений Azure с настроенным брандмауэром веб-приложения и включенным набором правил OWASP. Доступны следующие дополнительные возможности:

- [сквозное SSL-подключение](https://docs.microsoft.com/azure/application-gateway/application-gateway-end-to-end-ssl-powershell);
- включение [разгрузки SSL](https://docs.microsoft.com/azure/application-gateway/application-gateway-ssl-portal);
- отключение [TLS версий 1.0 и 1.1](https://docs.microsoft.com/azure/application-gateway/application-gateway-end-to-end-ssl-powershell);
- [брандмауэр веб-приложения](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-application-firewall-overview) (режим предотвращения);
- [режим предотвращения](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-application-firewall-portal) с набором правил OWASP 3.0.
- включение [ведения журналов диагностики](https://docs.microsoft.com/azure/application-gateway/application-gateway-diagnostics);
- [пользовательские пробы работоспособности](https://docs.microsoft.com/azure/application-gateway/application-gateway-create-gateway-portal);
- [Центр безопасности Azure](https://azure.microsoft.com/services/security-center) и [Помощник Azure](https://docs.microsoft.com/azure/advisor/advisor-security-recommendations) обеспечивают дополнительную защиту и уведомления. Центр безопасности Azure также предоставляет систему репутации.

### <a name="business-continuity"></a>Непрерывность бизнес-процессов
**Высокий уровень доступности**. Решение развертывает все виртуальные машины в группе доступности. Дополнительные сведения см. в [этом руководстве](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-availability-sets). Группа доступности распределяет виртуальные машины между несколькими изолированными аппаратными кластерами, чтобы повысить уровень доступности. Во время планового или внепланового технического обслуживания доступна как минимум одна виртуальная машина, что соответствует соглашению об уровне обслуживания Azure, гарантирующему доступность в течение 99,95 % времени.

**Хранилище служб восстановления**. [Хранилище Служб восстановления](https://docs.microsoft.com/azure/backup/backup-azure-recovery-services-vault-overview) содержит резервные копии данных и защищает все конфигурации виртуальных машин Azure в этой архитектуре. С помощью хранилища служб восстановления клиенты могут восстановить отдельные файлы и папки виртуальной машины IaaS, а не всю виртуальную машину. Это сокращает время восстановления.

**Облако-свидетель**. [Облако-свидетель](https://docs.microsoft.com/windows-server/failover-clustering/whats-new-in-failover-clustering#BKMK_CloudWitness) — это тип свидетеля кворума отказоустойчивого кластера в Windows Server 2016, использующий Azure в качестве точки разрешения конфликтов. Для облака-свидетеля, как и для других свидетелей кворума, предоставляется возможность голосования и участия в подсчетах кворума, но используется стандартное общедоступное хранилище BLOB-объектов Azure. Это позволяет избежать дополнительных затрат на обслуживание виртуальных машин, размещенных в общедоступном облаке.

### <a name="logging-and-auditing"></a>Ведение журналов и аудит
Службы Azure обеспечивают детальную запись системных и пользовательских действий, а также сведений о работоспособности системы.
- **Журналы действий**. [Журналы действий](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-activity-logs) предоставляют информацию об операциях, которые выполнялись с ресурсами в подписке. Журналы действий помогают определить инициатора операции, время события и состояние.
- **Журналы диагностики**. [Журналы диагностики](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs) включают все журналы, создаваемые ресурсами. К этим журналам относятся системные журналы событий Windows, журналы службы хранилища Azure, журналы аудита Key Vault, а также журналы брандмауэра и доступа к шлюзу приложений. Все журналы диагностики обеспечивают запись данных в централизованную и зашифрованную учетную запись Azure для архивирования. В соответствии с требованиями конкретной организации пользователь может настроить срок хранения до 730 дней.

**Журналы Azure Monitor**. Эти журналы объединяются в [журналы Azure Monitor](https://azure.microsoft.com/services/log-analytics/) для обработки, хранения и создания отчетов информационной панели. После сбора данные объединяются в отдельные таблицы для каждого типа данных, что позволяет анализировать все данные независимо от исходного источника. Кроме того центр безопасности Azure интегрируется с журналами Azure Monitor, позволяя клиентам использовать запросов Kusto получить доступ к данным событий безопасности и использовать ее в сочетании с данными из других служб.

Следующие Azure [решения для мониторинга](https://docs.microsoft.com/azure/log-analytics/log-analytics-add-solutions) включены как часть этой архитектуры:
-   [Оценка Active Directory](https://docs.microsoft.com/azure/log-analytics/log-analytics-ad-assessment). Решение "Проверка работоспособности Active Directory" регулярно оценивает риски и работоспособность серверных сред и предоставляет список рекомендаций, относящихся к развернутой серверной инфраструктуре, в порядке приоритета.
- [Оценка SQL](https://docs.microsoft.com/azure/log-analytics/log-analytics-sql-assessment). Решение "Проверка работоспособности SQL" регулярно оценивает риски и работоспособность серверных сред и предоставляет клиентам список рекомендаций, относящихся к развернутой серверной инфраструктуре и перечисленных в порядке приоритета.
- [Работоспособность агентов](https://docs.microsoft.com/azure/operations-management-suite/oms-solution-agenthealth). Решение "Работоспособность агентов" сообщает количество развернутых агентов, их географическое распределение, а также количество агентов, которые перестают отвечать на запросы, и агентов, которые отправляют операционные данные.
-   [Аналитика журнала действий](https://docs.microsoft.com/azure/log-analytics/log-analytics-activity). Решение Azure Activity Log Analytics помогает анализировать журналы действий Azure во всех подписках Azure для клиента.

**Служба автоматизации Azure**. [Служба автоматизации Azure](https://docs.microsoft.com/azure/automation/automation-hybrid-runbook-worker) обеспечивает хранение и выполнение модулей runbook, а также управление ими. В этом решении модули runbook помогают собирать журналы из Azure SQL Server. Решение [Отслеживание изменений](https://docs.microsoft.com/azure/automation/automation-change-tracking) службы автоматизации позволяет клиентам легко определять изменения в среде.

**Azure Monitor**. [Azure Monitor](https://docs.microsoft.com/azure/monitoring-and-diagnostics/) помогает пользователям отслеживать производительность, поддерживать безопасность и выявлять тенденции, предоставляя организациям возможность аудита, создания оповещений и архивации данных, включая отслеживание вызовов API в ресурсах Azure.

[Наблюдатель за сетями Azure](https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview): Наблюдатель за сетями Azure предоставляет инструменты для мониторинга, диагностики, просмотра метрик и включения или отключения журналов для ресурсов в виртуальной сети Azure.  Организации Австралийского союза должны поддерживать журналы потоков Наблюдателя за сетями для всех групп безопасности сети и Виртуальных машин. Эти журналы должны храниться в выделенной учетной записи хранения, предназначенной только для журналов безопасности, доступ к которой следует защитить с помощью элементов управления доступом на основе ролей.

## <a name="threat-model"></a>Модель рисков
Схему потока данных для этой эталонной архитектуры можно [скачать](https://aka.ms/au-protected-iaaswa-tm) или просмотреть ниже. Используя эту модель, клиенты могут выявить зоны потенциального риска в инфраструктуре системы при внесении изменений.

![Модель угроз для веб-приложения IaaS AU-PROTECTED](images/au-protected-iaaswa-threat-model.png?raw=true "Схема модели угроз для веб-приложения IaaS AU-PROTECTED")

## <a name="compliance-documentation"></a>Документация по соответствию
Эта документация по соответствию составлена корпорацией Майкрософт с учетом характеристик платформ и служб корпорации Майкрософт. В силу широкого разнообразия клиентских развертываний в документации приведен обобщенный подход для решений, размещенных в среде Azure. Клиенты могут выбирать и использовать другие продукты и службы с учетом особенностей операционной среды и бизнес-целей. Клиенты, которые выбирают работу с локальными ресурсами, должны самостоятельно оценить требования к безопасности и эксплуатации для этих локальных ресурсов. Клиенты могут изменять приведенное решение с учетом требований к локальной сети и безопасности.

В документе [Схема безопасности и соответствия требованиям Azure. Таблица ответственности клиента AU-PROTECTED](https://aka.ms/au-protected-crm) перечислены все обязательные элементы безопасности для AU-PROTECTED. В этой таблице указано, кто отвечает за управление каждого принципа: корпорация Майкрософт, клиент или все вместе.

В документе [Схема безопасности и соответствия требованиям Azure. Таблица реализации веб-приложения IaaS для AU-PROTECTED](https://aka.ms/au-protected-iaaswa-cim) содержатся сведения о том, какие элементы управления AU-PROTECTED учтены в архитектуре веб-приложения IaaS. Сюда включены подробные описания того, как реализация соответствует требованиям каждого элемента управления.

## <a name="guidance-and-recommendations"></a>Инструкции и рекомендации
### <a name="vpn-and-expressroute"></a>VPN и ExpressRoute
Для конфиденциальных данных необходимо настроить защищенный туннель VPN IPSec, чтобы создать защищенное подключение к ресурсам, развернутым в рамках эталонной архитектуры для веб-приложений IaaS. Правильно настроив VPN-подключение IPSec, клиенты обеспечат дополнительный уровень защиты для передаваемых данных.

Используя защищенный VPN-туннель IPSec с помощью Azure, можно создать виртуальное частное подключение между локальной сетью и виртуальной сетью Azure. Такое подключение проходит через Интернет и позволяет безопасно передавать данные по туннелю внутри зашифрованного канала между сетью клиента и Azure. VPN типа "сеть — сеть" представляет собой безопасную проверенную технологию, которая десятилетиями применяется на предприятиях всех размеров. 

Так как трафик в VPN-туннеле типа "сеть — сеть" проходит через Интернет, корпорация Майкрософт отдельно предлагает вариант частного подключения. Выделенный канал связи Azure ExpressRoute создается между Azure и локальной средой или поставщиком услуг размещения Exchange, реализуя возможности частной сети. Подключения ExpressRoute не проходят через Интернет, что повышает надежность и быстродействие, а также сокращает задержки по сравнению со стандартными подключениями через Интернет. Более того, так как это прямое подключение поставщика телекоммуникационных услуг клиента, данные не передаются через Интернет и поэтому недоступны в нем.

См. [рекомендации](https://docs.microsoft.com/azure/architecture/reference-architectures/dmz/secure-vnet-hybrid) по реализации защищенной гибридной сети, расширяющей локальную сеть в Azure. 

Для защиты конфиденциальных данных при подключении через Интернет или Azure ExpressRoute клиентам необходимо настроить для VPN-шлюза IPSec следующие параметры:

• для инициатора VPN со стороны клиента время существования сопоставления безопасности не должно превышать 14 400 секунд;
• для инициатора VPN со стороны клиента режим интенсивного IKEv1 должен быть отключен;
• для инициатора VPN со стороны клиента необходимо обеспечить полную безопасность пересылки;
• для инициатора VPN со стороны клиента необходимо использовать алгоритм HMAC-SHA256 или более надежный.

Параметры конфигурации для VPN-устройств и параметры IPSec/IKE можно [получить](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpn-devices) для проверки.

### <a name="azure-active-directory-setup"></a>Настройка Azure Active Directory
Служба [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-whatis) играет важную роль в управлении развертыванием и подготовкой доступа для персонала, взаимодействующего со средой. Windows Server Active Directory можно интегрировать с Azure Active Directory [с помощью четырех простых действий](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-express).

Более того, [Azure Active Directory Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect) позволяет клиентам настроить федерацию с локальными [службами федерации Active Directory]( https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-azure-adfs) и Azure Active Directory. С помощью федеративного входа пользователи могут входить в службы Azure Active Directory с паролями от локальных учетных записей, а в корпоративной сети им не придется вводить пароли повторно. Благодаря функции федерации в службах федерации Active Directory вы можете развернуть новую установку AD FS или выбрать существующую установку в ферме Windows Server 2012 R2.

Чтобы запретить синхронизацию секретных данных в Azure Active Directory, клиенты могут ограничить репликацию с помощью атрибутов, настроив следующие параметры в Azure Active Directory Connect:
- [включите фильтрацию](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-configure-filtering);
- [отключите синхронизацию хэша паролей](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-implement-password-hash-synchronization);
- [отключите обратную запись паролей](https://docs.microsoft.com/azure/active-directory/authentication/quickstart-sspr);
- [отключите обратную запись устройств](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-feature-device-writeback);
- оставьте значения по умолчанию для параметров [предотвращения случайного удаления](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnectsync-feature-prevent-accidental-deletes) и [автоматического обновления](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-feature-automatic-upgrade).

## <a name="disclaimer"></a>Заявление об отказе
- Этот документ является исключительно информационным. МАЙКРОСОФТ НЕ ПРЕДОСТАВЛЯЕТ НИКАКИХ ГАРАНТИЙ, ЯВНЫХ, КОСВЕННЫХ ИЛИ ПРЕДУСМОТРЕННЫХ ЗАКОНОМ, В ОТНОШЕНИИ ИНФОРМАЦИИ В ЭТОМ ДОКУМЕНТЕ. Данный документ предоставляется "как есть". Сведения и мнения, представленные в данном документе, включая URL-адреса и ссылки на другие веб-сайты, могут быть изменены без предварительного уведомления. Клиенты, читающие этот документ, берут ответственность за его использование на себя.
- Настоящий документ не предоставляет клиентам юридических прав на интеллектуальную собственность в отношении продуктов или решений корпорации Майкрософт.
- Клиенты могут скопировать и использовать данный документ для внутренних справочных целей.
- Выполнение некоторых рекомендаций в этом документе может привести к более интенсивному использованию данных, а также сетевых и вычислительных ресурсов в Azure, а значит и к дополнительным затратам на лицензии или подписки Azure.
- Эта архитектура призвана служить основой, которую клиенты должны адаптировать для конкретных требований, и не должна использоваться "как есть" в рабочей среде.
- Этот документ разработан в качестве справочного материала и не определяет все способы, с помощью которых клиент может отвечать нормам и стандартам соответствия. Клиентам следует обратиться в юридический отдел своей организации, чтобы получить одобренные варианты пользовательских реализаций.
