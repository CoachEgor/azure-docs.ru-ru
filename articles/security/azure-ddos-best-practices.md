---
title: Защита от атак DDoS Azure. Рекомендации и эталонные образцы архитектуры | Документация Майкрософт
description: Узнайте, как использовать данные журналов для получения подробных сведений о приложении.
services: security
author: barclayn
manager: barbkess
editor: TomSh
ms.assetid: ''
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 06/06/2018
ms.author: barclayn
ms.openlocfilehash: 11f3dcefd283ada00e915c2d6cb8abf654590ec1
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60588164"
---
# <a name="azure-ddos-protection-best-practices-and-reference-architectures"></a>Защита от атак DDoS Azure: рекомендации и эталонная архитектура

Эта статья предназначена для ответственных за принятие решений в сфере ИТ, а также для сотрудников служб безопасности. Предполагается, что вы уже ознакомлены с Azure, сетью и безопасностью.

Для обеспечения устойчивости к распределенным атакам типа "отказ в обслуживании" (DDoS) необходимо планирование и проектирование различных режимов сбоев. В этой статье приведены рекомендации по разработке приложений в Azure для обеспечения устойчивости к атакам DDoS.

## <a name="types-of-attacks"></a>Типы атак

DDoS — это тип атаки, используемый в целях исчерпания ресурсов приложения. Цель: влияние на доступность и возможность обработки допустимых запросов приложения. Атаки становятся все более сложными и крупными по размеру и влиянию. Атаку DDoS можно направить на любую конечную точку, публично доступную через Интернет.

Azure предоставляет постоянную защиту от атак DDoS. Такая защита интегрирована в платформу Azure по умолчанию и предоставляется без дополнительной оплаты. 

Помимо базовой защиты от атак DDoS на платформе, служба [Защита от атак DDoS Azure уровня "Стандартный"](https://azure.microsoft.com/services/ddos-protection/) предоставляет расширенные возможности предотвращения сетевых атак DDoS. Она автоматически настраивается для защиты конкретных ресурсов Azure. Защиту можно включить во время создания виртуальных сетей. Кроме того, это можно сделать после создания. При этом не требуются никакие изменения приложения или ресурса.

![Роль службы "Защита от атак DDoS" в защите клиентов и виртуальной сети от злоумышленника](media/azure-ddos-best-practices/image1.png)

Атаки DDoS можно разделить на три категории: объемные, протокольные и ресурсные.

### <a name="volumetric-attacks"></a>Объемные атаки

Это наиболее распространенный тип атак DDoS. Объемные атаки — это атаки методом подбора, нацеленные на сетевой и транспортный уровни. Они направлены на исчерпание ресурсов, таких как сетевые соединения. 

Во время этих атак, чтобы переполнить сетевые уровни трафиком, который очень похож на обычный, часто используются зараженные системы. Они используют протоколы сетевого уровня, например протокол ICMP, UDP и TCP.

Распространенными атаками DDoS сетевого уровня являются TCP SYN-флуд, эхо ICMP, UDP-флуд, усиление DNS и NTP. Этот тип атаки можно использовать не только для нарушения работы службы, но и как "дымовую завесу" для более целенаправленных сетевых вторжений. Примером объемной атаки является недавний [эксплойт Memcached](https://www.wired.com/story/github-ddos-memcached/), который затронул GitHub. Эта атака была направлена против UDP-порта 11211. Она создала 1,35 ТБ/с объема атаки.

### <a name="protocol-attacks"></a>Атаки протоколов

Атаки протоколов направлены на протоколы приложений. Они пытаются использовать все доступные ресурсы в устройствах инфраструктуры, например брандмауэры, серверы приложений и подсистемы балансировки нагрузки. Атаки протоколов используют пакеты неправильного формата или содержащие аномалии протокола. Эти атаки отправляют большое количество открытых запросов, на которые отвечают и ожидают ответа сервера и другие устройства связи. Целевой объект пытается ответить на открытые запросы, в результате чего система выходит из строя.

Наиболее распространенным примером атаки DDoS на основе протокола является TCP SYN-флуд. В этой атаке отправляется последовательность запросов TCP SYN, чтобы перегрузить целевую систему. Цель состоит в том, чтобы целевой объект перестал отвечать. Сбой Dyn в 2016 году, помимо атак на уровне приложений, был вызван и атаками TCP SYN-флуд на порт 53 DNS-серверов.

### <a name="resource-attacks"></a>Атаки ресурсов

Атаки ресурсов направлены на прикладной уровень. Они запускают фоновые процессы с целью перегрузки системы. Атаки ресурсов направлены на трафик, который выглядит обычным, но загружает на сервер запросы, интенсивно использующие ЦП. Объем трафика, необходимый для исчерпания ресурсов, ниже, чем у других типов атак. Трафик в атаке ресурсов неотличим от допустимого трафика, что затрудняет обнаружение. Наиболее распространенными атаками ресурсов являются атаки на службы HTTP или HTTPS и DNS.

## <a name="shared-responsibility-in-the-cloud"></a>Разделение ответственности в облаке

Для борьбы с возрастающим разнообразием и изощренностью атак помогает стратегия эшелонированной защиты. Ответственность за безопасность лежит как на клиенте, так и на корпорации Майкрософт. Корпорация Майкрософт называет это [моделью разделения ответственности](https://azure.microsoft.com/blog/microsoft-incident-response-and-shared-responsibility-for-cloud-computing/). Это разделение ответственности представлено на приведенном рисунке:

![Обязанности клиента и Azure](media/azure-ddos-best-practices/image2.png)

Мы рекомендуем клиентам Azure ознакомиться с рекомендациями Майкрософт и создать глобально распределенные приложения, разработанные и проверенные с учетом сбоев.

## <a name="fundamental-best-practices"></a>Основные рекомендации

В следующем разделе описано руководство для создания служб Azure, которые могут устоять против атак DDoS.

### <a name="design-for-security"></a>Проектирование для безопасности

Учитывайте аспекты безопасности на протяжении всего жизненного цикла приложения — от разработки и реализации до развертывания и эксплуатации. В приложениях могут быть ошибки, позволяющие относительно малому объему запросов использовать чрезмерное количество ресурсов, что вызывает сбой службы. 

Чтобы помочь защитить службу, запущенную в Microsoft Azure, изучите архитектуру своего приложения и сосредоточьтесь на [пяти основных аспектах качества программного обеспечения](https://docs.microsoft.com/azure/architecture/guide/pillars).
Необходимо знать типичные объемы трафика, модель подключения между приложениями, а также конечные точки службы, к которым предоставлен доступ через Интернет.

Убедитесь, что приложение достаточно устойчиво для обработки отказа в службе, предназначенной для самого приложения. Безопасность и конфиденциальность создаются на платформе Azure, начиная с  [жизненного цикла безопасности ПО (SDL)](https://www.microsoft.com/sdl/default.aspx). SDL обеспечивает защиту на каждом этапе разработки и гарантирует постоянное обновление платформы Azure, чтобы сделать ее более безопасной.

### <a name="design-for-scalability"></a>Проектирование для масштабируемости

Масштабируемость — это способность системы успешно обрабатывать повышенную нагрузку. Необходимо проектировать свои приложения таким образом, чтобы они могли выполнять [горизонтальное масштабирование](https://docs.microsoft.com/azure/architecture/guide/design-principles/scale-out) для удовлетворения запроса на усиленную нагрузку, особенно в случае атаки DDoS. Если приложение зависит от одного экземпляра службы, создается единая точка отказа. Подготовка нескольких экземпляров улучшает как отказоустойчивость, так и масштабируемость системы.

Для [службы приложений Azure](../app-service/app-service-value-prop-what-is.md) выберите [план служб приложений](../app-service/overview-hosting-plans.md), где есть несколько экземпляров. Для облачных служб Azure настройте каждую роль для применения [нескольких экземпляров](../cloud-services/cloud-services-choose-me.md). Для [виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) убедитесь, что архитектура виртуальных машин содержит несколько виртуальных машин, а также что каждая виртуальная машина входит в [группу доступности](../virtual-machines/virtual-machines-windows-manage-availability.md). Мы рекомендуем использовать [масштабируемый набор виртуальных машин](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md), чтобы получить возможности автомасштабирования.

### <a name="defense-in-depth"></a>Глубинная защита

Целью глубинной защиты является управление риском с помощью различных защитных стратегий. Иерархическое распределение способов защиты в приложении уменьшает вероятность успешной атаки. Мы рекомендуем внедрять безопасные проекты для своих приложений через встроенные возможности платформы Azure.

Например, риск атаки увеличивается с размером (*контактной зоной*) приложения. Уменьшить контактную зону можно с помощью списка разрешений для закрытия диапазона IP-адресов и прослушивающих портов, которые не нужны для подсистемы балансировки нагрузки ([Azure Load Balancer](../load-balancer/load-balancer-get-started-internet-portal.md) и [шлюз приложений Azure](../application-gateway/application-gateway-create-probe-portal.md)). [Группы безопасности сети (NSG)](../virtual-network/security-overview.md) также позволяют снизить возможность атак.
С помощью [тегов служб](../virtual-network/security-overview.md#service-tags) и [групп безопасности приложений](../virtual-network/security-overview.md#application-security-groups) можно упростить создание правил безопасности и настроить сетевую безопасность как гармоничное расширение структуры приложения.

По возможности вы должны развертывать службы Azure в [виртуальной сети](../virtual-network/virtual-networks-overview.md). Это позволит ресурсам службы взаимодействовать через частные IP-адреса. По умолчанию трафик служб Azure из виртуальной сети использует общедоступные IP-адреса в качестве исходных. При помощи [конечных точек служб](../virtual-network/virtual-network-service-endpoints-overview.md) трафик службы в качестве исходных IP-адресов использует частные адреса виртуальной сети при обращении к службе Azure из виртуальной сети.

Локальные ресурсы клиентов часто подвергаются атакам наряду с ресурсами в Azure. Если вы подключаете локальную среду к Azure, мы рекомендуем свести к минимуму предоставление доступа к локальным ресурсам через Интернет. Вы можете использовать возможности масштабирования и расширенной защиты от атак DDoS для Azure, развернув в Azure общедоступные объекты. Так как подобные общедоступные объекты часто являются целью для атак DDoS, их размещение в Azure снижает влияние на локальные ресурсы.

## <a name="azure-offerings-for-ddos-protection"></a>Предложения Azure для защиты от атак DDoS

В Azure есть два предложения служб, предоставляющих защиту от сетевых атак DDoS (уровни 3 и 4): защита от атак DDoS уровня "Базовый" и защита от атак DDoS уровня "Стандартный". 

### <a name="ddos-protection-basic"></a>Защита от атак DDoS уровня "Базовый"

Защита уровня "Базовый" интегрирована в Azure по умолчанию и предоставляется без каких-либо дополнительных затрат. Масштаб и емкость глобально развернутой сети Azure обеспечивают защиту от распространенных атак сетевого уровня за счет постоянно контролируемого мониторинга трафика и устранения атак в режиме реального времени. Защита от атак DDoS уровня "Базовый" не требует изменений конфигурации пользователя или приложения. Защита от атак DDoS уровня "Базовый" помогает защитить все службы Azure, включая службы PaaS, такие как Azure DNS.

![Карта сети Azure с текстом "Глобальное присутствие средств защиты от атак DDoS" и "Начальная емкость ресурсов защиты от атак DDoS"](media/azure-ddos-best-practices/image3.png)

Защита от атак DDoS уровня "Базовый" в Azure состоит из компонентов программного обеспечения и оборудования. Плоскость управления программным обеспечением решает, когда, где и каким типом трафика нужно управлять с помощью устройств, которые анализируют и удаляют трафик атаки. Эта плоскость управления принимает решение на основе общедоступной *политики* защиты от атак DDoS. Эта политика статически устанавливается и универсально применяется ко всем клиентам Azure.

Например, в политике службы "Защита от атак DDoS" указывается, какой должен быть *установлен* объем трафика. (То есть трафик клиента должен проходить через устройства для очистки.) Затем политика указывает, как очищающие устройства должны *устранять* атаку.

Служба "Защита от атак DDoS Azure" уровня "Базовый" предназначена для защиты инфраструктуры и платформы Azure. Она снижает трафик, если он превышает скорость, которая может влиять на нескольких клиентов в многопользовательской среде. Она не предоставляет предупреждения или настраиваемые политики для каждого клиента.

### <a name="ddos-protection-standard"></a>Защита от атак DDoS уровня "Стандартный"

Защита уровня "Стандартный" предоставляет улучшенные функции устранения атак DDoS. Она автоматически настраивается для помощи в защите конкретных ресурсов Azure в виртуальной сети. Защита проста в использовании для любой новой или имеющейся виртуальной сети и не требует изменений приложений или ресурсов. Она имеет несколько преимуществ в сравнении с базовой службой, например ведение журнала, оповещения и данные телеметрии. В следующих разделах перечислены основные возможности службы "Защита от атак DDoS Azure" уровня "Стандартный".

#### <a name="adaptive-real-time-tuning"></a>Адаптивная настройка в режиме реального времени

Служба "Защита от атак DDoS Azure" уровня "Базовый" помогает защитить клиентов и предотвратить влияние на других клиентов. Например, если служба предоставляется для типичного объема допустимого входящего трафика, который меньше *доли срабатывания триггеров* общей политики службы "Защита от атак DDoS", атака DDoS на ресурсы этого клиента может остаться незамеченной. В более широком смысле сложность недавних атак (например, многовекторные атаки DDoS) и поведение клиентов, связанное с конкретными приложениями, требуют настраиваемых политик для каждого клиента. Служба выполняет эту настройку с помощью двух аналитических инструментов:

- Автоматическое изучение шаблонов трафика уровня 3 и 4 для каждого клиента (протокола IP).

- Минимизация ложных срабатываний, учитывая, что масштаб Azure позволяет поглощать значительный объем трафика.

![Схема работы службы "Защита от атак DDoS" уровня "Стандартный" с обведенным компонентом "Создание политики"](media/azure-ddos-best-practices/image5.png)

#### <a name="ddos-protection-telemetry-monitoring-and-alerting"></a>Телеметрия, мониторинг и предупреждение службы "Защита от атак DDoS"

Служба "Защита от атак DDoS" уровня "Стандартный" предоставляет расширенную телеметрию с помощью [Azure Monitor](../azure-monitor/overview.md) во время атаки DDoS. Вы можете настроить получение оповещений для любой метрики Azure Monitor, которую использует защита от атак DDoS. Ведение журнала можно интегрировать с Splunk (концентраторами событий), журналы Azure Monitor и службы хранилища Azure для расширенного анализа через интерфейс диагностики Azure Monitor.

##### <a name="ddos-mitigation-policies"></a>Политики устранения атак DDoS

На портале Azure выберите **Монитор** > **Метрики**. На панели **Метрики** выберите группу ресурсов, выберите тип ресурса **Общедоступный IP-адрес** и свой общедоступный IP-адрес Azure. Метрики DDoS видны на панели **Доступные метрики**.

Служба "Защита от атак DDoS" уровня "Стандартный" применяет три автоматически настраиваемые политики устранения атак (TCP SYN, TCP и UDP) для каждого общедоступного IP-адреса защищенного ресурса в виртуальной сети с включенной защитой от атак DDoS. Вы можете просмотреть пороговые значения политики, выбрав метрику **Inbound packets to trigger DDoS mitigation** (Входящие пакеты для активации устранения рисков DDoS).

![Доступные метрики и диаграммы метрик](media/azure-ddos-best-practices/image7.png)

Пороговые значения политики настраиваются автоматически через профилирование сетевого трафика на основе машинного обучения. Устранение атак DDoS выполняется для атакованного IP-адреса, только если превышены пороговые значения политики.

##### <a name="metric-for-an-ip-address-under-ddos-attack"></a>Метрики для IP-адреса при атаке DDoS

Если общедоступный IP-адрес находится под атакой, значение метрики **Выполняется ли атака DDoS** изменяется на 1, так как служба "Защита от атак DDoS" устраняет атаку трафика.

![Диаграмма с метрикой "Выполняется ли атака DDoS"](media/azure-ddos-best-practices/image8.png)

Мы советуем настроить оповещение на основе этой метрики. Тогда вы будете получать уведомления о выполнении активного устранения атак DDoS на общедоступном IP-адресе.

Дополнительные сведения см. в статье [Manage Azure DDoS Protection Standard using the Azure portal](../virtual-network/ddos-protection-manage-portal.md) (Управление службой "Защита от атак DDoS Azure" уровня "Стандартный" с помощью портала Azure).

#### <a name="web-application-firewall-for-resource-attacks"></a>Брандмауэр веб-приложения для ресурсных атак

При атаках конкретных ресурсов на уровне приложения вы должны настроить брандмауэр веб-приложения (WAF), чтобы защитить веб-приложения. WAF проверяет входящий веб-трафик, чтобы блокировать внедрения кода SQL, межсайтовые сценарии, атаки DDoS и другие атаки уровня 7. Azure предоставляет [компонент шлюза приложений WAF](../application-gateway/application-gateway-web-application-firewall-overview.md) для централизованной защиты веб-приложений от распространенных эксплойтов и уязвимостей. В [Azure Marketplace](https://azuremarketplace.microsoft.com/marketplace/apps?search=WAF&page=1) можно найти разные предложения WAF от партнеров Azure, соответствующие вашим требованиям.

Даже брандмауэры веб-приложений подвержены объемным атакам. Мы настоятельно рекомендуем включить защиту от атак DDoS уровня "Стандартный" в виртуальной сети WAF для защиты от объемных и протокольных атак. Дополнительные сведения см. в разделе [Эталонные архитектуры защиты от атак DDoS](#ddos-protection-reference-architectures).

### <a name="protection-planning"></a>Планирование защиты

Планирование и подготовка важны для понимания работы системы во время атаки DDoS. Сюда также входит разработка плана управления реагированием на инциденты.

Если вы используете службу "Защита от атак DDoS" уровня "Стандартный", то убедитесь, что она включена в виртуальной сети, подключенной к конечной точке с доступом к Интернету. Настройка предупреждений об атаках DDoS помогает постоянно следить за любыми потенциальными атаками, направленными на вашу инфраструктуру. 

Вы должны самостоятельно отслеживать свои приложения и распознавать нормальное поведение приложения. Подготовьтесь действовать, если приложение во время атаки DDoS не будет вести себя так, как ожидалось.

#### <a name="testing-through-simulations"></a>Тестирование через моделирования

Мы рекомендуем заранее проверять реакцию служб на атаку, проводя периодические моделирования. Во время тестирования проверьте, продолжают ли службы или приложения функционировать должным образом и возникают ли проблемы в работе пользователя. Определите пробелы с точки зрения технологии и процесса и учтите их при разработке стратегии реагирования на атаки DDoS. Мы рекомендуем выполнять подобные проверки в промежуточных средах или в периоды низкой загрузки, чтобы свести к минимуму воздействие на производственную среду.

Вместе с [BreakingPoint Cloud](https://www.ixiacom.com/products/breakingpoint-cloud) мы разработали интерфейс, в котором клиенты Azure смогут создавать трафик для защиты от атак DDoS с помощью общедоступных конечных точек для моделирований. Вы можете использовать моделирование [BreakingPoint Cloud](https://www.ixiacom.com/products/breakingpoint-cloud), чтобы:

- Проверить, как служба "Защита от атак DDoS Azure" защищает ваши ресурсы Azure.

- Оптимизировать процесс реагирования на инциденты во время атаки DDoS.

- Обеспечить соответствие документации по защите от атак DDoS.

- Обучить команды безопасности сети.

Кибербезопасность требует постоянных инноваций в защите. "Защита от атак DDoS Azure" уровня "Стандартный" — это современное предложение, предоставляющее эффективные решения для устранения риска более сложных атак DDoS.

## <a name="components-of-a-ddos-response-strategy"></a>Компоненты стратегии реагирования на атаки DDoS

Атака DDoS, нацеленная на ресурсы Azure, обычно требует минимального вмешательства пользователя. Тем не менее включение устранения атак DDoS в рамках стратегии реагирования на инциденты минимизирует влияние на непрерывность бизнес-процессов.

### <a name="microsoft-threat-intelligence"></a>Анализ угроз корпорации Майкрософт

Корпорация Майкрософт имеет обширную сеть интеллектуальных угроз. Эта сеть использует общий набор знаний расширенного сообщества по безопасности, поддерживающее веб-службы и партнеров Майкрософт, а также отношения в сообществе по интернет-безопасности. 

Как поставщик ключевой инфраструктуры корпорация Майкрософт первой получает предупреждения об угрозах. Мы собираем аналитику угроз, полученную от своих веб-служб и глобальной клиентской базы Майкрософт. Корпорации Майкрософт включает всю эту аналитику угроз в продукты защиты от атак DDoS Azure.

Кроме того, команда Microsoft Digital Crimes Unit (DCU) реализует наступательные стратегии против ботнетов. Ботнеты – распространенный источник управления и контроля для атак DDoS.

### <a name="risk-evaluation-of-your-azure-resources"></a>Оценка риска ресурсов Azure

Необходимо определить область риска от атаки DDoS на постоянной основе. Периодически задавайтесь вопросами: 
- Какие новые общедоступные ресурсы Azure нуждаются в защите?

- Существует ли в службе единая точка отказа? 

- Как изолировать службы, чтобы ограничить влияние атаки, и по-прежнему предоставлять услуги допустимым клиентам?

- Есть ли виртуальные сети без службы "Защита от атак DDoS" уровня "Стандартный", хотя она и должна быть включена? 

- Активны ли службы с отработкой отказа в нескольких регионах?

### <a name="customer-ddos-response-team"></a>Команда реагирования на атаки DDoS

Создание команды реагирования на атаки DDoS является ключевым шагом эффективного и быстрого реагирования на атаку. Определите контакты в организации, которые будут контролировать планирование и выполнение. Эта команда реагирования на атаки DDoS должна иметь полное представление о службе "Защита от атак DDoS Azure" уровня "Стандартный". Убедитесь, что команда может выявлять и устранять атаку, взаимодействуя с внутренними и внешними клиентами, включая группу поддержки Майкрософт.

Для команды реагирования на атаки DDoS мы рекомендуем использовать упражнения по симуляции в качестве обычной части плана по обеспечению доступности и непрерывной работы службы. Эти упражнения должны включать тестирование масштабирования.

### <a name="alerts-during-an-attack"></a>Предупреждения во время атаки

"Защита от атак DDoS Azure" уровня "Стандартный" определяет и устраняет атаки DDoS без вмешательства пользователя. Чтобы получать уведомление о наличии активного устранения атак для защищенного общедоступного IP-адреса, вы можете [настроить предупреждение](../virtual-network/ddos-protection-manage-portal.md) на основе метрики **Выполняется ли атака DDoS**. Вы можете создать оповещения для других метрик атак DDoS, чтобы изучить масштабирование атаки, снижающийся трафик и другие сведения.

#### <a name="when-to-contact-microsoft-support"></a>Обращаться в службу поддержки Майкрософт необходимо в следующих случаях:

- Во время атаки DDoS защищенный ресурс становится недоступным или его производительность сильно ухудшится.

- Вы считаете, что служба "Защита от атак DDoS" ведет себя неожиданно. 

  Служба "Защита от атак DDoS" начинает устранение атак только, если значение показателя **Политика запуска устранения атак DDoS (TCP/TCP SYN /UDP)** ниже, чем трафик, полученный на защищенном ресурсе общедоступного IP-адреса.

- Вы планируете вирусное событие, которое значительно увеличит ваш сетевой трафик.

- Субъект угрожает запустить атаку DDoS против ваших ресурсов.

Для атак, которые имеют критическое влияние на бизнес, создайте [запрос в службу поддержки](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest) с уровнем серьезности А.

### <a name="post-attack-steps"></a>Действия после атаки

Рекомендуем после атаки выполнить итоговый анализ и при необходимости изменить стратегию реагирования на атаки DDoS. Необходимо учитывать следующее:

- Было ли обнаружено какое-либо нарушение работы службы или пользователя из-за отсутствия масштабируемой архитектуры?

- Какие приложения или службы пострадали больше всего?

- Насколько эффективна стратегия реагирования на атаки DDoS и как ее можно улучшить?

Если вы подозреваете, что находитесь под атакой DDoS, используйте обычные каналы поддержки Azure.

## <a name="ddos-protection-reference-architectures"></a>Эталонные архитектуры защиты от атак DDoS

"Защита от атак DDoS" уровня "Стандартный" разработана [для служб, которые развертываются в виртуальной сети](../virtual-network/virtual-network-for-azure-services.md). Для остальных служб применяется "Защита от атак DDoS" уровня "Базовый". Следующие эталонные архитектуры упорядочены по сценариям. Образцы архитектуры сгруппированы.

### <a name="virtual-machine-windowslinux-workloads"></a>Рабочие нагрузки виртуальной машины (Windows и Linux)

#### <a name="application-running-on-load-balanced-vms"></a>Приложение, запущенное на виртуальных машинах с балансировкой нагрузки

На этой схеме эталонной архитектуры представлены проверенные способы запуска нескольких виртуальных машин Windows в масштабируемом наборе за подсистемой балансировки нагрузки для повышения доступности и масштабируемости. Эта архитектура может использоваться для любой рабочей нагрузки без учета состояния, например для веб-сервера.

![Схема эталонной архитектуры для приложений, запущенных на виртуальных машинах с балансировкой нагрузки](media/azure-ddos-best-practices/image9.png)

В этой архитектуре рабочая нагрузка распределяется между несколькими экземплярами виртуальных машин. Здесь приведен один общедоступный IP-адрес, а интернет-трафик распределяется между виртуальными машинами через подсистему балансировки нагрузки. "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети подсистемы балансировки нагрузки Azure (Интернет) с общедоступным IP-адресом.

Подсистема балансировки нагрузки распределяет входящие запросы из Интернета между экземплярами виртуальных машин. Масштабируемые наборы виртуальных машин позволяют масштабировать определенное число виртуальных машин вручную или автоматически на основе предопределенных правил. Это важно, если ресурс находится под атакой DDoS. Дополнительные сведения об этой эталонной архитектуре см. [в этой статье](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/multi-vm).

#### <a name="application-running-on-windows-n-tier"></a>N-уровневые приложения, выполняющиеся на компьютере Windows

Существует много способов реализовать n-уровневую архитектуру. На следующей схеме показано стандартное трехуровневое веб-приложение. Эта архитектура создана на основе архитектуры из статьи [N-уровневое приложение с SQL Server](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/multi-vm). На веб- и бизнес-уровнях используются виртуальные машины с балансировкой нагрузки.

![Схема эталонной архитектуры для N-уровневых приложений, выполняющихся на компьютере Windows](media/azure-ddos-best-practices/image10.png)

В этой архитектуре "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети. Все общедоступные IP-адреса в виртуальной сети получают защиту от атак DDoS уровня 3 или 4. Для защиты от атак уровня 7 разверните шлюз приложений в WAF SKU. Дополнительные сведения об этой эталонной архитектуре см. [в этой статье](https://docs.microsoft.com/azure/architecture/reference-architectures/virtual-machines-windows/n-tier).

#### <a name="paas-web-application"></a>Веб-приложение PaaS

Эталонная архитектура демонстрирует запуск приложения службы приложений Azure в одном регионе. На изображении архитектуры показан набор проверенных методов для создания веб-приложения, в котором используются  [Служба приложений Azure](https://azure.microsoft.com/documentation/services/app-service/) и служба [База данных SQL Azure](https://azure.microsoft.com/documentation/services/sql-database/).
Резервный регион настроен для сценариев отработки отказа.

![Схема эталонной архитектуры для веб-приложения PaaS](media/azure-ddos-best-practices/image11.png)

Диспетчер трафика Azure направляет входящие запросы к шлюзу приложений в одном из регионов. При обычной работе он направляет запросы в шлюз приложений в активном регионе. Если этот регион становится недоступным, диспетчер трафика выполняет отработку отказа в шлюз приложений в резервном регионе.

Весь интернет-трафик, предназначенный для веб-приложения, перенаправляется на [общедоступный IP-адрес шлюза приложений](https://docs.microsoft.com/azure/application-gateway/application-gateway-web-app-overview) через диспетчер трафика. В этом случае сама служба приложения (веб-приложения) не является общедоступной — она защищена шлюзом приложений. 

Для защиты от атак уровня 7 (HTTP, HTTPS, WebSocket) мы рекомендуем настроить шлюз приложений WAF SKU (режим предотвращения). Кроме того, веб-приложения настроены для [принятия только трафика с IP-адресов шлюза приложений](https://azure.microsoft.com/blog/ip-and-domain-restrictions-for-windows-azure-web-sites/).

Дополнительные сведения об этой эталонной архитектуре см. [в этой статье](https://docs.microsoft.com/azure/architecture/reference-architectures/app-service-web-app/multi-region).

### <a name="mitigation-for-non-web-paas-services"></a>Устранение рисков для служб PaaS

#### <a name="hdinsight-on-azure"></a>HDInsight в Azure

Эта эталонная архитектура демонстрирует настройку службы "Защита от атак DDoS" уровня "Стандартный" для [кластера HDInsight Azure](https://docs.microsoft.com/azure/hdinsight/). Убедитесь, что кластер HDInsight связан с виртуальной сетью, и "Защита от атак DDoS" включена в этой виртуальной сети.

![Панели "HDInsight" и "Дополнительные параметры" с параметрами виртуальной сети](media/azure-ddos-best-practices/image12.png)

![Выбор значения для включения защиты от атак DDoS](media/azure-ddos-best-practices/image13.png)

В этой архитектуре трафик, предназначенный для кластера HDInsight, перенаправляется из Интернета на общедоступный IP-адрес, связанный с подсистемой балансировки нагрузки шлюза HDInsight. Затем подсистема балансировки нагрузки шлюза отправляет трафик на головные или рабочие узлы напрямую. Так как "Защита от атак DDoS" уровня "Стандартный" включена в виртуальной сети HDInsight, то все общедоступные IP-адреса в виртуальной сети получают защиту от атак DDoS уровня 3 или 4. Эта эталонная архитектура может объединяться с эталонными архитектурами N-уровневого приложения в нескольких регионах.

Дополнительные сведения об этой эталонной архитектуре см. в статье [Расширение возможностей HDInsight с помощью виртуальной сети Azure](https://docs.microsoft.com/azure/hdinsight/hdinsight-extend-hadoop-virtual-network?toc=%2fazure%2fvirtual-network%2ftoc.json).


> [!NOTE]
> Среда Службы приложений Azure для PowerApps и управление API в виртуальной сети с общедоступным IP-адресом не поддерживаются на уровне системы.

## <a name="next-steps"></a>Дальнейшие действия

* [Страница службы "Защита от атак DDoS Azure"](https://azure.microsoft.com/services/ddos-protection/)

* [Запись блога о службе "Защита от атак DDoS Azure"](https://aka.ms/ddosblog)

* [Документация по службе "Защита от атак DDoS Azure"](../virtual-network/ddos-protection-overview.md)
