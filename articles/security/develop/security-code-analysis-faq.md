---
title: Задаваемые вопросы по анализу кода безопасности Майкрософт
description: Эта статья содержит часто задаваемые вопросы о расширении анализа кода безопасности Майкрософт
author: vharindra
manager: sukhans
ms.author: terrylan
ms.date: 07/31/2019
ms.topic: article
ms.service: security
services: azure
ms.assetid: 521180dc-2cc9-43f1-ae87-2701de7ca6b8
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.openlocfilehash: cb04a8e5a6d8c982a35cb5c448e4b6d93825bf73
ms.sourcegitcommit: b55d7c87dc645d8e5eb1e8f05f5afa38d7574846
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81460228"
---
# <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
Есть вопросы? Ознакомьтесь со следующими часто задаваемыми вопросами для получения дополнительной информации.

## <a name="general-faq"></a>Общие часто задаваемые вопросы

### <a name="can-i-install-the-extension-on-my-visual-studio-team-foundation-server-instance-instead-of-on-an-azure-devops-instance"></a>Могу ли я установить расширение в экземпляре Visual Studio Team Foundation Server, а не в экземпляре Azure DevOps?

Нет. Расширение недоступно для загрузки и установки для Visual Studio Team Foundation Server.

### <a name="do-i-have-to-run-microsoft-security-code-analysis-with-my-build"></a>Должен ли я запускать анализ кода безопасности Майкрософт с моей сборкой? 

Возможно. Это зависит от типа инструмента анализа. Исходный код может быть единственной вещью, которая требуется, или может потребоваться выход сборки.

Например, сканер учетных данных (CredScan) анализирует файлы в структуре папки репозитория кода. Благодаря этому анализу можно запустить задачи CredScan и Publish Security Analysis Logs в автономной сборке для получения результатов.

Для других инструментов, таких как BinSkim, которые анализируют артефакты после сборки, сборка требуется в первую очередь.

### <a name="can-i-break-my-build-when-results-are-found"></a>Могу ли я разорвать сборку при обнаружении результатов?

Да. Можно ввести перерыв сборки, когда любой инструмент сообщает о проблеме или проблеме в файле журнала. Просто добавьте задачу сборки post-Analysis и выберите флажок для любого инструмента, для которого вы хотите разбить сборку.

В ui задачи Post-Analysis можно выбрать перерыв сборки, когда любой инструмент сообщает либо об ошибках, либо об ошибках и предупреждениях.

### <a name="how-do-the-command-line-arguments-in-azure-devops-differ-from-those-arguments-in-the-standalone-desktop-tools"></a>Чем аргументы командной строки в Azure DevOps отличаются от аргументов в автономных настольных инструментах? 

По большей части задачи сборки Azure DevOps являются прямыми обертками вокруг аргументов командной строки инструментов безопасности. Вы можете передать в качестве аргументов задаче сборки все, что обычно передается инструменту командной строки.

Заметные различия:

- Инструменты, запускаемые из исходной папки агента $(Build.SourcesDirectory) или от %BUILD_SOURCESDIRECTORY%. Примером может быть\_C: «агент наячна.
- Пути в аргументах могут быть относительно корня исходного каталога, указанного ранее. Пути также могут быть абсолютными. Вы получаете абсолютные пути либо с помощью переменных Azure DevOps Build, либо при запуске локального агента с известными местоположениями локальных ресурсов.
- Инструменты автоматически обеспечивают путь вывода файла или папку. Если вы предоставляете место вывода для задачи сборки, это местоположение заменяется путем к нашему хорошо известному расположению журналов на агенте сборки
- Некоторые дополнительные аргументы командной строки изменены для некоторых инструментов. Одним из примеров является добавление или удаление опций, которые гарантируют отсутствие графического интерфейса.

### <a name="can-i-run-a-build-task-like-credential-scanner-across-multiple-repositories-in-an-azure-devops-build"></a>Могу ли я запустить задачу сборки, например сканер учетных данных в нескольких репозиториях в сборке Azure DevOps?

Нет. Запуск безопасных средств разработки в нескольких репозиториях в одном конвейере не поддерживается.

### <a name="the-output-file-i-specified-isnt-being-created-or-i-cant-find-the-output-file-i-specified"></a>Указанный файл не создается, или я не могу найти указанный

Задачи сборки фильтруют некоторые пользовательские вводы. Для этого вопроса конкретно они обновляют местоположение генерируемого вывода файла, чтобы быть общим местом в агенте сборки. Для получения дополнительной информации об этом местоположении, см.

### <a name="where-are-the-output-files-generated-by-the-tools-saved"></a>Где сохраняются выходные файлы, генерируемые инструментами? 

Задачи сборки автоматически добавляют выходные пути к этому хорошо известному местоположению\_в агенте сборки: $(Agent.BuildDirectory) sdt'logs. Поскольку мы стандартизируем это местоположение, все группы, которые производят или потребляют журналы анализа кода, имеют доступ к выходу.

### <a name="can-i-queue-a-build-to-run-these-tasks-on-a-hosted-build-agent"></a>Могу ли я выстроить сборку в очередь для выполнения этих задач в агенте развгона сборки? 

Да. Все задачи и инструменты в расширении могут быть выполнены на размещенном агенте сборки.

>[!NOTE]
> Задача сборки сканера для вредоносных программ требует создания агента с включенным Windows Defender. Хостинг Visual Studio 2017, а затем предоставить такой агент. Задание сборки не будет работать на Visual Studio 2015 размещены агента.
>
> Хотя подписи не могут быть обновлены на этих агентов, подписи всегда должны быть менее трех часов.

### <a name="can-i-run-these-build-tasks-as-part-of-a-release-pipeline-as-opposed-to-a-build-pipeline"></a>Могу ли я выполнять эти задачи сборки в рамках конвейера выпуска, в отличие от конвейера сборки?

В большинстве случаев, да.

Однако Azure DevOps не поддерживает выполнение задач в конвейерах выпуска, когда эти задачи публикуют артефакты. Отсутствие поддержки не позволяет задаче анализа безопасности Publish Security Logs успешно работать в конвейере выпуска. Вместо этого задача завершает сятвие с описательным сообщением об ошибке.

### <a name="from-where-do-the-build-tasks-download-the-tools"></a>Откуда задачи сборки загружают инструменты?

Задачи сборки можно загрузить пакеты NuGet инструментов из [ленты управления пакетами Azure DevOps.](https://securitytools.pkgs.visualstudio.com/_packaging/SecureDevelopmentTools/nuget/v3/index.json) Задачи сборки могут также использовать менеджер пакета узлов, который должен быть предустановлен на агенте сборки. Примером такой установки является команда **npm установить tslint**.

### <a name="what-effect-does-installing-the-extension-have-on-my-azure-devops-organization"></a>Какое влияние на установку расширения оказывает на организацию Azure DevOps? 

После установки задачи построения безопасности, предоставляемые расширением, становятся доступными для всех пользователей организации. При создании или отощобляемом конвейер Azure эти задачи доступны из списка сбора задач сборки. В противном случае установка расширения в организацию Azure DevOps не имеет никакого эффекта. Установка не изменяет настройки учетной записи, настройки проекта или конвейеры.

### <a name="does-installing-the-extension-modify-my-existing-azure-pipelines"></a>Изменяет ли установка расширения существующие трубопроводы Azure? 

Нет. Установка расширения делает задачи построения безопасности доступными для добавления к конвейерам. Вам по-прежнему требуется добавлять или обновлять определения сборки, чтобы инструменты могли работать с процессом сборки.

## <a name="task-specific-faq"></a>Часто задаваемые вопросы по конкретным задачам

В этом разделе перечислены вопросы, специфичные для построения задач.

### <a name="credential-scanner"></a>Сканер учетных данных

#### <a name="what-are-common-suppression-scenarios-and-examples"></a>Каковы общие сценарии и примеры подавления?

Ниже приведены подробные сведения о двух наиболее распространенных сценариях подавления.

##### <a name="to-suppress-all-occurrences-of-a-given-secret-within-the-specified-path"></a>Для подавления всех случаев данного секрета в пределах заданного пути

Требуется ключ хэша из выходного файла CredScan, как показано в следующем примере.

        {
            "tool": "Credential Scanner",
            "suppressions": [
            {
                "hash": "CLgYxl2FcQE8XZgha9/UbKLTkJkUh3Vakkxh2CAdhtY=",
                "_justification": "Secret used by MSDN sample, it is fake."
            }
          ]
        }

>[!WARNING]
> Ключ хэша генерируется частью соответствующего значения или содержимого файла. Любой пересмотр исходного кода может изменить ключ хэша и отключить правило подавления.

##### <a name="to-suppress-all-secrets-in-a-specified-file-or-to-suppress-the-secrets-file-itself"></a>Чтобы подавить все секреты в указанном файле или подавить секреты файла себя

Выражение файла может быть именем файла. Она также может быть базовой частью полного пути файла или имени файла. Подстановочные знаки не поддерживаются.

Следующие примеры показывают, \<как подавить файл InputPath>

Примеры действительных правил подавления:

- \<Входный палет>
- «Срк»-Либ-угловайт.js
- «ДжСлиб»-угловаге.js
- Злиб-угловайт.js
- angular.js - подавляет любой файл с тем же именем

        {
            "tool": "Credential Scanner",
            "suppressions": [
            {
                "file": "\\files\\AdditonalSearcher.xml", 
                "_justification": "Additional CredScan searcher specific to my team"
            },
            {
                "file": "\\files\\unittest.pfx", 
                "_justification": "Legitimate UT certificate file with private key"
            }
          ]
        }      

>[!WARNING] 
> Все будущие секреты, добавленные в файл, также будут автоматически подавлены.

#### <a name="what-are-recommended-guidelines-for-managing-secrets"></a>Каковы рекомендуемые рекомендации по управлению секретами?

Следующие ресурсы помогут вам безопасно управлять секретами и получать доступ к конфиденциальной информации из ваших приложений:

 - [Azure Key Vault](../../key-vault/index.yml)
 - [Активный каталог Azure (Azure AD)](../../sql-database/sql-database-aad-authentication.md)
 - [Идентификация службы Azure AD управляемая (MSI)](https://azure.microsoft.com/blog/keep-credentials-out-of-code-introducing-azure-ad-managed-service-identity/)
 - [Управляемые удостоверения для ресурсов Azure](../../active-directory/managed-identities-azure-resources/overview.md)
 - [Управляемые идентификаторы в службах приложений Azure и функциях Azure](../../app-service/overview-managed-identity.md)
 - [Библиотека AppAuthentication](../../key-vault/general/service-to-service-authentication.md)


Для получения дополнительной информации, смотрите в блоге [Управление секретами безопасно в облаке](https://devblogs.microsoft.com/visualstudio/managing-secrets-securely-in-the-cloud/).

#### <a name="can-i-write-my-own-custom-searchers"></a>Могу ли я написать свои собственные пользовательские поисковики?

Сканер учетных данных опирается на набор поисковиков содержимого, которые обычно определяются в файле buildsearchers.xml. Файл содержит массив сериализованных объектов XML, представляющих объект **ContentSearcher.** Программа распространяется с набором хорошо проверенных поисковиков. Но вы можете реализовать свои собственные пользовательские искателей тоже.

Поиск содержимого определяется следующим образом:

- **Имя**: Описательное имя поискового, которое будет использоваться в выводах сканера учетных данных. Мы рекомендуем вам использовать верблюжью дело именования конвенции для поиска имен.
- **RuleId**: Стабильный непрозрачный идентификатор искателя:
    - Поисковику сканера учетных данных присваивается значение **RuleId,** такое как CSCAN0010, CSCAN0020 или CSCAN0030. Последняя цифра зарезервирована для потенциального слияния или деления групп поиска с помощью регулярных выражений (regex).
    - Значение **RuleId** для настроенного поисковика должно иметь свое собственное пространство имен. Примеры включают\<CSCAN- Namespace\>0010, CSCAN-\<Namespace\>0020, и CSCAN-\<Namespace\>0030.
    - Полностью квалифицированное имя поискового является сочетанием значения **RuleId** и имени поискового. Примеры включают CSCAN0010. KeyStoreFiles и CSCAN0020. Base64EncodedCertificate.
- **ResourceMatchPattern**: Regex расширения файлов для проверки в отношении поискового.
- **ContentSearchPatterns**: Массив строк, содержащих операторы regex, чтобы соответствовать. Если шаблоны поиска не определены, все файлы, соответствующие значению **ResourceMatchPattern,** возвращаются.
- **ContentSearchFilters**: Массив строк, содержащих операторы regex, для фильтрации ложных срабатываний, специфических для поиска.
- **MatchDetails**: Описательное сообщение, инструкции по смягчению последствий или оба, которые будут добавлены для каждого матча поискового.
- **Рекомендация**: Содержимое поля предложений для совпадения с использованием формата отчета PREfast.
- **Тяжесть**: Неравномерное, что отражает уровень серьезности проблемы. Самый высокий уровень тяжести имеет значение 1.

  ![XML, показывающий настройку сканера учетных данных](./media/security-tools/6-credscan-customsearchers.png)

### <a name="roslyn-analyzers"></a>Анализаторы Roslyn

#### <a name="what-are-common-errors-when-using-the-roslyn-analyzers-task"></a>Каковы распространенные ошибки при использовании задачи Roslyn Analyzers?

##### <a name="the-project-was-restored-using-a-wrong-microsoftnetcoreapp-version"></a>Проект был восстановлен с помощью неправильной версии Microsoft.NETCore.App

Полное сообщение об ошибке:

"Ошибка: Проект был восстановлен с помощью Microsoft.NETCore.App версия *x.x.x*, но с текущими настройками, версия *y.y.y* будет использоваться вместо. Чтобы устранить эту проблему, убедитесь, что для операции восстановления и для последующих операций, например сборки или публикации, используются одинаковые параметры. Обычно эта проблема возникает, если свойство RuntimeIdentifier задается во время сборки или публикации, а не во время восстановления".

Поскольку задачи Roslyn Analyzers выполняются как часть компиляции, исходное дерево на машине сборки должно находиться в строяемом состоянии.

Шаг между основной сборкой и шагами Roslyn Analyzers мог бы привести дерево исходного кода в состояние, которое препятствует построению. Этот дополнительный шаг, вероятно, **dotnet.exe опубликовать**. Попробуйте дублировать шаг, который делает восстановление NuGet непосредственно перед шагом Анализаторов Roslyn. Этот дублированный шаг может поместить исходное дерево обратно в состояние, приспособиваемое к сборке.

##### <a name="cscexe-cant-create-an-analyzer-instance"></a>csc.exe не может создать экземпляр анализатора

Полное сообщение об ошибке:

"'csc.exe' вышел с кодом ошибки 1 - экземпляр анализатор *AAAA* не может быть создан из C:\\*BBBB*.dll : Не может загрузить файл или сборку 'Microsoft.CodeAnalysis, Версия'*X.X.X*, Культура-нейтральный, PublicKeyToken-31bf3856ad364e35 ' или один из его зависимостей. The system cannot find the file specified" ("Недопустимое значение "/src" каталога "cwd". Системе не удается найти указанный файл")

Убедитесь, что компилятор поддерживает Рослин Анализаторы. Запуск команды **csc.exe/версии** должен сообщить о значении версии 2.6 или позже.

Иногда файл .csproj может переопределить установку Visual Studio машины сборки, ссылаясь на пакет от Microsoft.Net.Compilers. Если вы не собираетесь использовать конкретную версию компилятора, удалите ссылки на Microsoft.Net.Compilers. В противном случае убедитесь, что версия ссылки пакет также 2.6 или позже.

Попробуйте получить путь входа в журнал ошибок, который указан в опции **csc.exe/errorlog.** Параметр и путь отображаются в журнале для задачи сборки Roslyn Analyzers. Они могут выглядеть как **/errorlog:F: 'ts-услуги-123\_работы»456's-Some-Project-Code.csproj.sarif**

##### <a name="the-c-compiler-version-isnt-recent-enough"></a>Версия компилятора СЗ недостаточно недавняя

Чтобы получить последние версии компилятора СИ, перейдите на [сайте Microsoft.Net.Compilers](https://www.nuget.org/packages/Microsoft.Net.Compilers). Чтобы получить установленную версию, запустите **csc.exe /версию** в командном запросе. Убедитесь, что вы ссылаетесь на пакет Microsoft.Net.Compilers NuGet, который является версией 2.6 или позже.

##### <a name="msbuild-and-vsbuild-logs-arent-found"></a>Не найдены журналы MSBuild и VSBuild

Задача по сборке Roslyn Analyzers должна запросить Azure DevOps для журнала MSBuild из задачи сборки MSBuild. Если задача анализатора выполняется сразу после выполнения задачи MSBuild, журнал еще не будет доступен. Разместите другие задачи между задачей MSBuild и задачей Анализаторов Roslyn. Примеры других задач включают BinSkim и анти-вредоносных сканеров.

## <a name="next-steps"></a>Следующие шаги

Если вам нужна дополнительная помощь, служба анализа кода безопасности Майкрософт доступна с понедельника по пятницу с 9:00 до 17:00 по тихоокеанскому стандартному времени.

- Посадка: Ссылка на нашу [документацию по посадке на борт](security-code-analysis-onboard.md)
  
- Поддержка: Напишите нашей команде в [службу анализа кода безопасности Майкрософт](mailto:mscahelp@microsoft.com?Subject=Microsoft%20Security%20Code%20Analysis%20Support%20Request)