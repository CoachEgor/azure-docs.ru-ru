---
title: Microsoft Azure инструкции по настройке задачи анализа кода безопасности
description: В этой статье рассматривается настройка задач в расширении анализа кода безопасности
author: vharindra
manager: sukhans
ms.author: terrylan
ms.date: 07/31/2019
ms.topic: article
ms.service: security
services: azure
ms.assetid: 521180dc-2cc9-43f1-ae87-2701de7ca6b8
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.openlocfilehash: ab219b71eb8cd6f6172b7d02a639301c67811b49
ms.sourcegitcommit: a52f17307cc36640426dac20b92136a163c799d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/01/2019
ms.locfileid: "68718357"
---
# <a name="how-to-configure--customize-the-build-tasks"></a>Как Настройка & Настройка задач сборки

На этой странице подробно описаны параметры конфигурации, доступные в каждой из задач сборки, начиная с задач для средств анализа кода безопасности, за которыми следуют задачи после обработки.

## <a name="anti-malware-scanner-task"></a>Задача сканера защиты от вредоносных программ

> [!NOTE]
> Задача сборки защиты от вредоносных программ требует наличия агента сборки с включенным защитником Windows, который имеет значение true для агентов сборки "Hosted VS2017" и более поздних версий. (Он не будет выполняться в устаревшем или VS2015ном агенте) Подписи не могут быть обновлены на этих агентах, но подпись всегда должна быть относительно актуальной, менее 3 часов назад.

Снимок экрана и сведения о настройке ниже.

![Настройка задачи сборки сканера защиты от вредоносных программ](./media/security-tools/5-add-anti-malware-task600.png) 

- Параметры для типа " **базовый** "
- Если задано значение Type = **Custom**, для настройки проверки можно указать аргументы командной строки.

Защитник Windows использует клиент Центр обновления Windows для скачивания и установки сигнатур. Если обновление сигнатуры для агента сборки завершается сбоем, код ошибки HRESULT, скорее всего, поступает из Центр обновления Windows. Дополнительные сведения об Центр обновления Windows ошибках и их устранении см. на [этой странице](https://docs.microsoft.com/windows/deployment/update/windows-update-error-reference) и на этой [странице TechNet](https://social.technet.microsoft.com/wiki/contents/articles/15260.windows-update-agent-error-codes.aspx) .

## <a name="binskim-task"></a>Задача Бинским

> [!NOTE]
> В качестве необходимого компонента для выполнения задачи Бинским сборка должна соответствовать одному из следующих условий.
>    - Сборка создает двоичные артефакты из управляемого кода.
>    - Имеются зафиксированные двоичные артефакты, которые вы хотите проанализировать с помощью Бинским.

Снимок экрана и сведения о настройке ниже. 

![Установка Бинским](./media/security-tools/7-binskim-task-details.png)  
1. Установите для конфигурации сборки значение Отладка для создания отладочных файлов * **. pdb** . Они используются Бинским для отображения проблем, обнаруженных в двоичном двоичном файле, обратно в исходный код. 
2. Выберите тип = **базовый** & функция = **анализ** , чтобы избежать повторного поиска и создания собственной командной строки. 
3. **Target** — один или несколько описателей для файла, каталога или шаблона фильтра, который разрешается в один или несколько двоичных файлов для анализа. 
    - Несколько целевых объектов следует разделять **точкой с запятой (;)** . 
    - Может быть одним файлом или содержать подстановочные знаки.
    - Каталоги всегда должны заканчиваться на\*
    - Примеры:

           *.dll;*.exe
           $(BUILD_STAGINGDIRECTORY)\*
           $(BUILD_STAGINGDIRECTORY)\*.dll;$(BUILD_STAGINGDIRECTORY)\*.exe;
4. Если выбрать тип = **Командная строка**, 
     - Убедитесь, что первый аргумент для **бинским. exe** — это команда , проанализируемая с использованием полных путей или путей относительно исходного каталога.
     - Для входных данных из **командной строки** несколько целевых объектов должны быть разделены пробелом.
     - Параметр файла **/o** или **/Output** можно опустить. Он будет добавлен или заменен. 
     - **Стандартная настройка командной строки** 

           analyze $(Build.StagingDirectory)\* --recurse --verbose
           analyze *.dll *.exe --recurse --verbose
          > [!NOTE]
          > Конечная \* папка очень важна при указании каталога или каталогов для целевого объекта. 

Дополнительные сведения о параметрах командной строки, правилах по ИДЕНТИФИКАТОРам или кодах выхода см. в разделе [Бинским User Guide](https://github.com/Microsoft/binskim/blob/master/docs/UserGuide.md) .

## <a name="credential-scanner-task"></a>Задача сканера учетных данных
Снимок экрана и сведения о настройке ниже.
 
![Настройка средства проверки учетных данных](./media/security-tools/3-taskdetails.png)

Доступные параметры: 
  - **Формат вывода** : TSV/CSV/сариф/Fast
  - **Версия средства** Такую Последняя
  - **Папка для проверки** — папка в вашем репозитории для проверки
  - **Типы файлов поиска** — параметры для поиска файла поиска, используемого для сканирования.
  - **Файл подавлений** — [JSON](https://json.org/) -файл можно использовать для подавления проблем в выходном журнале (Дополнительные сведения см. в разделе Ресурсы). 
  - **Подробный вывод** с пояснениями 
  - **Размер пакета** — количество параллельных потоков, одновременно используемых для запуска сканеров учетных данных. По умолчанию — 20 (значение должно находиться в диапазоне от 1 до 2147483647).
  - **Время ожидания сопоставления** — количество времени, затрачиваемого на проверку соответствия поисковому запросу перед отменой проверки. 
  - **Размер буфера чтения файла Просмотр** — размер буфера при чтении содержимого в байтах. (По умолчанию — 524288) 
  - **Максимальное количество прочитанных байт при просмотре файла** — максимальное число байтов для чтения из заданного файла во время анализа содержимого. (По умолчанию — 104857600) 
  - **Выполнить эту задачу** (в разделе **Параметры управления**) — указывает, когда должна выполняться задача. Выберите "пользовательские условия", чтобы указать более сложные условия. 
  - Версия **— версия** задачи сборки в Azure DevOps. Не используется часто. 

## <a name="microsoft-security-risk-detection-task"></a>Задача обнаружения угроз безопасности Майкрософт
> [!NOTE]
> Чтобы использовать эту задачу, необходимо создать и настроить учетную запись со службой обнаружения рисков в качестве необходимого компонента. Для этой службы требуется отдельный процесс адаптации. Это не "Plug-and-Play", как большинство других задач в этом расширении. Ознакомьтесь со сведениями об [обнаружении угроз безопасности корпорации Майкрософт](https://aka.ms/msrddocs) и [обнаружении угроз безопасности корпорации Майкрософт: ](https://docs.microsoft.com/security-risk-detection/how-to/) Инструкции.

Сведения о настройке см. ниже.

Введите необходимые данные. Каждый параметр имеет текст Справка по наведении.
   - **Имя конечной точки службы DevOps Azure для мсрд**: Если вы создали универсальный тип конечной точки службы DevOps Azure для хранения URL-адреса экземпляра МСРД (который вы подключены к) и маркера доступа REST API, то можете выбрать эту конечную точку службы. В противном случае щелкните ссылку Управление, чтобы создать и настроить новую конечную точку службы для этой задачи МСРД. 
   - **Идентификатор учетной записи**: Это GUID, который можно получить из URL-адреса учетной записи МСРД.
   - **URL-адреса двоичных файлов**: Разделенный точками с запятой список общедоступных URL-адресов (для использования нечетким компьютером для скачивания двоичных файлов).
   - **URL-адреса начальных файлов**: Разделенный точками с запятой список общедоступных URL-адресов (которые будут использоваться нечетким компьютером для загрузки начальных значений). Это поле необязательно, если начальные файлы загружаются вместе с двоичными файлами.
   - **Тип платформы ОС**: Тип платформы ОС (Windows или Linux) компьютеров, на которых нужно запустить задание нечеткого тестирования.
   - Выпуск **Windows Edition/Linux**: Выпуск ОС компьютеров, на которых выполняется задание нечеткого тестирования. Вы можете перезаписать значение по умолчанию, если компьютеры имеют другой выпуск ОС.
   - **Сценарий установки пакета**: Предоставьте скрипт для выполнения на тестовом компьютере, чтобы установить целевую тестовую программу и ее зависимости перед отправкой задания нечеткого тестирования.
   - **Параметры отправки задания**:
       - **Начальный каталог**: Путь к каталогу на нечетком компьютере, содержащему начальные значения.
       - **Добавочное заполнение**: Расширение файла начальных значений
       - **Исполняемый файл драйвера тестирования**: Путь к целевому исполняемому файлу на нечетком компьютере.
       - **Архитектура исполняемого драйвера тестирования**: Архитектура целевого исполняемого файла (x86 или AMD64).
       - **Аргументы тестового драйвера**: Аргументы командной строки, передаваемые в целевой исполняемый файл теста. Обратите внимание, что символ "% TestFile%", включая двойные кавычки, будет автоматически заменен полным путем к целевому файлу, который должен проанализировать тестовый драйвер, и является обязательным.
       - **Процесс драйвера тестирования завершает работу после завершения теста**: Установите флажок, чтобы завершить тестовый драйвер после завершения. Снимите флажок, если необходимо принудительно закрыть драйвер тестирования.
       - **Максимальная длительность (в секундах)** : Укажите оценку наиболее длительного относительно ожидаемого времени, необходимого для анализа входного файла целевой программой. Чем точнее эта оценка, тем эффективнее выполняется нечеткое выполнение.
       - **Тестовый драйвер можно запускать повторно**: Проверьте, может ли тестовый драйвер запускаться повторно без необходимости в зависимости от сохраненного или общего глобального состояния.
       - **Тестовый драйвер можно переименовать**: Проверьте, можно ли переименовать исполняемый файл тестового драйвера и все же работать правильно.
       - **Нечеткое приложение выполняется как один процесс ОС**: Проверьте, выполняется ли тестовый драйвер в рамках одного процесса ОС. Снимите флажок, если тестовый драйвер порождает дополнительные процессы.


## <a name="roslyn-analyzers-task"></a>Задача «Roslyn Analyzer»
> [!NOTE]
> В качестве необходимого компонента для выполнения задачи Roslyn Analyzer сборка должна соответствовать следующим условиям.
>  - Определение сборки включает встроенную задачу сборки MSBuild или Всбуилд для компиляции C# (или VB) кода. Эта задача полагается на входные и выходные данные конкретной задачи сборки, чтобы повторно запустить компиляцию MSBuild с включенными анализаторами Roslyn.
>  - В агенте сборки, выполняющем эту задачу сборки, установлен Visual Studio 2017 v 15.5 или более поздней версии (компилятор версии 2.6. x).
>

Сведения о настройке см. ниже.

Доступные параметры: 
- **RuleSet** — требуется SDL, рекомендуется использовать SDL или пользовательский набор правил.
- **Версия анализаторов** Такую Последняя
- **Файл подавления предупреждений компилятора** — текстовый файл со списком идентификаторов предупреждений, которые следует подавлять. 
- **Выполнить эту задачу** (в разделе **Параметры управления**) — указывает, когда должна выполняться задача. Выберите "**пользовательские условия**", чтобы указать более сложные условия. 

> [!NOTE]
> - Анализаторы Roslyn являются интегрированными в компилятор и могут запускаться только как часть компиляции CSC. exe. Таким образом, эта задача требует воспроизведения или перезапуска команды компилятора, которая выполнялась ранее в сборке. Это делается путем запроса VSTS для журналов задач сборки MSBuild (нет других способов надежного получения командной строки компиляции MSBuild из определения сборки; мы рекомендуем добавить текстовое поле с полилинией, чтобы пользователи могли вводить свои командные строки. , но при этом было бы сложно поддерживать эти обновления и синхронизировать их с главной сборкой. Пользовательские сборки должны воспроизводить весь набор команд, а не только команды компилятора, и не является тривиальным и надежным, чтобы включить анализаторы Roslyn в этих случаях. 
> - Анализаторы Roslyn интегрированы с компилятором и требуют вызова компиляции. Эта задача сборки реализуется путем перекомпиляции C# проектов, которые уже были созданы с использованием только задачи сборки MSBuild/всбуилд, в том же определении сборки или сборки, но в данном случае с включенными анализаторами. Если эта задача сборки выполняется на том же агенте, что и исходная задача сборки, выходные данные исходной задачи сборки MSBuild/Всбуилд будут перезаписаны в папку Sources по выходным данным этой задачи сборки. Выходные данные сборки будут одинаковы, но рекомендуется запустить MSBuild, скопировать выходные данные в промежуточный каталог артефактов, а затем запустить Roslyn.
>

Дополнительные ресурсы для Roslyn анализаторов задач Check [Roslyn Analyzer on документация Майкрософт](https://docs.microsoft.com/dotnet/standard/analyzers/)

Пакет анализатора, установленный и используемый этой задачей сборки, можно найти [здесь](https://www.nuget.org/packages/Microsoft.CodeAnalysis.FxCopAnalyzers) . 

## <a name="tslint-task"></a>Задача TSLint

Дополнительные сведения о TSLint см. в [репозитории TSLint GitHub](https://github.com/palantir/tslint)
>[!NOTE] 
>Как вы, возможно, помните, TSLint будет считаться устаревшим в 2019 (Источник: [Репозиторий GitHub TSLint](https://github.com/palantir/tslint)) В настоящее время команда изучает [ESLint](https://github.com/eslint/eslint) как альтернативу, а создание новой задачи для ESLint — в плане.

## <a name="publish-security-analysis-logs-task"></a>Задача публикации журналов анализа безопасности
Снимок экрана и сведения о настройке ниже.

![Настройка анализа безопасности публикации](./media/security-tools/9-publish-security-analsis-logs600.png)  

- **Имя артефакта** — может быть любым строковым идентификатором
- **Тип артефакта** — вы можете публиковать журналы на сервере Azure-DevOps или в общей папке, доступной для агента сборки. 
- **Средства** . Вы можете сохранить журналы для отдельных или конкретных инструментов или выбрать **все инструменты** , чтобы сохранить все журналы. 

## <a name="security-report-task"></a>Задача "отчет о безопасности"
Снимок экрана и сведения о настройке ниже.  
![Настройка после анализа](./media/security-tools/4-createsecurityanalysisreport600.png) 
- **Отчеты** — выбор файлов отчетов для создания; Он будет создан в каждом формате **Console**, **TSV**и (или) **HTML** . 
- **Инструменты** — выберите инструменты в определении сборки, для которых требуется сводка обнаруженных проблем. Для каждого выбранного инструмента можно выбрать, следует ли просматривать только ошибки или ошибки и предупреждения в отчете. 
- **Дополнительные параметры** . можно выбрать запись в журнал предупреждения или ошибки (и завершить задачу), если для одного из выбранных средств нет журналов.
Вы можете настроить папку базовых журналов, в которой будут найдены журналы, но это не типичный сценарий. 

## <a name="post-analysis-task"></a>Задача после анализа
Снимок экрана и сведения о настройке ниже.

![Настройка после анализа](./media/security-tools/a-post-analysis600.png) 
- **Инструменты** — выберите инструменты в определении сборки, для которых необходимо вставить разрыв сборки в зависимости от результатов. Для каждого выбранного инструмента может быть выбрано, следует ли прерывать только ошибки или ошибки и предупреждения. 
- **Отчет** . при необходимости можно записать найденные результаты и вызвать разрыв сборки в окне консоли Azure DevOps и файле журнала. 
- **Дополнительные параметры** . можно выбрать запись в журнал предупреждения или ошибки (и завершить задачу), если для одного из выбранных средств нет журналов.

## <a name="next-steps"></a>Следующие шаги

Если у вас есть дополнительные вопросы о расширении и предлагаемых средствах, см [. страницу часто задаваемых вопросов.](security-code-analysis-faq.md)


