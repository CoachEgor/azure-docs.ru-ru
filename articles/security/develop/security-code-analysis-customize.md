---
title: Настройка задач анализа кода безопасности Майкрософт
titleSuffix: Azure
description: В этой статье описаны настройки задач в расширении анализа кода безопасности Майкрософт
author: vharindra
manager: sukhans
ms.author: terrylan
ms.date: 07/31/2019
ms.topic: article
ms.service: security
services: azure
ms.assetid: 521180dc-2cc9-43f1-ae87-2701de7ca6b8
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.openlocfilehash: 6cdf892651407defc21f359a8e3b326b4af63b62
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77499985"
---
# <a name="configure-and-customize-the-build-tasks"></a>Настройка и настройка задач сборки

В этой статье подробно описаны параметры конфигурации, доступные в каждой из задач сборки. Статья начинается с задач для инструментов анализа кода безопасности. Он заканчивается пост-обработкой задач.

## <a name="anti-malware-scanner-task"></a>Задача по антивредоносному сканеру

>[!NOTE]
> Задача сборки сканера для вредоносных программ требует создания агента с включенным Windows Defender. Хостинг Visual Studio 2017, а затем предоставить такой агент. Задание сборки не будет работать на Visual Studio 2015 размещены агента.
>
> Хотя подписи не могут быть обновлены на этих агентов, подписи всегда должны быть менее трех часов.

Подробная информация о конфигурации задачи отображается в следующем скриншоте и тексте.

![Настройка задачи сборки сканера антивредоносных программ](./media/security-tools/5-add-anti-malware-task600.png)

В поле **списка типов** скриншота выбирается **Basic.** Выберите **Custom,** чтобы предоставить аргументы командной строки, которые настраивают сканирование.

Windows Defender использует клиент Windows Update для загрузки и установки подписей. Если обновление подписи не удается на вашем агенте сборки, код ошибки **HRESULT,** скорее всего, исходит от Windows Update.

Для получения дополнительной информации об ошибках обновления Windows и их смягчении [см.](https://docs.microsoft.com/windows/deployment/update/windows-update-error-reference) [Windows Update Agent - Error Codes](https://social.technet.microsoft.com/wiki/contents/articles/15260.windows-update-agent-error-codes.aspx)

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [варианты Anti-Malware YAML](yaml-configuration.md#anti-malware-scanner-task)

## <a name="binskim-task"></a>Задача Бинским

> [!NOTE]
> Прежде чем вы сможете выполнить задачу BinSkim, сборка должна соответствовать одному из следующих условий:
>  - Ваша сборка производит двоичные артефакты из управляемого кода.
>  - У вас есть двойные артефакты, совершенные, которые вы хотите проанализировать с binSkim.

Подробная информация о конфигурации задачи отображается в следующем скриншоте и списке.

![Настройка задачи сборки BinSkim](./media/security-tools/7-binskim-task-details.png)

- Установите конфигурацию сборки для отладки так, чтобы были созданы файлы отладки .pdb. BinSkim использует эти файлы для картирования проблем в выходных файлах обратно в исходный код.
- Чтобы избежать исследования и создания собственной командной строки:
     - В списке **Типов** выберите **Basic**.
     - В списке **функций** выберите **Analyse**.
- В **Target**введите один или несколько спецификаций для шаблона файла, каталога или фильтра. Эти specifiers решить для одного или нескольких бинарных файлов для анализа:
    - Несколько указанных целей должны быть разделены запятой (;).
    - Спецификатор может быть одним файлом или содержать подстановочные знаки.
    - Спецификации каталога всегда \\должны заканчиваться с q.
    - Примеры:

           *.dll;*.exe
           $(BUILD_STAGINGDIRECTORY)\*
           $(BUILD_STAGINGDIRECTORY)\*.dll;$(BUILD_STAGINGDIRECTORY)\*.exe;

- Если вы выберете **командную строку** в списке **Типов,** необходимо запустить binskim.exe:
     - Убедитесь, что первыми аргументами binskim.exe являются **анализ** глагола, за которым следуют одна или несколько спецификаций пути. Каждый путь может быть либо полным путем, либо по путю относительно исходного каталога.
     - Несколько целевых путей должны быть разделены пространством.
     - Вы можете пропустить **/o** или **/выходный** вариант. Выходная стоимость добавляется для вас или заменяется.
     - Стандартные конфигурации командной строки отображаются следующим образом.

           analyze $(Build.StagingDirectory)\* --recurse --verbose
           analyze *.dll *.exe --recurse --verbose

          > [!NOTE]
          > Трейлинг \\- важен, если вы указываете каталоги для цели.

Для получения дополнительной информации о аргументах командной строки BinSkim, [BinSkim User Guide](https://github.com/Microsoft/binskim/blob/master/docs/UserGuide.md)правилах по идентификатору или кодах выхода см.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [варианты BinSkim YAML](yaml-configuration.md#binskim-task)

## <a name="credential-scanner-task"></a>Задача сканера учетных данных

Подробная информация о конфигурации задачи отображается в следующем скриншоте и списке.

![Настройка задачи сборки сканера учетных данных](./media/security-tools/3-taskdetails.png)

Доступны следующие варианты:

  - **Формат вывода**: Доступные значения включают **TSV,** **CSV,** **SARIF**и **PREfast.**
  - **Версия для инструментов**: Рекомендуем выбрать **последнюю**.
  - **Сканирование Folder**: Папка репозитория для сканирования.
  - **Поисковики Тип файла**: Параметры для размещения файла поисковиков, который используется для сканирования.
  - **Файл подавления:** файл [JSON](https://json.org/) может подавлять проблемы в журнале вывода. Для получения дополнительной информации о сценариях подавления смотрите раздел часто задаваемых вопросов этой статьи.
  - **Результат verbose**: Самоочевидный.
  - **Размер пакета**: количество одновременных потоков, используемых для запуска сканера учетных данных. Значение по умолчанию — 20. Возможные значения варьируются от 1 до 2 147 483 647.
  - **Время матча:** количество времени в секундах, чтобы потратить попытку матча поиска, прежде чем отказаться от проверки.
  - **Сканирование файлов Чтение размера буфера**: Размер в байтах буфера, используемого во время чтения содержимого. Значение по умолчанию составляет 524 288.  
  - **Максимальное сканирование файлов Прочитано Байты**: Максимальное количество байтов для чтения из файла во время анализа содержимого. Значение по умолчанию составляет 104 857 600.
  - **Параметры управления****Выполнить эту задачу**: Определяет, когда задача будет работать. >  Выберите **пользовательские условия** для указания более сложных условий.
  - **Версия**: Версия задачи сборки в Azure DevOps. Эта опция используется не часто.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [опции сканера учетных данных YAML](yaml-configuration.md#credential-scanner-task)

## <a name="microsoft-security-risk-detection-task"></a>Задача обнаружения рисков безопасности Майкрософт

> [!NOTE]
> Перед использованием задачи MSRD необходимо создать и настроить учетную запись в службе обнаружения рисков безопасности Майкрософт (MSRD). Эта услуга требует отдельного процесса посадки на борт. В отличие от большинства других задач в этом расширении, эта задача требует отдельной подписки с MSRD.
>
> Пожалуйста, обратитесь к [Microsoft Security Risk Detection](https://aka.ms/msrddocs) и Microsoft Security Risk [Detection: Как](https://docs.microsoft.com/security-risk-detection/how-to/) получить инструкции.

Подробная информация для настройки этой задачи отображается в следующем списке. Для любого элемента uI, вы можете парить над этим элементом, чтобы получить помощь.

   - **Название конечной точки службы Azure DevOps для MSRD:** общий тип конечной точки службы Azure DevOps хранит URL-адрес msRD на борту и токен доступа REST API. Если вы создали такую конечную точку, вы можете указать ее здесь. В противном случае выберите ссылку **«Управление»,** чтобы создать и настроить новую конечную точку службы для этой задачи MSRD.
   - **Идентификатор учетной записи**: GUID, который можно извлечь из URL-адреса MSRD.
   - **URL-адреса для бинарных файлов**: Список разграниченных в замыплянии URL-адресов. Машина с пухом использует эти URL-адреса для загрузки бинарных файлов.
   - **URL-адреса файлов семян**: Список разграниченных запятых URL-адресов. Машина с пухом использует эти URL-адреса для загрузки семян. Указание этого значения не обязательно, если файлы семян загружаются вместе с файлами.
   - **Тип платформы Os**: Платформа операционной системы (ОС) машин, выполняющих задания с пухом. Доступные значения **Windows** и **Linux**.
   - **Windows Edition / Linux Edition**: ОС издание машин, которые работают fuzzing работу. Вы можете перезаписать значение по умолчанию, если ваши машины имеют другое издание ОС.
   - **Сценарий установки пакета**: Ваш сценарий для запуска на тестовой машине. Этот скрипт устанавливает таргетную программу и ее зависимости до отправки задания.
   - **Параметры представления работы**:
       - **Каталог семян**: Путь к каталогу на пуховика машина, которая содержит семена.
       - **Расширение семян**: Расширение файла семян.
       - **Тест-драйвер Исполняемый:** Путь к целевому исполняемому файлу на пуховике машины.
       - **Тестовая архитектура драйвера:** Архитектура целевого исполняемого файла. Доступные значения **x86** и **amd64**.
       - **Аргументы драйвера тестирования**: Аргументы командной строки, передаваемые в тестовый исполняемый файл. Аргумент "%testfile%", включая кавычки, автоматически заменяется полным путем к целевому файлу. Этот файл разбирается тест-драйвером и требуется.
       - **Тест овый тест-драйвер Процесс выходит после завершения теста**: Выберите этот флажок, если тест-драйвер должен быть прекращен по завершении. Очистите его, если тест-пилот должен быть принудительно закрыт.
       - **Максимальная продолжительность (в секундах)**: Оценка самого длинного разумно ожидаемого времени, которое требуется целевой программе для разбора вхотоза. Чем точнее оценка, тем эффективнее работает приложение fuzzing.
       - **Тест-драйвер можно запускать повторно:** Выберите этот флажок, если тест-драйвер может работать повторно, не в зависимости от постоянного или общего глобального состояния.
       - **Тест-драйвер может быть переименован:** Выберите этот флажок, если исполняемый файл тест-драйвера может быть переименован и при этом работать правильно.
       - **Приложение Fuzzing выполняется как единый процесс ОС:** Выберите этот флажок, если тест-драйвер работает в рамках одного процесса ОС. Очистите его, если тест-драйвер порождает дополнительные процессы.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [параметры обнаружения рисков безопасности Microsoft YAML](yaml-configuration.md#microsoft-security-risk-detection-task)

## <a name="roslyn-analyzers-task"></a>Задача анализаторов Рослин

> [!NOTE]
> Прежде чем вы сможете выполнить задачу Roslyn Analyzers, сборка должна соответствовать этим условиям:
>
> - Определение сборки включает в себя встроенную задачу сборки MSBuild или VSBuild для компиляции кода C- или Visual Basic. Задача анализаторов зависит от ввода и вывода встроенной задачи для выполнения компиляции MSBuild с включенными анализаторами Roslyn.
> - Агент сборки, работающий в этой задаче сборки, имеет версию Visual Studio 2017 15.5 или более позднюю установку, так что он использует версию компилятора 2.6 или позже.

Подробная информация о конфигурации задачи отображается в следующем списке и заметке.

Доступны следующие варианты:

- **Набор правил**: Значения **sDL Требуется,** **SDL Рекомендуется**, или ваш собственный набор пользовательских правил.
- **Анализаторы Версия**: Мы рекомендуем вам выбрать **Последние**.
- **Файл компилятора Предупреждения Оповерция**: текстовый файл со списком идотов предупреждений, которые подавляются.
- **Параметры управления****Выполнить эту задачу**: Определяет, когда задача будет работать. >  Выберите **пользовательские условия** для указания более сложных условий.

> [!NOTE]
>
> - Рослин Анализаторы интегрированы с компилятором и могут работать только как часть компиляции csc.exe. Таким образом, эта задача требует, чтобы команда компилятора, запущенная ранее в сборке, была воспроизведена или снова запущена. Это воспроизведение или запуск выполняется путем запроса визуальных студийных служб команды (VSTS) для журналов задач сборки MSBuild.
>
>   Нет другого способа надежно получить командную строку компиляции MSBuild из определения сборки. Мы рассмотрели возможность добавления текстового окна свободной формы, чтобы пользователи могли вводить свои командные строки. Но тогда было бы трудно держать эти командные линии в актуальном состоянии и в синхронизации с основной сборки.
>
>   Пользовательские сборки требуют воспроизведения всего набора команд, а не только команд компилятора. В этих случаях включение Roslyn Analyzers не является тривиальным или надежным.
>
> - Рослин Анализаторы интегрированы с компилятором. Для вызова Рослин Анализаторы требуют компиляции.
>
>   Эта новая задача сборки реализуется путем перекомпиляции уже построенных проектов. Новая задача использует только задачи сборки MSBuild и VSBuild в том же определении сборки или сборки, что и исходная задача. Однако в этом случае новая задача использует их с включенными Рослин Анализаторы.
>
>   Если новая задача выполняется на том же агенте, что и исходная задача, вывод новой задачи перезаписывает выход исходной задачи в папке *источников.* Хотя выход сборки одинаков, мы советуем запустить MSBuild, скопировать выход в каталог постановки артефактов, а затем запустить Roslyn Analyzers.

Дополнительные ресурсы для задачи Roslyn Analyzers ознакомьтесь с [анализаторами на основе Roslyn](https://docs.microsoft.com/dotnet/standard/analyzers/) в документах Майкрософт.

Вы можете найти пакет анализатора, установленный и используемый этой задачей сборки, на странице NuGet [Microsoft.CodeAnalysis.FxCopAnalyzers](https://www.nuget.org/packages/Microsoft.CodeAnalysis.FxCopAnalyzers).

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [варианты анализаторов Roslyn YAML](yaml-configuration.md#roslyn-analyzers-task)

## <a name="tslint-task"></a>Задача TSLint

Для получения дополнительной информации о TSLint, перейдите на [TSLint GitHub репо](https://github.com/palantir/tslint).

>[!NOTE] 
>Как вы, возможно, знаете, [TSLint GitHub репо](https://github.com/palantir/tslint) главная страница говорит, что TSLint будет обезврежен где-то в 2019 году. Корпорация Майкрософт изучает [ESLint](https://github.com/eslint/eslint) в качестве альтернативной задачи.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [варианты TSLint YAML](yaml-configuration.md#tslint-task)

## <a name="publish-security-analysis-logs-task"></a>Публикация задач анализа безопасности

Подробная информация о конфигурации задачи отображается в следующем скриншоте и списке.

![Настройка задачи построения анализа безопасности публикации](./media/security-tools/9-publish-security-analsis-logs600.png)  

- **Имя артефакта**: Любой идентификатор строки.
- **Тип артефакта:** В зависимости от выбора можно публиковать журналы на серверAzнном DevOps или в общий файл, доступный агенту сборки.
- **Инструменты**: Вы можете сохранить журналы для конкретных инструментов, или вы можете выбрать **все инструменты,** чтобы сохранить все журналы.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [журналы безопасности YAML](yaml-configuration.md#publish-security-analysis-logs-task)

## <a name="security-report-task"></a>Задача отчета о безопасности

Подробная информация о конфигурации отчета о безопасности отображается в следующем скриншоте и списке.

![Настройка задачи построения отчета безопасности](./media/security-tools/4-createsecurityanalysisreport600.png)

- **Отчеты**: Выберите любой из форматов **трубопроводной консоли,** **TSV File**и **html-файлов.** Для каждого выбранного формата создается один файл отчета.
- **Инструменты**: Выберите инструменты в определении сборки, для которых требуется резюме обнаруженных проблем. Для каждого выбранного инструмента может быть возможность выбрать, видите ли вы только ошибки или видите ошибки и предупреждения в сводном отчете.
- **Расширенные параметры**: Если нет журналов для одного из выбранных инструментов, вы можете войти предупреждение или ошибку. При входе ошибки задача завершается сбой.
- **Базовые журналы Folder**: Вы можете настроить папку базовых журналов, где можно найти журналы. Но этот параметр обычно не используется.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [параметры отчета безопасности YAML](yaml-configuration.md#security-report-task)

## <a name="post-analysis-task"></a>Постанализная задача

Подробная информация о конфигурации задачи отображается в следующем скриншоте и списке.

![Настройка задачи сборки после анализа](./media/security-tools/a-post-analysis600.png)

- **Инструменты**: Выберите инструменты в определении сборки, для которых вы хотите условно ввести перерыв сборки. Для каждого выбранного инструмента может быть возможность выбрать, хотите ли вы нарушать только ошибки или ошибки и предупреждения.
- **Отчет**: Вы можете по желанию написать результаты, которые вызывают разрыв сборки. Результаты записываются в оконное окно консоли Azure DevOps и файл журнала.
- **Расширенные параметры**: Если нет журналов для одного из выбранных инструментов, вы можете войти предупреждение или ошибку. При входе ошибки задача завершается сбой.

Для получения информации о конфигурации YAML для этой задачи, пожалуйста, проверьте наши [параметры Пост-аналитики YAML](yaml-configuration.md#post-analysis-task)

## <a name="next-steps"></a>Дальнейшие действия

Для получения информации о конфигурации на основе YAML обратитесь к нашему [руководству по конфигурации YAML.](yaml-configuration.md)

Если у вас есть дополнительные вопросы о расширении анализа Кода Безопасности и предлагаемых инструментах, ознакомьтесь с [нашей страницей часто задаваемых вопросов](security-code-analysis-faq.md).
