---
title: Шифрование дисков ОС с помощью управляемых клиентом ключей в Azure DevTest Labs
description: Узнайте, как шифровать диски операционной системы (ОС) с помощью управляемых клиентом ключей в Azure DevTest Labs.
ms.topic: article
ms.date: 07/28/2020
ms.openlocfilehash: b9eb401521f6bd81efe3238dc05d07e4554c4f62
ms.sourcegitcommit: 8def3249f2c216d7b9d96b154eb096640221b6b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2020
ms.locfileid: "87542431"
---
# <a name="encrypt-operating-system-os-disks-using-customer-managed-keys-in-azure-devtest-labs"></a>Шифрование дисков операционной системы (ОС) с помощью управляемых клиентом ключей в Azure DevTest Labs
Шифрование на стороне сервера (SSE) защищает данные и помогает соблюсти корпоративные обязательства по обеспечению безопасности и соответствия. SSE автоматически шифрует данные, хранящиеся на управляемых дисках в Azure (дисках ОС и данных), по умолчанию при сохранении в облаке. Дополнительные сведения о [шифровании дисков](../virtual-machines/windows/disk-encryption.md) в Azure. 

В рамках DevTest Labs все диски ОС и диски данных, созданные как часть лаборатории, шифруются с помощью ключей, управляемых платформой. Однако в качестве владельца лаборатории можно использовать собственные ключи для шифрования дисков ОС виртуальных машин лаборатории. Если вы решили управлять шифрованием с помощью собственных ключей, можно указать ключ, **управляемый клиентом** , который будет использоваться для шифрования данных на дисках ОС лаборатории. Дополнительные сведения о шифровании на стороне сервера (SSE) с ключами, управляемыми клиентом, и других типах шифрования управляемых дисков см. в разделе [управляемые клиентом ключи](../virtual-machines/windows/disk-encryption.md#customer-managed-keys). См. также [раздел ограничения с помощью ключей, управляемых клиентом](../virtual-machines/windows/disks-enable-customer-managed-keys-portal.md#restrictions).


> [!NOTE]
> - В настоящее время шифрование дисков с помощью управляемого клиентом ключа поддерживается только для дисков ОС в DevTest Labs. 
> 
> - Этот параметр применяется ко вновь созданным дискам ОС в лаборатории. Если вы решили изменить набор шифрования диска в некоторый момент, старые диски в лаборатории останутся зашифрованными с использованием предыдущего набора шифрования диска. 

В следующем разделе показано, как владелец лаборатории может настроить шифрование с помощью управляемого клиентом ключа.

## <a name="pre-requisites"></a>Предварительные требования

1. Если у вас нет набора шифрования дисков, следуйте указаниям в этой статье, чтобы [настроить Key Vault и набор шифрования дисков](../virtual-machines/windows/disks-enable-customer-managed-keys-portal.md#set-up-your-azure-key-vault). Обратите внимание на следующие требования к набору шифрования дисков: 

    - Набор шифрования дисков должен находиться **в том же регионе и подписке, что и ваша лаборатория**. 
    - Убедитесь, что у вас (владелец лаборатории) есть по крайней мере **доступ на уровне чтения** к набору шифрования диска, который будет использоваться для шифрования дисков ОС лаборатории.  
2. Чтобы лабораторная среда обрабатывала шифрование для всех дисков операционной системы, владельцу лаборатории необходимо явно предоставить **удостоверению, назначенное системой** в лаборатории, разрешение на набор шифрования дисков. Владелец лаборатории может сделать это, выполнив следующие действия.

    > [!IMPORTANT]
    > Эти шаги необходимо выполнить для лабораторий, созданных в течение или после 8/1/2020. Для лабораторий, созданных до этой даты, никаких действий не требуется.

    1. Убедитесь, что вы являетесь членом [роли администратора доступа пользователей](../role-based-access-control/built-in-roles.md#user-access-administrator) на уровне подписки Azure, чтобы вы могли управлять доступом пользователей к ресурсам Azure. 
    1. На странице **набор шифрования дисков** выберите **Управление доступом (IAM)** в меню слева. 
    1. Выберите **+ Добавить** на панели инструментов и щелкните **добавить назначение роли**.  

        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/add-role-management-menu.png" alt-text="Добавление управления ролями — меню":::
    1. На странице **Добавление назначения ролей** выберите роль **читатель** или роль, которая обеспечивает дополнительный доступ. 
    1. Введите имя лаборатории, для которой будет использоваться набор шифрования дисков, и выберите имя лаборатории (удостоверение, назначенное системой для лаборатории) из раскрывающегося списка. 
    
        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/select-lab.png" alt-text="Выбор управляемого системой удостоверения лаборатории":::        
    1. На панели инструментов щелкните **Сохранить**. 

        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/save-role-assignment.png" alt-text="Сохранить назначение ролей":::
3. Добавьте в роль **участника виртуальной машины** **удостоверение, назначенное системой** лаборатории, с помощью страницы **Subscription**  ->  **управления доступом к подпискам (IAM)** . Шаги аналогичны описанным в предыдущих шагах. 

    > [!IMPORTANT]
    > Эти шаги необходимо выполнить для лабораторий, созданных в течение или после 8/1/2020. Для лабораторий, созданных до этой даты, никаких действий не требуется.

    1. Перейдите на страницу **подписки** в портал Azure. 
    1. Выберите **Управление доступом (IAM)** . 
    1. Выберите **+ Добавить** на панели инструментов и щелкните **добавить назначение роли**. 
    
        :::image type="content" source="./media/encrypt-disks-customer-managed-keys/subscription-access-control-page.png" alt-text="Подписка — страница управления доступом > (IAM)":::
    1. На странице **Добавление назначения ролей** выберите **участника виртуальной машины** для роли.
    1. Введите имя лаборатории и выберите **имя лаборатории** (удостоверение, назначенное системой для лаборатории) из раскрывающегося списка. 
    1. На панели инструментов щелкните **Сохранить**. 

## <a name="encrypt-lab-os-disks-with-a-customer-managed-key"></a>Шифрование дисков ОС лаборатории с помощью управляемого клиентом ключа 

1. На домашней странице лаборатории в портал Azure выберите **Конфигурация и политики** в меню слева. 
1. На странице **Конфигурация и политики** в разделе **Шифрование** выберите **диски (Предварительная версия)** . По умолчанию для параметра **тип шифрования** задано значение **Шифрование неактивных данных с управляемым платформой ключом**.

    :::image type="content" source="./media/encrypt-disks-customer-managed-keys/disks-page.png" alt-text="Вкладка "диски" страницы "Конфигурация и политики"":::
1. В качестве **типа шифрования**выберите **Шифрование неактивных с помощью управляемого клиентом ключа** из раскрывающегося списка. 
1. Для параметра **Шифрование диска**выберите созданный ранее набор шифрования дисков. Это тот же набор шифрования диска, к которому может получить доступ, назначенный системой удостоверением лаборатории.
1. На панели инструментов щелкните **Сохранить**. 

    :::image type="content" source="./media/encrypt-disks-customer-managed-keys/disk-encryption-set.png" alt-text="Включение шифрования с помощью ключа, управляемого клиентом":::
1. В окне сообщения со следующим текстом: *этот параметр будет применяться к вновь созданным компьютерам в лаборатории. Старый диск ОС останется зашифрованным со старым набором шифрования диска*, нажмите кнопку **ОК**. 

    После настройки диски ОС лаборатории будут зашифрованы с помощью управляемого клиентом ключа, предоставленного с использованием набора шифрования дисков. 

## <a name="next-steps"></a>Дальнейшие действия
См. следующие статьи: 

- [Шифрование дисков Azure](../virtual-machines/windows/disk-encryption.md). 
- [Ключи, управляемые клиентом](../virtual-machines/windows/disk-encryption.md#customer-managed-keys) 