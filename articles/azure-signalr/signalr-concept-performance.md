---
title: Руководство по производительности для Службы Azure SignalR
description: Обзор производительности и эталон службы Azure SignalR. Ключевые показатели следует учитывать при планировании емкости.
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: zhshang
ms.openlocfilehash: 68cad32be177fa20794399157fca89e87c2f8f59
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74157667"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Руководство по производительности для Службы Azure SignalR

Одним из ключевых преимуществ использования сервиса Azure SignalR является простота масштабирования приложений SignalR. В крупномасштабном сценарии производительность является важным фактором. 

В этом руководстве мы представим факторы, влияющие на производительность приложения SignalR. Мы опишите типичную производительность в различных сценариях использования. В конце мы представим среду и инструменты, которые можно использовать для создания отчета о производительности.

## <a name="term-definitions"></a>Определения терминов

*Входв:* Входное сообщение службе Azure SignalR.

*Исходящие*сообщения от службы Azure SignalR.

*Пропускная способность*: Общий размер всех сообщений за 1 секунду.

*Режим по умолчанию:* Режим работы по умолчанию при создании экземпляра Службы Ожидания Azure. Служба Azure SignalR ожидает, что сервер приложения установит с ним связь до того, как он примет какие-либо клиентские соединения.

*Режим без сервера:* режим, в котором служба Azure SignalR принимает только клиентские соединения. Подключение сервера не допускается.

## <a name="overview"></a>Обзор

Служба Azure SignalR определяет семь стандартных уровней для различных производственных мощностей. Данное руководство отвечает на следующие вопросы:

-   Какова типичная производительность службы Azure SignalR для каждого уровня?

-   Соответствует ли служба Azure SignalR моим требованиям к пропускной связи (например, отправка 100 000 сообщений в секунду)?

-   Для моего конкретного сценария, какой уровень подходит для меня? Или как я могу выбрать правильный уровень?

-   Какой сервер приложений (размер VM) подходит для меня? Сколько из них я должен развернуть?

Чтобы ответить на эти вопросы, это руководство сначала дает на высоком уровне объяснение факторов, влияющих на производительность. Затем он иллюстрирует максимальные входящие и исходящие сообщения для каждого уровня для типичных случаев использования: **эхо,** **трансляция,** отправка в **группу**и **отправка в соединение** (одноранговой чат).

Это руководство не может охватывать все сценарии (и различные случаи использования, размеры сообщений, шаблоны отправки сообщений и так далее). Но он предоставляет некоторые методы, чтобы помочь вам:

- Оцените приблизительное требование для входящих или исходящих сообщений.
- Найдите подходящие уровни, проверив таблицу производительности.

## <a name="performance-insight"></a>Производительность проницательность

В этом разделе описаны методологии оценки производительности, а затем перечислены все факторы, влияющие на производительность. В конце концов, он предоставляет методы, которые помогут вам оценить требования к производительности.

### <a name="methodology"></a>Методика

*Пропускная способность* и *задержка* являются двумя типичными аспектами проверки производительности. Для службы Azure SignalR каждый уровень SKU имеет свою собственную политику регулирования пропускной связи. Политика определяет *максимально допустимую пропускную способность (входящих и исходящих полосы пропускания)* как максимальную достигнутую пропускной способности, когда 99 процентов сообщений имеют задержку, которая составляет менее 1 секунды.

Задержка — это промежуток времени от соединения, отправляя сообщение, до получения сообщения от ответа от службы Azure SignalR. Давайте возьмем **эхо** в качестве примера. Каждое клиентское соединение добавляет в сообщение отметку времени. Концентратор сервера приложения отправляет исходное сообщение обратно клиенту. Таким образом, задержка распространения легко рассчитывается каждым подключением клиента. Отметка времени прилагается для каждого сообщения в **эфире,** отправить в **группу,** и **отправить на подключение**.

Для имитации тысяч одновременных клиентских подключений несколько виртуальных виртуальных вс-ч создаются в виртуальной частной сети Azure. Все эти ВМ подключаются к тому же экземпляру службы СигналR Azure.

В режиме по умолчанию службы Azure SignalR, виртуальные серверы приложений развертываются в той же виртуальной частной сети, что и клиентские виртуальные. Все клиентские ВМ и vMs-серверы приложений развернуты в одной сети одного региона, чтобы избежать межрегиональной задержки.

### <a name="performance-factors"></a>Факторы производительности

Теоретически емкость службы Azure SignalR ограничена вычислительными ресурсами: процессором, памятью и сетью. Например, большее количество подключений к службе Azure SignalR приводит к тому, что служба использует больше памяти. Для большего трафика сообщений (например, каждое сообщение больше, чем 2048 байтов), служба Azure SignalR должна тратить больше циклов процессора для обработки трафика. В то же время пропускная способность сети Azure также вводит ограничение для максимального трафика.

Тип транспорта является еще одним фактором, влияющим на производительность. Эти три типа: [WebSocket,](https://en.wikipedia.org/wiki/WebSocket) [Server-Sent-Event](https://en.wikipedia.org/wiki/Server-sent_events)и [Long-Polling.](https://en.wikipedia.org/wiki/Push_technology) 

WebSocket — это двунаправленный и полнодуповальный протокол связи по одному подключению TCP. Server-Sent-Event — это однонаправленный протокол для push сообщений с сервера на клиент. Long-Polling требует от клиентов периодически опрашивать информацию с сервера через запрос HTTP. Для того же API в тех же условиях WebSocket имеет лучшую производительность, Server-Sent-Event медленнее, а Long-Polling - самый медленный. Служба Azure SignalR рекомендует WebSocket по умолчанию.

Стоимость реуктора сообщений также ограничивает производительность. Служба Azure SignalR играет роль маршрутизатора сообщений, который направляет сообщение с набора клиентов или серверов другим клиентам или серверам. Другой сценарий или API требует другой политики трассировки. 

Для **эхо,** клиент посылает сообщение себе, и направление направления также сам по себе. Этот шаблон имеет самую низкую стоимость реуктора. Но для **трансляции,** отправки в **группу**и **отправки на подключение**служба Azure SignalR должна искать целевые соединения через внутреннюю распределенную структуру данных. Эта дополнительная обработка использует больше процессора, памяти и пропускной способности сети. В результате производительность снижается.

В режиме по умолчанию сервер приложения также может стать узким местом для определенных сценариев. Azure SignalR SDK должен вызывать концентратор, в то время как он поддерживает живую связь с каждым клиентом через сигналы сердцебиения.

В режиме без сервера клиент отправляет сообщение http post, которое не так эффективно, как WebSocket.

Другим фактором является протокол: JSON и [MessagePack](https://msgpack.org/index.html). MessagePack меньше по размеру и доставляется быстрее, чем JSON. Однако MessagePack может не повысить производительность. Производительность службы Azure SignalR не чувствительна к протоколам, поскольку она не декодирует полезную нагрузку сообщения во время переадресности сообщений от клиентов к серверам или наоборот.

Таким образом, на входящих и исходящих емкостях влияют следующие факторы:

-   Уровень SKU (CPU/память)

-   Количество подключений.

-   Размер сообщения

-   Скорость отправки сообщений

-   Тип транспорта (WebSocket, Server-Sent-Event или Long-Polling)

-   Сценарий использования (стоимость реуктора)

-   Подключение сервера и службы приложения (в режиме сервера)


### <a name="finding-a-proper-sku"></a>Поиск правильного SKU

Как вы можете оценить входящих / исходящих мощностей или найти, какой уровень подходит для конкретного случая использования?

Предположим, что сервер приложения является достаточно мощным и не является узким местом производительности. Затем проверьте максимальную входящее и исходящие полосы пропускания для каждого уровня.

#### <a name="quick-evaluation"></a>Быстрая оценка

Давайте сначала упростим оценку, предполагая некоторые настройки по умолчанию: 

- Тип транспорта — WebSocket.
- Размер сообщения составляет 2048 байтов.
- Сообщение отправляется каждые 1 секунды.
- Служба СигналR Azure находится в режиме по умолчанию.

Каждый уровень имеет свою максимальную входяную пропускную способность и исходящий пропускной способности. Бесперебойное взаимодействие с пользователем не гарантируется после того, как входявое или исходящие соединения превысят предел.

**Echo** обеспечивает максимальную входячную пропускную способность, поскольку имеет самую низкую стоимость смгой. **Трансляция** определяет максимальную пропускную способность исходящих сообщений.

Не *not* превышать выделенные значения в следующих двух таблицах.

|       Echo                        | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| **Входящие полосы пропускания** | **2 Мбит/с**    | **4 Мбит/с**    | **10 Мбит/с**   | **20 Мбит/с**    | **40 Мбит/с**    | **100 Мбит/с**   | **200 Мбит/с**    |
| Исходящие полосы пропускания | 2 Мбит/с   | 4 Мбит/с   | 10 Мбит/с  | 20 Мбит/с   | 40 Мбит/с   | 100 Мбит/с  | 200 Мбит/с   |


|     Broadcast             | Единица1 | Единица2 | Единица5  | Единица10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие полосы пропускания  | 4 Кбит/и   | 4 Кбит/и   | 4 Кбит/и    | 4 Кбит/и    | 4 Кбит/и    | 4 Кбит/и     | 4 Кбит/и    |
| **Исходящие полосы пропускания** | **4 Мбит/с**    | **8 Мбит/с**    | **20 Мбит/с**    | **40 Мбит/с**    | **80 Мбит/с**    | **200 Мбит/с**    | **400 Мбит/с**   |

*Входящие полосы пропускания* и *исходящие полосы пропускаявляются* общим размером сообщения в секунду.  Вот формулы для них:
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *входящиесоединения*: Количество соединений, отправляющих сообщение.

- *outboundConnections*: Количество подключений, получающих сообщение.

- *messageSize*: Размер одного сообщения (среднее значение). Небольшое сообщение, которое меньше 1024 байтов, оказывает влияние на производительность, аналогичное сообщению 1024 байт.

- *sendInterval*: Время отправки одного сообщения. Обычно это 1 секунда за сообщение, что означает отправку одного сообщения каждую секунду. Меньший интервал означает отправку большего количества сообщений за период времени. Например, 0,5 секунды на сообщение означает отправку двух сообщений в секунду.

- *Соединения*: Зафиксированный максимальный порог для службы Azure SignalR для каждого уровня. Если число соединения увеличивается дальше, он будет страдать от регулирования соединения.

#### <a name="evaluation-for-complex-use-cases"></a>Оценка для сложных случаев использования

##### <a name="bigger-message-size-or-different-sending-rate"></a>Больший размер сообщения или различная скорость отправки

Реальный случай использования является более сложным. Он может отправить сообщение больше, чем 2048 байт, или скорость отправки сообщения не является одним сообщением в секунду. Давайте возьмем трансляцию Unit100 в качестве примера, чтобы найти, как оценить его производительность.

В следующей таблице показан реальный случай использования **вещания.** Но размер сообщения, количество подключений и скорость отправки сообщений отличаются от того, что мы предполагали в предыдущем разделе. Вопрос в том, как мы можем вывести любой из этих элементов (размер сообщения, количество соединений или скорость отправки сообщений), если мы знаем только два из них.

| Broadcast  | Размер сообщения | Входящие сообщения в секунду | Соединения | Отправка интервалов |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 кБ                | 1                        | 100 000     | 5 секунд                      |
| 2 | 256 KB               | 1                        | 8000       | 5 секунд                      |

Следующую формулу легко сделать на основе предыдущей формулы:

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

Для Unit100 максимальная исходящие полосы пропускания составляет 400 МБ от предыдущей таблицы. Для 20-КБ размер сообщения, максимальный исходящих соединений должно быть 400 МБ \* 5 / 20 КБ и 100000, который соответствует реальной стоимости.

##### <a name="mixed-use-cases"></a>Случаи смешанного использования

Реальный случай использования обычно смешивает четыре основных случаях использования вместе: **эхо,** **трансляция,** отправить в **группу,** и **отправить на подключение.** Методология, используемая для оценки емкости:

1. Разделите случаи смешанного использования на четыре основных случая использования.
1. Рассчитайте максимальную пропускную способность входящих и исходящих сообщений, используя предыдущие формулы отдельно.
1. Сумма вычислений пропускной способности, чтобы получить общую максимальную входящих / исходящих пропускной способности. 

Затем подобрать правильный уровень из максимального входящих / исходящих таблиц пропускной способности.

> [!NOTE]
> Для отправки сообщения сотням или тысячам небольших групп или тысячам клиентов, отправляющих сообщения друг другу, стоимость направления станет доминирующей. Примите это влияние во внимание.

В случае отправки сообщения клиентам убедитесь, что сервер приложения *не* является узким местом. В следующем разделе "Case study" приведены рекомендации о том, сколько серверов приложений вам нужно и сколько серверных соединений вы должны настроить.

## <a name="case-study"></a>пример использования

Следующие разделы проходят через четыре типичных случаях использования для транспортировки WebSocket: **эхо**, **трансляция,** отправить в **группу,** и **отправить на подключение**. Для каждого сценария раздел перечисляет текущую входящие и исходящие емкости для службы Azure SignalR. В нем также разъясняются основные факторы, влияющие на производительность.

В режиме по умолчанию сервер приложения создает пять серверных соединений с azure SignalR Service. Сервер приложения использует службу SDK Azure SignalR по умолчанию. В следующих результатах тестирования производительности соединения сервера увеличиваются до 15 (или более для трансляции и отправки сообщения большой группе).

Различные случаи использования имеют различные требования к серверам приложений. **Трансляция** требует небольшого количества серверов приложений. **Эхо** или **отправка на подключение** требует много серверов приложений.

Во всех случаях использования размер сообщения по умолчанию составляет 2048 байтов, а интервал отправки сообщений — 1 секунда.

### <a name="default-mode"></a>Режим по умолчанию

Клиенты, серверы веб-приложений и служба Azure SignalR участвуют в режиме по умолчанию. Каждый клиент означает одно соединение.

#### <a name="echo"></a>Echo

Во-первых, веб-приложение подключается к службе Azure SignalR. Во-вторых, многие клиенты подключаются к веб-приложению, которое перенаправляет клиентов в службу Azure SignalR с токеном доступа и конечным пунктом. Затем клиенты устанавливают соединения WebSocket с сервисом Azure SignalR.

После того, как все клиенты устанавливают связи, они начинают отправлять сообщение, содержащее отметку времени в конкретный концентратор каждую секунду. Концентратор перекликается с сообщением обратно к исходному клиенту. Каждый клиент вычисляет задержку, когда он получает эхо-сообщение обратно.

На следующей диаграмме 5 к 8 (красный выделенный трафик) находятся в цикле. Цикл выполняется по умолчанию (5 минут) и получает статистику всей задержки сообщений.

![Трафик для корпуса использования эха](./media/signalr-concept-performance/echo.png)

Поведение **эха** определяет, что максимальная входявая пропускная способность равна максимальной исходящих полосы пропуска. Дополнительные сведения см. в приведенной ниже таблице.

|       Echo                        | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Входящие/исходящие сообщения в секунду | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Входящие/ исходящие полосы пропускания | 2 Мбит/с   | 4 Мбит/с   | 10 Мбит/с  | 20 Мбит/с   | 40 Мбит/с   | 100 Мбит/с  | 200 Мбит/с   |

В этом случае каждый клиент вызывает концентратор, определенный на сервере приложения. Концентратор просто вызывает метод, определенный в исходной стороне клиента. Этот концентратор является самым легким центром для **эхо**.

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

Даже для этого простого концентратора давление трафика на сервере приложения заметно по мере увеличения нагрузки **на входящие сообщения.** Это давление трафика требует много серверов приложений для больших уровней SKU. В следующей таблице перечислены подсчет сервера приложения для каждого уровня.


|    Echo          | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Номер соединения клиента, размер сообщения, скорость отправки сообщений, уровень SKU и процессор/память сервера приложения влияют на общую производительность **эхо.**

#### <a name="broadcast"></a>Broadcast

Для **трансляции,** когда веб-приложение получает сообщение, он вещает на всех клиентов. Чем больше клиентов, тем больше трафика сообщений есть для всех клиентов. Рассмотрим схему ниже.

![Трафик для случая использования трансляции](./media/signalr-concept-performance/broadcast.png)

Небольшое количество клиентов вещают. Пропускная способность входящих сообщений мала, но исходящие полосы пропускания огромны. Пропускная способность исходящих сообщений увеличивается по мере увеличения клиентского соединения или скорости вещания.

В следующей таблице кратко излагается максимальное количество клиентских подключений, количество входящих/исходящих сообщений и пропускная способность.

|     Broadcast             | Единица1 | Единица2 | Единица5  | Единица10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие сообщения в секунду  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящие сообщения в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Входящие полосы пропускания  | 4 Кбит/и   | 4 Кбит/и   | 4 Кбит/и    | 4 Кбит/и    | 4 Кбит/и    | 4 Кбит/и     | 4 Кбит/и     |
| Исходящие полосы пропускания | 4 Мбит/с   | 8 Мбит/с   | 20 Мбит/с   | 40 Мбит/с   | 80 Мбит/с   | 200 Мбит/с   | 400 Мбит/с   |

Клиентов, которые размещают сообщения, не более четырех. Им нужно меньше серверов приложений по сравнению с **эхо,** потому что входящие сообщения сумма мала. Двух серверов приложений достаточно как для SLA, так и для учета производительности. Но следует увеличить соединения сервера по умолчанию, чтобы избежать дисбаланса, особенно для Unit50 и Unit100.

|   Broadcast      | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> Увеличьте соединения сервера по умолчанию с 5 до 40 на каждом сервере приложения, чтобы избежать возможных несбалансированных подключений к серверу службы Azure SignalR.
>
> Номер соединения клиента, размер сообщения, скорость отправки сообщений и уровень SKU влияют на общую производительность **вещания.**

#### <a name="send-to-group"></a>Отправить в группу

Отправка в случай использования **группы** имеет аналогичную схему трафика для **трансляции.** Разница заключается в том, что после того, как клиенты устанавливают соединения WebSocket с службой Azure SignalR, они должны присоединиться к группам, прежде чем они смогут отправить сообщение определенной группе. Следующая диаграмма иллюстрирует транспортный поток.

![Трафик для случая использования в группе](./media/signalr-concept-performance/sendtogroup.png)

Количество участников группы и группы — это два фактора, влияющих на производительность. Для упрощения анализа мы определяем два типа групп:

- **Небольшая группа**: Каждая группа имеет 10 соединений. Номер группы равен (максимальное количество подключений) / 10. Например, для Unit1, если есть 1000 соединений рассчитывает, то у нас есть 1000 / 10 и 100 групп.

- **Большая группа**: Номер группы всегда 10. Количество участников группы равно (максимальное количество подключений) / 10. Например, для Unit1, если есть 1000 количество подключений, то каждая группа имеет 1000 / 10 и 100 членов.

**Отправка в группу** приносит стоимость разгрома службе Azure SignalR, поскольку она должна найти целевые соединения через распределенную структуру данных. По мере увеличения подключения к отправке стоимость увеличивается.

##### <a name="small-group"></a>Небольшая группа

Стоимость направления является значительной для отправки сообщений многим небольшим группам. В настоящее время реализация службы Azure SignalR достигает предела затрат на скорость в Unit50. Добавление большего количества процессора и памяти не помогает, поэтому Unit100 не может улучшиться с помощью дизайна. Если вам нужно больше входящих пропускной способности, обратитесь в службу поддержки клиентов.

|   Отправить в небольшую группу     | Единица1 | Единица2 | Единица5  | Единица10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000 | 100 000
| Количество участников группы        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| Количество групп               | 100   | 200   | 500    | 1000  | 2 000  | 5 000  | 10 000 
| Входящие сообщения в секунду  | 200   | 400   | 1000  | 2500  | 4000  | 7000  | 7000   |
| Входящие полосы пропускания  | 400 кбит /ч  | 800 кбит /ч  | 2 Мбит/с     | 5 Мбит/с     | 8 Мбит/с     | 14 Мбит/с    | 14 Мбит/с     |
| Исходящие сообщения в секунду | 2 000 | 4000 | 10 000 | 25 000 | 40 000 | 70,000 | 70,000  |
| Исходящие полосы пропускания | 4 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 50 Мбит/с     | 80 Мбит/с    | 140 Мбит/с   | 140 Мбит/с    |

Многие клиентские соединения вызывают концентратор, поэтому номер сервера приложения также имеет решающее значение для производительности. В следующей таблице перечислены предполагаемые значения сервера приложений.

|  Отправить в небольшую группу   | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Номер клиентского соединения, размер сообщения, скорость отправки сообщений, стоимость разгрома, уровень SKU и процессор/память сервера приложения влияют на общую производительность **отправки в небольшую группу.**

##### <a name="big-group"></a>Большая группа

Для **отправки в большую группу**исходящие полосы пропускания становятся узким местом перед ударом пределов затрат на скорость. В следующей таблице перечислена максимальная исходящие полосы пропускания, которая почти такая же, как и для **трансляции.**

|    Отправить в большую группу      | Единица1 | Единица2 | Единица5  | Единица10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000
| Количество участников группы        | 100   | 200   | 500    | 1000  | 2 000  | 5 000   | 10 000 
| Количество групп               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| Входящие сообщения в секунду  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| Входящие полосы пропускания  | 80 Кбит/с   | 40 Кбит/с   | 40 Кбит/с    | 20 Кбит /С.    | 40 Кбит/с    | 40 Кбит/с     | 40 Кбит/с     |
| Исходящие сообщения в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Исходящие полосы пропускания | 8 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 40 Мбит/с    | 80 Мбит/с    | 200 Мбит/с    | 400 Мбит/с    |

Количество сообщений об отправке не превышает 40. Нагрузка на сервер приложения невелика, поэтому предлагаемое количество веб-приложений невелико.

|  Отправить в большую группу  | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> Увеличьте соединения сервера по умолчанию с 5 до 40 на каждом сервере приложения, чтобы избежать возможных несбалансированных подключений к серверу службы Azure SignalR.
> 
> Номер соединения клиента, размер сообщения, скорость отправки сообщений, стоимость направления и уровень SKU влияют на общую производительность **отправки в большую группу.**

#### <a name="send-to-connection"></a>Отправка на подключение

В случае использования **подключения,** когда клиенты устанавливают соединения с azure SignalR Service, каждый клиент вызывает специальный концентратор, чтобы получить свой собственный идентификатор связи. Тест производительности собирает все идентии связи, перетасовывает их и переназначает их всем клиентам в качестве цели отправки. Клиенты продолжают отправлять сообщение в целевое соединение до завершения теста производительности.

![Трафик для случая использования отсылки клиенту](./media/signalr-concept-performance/sendtoclient.png)

Стоимость отправки для **отправки в соединение** аналогична стоимости **отправки в небольшую группу.**

По мере увеличения количества соединения стоимость сравливания ограничивает общую производительность. Unit50 достигла предела. В результате, Unit100 не может улучшить дальше.

Следующая таблица представляет собой статистическую сводку после многих раундов выполнения **отправки к бенчмарку соединения.**

|   Отправка на подключение   | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| Соединения                        | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000          | 100 000         |
| Входящие/исходящие сообщения в секунду | 1000 | 2 000 | 5 000 | 8000  | 9000  | 20 000 | 20 000 |
| Входящие/ исходящие полосы пропускания | 2 Мбит/с    | 4 Мбит/с    | 10 Мбит/с   | 16 Мбит/с    | 18 Мбит/с    | 40 Мбит/с       | 40 Мбит/с       |

Этот случай использования требует высокой нагрузки на сторону сервера приложения. Ознакомьтесь с предполагаемым количеством серверов приложений в следующей таблице.

|  Отправка на подключение  | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Номер соединения клиента, размер сообщения, скорость отправки сообщений, стоимость разгрома, уровень SKU и процессор/память для сервера приложения влияют на общую производительность **отправки в соединение.**

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>ASP.NET SignalR эхо, трансляция и отправка в небольшую группу

Служба СигналR Azure обеспечивает такую же емкость производительности для ASP.NET SignalR. 

Тест производительности использует web-приложения Azure из [Standard Service Plan S3](https://azure.microsoft.com/pricing/details/app-service/windows/) для ASP.NET SignalR.

Следующая таблица дает предлагаемый веб-приложение рассчитывать на ASP.NET **Эхо**SignalR .

|   Echo           | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

Следующая таблица дает предлагаемый веб-приложение рассчитывать на ASP.NET **SignalR вещания**.

|  Broadcast       | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

Следующая таблица дает предлагаемый веб-приложение рассчитывать на ASP.NET SignalR **отправить в небольшую группу**.

|  Отправить в небольшую группу     | Единица1 | Единица2 | Единица5 | Единица10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Соединения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Количество серверов приложений | 2     | 2     | 4     | 4      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>Режим без сервера

Клиенты и служба Azure SignalR участвуют в режиме без серверов. Каждый клиент означает одно соединение. Клиент отправляет сообщения через REST API другому клиенту или транслирует сообщения всем.

Отправка сообщений высокой плотности через REST API не так эффективна, как использование WebSocket. Он требует, чтобы вы построили новое соединение HTTP каждый раз, и это дополнительные расходы в режиме без сервера.

#### <a name="broadcast-through-rest-api"></a>Трансляция через REST API
Все клиенты устанавливают связи WebSocket с сервисом Azure SignalR. Затем некоторые клиенты начинают вещание через REST API. Отправка сообщений (входящих) проходит через HTTP Post, что не эффективно по сравнению с WebSocket.

|   Трансляция через REST API     | Единица1 | Единица2 | Единица5  | Единица10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие сообщения в секунду  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящие сообщения в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200 000 |
| Входящие полосы пропускания  | 4 Кбит/и    | 4 Кбит/и    | 4 Кбит/и     | 4 Кбит/и     | 4 Кбит/и     | 4 Кбит/и      | 4 Кбит/и      |
| Исходящие полосы пропускания | 4 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 40 Мбит/с    | 80 Мбит/с    | 200 Мбит/с    | 400 Мбит/с    |

#### <a name="send-to-user-through-rest-api"></a>Отправить пользователю через REST API
Бенчмарк присваивает имена пользователей всем клиентам до того, как они начнут подключаться к службе Azure SignalR. После того, как клиенты устанавливают соединения WebSocket с службой Azure SignalR, они начинают отправлять сообщения другим через HTTP Post.

|   Отправить пользователю через REST API | Единица1 | Единица2 | Единица5  | Единица10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Соединения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящие сообщения в секунду  | 300   | 600   | 900    | 1,300  | 2 000  | 10 000  | 18 000  |
| Исходящие сообщения в секунду | 300   | 600   | 900    | 1,300  | 2 000  | 10 000  | 18 000 |
| Входящие полосы пропускания  | 600 кбит /ч  | 1.2 Мбит/с  | 1,8 Мбит/с   | 2.6 Мбит/с   | 4 Мбит/с     | 10 Мбит/с     | 36 Мбит/с    |
| Исходящие полосы пропускания | 600 кбит /ч  | 1.2 Мбит/с  | 1,8 Мбит/с   | 2.6 Мбит/с   | 4 Мбит/с     | 10 Мбит/с     | 36 Мбит/с    |

## <a name="performance-test-environments"></a>Среды тестирования производительности

Для всех случаев использования, перечисленных ранее, мы провели тесты производительности в среде Azure. В лучшем случае мы использовали 50 клиентских ВМ и 20 vMs-серверов приложений. Вот несколько советов:

- Размер клиента VM: StandarddS2V2 (2 vCPU, память 7G)

- Размер сервера приложений VM: StandardF4sV2 (4 vCPU, память 8G)

- Подключение сервера Azure Signalr SDK: 15

## <a name="performance-tools"></a>Средства производительности

Вы можете найти инструменты производительности для службы Azure SignalR на [GitHub.](https://github.com/Azure/azure-signalr-bench/)

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы получили обзор производительности службы Azure SignalR в типичных сценариях использования.

Чтобы получить подробную информацию о внутренних службах и масштабирования для него, прочитайте следующие руководства:

* [Внутренние компоненты службы Azure SignalR](signalr-concept-internals.md)
* [Масштабирование службы Azure SignalR](signalr-howto-scale-multi-instances.md)
