---
title: Руководства по повышению производительности для службы Azure SignalR
description: Общие сведения о производительности служба Azure SignalR.
author: sffamily
ms.service: signalr
ms.topic: conceptual
ms.date: 04/08/2019
ms.author: zhshang
ms.openlocfilehash: f7cc05c8c2a299d809c4386d119fef58fa2548d5
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "61269503"
---
# <a name="performance-guide-for-azure-signalr-service"></a>Руководства по повышению производительности для службы Azure SignalR

Одним из ключевых преимуществ использования службы Azure SignalR является простота масштабирования приложений SignalR. В случае крупномасштабных производительность является важным фактором. 

В этом руководстве мы добавим факторы, влияющие на производительность приложения SignalR. Мы опишем обычной производительностью в различных сценариях использования. В конце концов мы добавим среды и инструментов, которые можно использовать для создания отчета о производительности.

## <a name="term-definitions"></a>Определения терминов

*Входящие*: Входящее сообщение, чтобы служба Azure SignalR.

*Исходящие*: Исходящего сообщения из SignalR службы Azure.

*Пропускная способность*: Общий размер всех сообщений в секунду.

*Режим по умолчанию*: Режим работы по умолчанию, при создании экземпляра службы Azure SignalR. Служба Azure SignalR ожидает сервера приложений для установления соединения с ним, прежде чем он принимает подключения клиентов.

*Режим без сервера*: Режим, в котором служба Azure SignalR принимает только подключения клиентов. Допускается нет соединения с сервером.

## <a name="overview"></a>Обзор

Служба Azure SignalR определяет семь стандартных уровней для емкостей производительности. В этом руководстве содержатся ответы на следующие вопросы:

-   Что такое служба Azure SignalR производительность типичной для каждого уровня?

-   Служба Azure SignalR соответствует моим требованиям к пропускной способности сообщений (например, отправку 100 000 сообщений в секунду)?

-   Для моей конкретного сценария, какой уровень подходит для меня? Или, как можно выбрать правильный уровень?

-   Тип сервера приложений (размер виртуальной Машины) подходит для меня? Сколько из них следует развернуть?

Чтобы ответить на эти вопросы, в этом руководстве сначала предоставляет высокоуровневый объяснение факторы, влияющие на производительность. Затем он иллюстрирует максимальное количество входящих и исходящих сообщений для каждого уровня для типичные случаи использования: **echo**, **вещания**, **отправки группу**, и **отправки подключение** (peer-to-peer беседы).

В этом руководстве не может охватить все сценарии (и различных сценариев использования, размеры сообщений шаблоны отправки сообщениями и т. д). Но он предоставляет некоторые методы, помогающие:

- Вычислить приблизительные требования для входящих или исходящих сообщений.
- Найти соответствующие уровни, проверяя таблицу производительности.

## <a name="performance-insight"></a>Анализ производительности

В этом разделе описаны методики оценки производительности и выводит список всех факторов, влияющих на производительность. В конечном счете он предоставляет методы, которые помогут вам оценить требования к производительности.

### <a name="methodology"></a>Методика

*Пропускная способность* и *задержки* два типичных аспекта проверки производительности. Служба Azure SignalR каждый уровень SKU имеет свой собственный пропускную способность политике регулирования. Определяет политику *максимально допустимая пропускная способность (полоса пропускания входящего и исходящего)* как максимальный совокупный результат пропускной способности 99 процентов сообщений имеют задержки, не менее 1 секунды.

Задержка — это интервал времени из подключения, передающего сообщения с получением сообщения-ответа от службы Azure SignalR. Давайте **echo** в качестве примера. Каждое соединение клиент добавляет метку времени в сообщении. На сервере приложений центр отправляет исходное сообщение обратно клиенту. Поэтому задержки распространения легко вычисляется путем каждое подключение клиента. Для каждого сообщения в присоединена штампа времени **вещания**, **отправки группу**, и **отправку подключения**.

Чтобы смоделировать тысяч одновременных клиентских подключений, несколько виртуальных машин, создаются в виртуальной частной сети в Azure. Все эти виртуальные машины подключитесь к тому же экземпляру служба Azure SignalR.

В режиме по умолчанию служба Azure SignalR сервера приложений виртуальные машины развертываются в одной виртуальной частной сети как виртуальных машин клиента. Все виртуальные машины клиента и сервера приложений виртуальные машины развертываются в той же сети, в одном регионе, чтобы избежать задержки между регионами.

### <a name="performance-factors"></a>Факторы производительности

Теоретически служба Azure SignalR емкость ограничена вычислительные ресурсы: ЦП, памяти и сети. Например дополнительные подключения к службе Azure SignalR вызвать службу для использования большего объема памяти. Для больших сообщений трафика (например, каждое сообщение превышает 2048 байт), служба Azure SignalR необходимо потратить больше циклов ЦП для обработки трафика. В то же время пропускной способности сети Azure также налагает ограничение для максимального трафика.

Тип транспорта является еще одним фактором, который влияет на производительность. Три типа перечислены [WebSocket](https://en.wikipedia.org/wiki/WebSocket), [отправленных событий сервера](https://en.wikipedia.org/wiki/Server-sent_events), и [продолжительным опросом](https://en.wikipedia.org/wiki/Push_technology). 

WebSocket — это двунаправленный и протокол связи полный дуплекс через одно подключение TCP. Отправленных событий сервера — это однонаправленный протокол для отправки сообщения от сервера клиенту. Продолжительным опросом требует клиентами для периодического опроса, возвращенными на сервере с помощью HTTP-запроса. Для такой же API в таких же условиях WebSocket характеризуется более высокой производительностью, отправленных событий сервера занимает больше времени и продолжительным опросом является самым медленным. Служба Azure SignalR рекомендует WebSocket по умолчанию.

Стоимость маршрутизации сообщений также ограничивает производительность. Служба Azure SignalR играет роль как маршрутизатор сообщение, которое направляет сообщения из набора клиентов или серверов в других клиентов или серверов. Другой сценарий или API требует другую политику маршрутизации. 

Для **echo**, клиент отправляет сообщение на себя и назначения маршрутизации также сам является. Этот шаблон имеет наименьшую стоимость. Но для **вещания**, **отправки группу**, и **отправку подключения**, служба Azure SignalR требуется найти целевые соединения через внутренние распределенные данные Структура. Эта дополнительная обработка использует больше ресурсов ЦП, памяти и пропускной способности сети. В результате снижается производительность.

В режиме по умолчанию сервера приложений также может стать узким местом для определенных сценариев. Пакет SDK Azure SignalR имеет для вызова концентратора, хотя он поддерживает активное соединение с любого клиента через сигналы пульса.

В режиме без сервера клиент отправляет сообщение с помощью HTTP post, который не является настолько эффективна, насколько WebSocket.

Еще одним фактором является протокол: JSON и [MessagePack](https://msgpack.org/index.html). MessagePack меньшими по размеру и доставляться быстрее, чем JSON. MessagePack не может повысить производительность, однако. Производительность SignalR службы Azure не чувствителен к протоколов, так как он не декодировать полезных данных сообщения во время пересылки сообщений от клиентов на серверах или наоборот.

Таким образом следующие факторы влияют на емкость входящего и исходящего трафика:

-   Уровень SKU (ЦП и памяти)

-   Количество подключений.

-   Размер сообщения

-   скорость отправки сообщений

-   Тип транспорта (веб-сокет, отправленных событий сервера или продолжительным опросом)

-   Сценарии использования (Цена маршрутной)

-   подключения сервера и службы приложений (в режиме сервера)


### <a name="finding-a-proper-sku"></a>Поиск правильного номера SKU

Как можно оценить входящие и исходящие емкости или найти какой уровень подходит для конкретного сценария использования?

Предполагается, что сервер приложений обладает достаточными возможностями и не является узким местом производительности. Затем проверьте максимальную пропускную способность входящего и исходящего трафика для каждого уровня.

#### <a name="quick-evaluation"></a>Краткий обзор

Давайте упростим оценки сначала, предполагая, что некоторые параметры по умолчанию: 

- Тип транспорта — WebSocket.
- Размер сообщения составляет 2048 байт.
- Сообщение отправляется каждую секунду.
- Служба Azure SignalR находится в режиме по умолчанию.

Каждый уровень имеет свои собственные максимальную пропускную способность для входящих и исходящей пропускной способности. После подключения входящего или исходящего трафика превышает предел для удобства пользователей не гарантируется.

**Echo** предоставляет максимальную пропускную способность для входящих, так как он имеет наименьшую стоимость. **Рассылка** определяет пропускную способность исходящего сообщения.

Сделать *не* превышать выделенные значения в следующих двух таблицах.

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| **Входящей пропускной способности** | **2 Мбит/с**    | **4 Мбит/с**    | **10 Мбит/с**   | **20 Мбит/с**    | **40 Мбит/с**    | **100 Мбит/с**   | **200 Мбит/с**    |
| Исходящей пропускной способности | 2 Мбит/с   | 4 Мбит/с   | 10 Мбит/с  | 20 Мбит/с   | 40 Мбит/с   | 100 Мбит/с  | 200 Мбит/с   |


|     Трансляция             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящей пропускной способности  | 4 Кбит/с   | 4 Кбит/с   | 4 Кбит/с    | 4 Кбит/с    | 4 Кбит/с    | 4 Кбит/с     | 4 Кбит/с    |
| **Исходящей пропускной способности** | **4 Мбит/с**    | **8 Мбит/с**    | **20 Мбит/с**    | **40 Мбит/с**    | **80 Мбит/с**    | **200 Мбит/с**    | **400 Мбит/с**   |

*Полоса пропускания для входящих* и *пропускной способности исходящего канала* являются общим размером сообщения в секунду.  Ниже приведены для них формулы.
```
  inboundBandwidth = inboundConnections * messageSize / sendInterval
  outboundBandwidth = outboundConnections * messageSize / sendInterval
```

- *inboundConnections*: Число подключений, отправляющий сообщение.

- *outboundConnections*: Число подключений, получения сообщения.

- *messageSize*: Размер одного сообщения (среднее значение). Небольшое сообщение, что все меньше 1024 байта, снижению производительности, аналогичную сообщение 1024 байтов.

- *SendInterval*: Время отправки одного сообщения. Обычно он составляет 1 секунду каждого сообщения, значит, отправка одного сообщения каждую секунду. Меньший интервал означает, что Отправка дополнительных сообщений за период времени. Например 0,5 секунд на каждое сообщение означает, что отправкой двух сообщений каждую секунду.

- *Подключения*. Зафиксированные максимальное пороговое значение для службы Azure SignalR для каждого уровня. Если дальнейшей увеличивается номер соединения, он будет испытывать после подключения регулирования.

#### <a name="evaluation-for-complex-use-cases"></a>Ознакомительная версия для вариантов использования сложных

##### <a name="bigger-message-size-or-different-sending-rate"></a>Чем больше размер сообщения или различные скорости отправки

Реальный вариант использования более сложен. Он может отправить сообщение размером более 2048 байтов или скорость отправки сообщений является не одно сообщение в секунду. Давайте вещания Unit100 например о том, как можно оценить его производительность.

В следующей таблице показаны реальный вариант использования из **вещания**. Но размер сообщения, число соединений и частота, отправляющим сообщения, отличаются от предполагается в предыдущем разделе. Вопрос состоит в том, как мы можем предположить, любого из этих элементов (размер сообщения, число соединений или скорость отправки сообщений) Если мы знаем, что только два из них.

| Трансляция  | Размер сообщения | Входящих сообщений в секунду | Подключения | Отправить интервалов |
|---|---------------------|--------------------------|-------------|-------------------------|
| 1 | 20 КБ                | 1                        | 100 000     | 5 секунд                      |
| 2 | 256 KB               | 1                        | 8000       | 5 секунд                      |

Следующая формула легко определить по предыдущей формуле:

```
outboundConnections = outboundBandwidth * sendInterval / messageSize
```

Для Unit100 максимальная пропускная способность исходящих составляет 400 МБ из приведенной выше таблице. Для размера сообщения 20 КБ, максимальное число исходящих подключений должен быть 400 МБ \* 5 / 20 КБ = 100 000, который соответствует фактическому значению.

##### <a name="mixed-use-cases"></a>Варианты использования смешанных

Реальный вариант использования обычно содержатся одновременно четыре основные варианты друг с другом: **echo**, **вещания**, **отправки группу**, и **отправку подключения**. — Методологию, которая позволяет оценить емкость:

1. Варианты использования смешанных разделите на четыре варианта использования основных.
1. Рассчитать пропускную способность максимальное входящих и исходящих сообщений с помощью предыдущие формулы отдельно.
1. Сумма вычисления пропускной способности, чтобы получить общий входящий и исходящий максимальную пропускную способность. 

Затем выберите правильный уровень из таблиц максимальной пропускной способности для входящего и исходящего.

> [!NOTE]
> Для отправки сообщения до сотен и тысяч небольших групп или для тысяч клиентов при отправке сообщения друг с другом Цена маршрутной станет главным. Воспользуйтесь влияние этой конфигурации в учетную запись.

В случае использования отправки сообщения на клиентах, убедитесь, что сервера приложений *не* узкое место. В следующем разделе «Исследование» даны рекомендации по какое множество серверов приложений требуется и сколько подключений сервера следует настроить.

## <a name="case-study"></a>Пример использования

В следующих разделах описываются через четыре типичные случаи использования для транспорта WebSocket: **echo**, **вещания**, **отправки группу**, и **отправку подключения**. Для каждого сценария в разделе перечисляются текущий объем входящего и исходящего трафика для службы Azure SignalR. Здесь также описываются основные факторы, влияющие на производительность.

В режиме по умолчанию сервера приложений создает пять подключений к серверу с помощью службы Azure SignalR. По умолчанию сервера приложений используется пакет SDK службы Azure SignalR. В следующем результаты теста производительности увеличиваются соединения с сервером, чтобы 15 (или несколько для вещания и отправке сообщения для большой группы).

Разные варианты использования имеют различные требования для серверов приложений. **Рассылка** требуется небольшое количество серверов приложений. **Echo** или **отправку подключения** должен многие серверы приложений.

Во всех вариантов использования, по умолчанию размер сообщения составляет 2048 байт и интервал отправки сообщения составляет 1 секунду.

### <a name="default-mode"></a>Режим по умолчанию

Клиенты, серверы веб-приложений и служба Azure SignalR участвуют в режиме по умолчанию. Каждый клиент — это одно подключение.

#### <a name="echo"></a>echo

Во-первых веб-приложение подключается к службе Azure SignalR. Во-вторых многие клиенты подключаются к веб-приложения, который перенаправляет запрос клиентов служба Azure SignalR с помощью маркера доступа и конечную точку. Затем клиенты устанавливают соединения WebSocket с помощью службы Azure SignalR.

После подключения всех клиентов, они приступить к отправке сообщения, которое содержит отметку времени определенным центром каждую секунду. Концентратор возвращает пользователю сообщение обратно к его исходному клиенту. Каждый клиент вычисляет время задержки при получении сообщения проверки связи обратно.

На следующей схеме 5-8 (красный выделенный трафик) находятся в цикле. Цикл выполняется по умолчанию в течение (5 минут) и возвращает статистику всех задержка сообщений.

![Трафик в случае использования echo](./media/signalr-concept-performance/echo.png)

Поведение **echo** определит, что максимальная пропускная способность входящих равно максимальную пропускную способность исходящего трафика. Дополнительные сведения см. в разделе в следующей таблице.

|       echo                        | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|-----------------------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения                       | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Входящие и исходящие сообщения в секунду | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Входящие и исходящие пропускной способности | 2 Мбит/с   | 4 Мбит/с   | 10 Мбит/с  | 20 Мбит/с   | 40 Мбит/с   | 100 Мбит/с  | 200 Мбит/с   |

В этом случае каждый клиент вызывает концентратору, описанному в сервера приложений. Концентратор, просто вызывает метод, определенный на исходной стороне клиента. Этот центр — это самый легкий вариант центр для **echo**.

```
        public void Echo(IDictionary<string, object> data)
        {
            Clients.Client(Context.ConnectionId).SendAsync("RecordLatency", data);
        }
```

Даже для этого простого концентратора, известных как трафика давление на сервере приложений **echo** входящего сообщения увеличения нагрузки. Этот трафик давление требует многие серверы приложений для больших уровней SKU. В следующей таблице перечислены числа серверов приложений для каждого уровня.


|    echo          | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Клиент подключения number, размер сообщения, сообщения, отправкой скорость, уровень SKU и ЦП и памяти сервера приложений влияют на общую производительность **echo**.

#### <a name="broadcast"></a>Трансляция

Для **вещания**, когда веб-приложение получает сообщение, она рассылает всем клиентам. Чем больше клиентов являются для передачи, больше трафика сообщение, что требуется для всех клиентов. См. в следующей схеме.

![Трафик в случае использования вещания](./media/signalr-concept-performance/broadcast.png)

Транслирует небольшое количество клиентов. Пропускная способность входящих сообщений невелика, но исходящей пропускной способности огромен. Увеличивает пропускную способность исходящего сообщения как клиентского соединения или увеличивает частота широковещательных пакетов.

В следующей таблице перечислены максимальное число клиентских подключений, число входящих и исходящих сообщений и пропускной способности.

|     Трансляция             | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящих сообщений в секунду  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200,000 |
| Входящей пропускной способности  | 4 Кбит/с   | 4 Кбит/с   | 4 Кбит/с    | 4 Кбит/с    | 4 Кбит/с    | 4 Кбит/с     | 4 Кбит/с     |
| Исходящей пропускной способности | 4 Мбит/с   | 8 Мбит/с   | 20 Мбит/с   | 40 Мбит/с   | 80 Мбит/с   | 200 Мбит/с   | 400 Мбит/с   |

Клиенты широковещательной рассылки, отправлять сообщения являются не более четырех. Они должны меньшее количество серверов приложений, по сравнению с **echo** так, как небольшой объем входящего сообщения. Два сервера приложений к ним относятся рекомендации соглашение об уровне ОБСЛУЖИВАНИЯ и производительности. Однако во избежание дисбаланс, особенно для Unit50 и Unit100 подключения сервера по умолчанию следует увеличить.

|   Трансляция      | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> Увеличьте подключения сервера по умолчанию от 5 до 40, на каждом сервере приложений, чтобы избежать возможных несбалансированное подключений к службе Azure SignalR.
>
> Номер соединения клиента, размер сообщения, скорость отправки сообщений и уровень SKU влияют на общую производительность для **вещания**.

#### <a name="send-to-group"></a>Отправить в группу

**Отправки группу** вариант использования имеет аналогичный шаблон для трафика **вещания**. Разница, что после клиенты устанавливают соединения WebSocket с помощью службы Azure SignalR, они должны присоединить группы перед отправкой сообщения для определенной группы. Следующая диаграмма иллюстрирует поток трафика.

![Трафик в случае использования группа отправки](./media/signalr-concept-performance/sendtogroup.png)

Член группы и число групп — два фактора, влияющих на производительность. Чтобы упростить анализ, мы определим два типа групп:

- **Небольшая группа**: Каждая группа имеет 10 подключений. Номер группы равен (max подключения count) / 10. Например, для Unit1, при наличии 1000 количества соединений, у нас есть 1000 / 10 = 100 групп.

- **Большой группы**: Номер группы всегда равно 10. Число участников группы равен (max подключения count) / 10. Например, для Unit1, если 1000 подключения применяется ограничение на число, то каждая группа имеет 1000 / 10 = 100 членов.

**Отправить в группу** обеспечивает маршрутизацию затрат на служба Azure SignalR, так как он должен найти целевые соединения в структуре распределенных данных. По мере отправки подключений повышения увеличивается стоимость.

##### <a name="small-group"></a>Небольшая группа

Цена маршрутной важен для отправки сообщения в несколько небольших групп. В настоящее время служба Azure SignalR реализация достигает маршрутизации граница стоимости в Unit50. Добавив дополнительные ЦП и памяти не поможет, поэтому не может улучшить Unit100 дальнейшего намеренно. Если вам требуется более входящей пропускной способности, обратитесь в службу поддержки.

|   Отправить небольшой группе     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50 | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|--------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000 | 100 000
| Число участников группы        | 10    | 10    | 10     | 10     | 10     | 10     | 10 
| Количество групп               | 100   | 200   | 500    | 1000  | 2 000  | 5 000  | 10 000 
| Входящих сообщений в секунду  | 200   | 400   | 1000  | 2500  | 4000  | 7000  | 7000   |
| Входящей пропускной способности  | 400 Кбит/с  | 800 Кбит/с  | 2 Мбит/с     | 5 Мбит/с     | 8 Мбит/с     | 14 Мбит/с    | 14 Мбит/с     |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 25 000 | 40 000 | 70,000 | 70,000  |
| Исходящей пропускной способности | 4 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 50 Мбит/с     | 80 Мбит/с    | 140 Мбит/с   | 140 Мбит/с    |

Многие клиентские подключения вызова концентратора, поэтому номер сервера приложений также критически важными для производительности. В следующей таблице перечислены счетчики server предлагаемых приложений.

|  Отправить небольшой группе   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Клиент подключения number, размер сообщения, скорость, маршрутизации затрат, уровень SKU и ЦП и памяти сервера приложений, отправляющим сообщения, влияют на общую производительность **отправки для небольшой группы**.

##### <a name="big-group"></a>Большие группы

Для **отправить большой группе**, пропускной способности исходящего канала станет узким местом, перед попадание маршрутизацию затрат ограничение. В следующей таблице перечислены максимальное исходящей пропускной способности, это почти то же самое, что и для **вещания**.

|    Отправить большой группе      | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000
| Число участников группы        | 100   | 200   | 500    | 1000  | 2 000  | 5 000   | 10 000 
| Количество групп               | 10    | 10    | 10     | 10     | 10     | 10      | 10
| Входящих сообщений в секунду  | 20    | 20    | 20     | 20     | 20     | 20      | 20      |
| Входящей пропускной способности  | 80 кбит/с   | 40 Кбит/с   | 40 Кбит/с    | 20 Кбит/с    | 40 Кбит/с    | 40 Кбит/с     | 40 Кбит/с     |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200,000 |
| Исходящей пропускной способности | 8 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 40 Мбит/с    | 80 Мбит/с    | 200 Мбит/с    | 400 Мбит/с    |

Отправка количество подключений — не более чем 40. Нагрузку на сервера приложений мал, чтобы максимально допустимое число веб-приложения мал.

|  Отправить большой группе  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

> [!NOTE]
> Увеличьте подключения сервера по умолчанию от 5 до 40, на каждом сервере приложений, чтобы избежать возможных несбалансированное подключений к службе Azure SignalR.
> 
> Номер соединения клиента, размер сообщения, скорости отправки сообщения, Цена маршрутной и уровень SKU влияют на общую производительность **отправить большой группе**.

#### <a name="send-to-connection"></a>Отправить подключения

В **отправку подключения** варианта использования, когда клиенты устанавливают подключения к службе Azure SignalR, каждый клиент вызывает специальный концентратора для получения идентификатора собственные подключения. В тесте производительности собирает все идентификаторы подключения, переставляет их и переназначает их ко всем клиентам в качестве отправляющего целевого объекта. Клиенты отправлять сообщения для подключения к целевой до завершения теста производительности.

![Трафик в случае использования send клиент](./media/signalr-concept-performance/sendtoclient.png)

Маршрутизацию затрат для **отправку подключения** аналогичен затраты для **отправки для небольшой группы**.

По мере увеличения числа подключений Цена маршрутной ограничивает общую производительность. Unit50 достигнут предел. Таким образом не может улучшить Unit100.

В следующей таблице приведен статистическую сводку по после многоэтапной выполнение **отправку подключения** теста производительности.

|   Отправить подключения   | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50          | Unit100         |
|------------------------------------|-------|-------|-------|--------|--------|-----------------|-----------------|
| Подключения                        | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000          | 100 000         |
| Входящие и исходящие сообщения в секунду | 1000 | 2 000 | 5 000 | 8000  | 9000  | 20 000 | 20 000 |
| Входящие и исходящие пропускной способности | 2 Мбит/с    | 4 Мбит/с    | 10 Мбит/с   | 16 Мбит/с    | 18 Мбит/с    | 40 Мбит/с       | 40 Мбит/с       |

Этот вариант использования требует высокой нагрузки на стороне сервера приложений. См. в разделе сервера приложений, предлагаемых подсчета в следующей таблице.

|  Отправить подключения  | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 3      | 3      | 10     | 20      |

> [!NOTE]
> Клиент подключения number, размер сообщения, сообщения, отправкой скорость, маршрутизации затрат, уровень SKU и ЦП и памяти для сервера приложений влияют на общую производительность **отправку подключения**.

#### <a name="aspnet-signalr-echo-broadcast-and-send-to-small-group"></a>Echo ASP.NET SignalR, вещания и отправки для небольшой группы

Служба Azure SignalR предоставляет такие же возможности производительности для ASP.NET SignalR. 

Тест производительности использует веб-приложения Azure из [стандартный S3 план службы](https://azure.microsoft.com/pricing/details/app-service/windows/) для ASP.NET SignalR.

В следующей таблице приведены число предлагаемых web app для ASP.NET SignalR **echo**.

|   echo           | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 4\.     | 4\.      | 8      | 32      | 40       |

В следующей таблице приведены число предлагаемых web app для ASP.NET SignalR **вещания**.

|  Трансляция       | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 2     | 2      | 2      | 2      | 2       |

В следующей таблице приведены число предлагаемых web app для ASP.NET SignalR **отправки для небольшой группы**.

|  Отправить небольшой группе     | Unit1 | Unit2 | Unit5 | Unit10 | Unit20 | Unit50 | Unit100 |
|------------------|-------|-------|-------|--------|--------|--------|---------|
| Подключения      | 1000 | 2 000 | 5 000 | 10 000 | 20 000 | 50 000 | 100 000 |
| Число серверов приложений | 2     | 2     | 4\.     | 4\.      | 8      | 32      | 40       |

### <a name="serverless-mode"></a>Режим без сервера

Клиенты и служба Azure SignalR участвуют в режиме без сервера. Каждый клиент — это одно подключение. Клиент отправляет сообщения через REST API для другого клиента или широковещательной передачи сообщений, ко всем.

Отправка сообщений с высокой плотностью через REST API не так эффективны, как с помощью WebSocket. Необходимо создать новое соединение HTTP каждый раз, и дополнительная плата за в режиме без сервера.

#### <a name="broadcast-through-rest-api"></a>Рассылка по REST API
Все клиенты устанавливают соединения WebSocket с помощью службы Azure SignalR. Некоторые клиенты запустите широковещательной рассылки с помощью REST API. Сообщения, отправкой (входящий трафик) — все это HTTP-Post, который не является эффективным по сравнению с WebSocket.

|   Рассылка по REST API     | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящих сообщений в секунду  | 2     | 2     | 2      | 2      | 2      | 2       | 2       |
| Исходящих сообщений в секунду | 2 000 | 4000 | 10 000 | 20 000 | 40 000 | 100 000 | 200,000 |
| Входящей пропускной способности  | 4 Кбит/с    | 4 Кбит/с    | 4 Кбит/с     | 4 Кбит/с     | 4 Кбит/с     | 4 Кбит/с      | 4 Кбит/с      |
| Исходящей пропускной способности | 4 Мбит/с    | 8 Мбит/с    | 20 Мбит/с    | 40 Мбит/с    | 80 Мбит/с    | 200 Мбит/с    | 400 Мбит/с    |

#### <a name="send-to-user-through-rest-api"></a>Отправить пользователю через REST API
Тест производительности присваивает имена пользователей для всех клиентов, до их запуска, подключения к службе Azure SignalR. После клиенты устанавливают соединения WebSocket с помощью службы Azure SignalR, они приступить к отправке сообщений через HTTP Post.

|   Отправить пользователю через REST API | Unit1 | Unit2 | Unit5  | Unit10 | Unit20 | Unit50  | Unit100 |
|---------------------------|-------|-------|--------|--------|--------|---------|---------|
| Подключения               | 1000 | 2 000 | 5 000  | 10 000 | 20 000 | 50 000  | 100 000 |
| Входящих сообщений в секунду  | 300   | 600   | 900    | 1,300  | 2 000  | 10 000  | 18,000  |
| Исходящих сообщений в секунду | 300   | 600   | 900    | 1,300  | 2 000  | 10 000  | 18,000 |
| Входящей пропускной способности  | 600 Кбит/с  | 1.2 Мбит/с  | 1.8 Мбит/с   | 2.6 Мбит/с   | 4 Мбит/с     | 10 Мбит/с     | 36 Мбит/с    |
| Исходящей пропускной способности | 600 Кбит/с  | 1.2 Мбит/с  | 1.8 Мбит/с   | 2.6 Мбит/с   | 4 Мбит/с     | 10 Мбит/с     | 36 Мбит/с    |

## <a name="performance-test-environments"></a>Среды для тестирования производительности

Для всех вариантов, перечисленных выше использования, мы провели тесты производительности в среде Azure. Более того мы использовали 50 виртуальных машин клиента и 20 виртуальных машин сервера приложений. Ниже приведены некоторые сведения.

- Размер виртуальной Машины клиента: StandardDS2V2 (2 виртуальных ЦП, память 7G)

- Размер виртуальной Машины сервера приложений: StandardF4sV2 (4 виртуальных ЦП, памяти 8G)

- Подключения сервера Azure SignalR SDK: 15

## <a name="performance-tools"></a>Средства повышения производительности

Средства производительности для службы SignalR Azure можно найти на [GitHub](https://github.com/Azure/azure-signalr-bench/tree/master/SignalRServiceBenchmarkPlugin).

## <a name="next-steps"></a>Дальнейшие действия

В этой статье вы получили Обзор производительности служба Azure SignalR в типичных сценариях использования.

Получить сведения о внутренних компонентов службы, а также масштабирование для него, см. следующие руководства:

* [Azure SignalR Service internals](signalr-concept-internals.md) (Внутренние компоненты Службы Azure SignalR)
* [Служба Azure SignalR масштабирование](signalr-howto-scale-multi-instances.md)
