---
title: Управляемые удостоверения в службе Azure SignalR
description: Узнайте, как управляемые удостоверения работают в службе Azure SignalR и как использовать управляемое удостоверение в бессерверных сценариях.
author: chenyl
ms.service: signalr
ms.topic: article
ms.date: 06/8/2020
ms.author: chenyl
ms.openlocfilehash: abe7503e7eb73d533ae901af21de001960173fb0
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85559412"
---
# <a name="managed-identities-for-azure-signalr-service"></a>Управляемые удостоверения для службы Azure SignalR

В этой статье показано, как создать управляемое удостоверение для службы Azure SignalR и как использовать его в бессерверных сценариях.

> [!Important] 
> Служба Azure SignalR может поддерживать только одно управляемое удостоверение. Это означает, что можно добавить либо назначенное системой удостоверение, либо пользовательское удостоверение. 

## <a name="add-a-system-assigned-identity"></a>Добавление назначаемого системой удостоверения

Чтобы настроить управляемое удостоверение в портал Azure, сначала создайте экземпляр службы Azure SignalR, а затем включите эту функцию.

1. Создайте экземпляр службы Azure SignalR на портале, как обычно. Перейдите к нему на портале.

2. Выберите **Удостоверение**.

4. На вкладке **назначенная система** переключите **состояние** **на вкл**. Нажмите кнопку **Сохранить**.

    :::image type="content" source="media/signalr-howto-use-managed-identity/system-identity-portal.png" alt-text="Добавление назначенного системой удостоверения на портале":::

## <a name="add-a-user-assigned-identity"></a>Добавление назначаемого пользователем удостоверения

Для создания экземпляра службы Azure SignalR с назначенным пользователем удостоверением необходимо создать удостоверение, а затем добавить его идентификатор ресурса в службу.

1. Создайте ресурс назначаемого пользователем управляемого удостоверения в соответствии с [этими инструкциями](../active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal.md#create-a-user-assigned-managed-identity).

2. Создайте экземпляр службы Azure SignalR на портале, как обычно. Перейдите к нему на портале.

3. Выберите **Удостоверение**.

4. На вкладке **Назначенные пользователи** выберите **Добавить**.

5. Найдите созданное ранее удостоверение и выберите его. Выберите **Добавить**.

    :::image type="content" source="media/signalr-howto-use-managed-identity/user-identity-portal.png" alt-text="Добавление назначенного пользователем удостоверения на портале":::

## <a name="use-a-managed-identity-in-serverless-scenarios"></a>Использование управляемого удостоверения в бессерверных сценариях

Служба Azure SignalR — это полностью управляемая служба, поэтому вы не можете использовать управляемое удостоверение для получения маркеров вручную. Вместо этого служба Azure SignalR использует управляемое удостоверение, заданное для получения маркера доступа. Затем служба устанавливает маркер доступа в `Authorization` заголовок вышестоящего запроса в бессерверных сценариях.

### <a name="enable-managed-identity-authentication-in-upstream-settings"></a>Включение проверки подлинности управляемого удостоверения в параметрах вышестоящего

1. Добавьте удостоверение, назначенное системой, или пользовательское удостоверение.

2. Настройте параметры восходящего потока и используйте **ManagedIdentity** в качестве параметров **проверки подлинности** . Сведения о создании вышестоящего параметра с проверкой подлинности см. в статье [Параметры вышестоящей](concept-upstream.md)передачи.

3. В параметрах аутентификации управляемого удостоверения для **ресурса**можно указать целевой ресурс. Ресурс станет `aud` утверждением в полученном маркере доступа, который можно использовать в качестве части проверки в вышестоящей конечной точки. Ресурс может быть одним из следующих:
    - Empty
    - Идентификатор приложения (клиента) субъекта-службы
    - URI идентификатора приложения субъекта-службы
    - [Идентификатор ресурса службы Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities#azure-services-that-support-azure-ad-authentication)

    > [!NOTE]
    > При проверке маркера доступа в службе вы можете выбрать любой из форматов ресурсов. Просто убедитесь, что значение **ресурса** в параметрах **проверки подлинности** и проверка являются одинаковыми. Если для плоскости данных используется управление доступом на основе ролей (RBAC), необходимо использовать ресурс, запрашиваемый поставщиком услуг.

### <a name="validate-access-tokens"></a>Проверка маркеров доступа

Маркер в `Authorization` заголовке — это [маркер доступа платформы удостоверений (Майкрософт](https://docs.microsoft.com/azure/active-directory/develop/access-tokens#validating-tokens)).

Чтобы проверить маркеры доступа, приложение должно также проверить аудиторию и маркеры подписывания. Они должны проверяться на соответствие значениям в документе обнаружения OpenID. Например, см. [версию документа, не зависящую от клиента](https://login.microsoftonline.com/common/.well-known/openid-configuration).

По промежуточного слоя Azure Active Directory (Azure AD) имеет встроенные возможности проверки маркеров доступа. Вы можете просмотреть наши [примеры](https://docs.microsoft.com/azure/active-directory/develop/sample-v2-code) , чтобы найти их на выбранном языке.

Мы предоставляем библиотеки и примеры кода, демонстрирующие способы проверки маркеров. Кроме того, для проверки JSON Web Token (JWT) доступны несколько библиотек партнеров с открытым кодом. Существует по крайней мере один вариант почти для каждой платформы и языка. Дополнительные сведения о библиотеках проверки подлинности Azure AD и примеры кода см. в [статье библиотеки проверки подлинности платформы Microsoft Identity](https://docs.microsoft.com/azure/active-directory/develop/reference-v2-libraries).

## <a name="next-steps"></a>Дальнейшие шаги

- [Azure Functions development and configuration with Azure SignalR Service](signalr-concept-serverless-development-config.md) (Разработка и настройка функций Azure с помощью Службы Azure SignalR)
