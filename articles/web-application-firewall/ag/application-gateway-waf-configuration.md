---
title: Предельный размер запросов брандмауэра веб-приложения и списки исключений в Шлюзе приложений Azure — портал Azure
description: В этой статье содержится информация об ограничениях размера запроса веб-приложений firewall и конфигурации списков исключений в шлюзе приложений с порталом Azure.
services: web-application-firewall
author: vhorne
ms.service: web-application-firewall
ms.date: 02/20/2020
ms.author: victorh
ms.topic: conceptual
ms.openlocfilehash: 7244788bbc7431c7f26363b2852babb72d5697e9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "77526796"
---
# <a name="web-application-firewall-request-size-limits-and-exclusion-lists"></a>Ограничения размера запроса веб-приложений и списки исключений

Брандмауэр Web Application Firewall Azure Application Gateway Web Application (WAF) обеспечивает защиту веб-приложений. В этой статье описывается настройка предельного размера запросов WAF и списков исключений. Эти параметры расположены в политике WAF, связанной с вашим шлюзом приложений. Чтобы узнать больше о политике WAF, [см.](ag-overview.md) [Create Web Application Firewall policies for Application Gateway](create-waf-policy-ag.md)

## <a name="waf-exclusion-lists"></a>Списки исключений WAF

![Предельный размер запросов](../media/application-gateway-waf-configuration/waf-policy.png)

Списки исключений WAF позволяют пропустить некоторые атрибуты запроса при проверке WAF. Распространенный пример — вставленные токены Active Directory, которые используются для проверки подлинности или полей пароля. Такие атрибуты часто могут содержать специальные символы, которые активируют ложные срабатывания правил WAF. После добавления атрибута в список исключений WAF он не учитывается ни одним настроенным и активным правилом WAF. Списки исключений применяются глобально.

Следующие атрибуты могут быть добавлены в списки исключений по имени. Значения выбранного поля не оцениваются в правилах WAF, но их имена все еще есть (см. Пример 1 ниже, значение заголовка пользователя-агента исключено из оценки WAF). Списки исключений устраняют проверку стоимости поля.

* Заголовки запросов
* Объекты cookie запросов
* Имя атрибута запроса (args) может быть добавлено в качестве элемента исключения, такого как:

   * Название поля формы
   * Сущность XML
   * Лицо JSON
   * Строка запроса URL-адреса args

Вы можете указать точное соответствие заголовка запроса, текста, файла cookie или атрибута строки запроса.  Либо при необходимости вы можете задать частичное соответствие. Правила исключения являются глобальными в области и применяются ко всем страницам и всем правилам.

Поддерживаемые операторы критериев соответствия:

- **Equals**: этот оператор используется для точного совпадения. Например, для выбора заголовка с именем **bearerToken** используйте оператор равенства со значением селектора **bearerToken**.
- **Starts with**: этот оператор находит все поля, которые начинаются с указанного значения селектора.
- **Ends with**: этот оператор находит все поля запроса, заканчивающиеся на указанное значение селектора.
- **Contains**: этот оператор находит все поля запроса, которые содержат указанное значение селектора.
- **Равно любой**: Этот оператор соответствует всем полям запроса. Значение селектора будет значением селектора.

Во всех случаях при поиске не учитывается регистр, и в качестве селекторов запрещено использовать регулярные выражения.

> [!NOTE]
> Для получения дополнительной информации [WAF troubleshooting](web-application-firewall-troubleshoot.md)и устранения неполадок см.

### <a name="examples"></a>Примеры

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]

Следующие примеры свидетельствуют об использовании исключений.

#### <a name="example-1"></a>Пример 1

В этом примере необходимо исключить заголовок пользователя-агента. Заголовок запроса пользователя-агента содержит характерную строку, которая позволяет коллегам по сетевому протоколу идентифицировать тип приложения, операционную систему, поставщика программного обеспечения или версию программного обеспечения запрашивающего агента пользователя программного обеспечения. Для получения дополнительной информации [см.](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent)

Может быть множество причин, чтобы отключить оценку этого заголовка. Там может быть строка, что WAF видит и предполагает, что это вредоносный. Например, классическая атака S'L "x'x" в строке. В некоторых случаях это может быть законным трафиком. Таким образом, возможно, потребуется исключить этот заголовок из оценки WAF.

Следующий cmdlet Azure PowerShell исключает заголовок пользователя-агента из оценки:

```azurepowershell
$exclusion1 = New-AzApplicationGatewayFirewallExclusionConfig `
   -MatchVariable "RequestHeaderNames" `
   -SelectorMatchOperator "Equals" `
   -Selector "User-Agent"
```
#### <a name="example-2"></a>Пример 2

Этот пример исключает значение в параметре *пользователя,* которое передается в запросе через URL. Например, можно сказать, что в поле пользователя обычно содержитстроко, которое просматривает WAF как вредоносное содержимое, поэтому оно блокирует его.  В этом случае можно исключить пользовательский параметр, чтобы WAF ничего не оценивал в поле.

Следующий cmdlet Azure PowerShell исключает пользовательский параметр из оценки:

```azurepowershell
$exclusion2 = New-AzApplicationGatewayFirewallExclusionConfig `
   -MatchVariable "RequestArgNames" `
   -SelectorMatchOperator "StartsWith" `
   -Selector "user"
```
Так что, `http://www.contoso.com/?user%281%29=fdafdasfda` если URL передается в WAF, он не будет оценивать строку **fdafdasfda**, но он будет по-прежнему оценивать имя параметра **пользователя%281%29**. 

## <a name="waf-request-size-limits"></a>Предельный размер запросов WAF



Брандмауэр веб-приложения позволяет настроить предельный размер запроса с нижней и верхней границей. Доступны следующие две конфигурации предельного размера:

- Максимальное поле размера тела запроса указывается в килобайтах и контролирует общий предел размера запроса, исключая любые загрузки файлов. Значение поля может варьироваться от 1 КБ (минимум) до 128 КБ (максимум). Значение по умолчанию — 128 КБ.
- Поле "Предельный размер отправки файла" указывается в МБ и определяет максимальный размер отправки файла. Это поле может иметь минимальное значение 1 МБ и следующие максимумы:

   - 100 МБ для v1 Средние WAF шлюзы
   - 500 МБ для v1 Большие шлюзы WAF
   - 750 МБ для v2 WAF шлюзы 

 Значение по умолчанию — 100 МБ.

WAF также позволяет настроить ручку, включающую и отключающую проверку текста запроса. По умолчанию проверка включена. Если проверка тела запроса отключена, WAF не оценивает содержимое тела сообщений HTTP. В таких случаях WAF продолжит применять свои правила к заголовкам, файлам cookie и URI. Если проверка текста запроса отключена, то поле максимального размера текста запроса будет неприменимо и его невозможно будет настроить. Отключение проверки текста запроса позволяет отправлять в брандмауэр веб-приложения сообщения, длина которых превышает 128 Кбайт, но текст сообщения не проверяется на наличие уязвимостей.

## <a name="next-steps"></a>Дальнейшие действия

После настройки параметров WAF вы можете узнать, как просматривать журналы WAF. Для получения дополнительной [информации](../../application-gateway/application-gateway-diagnostics.md#diagnostic-logging)см.
