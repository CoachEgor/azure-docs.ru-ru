---
title: Копирование данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения с помощью Фабрики данных Azure
description: Использование Фабрики данных Azure для копирования данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 05/13/2019
ms.author: jingwang
ms.openlocfilehash: d6e09ec1f070f9ee0f4162524e4bd80d1f81adc3
ms.sourcegitcommit: 179918af242d52664d3274370c6fdaec6c783eb6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2019
ms.locfileid: "65560640"
---
# <a name="copy-data-from-azure-data-lake-storage-gen1-to-gen2-with-azure-data-factory"></a>Копирование данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения с помощью Фабрики данных Azure

Azure Data Lake Storage 2-го поколения — это набор возможностей аналитики больших данных, созданных на основе [хранилища BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md). Она позволяет работать с данными с использованием как файловой системы, так и парадигмы хранения объектов.

Если вы используете Azure Data Lake Storage 1-го поколения, оцените новые возможности 2-го поколения, скопировав данные из Data Lake Storage 1-го поколения в Data Lake Storage 2-го поколения с помощью Фабрики данных Azure.

Фабрика данных Azure — это полностью управляемая облачная служба интеграции данных. Эту службу можно использовать для заполнения озера данными из богатого набора локальных и облачных хранилищ данных и экономии времени при создании аналитических решений. Дополнительные сведения о поддерживаемых соединителях, см. в таблице [Поддерживаемые хранилища данных и форматы](copy-activity-overview.md#supported-data-stores-and-formats).

Фабрика данных Azure предлагает масштабируемое и управляемое решение для перемещения данных. Благодаря архитектуре горизонтального масштабирования ADF, фабрика данных Azure может использовать высокую пропускную способность для приема данных. Дополнительные сведения см. в руководстве [по настройке производительности действия копирования](copy-activity-performance.md).

В этой статье показано, как с помощью средства копирования данных службы "Фабрика данных" скопировать данные из _Azure Data Lake Storage 1-го поколения_ в _Azure Data Lake Storage 2-го поколения_. Чтобы копировать данные из других типов хранилищ, необходимо выполнить аналогичные шаги.

## <a name="prerequisites"></a>Технические условия

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Учетная запись Azure Data Lake Storage 1-го поколения с сохраненными в ней данными.
* Учетная запись хранения Azure с поддержкой Data Lake Storage 2-го поколения. Если у вас нет учетной записи хранения [создать учетную запись](https://ms.portal.azure.com/#create/Microsoft.StorageAccount-ARM).

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В меню слева выберите **Создать ресурс** > **Данные и аналитика** > **Фабрика данных**.
   
   ![Выбор фабрики данных в области "Создать"](./media/quickstart-create-data-factory-portal/new-azure-data-factory-menu.png)

2. В полях на странице **Новая фабрика данных** задайте значения, как показано на следующем изображении: 
      
   ![Страница "Новая фабрика данных"](./media/load-azure-data-lake-storage-gen2-from-gen1/new-azure-data-factory.png)
 
    * **Имя.** Введите глобальное уникальное имя фабрики данных Azure. Если отобразится сообщение об ошибке "Имя \"LoadADLSDemo\" фабрики данных недоступно", введите другое имя. Например, вы можете использовать имя _**ваше_имя**_**ADFTutorialDataFactory**. Попробуйте создать фабрику данных еще раз. Правила именования артефактов службы "Фабрика данных" см. в [этой](naming-rules.md) статье.
    * **Подписка**: Выберите подписку Azure, в рамках которой нужно создать фабрику данных. 
    * **Группа ресурсов.** Выберите существующую группу ресурсов из раскрывающегося списка или щелкните вариант **Создать новую** и введите имя группы ресурсов. Сведения о группах ресурсов см. в статье, где описывается [использование групп ресурсов для управления ресурсами Azure](../azure-resource-manager/resource-group-overview.md).  
    * **Версия.** Выберите **V2**.
    * **Расположение.** Укажите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных, используемые в фабрике данных, могут находиться в других расположениях и регионах. 

3. Нажмите кнопку **Создать**.
4. После создания перейдите к фабрике данных. Вы увидите домашнюю страницу **фабрики данных**, как показано на следующем изображении: 
   
   ![Домашняя страница фабрики данных](./media/load-azure-data-lake-storage-gen2-from-gen1/data-factory-home-page.png)

   Выберите плитку **Создание и мониторинг**, чтобы открыть на отдельной вкладке приложение интеграции данных.

## <a name="load-data-into-azure-data-lake-storage-gen2"></a>Загрузка данных в Azure Data Lake Storage Gen2

1. Чтобы запустить средство копирования данных, на странице **Get started** (Начало работы) выберите плитку **Copy Data** (Копирование данных): 

   ![Плитка средства копирования данных](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-tile.png)
2. На странице **Properties** (Свойства) укажите **CopyFromADLSGen1ToGen2** в поле **Task name** (Имя задачи) и выберите **Далее**.

    ![Страница свойств](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-properties-page.png)
3. На странице **Исходное хранилище данных** щелкните **Создать новое подключение**.

    ![Страница исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page.png)
    
    В коллекции соединителя выберите **Azure Data Lake Storage 1-го поколения** и щелкните **Продолжить**.
    
    ![Страница настройки Azure Data Lake Storage 1-го поколения в качестве исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page-adls-gen1.png)
    
4. На **странице подключения к Azure Data Lake Storage 1-го поколения** выполните следующие действия.
   1. Выберите имя учетной записи Data Lake Storage 1-го поколения и укажите или подтвердите имя **клиента**.
   2. Щелкните **Проверить подключение**, чтобы проверить настройки, а затем нажмите кнопку **Готово**.
   3. Появится новое соединение. Щелкните **Далее**.
   
   > [!IMPORTANT]
   > В этом руководстве вы используете управляемое удостоверение для ресурсов Azure для аутентификации в Data Lake Storage 1-го поколения. Не забудьте предоставить Управляемому удостоверению службы соответствующие разрешения в Azure Data Lake Storage 1-го поколения, выполнив [эти инструкции](connector-azure-data-lake-store.md#managed-identity).
   
   ![Выбор учетной записи Data Lake Storage 1-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen1-account.png)
      
5. На странице **Choose the input file or folder** (Выбор файла или папки входных данных) перейдите в папку и файл, которые необходимо скопировать. Чтобы выбрать папку или файл, нажмите кнопку **Выбрать**.

    ![Выбор файла или папки входных данных](./media/load-azure-data-lake-storage-gen2-from-gen1/choose-input-folder.png)

6. Укажите поведение копирования, установив параметры **Copy files recursively** (Копировать файлы рекурсивно) и **Binary copy** (Двоичное копирование). Нажмите кнопку **Далее**:

    ![Укажите выходную папку.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-binary-copy.png)
    
7. На странице **Целевое хранилище данных** щелкните **+ Создать подключение**, а затем выберите **Azure Data Lake Storage 2-го поколения** и щелкните **Продолжить**.

    ![Страница целевого хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/destination-data-storage-page.png)

8. На **странице подключения к Azure Data Lake Storage 2-го поколения** выполните следующие действия.

   1. Из раскрывающегося списка "Имя учетной записи хранения" выберите соответствующую учетную запись Data Lake Storage Gen2.
   2. Выберите **Готово**, чтобы создать подключение. Затем нажмите кнопку **Далее**.
   
   ![Выбор учетной записи Data Lake Storage 2-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-account.png)

9. В **Выбор выходного файла или папки** введите **copyfromadlsgen1** качестве имя выходной папки, а затем выберите **Далее**. ADF создаст соответствующие ADLS Gen2 файловой системы и вложенные папки во время копирования, если он не существует.

    ![Укажите выходную папку.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-path.png)

10. На странице **Параметры** нажмите кнопку **Далее**, подтверждая использование параметров по умолчанию.

11. Просмотрите параметры на странице **Summary** (Сводка), а затем нажмите кнопку **Далее**.

    ![Страница "Сводка"](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-summary.png)
12. Чтобы отслеживать конвейер, на **странице развертывания** выберите **Монитор**.

    ![Страница развертывания](./media/load-azure-data-lake-storage-gen2-from-gen1/deployment-page.png)
13. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. В столбце **Actions** (Действия) содержатся ссылки на сведения о выполнении действий или повторный запуск конвейера:

    ![Мониторинг выполнений конвейера](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-pipeline-runs.png)

14. Щелкните ссылку **View Activity Runs** (Просмотр выполнений действий) в столбце **Actions** (Действия), чтобы просмотреть выполнения действий, связанные с этим запуском конвейера. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению запусков конвейера, щелкните ссылку **Конвейеры** в верхней части окна. Щелкните **Обновить**, чтобы обновить список. 

    ![Мониторинг выполнений действий](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-runs.png)

15. Чтобы отслеживать сведения о выполнении каждого действия копирования, щелкните ссылку **Сведения** (изображение очков) в разделе **Действия** в представлении мониторинга действия. Вы можете отслеживать такие сведения, как объем данных, копируемых из источника в приемник, пропускная способность данных, шаги выполнения с длительностью и используемые параметры:

    ![Мониторинг сведений о выполнении действия](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-run-details.png)

16. Убедитесь, что данные скопированы в Data Lake Storage Gen2.

## <a name="best-practices"></a>Рекомендации

Оценка обновления Gen1 хранилища Озера данных Azure (ADLS) до 2-го поколения в целом, см. в статье [обновления решений аналитики больших данных Gen1 хранилища Озера данных Azure до Gen2 хранилища Озера данных Azure](../storage/blobs/data-lake-storage-upgrade.md). В следующих разделах представлены рекомендации, с помощью фабрики данных AZURE для обновления данных из поколение 1 на уровень Gen2.

### <a name="data-partition-for-historical-data-copy"></a>Секции данных для копирования исторических данных

- Если размер общего объема данных в ADLS Gen1 меньше, чем **30 ТБ** и число файлов меньше, чем **1 миллион**, вы можете копировать все данные одного выполнения действия копирования.
- Если у вас есть больший размер данных для копирования или требуется возможность переноса данных в пакетах управления и каждый из них завершены в течение определенного времени windows, предлагаются для секционирования данных, в противном случае он также может снизить риск все непредвиденные iss UE.

Чтобы проверить сквозное решение и проверить пропускную способность копирования в вашей среде настоятельно рекомендуется (подтверждение концепции) для подтверждения концепции. Основные шаги выполнения PoC: 

1. Создать один конвейер ADF с помощью отдельного действия копирования для копирования нескольких терабайтов данных из ADLS Gen1 Gen2 ADLS, чтобы получить базовые показатели производительности копирования, начиная с [единицы интеграции данных (DIUs)](copy-activity-performance.md#data-integration-units) как 128. 
2. Учитывая пропускную способность копирования, полученный на шаге #1, вычислить предполагаемое время, требуемое для миграции данных. 
3. (Необязательно) Создайте таблицу элемента управления и определите фильтр файлов, чтобы файлы переносимых разделов. Способ секционирования файлов следующими способами: 

    - Имя папки или имя папки разбитый на фильтр с подстановочными знаками (рекомендуется) 
    - Секционированные по времени последнего изменения файла 

### <a name="network-bandwidth-and-storage-io"></a>Сетевой пропускной способности и хранилища ввода-вывода 

Параллелизм заданий копирования фабрики данных AZURE, которые считывать данные из ADLS Gen1 и записывать данные на уровень Gen2 ADLS, можно управлять так, что использование на ввод-вывод хранилища можно управлять, чтобы не влиять на работу обычного рабочего в поколение 1 ADLS во время миграции.

### <a name="permissions"></a>Разрешения 

В фабрике данных [ADLS Gen1 соединитель](connector-azure-data-lake-store.md) поддерживает субъект-служба и управляемое удостоверение для проверки подлинности ресурсов Azure; [ADLS Gen2 соединитель](connector-azure-data-lake-storage.md) ключ, учетной записи поддерживает, субъект-служба и управляемое удостоверение для проверки подлинности ресурсов Azure. Чтобы возможности перехода фабрики данных и скопировать все файлы/ACL потребуется, убедитесь, что вы высокого предоставили достаточно разрешений для учетной записи нужно предоставить доступ, чтение и запись всех файлов и настройка списков управления доступом в том случае, если вы решили. Предложите пользователю предоставлять его super пользователя или владельца роли во время миграции. 

### <a name="preserve-acls-from-data-lake-storage-gen1"></a>Сохраняет списки управления доступом из Gen1 хранилища Озера данных

Если вы хотите реплицировать списки управления доступом, а также файлов данных при обновлении до 2-го поколения Gen1 хранилища Озера данных, см. раздел [сохранить списки управления доступом из Gen1 хранилища Озера данных](connector-azure-data-lake-storage.md#preserve-acls-from-data-lake-storage-gen1). 

### <a name="incremental-copy"></a>Добавочное копирование 

Несколько подходов можно использовать для загрузки только новых или обновленных файлов из ADLS Gen1:

- Загрузить новые или обновленные файлы времени секционированных папке или имя файла, например/2019/05/13 / *;
- Загрузить новые или обновленные файлы, Дата последнего изменения;
- Определить новые или обновленные файлы с любого стороннего средства и решения, а затем передайте имя файла или папки в конвейер ADF с помощью параметра или таблицу или файл.  

Правильное частота проводить добавочную загрузку, зависит от того, общее число файлов в ADLS Gen1 и объем новых или обновленных загружаемый файл каждый раз.  

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Об обзоре действия копирования](copy-activity-overview.md)
> [соединитель Gen1 хранилища Озера данных Azure](connector-azure-data-lake-store.md)
> [соединитель Gen2 хранилища Озера данных Azure](connector-azure-data-lake-storage.md)