---
title: Копирование данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения с помощью Фабрики данных Azure
description: Использование Фабрики данных Azure для копирования данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 05/13/2019
ms.author: jingwang
ms.openlocfilehash: d13dad6e87bd6c821b497138ad75d7ae2b9a052d
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67068977"
---
# <a name="copy-data-from-azure-data-lake-storage-gen1-to-gen2-with-azure-data-factory"></a>Копирование данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения с помощью Фабрики данных Azure

Azure Data Lake хранения 2-го поколения — это набор возможностей, предназначенный для анализа больших данных, который встроен в [хранилище BLOB-объектов Azure](../storage/blobs/storage-blobs-introduction.md). Его можно использовать для взаимодействия с данными с помощью обоих парадигм файл системы и объект хранилища.

Если вы сейчас используете Gen1 хранилища Озера данных Azure, вы можете оценить Gen2 хранилища Озера данных Azure путем копирования данных из Gen1 хранилища Озера данных в 2-го поколения с помощью фабрики данных Azure.

Фабрика данных Azure — это полностью управляемая облачная служба интеграции данных. Службу можно использовать для заполнения Озера данными из широкий набор локальных и облачных данных, хранит и сэкономить время при построении решений аналитики. Список поддерживаемых соединителей, см. в таблице из [поддерживаемых хранилищ данных](copy-activity-overview.md#supported-data-stores-and-formats).

Фабрика данных Azure предлагает масштабируемое и управляемое решение для перемещения данных. Из-за горизонтально масштабируемой архитектуры фабрики данных он может принимать данные с высокой пропускной способностью. Дополнительные сведения см. в разделе [настройке производительности действия копирования](copy-activity-performance.md).

В этой статье показано, как с помощью средства копирования данных фабрики данных копировать данные из Gen1 хранилища Озера данных Azure в Gen2 хранилища Озера данных Azure. Чтобы копировать данные из других типов хранилищ, необходимо выполнить аналогичные шаги.

## <a name="prerequisites"></a>Технические условия

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись Azure](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Учетная запись Azure Data Lake Storage 1-го поколения с сохраненными в ней данными.
* Учетная запись хранения Azure с уровня Gen2 хранилища Озера данных включена. Если у вас нет учетной записи хранения [создать учетную запись](https://ms.portal.azure.com/#create/Microsoft.StorageAccount-ARM).

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В меню слева, выберите **создать ресурс** > **данные и аналитика** > **фабрики данных**.
   
   ![Выбор фабрики данных в новой области](./media/quickstart-create-data-factory-portal/new-azure-data-factory-menu.png)

2. На **новая фабрика данных** странице, укажите значения для поля, показанные на следующем рисунке: 
      
   ![Новая страница фабрики данных](./media/load-azure-data-lake-storage-gen2-from-gen1/new-azure-data-factory.png)
 
    * **Имя.** Введите глобальное уникальное имя фабрики данных Azure. Если отобразится сообщение об ошибке "Имя \"LoadADLSDemo\" фабрики данных недоступно", введите другое имя. Например, _**ваше_имя**_ **ADFTutorialDataFactory**. Снова создайте фабрику данных. Правила именования артефактов службы "Фабрика данных" см. в [этой](naming-rules.md) статье.
    * **Подписка**: Выберите подписку Azure, в рамках которой нужно создать фабрику данных. 
    * **Группа ресурсов**. Выберите существующую группу ресурсов из раскрывающегося списка. Можно также выбрать **создать** параметр и введите имя группы ресурсов. Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/resource-group-overview.md). 
    * **Версия.** Выберите **V2**.
    * **Расположение.** Укажите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. В других расположениях и регионах можно хранилищах данных, используемые фабрикой данных. 

3. Нажмите кнопку **Создать**.
4. После завершения создания перейдите к фабрике данных. Вы увидите домашнюю страницу **фабрики данных**, как показано на следующем изображении: 
   
   ![Домашняя страница фабрики данных](./media/load-azure-data-lake-storage-gen2-from-gen1/data-factory-home-page.png)

5. Выберите **Создание и мониторинг** плитку, чтобы запустить на отдельной вкладке приложение интеграции данных.

## <a name="load-data-into-azure-data-lake-storage-gen2"></a>Загрузка данных в Azure Data Lake Storage Gen2

1. На **приступить к работе** выберите **копирования данных** плитку, чтобы запустить средство копирования данных. 

   ![Плитка средства копирования данных](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-tile.png)
2. На **свойства** , определите **CopyFromADLSGen1ToGen2** для **имя задачи** поля. Щелкните **Далее**.

    ![Страница свойств](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-properties-page.png)
3. На **исходного хранилища данных** выберите **+ создать новое соединение**.

    ![Страница исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page.png)
    
4. Выберите **Gen1 хранилища Озера данных Azure** из коллекции соединителя и выберите **Продолжить**.
    
    ![Страница настройки Azure Data Lake Storage 1-го поколения в качестве исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page-adls-gen1.png)
    
5. На **подключения укажите Azure Data Lake хранилища поколение 1** странице, выполните следующие действия:

   a. Выберите имя учетной записи Data Lake Storage 1-го поколения и укажите или подтвердите имя **клиента**.
  
   2\. Выберите **Проверка соединения** для проверки параметров. Затем нажмите кнопку **Готово**.
  
   c. Вы увидите, что был создан новое соединение. Щелкните **Далее**.
   
   > [!IMPORTANT]
   > В этом пошаговом руководстве использовать управляемое удостоверение для ресурсов Azure для проверки подлинности вашего Gen1 хранилища Озера данных Azure. Чтобы предоставить управляемому удостоверению соответствующие разрешения в Gen1 хранилища Озера данных Azure, выполните [эти инструкции](connector-azure-data-lake-store.md#managed-identity).
   
   ![Выбор учетной записи Data Lake Storage 1-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen1-account.png)
      
6. На **Выбор входного файла или папки** странице, перейдите в папку и файл, который требуется скопировать. Выберите файл или папку и выберите **Выбор**.

    ![Выбор файла или папки входных данных](./media/load-azure-data-lake-storage-gen2-from-gen1/choose-input-folder.png)

7. Укажите поведение копирования, выбрав **копировать файлы рекурсивно** и **двоичное копирование** параметры. Щелкните **Далее**.

    ![Укажите выходную папку.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-binary-copy.png)
    
8. На **целевое хранилище данных** выберите **+ создать новое соединение** > **Gen2 хранилища Озера данных Azure**  >   **По-прежнему**.

    ![Страница целевого хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/destination-data-storage-page.png)

9. На **подключения укажите Azure Data Lake хранения 2-го поколения** странице, выполните следующие действия:

   a. Выберите свою учетную запись может Gen2 хранилища Озера данных из **имя учетной записи хранения** стрелку раскрывающегося списка.
   
   2\. Выберите **Готово**, чтобы создать подключение. Затем нажмите кнопку **Далее**.
   
   ![Выбор учетной записи Data Lake Storage 2-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-account.png)

10. На **Выбор выходного файла или папки** введите **copyfromadlsgen1** качестве имя выходной папки, а затем выберите **Далее**. Фабрика данных создает соответствующий Gen2 хранилища Озера данных Azure файловой системы и вложенные папки во время копирования, если они не существуют.

    ![Укажите выходную папку.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-path.png)

11. На **параметры** выберите **Далее** использовать параметры по умолчанию.

12. На **Сводка** странице просмотрите параметры и выберите **Далее**.

    ![Страница "Сводка"](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-summary.png)
13. На **страницу развертывания**выберите **монитор** для мониторинга конвейера.

    ![Страница развертывания](./media/load-azure-data-lake-storage-gen2-from-gen1/deployment-page.png)
14. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. В столбце **действий** отображаются ссылки для просмотра сведений о запусках действий и (или) повторного выполнения на конвейере.

    ![Мониторинг выполнений конвейера](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-pipeline-runs.png)

15. Щелкните ссылку **View Activity Runs** (Просмотр выполнений действий) в столбце **Actions** (Действия), чтобы просмотреть выполнения действий, связанные с этим запуском конвейера. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению запусков конвейера, щелкните ссылку **Конвейеры** в верхней части окна. Щелкните **Обновить**, чтобы обновить список. 

    ![Мониторинг выполнений действий](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-runs.png)

16. Чтобы отслеживать сведения о выполнении каждого действия копирования, щелкните ссылку **Сведения** (изображение очков) в разделе **Действия** в представлении мониторинга действия. Можно отслеживать сведения, такие как объем данных, скопированных из источника в приемник, пропускная способность, шаги выполнения с длительностью и используемые параметры.

    ![Мониторинг сведений о выполнении действия](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-run-details.png)

17. Убедитесь, что данные скопированы в учетную запись Gen2 хранилища Озера данных Azure.

## <a name="best-practices"></a>Рекомендации

Чтобы оценить, обновление Gen1 хранилища Озера данных Azure до Gen2 хранилища Озера данных Azure в целом, см. в разделе [обновления решений аналитики больших данных Gen1 хранилища Озера данных Azure до Gen2 хранилища Озера данных Azure](../storage/blobs/data-lake-storage-upgrade.md). В следующих разделах представлены рекомендации по использованию фабрики данных для обновления данных из Gen1 хранилища Озера данных на уровень Gen2 хранилища Озера данных.

### <a name="data-partition-for-historical-data-copy"></a>Секции данных для копирования исторических данных

- Если количество файлов не меньше 1 миллиона ваш общий объем данных в поколение 1 хранилища Озера данных — менее 30 ТБ, можно скопировать все данные в выполнения отдельного действия копирования.
- Если у вас есть больший объем данных для копирования или необходима гибкость для управления миграцией данных в пакетах и каждый из них завершился в течение заданного промежутка времени, секционирования данных. Секционирование также снижает риск непредвиденные проблемы.

Позволяет проверить решение end-to-end и проверить пропускную способность копирования в вашей среде подтверждения концепции. Основные действия по подтверждению концепции: 

1. Создание одного конвейера фабрики данных с помощью отдельного действия копирования для копирования нескольких терабайтов данных из Gen1 хранилища Озера данных на уровень Gen2 хранилища Озера данных для получения базовых показателей производительности копирования. Начните с [единицы интеграции данных (DIUs)](copy-activity-performance.md#data-integration-units) как 128. 
2. Учитывая пропускную способность копирования, полученный на шаге 1, вычислить предполагаемое время, необходимое для миграции данных. 
3. (Необязательно) Создайте таблицу элемента управления и определите фильтр файлов, чтобы файлы переносимых разделов. Способ секционирования файлы —: 

    - Раздел по имени папки или имя папки с фильтр с подстановочными знаками. Рекомендуется использовать этот метод.
    - Время последнего изменения секции с помощью файла.

### <a name="network-bandwidth-and-storage-io"></a>Сетевой пропускной способности и хранилища ввода-вывода 

Вы можете управлять параллелизмом заданий копирования фабрики данных, чтение данных из Gen1 хранилища Озера данных и записи данных на уровень Gen2 хранилища Озера данных. Таким образом вы можете управлять использованием на операции ввода-вывода, чтобы избежать влияния на работу обычного рабочего в поколение 1 хранилища Озера данных во время миграции хранилища.

### <a name="permissions"></a>Разрешения 

В фабрике данных [Gen1 хранилища Озера данных соединителя](connector-azure-data-lake-store.md) поддерживает principal и управляемого удостоверения службы для проверки подлинности ресурсов Azure. [Gen2 хранилища Озера данных соединителя](connector-azure-data-lake-storage.md) поддерживает учетной записи, ключ субъекта-службы и управляемые удостоверения для проверки подлинности ресурсов Azure. Чтобы сделать возможность перехода и скопируйте все файлы или списки управления доступом (ACL high предоставили достаточно разрешений для учетной записи, которые вы предоставляете доступ, чтения, или написать все файлы и настройка списков управления доступом в том случае, если вы решили) фабрики данных. Предоставьте ему роль владельца или суперпользователь во время миграции. 

### <a name="preserve-acls-from-data-lake-storage-gen1"></a>Сохраняет списки управления доступом из Gen1 хранилища Озера данных

Если вы хотите реплицировать списки управления доступом, а также файлов данных при обновлении с Gen1 хранилища Озера данных на уровень Gen2 хранилища Озера данных, см. в разделе [сохранить списки управления доступом из Gen1 хранилища Озера данных](connector-azure-data-lake-storage.md#preserve-acls-from-data-lake-storage-gen1). 

### <a name="incremental-copy"></a>Добавочное копирование 

Загрузить только новые или обновленные файлы из Gen1 хранилища Озера данных можно использовать несколько подходов:

- Загрузите новые или обновленные файлы, имя файла или папки секционированных времени. Например, / 2019/05/13 / *.
- Загрузите новые или обновленные файлы, Дата последнего изменения.
- Определите новые или обновленные файлы любого стороннего средства или решения. Затем передайте имя файла или папки в конвейере фабрики данных с помощью параметра таблицу или файл. 

Правильное частота проводить добавочную загрузку, зависит от того, общее число файлов в Gen1 хранилища Озера данных Azure и объем новых или обновленных файлов, которые необходимо загрузить каждый раз. 

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Об обзоре действия копирования](copy-activity-overview.md)
> [соединитель Gen1 хранилища Озера данных Azure](connector-azure-data-lake-store.md)
> [соединитель Gen2 хранилища Озера данных Azure](connector-azure-data-lake-storage.md)