---
title: Копирование данных из хранилища данных Azure Data Lake Gen1 в Gen2
description: Использование Фабрики данных Azure для копирования данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения
services: data-factory
documentationcenter: ''
ms.author: jingwang
author: linda33wj
manager: shwang
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 05/13/2019
ms.openlocfilehash: ea0a9de5dde02b45ae34e3e98e24b31fd01fa713
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80235825"
---
# <a name="copy-data-from-azure-data-lake-storage-gen1-to-gen2-with-azure-data-factory"></a>Копирование данных из Azure Data Lake Storage 1-го поколения в Azure Data Lake Storage 2-го поколения с помощью Фабрики данных Azure

Azure Data Lake Storage2 — это набор возможностей, предназначенных для анализа больших данных, встроенных в [хранилище Azure Blob.](../storage/blobs/storage-blobs-introduction.md) Вы можете использовать его для взаимодействия с данными, используя как файловую систему, так и парадигмы хранения объектов.

Если в настоящее время используется Azure Data Lake Storage Gen1, вы можете оценить данные Azure Data Lake Storage Gen2, скопируя данные от Data Lake Storage Gen1 до Gen2 с помощью Azure Data Factory.

Фабрика данных Azure — это полностью управляемая облачная служба интеграции данных. Сервис можно использовать для заполнения озера данными из богатого набора штатных и облачных хранилищ данных и экономии времени при создании аналитических решений. Список поддерживаемых разъемов см. [Supported data stores](copy-activity-overview.md#supported-data-stores-and-formats)

Фабрика данных Azure предлагает масштабируемое и управляемое решение для перемещения данных. Из-за масштабирования архитектуры Data Factory, он может глотать данные с высокой пропускной всей пропускной всей. Для получения дополнительной информации [см.](copy-activity-performance.md)

В этой статье показано, как использовать инструмент копирования данных Data Factory для копирования данных из Azure Data Lake Storage 1 в Azure Data Lake Storage Gen2. Чтобы копировать данные из других типов хранилищ, необходимо выполнить аналогичные шаги.

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/), прежде чем начинать работу.
* Учетная запись Azure Data Lake Storage 1-го поколения с сохраненными в ней данными.
* Учетная запись хранения Azure с включенным хранилищем Data Lake. Если у вас нет учетной записи Хранилища, [создайте учетную запись.](https://ms.portal.azure.com/#create/Microsoft.StorageAccount-ARM)

## <a name="create-a-data-factory"></a>Создание фабрики данных

1. В левом меню выберите **«Создайте ресурс** > **данные и фабрику** > **аналитических данных».**
   
   ![Выбор фабрики данных в новой панели](./media/quickstart-create-data-factory-portal/new-azure-data-factory-menu.png)

2. На странице **New data Factory** укажите значения для полей, отображаемых на следующем изображении: 
      
   ![Новая страница фабрики данных](./media/load-azure-data-lake-storage-gen2-from-gen1/new-azure-data-factory.png)
 
    * **Имя.** Введите глобальное уникальное имя фабрики данных Azure. Если отобразится сообщение об ошибке "Имя \"LoadADLSDemo\" фабрики данных недоступно", введите другое имя. Например,**_ваше_имя_****ADFTutorialDataFactory**. Создайте фабрику данных снова. Правила именования артефактов службы "Фабрика данных" см. в [этой](naming-rules.md) статье.
    * **Подписка.** Выберите подписку Azure, в рамках которой нужно создать фабрику данных. 
    * **Группа ресурсов**: Выберите существующую группу ресурсов из списка выпадающих. Вы также можете выбрать **новую опцию «Создание»** и ввести имя группы ресурсов. Сведения о группах ресурсов см. в статье [Общие сведения об Azure Resource Manager](../azure-resource-manager/management/overview.md). 
    * **Версия.** Выберите значение **V2**.
    * **Расположение.** Выберите расположение фабрики данных. В раскрывающемся списке отображаются только поддерживаемые расположения. Хранилища данных, используемые в фабрике данных, могут находиться в других расположениях и регионах. 

3. Выберите **Создать**.
4. После завершения создания перейдите на фабрику данных. Вы увидите домашнюю страницу **фабрики данных**, как показано на следующем изображении: 
   
   ![Домашняя страница фабрики данных](./media/load-azure-data-lake-storage-gen2-from-gen1/data-factory-home-page.png)

5. Выберите плитку **Author & Monitor** для запуска приложения интеграции данных в отдельной вкладке.

## <a name="load-data-into-azure-data-lake-storage-gen2"></a>Загрузка данных в Azure Data Lake Storage Gen2

1. На странице **Get started** выберите плитку **Copy Data** для запуска инструмента копировальных данных. 

   ![Копирование плитки инструментов данных](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-tile.png)
2. На странице **Свойства** укажите **CopyFromADLSGen1ToGen2** для поля **имени задачи.** Нажмите кнопку **Далее**.

    ![Страница свойств](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-data-tool-properties-page.png)
3. На странице **хранилища данных Источника** выберите **: Создайте новое соединение.**

    ![Страница исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page.png)
    
4. Выберите **Azure Data Lake Storage1** из галереи разъемов и выберите **Продолжить**.
    
    ![Страница настройки Azure Data Lake Storage 1-го поколения в качестве исходного хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/source-data-store-page-adls-gen1.png)
    
5. На странице **подключения Specify Azure Data Lake Storage Gen1** выполните следующие действия:

   а. Выберите имя учетной записи Data Lake Storage 1-го поколения и укажите или подтвердите имя **клиента**.
  
   b. Выберите **подключение к тесту** для проверки настроек. Выберите **Готово**.
  
   c. Вы видите, что было создано новое соединение. Нажмите кнопку **Далее**.
   
   > [!IMPORTANT]
   > В этом пошаговом переходе используется управляемый итог ресурсов Azure для проверки подлинности хранилища данных Azure Data Lake Gen1. Чтобы предоставить управляемой идентификации соответствующие разрешения в Azure Data Lake Storage Gen1, следуйте [этим инструкциям.](connector-azure-data-lake-store.md#managed-identity)
   
   ![Выбор учетной записи Data Lake Storage 1-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen1-account.png)
      
6. На странице **«Выбрать файл ввода» или папку** — просмотрите папку и файл, который вы хотите скопировать. Выберите папку или файл и **выберите «**

    ![Выбор файла или папки входных данных](./media/load-azure-data-lake-storage-gen2-from-gen1/choose-input-folder.png)

7. Укажите поведение копии, выбрав **файлы copy recursively** и **варианты бинарных копий.** Нажмите кнопку **Далее**.

    ![Укажите выходную папку.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-binary-copy.png)
    
8. На странице **хранилища данных Destination** выберите: **Создайте новое соединение** > **Azure Data Lake Storage Gen2** > **Продолжить**.

    ![Страница целевого хранилища данных](./media/load-azure-data-lake-storage-gen2-from-gen1/destination-data-storage-page.png)

9. На странице **подключения Specify Azure Data Lake Storage Gen2** выполните следующие действия:

   а. Выберите учетную запись Data Lake Storage Gen2, способную выйти из списка выпадающих данных **учетной записи..**
   
   b. Выберите **Готово**, чтобы создать подключение. Затем выберите **Следующий**.
   
   ![Выбор учетной записи Data Lake Storage 2-го поколения](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-account.png)

10. На **странице «Выбрать выводной файл» или страницу папки** введите **copyfromadlsgen1** в качестве имени папки вывода и выберите **«Следующий.** Фабрика данных создает соответствующую файловую систему хранения данных Azure Data Lake Gen2 и субфолители во время копирования, если их не существует.

    ![Укажите выходную папку.](./media/load-azure-data-lake-storage-gen2-from-gen1/specify-adls-gen2-path.png)

11. На странице **Параметры** нажмите кнопку **Далее**, подтверждая использование параметров по умолчанию.

12. На странице **Резюме** просмотрите настройки и выберите **далее**.

    ![Страница "Сводка"](./media/load-azure-data-lake-storage-gen2-from-gen1/copy-summary.png)
13. На **странице развертывания**выберите **Монитор** для мониторинга конвейера.

    ![Страница развертывания](./media/load-azure-data-lake-storage-gen2-from-gen1/deployment-page.png)
14. Обратите внимание, что слева автоматически выбирается вкладка **Мониторинг**. В столбце **действий** отображаются ссылки для просмотра сведений о запусках действий и (или) повторного выполнения на конвейере.

    ![Мониторинг выполнений конвейера](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-pipeline-runs.png)

15. Щелкните ссылку **View Activity Runs** (Просмотр выполнений действий) в столбце **Actions** (Действия), чтобы просмотреть выполнения действий, связанные с этим запуском конвейера. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению запусков конвейера, щелкните ссылку **Конвейеры** в верхней части окна. Щелкните **Обновить**, чтобы обновить список. 

    ![Мониторинг выполнений действий](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-runs.png)

16. Чтобы отслеживать сведения о выполнении каждого действия копирования, щелкните ссылку **Сведения** (изображение очков) в разделе **Действия** в представлении мониторинга действия. Вы можете отслеживать такие данные, как объем данных, скопированных из источника в раковину, пропускную стоимость данных, этапы выполнения с соответствующей продолжительностью и используемые конфигурации.

    ![Мониторинг сведений о выполнении действия](./media/load-azure-data-lake-storage-gen2-from-gen1/monitor-activity-run-details.png)

17. Проверить, что данные скопированы в учетную запись Azure Data Lake Storage Gen2.

## <a name="best-practices"></a>Рекомендации

Чтобы оценить обновление от Azure Data Lake Storage Gen1 до [Upgrade your big data analytics solutions from Azure Data Lake Storage Gen1 to Azure Data Lake Storage Gen2](../storage/blobs/data-lake-storage-upgrade.md)Azure Data Lake Storage Gen2 в целом, см. В следующих разделах представлены рекомендации по использованию фабрики данных для обновления данных от Data Lake Storage Gen1 до Data Lake Storage Gen2.

### <a name="data-partition-for-historical-data-copy"></a>Раздел данных для копии исторических данных

- Если общий размер данных в Data Lake Storage Gen1 составляет менее 30 ТБ, а количество файлов — менее 1 миллиона, можно скопировать все данные за одну копию.
- Если у вас есть больший объем данных для копирования, или вы хотите гибкость для управления миграцией данных в пакетах и сделать каждый из них завершен в течение определенного периода времени, раздел данных. Раздел также снижает риск любой неожиданной проблемы.

Используйте доказательство концепции для проверки сквозного решения и тестирования пропускной схемы копирования в вашей среде. Основные шаги по проверке концепции: 

1. Создайте один конвейер Data Factory с одной копией, чтобы скопировать несколько ТБ данных от Data Lake Storage Gen1 до Data Lake Storage Gen2, чтобы получить базовый уклад производительности копий. Начните с [единиц интеграции данных (DIUs)](copy-activity-performance.md#data-integration-units) как 128. 
2. На основе пропускной переливки копии, которую вы получаете в шаге 1, вычислите предполагаемое время, необходимое для всей миграции данных. 
3. (Необязательно) Создайте таблицу управления и определите фильтр файла для раздела мигрируемых файлов. Способ раздела файлов заключается в: 

    - Раздел по имени папки или именем папки с фильтром подстановочных знаков. Рекомендуется использовать этот метод.
    - Раздел последним модифицированным временем файла.

### <a name="network-bandwidth-and-storage-io"></a>Пропускная способность сети и ввоза в/o 

Вы можете управлять параллелью задания Data Factory, которые считываемые данные из Data Lake Storage Gen1, и записывать данные в Data Lake Storage Gen2. Таким образом, можно управлять использованием вв:2, чтобы избежать влияния на нормальную деловую работу Data Lake Storage Gen1 во время миграции.

### <a name="permissions"></a>Разрешения 

В Data Factory [разъем Data Lake Storage Gen1](connector-azure-data-lake-store.md) поддерживает основную и управляемую идентификацию ресурсов Azure для проверки подлинности ресурсов Azure. [Разъем Data Lake Storage Gen2](connector-azure-data-lake-storage.md) поддерживает ключ учетной записи, основную службу и управляемую идентификацию для аутентификации ресурсов Azure. Чтобы фабрика данных могла перемещаться и копировать все файлы или списки управления доступом (ACLs), предоставьте достаточно высокие разрешения для учетной записи, предоставляемой для доступа, чтения или записи всех файлов и установки ACL, если вы хотите. Предоставите ему роль супер-пользователя или владельца в период миграции. 

### <a name="preserve-acls-from-data-lake-storage-gen1"></a>Сохранение ACLs из хранилища data Lake Gen1

Если вы хотите воспроизвести ACLs вместе с файлами данных при обновлении с Data Lake Storage Gen1 до Data Lake Storage Gen2, [см.](connector-azure-data-lake-storage.md#preserve-acls) 

### <a name="incremental-copy"></a>Добавочное копирование 

Вы можете использовать несколько подходов для загрузки только новых или обновленных файлов из Data Lake Storage Gen1:

- Загрузите новые или обновленные файлы по времени разделенной папки или имени файла. Примером может быть /2019/05/13/ .
- Загрузите новые или обновленные файлы LastModifiedDate.
- Определите новые или обновленные файлы с помощью любого стороннего инструмента или решения. Затем передайте имя файла или папки конвейеру Data Factory по параметру или таблице или файлу. 

Надлежащая частота для увеличения нагрузки зависит от общего количества файлов в Azure Data Lake Storage Gen1 и объема новых или обновленных файлов, которые будут загружаться каждый раз. 

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Копирование обзора](copy-activity-overview.md)
> активности[Azure Data Lake Storage Gen1 разъем](connector-azure-data-lake-store.md)
> [Azure Data Lake Storage Gen2 разъем](connector-azure-data-lake-storage.md)