---
title: Шаблоны столбцов в потоке данных сопоставления фабрики данных Azure
description: Создание обобщенных шаблонов преобразования данных с помощью шаблонов столбцов в потоках данных сопоставления фабрики данных Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 10/21/2019
ms.openlocfilehash: 0c9a3c2ef05f4a11933ca7fc81c7c0f87a612293
ms.sourcegitcommit: b050c7e5133badd131e46cab144dd5860ae8a98e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72789930"
---
# <a name="using-column-patterns-in-mapping-data-flow"></a>Использование шаблонов столбцов в потоке данных сопоставления

Несколько преобразований потока данных сопоставления позволяют ссылаться на столбцы шаблонов на основе шаблонов, а не жестко запрограммированных имен столбцов. Это сопоставление называется *шаблонами столбцов*. Можно определить закономерности для сопоставления столбцов по имени, типу данных, потоку или положению вместо того, чтобы вводить точные имена полей. Существуют два сценария, в которых шаблоны столбцов полезны:

* Если входящие поля источника изменяются часто, например в случае изменения столбцов в текстовых файлах или базах данных NoSQL. Этот сценарий называется [смещением схемы](concepts-data-flow-schema-drift.md).
* Если вы хотите выполнить общую операцию над большой группой столбцов. Например, необходимо привести каждый столбец, имеющий в имени столбца "Total", к типу Double.

Шаблоны столбцов в настоящее время доступны для преобразований «производный столбец», «Статистическая обработка», «выбор» и «приемник».

## <a name="column-patterns-in-derived-column-and-aggregate"></a>Шаблоны столбцов в производном столбце и агрегатной функции

Чтобы добавить шаблон столбца в производный столбец или на вкладку статистические выражения преобразования «Статистическая обработка», щелкните значок «плюс» справа от существующего столбца. Выберите **Добавить шаблон столбца**. 

![шаблоны столбцов](media/data-flow/columnpattern.png "Шаблоны столбцов")

Используйте [Построитель выражений](concepts-data-flow-expression-builder.md) для ввода условия соответствия. Создайте логическое выражение, которое соответствует столбцам на основе `name`, `type`, `stream`и `position` столбца. Шаблон будет влиять на любой столбец, смещенное или определенное, где условие возвращает значение true.

Два поля выражений под условием соответствия указывают новые имена и значения затронутых столбцов. Используйте `$$`, чтобы сослаться на существующее значение соответствующего поля. Поле левое выражение определяет имя, а поле правого выражения определяет значение.

![шаблоны столбцов](media/data-flow/columnpattern2.png "Шаблоны столбцов")

Шаблон приведенного выше столбца соответствует каждому столбцу типа Double и создает один статистический столбец для каждого соответствия. Имя нового столбца — это имя сопоставленного столбца, объединенное с "_Total". Значением нового столбца является округленная итоговая сумма существующего значения Double.

Чтобы проверить правильность условия сопоставления, можно проверить схему вывода определенных столбцов на вкладке **Проверка** или получить моментальный снимок данных на вкладке **Предварительный просмотр данных** . 

![шаблоны столбцов](media/data-flow/columnpattern3.png "Шаблоны столбцов")

## <a name="rule-based-mapping-in-select-and-sink"></a>Сопоставление на основе правил в выборе и приемнике

При сопоставлении столбцов в источнике и выборе преобразований можно добавить фиксированные сопоставления или сопоставления на основе правил. Если вы знакомы со схемой данных и предполагаете, что определенные столбцы из исходного набора данных всегда соответствуют определенным статическим именам, используйте фиксированное сопоставление. Если вы работаете с гибкими схемами, используйте сопоставление на основе правил для построения соответствия шаблону на основе `name`, `type`, `stream`и `position` столбцов. Можно использовать любое сочетание фиксированных и основанных на правилах сопоставлений. 

Чтобы добавить сопоставление на основе правил, нажмите кнопку **Добавить сопоставление** и выберите **сопоставление на основе правил**.

![сопоставление на основе правил](media/data-flow/rule2.png "Сопоставление на основе правил")

В поле левое выражение введите логическое условие соответствия. В поле справа укажите, с каким столбцом будет сопоставляться сопоставленный столбец. Используйте `$$` для ссылки на существующее имя соответствующего поля.

Если щелкнуть значок шеврона вниз, можно указать условие сопоставления регулярных выражений.

Щелкните значок очков рядом с сопоставлением на основе правил, чтобы просмотреть, какие определенные столбцы соответствуют и что они сопоставлены.

![сопоставление на основе правил](media/data-flow/rule1.png "Сопоставление на основе правил")

В приведенном выше примере создаются два сопоставления на основе правил. Первый принимает все столбцы, не имеющие имя "Movie", и сопоставляет их с существующими значениями. Второе правило использует регулярное выражение для сопоставления всех столбцов, начинающихся с "Movie", и сопоставляет их со столбцом "Мовиеид".

Если в правиле приводится несколько одинаковых сопоставлений, включите **Пропуск повторяющихся входов** или **пропустите дублирование** , чтобы предотвратить дублирование.

## <a name="pattern-matching-expression-values"></a>Значения выражения сопоставления шаблонов.

* `$$` преобразуется в имя или значение каждого совпадения во время выполнения
* `name` представляет имя каждого входящего столбца.
* `type` представляет тип данных каждого входящего столбца
* `stream` представляет имя, связанное с каждым потоком, или преобразование в последовательности
* `position` — порядковый номер столбцов в потоке данных

## <a name="next-steps"></a>Дальнейшие действия
* Дополнительные сведения о [языке выражений](data-flow-expression-functions.md) потока данных сопоставления для преобразований данных
* Использование шаблонов столбцов в [преобразовании приемника](data-flow-sink.md) и [Выбор преобразования](data-flow-select.md) с сопоставлением на основе правил
