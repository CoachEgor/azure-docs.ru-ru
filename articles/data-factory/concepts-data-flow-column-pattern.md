---
title: Шаблоны столбцов в потоке данных сопоставления фабрики данных Azure
description: Создание обобщенных шаблонов преобразования данных с помощью шаблонов столбцов в потоках данных сопоставления фабрики данных Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 10/21/2019
ms.openlocfilehash: aacec8830948e08f66d71da88897670f7ef43788
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81606118"
---
# <a name="using-column-patterns-in-mapping-data-flow"></a>Использование шаблонов столбцов в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Несколько преобразований потока данных сопоставления позволяют ссылаться на столбцы шаблонов на основе шаблонов, а не жестко запрограммированных имен столбцов. Это сопоставление называется *шаблонами столбцов*. Можно определить закономерности для сопоставления столбцов по имени, типу данных, потоку или положению вместо того, чтобы вводить точные имена полей. Существуют два сценария, в которых шаблоны столбцов полезны:

* Если входящие поля источника изменяются часто, например в случае изменения столбцов в текстовых файлах или базах данных NoSQL. Этот сценарий называется [смещением схемы](concepts-data-flow-schema-drift.md).
* Если вы хотите выполнить общую операцию над большой группой столбцов. Например, необходимо привести каждый столбец, имеющий в имени столбца "Total", к типу Double.

Шаблоны столбцов в настоящее время доступны для преобразований «производный столбец», «Статистическая обработка», «выбор» и «приемник».

## <a name="column-patterns-in-derived-column-and-aggregate"></a>Шаблоны столбцов в производном столбце и агрегатной функции

Чтобы добавить шаблон столбца в производный столбец или на вкладку статистические выражения преобразования «Статистическая обработка», щелкните значок «плюс» справа от существующего столбца. Выберите **Добавить шаблон столбца**. 

![шаблоны столбцов](media/data-flow/columnpattern.png "Шаблоны столбцов")

Используйте [Построитель выражений](concepts-data-flow-expression-builder.md) для ввода условия соответствия. Создайте логическое выражение, которое `name`соответствует столбцам, основанным `type`на `stream`столбцах `position` ,, и. Шаблон будет влиять на любой столбец, смещенное или определенное, где условие возвращает значение true.

Два поля выражений под условием соответствия указывают новые имена и значения затронутых столбцов. Используйте `$$` для ссылки на существующее значение соответствующего поля. Поле левое выражение определяет имя, а поле правого выражения определяет значение.

![шаблоны столбцов](media/data-flow/columnpattern2.png "Шаблоны столбцов")

Шаблон приведенного выше столбца соответствует каждому столбцу типа Double и создает один статистический столбец для каждого соответствия. Имя нового столбца — это имя сопоставленного столбца, объединенное с "_total". Значением нового столбца является округленная итоговая сумма существующего значения Double.

Чтобы проверить правильность условия сопоставления, можно проверить схему вывода определенных столбцов на вкладке **Проверка** или получить моментальный снимок данных на вкладке **Предварительный просмотр данных** . 

![шаблоны столбцов](media/data-flow/columnpattern3.png "Шаблоны столбцов")

## <a name="rule-based-mapping-in-select-and-sink"></a>Сопоставление на основе правил в выборе и приемнике

При сопоставлении столбцов в источнике и выборе преобразований можно добавить фиксированные сопоставления или сопоставления на основе правил. Соответствие `name`, основанное на `type`столбцах,, `stream`и `position` . Можно использовать любое сочетание фиксированных и основанных на правилах сопоставлений. По умолчанию все проекции с более чем 50 столбцами по умолчанию будут сопоставлены на основе правил, которые соответствуют каждому столбцу и выводят выводимое имя. 

Чтобы добавить сопоставление на основе правил, нажмите кнопку **Добавить сопоставление** и выберите **сопоставление на основе правил**.

![сопоставление на основе правил](media/data-flow/rule2.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Каждое сопоставление на основе правил требует двух входных данных: условия, по которым производится сопоставление, и имя каждого сопоставленного столбца. Оба значения выводятся с помощью [построителя выражений](concepts-data-flow-expression-builder.md). В поле левое выражение введите логическое условие соответствия. В поле справа укажите, с каким столбцом будет сопоставляться сопоставленный столбец.

![сопоставление на основе правил](media/data-flow/rule-based-mapping.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Используйте `$$` синтаксис для ссылки на входное имя сопоставленного столбца. Используя приведенное выше изображение в качестве примера, предположим, что пользователь хочет сопоставить все строковые столбцы, имена которых короче шести символов. Если один входящий столбец был именован `test`, выражение `$$ + '_short'` будет переименовывать столбец `test_short`. Если это единственное сопоставление, все столбцы, которые не соответствуют условию, будут удалены из выведенных данных.

Закономерности совпадают с смещенными и определенными столбцами. Чтобы узнать, какие определенные столбцы сопоставляются правилу, щелкните значок очков рядом с правилом. Проверьте выходные данные с помощью предварительной версии данных.

### <a name="regex-mapping"></a>Сопоставление регулярного выражения

Если щелкнуть значок шеврона вниз, можно указать условие сопоставления регулярного выражения. Условие сопоставления регулярного выражения сопоставляет все имена столбцов, соответствующие указанному условию Regex. Это можно использовать в сочетании со стандартными сопоставлениями на основе правил.

![сопоставление на основе правил](media/data-flow/regex-matching.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Приведенный выше пример соответствует шаблону `(r)` регулярного выражения или любому имени столбца, в котором содержится нижний регистр r. Как и в стандартном сопоставлении на основе правил, все сопоставленные столбцы изменяются с `$$` помощью условия справа с использованием синтаксиса.

### <a name="rule-based-hierarchies"></a>Иерархии на основе правил

Если определенная проекция имеет иерархию, можно использовать сопоставление на основе правил для сопоставления подстолбцов иерархии. Укажите условие сопоставления и сложный столбец, для которого нужно выполнить сопоставление. Каждый сопоставленный подстолбец будет выведен с помощью правила "Name AS", указанного справа.

![сопоставление на основе правил](media/data-flow/rule-based-hierarchy.png "Rule-based mapping (Выбор преобразования: сопоставление на основе правил)")

Приведенный выше пример соответствует всем подстолбцам сложного столбца `a`. `a`содержит два подстолбца `b` и `c`. Выходная схема будет содержать два столбца `b` , `c` а в качестве условия "Name AS" `$$`—.

## <a name="pattern-matching-expression-values"></a>Значения выражения сопоставления шаблонов.

* `$$`Преобразует в имя или значение каждого совпадения во время выполнения
* `name`представляет имя каждого входящего столбца
* `type`представляет тип данных каждого входящего столбца
* `stream`представляет имя, связанное с каждым потоком, или преобразование в последовательности
* `position`порядковый номер столбца в потоке данных

## <a name="next-steps"></a>Дальнейшие шаги
* Дополнительные сведения о [языке выражений](data-flow-expression-functions.md) потока данных сопоставления для преобразований данных
* Использование шаблонов столбцов в [преобразовании приемника](data-flow-sink.md) и [Выбор преобразования](data-flow-select.md) с сопоставлением на основе правил
