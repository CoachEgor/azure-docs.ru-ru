---
title: Наборы данных и связанные службы в фабрике данных Azure | Документация Майкрософт
description: Узнайте о наборах данных и связанных службах в фабрике данных. Связанные службы связывают хранилища данных и вычислений с фабрикой данных. Наборы данных представляют входные и выходные данные.
services: data-factory
documentationcenter: ''
author: sharonlo101
manager: craigg
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 01/22/2018
ms.author: shlo
ms.openlocfilehash: 9e5da96cb02e681c83bd707fc038117050712ccf
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61262060"
---
# <a name="datasets-and-linked-services-in-azure-data-factory"></a>Наборы данных и связанные службы в фабрике данных Azure
> [!div class="op_single_selector" title1="Select the version of Data Factory service you are using:"]
> * [Версия 1](v1/data-factory-create-datasets.md)
> * [Текущая версия](concepts-datasets-linked-services.md)

В этой статье описывается, какие бывают наборы данных, каким образом они определяются в формате JSON, а также как они используются в конвейерах фабрики данных Azure.

Чтобы получить общие представления о фабрике данных, ознакомьтесь со статьей [Общие сведения о службе фабрики данных Azure, службе интеграции данных в облаке](introduction.md).

## <a name="overview"></a>Обзор
Фабрика данных может иметь один или несколько конвейеров. **Конвейер** — это логическая группа **действий**, которые вместе выполняют задачу. Действия в конвейере определяют операции с данными. Например, вы можете использовать действие копирования, чтобы скопировать данные из локального сервера SQL Server в хранилище BLOB-объектов Azure. Затем можно использовать действие Hive для запуска сценария Hive в кластере HDInsight Azure, чтобы обработать данные из хранилища BLOB-объектов для получения выходных данных. Наконец, можно использовать второе действие копирования, чтобы скопировать выходные данные в хранилище данных SQL Azure, на основе которого созданы решения для создания отчетов бизнес-аналитики. Дополнительные сведения о конвейерах и действиях см. в статье [Конвейеры и действия в фабрике данных Azure](concepts-pipelines-activities.md).

Теперь **набор данных** — это именованное представление данных, которое указывает данные, необходимые для использования в **действиях**, разделяя их на входные и выходные. Наборы данных представляют данные в разных хранилищах, например в таблицах, файлах, папках и документах. Например, набор данных больших двоичных объектов Azure указывает контейнер больших двоичных объектов и папку в хранилище BLOB-объектов, из которой действие должно считывать данные.

Перед созданием набора данных необходимо создать **связанную службу**, чтобы связать хранилище данных с фабрикой данных. Связанные службы напоминают строки подключения, определяющие сведения о подключении, необходимые для подключения фабрики данных к внешним ресурсам. Таким образом, набор данных представляет структуру данных в связанных хранилищах данных, а связанная служба определяет подключение к источнику данных. Например, связанная служба хранилища Azure связывает учетную запись хранения с фабрикой данных. Набор данных больших двоичных объектов Azure представляет контейнер больших двоичных объектов и папку в учетной записи хранения Azure, содержащую входные большие двоичные объекты для обработки.

Ниже приведен пример сценария. Чтобы скопировать данные из хранилища BLOB-объектов в базу данных SQL, создайте две связанные службы: службу хранилища Azure и Базу данных SQL Azure. Затем создайте два набора данных: набор данных из BLOB-объектов (для связанной службы хранилища Azure) и набор данных таблицы SQL Azure (для связанной службы Базы данных SQL Azure). Связанные службы хранилища Azure и базы данных SQL Azure содержат строки подключения, которые фабрика данных использует во время выполнения для подключения к службе хранилища Azure и базе данных Azure SQL соответственно. Набор данных больших двоичных объектов Azure указывает контейнер и папку больших двоичных объектов, содержащие входные большие двоичные объекты в хранилище BLOB-объектов. Набор данных таблицы SQL Azure указывает таблицу SQL в базе данных SQL, в которую будут копироваться данные.

На следующей схеме показана связь между конвейером, действием, набором данных и связанной службой в фабрике данных.

![Связь между конвейером, действием, набором данных и связанными службами](media/concepts-datasets-linked-services/relationship-between-data-factory-entities.png)

## <a name="linked-service-json"></a>JSON связанной службы
Связанная служба в фабрике данных определяется в формате JSON, как показано ниже.

```json
{
    "name": "<Name of the linked service>",
    "properties": {
        "type": "<Type of the linked service>",
        "typeProperties": {
              "<data store or compute-specific type properties>"
        },
        "connectVia": {
            "referenceName": "<name of Integration Runtime>",
            "type": "IntegrationRuntimeReference"
        }
    }
}
```

В следующей таблице описаны свойства приведенного выше объекта JSON.

Свойство | ОПИСАНИЕ | Обязательно для заполнения |
-------- | ----------- | -------- |
name | Имя связанной службы. Дополнительные сведения см. в статье [Фабрика данных Azure — правила именования](naming-rules.md). |  Да |
тип | Тип связанной службы. Пример. AzureStorage (хранилище данных) или AzureBatch (служба вычислений). См. описание typeProperties. | Да |
typeProperties | Свойства типов отличаются для каждого хранилища данных или вычислительного ресурса. <br/><br/> Поддерживаемые типы хранилищ данных и соответствующие свойства типов см. в таблице [типов наборов данных](#dataset-type) в этой статье. Дополнительные сведения о свойствах типов, характерных для хранилища данных, см. в статье о соединителях хранилища данных. <br/><br/> Поддерживаемые типы вычислительных служб и соответствующие свойства типов см. в статье [Вычислительные среды, поддерживаемые фабрикой данных Azure](compute-linked-services.md). | Да |
connectVia | [Среда выполнения интеграции](concepts-integration-runtime.md), используемая для подключения к хранилищу данных. Вы можете использовать среду выполнения интеграции Azure или локальную среду IR (если хранилище данных расположено в частной сети). Если не указано другое, по умолчанию используется интегрированная среда выполнения Azure. | Нет

## <a name="linked-service-example"></a>Образец связанной службы
Ниже показана связанная служба хранилища Azure. Обратите внимание, что параметру type присвоено значение AzureStorage. Свойства типов связанной службы хранилища Azure включают строку подключения. Фабрика данных использует эту строку подключения для соединения с хранилищем данных в среде выполнения.

```json
{
    "name": "AzureStorageLinkedService",
    "properties": {
        "type": "AzureStorage",
        "typeProperties": {
            "connectionString": {
                "type": "SecureString",
                "value": "DefaultEndpointsProtocol=https;AccountName=<accountname>;AccountKey=<accountkey>"
            }
        },
        "connectVia": {
            "referenceName": "<name of Integration Runtime>",
            "type": "IntegrationRuntimeReference"
        }
    }
}
```

## <a name="dataset-json"></a>JSON набора данных
Набор данных в фабрике данных определяется в формате JSON, как показано ниже.

```json
{
    "name": "<name of dataset>",
    "properties": {
        "type": "<type of dataset: AzureBlob, AzureSql etc...>",
        "linkedServiceName": {
                "referenceName": "<name of linked service>",
                "type": "LinkedServiceReference",
        },
        "structure": [
            {
                "name": "<Name of the column>",
                "type": "<Name of the type>"
            }
        ],
        "typeProperties": {
            "<type specific property>": "<value>",
            "<type specific property 2>": "<value 2>",
        }
    }
}

```
В следующей таблице описаны свойства приведенного выше объекта JSON.

Свойство | ОПИСАНИЕ | Обязательно для заполнения |
-------- | ----------- | -------- |
name | Имя набора данных. Дополнительные сведения см. в статье [Фабрика данных Azure — правила именования](naming-rules.md). |  Да |
тип | Тип набора данных. Укажите один из типов, которые поддерживает Фабрика данных (например, AzureBlob или AzureSqlTable). <br/><br/>Дополнительные сведения см. в разделе [о типах наборов данных](#dataset-type). | Да |
structure | Схема набора данных. Дополнительные сведения см. в разделе [Структура набора данных](#dataset-structure). | Нет |
typeProperties | Свойства каждого типа отличаются (например, свойства большого двоичного объекта Azure и таблицы SQL Azure). Сведения о поддерживаемых типах и их свойствах см. в разделе [Тип набора данных](#dataset-type). | Да |

## <a name="dataset-example"></a>Пример набора данных
В следующем примере набор данных представляет таблицу с именем MyTable в базе данных SQL.

```json
{
    "name": "DatasetSample",
    "properties": {
        "type": "AzureSqlTable",
        "linkedServiceName": {
                "referenceName": "MyAzureSqlLinkedService",
                "type": "LinkedServiceReference",
        },
        "typeProperties":
        {
            "tableName": "MyTable"
        },
    }
}

```
Обратите внимание на следующие моменты.

- для параметра type задано значение AzureSqlTable;
- свойство типа tableName (используется только для типа AzureSqlTable) имеет значение MyTable;
- параметр linkedServiceName ссылается на связанную службу типа AzureSqlDatabase, определение которой указано во фрагменте кода JSON ниже;

## <a name="dataset-type"></a>Тип набора данных
Существует множество различных типов наборов данных в зависимости от используемого хранилища данных. В таблице ниже перечислены хранилища данных, поддерживаемые фабрикой данных. Щелкните хранилище данных, чтобы узнать, как для него создать связанную службу и набор данных.

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

В примере в предыдущем разделе задан тип набора данных **AzureSqlTable**. Аналогично для набора данных больших двоичных объектов Azure задается тип **AzureBlob**, как показано в следующем фрагменте JSON.

```json
{
    "name": "AzureBlobInput",
    "properties": {
        "type": "AzureBlob",
        "linkedServiceName": {
                "referenceName": "MyAzureStorageLinkedService",
                "type": "LinkedServiceReference",
        },

        "typeProperties": {
            "fileName": "input.log",
            "folderPath": "adfgetstarted/inputdata",
            "format": {
                "type": "TextFormat",
                "columnDelimiter": ","
            }
        }
    }
}
```
## <a name="dataset-structure"></a>Структура набора данных
Раздел **structure** необязателен. Он определяет схему набора данных. В нем содержится коллекция имен и типов данных столбцов. Используйте этот раздел, чтобы указать сведения о типах, которые используются для преобразования типов и сопоставления столбцов из источника в приемник.

В каждом столбце раздела structure содержатся следующие свойства.

Свойство | ОПИСАНИЕ | Обязательно для заполнения
-------- | ----------- | --------
name | Имя столбца. | Да
тип | Тип данных столбца. Фабрика данных поддерживает следующие промежуточные типы данных в качестве допустимых значений: **Int16, Int32, Int64, Single, Double, Decimal, Byte[], Boolean, String, Guid, Datetime, Datetimeoffset и Timespan**. | Нет
culture | Язык и региональные параметры на основе .NET, используемые, если указан тип .NET `Datetime` или `Datetimeoffset`. Значение по умолчанию — `en-us`. | Нет
свойства | Строка формата будет использоваться, если указан тип .NET `Datetime` или `Datetimeoffset`. Сведения о формате даты и времени см. в статье [Строки настраиваемых форматов даты и времени](https://docs.microsoft.com/dotnet/standard/base-types/custom-date-and-time-format-strings). | Нет

### <a name="example"></a>Пример
В следующем примере предполагается, что исходные данные большого двоичного объекта представлены в формате таблицы CSV, которая содержит три столбца: userid, name и lastlogindate. Они имеют типы Int64, String и Datetime. Данные представлены в пользовательском формате даты и времени (используются французские сокращения дней недели).

Определите структуру набора данных большого двоичного объекта и укажите определения типов столбцов, как показано ниже:

```json
"structure":
[
    { "name": "userid", "type": "Int64"},
    { "name": "name", "type": "String"},
    { "name": "lastlogindate", "type": "Datetime", "culture": "fr-fr", "format": "ddd-MM-YYYY"}
]
```

### <a name="guidance"></a>Руководство

Используйте приведенные ниже рекомендации и узнайте, когда следует включать сведения о структуре, а также что должен содержать раздел **structure**. Ознакомьтесь со статьей [Сопоставление схем в действии копирования](copy-activity-schema-and-type-mapping.md), чтобы узнать больше о том, как фабрика данных сопоставляет исходные данные с данными приемника и когда необходимо указывать сведения о структуре.

- **Для жестко структурированных источников данных** добавьте раздел structure только в том случае, если нужно сопоставить столбцы источника со столбцами приемника и если их имена отличаются. Этот тип структурированного источника данных хранит схему данных и сведения о типе, а также сами данные. Примерами структурированных источников данных являются SQL Server, Oracle и база данных SQL Azure.<br/><br/>Для структурированных источников данных информация о типах уже доступна, поэтому ее не следует включать при добавлении раздела structure.
- **Для источников данных без схемы или частично структурированных источников данных (например, текстовых файлов в хранилище BLOB-объектов)** добавьте этот раздел, если в наборе содержатся входные данные для действия копирования и типы данных исходного набора нужно преобразовать в собственные типы для приемника. Кроме того, раздел structure добавляется, если нужно сопоставить столбцы источника со столбцами приемника.

## <a name="create-datasets"></a>Создание наборов данных
Наборы данных можно создавать с помощью таких инструментов и пакетов SDK: [API .NET](quickstart-create-data-factory-dot-net.md), [PowerShell](quickstart-create-data-factory-powershell.md), [REST API](quickstart-create-data-factory-rest-api.md), шаблон Azure Resource Manager, портал Azure.

## <a name="current-version-vs-version-1-datasets"></a>Наборы данных текущей версии и версии 1

Ниже приведены некоторые различия между наборами данных службы "Фабрика данных" текущей версии и версии 1.

- Внешнее свойство не поддерживается в текущей версии. Оно заменено [триггером](concepts-pipeline-execution-triggers.md).
- Политики и свойства доступности не поддерживаются в текущей версии. Время начала конвейера зависит от [триггеров](concepts-pipeline-execution-triggers.md).
- Наборы данных с заданной областью (наборы данных, определенные в конвейере) не поддерживаются в текущей версии.

## <a name="next-steps"></a>Дальнейшие действия
Пошаговые инструкции по созданию конвейеров и наборов данных с помощью одного из указанных ниже инструментов или пакетов SDK приведены в указанных ниже руководствах.

- [Создание фабрики данных и конвейера с помощью пакета SDK для .NET](quickstart-create-data-factory-dot-net.md)
- [Создание фабрики данных и конвейера с помощью пакета PowerShell](quickstart-create-data-factory-powershell.md)
- [Создание фабрики данных Azure и конвейера с помощью REST API](quickstart-create-data-factory-rest-api.md)
- Краткое руководство по созданию фабрики данных с помощью портала Azure
