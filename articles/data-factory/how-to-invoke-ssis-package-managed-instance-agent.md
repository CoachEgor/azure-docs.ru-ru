---
title: Запуск пакетов служб SSIS с помощью агента Управляемый экземпляр Базы данных SQL Azure
description: Узнайте, как запускать пакеты служб SSIS с помощью агента Управляемый экземпляр Базы данных SQL Azure.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.author: lle
author: lle
ms.date: 04/14/2020
ms.openlocfilehash: fcbfeb5ab3a3a80fdb8f7e355f290451d4afe804
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82144807"
---
# <a name="run-ssis-packages-by-using-azure-sql-database-managed-instance-agent"></a>Запуск пакетов служб SSIS с помощью агента Управляемый экземпляр Базы данных SQL Azure
В этой статье описывается, как запустить пакет SQL Server Integration Services (SSIS) с помощью агента Управляемый экземпляр Базы данных SQL Azure. Эта функция обеспечивает поведение, аналогичное планированию пакетов служб SSIS с помощью агент SQL Server в локальной среде.

С помощью этой функции можно запускать пакеты служб SSIS, хранящиеся в SSISDB, в управляемом экземпляре базы данных SQL Azure или файловой системе, например в службе файлов Azure.

## <a name="prerequisites"></a>Предварительные условия
Чтобы использовать эту функцию, [Скачайте](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017) и установите последнюю версию SQL Server Management Studio (SSMS), которая является версией 18,5.

Также необходимо выполнить [инициализацию среды выполнения интеграции Azure SSIS](tutorial-create-azure-ssis-runtime-portal.md) в фабрике данных Azure. В нем используется управляемый экземпляр базы данных SQL Azure в качестве сервера конечной точки. 

## <a name="run-an-ssis-package-in-ssisdb"></a>Запуск пакета служб SSIS в SSISDB
В этой процедуре для вызова пакета служб SSIS, хранящегося в SSISDB, используется агент Управляемый экземпляр Базы данных SQL Azure.

1. В последней версии SSMS подключитесь к управляемому экземпляру базы данных SQL Azure.
1. Создайте новое задание агента и новый шаг задания. В разделе **Агент SQL Server**щелкните правой кнопкой мыши папку **задания** и выберите команду **создать задание**.

   ![Параметры для создания нового задания агента](./media/how-to-invoke-ssis-package-managed-instance-agent/new-agent-job.png)

1. На странице **Создание шага задания** выберите **SQL Server Integration Services пакет** в качестве типа.

   ![Параметры для создания нового шага задания служб SSIS](./media/how-to-invoke-ssis-package-managed-instance-agent/new-ssis-job-step.png)

1. На вкладке **пакет** выберите **Каталог служб SSIS** в качестве типа источника пакета.
1. Поскольку SSISDB находится в управляемом экземпляре базы данных SQL Azure, указывать проверку подлинности не требуется.
1. Укажите пакет служб SSIS из SSISDB.

   ![Вкладка "пакет" с выбранными параметрами для типа источника пакета](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-ssisdb.png)

1. На вкладке **Конфигурация** можно выполнить следующие действия.
  
   - Укажите значения параметров в разделе **Параметры**.
   - Переопределите значения в разделе **Диспетчеры соединений**.
   - Переопределите свойство и выберите уровень ведения журнала в разделе **Дополнительно**.

   ![Вкладка "Конфигурация" с выбранными параметрами для типа источника пакета](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-ssisdb-configuration.png)

1. Нажмите кнопку **ОК** , чтобы сохранить конфигурацию задания агента.
1. Запустите задание агента для запуска пакета служб SSIS.


## <a name="run-an-ssis-package-in-the-file-system"></a>Запуск пакета служб SSIS в файловой системе
В этой процедуре для запуска пакета служб SSIS, хранящегося в файловой системе, используется агент Управляемый экземпляр Базы данных SQL Azure.

1. В последней версии SSMS подключитесь к управляемому экземпляру базы данных SQL Azure.
1. Создайте новое задание агента и новый шаг задания. В разделе **Агент SQL Server**щелкните правой кнопкой мыши папку **задания** и выберите команду **создать задание**.

   ![Параметры для создания нового задания агента](./media/how-to-invoke-ssis-package-managed-instance-agent/new-agent-job.png)

1. На странице **Создание шага задания** выберите **SQL Server Integration Services пакет** в качестве типа.

   ![Параметры для создания нового шага задания служб SSIS](./media/how-to-invoke-ssis-package-managed-instance-agent/new-ssis-job-step.png)

1. На вкладке **пакет** выполните следующие действия.

   1. В качестве **источника пакета**выберите **Файловая система**.
   
   1. Для **типа источника файла**:   

      - Если пакет отправляется в службу файлов Azure, выберите **файловый ресурс Azure**.

        ![Параметры для типа источника файла](./media/how-to-invoke-ssis-package-managed-instance-agent/package-source-file-system.png)
      
        Путь к пакету — ** \\ <storage account name>.\<File.Core.Windows.NET файлового ресурса \<имя>имя пакета>. dtsx**.
      
        В разделе **учетные данные для доступа к файлу пакета**введите имя учетной записи и ключ учетной записи Azure, чтобы получить доступ к файлу Azure. Домен задается как **Azure**.

      - Если пакет передается в общую сетевую папку, выберите **Сетевая папка**.
      
        Путь к пакету — это UNC-путь к файлу пакета с расширением DTSX.
      
        Введите соответствующий домен, имя пользователя и пароль для доступа к файлу пакета сетевой папки.
   1. Если файл пакета зашифрован с помощью пароля, выберите **Шифрование пароль** и введите пароль.
1. На вкладке **конфигурации** введите путь к файлу конфигурации, если для запуска пакета служб SSIS требуется файл конфигурации.
1. На вкладке **Параметры выполнения** можно выбрать, следует ли использовать **проверку подлинности Windows** или **32-разрядную среду выполнения** для запуска пакета служб SSIS.
1. На вкладке **ведение журнала** можно выбрать путь к журналу и соответствующие учетные данные для доступа к журналу для хранения файлов журнала. По умолчанию путь к журналу совпадает с путем к папке пакета, а учетные данные для доступа к нему совпадают с учетными данными для доступа к пакету.
1. На вкладке **задать значения** можно ввести путь и значение свойства, чтобы переопределить свойства пакета.
 
   Например, чтобы переопределить значение пользовательской переменной, введите ее путь в следующем формате: **\паккаже.вариаблес [пользователь:<variable name>:]. Значение**.
1. Нажмите кнопку **ОК** , чтобы сохранить конфигурацию задания агента.
1. Запустите задание агента для запуска пакета служб SSIS.


## <a name="cancel-ssis-package-execution"></a>Отмена выполнения пакета служб SSIS
Чтобы отменить выполнение пакета из задания агента Управляемый экземпляр Базы данных SQL Azure, выполните следующие действия вместо непосредственной остановки задания агента.

1. Найдите **Агент SQL** Server с помощью базы данных **msdb. dbo. sysjobs**.
1. Найдите соответствующую **executionId** служб SSIS на основе идентификатора задания, используя следующий запрос:
   ```sql
   select * from ssisdb.internal.execution_parameter_values_noncatalog where  parameter_value = 'SQL_Agent_Job_{jobId}' order by execution_id desc
   ```
1. Щелкните правой кнопкой мыши каталог SSISDB и выберите **Активные операции**.

   !["Активные операции" в контекстном меню для каталога SSISDB](./media/how-to-invoke-ssis-package-managed-instance-agent/catalog-active-operations.png)

1. Останавливает соответствующую операцию на основе **executionId**.

## <a name="next-steps"></a>Дальнейшие шаги
Вы также можете планировать пакеты служб SSIS с помощью фабрики данных Azure. Пошаговые инструкции см. в разделе [триггер событий фабрики данных Azure](how-to-create-event-trigger.md). 