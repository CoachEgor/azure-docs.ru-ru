---
title: Совокупная трансформация в потоке данных отображения
description: Узнайте, как агрегировать данные в масштабе на фабрике данных Azure с преобразованием потока данных отображения.
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 03/24/2020
ms.openlocfilehash: 1830a16108e6d8bb251d7ca45ae471e2f606874b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80240579"
---
# <a name="aggregate-transformation-in-mapping-data-flow"></a>Совокупная трансформация в потоке данных отображения 

Совокупная трансформация определяет агрегирование столбцов в потоках данных. С помощью expression Builder можно определить различные типы агрегаций, такие как SUM, MIN, MAX и COUNT, сгруппированные по существующим или вычисленному столбцу.

## <a name="group-by"></a>Group by

Выберите существующий столбец или создайте новый вычисленный столбец для использования в качестве группы за положением для агрегации. Чтобы использовать существующий столбец, выберите его из выпадающего. Чтобы создать новый вычисленный столбец, нависните над оговоркой и нажмите **вычисляемый столбец.** Это открывает [строитель выражения потока данных.](concepts-data-flow-expression-builder.md) Как только вы создадите вычисленный столбец, введите имя выходного столбца под **именем в качестве** поля. Если вы хотите добавить дополнительную группу за положением, нависните над существующей оговоркой и нажмите значок plus.

![Агрегируйте группу преобразования по параметрам](media/data-flow/agg.png "Агрегируйте группу преобразования по параметрам")

Группа за положением не является обязательной в преобразовании агрегата.

## <a name="aggregate-column"></a>Агрегированный столбец 

Перейдите на вкладку **Агрегаты** для создания выражений агрегирования. Можно либо перезаписать существующую колонку с агрегацией, либо создать новое поле с новым именем. Выражение агрегации вводится в правую коробку рядом с селектора имени столбца. Чтобы отсеять выражение, нажмите на текстовое поле, чтобы открыть разъяснение. Чтобы добавить дополнительные агрегации, нависните над существующим выражением и нажмите плюс значок, чтобы создать новый столбец агрегации или [шаблон столбца.](concepts-data-flow-column-pattern.md)

Каждое выражение агрегации должно содержать по крайней мере одну агрегированную функцию.

![Агрегированные настройки агрегированных преобразований](media/data-flow/agg2.png "Агрегированные настройки агрегированных преобразований")


> [!NOTE]
> В режиме Debug раздувание не может производить предварительные данные с агрегированными функциями. Для просмотра предварительных данных для агрегированных преобразований закройте систему выражения и просмотрите данные через вкладку "Предварительный просмотр данных".

## <a name="reconnect-rows-and-columns"></a>Переподключение строк и столбцов

Совокупные преобразования аналогичны агрегированным запросам выбора S'L. Столбцы, которые не включены в группу по положениям или агрегированным функциям, не будут просачьться к выходу агрегированной трансформации. Если вы хотите включить другие столбцы в агрегированный вывод, сделайте один из следующих методов:

* Используйте агрегированную функцию, такую как `last()` или `first()` включите дополнительный столбец.
* Присоединитесь к столбцов к выходу потока с помощью [шаблона самосоединения.](https://mssqldude.wordpress.com/2018/12/20/adf-data-flows-self-join/)

## <a name="removing-duplicate-rows"></a>Удаление дубликатов строк

Общее использование агрегированной трансформации — удаление или идентификация дублирующих записей в исходных данных. Этот процесс известен как deduplication. Основываясь на наборе группы по клавишам, используйте эвристику по вашему выбору, чтобы определить, какой дубликат строки держать. Общие `first()`эвристики, `last()` `max()` `min()`и . Используйте [шаблоны столбцов,](concepts-data-flow-column-pattern.md) чтобы применить правило ко всем столбцам, за исключением группы столбцов.

![Deduplication](media/data-flow/agg-dedupe.png "Дедупликация") (Дедупликация)

В приведенном выше `ProductID` примере столбцы используются `Name` для группировки. Если две строки имеют одинаковые значения для этих двух столбцов, они считаются дубликатами. В этом совокупном преобразовании значения первого ряда совпадают, а все остальные будут удалены. Используя синтаксис шаблона столбцов, все `ProductID` `Name` столбцы, имена которых не являются и отображаются в их существующем имени столбца и с учетом значения первых совпадающих строк. Схема вывода такая же, как и схема ввода.

Для сценариев проверки данных `count()` функция может использоваться для подсчета количества дубликатов.

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream>
    aggregate(
           groupBy(
                <groupByColumnName> = <groupByExpression1>,
                <groupByExpression2>
               ),
           <aggregateColumn1> = <aggregateExpression1>,
           <aggregateColumn2> = <aggregateExpression2>,
           each(
                match(matchExpression),
                <metadataColumn1> = <metadataExpression1>,
                <metadataColumn2> = <metadataExpression2>
               )
          ) ~> <aggregateTransformationName>
```

### <a name="example"></a>Пример

Ниже приведен приведен входящий `MoviesYear` поток и группируется по столбцам. `year` Преобразование создает `avgrating` агрегированный столбец, `Rating`который оценивает среднее значение столбца. Эта совокупная `AvgComedyRatingsByYear`трансформация называется .

В Data Factory UX это преобразование выглядит как приведенное ниже изображение:

![Группа за примером](media/data-flow/agg-script1.png "Группа за примером")

![Совокупный пример](media/data-flow/agg-script2.png "Совокупный пример")

Сценарий потока данных для этого преобразования находится в фрагменте ниже.

```
MoviesYear aggregate(
                groupBy(year),
                avgrating = avg(toInteger(Rating))
            ) ~> AvgComedyRatingByYear
```

## <a name="next-steps"></a>Дальнейшие действия

* Определение агрегации на основе окон с помощью [преобразования окна](data-flow-window.md)
