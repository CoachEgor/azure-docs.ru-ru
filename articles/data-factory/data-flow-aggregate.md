---
title: Преобразование "Статистическая обработка" в потоке данных сопоставления фабрики данных Azure
description: Узнайте, как агрегировать данные в фабрике данных Azure с помощью преобразования «Статистическая обработка потока данных сопоставления».
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 10/15/2019
ms.openlocfilehash: 3f21367c36ae31aa2115c109933a581bef464baf
ms.sourcegitcommit: 609d4bdb0467fd0af40e14a86eb40b9d03669ea1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2019
ms.locfileid: "73676911"
---
# <a name="aggregate-transformation-in-mapping-data-flow"></a>Преобразование "Статистическая обработка" в потоке данных сопоставления 

Преобразование «Статистическая обработка» определяет статистические выражения столбцов в потоках данных. С помощью построителя выражений можно определить различные типы агрегатов, такие как SUM, MIN, MAX и COUNT, сгруппированные по существующим или вычисляемым столбцам.

## <a name="group-by"></a>Группировать по

Выберите существующий столбец или создайте новый вычисляемый столбец для использования в качестве предложения GROUP BY для статистической обработки. Чтобы использовать существующий столбец, выберите его из раскрывающегося списка. Чтобы создать новый вычисляемый столбец, наведите указатель мыши на предложение и щелкните **вычисляемый столбец**. Откроется [Построитель выражений потока данных](concepts-data-flow-expression-builder.md). После создания вычисляемого столбца введите имя выходного столбца в поле **name as (имя** ). Если вы хотите добавить дополнительное предложение GROUP BY, наведите указатель мыши на существующее предложение и щелкните значок "плюс".

![Статистическая обработка группы преобразования по параметрам](media/data-flow/agg.png "Статистическая обработка группы преобразования по параметрам")

Предложение GROUP BY является необязательным в преобразовании «Статистическая обработка».

## <a name="aggregate-column"></a>Статистический столбец 

Перейдите на вкладку **статистические** выражения для построения статистических выражений. Можно либо перезаписать существующий столбец агрегатом, либо создать новое поле с новым именем. Выражение статистической обработки указывается в правом поле рядом с селектором имени столбца. Чтобы изменить выражение, щелкните текстовое поле, чтобы открыть построитель выражений. Чтобы добавить дополнительные агрегаты, наведите указатель мыши на существующее выражение и щелкните значок плюса, чтобы создать новый столбец статистической обработки или [шаблон столбца](concepts-data-flow-column-pattern.md).

Каждое статистическое выражение должно содержать по крайней мере одну агрегатную функцию.

![Агрегатные параметры преобразования "Статистическая обработка"](media/data-flow/agg2.png "Агрегатные параметры преобразования "Статистическая обработка"")


> [!NOTE]
> В режиме отладки построитель выражений не может создавать предварительные представления данных с агрегатными функциями. Чтобы просмотреть предварительные данные для преобразований «Статистическая обработка», закройте построитель выражений и просмотрите данные на вкладке «Предварительный просмотр данных».

## <a name="reconnect-rows-and-columns"></a>Повторное соединение строк и столбцов

Агрегатные преобразования похожи на статистические запросы SELECT SQL. Столбцы, не входящие в предложение GROUP BY или агрегатные функции, не будут передаваться в выходные данные преобразования «Статистическая обработка». Если вы хотите включить другие столбцы в агрегированные выходные данные, выполните один из следующих методов.

* Используйте агрегатную функцию, такую как `last()` или `first()`, чтобы включить этот дополнительный столбец.
* Повторно присоедините столбцы к выходному потоку, используя [шаблон самосоединения](https://mssqldude.wordpress.com/2018/12/20/adf-data-flows-self-join/).

## <a name="data-flow-script"></a>Сценарий потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream>
    aggregate(
           groupBy(
                <groupByColumnName> = <groupByExpression1>,
                <groupByExpression2>
               ),
           <aggregateColumn1> = <aggregateExpression1>,
           <aggregateColumn2> = <aggregateExpression2>,
           each(
                match(matchExpression),
                <metadataColumn1> = <metadataExpression1>,
                <metadataColumn2> = <metadataExpression2>
               )
          ) ~> <aggregateTransformationName>
```

### <a name="example"></a>Пример

Следующий пример принимает входящий поток `MoviesYear` и группирует строки по столбцам `year`. Преобразование создает статистический столбец `avgrating`, результатом которого является среднее `Rating`столбца. Это преобразование «Статистическая обработка» называется `AvgComedyRatingsByYear`.

В интерфейсе фабрики данных это преобразование выглядит как на изображении ниже:

![Пример группировки](media/data-flow/agg-script1.png "Пример группировки")

![Пример агрегирования](media/data-flow/agg-script2.png "Пример агрегирования")

Скрипт потока данных для этого преобразования находится в следующем фрагменте кода.

```
MoviesYear aggregate(
                groupBy(year),
                avgrating = avg(toInteger(Rating))
            ) ~> AvgComedyRatingByYear
```

## <a name="next-steps"></a>Дальнейшие действия

* Определение агрегирования на основе окон с помощью [преобразования «окно»](data-flow-window.md)
