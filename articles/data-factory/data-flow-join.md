---
title: Присоединиться к преобразованию в картографии потока данных
description: Объедините данные из двух источников данных, используя преобразование соединения в картографии Data Factory Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 01/02/2020
ms.openlocfilehash: 0c0e35f7f06afd0cafa4a1e353b7eda84ed226f2
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81413666"
---
# <a name="join-transformation-in-mapping-data-flow"></a>Присоединиться к преобразованию в картографии потока данных

[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

Используйте преобразование соединения для объединения данных из двух источников или потоков в потоке данных отображения. Поток вывода будет включать в себя все столбцы из обоих источников, совпадающие с условием соединения. 

## <a name="join-types"></a>Типы соединений

Потоки карт данных в настоящее время поддерживают пять различных типов соединений.

### <a name="inner-join"></a>Внутреннее соединение

Внутреннее соединение только строки выходов, которые имеют соответствующие значения в обеих таблицах.

### <a name="left-outer"></a>Левое внешнее соединение

Левый внешний соединится возвращает все строки из левого потока и совпадает записи из правого потока. Если строка из левого потока не совпадает, выводные столбцы из правого потока устанавливаются на NULL. Выходом будут строки, возвращенные внутренним соединением плюс непревзойденные строки из левого потока.

> [!NOTE]
> Двигатель Spark, используемый потоками данных, иногда выходит из строя из-за возможных декартовых продуктов в ваших условиях соединения. Если это происходит, вы можете переключиться на пользовательский крест соединения и вручную ввести условие соединения. Это может привести к снижению производительности потоков данных, так как движку выполнения может потребоваться вычислить все строки с обеих сторон связи, а затем фильтровать строки.

### <a name="right-outer"></a>Правое внешнее соединение

Правое внешнее соединение возвращает все строки из правого потока и совпадает записи из левого потока. Если строка из правого потока не совпадает, выходные столбцы из левого потока устанавливаются на NULL. Выходом будут строки, возвращенные внутренним соединением плюс непревзойденные строки из правого потока.

### <a name="full-outer"></a>Полное внешнее соединение

Полное внешнее соединение выводит все столбцы и строки с обеих сторон с значениями NULL для столбцов, которые не совпадают.

### <a name="custom-cross-join"></a>Пользовательские кросс-соединения

Кросс соединение выводит кросс-продукт двух потоков на основе состояния. Если вы используете условие, которое не является равным, укажите пользовательское выражение как условие соединения креста. Поток вывода будет все строки, которые отвечают условиесоединения.

Вы можете использовать этот тип соединения для ```OR``` не-экви-соединений и условий.

Если вы хотите явно произвести полный декартовый продукт, используйте преобразование производных столбцов в каждом из двух независимых потоков перед соединением, чтобы создать синтетический ключ, чтобы соответствовать. Например, создать новую колонку в derived Column в ```1```каждом потоке, который вызывается ```SyntheticKey``` и устанавливает его равным. Затем ```a.SyntheticKey == b.SyntheticKey``` используйте в качестве пользовательского выражения соединения.

> [!NOTE]
> Убедитесь в том, чтобы включить по крайней мере один столбец с каждой стороны от левой и правой отношения в пользовательских крест присоединиться. Выполнение кросса со статическими значениями вместо столбцов с каждой стороны приводит к полному сканированию всего набора данных, в результате чего поток данных работает плохо.

## <a name="configuration"></a>Конфигурация

1. Выберите, с каким потоком данных вы присоединяетесь в **падении правого потока.**
1. Выберите **тип соединения**
1. Выберите, какие ключевые столбцы вы хотите сопоставить для вас присоединиться к условию. По умолчанию поток данных ищет равенство между одним столбцом в каждом потоке. Для сравнения с помощью вычисленных значений нависнете над выпадением столбца и выберите **вычисленный столбец.**

![Присоединиться к трансформации](media/data-flow/join.png "Join")

## <a name="optimizing-join-performance"></a>Оптимизация производительности присоединения

В отличие от объединения в таких инструментах, как SSIS, преобразование соединения не является обязательной операцией соединения. Ключи соединения не требуют сортировки. Операция соединения происходит на основе оптимальной операции соединения в Spark, либо трансляции или карты стороне соединения.

![Оптимизация преобразования](media/data-flow/joinoptimize.png "Присоединиться к оптимизации")

Если один или оба потока данных вписываются в память об узлах рабочего узла, дальнейшая оптимизация производительности путем включения **вещания** во вкладке оптимизации. Вы также можете переразделить данные в операции соединения, чтобы они лучше вписывались в память на одного работника.

## <a name="self-join"></a>Самосоединение

Самостоятельное соединение потока данных с самим собой, под псевдонимом существующий поток с выбранным преобразованием. Создайте новую ветку, нажав на значок plus рядом с преобразованием и выбрав **новую ветку.** Добавьте выбранное преобразование в псевдоним исходный поток. Добавьте преобразование соединения и выберите исходный поток в качестве **левого потока** и выбранное преобразование в качестве **правого потока.**

![Самосоединение](media/data-flow/selfjoin.png "Самосоединение")

## <a name="testing-join-conditions"></a>Условия тестирования соединения

При тестировании преобразований соединения с предварительным просмотром данных в режиме отладки используйте небольшой набор известных данных. При выборке строк из большого набора данных нельзя предсказать, какие строки и клавиши будут считываться для тестирования. Результат не детерминирован, что означает, что условия соединения не могут вернуть совпадения.

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<leftStream>, <rightStream>
    join(
        <conditionalExpression>,
        joinType: { 'inner'> | 'outer' | 'left_outer' | 'right_outer' | 'cross' }
        broadcast: { 'none' | 'left' | 'right' | 'both' }
    ) ~> <joinTransformationName>
```

### <a name="inner-join-example"></a>Пример внутреннего соединения

Ниже приведена преобразование `JoinMatchedData` соединения, `TripData` названное, которое занимает левый поток и правый поток. `TripFare`  Условие соединения является `hack_license == { hack_license} && TripData@medallion == TripFare@medallion && vendor_id == { vendor_id} && pickup_datetime == { pickup_datetime}` выражением, которое `medallion` `vendor_id`возвращается `pickup_datetime` `hack_license`верно, если , , и столбцы в каждом потоке совпадают. Значение параметра `joinType` — `'inner'`. Мы включим вещание только в `broadcast` левом `'left'`потоке, так что имеет значение .

В Data Factory UX это преобразование выглядит как приведенное ниже изображение:

![Присоединиться к примеру](media/data-flow/join-script1.png "Присоединиться к примеру")

Сценарий потока данных для этого преобразования находится в фрагменте ниже:

```
TripData, TripFare
    join(
        hack_license == { hack_license}
        && TripData@medallion == TripFare@medallion
        && vendor_id == { vendor_id}
        && pickup_datetime == { pickup_datetime},
        joinType:'inner',
        broadcast: 'left'
    )~> JoinMatchedData
```

### <a name="custom-cross-join-example"></a>Пользовательский пример соединения креста

Ниже приведена преобразование `JoiningColumns` соединения, `LeftStream` названное, которое занимает левый поток и правый поток. `RightStream` Это преобразование принимает в двух потоках и `leftstreamcolumn` объединяет все `rightstreamcolumn`строки, где столбец больше, чем столбец. Значение параметра `joinType` — `cross`. Вещание не `broadcast` включено `'none'`имеет значение.

В Data Factory UX это преобразование выглядит как приведенное ниже изображение:

![Присоединиться к примеру](media/data-flow/join-script2.png "Присоединиться к примеру")

Сценарий потока данных для этого преобразования находится в фрагменте ниже:

```
LeftStream, RightStream
    join(
        leftstreamcolumn > rightstreamcolumn,
        joinType:'cross',
        broadcast: 'none'
    )~> JoiningColumns
```

## <a name="next-steps"></a>Дальнейшие действия

После присоединения к данным создайте [производный столбец](data-flow-derived-column.md) и [погрузите](data-flow-sink.md) данные в хранилище данных назначения.
