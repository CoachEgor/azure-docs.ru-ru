---
title: Дрейф схемы в потоке картданных данных
description: Создание устойчивых потоков данных со смещением схемы в Фабрике данных Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 09/12/2019
ms.openlocfilehash: 9daf7973a2e48f866a8d0b93a682851d31dc3af7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74928556"
---
# <a name="schema-drift-in-mapping-data-flow"></a>Дрейф схемы в потоке картданных данных

Schema дрейф является тот случай, когда ваши источники часто меняют метаданные. Поля, столбцы и типы могут быть добавлены, удалены или изменены на лету. Без обработки для дрейфа схемы поток данных становится уязвимым для изменений источника данных вверх по течению. Типичные шаблоны ETL терпят неудачу при изменении входящих столбцов и полей, поскольку они, как правило, привязаны к этим именам источников.

Для защиты от дрейфа схем ы и средств в инструменте потока данных необходимо, чтобы вы, как инженер данных, могли:

* Определение источников, которые имеют изменяемые названия полей, типы данных, значения и размеры
* определять параметры преобразования, которые могут работать с шаблонами данных вместо жестко закодированных полей и значений;
* определять выражения, которые распознают шаблоны для сопоставления входящих полей вместо использования именованных полей.

Фабрика данных Azure намеренно поддерживает гибкие схемы, которые изменяются от выполнения к исполнению, чтобы можно было построить общую логику преобразования данных без необходимости перекомпилировать потоки данных.

Необходимо реализовать в потоке данных архитектурное решение, чтобы принимать смещение схемы по всему потоку. При этом можно защититься от изменений схемы, поступающих из источников. Тем не менее, вы потеряете раннюю связывание столбцов и типов во всем потоке данных. Azure Data Factory рассматривает потоки дрейфа схем как потоки с опозданием, поэтому при построении преобразований имена дрейфующих столбцов не будут доступны вам в представлениях схемы на протяжении всего потока.

## <a name="schema-drift-in-source"></a>Схема дрейфа в источнике

Столбцы, поступающие в поток данных из определения исходного кода, определяются как "дрифт", когда они не присутствуют в исходной проекции. Вы можете просмотреть исходную проекцию из вкладки проекции в преобразовании источника. При выборе набора данных для источника ADF автоматически заберет схему из набора данных и создаст проект из определения схемы набора данных.

В преобразовании источника дрейф схемы определяется как столбцы чтения, которые не определены в схеме набора данных. Чтобы включить дрейф схемы, проверьте **Разрешить дрифт схемы** в преобразовании источника.

![Источник дрейфа схемы](media/data-flow/schemadrift001.png "Источник дрейфа схемы")

Когда дрифт схемы включен, все входящие поля считываются из вашего источника во время выполнения и передаются через весь поток в раковину. По умолчанию все недавно обнаруженные столбцы, известные как *дрейфуенные столбцы,* поступают как тип данных строки. Если вы хотите, чтобы поток данных автоматически вынисхвал типы данных дрейфующих столбцов, проверьте **типы исходных столбцов Infer** в настройках исходного кода.

## <a name="schema-drift-in-sink"></a>Схема дрейфа в раковине

В преобразовании раковины дрейф схемы — это когда вы пишете дополнительные столбцы поверх того, что определено в схеме данных раковины. Для обеспечения дрейфа схемы проверьте **дрейф схемы** в преобразовании раковины.

![Схема дрейф раковина](media/data-flow/schemadrift002.png "Схема дрейф раковина")

Если дрифт схемы включена, убедитесь, что ползунок **автоматического отображения** в вкладке Mapping включен. С помощью этого слайдера все входящие столбцы записываются к месту назначения. В противном случае для записи дрейфующих столбцов необходимо использовать картографическое на основе правил.

![Раковина автоматическое отображение](media/data-flow/automap.png "Раковина автоматическое отображение")

## <a name="transforming-drifted-columns"></a>Преобразование дрейфующих колонн

Когда поток данных дрейфовал столбцы, вы можете получить к ним доступ в преобразованиях следующими методами:

* Используйте `byPosition` `byName` и выражения, чтобы явно ссылаться на столбец по имени или номеру положения.
* Добавьте шаблон столбца в производный столбец или агрегирование преобразования в соответствии с любой комбинацией имени, потока, положения или типа
* Добавление картирования на основе правил в преобразование Select или Sink для сопоставления дрейфующих столбцов с псевдонимами столбцов с помощью шаблона

Для получения дополнительной информации о том, как реализовать шаблоны столбцов, см. [шаблоны столбцов в картографии потока данных.](concepts-data-flow-column-pattern.md)

### <a name="map-drifted-columns-quick-action"></a>Карта дрейфующих столбцов быстрого действия

Для явного упоминания дрейфующих столбцов можно быстро генерировать отображения для этих столбцов с помощью быстрого предварительного просмотра данных. После того, как [режим отладки](concepts-data-flow-debug-mode.md) будет начат, перейдите на вкладку Data Preview и нажмите **Refresh,** чтобы получить предварительный просмотр данных. Если фабрика данных обнаруживает, что существуют дрейфующие столбцы, можно нажать **на карту Drifted** и создать производный столбец, который позволяет ссылаться на все дрейфующие столбцы в представлениях схемы вниз по течению.

![Карта дрейфовала](media/data-flow/mapdrifted1.png "Карта дрейфовала")

При преобразовании полученной колонки каждая дрейфующая колонка отображается с обнаруженным именем и типом данных. В приведенном выше предварительном просмотре приведены данные, столбец 'movieId' обнаруживается как целый ряд. После **нажатия карты Drifted,** movieId определяется в `toInteger(byName('movieId'))` производном столбце как и включен в представления схемы в преобразованиях вниз по течению.

![Карта дрейфовала](media/data-flow/mapdrifted2.png "Карта дрейфовала")

## <a name="next-steps"></a>Дальнейшие действия
На [языке выражения потока данных](data-flow-expression-functions.md)вы найдете дополнительные возможности для шаблонов столбцов и дрейфа схем, включая "byName" и "byPosition".
