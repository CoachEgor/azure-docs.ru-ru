---
title: Смещение схемы в потоке данных сопоставления | Фабрика данных Azure
description: Создание устойчивых потоков данных со смещением схемы в Фабрике данных Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 09/12/2019
ms.openlocfilehash: 5eff92352251febca1d4e7033618372dc929d987
ms.sourcegitcommit: 11265f4ff9f8e727a0cbf2af20a8057f5923ccda
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/08/2019
ms.locfileid: "72029405"
---
# <a name="schema-drift-in-mapping-data-flow"></a>Смещение схемы в потоке данных сопоставления



Смещение схемы — это случай, когда источники часто изменяют метаданные. Поля, столбцы и типы можно добавлять, удалять или изменять в режиме реального времени. Без обработки смещения схемы поток данных становится уязвимым для вышестоящего изменения источника данных. Стандартные шаблоны ETL завершаются ошибкой при изменении входящих столбцов и полей, так как они обычно привязаны к этим именам источников.

Для защиты от смещения схемы важно, чтобы средства потока данных позволяли разработчикам данных выполнять следующие задачи:

* Определение источников с изменяемыми именами полей, типами данных, значениями и размерами
* определять параметры преобразования, которые могут работать с шаблонами данных вместо жестко закодированных полей и значений;
* определять выражения, которые распознают шаблоны для сопоставления входящих полей вместо использования именованных полей.

Фабрика данных Azure изначально поддерживает гибкие схемы, которые изменяют выполнение до выполнения, чтобы можно было создавать логику универсального преобразования данных без необходимости перекомпиляции потоков данных.

Необходимо реализовать в потоке данных архитектурное решение, чтобы принимать смещение схемы по всему потоку. При этом можно защититься от изменений схемы, поступающих из источников. Однако в потоке данных будет происходить раннее связывание столбцов и типов. Фабрика данных Azure считает, что смещение схемы проходит в виде потоков с поздним связыванием, поэтому при построении преобразований имена столбцов с несмещенными данными не будут доступны в представлениях схемы во всей последовательности.

## <a name="schema-drift-in-source"></a>Смещение схемы в источнике

В преобразовании «источник» смещение схемы определяется как считывание столбцов, которые не определяют схему набора данных. Чтобы включить отклонение схемы, установите флажок **Разрешить смещение схемы** в преобразовании источника.

![](media/data-flow/schemadrift001.png "Источник смещения схемы") источника отклонения схемы

Если параметр «смещение схемы» включен, все входящие поля считываются из источника во время выполнения и передаются по всему потоку в приемник. По умолчанию все вновь обнаруженные столбцы, известные как *смещенные столбцы*, поступают в виде строкового типа данных. Если вы хотите, чтобы поток данных автоматически высчитал типы данных со смещенными столбцами, установите флажок **определить типы столбцов** с отклонениями в исходных параметрах.

## <a name="schema-drift-in-sink"></a>Смещение схемы в приемнике

В преобразовании «приемник» смещение схемы происходит при записи дополнительных столбцов поверх того, что определено в схеме данных приемника. Чтобы включить отклонение схемы, установите флажок **Разрешить смещение схемы** в преобразовании приемника.

(media/data-flow/schemadrift002.png "Приемник смещения схемы") ![приемника смещения схемы]

Если параметр «смещение схемы» включен, убедитесь, что ползунок « **Автоматическое сопоставление** » на вкладке «Сопоставление» включен. Если этот ползунок включен, все входящие столбцы записываются в назначение. В противном случае для записи смещенных столбцов необходимо использовать сопоставление на основе правил.

(media/data-flow/automap.png "Автоматическое сопоставление") приемника ![автоматического сопоставления приемника]

## <a name="transforming-drifted-columns"></a>Преобразование смещенных столбцов

Если в потоке данных имеются смещенные столбцы, к ним можно получить доступ в преобразованиях с помощью следующих методов:

* Используйте выражения `byPosition` и `byName` для явной ссылки на столбец по имени или номеру расположения.
* Добавление шаблона столбца в производный столбец или преобразование «Статистическая обработка» для сопоставления с любым сочетанием имени, потока, расположения или типа
* Добавление сопоставления на основе правил в преобразовании «выбор» или «приемник» для сопоставления смещенных столбцов и псевдонимов столбцов с помощью шаблона

Дополнительные сведения о реализации шаблонов столбцов см. [в разделе Шаблоны столбцов в потоке данных сопоставления](concepts-data-flow-column-pattern.md).

### <a name="map-drifted-columns-quick-action"></a>Быстрое действие "связать смещенные столбцы"

Чтобы явно ссылаться на смещенные столбцы, можно быстро создавать сопоставления для этих столбцов с помощью быстрого действия "предварительный просмотр данных". Когда [режим отладки](concepts-data-flow-debug-mode.md) включен, перейдите на вкладку Предварительный просмотр данных и нажмите кнопку **Обновить** , чтобы получить предварительную версию данных. Если фабрика данных обнаруживает, что смещенные столбцы существуют, можно щелкнуть элемент раскрытие **карт** и создать производный столбец, который позволяет ссылаться на все смещенные столбцы в представлениях схемы в нисходящем направлении.

Пересмещенная(media/data-flow/mapdrifted1.png "Таблица") с ![смещенным смещением]

В созданном преобразовании «Производный столбец» каждый смещенный столбец сопоставляется с его обнаруженным именем и типом данных. В приведенном выше предварительном просмотре данных столбец "Мовиеид" определяется как целое число. После нажатия кнопки « **смещенная таблица** » мовиеид определяется в производном столбце как `toInteger(byName('movieId'))` и включается в представления схемы в нисходящих преобразованиях.

Пересмещенная(media/data-flow/mapdrifted2.png "Таблица") с ![смещенным смещением]

## <a name="next-steps"></a>Следующие шаги
В [языке выражений потока данных](data-flow-expression-functions.md)вы найдете дополнительные средства для шаблонов столбцов и смещения схем, включая "бинаме" и "бипоситион".
