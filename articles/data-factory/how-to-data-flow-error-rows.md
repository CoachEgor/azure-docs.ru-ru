---
title: Обработку строк ошибок с сопоставлением потоков данных в фабрике данных Azure
description: Узнайте, как выполнять обработку ошибок усечения SQL в фабрике данных Azure с помощью сопоставления потоков данных.
services: data-factory
author: kromerm
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 04/20/2020
ms.author: makromer
ms.openlocfilehash: 3f8ac2d1434019548b01d8468015a543d89d0fba
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "85254418"
---
# <a name="handle-sql-truncation-error-rows-in-data-factory-mapping-data-flows"></a>Обработку строк ошибок усечения SQL в потоках данных сопоставления фабрики данных

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Распространенный сценарий в фабрике данных при использовании сопоставления потоков данных заключается в записи преобразованных данных в базу данных в базе данных SQL Azure. В этом сценарии распространенным условием ошибки, которое необходимо предотвратить, является усечение столбца. Выполните следующие действия, чтобы вести журнал столбцов, которые не помещаются в целевой строковый столбец, что позволяет потоку данных продолжить работу в этих сценариях.

## <a name="scenario"></a>Сценарий

1. У нас есть таблица целевой базы данных, которая содержит столбец с именем ```nvarchar(5)``` Name.

2. Внутри нашего потока данных мы хотим сопоставлять названия фильмов из нашего приемника с этим целевым столбцом "Name".

    ![Поток данных фильмов 1](media/data-flow/error4.png)
    
3. Проблема заключается в том, что заголовок фильма не умещается в столбце приемника, в котором может содержаться только 5 символов. При выполнении этого потока данных появится сообщение об ошибке следующего вида: ```"Job failed due to reason: DF-SYS-01 at Sink 'WriteToDatabase': java.sql.BatchUpdateException: String or binary data would be truncated. java.sql.BatchUpdateException: String or binary data would be truncated."```

В этом видео рассматривается пример логики обработки строк ошибок в потоке данных.
> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4uOHj]

## <a name="how-to-design-around-this-condition"></a>Как создать обход этого условия

1. В этом сценарии максимальная длина столбца "Name" составляет пять символов. Итак, добавим преобразование «Условное разбиение», которое позволит нам записывать строки с «заголовками», длина которых превышает пять символов, одновременно позволяя остальным строкам, которые могут поместиться в это пространство, записываться в базу данных.

    ![условное разбиение](media/data-flow/error1.png)

2. Это преобразование "Условное разбиение" определяет максимальную длину "Title", которая должна быть пятью. Любая строка, которая меньше или равна 5, перейдет в ```GoodRows``` поток. Любая строка, превышающая пять, перейдет в ```BadRows``` поток.

3. Теперь нужно регистрировать строки, на которые произошел сбой. Добавьте преобразование приемника в ```BadRows``` поток для ведения журнала. Здесь мы будем «автоmap» все поля, чтобы мы зарегистрировали полную запись транзакции. Это файловый выход CSV-файла, разделенный текстом, в один файл в хранилище больших двоичных объектов. Мы назовем файл журнала «badrows.csv».

    ![Неправильные строки](media/data-flow/error3.png)
    
4. Завершенный поток данных показан ниже. Теперь можно разделить строки ошибок, чтобы избежать ошибок усечения SQL и поместить эти записи в файл журнала. В то же время успешные строки могут продолжать записывать в нашу целевую базу данных.

    ![завершение потока данных](media/data-flow/error2.png)

## <a name="next-steps"></a>Дальнейшие действия

* Создайте оставшуюся часть логики потока данных с помощью [преобразования потоков данных](concepts-data-flow-overview.md)сопоставления.
