---
title: Система управления версиями
description: Узнайте, как настроить систему управления версиями в фабрике данных Azure.
services: data-factory
ms.service: data-factory
ms.workload: data-services
author: djpmsft
ms.author: daperlov
manager: anandsub
ms.reviewer: ''
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 04/30/2020
ms.openlocfilehash: f327844be57d7f8e177f3bf72b1e3b56c5147e00
ms.sourcegitcommit: 1895459d1c8a592f03326fcb037007b86e2fd22f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2020
ms.locfileid: "82629343"
---
# <a name="source-control-in-azure-data-factory"></a>Система управления версиями в фабрике данных Azure
[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

По умолчанию авторы пользовательского интерфейса фабрики данных Azure (UX) непосредственно применяют службу фабрики данных. Этот интерфейс имеет следующие ограничения.

- Служба фабрики данных не содержит репозиторий для хранения сущностей JSON для изменений. Единственный способ сохранить изменения — с помощью кнопки **опубликовать все** , и все изменения публикуются непосредственно в службе фабрики данных.
- Служба фабрики данных не оптимизирована для совместной работы и управления версиями.

Чтобы обеспечить лучшую работу по созданию, фабрика данных Azure позволяет настроить репозиторий Git с помощью Azure Repos или GitHub. Git — это система управления версиями, позволяющая упростить отслеживание изменений и совместную работу. В этом руководстве описано, как настроить и работать в репозитории Git вместе с рекомендациями и руководством по устранению неполадок.

> [!NOTE]
> Интеграция Git фабрики данных Azure недоступна в облаке Azure для государственных организаций.

## <a name="advantages-of-git-integration"></a>Преимущества интеграции Git

Ниже приведен список преимуществ, предоставляемых интеграцией Git для разработки.

-   **Система управления версиями:** По мере того как рабочие нагрузки фабрики данных станут критически важными, вам нужно интегрировать фабрику с Git, чтобы использовать несколько преимуществ системы управления версиями, как показано ниже:
    -   возможность отслеживания и аудита изменений;
    -   возможность отменить изменения, внесение которых привело к появлению ошибок.
-   **Частичные сохранения:** При разработке в службе фабрики данных нельзя сохранить изменения в виде черновика, и все публикации должны пройти проверку фабрики данных. Если конвейеры не завершены или вы просто не хотите потерять изменения в случае сбоя компьютера, интеграция с Git позволяет выполнять добавочные изменения ресурсов фабрики данных независимо от состояния, в котором они находятся. Настройка репозитория Git позволяет сохранять изменения, позволяя публиковать только после тестирования изменений в удовлетворении.
-   **Совместная работа и управление:** При наличии нескольких членов группы, участвующих в одной фабрике, может потребоваться совместная работа коллег друг с другом с помощью процесса проверки кода. Вы также можете настроить фабрику так, чтобы не у каждого участника были одинаковые разрешения. Некоторые члены команды могут вносить изменения только через Git, и только определенные сотрудники группы могут публиковать изменения в фабрике.
-   **Улучшенная непрерывная интеграция и компакт-диск:**  При развертывании в нескольких средах с [непрерывной поставкой](continuous-integration-deployment.md)интеграция с Git упрощает определенные действия. Ниже перечислены некоторые из этих действий.
    -   Настройте конвейер выпуска для автоматического запуска, как только изменения, внесенные в фабрику разработки.
    -   Настройте свойства фабрики, доступные в качестве параметров в шаблоне диспетчер ресурсов. Может быть полезно сохранить в качестве параметров только требуемый набор параметров, а все остальные параметры жестко закодировать.
-   **Повышенная производительность.** Среднее значение фабрики с интеграцией Git загружается в 10 раз быстрее, чем одна разработка для службы фабрики данных. Это улучшение производительности связано с тем, что ресурсы загружаются с помощью Git.

> [!NOTE]
> При настройке репозитория Git в службе "Фабрика данных Azure" отключена Непосредственная разработка службы фабрики данных. Изменения можно вносить непосредственно в службу с помощью PowerShell или пакета SDK.

## <a name="author-with-azure-repos-git-integration"></a>Разработка с помощью интеграции Git Azure Repos

Визуальная разработка с помощью интеграции Git Azure Repos поддерживает управление исходным кодом и совместную работу для создания конвейеров фабрики данных. Фабрику данных можно сопоставить с репозиторием организации Git Azure Repos для управления исходным кодом, совместной работы, управления версиями и т. д. В одной организации Git Azure Repos может быть несколько репозиториев, но репозиторий Git Azure Repos может быть связан только с одной фабрикой данных. Если у вас нет организации Azure Repos или репозитория, создайте их, следуя [этим инструкциям](https://docs.microsoft.com/azure/devops/organizations/accounts/create-organization-msa-or-work-student).

> [!NOTE]
> Вы можете хранить файлы данных и сценариев в репозитории Git Azure Repos. Но в службу хранилища Azure файлы необходимо отправлять вручную. Конвейер Фабрики данных автоматически не отправляет в службу хранилища Azure файлы данных и сценариев, которые хранятся в репозитории Git Azure Repos.

### <a name="configure-an-azure-repos-git-repository-with-azure-data-factory"></a>Настройка репозитория Git Azure Repos с помощью Фабрики данных Azure

Репозиторий Git Azure Repos можно настроить с помощью фабрики данных двумя способами.

#### <a name="configuration-method-1-azure-data-factory-home-page"></a>Метод конфигурации 1. Домашняя страница фабрики данных Azure

На домашней странице фабрики данных Azure выберите **настроить репозиторий кода**.

![Настройка репозитория кода Azure Repos](media/author-visually/configure-repo.png)

#### <a name="configuration-method-2-ux-authoring-canvas"></a>Метод 2. Пользовательский интерфейс "Работа над холстом"
На холсте разработки фабрики данных Azure выберите в раскрывающемся меню **фабрика данных** пункт **настроить репозиторий кода**.

![Настройка параметров репозитория кода для создания в пользовательском интерфейсе](media/author-visually/configure-repo-2.png)

Оба метода открывают панель конфигурации параметры репозитория.

![Настройка параметров репозитория кода](media/author-visually/repo-settings.png)

В области Конфигурация отображаются следующие Azure Repos параметры репозитория кода.

| Параметр | Описание | Значение |
|:--- |:--- |:--- |
| **Тип репозитория** | Тип репозитория кода Azure Repos.<br/> | Azure DevOps Git или GitHub |
| **Azure Active Directory** | Имя вашего клиента Azure AD. | `<your tenant name>` |
| **Организация Azure Repos** | Название вашей организации Azure Repos. Название организации Azure Repos можно найти по адресу `https://{organization name}.visualstudio.com`. [Войдите в свою организацию Azure Repos](https://www.visualstudio.com/team-services/git/) и получите доступ к профилю Visual Studio, чтобы просмотреть свои репозитории и проекты. | `<your organization name>` |
| **ProjectName** | Имя проекта Azure Repos. Имя проекта Azure Repos можно найти по адресу `https://{organization name}.visualstudio.com/{project name}`. | `<your Azure Repos project name>` |
| **RepositoryName** | Имя репозитория кода Azure Repos. Проекты Azure Repos содержат репозитории Git, которые управляют исходным кодом по мере роста проекта. Создайте репозиторий либо используйте репозиторий, который уже имеется в проекте. | `<your Azure Repos code repository name>` |
| **Ветвь совместной работы** | Ветвь вашей совместной работы в Azure Repos, которая используется для публикации. По умолчанию его `master`. Измените этот параметр, если нужно опубликовать ресурсы из другой ветви. | `<your collaboration branch name>` |
| **Корневая папка** | Корневая папка в ветви совместной работы Azure Repos. | `<your root folder name>` |
| **Import existing Data Factory resources to repository** (Импорт существующих ресурсов фабрики данных в репозиторий) | Указывает, следует ли импортировать имеющиеся ресурсы фабрики данных из пользовательского интерфейса **Работа над холстом** в репозиторий Git Azure Repos. Установите флажок, чтобы импортировать ресурсы фабрики данных в связанный репозиторий Git в формате JSON. Это действие экспортирует каждый ресурс по отдельности (то есть, связанные службы и наборы данных будут экспортироваться в отдельных файлах JSON). Если этот флажок не установлен, имеющиеся ресурсы не импортируются. | Установлен (по умолчанию) |
| **Branch to import resource into** (Ветвь для импорта ресурсов) | Указывает, в какую ветвь импортируются ресурсы фабрики данных (конвейеры, наборы данных, связанные службы и т.д.). Вы можете выбрать для импорта ресурсов один из следующих вариантов: 1) "Совместная работа"; 2) "Создать"; 3) "Использовать имеющуюся". |  |

> [!NOTE]
> Если вы используете Microsoft ребро и не видите никаких значений в раскрывающемся списке Учетная запись Azure DevOps, добавьте HTTPS://*. VisualStudio. com в список надежных сайтов.

### <a name="use-a-different-azure-active-directory-tenant"></a>Использование другого клиента Azure Active Directory

Репозиторий Git Azure Repos может находиться в другом клиенте Azure Active Directory. Чтобы указать другой клиент Azure AD, у вас должны быть права администратора для подписки Azure, которую вы используете.

### <a name="use-your-personal-microsoft-account"></a>Использование личной учетной записи Майкрософт

Чтобы использовать личную учетную запись Майкрософт для интеграции с Git, можно связать личный репозиторий Azure с Active Directory вашей организации.

1. Добавление личной учетной записи Майкрософт в Active Directory вашей организации в качестве гостя. Дополнительные сведения см. в статье [Добавление пользователей службы совместной работы B2B на портале Azure](../active-directory/b2b/add-users-administrator.md).

2. Войдите на портал Azure с помощью личной учетной записи Майкрософт. Перейдите в Active Directory вашей организации.

3. Перейдите к разделу Azure DevOps, где находится личный репозиторий. Выберите репозиторий и подключитесь к Active Directory.

После этих шагов настройки личный репозиторий доступен при настройке интеграции Git в пользовательском интерфейсе Фабрики данных.

Дополнительные сведения о подключении репозитория Azure Active Directory вашей организации см. в статье о [подключении организации Azure DevOps к Azure Active Directory](/azure/devops/organizations/accounts/connect-organization-to-azure-ad).

## <a name="author-with-github-integration"></a>Разработка с помощью интеграции GitHub

Визуальная разработка с помощью интеграции GitHub поддерживает управление исходным кодом и совместную работу для создания конвейеров фабрики данных. Фабрику данных можно связать с репозиторием учетной записи GitHub для управления исходным кодом, совместной работы и управления версиями. В одной учетной записи GitHub может быть несколько репозиториев, но репозиторий GitHub может быть связан только с одной фабрикой данных. Если у вас нет учетной записи GitHub или репозитория, следуйте [этим инструкциям](https://github.com/join) , чтобы создать ресурсы.

Интеграция GitHub с фабрикой данных поддерживает как общедоступный GitHub (т [https://github.com](https://github.com). е.), так и GitHub Enterprise. Вы можете использовать общедоступные и частные репозитории GitHub с Фабрикой данных, если у вас есть разрешения на чтение и запись в репозитории GitHub.

Чтобы настроить репозиторий GitHub, необходимо иметь разрешения администратора для подписки Azure, которую вы используете.

Уделите 9 минут вашего времени, чтобы просмотреть следующее видео с кратким обзором и демонстрацией этой функции:

> [!VIDEO https://channel9.msdn.com/shows/azure-friday/Azure-Data-Factory-visual-tools-now-integrated-with-GitHub/player]

### <a name="configure-a-github-repository-with-azure-data-factory"></a>Настройка репозитория GitHub с помощью фабрики данных Azure

Репозиторий GitHub можно настроить с помощью фабрики данных двумя способами.

#### <a name="configuration-method-1-azure-data-factory-home-page"></a>Метод конфигурации 1. Домашняя страница фабрики данных Azure

На домашней странице фабрики данных Azure выберите **настроить репозиторий кода**.

![Настройка репозитория кода Azure Repos](media/author-visually/configure-repo.png)

#### <a name="configuration-method-2-ux-authoring-canvas"></a>Метод 2. Пользовательский интерфейс "Работа над холстом"

На холсте разработки фабрики данных Azure выберите в раскрывающемся меню **фабрика данных** пункт **настроить репозиторий кода**.

![Настройка параметров репозитория кода для создания в пользовательском интерфейсе](media/author-visually/configure-repo-2.png)

Оба метода открывают панель конфигурации параметры репозитория.

![Параметры репозитория GitHub](media/author-visually/github-integration-image2.png)

В области Конфигурация отображаются следующие параметры репозитория GitHub:

| **Параметр** | **Описание**  | **Значение**  |
|:--- |:--- |:--- |
| **Тип репозитория** | Тип репозитория кода Azure Repos. | GitHub |
| **Use GitHub Enterprise** (Использовать GitHub Enterprise) | Флажок для выбора GitHub Enterprise. | не выбрано (по умолчанию) |
| **GitHub Enterprise URL** (URL-адрес GitHub Enterprise) | Корневой URL-адрес GitHub Enterprise (должен быть HTTPS для локального сервера GitHub Enterprise Server). Например: `https://github.mydomain.com`. Требуется только в том случае, если выбрано **Использование GitHub Enterprise** . | `<your GitHub enterprise url>` |                                                           
| **Учетная запись GitHub** | Имя учетной записи GitHub. Это имя можно найти по имени HTTPS:\//гисуб.ком/{аккаунт имя/{репоситори}. При переходе на эту страницу вам предложат ввести учетные данные OAuth GitHub для вашей учетной записи GitHub. | `<your GitHub account name>` |
| **Имя репозитория**  | Имя репозитория кода GitHub. Учетные записи GitHub содержат репозитории Git для управления исходным кодом. Создайте репозиторий либо используйте уже имеющийся в учетной записи. | `<your repository name>` |
| **Ветвь совместной работы** | Ветвь вашей совместной работы в GitHub, которая используется для публикации. По умолчанию он является главным. Измените этот параметр, если нужно опубликовать ресурсы из другой ветви. | `<your collaboration branch>` |
| **Корневая папка** | Корневая папка в ветви совместной работы GitHub. |`<your root folder name>` |
| **Import existing Data Factory resources to repository** (Импорт существующих ресурсов фабрики данных в репозиторий) | Указывает, следует ли импортировать существующие ресурсы фабрики данных из холста разработки UX в репозиторий GitHub. Установите флажок, чтобы импортировать ресурсы фабрики данных в связанный репозиторий Git в формате JSON. Это действие экспортирует каждый ресурс по отдельности (то есть, связанные службы и наборы данных будут экспортироваться в отдельных файлах JSON). Если этот флажок не установлен, имеющиеся ресурсы не импортируются. | Установлен (по умолчанию) |
| **Branch to import resource into** (Ветвь для импорта ресурсов) | Указывает, в какую ветвь импортируются ресурсы фабрики данных (конвейеры, наборы данных, связанные службы и т.д.). Вы можете выбрать для импорта ресурсов один из следующих вариантов: 1) "Совместная работа"; 2) "Создать"; 3) "Использовать имеющуюся". |  |

### <a name="known-github-limitations"></a>Известные ограничения GitHub

- В репозитории GitHub можно хранить файлы данных и сценариев. Но в службу хранилища Azure файлы необходимо отправлять вручную. Конвейер Фабрики данных автоматически не отправляет в службу хранилища Azure файлы данных и сценариев, которые хранятся в репозитории GitHub.

- GitHub Enterprise версии ниже 2.14.0 не работает в браузере Microsoft Edge.

- Интеграция GitHub с визуальными инструментами для создания фабрики данных работает только в общедоступной версии фабрики данных.

- В одной ветви GitHub можно получить не более 1 000 сущностей на каждый тип ресурсов (например, конвейеры и наборы данных). Если это ограничение достигнуто, рекомендуется разделить ресурсы на отдельные фабрики. Azure DevOps Git не имеет этого ограничения.

## <a name="version-control"></a>Управление версиями

Системы управления версиями, также называемые системами _контроля версий_, позволяют разработчикам взаимодействовать с кодом и отслеживать изменения, внесенные в базу кода. Система управления версиями является важным инструментом для проектов с несколькими разработчиками.

### <a name="creating-feature-branches"></a>Создание ветвей компонентов

Каждый репозиторий Git Azure Repos, который связан с фабрикой данных, имеет ветвь совместной работы. (`master` — ветвь совместной работы по умолчанию.) Пользователи также могут создавать ветви компонентов, щелкая **+ создать ветвь** в раскрывающемся списке ветвей. После появления новой области создать ветвь введите имя ветви компонентов.

![Создание новой ветви](media/author-visually/new-branch.png)

Когда вы будете готовы объединить изменения из ветви компонентов в ветвь совместной работы, щелкните раскрывающийся список ветвей и выберите **создать запрос на вытягивание**. Вы перейдете в Git Azure Repos, где можно инициировать запросы на вытягивание, выполнять проверки кода и объединять изменения в ветви совместной работы. (Значение по умолчанию — `master`.) Публикация в службе фабрики данных разрешена только из ветви совместной работы. 

![Создание нового запроса на вытягивание](media/author-visually/create-pull-request.png)

### <a name="configure-publishing-settings"></a>Настройка параметров публикации

По умолчанию фабрика данных создает шаблоны диспетчер ресурсов опубликованной фабрике и сохраняет их в ветви с `adf_public`именем. Чтобы настроить пользовательскую ветвь публикации, добавьте `publish_config.json` файл в корневую папку в ветви совместной работы. При публикации ADF считывает этот файл, ищет поле `publishBranch`и сохраняет все шаблоны диспетчер ресурсов в указанном расположении. Если ветвь не существует, фабрика данных автоматически создаст ее. Ниже приведен пример того, как выглядит этот файл:

```json
{
    "publishBranch": "factory/adf_publish"
}
```

Фабрика данных Azure может одновременно иметь только одну ветвь публикации. Если вы указываете новую ветвь публикации, Фабрика данных не удаляет предыдущую ветвь. Если вы хотите удалить предыдущую ветвь publish, удалите ее вручную.

> [!NOTE]
> Фабрика данных считывает файл `publish_config.json` только при загрузке фабрики. Если вы уже загрузили фабрику на портал, обновите браузер, чтобы изменения вступили в силу.

### <a name="publish-code-changes"></a>Публикация изменений кода

После объединения изменений в ветви совместной работы (`master` используется по умолчанию) нажмите кнопку **опубликовать** , чтобы вручную опубликовать изменения кода в главной ветви в службе фабрики данных.

![Публикация изменений в службе фабрики данных](media/author-visually/publish-changes.png)

Откроется Боковая область, где вы убедитесь, что ветвь Publish и ожидающие изменения верны. После проверки изменений нажмите кнопку **ОК** , чтобы подтвердить публикацию.

![Подтверждение использования правильной ветви публикации](media/author-visually/configure-publish-branch.png)

> [!IMPORTANT]
> Главная ветвь может не соответствовать тому, что развернуто в службе фабрики данных. Главную ветвь *нужно* опубликовать вручную в службе фабрики данных.

## <a name="best-practices-for-git-integration"></a>Рекомендации по интеграции Git

### <a name="permissions"></a>Разрешения

Обычно не нужно, чтобы у каждого члена группы имелись разрешения на обновление фабрики. Рекомендуется использовать следующие параметры разрешений.

*   Всем участникам команды следует предоставить разрешения на чтение фабрики данных.
*   Для публикации в фабрике должно быть разрешено только выбранное множество пользователей. Для этого у них должна быть роль **участника фабрики данных** в группе ресурсов, в которой находится фабрика. Дополнительные сведения о разрешениях см. в статье [роли и разрешения для фабрики данных Azure](concepts-roles-permissions.md).
   
Не рекомендуется разрешать прямые возвраты в ветвь совместной работы. Это ограничение может помочь предотвратить ошибки, так как при каждом возврате будет выполнен процесс проверки запроса на включение внесенных изменений, описанный в разделе [создание ветвей компонентов](source-control.md#creating-feature-branches).

### <a name="using-passwords-from-azure-key-vault"></a>Использование паролей из Azure Key Vault

Рекомендуется использовать Azure Key Vault для хранения любых строк подключения или паролей или аутентификации управляемой идентификации для связанных служб фабрики данных. В целях безопасности фабрика данных не сохраняет секреты в Git. Любые изменения в связанных службах, содержащие секреты, такие как пароли, публикуются немедленно в службе фабрики данных Azure.

Использование Key Vault или проверки подлинности MSI также упрощает непрерывную интеграцию и развертывание, так как вам не придется предоставлять эти секреты во время развертывания шаблона диспетчер ресурсов.

## <a name="troubleshooting-git-integration"></a>Устранение неполадок интеграции с Git

### <a name="stale-publish-branch"></a>Устаревшая ветвь публикации

Если ветвь Publish не синхронизирована с главной ветвью и содержит неактуальные ресурсы, несмотря на последние публикации, попробуйте выполнить следующие действия.

1. Удаление текущего репозитория Git
1. Перенастройте Git с теми же параметрами, но убедитесь, что выбран параметр **импортировать существующие ресурсы фабрики данных в репозиторий** , и выберите пункт **создать ветвь** .
1. Создание запроса на вытягивание для объединения изменений в ветви совместной работы 

Ниже приведены некоторые примеры ситуаций, которые могут вызвать устаревшую ветвь публикации.
- Пользователь имеет несколько ветвей. В одной ветви компонентов они удалили связанную службу, которая не AKV (связанные службы, не связанные с AKV, публикуются немедленно, независимо от того, находятся ли они в Git или нет) и никогда не объединили ветвь компонента в ветвь совместной работы.
- Пользователь изменил фабрику данных с помощью пакета SDK или PowerShell
- Пользователь переместил все ресурсы в новую ветвь и пытался опубликовать в первый раз. Связанные службы должны создаваться вручную при импорте ресурсов.
- Пользователь передает не AKV связанную службу или Integration Runtime JSON вручную. Они ссылаются на этот ресурс из другого ресурса, такого как набор данных, связанная служба или конвейер. НеAKV связанная служба, созданная с помощью UX, публикуется немедленно, так как учетные данные должны быть зашифрованы. Если отправить набор данных, ссылающийся на эту связанную службу, и попытаться опубликовать его, то UX разрешит его, так как он существует в среде Git. Оно будет отклонено во время публикации, поскольку оно не существует в службе фабрики данных.

## <a name="switch-to-a-different-git-repository"></a>Переключиться на другой репозиторий Git

Чтобы переключиться на другой репозиторий Git, щелкните значок **Параметры репозитория Git** в правом верхнем углу страницы обзор фабрики данных. Если значок не отображается, очистите кэш локального браузера. Чтобы разорвать связь с текущим репозиторием, выберите значок.

![Значок Git](media/author-visually/remove-repo.png)

Когда появится область Параметры репозитория, выберите **Удалить Git**. Введите имя фабрики данных и нажмите кнопку " **подтвердить** ", чтобы удалить репозиторий Git, связанный с фабрикой данных.

![Удаление связи с текущим репозиторием Git](media/author-visually/remove-repo2.png)

После удаления связи с текущим репозиторием можно настроить параметры Git для использования другого репозитория, а затем импортировать существующие ресурсы фабрики данных в новый репозиторий.

> [!IMPORTANT]
> Удаление конфигурации Git из фабрики данных не приводит к удалению чего-либо из репозитория. Фабрика будет содержать все опубликованные ресурсы. Вы можете продолжить редактирование фабрики непосредственно для службы.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о мониторинге и управлении конвейерами см. в статье [Отслеживание фабрики данных Azure с помощью программных средств](monitor-programmatically.md).
* Сведения о реализации непрерывной интеграции и развертывания см. [в статье непрерывная интеграция и доставка (CI/CD) в фабрике данных Azure](continuous-integration-deployment.md).
