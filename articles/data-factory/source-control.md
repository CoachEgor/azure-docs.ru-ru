---
title: Система управления версиями
description: Узнайте, как настроить элемент управления исходными данными на фабрике данных Azure
services: data-factory
ms.service: data-factory
ms.workload: data-services
author: djpmsft
ms.author: daperlov
manager: anandsub
ms.reviewer: ''
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 01/09/2019
ms.openlocfilehash: 3007865c15ceb03b104282c29179ec59a8196b38
ms.sourcegitcommit: 5e49f45571aeb1232a3e0bd44725cc17c06d1452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81604590"
---
# <a name="source-control-in-azure-data-factory"></a>Управление исходом на фабрике данных Azure
[!INCLUDE[appliesto-adf-xxx-md](includes/appliesto-adf-xxx-md.md)]

Пользовательский интерфейс Azure Data Factory (UX) имеет два интерфейса, доступных для визуального авторизации:

- Разработка с помощью службы фабрики данных
- Автор с интеграцией Azure Repos Git или GitHub

> [!NOTE]
> В правительственном облаке Azure поддерживается только авторство непосредственно с помощью службы Data Factory.

## <a name="author-directly-with-the-data-factory-service"></a>Разработка с помощью службы фабрики данных

В то время как авторирование непосредственно с службой Data Factory, единственный способ сохранить изменения через кнопку **Publish All.** После нажатия все внесенные изменения публикуются непосредственно в службу Data Factory. 

![Режим публикации](media/author-visually/data-factory-publish.png)

Авторство непосредственно в службе Data Factory имеет следующие ограничения:

- Служба фабрики данных не содержит репозиторий для хранения сущностей JSON для изменений.
- Служба фабрики данных не оптимизирована для совместной работы или управления версиями.

> [!NOTE]
> Автор непосредственно с помощью службы Data Factory отключен в Azure Data Factory UX при настройке репозитория Git. Изменения могут быть внесены непосредственно в службу через PowerShell или SDK.

## <a name="author-with-azure-repos-git-integration"></a>Разработка с помощью интеграции Git Azure Repos

Визуальная разработка с помощью интеграции Git Azure Repos поддерживает управление исходным кодом и совместную работу для создания конвейеров фабрики данных. Фабрику данных можно сопоставить с репозиторием организации Git Azure Repos для управления исходным кодом, совместной работы, управления версиями и т. д. В одной организации Git Azure Repos может быть несколько репозиториев, но репозиторий Git Azure Repos может быть связан только с одной фабрикой данных. Если у вас нет организации Azure Repos или репозитория, создайте их, следуя [этим инструкциям](https://docs.microsoft.com/azure/devops/organizations/accounts/create-organization-msa-or-work-student).

> [!NOTE]
> Вы можете хранить файлы данных и сценариев в репозитории Git Azure Repos. Но в службу хранилища Azure файлы необходимо отправлять вручную. Конвейер Фабрики данных автоматически не отправляет в службу хранилища Azure файлы данных и сценариев, которые хранятся в репозитории Git Azure Repos.

### <a name="configure-an-azure-repos-git-repository-with-azure-data-factory"></a>Настройка репозитория Git Azure Repos с помощью Фабрики данных Azure

Репозиторий Git Azure Repos можно настроить с помощью фабрики данных двумя способами.

#### <a name="configuration-method-1-azure-data-factory-home-page"></a>Метод конфигурации 1: домашняя страница фабрики данных Azure

На главной странице Фабрики данных Azure выберите **Репозиторий кода.**

![Настройка репозитория кода Azure Repos](media/author-visually/configure-repo.png)

#### <a name="configuration-method-2-ux-authoring-canvas"></a>Метод 2. Пользовательский интерфейс "Работа над холстом"
В авторстве canvas AAzure Data Factory UX выберите меню выпадения **данных,** а затем выберите **Репозиторий кода.**

![Настройка параметров репозитория кода для создания в пользовательском интерфейсе](media/author-visually/configure-repo-2.png)

Оба метода открывают панель конфигурации параметров репозитория.

![Настройка параметров репозитория кода](media/author-visually/repo-settings.png)

Панель конфигурации показывает следующие настройки репозитория репозитория репосуктов:

| Параметр | Описание | Значение |
|:--- |:--- |:--- |
| **Тип репозитория** | Тип репозитория кода Azure Repos.<br/> | Azure DevOps Git или GitHub |
| **Azure Active Directory** | Имя вашего клиента Azure AD. | `<your tenant name>` |
| **Организация Azure Repos** | Название вашей организации Azure Repos. Название организации Azure Repos можно найти по адресу `https://{organization name}.visualstudio.com`. [Войдите в свою организацию Azure Repos](https://www.visualstudio.com/team-services/git/) и получите доступ к профилю Visual Studio, чтобы просмотреть свои репозитории и проекты. | `<your organization name>` |
| **ProjectName** | Имя проекта Azure Repos. Имя проекта Azure Repos можно найти по адресу `https://{organization name}.visualstudio.com/{project name}`. | `<your Azure Repos project name>` |
| **РепозиторийИмя** | Имя репозитория кода Azure Repos. Проекты Azure Repos содержат репозитории Git, которые управляют исходным кодом по мере роста проекта. Создайте репозиторий либо используйте репозиторий, который уже имеется в проекте. | `<your Azure Repos code repository name>` |
| **Ветвь совместной работы** | Ветвь вашей совместной работы в Azure Repos, которая используется для публикации. По умолчанию, `master`это . Измените этот параметр, если нужно опубликовать ресурсы из другой ветви. | `<your collaboration branch name>` |
| **Корневая папка** | Корневая папка в ветви совместной работы Azure Repos. | `<your root folder name>` |
| **Import existing Data Factory resources to repository** (Импорт существующих ресурсов фабрики данных в репозиторий) | Указывает, следует ли импортировать имеющиеся ресурсы фабрики данных из пользовательского интерфейса **Работа над холстом** в репозиторий Git Azure Repos. Установите флажок, чтобы импортировать ресурсы фабрики данных в связанный репозиторий Git в формате JSON. Это действие экспортирует каждый ресурс по отдельности (то есть, связанные службы и наборы данных будут экспортироваться в отдельных файлах JSON). Если этот флажок не установлен, имеющиеся ресурсы не импортируются. | Установлен (по умолчанию) |
| **Branch to import resource into** (Ветвь для импорта ресурсов) | Указывает, в какую ветвь импортируются ресурсы фабрики данных (конвейеры, наборы данных, связанные службы и т.д.). Вы можете выбрать для импорта ресурсов один из следующих вариантов: 1) "Совместная работа"; 2) "Создать"; 3) "Использовать имеющуюся". |  |

> [!NOTE]
> Если вы используете Microsoft Edge и не видите никаких значений в выпадении учетной записи Azure DevOps, добавьте https://.visualstudio.com в список доверенных сайтов.

### <a name="use-a-different-azure-active-directory-tenant"></a>Использование другого клиента Azure Active Directory

Репозиторий Git Azure Repos можно создать в другом клиенте Azure Active Directory. Чтобы указать другой клиент Azure AD, у вас должны быть права администратора для подписки Azure, которую вы используете.

### <a name="use-your-personal-microsoft-account"></a>Использование личной учетной записи Майкрософт

Чтобы использовать личную учетную запись Майкрософт для интеграции с Git, можно связать личный репозиторий Azure с Active Directory вашей организации.

1. Добавление личной учетной записи Майкрософт в Active Directory вашей организации в качестве гостя. Дополнительные сведения см. в статье [Добавление пользователей службы совместной работы B2B на портале Azure](../active-directory/b2b/add-users-administrator.md).

2. Войдите на портал Azure с помощью личной учетной записи Майкрософт. Перейдите в Active Directory вашей организации.

3. Перейдите к разделу Azure DevOps, где находится личный репозиторий. Выберите репозиторий и подключитесь к Active Directory.

После этих шагов настройки личный репозиторий доступен при настройке интеграции Git в пользовательском интерфейсе Фабрики данных.

Дополнительные сведения о подключении репозитория Azure Active Directory вашей организации см. в статье о [подключении организации Azure DevOps к Azure Active Directory](/azure/devops/organizations/accounts/connect-organization-to-azure-ad).

## <a name="author-with-github-integration"></a>Разработка с помощью интеграции GitHub

Визуальная разработка с помощью интеграции GitHub поддерживает управление исходным кодом и совместную работу для создания конвейеров фабрики данных. Фабрику данных можно связать с репозиторием учетной записи GitHub для управления исходным кодом, совместной работы и управления версиями. В одной учетной записи GitHub может быть несколько репозиториев, но репозиторий GitHub может быть связан только с одной фабрикой данных. Если у вас нет учетной записи или репозитория GitHub, следуйте [этим инструкциям](https://github.com/join) для создания ресурсов.

Интеграция GitHub с Data Factory поддерживает как общедоступный GitHub (то есть, [https://github.com](https://github.com)) и GitHub Enterprise. Вы можете использовать общедоступные и частные репозитории GitHub с Фабрикой данных, если у вас есть разрешения на чтение и запись в репозитории GitHub.

Чтобы настроить репо GitHub, необходимо иметь разрешения администратора для подписки Azure, которую вы используете.

Уделите 9 минут вашего времени, чтобы просмотреть следующее видео с кратким обзором и демонстрацией этой функции:

> [!VIDEO https://channel9.msdn.com/shows/azure-friday/Azure-Data-Factory-visual-tools-now-integrated-with-GitHub/player]

### <a name="configure-a-github-repository-with-azure-data-factory"></a>Налажить репозиторий GitHub с помощью фабрики данных Azure

Репозиторий GitHub можно настроить с помощью фабрики данных двумя способами.

#### <a name="configuration-method-1-azure-data-factory-home-page"></a>Метод конфигурации 1: домашняя страница фабрики данных Azure

На главной странице Фабрики данных Azure выберите **Репозиторий кода.**

![Настройка репозитория кода Azure Repos](media/author-visually/configure-repo.png)

#### <a name="configuration-method-2-ux-authoring-canvas"></a>Метод 2. Пользовательский интерфейс "Работа над холстом"

В авторстве canvas AAzure Data Factory UX выберите меню выпадения **данных,** а затем выберите **Репозиторий кода.**

![Настройка параметров репозитория кода для создания в пользовательском интерфейсе](media/author-visually/configure-repo-2.png)

Оба метода открывают панель конфигурации параметров репозитория.

![Параметры репозитория GitHub](media/author-visually/github-integration-image2.png)

Панель конфигурации показывает следующие настройки репозитория GitHub:

| **Параметр** | **Описание**  | **Значение**  |
|:--- |:--- |:--- |
| **Тип репозитория** | Тип репозитория кода Azure Repos. | GitHub |
| **Use GitHub Enterprise** (Использовать GitHub Enterprise) | Флажок для выбора GitHub Enterprise. | невыбранный (по умолчанию) |
| **GitHub Enterprise URL** (URL-адрес GitHub Enterprise) | Корневый URL-адрес GitHub Enterprise (должен быть HTTPS для локального сервера GitHub Enterprise). Например: https://github.mydomain.com. Требуется только при выборе **предприятия GitHub** | `<your GitHub enterprise url>` |                                                           
| **Учетная запись GitHub** | Имя учетной записи GitHub. Это имя можно найти на\/сайте https: /github.com/«имя счета»/«репозиторийское имя». При переходе на эту страницу вам предложат ввести учетные данные OAuth GitHub для вашей учетной записи GitHub. | `<your GitHub account name>` |
| **Имя репозитория**  | Имя репозитория кода GitHub. Учетные записи GitHub содержат репозитории Git для управления исходным кодом. Создайте репозиторий либо используйте уже имеющийся в учетной записи. | `<your repository name>` |
| **Ветвь совместной работы** | Ветвь вашей совместной работы в GitHub, которая используется для публикации. По умолчанию, это мастер. Измените этот параметр, если нужно опубликовать ресурсы из другой ветви. | `<your collaboration branch>` |
| **Корневая папка** | Корневая папка в ветви совместной работы GitHub. |`<your root folder name>` |
| **Import existing Data Factory resources to repository** (Импорт существующих ресурсов фабрики данных в репозиторий) | Уточняется, следует ли импортировать существующие ресурсы фабрики данных из холста-автора UX в репозиторий GitHub. Установите флажок, чтобы импортировать ресурсы фабрики данных в связанный репозиторий Git в формате JSON. Это действие экспортирует каждый ресурс по отдельности (то есть, связанные службы и наборы данных будут экспортироваться в отдельных файлах JSON). Если этот флажок не установлен, имеющиеся ресурсы не импортируются. | Установлен (по умолчанию) |
| **Branch to import resource into** (Ветвь для импорта ресурсов) | Указывает, в какую ветвь импортируются ресурсы фабрики данных (конвейеры, наборы данных, связанные службы и т.д.). Вы можете выбрать для импорта ресурсов один из следующих вариантов: 1) "Совместная работа"; 2) "Создать"; 3) "Использовать имеющуюся". |  |

### <a name="known-github-limitations"></a>Известные ограничения GitHub

- В репозитории GitHub можно хранить файлы данных и сценариев. Но в службу хранилища Azure файлы необходимо отправлять вручную. Конвейер Фабрики данных автоматически не отправляет в службу хранилища Azure файлы данных и сценариев, которые хранятся в репозитории GitHub.

- GitHub Enterprise версии ниже 2.14.0 не работает в браузере Microsoft Edge.

- Интеграция GitHub с инструментами визуального авторства Data Factory работает только в общедоступной версии Data Factory.

- Максимум 1000 сущностей на тип ресурса (например, конвейеры и наборы данных) могут быть извлечены из одной ветви GitHub. Если этот предел достигнут, предлагается разделить ресурсы на отдельные заводы. Azure DevOps Git не имеет этого ограничения.

## <a name="switch-to-a-different-git-repo"></a>Выберите другой репозиторий Git

Чтобы переключиться на другое репо Git, щелкните **значок Git Repo Настройки** в правом верхнем углу страницы обзора Data Factory. Если вы не видите значок, очистите кэш локального браузера. Чтобы разорвать связь с текущим репозиторием, выберите значок.

![Значок Git](media/author-visually/remove-repo.png)

После того, как появится панель параметров репозитория, выберите **Удалить Git**. Введите название фабрики данных и нажмите **кнопку "Подтвердить",** чтобы удалить репозиторий Git, связанный с фабрикой данных.

![Удаление связи с текущим репозиторием Git](media/author-visually/remove-repo2.png)

После удаления связи с текущим репо можно настроить настройки Git для использования другого репо, а затем импортировать существующие ресурсы Data Factory в новое репо. 

## <a name="version-control"></a>Управление версиями

Системы управления версиями, также называемые системами _контроля версий_, позволяют разработчикам взаимодействовать с кодом и отслеживать изменения, внесенные в базу кода. Система управления версиями является важным инструментом для проектов с несколькими разработчиками.

### <a name="creating-feature-branches"></a>Создание ветвей функций

Каждый репозиторий Git Azure Repos, который связан с фабрикой данных, имеет ветвь совместной работы. (`master` — ветвь совместной работы по умолчанию.) Пользователи также могут создавать ветви функций, нажав **на новую ветвь** в ветке. Как только появится новая панель ветви, введите имя ветви функции.

![Создание новой ветви](media/author-visually/new-branch.png)

Когда вы будете готовы объединить изменения из ветви функций в ветвь совместной работы, нажмите на выпадение ветки и выберите **Запрос на вытяну.** Вы перейдете в Git Azure Repos, где можно инициировать запросы на вытягивание, выполнять проверки кода и объединять изменения в ветви совместной работы. (Значение по умолчанию — `master`.) Публикация в службе фабрики данных разрешена только из ветви совместной работы. 

![Создание нового запроса на вытягивание](media/author-visually/create-pull-request.png)

### <a name="configure-publishing-settings"></a>Настройка параметров публикации

Чтобы настроить ветвь публикации (ветвь, в которой сохраняются шаблоны Resource Manager), добавьте файл `publish_config.json` в корневую папку в ветви совместной работы. Фабрика данных считывает этот файл, ищет поле `publishBranch` и создает новую ветвь (если она отсутствует) с указанным значением. Затем она сохраняет все шаблоны Resource Manager в указанном расположении. Пример:

```json
{
    "publishBranch": "factory/adf_publish"
}
```

Если вы указываете новую ветвь публикации, Фабрика данных не удаляет предыдущую ветвь. Если вы хотите удалить предыдущую ветвь публикации, удалите ее вручную.

> [!NOTE]
> Фабрика данных считывает файл `publish_config.json` только при загрузке фабрики. Если вы уже загрузили фабрику на портал, обновите браузер, чтобы изменения вступили в силу.

### <a name="publish-code-changes"></a>Публикация изменений кода

После объединения изменений в ветке совместной работы (это`master` по умолчанию) нажмите **Publish,** чтобы вручную опубликовать изменения кода в основной ветке в службу Data Factory.

![Публикация изменений в службе фабрики данных](media/author-visually/publish-changes.png)

Боковое стекло откроется, где вы подтвердите правильность ветки публикации и ожидающих изменений. Как только вы проверите свои изменения, нажмите **OK,** чтобы подтвердить публикацию.

![Подтверждение использования правильной ветви публикации](media/author-visually/configure-publish-branch.png)

> [!IMPORTANT]
> Главная ветвь может не соответствовать тому, что развернуто в службе фабрики данных. Главную ветвь *нужно* опубликовать вручную в службе фабрики данных.

## <a name="advantages-of-git-integration"></a>Преимущества интеграции Git

-   **Управление источником**. Так как рабочие нагрузки фабрики данных становятся критически важными, вам может понадобиться интегрировать фабрику с Git, чтобы использовать несколько преимуществ системы управления версиями, таких как:
    -   возможность отслеживания и аудита изменений;
    -   возможность отменить изменения, внесение которых привело к появлению ошибок.
-   **Частичное сохранение**. Как вы делаете много изменений в вашей фабрике, вы поймете, что в обычном режиме LIVE, вы не можете сохранить ваши изменения, как проект, потому что вы не готовы, или вы не хотите потерять изменения в случае сбоя компьютера. При использовании интеграции Git можно продолжить постепенное сохранение изменений и публиковать их в фабрике только при необходимости. Git выступает в качестве промежуточного места для результатов работы, пока вы не выполните все необходимые проверки.
-   **Совместная работа и управление**. Если несколько участников команды выполняют развертывание в одной фабрике, вы можете разрешить им совместно работать друг с другом с помощью процесса проверки кода. Вы также можете настроить фабрику таким образом, чтобы не каждый участник мог выполнять развертывание в нее. Вы можете разрешить вносить изменения через Git всем участникам команды, но только определенным из них присвоить разрешение на публикацию изменений в фабрике.
-   **Отображение изменений**. В режиме Git, вы можете видеть хороший дифф полезной нагрузки, которая вот-вот будет опубликована на заводе. Будут показаны все ресурсы или сущности, которые были изменены, добавлены или удалены с момента последней публикации в фабрике. Исходя из данных о различиях, можно либо продолжить процесс публикации, либо вернуться и проверить изменения и продолжить публикацию позже.
-   **Более эффективные методы CI/CD**. Если вы используете режим Git, можно настроить конвейер выпуска, чтобы он активировался автоматически после внесения каждого изменения в фабрике разработки. В фабрике можно настроить свойства, доступные в качестве параметров в шаблоне Resource Manager. Может быть полезно сохранить в качестве параметров только требуемый набор параметров, а все остальные параметры жестко закодировать.
-   **Повышенная производительность**. Средняя загрузка фабрики в режиме Git в десять раз быстрее, чем в обычном режиме LIVE, так как ресурсы загружаются через Git.

## <a name="best-practices-for-git-integration"></a>Рекомендации по интеграции Git

### <a name="permissions"></a>Разрешения

Обычно вы не хотите, чтобы у каждого члена команды были разрешения на обновление фабрики. Рекомендуются следующие параметры разрешений:

*   Всем участникам команды следует предоставить разрешения на чтение фабрики данных.
*   Только выбранный набор людей должен быть разрешен к публикации на заводе. Для этого они должны иметь роль **вкладчика Data Factory** в группе ресурсов, в которой находится фабрика. Для получения дополнительной информации [Roles and permissions for Azure Data Factory](concepts-roles-permissions.md)о разрешениях см.
   
Рекомендуется не допускать прямой регистрации в ветке совместной работы. Это ограничение может помочь предотвратить ошибки, так как каждая регистрация будет проходить через процесс проверки запроса на вытягивание, описанный в [ветвях функций.](source-control.md#creating-feature-branches)

### <a name="using-passwords-from-azure-key-vault"></a>Использование паролей от Azure Key Vault

Рекомендуется использовать Azure Key Vault для хранения любых строк или паролей соединения для служб связи Data Factory Linked Services. По соображениям безопасности мы не храним такую секретную информацию в Git, поэтому любые изменения в связанных службах немедленно публикуются в службе Azure Data Factory.

Использование Key Vault также упрощает непрерывную интеграцию и развертывание, поскольку вам не придется предоставлять эти секреты во время развертывания шаблона Resource Manager.

## <a name="troubleshooting-git-integration"></a>Устранение неполадок интеграции Git

### <a name="stale-publish-branch"></a>Застойная ветвь публикации

Если ветвь публикации не синхронизирована с основной ветвью и содержит устаревшие ресурсы, несмотря на недавнее публикацию, попробуйте выследовать следующие действия:

1. Удалить текущий репозиторий Git
1. Перенастроить Git с теми же настройками, но убедитесь, что импорт существующих ресурсов Data Factory для **репозитория** выбран и выбрать **новую ветвь**
1. Создать запрос на выдвижной для объединения изменений в ветку совместной работы 

Ниже приведены некоторые примеры ситуаций, которые могут вызвать устаревший опубликовать ветку:
- Пользователь имеет несколько ветвей. В одной ветви функций они удалили связанную службу, которая не связана с AKV (не связанные с AKV службы публикуются немедленно, независимо от того, находятся они в Git или нет) и никогда не объединяли ветвь функций в совместное brnach.
- Пользователь изменил фабрику данных, используя SDK или PowerShell
- Пользователь перевел все ресурсы в новую ветвь и попытался опубликовать в первый раз. Связанные службы должны создаваться вручную при импорте ресурсов.
- Пользователь загружает услугу, не связанную с AKV, или интеграционный Runtime JSON вручную. Они ссылаются на этот ресурс из другого ресурса, такого как набор данных, связанная служба или конвейер. Служба, не связанная с AKV, созданная через UX, немедленно публикуется, поскольку учетные данные должны быть зашифрованы. Если вы загрузите набор данных, ссылающийся на службу, который связан с службой, и попытаетесь опубликовать, UX позволит это сделать, поскольку он существует в среде git. Он будет отклонен во время публикации, так как он не существует в службе фабрики данных.

## <a name="provide-feedback"></a>Отзывы
Выберите **Обратная связь**, чтобы оставить комментарии о возможностях или сообщить корпорации Майкрософт о проблемах со средством:

![Отзывы](media/author-visually/provide-feedback.png)

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о мониторинге и управлении конвейерами см. в статье [Отслеживание фабрики данных Azure с помощью программных средств](monitor-programmatically.md).
* Для внедрения непрерывной [Continuous integration and delivery (CI/CD) in Azure Data Factory](continuous-integration-deployment.md)интеграции и развертывания см.
