---
title: Устранение неполадок SSIS Интеграция Runtime управления
description: В этой статье содержатся рекомендации по устранению неполадок по вопросам управления sSIS Integration Runtime (SSIS IR)
services: data-factory
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
author: chinadragon0515
ms.author: dashe
ms.reviewer: sawinark
manager: mflasko
ms.custom: seo-lt-2019
ms.date: 07/08/2019
ms.openlocfilehash: 52b1d93935e6428563c72361655893ffddf8a507
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74941867"
---
# <a name="troubleshoot-ssis-integration-runtime-management-in-azure-data-factory"></a>Устранение проблем SSIS Интеграция Runtime управления в Azure Data Factory

В этой статье содержатся рекомендации по устранению неполадок для устранения проблем управления в службе интеграции серверов Azure-S'L (SSIS) Интеграция Runtime (IR), также известной как SSIS IR.

## <a name="overview"></a>Обзор

Если вы столкнулись с какой-либо проблемой при подготовке или деобеспечении SSIS IR, вы увидите сообщение об ошибке на портале Microsoft Azure Data Factory или ошибку, возвращенную из cmdlet PowerShell. Ошибка всегда отображается в формате кода ошибки с подробным сообщением об ошибке.

Если код ошибки является InternalServerError, служба имеет временные проблемы, и вы должны повторить операцию позже. Если повторная попытка не помогает, обратитесь в группу поддержки Фабрики данных Azure.

В противном случае три основные внешние зависимости могут привести к ошибкам: сервер базы данных Azure s'L или управляемый экземпляр, пользовательский сценарий настройки и виртуальная конфигурация сети.

## <a name="azure-sql-database-server-or-managed-instance-issues"></a>Сервер базы данных Azure или проблемы с управляемыми экземплярами

Сервер базы данных SQL Azure или управляемый экземпляр требуется, если выполняется подготовка служб SSIS IR с базой данных каталога служб SSIS. Служба SSIS IR должна иметь доступ к серверу базы данных SQL Azure или к управляемому экземпляру. Кроме того, учетная запись сервера базы данных SQL Azure или управляемого экземпляра должна иметь разрешение на создание базы данных каталога служб SSIS (SSISDB). Если возникает ошибка, на портале фабрики данных будет отображатся код ошибки с подробным сообщением об исключении SQL. Используйте сведения из следующего списка для устранения неполадок с кодами ошибок.

### <a name="azuresqlconnectionfailure"></a>AzureSqlConnectionFailure

Эта проблема может возникать при подготовке нового SSIS IR или во время работы IR. Если эта ошибка возникла во время подготовки IR, вы можете получить подробное сообщение SqlException в сообщении об ошибке, указывающее на одну из следующих проблем:

* Проблема подключения в сети. Проверьте, доступно ли имя узла SQL Server или управляемого экземпляра. Также убедитесь, что брандмауэр или группа безопасности сети (NSG) не блокируют доступ к серверу служб SSIS IR.
* Ошибка входа при проверке подлинности SQL. Не удается войти в базу данных SQL Server с указанной учетной записью. Убедитесь, что указана правильная учетная запись пользователя.
* Ошибка входа в систему во время аутентификации Microsoft Azure Active Directory (Azure AD) (управляемое удостоверение). Добавьте управляемое удостоверение фабрики в группу AAD и убедитесь, что управляемое удостоверение имеет разрешения на доступ к серверу базы данных каталога.
* Истечение времени ожидания подключения. Эта ошибка всегда вызвана конфигурацией, связанной с безопасностью. Примите во внимание следующие рекомендации.
  1. Создайте новый VM.
  1. Присоединитесь к VM в той же виртуальной сети ИК Microsoft Azure, если ИК находится в виртуальной сети.
  1. Установите SSMS и проверьте сервер базы данных Azure s'L или статус управляемого экземпляра.

Для устранения других проблем, устраните проблему, отображаемую в подробном сообщении об ошибке исключения SQL. Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки сервера базы данных SQL Azure или управляемого экземпляра.

Если сообщение об ошибке отображается в процессе выполнения IR, то, скорее всего, изменение группы безопасности сети или брандмауэра препятствует доступу к серверу базы данных SQL Azure или управляемому экземпляру. Разблокируйте рабочий узел SSIS IR, чтобы он мог обращаться к серверу базы данных SQL Azure или к управляемому экземпляру.

### <a name="catalogcapacitylimiterror"></a>CatalogCapacityLimitError

Вот как может выглядеть такого рода сообщение об ошибке: «База данных SSISDB достигла своей квоты размера. Раздел и удалите данные, отбросьте индексы или проконсультируйтесь с документацией для возможных разрешений». 

Возможные решения:
* Увеличьте размер квоты вашего SSISDB.
* изменение конфигурации SSISDB для уменьшения размера на:;
   * Сокращение периода хранения и количества версий проекта.
   * Сокращение периода хранения журнала.
   * Изменение уровня по умолчанию журнала.

### <a name="catalogdbbelongstoanotherir"></a>CatalogDbBelongsToAnotherIR

Эта ошибка означает, что сервер базы данных SQL Azure или управляемый экземпляр уже имеет SSISDB и используется другим IR. Необходимо либо указать другой сервер базы данных SQL Azure или управляемый экземпляр, либо удалить существующий SSISDB и перезапустить новый IR.

### <a name="catalogdbcreationfailure"></a>CatalogDbCreationFailure

Ошибка может быть вызвана одной из следующих причин:

* Учетная запись пользователя, настроенная для службы SSIS IR, не имеет разрешения на создание базы данных. Вы можете предоставить пользователю разрешение на создание базы данных.
* Время ожидания возникает во время создания базы данных, например время ожидания выполнения или время ожидания операции базы данных. Повторите операцию позже. Если повторное выполнение не работает, обратитесь к серверу базы данных SQL Azure или в службу поддержки Управляемого экземпляра.

Для устранения других проблем проверьте сообщение об ошибке исключения SQL и устраните проблему, упомянутую в сведениях об ошибке. Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки сервера базы данных SQL Azure или управляемого экземпляра.

### <a name="invalidcatalogdb"></a>InvalidCatalogDb

Такое сообщение об ошибке выглядит следующим образом: "Недействительный объект имя 'catalog.catalog_properties'." В этой ситуации либо у вас уже есть база данных под названием SSISDB, но она не была создана SSIS IR, либо база данных находится в недействительном состоянии, вызванном ошибками в последнем подготовке SSIS IR. Вы можете удалить существующую базу данных с именем SSISDB или настроить новый сервер базы данных SQL Azure или управляемый экземпляр для IR.

## <a name="custom-setup-issues"></a>Проблемы с пользовательской настройкой

Пользовательская настройка предоставляет интерфейс для добавления собственных шагов настройки во время подготовки или перенастройки SSIS IR. Дополнительные сведения см. в статье [Пользовательская настройка Azure-SSIS Integration Runtime](https://docs.microsoft.com/azure/data-factory/how-to-configure-azure-ssis-ir-custom-setup).

Убедитесь, что контейнер содержит только необходимые пользовательские файлы настройки; все файлы в контейнере будут загружены на рабочий узел службы SSIS IR. Мы рекомендуем протестировать пользовательский сценарий настройки на локальном компьютере чтобы исправить любые проблемы с выполнением сценария, прежде чем запускать сценарий в SSIS IR.

Контейнер сценария пользовательской настройки будет проверяться во время работы IR, потому что SSIS IR регулярно обновляется. Это обновление требует доступа к контейнеру для загрузки сценария пользовательской установки и его повторной установки. Процесс также проверяет, доступен ли контейнер и существует ли файл main.cmd.

Для любой ошибки, которая включает в себя пользовательскую настройку, вы увидите код ошибки CustomSetupScriptFailure с подкодом, как CustomSetupScriptBlobContainerAccessible или CustomSetupScriptNotFound.

### <a name="customsetupscriptblobcontainerinaccessible"></a>CustomSetupScriptBlobContainerInaccessible

Эта ошибка означает, что служба SSIS IR не может получить доступ к контейнеру BLOB-объектов Azure для пользовательской настройки. Убедитесь, что универсальный код доступа (URI) SAS контейнера доступен и срок его действия не истек.

Остановите IR, если она работает, перенастройте ее с помощью нового пользовательского универсального кода доступа (URI) SAS контейнера пользовательской настройки, а затем перезапустите IR.

### <a name="customsetupscriptnotfound"></a>CustomSetupScriptNotFound

Эта ошибка означает, что SSIS IR не может найти сценарий пользовательской настройки (main.cmd) в контейнере BLOB-объектов. Убедитесь, что main.cmd существует в контейнере, который является точкой входа для установки пользовательской настройки.

### <a name="customsetupscriptexecutionfailure"></a>CustomSetupScriptExecutionFailure

Эта ошибка означает, что не удалось выполнить сценарий пользовательской настройки (main.cmd). Сначала попробуйте выполнить сценарий на локальном компьютере или проверьте журналы выполнения пользовательской настройки в контейнере BLOB-объектов.

### <a name="customsetupscripttimeout"></a>CustomSetupScriptTimeout

Эта ошибка указывает на время ожидания выполнения сценария пользовательской настройки. Убедитесь, что скрипт можно выполнить без вмешательства пользователя, что не требуется интерактивный ввод, а также что контейнер больших двоичных объектов содержит только необходимые пользовательские файлы установки. Рекомендуем сначала протестировать сценарий на локальном компьютере. Кроме того, следует проверить журналы выполнения пользовательских настроек в контейнере BLOB-объектов. Максимальный период для пользовательской настройки составляет 45 минут, прежде чем истечет время ожидания. Он включает в себя время загрузки всех файлов из контейнера и установки их на SSIS IR. Если требуется более длительный период, создайте запрос в службу поддержки.

### <a name="customsetupscriptloguploadfailure"></a>CustomSetupScriptLogUploadFailure

Эта ошибка означает, что попытка передачи журналов выполнения пользовательской настройки в контейнер BLOB-объектов завершилась сбоем. Эта проблема возникает либо из-за того, что у SSIS IR нет прав на запись в контейнер BLOB-объектов, либо из-за проблем с хранилищем или сетью. Если пользовательская настройка прошла успешно, эта ошибка не повлияет ни на одну функцию SSIS, но журналы будут отсутствовать. Если пользовательская настройка завершается с другой ошибкой, а журнал не передается, сначала появится сообщение об этой ошибке, чтобы журнал можно было отправить для анализа. Кроме того, после устранения этой проблемы появятся сообщения о любых более конкретных проблемах. Если эта проблема не устранена после повторной попытки, обратитесь в техническую поддержку Фабрики данных Azure.

## <a name="virtual-network-configuration"></a>Конфигурация виртуальной сети

При присоединении SSIS IR к виртуальной сети Azure SSIS IR использует виртуальную сеть, входящую в подписку пользователя. Дополнительные сведения см. в статье [Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network).

При возникновении проблемы, связанной с виртуальной сетью, отобразится одна из следующих ошибок.

### <a name="invalidvnetconfiguration"></a>InvalidVnetConfiguration

Эта ошибка может возникать по разным причинам. Сведения об устранении проблем см. в разделах [Запрещено](#forbidden), [InvalidPropertyValue](#invalidpropertyvalue) и [MisconfiguredDnsServerOrNsgSettings](#misconfigureddnsserverornsgsettings).

### <a name="forbidden"></a>Запрещено

Такая ошибка может напоминать: "SubnetId не включен для текущего счета. Поставщик ресурсов Microsoft.Batch не зарегистрирован по той же подписке На VNet».

Эти сведения означают, что пакетная служба Azure не может получить доступ к виртуальной сети. Зарегистрируйте поставщика ресурсов Microsoft.Batch по той же подписке, что и виртуальная сеть.

### <a name="invalidpropertyvalue"></a>InvalidPropertyValue

Этот вид ошибки может выглядеть следующим образом: 

- "Либо указанный VNet не существует, либо служба пакета не имеет к нему доступа".
- "Указанный поднет xxx не существует."

Эти ошибки означают, что виртуальная сеть не существует, пакетная служба Azure не может получить к ней доступ, или же указанная подсеть не существует. Убедитесь, что виртуальная сеть и подсеть существуют, и что пакетная служба Azure имеет к ним доступ.

### <a name="misconfigureddnsserverornsgsettings"></a>MisconfiguredDnsServerOrNsgSettings

Такое сообщение об ошибке может выглядеть следующим образом: "Не удалось обеспечить интеграцию Runtime в VNet. Если настроены настройки DNS-сервера или NSG, убедитесь, что DNS-сервер доступен и NSG настроен должным образом.

В этой ситуации у вас, вероятно, есть настроенная конфигурация DNS-сервера или параметров NSG, которая предотвращает разрешение или доступ к имени сервера Azure, необходимого для службы SSIS IR. Дополнительные сведения см. в разделе [Конфигурация виртуальной сети SSIS IR](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки Фабрики данных Azure.

### <a name="vnetresourcegrouplockedduringupgrade"></a>VNetResourceGroupLockedDuringUpgrade

Службы SSIS IR будут автоматически обновляться на регулярной основе. Во время обновления создается новый пул пакетной службы Azure, а старый удаляется. Кроме того, ресурсы, связанные с виртуальной сетью, для старого пула удаляются, а новые ресурсы, связанные с виртуальной сетью, создаются в подписке. Эта ошибка означает, что удаление ресурсов, связанных с виртуальной сетью, для старого пула завершилось сбоем из-за блокировки удаления на уровне подписки или группы ресурсов. Поскольку клиент контролирует и устанавливает блокировку удаления, в этой ситуации он должен удалить блокировку удаления.

### <a name="vnetresourcegrouplockedduringstart"></a>VNetResourceGroupLockedDuringStart

При сбое подготовки служб SSIS IR все созданные ресурсы удаляются. Однако при наличии блокировки удаления ресурса на уровне подписки или группы ресурсов, ресурсы виртуальной сети не удаляются должным образом. Чтобы устранить эту ошибку, удалите блокировку удаления и перезапустите IR.

### <a name="vnetresourcegrouplockedduringstop"></a>VNetResourceGroupLockedDuringStop

При остановке служб SSIS IR все ресурсы, связанные с виртуальной сетью, удаляются. Но удаление может завершиться ошибкой, если на уровне подписки или группы ресурсов имеется блокировка удаления ресурса. Здесь клиент также управляет и устанавливает блокировку удаления. Поэтому он должен удалить блокировку удаления, а затем еще раз остановить службу SSIS IR.

### <a name="nodeunavailable"></a>NodeUnavailable

Эта ошибка возникает, когда при выполнении IR, и значит, что IR стала неработоспособной. Эта ошибка всегда вызвана изменением DNS-сервера или конфигурации NSG, которое блокирует подключение служб SSIS IR к необходимой службе. Поскольку настройка DNS-сервера и NSG контролируется клиентом, клиент должен устранить блокирующие проблемы на их стороне. Дополнительные сведения см. в разделе [Конфигурация виртуальной сети SSIS IR](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки Фабрики данных Azure.

## <a name="static-public-ip-addresses-configuration"></a>Статической конфигурации общедоступных IP-адресов

При входе в ИК Azure-SSIS в виртуальную сеть Azure вы также можете принести свои собственные статические общедоступные IP-адреса для ИК, чтобы ИК мог получить доступ к источникам данных, ограничивающим доступ к определенным IP-адресам. Дополнительные сведения см. в статье [Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network).

Помимо вышеуказанных проблем виртуальной сети, вы также можете столкнуться со статичной проблемой, связанной с общедоступными IP-адресами. Пожалуйста, проверьте следующие ошибки для справки.

### <a name="invalidpublicipspecified"></a><a name="InvalidPublicIPSpecified"></a>НедействительноеОбщественноеIPОпределено

Эта ошибка может возникнуть по разным причинам при запуске ИК Azure-SSIS:

| Сообщение об ошибке | Решение|
|:--- |:--- |
| Предоставленный статический общедоступный IP-адрес уже используется, пожалуйста, предоставьте два неиспользованных для вашего Runtime интеграции Azure-SSIS. | Следует выбрать два неиспользованных статических общедоступных IP-адреса или удалить текущие ссылки на указанный общедоступный IP-адрес, а затем перезапустить ИК Azure-SSIS. |
| Предоставленный статичный общедоступный IP-адрес не имеет имени DNS, пожалуйста, укажите два из них с именем DNS для вашего Runtime интеграции Azure-SSIS. | Вы можете настроить имя DNS публичного IP-адреса на портале Azure, как показано на рисунке ниже. Конкретные шаги следующие: (1) Открытый портал Azure и goto страница ресурса этого публичного IP-адреса; (2) Выберите раздел **Конфигурация** и навязание имени DNS, а затем нажмите кнопку **«Сохранить»;** (3) Перезапустить ИК Azure-SSIS. |
| Предоставленные VNet и статические общедоступные IP-адреса для вашего Runtime интеграции Azure-SSIS должны находиться в одном месте. | В соответствии с требованиями Azure Network, статический общедоступный IP-адрес и виртуальная сеть должны находиться в одном месте и подписке. Просьба предоставить два действительных статических общедоступных IP-адреса и перезапустить ИК Azure-SSIS. |
| Предоставленный статический общедоступный IP-адрес является базовым, пожалуйста, предоставьте два стандартных для вашего Runtime интеграции Azure-SSIS. | Обратитесь за помощью к [SUS общественного IP-адреса.](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm#sku) |

![Azure SSIS IR](media/ssis-integration-runtime-management-troubleshoot/setup-publicipdns-name.png)

### <a name="publicipresourcegrouplockedduringstart"></a>PublicIPResourceGroupLockedDuringStart

Если подготовка ИК Azure-SSIS не выполняется, все созданные ресурсы удаляются. Однако, если на уровне подписки или группы ресурсов (которая содержит ваш статичный общедоступный IP-адрес) блокировка ресурса, сетевые ресурсы не удаляются, как ожидалось. Чтобы исправить ошибку, пожалуйста, удалите блокировку удаления и перезапустите ИК.

### <a name="publicipresourcegrouplockedduringstop"></a>PublicIPResourceGroupLockedDuringStop

При остановке ИК Azure-SSIS все сетевые ресурсы, созданные в группе ресурсов, содержащей ваш общедоступный IP-адрес, будут удалены. Но удаление может выйти из строя, если на уровне подписки или группы ресурсов (которая содержит ваш статичный общедоступный IP-адрес) блокировка ресурса. Пожалуйста, удалите блокировку удаления и перезапустите ИК.

### <a name="publicipresourcegrouplockedduringupgrade"></a>PublicIPResourceGroupLockedDuringUpgrade

Azure-SSIS IR автоматически обновляется на регулярной основе. Новые ИК-узлы создаются во время обновления и старые узлы будут удалены. Кроме того, удаляются созданные сетевые ресурсы (например, баланселизатор нагрузки и группа сетевой безопасности) для старых узлов, а новые сетевые ресурсы создаются под подпиской. Эта ошибка означает, что удаление сетевых ресурсов для старых узлов не удалось из-за блокировки удаления на уровне подписки или ресурса (которая содержит ваш статический общедоступный IP-адрес). Пожалуйста, удалите блокировку удаления, чтобы мы могли очистить старые узлы и освободить статический общедоступный IP-адрес для старых узлов. В противном случае статический публичный IP-адрес не может быть освобожден, и мы не сможем обновить ваш ИК дальше.

### <a name="publicipnotusableduringupgrade"></a>PublicIPNotUsableDuringUpgrade

Если вы хотите принести свои собственные статические общедоступные IP-адреса, должны быть предоставлены два общедоступных IP-адреса. Один из них будет использоваться для создания ИК-узлов немедленно, а другой будет использоваться во время обновления ИК. Эта ошибка может возникнуть, когда другой общедоступный IP-адрес непригоен при обновлении. Пожалуйста, обратитесь к [InvalidPublicIPSpecified](#InvalidPublicIPSpecified) для возможных причин.