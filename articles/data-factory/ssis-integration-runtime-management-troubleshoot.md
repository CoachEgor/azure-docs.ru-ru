---
title: Устранение неполадок управления Integration Runtime SSIS в фабрике данных Azure | Документация Майкрософт
description: В этой статье содержатся рекомендации по устранению неполадок управления службами SSIS Integration Runtime (службы SSIS IR).
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 07/08/2019
author: chinadragon0515
ms.author: dashe
ms.reviewer: sawinark
manager: craigg
ms.openlocfilehash: 8abffdf443e26c03c38c12a3947a47a94157c9da
ms.sourcegitcommit: 6cff17b02b65388ac90ef3757bf04c6d8ed3db03
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/29/2019
ms.locfileid: "68609618"
---
# <a name="troubleshoot-ssis-integration-runtime-management-in-azure-data-factory"></a>Устранение неполадок управления Integration Runtime SSIS в фабрике данных Azure

В этой статье содержатся рекомендации по устранению неполадок управления в Azure-SQL Server Integration Services (SSIS) Integration Runtime (IR), также известные как службы SSIS IR.

## <a name="overview"></a>Обзор

Если во время подготовки или отмены подготовки служб SSIS IR возникли какие-либо проблемы, вы увидите сообщение об ошибке на портале фабрики данных Microsoft Azure или ошибку, возвращенную командлетом PowerShell. Ошибка всегда отображается в формате кода ошибки с подробным сообщением об ошибке.

Если код ошибки — InternalServerError, служба имеет временные проблемы, и ее следует повторить позже. Если повторная попытка не помогает, обратитесь в службу поддержки фабрики данных Azure.

В противном случае три основные внешние зависимости могут вызвать ошибки: сервер базы данных SQL Azure или управляемый экземпляр, Пользовательский скрипт установки и конфигурацию виртуальной сети.

## <a name="azure-sql-database-server-or-managed-instance-issues"></a>Проблемы с сервером базы данных SQL Azure или управляемым экземпляром

Сервер базы данных SQL Azure или управляемый экземпляр требуется, если выполняется подготовка служб SSIS IR с базой данных каталога служб SSIS. Служба SSIS IR должна иметь доступ к серверу базы данных SQL Azure или к управляемому экземпляру. Кроме того, учетная запись сервера базы данных SQL Azure или управляемого экземпляра должна иметь разрешение на создание базы данных каталога SSIS (SSISDB). Если возникает ошибка, на портале фабрики данных отображается код ошибки с подробным сообщением об исключении SQL. Используйте сведения из следующего списка для устранения неполадок с кодами ошибок.

### <a name="azuresqlconnectionfailure"></a>азуресклконнектионфаилуре

Эта проблема может возникать при подготовке нового IR-порта служб SSIS или во время работы IR. Если эта ошибка возникла во время подготовки ИК-связи, вы можете получить подробное сообщение SqlException в сообщении об ошибке, которое указывает на одну из следующих проблем:

* Проблемы с сетевым подключением. Проверьте, доступно ли имя узла SQL Server или управляемого экземпляра. Также убедитесь, что брандмауэр или группа безопасности сети (NSG) не блокируют доступ к серверу служб SSIS IR.
* Ошибка входа в систему при проверке подлинности SQL. Указанная учетная запись не может войти в базу данных SQL Server. Убедитесь, что указана правильная учетная запись пользователя.
* Ошибка входа в систему во время проверки подлинности Microsoft Azure Active Directory (Azure AD) (управляемое удостоверение). Добавьте управляемое удостоверение фабрики в группу AAD и убедитесь, что управляемое удостоверение имеет разрешения на доступ к серверу базы данных каталога.
* Время ожидания подключения. Эта ошибка всегда вызвана конфигурацией, связанной с безопасностью. Примите во внимание следующие рекомендации.
  1. Создайте новую виртуальную машину.
  1. Присоедините виртуальную машину к тому же виртуальная сеть Microsoft Azure IR, если IR находится в виртуальной сети.
  1. Установите SSMS и проверьте состояние сервера базы данных SQL Azure или управляемого экземпляра.

Для устранения других проблем устраните проблему, показанную в сообщении об ошибке "подробное исключение SQL". Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки сервера базы данных SQL Azure или управляемого экземпляра.

Если отображается сообщение об ошибке, когда выполняется IR, то, скорее всего, изменение группы безопасности сети или брандмауэра препятствует доступу к серверу базы данных SQL Azure или управляемому экземпляру. Разблокируйте узел "IR" служб SSIS, чтобы он мог получить доступ к серверу базы данных SQL Azure или к управляемому экземпляру.

### <a name="catalogcapacitylimiterror"></a>каталогкапаЦитилимитеррор

Этот вид сообщения об ошибке может выглядеть следующим образом: "База данных" SSISDB "достигла квоты на размер. Разбейте или удаляйте данные, удалите индексы или обратитесь к документации, чтобы получить возможные решения ". 

Возможные решения:
* Увеличьте размер квоты SSISDB.
* Измените конфигурацию SSISDB, чтобы уменьшить размер:
   * Уменьшение срока хранения и количества версий проекта.
   * Уменьшение срока хранения журнала.
   * Изменение уровня журнала по умолчанию.

### <a name="catalogdbbelongstoanotherir"></a>каталогдббелонгстоаносерир

Эта ошибка означает, что сервер базы данных SQL Azure или управляемый экземпляр уже имеет SSISDB и используется другим IR. Необходимо либо указать другой сервер базы данных SQL Azure или управляемый экземпляр, либо удалить существующий SSISDB и перезапустить новый IR.

### <a name="catalogdbcreationfailure"></a>каталогдбкреатионфаилуре

Эта ошибка может возникать по одной из следующих причин.

* Учетная запись пользователя, настроенная для среды выполнения интеграции служб SSIS, не имеет разрешения на создание базы данных. Можно предоставить пользователю разрешение на создание базы данных.
* Время ожидания возникает во время создания базы данных, например время ожидания выполнения или время ожидания операции базы данных. Повторите операцию позже. Если повторная попытка не работает, обратитесь в службу поддержки сервера базы данных SQL Azure или Управляемый экземпляр.

Для устранения других проблем проверьте сообщение об ошибке SQL Exception и устраните проблему, упомянутую в сведениях об ошибке. Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки сервера базы данных SQL Azure или управляемого экземпляра.

### <a name="invalidcatalogdb"></a>инвалидкаталогдб

Этот вид сообщения об ошибке выглядит следующим образом: "Недопустимое имя объекта" Catalog. catalog_properties ". В этой ситуации у вас уже есть база данных SSISDB, но она не была создана службой SSIS IR, либо база данных находится в недопустимом состоянии, вызванном ошибками во время последней подготовки служб SSIS IR. Можно удалить существующую базу данных с именем SSISDB или настроить новый сервер базы данных SQL Azure или управляемый экземпляр для IR.

## <a name="custom-setup-issues"></a>Проблемы с настраиваемой установкой

Пользовательская установка предоставляет интерфейс для добавления собственных шагов установки во время подготовки или перенастройки службы SSIS IR. Дополнительные сведения см. [в разделе Настройка установки для Integration Runtime Azure SSIS](https://docs.microsoft.com/azure/data-factory/how-to-configure-azure-ssis-ir-custom-setup).

Убедитесь, что контейнер содержит только необходимые файлы пользовательской установки. все файлы в контейнере будут скачаны на узел "ИНФРАКРАСная Рабочая роль служб SSIS". Рекомендуется протестировать сценарий пользовательской установки на локальном компьютере, чтобы устранить все проблемы, связанные с выполнением сценария, прежде чем запускать скрипт в службах SSIS IR.

Контейнер скрипта пользовательской установки будет проверяться во время работы IR, так как службы SSIS IR регулярно обновляются. Для этого обновления требуется доступ к контейнеру для скачивания пользовательского скрипта установки и его повторная установка. Этот процесс также проверяет, доступен ли контейнер, и существует ли главный CMD-файл.

Для любой ошибки, связанной с пользовательской настройкой, вы увидите код ошибки Кустомсетупскриптфаилуре с вспомогательным кодом, например Кустомсетупскриптблобконтаинеринакцессибле или Кустомсетупскриптнотфаунд.

### <a name="customsetupscriptblobcontainerinaccessible"></a>кустомсетупскриптблобконтаинеринакцессибле

Эта ошибка означает, что служба SSIS IR не может получить доступ к контейнеру больших двоичных объектов Azure для пользовательской установки. Убедитесь, что URI SAS контейнера доступен и срок его действия не истек.

Останавливает IR, если он работает, перенастройте IR с новым URI SAS контейнера настраиваемой установки, а затем перезапустите IR.

### <a name="customsetupscriptnotfound"></a>кустомсетупскриптнотфаунд

Эта ошибка означает, что службы SSIS IR не могут найти пользовательский сценарий установки (Main. cmd) в контейнере больших двоичных объектов. Убедитесь, что Main. cmd существует в контейнере, который является точкой входа для выборочной установки установки.

### <a name="customsetupscriptexecutionfailure"></a>кустомсетупскриптексекутионфаилуре

Эта ошибка означает, что выполнение скрипта пользовательской установки (Main. cmd) завершилось ошибкой. Сначала Испытайте сценарий на локальном компьютере или проверьте журналы выполнения пользовательской установки в контейнере больших двоичных объектов.

### <a name="customsetupscripttimeout"></a>кустомсетупскрипттимеаут

Эта ошибка указывает на время ожидания выполнения сценария настраиваемой установки. Убедитесь, что контейнер больших двоичных объектов содержит только необходимые пользовательские файлы установки. Кроме того, следует проверить журналы выполнения пользовательской установки в контейнере больших двоичных объектов. Максимальный период для пользовательской установки составляет 45 минут до истечения времени ожидания, а максимальный период включает время на скачивание всех файлов из контейнера и их установку на среду SSIS IR. Если вам требуется более длительный период, создайте запрос в службу поддержки.

### <a name="customsetupscriptloguploadfailure"></a>кустомсетупскриптлогуплоадфаилуре

Эта ошибка означает, что попытка отправить пользовательские журналы выполнения установки в контейнер больших двоичных объектов завершилась ошибкой. Эта проблема возникает либо из-за того, что службы SSIS IR не имеют разрешений на запись в контейнер больших двоичных объектов или из-за проблем с хранилищем или сетью. Если пользовательская установка выполнена успешно, эта ошибка не повлияет на функцию служб SSIS, но журналы будут отсутствовать. Если пользовательская установка завершается с другой ошибкой, а журнал не передается, сначала будет выведено сообщение об ошибке, чтобы журнал можно было отправить для анализа. Кроме того, после устранения этой проблемы будут выдаваться дополнительные сведения о конкретных проблемах. Если эта проблема не устранена после повторной попытки, обратитесь к группе поддержки фабрики данных Azure.

## <a name="virtual-network-configuration"></a>Конфигурация виртуальной сети

При присоединении служб SSIS IR к виртуальной сети Azure служба SSIS IR использует виртуальную сеть, которая находится в подписке пользователя. Дополнительные сведения см. в статье [Присоединение Integration Runtime Azure SSIS к виртуальной сети](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network).

При возникновении проблемы, связанной с виртуальной сетью, вы увидите одну из следующих ошибок.

### <a name="invalidvnetconfiguration"></a>инвалидвнетконфигуратион

Эта ошибка может возникнуть по ряду причин. Сведения об устранении неполадок см. в разделах [Forbidden](#forbidden), [InvalidPropertyValue](#invalidpropertyvalue) и [MisconfiguredDnsServerOrNsgSettings](#misconfigureddnsserverornsgsettings) .

### <a name="forbidden"></a>Запрещено

Этот вид ошибки может выглядеть следующим образом: "SubnetId не включена для текущей учетной записи. Поставщик ресурсов Microsoft. Batch не зарегистрирован в той же подписке виртуальной сети ".

Эти сведения означают, что Пакетная служба Azure не может получить доступ к виртуальной сети. Зарегистрируйте поставщик ресурсов Microsoft. Batch в той же подписке, что и виртуальная сеть.

### <a name="invalidpropertyvalue"></a>инвалидпропертивалуе

Этот вид ошибки может выглядеть следующим образом: 

- Либо указанная виртуальная сеть не существует, либо Пакетная служба не имеет доступа к ней.
- "Указанная подсеть XXX не существует".

Эти ошибки означают, что виртуальная сеть не существует, пакетная служба Azure не может получить к ней доступ или указанная подсеть не существует. Убедитесь, что виртуальная сеть и подсеть существуют и что Пакетная служба Azure имеет к ним доступ.

### <a name="misconfigureddnsserverornsgsettings"></a>мисконфигуредднссерверорнсгсеттингс

Этот вид сообщения об ошибке может выглядеть следующим образом: "Не удалось выполнить инициализацию Integration Runtime в виртуальной сети. Если параметры DNS-сервера или NSG настроены, убедитесь, что DNS-сервер доступен и NSG настроен правильно. "

В этой ситуации, возможно, у вас есть настроенная конфигурация DNS-сервера или параметров NSG, которая предотвращает разрешение или недоступность имени сервера Azure, необходимого для работы служб SSIS IR. Дополнительные сведения см. в статье [Настройка IR-виртуальной сети служб SSIS](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки фабрики данных Azure.

### <a name="vnetresourcegrouplockedduringupgrade"></a>внетресаурцеграуплоккеддурингупграде

Службы SSIS IR будут автоматически обновляться на регулярной основе. Новый пул пакетной службы Azure создается во время обновления, и старый пул пакетной службы Azure удаляется. Кроме того, ресурсы, связанные с виртуальной сетью, для старого пула удаляются, а новые ресурсы, связанные с виртуальной сетью, создаются в подписке. Эта ошибка означает, что удаление ресурсов, связанных с виртуальной сетью, для старого пула завершилось сбоем из-за блокировки удаления на уровне подписки или группы ресурсов. Так как клиент управляет и устанавливает блокировку удаления, в этой ситуации необходимо удалить блокировку удаления.

### <a name="vnetresourcegrouplockedduringstart"></a>внетресаурцеграуплоккеддурингстарт

При сбое подготовки служб SSIS IR все созданные ресурсы удаляются. Однако при наличии блокировки удаления ресурса на уровне подписки или группы ресурсов ресурсы виртуальной сети не удаляются должным образом. Чтобы устранить эту ошибку, удалите блокировку удаления и перезапустите IR.

### <a name="vnetresourcegrouplockedduringstop"></a>внетресаурцеграуплоккеддурингстоп

При отмене служб SSIS IR все ресурсы, связанные с виртуальной сетью, удаляются. Но удаление может завершиться ошибкой, если на уровне подписки или группы ресурсов имеется блокировка удаления ресурса. Здесь также клиент управляет и устанавливает блокировку удаления. Поэтому они должны удалить блокировку удаления, а затем еще раз отключить службы SSIS IR.

### <a name="nodeunavailable"></a>нодеунаваилабле

Эта ошибка возникает, когда выполняется IR, и это означает, что IR стал неработоспособным. Эта ошибка всегда вызвана изменением DNS-сервера или конфигурации NSG, которая блокирует подключение служб SSIS IR к необходимой службе. Поскольку настройка DNS-сервера и NSG контролируется клиентом, клиент должен устранить блокирующие проблемы на их стороне. Дополнительные сведения см. в статье [Настройка IR-виртуальной сети служб SSIS](https://docs.microsoft.com/azure/data-factory/join-azure-ssis-integration-runtime-virtual-network). Если у вас по-прежнему возникают проблемы, обратитесь в службу поддержки фабрики данных Azure.
