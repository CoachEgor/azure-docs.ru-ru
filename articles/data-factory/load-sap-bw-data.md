---
title: Данные о загрузке с бизнес-склада SAP
description: Используйте фабрику данных Azure для копирования данных с склада sAP Business (BW)
services: data-factory
author: linda33wj
ms.author: jingwang
manager: shwang
ms.reviewer: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 05/22/2019
ms.openlocfilehash: 96b23696164514ad2f16de72f0f76aa237ffce2e
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81415844"
---
# <a name="copy-data-from-sap-business-warehouse-by-using-azure-data-factory"></a>Копирование данных из бизнес-хранилища SAP с помощью Azure Data Factory
[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этой статье показано, как использовать фабрику данных Azure для копирования данных с SAP Business Warehouse (BW) через Open Hub to Azure Data Lake Storage Gen2. Аналогичный процесс можно использовать для копирования данных в другие [поддерживаемые хранилища данных sink.](copy-activity-overview.md#supported-data-stores-and-formats)

> [!TIP]
> Для получения общей информации о копировании данных из SAP BW, включая интеграцию SAP BW Open Hub и поток извлечения дельты, [см. Копии данных из бизнес-склада SAP через Open Hub с помощью Azure Data Factory.](connector-sap-business-warehouse-open-hub.md)

## <a name="prerequisites"></a>Предварительные требования

- **Фабрика данных Azure:** Если у вас ее нет, выполните последующие действия по [созданию фабрики данных.](quickstart-create-data-factory-portal.md#create-a-data-factory)

- **SAP BW Open Hub Destination (OHD) с типом назначения "Таблица баз данных"**: Чтобы создать OHD или проверить, правильно ли настроен ваш OHD для интеграции Data Factory, см. раздел [конфигураций SAP BW Open Hub Destination destination](#sap-bw-open-hub-destination-configurations) в этой статье.

- **Пользователю SAP BW нужны следующие разрешения:**

  - Авторизация для удаленных вызовов функций (RFC) и SAP BW.
  - Разрешения на "выполнение" деятельности объекта авторизации **S_SDSAUTH.**

- ** [Самохлажен интеграции времени (ИК)](concepts-integration-runtime.md#self-hosted-integration-runtime) с Разъемом SAP .NET 3.0**. Следуйте этим шагам установки:

  1. Установите и зарегистрируйте автономное время выполнения интеграции, версию 3.13 или позже. (Этот процесс описан позже в этой статье.)

  2. Загрузите [64-разрядный SAP-разъем для Microsoft .NET 3.0](https://support.sap.com/en/product/connectors/msnet.html) с веб-сайта SAP и установите его на тот же компьютер, что и самоуправляемый ИК. Во время установки убедитесь, что вы выбираете **установку сборок для GAC** в **диалоговом поле Факультативной настройки,** как показано следующее изображение:

     ![Настройка диалогового окна SAP .NET Connector](media/connector-sap-business-warehouse-open-hub/install-sap-dotnet-connector.png)

## <a name="do-a-full-copy-from-sap-bw-open-hub"></a>Сделайте полную копию из SAP BW Open Hub

На портале Azure перейдите в фабрику данных. Выберите **автора & монитор,** чтобы открыть uI Data Factory в отдельной вкладке.

1. На странице **«Давайте начнем»** выберите **«Копировать данные»,** чтобы открыть инструмент Copy Data.

2. На странице **Свойства** укажите **имя задачи,** а затем выберите **Следующий**.

3. На странице **хранилища данных «Источник»** выберите **«Создайте новое соединение».** Выберите **SAP BW Open Hub** из галереи разъемов, а затем выберите **Продолжить**. Чтобы отфильтровать разъемы, можно ввести **SAP** в поле поиска.

4. На странице **подключения Specify BW Open Hub** выполните следующие действия, чтобы создать новое соединение.

   ![Создание страницы сервиса SAP BW Open Hub](media/load-sap-bw-data/create-sap-bw-open-hub-linked-service.png)

   1. Из **списка времени выполнения интеграции** из списка интеграционных запусков выберите существующую иК-инфраструктуру. Или, выберите создать одно если вы не имеете одно пока.

      Чтобы создать новый самоуправляемый ИК, выберите **«Новый**, а затем выберите **Самостоятельное размещение.** Введите **имя,** а затем выберите **Следующий**. Выберите **настройку Express** для установки на текущем компьютере или выполните предоставленные инструкции **Manual.**

      Как уже упоминалось в [Prerequisites,](#prerequisites)убедитесь, что у вас есть SAP Разъем для Microsoft .NET 3.0 установлен на том же компьютере, где самостоятельно размещены ИК работает.

   2. Заполните имя SAP BW **Server,** **номер системы,** **идентификатор клиента,** **язык** (если кроме **EN),** **имя пользователя**и **пароль.**

   3. Выберите **подключение к тесту** для проверки настроек, а затем выберите **Finish.**

   4. Создается новое соединение. Выберите **Далее**.

5. На странице **Select Open Hub Destinations** просмотрите направления Open Hub, доступные в вашем SAP BW. Выберите OHD для копирования данных, а затем выберите **Следующий**.

   ![Выберите таблицу SAP BW Open Hub Destination](media/load-sap-bw-data/select-sap-bw-open-hub-table.png)

6. Укажите фильтр, если он необходим. Если ваш OHD содержит только данные из одного процесса передачи данных (DTP) с одним идентификатором запроса, или вы уверены, что ваш DTP закончен, и вы хотите скопировать данные, очистите флажок **"Исключить последний запрос".**

   Узнайте больше об этих настройках в разделе [конфигураций SAP BW Open Hub Destination](#sap-bw-open-hub-destination-configurations) в этой статье. Выберите **Validate,** чтобы перепроверить, какие данные будут возвращены. Выберите **Далее**.

   ![Настройка фильтра SAP BW Open Hub](media/load-sap-bw-data/configure-sap-bw-open-hub-filter.png)

7. На странице **хранилища данных Destination** выберите **«Создание нового соединения** > **Azure Data Lake Storage Gen2** > **Продолжить.**

8. На странице **подключения к уточнению Azure Data Lake Storage** выполните следующие действия для создания соединения.

   ![Создание страницы сервиса ADLS Gen2, связанной с ADLS Gen2](media/load-sap-bw-data/create-adls-gen2-linked-service.png)

   1. Выберите учетную запись, способную хранить данные lake Storage Gen2, из списка выпадающих **имен.**
   2. Выберите **Готово**, чтобы создать подключение. Выберите **Далее**.

9. На **странице «Выбрать выводной файл» или страницу папки** введите **copyfromopenhub** в качестве имени папки вывода. Выберите **Далее**.

   ![Выберите страницу папки вывода](media/load-sap-bw-data/choose-output-folder.png)

10. На странице **настройки формата файла** выберите **Далее,** чтобы использовать настройки по умолчанию.

    ![Указать страницу формата раковины](media/load-sap-bw-data/specify-sink-format.png)

11. На странице **«Настройки»** расширьте **параметры производительности.** Введите значение для **степени параллелизма копирования,** например 5 для параллельной загрузки с SAP BW. Выберите **Далее**.

    ![Настройка настроек копирования](media/load-sap-bw-data/configure-copy-settings.png)

12. Проверьте параметры на странице **Сводка**. Выберите **Далее**.

13. На странице **развертывания** выберите **Монитор** для мониторинга конвейера.

    ![Страница развертывания](media/load-sap-bw-data/deployment.png)

14. Обратите внимание, что вкладка **Монитор** на левой стороне страницы автоматически выбирается. Столбец **«Действия»** содержит ссылки для просмотра сведений о действиях и повторного запуска конвейера.

    ![Представление мониторинга трубопроводов](media/load-sap-bw-data/pipeline-monitoring.png)

15. Для просмотра запусков, связанных с запуском конвейера, выберите **«Запусков действий в** столбце **действий.** В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы вернуться к представлению **трубопроводных запусков,** выберите ссылку Трубопроводов в верхней части. Щелкните **Обновить**, чтобы обновить список.

    ![Экран мониторинга активности](media/load-sap-bw-data/activity-monitoring.png)

16. Чтобы отслеживать детали выполнения для каждого действия копии, выберите ссылку **Детали,** которая является значок очков ниже **Действия** в представлении мониторинга активности. Доступные сведения включают объем данных, скопированный из источника в раковину, пропускную систему данных, этапы выполнения и продолжительность, а также используемые конфигурации.

    ![Детали мониторинга активности](media/load-sap-bw-data/activity-monitoring-details.png)

17. Чтобы просмотреть **максимальный идентификатор запроса,** вернитесь к представлению мониторинга активности и выберите **выход** в соответствии с **действиями.**

    ![Экран вывода активности](media/load-sap-bw-data/activity-output.png)

    ![Представление сведений о выводах активности](media/load-sap-bw-data/activity-output-details.png)

## <a name="incremental-copy-from-sap-bw-open-hub"></a>Инкрементная копия из открытого концентратора SAP BW

> [!TIP]
> [См. поток извлечения дельты разъема SAP BW Open Hub,](connector-sap-business-warehouse-open-hub.md#delta-extraction-flow) чтобы узнать, как разъем SAP BW Open Hub в копии дополнительных данных SAP BW. Эта статья также может помочь вам понять основную конфигурацию разъема.

Теперь давайте продолжим настраивать инкрементную копию из SAP BW Open Hub.

Инкрементная копия использует механизм «высоководной знак», основанный на **идентификаторе запроса.** Этот идентификатор автоматически генерируется в SAP BW Open Hub Destination DTP. Следующая диаграмма показывает этот рабочий процесс:

![Инкрементная диаграмма потока рабочего потока копирования](media/load-sap-bw-data/incremental-copy-workflow.png)

На фабрике данных **Давайте начняем** страницу, выберите **Создайте конвейер из шаблона** и воспользуя встроенный шаблон.

1. Поиск **SAP BW** для поиска и выбора **инкрементной копии из шаблона SAP BW в Azure Data Lake Storage Gen2.** Этот шаблон копирует данные в Azure Data Lake Storage Gen2. Можно использовать аналогичный рабочий процесс для копирования другим типам раковин.

2. На главной странице шаблона выберите или создайте следующие три соединения, а затем выберите **Используйте этот шаблон** в правом нижнем углу окна.

   - **Хранение Azure Blob:** В этом пошаговом варианте мы используем хранилище Azure Blob для хранения высокого водяного знака, который является *максимальным идентификатором запроса.*
   - **SAP BW Open Hub**: Это источник для копирования данных. Для получения подробной конфигурации обратитесь к предыдущему полную копию пошагового пошагового письма.
   - **Azure Data Lake Storage Gen2:** Это раковина для копирования данных. Для получения подробной конфигурации обратитесь к предыдущему полную копию пошагового пошагового письма.

   ![Инкрементная копия из шаблона SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-template.png)

3. Этот шаблон генерирует конвейер со следующими тремя действиями и делает их прикованы к успеху: *Lookup,* *Copy Data*и *Web*.

   Перейдите на вкладку **параметры** конвейера. Вы видите все конфигурации, которые необходимо предоставить.

   ![Инкрементная копия из конфигурации SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-pipeline-config.png)

   - **SAPOpenHubDestinationName**: Укажите имя таблицы Open Hub для копирования данных.

   - **Data_Destination_Container**: Укажите пункт назначения Azure Data Lake Storage Gen2 для копирования данных. Если контейнер не существует, активность копирования Data Factory создает его во время выполнения.
  
   - **Data_Destination_Directory**: Укажите путь папки в контейнере Azure Data Lake Storage Gen2 для копирования данных. Если путь не существует, активность копирования Data Factory создает путь во время выполнения.
  
   - **HighWatermarkBlobContainer**: Укажите контейнер для хранения высокой стоимости водяного знака.

   - **HighWatermarkBlobDirectory**: Укажите путь папки под контейнером для хранения значения высокого водяного знака.

   - **HighWatermarkBlobName**: Укажите имя капли для хранения высокой `requestIdCache.txt`стоимости водяного знака, например. В хранилище Blob, перейдите на соответствующий путь HighWatermarkBlobContainer-HighWatermarkBlobDirectory-HighWatermarkBlobName, таких как *контейнер / путь/requestIdCachehe.txt*. Создайте каплю с содержанием 0.

      ![Содержимое BLOB-объекта](media/load-sap-bw-data/blob.png)

   - **LogicAppURL:** В этом шаблоне мы используем WebActivity для вызова приложений Azure Logic Apps для установки значения высокой воды в хранилище Blob. Для ее хранения можно использовать базу данных Azure S'L. Используйте сохраненную процедуру для обновления значения.

      Сначала необходимо создать логическое приложение, как показано на следующем изображении. Затем, вставьте в **HTTP POST URL**.

      ![Конфигурация приложения логики](media/load-sap-bw-data/logic-app-config.png)

      1. Перейдите на портал Azure. Выберите новую службу **logic Apps.** Выберите **приложение «Blank Logic App»,** чтобы перейти к **Logic Apps Designer.**

      2. Создайте триггер **при получении запроса HTTP.** Укажите орган запроса HTTP следующим образом:

         ```json
         {
            "properties": {
               "sapOpenHubMaxRequestId": {
                  "type": "string"
               }
            },
            "type": "object"
         }
         ```

      3. Добавить **действие Create blob.** Для того, чтобы **фолдерский путь** и **имя Blob,** используйте те же значения, которые вы настроили ранее в *HighWatermarkBlobContainer-HighWatermarkBlobDirectory* и *HighWatermarkBlobName*.

      4. Щелкните **Сохранить**. Затем скопируйте значение **URL HTTP POST** для использования в конвейере Data Factory.

4. После предоставления параметров конвейера Data Factory выберите **Debug** > **Finish,** чтобы вызвать запуск для проверки конфигурации. Или выберите **Опубликовать,** чтобы опубликовать все изменения, а затем выберите **добавить триггер** для выполнения запуска.

## <a name="sap-bw-open-hub-destination-configurations"></a>Конфигурации SAP BW Open Hub Destination

В этом разделе представлена конфигурация стороны SAP BW для использования разъема SAP BW Open Hub в Data Factory для копирования данных.

### <a name="configure-delta-extraction-in-sap-bw"></a>Настройка добычи дельты в SAP BW

Если вам нужна как историческая копия, так и инкрементная копия или только инкрементная копия, нависните извилистое дельты в SAP BW.

1. Создайте направление open Hub. Вы можете создать OHD в SAP Transaction RSA1, который автоматически создает необходимый процесс преобразования и передачи данных. Используйте следующие параметры:

   - **ObjectType**: Вы можете использовать любой тип объекта. Здесь мы используем **InfoCube** в качестве примера.
   - **Тип назначения**: Выберите **таблицу базы данных**.
   - **Ключ таблицы**: Выберите **технический ключ.**
   - **Извлечение:** Выберите **Хранить данные и вставлять записи в таблицу.**

   ![Создание sAP BW OHD дельта добычи диалоговая коробка](media/load-sap-bw-data/create-sap-bw-ohd-delta.png)

   ![Создание sAP BW OHD delta2 диалоговая коробка](media/load-sap-bw-data/create-sap-bw-ohd-delta2.png)

   Можно увеличить количество параллельных рабочих процессов SAP для DTP:

   ![create-sap-bw-ohd-delta3](media/load-sap-bw-data/create-sap-bw-ohd-delta3.png)

2. Расписание DTP в технологических цепочках.

   Дельта DTP для куба работает только в том случае, если необходимые строки не были сжаты. Убедитесь, что сжатие кубиков BW не будет запущено перед DTP к таблице Open Hub. Самый простой способ сделать это — интегрировать DTP в существующие технологические цепочки. В следующем примере DTP (к OHD) вставляется в цепочку процесса между шагами *Adjust* (агрегатный свертывание) и *Collapse* (сжатие куба).

   ![Создание диаграммы потока цепочек процессов SAP BW](media/load-sap-bw-data/create-sap-bw-process-chain.png)

### <a name="configure-full-extraction-in-sap-bw"></a>Настройка полного извлечения в SAP BW

В дополнение к добыче дельты, вы можете получить полную добычу того же SAP BW InfoProvider. Это обычно применяется, если вы хотите сделать полную копию, но не инкрементные, или вы хотите, чтобы [resync дельта экстракции.](#resync-delta-extraction)

Вы не можете иметь более одного DTP для того же OHD. Таким образом, вы должны создать дополнительный OHD до добычи дельты.

![Создать SAP BW OHD полный](media/load-sap-bw-data/create-sap-bw-ohd-full.png)

Для полной нагрузки OHD выберите другие варианты, чем для добычи дельты:

- В OHD: Установите опцию **извлечения** для **удаления данных и вставки записей.** В противном случае данные будут извлечены много раз при повторении DTP в цепочке процесса BW.

- В DTP: Установите **режим извлечения** до **полного.** Вы должны изменить автоматически созданный DTP с **Delta** на **Полный** сразу после создания OHD, как показано на этом изображении:

   ![Создание диалогового ящика SAP BW OHD, настроенного для "полного" извлечения](media/load-sap-bw-data/create-sap-bw-ohd-full2.png)

- В разъеме BW Open Hub Data Factory: Выключите **последний запрос.** В противном случае, ничего не будет извлечено.

Обычно вы работаете полный DTP вручную. Или можно создать цепочку процессов для полного DTP. Как правило, это отдельная цепочка, не зависяющая от существующих технологических цепочек. В любом случае *убедитесь, что DTP закончен, прежде чем начать добычу с помощью копии Data Factory.* В противном случае будут скопированы только частичные данные.

### <a name="run-delta-extraction-the-first-time"></a>Выполнить добычу дельты в первый раз

Первая добыча дельты технически *является полной добычей.* По умолчанию разъем SAP BW Open Hub исключает последний запрос при копировании данных. Для первого извлечения дельты никакие данные не извлекаются в результате действия копирования Data Factory до тех пор, пока последующий DTP не генерирует данные дельты в таблице с отдельным идентификатором запроса. Существует два способа избежать этого сценария:

- Выключите опцию **Последнего запроса Исключение** для первой добычи дельты. Убедитесь, что первая дельта DTP закончена, прежде чем начать добычу дельты в первый раз.
-  Используйте процедуру ресинхронизации добычи дельты, как описано в следующем разделе.

### <a name="resync-delta-extraction"></a>Извлечение дельты Resync

Следующие сценарии меняют данные в кубиках SAP BW, но не рассматриваются дельтой DTP:

- Селективное удаление SAP BW (строк с помощью любого состояния фильтра)
- Удаление запроса SAP BW (неисправных запросов)

SAP Open Hub Destination не является целевой целью данных, контролируемой data-mart (во всех пакетах поддержки SAP BW с 2015 года). Таким образом, вы можете удалить данные из куба, не изменяя данные в OHD. Затем необходимо синхронизировать данные куба с помощью Data Factory:

1. Выполнить полную добычу на data Factory (с помощью полного DTP в SAP).
2. Удалите все строки в таблице Open Hub для дельты DTP.
3. Установите статус дельты DTP для **fetched**.

После этого все последующие Дельта DTPs и Data Factory дельта извлечения работы, как ожидалось.

Чтобы установить статус дельты DTP для **Fetched,** вы можете использовать следующий вариант для запуска дельта DTP вручную:

    *No Data Transfer; Delta Status in Source: Fetched*

## <a name="next-steps"></a>Дальнейшие действия

Узнайте о поддержке разъема SAP BW Open Hub:

> [!div class="nextstepaction"]
>[SAP Бизнес Склад Открыть разъем концентратор](connector-sap-business-warehouse-open-hub.md)
