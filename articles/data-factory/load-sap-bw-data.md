---
title: Загрузка данных из SAP Business Warehouse с помощью фабрики данных Azure | Документация Майкрософт
description: С помощью фабрики данных Azure копировать данные из SAP Business Warehouse (BW)
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: ''
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 05/22/2019
ms.author: jingwang
ms.openlocfilehash: 4cd61db3ec0e8d88c9b1c6d6ba427b120b3f1af1
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "66152421"
---
# <a name="copy-data-from-sap-business-warehouse-by-using-azure-data-factory"></a>Копирование данных из SAP Business Warehouse с помощью фабрики данных Azure

В этой статье показано, как использовать фабрику данных Azure для копирования данных из SAP Business Warehouse (BW) с помощью Open вещей Gen2 хранилища Озера данных Azure. Аналогичный процесс можно использовать для копирования данных в другом [поддерживаемые приемники хранилища данных](copy-activity-overview.md#supported-data-stores-and-formats).

> [!TIP]
> Общие сведения о копировании данных из SAP BW, включая интеграцию SAP BW, откройте центр и поток извлечения разностных, см. в разделе [копировать данные из SAP Business Warehouse с помощью Open вещей с помощью фабрики данных Azure](connector-sap-business-warehouse-open-hub.md).

## <a name="prerequisites"></a>Технические условия

- **Фабрика данных Azure**: Если у вас ее нет, выполните действия, чтобы [создать фабрику данных](quickstart-create-data-factory-portal.md#create-a-data-factory).

- **SAP BW откройте концентратор назначения (OHD) с целевой тип «В таблице базы данных»** : Для создания OHD или проверить правильность настройки вашего OHD для интеграции фабрики данных, см. в разделе [конфигураций SAP BW открыть назначение концентратора](#sap-bw-open-hub-destination-configurations) этой статьи.

- **Пользователь SAP BW необходимы следующие разрешения**:

  - Авторизация для удаленные вызовы функций (RFC) и SAP BW.
  - Разрешения для действия «Выполнить» **S_SDSAUTH** объект проверки подлинности.

- **Объект [локальная среда выполнения интеграции (IR)](concepts-integration-runtime.md#self-hosted-integration-runtime) с помощью соединителя SAP .NET 3.0**. Выполните следующие действия для установки.

  1. Установите и зарегистрируйте локальную среду выполнения интеграции, 3,13 или более поздней версии. (Этот процесс описан далее в этой статье).

  2. Скачайте [64-разрядных соединителя SAP для Microsoft .NET 3.0](https://support.sap.com/en/product/connectors/msnet.html) с веб-сайта компании SAP и установите его на одном компьютере с резидентных IR. Во время установки, убедитесь, что выбран **Установка сборок в глобальный кэш СБОРОК** в **этапы установки** диалоговое окно, как показано на следующем рисунке:

     ![Настройка соединителя SAP .NET-диалоговое окно](media/connector-sap-business-warehouse-open-hub/install-sap-dotnet-connector.png)

## <a name="do-a-full-copy-from-sap-bw-open-hub"></a>Выполнить полное копирование из SAP BW, откройте Центр

На портале Azure перейдите к фабрике данных. Выберите **Создание и мониторинг** открыть на отдельной вкладке пользовательский Интерфейс фабрики данных.

1. На **приступим к работе** выберите **копирования данных** чтобы открыть инструмент копирования данных.

2. На **свойства** , определите **имя задачи**, а затем выберите **Далее**.

3. На **исходного хранилища данных** выберите **+ создать новое соединение**. Выберите **SAP BW, откройте Центр** из коллекции соединителя, а затем выберите **Продолжить**. Чтобы отфильтровать соединителей, можно ввести **SAP** в поле поиска.

4. На **укажите SAP BW откройте концентратора** странице, выполните следующие действия, чтобы создать новое соединение.

   ![Создание страницы SAP BW откройте концентратор связанной службы](media/load-sap-bw-data/create-sap-bw-open-hub-linked-service.png)

   1. Из **подключиться через среду выполнения интеграции** выберите существующий резидентных IR. Запись или создайте его, если у вас его еще.

      Чтобы создать новый локальную среду выполнения Интеграции, выберите **+ создать**, а затем выберите **с локальным размещением**. Введите **имя**, а затем выберите **Далее**. Выберите **экспресс-установка** для установки на текущем компьютере, или выполните **установку вручную** указаниям.

      Как упоминалось в [предварительные требования](#prerequisites), убедитесь, что у вас есть соединитель SAP для Microsoft .NET 3.0 установлен на том же компьютере, где выполняется локальная IR.

   2. Заполните SAP BW **имя_сервера**, **номер системы**, **идентификатор клиента,** **языка** (if, отличных от **EN**) , **Имя пользователя**, и **пароль**.

   3. Выберите **Проверка соединения** для проверки параметров, а затем выберите **Готово**.

   4. Создается новое соединение. Щелкните **Далее**.

5. На **выберите Открыть центр назначения** странице, выберите Открыть центр назначений, которые доступны в вашей SAP BW. Выберите OHD, чтобы скопировать данные из, а затем выберите **Далее**.

   ![Выберите таблицу, открыть назначение концентратора SAP BW](media/load-sap-bw-data/select-sap-bw-open-hub-table.png)

6. Укажите фильтр, если вам нужен один. Если ваш OHD содержит только данные из одной передачи данных выполнение процесса (DTP) с Идентификатором одного запроса, или вы уверены, что вашей DTP завершения и вы хотите скопировать данные, снимите флажок **исключить последнего запроса** "флажок".

   Дополнительные сведения об этих параметрах в [конфигураций SAP BW открыть назначение концентратора](#sap-bw-open-hub-destination-configurations) этой статьи. Выберите **Validate** еще раз проверьте, какие данные будут возвращены. Затем нажмите кнопку **Далее**.

   ![Настройка фильтра откройте Центр SAP BW](media/load-sap-bw-data/configure-sap-bw-open-hub-filter.png)

7. На **целевое хранилище данных** выберите **+ создать новое соединение** > **Gen2 хранилища Озера данных Azure**  >   **По-прежнему**.

8. На **подключения укажите хранилище Azure Data Lake** странице, выполните следующие действия, чтобы создать подключение.

   ![Создание связанной службы ADLS Gen2 страницы](media/load-sap-bw-data/create-adls-gen2-linked-service.png)

   1. Выберите учетную запись хранения Озера данных 2-го поколения с поддержкой из **имя** стрелку раскрывающегося списка.
   2. Выберите **Готово**, чтобы создать подключение. Затем нажмите кнопку **Далее**.

9. На **Выбор выходного файла или папки** введите **copyfromopenhub** как имя папки выходных данных. Затем нажмите кнопку **Далее**.

   ![Выберите папку страница "Вывод"](media/load-sap-bw-data/choose-output-folder.png)

10. На **параметр формата файла** выберите **Далее** использовать параметры по умолчанию.

    ![Укажите формат страницу в качестве приемника](media/load-sap-bw-data/specify-sink-format.png)

11. На **параметры** странице, разверните узел **параметры производительности**. Введите значение для **степень параллелизма копирования** например 5, чтобы загрузить из SAP BW в параллельном режиме. Затем нажмите кнопку **Далее**.

    ![Настройте параметры копирования](media/load-sap-bw-data/configure-copy-settings.png)

12. На **Сводка** просмотрите параметры. Затем нажмите кнопку **Далее**.

13. На **развертывания** выберите **монитор** для мониторинга конвейера.

    ![Страница развертывания](media/load-sap-bw-data/deployment.png)

14. Обратите внимание, что **монитор** автоматически выбрана вкладка в левой части страницы. **Действия** столбец содержит ссылки для просмотра сведений о выполняемое действие и повторно запустить конвейер.

    ![Представление мониторинга конвейера](media/load-sap-bw-data/pipeline-monitoring.png)

15. Чтобы просмотреть запуски действий, которые связаны с этим запуском конвейера, выберите **View Activity Runs** в **действия** столбца. В этом конвейере определено только одно действие (действие копирования), поэтому вы увидите только одну запись. Чтобы переключиться обратно в режим просмотра запусков конвейера, выберите **конвейеры** ссылку вверху. Щелкните **Обновить**, чтобы обновить список.

    ![Экран «мониторинг активности»](media/load-sap-bw-data/activity-monitoring.png)

16. Чтобы отслеживать сведения о выполнении для каждого действия копирования, выберите **сведения** ссылка, значок очков ниже **действия** в представлении мониторинга действия. Доступные сведения включают объем данных, скопированных из источника в приемник, пропускная способность, шаги выполнения и длительность и конфигурации, используемые.

    ![Сведения о наблюдении за действие](media/load-sap-bw-data/activity-monitoring-details.png)

17. Чтобы просмотреть **максимальный идентификатор запроса**вернитесь к мониторинг активности представление и выберите **выходные данные** под **действия**.

    ![Экран выходных данных действия](media/load-sap-bw-data/activity-output.png)

    ![Просмотр подробностей выходные данные действия](media/load-sap-bw-data/activity-output-details.png)

## <a name="do-an-incremental-copy-from-sap-bw-open-hub"></a>Делать копия будет добавочной и откройте Центр SAP BW

> [!TIP]
> См. в разделе [поток извлечения разностных соединителя SAP BW, откройте Центр](connector-sap-business-warehouse-open-hub.md#delta-extraction-flow) чтобы узнать, как соединитель SAP BW, откройте центр в фабрике данных копирует добавочные данные из SAP BW. В этой статье также может помочь вам понять основные соединитель configuration.

Теперь давайте продолжить настройку добавочного копирования из SAP BW откройте концентратора.

Добавочная копия использует механизм «верхнего предела», основанный на **идентификатор запроса**. Этот идентификатор создается автоматически в SAP BW открыть назначение концентратора DTP. Этот рабочий процесс показан на следующей схеме:

![Добавочное копирование рабочего процесса блок-схема](media/load-sap-bw-data/incremental-copy-workflow.png)

В фабрике данных **приступим к работе** выберите **Создание конвейера с помощью шаблона** для использования встроенного шаблона.

1. Поиск **SAP BW** для поиска и выбора **добавочное копирование из SAP BW в Gen2 хранилища Озера данных Azure** шаблона. Этот шаблон копирует данные в Gen2 хранилища Озера данных Azure. Аналогичный рабочий процесс можно использовать для копирования в другие типы в качестве приемника.

2. На главной странице шаблона, выберите или создайте следующие три подключения и выберите **использовать этот шаблон** в правом нижнем углу окна.

   - **Хранилище BLOB-объектов**: В этом пошаговом руководстве мы используем хранилище BLOB-объектов Azure для хранения верхнего предела, который является *max скопировать идентификатор запроса*.
   - **SAP BW открыть центр**: Это, чтобы скопировать данные из источника. Обратитесь к предыдущему пошаговому руководству полного копирования для подробных сведений о конфигурации.
   - **Хранилище Озера данных Azure 2-го поколения**: Это приемника для копирования данных. Обратитесь к предыдущему пошаговому руководству полного копирования для подробных сведений о конфигурации.

   ![Добавочное копирование из шаблона SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-template.png)

3. Этот шаблон создает конвейер со следующими тремя действиями и делает их по цепочке при успешном выполнении: *Поиск*, *копирование данных*, и *Web*.

   Перейдите в конвейер **параметры** вкладки. Вы увидите все конфигурации, которые необходимо предоставить.

   ![Добавочное копирование из конфигурации SAP BW](media/load-sap-bw-data/incremental-copy-from-sap-bw-pipeline-config.png)

   - **SAPOpenHubDestinationName**: Укажите имя таблицы откройте центр, чтобы скопировать данные из.

   - **ADLSGen2SinkPath**: Укажите путь, Gen2 хранилища Озера данных Azure копировать данные. Если путь не существует, действие копирования фабрики данных создает путь во время выполнения.

   - **HighWatermarkBlobPath**: Укажите путь для хранения значения верхнего предела, такие как `container/path`.

   - **HighWatermarkBlobName**: Укажите имя большого двоичного объекта для хранения значения верхнего предела, таких как `requestIdCache.txt`. В хранилище BLOB-объектов, перейдите в соответствующий путь HighWatermarkBlobPath + HighWatermarkBlobName, такие как *container/path/requestIdCache.txt*. Создайте большой двоичный объект с содержимым 0.

      ![Содержимое BLOB-объекта](media/load-sap-bw-data/blob.png)

   - **LogicAppURL**: В этом шаблоне мы используем WebActivity для вызова Azure Logic Apps для установки значения верхнего предела в хранилище BLOB-объектов. Или можно использовать базу данных SQL Azure для его сохранения. Используйте действия хранимой процедуры для обновления значения.

      Во-первых, необходимо создать приложение логики, как на следующем рисунке показана. Вставьте в **URL-адрес HTTP POST**.

      ![Настройка приложения логики](media/load-sap-bw-data/logic-app-config.png)

      1. Перейдите на портал Azure. Выбрать новую **Logic Apps** службы. Выберите **+ пустое приложение логики** к **конструктор Logic Apps**.

      2. Создать триггер для **поступает запрос HTTP при**. Укажите HTTP-запроса следующим образом:

         ```json
         {
            "properties": {
               "sapOpenHubMaxRequestId": {
                  "type": "string"
               }
            },
            "type": "object"
         }
         ```

      3. Добавить **создать BLOB-объект** действие. Для **путь к папке** и **имя большого двоичного объекта**, используйте те же значения, которые вы ранее настроили в **HighWatermarkBlobPath** и **HighWatermarkBlobName**.

      4. Щелкните **Сохранить**. Затем скопируйте значение **URL-адрес HTTP POST** для использования в конвейере фабрики данных.

4. После того как вы укажете параметры конвейера фабрики данных, выберите **Отладка** > **Готово** вызвать выполнение, чтобы проверить конфигурацию. Также можно выбрать **опубликовать все** для публикации изменений, а затем выберите **триггера** для выполнения запуска.

## <a name="sap-bw-open-hub-destination-configurations"></a>Конфигурации SAP BW открыть назначение концентратора

В этом разделе представлены конфигурации стороны SAP BW с помощью соединителя SAP BW, откройте центр в фабрике данных для копирования данных.

### <a name="configure-delta-extraction-in-sap-bw"></a>Настройка дельта извлечения в SAP BW

Если требуется исторические копии и добавочного копирования или только добавочное копирование, настройте разностных извлечения в SAP BW.

1. Создайте открытое назначение концентратора. Можно создать OHD в транзакции RSA1 SAP, который автоматически создает необходимые преобразования и процесс передачи данных. Используйте следующие параметры:

   - **ObjectType**: Можно использовать любой тип объекта. Здесь мы используем **InfoCube** в качестве примера.
   - **Тип назначения**: Выберите **таблица базы данных**.
   - **Ключевые таблицы**: Выберите **технические ключ**.
   - **Извлечение**. Выберите **хранить данные и вставить записи в таблицу**.

   ![Создание диалогового окна извлечения разностных SAP BW OHD](media/load-sap-bw-data/create-sap-bw-ohd-delta.png)

   ![Создание диалогового окна извлечения delta2 SAP BW OHD](media/load-sap-bw-data/create-sap-bw-ohd-delta2.png)

   Можно увеличить число одновременно выполняющихся SAP рабочих процессов для DTP:

   ![Создание sap-bw-ohd-delta3](media/load-sap-bw-data/create-sap-bw-ohd-delta3.png)

2. Запланируйте DTP в цепочек процессов.

   Разностный DTP для куба работает только в том случае, если это еще не были сжаты необходимых строк. Убедитесь, что сжатие кубов BW не работает на нее, откройте Центр перед DTP. Для этого проще всего интегрировать DTP в вашей существующей цепочек процессов. В следующем примере DTP (чтобы OHD) вставляется в цепочку процессов между *Adjust* (составного сводного) и *свернуть* действия (куба сжатия).

   ![Создание блок-схема процесса цепочки SAP BW](media/load-sap-bw-data/create-sap-bw-process-chain.png)

### <a name="configure-full-extraction-in-sap-bw"></a>Настройка полного извлечения в SAP BW

Помимо извлечения изменений может потребоваться полное извлечение из же InfoProvider SAP BW. Это обычно происходит, если требуется полная копия, но не добавочное, или вы хотите [resync разностных извлечения](#resync-delta-extraction).

Для одной OHD не может иметь более одного DTP. Таким образом необходимо создать дополнительные OHD перед извлечением изменений.

![Создание SAP BW OHD полный](media/load-sap-bw-data/create-sap-bw-ohd-full.png)

Для полной загрузки OHD выберите различные параметры, чем для извлечения изменений:

- In OHD: Задайте **извлечения** равным **удаление данных и вставить записи**. В противном случае данные будут извлекаться много раз, когда повторите DTP в цепочку процесса BW.

- В DTP: Задайте **режим извлечения** для **полный**. Необходимо изменить автоматически созданный DTP из **разностных** для **полный** сразу после создания OHD, так как на этом изображении показаны:

   ![Создание SAP BW OHD диалоговое окно, настроенный для извлечения «Full»](media/load-sap-bw-data/create-sap-bw-ohd-full2.png)

- В соединителе откройте Центр BW фабрики данных: Отключить **последнего запроса исключения**. В противном случае ничего не будут извлечены.

Обычно выполняется полное DTP вручную. Или можно создать цепочку процессов для полной DTP. Это обычно отдельной последовательности, которая не зависит от вашей существующей цепочек процессов. В любом случае *убедитесь, что DTP завершена, прежде чем начать извлечение файлов с помощью фабрики данных Копировать*. В противном случае будут скопированы только часть данных.

### <a name="run-delta-extraction-the-first-time"></a>Выполните извлечение разностных первый раз

С технической точки зрения является первой извлечения разностных *полного извлечения*. По умолчанию соединитель SAP BW, откройте Центр исключает последнего запроса, при копировании данных. Для первого извлечение изменений данные не извлекается с помощью действия копирования фабрики данных, до последующих DTP создает разностные данные в таблице с идентификатором отдельный запрос. Существует два способа избежать этого сценария:

- Отключить **последнего запроса исключения** вариант для первого разностных извлечения. Убедитесь, что первый разностных DTP завершена, прежде чем начать извлечение разностных первый раз.
-  Используйте процедуру для повторной синхронизации извлечение изменений, как описано в следующем разделе.

### <a name="resync-delta-extraction"></a>Повторная синхронизация разностных извлечения

Приведенные ниже изменения данных в кубах SAP BW, но не считается функцией изменений DTP:

- SAP BW выборочного удаления (строк с помощью любое условие фильтра)
- SAP BW запрос на удаление (неисправного запросов)

Открыть назначение концентратора SAP не управлением данных киоска данных целевой объект (в все пакеты поддержки SAP BW с момента 2015). Таким образом можно удалить данные из куба без изменения данных в OHD. Затем необходимо еще раз синхронизировать данные куба с помощью фабрики данных:

1. Запустите полное извлечение в фабрике данных (с помощью полного DTP в SAP).
2. Удалите все строки в таблице откройте Центр разностного DTP.
3. Задать состояние разностных DTP для **выбрано**.

После этого все последующие разностные DTPs и извлечения разностных фабрики данных работать должным образом.

Задать состояние разностных DTP для **выбрано**, можно использовать следующий параметр для запуска дельта DTP вручную:

    *No Data Transfer; Delta Status in Source: Fetched*

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о поддержке соединителя SAP BW, откройте центр:

> [!div class="nextstepaction"]
>[Соединитель SAP Business хранилище Open Hub](connector-sap-business-warehouse-open-hub.md)
