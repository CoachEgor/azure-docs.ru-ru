---
title: Создание триггеров на основе событий в Фабрике данных Azure | Документация Майкрософт
description: Узнайте, как создать в Фабрике данных Azure триггер, который запускает конвейер в ответ на событие.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 10/18/2018
author: sharonlo101
ms.author: shlo
manager: craigg
ms.openlocfilehash: 94c9c3f997143d72262c1ba3d8dbfea90d6f920c
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "61347727"
---
# <a name="create-a-trigger-that-runs-a-pipeline-in-response-to-an-event"></a>Создание триггера, запускающего конвейер в ответ на событие

В этой статье описаны триггеры на основе событий, создаваемые в конвейерах Фабрики данных.

Управляемая событиями архитектура (EDA) — это общий шаблон интеграции данных, включающий в себя производство, обнаружение, потребление и реагирование на события. При выполнении сценариев интеграции данных клиентам Фабрики данных часто требуется запускать конвейеры на основе событий. Фабрика данных теперь интегрируется с [Сеткой событий Azure](https://azure.microsoft.com/services/event-grid/), что позволяет активировать конвейеры на основе событий.

Уделите 10 минут своего времени, чтобы просмотреть следующее видео с кратким обзором и демонстрацией этой функции:

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Event-based-data-integration-with-Azure-Data-Factory/player]


> [!NOTE]
> Интеграция, описанная в этой статье, зависит от службы [Сетка событий Azure](https://azure.microsoft.com/services/event-grid/). Убедитесь, что ваша подписка зарегистрирована у поставщика ресурсов "Сетка событий". См. дополнительные сведения о [поставщиках и типах ресурсов](../azure-resource-manager/resource-manager-supported-services.md#azure-portal).

## <a name="data-factory-ui"></a>Пользовательский интерфейс фабрики данных

### <a name="create-a-new-event-trigger"></a>Создание триггера события

Обычное событие — получение или удаление файла в учетной записи службы хранилища Azure. Вы можете создать триггер, реагирующий на это событие, в конвейере Фабрики данных.

> [!NOTE]
> Для этой интеграции поддерживаются только учетные записи хранения версии 2 (общего назначения).

![Создание триггера события](media/how-to-create-event-trigger/event-based-trigger-image1.png)

### <a name="configure-the-event-trigger"></a>Настройка триггера события

С помощью свойств **Blob path begins with** (Путь большого двоичного объекта начинается с) и **Blob path ends with** (Путь большого двоичного объекта заканчивается на) можно указать названия контейнеров, папок и больших двоичных объектов, для которых необходимо получать события. Вы можете использовать различные шаблоны для свойств **Blob path begins with** (Путь большого двоичного объекта начинается с) и **Blob path ends with** (Путь большого двоичного объекта заканчивается на), как показано в примерах далее в этой статье. Необходимо указать по крайней мере одно из этих свойств.

![Настройка триггера события](media/how-to-create-event-trigger/event-based-trigger-image2.png)

### <a name="select-the-event-trigger-type"></a>Выбор типа триггера события

Это событие запускает и выполняет конвейер Фабрики данных сразу после получения файла в месте хранения и создания большого двоичного объекта. Вы можете создать триггер, реагирующий на события создания или удаления большого двоичного объекта, а также на оба эти события в конвейерах Фабрики данных.

![Выбор типа триггера в качестве события](media/how-to-create-event-trigger/event-based-trigger-image3.png)

### <a name="map-trigger-properties-to-pipeline-parameters"></a>Сопоставление свойств триггера с параметрами конвейера

При срабатывании триггера событий для конкретного большого двоичного объекта событие записывает путь к папке и имя файла большого двоичного объекта в свойства `@triggerBody().folderPath` и `@triggerBody().fileName`. Чтобы использовать значения этих свойств в конвейере, необходимо сопоставить эти свойства с параметрами конвейера. После сопоставления свойств с параметрами можно получить доступ к значениям, записанным с помощью триггера, через выражение `@pipeline().parameters.parameterName` в конвейере.

![Сопоставление свойств с параметрами конвейера](media/how-to-create-event-trigger/event-based-trigger-image4.png)

Например, на предыдущем снимке экрана триггер настроен таким образом, что срабатывает, когда в учетной записи хранения создается путь большого двоичного объекта, оканчивающийся на `.csv`. В результате, когда большой двоичный объект с расширением `.csv` создается в учетной записи хранения, свойства `folderPath` и `fileName` записывают расположение нового большого двоичного объекта. Например, `@triggerBody().folderPath` имеет значение `/containername/foldername/nestedfoldername`, `@triggerBody().fileName` имеет значение `filename.csv`. Эти значения сопоставляются в примере с параметрами конвейера `sourceFolder` и `sourceFile`. Их можно использовать в конвейере как `@pipeline().parameters.sourceFolder` и `@pipeline().parameters.sourceFile` соответственно.

## <a name="json-schema"></a>Схема JSON

В таблице ниже приводится обзор элементов схемы, относящихся к триггерам на основе событий:

| **Элемент JSON** | **Описание** | **Тип** | **Допустимые значения** | **Обязательный** |
| ---------------- | --------------- | -------- | ------------------ | ------------ |
| **scope** | Идентификатор ресурса Azure Resource Manager учетной записи хранения. | String | Идентификатор Azure Resource Manager | Да |
| **events** | Тип событий, вызывающих срабатывание триггера. | Массив,    | Microsoft.Storage.BlobCreated, Microsoft.Storage.BlobDeleted | Да, любое сочетание этих значений. |
| **blobPathBeginsWith** | Путь большого двоичного объекта должен начинаться с шаблона, указанного для срабатывания триггера. Например, `/records/blobs/december/` активирует только триггер для больших двоичных объектов в папке `december` контейнера `records`. | String   | | Вы должны предоставить значение хотя бы для одного из этих свойств: `blobPathBeginsWith` или `blobPathEndsWith`. |
| **blobPathEndsWith** | Путь большого двоичного объекта должен оканчиваться шаблоном, указанным для срабатывания триггера. Например, `december/boxes.csv` активирует только триггер для больших двоичных объектов с именем `boxes` в папке `december`. | String   | | Вы должны предоставить значение хотя бы для одного из этих свойств: `blobPathBeginsWith` или `blobPathEndsWith`. |

## <a name="examples-of-event-based-triggers"></a>Примеры триггеров на основе событий

В этом разделе приведены примеры параметров триггера на основе событий.

> [!IMPORTANT]
> Каждый раз, когда вы указываете контейнер и папку, контейнер и файл или контейнер, папку и файл, добавляйте сегмент пути `/blobs/`, как показано в следующих примерах.

| Свойство | Пример | Описание |
|---|---|---|
| **Путь большого двоичного объекта начинается с** | `/containername/` | Получает события для любого большого двоичного объекта в контейнере. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/` | Получает события для любого большого двоичного объекта в контейнере `containername` и папке `foldername`. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/subfoldername/` | Можно также указать ссылку на вложенную папку. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в папке `foldername` в контейнере `containername`. |
| **Большой двоичный объект оканчивается на** | `file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в любом пути. |
| **Большой двоичный объект оканчивается на** | `/containername/blobs/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в контейнере `containername`. |
| **Большой двоичный объект оканчивается на** | `foldername/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в папке `foldername` в любом контейнере. |

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в руководстве по [выполнению конвейера и использованию триггеров](concepts-pipeline-execution-triggers.md#triggers).
