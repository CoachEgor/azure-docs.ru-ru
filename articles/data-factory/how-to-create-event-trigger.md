---
title: Создание триггеров на основе событий в Azure Data Factory
description: Узнайте, как создать в Фабрике данных Azure триггер, который запускает конвейер в ответ на событие.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
author: djpmsft
ms.author: daperlov
manager: jroth
ms.reviewer: maghan
ms.topic: conceptual
ms.date: 10/18/2018
ms.openlocfilehash: e4301afafb48fb9a1b0c9e36dde9800e2b8390f1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75443926"
---
# <a name="create-a-trigger-that-runs-a-pipeline-in-response-to-an-event"></a>Создание триггера, запускающего конвейер в ответ на событие

В этой статье описаны триггеры на основе событий, создаваемые в конвейерах Фабрики данных.

Управляемая событиями архитектура (EDA) — это общий шаблон интеграции данных, включающий в себя производство, обнаружение, потребление и реагирование на события. В сценариях интеграции данных часто требуется, чтобы клиенты Data Factory запускали конвейеры на основе таких событий, как прибытие или удаление файла в учетной записи хранения Azure. Фабрика данных теперь интегрируется с [Сеткой событий Azure](https://azure.microsoft.com/services/event-grid/), что позволяет активировать конвейеры на основе событий.

Уделите 10 минут своего времени, чтобы просмотреть следующее видео с кратким обзором и демонстрацией этой функции:

> [!VIDEO https://channel9.msdn.com/Shows/Azure-Friday/Event-based-data-integration-with-Azure-Data-Factory/player]


> [!NOTE]
> Интеграция, описанная в этой статье, зависит от службы [Сетка событий Azure](https://azure.microsoft.com/services/event-grid/). Убедитесь, что ваша подписка зарегистрирована у поставщика ресурсов "Сетка событий". См. дополнительные сведения о [поставщиках и типах ресурсов](../azure-resource-manager/management/resource-providers-and-types.md#azure-portal).

## <a name="data-factory-ui"></a>Пользовательский интерфейс Фабрики данных

В этом разделе показано, как создать триггер события в пользовательском интерфейсе Azure Data Factory.

1. Перейти к **автору холст**

1. В левом нижнем углу нажмите на кнопку **Триггеры**

1. Нажмите **и новый,** который откроет создать триггер боковой навигатор

1. Выберите **событие** типа триггера

    ![Создание триггера события](media/how-to-create-event-trigger/event-based-trigger-image1.png)

1. Выберите учетную запись хранения из системы отбрасывания подписки Azure или вручную, используя идентификатор ресурса учетной записи хранения. Выберите контейнер, на котором вы хотите, чтобы события происходили. Выбор контейнеров является необязательным, но помните, что выбор всех контейнеров может привести к большому количеству событий.

   > [!NOTE]
   > В настоящее время Event Trigger поддерживает только учетные записи хранения azure Data Lake Storage Gen2 и учетные записи 2 систем общего назначения. Из-за ограничения Azure Event Grid, Azure Data Factory поддерживает максимум 500 триггеров событий на одну учетную запись хранения.

1. **Путь Blob начинается с** того, что путь **Blob заканчивается свойствами,** позволяющими указать имена контейнеров, папок и каблов, для которых вы хотите получать события. Триггер события требует, чтобы было определено по крайней мере одно из этих свойств. Вы можете использовать различные шаблоны для свойств **Blob path begins with** (Путь большого двоичного объекта начинается с) и **Blob path ends with** (Путь большого двоичного объекта заканчивается на), как показано в примерах далее в этой статье.

    * **Blob путь начинается с:** Путь капли должен начинаться с пути папки. Допустимые значения включают `2018/` и `2018/april/shoes.csv`. Это поле не может быть выбрано, если контейнер не выбран.
    * **Путь Blob заканчивается:** Путь blob должен заканчиваться именем файла или расширением. Допустимые значения включают `shoes.csv` и `.csv`. Имя контейнера и папки не обязательно, но `/blobs/` при указании они должны быть разделены сегментом. Например, контейнер под названием 'заказы' `/orders/blobs/2018/april/shoes.csv`может иметь значение. Чтобы указать папку в любом контейнере, опустите ведущий символ '/'. Например, `april/shoes.csv` запустит событие в любом `shoes.csv` файле, названном в папке, под названием "апрель" в любом контейнере. 

1. Выберите, будет ли ваш триггер реагировать на **созданное Blob** событие, **событие Blob, удаленное или** и то, и другое. В указанном месте хранения каждое событие будет вызывать конвейеры Data Factory, связанные с триггером.

    ![Настройка триггера события](media/how-to-create-event-trigger/event-based-trigger-image2.png)

1. Выберите, игнорирует ли ваш триггер капли с нулевыми байтами.

1. После настройки триггера нажмите на **следующий: предварительный просмотр данных.** На этом экране отображается существующая каплю, соответствующую конфигурации триггера события. Убедитесь, что у вас есть конкретные фильтры. Слишком широкие фильтры для настройки могут соответствовать большому количеству созданных/удаленных файлов и существенно повлиять на стоимость. Как только условия фильтра будут проверены, нажмите **Finish.**

    ![Предварительный просмотр данных триггера события](media/how-to-create-event-trigger/event-based-trigger-image3.png)

1. Чтобы прикрепить конвейер к этому триггеру, перейдите к холсту конвейера и нажмите **Добавить триггер** и выберите **New/Edit.** Когда появится боковой навигатор, нажмите на **триггер Select...** Нажмите **далее: Предварительный просмотр данных,** чтобы подтвердить конфигурацию является правильным, а затем **далее** для проверки предварительный просмотр данных является правильным.

1. Если ваш конвейер имеет параметры, вы можете указать их на триггерных запусках параметра бокового навистого. Триггер события захватывает путь папки и имя файла `@triggerBody().folderPath` капли `@triggerBody().fileName`в свойства и . Чтобы использовать значения этих свойств в конвейере, необходимо сопоставить эти свойства с параметрами конвейера. После сопоставления свойств с параметрами можно получить доступ к значениям, записанным с помощью триггера, через выражение `@pipeline().parameters.parameterName` в конвейере. Нажмите **Закончить,** как только вы закончите.

    ![Сопоставление свойств с параметрами конвейера](media/how-to-create-event-trigger/event-based-trigger-image4.png)

В предыдущем примере триггер настроен для запуска при создании пути каплей, заканчивающегося в .csv в папке тестирования событий в данных образца контейнера. Свойства **folderPath** и **fileName** захватывают местоположение нового капли. Например, когда MoviesDB.csv добавляется к `@triggerBody().folderPath` пробе-данные/тестированию `sample-data/event-testing` событий, имеет значение и `@triggerBody().fileName` имеет значение `moviesDB.csv`. Эти значения отображаются в примере `sourceFolder` `sourceFile` к параметрам конвейера `@pipeline().parameters.sourceFolder` и `@pipeline().parameters.sourceFile` которые могут быть использованы во всем конвейере как и соответственно.

## <a name="json-schema"></a>Схема JSON

В таблице ниже приводится обзор элементов схемы, относящихся к триггерам на основе событий:

| **Элемент JSON** | **Описание** | **Тип** | **Разрешенные значения** | **Обязательно** |
| ---------------- | --------------- | -------- | ------------------ | ------------ |
| **область действия** | Идентификатор ресурса Azure Resource Manager учетной записи хранения. | Строка | Идентификатор Azure Resource Manager | Да |
| **События** | Тип событий, вызывающих срабатывание триггера. | Array    | Microsoft.Storage.BlobCreated, Microsoft.Storage.BlobDeleted | Да, любое сочетание этих значений. |
| **blobPathBeginsWith** | Путь большого двоичного объекта должен начинаться с шаблона, указанного для срабатывания триггера. Например, `/records/blobs/december/` активирует только триггер для больших двоичных объектов в папке `december` контейнера `records`. | Строка   | | Вы должны предоставить значение хотя бы для одного из этих свойств: `blobPathBeginsWith` или `blobPathEndsWith`. |
| **blobPathEndsWith** | Путь большого двоичного объекта должен оканчиваться шаблоном, указанным для срабатывания триггера. Например, `december/boxes.csv` активирует только триггер для больших двоичных объектов с именем `boxes` в папке `december`. | Строка   | | Вы должны предоставить значение хотя бы для одного из этих свойств: `blobPathBeginsWith` или `blobPathEndsWith`. |
| **ignoreEmptyBlobs** | Независимо от того, смогут ли капли с нулевым байт запустить конвейер. По умолчанию это соответствует действительности. | Логическое | true или false | нет |

## <a name="examples-of-event-based-triggers"></a>Примеры триггеров на основе событий

В этом разделе приведены примеры параметров триггера на основе событий.

> [!IMPORTANT]
> Каждый раз, когда вы указываете контейнер и папку, контейнер и файл или контейнер, папку и файл, добавляйте сегмент пути `/blobs/`, как показано в следующих примерах. Для **blobPathBeginsWith**, uI Data `/blobs/` Factory автоматически добавит между папкой и именем контейнера в триггере JSON.

| Свойство | Пример | Описание |
|---|---|---|
| **Путь большого двоичного объекта начинается с** | `/containername/` | Получает события для любого большого двоичного объекта в контейнере. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/` | Получает события для любого большого двоичного объекта в контейнере `containername` и папке `foldername`. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/subfoldername/` | Можно также указать ссылку на вложенную папку. |
| **Путь большого двоичного объекта начинается с** | `/containername/blobs/foldername/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в папке `foldername` в контейнере `containername`. |
| **Большой двоичный объект оканчивается на** | `file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в любом пути. |
| **Большой двоичный объект оканчивается на** | `/containername/blobs/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в контейнере `containername`. |
| **Большой двоичный объект оканчивается на** | `foldername/file.txt` | Получает события для большого двоичного объекта с именем `file.txt` в папке `foldername` в любом контейнере. |

## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения см. в руководстве по [выполнению конвейера и использованию триггеров](concepts-pipeline-execution-triggers.md#triggers).
