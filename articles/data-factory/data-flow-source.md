---
title: Преобразование источника в потоке данных сопоставления
description: Узнайте, как настроить преобразование источника в потоке данных сопоставления.
author: kromerm
ms.author: makromer
manager: anandsub
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 09/27/2020
ms.openlocfilehash: d850bcf2ffbd3867ab28d7dee54df3f8b427fd6e
ms.sourcegitcommit: ada9a4a0f9d5dbb71fc397b60dc66c22cf94a08d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2020
ms.locfileid: "91404758"
---
# <a name="source-transformation-in-mapping-data-flow"></a>Преобразование источника в потоке данных сопоставления 

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Преобразование «источник» настраивает источник данных для потока данных. При проектировании потоков данных первым шагом всегда будет настройка преобразования «источник». Чтобы добавить источник, щелкните поле **Добавить источник** на холсте потока данных.

Для каждого потока данных требуется по крайней мере одно преобразование источника, но при необходимости можно добавить столько источников, сколько необходимо для выполнения преобразований данных. Вы можете объединить эти источники вместе с преобразованием «соединение», «уточняющий запрос» или «объединение».

Каждое преобразование источника связано только с одним набором данных или связанной службой. Набор данных определяет форму и расположение данных, которые необходимо записать или прочитать. При использовании файлового набора данных можно использовать подстановочные знаки и списки файлов в источнике для работы с несколькими файлами за раз.

## <a name="inline-datasets"></a>Встроенные наборы данных

Первое решение, которое вы создаете при создании преобразования источника, — это определение того, определены ли сведения об источнике внутри объекта DataSet или в преобразовании источника. Большинство форматов доступны только в одном или другом. Чтобы узнать, как использовать конкретный соединитель, ознакомьтесь с соответствующим документом соединителя.

Если формат поддерживается как для встроенного, так и для объекта DataSet, то оба имеют преимущества. Объекты DataSet — это многократно используемые сущности, которые можно использовать в других потоках данных и действиях, таких как копирование. Они особенно полезны при использовании зафиксированной схемы. Наборы данных не основаны на Spark и иногда может потребоваться переопределить некоторые параметры или проекции схемы в преобразовании «источник».

Встроенные наборы данных рекомендуются при использовании гибких схем, одноразовых экземпляров источника или параметризованных источников. Если источник сильно параметризован, встроенные наборы данных позволяют не создавать фиктивные объекты. Встроенные наборы данных основаны на Spark, а их свойства являются собственными для потока данных.

Чтобы использовать встроенный набор данных, выберите нужный формат в селекторе **типа источника** . Вместо выбора исходного набора данных выберите связанную службу, к которой нужно подключиться.

![Встроенный набор данных](media/data-flow/inline-selector.png "Встроенный набор данных")

##  <a name="supported-source-types"></a><a name="supported-sources"></a> Поддерживаемые типы источников

Поток данных сопоставления соответствует подходу "извлечь", "Загрузка", "преобразование" (ELT) и работает с *промежуточными* наборами DataSet, которые находятся в Azure. В настоящее время в преобразовании источника можно использовать следующие наборы данных:

| Соединитель | Формат | Набор данных или встраивание |
| --------- | ------ | -------------- |
| [Хранилище BLOB-объектов Azure](connector-azure-blob-storage.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties)<br>[Дельта (Предварительная версия)](format-delta.md)<br>[Excel](format-excel.md#mapping-data-flow-properties)<br>[JSON](format-json.md#mapping-data-flow-properties) <br>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties)<br>[XML](format-xml.md#mapping-data-flow-properties) | ✓/-<br>✓/-<br>-/✓<br>✓/✓<br/>✓/-<br>✓/✓<br/>✓/-<br>✓/✓ |
| [Azure Data Lake Storage 1-го поколения](connector-azure-data-lake-store.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties)<br>[Excel](format-excel.md#mapping-data-flow-properties)<br>[JSON](format-json.md#mapping-data-flow-properties)<br>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties)<br>[XML](format-xml.md#mapping-data-flow-properties) | ✓/-<br>✓/-<br>✓/✓<br/>✓/-<br>✓/✓<br/>✓/-<br>✓/✓ |
| [Azure Data Lake Storage 2-го поколения](connector-azure-data-lake-storage.md#mapping-data-flow-properties) | [Avro](format-avro.md#mapping-data-flow-properties)<br>[Общая модель данных (Предварительная версия)](format-common-data-model.md#source-properties)<br>[Текст с разделителями](format-delimited-text.md#mapping-data-flow-properties)<br>[Дельта (Предварительная версия)](format-delta.md)<br>[Excel](format-excel.md#mapping-data-flow-properties)<br>[JSON](format-json.md#mapping-data-flow-properties)<br>[ORC](format-orc.md#mapping-data-flow-properties)<br/>[Parquet](format-parquet.md#mapping-data-flow-properties)<br>[XML](format-xml.md#mapping-data-flow-properties) | ✓/-<br/>-/✓<br>✓/-<br>-/✓<br>✓/✓<br>✓/-<br/>✓/✓<br/>✓/-<br>✓/✓ |
| [Azure Synapse Analytics](connector-azure-sql-data-warehouse.md#mapping-data-flow-properties) | | ✓/- |
| [База данных SQL Azure](connector-azure-sql-database.md#mapping-data-flow-properties) | | ✓/- |
| [Azure Cosmos DB (SQL API)](connector-azure-cosmos-db.md#mapping-data-flow-properties) | | ✓/- |
| [Snowflake](connector-snowflake.md) | | ✓/✓ |

Параметры, относящиеся к этим соединителям, находятся на вкладке **Параметры источника** . Сведения и примеры сценариев потока данных для этих параметров находятся в документации по соединителю. 

Фабрике данных Azure доступно более [90 собственных соединителей](connector-overview.md). Чтобы включить данные из других источников в потоке данных, используйте действие копирования для загрузки этих данных в одну из поддерживаемых промежуточных областей.

## <a name="source-settings"></a>Параметры источника

После добавления источника настройте его с помощью вкладки **Параметры источника** . Здесь можно выбрать или создать набор данных, на котором находятся исходные точки. Можно также выбрать схему и параметры выборки для данных.

![Вкладка "Параметры источника"](media/data-flow/source1.png "Вкладка "Параметры источника"")

**Имя выходного потока:** Имя преобразования источника.

**Тип источника:** Выберите, следует ли использовать встроенный набор данных или существующий объект DataSet.

**Проверить подключение:** Проверьте, может ли служба Spark потока данных успешно подключаться к связанной службе, используемой в исходном наборе данных. Для включения этой функции необходимо включить режим отладки.

Отклонение **схемы.** [смещение схемы](concepts-data-flow-schema-drift.md) — это способность фабрики данных в собственном коде управлять гибкими схемами в потоках данных без необходимости явно определять изменения столбцов.

* Установите флажок **Разрешить смещение схемы** , если исходные столбцы будут часто меняться. Этот параметр позволяет всем входящим полям источника проходить через преобразования в приемник.

* Выбор **типов столбцов с несмещенными типами** позволит фабрике данных обнаруживать и определять типы данных для каждого обнаруженного нового столбца. Если эта функция отключена, все смещенные столбцы будут иметь строковый тип.

**Проверить схему:** Если выбран параметр проверить схему, поток данных не будет выполняться, если входящие исходные данные не соответствуют определенной схеме набора данных.

**Пропустить число строк:** В поле пропустить число строк указывается, сколько строк следует игнорировать в начале набора данных.

**Выборка:** Включите выборку, чтобы ограничить количество строк в источнике. Используйте этот параметр при тестировании или выборки данных из источника для отладки.

Чтобы проверить правильность настройки источника, включите режим отладки и получите предварительную версию данных. Дополнительные сведения см. в разделе [режим отладки](concepts-data-flow-debug-mode.md).

> [!NOTE]
> Когда режим отладки включен, конфигурация ограничения строк в параметрах отладки будет перезаписывать параметр выборки в источнике при предварительном просмотре данных.

## <a name="source-options"></a>Параметры источника

Вкладка Параметры источника содержит параметры, относящиеся к выбранному соединителю и формату. Дополнительные сведения и примеры см. в [документации по соответствующему соединителю](#supported-sources).

## <a name="projection"></a>Проекция

Подобно схемам в наборах данных, проекция в источнике определяет столбцы данных, типы и форматы из исходных. Для большинства типов наборов данных, таких как SQL и Parquet, проекция в источнике исправлена в соответствии со схемой, определенной в наборе данных. Если исходные файлы не являются строго типизированными (например, плоскими CSV-файлами, а не файлами Parquet), можно определить типы данных для каждого поля в преобразовании «источник».

![Параметры на вкладке "Проекция"](media/data-flow/source3.png "Проекция")

Если в текстовом файле не определена схема, выберите команду **определить тип данных** , чтобы фабрика данных выработала выборку и вывести типы данных. Выберите параметр **определить формат по умолчанию** , чтобы автоматически определить форматы данных по умолчанию.

**Сброс схемы** сбрасывает проекцию до того, что определено в наборе данных, на который указывает ссылка.

Типы данных столбца можно изменить в некотором преобразовании «Производный столбец». Используйте преобразование SELECT, чтобы изменить имена столбцов.

### <a name="import-schema"></a>Импорт схемы

Кнопка **Импорт схемы** на вкладке **проекция** позволяет использовать активный кластер отладки для создания проекции схемы. При импорте схемы, доступной в каждом типе источника, будет переопределена проекция, определенная в наборе данных. Объект DataSet не будет изменен.

Это полезно в таких наборах данных, как Avro и Azure Cosmos DB, которые поддерживают сложные структуры, но не нуждаются в определениях схем в наборе данных. Для встроенных наборов данных это единственный способ ссылки на метаданные столбца без смещения схемы.

## <a name="optimize-the-source-transformation"></a>Оптимизация преобразования источника

Вкладка **оптимизировать** позволяет изменять сведения о секциях на каждом шаге преобразования. В большинстве случаев **использование текущего секционирования** будет оптимизировано для идеальной структуры секционирования для источника.

При чтении из источника базы данных SQL Azure настраиваемое **исходное** секционирование, скорее всего, будет считывать данные быстрее. ADF будет считывать большие запросы, делая подключения к базе данных в параллельном режиме. Это исходное секционирование можно выполнить для столбца или с помощью запроса.

![Параметры исходной секции](media/data-flow/sourcepart3.png "Секционирование")

Дополнительные сведения о оптимизации в потоке данных сопоставления см. на [вкладке "оптимизация"](concepts-data-flow-overview.md#optimize).

## <a name="next-steps"></a>Дальнейшие действия

Начните создавать поток данных с помощью [преобразования «Производный столбец](data-flow-derived-column.md) » и [преобразования «выбор](data-flow-select.md)».
