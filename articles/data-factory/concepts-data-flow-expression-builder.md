---
title: Построитель выражений в потоке данных сопоставления
description: Построение выражений с помощью построителя выражений при сопоставлении потоков данных в фабрике данных Azure
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 12/9/2019
ms.openlocfilehash: 01aa2574ac6edd1ce5e1b209eac3e43bbed82fce
ms.sourcegitcommit: 5ab4f7a81d04a58f235071240718dfae3f1b370b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2019
ms.locfileid: "74969397"
---
# <a name="building-expressions-in-mapping-data-flow"></a>Создание выражений в потоке данных сопоставления

В потоке данных сопоставления многие свойства преобразования задаются как выражения. Эти выражения состоят из значений столбцов, параметров, функций, операторов и литералов, результатом вычисления которых является тип данных Spark во время выполнения.

## <a name="opening-the-expression-builder"></a>Открытие построителя выражений

Интерфейс редактирования выражений в UX фабрики данных знает как **Построитель выражений**. По мере ввода в логике выражения фабрика данных использует функцию завершения кода [IntelliSense](https://docs.microsoft.com/visualstudio/ide/using-intellisense?view=vs-2019) для выделения, проверки синтаксиса и автозаполнения.

![Построитель выражений](media/data-flow/xpb1.png "Построитель выражений")

В таких преобразованиях, как производный столбец и фильтр, где выражения являются обязательными, откройте построитель выражений, щелкнув синюю поле выражения.

![Построитель выражений](media/data-flow/expressionbox.png "Построитель выражений")

При ссылке на столбцы в условии сопоставления или группирования выражение может извлекать значения из столбцов. Чтобы создать выражение, выберите параметр "вычисляемый столбец".

![Построитель выражений](media/data-flow/computedcolumn.png "Построитель выражений")

В случаях, когда выражение или литеральное значение являются допустимыми входными данными, "добавить динамическое содержимое" позволит построить выражение, результатом вычисления которого является литерал.

![Построитель выражений](media/data-flow/add-dynamic-content.png "Построитель выражений")

## <a name="expression-language-reference"></a>Справочник по языку выражений

Сопоставление потоков данных имеет встроенные функции и операторы, которые можно использовать в выражениях. Список доступных функций находится на странице Справочник по [языку выражений потока данных сопоставления](data-flow-expression-functions.md) .

## <a name="column-names-with-special-characters"></a>Имена столбцов с специальными символами

Если имена столбцов содержат специальные символы или пробелы, заключите имя в фигурные скобки, чтобы ссылаться на них в выражении.

```{[dbo].this_is my complex name$$$}```

## <a name="previewing-expression-results"></a>Просмотр результатов выражения

Если включен [режим отладки](concepts-data-flow-debug-mode.md) , можно использовать динамический кластер Spark для просмотра выполняемого в данный момент предварительного просмотра того, на что вычисляется выражение. При создании логики можно отлаживать выражение в режиме реального времени. 

![Построитель выражений](media/data-flow/exp4b.png "Предварительный просмотр данных выражения")

Нажмите кнопку "Обновить", чтобы обновить результаты выражения на основе реальной выборки источника.

![Построитель выражений](media/data-flow/exp5.png "Предварительный просмотр данных выражения")

## <a name="string-interpolation"></a>Интерполяция строк

Используйте двойные кавычки для заключения текста литеральной строки вместе с выражениями. Можно включать функции выражений, столбцы и параметры. Интерполяция строк полезна, чтобы избежать широкого использования объединения строк при включении параметров в строки запроса. Чтобы использовать синтаксис выражений, заключите его в фигурные скобки,

Некоторые примеры интерполяции строк:

* ```"My favorite movie is {iif(instr(title,', The')>0,"The {split(title,', The')[1]}",title)}"```

* ```"select * from {$tablename} where orderyear > {$year}"```

* ```"Total cost with sales tax is {round(totalcost * 1.08,2)}"```

## <a name="commenting-expressions"></a>Выражения комментариев

К выражениям можно добавлять комментарии с использованием однострочного и многострочного синтаксиса комментариев:

![Комментарии](media/data-flow/comments.png "Комментарии")

Ниже приведены примеры допустимых комментариев.

* ```/* This is my comment */```

* ```/* This is a```
*   ```multi-line comment */```
   
* ```// This is a single line comment```

Если вы поместили комментарий в верхней части выражения, он появится в текстовом поле преобразование, чтобы документировать выражения преобразования:

![Комментарии](media/data-flow/comments2.png "Комментарии")

## <a name="regular-expressions"></a>Регулярные выражения

Многие функции языка выражений используют синтаксис регулярных выражений. При использовании функций регулярных выражений построитель выражений попытается интерпретировать обратную косую черту (\\) как последовательность escape-символов. При использовании обратных косых черт в регулярном выражении либо заключите все регулярное выражение в такты (\`), либо используйте двойную обратную косую черту.

Пример использования обратных кавычек

```
regex_replace('100 and 200', `(\d+)`, 'digits')
```

и двойной обратной косой черты

```
regex_replace('100 and 200', '(\\d+)', 'digits')
```

## <a name="addressing-array-indexes"></a>Адресация индексов массива

При использовании функций выражений, которые возвращают массивы, используйте квадратные скобки [], чтобы обращаться к конкретному индексу в возвращаемом объекте массива. Массив отсчитывается от единицы.

![Массив построителя выражений](media/data-flow/expb2.png "Предварительный просмотр данных выражения")

## <a name="keyboard-shortcuts"></a>Сочетания клавиш

* ```Ctrl-K Ctrl-C```: все строки комментариев
* ```Ctrl-K Ctrl-U```: раскомментировать
* ```F1```: предоставление команд справки по редактору
* ```Alt-Down Arrow```: перемещение вниз текущей строки
* ```Alt-Up Arrow```: перемещение вверх текущей строки
* ```Cntrl-Space```: отображение контекстной справки

## <a name="convert-to-dates-or-timestamps"></a>Преобразовать в даты или метки времени

Чтобы включить строковые литералы в выходные данные отметок времени, необходимо заключить преобразование в ```toString()```.

```toString(toTimestamp('12/31/2016T00:12:00', 'MM/dd/yyyy\'T\'HH:mm:ss'), 'MM/dd /yyyy\'T\'HH:mm:ss')```

Чтобы преобразовать миллисекунды из эпохи в дату или отметку времени, используйте `toTimestamp(<number of milliseconds>)`. Если время исходят в секундах, умножьте его на 1000.

```toTimestamp(1574127407*1000l)```

Завершающий символ "l" в конце выражения выше означает преобразование в тип long в качестве встроенного синтаксиса.

## <a name="next-steps"></a>Дальнейшие действия

[Начало создания выражений преобразования данных](data-flow-expression-functions.md)
