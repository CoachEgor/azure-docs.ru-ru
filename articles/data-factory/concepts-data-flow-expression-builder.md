---
title: Строитель выражения в картировании потока данных
description: Создавайте выражения с помощью builder выражения в картировании потоков данных в Azure Data Factory
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.date: 04/08/2020
ms.openlocfilehash: dda2812b5e2cc79d53658d568ba0845d593f41d6
ms.sourcegitcommit: 5e49f45571aeb1232a3e0bd44725cc17c06d1452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81605381"
---
# <a name="build-expressions-in-mapping-data-flow"></a>Создание выражений в картировании потока данных

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

При картировании потока данных многие свойства преобразования вводятся в виде выражений. Эти выражения состоят из значений столбца, параметров, функций, операторов и буквальных значений, которые оценивают тип данных Spark во время выполнения.

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4tkur]

## <a name="open-expression-builder"></a>Строитель открытого выражения

Интерфейс редактирования выражений в пользовательском интерфейсе Azure Data Factory известен как Expression Builder. При вводе логики выражения Data Factory использует завершение кода [IntelliSense](https://docs.microsoft.com/visualstudio/ide/using-intellisense?view=vs-2019) для выделения, проверки синтаксиса и автоматического завершения.

![Строитель выражения](media/data-flow/xpb1.png "Построитель выражений")

В преобразованиях, таких как производный столбец и фильтр, где выражения являются обязательными, откройте Builder выражения, выбрав синий ящик выражения.

![Голубая коробка выражения](media/data-flow/expressionbox.png "Построитель выражений")

При ссылке столбцов в соответствие или по группе условие множеству может извлечь значения из столбцов. Чтобы создать выражение, выберите **вычисляемый столбец.**

![Опция вычисляемый столбец](media/data-flow/computedcolumn.png "Построитель выражений")

В тех случаях, когда выражение или буквальное значение являются допустимым вводимым материалом, выберите **Добавить динамическое содержимое,** чтобы создать выражение, которое оценивается до буквального значения.

![Добавление опции динамического содержимого](media/data-flow/add-dynamic-content.png "Построитель выражений")

## <a name="expression-language-reference"></a>Ссылка на язык выражения

Потоки карт данных имеют встроенные функции и операторов, которые могут быть использованы в выражениях. Для списка доступных функций [см.](data-flow-expression-functions.md)

## <a name="column-names-with-special-characters"></a>Названия столбцов со специальными символами

Если у вас есть названия столбцов, которые включают специальные символы или пробелы, окружите имя фигурными скобками, чтобы ссылаться на них в выражении.

```{[dbo].this_is my complex name$$$}```

## <a name="preview-expression-results"></a>Предварительный просмотр результатов выражения

При включении [режима отладки](concepts-data-flow-debug-mode.md) можно использовать кластер Spark в реальном времени, чтобы увидеть предварительный просмотр того, что оценивает ваше выражение. Померев построить логику, вы можете отладить выражение в режиме реального времени. 

![Предварительный просмотр в процессе](media/data-flow/exp4b.png "Предварительный просмотр данных выражения")

Выберите **Refresh,** чтобы обновить результаты выражения по отношению к живому образцу вашего источника.

![Кнопка "Обновить"](media/data-flow/exp5.png "Предварительный просмотр данных выражения")

## <a name="string-interpolation"></a>Интерполяция строк

Используйте кавычки, чтобы приложить буквальный текст строки вместе с выражениями. Функции выражения, столбцы и параметры могут включать сяовыражение. Строка интерполяции полезна, чтобы избежать широкого использования строки конкатации, когда параметры включены в строки запроса. Чтобы использовать синтаксис выражения, приложить его в фигурные скобки,

Некоторые примеры линии интерполяции:

* ```"My favorite movie is {iif(instr(title,', The')>0,"The {split(title,', The')[1]}",title)}"```

* ```"select * from {$tablename} where orderyear > {$year}"```

* ```"Total cost with sales tax is {round(totalcost * 1.08,2)}"```

## <a name="comment-expressions"></a>Выражения комментариев

Добавьте комментарии к выражениям, используя синтаксис с однолинейным и многолинейным комментарием.

![Синтаксис однострока- и многолинейный комментарий](media/data-flow/comments.png "Комментарии")

Следующие примеры являются действительными комментариями:

* ```/* This is my comment */```

* ```/* This is a```
*   ```multi-line comment */```
   
* ```// This is a single line comment```

Если вы кладете комментарий в верхней части выражения, он отображается в текстовом поле преобразования для документирования выражения преобразования.

![Комментарий в текстовом окне преобразования](media/data-flow/comments2.png "Комментарии")

## <a name="regular-expressions"></a>Регулярные выражения

Многие функции языка выражения используют обычный синтаксис выражения. При использовании регулярных функций выражения, Expression\\Builder пытается интерпретировать backslash ( ) как последовательность персонажа побега. При использовании backslashes в вашем регулярном выражении, либо приложить весь regex в backticks (\`) или использовать двойной backslash.

Пример, в использовании бэктиков:

```
regex_replace('100 and 200', `(\d+)`, 'digits')
```

Пример, в который используются двойные слэши:

```
regex_replace('100 and 200', '(\\d+)', 'digits')
```

## <a name="address-array-indexes"></a>Индексы адресных массивов

С функциями выражения, возвращающие массивы, используйте скобки (я) для решения конкретных индексов внутри объектов массива возврата. Массив основан на них.

![Массив «Строитель выражения»](media/data-flow/expb2.png "Предварительный просмотр данных выражения")

## <a name="keyboard-shortcuts"></a>Сочетания клавиш

* Ctrl-K Ctrl-C: Комментарий всей линии.
* Ctrl-K Ctrl-U: Некомментарий.
* F1: Предоставьте команды помощи редактору.
* Алт-Вниз стрелка ключ: Переместить вниз текущей линии.
* Ключ со стрелками Alt-Up: Перемещение вверх по текущей линии.
* Ctrl-Spacebar: Показать контекстную помощь.

## <a name="convert-to-dates-or-timestamps"></a>Преобразование в даты или метки времени

Чтобы включить строку буквальные в вашей временной метки выход, оберните преобразования в ```toString()```.

```toString(toTimestamp('12/31/2016T00:12:00', 'MM/dd/yyyy\'T\'HH:mm:ss'), 'MM/dd /yyyy\'T\'HH:mm:ss')```

Для преобразования миллисекунд от эпохи к `toTimestamp(<number of milliseconds>)`дате или метке времени используйте. Если время идет в секундах, умножьте на 1000.

```toTimestamp(1574127407*1000l)```

Задняя часть "l" в конце предыдущего выражения означает преобразование в длинный тип как inline syntax.

## <a name="next-steps"></a>Дальнейшие действия

[Начало создания выражений преобразования данных](data-flow-expression-functions.md)
