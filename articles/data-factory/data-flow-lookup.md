---
title: Преобразование «Уточняющий запрос» в потоке данных сопоставления
description: Ссылочные данные из другого источника с помощью преобразования «Уточняющий запрос» в потоке данных сопоставления.
author: kromerm
ms.reviewer: daperlov
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 03/23/2020
ms.openlocfilehash: 672fecc7487a73909efa5b4247f4889bb47b7b7e
ms.sourcegitcommit: 3abadafcff7f28a83a3462b7630ee3d1e3189a0e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2020
ms.locfileid: "82594327"
---
# <a name="lookup-transformation-in-mapping-data-flow"></a>Преобразование «Уточняющий запрос» в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Преобразование «Уточняющий запрос» используется для ссылки на данные из другого источника в потоке потока данных. Преобразование «Уточняющий запрос» добавляет столбцы из сопоставленных данных в исходные данные.

Преобразование «Уточняющий запрос» похоже на левое внешнее соединение. Все строки из основного потока будут существовать в выходном потоке с дополнительными столбцами из потока подстановки. 

## <a name="configuration"></a>Параметр Configuration

![Преобразование «Уточняющий запрос»](media/data-flow/lookup1.png "Поиск")

**Основной поток:** Входящий поток данных. Этот поток эквивалентен левой стороне объединения.

**Поток подстановки:** Данные, добавляемые к основному потоку. Добавляемые данные определяются условиями поиска. Этот поток эквивалентен правой части JOIN.

**Совпадение с несколькими строками:** Если параметр включен, строка с несколькими совпадениями в первичном потоке вернет несколько строк. В противном случае будет возвращена только одна строка, основанная на условии "Match on".

**Совпадение:** Отображается, только если не выбрано "сопоставлять несколько строк". Выберите, следует ли выполнять поиск по любой строке, первому совпадению или последнему совпадению. Рекомендуется использовать любую строку, так как она выполняет самую быструю процедуру. Если выбрана первая строка или последняя строка, потребуется указать условия сортировки.

**Условия поиска:** Выберите столбцы для сопоставления. Если условие равенства выполнено, строки будут считаться совпадениями. Наведите указатель мыши на пункт "вычисляемый столбец", чтобы извлечь значение с помощью [языка выражений потока данных](data-flow-expression-functions.md).

Преобразование «Уточняющий запрос» поддерживает только совпадения равенства. Чтобы настроить выражение уточняющего запроса для включения других операторов, таких как «больше», рекомендуется использовать [перекрестное соединение в преобразовании «соединение](data-flow-join.md#custom-cross-join)». Перекрестное соединение не позволит избежать возможных ошибок декартного продукта при выполнении.

В выходные данные включаются все столбцы из обоих потоков. Чтобы удалить дублирующиеся или ненужные столбцы, добавьте [Преобразование «выбор](data-flow-select.md) » после преобразования «Уточняющий запрос». Столбцы также могут быть удалены или переименованы в преобразовании приемника.

## <a name="analyzing-matched-rows"></a>Анализ сопоставленных строк

После преобразования «Уточняющий запрос» `isMatch()` функция может использоваться для проверки соответствия уточняющего запроса отдельным строкам.

![Шаблон подстановки](media/data-flow/lookup111.png "Шаблон подстановки")

Примером такого шаблона является использование преобразования «Условное разбиение» для разбиения `isMatch()` по функции. В приведенном выше примере соответствующие строки проходят через ```NoMatch``` поток в верхнем и несовпадающих строках.

## <a name="testing-lookup-conditions"></a>Проверка условий поиска

При тестировании преобразования «Уточняющий запрос» с предварительным просмотром данных в режиме отладки используйте небольшой набор известных данных. При выборке строк из большого набора данных нельзя предсказать, какие строки и ключи будут считываться для тестирования. Результат является недетерминированным, то есть условия объединения не могут возвращать совпадения.

## <a name="broadcast-optimization"></a>Оптимизация вещания

![Широковещательное соединение](media/data-flow/broadcast.png "Широковещательное соединение")

В случае преобразования «уточняющие запросы» и «EXISTS», если один или оба потока данных помещаются в память рабочего узла, можно оптимизировать производительность, включив **вещание**. По умолчанию механизм Spark автоматически решает, следует ли транслировать одну сторону. Чтобы вручную выбрать сторону для вещания, выберите **фиксированный**.

Не рекомендуется отключать трансляцию с помощью параметра **Off** , если только не истечет ошибка времени ожидания при выполнении соединений.

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<leftStream>, <rightStream>
    lookup(
        <lookupConditionExpression>,
        multiple: { true | false },
        pickup: { 'first' | 'last' | 'any' },  ## Only required if false is selected for multiple
        { desc | asc }( <sortColumn>, { true | false }), ## Only required if 'first' or 'last' is selected. true/false determines whether to put nulls first
        broadcast: { 'auto' | 'left' | 'right' | 'both' | 'off' }
    ) ~> <lookupTransformationName>
```
### <a name="example"></a>Пример

![Преобразование «Уточняющий запрос»](media/data-flow/lookup-dsl-example.png "Поиск")

Сценарий потока данных для приведенной выше конфигурации поиска находится в следующем фрагменте кода.

```
SQLProducts, DimProd lookup(ProductID == ProductKey,
    multiple: false,
    pickup: 'first',
    asc(ProductKey, true),
    broadcast: 'auto')~> LookupKeys
```
## 
Дальнейшие действия

* Преобразования [Join](data-flow-join.md) и [Exists](data-flow-exists.md) принимаются в нескольких входных потоках.
* Использование [преобразования «Условное разбиение](data-flow-conditional-split.md) » с ```isMatch()``` целью разбиения строк на совпадающие и несовпадающие значения
