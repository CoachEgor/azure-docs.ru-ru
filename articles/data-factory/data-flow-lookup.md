---
title: Сопоставление преобразования «Уточняющий запрос потока данных»
description: Преобразование "Поиск потока данных" фабрики данных Azure
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 02/26/2020
ms.openlocfilehash: 2216e1bf058eef486dbfefba24d52bdc6bdb232f
ms.sourcegitcommit: 1f738a94b16f61e5dad0b29c98a6d355f724a2c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2020
ms.locfileid: "78164684"
---
# <a name="azure-data-factory-mapping-data-flow-lookup-transformation"></a>Преобразование "Поиск потока данных" фабрики данных Azure

Используйте "Поиск" для добавления эталонных данных из другого источника в ваш Поток данных. Преобразование поиска требует определенный источник, который указывает на вашу ссылочную таблицу и совпадает с полями ключа.

![Преобразование "Уточняющий запрос"](media/data-flow/lookup1.png "Просмотр")

Выберите поля ключа, которые вы желаете соотнести с полями входящего потока, и поля с источника ссылки. Сначала необходимо создать новый источник на холсте разработки Потока данных, чтобы использовать в качестве средства для поиска.

Если совпадения найдены, итоговые строки и столбцы из источника ссылки будут добавляться к потоку данных. Вы можете выбрать интересующие вас поля, которые вы желаете включить в ваш приемник в конце потока данных. Кроме того, используйте преобразование SELECT, следующее за уточняющим запросом, чтобы очистить список полей, чтобы хранить только поля из обоих потоков, которые нужно хранить.

Преобразование «Уточняющий запрос» выполняет эквивалент левого внешнего объединения. Таким образом, вы увидите, что все строки из левого источника объединяются с совпадениями из правой части. Если в уточняющем запросе имеется несколько совпадающих значений или вы хотите настроить выражение уточняющего запроса, предпочтительнее переключиться на преобразование «соединение» и использовать перекрестное соединение. Это позволит избежать возможных ошибок декартного продукта при выполнении.

## <a name="match--no-match"></a>Совпадение без соответствия

После преобразования «Уточняющий запрос» можно использовать последующее преобразование для проверки результатов каждой строки соответствия с помощью функции выражения `isMatch()`, чтобы сделать выбор в логике в зависимости от того, привело ли поиск в соответствие к строке или нет.

![Шаблон подстановки](media/data-flow/lookup111.png "Шаблон подстановки")

После использования преобразования «Уточняющий запрос» можно добавить разбиение преобразования «Условное разбиение» на функцию ```isMatch()```. В приведенном выше примере совпадающие строки проходят через верхний и несовпадающие строки в потоке ```NoMatch```.

## <a name="first-or-last-value"></a>Первое или Последнее значение

Преобразование «Уточняющий запрос» реализуется как левое внешнее соединение. При наличии нескольких совпадений из уточняющего запроса может потребоваться уменьшить несколько совпадающих строк, выбрав первую совпадающую строку, Последнее совпадение или любую случайную строку.

### <a name="option-1"></a>Вариант 1

![Уточняющий запрос одной строки](media/data-flow/singlerowlookup.png "Уточняющий запрос одной строки")

* Совпадение с несколькими строками: оставьте поле пустым, чтобы вернуть одно совпадение строк
* Совпадение: выберите первый, последний или любое совпадение.
* Условия сортировки. Если выбрать первый или последний, ADF требует, чтобы данные были упорядочены, чтобы существовала логика, которая находится за первой и последней

> [!NOTE]
> Используйте только первый или последний параметр в селекторе одной строки, если необходимо контролировать, какое значение вернуть из уточняющего запроса. Использование "Any" или поиск по нескольким строкам выполняется быстрее.

### <a name="option-2"></a>Вариант 2

Это можно также сделать с помощью преобразования «Статистическая обработка» после уточняющего запроса. В этом случае преобразование «Статистическая обработка» с именем ```PickFirst``` используется для выбора первого значения из совпадений поиска.

![Статистическое выражение поиска](media/data-flow/lookup333.png "Статистическое выражение поиска")

![Сначала Уточняющий запрос](media/data-flow/lookup444.png "Сначала Уточняющий запрос")

## <a name="optimizations"></a>Оптимизация

В фабрике данных потоки данных выполняются в масштабных средах Spark. Если набор данных может уместиться в пространстве памяти рабочего узла, можно оптимизировать производительность поиска.

![Широковещательное соединение](media/data-flow/broadcast.png "Широковещательное соединение")

### <a name="broadcast-join"></a>Широковещательное соединение

Выберите левое и/или правое широковещательное соединение для запроса ADF, чтобы отправить весь набор данных с любой стороны связи поиска в память. Для наборов данных меньшего размера это может значительно повысить производительность поиска.

### <a name="data-partitioning"></a>Секционирование данных

Можно также указать секционирование данных, выбрав "задать секционирование" на вкладке "оптимизация" преобразования "Уточняющий запрос", чтобы создать наборы данных, которые лучше подходят для каждого рабочего процесса в памяти.

## <a name="next-steps"></a>Следующие шаги

* Преобразования [Join](data-flow-join.md) и [Exists](data-flow-exists.md) выполняют аналогичные задачи в потоках данных сопоставления ADF. Далее рассмотрим эти преобразования.
* Использование [условного разбиения](data-flow-conditional-split.md) с ```isMatch()``` для разделения строк по сопоставленным и несовпадающим значениям
