---
title: Сопоставление преобразования «Уточняющий запрос потока данных»
description: Преобразование "Поиск потока данных" фабрики данных Azure
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 10/03/2019
ms.openlocfilehash: 5cc54c95759ba1490f498305f05cc49a4411686d
ms.sourcegitcommit: a5ebf5026d9967c4c4f92432698cb1f8651c03bb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/08/2019
ms.locfileid: "74930317"
---
# <a name="azure-data-factory-mapping-data-flow-lookup-transformation"></a>Преобразование "Поиск потока данных" фабрики данных Azure

Используйте "Поиск" для добавления эталонных данных из другого источника в ваш Поток данных. Преобразование поиска требует определенный источник, который указывает на вашу ссылочную таблицу и совпадает с полями ключа.

![Lookup Transformation](media/data-flow/lookup1.png "Поиск")

Выберите поля ключа, которые вы желаете соотнести с полями входящего потока, и поля с источника ссылки. Сначала необходимо создать новый источник на холсте разработки Потока данных, чтобы использовать в качестве средства для поиска.

Если совпадения найдены, итоговые строки и столбцы из источника ссылки будут добавляться к потоку данных. Вы можете выбрать интересующие вас поля, которые вы желаете включить в ваш приемник в конце потока данных. Кроме того, используйте преобразование SELECT, следующее за уточняющим запросом, чтобы очистить список полей, чтобы хранить только поля из обоих потоков, которые нужно хранить.

Преобразование «Уточняющий запрос» выполняет эквивалент левого внешнего объединения. Таким образом, вы увидите, что все строки из левого источника объединяются с совпадениями из правой части. Если в уточняющем запросе имеется несколько совпадающих значений или вы хотите настроить выражение уточняющего запроса, предпочтительнее переключиться на преобразование «соединение» и использовать перекрестное соединение. Это позволит избежать возможных ошибок декартного продукта при выполнении.

## <a name="match--no-match"></a>Совпадение без соответствия

После преобразования «Уточняющий запрос» можно использовать последующее преобразование для проверки результатов каждой строки соответствия с помощью функции выражения `isMatch()`, чтобы сделать выбор в логике в зависимости от того, привело ли поиск в соответствие к строке или нет.

![Шаблон подстановки](media/data-flow/lookup111.png "Шаблон подстановки")

После использования преобразования «Уточняющий запрос» можно добавить разбиение преобразования «Условное разбиение» на функцию ```isMatch()```. В приведенном выше примере совпадающие строки проходят через верхний и несовпадающие строки в потоке ```NoMatch```.

## <a name="first-or-last-value"></a>Первое или Последнее значение

При наличии нескольких совпадений из уточняющего запроса может потребоваться уменьшить несколько совпадающих строк, выбрав первое или Последнее соответствие. Это можно сделать с помощью преобразования «Статистическая обработка» после уточняющего запроса.

В этом случае преобразование «Статистическая обработка» с именем ```PickFirst``` используется для выбора первого значения из совпадений поиска.

![Статистическое выражение поиска](media/data-flow/lookup333.png "Статистическое выражение поиска")

![Сначала Уточняющий запрос](media/data-flow/lookup444.png "Сначала Уточняющий запрос")

## <a name="optimizations"></a>Оптимизация

В фабрике данных потоки данных выполняются в масштабных средах Spark. Если набор данных может уместиться в пространстве памяти рабочего узла, можно оптимизировать производительность поиска.

![Широковещательное соединение](media/data-flow/broadcast.png "Широковещательное соединение")

### <a name="broadcast-join"></a>Широковещательное соединение

Выберите левое и/или правое широковещательное соединение для запроса ADF, чтобы отправить весь набор данных с любой стороны связи поиска в память. Для наборов данных меньшего размера это может значительно повысить производительность поиска.

### <a name="data-partitioning"></a>Секционирование данных

Можно также указать секционирование данных, выбрав "задать секционирование" на вкладке "оптимизация" преобразования "Уточняющий запрос", чтобы создать наборы данных, которые лучше подходят для каждого рабочего процесса в памяти.

## <a name="next-steps"></a>Дальнейшие действия

* Преобразования [Join](data-flow-join.md) и [Exists](data-flow-exists.md) выполняют аналогичные задачи в потоках данных сопоставления ADF. Далее рассмотрим эти преобразования.
* Использование [условного разбиения](data-flow-conditional-split.md) с ```isMatch()``` для разделения строк по сопоставленным и несовпадающим значениям
