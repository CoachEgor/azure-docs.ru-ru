---
title: Преобразование поиска в картографии потока данных
description: Справочные данные из другого источника, использующие преобразование поиска в потоке данных отображения.
author: kromerm
ms.reviewer: daperlov
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 03/23/2020
ms.openlocfilehash: 78c6c1363af011a90865770d88c0037e50e958c1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80240417"
---
# <a name="lookup-transformation-in-mapping-data-flow"></a>Преобразование поиска в картографии потока данных

Используйте преобразование поиска для ссылки данных из другого источника в потоке потока данных. Преобразование поиска прикрепляет столбцы от совпадающих данных к исходным данным.

Преобразование поиска похоже на левое внешнее соединение. Все строки из основного потока будут существовать в потоке вывода с дополнительными столбцов из потока поиска. 

## <a name="configuration"></a>Параметр Configuration

![Преобразование «Уточняющий запрос»](media/data-flow/lookup1.png "Поиск")

**Первичный поток:** Входящий поток данных. Этот поток эквивалентен левой стороне соединения.

**Поиск потока:** Данные, применяемые к основному потоку. Какие данные добавляются, определяется условиями поиска. Этот поток эквивалентен правой стороне соединения.

**Совпадают с несколькими рядами:** Если включено, строка с несколькими совпадениями в основном потоке вернет несколько строк. В противном случае, только одна строка будет возвращена на основе состояния "Матч на".

**Матч на:** Видимый только при включении "Совпадений нескольких строк". Выберите, следует ли совпадать на любой строке, первом матче или последнем матче. Любая строка рекомендуется, так как она выполняется быстрее всего. При выборе первой строки или последней строки необходимо указать условия сортировки.

**Условия поиска:** Выберите, какие столбцы должны соответствовать. Если условие равенства выполнено, то строки будут считаться совпадением. Нависаете и выберите «Вычислинный столбец», чтобы извлечь значение с помощью [языка выражения потока данных.](data-flow-expression-functions.md)

Преобразование поиска поддерживает только равные совпадения. Чтобы настроить выражение поиска, чтобы включить другие операторы, такие как больше, чем, рекомендуется использовать [кросс-соединение в преобразовании соединения.](data-flow-join.md#custom-cross-join) Перекрестное соединение позволит избежать любых возможных ошибок декартового продукта при исполнении.

Все столбцы из обоих потоков включены в данные вывода. Чтобы упасть дубликаты или нежелательные столбцы, добавьте [выбранное преобразование](data-flow-select.md) после преобразования поиска. Столбцы также могут быть удалены или переименованы в преобразовании раковины.

## <a name="analyzing-matched-rows"></a>Анализ соответствующих строк

После преобразования поиска функция `isMatch()` может быть использована для проверки, соответствует ли поиск для отдельных строк.

![Шаблон поиска](media/data-flow/lookup111.png "Шаблон поиска")

Примером этого шаблона является использование условного `isMatch()` преобразования разделения для разделения на функцию. В приведенном выше примере соответствующие строки проходят через верхний поток, и несоответствующие строки проходят через ```NoMatch``` поток.

## <a name="testing-lookup-conditions"></a>Условия поиска тестирования

При тестировании преобразования поиска с помощью предварительного просмотра данных в режиме отладки используйте небольшой набор известных данных. При выборке строк из большого набора данных нельзя предсказать, какие строки и клавиши будут считываться для тестирования. Результат не детерминирован, что означает, что условия соединения не могут вернуть совпадения.

## <a name="broadcast-optimization"></a>Оптимизация вещания

В azure Data Factory картографирование потоков данных выполняется в средах масштабирования Spark. Если набор данных может поместиться в пространство памяти узла рабочего узла, производительность поиска может быть оптимизирована путем включения вещания.

![Трансляция Присоединиться](media/data-flow/broadcast.png "Трансляция Присоединиться")

Включение вещания толкает весь набор данных в память. Для небольших наборов данных, содержащих всего несколько тысяч строк, вещание может значительно улучшить производительность поиска. Для больших наборов данных эта опция может привести к исключению из памяти.

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<leftStream>, <rightStream>
    lookup(
        <lookupConditionExpression>,
        multiple: { true | false },
        pickup: { 'first' | 'last' | 'any' },  ## Only required if false is selected for multiple
        { desc | asc }( <sortColumn>, { true | false }), ## Only required if 'first' or 'last' is selected. true/false determines whether to put nulls first
        broadcast: { 'none' | 'left' | 'right' | 'both' }
    ) ~> <lookupTransformationName>
```
### <a name="example"></a>Пример

![Преобразование «Уточняющий запрос»](media/data-flow/lookup-dsl-example.png "Поиск")

Скрипт потока данных для вышеуказанной конфигурации поиска находится в фрагменте кода ниже.

```
SQLProducts, DimProd lookup(ProductID == ProductKey,
    multiple: false,
    pickup: 'first',
    asc(ProductKey, true),
    broadcast: 'none')~> LookupKeys
```
## 
Дальнейшие действия

* [Соединение](data-flow-join.md) и [существующие](data-flow-exists.md) преобразования принимают в нескольких входных данных потока
* Используйте [условное преобразование сплит-диапазона](data-flow-conditional-split.md) ```isMatch()``` на соответствующих и несоответствующих значениях
