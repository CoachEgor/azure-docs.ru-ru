---
title: Изменение преобразования строк в потоке данных сопоставления
description: Обновление целевого объекта базы данных с помощью преобразования "изменение строки" в потоке данных сопоставления
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 04/20/2020
ms.openlocfilehash: 6b353967c9b9c7517f1a42581717c6394c0e6374
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81729141"
---
# <a name="alter-row-transformation-in-mapping-data-flow"></a>Изменение преобразования строк в потоке данных сопоставления

[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

Используйте преобразование «изменение строки», чтобы задать политики вставки, удаления, обновления и Upsert для строк. В качестве выражений можно добавить условия "один ко многим". Эти условия следует указывать в порядке приоритета, так как каждая строка будет помечена политикой, соответствующей выражению первого сопоставления. Каждое из этих условий может привести к вставке, обновлению, удалению или восстановлена строк (или строк). Инструкция ALTER Row может формировать в базе данных как инструкции DDL & DML.

![Изменение параметров строк](media/data-flow/alter-row1.png "Изменение параметров строк")

Преобразования «изменение строк» будут действовать только для приемников базы данных или CosmosDB в потоке данных. Действия, назначаемые строкам (вставки, обновления, удаления, Upsert), не будут выполняться во время сеансов отладки. Выполните в конвейере действие "выполнение потока данных", чтобы применить политики ALTER Row к таблицам базы данных.

## <a name="specify-a-default-row-policy"></a>Укажите политику строк по умолчанию

Создайте преобразование «изменение строки» и укажите политику строк с условием `true()`. Каждая строка, не соответствующая ни одному из ранее определенных выражений, будет помечена для указанной политики строк. По умолчанию каждая строка, не соответствующая условному выражению, будет `Insert`помечена для.

![Изменение политики строк](media/data-flow/alter-row4.png "Изменение политики строк")

> [!NOTE]
> Чтобы пометить все строки одной политикой, можно создать условие для этой политики и указать условие в виде `true()`.

## <a name="view-policies-in-data-preview"></a>Просмотр политик в предварительной версии данных

Используйте [режим отладки](concepts-data-flow-debug-mode.md) для просмотра результатов политик изменения строк на панели предварительного просмотра данных. Предварительный просмотр преобразования «изменение строки» не приводит к созданию действий DDL или DML для целевого объекта.

![Изменение политик строк](media/data-flow/alter-row3.png "Изменение политик строк")

Каждая политика изменения строк представляется значком, указывающим, будет ли выполняться операция вставки, обновления, Upsert или удаления. В верхнем колонтитуле показано количество строк, затронутых каждой политикой в предварительной версии.

## <a name="allow-alter-row-policies-in-sink"></a>Разрешить политики ALTER Row в приемнике

Чтобы политики ALTER Row работали, поток данных должен выполнить запись в базу данных или приемник Cosmos. На вкладке **Параметры** в приемнике включите, какие политики ALTER Row разрешены для этого приемника.

![Изменение приемника строк](media/data-flow/alter-row2.png "Изменение приемника строк")

Поведение по умолчанию — разрешить вставки только. Чтобы разрешить обновления, операции Upsert или удаления, установите флажок в приемнике, соответствующем условию. Если операции Updates, операции Upsert и DELETE включены, необходимо указать, для каких ключевых столбцов в приемнике должны совпадать.

> [!NOTE]
> Если при вставке, обновлении или операции Upsert изменить схему целевой таблицы в приемнике, поток данных завершится ошибкой. Чтобы изменить целевую схему в базе данных, выберите **Повторное создание таблицы** в качестве действия таблицы. Это приведет к удалению и повторному созданию таблицы с новым определением схемы.

Преобразование приемника требует либо одного ключа, либо ряда ключей для уникальной идентификации строк в целевой базе данных. Для приемников SQL задайте ключи на вкладке параметры приемника. Для CosmosDB задайте ключ секции в параметрах, а также задайте Системное поле CosmosDB "ID" в сопоставлении приемника. Для CosmosDB обязательно включать системный столбец "ID" для обновлений, операции Upsert и удалений.

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream>
    alterRow(
           insertIf(<condition>?),
           updateIf(<condition>?),
           deleteIf(<condition>?),
           upsertIf(<condition>?),
        ) ~> <alterRowTransformationName>
```

### <a name="example"></a>Пример

Ниже приведен пример преобразования «изменение строки» с `CleanData` именем, которое принимает входящий `SpecifyUpsertConditions` поток и создает три условия изменения строки. В предыдущем преобразовании столбец с именем `alterRowCondition` вычисляется, который определяет, вставляется ли строка, обновляется или удаляется в базе данных. Если значение столбца имеет строковое значение, соответствующее правилу ALTER Row, ему назначается эта политика.

В интерфейсе фабрики данных это преобразование выглядит как на изображении ниже:

![Пример изменения строки](media/data-flow/alter-row4.png "Пример изменения строки")

Сценарий потока данных для этого преобразования находится в следующем фрагменте кода:

```
SpecifyUpsertConditions alterRow(insertIf(alterRowCondition == 'insert'),
    updateIf(alterRowCondition == 'update'),
    deleteIf(alterRowCondition == 'delete')) ~> AlterRow
```

## <a name="next-steps"></a>Дальнейшие шаги

После преобразования «изменение строки» может потребоваться прием [данных в целевое хранилище данных](data-flow-sink.md).
