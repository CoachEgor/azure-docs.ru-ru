---
title: Действие копирования в фабрике данных Azure
description: Сведения о действии копирования в фабрике данных Azure. Его можно использовать для копирования данных из поддерживаемого исходного хранилища данных в поддерживаемое хранилище данных, используемое в качестве приемника.
services: data-factory
documentationcenter: ''
author: linda33wj
manager: craigg
ms.reviewer: douglasl
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 11/13/2019
ms.author: jingwang
ms.openlocfilehash: fa2876b88a520480813ebfb8af8219d53c32057a
ms.sourcegitcommit: a107430549622028fcd7730db84f61b0064bf52f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/14/2019
ms.locfileid: "74075566"
---
# <a name="copy-activity-in-azure-data-factory"></a>Действие копирования в фабрике данных Azure

> [!div class="op_single_selector" title1="Выберите версию фабрики данных, которую вы используете:"]
> * [Версия 1](v1/data-factory-data-movement-activities.md)
> * [Текущая версия](copy-activity-overview.md)

В фабрике данных Azure действие копирования можно использовать для копирования данных между хранилищами данных, расположенными локально и в облаке. После копирования данных можно использовать другие действия для дальнейшего преобразования и анализа. Вы также можете использовать действие копирования для публикации результатов преобразования и анализа для бизнес-аналитики (BI) и использования приложений.

![Роль действия копирования](media/copy-activity-overview/copy-activity.png)

Действие копирования выполняется в [среде выполнения интеграции](concepts-integration-runtime.md). Для различных сценариев копирования данных можно использовать разные типы среды выполнения интеграции.

* При копировании данных между двумя хранилищами данных, доступ к которым осуществляется через Интернет, с любого IP-адреса, для действия копирования можно использовать среду выполнения интеграции Azure. Эта среда выполнения интеграции является безопасной, надежной, масштабируемой и [глобально доступной](concepts-integration-runtime.md#integration-runtime-location).
* При копировании данных в хранилища данных и из них, расположенных локально или в сети с контролем доступа (например, с виртуальной сетью Azure), необходимо настроить локальную среду выполнения интеграции.

Среду выполнения интеграции необходимо связать с каждым хранилищем данных источника и приемника. Сведения о том, как действие копирования определяет, какую среду выполнения интеграции использовать, см. [в разделе Определение используемого IR](concepts-integration-runtime.md#determining-which-ir-to-use).

Чтобы скопировать данные из источника в приемник, служба, выполняющая действие копирования, выполняет следующие действия.

1. Считывает данные из источника данных.
2. Выполняет сериализацию и десериализацию, сжатие и распаковку, сопоставление столбцов и т. д. Она выполняет эти операции на основе конфигурации входного набора данных, выходного набора данных и действия копирования.
3. Записывает данные в приемник или целевое хранилище данных.

![Общие сведения о действии копирования](media/copy-activity-overview/copy-activity-overview.png)

## <a name="supported-data-stores-and-formats"></a>Поддерживаемые хранилища данных и форматы

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

### <a name="supported-file-formats"></a>Поддерживаемые форматы файлов

Действие копирования можно использовать для копирования файлов, которые находятся между двумя хранилищами данных на основе файлов. В этом случае данные копируются эффективно без сериализации или десериализации.

[!INCLUDE [data-factory-v2-file-formats](../../includes/data-factory-v2-file-formats.md)] 

Например, можно выполнять следующие действия копирования:

* Копирование данных из локальной базы данных SQL Server и запись данных в Azure Data Lake Storage 2-го поколения в формате Parquet.
* Копирование файлов в текстовом формате (CSV) из локальной файловой системы и запись в хранилище BLOB-объектов Azure в формате Avro.
* Скопируйте ZIP-файлы из локальной файловой системы, распакуйте их и запишите в Azure Data Lake Storage 2-го поколения.
* Копирование данных в формате сжатого текста gzip (CSV) из хранилища BLOB-объектов Azure и их запись в базу данных SQL Azure.
* Многие другие действия, требующие сериализации, десериализации или сжатия и распаковки.

## <a name="supported-regions"></a>Поддерживаемые регионы

Служба, которая включает действие копирования, доступна глобально в регионах и географических областях, перечисленных в [расположениях среды выполнения интеграции Azure](concepts-integration-runtime.md#integration-runtime-location). Глобально доступная топология обеспечивает эффективное перемещение данных, обычно позволяя избежать "прыжков" по разным регионам. Ознакомьтесь с [продуктами по регионам](https://azure.microsoft.com/regions/#services) , чтобы проверить доступность фабрики данных и перемещения данных в определенном регионе.

## <a name="configuration"></a>Параметр Configuration

Чтобы использовать действие копирования в фабрике данных Azure, необходимо выполнить следующие действия:

1. **Создайте связанные службы для исходного хранилища данных и приемника хранилища данных.** Сведения о конфигурации и поддерживаемые свойства см. в разделе "Свойства связанной службы" статьи соединителя. Список поддерживаемых соединителей можно найти в разделе [Поддерживаемые хранилища данных и форматы](#supported-data-stores-and-formats) этой статьи.
2. **Создание наборов данных для источника и приемника.** Сведения о конфигурации и поддерживаемых свойствах см. в разделах "Свойства набора данных" статьи о соединителях источника и приемника.
3. **Создайте конвейер с действием копирования.** В следующем разделе приведен пример.

### <a name="syntax"></a>Синтаксис

Следующий шаблон действия копирования содержит полный список поддерживаемых свойств. Выберите свойства для своего сценария.

```json
"activities":[
    {
        "name": "CopyActivityTemplate",
        "type": "Copy",
        "inputs": [
            {
                "referenceName": "<source dataset name>",
                "type": "DatasetReference"
            }
        ],
        "outputs": [
            {
                "referenceName": "<sink dataset name>",
                "type": "DatasetReference"
            }
        ],
        "typeProperties": {
            "source": {
                "type": "<source type>",
                <properties>
            },
            "sink": {
                "type": "<sink type>"
                <properties>
            },
            "translator":
            {
                "type": "TabularTranslator",
                "columnMappings": "<column mapping>"
            },
            "dataIntegrationUnits": <number>,
            "parallelCopies": <number>,
            "enableStaging": true/false,
            "stagingSettings": {
                <properties>
            },
            "enableSkipIncompatibleRow": true/false,
            "redirectIncompatibleRowSettings": {
                <properties>
            }
        }
    }
]
```

#### <a name="syntax-details"></a>Сведения о синтаксисе

| Свойство | ОПИСАНИЕ | Обязательный? |
|:--- |:--- |:--- |
| type | Для действия копирования задайте значение `Copy` | Yes |
| inputs | Укажите созданный набор данных, указывающий на исходные данные. Действие копирования поддерживает только один вход. | Yes |
| outputs | Укажите созданный набор данных, указывающий на данные приемника. Действие копирования поддерживает только один выход. | Yes |
| typeProperties | Укажите свойства для настройки действия копирования. | Yes |
| source | Укажите тип источника копирования и соответствующие свойства для получения данных.<br/><br/>Дополнительные сведения см. в разделе "свойства действия копирования" статьи о соединителе, приведенном в статье [Поддерживаемые хранилища данных и форматы](#supported-data-stores-and-formats). | Yes |
| sink | Укажите тип приемника копирования и соответствующие свойства для записи данных.<br/><br/>Дополнительные сведения см. в разделе "свойства действия копирования" статьи о соединителе, приведенном в статье [Поддерживаемые хранилища данных и форматы](#supported-data-stores-and-formats). | Yes |
| translator | Укажите явные сопоставления столбцов от источника к приемнику. Это свойство применяется, если поведение копирования по умолчанию не соответствует вашим потребностям.<br/><br/>Дополнительные сведения см. [в разделе сопоставление схем в действии копирования](copy-activity-schema-and-type-mapping.md). | Нет |
| dataIntegrationUnits | Укажите меру, представляющую объем энергии, которую [Среда выполнения интеграции Azure](concepts-integration-runtime.md) использует для копирования данных. Эти единицы ранее назывались облачными единицами перемещения данных (эта мера). <br/><br/>Дополнительные сведения см. в разделе [единицы интеграции данных](copy-activity-performance.md#data-integration-units). | Нет |
| parallelCopies | Укажите параллелизм, который будет использоваться действием копирования при считывании данных из источника и записи данных в приемник.<br/><br/>Дополнительные сведения см. в разделе [Параллельное копирование](copy-activity-performance.md#parallel-copy). | Нет |
| enableStaging<br/>stagingSettings | Укажите, следует ли разместить промежуточные данные в хранилище BLOB-объектов вместо прямого копирования данных из источника в приемник.<br/><br/>Сведения о полезных сценариях и сведениях о конфигурации см. в разделе [промежуточное копирование](copy-activity-performance.md#staged-copy). | Нет |
| enableSkipIncompatibleRow<br/>redirectIncompatibleRowSettings| Выберите способ управления несовместимыми строками при копировании данных из источника в приемник.<br/><br/>Дополнительные сведения см. в разделе [отказоустойчивость](copy-activity-fault-tolerance.md). | Нет |

## <a name="monitoring"></a>Мониторинг

Вы можете отслеживать выполнение действия копирования в пользовательском интерфейсе **& монитора** фабрики данных Azure или программно.

### <a name="monitor-visually"></a>Визуальный мониторинг

Чтобы визуально отслеживать выполнение действия копирования, перейдите в фабрику данных и перейдите в раздел **создание & монитора**. На вкладке **монитор** отображается список запусков конвейера с кнопкой **Просмотр выполнения действия** в столбце **действия** .

![Мониторинг выполнений конвейера](./media/load-data-into-azure-data-lake-store/monitor-pipeline-runs.png)

Выберите **Просмотр запусков действий** , чтобы просмотреть список действий в конвейере. В столбце **действия** отображаются ссылки на входные данные действия копирования, выходные данные, ошибки (если не удается выполнить действие копирования) и сведения.

![Мониторинг выполнений действий](./media/load-data-into-azure-data-lake-store/monitor-activity-runs.png)

Нажмите кнопку **сведения** в столбце **действия** , чтобы просмотреть сведения о выполнении действия копирования и характеристики производительности. Вы видите такие сведения, как объем/число строк или количество файлов данных, скопированных из источника в приемник, пропускная способность, действия, выполняемые действием копирования, с учетом соответствующих длительностей и конфигурации, используемые для сценария копирования.

>[!TIP]
>В некоторых сценариях вы также увидите **Советы по настройке производительности** в верхней части страницы "мониторинг копирования". Эти советы сообщают об обнаруженных узких местах и содержат сведения о том, что нужно изменить для повышения пропускной способности копирования. Пример см. в разделе [производительность и настройка](#performance-and-tuning) этой статьи.

**Пример. копирование из Amazon S3 в Azure Data Lake Store**
сведения о запуске действия монитора ![](./media/copy-activity-overview/monitor-activity-run-details-adls.png)

**Пример. копирование из базы данных SQL Azure в хранилище данных SQL Azure с промежуточной копией**
![мониторинг сведений о выполнении действий](./media/copy-activity-overview/monitor-activity-run-details-sql-dw.png)

### <a name="monitor-programmatically"></a>Мониторинг при помощи программных средств

Сведения о выполнении действия копирования и характеристики производительности также возвращаются в разделе **результат выполнения действия копирования** > **выходные данные** . Ниже приведен полный список свойств, которые могут быть возвращены. Вы увидите только те свойства, которые применимы к сценарию копирования. Сведения о мониторинге выполнения действий см. в разделе [мониторинг запуска конвейера](quickstart-create-data-factory-dot-net.md#monitor-a-pipeline-run).

| Имя свойства  | ОПИСАНИЕ | Единица измерения |
|:--- |:--- |:--- |
| dataRead | Объем данных, считанных из источника. | Значение Int64 в байтах |
| dataWritten | Объем данных, записываемых в приемник. | Значение Int64 в байтах |
| filesRead | Количество файлов, скопированных во время копирования из хранилища файлов. | Значение Int64 (не единица измерения) |
| filesWritten | Количество файлов, скопированных во время копирования в хранилище файлов. | Значение Int64 (не единица измерения) |
| саурцепеакконнектионс | Пиковое число одновременных подключений, установленных для исходного хранилища данных во время выполнения действия копирования. | Значение Int64 (не единица измерения) |
| синкпеакконнектионс | Пиковое число одновременных подключений, установленных в хранилище данных приемника во время выполнения действия копирования. | Значение Int64 (не единица измерения) |
| ровсреад | Число строк, считанных из источника (неприменимо для двоичного копирования). | Значение Int64 (не единица измерения) |
| rowsCopied | Число строк, скопированных в приемник (неприменимо для двоичного копирования). | Значение Int64 (не единица измерения) |
| rowsSkipped | Количество пропущенных несовместимых строк. Можно включить пропуск несовместимых строк, задав для `enableSkipIncompatibleRow` значение true. | Значение Int64 (не единица измерения) |
| copyDuration | Длительность выполнения копирования. | Значение Int32 в секундах |
| throughput | Интенсивность передачи данных. | Число с плавающей запятой, в кбит/с |
| саурцепеакконнектионс | Пиковое число одновременных подключений, установленных для исходного хранилища данных во время выполнения действия копирования. | Значение Int32 (без единицы измерения) |
| синкпеакконнектионс| Пиковое число одновременных подключений, установленных в хранилище данных приемника во время выполнения действия копирования.| Значение Int32 (без единицы измерения) |
| sqlDwPolyBase | Используется ли Polybase при копировании данных в хранилище данных SQL. | Логическое значение. |
| redshiftUnload | Используется ли выгрузка при копировании данных из RedShift. | Логическое значение. |
| hdfsDistcp | Используется ли DistCp при копировании данных из HDFS. | Логическое значение. |
| effectiveIntegrationRuntime | Среда выполнения интеграции (IR) или среда выполнения, используемая для выполнения действия, в формате `<IR name> (<region if it's Azure IR>)`. | Текст (string) |
| usedDataIntegrationUnits | Единицы интеграции актуальных данных во время копирования. | Значение Int32 |
| usedParallelCopies | Использованное количество параллельных процессов копирования. | Значение Int32 |
| redirectRowPath | Путь к журналу пропущенных несовместимых строк в хранилище BLOB-объектов, настраиваемом в свойстве `redirectIncompatibleRowSettings`. См. раздел [отказоустойчивость](#fault-tolerance) далее в этой статье. | Текст (string) |
| executionDetails | Дополнительные сведения о стадиях, с которыми проходит действие копирования, и соответствующих шагах, длительностей, конфигурациях и т. д. Мы не рекомендуем анализировать этот раздел, так как он может измениться.<br/><br/>Фабрика данных также содержит подробные сведения о длительности (в секундах), потраченные на различные этапы в рамках `detailedDurations`. Продолжительность этих шагов исключается. Отображаются только длительности, относящиеся к заданному действию копирования:<br/>**Длительность очереди** (`queuingDuration`): период времени, по истечении которого действие копирования запускается в среде выполнения интеграции. Если используется локальная среда IR, а это значение велико, проверьте мощность и использование IR и увеличьте масштаб в соответствии с рабочей нагрузкой. <br/>**Длительность скрипта перед копированием** (`preCopyScriptDuration`): время, прошедшее с момента запуска действия копирования на IR и когда действие копирования завершает выполнение скрипта, предшествующего копированию, в хранилище данных-приемнике. Применяется при настройке скрипта перед копированием. <br/>**Время до получения первого байта** (`timeToFirstByte`): время, прошедшее с конца предыдущего шага и время, когда IR получает первый байт из исходного хранилища данных. Применяется к источникам, не являющимся файлами. Если это значение велико, проверьте и оптимизируйте запрос или сервер.<br/>**Длительность передачи** (`transferDuration`): время, прошедшее с конца предыдущего шага и время, когда IR передает все данные из источника в приемник. | Массив. |
| перфрекоммендатион | Скопируйте советы по настройке производительности. Дополнительные сведения см. в разделе [производительность и настройка](#performance-and-tuning) . | Массив. |

```json
"output": {
    "dataRead": 6198358,
    "dataWritten": 19169324,
    "filesRead": 1,
    "sourcePeakConnections": 1,
    "sinkPeakConnections": 2,
    "rowsRead": 39614,
    "rowsCopied": 39614,
    "copyDuration": 1325,
    "throughput": 4.568,
    "errors": [],
    "effectiveIntegrationRuntime": "DefaultIntegrationRuntime (West US)",
    "usedDataIntegrationUnits": 4,
    "usedParallelCopies": 1,
    "executionDetails": [
        {
            "source": {
                "type": "AzureBlobStorage"
            },
            "sink": {
                "type": "AzureSqlDatabase"
            },
            "status": "Succeeded",
            "start": "2019-08-06T01:01:36.7778286Z",
            "duration": 1325,
            "usedDataIntegrationUnits": 4,
            "usedParallelCopies": 1,
            "detailedDurations": {
                "queuingDuration": 2,
                "preCopyScriptDuration": 12,
                "transferDuration": 1311
            }
        }
    ],
    "perfRecommendation": [
        {
            "Tip": "Sink Azure SQL Database: The DTU utilization was high during the copy activity run. To achieve better performance, you are suggested to scale the database to a higher tier than the current 1600 DTUs.",
            "ReferUrl": "https://go.microsoft.com/fwlink/?linkid=2043368",
            "RuleName": "AzureDBTierUpgradePerfRecommendRule"
        }
    ]
}
```

## <a name="schema-and-data-type-mapping"></a>Сопоставление типов данных и схемы

Сведения о том, как действие копирования сопоставляет исходные данные с приемником, см. в разделе [схема и сопоставление типов данных](copy-activity-schema-and-type-mapping.md) .

## <a name="fault-tolerance"></a>Отказоустойчивость

По умолчанию действие копирования прекращает копирование данных и возвращает ошибку, если строки исходных данных несовместимы со строками данных приемника. Чтобы выполнить копирование, можно настроить действие копирования, чтобы пропустить и записать несовместимые строки и скопировать только совместимые данные. Дополнительные сведения см. в разделе [отказоустойчивость действий копирования](copy-activity-fault-tolerance.md) .

## <a name="performance-and-tuning"></a>Производительность и настройка

В разделе " [производительность и масштабируемость действия копирования](copy-activity-performance.md) " описываются ключевые факторы, влияющие на производительность перемещения данных с помощью действия копирования в фабрике данных Azure. В нем также перечислены значения производительности, наблюдаемые во время тестирования, и объясняется, как оптимизировать производительность действия копирования.

В некоторых сценариях при выполнении действия копирования в фабрике данных вы увидите **Советы по настройке производительности** в верхней части [страницы мониторинг действий копирования](#monitor-visually), как показано в следующем примере. Советы указывают на узкое место, идентифицированное для данного запуска копирования. Они также содержат сведения о том, что нужно изменить, чтобы повысить пропускную способность копирования. Советы по настройке производительности в настоящее время предоставляют рекомендации, такие как использование Polybase при копировании данных в хранилище данных SQL Azure, увеличение Azure Cosmos DB RUs или DTU базы данных SQL Azure, когда ресурс на стороне хранилища данных является узким местом и удаляет ненужные промежуточные копии.

**Пример. копирование в базу данных SQL Azure с помощью Совета по настройке производительности**

В этом примере во время выполнения копирования фабрика данных отслеживает высокий уровень использования DTU в базе данных приемника SQL Azure. Это условие замедляет операции записи. Предложение заключается в увеличении числа DTU на уровне базы данных SQL Azure:

![Мониторинг копирования с помощью советов по настройке производительности](./media/copy-activity-overview/copy-monitoring-with-performance-tuning-tips.png)

## <a name="incremental-copy"></a>Добавочное копирование
Фабрика данных позволяет постепенно копировать разностные данные из исходного хранилища данных в хранилище приемников. Дополнительные сведения см. в разделе [учебник. добавочное копирование данных](tutorial-incremental-copy-overview.md).

## <a name="next-steps"></a>Дополнительная информация
Ознакомьтесь со следующими руководствами и примерами:

- [Копирование данных из одного расположения в другое в одной учетной записи хранилища BLOB-объектов Azure](quickstart-create-data-factory-dot-net.md)
- [Копирование данных из хранилища BLOB-объектов Azure в базу данных SQL Azure](tutorial-copy-data-dot-net.md)
- [Копирование данных из локальной базы данных SQL Server в Azure](tutorial-hybrid-copy-powershell.md)
