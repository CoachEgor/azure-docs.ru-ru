---
title: Суррогатная трансформация ключей в картировании потока данных
description: Как использовать картографическое преобразование потока данных Azure Data Factory для создания последовательных ключевых значений
author: kromerm
ms.author: makromer
ms.reviewer: daperlov
ms.service: data-factory
ms.topic: conceptual
ms.custom: seo-lt-2019
ms.date: 04/08/2020
ms.openlocfilehash: e5ac25c002da121be3adadf0eed978dd60ba26d9
ms.sourcegitcommit: ae3d707f1fe68ba5d7d206be1ca82958f12751e8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2020
ms.locfileid: "81010667"
---
# <a name="surrogate-key-transformation-in-mapping-data-flow"></a>Суррогатная трансформация ключей в картировании потока данных 

Используйте преобразование суррогатного ключа, чтобы добавить приравливную ключевую ценность к каждому ряду данных. Это полезно при проектировании таблиц измерений в модели аналитических данных звездной схемы. В звездной схеме каждому участнику таблицы измерений требуется уникальный ключ, который является ключом, не относясь к бизнесу.

## <a name="configuration"></a>Конфигурация

![Суррогатный ключ Преобразование](media/data-flow/surrogate.png "Суррогатная ключевая трансформация")

**Ключевая колонка:** Название генерируемого столбца ключа суррогатного ключа.

**Начальное значение:** Самое низкое ключевое значение, которое будет сгенерировано.

## <a name="increment-keys-from-existing-sources"></a>Ключи приращения из существующих источников

Чтобы начать последовательность из значения, которое существует в источнике, используйте производное преобразование столбца после преобразования суррогатного ключа, чтобы объединить два значения:

![SK добавить Макс](media/data-flow/sk006.png "Суррогатная ключевая трансформация Добавить Макс")

### <a name="increment-from-existing-maximum-value"></a>Приращение от существующего максимального значения

Чтобы засеять ключевое значение с предыдущим макс, Есть два метода, которые можно использовать на основе того, где ваши исходные данные.

#### <a name="database-sources"></a>Источники баз данных

Для выбора MAX() из источника используйте опцию запроса S'L. Например`Select MAX(<surrogateKeyName>) as maxval from <sourceTable>`/

![Суррогатный ключевой запрос](media/data-flow/sk002.png "Суррогатный ключ Трансформация Запрос")

#### <a name="file-sources"></a>Источники файлов

Если предыдущее максимальное значение находится `max()` в файле, используйте функцию в агрегированной трансформации, чтобы получить предыдущее максимальное значение:

![Файл суррогатного ключа](media/data-flow/sk008.png "Файл суррогатного ключа")

В обоих случаях необходимо соединить входящие новые данные вместе с исходным источником, содержащим предыдущее максимальное значение.

![Суррогатный ключ Присоединиться](media/data-flow/sk004.png "Суррогатный ключ Присоединиться")

## <a name="data-flow-script"></a>Скрипт потока данных

### <a name="syntax"></a>Синтаксис

```
<incomingStream> 
    keyGenerate(
        output(<surrogateColumnName> as long),
        startAt: <number>L
    ) ~> <surrogateKeyTransformationName>
```

### <a name="example"></a>Пример

![Суррогатный ключ Преобразование](media/data-flow/surrogate.png "Суррогатная ключевая трансформация")

Сценарий потока данных для вышеуказанной конфигурации суррогатного ключа находится в фрагменте кода ниже.

```
AggregateDayStats
    keyGenerate(
        output(key as long),
        startAt: 1L
    ) ~> SurrogateKey1
```

## <a name="next-steps"></a>Следующие шаги

В этих примерах используются преобразования [соединительных](data-flow-join.md) и [производных столбцов.](data-flow-derived-column.md)
