---
title: Конвейеры и действия в фабрике данных Azure
description: Узнайте о конвейерах и действиях в фабрике данных Azure.
services: data-factory
documentationcenter: ''
author: djpmsft
ms.author: daperlov
ms.service: data-factory
ms.workload: data-services
ms.topic: conceptual
ms.date: 11/19/2019
ms.openlocfilehash: ad4ffa71480a5af06c31872cbafcaab7719c55e0
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81418343"
---
# <a name="pipelines-and-activities-in-azure-data-factory"></a>Конвейеры и действия в фабрике данных Azure

> [!div class="op_single_selector" title1="Выберите используемую вами версию службы Data Factory:"]
> * [Версия 1](v1/data-factory-create-pipelines.md)
> * [Текущая версия](concepts-pipelines-activities.md)
[!INCLUDE[appliesto-adf-asa-md](includes/appliesto-adf-asa-md.md)]

В этой статье вы ознакомитесь с принципом работы конвейеров и действий в фабрике данных Azure и узнаете, как с их помощью создавать комплексные рабочие процессы, управляемые данными, для сценариев перемещения и обработки данных.

## <a name="overview"></a>Обзор
Фабрика данных может иметь один или несколько конвейеров. Конвейеры — это логические группы действий, которые вместе отвечают за выполнение задачи. Например, конвейер может содержать набор действий, которые глотают и очищают данные журнала, а затем отскакивают поток данных отображения для анализа данных журнала. Конвейер позволяет управлять действиями в виде набора, а не каждый по отдельности. Развертываете и запланировали конвейер вместо действий самостоятельно.

Действия в конвейере определяют операции с данными. Например, действие копирования позволяет скопировать данные из локальной базы данных SQL Server в хранилище BLOB-объектов Azure. Затем используйте активность потока данных или деятельность Databricks Notebook для обработки и преобразования данных из хранилища каблов в пул Azure Synapse Analytics, поверх которого строятся решения для отчетов бизнес-аналитики.

Data Factory имеет три группы деятельности: [деятельность движения данных,](copy-activity-overview.md) [деятельность по преобразованию данных](transform-data.md)и [контрольные действия.](control-flow-web-activity.md) Активность может занять ноль или больше [входных наборов данных](concepts-datasets-linked-services.md) и создать один или несколько [наборов выходных данных.](concepts-datasets-linked-services.md) На следующей схеме показана связь между конвейером, действием и набором данных в фабрике данных:

![Связь между набором данных, действием и конвейером](media/concepts-pipelines-activities/relationship-between-dataset-pipeline-activity.png)

Входной набор данных представляет входные данные для действия в конвейере, а выходной набор данных — выходные данные для действия. Наборы данных представляют данные в разных хранилищах, например в таблицах, файлах, папках и документах. Созданные наборы данных можно использовать для действий в конвейере. Например, можно указать входной или выходной набор данных для действия HDInsightHive или действия копирования. Дополнительные сведения о наборах данных см. в статье [Наборы данных в фабрике данных Azure](concepts-datasets-linked-services.md).

## <a name="data-movement-activities"></a>Действия перемещения данных

Действие копирования в фабрике данных копирует данные из хранилища-источника в хранилище-приемник. Фабрика данных поддерживает хранилища данных, перечисленные в таблице в этом разделе. Данные из любого источника можно записывать в любой приемник. Щелкните название хранилища, чтобы узнать, как скопировать данные из него или в него.

[!INCLUDE [data-factory-v2-supported-data-stores](../../includes/data-factory-v2-supported-data-stores.md)]

Дополнительные сведения см. в статье [Действие копирования в фабрике данных Azure](copy-activity-overview.md).

## <a name="data-transformation-activities"></a>Действия преобразования данных
Фабрика данных Azure поддерживает указанные ниже действия преобразования, которые вы можете добавлять в конвейеры как по отдельности, так и в связи с другим действием.

Действия по преобразованию данных | Вычислительная среда
---------------------------- | -------------------
[Поток данных](control-flow-execute-data-flow-activity.md) | Лазурные databricks, управляемые фабрикой данных Azure
[Функция Azure](control-flow-azure-function-activity.md) | Функции Azure
[Hive](transform-data-using-hadoop-hive.md) | HDInsight [Hadoop]
[Pig,](transform-data-using-hadoop-pig.md) | HDInsight [Hadoop]
[Mapreduce](transform-data-using-hadoop-map-reduce.md) | HDInsight [Hadoop]
[Потоковая передача Hadoop](transform-data-using-hadoop-streaming.md) | HDInsight [Hadoop]
[Spark](transform-data-using-spark.md) | HDInsight [Hadoop]
[Действия машинного обучения: выполнение пакета и обновление ресурса](transform-data-using-machine-learning.md) | Azure
[Сохраненная процедура](transform-data-using-stored-procedure.md) | Azure SQL, хранилище данных Azure SQL или SQL Server
[U-SQL](transform-data-using-data-lake-analytics.md) | Аналитика озера данных Azure
[Настраиваемое действие](transform-data-using-dotnet-custom-activity.md) | Пакетная служба Azure
[Записная книжка Databricks](transform-data-databricks-notebook.md) | Azure Databricks
[Действие JAR в Databricks](transform-data-databricks-jar.md) | Azure Databricks
[Действие Python в Databricks](transform-data-databricks-python.md) | Azure Databricks

Дополнительные сведения см. в статье [Преобразование данных в фабрике данных Azure](transform-data.md).

## <a name="control-flow-activities"></a>Управление действиями потока
Поддерживаются следующие действия потока управления:

Действие управления | Описание
---------------- | -----------
[Приложение Переменный](control-flow-append-variable-activity.md) | Добавьте значение к существующей переменной массива.
[Выполнение трубопровода](control-flow-execute-pipeline-activity.md) | Действие выполнения конвейера позволяет конвейеру фабрики данных вызвать другой конвейер.
[Фильтр](control-flow-filter-activity.md) | Примените выражение фильтра к вхотвому массиву
[Для каждого](control-flow-for-each-activity.md) | Действие ForEach определяет повторяющийся поток управления в конвейере. Это действие используется для выполнения итерации коллекции и выполняет указанные в цикле действия. Реализация цикла этого действия аналогична структуре цикла Foreach на языках программирования.
[Получение метаданных](control-flow-get-metadata-activity.md) | Действие GetMetadata можно использовать для получения метаданных любых данных в фабрике данных Azure.
[Действие условия If](control-flow-if-condition-activity.md) | Это действие можно использовать для создания ветви на основе условия, результатом расчета которого является значение True или False. Действие условия If предоставляет те же функциональные возможности, что и инструкция if в языках программирования. Он оценивает набор действий, когда условие `true` оценивает и другой набор действий, когда условие оценивается`false.`
[Действие поиска](control-flow-lookup-activity.md) | Действие поиска можно использовать для считывания или поиска записи, имени таблицы и значения из внешних источников. На эти выходные данные можно затем ссылаться в последующих действиях.
[Набор переменных](control-flow-set-variable-activity.md) | Установите значение существующей переменной.
[Действие Until](control-flow-until-activity.md) | Реализует цикл Do Until, который аналогичен циклической структуре Do-Until в языках программирования. Оно выполняет набор действий в цикле, пока условие, связанное с действием, не получит значение true. Можно указать значение времени ожидания для действия until в фабрике данных.
[Действие проверки](control-flow-validation-activity.md) | Убедитесь, что конвейер продолжает выполняться только в том случае, если набор справочных данных, соответствует определенным критериям или достигнут тайм-аут.
[Действие Wait](control-flow-wait-activity.md) | При использовании действия ожидания в конвейере конвейер ждет указанное время, прежде чем продолжить выполнение последующих действий.
[Веб-действие](control-flow-web-activity.md) | Веб-действие можно использовать для вызова из конвейера фабрики данных пользовательской конечной точки REST. Вы можете передать наборы данных и связанные службы, которые будет использовать это действие и к которым оно будет обращаться.
[Действие веб-перехватчика](control-flow-webhook-activity.md) | Используя активность webhook, позвоните в конечную точку и передайте URL-адрес обратного вызова. Запуск конвейера ждет вызова вызова, прежде чем приступить к следующему действию.

## <a name="pipeline-json"></a>Конвейер JSON
Вот, как конвейер определяется в формате JSON:

```json
{
    "name": "PipelineName",
    "properties":
    {
        "description": "pipeline description",
        "activities":
        [
        ],
        "parameters": {
        },
        "concurrency": <your max pipeline concurrency>,
        "annotations": [
        ]
    }
}
```

Тег | Описание | Тип | Обязательно
--- | ----------- | ---- | --------
name | Имя конвейера. Укажите имя, представляющее действие, которое выполняет конвейер. <br/><ul><li>Максимальное количество знаков: 140</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (\_).</li><li>Следующие символы не допускаются: ".", "я", "?", "/","<",">","",""&",",",","", "", "", "", "", "", ", ", ", ",\" </li></ul> | Строка | Да
description | Укажите текст, описывающий, для чего используется конвейер. | Строка | нет
Действия | В разделе **activities** можно определить одно или несколько действий. Дополнительные сведения об элементе JSON действий см. в разделе [JSON действия](#activity-json). | Array | Да
параметры | В разделе **Параметры** может быть задан один или несколько параметров, определенных в конвейере, которые делают конвейер гибким для повторного использования. | Список | нет
параллелизм | Максимальное количество одновременных запусков трубопровода может иметь. По умолчанию максимума не существует. Если лимит параллелизма достигнут, дополнительные запуски конвейера стоят в очереди до завершения предыдущих | Number | нет 
annotations | Список тегов, связанных с конвейером | Array | нет

## <a name="activity-json"></a>Действие JSON
В разделе **activities** можно определить одно или несколько действий. Существует два основных типа действий: действия выполнения и действия управления.

### <a name="execution-activities"></a>Действия выполнения
Действия выполнения включают в себя действия [перемещения данных](#data-movement-activities) и [преобразования данных](#data-transformation-activities). Они имеют следующую структуру верхнего уровня:

```json
{
    "name": "Execution Activity Name",
    "description": "description",
    "type": "<ActivityType>",
    "typeProperties":
    {
    },
    "linkedServiceName": "MyLinkedService",
    "policy":
    {
    },
    "dependsOn":
    {
    }
}
```

В приведенной ниже таблице описаны свойства, используемые в определениях JSON действия:

Тег | Описание | Обязательно
--- | ----------- | ---------
name | Имя действия. Укажите имя, представляющее операцию, которую выполняет действие. <br/><ul><li>Максимальное количество знаков: 55</li><li>Должен начать с буквы-номер, или\_подчеркнуть ( )</li><li>Следующие символы не допускаются: ".", "я", "?", "/","<",">","",""&",",",","", "", "", "", "", "", ", ", ", ",\" | Да</li></ul>
description | Текст, описывающий, для чего используется действие | Да
type | Тип действия. Разные типы действий описаны в разделах, посвященных [действиям перемещения данных](#data-movement-activities), [действиям преобразования данных](#data-transformation-activities) и [действиям управления](#control-flow-activities). | Да
linkedServiceName | Имя связанной службы, используемой действием.<br/><br/>Для действия может потребоваться указать службу, связанную с обязательной вычислительной средой. | Да, для действия HDInsight, действия пакетной оценки показателей службы "Машинное обучение Azure" и действия хранимой процедуры. <br/><br/>Нет — для всех остальных
typeProperties | Свойства в разделе typeProperties зависят от каждого типа действия. Чтобы просмотреть свойства типа для действия, щелкните ссылки на действие в предыдущем разделе. | нет
policy | Политики, которые влияют на поведение во время выполнения действия. Это свойство включает в себя тайм-аут и повторную попытку поведения. Если он не указан, используются значения по умолчанию. Дополнительные сведения см. в разделе [Политика действий](#activity-policy). | нет
Свойство dependsOn | Это свойство используется для определения зависимостей между последующими и предыдущими действиями. Дополнительные сведения см. в разделе [Зависимости действий](#activity-dependency). | нет

### <a name="activity-policy"></a>Политика действий
Политики влияют на поведение действия во время его выполнения, предоставляя возможность настройки параметров. Они доступны только для действий выполнения.

### <a name="activity-policy-json-definition"></a>Определение JSON политики действия

```json
{
    "name": "MyPipelineName",
    "properties": {
      "activities": [
        {
          "name": "MyCopyBlobtoSqlActivity",
          "type": "Copy",
          "typeProperties": {
            ...
          },
         "policy": {
            "timeout": "00:10:00",
            "retry": 1,
            "retryIntervalInSeconds": 60,
            "secureOutput": true
         }
        }
      ],
        "parameters": {
           ...
        }
    }
}
```

Имя JSON | Описание | Допустимые значения | Обязательно
--------- | ----------- | -------------- | --------
timeout | Указывает время ожидания для выполнения действия. | Timespan | Нет. Время ожидания по умолчанию — 7 дней.
retry | Максимальное количество повторных попыток | Целое число | Нет. Значение по умолчанию — 0.
retryIntervalInSeconds | Задержка между повторными попытками (в секундах) | Целое число | Нет. По умолчанию 30 секунд
secureOutput | При установлении истины выход из действия считается безопасным и не регистрируется для мониторинга. | Логическое | Нет. Значение по умолчанию — false.

### <a name="control-activity"></a>Действие управления
Действие управления имеет следующую структуру верхнего уровня:

```json
{
    "name": "Control Activity Name",
    "description": "description",
    "type": "<ActivityType>",
    "typeProperties":
    {
    },
    "dependsOn":
    {
    }
}
```

Тег | Описание | Обязательно
--- | ----------- | --------
name | Имя действия. Укажите имя, представляющее операцию, которую выполняет действие.<br/><ul><li>Максимальное количество знаков: 55</li><li>Должно начинаться с буквы, цифры или символа подчеркивания (\_).</li><li>Следующие символы не допускаются: ".", "я", "?", "/","<",">","",""&",",",","", "", "", "", "", "", ", ", ", ",\" | Да</li><ul>
description | Текст, описывающий, для чего используется действие | Да
type | Тип действия. Просматривайте [действия движения данных,](#data-movement-activities) [действия преобразования данных](#data-transformation-activities)и разделы [управления действиями](#control-flow-activities) для различных видов деятельности. | Да
typeProperties | Свойства в разделе typeProperties зависят от каждого типа действия. Чтобы просмотреть свойства типа для действия, щелкните ссылки на действие в предыдущем разделе. | нет
Свойство dependsOn | Это свойство используется для определения зависимостей между последующими и предыдущими действиями. Для получения дополнительной [информации см.](#activity-dependency) | нет

### <a name="activity-dependency"></a>Зависимость действий
Зависимость от действий определяет, как последующие действия зависят от предыдущих действий, определяя условие продолжения выполнения следующей задачи. Действие может зависеть от одного или нескольких предыдущих действий с разными условиями зависимости.

Различные условия зависимости: "Выполнено", "Сбой", "Пропущено", "Завершено".

Например, если в конвейере есть действие A -> действие B, возможны различные сценарии:

- Действие B имеет условие зависимости от действия А с условием **Выполнено**: действие B выполняется, только если действие А имеет конечное состояние "Выполнено".
- Действие B имеет условие зависимости от действия А с условием **Сбой**: действие B выполняется, только если действие А имеет конечное состояние "Сбой".
- Действие Б имеет условие зависимости от действия А с условием **Завершено**: действие B выполняется, если действие А имеет конечное состояние "Выполнено" или "Сбой".
- Активность B имеет условие зависимости от действия A с **пропущенным**: Действие B выполняется, если действие A имеет окончательный статус пропущенного. Конечное состояние "Пропущено" происходит в таком сценарии: действие X -> действие Y -> действие Z, где каждое действие выполняется, только если предыдущее действие завершается успешно. Если активность X выходит из строя, то activity Y имеет статус "Skipped", поскольку он никогда не выполняется. Аналогичным образом, Activity s также имеет статус «Skipped».

#### <a name="example-activity-2-depends-on-the-activity-1-succeeding"></a>Пример. Действие 2 зависит от успешного завершения действия 1

```json
{
    "name": "PipelineName",
    "properties":
    {
        "description": "pipeline description",
        "activities": [
         {
            "name": "MyFirstActivity",
            "type": "Copy",
            "typeProperties": {
            },
            "linkedServiceName": {
            }
        },
        {
            "name": "MySecondActivity",
            "type": "Copy",
            "typeProperties": {
            },
            "linkedServiceName": {
            },
            "dependsOn": [
            {
                "activity": "MyFirstActivity",
                "dependencyConditions": [
                    "Succeeded"
                ]
            }
          ]
        }
      ],
      "parameters": {
       }
    }
}

`"

## Sample copy pipeline
In the following sample pipeline, there is one activity of type **Copy** in the **activities** section. In this sample, the [copy activity](copy-activity-overview.md) copies data from an Azure Blob storage to an Azure SQL database.

```json
{
  "name": "CopyPipeline",
  "properties": {
    "description": "Copy data from a blob to Azure SQL table",
    "activities": [
      {
        "name": "CopyFromBlobToSQL",
        "type": "Copy",
        "inputs": [
          {
            "name": "InputDataset"
          }
        ],
        "outputs": [
          {
            "name": "OutputDataset"
          }
        ],
        "typeProperties": {
          "source": {
            "type": "BlobSource"
          },
          "sink": {
            "type": "SqlSink",
            "writeBatchSize": 10000,
            "writeBatchTimeout": "60:00:00"
          }
        },
        "policy": {
          "retry": 2,
          "timeout": "01:00:00"
        }
      }
    ]
  }
}
```
Обратите внимание на следующие моменты.

- В разделе действий доступно только одно действие, параметр **type** которого имеет значение **Copy**.
- Для этого действия параметру input присвоено значение **InputDataset**, а параметру output — значение **OutputDataset**. Сведения об определении наборов данных в JSON см. в статье [Наборы данных](concepts-datasets-linked-services.md).
- В разделе **typeProperties** в качестве типа источника указано **BlobSource**, а в качестве типа приемника — **SqlSink**. В разделе [действия движения данных](#data-movement-activities) щелкните хранилище данных, которое вы хотите использовать в качестве источника или раковины, чтобы узнать больше о перемещении данных в/из этого хранилища данных.

Полное пошаговое руководство по созданию этого конвейера см. в статье [Создание фабрики данных и конвейера с помощью PowerShell](quickstart-create-data-factory-powershell.md).

## <a name="sample-transformation-pipeline"></a>Пример конвейера преобразования
В следующем примере конвейера содержится одно действие типа **HDInsightHive** in the **действий** . В этом примере [действие HDInsight Hive](transform-data-using-hadoop-hive.md) преобразовывает данные из хранилища BLOB-объектов Azure, запуская файл сценария Hive в кластере Azure HDInsight Hadoop.

```json
{
    "name": "TransformPipeline",
    "properties": {
        "description": "My first Azure Data Factory pipeline",
        "activities": [
            {
                "type": "HDInsightHive",
                "typeProperties": {
                    "scriptPath": "adfgetstarted/script/partitionweblogs.hql",
                    "scriptLinkedService": "AzureStorageLinkedService",
                    "defines": {
                        "inputtable": "wasb://adfgetstarted@<storageaccountname>.blob.core.windows.net/inputdata",
                        "partitionedtable": "wasb://adfgetstarted@<storageaccountname>.blob.core.windows.net/partitioneddata"
                    }
                },
                "inputs": [
                    {
                        "name": "AzureBlobInput"
                    }
                ],
                "outputs": [
                    {
                        "name": "AzureBlobOutput"
                    }
                ],
                "policy": {
                    "retry": 3
                },
                "name": "RunSampleHiveActivity",
                "linkedServiceName": "HDInsightOnDemandLinkedService"
            }
        ]
    }
}
```
Обратите внимание на следующие моменты.

- В разделе activities есть только одно действие, параметр **type** которого имеет значение **HDInsightHive**.
- Файл скриптHive, **partitionweblogs.hql**, хранится в учетной записи хранилища Azure (указан скриптомLinkedService, называемой `adfgetstarted`AzureStorageLinkedService) и в папке скриптов в контейнере.
- Раздел `defines` используется, чтобы указать параметры среды выполнения, передаваемые скрипту Hive в качестве значений конфигурации Hive (например, `{hiveconf:inputtable}`, $`${hiveconf:partitionedtable}`).

Разделы **typeProperties** для каждого действия преобразования отличаются. Для получения дополнительных сведений о свойствах типа, поддерживаемых для действия преобразования, щелкните такое действие в таблице [Действия по преобразованию данных](#data-transformation-activities).

Полное пошаговое руководство по созданию этого конвейера см. в статье [Преобразование данных в облаке с помощью действия Spark в фабрике данных Azure](tutorial-transform-data-spark-powershell.md).

## <a name="multiple-activities-in-a-pipeline"></a>Несколько действий в конвейере
В двух предыдущих примерах конвейеров присутствует только одно действие. Конвейер может содержать сразу несколько действий. Действия могут выполняться параллельно при наличии нескольких действий в конвейере и последующих действий, которые не зависят от предыдущих.

Два действия можно соединить с помощью [зависимости действий](#activity-dependency), определяющей зависимость последующих действий от предыдущих, а также то, следует ли продолжать выполнение следующей задачи. Действие может зависеть от одного или нескольких предыдущих действий с разными условиями зависимости.

## <a name="scheduling-pipelines"></a>Планирование конвейеров
Конвейеры планируются триггерами. Существуют различные типы триггеров (спусковой крючок "Расписание", который позволяет запускать трубопроводы в расписании настенных часов, а также ручной триггер, который запускает трубопроводы по требованию). Дополнительные сведения см. в статье [Pipeline execution and triggers in Azure Data Factory](concepts-pipeline-execution-triggers.md) (Выполнение конвейера и триггеры в фабрике данных Azure).

Чтобы триггер выполнял конвейер, включите в определении триггера ссылку на нужный конвейер. Конвейеры и триггеры имеют связь n-m. Несколько триггеров могут выйти из одного конвейера, и один и тот же триггер может выйти из нескольких трубопроводов. После определения триггера необходимо активировать его, чтобы он начал запуск конвейера. Дополнительные сведения см. в статье [Pipeline execution and triggers in Azure Data Factory](concepts-pipeline-execution-triggers.md) (Выполнение конвейера и триггеры в фабрике данных Azure).

Например, скажите, что у вас есть триггер Планировщика, "Trigger A", который я хочу начать мой конвейер, "MyCopyPipeline". Вы определяете триггер, как показано в следующем примере:

### <a name="trigger-a-definition"></a>Определение триггера А

```json
{
  "name": "TriggerA",
  "properties": {
    "type": "ScheduleTrigger",
    "typeProperties": {
      ...
      }
    },
    "pipeline": {
      "pipelineReference": {
        "type": "PipelineReference",
        "referenceName": "MyCopyPipeline"
      },
      "parameters": {
        "copySourceName": "FileSource"
      }
    }
  }
}
```

## <a name="next-steps"></a>Дальнейшие действия
Пошаговые инструкции по созданию конвейеров с помощью действий приведены в следующих руководствах:

- [Создание фабрики данных и конвейера с помощью PowerShell](quickstart-create-data-factory-powershell.md)
- [Учебник. Создание первого конвейера для преобразования данных с помощью кластера Hadoop](tutorial-transform-data-spark-powershell.md)
