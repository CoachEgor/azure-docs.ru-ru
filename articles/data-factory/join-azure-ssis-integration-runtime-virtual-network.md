---
title: Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети | Документация Майкрософт
description: Узнайте, как присоединить среду выполнения интеграции Azure–SSIS к виртуальной сети Azure.
services: data-factory
documentationcenter: ''
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.topic: conceptual
ms.date: 08/15/2019
author: swinarko
ms.author: sawinark
ms.reviewer: douglasl
manager: craigg
ms.openlocfilehash: 3a1e272fa332c0bf0ee4e5ececa3edd83aec1d46
ms.sourcegitcommit: 0c906f8624ff1434eb3d3a8c5e9e358fcbc1d13b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2019
ms.locfileid: "69543136"
---
# <a name="join-an-azure-ssis-integration-runtime-to-a-virtual-network"></a>Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети
При использовании SQL Server Integration Services (SSIS) в фабрике данных Azure (ADF) необходимо присоединить Integration Runtime Azure-SSIS (IR) к виртуальной сети Azure в следующих сценариях: 

- Необходимо подключиться к локальным хранилищам данных из пакетов служб SSIS, работающих в среде IR Azure SSIS, без настройки и управления локальным IR в качестве прокси-сервера. 

- Вы хотите подключиться к ресурсам службы Azure, поддерживаемым конечными точками службы виртуальной сети, из пакетов служб SSIS, работающих в среде IR Azure SSIS.

- Вы размещаете базу данных каталога SSIS (SSISDB) в базе данных SQL Azure с конечными точками службы виртуальной сети или Управляемый экземпляр в виртуальной сети. 

ADF позволяет присоединить среду выполнения интеграции Azure SSIS к виртуальной сети, созданной с помощью классической модели развертывания или модели развертывания Azure Resource Manager. 

> [!IMPORTANT]
> Классическая виртуальная сеть скоро будет объявлена устаревшей, поэтому мы настоятельно рекомендуем использовать вместо нее виртуальную сеть Azure Resource Manager.  Если вы уже используете классическую виртуальную сеть, перейдите на виртуальную сеть Azure Resource Manager как можно скорее.

## <a name="access-to-on-premises-data-stores"></a>Доступ к локальным хранилищам данных
Если пакеты служб SSIS обращаются к локальным хранилищам данных, вы можете присоединить среду выполнения интеграции Azure SSIS к виртуальной сети, подключенной к локальной сети, или настроить и управлять локальным IR в качестве прокси-сервера для среды выполнения интеграции Azure SSIS. см. раздел [Настройка автономных IR в качестве Учетная запись-посредник для Azure SSIS IR](https://docs.microsoft.com/azure/data-factory/self-hosted-integration-runtime-proxy-ssis) . При присоединении среды выполнения интеграции Azure SSIS к виртуальной сети необходимо отметить несколько важных моментов. 

- Если есть имеющаяся виртуальная сеть, подключенная к локальной сети, то сначала создайте [виртуальную сеть Azure Resource Manager](../virtual-network/quick-create-portal.md#create-a-virtual-network) или [классическую виртуальную сеть](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) для присоединения среды выполнения интеграции Azure SSIS. Затем настройте подключение типа "сеть — сеть" через [VPN-шлюз](../vpn-gateway/vpn-gateway-howto-site-to-site-classic-portal.md) или [ExpressRoute](../expressroute/expressroute-howto-linkvnet-classic.md) между этой виртуальной сетью и вашей локальной сетью. 

- Если есть существующая виртуальная сеть Azure Resource Manager или классическая виртуальная сеть, подключенная к локальной сети в том же расположении, что и ваша среда выполнения интеграции Azure SSIS, вы можете присоединить IR к этой виртуальной сети. 

- Если есть существующая классическая виртуальная сеть, подключенная к локальной сети в расположении, отличном от вашей среды выполнения интеграции Azure SSIS, вы можете сначала создать [классическую виртуальную сеть](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) для присоединения IR Azure SSIS. Затем настройте подключение типа [классическая виртуальная сеть — классическая виртуальная сеть](../vpn-gateway/vpn-gateway-howto-vnet-vnet-portal-classic.md). Или вы можете создать [виртуальную сеть Azure Resource Manager](../virtual-network/quick-create-portal.md#create-a-virtual-network), чтобы присоединить к ней свою среду выполнения интеграции Azure SSIS. Затем настройте подключение типа [классическая виртуальная сеть — виртуальная сеть Azure Resource Manager](../vpn-gateway/vpn-gateway-connect-different-deployment-models-portal.md). 
 
- Если существует виртуальная сеть Azure Resource Manager, подключенная к локальной сети в расположении, отличном от вашей среды выполнения интеграции Azure SSIS, вы можете сначала создать [виртуальную сеть Azure Resource Manager](../virtual-network/quick-create-portal.md##create-a-virtual-network) для присоединения IR Azure SSIS. Затем настройте подключение типа "виртуальная сеть Azure Resource Manager — виртуальная сеть Azure Resource Manager". Кроме того, вы можете создать [классическую виртуальную сеть](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) для присоединения IR Azure SSIS. Затем настройте подключение типа [классическая виртуальная сеть — виртуальная сеть Azure Resource Manager](../vpn-gateway/vpn-gateway-connect-different-deployment-models-portal.md). 

## <a name="access-to-azure-services-with-virtual-network-service-endpoints"></a>Доступ к службам Azure с конечными точками службы виртуальной сети
Если пакеты SSIS обращаются к ресурсам службы Azure, поддерживаемым [конечными точками службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md) , и вы хотите защитить эти ресурсы в Azure SSIS IR, вы можете присоединить среду выполнения интеграции Azure SSIS к подсети виртуальной сети, настроенной с помощью виртуальной сети. Конечная точка службы и, в то же время, добавьте правило виртуальной сети в ресурс службы Azure, чтобы разрешить доступ из той же подсети.

## <a name="host-the-ssis-catalog-database-in-azure-sql-database-with-virtual-network-service-endpointsmanaged-instance"></a>Размещение базы данных каталога SSIS в базе данных SQL Azure с использованием конечных точек служб для виртуальной сети или управляемого экземпляра
Если вы размещаете каталог SSIS в базе данных SQL Azure с использованием конечных точек службы виртуальной сети, обязательно присоедините Azure-SSIS IR к той же виртуальной сети и подсети.

Если Azure-SSIS IR присоединяется к виртуальной сети управляемого экземпляра, используйте для них разные подсети. Если Azure-SSIS IR присоединяется к другой виртуальной сети, отличной от сети управляемого экземпляра, используйте пиринг между виртуальными сетями (в том же регионе) или подключение типа "виртуальная сеть — виртуальная сеть". См. статью [Подключение приложения к Управляемому экземпляру Базы данных SQL Azure](../sql-database/sql-database-managed-instance-connect-app.md)

В любом случае виртуальную сеть можно развернуть только с использованием модели развертывания с помощью Azure Resource Manager.

В следующих разделах приведены дополнительные сведения. 

## <a name="requirements-for-virtual-network-configuration"></a>Требования к конфигурации виртуальной сети
-   Убедитесь, что `Microsoft.Batch` — это поставщик, зарегистрированный в подписке подсети вашей виртуальной сети, в которой размещается IR Azure–SSIS. При использовании классической виртуальной сети также добавьте `MicrosoftAzureBatch` к роли "Участник классической виртуальной машины" для этой виртуальной сети. 

-   Убедитесь, что необходимые разрешения доступны. См. [Необходимые разрешения](#perms).

-   Выберите подходящую подсеть для размещения Azure-SSIS IR. См. раздел [Выбор подсети](#subnet). 

-   Если вы используете сервер служб доменных имен (DNS) в виртуальной сети, см. раздел [Сервер служб доменных имен](#dns_server). 

-   Если вы используете группу безопасности сети (NSG) в подсети, см. раздел [Группа безопасности сети](#nsg). 

-   Если вы используете Azure Express Route или настроили определяемый пользователем маршрут, см. раздел [Использование Azure Express Route или определяемого пользователем маршрута](#route). 

-   Убедитесь, что группа ресурсов виртуальной сети может создавать и удалять определенные ресурсы сети Azure. См. раздел [Требования для группы ресурсов](#resource-group). 

-   Если вы настраиваете среду выполнения интеграции Azure SSIS, как описано в статье [Выборочная установка для Azure SSIS IR](https://docs.microsoft.com/azure/data-factory/how-to-configure-azure-ssis-ir-custom-setup) , ваши узлы IR Azure SSIS будут выделять частные IP-адреса из предопределенного диапазона 172.16.0.0-172.31.255.255. Убедитесь, что частный IP-адрес диапазоны адресов виртуальных или локальных сетей не конфликтуют с этим диапазоном.

Ниже приведена схема, показывающая требуемые подключения для Azure-SSIS IR:

![Azure SSIS IR](media/join-azure-ssis-integration-runtime-virtual-network/azure-ssis-ir.png)

### <a name="perms"></a> Необходимые разрешения

Пользователь, создающий Azure-SSIS Integration Runtime, должен иметь следующие разрешения.

- Если вы присоединяете Azure-SSIS IR к виртуальной сети Azure Resource Manager, у вас есть два варианта:

  - Использовать встроенную роль *Участник сетей*. Эта роль предоставляет разрешение _Microsoft.Network/\*_ , область применения которого намного шире, чем требуется для этой задачи.

  - Создать настраиваемую роль, которая включает только нужное разрешение _Microsoft.Network/virtualNetworks/\*/join/action_. 

- Если вы присоединяете SSIS IR к классической виртуальной сети, мы рекомендуем использовать встроенную роль *Участник классических виртуальных машин*. В противном случае вам нужно будет определить пользовательскую роль, которая включает разрешение на присоединение к виртуальной сети.

### <a name="subnet"></a> Выбор подсети
-   Не следует выбирать подсеть шлюза для развертывания среды выполнения интеграции SSIS и Azure, так как она предназначена для шлюзов виртуальных сетей. 

-   Убедитесь, что выбранная подсеть содержит достаточный диапазон адресов для работы среды выполнения интеграции SSIS и Azure. Оставьте по крайней мере в два раза больше доступных IP-адресов, чем содержит узлов среда выполнения интеграции. Azure резервирует некоторые IP-адреса в каждой подсети, которые нельзя использовать. Зарезервированы первый и последний IP-адреса подсетей (для соответствия требованиям протокола), а также еще три адреса, используемые для служб Azure. Дополнительные сведения см. в разделе [Существуют ли ограничения на использование IP-адресов в пределах этих подсетей?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets) 

-   Не используйте подсеть, которая монопольно используется другими службами Azure (например, управляемый экземпляр базы данных SQL Azure, служба приложений и т. д.). 

### <a name="dns_server"></a> Сервер служб доменных имен 
Если вам нужно использовать собственный сервер служб доменных имен (DNS) в виртуальной сети, присоединенной с помощью среды выполнения интеграции Azure SSIS, убедитесь, что она может разрешить глобальные имена узлов Azure (например, имя `<your storage account>.blob.core.windows.net`большого двоичного объекта службы хранилища Azure). 

Рекомендуется выполнить следующие действия: 

-   Настройте пользовательскую службу DNS для перенаправления запросов в Azure DNS. Вы можете перенаправлять неразрешенные записи DNS на IP-адрес рекурсивных сопоставителей Azure (168.63.129.16) на вашем сервере DNS. 

-   Настройте пользовательскую службу DNS в качестве основной службы и Azure DNS в качестве дополнительной службы для виртуальной сети. Зарегистрируйте IP-адрес рекурсивных сопоставителей Azure (168.63.129.16) в качестве вторичного DNS-сервера, используемого в том случае, если ваш DNS-сервер недоступен. 

Дополнительные сведения см. в разделе [Разрешение имен с помощью собственного DNS-сервера](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-that-uses-your-own-dns-server). 

### <a name="nsg"></a> Группа безопасности сети
Если необходимо реализовать группу безопасности сети (NSG) для подсети, присоединенной средой выполнения интеграции Azure SSIS, разрешите входящий и исходящий трафик через следующие порты: 

| Direction | Транспортный протокол | Source | Диапазон исходных портов | Назначение | Диапазон портов назначения | Комментарии |
|---|---|---|---|---|---|---|
| Входящий трафик | TCP | батчнодеманажемент | * | VirtualNetwork | 29876, 29877 (при присоединении среды выполнения интеграции к виртуальной сети Azure Resource Manager) <br/><br/>10100, 20100, 30100 (при присоединении среды выполнения интеграции к классической виртуальной сети)| Служба фабрики данных использует эти порты для взаимодействия с узлами вашей среды выполнения интеграции Azure-SSIS в виртуальной сети. <br/><br/> Независимо от того, создан уровень подсети NSG или нет, Фабрика данных всегда настраивает NSG на уровне карт сетевых интерфейсов, подключенных к виртуальным машинам, на которых размещается Azure-SSIS IR. NSG уровня сетевых адаптеров на указанных портах разрешает только входящий трафик от IP-адресов Фабрики данных. Даже если эти порты доступны для интернет-трафика, трафик с IP-адресов, которые не являются IP-адресами Фабрики данных, блокируется на уровне сетевых адаптеров. |
| Исходящие | TCP | VirtualNetwork | * | AzureCloud; | 443 | Узлы среды выполнения интеграции Azure-SSIS в виртуальной сети используют этот порт для доступа к службам Azure, например к службе хранилища Azure и Центрам событий Azure. |
| Исходящие | TCP | VirtualNetwork | * | Интернет | 80 | Узлы среды выполнения интеграции Azure SSIS в виртуальной сети используют этот порт для скачивания списка отзыва сертификатов из Интернета. |
| Исходящие | TCP | VirtualNetwork | * | SQL | 1433, 11000-11999 | Узлы среды выполнения интеграции Azure-SSIS в виртуальной сети используют эти порты для доступа к базе данных SSISDB, размещенной на сервере Базы данных SQL Azure. Если для политики подключения сервера базы данных SQL Azure задано значение **прокси** вместо **перенаправления**, требуется только порт 1433. Это правило безопасности для исходящего трафика неприменимо к SSISDB, размещенной в вашей Управляемый экземпляр в виртуальной сети. |
||||||||

### <a name="route"></a> Использование Azure Express Route или определяемого пользователем маршрута
При подключении канала [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) к инфраструктуре виртуальной сети для расширения локальной сети в Azure распространенной конфигурацией является использование принудительного туннелирования (объявление маршрута BGP 0.0.0.0/0 в виртуальной сети), что заставляет исходящий Интернет-трафик из виртуальной сети передается локальному сетевому устройству для проверки и ведения журнала. 
 
Кроме того, можно определить [определяемые пользователем маршруты (определяемые пользователем маршруты)](../virtual-network/virtual-networks-udr-overview.md) , чтобы принудительно настроить исходящий Интернет-трафик из подсети, в которой размещена среда выполнения интеграции Azure SSIS в другой подсети, где размещено устройство виртуальной сети (NVA) в качестве брандмауэра или брандмауэра Azure для проверки и ведения журнала.
 
В обоих случаях маршрут трафика будет прерывать требуемое входящее подключение из зависимых служб фабрики данных Azure (службы управления пакетной службой Azure) к среде IR Azure SSIS в виртуальной сети. 
 
Решение заключается в определении одного (или нескольких) определяемых пользователем маршрутов (определяемые пользователем маршруты) в подсети, содержащей среду выполнения интеграции Azure SSIS. 

- Вы можете применить маршрут 0.0.0.0/0 с типом следующего прыжка в **Интернете** в подсети, где размещается среда выполнения интеграции Azure SSIS IR в Azure ExpressRoute, или изменить существующий маршрут 0.0.0.0/0 от типа следующего прыжка в качестве **виртуального устройства** в **Интернете** в NVA. моделирования.

![Добавление маршрута](media/join-azure-ssis-integration-runtime-virtual-network/add-route-for-vnet.png)
- Если вы собираетесь потерять возможность проверять исходящий Интернет трафик из этой подсети. Вы можете определить конкретные определяемые пользователем маршруты, чтобы маршрутизировать трафик только между службами управления пакетной службой Azure и Azure SSIS IR с типом следующего прыжка в **Интернете**.
Например, Если среда выполнения интеграции Azure `UK South`SSIS находится в, необходимо получить список диапазонов IP-адресов `BatchNodeManagement.UKSouth` из [тегов службы ссылка для скачивания](https://www.microsoft.com/en-us/download/details.aspx?id=56519) или через [API обнаружения тегов служб](https://aka.ms/discoveryapi). Затем примените ниже определяемые пользователем маршруты для связанного маршрута диапазона IP-адресов с типом следующего прыжка в **Интернете**.

![Параметры UDR AzureBatch](media/join-azure-ssis-integration-runtime-virtual-network/azurebatch-udr-settings.png)
> [!NOTE]
> Существуют дополнительные затраты на обслуживание этого подхода, которые необходимо регулярно проверять диапазон IP-адресов и добавлять новый диапазон IP-адресов в UDR, чтобы избежать нарушения работы среды IR Azure SSIS. Когда новый IP-адрес появится в теге службы, новый IP-адрес вступит в силу в течение другого месяца. Поэтому рекомендуется проверять диапазон IP-адресов ежемесячно. 

### <a name="resource-group"></a> Требования для группы ресурсов
-   Среда выполнения интеграции Azure SSIS должна создать определенные сетевые ресурсы в той же группе ресурсов, в которой находится виртуальная сеть. В число этих ресурсов входят следующие:
    -   Балансировщик нагрузки Azure с именем  *\<GUID >-azurebatch-клаудсервицелоадбаланцер*.
    -   Общедоступный IP-адрес Azure с именем  *\<GUID >-azurebatch-клаудсервицепублиЦип*.
    -   Группа безопасности рабочей сети с именем  *\<GUID >-azurebatch-клаудсервиценетворксекуритиграуп*. 

    Эти ресурсы будут созданы при запуске и удалении IR при прерывании IR. Не используйте их повторно в других ресурсах. в противном случае будет заблокирована ИК-блокировка. 

-   Убедитесь в отсутствии блокировки ресурсов в группе ресурсов и в подписке, к которым принадлежит виртуальная сеть. Если вы настраиваете блокировку только для чтения или удаление, запуск и остановка IR могут завершиться сбоем или перестать отвечать на запросы. 

-   Убедитесь, что у вас нет политики Azure, которая запрещает создавать следующие ресурсы в группе ресурсов и в подписке, к которым принадлежит виртуальная сеть: 
    -   Microsoft.Network/LoadBalancers 
    -   Microsoft.Network/NetworkSecurityGroups 
    -   Microsoft.Network/PublicIPAddresses 

### <a name="faq"></a> Часто задаваемые вопросы

- Как мы защищаем общедоступный IP-адрес, предоставляемый в Azure SSIS IR для входящего подключения? И можно ли удалить общедоступный IP-адрес?
 
    Сейчас общедоступный IP-адрес будет автоматически создан при использовании виртуальной сети Azure SSIS IR. У нас есть NSG на уровне сетевого адаптера, позволяющие только службе управления пакетной службой Azure исключать входящие подключения к Azure SSIS IR. Кроме того, можно указать уровень подсети NSG для защиты входящего трафика.

    Если вы не хотите предоставлять общедоступный IP-адрес, можно рассмотреть возможность [настройки самостоятельно размещенного IR в качестве прокси для Azure-SSIS IR](https://docs.microsoft.com/azure/data-factory/self-hosted-integration-runtime-proxy-ssis) , а не виртуальной сети, если она применяется в вашем сценарии.
 
- Есть ли статический IP-адрес клиента Azure SSIS IR, который можно включить в список разрешений брандмауэра для доступа к источнику данных?
 
    - Если источник данных является локальным, после подключения виртуальной сети к локальной сети и присоединения среды выполнения интеграции Azure SSIS в эту подсеть виртуальной сети можно разместить диапазон IP-адресов этой подсети в списке разрешений.
    - Если ваш источник данных поддерживает службу Azure с конечной точкой службы виртуальной сети, вы можете выполнить настройку точки обслуживания виртуальной сети в виртуальной сети и присоединить среду выполнения интеграции Azure SSIS к подсети виртуальной сети, после чего вы сможете использовать правило виртуальной сети. служб Azure вместо диапазона IP-адресов, чтобы разрешить доступ.
    - Если источником данных является другой облачный источник данных, вы можете использовать UDR для маршрутизации исходящего трафика из среды выполнения интеграции Azure SSIS в NVA или брандмауэра Azure со статическим общедоступным IP-адресом, чтобы вы могли разместить этот общедоступный IP-адрес NVA или брандмауэра Azure в списке разрешений.
    - Если ни одно из перечисленных выше требований не соответствует требованиям, вы можете оценить, можно ли выполнить доступ к источнику данных с помощью [настройки автономного IR в качестве прокси-сервера для среды выполнения интеграции Azure SSIS](https://docs.microsoft.com/azure/data-factory/self-hosted-integration-runtime-proxy-ssis). Затем можно разместить IP-адрес компьютера, на котором размещена локальная среда IR, в список разрешений вместо Присоединение Azure SSIS IR к виртуальной сети.

## <a name="azure-portal-data-factory-ui"></a>Портал Azure (пользовательский интерфейс фабрики данных)
В этом разделе показано, как присоединить имеющуюся среду выполнения Azure SSIS к виртуальной сети (классической виртуальной сети или виртуальной сети Azure Resource Manager) с помощью портала Azure и пользовательского интерфейса фабрики данных. Во-первых, необходимо правильно настроить виртуальную сеть перед присоединением к ней среды выполнения интеграции Azure SSIS. Выполните действия, приведенные в одном из следующих двух разделов, в зависимости от типа виртуальной сети (классическая или Azure Resource Manager). Затем перейдите к третьему разделу, чтобы присоединить среду выполнения интеграции Azure SSIS к виртуальной сети. 

### <a name="use-the-portal-to-configure-an-azure-resource-manager-virtual-network"></a>Настройка виртуальной сети Azure Resource Manager с помощью портала
Перед присоединением среды выполнения интеграции Azure SSIS к виртуальной сети необходимо настроить виртуальную сеть. 

1. Запустите Microsoft Edge или Google Chrome. Сейчас пользовательский интерфейс фабрики данных поддерживают только эти браузеры. 

1. Войдите на [портале Azure](https://portal.azure.com). 

1. Выберите **Больше служб**. Примените фильтр и выберите **Виртуальные сети**. 

1. Примените фильтр и выберите в списке свою виртуальную сеть. 

1. На странице **Виртуальная сеть** выберите **Свойства**. 

1. Нажмите кнопку копирования напротив поля **Идентификатор ресурса**, чтобы скопировать идентификатор ресурса для виртуальной сети в буфер обмена. Сохраните идентификатор из буфера обмена в OneNote или в файле. 

1. В меню слева выберите **Подсети**. Убедитесь, что число **доступных адресов** больше, чем узлов в вашей среде выполнения интеграции Azure SSIS. 

1. Убедитесь, что поставщик пакетной службы Azure зарегистрирован в подписке Azure, которая содержит виртуальную сеть. В противном случае зарегистрируйте этого поставщика. Если у вас в подписке уже есть учетная запись пакетной службы Azure, то ваша подписка зарегистрирована в пакетной службе Azure. (При создании Azure-SSIS IR на портале фабрики данных поставщик пакетной службы Azure регистрируется автоматически.) 

   1\. На портале Azure в меню слева выберите **Подписки**. 

   2\. Выберите свою подписку. 

   В. Выберите **Поставщики ресурсов** в меню слева и убедитесь, что **Microsoft.Batch** является зарегистрированным поставщиком. 

   ![Подтверждение состояния "Зарегистрировано"](media/join-azure-ssis-integration-runtime-virtual-network/batch-registered-confirmation.png)

   Если поставщик **Microsoft.Batch** не отображается в списке, то для его регистрации [создайте в своей подписке пустую учетную запись пакетной службы Azure](../batch/batch-account-create-portal.md). Затем ее можно будет удалить. 

### <a name="use-the-portal-to-configure-a-classic-virtual-network"></a>Настройка классической виртуальной сети с помощью портала
Перед присоединением среды выполнения интеграции Azure SSIS к виртуальной сети необходимо настроить виртуальную сеть. 

1. Запустите Microsoft Edge или Google Chrome. Сейчас пользовательский интерфейс фабрики данных поддерживают только эти браузеры. 

1. Войдите на [портале Azure](https://portal.azure.com). 

1. Выберите **Больше служб**. Примените фильтр и выберите **Виртуальные сети (классика)** . 

1. Примените фильтр и выберите в списке свою виртуальную сеть. 

1. На странице **Виртуальные сети (классика)** выберите **Свойства**. 

   ![Идентификатор ресурса классической виртуальной сети](media/join-azure-ssis-integration-runtime-virtual-network/classic-vnet-resource-id.png)

1. Нажмите кнопку копирования напротив поля **Идентификатор ресурса**, чтобы скопировать идентификатор ресурса для классической сети в буфер обмена. Сохраните идентификатор из буфера обмена в OneNote или в файле. 

1. В меню слева выберите **Подсети**. Убедитесь, что число **доступных адресов** больше, чем узлов в вашей среде выполнения интеграции Azure SSIS. 

   ![Число доступных адресов в виртуальной сети](media/join-azure-ssis-integration-runtime-virtual-network/number-of-available-addresses.png)

1. Присоедините **MicrosoftAzureBatch** к роли **Участник классической виртуальной машины** для виртуальной сети. 

    1\. В меню слева щелкните **Управление доступом (IAM)** и выберите вкладку **Назначения ролей**. 

    ![Кнопки "Управление доступом" и "Добавить"](media/join-azure-ssis-integration-runtime-virtual-network/access-control-add.png)

    2\. Выберите **Добавить назначение ролей**.

    В. На странице **Добавить назначение ролей** в поле **Роль** выберите **Участник классических виртуальных машин**. Вставьте **ddbf3205-c6bd-46ae-8127-60eb93363864** в поле **Выбор**, а затем из списка результатов поиска выберите **пакетную службу Microsoft Azure**. 

    ![Результаты поиска на странице "Добавить назначение ролей"](media/join-azure-ssis-integration-runtime-virtual-network/azure-batch-to-vm-contributor.png)

    Г. Нажмите кнопку **Сохранить**, чтобы сохранить параметры и закрыть страницу. 

    ![Сохранение параметров доступа](media/join-azure-ssis-integration-runtime-virtual-network/save-access-settings.png)

    Д. Убедитесь, что в списке участников отображается **пакетная служба Microsoft Azure**. 

    ![Подтверждение доступа к пакетной службе Azure](media/join-azure-ssis-integration-runtime-virtual-network/azure-batch-in-list.png)

1. Убедитесь, что поставщик пакетной службы Azure зарегистрирован в подписке Azure, которая содержит виртуальную сеть. В противном случае зарегистрируйте этого поставщика. Если у вас в подписке уже есть учетная запись пакетной службы Azure, то ваша подписка зарегистрирована в пакетной службе Azure. (При создании Azure-SSIS IR на портале фабрики данных поставщик пакетной службы Azure регистрируется автоматически.) 

   1\. На портале Azure в меню слева выберите **Подписки**. 

   2\. Выберите свою подписку. 

   В. Выберите **Поставщики ресурсов** в меню слева и убедитесь, что **Microsoft.Batch** является зарегистрированным поставщиком. 

   ![Подтверждение состояния "Зарегистрировано"](media/join-azure-ssis-integration-runtime-virtual-network/batch-registered-confirmation.png)

   Если поставщик **Microsoft.Batch** не отображается в списке, то для его регистрации [создайте в своей подписке пустую учетную запись пакетной службы Azure](../batch/batch-account-create-portal.md). Затем ее можно будет удалить. 

### <a name="join-the-azure-ssis-ir-to-a-virtual-network"></a>Присоединение среды выполнения интеграции Azure SSIS к виртуальной сети
1. Запустите Microsoft Edge или Google Chrome. Сейчас пользовательский интерфейс фабрики данных поддерживают только эти браузеры. 

1. На [портале Azure](https://portal.azure.com) в меню слева выберите **Фабрики данных**. Если пункт **Фабрики данных** не отображается в меню, щелкните **Больше служб**, а затем выберите **Фабрики данных** в разделе **АНАЛИТИКА**. 

   ![Список фабрик данных](media/join-azure-ssis-integration-runtime-virtual-network/data-factories-list.png)

1. Выберите из списка фабрику данных со средой выполнения интеграции Azure SSIS. После этого откроется домашняя страница фабрики данных. Выберите плитку **Author & Deploy** (Создать и развернуть). На отдельной вкладке откроется пользовательский интерфейс фабрики данных. 

   ![Домашняя страница фабрики данных](media/join-azure-ssis-integration-runtime-virtual-network/data-factory-home-page.png)

1. В пользовательском интерфейсе фабрики данных перейдите на вкладку **Правка**, щелкните **Подключения**, а затем выберите вкладку **сред выполнения интеграции**. 

   ![Вкладка сред выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/integration-runtimes-tab.png)

1. Если среда выполнения интеграции Azure SSIS запущена, в списке сред выполнения интеграции нажмите кнопку **Остановить** в столбце **Действия** для нужной среды выполнения интеграции Azure SSIS. Среду выполнения интеграции невозможно изменить, не остановив ее. 

   ![Остановка среды выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/stop-ir-button.png)

1. В списке сред выполнения интеграции нажмите кнопку **Изменить** в столбце **Действия** для нужной среды выполнения интеграции Azure SSIS. 

   ![Изменение среды выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/integration-runtime-edit.png)

1. На панели **настройки Integration Runtime** перейдите на страницу **Общие параметры** и **параметры SQL** , нажав кнопку **Далее** . 

1. На странице **Дополнительные параметры** выполните следующие действия. 

   1\. Установите флажок **выбрать виртуальную сеть...** . 

   2\. В поле **Подписка**выберите подписку Azure, в которой можно выбрать существующую виртуальную сеть. 
  
   В. В поле **Имя виртуальной сети** выберите нужную виртуальную сеть. 

   Г. В поле **Имя подсети** выберите нужную подсеть в виртуальной сети. 

   Д. Если вы хотите настроить и управлять локальной средой IR в качестве прокси-сервера для среды выполнения интеграции Azure SSIS, установите флажок настроить автономную среду **...** и см. статью [Настройка автономных IR в качестве прокси-сервера для Azure SSIS IR](https://docs.microsoft.com/azure/data-factory/self-hosted-integration-runtime-proxy-ssis) .

   f. Нажмите кнопку **Проверка виртуальной сети** и в случае успеха нажмите кнопку **Далее** . 

   ![Дополнительные параметры для настройки среды выполнения интеграции](media/join-azure-ssis-integration-runtime-virtual-network/ir-setup-advanced-settings.png)

1. На странице **Сводка** проверьте все параметры для среды IR Azure SSIS и нажмите кнопку **Обновить** .

1. Теперь можно запустить IR Azure SSIS, нажав кнопку **Пуск** в столбце **действия** для среды выполнения интеграции Azure SSIS. Запуск среды выполнения интеграции Azure SSIS, которая присоединяется к виртуальной сети, занимает примерно 20 – 30 минут. 

## <a name="azure-powershell"></a>Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

### <a name="configure-a-virtual-network"></a>Настройка виртуальной сети
Прежде чем присоединить среду выполнения интеграции Azure SSIS к виртуальной сети, настройте виртуальную сеть. Добавьте следующий скрипт, чтобы автоматически настроить разрешения или параметры виртуальной сети, которую присоединит ваша среда интеграции Azure SSIS.

```powershell
# Make sure to run this script against the subscription to which the virtual network belongs.
if(![string]::IsNullOrEmpty($VnetId) -and ![string]::IsNullOrEmpty($SubnetName))
{
    # Register to the Azure Batch resource provider
    $BatchApplicationId = "ddbf3205-c6bd-46ae-8127-60eb93363864"
    $BatchObjectId = (Get-AzADServicePrincipal -ServicePrincipalName $BatchApplicationId).Id
    Register-AzResourceProvider -ProviderNamespace Microsoft.Batch
    while(!(Get-AzResourceProvider -ProviderNamespace "Microsoft.Batch").RegistrationState.Contains("Registered"))
    {
    Start-Sleep -s 10
    }
    if($VnetId -match "/providers/Microsoft.ClassicNetwork/")
    {
        # Assign the VM contributor role to Microsoft.Batch
        New-AzRoleAssignment -ObjectId $BatchObjectId -RoleDefinitionName "Classic Virtual Machine Contributor" -Scope $VnetId
    }
}
```

### <a name="create-an-azure-ssis-ir-and-join-it-to-a-virtual-network"></a>Создание среды выполнения интеграции Azure SSIS и ее присоединение к виртуальной сети
Вы можете создать среду выполнения интеграции Azure SSIS и присоединить ее к виртуальной сети одновременно. Полный сценарий и инструкции см. в разделе [Azure PowerShell](create-azure-ssis-integration-runtime.md#azure-powershell).

### <a name="join-an-existing-azure-ssis-ir-to-a-virtual-network"></a>Присоединение имеющейся среды выполнения интеграции Azure SSIS к виртуальной сети
В сценарии статьи [Создание среды выполнения интеграции Azure SSIS в фабрике данных Azure](create-azure-ssis-integration-runtime.md) показано, как создать среду выполнения интеграции Azure SSIS и присоединить ее к виртуальной сети в том же сценарии. Если у вас имеется среда выполнения интеграции Azure SSIS, выполните следующие действия, чтобы присоединить ее к виртуальной сети. 
1. Остановите среду выполнения интеграции Azure SSIS. 
1. Настройте среду выполнения интеграции Azure SSIS для присоединения виртуальной сети. 
1. Запустите среду выполнения интеграции Azure SSIS. 

### <a name="define-the-variables"></a>Определение переменных
```powershell
$ResourceGroupName = "<your Azure resource group name>"
$DataFactoryName = "<your Data Factory name>" 
$AzureSSISName = "<your Azure-SSIS IR name>"
# Specify the information about your classic or Azure Resource Manager virtual network.
$VnetId = "<your Azure virtual network resource ID>"
$SubnetName = "<the name of subnet in your virtual network>"
```

### <a name="stop-the-azure-ssis-ir"></a>Остановка среды выполнения интеграции Azure SSIS
Остановите среду выполнения интеграции Azure SSIS перед присоединением к виртуальной сети. Следующая команда освобождает все узлы и прекращает выставление счетов.

```powershell
Stop-AzDataFactoryV2IntegrationRuntime -ResourceGroupName $ResourceGroupName `
                                            -DataFactoryName $DataFactoryName `
                                            -Name $AzureSSISName `
                                            -Force 
```

### <a name="configure-virtual-network-settings-for-the-azure-ssis-ir-to-join"></a>Настройка параметров виртуальной сети для присоединения средой выполнения интеграции Azure SSIS
```powershell
# Make sure to run this script against the subscription to which the virtual network belongs.
if(![string]::IsNullOrEmpty($VnetId) -and ![string]::IsNullOrEmpty($SubnetName))
{
    # Register to the Azure Batch resource provider
    $BatchApplicationId = "ddbf3205-c6bd-46ae-8127-60eb93363864"
    $BatchObjectId = (Get-AzADServicePrincipal -ServicePrincipalName $BatchApplicationId).Id
    Register-AzResourceProvider -ProviderNamespace Microsoft.Batch
    while(!(Get-AzResourceProvider -ProviderNamespace "Microsoft.Batch").RegistrationState.Contains("Registered"))
    {
        Start-Sleep -s 10
    }
    if($VnetId -match "/providers/Microsoft.ClassicNetwork/")
    {
        # Assign VM contributor role to Microsoft.Batch
        New-AzRoleAssignment -ObjectId $BatchObjectId -RoleDefinitionName "Classic Virtual Machine Contributor" -Scope $VnetId
    }
}
```

### <a name="configure-the-azure-ssis-ir"></a>Настройка среды выполнения интеграции Azure SSIS
Выполните команду `Set-AzDataFactoryV2IntegrationRuntime`, чтобы настроить среду выполнения интеграции Azure SSIS для присоединения виртуальной сети. 

```powershell
Set-AzDataFactoryV2IntegrationRuntime -ResourceGroupName $ResourceGroupName `
                                           -DataFactoryName $DataFactoryName `
                                           -Name $AzureSSISName `
                                           -Type Managed `
                                           -VnetId $VnetId `
                                           -Subnet $SubnetName
```

### <a name="start-the-azure-ssis-ir"></a>Запуск среды выполнения интеграции Azure SSIS
Чтобы запустить среду выполнения интеграции Azure SSIS, выполните следующую команду. 

```powershell
Start-AzDataFactoryV2IntegrationRuntime -ResourceGroupName $ResourceGroupName `
                                             -DataFactoryName $DataFactoryName `
                                             -Name $AzureSSISName `
                                             -Force

```

Выполнение этой команды занимает от 20 до 30 минут.

## <a name="next-steps"></a>Следующие шаги
Дополнительные сведения о среде выполнения интеграции Azure SSIS см. в следующих разделах: 
- [Среда выполнения интеграции Azure SSIS](concepts-integration-runtime.md#azure-ssis-integration-runtime). В этой статье приводятся общие сведения о средах выполнения интеграции в целом, включая среду Azure SSIS IR. 
- [Развертывание пакетов служб интеграции SQL Server (SSIS) в Azure](tutorial-create-azure-ssis-runtime-portal.md). В этом руководстве содержатся пошаговые инструкции по созданию среды выполнения интеграции Azure SSIS. Для размещения каталога SSIS в ней используется База данных SQL Azure. 
- [Создание среды выполнения интеграции Azure SSIS в фабрике данных Azure](create-azure-ssis-integration-runtime.md). Эта статья раскрывает учебник и содержит инструкции по использованию базы данных SQL Azure с конечными точками службы виртуальной сети или Управляемый экземпляр в виртуальной сети для размещения каталога SSIS и присоединения среды выполнения интеграции Azure SSIS к виртуальной сети. 
- [Мониторинг среды выполнения интеграции в фабрике данных Azure](monitor-integration-runtime.md#azure-ssis-integration-runtime). В этой статье показано, как получить сведения о среде выполнения интеграции Azure SSIS и предоставить описание состояния в возвращенных сведениях. 
- [Manage an Azure-SSIS integration runtime](manage-azure-ssis-integration-runtime.md) (Управление средой выполнения интеграции Azure SSIS). В этой статье показано, как приступить к работе, запускать или удалять среду выполнения интеграции Azure SSIS. Кроме того, здесь показано, как развернуть IR Azure SSIS путем добавления узлов.
