---
title: Общие проблемы - Миграционная служба базы данных Azure
description: Узнайте о том, как устранить распространенные проблемы/ошибки, связанные с использованием службы миграции баз данных Azure.
services: database-migration
author: pochiraju
ms.author: rajpo
manager: craigg
ms.reviewer: craigg
ms.service: dms
ms.workload: data-services
ms.custom: seo-lt-2019
ms.topic: article
ms.date: 02/20/2020
ms.openlocfilehash: c5d2ad481124f5ae048d010cdf632ee661bbd6ec
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77649113"
---
# <a name="troubleshoot-common-azure-database-migration-service-issues-and-errors"></a>Устранение проблем, распространенных проблем службы миграции базы данных Azure

В этой статье описаны некоторые распространенные проблемы и ошибки, с которыми могут сталкиваться пользователи службы миграции базы данных Azure. В статье также содержится информация о том, как решить эти проблемы и ошибки.

## <a name="migration-activity-in-queued-state"></a>Миграционная активность в состоянии очереди

При создании новых действий в проекте миграционной службы базы данных Azure действия остаются в состоянии в очереди.

| Причина         | Решение |
| ------------- | ------------- |
| Эта проблема возникает, когда экземпляр службы миграции базы данных Azure достиг максимальной емкости для текущих задач, которые одновременно выполняются. Любое новое действие стоит в очереди до тех пор, пока емкость не станет доступной. | Проверка экземпляра Службы миграции данных имеет действия в различных проектах. Можно продолжить создание новых действий, которые автоматически добавляются в очередь для выполнения. Как только любое из существующих выполняемых действий завершается, запускается следующее занятие в очереди и автоматически изменяется состояние состояния состояния. Вам не нужно предпринимать никаких дополнительных действий, чтобы начать миграцию действий в очереди.<br><br> |

## <a name="max-number-of-databases-selected-for-migration"></a>Максимальное количество баз данных, выбранных для миграции

Следующая ошибка возникает при создании действия для проекта миграции базы данных для перехода в базу данных Azure S'L или управляемый экземпляр базы данных Azure S'L:

* **Ошибка**: Ошибка проверки параметров миграции», «ошибкаDetail»:«Больше, чем максимальное число '4' объектов 'Базы данных' было выбрано для миграции."

| Причина         | Решение |
| ------------- | ------------- |
| Эта ошибка отображается при выборе более четырех баз данных для одного миграционного действия. В настоящее время каждая миграционная деятельность ограничена четырьмя базами данных. | Выберите четыре или меньше баз данных на миграционную деятельность. Если необходимо перенести более четырех баз данных параллельно, устройте другой экземпляр службы миграции баз данных Azure. В настоящее время каждая подписка поддерживает до двух экземпляров миграционной службы базы данных Azure.<br><br> |

## <a name="errors-for-mysql-migration-to-azure-mysql-with-recovery-failures"></a>Ошибки при миграции MyS'L в Azure MyS'L с сбоями восстановления

При переходе из базы данных MyS'L в базу данных Azs'L с помощью службы миграции Azure Database служба миграции завершается сбоем в следующем случае:

* **Ошибка**: Ошибка миграции базы данных - Задача 'TaskID' была приостановлена из-за последовательных сбоев восстановления.

| Причина         | Решение |
| ------------- | ------------- |
| Эта ошибка может возникнуть, когда пользователь, выполняющий миграцию, отсутствует роль ReplicationAdmin и/или привилегии REPLICATION CLIENT, REPLICATION REPLICA и SUPER (версии раньше, чем MyS'L 5.6.6).<br><br><br><br><br><br><br><br><br><br><br><br><br> | Убедитесь, что [предварительные привилегии](https://docs.microsoft.com/azure/dms/tutorial-mysql-azure-mysql-online#prerequisites) для учетной записи пользователя точно настроены в базе данных Azure для экземпляра MyS'L. Например, можно следовать следующим шагам для создания пользователя с познаваемым пользователем с требуемыми привилегиями:<br>1. CREATE USER migrateuser@'%' IDENTIFIED BY 'секретно'; <br>2. Предоставить все привилегии на db_name.' на 'migrateuser''%'%, определенные "секретным"; повторить этот шаг, чтобы предоставить доступ к большему количестве баз данных <br>3. Грант репликации раба на *.* до 'migrateuser''%'%, идентифицированного по «секретному»;<br>4. Клиент репликации гранта на *.* до 'migrateuser''%'%, идентифицированного по «секретному»;<br>5. Привилегии флеша; |

## <a name="error-when-attempting-to-stop-azure-database-migration-service"></a>Ошибка при попытке остановить миграционную службу баз данных Azure

Вы получаете следующую ошибку при остановке экземпляра службы миграции базы данных Azure:

* **Ошибка**: Служба не удалось остановить. Error (Ошибка): {'error':{'code':'InvalidRequest','message':'One or more activities are currently running' (Сейчас выполняется одно или более действий). Чтобы остановить службу, подождите, пока действия не будут завершены, или прекратите эти действия вручную и повторите попытку».

| Причина         | Решение |
| ------------- | ------------- |
| Эта ошибка отображается при попытке остановить экземпляр службы, включающий действия, которые все еще работают или присутствуют в проектах миграции. <br><br><br><br><br><br> | Убедитесь, что в случае службы миграции базы данных Azure, которую вы пытаетесь остановить, не проводится никаких действий. Вы также можете удалить действия или проекты, прежде чем пытаться остановить службу. Следующие шаги иллюстрируют, как удалить проекты для очистки экземпляра миграционной службы, удалив все выполняемые задачи:<br>1. Установка-модуль -Name AzureRM.DataMigration <br>2. Логин-AzureRmAccount <br>3. Выберите-AzureRmSubscription -ПодпискаName "подзаголовок\<>" <br> 4. Удалить-AzureRmDataMigrationProject \<-Имя проектаName> \<-ResourceGroupName \<rgName> -ServiceName сервисName> -DeleteRunningTask |

## <a name="error-when-attempting-to-start-azure-database-migration-service"></a>Ошибка при попытке запустить миграционную службу базы данных Azure

Вы получаете следующую ошибку при запуске экземпляра службы миграции базы данных Azure:

* **Ошибка**: Служба не запустится. Ошибка: «ошибкаDetail':'Служба не заработана, пожалуйста, свяжитесь с службой поддержки Майкрософт»

| Причина         | Решение |
| ------------- | ------------- |
| Эта ошибка отображается при сходе предыдущего экземпляра внутри. Эта ошибка возникает редко, и команда инженеров знает об этом. <br> | Удалите экземпляр службы, который вы не можете запустить, а затем предоставить новый, чтобы заменить его. |

## <a name="error-restoring-database-while-migrating-sql-to-azure-sql-db-managed-instance"></a>Восстановление базы данных ошибка при переходе смигрировать сSL в управляемый экземпляр Azure S'L DB

При выполнении онлайн-миграции с сервера S'L в управляемый экземпляр базы данных Azure S'L, сокращение не удается при следующей ошибке:

* **Ошибка**: Операция восстановления не сработала для операции Id 'operationId'. Код 'AuthorizationFailed', Сообщение 'Клиент 'clientId' с object id 'objectId' не имеет разрешения на выполнение действия 'Microsoft.Sql/locations/managedDatabaseRestoreAzureAsyncOperation/read' над областью '/подписки/subscriptionId'.

| Причина         | Решение    |
| ------------- | ------------- |
| Эта ошибка указывает на то, что основной элемент приложения, используемый для онлайн-миграции с сервера S'L в управляемый экземпляр базы данных Azure S'L, не имеет разрешения на ввод подписок. Некоторые вызовы API с Управляемой инстанцией в настоящее время требуют этого разрешения на подписку на операцию восстановления. <br><br><br><br><br><br><br><br><br><br><br><br><br><br> | Используйте `Get-AzureADServicePrincipal` cmdlet PowerShell, `-ObjectId` доступный из сообщения об ошибке, чтобы перечислить имя дисплея используемого идентификатора приложения.<br><br> Проверка разрешений на это приложение и убедитесь, что он играет [роль участника](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor) на уровне подписки. <br><br> Инженерная группа миграционной службы базы данных Azure работает над тем, чтобы ограничить требуемый доступ от текущей роли вклада в подписке. Если у вас есть бизнес-требования, которые не позволяют использовать роль впользуесь, обратитесь в службу поддержки Azure для получения дополнительной помощи. |

## <a name="error-when-deleting-nic-associated-with-azure-database-migration-service"></a>Ошибка при утяжении NIC, связанной с миграционной службой баз данных Azure

При попытке удалить карту сетевого интерфейса, связанную с миграционной службой базы данных Azure, попытка удаления завершается ошибкой:

* **Ошибка**: Не удается удалить NIC, связанный с миграционной службой базы данных Azure, из-за службы DMS, используя NIC

| Причина         | Решение    |
| ------------- | ------------- |
| Эта проблема возникает, когда экземпляр службы миграции базы данных Azure все еще может присутствовать и потреблять NIC. <br><br><br><br><br><br><br><br> | Чтобы удалить этот NIC, удалите экземпляр службы DMS, который автоматически удаляет NIC, используемый службой.<br><br> **Важно:** Убедитесь, что удаленный экземпляр службы миграции базы данных Azure не работает.<br><br> После удаления всех проектов и действий, связанных с экземпляром службы миграции базы данных Azure, можно удалить экземпляр службы. NIC, используемый экземпляром службы, автоматически очищается в рамках удаления службы. |

## <a name="connection-error-when-using-expressroute"></a>Ошибка при подключении с помощью ExpressRoute

При попытке подключения к источнику с помощью ExpressRoute в мастере проектов Azure Database Migration Service происходит сбой после длительного времени ожидания.

| Причина         | Решение    |
| ------------- | ------------- |
| При использовании [ExpressRoute](https://azure.microsoft.com/services/expressroute/)служба миграции базы данных Azure [требует](https://docs.microsoft.com/azure/dms/tutorial-sql-server-azure-sql-online) предоставления трех конечных точек службы в подсети Virtual Network, связанной с службой:<br> -- Конечная точка сервисного автобуса<br> -- Конечная точка хранения<br> -- Конечная точка базы данных (например, конечная точка S'L, конечная точка Cosmos DB)<br><br><br><br><br> | [Включить](https://docs.microsoft.com/azure/dms/tutorial-sql-server-azure-sql-online) необходимые конечные точки службы для подключения ExpressRoute между источником и миграционной службой базы данных Azure. <br><br><br><br><br><br><br><br> |

## <a name="lock-wait-timeout-error-when-migrating-a-mysql-database-to-azure-db-for-mysql"></a>Ошибка тайм-аута ожидания блокировки при переходе базы данных MyS'L в Azure DB для MyS'L

При переносе базы данных MyS'L в базу данных Azure для экземпляра MyS'L через службу миграции базы данных Azure не удается с помощью следующей ошибки тайм-аута блокировки:

* **Ошибка**: Ошибка миграции базы данных - Не удалось загрузить файл - Не удалось запустить процесс загрузки для файла 'n' RetCode: SQL_ERROR SqlState: HY000 NativeError: 1205 Сообщение: «MyS'L» (водитель ODBC) попытаться перезапустить транзакцию

| Причина         | Решение    |
| ------------- | ------------- |
| Эта ошибка возникает, когда миграция выходит из строя из-за тайм-аута ожидания блокировки во время миграции. | Рассмотрите возможность увеличения значения параметра **сервера «innodb_lock_wait_timeout».** Самое допустимое значение 1073741824. |

## <a name="error-connecting-to-source-sql-server-when-using-dynamic-port-or-named-instance"></a>Ошибка подключения к исходному серверу S'L Server при использовании динамического порта или названного экземпляра

При попытке подключения миграционной службы базы данных Azure к исходному коду сервера S'L Server, который работает как на названном экземпляре, так и в динамическом порту, соединение завершается ошибкой с этой ошибкой:

* **Ошибка**: -1 - СЗл соединение не удалось. При подключении к SQL Server произошла ошибка, связанная с сетью или с определенным экземпляром. Сервер не найден или недоступен. Убедитесь, что указано правильное имя сервера и SQL Server разрешает удаленные подключения. (поставщик: сетевые интерфейсы SQL, ошибка: 26 — ошибка при обнаружении указанного сервера или экземпляра)

| Причина         | Решение    |
| ------------- | ------------- |
| Эта проблема возникает, когда экземпляр исходного сервера S'L Server, к которому служба миграции базы данных Azure пытается подключиться, имеет динамический порт или использует именованный экземпляр. Служба браузера сервера S'L слушает порт UDP 1434 для входящих соединений в названном экземпляре или при использовании динамического порта. Динамический порт может изменяться при перезагрузке службы S'L Server. Вы можете проверить динамический порт, назначенный экземпляру, через конфигурацию сети в менеджере конфигурации сервера S'L.<br><br><br> |Проверить, что служба миграции базы данных Azure может подключиться к исходной службе s'L Server Browser на порте UDP 1434 и экземпляру s-L Server через динамически назначенный порт TCP по мере необходимости. |

## <a name="additional-known-issues"></a>Дополнительные известные проблемы

* [Известные проблемы/ограничения миграции с миграцией в интернет-сети в базу данных Azure S'L](https://docs.microsoft.com/azure/dms/known-issues-azure-sql-online)
* [Известные проблемы/ограничения миграции с миграцией в Интернет в базу данных Azure для MyS'L](https://docs.microsoft.com/azure/dms/known-issues-azure-mysql-online)
* [Известные проблемы/ограничения миграции с миграцией в Интернет в базу данных Azure для PostgreS'L](https://docs.microsoft.com/azure/dms/known-issues-azure-postgresql-online)

## <a name="next-steps"></a>Дальнейшие действия

* Посмотреть статью [Azure базы данных миграционной службы PowerShell](https://docs.microsoft.com/powershell/module/azurerm.datamigration/?view=azurermps-6.13.0#data_migration).
* Посмотреть статью [Как настроить параметры сервера в базу данных Azure для MyS'L с помощью портала Azure](https://docs.microsoft.com/azure/mysql/howto-server-parameters).
* Просмотрите статью [Обзор предпосылок для использования службы миграции баз данных Azure.](https://docs.microsoft.com/azure/dms/pre-reqs)
* Ознакомьтесь [с часто задаваемыми вопросами об использовании миграционной службы базы данных Azure.](https://docs.microsoft.com/azure/dms/faq)
