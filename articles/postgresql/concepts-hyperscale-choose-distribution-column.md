---
title: Выберите столбцы распределения в базе данных Azure для PostgreSQL — Гипермасштабируемость (Citus) (Предварительная версия)
description: Хороший выбор для столбцов распределения в распространенных сценариях гипермасштабируемого
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: e9fba14b8979f739fd29bc277e32fb544221d08a
ms.sourcegitcommit: 0ae3139c7e2f9d27e8200ae02e6eed6f52aca476
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65078990"
---
# <a name="choose-distribution-columns-in-azure-database-for-postgresql--hyperscale-citus-preview"></a>Выберите столбцы распределения в базе данных Azure для PostgreSQL — Гипермасштабируемость (Citus) (Предварительная версия)

Выбор столбца распределения каждая таблица является **одним из наиболее важных** моделирования решения. Гипермасштабируемый сохраняет строки в сегментах, на основе значения столбца распределения строк.

Правильный выбор групп связанных данных на тех же физических узлах, делая запрашивает быстрые и добавление поддержки для всех компонентов SQL. Делает неправильный выбор системы будет выполняться медленно и не будет поддерживать все функции SQL на узлах.

В этом разделе советы распространения столбца по два наиболее распространенных сценариев обработки.

### <a name="multi-tenant-apps"></a>Мультитенантные приложения

Мультитенантной архитектуре используется форма иерархическая база данных для моделирования для распределения запросов между узлами в группе серверов.  Вверху иерархии данных называется *идентификатор_клиента*и должны храниться в столбце для каждой таблицы.

Гипермасштабируемого проверяет запросы для просмотра с каким Идентификатором клиента, они включают в себя и находит соответствующий таблицы сегментов. Он направляет запрос в одном рабочем узле, который содержит сегмент. Выполнив запрос с все соответствующие данные, помещенные на одном узле называется совместного размещения.

На следующей схеме показано совместное размещение в модели данных мультитенантного приложения. В ней содержится две таблицы, учетные записи и кампании, распределенные по `account_id`. Затененный сегментов, каждый из которых цвет представляет узел рабочей роли, который содержит его. Зеленый сегментов хранятся вместе на одного рабочего узла и синего на другом. Обратите внимание на то, как запрос соединения между учетными записями и кампаний бы все необходимые данные вместе на одном узле при ограничении обеих таблиц в той же учетной записи\_идентификатор.

![совместное размещение нескольких клиентов](media/concepts-hyperscale-choosing-distribution-column/multi-tenant-colocation.png)

Чтобы применить такой подход в вашей собственной схеме, определение того, что составляет клиента в приложении. Общие экземпляры включают в компании, учетная запись, организации или клиента. Имя столбца будет выглядеть примерно так `company_id` или `customer_id`. Рассмотрим каждое из запросов и задаться вопросом: он подойдет, если бы она имела Дополнительные предложения WHERE, чтобы ограничить все таблицы, участвующие в строках с помощью один и тот же идентификатор клиента?
Запросы в мультитенантной модели относятся к клиенту, для экземпляра в определенные хранилища, в котором бы области запросов на продажи или инвентаризации.

#### <a name="best-practices"></a>Рекомендации

-   **Секции распределенных таблицах распространенных клиентом\_столбец идентификатора.** Например, в приложении SaaS, где клиенты являются компаний, клиент\_идентификатор скорее всего будет компании\_идентификатор.
-   **Преобразуйте небольших таблиц между клиентами ссылочных таблиц.** Если несколько клиентов совместно используют небольшую таблицу данных, распространять ее как ссылочной таблице.
-   **Ограничить фильтр, все приложение запрашивает клиентом\_идентификатор.** Каждый запрос следует запросить сведения для одного клиента за раз.

Чтение [мультитенантной руководстве](./tutorial-design-database-hyperscale-multi-tenant.md) пример создания такого приложения.

### <a name="real-time-apps"></a>В режиме реального времени приложения

Мультитенантной архитектуре представляет иерархическую структуру и использует совместное размещение данных, чтобы направлять запросы на каждого клиента. Напротив архитектуры в режиме реального времени зависят от свойств конкретного распространения своих данных для достижения высокой параллельной обработки.

Мы используем «идентификатор сущности» как условие для распределения столбцов в модели в режиме реального времени. Типичный сущности являются пользователи, узлов или устройств.

Запросов в реальном времени обычно запросить числовые статистические выражения, сгруппированные по дате или категории. Гипермасштабируемый пересылает запросы для каждого сегмента для частичные результаты и собирает окончательный ответ на узел-координатор. Запросы выполняются быстрее при как contribute большого числа узлов, как можно и не один узел необходимо выполнить непропорционально большое количество рабочих.

#### <a name="best-practices"></a>Рекомендации

-   **Выберите столбец с большим количеством элементов, как столбец распределения.** Для сравнения \"состояние\" поля в таблице order со значениями «new», «оплачиваемое» и «отправлен» является неудачный Выбор столбца распределения. Предполагается только эти несколько значений, который ограничивает количество сегментов, которые могут содержать данные, а также количество узлов, которые может обработать его. Между столбцами с большим количеством элементов это хорошо, кроме того, чтобы выбрать те, которые часто используются в предложений group by или в качестве ключей соединения.
-   **Выберите столбец с равномерное распределение.** При распространении таблицы по столбцу, будут реализованы некоторые общие значения данных в таблице постепенно накапливаются в определенные сегменты. Узлами, содержащими этих сегментах приведет к выполняет больше работы, чем другие узлы.
-   **Распределение таблиц фактов и измерений в общих столбцах.**
    Таблицы фактов может иметь только один ключ распределения. Таблицы, которые объединяют на другой ключ не будет размещен совместно с таблицей фактов. Выберите одно измерение совместно разместить на основе частоты присоединен и размер строки соединения.
-   **Измените некоторые таблицы измерения в ссылочные таблицы.** Если таблица измерения не может быть размещен совместно с таблицей фактов, можно повысить производительность запросов, распространяя копии таблицы измерений для всех узлов в виде ссылочной таблице.

Чтение [руководстве панели мониторинга в режиме реального времени](./tutorial-design-database-hyperscale-realtime.md) пример создания такого приложения.

### <a name="timeseries-data"></a>Временной ряд данных

В рабочей нагрузке временных рядов приложения запросить последние сведения и обеспечит архивацию старых сведений.

Наиболее распространенная ошибка при моделировании информации временной ряд в Гипермасштабируемого использует сам штамп времени в качестве столбца распределения. Хэш-распределение на основе времени будет распределять раз первый взгляд в произвольном порядке в разных сегментах, вместо того, чтобы оставить диапазоны времени вместе в сегментах. Запросы, включающие времени обычно ссылаются на диапазоны времени (например последние данные), поэтому такие хэш-распределение может привести к сетевых издержек.

#### <a name="best-practices"></a>Рекомендации

-   **Не выбирайте метку времени как столбец распределения.** Выберите другим столбцом распределения. В приложении с несколькими клиентами используйте идентификатор клиента или в приложении в режиме реального времени используйте идентификатор сущности.
-   **Используйте PostgreSQL секционирование таблиц для времени вместо нее.** Используйте секционирование таблиц для разбиения большой таблицы данных, упорядоченную по времени на несколько таблиц, унаследованного с каждая из которых содержит различные периоды времени.  Распределению таблицы секционированы Postgres в Гипермасштабируемого создает сегменты для производных таблиц.

Чтение [руководстве временной ряд](https://aka.ms/hyperscale-tutorial-timeseries) пример создания такого приложения.

## <a name="next-steps"></a>Дальнейшие действия
- Узнайте, как [совместное размещение](concepts-hyperscale-colocation.md) между помогает распределенных данных, запросы будут выполняться очень быстро
