---
title: мониторингу и настройке отдельного сервера Базы данных Azure для PostgreSQL
description: В этой статье описываются функции мониторинга и настройки в базе данных Azure для PostgreSQL-Single Server.
author: lfittl-msft
ms.author: lufittl
ms.service: postgresql
ms.topic: conceptual
ms.date: 07/10/2020
ms.openlocfilehash: 4fd16e9dcf9f0b75b48311adf3e9282adbce2a25
ms.sourcegitcommit: 19dce034650c654b656f44aab44de0c7a8bd7efe
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2020
ms.locfileid: "91708719"
---
# <a name="monitor-and-tune-azure-database-for-postgresql---single-server"></a>мониторингу и настройке отдельного сервера Базы данных Azure для PostgreSQL
Мониторинг данных о серверах помогает устранять неполадки и оптимизировать рабочую нагрузку. База данных Azure для PostgreSQL предоставляет различные параметры мониторинга, дающие возможность получить полезные сведения о поведении сервера.

## <a name="metrics"></a>Метрики
База данных Azure для PostgreSQL предоставляет различные метрики, позволяющие понять действия ресурсов, поддерживающих сервер PostgreSQL. Каждая метрика создается с частотой в одну минуту и имеет объем [истории до 93 дней](https://docs.microsoft.com/azure/azure-monitor/platform/data-platform-metrics#retention-of-metrics). Вы можете настроить оповещения на основе метрик. Пошаговые инструкции см. в статье [Использование портала Azure для настройки оповещений на основе метрик для базы данных Azure для MySQL](howto-alert-on-metric.md). Другие задачи включают настройку автоматических действий, выполнение расширенной аналитики и архивирование журнала. Дополнительные сведения см. в статье [Обзор метрик в Microsoft Azure](../monitoring-and-diagnostics/monitoring-overview-metrics.md).

### <a name="list-of-metrics"></a>Список метрик
Для базы данных Azure для PostgreSQL доступны следующие метрики:

|Метрика|Отображаемое имя метрики|Единица измерения|Описание|
|---|---|---|---|
|cpu_percent|Нагрузка ЦП|Процент|Процент используемого ЦП.|
|memory_percent|Процент памяти|Процент|Процент используемой памяти.|
|io_consumption_percent|Процент ввода-вывода данных|Процент|Процент используемых операций ввода-вывода. (Неприменимо для серверов уровня Basic.)|
|storage_percent|Storage percentage|Процент|Процент использованного объема хранилища сервера (от максимального объема).|
|storage_used|Storage used|Байты|Используемый объем хранилища. Хранилище, используемое службой, может содержать файлы базы данных, журналы транзакций и журналы сервера.|
|storage_limit|Storage limit|Байты|Максимальный объем хранилища для этого сервера.|
|serverlog_storage_percent|Процент хранилища для журнала сервера|Процент|Процент использованного объема хранилища журнала сервера (от максимального объема).|
|serverlog_storage_usage|Используемый объем хранилища для журнала сервера|Байты|Используемый объем хранилища журнала сервера.|
|serverlog_storage_limit|Максимальный объем хранилища для журнала сервера|Байты|Максимальный объем хранилища журнала сервера для этого сервера.|
|active_connections|Активные подключения|Count|Число активных подключений к серверу.|
|connections_failed|Неудачные подключения|Count|Число установленных соединений, для которых произошел сбой.|
|network_bytes_egress|Сеть (исходящий трафик)|Байты|Исходящий сетевой трафик по активным подключениям.|
|network_bytes_ingress|Сеть (входящий трафик)|Байты|Входящий сетевой трафик по активным подключениям.|
|backup_storage_used|Используемое хранилище резервных копий|Байты|Объем используемого хранилища резервных копий. Эта метрика представляет собой сумму хранилища, потребляемого всеми полными резервными копиями базы данных, разностными резервными копиями и резервными копиями журналов на основе срока хранения резервной копии, заданного для сервера. Периодичность резервного копирования управляется службой и описывается в [статье основные понятия](concepts-backup.md). Для геоизбыточного хранилища использование хранилища резервных копий в два раза больше, чем локально избыточное хранилище.|
|pg_replica_log_delay_in_bytes|Максимальная задержка между репликами|Байты|Запаздывание в байтах между первичной и задержкой репликой. Эта метрика доступна только на сервере-источнике.|
|pg_replica_log_delay_in_seconds|Задержка реплики|Секунды|Время с момента последнего воспроизведения транзакции. Эта метрика доступна только для серверов реплик.|

## <a name="server-logs"></a>Журналы сервера
Можно включить ведение журнала на сервере. Эти журналы ресурсов можно отправлять в [журналы Azure Monitor](../azure-monitor/log-query/log-query-overview.md), концентраторы событий и учетную запись хранения. Дополнительные сведения о ведении журналов см. на странице [Журналы сервера в базе данных Azure для PostgreSQL](concepts-server-logs.md).

## <a name="query-store"></a>Хранилище запросов
[Хранилище запросов](concepts-query-store.md) отслеживает производительность запросов с течением времени, включая статистику времени выполнения запросов и события ожидания. Эта функция сохраняет сведения о производительности среды выполнения запросов в системной базе данных с именем **azure_sys** в схеме query_store. Вы можете управлять процессами сбора и хранения данных с помощью различных приспособлений конфигурации.

## <a name="query-performance-insight"></a>Анализ производительности запросов
Средство [Анализ производительности запросов](concepts-query-performance-insight.md) работает совместно с хранилищем запросов для предоставления визуализаций, доступных на портале Azure. Эти диаграммы позволяют определить основные запросы, влияющие на производительность. Анализ производительности запросов доступен в разделе **Поддержка и устранение неполадок** страницы портала сервера базы данных Azure для PostgreSQL.

## <a name="performance-recommendations"></a>Рекомендации по производительности
Функция [Рекомендации по производительности](concepts-performance-recommendations.md) определяет возможности для повышения производительности рабочей нагрузки. Рекомендации по производительности предоставляют рекомендации по созданию новых индексов, которые могут повысить производительность рабочих нагрузок. Для создания рекомендаций по индексам эта функция учитывает различные характеристики базы данных, включая ее схемы и рабочую нагрузку по данным хранилища запросов. После реализации любой из рекомендаций по повышению производительности клиенты должны протестировать производительность, чтобы оценить результаты внесенных изменений. 

## <a name="planned-maintenance-notification"></a>Уведомление о плановом обслуживании

**Уведомления о плановом обслуживании** позволяют получать оповещения о запланированном обслуживании базы данных Azure для PostgreSQL-Single Server. Эти уведомления интегрируются с плановым обслуживанием [работоспособности служб](../service-health/overview.md) и позволяют просматривать все запланированные профилактические работы для подписок в одном месте. Он также помогает масштабировать уведомление до нужных аудиторий для разных групп ресурсов, так как у вас могут быть разные контакты, ответственные за различные ресурсы. Вы получите уведомление о предстоящем обслуживании 72 часов перед событием.

> [!Note]
> Мы сделаем все попытки предоставить **уведомление о плановом обслуживании** 72 часов для всех событий. Однако в случае критических обновлений или исправлений безопасности уведомления могут быть отправлены ближе к событию или пропущены.

### <a name="to-receive-planned-maintenance-notification"></a>Получение уведомления о запланированном обслуживании

1. На [портале](https://portal.azure.com)выберите **Работоспособность службы**.
2. В разделе **Оповещения** выберите **Оповещения о работоспособности**.
3. Выберите **+ Добавить оповещение о работоспособности службы** и заполните поля.
4. Заполните обязательные поля. 
5. Выберите **Тип события**, выберите **плановое техническое обслуживание** или **выберите все** .
6. В **группе действий** определите, как вы хотите получать оповещение (получить электронное письмо, активировать приложение логики и т. д.).  
7. Убедитесь, что для параметра Включить правило при создании задано значение Да.
8. Выберите **создать правило генерации оповещений** , чтобы завершить оповещение.

Подробные инструкции по созданию **оповещений о работоспособности службы**см. в статье [Создание оповещений журнала действий для уведомлений службы](../service-health/alerts-activity-log-service-notifications.md).

> [!IMPORTANT]
> Уведомления о плановом обслуживании в настоящее время доступны в предварительной версии во всех регионах, **за исключением** западной центральной части США

## <a name="next-steps"></a>Дальнейшие действия
- См. раздел [Настройка оповещений](howto-alert-on-metric.md) для получения рекомендаций по созданию оповещения для метрики.
- Дополнительные сведения о доступе к метрикам и их экспорте с помощью портала Azure, REST API или интерфейса командной строки см. в статье [Обзор метрик в Microsoft Azure](../monitoring-and-diagnostics/monitoring-overview-metrics.md).
- Читайте наш блог, чтобы ознакомиться с [рекомендациями по мониторингу сервера](https://azure.microsoft.com/blog/best-practices-for-alerting-on-metrics-with-azure-database-for-postgresql-monitoring/).
