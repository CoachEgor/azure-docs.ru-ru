---
title: Настройка оповещения - Hyperscale (Citus) - База данных Azure для PostgreS'L
description: В этой статье описывается, как настроить и получить доступ к метрическим оповещениям для базы данных Azure для PostgreS-L - Hyperscale (Citus)
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.topic: conceptual
ms.date: 3/16/2020
ms.openlocfilehash: 80c061f72ce827df8f8354a5881c032c6f874fe1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80063147"
---
# <a name="use-the-azure-portal-to-set-up-alerts-on-metrics-for-azure-database-for-postgresql---hyperscale-citus"></a>Используйте портал Azure для настройки оповещений о метриках для базы данных Azure для PostgreS-L - Hyperscale (Citus)

В этой статье показано, как настроить оповещения для базы данных Azure для PostgreSQL с помощью портала Azure. Вы можете получать оповещение на основе [метрик мониторинга](concepts-hyperscale-monitoring.md) для служб Azure.

Мы назначаем оповещение для срабатывания при пересечении порога значением указанной метрики. Оповещение срабатывает при первом смнянии состояния и продолжает вызываться после этого.

Оповещения можно настроить для выполнения следующих действий при его активации:
* Отправка уведомлений по электронной почте администратору службы и соадминистраторам.
* отправка уведомления на указанные дополнительные электронные адреса;
* вызов веб-перехватчика.

Для настройки правил генерации оповещений и получения сведений о них можно использовать:
* [Портал Azure](../azure-monitor/platform/alerts-metric.md#create-with-azure-portal)
* [Лазурный CLI](../azure-monitor/platform/alerts-metric.md#with-azure-cli)
* [Azure Monitor REST API](https://docs.microsoft.com/rest/api/monitor/metricalerts)

## <a name="create-an-alert-rule-on-a-metric-from-the-azure-portal"></a>Создание правила генерации оповещений на основе метрики на портале Azure
1. На [портале Azure](https://portal.azure.com/) выберите сервер базы данных Azure для PostgreSQL, который нужно отследить.

2. В разделе боковой панели **Мониторинг** выберите **Оповещения**, как показано ниже:

   ![Выбор "Правила оповещения"](./media/howto-hyperscale-alert-on-metric/2-alert-rules.png)

3. Выберите **новое правило оповещения** (яп.

4. Откроется страница **Создание правила**, как показано ниже. Заполните необходимые сведения:

   ![Форма добавления оповещения для метрики](./media/howto-hyperscale-alert-on-metric/4-add-rule-form.png)

5. В разделе **Состояние** выберите **Добавить**.

6. Выберите из списка сигналов метрику, для которой необходимо создать оповещение. В этом примере выберите Storage percent (Процент хранилища).
   
   ![Выбор метрики](./media/howto-hyperscale-alert-on-metric/6-configure-signal-logic.png)

7. Наверстойная логика оповещения:

    * **Оператор** (напротив. "Больше, чем")
    * **Пороговое значение** (напротив. 85 процентов)
    * **Детальность агрегации** времени метрического правила должна быть удовлетворена до срабатывания оповещения (напротив. "За последние 30 минут")
    * и **частота оценки** (напротив. "1 минута")
   
   По завершении нажмите кнопку **Готово**.

   ![Выбор метрики](./media/howto-hyperscale-alert-on-metric/7-set-threshold-time.png)

8. В разделе **Группы действий** выберите **Создать**, чтобы создать группу для получения уведомлений об оповещении.

9. Заполните форму "Добавить группу действий", указав имя, короткое имя, подписку и группу ресурсов.

    ![Группа действий](./media/howto-hyperscale-alert-on-metric/9-add-action-group.png)

10. Настройте тип действия **Электронная почта, SMS, push-уведомление, голосовой вызов**.
    
    Выберите "Роль менеджера ресурсов Azure" для отправки уведомлений владельцам подписок, участникам и читателям.
   
    По завершении нажмите кнопку **ОК**.

    ![Группа действий](./media/howto-hyperscale-alert-on-metric/10-action-group-type.png)

11. Укажите имя правила генерации оповещений, описание и уровень серьезности.

    ![Группа действий](./media/howto-hyperscale-alert-on-metric/11-name-description-severity.png) 

12. Выберите **Создать правило генерации оповещений**, чтобы создать оповещение.

    Через несколько минут оповещение включится и будет активироваться, как было описано выше.

### <a name="managing-alerts"></a>Управление оповещениями

После создания оповещения можно выбрать его и выложить следующие действия:

* просмотреть диаграмму, отображающую пороговое и фактическое значения метрики за предыдущий день, относящиеся к этому оповещению;
* **изменить** или **удалить** правило генерации оповещений;
* **отключить** или **включить** его, если нужно временно остановить или возобновить получение уведомлений.

## <a name="suggested-alerts"></a>Предлагаемые оповещения

### <a name="disk-space"></a>Дисковое пространство

Мониторинг и оповещение важно для каждой группы серверов Hyperscale (Citus). Базовая база данных PostgreS'L требует свободного дискового пространства для правильной работы. Если диск становится полным, узла сервера базы данных будет отключена и откажется от запуска до тех пор, пока не будет доступно пространство. В этот момент для исправления ситуации требуется запрос поддержки майкрософт.

Мы рекомендуем устанавливать дисковые оповещения о пространстве на каждом узлах в каждой группе серверов, даже для непроизводственного использования. Предупреждения об использовании дисков оговора обеспечивают заблаговременное предупреждение, необходимое для вмешательства и поддержания работообразности узлов. Для достижения наилучших результатов попробуйте серию оповещений на 75%, 85% и 95% использования. Проценты выбора зависят от скорости приема данных, так как быстрое проглатывание данных заполняет диск быстрее.

По мере того как диск причаливает своему пределу космоса, попробуйте эти методы для того чтобы получить больше свободно космоса:

* Обзор политики хранения данных. Если это возможно, переместите старые данные в холодное хранилище.
* Рассмотрите возможность [добавления узлов](howto-hyperscale-scaling.md#add-worker-nodes) в группу серверов и перебалансировки осколков. Перебалансировка распределяет данные на большем количестве компьютеров.
* Рассмотрим [рост емкости](howto-hyperscale-scaling.md#increase-or-decrease-vcores-on-nodes) рабочих узлов. Каждый работник может иметь до 2 TiB хранения. Однако добавление узлов следует попытаться перед изменяя узлы, поскольку добавление узлов завершается быстрее.

### <a name="cpu-usage"></a>Загрузка ЦП.

Мониторинг использования процессора полезен для установления базового уровня производительности. Например, вы можете заметить, что использование процессора, как правило, около 40-60%. Если использование процессора вдруг начинает колебаться вокруг 95%, вы можете распознать аномалию. Использование процессора может отражать органический рост, но оно также может выявить бродячий запрос. При создании оповещения процессора установите длительную детализацию агрегации, чтобы поймать длительные увеличения и игнорировать сиюминутные всплески.

## <a name="next-steps"></a>Дальнейшие действия
* Узнайте больше о [настройке веб-перехватчиков webhook в оповещениях](../azure-monitor/platform/alerts-webhooks.md).
* Прочитайте [обзор сбора метрики](../monitoring-and-diagnostics/insights-how-to-customize-monitoring.md) и узнайте, как можно обеспечить, чтобы служба была доступна и отвечала на запросы.
