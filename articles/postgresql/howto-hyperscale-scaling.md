---
title: Масштабирование группы серверов — горизонтальное масштабирование (Цитус) — база данных Azure для PostgreSQL
description: Настройка памяти группы серверов, диска и ресурсов ЦП для повышения нагрузки
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: how-to
ms.date: 9/18/2020
ms.openlocfilehash: fef873d5122fefb48c85281f71e206f95f3fbe48
ms.sourcegitcommit: bdd5c76457b0f0504f4f679a316b959dcfabf1ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2020
ms.locfileid: "90986709"
---
# <a name="server-group-size"></a>Размер группы серверов

Параметр развертывания в режиме масштабирования (Цитус) использует серверы баз данных для параллельного выполнения запросов и хранения дополнительных данных. Группа серверов "размер" относится как к числу серверов, так и к аппаратным ресурсам каждого из них.

## <a name="picking-initial-size"></a>Начальный размер выборки

Размер группы серверов с точки зрения количества узлов и их емкости оборудования легко изменить ([см. ниже](#scale-a-hyperscale-citus-server-group)). Однако по-прежнему необходимо выбрать исходный размер для новой группы серверов. Ниже приведены некоторые советы по разумному выбору.

### <a name="multi-tenant-saas-use-case"></a>Вариант использования SaaS с несколькими клиентами

Для миграции в Цитус с существующего экземпляра базы данных PostgreSQL с одним узлом рекомендуется выбрать кластер, в котором общее количество рабочих ролей виртуальных ядер и RAM равно значению исходного экземпляра. В таких случаях мы наблюдали 3 раза улучшения производительности, так как сегментирование улучшает использование ресурсов, позволяя использовать меньшие индексы и т. д.

Количество виртуальных ядер, необходимое для узла координатора, зависит от имеющейся рабочей нагрузки (пропускная способность для записи и чтения). Узел координатора не требует настолько большого объема ОЗУ, как рабочие узлы, но выделение памяти определяется на основе числа Виртуальное ядро (как описано в разделе [Параметры конфигурации](concepts-hyperscale-configuration-options.md)), так что число Виртуальное ядро по сути является реальным решением.

### <a name="real-time-analytics-use-case"></a>Регистр использования аналитики в режиме реального времени

Всего виртуальных ядер: при работе с данными в ОЗУ можно рассчитывать линейное улучшение производительности на масштабировании (Цитус) пропорционально числу рабочих ядер. Чтобы определить нужное количество виртуальных ядер, учитывайте текущую задержку запросов в базе данных с одним узлом и требуемую задержку в масштабировании (Цитус). Разделите текущее значение задержки на планируемое и округлите результат.

Объем ОЗУ для рабочей роли. Желательно предоставить такой объем памяти, чтобы ее хватало для большей части рабочего набора данных. Тип запросов, используемых приложением, влияет на требования к памяти. Вы можете выполнить анализ запроса, чтобы определить, сколько памяти требуется. Помните, что виртуальных ядер и ОЗУ масштабируются вместе, как описано в статье [Параметры конфигурации](concepts-hyperscale-configuration-options.md) в.

## <a name="scale-a-hyperscale-citus-server-group"></a>Масштабирование группы серверов с горизонтальным масштабированием (Цитус)

Служба "база данных Azure для PostgreSQL" (Цитус) предоставляет возможность самостоятельного масштабирования, чтобы справиться с повышенной нагрузкой. Портал Azure позволяет легко добавлять новые рабочие узлы и увеличивать виртуальных ядер существующих узлов. Добавление узлов не приводит к простою и даже перемещение сегментов на новые узлы (называемые [перераспределением сегментов](#rebalance-shards)) без прерывания запросов.

### <a name="add-worker-nodes"></a>Добавление рабочих узлов

Чтобы добавить узлы, перейдите на вкладку " **Вычисление и хранение** " в группе серверов "Горизонтальная шкала" (Цитус).  При перетаскивании ползунка для **счетчика рабочих узлов** изменяется значение.

:::image type="content" source="./media/howto-hyperscale-scaling/01-sliders-workers.png" alt-text="Ползунки ресурсов":::

Нажмите кнопку **сохранить** , чтобы изменения вступили в силу.

> [!NOTE]
> После увеличения и сохранения число рабочих узлов не может быть уменьшено с помощью ползунка.

#### <a name="rebalance-shards"></a>Перераспределение сегментов

Чтобы воспользоваться преимуществами новых добавленных узлов, необходимо перераспределить сегменты распределенной таблицы, что означает перемещение [некоторых сегментов из](concepts-hyperscale-distributed-data.md#shards)существующих узлов в новые. Сначала убедитесь, что подготовка новых рабочих ролей успешно завершена. Затем запустите подсистему балансировки сегментов, подключившись к узлу координатора кластера с psql и запустив:

```sql
SELECT rebalance_table_shards('distributed_table_name');
```

`rebalance_table_shards`Функция перераспределяет все таблицы в группе совместного [размещения](concepts-hyperscale-colocation.md) таблицы с именем в аргументе. Поэтому нет необходимости вызывать функцию для каждой распределенной таблицы, просто вызвать ее в репрезентативной таблице из каждой группы совместного размещения.

### <a name="increase-or-decrease-vcores-on-nodes"></a>Увеличение или уменьшение виртуальных ядер на узлах

Помимо добавления новых узлов можно увеличить возможности существующих узлов. Регулировка емкости вычислений может оказаться полезной для экспериментов с производительностью, а также для краткосрочных или долгосрочных изменений в требованиях к трафику.

Чтобы изменить виртуальных ядер для всех рабочих узлов, настройте ползунок **виртуальных ядер** в разделе **Конфигурация (на рабочий узел)**. Виртуальных ядер узла координатора можно изменить независимо. Измените ползунок **виртуальных ядер** в разделе  **Конфигурация (узел координатор)**.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения о [параметрах производительности](concepts-hyperscale-configuration-options.md)группы серверов.
