---
title: Шифрование данных для базы данных Azure для PostgreSQL — устранение неполадок одиночного сервера
description: Узнайте, как устранить неполадки шифрования данных для базы данных Azure для PostgreSQL — один сервер.
author: kummanish
ms.author: manishku
ms.service: postgresql
ms.topic: conceptual
ms.date: 02/13/2020
ms.openlocfilehash: 6d2e027c47bef3186f95c2183b316b5c15511070
ms.sourcegitcommit: f255f869c1dc451fd71e0cab340af629a1b5fb6b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/16/2020
ms.locfileid: "77371505"
---
# <a name="troubleshooting-data-encryption-with-customer-managed-keys-in-azure-database-for-postgresql---single-server"></a>Устранение неполадок шифрования данных с помощью управляемых клиентом ключей в базе данных Azure для PostgreSQL — один сервер
В этой статье описывается, как определить и устранить распространенные проблемы и ошибки, возникающие в базе данных Azure для PostgreSQL-Single Server, настроенном с шифрованием данных с помощью ключа, управляемого клиентом.

## <a name="introduction"></a>Введение
Если шифрование данных настроено для использования управляемого клиентом ключа в Azure Key Vault, постоянный доступ к этому ключу необходим для того, чтобы сервер оставался доступным. Если сервер теряет доступ к ключу, управляемому клиентом, в Azure Key Vault, сервер запустит все подключения с соответствующим сообщением об ошибке и изменит его состояние на " ***недоступен*** " в портал Azure.

Если недоступная база данных Azure для PostgreSQL-Single Server больше не нужна, ее можно немедленно удалить для прекращения расходов. Все остальные действия на сервере не разрешены, пока доступ к хранилищу ключей Azure не будет восстановлен и сервер станет доступен. Изменение параметра шифрования данных с "Да" (управляемое клиентом) на "No" (управляемое службой) на недоступном сервере также невозможно, пока сервер зашифрован с помощью управляемого клиентом. Необходимо выполнить повторную проверку ключа вручную, чтобы сервер был доступен. Это необходимо для защиты данных от несанкционированного доступа во время отзыва разрешений на управляемый клиентом ключ.

## <a name="common-errors-causing-server-to-become-inaccessible"></a>Распространенные ошибки, вызывающие недоступность сервера

Большинство проблем, возникающих при использовании шифрования данных с Azure Key Vault, вызваны одной из следующих ошибок конфигурации.

Хранилище ключей недоступно или не существует.

* Хранилище ключей случайно удалено.
* Временная ошибка сети, которая приводит к недоступности хранилища ключей.

Нет разрешения на доступ к хранилищу ключей или ключ не существует.

* Ключ случайно удален, отключен или истек его срок действия.
* База данных Azure для PostgreSQL — управляемое экземпляром единичное удостоверение было случайно удалено.
* Разрешения, предоставленные службе "база данных Azure для PostgreSQL" для ключей, не достаточны (они не включают в себя получение, перенос и распаковку).
* Разрешения для базы данных Azure для PostgreSQL, управляемого экземпляром одиночного сервера, были отозваны или удалены.

## <a name="identify-and-resolve-common-errors"></a>Определение и исправление распространенных ошибок
### <a name="errors-on-the-key-vault"></a>Ошибки в хранилище ключей

#### <a name="disabled-key-vault"></a>Отключенное хранилище ключей
* азурекэйваулткэйдисабледмессаже
* **Объяснение** : не удалось выполнить операцию на сервере, так как ключ Azure Key Vault отключен.

#### <a name="missing-key-vault-permissions"></a>Отсутствуют разрешения хранилища ключей
* азурекэйваултмиссингпермиссионсмессаже
* Сервер не имеет необходимых разрешений на получение, перенос и распаковку для разрешений Azure Key Vault. Предоставьте всем отсутствующим разрешениям субъекта-службы с ИДЕНТИФИКАТОРом.

### <a name="mitigation"></a>Меры по снижению риска
* Убедитесь, что ключ, управляемый клиентом, имеется в Key Vault:
* Определите хранилище ключей и перейдите к нему на портале Azure.
* Убедитесь, что ключ, определенный по URI ключа, присутствует.


## <a name="next-steps"></a>Дальнейшие действия
[Настройте шифрование данных с помощью ключа, управляемого клиентом, для базы данных Azure для PostgreSQL, используя портал Azure](howto-data-encryption-portal.md).