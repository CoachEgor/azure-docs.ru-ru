---
title: Шифрование данных для устранения проблем - База данных Azure для PostgreS'L - Единый сервер
description: Узнайте, как устранить проблему шифрования данных в базе данных Azure для PostgreS-L - Единый сервер
author: kummanish
ms.author: manishku
ms.service: postgresql
ms.topic: conceptual
ms.date: 02/13/2020
ms.openlocfilehash: 2902ff17ac14a48f1a11259339c2ab1bc4595980
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79299266"
---
# <a name="troubleshoot-data-encryption-in-azure-database-for-postgresql---single-server"></a>Шифрование данных в базе данных Azure для PostgreS-L - Единый сервер

Эта статья поможет выявить и устранить общие проблемы, которые могут возникнуть при развертывании на одном сервере базы данных Azure для PostgreS'L при настройке с помощью шифрования данных с помощью ключа, управляемого клиентом.

## <a name="introduction"></a>Вступление

При настройке шифрования данных для использования управляемого клиентом ключа в Azure Key Vault сервертребует постоянного доступа к ключу. Если сервер теряет доступ к ключу, управляемому клиентом в Azure Key Vault, он откажет сядево,обратно в надлежащее сообщение об ошибке и изменит его состояние на ***Недоступный*** на портале Azure.

Если вам больше не нужна недоступная база данных Azure для сервера PostgreS'L, вы можете удалить ее, чтобы прекратить расходы. Никакие другие действия на сервере не допускаются до тех пор, пока не будет восстановлен доступ к хранилищу ключей и не будет доступен сервер. Кроме того, невозможно изменить опцию шифрования данных `Yes`с `No` (управляемой клиентом) на (управляемую службой) на недоступном сервере, когда он зашифрован с помощью ключа, управляемого клиентом. Вам придется повторно пересмотреть ключ вручную, прежде чем сервер снова будет доступен. Это действие необходимо для защиты данных от несанкционированного доступа, в то время как разрешения на ключ, управляемый клиентом, аннулируются.

## <a name="common-errors-causing-server-to-become-inaccessible"></a>Распространенные ошибки, приводящие к тому, что сервер становится недоступным

Следующие ошибки вызывают большинство проблем с шифрованием данных, которые используют ключи Azure Vault:

- Хранилище ключей недоступно или не существует:
  - Хранилище ключей случайно удалено.
  - Временная ошибка сети, которая приводит к недоступности хранилища ключей.

- У вас нет разрешений на доступ к хранилищу ключа или ключ не существует:
  - Срок действия ключа истек или был случайно удален или отключен.
- Управляемая идентификация базы данных Azure для экземпляра PostgreS'L была случайно удалена.
  - Управляемая идентификация базы данных Azure для экземпляра PostgreS'L не имеет достаточного количества ключевых разрешений. Например, разрешения не включают Get, Wrap и Unwrap.
  - Управляемые разрешения на идентификацию в базе данных Azure для экземпляра PostgreS'L были отозваны или удалены.

## <a name="identify-and-resolve-common-errors"></a>Определение и исправление распространенных ошибок

### <a name="errors-on-the-key-vault"></a>Ошибки на хранилище ключей

#### <a name="disabled-key-vault"></a>Свод ключей от инвалидов

- `AzureKeyVaultKeyDisabledMessage`
- **Объяснение**: Операция не может быть завершена на сервере, так как ключ ключ Азура Отключительного Ключа отключен.

#### <a name="missing-key-vault-permissions"></a>Отсутствующие разрешения хранилища ключей

- `AzureKeyVaultMissingPermissionsMessage`
- **Объяснение**: Сервер не имеет необходимых разрешений Get, Wrap и Unwrap в Хранилище ключей Azure. Предоставь любые недостающие разрешения директору службы с помощью id.

### <a name="mitigation"></a>Меры по снижению риска

- Подтвердите, что ключ, управляемый клиентом, присутствует в хранилище ключей.
- Определите хранилище ключей и перейдите к нему на портале Azure.
- Убедитесь, что ключ URI идентифицирует присутствуют ключ.

## <a name="next-steps"></a>Дальнейшие действия

[Используйте портал Azure для настройки шифрования данных с помощью ключа, управляемого клиентом, в базе данных Azure для PostgreS'L](howto-data-encryption-portal.md)
