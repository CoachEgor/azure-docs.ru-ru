---
title: Активная аутентификация каталогов - База данных Azure для PostgreS-L - Единый сервер
description: Узнайте о концепциях активного каталога Azure для проверки подлинности с помощью базы данных Azure для PostgreS-L - Единый сервер
author: lfittl
ms.author: lufittl
ms.service: postgresql
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: ec853657d6dd1f3b019d8a414cfa28edc1083b29
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74769920"
---
# <a name="use-azure-active-directory-for-authenticating-with-postgresql"></a>Используйте активный каталог Azure для проверки подлинности с помощью PostgreS'L

Microsoft Azure Active Directory (Azure AD) является механизмом подключения к базе данных Azure для PostgreS'L с использованием идентификаторов, определенных в Azure AD.
С помощью проверки подлинности Azure AD можно управлять учетными данных пользователей баз данных и другими службами Майкрософт в центральном месте, что упрощает управление разрешениями.

> [!IMPORTANT]
> Проверка аутентификации Azure AD для базы данных Azure для PostgreS'L в настоящее время находится в открытом доступе.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Преимущества использования Azure AD включают:

- Проверка подлинности пользователей в службах Azure единым образом
- Управление политиками паролей и вращение паролей в одном месте
- Несколько форм проверки подлинности, поддерживаемых Active Directory Azure, которые могут устранить необходимость хранения паролей
- клиенты могут управлять разрешениями базы данных с помощью внешних групп (Azure AD);
- Аутентификация Azure AD использует роли базы данных PostgreS'L для проверки идентификации идентификационных данных на уровне базы данных
- Поддержка аутентификации на основе токенов для приложений, подключающихся к базе данных Azure для PostgreS'L

Для настройки и использования аутентификации Active Directory Azure используйте следующий процесс:

1. Создавайте и заполняйте Active Directory Azure с помощью идентификаторов пользователей по мере необходимости.
2. Дополнительно связать или изменить Active Directory, в настоящее время связанный с подпиской Azure.
3. Создайте администратор Azure AD для базы данных Azure для сервера PostgreS-L.
4. Создавайте пользователей баз данных в базе данных, отображаемые с идентификаторами Azure AD.
5. Подключитесь к базе данных, извозив маркер для идентификации Azure AD и войдя в систему.

> [!NOTE]
> Чтобы узнать, как создавать и заполнять Azure AD, а затем настроить Azure AD с базой данных Azure для PostgreS'L, [см.](howto-configure-sign-in-aad-authentication.md)

## <a name="architecture"></a>Architecture

Следующая диаграмма высокого уровня обобщает, как работает аутентификация с использованием аутентификации Azure AD с базой данных Azure для PostgreS'L. Стрелки обозначают пути обмена данными.

![поток аутентификации][1]

## <a name="administrator-structure"></a>Структура администраторов

При использовании аутентификации Azure AD для сервера PostgreS'L имеются две учетные записи администратора; первоначальный администратор PostgreS'L и администратор Azure AD. Создать в пользовательской базе данных первого пользователя автономной базы данных Azure AD может только администратор с учетной записью Azure AD. Администратор Azure AD может использовать для входа имя пользователя Azure AD или имя группы Azure AD. Когда администратор является групповой учетной записью, она может быть использована любым членом группы, что позволяет нескольким администраторам Azure AD для сервера PostgreS'L. Использование групповой учетной записи в качестве администратора повышает управляемость, позволяя вам централизованно добавлять и удалять членов группы в Azure AD без изменения пользователей или разрешений на сервере PostgreS'L. За один раз можно настроить только одного администратора Azure AD (пользователя или группу).

![структура администраторов][2]

## <a name="permissions"></a>Разрешения

Для создания новых пользователей, которые могут аутентифицировать `azure_ad_admin` с помощью Azure AD, необходимо иметь роль в базе данных. Эта роль назначается путем настройки учетной записи Администратора Azure AD для определенной базы данных Azure для сервера PostgreS-L.

Для создания нового пользователя базы данных Azure AD необходимо подключиться к администратору Azure AD. Это демонстрируется в [Configure и Login с Azure AD для базы данных Azure для PostgreS'L.](howto-configure-sign-in-aad-authentication.md)

Любая аутентификация Azure AD возможна только в том случае, если админ AD Azure был создан для базы данных Azure для PostgreS'L. Если администратор Azure Active Directory был удален с сервера, существующие пользователи Active Directory Azure, созданные ранее, больше не могут подключаться к базе данных, используя свои учетные данные Active Directory Azure.

## <a name="connecting-using-azure-ad-identities"></a>Подключение с использованием удостоверений Azure AD

Проверка подлинности Azure Active Directory поддерживает следующие способы подключения к базе данных с помощью удостоверений Azure AD:

- Пароль Azure Active Directory.
- Встроенная служба Azure Active Directory.
- Универсальная служба Azure Active Directory с поддержкой MFA.
- Использование сертификатов приложения Active Directory или секретов клиента

После проверки подлинности в отношении Active Directory вы получаете токен. Этот маркер является вашим паролем для входа в систему.

> [!NOTE]
> Для получения более подробной информации о том, как подключиться к маркеру Active Directory, [см. Нафотось и вопийте с Azure AD для базы данных Azure для PostgreS'L.](howto-configure-sign-in-aad-authentication.md)

## <a name="additional-considerations"></a>Дополнительные сведения

- Для повышения управляемости рекомендуем подготовить специальную группу Azure AD от имени администратора.
- Только один администратор Azure AD (пользователь или группа) может быть настроен для базы данных Azure для сервера PostgreS'L в любое время.
- Только администратор Azure AD для PostgreS'L может первоначально подключиться к базе данных Azure для PostgreS'L с помощью учетной записи Active Directory Azure. Затем администратор Active Directory может настроить других пользователей базы данных Azure AD.
- Если пользователь удален из Azure AD, этот пользователь больше не сможет проверить подлинность с помощью Azure AD, и поэтому получить токен доступа для этого пользователя больше не будет. В этом случае, хотя роль сопоставления все еще будет находиться в базе данных, подключиться к серверу с этой ролью будет невозможно.
> [!NOTE]
> Войти с удаленным пользователем Azure AD можно сделать до истечения срока действия маркера (до 60 минут с момента выдачи токенов).  Если вы также удалите пользователя из базы данных Azure для PostgreS'L, этот доступ будет немедленно отменен.
- Если администратор Azure Ad удален с сервера, сервер больше не будет связан с арендатором Azure AD, и поэтому все логи на сервер Azure AD будут отключены для сервера. Добавление нового админа Azure AD от того же арендатора позволит подчинить входы Azure AD.
- База данных Azure для PostgreS'L сопоставляет токены доступа к базе данных Azure для роли PostgreS'L с использованием уникального идентификатора пользователя Azure AD, в отличие от использования имени пользователя. Это означает, что если пользователь Azure AD удален в Azure AD, а новый пользователь, созданный с тем же именем, База данных Azure для PostgreS'L считает, что другой пользователь. Таким образом, если пользователь удален из Azure AD, а затем добавлен новый пользователь с тем же именем, новый пользователь не сможет подключиться к существующей роли. Для этого azure Database для админа PostgreS'L Azure AD должна отозвать, а затем предоставить пользователю роль "azure_ad_user" для обновления идентификатора пользователя Azure AD.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы узнать, как создавать и заполнять Azure AD, а затем настроить Azure AD с базой данных Azure для PostgreS'L, [см.](howto-configure-sign-in-aad-authentication.md)
- Для просмотра ролей логинов, пользователей и баз данных базы данных Azure Database для PostgreS'L [см. Создать пользователей в базе данных Azure для PostgreS-L - Один сервер.](howto-create-users.md)

<!--Image references-->

[1]: ./media/concepts-aad-authentication/authentication-flow.png
[2]: ./media/concepts-aad-authentication/admin-structure.png
