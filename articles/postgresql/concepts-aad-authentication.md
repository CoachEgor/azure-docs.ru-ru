---
title: Проверка подлинности Active Directory — база данных Azure для PostgreSQL — один сервер
description: Сведения о концепциях Azure Active Directory для проверки подлинности с помощью базы данных Azure для PostgreSQL-Single Server
author: lfittl
ms.author: lufittl
ms.service: postgresql
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: ec853657d6dd1f3b019d8a414cfa28edc1083b29
ms.sourcegitcommit: 6bb98654e97d213c549b23ebb161bda4468a1997
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2019
ms.locfileid: "74769920"
---
# <a name="use-azure-active-directory-for-authenticating-with-postgresql"></a>Использование Azure Active Directory для проверки подлинности с помощью PostgreSQL

Проверка подлинности Microsoft Azure Active Directory (Azure AD) — это механизм подключения к базе данных Azure для PostgreSQL с использованием удостоверений, определенных в Azure AD.
С помощью аутентификации Azure AD вы можете управлять удостоверениями пользователей базы данных и другими службами Майкрософт в централизованном расположении, что упрощает управление разрешениями.

> [!IMPORTANT]
> Аутентификация Azure AD для базы данных Azure для PostgreSQL в настоящее время доступна в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены.
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Ниже перечислены преимущества использования Azure AD.

- Единообразная проверка подлинности пользователей в службах Azure
- Управление политиками паролей и сменой паролей в одном месте
- Azure Active Directory поддерживает несколько форм проверки подлинности, что может избавиться от необходимости хранить пароли.
- клиенты могут управлять разрешениями базы данных с помощью внешних групп (Azure AD);
- Аутентификация Azure AD использует роли базы данных PostgreSQL для проверки подлинности удостоверений на уровне базы данных.
- Поддержка проверки подлинности на основе маркеров для приложений, подключающихся к базе данных Azure для PostgreSQL

Чтобы настроить и использовать проверку подлинности Azure Active Directory, используйте следующую процедуру.

1. При необходимости создайте и заполните Azure Active Directory удостоверениями пользователей.
2. При необходимости свяжите или измените Active Directory, которые в настоящее время связаны с подпиской Azure.
3. Создайте администратора Azure AD для сервера базы данных Azure для PostgreSQL.
4. Создание пользователей базы данных в базе данных, сопоставленной с удостоверениями Azure AD.
5. Подключитесь к базе данных, извлекая маркер для удостоверения Azure AD и войдя в систему.

> [!NOTE]
> Сведения о создании и заполнении Azure AD, а также настройке Azure AD с помощью базы данных Azure для PostgreSQL см. в статье [Настройка и вход в Azure AD для базы данных Azure для PostgreSQL](howto-configure-sign-in-aad-authentication.md).

## <a name="architecture"></a>Архитектура

На следующей высокоуровневой схеме показано, как работает аутентификация с помощью аутентификации Azure AD и базы данных Azure для PostgreSQL. Стрелки обозначают пути обмена данными.

![Поток проверки подлинности][1]

## <a name="administrator-structure"></a>Структура администраторов

При использовании аутентификации Azure AD существует две учетные записи администратора для сервера PostgreSQL. исходный администратор PostgreSQL и администратор Azure AD. Создать в пользовательской базе данных первого пользователя автономной базы данных Azure AD может только администратор с учетной записью Azure AD. Администратор Azure AD может использовать для входа имя пользователя Azure AD или имя группы Azure AD. Если администратор является учетной записью группы, он может использоваться любым членом группы, что позволяет нескольким администраторам Azure AD для сервера PostgreSQL. Использование учетной записи группы в качестве администратора повышает управляемость, позволяя централизованно добавлять и удалять членов группы в Azure AD без изменения пользователей или разрешений на сервере PostgreSQL. За один раз можно настроить только одного администратора Azure AD (пользователя или группу).

![структура администраторов][2]

## <a name="permissions"></a>Разрешения

Чтобы создать новых пользователей, которые могут проходить проверку подлинности в Azure AD, необходимо иметь роль `azure_ad_admin` в базе данных. Эта роль назначается путем настройки учетной записи администратора Azure AD для конкретного сервера базы данных Azure для PostgreSQL.

Чтобы создать нового пользователя базы данных Azure AD, необходимо подключиться к администратору Azure AD. Это продемонстрировано в этой [настройке и входе в Azure AD для базы данных Azure для PostgreSQL](howto-configure-sign-in-aad-authentication.md).

Проверка подлинности Azure AD возможна только в том случае, если администратор Azure AD создан для базы данных Azure для PostgreSQL. Если администратор Azure Active Directory был удален с сервера, уже созданные ранее пользователи Azure Active Directory не смогут подключаться к базе данных с помощью учетных данных Azure Active Directory.

## <a name="connecting-using-azure-ad-identities"></a>Подключение с использованием удостоверений Azure AD

Проверка подлинности Azure Active Directory поддерживает следующие способы подключения к базе данных с помощью удостоверений Azure AD:

- Пароль Azure Active Directory.
- Встроенная служба Azure Active Directory.
- Универсальная служба Azure Active Directory с поддержкой MFA.
- Использование Active Directory сертификатов приложений или секретов клиента

После проверки подлинности в Active Directory вы получаете маркер. Этот маркер является вашим паролем для входа в систему.

> [!NOTE]
> Дополнительные сведения о подключении с помощью токена Active Directory см. в статье [Настройка и вход с помощью Azure AD для базы данных Azure для PostgreSQL](howto-configure-sign-in-aad-authentication.md).

## <a name="additional-considerations"></a>Дополнительные замечания

- Для повышения управляемости рекомендуем подготовить специальную группу Azure AD от имени администратора.
- Только один администратор Azure AD (пользователь или группа) можно настроить для сервера базы данных Azure для PostgreSQL в любое время.
- Только администратор Azure AD для PostgreSQL может сначала подключиться к базе данных Azure для PostgreSQL с помощью учетной записи Azure Active Directory. Затем администратор Active Directory может настроить других пользователей базы данных Azure AD.
- Если пользователь удален из Azure AD, он больше не сможет пройти проверку подлинности в Azure AD, поэтому получить маркер доступа для этого пользователя будет невозможно. В этом случае, несмотря на то, что роль сопоставления по-прежнему будет находиться в базе данных, подключиться к серверу с этой ролью будет невозможно.
> [!NOTE]
> Вход с удаленным пользователем Azure AD по-прежнему может быть выполнен до истечения срока действия маркера (до 60 минут от выдачи маркера).  Если вы также удалите пользователя из базы данных Azure для PostgreSQL, этот доступ будет отозван немедленно.
- Если администратор Azure AD удален с сервера, сервер больше не будет связан с клиентом Azure AD, поэтому все имена входа Azure AD будут отключены для сервера. Добавление нового администратора Azure AD из того же клиента приведет к повторному включению имен входа Azure AD.
- База данных Azure для PostgreSQL сопоставляет маркеры доступа с ролью базы данных Azure для PostgreSQL, используя уникальный идентификатор пользователя Azure AD, а не имя пользователя. Это означает, что при удалении пользователя Azure AD в Azure AD и создании нового пользователя с тем же именем база данных Azure для PostgreSQL считает, что другой пользователь. Таким образом, если пользователь удаляется из Azure AD, а затем добавляется новый пользователь с тем же именем, новый пользователь не сможет подключиться к существующей роли. Чтобы это сделать, база данных Azure для PostgreSQL администратор Azure AD должна отозвать, а затем предоставить пользователю роль "azure_ad_user", чтобы обновить идентификатор пользователя Azure AD.

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о создании и заполнении Azure AD, а также настройке Azure AD с помощью базы данных Azure для PostgreSQL см. в статье [Настройка и вход в Azure AD для базы данных Azure для PostgreSQL](howto-configure-sign-in-aad-authentication.md).
- Общие сведения о именах входа, пользователях и ролях базы данных Azure для PostgreSQL см. [в статье Создание пользователей в базе данных Azure для PostgreSQL-Single Server](howto-create-users.md).

<!--Image references-->

[1]: ./media/concepts-aad-authentication/authentication-flow.png
[2]: ./media/concepts-aad-authentication/admin-structure.png
