---
title: Резервное копирование и восстановление - База данных Azure для PostgreS'L - Единый сервер
description: Узнайте об автоматическом резервном копировании и восстановлении базы данных Azure для сервера PostgreS-L - Single Server.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 02/25/2020
ms.openlocfilehash: 3e6dfd5882e49ad903e8cff6f0ec7f3d6bd4a8b7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77619622"
---
# <a name="backup-and-restore-in-azure-database-for-postgresql---single-server"></a>Резервное копирование и восстановление в базе данных Azure для PostgreS'L - Единый сервер

Служба "База данных Azure для PostgreSQL" автоматически создает резервные копии для сервера и сохраняет их в локальном избыточном или геоизбыточном хранилище, настроенном пользователем. Резервные копии можно использовать для восстановления сервера до точки во времени. Резервное копирование и восстановление данных являются важной частью любой стратегии непрерывности бизнес-процессов. Таким образом данные защищаются от случайного повреждения или удаления.

## <a name="backups"></a>Резервные копии

База данных Azure для PostgreS'L принимает резервные копии файлов данных и журнал транзакций. В зависимости от поддерживаемого максимального размера хранилища мы либо берем полные и дифференциальные резервные копии (4 сервера хранения с максимальным объемом хранения ТБ), либо резервные копии моментального снимка (до 16 серверов хранения максимального объема ТБ). При помощи этих резервных копий вы можете восстановить сервер до любой точки во времени в пределах заданного срока хранения резервных копий. По умолчанию срок хранения резервных копий составляет 7 дней. При необходимости вы увеличить его вплоть до 35 дней. Все резервные копии шифруются с помощью 256-битового шифрования AES.

Эти файлы резервного копирования не могут быть экспортированы. Резервные копирования могут использоваться только для восстановления операций в базе данных Azure для PostgreS'L. Вы можете использовать [pg_dump](howto-migrate-using-dump-and-restore.md) для копирования базы данных.

### <a name="backup-frequency"></a>Частота резервного копирования

Как правило, полное резервное копирование происходит еженедельно, дифференциальные резервные копии происходят два раза в день для серверов с максимально поддерживаемым хранением 4 ТБ. Резервное копирование моментальных снимков выполняется по крайней мере один раз в день для серверов, которые поддерживают до 16 ТБ хранилища. Создание резервных копий журналов транзакций в обоих случаях происходят каждые 5 минут. Первый моментальный снимок полного резервного копирования запланирован сразу после создания сервера. Первоначальная полная резервная часть может занять больше времени на большом восстановленном сервере. Самая ранняя точка во времени, до которой можно восстановить новый сервер, — это время, в которое завершилось создание полной резервной копии. Поскольку моментальные снимки являются мгновенными, серверы с поддержкой до 16 ТБ хранения могут быть восстановлены вплоть до времени создания.

### <a name="backup-redundancy-options"></a>Типы избыточности для резервного копирования

В службе "База данных Azure для PostgreSQL" вы можете выбрать локально избыточное или геоизбыточное хранилище резервных копий в ценовой категории "Общего назначения" или "С оптимизацией для операций в памяти". Резервные копии в геоизбыточном хранилище не только хранятся в регионе, где размещен сервер, но и реплицируются в [связанный центр обработки данных](https://docs.microsoft.com/azure/best-practices-availability-paired-regions). Благодаря этому сервер лучше защищен и его можно восстановить в другом регионе в случае аварии. На уровне "Базовый" предоставляется только локально избыточное хранилище резервных копий.

> [!IMPORTANT]
> Хранилище резервных копий (локально избыточное или геоизбыточное) можно настроить только на этапе создания сервера. После подготовки сервера невозможно изменить тип избыточности для хранилища резервных копий.

### <a name="backup-storage-cost"></a>Стоимость хранилищ резервных копий

В службе "База данных Azure для PostgreSQL" бесплатно предоставляется хранилище для резервных копий размером до 100 % объема подготовленного хранилища базы данных. Как правило, это подходит для срока хранения резервных копий, составляющего 7 дней. За дополнительный объем хранилища резервных копий взимается плата (за ГБ за месяц).

Например, если вы подготовили сервер размером 250 ГБ, вам будет предоставлено бесплатное хранилище резервных копий объемом 250 ГБ. За хранилище объемом более 250 ГБ будет взиматься плата.

## <a name="restore"></a>Восстановить

В службе "База данных Azure для PostgreSQL" при восстановлении создается новый сервер из резервных копий исходного сервера.

Есть два типа восстановления:

- **Восстановление до точки во времени** доступно для любого типа избыточности резервного копирования. При таком восстановлении новый сервер создается в том же регионе, где расположен исходный сервер.
- **Географическое восстановление** доступно, если для сервера настроено геоизбыточное хранилище, и позволяет восстановить сервер в другом регионе.

Предполагаемое время восстановления будет зависеть от нескольких факторов, включая размер базы данных, размер журнала транзакций, пропускную способность сети и общее количество баз данных, восстанавливаемых в том же регионе и в то же время. Обычно время восстановления составляет менее 12 часов.

> [!IMPORTANT]
> Удаленные серверы **нельзя** восстановить. Если вы удалите сервер, все связанные с ним базы данных также будут удалены без возможности восстановления. Чтобы защитить ресурсы сервера после развертывания от случайного удаления или внесения непредвиденных изменений, администраторы могут использовать [блокировки управления](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-lock-resources).

### <a name="point-in-time-restore"></a>Восстановление на момент времени

Независимо от типа избыточности для резервного копирования, вы можете выполнить восстановление до любой точки во времени в пределах срока хранения резервной копии. Новый сервер создается в том же регионе Azure, где расположен исходный сервер, и с такими же конфигурацией ценовой категории, поколением вычислительных ресурсов, числом виртуальных ядер, размером хранилища, сроком хранения резервных копий и типом избыточности резервного копирования.

Восстановление до точки во времени подходит для большинства сценариев. Например, если пользователь случайно удалил данные, важные таблицы или базы данных либо если приложение в результате ошибки случайно перезаписало правильные данные неправильными.

Возможно, вам придется подождать, пока создастся резервная копия журналов транзакций, прежде чем выполнить восстановление до точки во времени в пределах последних пяти минут.

### <a name="geo-restore"></a>геовосстановлением;

Вы можете восстановить сервер в другом регионе Azure, где доступна служба, если вы настроили для сервера геоизбыточное хранилище. Серверы, поддерживающие до 4 ТБ хранилища, могут быть восстановлены в геопаревом регионе или в любом регионе, поддерживающем до 16 ТБ хранения. Для серверов, поддерживающих до 16 ТБ хранилища, георезервные данные могут быть восстановлены в любом регионе, поддерживающем 16 ТБ-серверов. Просмотрите [уровни ценообразования Azure Database для уровней ценообразования PostgeS'L](concepts-pricing-tiers.md) для списка поддерживаемых регионов.

Геовосстановление используется по умолчанию, когда сервер недоступен из-за аварии в регионе, в котором он размещен. Если из-за масштабной аварии в регионе приложение базы данных станет недоступным, сервер можно будет восстановить из геоизбыточных резервных копий на сервер в любом другом регионе. Между созданием резервной копии и ее репликацией в другом регионе может пройти некоторое время. Эта задержка может длиться до часа, поэтому в случае аварии возможна потеря данных за час или менее.

Во время геовосстановления можно изменить такие конфигурации сервера, как поколение вычислительных ресурсов, виртуальное ядро, срок хранения резервных копий и варианты избыточности для резервного копирования. Изменить ценовую категорию ("Базовый", "Общего назначения" или "С оптимизацией для операций в памяти") и объем хранилища нельзя.

### <a name="perform-post-restore-tasks"></a>Задачи после восстановления

После восстановления с помощью любого из механизмов восстановления необходимо выполнить следующие задачи, прежде чем данные и приложения станут доступными:

- Если новый сервер заменит исходный, перенаправьте клиенты и клиентские приложения на новый сервер.
- Убедитесь, что для подключения пользователей будут установлены соответствующие правила брандмауэра уровня сервера и VNet. Эти правила не копируются с исходного сервера.
- Убедитесь, что заданы соответствующие данные для входа и разрешений уровня базы данных.
- Настройте оповещения соответствующим образом.

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как восстановить с [помощью портала Azure](howto-restore-server-portal.md).
- Узнайте, как восстановить с [помощью Azure CLI.](howto-restore-server-cli.md)
- Дополнительные сведения о непрерывности бизнес-процессов см. в  [этой статье](concepts-business-continuity.md).
