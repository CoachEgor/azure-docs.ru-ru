---
title: Распределенные данные - Hyperscale (Citus) - База данных Azure для PostgreS'L
description: Узнайте о распределенных таблицах, справочных таблицах, локальных таблицах и осколках в базе данных Azure для PostgreS'L.
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: ade7632dc042741a07bdb59e34e30b3fb464e0e9
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79243657"
---
# <a name="distributed-data-in-azure-database-for-postgresql--hyperscale-citus"></a>Распределенные данные в базе данных Azure для PostgreS'L - Hyperscale (Citus)

В этой статье описаны три типа таблиц в базе данных Azure для PostgreS'L - Hyperscale (Citus).
Он показывает, как распределенные таблицы хранятся в виде осколков, и как осколки помещаются на узлы.

## <a name="table-types"></a>типы таблиц

В группе серверов Hyperscale (Citus) есть три типа таблиц, каждый из которых используется для различных целей.

### <a name="type-1-distributed-tables"></a>Тип 1: Распределенные таблицы

Первый тип, и наиболее распространенный, распределенные таблицы. Они, как представляется, являются обычными таблицами для инструкций S'L, но они горизонтально разделены между узлами рабочих. Это означает, что строки таблицы хранятся на разных узлах, в фрагментных таблицах, называемых осколками.

Hyperscale (Citus) выполняет не только заявления S'L, но и DDL по всему кластеру.
Изменение схемы каскадов распределенной таблицы для обновления всех осколок таблицы между работниками.

#### <a name="distribution-column"></a>Колонка распределения

Hyperscale (Citus) использует алгоритмические осколки для присвоения строк осколкам. Назначение определяется на основе значения столбца таблицы, называемого столбецом распределения. Администратор кластера должен обозначить этот столбец при распределении таблицы.
Правильный выбор важен для производительности и функциональности.

### <a name="type-2-reference-tables"></a>Тип 2: Справочные таблицы

Справочная таблица — это тип распределенной таблицы, все содержимое которого сконцентрировано в одном осколок. Осколок реплицируется на каждом работнике. Запросы на любой работник может получить доступ к справочной информации локально, без сети накладных расходов запрашивает строки из другого узла. Справочные таблицы не имеют столбца распределения, поскольку нет необходимости различать отдельные осколки в строке.

Справочные таблицы обычно малы и используются для хранения данных, имеющих отношение к запросам, работающим на любом узлах рабочего. Примером могут быть перечисленные значения, такие как статусы заказов или категории продуктов.

### <a name="type-3-local-tables"></a>Тип 3: Местные таблицы

При использовании Hyperscale (Citus) узл координатора, к который подключается, является обычной базой данных PostgreS'L. Вы можете создать обычные таблицы на координатора и выбрать не осколки их.

Хорошим кандидатом для локальных таблиц будут небольшие административные таблицы, которые не участвуют в запросах соединения. Примером может быть таблица пользователей для регистрации приложения и проверки подлинности.

## <a name="shards"></a>Осколки

В предыдущем разделе описывается, как распределенные таблицы хранятся в виде осколков на рабочих узлах. В этом разделе рассматриваются более технические детали.

Таблица `pg_dist_shard` метаданных координатора содержит строку для каждого осколок каждой распределенной таблицы в системе. Строка соответствует идентификатору осколка с рядом целых чихов в хэш-пространстве (shardminvalue, shardmaxvalue).

```sql
SELECT * from pg_dist_shard;
 logicalrelid  | shardid | shardstorage | shardminvalue | shardmaxvalue 
---------------+---------+--------------+---------------+---------------
 github_events |  102026 | t            | 268435456     | 402653183
 github_events |  102027 | t            | 402653184     | 536870911
 github_events |  102028 | t            | 536870912     | 671088639
 github_events |  102029 | t            | 671088640     | 805306367
 (4 rows)
```

Если узло координатора хочет определить, какой `github_events`осколок содержит ряд, он хэширует значение столбца распределения в строке. Затем узла проверяет,\'диапазон осколок может содержать хэшированную стоимость. Диапазоны определяются таким образом, что изображение функции хэша является их разрозненным соединением.

### <a name="shard-placements"></a>Осколок размещения

Предположим, что осколок 102027 связан с строкой, о котором идет речь. Строка читается или записываются в таблице, называемой `github_events_102027` в одном из рабочих. Какой работник? Это полностью определяется таблицами метаданных. Отображение осколка для работника известен как размещение осколка.

Узла координатора перезаписывает запросы на фрагменты, `github_events_102027` которые относятся к определенным таблицам, например, и запускает эти фрагменты на соответствующих работниках. Вот пример запроса, запущенного за кулисами, чтобы найти узла, держащего осколок ID 102027.

```sql
SELECT
    shardid,
    node.nodename,
    node.nodeport
FROM pg_dist_placement placement
JOIN pg_dist_node node
  ON placement.groupid = node.groupid
 AND node.noderole = 'primary'::noderole
WHERE shardid = 102027;
```

    ┌─────────┬───────────┬──────────┐
    │ shardid │ nodename  │ nodeport │
    ├─────────┼───────────┼──────────┤
    │  102027 │ localhost │     5433 │
    └─────────┴───────────┴──────────┘

## <a name="next-steps"></a>Дальнейшие действия
- Узнайте, как [выбрать столбец распределения](concepts-hyperscale-choose-distribution-column.md) для распределенных таблиц.
