---
title: Распределенные данные в базе данных Azure для PostgreSQL — Гипермасштабируемость (Citus) (Предварительная версия)
description: Таблицы и сегментов, распределенных в группе серверов.
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: 9020ee690d93a1b477471fac4a482a909fca5935
ms.sourcegitcommit: 0568c7aefd67185fd8e1400aed84c5af4f1597f9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65077340"
---
# <a name="distributed-data-in-azure-database-for-postgresql--hyperscale-citus-preview"></a>Распределенные данные в базе данных Azure для PostgreSQL — Гипермасштабируемость (Citus) (Предварительная версия)

В этой статье описаны типы три таблицы в Гипермасштабируемого (Citus).
Он показывает, как распределенные таблицы хранятся в виде сегментов и способ сегментах размещаются на узлах.

## <a name="table-types"></a>Типы таблиц

Существует три типа таблиц в группе серверов обработки, каждый из которых используются для разных целей.

### <a name="type-1-distributed-tables"></a>Тип 1: распределенные таблицы

Первый тип, а также чаще всего является *распределенных* таблиц. Они могут быть обычные таблицы в инструкции SQL, но горизонтали *секционированных* на рабочих узлах. Это означает, что строки таблицы хранятся на разных узлах, фрагмент таблицы, называемые *сегментов*.

Гипермасштабируемый работает не только SQL, но каскадным способом DDL-инструкций во всем кластере, поэтому изменение схемы распределенные таблицы для обновления таблицы сегментов между рабочими ролями.

#### <a name="distribution-column"></a>Столбец распределения

Гипермасштабируемый использует алгоритмического сегментирования для назначения строк к сегментам. Назначение выполняется в детерминированно зависимости от значения столбца таблицы, именем *столбец распределения.* Администратор кластера необходимо назначить этот столбец, когда распределение таблиц в хранилище.
Правильный выбор очень важна для производительности и функциональности.

### <a name="type-2-reference-tables"></a>Тип 2: ссылочные таблицы

Ссылочная таблица — это разновидность распределенной таблицы, в которых все содержимое концентрируются в пределах одного сегмента. Сегмент реплицируется в каждой рабочей роли, поэтому запросы на любой рабочей роли можно получить доступ к локально, справочные сведения без нагрузки на сеть запроса строки из другой узел. Ссылочные таблицы имеют не столбец распределения, так как нет необходимости для различения отдельных сегментах каждой строки.

Ссылочные таблицы обычно невелики и используются для хранения данных, которые важно учитывать запросы, выполняемые на любом узле рабочей роли. Например перечисление значений, таких как состояния заказов или категории продуктов.

### <a name="type-3-local-tables"></a>Тип 3: локальные таблицы

При использовании Гипермасштабируемого, узел-координатор при подключении к является обычной базой данных PostgreSQL. Можно создавать обычные таблицы на координатор и отказаться от сегментов их.

Хорошим кандидатом для локальных таблиц будет административные небольших таблиц, которые не участвуют в запросах join. Например пользователи таблица для проверки подлинности и входа для приложения.

## <a name="shards"></a>Сегменты

Выше описаны как распределенные таблицы хранятся в виде сегментов на рабочих узлах. В этом разделе возвращает более подробные технические сведения.

`pg_dist_shard` Таблица метаданных на координатор содержит по одной строке для каждого сегмента каждого распределенной таблицы в системе. Строка соответствует идентификатор сегмента с диапазоном целых чисел в пространстве хэш (shardminvalue, shardmaxvalue):

```sql
SELECT * from pg_dist_shard;
 logicalrelid  | shardid | shardstorage | shardminvalue | shardmaxvalue 
---------------+---------+--------------+---------------+---------------
 github_events |  102026 | t            | 268435456     | 402653183
 github_events |  102027 | t            | 402653184     | 536870911
 github_events |  102028 | t            | 536870912     | 671088639
 github_events |  102029 | t            | 671088640     | 805306367
 (4 rows)
```

Если узел-координатор хочет определить, какие сегменты содержат искомые строки `github_events`, она хэширует значение столбца распределения в строке и проверяет, какие сегменты\'s диапазон содержит хэшированное значение. (Диапазоны определяются таким образом, чтобы изображение хэш-функции их перекрытия объединение.)

### <a name="shard-placements"></a>Размещение сегментов

Предположим, что в отдельном сегменте 102027 связан с интересующей строки. Строка будет чтения или записи в таблицу с именем `github_events_102027` в одном из рабочих ролей. Какой рабочий процесс? Полностью определяется таблицы метаданных, и сопоставление сегментов для рабочего процесса известна как сегмент *размещения*.

Узел-координатор переписывает запросы на фрагменты, которые ссылаются на таблицы, определенного как `github_events_102027`, и выполняет эти фрагменты в соответствующих рабочих ролях. Ниже приведен пример запроса, выполняемых в фоновом режиме автоматически найти узел, содержащий идентификатор 102027 сегментов.

```sql
SELECT
    shardid,
    node.nodename,
    node.nodeport
FROM pg_dist_placement placement
JOIN pg_dist_node node
  ON placement.groupid = node.groupid
 AND node.noderole = 'primary'::noderole
WHERE shardid = 102027;
```

    ┌─────────┬───────────┬──────────┐
    │ shardid │ nodename  │ nodeport │
    ├─────────┼───────────┼──────────┤
    │  102027 │ localhost │     5433 │
    └─────────┴───────────┴──────────┘

## <a name="next-steps"></a>Дальнейшие действия
- Узнайте, как [Выбор столбца распределения,](concepts-hyperscale-choose-distribution-column.md) для распределенных таблиц
