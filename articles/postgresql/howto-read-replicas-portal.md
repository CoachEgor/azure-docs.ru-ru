---
title: Управление репликами чтения - Портал Azure - База данных Azure для PostgreS'L - Единый сервер
description: Узнайте, как управлять чтением реплик Базы данных Azure для PostgreS-L - Единый сервер с портала Azure.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 01/24/2020
ms.openlocfilehash: dd79618b8d9f016c92166edb9ecdb0bfb113947e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76768946"
---
# <a name="create-and-manage-read-replicas-in-azure-database-for-postgresql---single-server-from-the-azure-portal"></a>Создание и управление считывательными репликами в базе данных Azure для PostgreS-L - Единый сервер с портала Azure

В этой статье описано, как создавать реплики чтения и управлять ими в службе "База данных Azure для PostgreSQL" с помощью портала Azure. Дополнительные сведения о репликах чтения см. в [этой статье](concepts-read-replicas.md).


## <a name="prerequisites"></a>Предварительные требования
[Сервер службы "База данных Azure для PostgreSQL"](quickstart-create-server-database-portal.md) в качестве главного.

## <a name="prepare-the-master-server"></a>Подготовка главного сервера
Приведенные ниже действия позволяют подготовить главный сервер в ценовой категории "Общего назначения" или "Оптимизированная для операций в памяти". Мастер-сервер подготовлен для репликации, установив параметр azure.replication_support. При изменении параметра репликации требуется перезагрузка сервера для вхедого изменения. На портале Azure эти два шага инкапсулированы одной кнопкой **Enable Replication Support.**

1. На портале Azure выберите имеющийся сервер службы "База данных Azure для PostgreSQL", который будет главным.

2. На боковой панели сервера, под **SETTINGS,** выберите **Репликацию.**

> [!NOTE] 
> Если вы видите, что **поддержка "Отключить репликацию"** посеяла, настройки репликации уже установлены на сервере по умолчанию. Вы можете пропустить следующие шаги и пойти, чтобы создать реплику чтения. 

3. Выберите **поддержку включения репликации.** 

   ![Включить поддержку репликации](./media/howto-read-replicas-portal/enable-replication-support.png)

4. Подтвердите, что вы хотите включить поддержку репликации. Эта операция будет перезапустить мастер-сервер. 

   ![Подтверждение поддержки репликации](./media/howto-read-replicas-portal/confirm-enable-replication.png)
   
5. Вы получите два уведомления портала Azure после завершения операции. Существует одно уведомление для обновления параметра сервера. Существует еще одно уведомление для перезагрузки сервера, которое следует немедленно.

   ![Уведомления об успехе - включить](./media/howto-read-replicas-portal/success-notifications-enable.png)

6. Обновите страницу портала Azure для обновления панели инструментов репликации. Теперь можно создавать считываемые реплики для этого сервера.

   ![Обновленная панель инструментов](./media/howto-read-replicas-portal/updated-toolbar.png)
   
Включение поддержки репликации — это одноразовая операция на главном сервере. Для вашего удобства предусмотрена **кнопка поддержки «Отключить репликацию».** Мы не рекомендуем отключать поддержку репликации, если вы не уверены, что никогда не создадите реплику на этом главном сервере. Вы не можете отключить поддержку репликации, в то время как на вашем главном сервере есть существующие реплики.


## <a name="create-a-read-replica"></a>Создание реплики чтения
Чтобы создать реплику чтения, выполните следующие действия:

1. Выберите имеющийся сервер службы "База данных Azure для PostgreSQL", который будет использоваться в качестве главного. 

2. На боковой панели сервера, под **SETTINGS,** выберите **Репликацию.**

3. Выберите **Добавить реплику**.

   ![Добавление реплики](./media/howto-read-replicas-portal/add-replica.png)

4. Введите имя реплики чтения. 

    ![Присвоение имени реплике](./media/howto-read-replicas-portal/name-replica.png)

5. Выберите место для реплики. Местоположение по умолчанию такое же, как и у главного сервера.

    ![Выберите расположение](./media/howto-read-replicas-portal/location-replica.png)

   > [!NOTE]
   > Чтобы узнать больше о том, в каких регионах можно создать копию, посетите [статью о концепциях ремиссий.](concepts-read-replicas.md) 

6. Нажмите кнопку **ОК**, чтобы подтвердить создание реплики.

Реплика создается с помощью тех же параметров вычислений и хранения, что и мастер. После создания реплики вы можете независимо от главного сервера изменять следующие ее параметры: поколение вычислительных ресурсов, число виртуальных ядер, объем хранилища и период хранения резервных копий. Изменить также можно ценовую категорию (за исключением уровня "Базовый").

> [!IMPORTANT]
> Перед обновлением настройки сервера до нового значения обновите настройку реплики до равного или большего значения. Это действие помогает реплике идти в ногу с любыми изменениями, внесенными в мастер.

Созданную реплику чтения можно просмотреть в окне **Репликация**:

![Просмотр новой реплики в окне "Репликация"](./media/howto-read-replicas-portal/list-replica.png)
 

## <a name="stop-replication"></a>Остановка репликации
Вы можете остановить репликацию между главным сервером и репликой чтения.

> [!IMPORTANT]
> Остановленную репликацию отменить невозможно. Реплика чтения становится отдельным сервером, который поддерживает операции чтения и записи. Это сервер нельзя снова преобразовать в реплику.

Чтобы остановить репликацию между главным сервером и репликой чтения на портале Azure, выполните следующие действия:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите сервер-реплику, на котором нужно остановить репликацию.

   ![Выбор реплики](./media/howto-read-replicas-portal/select-replica.png)
 
4. Выберите **Stop репликации.**

   ![Команда "Остановить репликацию"](./media/howto-read-replicas-portal/select-stop-replication.png)
 
5. Нажмите кнопку **ОК**, чтобы подтвердить остановку репликации.

   ![Подтверждение остановки репликации](./media/howto-read-replicas-portal/confirm-stop-replication.png)
 

## <a name="delete-a-master-server"></a>Удаление главного сервера
Чтобы удалить главный сервер, выполните те же действия, что и для отдельного сервера службы "База данных Azure для PostgreSQL". 

> [!IMPORTANT]
> При удалении главного сервера репликация всех реплик чтения останавливается. Реплики чтения становятся автономными серверами, которые начинают поддерживать операции чтения и записи.

Чтобы удалить сервер на портале Azure, сделайте следующе:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. Откройте страницу **Обзор** сервера. Выберите **Удалить**.

   ![Удаление главного сервера на странице "Обзор"](./media/howto-read-replicas-portal/delete-server.png)
 
3. Введите имя главного сервера, который нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление главного сервера.

   ![Подтверждение удаления главного сервера](./media/howto-read-replicas-portal/confirm-delete.png)
 

## <a name="delete-a-replica"></a>Удаление реплики
Чтобы удалить реплику чтения, выполните те же действия, что и для удаления главного сервера

- На портале Azure откройте страницу **Обзор** реплики чтения. Выберите **Удалить**.

   ![Удаление реплики на странице "Обзор"](./media/howto-read-replicas-portal/delete-replica.png)
 
Кроме того, реплику можно удалить из окна **Репликация**, выполнив следующие действия:

1. На портале Azure выберите главный сервер Базы данных Azure для PostgreSQL.

2. В меню сервера в разделе **Параметры** выберите **Репликация**.

3. Выберите реплику чтения, которую нужно удалить.

   ![Выбор реплики, которую нужно удалить.](./media/howto-read-replicas-portal/select-replica.png)
 
4. Щелкните **Удалить реплику**.

   ![Выбор команды удаления реплики](./media/howto-read-replicas-portal/select-delete-replica.png)
 
5. Введите имя реплики, которую нужно удалить. Нажмите кнопку **Удалить**, чтобы подтвердить удаление реплики.

   ![Подтверждение удаления реплики](./media/howto-read-replicas-portal/confirm-delete-replica.png)
 

## <a name="monitor-a-replica"></a>Мониторинг реплики
Выполнять мониторинг реплик чтения можно на основе двух метрик.

### <a name="max-lag-across-replicas-metric"></a>Метрика Max Lag Across Replicas (Максимальная задержка между репликами)
Метрика **Max Lag Across Replicas** (Максимальная задержка между репликами) показывает задержку между главным сервером и репликой с наибольшей задержкой в байтах. 

1.  На портале Azure выберите главный сервер службы "База данных Azure для PostgreSQL".

2.  Выберите **метрики**. В окне **Метрики** выберите **Max Lag Across Replicas** (Максимальная задержка между репликами).

    ![Отслеживание максимальной задержки между репликами](./media/howto-read-replicas-portal/select-max-lag.png)
 
3.  Для параметра **агрегирования** установите значение **Макс.**


### <a name="replica-lag-metric"></a>Метрика Replica Lag (Задержка реплики)
Метрика **Replica Lag** (Задержка реплики) показывает время с момента последнего воспроизведения транзакций по реплике. Если на главном сервере не выполняются транзакции, метрика будет отображать соответствующее время задержки.

1. На портале Azure выберите реплику чтения службы "База данных Azure для PostgreSQL".

2. Выберите **метрики**. В окне **Метрики** выберите **Replica Lag** (Задержка реплики).

   ![Отслеживание задержки реплики](./media/howto-read-replicas-portal/select-replica-lag.png)
 
3. Для параметра **агрегирования** установите значение **Макс.** 
 
## <a name="next-steps"></a>Дальнейшие действия
* См. дополнительные сведения о [репликах чтения в Базе данных Azure для PostgreSQL](concepts-read-replicas.md).
* Узнайте, как [создавать и управлять ремиссией чтения в Azure CLI и REST API.](howto-read-replicas-cli.md)