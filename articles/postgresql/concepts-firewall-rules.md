---
title: Правила брандмауэра в базе данных Azure для PostgreSQL — один сервер
description: В этой статье описываются правила брандмауэра для базы данных Azure для PostgreSQL-Single Server.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 09/22/2019
ms.openlocfilehash: a48e9e2583afbde584987e5a1ac61da9734058d1
ms.sourcegitcommit: 8a717170b04df64bd1ddd521e899ac7749627350
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/23/2019
ms.locfileid: "71200133"
---
# <a name="firewall-rules-in-azure-database-for-postgresql---single-server"></a>Правила брандмауэра в базе данных Azure для PostgreSQL — один сервер
Брандмауэр сервера базы данных Azure для PostgreSQL предотвращает доступ к серверу базы данных, пока вы не укажете, какие компьютеры имеют разрешение. Брандмауэр предоставляет доступ к серверу на основе исходного IP-адреса каждого запроса.
Для настройки брандмауэра можно создать правила брандмауэра, которые указывают диапазон допустимых IP-адресов. Правила брандмауэра можно создавать на уровне сервера.

**Правила брандмауэра:** эти правила разрешают клиентам доступ ко всему серверу базы данных Azure для PostgreSQL, то есть ко всем базам данных на одном логическом сервере. Правила брандмауэра уровня сервера можно настроить на портале Azure или с помощью команд Azure CLI. Для создания правил брандмауэра уровня сервера необходимо быть владельцем или участником подписки.

## <a name="firewall-overview"></a>Общие сведения о брандмауэре
По умолчанию весь доступ к базам данных на сервере базы данных Azure для PostgreSQL блокируется брандмауэром. Чтобы использовать сервер с другого компьютера, сначала необходимо указать одно или несколько правил брандмауэра уровня сервера для обеспечения доступа к этому серверу. Используйте правила брандмауэра, чтобы определить разрешенные диапазоны IP-адресов из Интернета. Правила брандмауэра не повлияют на доступ к самому веб-сайту портала Azure.
Запросы на подключение из Интернета и Azure должны сначала обрабатываться брандмауэром и только потом достигать базы данных PostgreSQL, как показано на следующей схеме:

![Пример рабочего потока брандмауэра](media/concepts-firewall-rules/1-firewall-concept.png)

## <a name="connecting-from-the-internet"></a>Подключение через Интернет
Правила брандмауэра уровня сервера применяются ко всем базам данных на одном и том же сервере базы данных Azure для PostgreSQL. Если IP-адрес запроса находится в одном из диапазонов, указанных в правилах брандмауэра уровня сервера, подключение предоставляется.
Если IP-адрес запроса находится за пределами диапазонов, указанных в любом из правил брандмауэра уровня сервера, запрос на подключение отклоняется.
Например, если приложение подключается с помощью драйвера JDBC для PostgreSQL, то при попытке подключения может возникать эта ошибка, когда брандмауэр блокирует подключение:
> java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.postgresql.util.PSQLException: FATAL: no pg\_hba.conf entry for host "123.45.67.890", user "adminuser", database "postgresql", SSL

## <a name="connecting-from-azure"></a>Подключение из Azure
Чтобы приложения из Azure могли подключаться к серверу Базы данных Azure для PostgreSQL, необходимо разрешить подключения Azure. Например, это необходимо для размещения веб-приложения Azure или приложения, которое выполняется на виртуальной машине Azure, либо для подключения из шлюза управления данными фабрики данных Azure. Чтобы разрешить эти подключения с помощью правила брандмауэра, ресурсы не обязательно должны находиться в одной и той же виртуальной сети или группе ресурсов. Когда приложение из Azure пытается подключиться к серверу базы данных, брандмауэр проверяет, разрешены ли подключения Azure. Такие подключения можно разрешить с помощью нескольких способов. Параметр брандмауэра с начальным и конечным адресом, равным 0.0.0.0, указывает, что эти подключения разрешены. Кроме того, в области **Безопасность подключения** на портале для параметра **Разрешить доступ к службам Azure** можно задать значение **Вкл.** , а затем нажать кнопку **Сохранить**. Если попытка подключения не разрешена, запрос не достигает сервера базы данных Azure для PostgreSQL.

> [!IMPORTANT]
> Этот параметр позволяет настроить брандмауэр так, чтобы разрешить все подключения из Azure, включая подключения из подписок других клиентов. При выборе этого параметра убедитесь, что используемое имя для входа и разрешения пользователя предоставляют доступ только авторизованным пользователям.
> 

![Настройка разрешения доступа к службам Azure на портале](media/concepts-firewall-rules/allow-azure-services.png)

## <a name="programmatically-managing-firewall-rules"></a>Программное управление правилами брандмауэра
Помимо портала Azure правилами брандмауэра можно управлять программно с помощью Azure CLI.
Ознакомьтесь также со статьей [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью Azure CLI](howto-manage-firewall-using-cli.md).

## <a name="troubleshooting-firewall-issues"></a>Устранение проблем с брандмауэром
Если доступ к службе сервера базы данных Microsoft Azure для PostgreSQL не работает должным образом, необходимо учитывать следующее:

* **Изменения в списке разрешенных адресов еще не вступили в силу** Изменения конфигурации брандмауэра сервера базы данных Azure для PostgreSQL могут вступить в силу в течение пяти минут.

* **Имя для входа не авторизовано или использован неправильный пароль** Если имя для входа не имеет разрешений на сервере базы данных Azure для PostgreSQL или введен неправильный пароль, то подключение к серверу базы данных Azure для PostgreSQL отклоняется. Создание параметра брандмауэра только предоставляет клиентам возможность подключения к серверу. Каждый клиент должен предоставить необходимые учетные данные безопасности.

   Например, при использовании клиента JDBC может возникать следующая ошибка:
   > java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.postgresql.util.PSQLException: FATAL: сбой проверки пароля для пользователя yourusername

* **Динамический IP-адрес** При наличии подключения к Интернету с динамическим предоставлением IP-адресов и возникновении проблем с прохождением через брандмауэр попробуйте одно из описанных ниже решений.

   * Попросите поставщика услуг Интернета (ISP) назначить диапазон IP-адресов тем клиентским компьютерам, с которых осуществляется доступ к серверу базы данных Azure для PostgreSQL, а затем добавьте диапазон IP-адресов в качестве правила брандмауэра.

   * Получите статические IP-адреса для клиентских компьютеров, а затем добавьте статические IP-адреса как правила брандмауэра.

* **IP-адрес сервера выглядит как общедоступный:** Подключения к серверу базы данных Azure для PostgreSQL направляются через общедоступный шлюз Azure. Однако фактический IP-адрес сервера защищен брандмауэром. Дополнительные сведения см. в [статье Архитектура подключения](concepts-connectivity-architecture.md). 

## <a name="next-steps"></a>Следующие шаги
Ниже перечислены статьи о создании правил брандмауэра уровня сервера и уровня базы данных.
* [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью портала Azure](howto-manage-firewall-using-portal.md)
* [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью Azure CLI](howto-manage-firewall-using-cli.md)
