---
title: Рекомендации по использованию хранилища запросов в базе данных Azure для PostgreSQL
description: В этой статье приводятся некоторые рекомендации по использованию хранилища запросов в базе данных Azure для PostgreSQL.
author: rachel-msft
ms.author: raagyema
ms.service: postgresql
ms.topic: conceptual
ms.date: 03/26/2018
ms.openlocfilehash: af68d5cdc891a8c924ca493d8e798edaa4670ab5
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60563179"
---
# <a name="best-practices-for-query-store"></a>Рекомендации по использованию хранилища запросов

**Область применения** База данных Azure для PostgreSQL 9.6 и 10

В этой статье приводятся рекомендации по использованию хранилища запросов в базе данных Azure для PostgreSQL.

## <a name="set-the-optimal-query-capture-mode"></a>Установка оптимального режима захвата запросов
Пусть хранилище запросов фиксирует данные, которые вам нужны. 

|**pg_qs.query_capture_mode** | **Сценарий**|
|---|---|
|_Все_  |Тщательный анализ рабочей нагрузки с учетом всех запросов, периодичности их выполнения и других статистических данных. Выявление новых запросов в рабочей нагрузке. Обнаружить, если нерегламентированные запросы используются для определения возможностей для пользовательской или автоматической параметризации. Режим _All_ предусматривает повышенные затраты на использование ресурсов. |
|_Top_  |Акцент на основные запросы — запросы, отправляемые клиентами.
|_None_ |Вы уже определили набор запросов и временное окно, которые вам нужно изучить, и не хотите отвлекаться на другие запросы. Режим _None_ подходит для сред тестирования и сопоставительного анализа. При выборе режима _None_ будьте осторожны, поскольку вы можете упустить возможность отследить и оптимизировать новые важные запросы. Восстановить данные за прошедшие периоды времени невозможно. |

Хранилище запросов включает также хранилище для статистики ожидания. Никакого дополнительного запроса режима захват для управления статистикой ожидания нет: параметру **pgms_wait_sampling.query_capture_mode** можно присвоить значение _none_ или _all_. 

> [!NOTE] 
> **pg_qs.query_capture_mode** заменяет **pgms_wait_sampling.query_capture_mode**. Если параметр pg_qs.query_capture_mode имеет значение _none_, pgms_wait_sampling.query_capture_mode не оказывает влияния. 


## <a name="keep-the-data-you-need"></a>Сохранение нужных данных
Параметр **Pg_qs.retention_period_in_days** определяет срок хранения данных ддя хранилища запросов в днях. Более старые запросы и статистические данные удаляются. По умолчанию данные в хранилище запросов хранятся в течение 7 дней. Не сохраняйте исторические данные, которые вы не планируете использовать. Увеличьте значение, если вам нужно хранить данные дольше.


## <a name="set-the-frequency-of-wait-stats-sampling"></a>Настройка периодичности для выборки статистики ожидания 
Параметр **pgms_wait_sampling.history_period** определяет периодичность для выборки событий ожидания (в миллисекундах). Чем меньше значение, тем чаще делается выборка. Вы получаете больше информации, но при этом и тратите больше ресурсов. Если нагрузка на сервер значительна или детализация вам не требуется, увеличьте период выборки.


## <a name="get-quick-insights-into-query-store"></a>Быстрый анализ хранилища запросов
Для быстрого анализа данных в хранилище запросов можно использовать функцию [анализа производительности запросов](concepts-query-performance-insight.md) на портале Azure. Визуализации показывают запросы с наибольшим временем выполнения и события максимального ожидания за период.

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о том, как получить или задать параметры с помощью [портала Azure](howto-configure-server-parameters-using-portal.md) или [Azure CLI](howto-configure-server-parameters-using-cli.md).