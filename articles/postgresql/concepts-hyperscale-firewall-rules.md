---
title: Правила брандмауэра - Hyperscale (Citus) - База данных Azure для PostgreS'L
description: В этой статье описаны правила брандмауэра для базы данных Azure для PostgreS-L - Hyperscale (Citus).
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.topic: conceptual
ms.date: 9/12/2019
ms.openlocfilehash: b843cd1528630a21255053f623356a0379daacf6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74975573"
---
# <a name="firewall-rules-in-azure-database-for-postgresql---hyperscale-citus"></a>Правила брандмауэра в базе данных Azure для PostgreS'L - Hyperscale (Citus)
База данных Azure для серверного брандмауэра PostgreS'L предотвращает доступ к вашему узелу координатора Hyperscale (Citus) до тех пор, пока вы не узнаете, какие компьютеры имеют разрешение. Брандмауэр предоставляет доступ к серверу на основе исходного IP-адреса каждого запроса.
Для настройки брандмауэра можно создать правила брандмауэра, которые указывают диапазон допустимых IP-адресов. Правила брандмауэра можно создавать на уровне сервера.

**Правила брандмауэра:** Эти правила позволяют клиентам получить доступ к вашему узлам координатора Hyperscale (Citus), то есть ко всем базам данных в одном логическом сервере. Правила брандмауэра уровня сервера можно настроить с помощью портала Azure. Для создания правил брандмауэра уровня сервера необходимо быть владельцем или участником подписки.

## <a name="firewall-overview"></a>Общие сведения о брандмауэре
Весь доступ к базе данных к узлам координатора блокируется брандмауэром по умолчанию. Чтобы использовать сервер с другого компьютера, сначала необходимо указать одно или несколько правил брандмауэра уровня сервера для обеспечения доступа к этому серверу. Используйте правила брандмауэра, чтобы определить разрешенные диапазоны IP-адресов из Интернета. Правила брандмауэра не повлияют на доступ к самому веб-сайту портала Azure.
Запросы на подключение из Интернета и Azure должны сначала обрабатываться брандмауэром и только потом достигать базы данных PostgreSQL, как показано на следующей схеме:

![Пример рабочего потока брандмауэра](media/concepts-hyperscale-firewall-rules/1-firewall-concept.png)

## <a name="connecting-from-the-internet-and-from-azure"></a>Подключение из Интернета и из Azure

Гипермасштабная (Citus) группа управления брандмауэром сервера, которая может подключиться к узлам координатора группы. Брандмауэр определяет доступ, консультируясь с настраиваемым списком правил. Каждое правило — это IP-адрес или диапазон адресов, в которых разрешено.

Когда брандмауэр блокирует соединения, это может привести к ошибкам приложения. Например, использование драйвера PostgreS'L JDBC приводит к такой ошибке:

> java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.postgresql.util.PS'LException: FATAL: no pg\_hba.conf entry for host "123.45.67.890", пользователь "citus", база данных "citus", SSL

Просмотрите [создание и управление правилами брандмауэра,](howto-hyperscale-manage-firewall-using-portal.md) чтобы узнать, как определяются правила.

## <a name="troubleshooting-the-database-server-firewall"></a>Устранение неполадок брандмауэра сервера базы данных
При доступе к базе данных Microsoft Azure для службы PostgreS-L - Hyperscale (Citus) ведет себя не так, как вы ожидаете, рассмотрим следующие моменты:

* **Изменения в списке разрешений еще не вступили** в силу: Возможно, потребуется пятиминутная задержка для встыковки изменений в конфигурацию брандмауэра Hyperscale (Citus).

* **Пользователь не авторизован или неверный пароль был использован:** Если у пользователя нет разрешений на сервере или используемый пароль неверен, подключение к серверу отказано. Создание параметра брандмауэра только предоставляет клиентам возможность подключения к серверу. Каждый клиент должен предоставить необходимые учетные данные безопасности.

Например, при использовании клиента JDBC может возникать следующая ошибка:
> java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.postgresql.util.PSQLException: FATAL: password authentication failed for user "yourusername"

* **Динамический IP-адрес:** при наличии подключения к Интернету с динамическим предоставлением IP-адресов и возникновении проблем с прохождением через брандмауэр попробуйте одно из описанных ниже решений.

* Запросите у поставщика услуг Интернета (ISP) диапазон IP-адресов, присвоенный компьютерам ваших клиентов, которые получают доступ к узлам координатора Hyperscale (Citus), а затем добавьте диапазон IP-адресов в качестве правила брандмауэра.

* Получите статические IP-адреса для клиентских компьютеров, а затем добавьте статические IP-адреса как правила брандмауэра.

## <a name="next-steps"></a>Дальнейшие действия
Ниже перечислены статьи о создании правил брандмауэра уровня сервера и уровня базы данных.
* [Создание правил брандмауэра базы данных Azure для PostgreSQL и управление ими с помощью портала Azure](howto-hyperscale-manage-firewall-using-portal.md)
