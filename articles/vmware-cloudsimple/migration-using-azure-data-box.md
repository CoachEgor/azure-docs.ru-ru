---
title: Решение VMware для Azure, Клаудсимпле миграцию с помощью Azure Data Box
description: Перенос данных в решение VMware для Azure с помощью Клаудсимпле Azure Data Box
author: sharaths-cs
ms.author: dikamath
ms.date: 09/27/2019
ms.topic: article
ms.service: azure-vmware-cloudsimple
ms.reviewer: cynthn
manager: dikamath
ms.openlocfilehash: 5f19b98fbbbad2f43227bfa2f73eab47bf7b1699
ms.sourcegitcommit: 80da36d4df7991628fd5a3df4b3aa92d55cc5ade
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2019
ms.locfileid: "71817466"
---
# <a name="migrating-data-to-azure-vmware-solution-by-cloudsimple-using-azure-data-box"></a>Перенос данных в решение VMware для Azure с помощью Клаудсимпле Azure Data Box

Облачное решение Microsoft Azure Data Box позволяет передавать терабайты данных в Azure быстрым, недорогим и надежным способом. Защищенное устройство хранения Azure Data Box обеспечивает безопасную передачу данных. Каждое устройство рассчитано на максимальный объем хранения 80 ТБ. Устройства поставляются в ваш центр обработки данных через регионального оператора. Прочный корпус защищает устройство и хранящиеся на нем данные во время передачи.

С помощью Azure Data Box можно перенести данные из большого объема данных VMware в частное облако.  Данные из локальной среды vSphere копируются в Data Box с помощью протокола NFS.  При переносе больших данных выполняется копирование копий виртуальных машин, конфигурации и связанных данных на момент времени в Data Box и их поставка в Azure.

В этой статье вы узнаете о следующих возможностях:

* Настройка Azure Data Box.
* Копирование данных из локальной среды VMware в Data Box с помощью NFS.
* Подготовка к возврату Azure Data Box.
* Подготовьте данные большого двоичного объекта для копирования в решение VMware для Azure с помощью Клаудсимпле.
* Копирование данных из Azure в частное облако.

## <a name="scenarios"></a>Сценарии

Azure Data Box следует использовать в следующих сценариях для выполнения групповой миграции данных.

* Перенос большого объема данных из локальной среды в решение VMware для Azure с помощью Клаудсимпле для использования в качестве базовой конфигурации и синхронизации в сети.
* Перенос большого объема выключенных виртуальных машин (холодных виртуальных машин).
* Перенос данных виртуальной машины для настройки сред разработки и тестирования.
* Перенос большого количества шаблонов виртуальных машин, ISO, дисков виртуальных машин.

## <a name="before-you-begin"></a>Перед началом работы

* Проверьте предварительные требования и [порядок Data Box](../databox/data-box-deploy-ordered.md) из портал Azure.  В процессе заказа необходимо выбрать учетную запись хранения, которая позволяет хранить BLOB-объекты.  Получив Data Box, подключите его к локальной сети и [настройте Data Box](../databox/data-box-deploy-set-up.md) с IP-адресом, доступным из сети управления vSphere.

* Создайте виртуальную сеть и учетную запись хранения в том же регионе Azure, в котором подготовлено решение VMware для Azure от Клаудсимпле.

* Создайте [подключение виртуальной сети Azure](cloudsimple-azure-network-connection.md) из частного облака к виртуальной сети, в которой создана учетная запись хранения, выполнив действия, описанные в статье [подключение виртуальной сети Azure к Клаудсимпле с помощью ExpressRoute](virtual-network-connection.md) .

## <a name="set-up-azure-data-box-for-nfs"></a>Настройка Azure Data Box для NFS

Подключитесь к локальному веб-ИНТЕРФЕЙСу Azure Data Box с помощью действий, упомянутых в разделе **Подключение к устройству** в статье [Tutorial: Кабель и подключитесь к Azure Data Box @ no__t-0.  Настройте Data Box, чтобы разрешить доступ клиентам NFS.

1. В локальном пользовательском веб-интерфейсе перейдите на страницу **Подключение и копирование**. В разделе **Параметры NFS** щелкните **Клиентский доступ NFS**. 

    ![Настройка клиентского доступа NFS 1](media/nfs-client-access.png)

2. Введите IP-адрес узлов VMware ESXi и нажмите кнопку **Добавить**. Вы можете настроить доступ для всех узлов в кластере vSphere, повторив этот шаг. Нажмите кнопку **ОК**.

    ![Настройка клиентского доступа NFS 2](media/nfs-client-access2.png)
> [!IMPORTANT]
> **Всегда создавайте отдельную папку для файлов, которые вы собираетесь скопировать в общую папку**. Папка, созданная в общих папках блочных и страничных BLOB-объектов, представляет собой контейнер, куда передаются данные в виде больших двоичных объектов. Вы не можете копировать файлы напрямую в *корневую* папку в учетной записи хранения.

В общих папках для блочных и страничных BLOB-объектов объектами первого уровня являются контейнеры, а второго — большие двоичные объекты. В общих папках для файлов Azure объекты первого уровня — общие папки, а объекты второго уровня — файлы.

В следующей таблице приведен UNC-путь к общим папкам в Data Box и URL-адрес службы хранилища Azure, куда отправляются данные. Конечный URL-адрес службы хранилища Azure может быть производным от UNC-пути к общей папке.
 
|                   |                                                            |
|-------------------|--------------------------------------------------------------------------------|
| Блочные BLOB-объекты Azure | <li>UNC-путь к общим папкам: `//<DeviceIPAddress>/<StorageAccountName_BlockBlob>/<ContainerName>/files/a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.blob.core.windows.net/<ContainerName>/files/a.txt`</li> |  
| Страничные BLOB-объекты Azure  | <li>UNC-путь к общим папкам: `//<DeviceIPAddres>/<StorageAccountName_PageBlob>/<ContainerName>/files/a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.blob.core.windows.net/<ContainerName>/files/a.txt`</li>   |  
| Файлы Azure       |<li>UNC-путь к общим папкам: `//<DeviceIPAddres>/<StorageAccountName_AzFile>/<ShareName>/files/a.txt`</li><li>URL-адрес службы хранилища Azure: `https://<StorageAccountName>.file.core.windows.net/<ShareName>/files/a.txt`</li>        |

> [!NOTE]
> Используйте блочные BLOB-объекты Azure для копирования данных VMware.

## <a name="mount-nfs-share-as-a-datastore-on-on-premises-vcenter-cluster-and-copy-data"></a>Подключение общего ресурса NFS к хранилищу данных в локальном кластере vCenter и его копирование

Общий ресурс NFS из Azure Data Box должен быть подключен как хранилище данных в локальном кластере vCenter или на VMware ESXi узле для копирования.  После подключения данные можно скопировать в хранилище данных NFS.

1. Войдите на локальный сервер vCenter.

2. Щелкните правой кнопкой мыши **центр обработки** **данных** , выберите пункт хранилище добавить щелкните **новое хранилище данных** и нажмите кнопку **Далее** .

   ![Добавить новое хранилище данных](media/databox-migration-add-datastore.png)

3. На шаге 1 мастера добавления хранилища данных выберите тип **NFS**.

   ![Добавить новое хранилище данных-тип](media/databox-migration-add-datastore-type.png)

4. На шаге 2 выберите **NFS 3** в качестве версии NFS и нажмите кнопку **Далее**.

   ![Добавление нового хранилища данных — версия NFS](media/databox-migration-add-datastore-nfs-version.png)

5. На шаге 3 укажите имя хранилища данных, путь и сервер.  Вы можете использовать IP-адрес Data Box для сервера.  Путь к папке будет иметь формат `/<StorageAccountName_BlockBlob>/<ContainerName>/`.

   ![Добавление нового хранилища данных — конфигурация NFS](media/databox-migration-add-datastore-nfs-configuration.png)

6. На шаге 4 Выберите узлы ESXi, в которых необходимо подключить хранилище данных, и нажмите кнопку **Далее**.  В кластере выберите все узлы, чтобы обеспечить миграцию виртуальных машин.

   ![Добавление нового хранилища данных — выбор узлов](media/databox-migration-add-datastore-nfs-select-hosts.png)

7. На шаге 5 Проверьте сводку и нажмите кнопку **Готово** .

## <a name="copy-data-to-data-box-nfs-datastore"></a>Копировать данные в хранилище данных Data Box NFS

Виртуальные машины можно перенести или клонировать в новое хранилище данных.  Все неиспользуемые виртуальные машины, которые необходимо перенести, можно перенести в хранилище данных Data Box NFS с помощью **хранилища VMotion**.  Активные виртуальные машины можно **клонировать** в хранилище данных Data Box NFS.

* Найдите список виртуальных машин, которые можно **переместить**.
* Укажите список виртуальных машин, которые должны быть **Клонированы**.

### <a name="move-virtual-machine-to-data-box-datastore"></a>Перемещение виртуальной машины в хранилище данных Data Box

1. Щелкните правой кнопкой мыши виртуальную машину, которую нужно переместить в Data Box хранилище данных, и выберите пункт **перенести**.

    ![Миграция виртуальной машины](media/databox-migration-vm-migrate.png)

2. Выберите **изменить хранилище только** для типа миграция и нажмите кнопку **Далее**.

    ![Миграция виртуальной машины — только хранилище](media/databox-migration-vm-migrate-change-storage.png)

3. Выберите Data Box хранилище данных в качестве места назначения и нажмите кнопку **Далее**.

    ![Миграция виртуальной машины — Выбор хранилища данных](media/databox-migration-vm-migrate-change-storage-select-datastore.png)

4. Проверьте сведения и нажмите кнопку **Готово**.

5. Повторите шаги 1 – 4 для других виртуальных машин.

> [!TIP]
> Можно выбрать несколько виртуальных машин в одном и том же состоянии электропитания (включен или выключен) и перенести их в набор.

Хранилище для виртуальной машины будет перенесено в хранилище данных NFS из Azure Data Box.  После переноса всех виртуальных машин можно завершить работу на виртуальных машинах при подготовке к переносу данных в решение VMware для Azure.

### <a name="clone-a-virtual-machine-or-a-virtual-machine-template-to-data-box-datastore"></a>Клонирование виртуальной машины или шаблона виртуальной машины для Data Box хранилища данных

1. Щелкните правой кнопкой мыши виртуальную машину или шаблон виртуальной машины, который необходимо клонировать.  Выбор **клонирования**, **клонирования в виртуальную машину**

    ![Клон виртуальной машины](media/databox-migration-vm-clone.png)

2. Выберите имя клонированной виртуальной машины или шаблона виртуальной машины.

3. Выберите папку, в которую нужно поместить клонированный объект, и нажмите кнопку **Далее**.

4. Выберите кластер или пул ресурсов, в котором нужно клонировать объект, и нажмите кнопку **Далее**.

5. Выберите хранилище данных Azure Data Box NFS в качестве места хранения и нажмите кнопку **Далее**.

    ![Клон виртуальной машины — выберите хранилище данных.](media/databox-migration-vm-clone-select-datastore.png)

6. Выберите параметры настройки, если требуется настроить параметры клонированного объекта, и нажмите кнопку **Далее**.

7. Проверьте конфигурации и нажмите кнопку **Готово**.

8. Повторите шаги 1 – 7 для дополнительных виртуальных машин или шаблонов виртуальных машин.

Виртуальные машины будут клонированы и сохранены в хранилище данных NFS из Azure Data Box.  После клонирования виртуальных машин убедитесь, что клонированные виртуальные машины выключены при подготовке к переносу данных в решение VMware для Azure.

### <a name="copy-iso-files-to-data-box-datastore"></a>Копирование ISO-файлов в хранилище данных Data Box

1. В локальном веб-ИНТЕРФЕЙСе vCenter перейдите в раздел **хранилище**.  Выберите Data Box хранилище данных NFS и щелкните **файлы**.  Создайте **новую папку** для хранения ISO-файлов.

    ![Копирование ISO-файла — создание новой папки](media/databox-migration-create-folder.png)

2. Укажите имя папки, в которой будут храниться файлы ISO.

3. Дважды щелкните только что созданную папку, чтобы получить доступ к содержимому.

4. Щелкните **upload Files (отправить файлы** ) и выберите ISO, которые нужно отправить.
    
    ![Копирование ISO-передача файлов](media/databox-migration-upload-iso.png)

> [!TIP]
> Если у вас уже есть ISO-файлы в локальном хранилище данных, можно выбрать файлы и **скопировать их в** хранилище данных Data Box NFS.


## <a name="prepare-azure-data-box-for-return"></a>Подготовка Azure Data Box к возврату

После того как все данные виртуальной машины, данные шаблона виртуальной машины и все ISO-файлы копируются в хранилище данных Data Box NFS, хранилище данных можно отключить от vCenter.  Прежде чем хранилище данных можно будет отключить, все виртуальные машины и шаблоны виртуальных машин необходимо удалить из инвентаризации.

### <a name="remove-objects-from-inventory"></a>Удаление объектов из инвентаризации

1. В локальном веб-ИНТЕРФЕЙСе vCenter перейдите в раздел **хранилище**.  Выберите Data Box хранилище данных NFS и щелкните **виртуальные машины**.

2. Убедитесь, что выключены все виртуальные машины.

    ![Удаление виртуальных машин из питания](media/databox-migration-select-databox-vm.png)

3. Выберите все виртуальные машины, щелкните правой кнопкой мыши и выберите **удалить из запасов**.

    ![Удаление виртуальных машин из инвентаризации](media/databox-migration-remove-vm-from-inventory.png)

4. Выберите **шаблоны виртуальных машин в папках** в верхней части кнопок и повторите шаг 3. 

### <a name="remove-azure-data-box-nfs-datastore-from-vcenter"></a>Удаление хранилища данных Azure Data Box NFS из vCenter

Перед началом подготовки к возврату хранилище данных NFS Data Box должно быть отключено от узлов VMware ESXi.

1. В локальном веб-ИНТЕРФЕЙСе vCenter перейдите в раздел **хранилище**.

2. Щелкните правой кнопкой мыши хранилище данных Data Box NFS и выберите **Отключить хранилище данных**.

    ![Отключение хранилища данных Data Box](media/databox-migration-unmount-datastore.png)

3. Выберите все узлы ESXi, на которых подключено хранилище данных, и нажмите кнопку **ОК**.

    ![Отключение Data Box хранилища данных — выбор узлов](media/databox-migration-unmount-datastore-select-hosts.png)

4. Проверьте и примите все предупреждения и нажмите кнопку **ОК**.

### <a name="prepare-data-box-for-return-and-return-the-data-box"></a>Подготовка Data Box к возврату и возврат Data Box

Выполните действия, описанные в статье [возврат Azure Data Box и проверьте передачу данных в Azure](../databox/data-box-deploy-picked-up.md) , чтобы получить Data Box.  Проверьте состояние копирования данных в учетную запись хранения Azure, после чего отобразится состояние "завершено". Вы можете проверить данные в учетной записи хранения Azure.

## <a name="copy-data-from-azure-storage-to-azure-vmware-solution-by-cloudsimple"></a>Копирование данных из службы хранилища Azure в решение VMware для Azure с помощью Клаудсимпле

Данные, скопированные в Azure Data Box, будут доступны в учетной записи хранения Azure после того, как состояние заказа Data Box будет отображаться как завершенное.  Теперь данные можно копировать в решение Azure VMware с помощью Клаудсимпле.  Данные в учетной записи хранения должны быть скопированы с помощью протокола NFS в хранилище данных vSAN частного облака.  Сначала скопируйте данные из хранилища больших двоичных объектов на управляемый диск в виртуальной машине Linux в Azure с помощью **AzCopy**.  Сделайте управляемый диск доступным по протоколу NFS и подключите общий ресурс NFS в качестве хранилища данных в частном облаке и скопируйте данные.  Этот метод позволяет ускорить копирование данных в частное облако. 

### <a name="copy-data-to-your-private-cloud-using-a-linux-virtual-machine-and-managed-disks-and-export-as-nfs-share"></a>Копирование данных в частное облако с помощью виртуальной машины Linux и управляемых дисков и экспорт в качестве общего ресурса NFS

1. Создайте [виртуальную машину Linux](../virtual-machines/linux/quick-create-portal.md) в Azure в том же регионе, где создана Ваша учетная запись хранения, и подключение к частному облаку с помощью виртуальной сети Azure.

2. Создайте управляемый диск, который больше, чем объем данных большого двоичного объекта, и [подключите его к виртуальной машине Linux](../virtual-machines/linux/attach-disk-portal.md).  Если объем данных большого двоичного объекта превышает наибольший доступный управляемый диск, данные необходимо скопировать в несколько шагов или с помощью нескольких управляемых дисков.

3. Подключитесь к виртуальной машине Linux и подключите управляемый диск.

4. Установите [AzCopy на виртуальной машине Linux](../storage/common/storage-use-azcopy-v10.md).

5. Скачайте данные из хранилища BLOB-объектов Azure на управляемый диск с помощью AzCopy.  Синтаксис команды: `azcopy copy "https://<storage-account-name>.blob.core.windows.net/<container-name>/*" "<local-directory-path>/"`.  Замените `<storage-account-name>` именем учетной записи хранения Azure и `<container-name>` на контейнер, содержащий данные, скопированные с помощью Azure Data Box.

6. Установите NFS Server на виртуальной машине Linux.

    1. В дистрибутиве Ubuntu/Debian: `sudo apt install nfs-kernel-server`.
    2. В дистрибутиве Enterprise Linux: `sudo yum install nfs-utils`.

7. Измените разрешения папки на управляемом диске, куда были скопированы данные из хранилища больших двоичных объектов Azure.  Измените разрешения для всех папок, которые требуется экспортировать как общий ресурс NFS.

    ```bash
    chmod -R 755 /<folder>/<subfolder>
    chown nfsnobody:nfsnobody /<folder>/<subfolder>
    ```

8. Назначьте разрешения для IP-адресов клиента для доступа к общему ресурсу NFS, изменив файл `/etc/exports`.

    ```bash
    sudo vi /etc/exports
    ```
    
    Введите следующие строки в файл для каждого IP-адреса узла ESXi частного облака.  При создании общих ресурсов для нескольких папок добавьте все папки.

    ```bash
    /<folder>/<subfolder> <ESXiNode1IP>(rw,sync,no_root_squash,no_subtree_check)
    /<folder>/<subfolder> <ESXiNode2IP>(rw,sync,no_root_squash,no_subtree_check)
    .
    .
    ```

9. Экспортируйте общие ресурсы NFS с помощью команды `sudo exportfs -a`.

10. Перезапустите сервер ядра NFS, выполнив команду `sudo systemctl restart nfs-kernel-server`.


### <a name="mount-linux-virtual-machine-nfs-share-as-a-datastore-on-private-cloud-vcenter-cluster-and-copy-data"></a>Подключение общего ресурса NFS виртуальной машины Linux в качестве хранилища данных в кластере vCenter с частным облаком и копирование

Общая папка NFS из виртуальной машины Linux должна быть подключена в качестве хранилища данных в кластере vCenter.  После подключения данные можно скопировать из хранилища данных NFS в хранилище данных частного облака vSAN.

1. Войдите на свой частный облачный сервер vCenter.

2. Щелкните правой кнопкой мыши **центр обработки** **данных** , выберите пункт хранилище добавить щелкните **новое хранилище данных** и нажмите кнопку **Далее** .

   ![Добавить новое хранилище данных](media/databox-migration-add-datastore.png)

3. На шаге 1 мастера добавления хранилища данных выберите тип **NFS**.

   ![Добавить новое хранилище данных-тип](media/databox-migration-add-datastore-type.png)

4. На шаге 2 выберите **NFS 3** в качестве версии NFS и нажмите кнопку **Далее**.

   ![Добавление нового хранилища данных — версия NFS](media/databox-migration-add-datastore-nfs-version.png)

5. На шаге 3 укажите имя хранилища данных, путь и сервер.  Вы можете использовать IP-адрес виртуальной машины Linux для сервера.  Путь к папке будет иметь формат `/<folder>/<subfolder>/`.

   ![Добавление нового хранилища данных — конфигурация NFS](media/databox-migration-add-datastore-nfs-configuration.png)

6. На шаге 4 Выберите узлы ESXi, в которых необходимо подключить хранилище данных, и нажмите кнопку **Далее**.  В кластере выберите все узлы, чтобы обеспечить миграцию виртуальных машин.

   ![Добавление нового хранилища данных — выбор узлов](media/databox-migration-add-datastore-nfs-select-hosts.png)

7. На шаге 5 Проверьте сводку и нажмите кнопку **Готово** .

### <a name="add-virtual-machines-and-virtual-machine-templates-from-nfs-datastore-to-the-inventory"></a>Добавление виртуальных машин и шаблонов виртуальных машин из хранилища данных NFS в инвентаризацию

1. Из веб-интерфейса частного облака vCenter перейдите в раздел **хранилище**.  Выберите хранилище данных NFS виртуальной машины Linux и щелкните **файлы**.

    ![Выбор файлов из хранилища данных NFS](media/databox-migration-datastore-select-files.png)

2. Выберите папку, которая содержит виртуальную машину или шаблон виртуальной машины.  В области сведений выберите файл `.vmx` для виртуальной машины или файл `.vmtx` для шаблона виртуальной машины.

3. Щелкните **Регистрация виртуальной** машины, чтобы зарегистрировать виртуальную машину в частном облаке vCenter.

    ![Зарегистрировать виртуальную машину](media/databox-migration-datastore-register-vm.png)

4. Выберите центр обработки данных, папку, кластер или пул ресурсов, в которых требуется зарегистрировать виртуальную машину.

4. Повторите шаги 3 и 4 для всех виртуальных машин и шаблонов виртуальных машин.

5. Перейдите в папку, содержащую ISO-файлы.  Выберите ISO-файлы и **скопируйте их в** папку в хранилище данных vSAN.

Виртуальные машины и шаблоны виртуальных машин теперь доступны в частном облаке vCenter.  Перед включением питания эти виртуальные машины необходимо переместить из хранилища данных NFS в хранилище данных vSAN.  Вы можете выполнить операцию vMotion хранилища виртуальных машин и выбрать vSAN хранилище данных в качестве целевого объекта для виртуальной машины.

Шаблоны виртуальных машин должны быть клонированы из хранилища данных NFS виртуальной машины Linux в хранилище данных vSAN.

### <a name="clean-up-of-your-linux-virtual-machine"></a>Очистка виртуальной машины Linux

После копирования всех данных в частное облако можно удалить хранилище данных NFS из частного облака.

1. Убедитесь, что все виртуальные машины и шаблоны перемещены и клонированы в хранилище данных vSAN.

2. Удалите из инвентаризации все шаблоны виртуальных машин из хранилища данных NFS.

3. Отключите хранилище данных виртуальной машины Linux от вашего частного облака vCenter.

4. Удалите виртуальную машину и управляемый диск из Azure.

5. Если вы не хотите хранить данные, передаваемые с помощью Azure Data Box, в учетной записи хранения, удалите учетную запись хранения Azure.  
    


## <a name="next-steps"></a>Следующие шаги

* Дополнительные сведения о [Azure Data Box](../databox/data-box-overview.md)
* Дополнительные сведения о различных вариантах [переноса рабочих нагрузок в частное облако](migrate-workloads.md)
