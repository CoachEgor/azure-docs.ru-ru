---
title: Решение Azure VMware от CloudSimple - Оптимизируйте облачное частное облако для Oracle RAC
description: Описывает, как развернуть новый кластер и оптимизировать VM для установки и конфигурации кластеров и конфигурации Oracle Real Application Clusters (RAC)
author: sharaths-cs
ms.author: b-shsury
ms.date: 08/06/2019
ms.topic: article
ms.service: azure-vmware-cloudsimple
ms.reviewer: cynthn
manager: dikamath
ms.openlocfilehash: b945beaa7497e1ad19315bacf1284dd0cbc24d6a
ms.sourcegitcommit: af1cbaaa4f0faa53f91fbde4d6009ffb7662f7eb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "81868075"
---
# <a name="optimize-your-cloudsimple-private-cloud-for-installing-oracle-rac"></a>Оптимизируйте облачное частное облако для установки Oracle RAC

В среде облачного облака CloudSimple Private Cloud можно развертывать кластеры oracle Real Application Clusters (RAC). В этом руководстве описывается, как развернуть новый кластер и оптимизировать VM для решения Oracle RAC. После выполнения шагов в этой теме можно установить и настроить Oracle RAC.

## <a name="storage-policy"></a>Политика хранения данных

Успешная реализация Oracle RAC требует достаточного количества узлов в кластере.  В политике хранения данных vSAN сбои в переносике (FTT) применяются к дискам данных, используемым для хранения данных, журналов и повторов.  Необходимое количество узлов для эффективного переноса сбоев составляет 2Н-1, где N является значением FTT.

Пример: Если желаемое FTT составляет 2, то общее количество узлов в кластере должно быть 2'2'1 и 5.

## <a name="overview-of-deployment"></a>Общие сведения о развертывании

В следующих разделах описывается, как настроить среду Облачного частного облака для Oracle RAC.

1. Рекомендации по конфигурации диска
2. Развертывание кластера CloudSimple Private Cloud vSphere
3. Настройка сети для Oracle RAC
4. Настройка политик хранения vSAN
5. Создание VMs Oracle и создание общих VM-дисков
6. Настройка правил сродства VM-to-host

## <a name="best-practices-for-disk-configuration"></a>Рекомендации по конфигурации диска

Виртуальные машины Oracle RAC имеют несколько дисков, которые используются для конкретной функции.  Общие диски установлены на всех виртуальных машинах, которые используются Oracle RAC Кластера.  Операционная система и диски установки программного обеспечения устанавливаются только на отдельные виртуальные машины.  

![Обзор виртуальных машинных дисков Oracle RAC](media/oracle-vm-disks-overview.png)

Ниже приводится пример, в примере используются диски, определенные в таблице ниже.

| Диск                                      | Назначение                                       | Общий диск |
|-------------------------------------------|-----------------------------------------------|-------------|
| OS                                        | Диск операционной системы                         | нет          |
| Сетки                                      | Установка местоположения для программного обеспечения Oracle Grid     | нет          |
| DATABASE                                  | Установка местоположения для программного обеспечения базы данных Oracle | нет          |
| ОРАДОМ                                   | Базовое местоположение для бинарных файлов базы данных Oracle    | нет          |
| DATA1, DATA2, DATA3, DATA4                | Диск, на котором хранятся файлы базы данных Oracle   | Да         |
| REDO1, REDO2, REDO3, REDO4, REDO5, REDO6  | Диски журнала Redo                                | Да         |
| OCR1, OCR2, OCR3, OCR4, OCR5              | Избирательные диски                                  | Да         |
| FRA1, FRA2                                | Диски области быстрого восстановления                      | Да         |

![Конфигурация виртуального машинного диска Oracle](media/oracle-vmdk.png)

### <a name="virtual-machine-configuration"></a>Конфигурация виртуальной машины

* Каждая виртуальная машина настроена с четырьмя контроллерами SCSI.
* Тип контроллера SCSI настроен на Paravirtual VMware.
* Создаются несколько виртуальных дисков (.vmdk).
* Диски устанавливаются на различные контроллеры SCSI.
* Тип обмена мультиписательным набором установлен для общих кластерных дисков.
* политика хранения vSAN определена для обеспечения высокой доступности дисков.

### <a name="operating-system-and-software-disk-configuration"></a>Конфигурация операционной системы и программного диска

Каждая виртуальная машина Oracle настроена с несколькими дисками для операционной системы хоста, своп, установки программного обеспечения и других функций ОС.  Эти диски не являются общими между виртуальными машинами.  

* Три диска для каждой виртуальной машины настроены как виртуальные диски и установлены на виртуальных машинах Oracle RAC.
    * Диск ОС
    * Диск для хранения Oracle Grid устанавливает файлы
    * Диск для хранения файлов базы данных Oracle
* Диски могут быть настроены как **тонкие provisioned**.
* Каждый диск устанавливается на первый контроллер SCSI (SCSI0).  
* Обмен набором **для не обмена**.
* Избыточность определяется на хранилище с использованием полисов vSAN.  

![Конфигурация группы дисков Oracle RAC](media/oracle-vm-os-disks.png)

### <a name="data-disk-configuration"></a>Конфигурация диска данных

Диски данных в основном используются для хранения файлов баз данных.  

* Четыре диска настроены как виртуальные диски и установлены на всех виртуальных машинах Oracle RAC.
* Каждый диск устанавливается на другой контроллер SCSI.
* Каждый виртуальный диск настроен как **Толстый Положение Стремясь нулевой**.  
* Обмен установлен на **Multi-писатель**.  
* Диски должны быть настроены как дисковая группа автоматического управления хранением данных (ASM).  
* Избыточность определяется на хранилище с использованием полисов vSAN.  
* Избыточность ASM устанавливается для **внешнего** резервирования.

![Конфигурация группы дисков Oracle RAC](media/oracle-vm-data-disks.png)

### <a name="redo-log-disk-configuration"></a>Конфигурация диска бревенчатого журнала Redo

Файлы журнала Redo используются для хранения копии изменений, внесенных в базу данных.  Файлы журнала используются, когда данные должны быть восстановлены после любых сбоев.

* Диски журнала Redo должны быть настроены как несколько групп дисков.  
* Шесть дисков создаются и устанавливаются на все виртуальные машины Oracle RAC.
* Диски устанавливаются на различные контроллеры SCSI
* Каждый виртуальный диск настроен как **Толстый Положение Стремясь нулевой**.
* Обмен установлен на **Multi-писатель**.  
* Диски должны быть настроены как две группы дисков ASM.
* Каждая группа дисков ASM содержит три диска, которые находятся на разных контроллерах SCSI.  
* Избыточность ASM настроена на **нормальную** избыточность.
* Пять файлов журнала redo создаются в обеих группах журнала ASM Redo

```
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 1 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
SQL > alter database add logfile thread 2 ('+ORCLRAC_REDO1','+ORCLRAC_REDO2') size 1G;
```

![Oracle RAC переделать конфигурацию диска журнала](media/oracle-vm-redo-log-disks.png)

### <a name="oracle-voting-disk-configuration"></a>Конфигурация избирательного диска Oracle

Избирательные диски обеспечивают функциональность диска кворума в качестве дополнительного канала связи, чтобы избежать любой ситуации с сплит-мозгом.

* Пять дисков создаются и устанавливаются на все виртуальные машины Oracle RAC.
* Диски устанавливаются на один контроллер SCSI
* Каждый виртуальный диск настроен как **Толстый Положение Стремясь нулевой**.
* Обмен установлен на **Multi-писатель**.  
* Диски должны быть настроены как группа дисков ASM.  
* Избыточность ASM настроена на **высокую** избыточность.

![Конфигурация дисковой группы голосования Oracle RAC RAC](media/oracle-vm-voting-disks.png)

### <a name="oracle-fast-recovery-area-disk-configuration-optional"></a>Конфигурация диска области быстрого восстановления Oracle (необязательно)

Область быстрого восстановления (FRA) — файловая система, управляемая дисковой группой Oracle ASM.  FRA предоставляет общее место хранения для файлов резервного копирования и восстановления. Oracle создает архивные журналы и журналы флэшбэков в области быстрого восстановления. Oracle Recovery Manager (RMAN) может дополнительно хранить резервные наборы и копии изображений в области быстрого восстановления, а также использует его при восстановлении файлов во время восстановления мультимедиа.

* Два диска создаются и устанавливаются на все виртуальные машины Oracle RAC.
* Диски устанавливаются на различные контроллеры SCSI
* Каждый виртуальный диск настроен как **Толстый Положение Стремясь нулевой**.
* Обмен установлен на **Multi-писатель**.  
* Диски должны быть настроены как группа дисков ASM.  
* Избыточность ASM устанавливается для **внешнего** резервирования.

![Конфигурация дисковой группы голосования Oracle RAC RAC](media/oracle-vm-fra-disks.png)

## <a name="deploy-cloudsimple-private-cloud-vsphere-cluster"></a>Развертывание кластера CloudSimple Private Cloud vSphere

Чтобы развернуть кластер vSphere в личном облаке, следуйте этому процессу:

1. С портала CloudSimple [создайте частное облако.](create-private-cloud.md) CloudSimple создает пользователя vCenter по умолчанию под названием «облачный владелец» в недавно созданном частном облаке. Подробнее о модели пользовательского частного облака по умолчанию и модели разрешений смотрите [в модели разрешения Private Cloud.](learn-private-cloud-permissions.md)  Этот шаг создает основной кластер управления для вашего частного облака.

2. С портала CloudSimple [расширьте частное облако](expand-private-cloud.md) с новым кластером.  Этот кластер будет использоваться для развертывания Oracle RAC.  Выберите количество узлов на основе желаемой допуска к ошибке (минимум три узла).

## <a name="set-up-networking-for-oracle-rac"></a>Настройка сетей для Oracle RAC

1. В вашем частном облаке [создайте два VLAN:](create-vlan-subnet.md)один для публичной сети Oracle и один для частной сети Oracle и назначьте соответствующие CIDRs подсети.
2. После создания VLANs создайте [распределенные группы портов в Private Cloud vCenter.](create-vlan-subnet.md#use-vlan-information-to-set-up-a-distributed-port-group-in-vsphere)
3. Навладийте [виртуальную машину сервера DHCP и DNS](dns-dhcp-setup.md) в вашем кластере управления для среды Oracle.
4. [Налаживание DNS-пересылки на сервере DNS,](on-premises-dns-setup.md#create-a-conditional-forwarder) установленном в частном облаке.

## <a name="set-up-vsan-storage-policies"></a>Настройка политик хранения vSAN

политики vSAN определяют сбои в переносительном и дисковом полоске для данных, хранящихся на дисках VM.  Созданная политика хранения должна применяться на дисках VM при создании VM.

1. [Войти на введомый клиент vSphere](https://docs.microsoft.com/azure/vmware-cloudsimple/vcenter-access) вашего частного облака.
2. Из верхнего меню выберите **Политики и профили.**
3. Из левого меню выберите **политики хранения VM,** а затем выберите **«Создайте политику хранения VM».**
4. Введите значимое имя для политики и нажмите **NEXT**.
5. В разделе **Структура политики** выберите **правила включить для хранения vSAN** и нажмите **NEXT**.
6. В разделе**доступность** **vSAN** > выберите **Нет** для допуска к стихийным бедствиям сайта. Для сбоев терпеть, выберите **RAID - Зеркальный** вариант для желаемого FTT.
    ![настройки](media/oracle-rac-storage-wizard-vsan.png)vSAN .
7. В разделе **Расширенный** выберите количество дисковых полос на объект. Для резервирования пространства объектов выберите **Thick Provisioned**. Выберите **проверку объекта отсражаемого.** Нажмите **NEXT**.
8. Следуйте инструкциям на экране, чтобы просмотреть список совместимых хранилики данных vSAN, просмотреть настройки и закончить настройку.

## <a name="create-oracle-vms-and-create-shared-vm-disks-for-oracle"></a>Создание VMs Oracle и создание общих VM-дисков для Oracle

Чтобы создать VM для Oracle, клонировать существующий VM или создать новый.  В этом разделе описывается, как создать новый VM, а затем клонировать его, чтобы создать второй после установки базовой операционной системы.  После создания VM можно создать дополнительные диски.  Кластер Oracle использует общие диски для хранения, данных, журналов и журналов повторов.

### <a name="create-vms"></a>Создание виртуальных машин

1. В vCenter щелкните **значок Хостов и кластеров.** Выберите кластер, созданный для Oracle.
2. Нажмите правой кнопкой кластера и выберите **новую виртуальную машину.**
3. Выберите **Создать новую виртуальную машину** и нажмите **кнопку Next**.
4. Назовите машину, выберите местоположение Oracle VM и нажмите **далее.**
5. Выберите кластерный ресурс и нажмите **далее**.
6. Выберите хранилище данных vSAN для кластера и нажмите **далее.**
7. Держите выбор совместимости esXi по умолчанию 6.5 и нажмите **далее.**
8. Выберите гостевую ОС ISO для VM, которую вы создаете, и нажмите **Далее.**
9. Выберите размер жесткого диска, который необходим для установки ОС.
10. Чтобы установить приложение на другом устройстве, нажмите **Добавить новое устройство.**
11. Выберите параметры сети и назначайте распределенную группу портов, созданную для общедоступной сети.
12. Чтобы добавить дополнительные сетевые интерфейсы, нажмите **Добавить новое устройство** и выберите распределенную группу портов, созданную для частной сети.
13. Для нового диска DC/DVD выберите файл ISO, содержащий ISO для предпочтительной установки операционной системы. Выберите файл, который вы ранее загрузили в папку IIOs и templates, и нажмите **OK.**
14. Просмотрите настройки и **нажмите OK,** чтобы создать новый VM.
15. Питание на ВМ. Установка операционной системы и любых необходимых обновлений

После установки операционной системы можно клонировать второй VM. Нажмите справа на ввод VM и выберите опцию и опцию клона.

### <a name="create-shared-disks-for-vms"></a>Создание общих дисков для vMs

Oracle использует общий диск для хранения файлов данных, журналов и повторов.  Вы можете создать общий диск на vCenter и смонтировать его на обоих ВМ.  Для повышения производительности поместите диски данных на различных контроллерах SCSI Steps ниже показать, как создать общий диск на vCenter, а затем прикрепить его к виртуальной машине. VCenter Flash клиент используется для изменения свойств VM.

#### <a name="create-disks-on-the-first-vm"></a>Создание дисков на первом VM

1. В vCenter, правой кнопкой мыши один из Oracle VMs и выберите **настройки edit**.
2. В новом разделе устройства выберите **контроллер SCSI** и нажмите **Добавить**.
3. В новом разделе устройства выберите **новый жесткий диск** и нажмите **Добавить**.
4. Расширьте свойства нового жесткого диска.
5. Укажите размер жесткого диска.
6. Укажите политику хранения VM как политику хранения vSAN, которую вы определили ранее.
7. Выберите местоположение в виде папки в хранилище данных vSAN. Расположение помогает при просмотре и присоединении дисков ко второму VM.
8. Для подготовки диска, выберите **Толстый положение стремятся обнулили**.
9. Для совместного использования укажите **Multi-writer**.
10. Для виртуального узла устройства выберите новый контроллер SCSI, который был создан в шаге 2.

    ![Создание дисков на первом VM](media/oracle-rac-new-hard-disk.png)

Повторите шаги 2 – 10 для всех новых дисков, необходимых для данных Oracle, журналов и файлов журналов повтора.

#### <a name="attach-disks-to-second-vm"></a>Прикрепите диски ко второму VM

1. В vCenter, правой кнопкой мыши один из Oracle VMs и выберите **настройки edit**.
2. В новом разделе устройства выберите **контроллер SCSI** и нажмите **Добавить**.
3. В новом разделе устройства выберите **Существующий жесткий диск** и нажмите **Добавить**.
4. Просмотрите место, где был создан диск для первого VM, и выберите файл VMDK.
5. Укажите политику хранения VM как политику хранения vSAN, которую вы определили ранее.
6. Для подготовки диска, выберите **Толстый положение стремятся обнулили**.
7. Для совместного использования укажите **Multi-writer**.
8. Для виртуального узла устройства выберите новый контроллер SCSI, который был создан в шаге 2.

    ![Создание дисков на первом VM](media/oracle-rac-existing-hard-disk.png)

Повторите шаги 2 - 7 для всех новых дисков, необходимых для данных Oracle, журналов и файлов журналов повтора.

## <a name="set-up-vm-host-affinity-rules"></a>Настройка правил сродства vM-хоста

Правила сродства VM-к-хосту гарантируют, что VM работает на нужном хосте.  Вы можете определить правила на vCenter, чтобы гарантировать, что Oracle VM работает на хосте с достаточными ресурсами и отвечает каким-либо конкретным требованиям лицензирования.

1. На портале CloudSimple [обостряются привилегии](escalate-private-cloud-privileges.md) пользователя облачного владельца.
2. [Войдите в клиент vSphere](https://docs.azure.cloudsimple.com/vsphere-access) вашего частного облака.
3. В клиенте vSphere выберите кластер, в котором развернуты VMs Oracle, и нажмите **на настройку.**
4. Под настройкой выберите **группы VM/Host.**
5. Нажмите кнопку **+**.
6. Добавьте группу VM. Выберите **группу VM** в качестве типа. Введите название группы. Выберите VMs, а затем нажмите **OK,** чтобы создать группу.
6. Добавьте группу хоста. Выберите **группу хоста** в качестве типа. Введите название группы. Выберите хосты, где будут работать vMs, а затем нажмите **OK,** чтобы создать группу.
7. Чтобы создать правило, нажмите на **правила VM/Host.**
8. Нажмите кнопку **+**.
9. Введите имя для правила и проверьте **Enable.**
10. Для типа правил выберите **виртуальные машины для размещения.**
11. Выберите группу VM, содержащую VMs Oracle.
12. Выберите **Обязательно работать на хостах в этой группе.**
13. Выберите созданную группу узла.
14. Нажмите **OK,** чтобы создать правило.

## <a name="references"></a>Ссылки

* [О политике vSAN](https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.virtualsan.doc/GUID-08911FD3-2462-4C1C-AE81-0D4DBC8F7990.html)
* [VMware Multi-Писатель Атрибут для общих VMDK](https://docs.vmware.com/en/VMware-Cloud-on-AWS/solutions/VMware-Cloud-on-AWS.df6735f8b729fee463802083d46fdc75/GUID-A7642A82B3D6C5F7806DB40A3F2766D9.html)
