---
title: Строка подключения к изображению Магазина изображений Azure Service Fabric
description: Узнайте о строке подключения к хранилику изображений, включая ее использование и приложения для кластера Service Fabric.
author: alexwun
ms.topic: conceptual
ms.date: 02/27/2018
ms.author: alexwun
ms.openlocfilehash: c3395248188c2a16736cfc8cea262fe163a6944b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75645673"
---
# <a name="understand-the-imagestoreconnectionstring-setting"></a>Общие сведения о параметре ImageStoreConnectionString

В некоторой документации мы упоминаем о существовании параметра ImageStoreConnectionString, не описывая его значение. И после прочтения такой статьи, как [Развертывание и удаление приложений с помощью PowerShell][10], создается обманчивое впечатление, что все, что нужно сделать, — скопировать и вставить значение, отображающееся в манифесте целевого кластера. Этот параметр должен настраиваться для каждого кластера, но при создании кластера с помощью [портала Azure][11] вы не можете его настроить, и он всегда имеет значение fabric:ImageStore. Для чего тогда нужен этот параметр?

![Манифест кластера][img_cm]

Изначально решение Service Fabric было разработано как платформа для внутреннего использования множеством различных групп, работающих в корпорации Майкрософт, поэтому некоторые ее аспекты имеют широкие возможности настройки. Одним из них является хранилище образов. По сути хранилище образов — это подключаемый репозиторий для хранения пакетов приложений. При развертывании приложения на узле в кластере этот узел скачивает содержимое пакета приложения из хранилища образов. ImageStoreConnectionString — это параметр, который содержит все необходимые сведения для клиентов и узлов, позволяющие найти правильное хранилище образов для заданного кластера.

В настоящее время существуют поставщики хранилища образов трех типов. Ниже приведены их строки подключения.

1. Служба хранилища образов: fabric:ImageStore

2. Файловая система: file:[путь_к_файловой_системе]

3. Служба хранилища Azure: "xstore:DefaultEndpointsProtocol=https;AccountName=[...];AccountKey=[...];Container=[...]"

В рабочей среде используется поставщик службы хранилища образов. Это сохраненная системная служба с отслеживанием состояния, которую можно просмотреть в Service Fabric Explorer. 

![Служба хранилища образов][img_is]

Размещение хранилища образов в системной службе внутри кластера избавляет от внешних зависимостей для репозитория пакетов и усиливает контроль над расположением хранилища. Будущие усовершенствования хранилища образов, скорее всего, в первую очередь затронут поставщик хранилища образов (возможно, и только его). Строка подключения для поставщика службы хранилища образов не содержит все уникальные сведения, так как клиент уже подключен к целевому кластеру. Клиент только должен знать, что следует использовать протоколы, нацеленные на системную службу.

Поставщик файловой системы используется вместо службы хранилища образов для локализированных кластеров, размещенных на локальных компьютерах, в период разработки, чтобы немного ускорить их начальную загрузку. Разница обычно невелика, но это полезная оптимизация для большинства разработчиков. Это позволяет также развернуть локализированный кластер на локальном компьютере, используя поставщики хранилища других типов, но обычно для этого нет причин, так как рабочий процесс разработки и тестирования не зависит от поставщика. Поставщик "служба хранилища Azure" существует только для поддержки старых кластеров, развернутых до появления поставщика "служба Secure Store".

Кроме того, ни поставщик "файловая система", ни поставщик "служба хранилища Azure" нельзя применять для совместного использования несколькими кластерами хранилища образов. Это приведет к повреждению данных конфигурации кластера, так как каждый кластер может записывать конфликтующие данные в хранилище образов. Для совместного использования подготовленных пакетов приложения несколькими кластерами используйте файлы [sfpkg][12], которые можно отправить в любое внешнее хранилище с помощью URI загрузки.

Поэтому несмотря на возможность настройки параметра ImageStoreConnectionString, обычно используется значение по умолчанию. При публикации в Azure с помощью Visual Studio этот параметр автоматически настраивается соответствующим образом. При программном развертывании в кластеры, размещенные в Azure, всегда используется строка подключения fabric:ImageStore. Но если вы сомневаетесь, ее значение всегда можно проверить, получив манифест кластера с помощью [PowerShell](https://docs.microsoft.com/powershell/module/servicefabric/get-servicefabricclustermanifest), [.NET](https://msdn.microsoft.com/library/azure/mt161375.aspx) или [REST](https://docs.microsoft.com/rest/api/servicefabric/get-a-cluster-manifest). Локальные тестовый кластер и рабочий кластер всегда должны использовать поставщик службы хранилища образов.

### <a name="next-steps"></a>Дальнейшие действия
[Развертывание и удаление приложений с помощью PowerShell][10]

<!--Image references-->
[img_is]: ./media/service-fabric-image-store-connection-string/image_store_service.png
[img_cm]: ./media/service-fabric-image-store-connection-string/cluster_manifest.png

[10]: service-fabric-deploy-remove-applications.md
[11]: service-fabric-cluster-creation-via-portal.md
[12]: service-fabric-package-apps.md#create-an-sfpkg
