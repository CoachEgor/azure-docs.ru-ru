---
title: Планирование кластерного развертывания azure Service Fabric
description: Узнайте о планировании и подготовке к развертыванию кластера службы Fabric в Azure.
ms.topic: conceptual
ms.date: 03/20/2019
ms.openlocfilehash: ad6a7a6ea9a90bea4a3b6bc553da67a46144dc03
ms.sourcegitcommit: 7581df526837b1484de136cf6ae1560c21bf7e73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80422283"
---
# <a name="plan-and-prepare-for-a-cluster-deployment"></a>Планирование и подготовка к развертыванию кластера

Планирование и подготовка к развертыванию производственного кластера очень важны.  Есть много факторов, чтобы рассмотреть.  В этой статье вы будете проходить по этапам подготовки развертывания кластера.

## <a name="read-the-best-practices-information"></a>Читать информацию о наилучшей практике
Для успешного управления приложениями и кластерами Azure Service Fabric существуют операции, которые мы настоятельно рекомендуем вам выполнить для оптимизации надежности производственной среды.  Для получения дополнительной информации прочитайте [приложение Service Fabric и лучшие практики кластера](service-fabric-best-practices-overview.md).

## <a name="select-the-os-for-the-cluster"></a>Выберите ОС для кластера
Service Fabric позволяет создавать кластеры Service Fabric на любых виртуальных машинах или компьютерах под управлением Windows Server или Linux.  Перед развертыванием кластера необходимо выбрать ОС: Windows или Linux.  Каждый уденный узла (виртуальная машина) в кластере работает одной и той же ОС, вы не можете смешивать Windows и Linux VMs в одном кластере.

## <a name="capacity-planning"></a>Планирование ресурсов
Для любой рабочей развернутой службы важным шагом является планирование загрузки. Вот несколько моментов, которые необходимо учесть:

* Начальное число типов узлов для кластера 
* Свойства каждого типа узла (размер, количество экземпляров, первичный, интернет облицовка, количество ВМ и т.д.)
* Надежность и устойчивость характеристик кластера.

### <a name="select-the-initial-number-of-node-types"></a>Выберите начальное число типов узлов
Во-первых, необходимо выяснить, для чего будет использоваться создаваемый кластер и какие виды приложений планируется в нем развернуть. Есть ли у вашего приложения несколько служб, среди которых есть службы, которые должны быть общедоступными или доступными из Интернета? У служб (составляющих приложение) различные требования к инфраструктуре, например больше ОЗУ или тактов центрального процессора? Кластер Service Fabric может состоять из нескольких типов узлов: типа первичного узла и одного или нескольких типов непервичных узлов. Каждый тип узла соответствует набору масштабирования виртуальных машин. Каждый тип узла поддерживает возможность независимого масштабирования, имеет разные наборы открытых портов и собственные метрики емкости. [Свойства узлов и ограничения размещения][placementconstraints] могут быть настроены для ограничения определенных служб определенными типами узлов.  Для получения дополнительной информации прочитайте количество типов узлов, с них [нужно начать с.](service-fabric-cluster-capacity.md#the-number-of-node-types-your-cluster-needs-to-start-out-with)

### <a name="select-node-properties-for-each-node-type"></a>Выберите свойства узлов для каждого типа узлов
Типы узлов определяют VM SKU, число и свойства VMs в связанном наборе шкалы.

Минимальный размер VMs для каждого типа узла определяется [уровнем прочности,][durability] который вы выбираете для типа узла.

Минимальное количество виртуальных машин для типа первичного узла зависит от выбранного [уровня надежности][reliability].

Ознакомьтесь с минимальными рекомендациями для [типов первичных узлов,](service-fabric-cluster-capacity.md#primary-node-type---capacity-guidance) [успокоительными рабочими нагрузками на непервичные типы узлов](service-fabric-cluster-capacity.md#non-primary-node-type---capacity-guidance-for-stateful-workloads)и [безабожными рабочими нагрузками на непервичные типы узлов.](service-fabric-cluster-capacity.md#non-primary-node-type---capacity-guidance-for-stateless-workloads)

Меньше минимального количества узлов должно основываться на количестве копий приложения/служб, которые вы хотите запустить в этом типе узла.  [Планирование емкости для приложений Service Fabric](service-fabric-capacity-planning.md) помогает оценить ресурсы, необходимые для запуска приложений. Позже можно масштабировать кластер вверх или вниз, чтобы настроить его для изменения рабочей нагрузки приложения. 

#### <a name="use-ephemeral-os-disks-for-virtual-machine-scale-sets"></a>Используйте эфемерные диски ОС для виртуальных наборов масштабов машин

*Эфемерные диски ОС* создаются на локальной виртуальной машине (VM) и не сохраняются в удаленном хранилище Azure. Они рекомендуются для всех типов узлов Service Fabric (первичных и вторичных), потому что по сравнению с традиционными стойкими дисками ОС, эфемерные диски ОС:

* Снижение задержки чтения/записи на дискЕ ОС
* Включить более быстрые операции управления узлами сбросить/переизобобиотки
* Снижение общих затрат (диски бесплатны и не несут дополнительных затрат на хранение)

Эфемерные диски ОС — это не специфическая функция Service Fabric, а скорее особенность *наборов виртуальной машины* Azure, которые отображаются на типах узлов Service Fabric. Для их использования с помощью Service Fabric требуется следующее в шаблоне управления ресурсами Azure:

1. Убедитесь, что типы узлов укажут [поддерживаемые размеры Azure VM](../virtual-machines/windows/ephemeral-os-disks.md) для дисков Ephemeral OS и что размер VM имеет достаточный размер кэша для поддержки размера диска ОС (см. *Примечание* ниже). Например:

    ```xml
    "vmNodeType1Size": {
        "type": "string",
        "defaultValue": "Standard_DS3_v2"
    ```

    > [!NOTE]
    > Не забудьте выбрать размер VM с размером кэша, равным или превышающим размер диска ОС в самом VM, в противном случае развертывание Azure может привести к ошибке (даже если оно первоначально принято).

2. Укажите виртуальную версию`vmssApiVersion`набора `2018-06-01` масштабов машины () или позже:

    ```xml
    "variables": {
        "vmssApiVersion": "2018-06-01",
    ```

3. В разделе набора виртуальной шкалы машины `Local` шаблона развертывания укажите опцию для: `diffDiskSettings`

    ```xml
    "apiVersion": "[variables('vmssApiVersion')]",
    "type": "Microsoft.Compute/virtualMachineScaleSets",
        "virtualMachineProfile": {
            "storageProfile": {
                "osDisk": {
                        "caching": "ReadOnly",
                        "createOption": "FromImage",
                        "diffDiskSettings": {
                            "option": "Local"
                        },
                }
            }
        }
    ```

> [!NOTE]
> Пользовательские приложения не должны иметь никакой зависимости/файла/артефакта на диске ОС, так как диск ОС будет потерян в случае обновления ОС.
> Следовательно, не рекомендуется использовать [PatchOrchestrationApplication](https://github.com/microsoft/Service-Fabric-POA) с эфемерными дисками.
>

> [!NOTE]
> Существующий неэфемерный VMSS не может быть обновлен на месте для использования эфемерных дисков.
> Чтобы мигрировать, пользователям придется [добавить](./virtual-machine-scale-set-scale-node-type-scale-out.md) новый уклад с эфемерными дисками, переместить рабочие нагрузки в новый узла, & [удалить](./service-fabric-how-to-remove-node-type.md) существующий узла.
>

Для получения дополнительной информации [Ephemeral OS disks for Azure VMs](../virtual-machines/windows/ephemeral-os-disks.md) и дальнейших вариантов конфигурации см. 


### <a name="select-the-durability-and-reliability-levels-for-the-cluster"></a>Выберите уровни долговечности и надежности кластера
Уровень устойчивости используется, чтобы указать системе привилегии, имеющиеся у виртуальных машин в базовой инфраструктуре Azure. Для типа первичного узла эта привилегия позволяет Service Fabric приостановить любой запрос инфраструктуры на уровне виртуальной машины (например, перезагрузку, переустановку из образа или перенос виртуальной машины), который влияет на требования к кворуму, установленные для системных служб и ваших служб с отслеживанием состояния. Для типов вторичных узлов эта привилегия позволяет Service Fabric приостановить любой запрос инфраструктуры на уровне виртуальной машины (например, перезагрузку, переустановку из образа и перенос виртуальной машины), который влияет на требования к кворуму, установленные для ваших служб с отслеживанием состояния.  Для преимуществ различных уровней и рекомендаций, на каком уровне использовать и когда, [см.][durability]

Уровень надежности используется для задания числа реплик системных служб, которые будут выполняться в этом кластере на первичных узлах. Чем больше реплик, тем надежнее системные службы в кластере.  Для преимуществ различных уровней и рекомендаций, на каком уровне использовать и когда, [см.][reliability] 

## <a name="enable-reverse-proxy-andor-dns"></a>Включить обратный прокси и/или DNS
Службы, которые подключаются друг к другу в рамках кластера, обычно могут напрямую обратиться к конечным точкам другой службы, так как узлы в кластере расположены в пределах одной локальной сети. Чтобы облегчить подключение между службами, Service Fabric предоставляет дополнительные услуги: [dNS-сервис](service-fabric-dnsservice.md) и [обратный прокси-сервис.](service-fabric-reverseproxy.md)  Обе службы могут быть включены при развертывании кластера.

Поскольку многие службы, особенно контейнеризированные службы, могут иметь существующее имя URL, возможность их решения с помощью стандартного протокола DNS (а не протокола службы именования) удобна, особенно в сценариях приложения "подъем и сдвиг". Именно это и делает служба DNS. Она позволяет сопоставить DNS-имена с именем службы и, следовательно, разрешить IP-адреса конечных точек.

Обратный прокси-адреса служб в кластере, которые разоблачают конечные точки HTTP (включая HTTPS). Обратный прокси значительно упрощает вызов других услуг, предоставляя определенный формат URI.  Обратный прокси также обрабатывает решения, подключения и повторной попытки, необходимые для одной службы для связи с другой.

## <a name="prepare-for-disaster-recovery"></a>Подготовка к аварийному восстановлению
Для обеспечения высокого уровня доступности крайне важно гарантировать продолжение работы всех типов служб при любых сбоях. Это особенно важно в ситуациях незапланированных сбоев, которые находятся вне вашего контроля. [Подготовка к аварийному восстановлению](service-fabric-disaster-recovery.md) описывает некоторые распространенные режимы сбоев, которые могут быть катастрофическими, если не смоделировать и управлять правильно. Он также обсуждает меры по смягчению последствий и действиям, которые необходимо принять в случае катастрофы в любом случае.

## <a name="production-readiness-checklist"></a>Контрольный список готовности рабочей среды
Готовы ли ваше приложение и кластер к приему рабочего трафика? Перед развертыванием кластера в производство проберитесь по [контрольному списку готовности производства.](service-fabric-production-readiness-checklist.md) Поддерживайте бесперебойную работу приложения и кластера, работая над элементами в этом контрольном списке. Мы настоятельно рекомендуем все эти элементы, которые будут проверены перед ввоком в производство.

## <a name="next-steps"></a>Следующие шаги
* [Создание кластера Service Fabric под управлением Windows](service-fabric-best-practices-overview.md)
* [Создание кластера Service Fabric под управлением Linux](service-fabric-tutorial-create-vnet-and-linux-cluster.md)

[placementconstraints]: service-fabric-cluster-resource-manager-cluster-description.md#node-properties-and-placement-constraints
[durability]: service-fabric-cluster-capacity.md#the-durability-characteristics-of-the-cluster
[reliability]: service-fabric-cluster-capacity.md#the-reliability-characteristics-of-the-cluster