---
title: Введение в микрослужбы в Azure | Документация Майкрософт
description: Общие сведения о том, почему создание облачных приложений с использованием микрослужб важно для разработки современных приложений и как платформа Azure Service Fabric позволяет достичь этой цели.
services: service-fabric
documentationcenter: .net
author: athinanthny
manager: chackdan
editor: ''
ms.assetid: fae2be85-0ab4-4cd3-9d1f-e0d95fe1959b
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/25/2019
ms.author: atsenthi
ms.openlocfilehash: feb82d2abb756d636aeb77042cc817b7b05f6b0c
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "65233651"
---
# <a name="why-a-microservices-approach-to-building-applications"></a>Разработка приложений с использованием микрослужб

Разработчики программного обеспечения думать о необходимым разбивать приложения на компоненты нет ничего нового. Как правило, многоуровневый подход предполагает наличие серверного хранилища, бизнес-логики среднего уровня и внешнего пользовательского интерфейса. За последние несколько лет *изменилось* только то, что разработчики стали создавать распределенные приложения для облака.

Некоторые бизнес-потребности быстро меняются. Они включают следующее.

* Служба, которая является ее Коллектив разработал и в нужном масштабе для взаимодействия с клиентами в новых географических регионах.
* ускоренное предоставление функций и возможностей для обеспечения гибкости реагирования на запросы клиентов;
* Более эффективное использование ресурсов, позволяющее снизить затраты.

Эти бизнес-потребности определяют *способ* сборки приложений.

Дополнительные сведения о применяющемся в Azure подходе к микрослужбам см. в блоге [Microservices: микрослужб для приложений на основе облака](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/).

## <a name="monolithic-vs-microservice-design-approach"></a>Подходы к разработке приложений: монолитные приложения и приложения, состоящие из микрослужб

По прошествии времени приложения развиваются. Успешные приложения развиваются за счет использования. Неудачные приложения не развиваются и в конечном счете устаревают. Возникает вопрос: Как много вы знаете о требования к уже сегодня и какими они будут в будущем? К примеру, предположим, что вы создаете приложение для составления отчетов для определенного подразделения. Это приложение будет применяться исключительно в рамках организации, а срок существования отчетов будет небольшим. В этом случае подход отличается от используемого, например, при создании службы для доставки видеоматериалов десяткам миллионов клиентов.

Иногда внедрение чего-либо на практике подтверждения концепции является решающим фактором, зная, что приложение может быть переработано позже. Но перерабатывать то, что никогда не используется, совсем нецелесообразно. С другой стороны, если компания планирует создание продукта для облака, ожидается, что такой продукт будет расширяться и использоваться. Проблема заключается в том, что расширение и масштаб достаточно сложно предсказать. Хотелось бы иметь возможность прототип быстро при этом также знать, что мы находимся в путь, который может обрабатывать будущему успеху. Подход, который применяют небольшие новые компании, включает сборку, измерение, анализ данных и повторение всего цикла.

В эпоху клиент-серверной архитектуры разработчики создавали многоуровневые приложения с использованием определенных технологий на каждом уровне. Потом для обозначения подобных подходов возник термин "*монолитные* приложения". Интерфейсы находились как бы между уровнями, а в рамках самого уровня компоненты были более тесно связаны. При разработке и разделении классы компилировались в библиотеки, а библиотеки объединялись в несколько исполняемых файлов и библиотек DLL.

Использование принципа монолитности при разработке приложений дает определенные преимущества. Зачастую такие приложения не требуют больших усилий при разработке, а вызовы между компонентами осуществляются быстрее благодаря механизму межпроцессного взаимодействия. Кроме того, все пользователи могут тестировать один продукт, за счет чего обеспечивается эффективное использование человеческих ресурсов. Недостаток этого подхода: тесная связь компонентов приложения в рамках уровней и невозможность масштабирования отдельных компонентов. Кроме того, при необходимости выполнения исправлений или обновлений нужно ждать, пока другие завершат тестирование. А это негативно сказывается на гибкости.

Микрослужбы позволяют устранить эти недостатки и добиться более точного соответствия ранее описанным бизнес-требованиям. Но они также обладают как преимуществами, так и недостатками. Преимущества микрослужб состоят в том, что обычно каждая из них включает в себя простые бизнес-функции, а также поддерживает возможность независимого вертикального масштабирования, тестирования, развертывания и управления. Одно из важных преимуществ микрослужб является то, что команды см. по бизнес-сценариев, чем на основе технологии. На практике небольшие команды разрабатывают микрослужбу на основе сценария клиента, используя при этом технологии на свой выбор.

Иными словами, организации не нужно стандартизировать технологии для поддержки своих приложений для микрослужб. Отдельные команды, владеющие службами, могут делать то, что они считают целесообразным, исходя из собственных знаний или подходящих действий для решения задачи. На практике предпочтительнее использовать набор рекомендуемых технологий, например при выборе конкретного хранилища NoSQL или платформы веб-приложений.

Недостаток микрослужб проявляется в управлении растущим количеством отдельных сущностей, работе с более сложными развертываниями и управлении версиями. Объем сетевого трафика между микрослужбами увеличивается, в результате чего возникают сетевые задержки. Большое количество избыточных "узкопрофильных" служб — прямой путь к катастрофическому снижению производительности. Отсутствие средств выявления этих зависимостей усложняет возможность обзора системы в целом.

Микрослужбы становятся полезными благодаря применению стандартов, а не контрактов, которым нужно неукоснительно следовать, т. е. составляются правила обмена данными и учитываются только те задачи, которые должна выполнять служба. Поэтому при разработке эти контракты нужно определить заранее, так как службы обновляются независимо друг от друга. При разработке приложений с использованием микрослужб выделяется еще одна характеристика — мелкомодульная сервисноориентированная архитектура (SOA).

***Фактически при разработке с использованием микрослужб применяются несвязанные федерации служб с возможностью независимых изменений каждой из них и согласованные стандарты для обмена данными.***

По мере создания дополнительных облачных приложений люди осознают, что такая декомпозиция всего приложения на отдельные службы, ориентированные на сценарии, — это оптимальный подход в долгосрочной перспективе.

## <a name="comparison-between-application-development-approaches"></a>Сравнение подходов к разработке приложений

![Разработка приложений на платформе Service Fabric][Image1]

1) Монолитные приложения обладают функциональными возможностями домена и обычно делятся на функциональные уровни, например сеть, бизнес-решения и данные.

2) Такие приложения масштабируются путем клонирования на нескольких серверах или виртуальных машинах либо в нескольких контейнерах.

3) В приложениях, состоящих из микрослужб, функциональные возможности распределены между отдельными службами меньшего размера.

4) Подход с использованием микрослужб дает возможность масштабировать приложения, развертывая каждую службу независимо от других и создавая экземпляры этих служб на разных серверах и виртуальных машинах и в разных контейнерах.

Использование микрослужб при разработке — не универсальный подход. Но он позволяет достичь более точного соответствия бизнес-целям, описанным выше. Применить монолитный подход можно, если известно, что позже у вас не будет возможности переработать код для внедрения микрослужб. Но чаще всего разработчики сначала создают монолитное приложение, а затем медленно и поэтапно разделяют его, начиная с функциональных областей, в которых следует увеличить масштабируемость и гибкость.

Подход с использованием микрослужб представляет собой сборку приложения из множества мелких служб. Эти службы работают в контейнерах, развернутых в кластере виртуальных машин. Небольшие команды разрабатывают службу, ориентированную на сценарии. При этом тестирование, управление версиями, развертывание и масштабирование выполняется для каждой службы отдельно, позволяя приложению развиваться как единое целое.

## <a name="what-is-a-microservice"></a>Что такое микрослужба

Существует много определений микрослужб. Однако большая часть следующие общие характеристики микрослужб широко являются допустимыми:

* Инкапсуляция сценария клиента или бизнес-сценария. Какую проблему требуется решить?
* Разработка небольшими командами разработчиков.
* Написание кода на любом языке программирования и использование любой платформы.
* Составляющие компоненты включают в себя код и при необходимости состояние, которые можно развертывать и масштабировать, а также управлять их версиями независимо друг от друга.
* Взаимодействие с другими микрослужбами с помощью четко определенных интерфейсов и протоколов.
* Наличие уникальных имен (URL-адресов), которые можно использовать для определения их расположения.
* Обеспечение стабильности работы и доступности в случае сбоя.

В разделе "Сводка" сделайте следующее.

***Приложения, состоящие из микрослужб, формируются из небольших ориентированных на клиента служб с независимым управлением версиями и масштабированием, которые взаимодействуют по стандартным протоколам с применением четко определенных интерфейсов.***

### <a name="written-in-any-programming-language-and-use-any-framework"></a>Написание кода на любом языке программирования и использование любой платформы

Разработчики могут выбирать язык или платформу в зависимости от своих навыков или потребностей службы. Для некоторых служб преимущества в отношении производительности, обеспечиваемые языком C++, могут иметь большее значение, чем все остальные. В других службах большую роль играет простота управляемой разработки на языке C# или Java. В некоторых случаях может потребоваться использовать определенные партнерские библиотеки, технологии хранения данных или средства предоставления службы клиентам.

После того как вы выбрали технологию, можно перейти к управлению процессами или жизненным циклом и ее масштабированию службы.

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>Возможность независимого управления версиями, развертывания и масштабирования кода и состояния

Независимо от способа написания микрослужб, код и при необходимости состояние следует независимо друг от друга развертывания, обновления и масштабирования. Эту проблему сложно решить, так как все сводится к выбору технологий. А для масштабирования все сводится к пониманию того, как секционировать (или сегментировать) код и состояние. Если в коде и состоянии используются разные технологии (а на сегодняшний день это обычная практика), в скриптах развертывания микрослужбы должна быть предусмотрена возможность масштабирования как кода, так и состояния. Кроме того, следует обеспечить гибкость и динамичность использования, позволяющие обновлять отдельные микрослужбы, а не все одновременно.

Ненадолго вернемся к сравнению двух подходов при разработке приложений. На следующей схеме показаны различия в подходах к хранению данных о состоянии.

#### <a name="state-storage-between-application-styles"></a>Различия в хранении данных о состоянии в двух подходах к разработке приложений

![Хранилище состояний платформы Service Fabric][Image2]

***Слева представлен монолитный подход с отдельной базой данных и уровнями определенных технологий.***

***Справа представлен подход с применением микрослужб. На рисунке изображена схема взаимосвязанных микрослужб, где состояние обычно ограничивается отдельной микрослужбой и используются различные технологии.***

Монолитное приложение, как правило, использует отдельную базу данных. Преимущество — единое расположение, что упрощает развертывание. У каждого компонента может быть одна таблица для хранения данных о состоянии. Сложность состоит в том, что командам разработчиков необходимо строго разграничивать состояния. Кроме того, обязательно появится соблазн добавить новый столбец в имеющуюся таблицу клиента, объединить таблицы и создать зависимости на уровне хранилища. Однако в таком случае будет невозможно масштабировать отдельные компоненты.

При подходе с использованием микрослужб каждая служба управляет собственным состоянием и хранит данные о нем. Каждая служба отвечает за масштабирование кода и состояния для обеспечения соответствия собственным требованиям. Недостаток такого подхода заключается в том, что вам нужно создавать представления данных приложения или запросы на их основе. Это обусловлено необходимостью отправлять запросы в несколько хранилищ состояний. Как правило, эту проблему можно решить, использовав отдельную микрослужбу, которая создает представление коллекции микрослужб. Если нужно выполнить несколько нерегламентированных запросов данных, в каждой микрослужбе должна предусматриваться возможность записи данных в службу хранилища данных для использования в автономной аналитике.

Версии микрослужб управляются, и разные версии микрослужбы могут выполняться параллельно. Более новая версия микрослужбы может давать сбой во время обновления. В таком случае необходимо выполнить откат до более ранней версии. Управление версиями также применяется при A/B-тестировании, при котором разные пользователи используют разные версии службы. Например, микрослужбы часто обновляют для определенной группы клиентов, которые тестируют новые функциональные возможности, прежде чем развертывать их для широкой аудитории.

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов

За последние 10 лет опубликована обширная литература по сервисноориентированной архитектуре, которая описывает шаблоны взаимодействия. Сейчас, как правило, для взаимодействия между службами используется REST, протоколы HTTP и TCP, а также формат сериализации XML или JSON. На уровне интерфейса используются средства веб-дизайна. Но вам ничего не мешает применять двоичные протоколы или собственные форматы данных. Будьте готовы, что в таком случае вашими микрослужбами (если эти протоколы и форматы не появятся в открытом доступе) будет сложнее пользоваться.

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>Уникальное имя (URL-адрес), используемое для распознавания расположения

Во время работы микрослужба должна быть адресуемой. Думать только о компьютерах и о том, на каком из них выполняется определенная микрослужба, — это заведомо неправильный подход.

Микрослужба должна иметь уникальное имя, позволяющее обнаружить ее расположение, подобно тому, как DNS разрешает URL-адрес для конкретного компьютера. Микрослужбам требуются адресуемые имена, которые делают их независимыми от инфраструктуры, в рамках которой они работают. Таким образом, необходимость в реестре службы предполагает определенную связь между развертыванием службы и ее обнаружением. При сбое компьютера служба реестра должна указывать, куда перемещена служба.

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>Стабильность работы и доступность в случае сбоя

Устранение неожиданных сбоев — одна из самых труднорешаемых задач, особенно в распределенной системе. Основная часть кода, который пишут разработчики, ориентирована на обработку исключений. Этому аспекту также уделяется большая часть времени при тестировании. Решение проблемы намного сложнее, чем просто написать код, позволяющий исправить ошибки. Что происходит при сбое компьютера, на котором запущена микрослужба? В такой ситуации вам нужно не только определить сбой (а это сама по себе непростая задача), но и перезапустить ее.

Для обеспечения доступности микрослужба должна быть устойчива к сбоям и в ней должна предусматриваться возможность перезапуска на другом компьютере. В дополнение к тому, что выполняемый код должен быть устойчивым, не должно быть потерь данных и данные должны оставаться согласованными.

Устойчивости трудно достичь при возникновении сбоев во время обновления приложения. Микрослужбе, работающей с системой развертывания, не требуется восстановление. Она должна определить, возможен ли переход к новой версии или нужно выполнить откат к предыдущей. Кроме того, следует учитывать такие моменты: достаточно ли компьютеров для последующего обновления и как восстановить предыдущие версии микрослужбы. Для принятия решений на основе ответов на эти вопросы требуется, чтобы микрослужба могла передавать информацию о состоянии.

### <a name="reports-health-and-diagnostics"></a>Передача информации о работоспособности и диагностических данных

Микрослужба должна передавать сведения о работоспособности и диагностические данные (хотя зачастую этому кажущемуся очевидным моменту уделяется недостаточно внимания). Иначе будет невозможно получить достаточно сведений о работоспособности и ходе процессов в микрослужбе. Сложность заключается не только в выявлении связи между диагностическими событиями для ряда независимых служб, но и в сопоставлении расхождений в показаниях часов компьютера для определения порядка событий. Как и при взаимодействии с микрослужбами с использованием согласованных протоколов и форматов данных, необходимо стандартизировать способ ведения журнала событий работоспособности и диагностических событий, которые в конечном счете оказываются в хранилище событий, к которому можно обращаться для просмотра данных и создания запросов. При подходе с использованием микрослужб разработчикам следует прежде всего согласовать единый формат ведения журнала. В приложении должен использоваться согласованный подход к просмотру диагностических событий.

Данные о работоспособности и диагностические данные — это не одно и то же. Отчет о работоспособности микрослужбы — это данные о ее текущем состоянии, необходимые для принятия соответствующих мер. Хорошим примером является работа с механизмами обновления и развертывания для обеспечения доступности. Служба может временно пребывать в неработоспособном состоянии (из-за сбоя процессов или перезагрузки компьютера), но при этом по-прежнему работать. Обновление микрослужбы — самое худшее действие в такой ситуации. Лучше сначала проанализировать ситуацию или дождаться восстановления микрослужбы. События работоспособности микрослужбы помогают принимать обоснованные решения и фактически помогают создавать службы с возможностью самовосстановления.

## <a name="microservices-design-guidance-on-azure"></a>Руководство по проектированию Микрослужб в Azure
Посетите Центр архитектуры Azure для руководство по проектированию на [создания микрослужб в Azure](https://docs.microsoft.com/azure/architecture/microservices/)

## <a name="service-fabric-as-a-microservices-platform"></a>Платформа микрослужб Service Fabric

Платформа Azure Service Fabric создана в рамках перехода корпорации Майкрософт от предоставления готовых продуктов, зачастую монолитных, к предоставлению служб. При ее создании учитывался опыт разработки и эксплуатации масштабных служб, например баз данных SQL Azure и Azure Cosmos DB. Она продолжала развиваться по мере внедрения во множестве служб. Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

***Service Fabric помогает решить сложные проблемы при разработке и запуске службы, связанные с эффективным использованием ресурсов инфраструктуры, что позволяет командам решать бизнес-задачи, применяя подход с использованием микрослужб.***

Service Fabric позволяет создавать приложения в рамках подхода с использованием микрослужб, предоставляя следующее:

* Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, маршрутизации сообщений, управления состоянием и мониторинга работоспособности.
* Возможность развертывания приложений, выполняемых в контейнерах или в виде процессов. Service Fabric — это контейнер и оркестратор процессов.
* Эффективные программные интерфейсы, которые помогут создавать приложения как микрослужбы, см. в статье [Общие сведения о модели программирования Service Fabric](service-fabric-choose-framework.md). К примеру, вы можете получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами встроенных средств, обеспечивающих высокую доступность.

***Для Service Fabric не важен способ создания службы, поэтому вы можете использовать любую технологию. Но эта платформа предоставляет встроенные программные интерфейсы, упрощающие создание микрослужб.***

### <a name="migrating-existing-applications-to-service-fabric"></a>Перенос существующих приложений в Service Fabric

В Service Fabric можно многократно использовать имеющийся код, который затем может быть модернизирован с помощью новых микрослужб. Существует пять этапов модернизации приложения, которые можно начинать и останавливать независимо друг от друга. Эти особые значения приведены ниже.

1) начать с традиционного монолитного приложения.  
2) Lift-and-shift. Использование контейнеров или гостевых исполняемых файлов для размещения существующего кода в Service Fabric.  
3) Модернизация. Добавление новых микрослужб к существующему контейнерному коду.  
4) Рационализация. Разделение монолитного приложения на микрослужбы исключительно на основе потребностей.  
5) Преобразование в микрослужбы. Преобразование существующих монолитных приложений или создание новых приложений "с нуля".

![Переход на микрослужбы][Image3]

Очень важно подчеркнуть, что можно **запускать и останавливать процесс на любом из этих этапов**. Переходить на следующий этап необязательно. Теперь рассмотрим примеры для каждого из этих этапов.

**Методика Lift-and-Shift**  
Многие компании переносят имеющиеся монолитные приложения в контейнеры по двум причинам.

* Снижение стоимости из-за консолидации и удаления имеющегося оборудования или выполнения приложений с более высокой плотностью.
* Контракт о согласованном развертывании между процессами разработки и эксплуатации.

Сокращение расходов — важный фактор. Поэтому в корпорации Майкрософт большое количество приложений выполняется в контейнерах, что позволяет сэкономить миллионы долларов. Согласованное развертывание труднее оценить, но оно не менее важно. Оно означает, что разработчики вольны выбирать подходящие им технологии, однако отдел эксплуатации поддерживает только один способ развертывания этих приложений и управления ими. Это избавляет отдел эксплуатации от сложностей, возникающих из-за использования множества различных технологий, а также принуждения разработчиков к выбору только некоторых из них. По сути, каждое приложение упаковывается в автономный развертываемый образ.

На этом многие организации останавливаются. Они уже получили преимущества контейнеров, и Service Fabric предоставляет все возможности управления для развертывания, обновления, управления версиями, отката, мониторинга работоспособности и т. д.

**Модернизация**  
Она заключается в добавлении новых служб к имеющемуся контейнерному коду. Если вы собираетесь написать новый код, то лучше пойти путем применения микрослужб, понемногу добавляя новые компоненты. Это может быть новая конечная точка REST API или бизнес-логика. Таким образом вы пойдете путем создания новых микрослужбами и освоите их разработку и развертывание.

**Инновации**  
Подход с использованием микрослужб позволит учесть изменяющиеся требования бизнеса. На этом этапе необходимо понять, нужно ли начать разделять монолитное приложение на службы или вносить в него изменения. Классический пример — когда базу данных, используемого в качестве очереди рабочего процесса становится узким местом обработки. По мере увеличения количества запросов рабочих процессов работа должна распределяться соответственно масштабу. Поэтому, если какая-либо определенная часть приложения не масштабируется или вам требуется более частое обновление, разделите это приложение на микрослужбы и рационализируйте.

**Преобразование в микрослужбы**  
Здесь находятся приложение полностью состоит из (или разбивать на) микрослужб. Для этого вы пошли путем использования микрослужб. Вы можете начать с этого этапа, но, чтобы сделать это без платформы микрослужб, потребуются значительные вложения.

### <a name="are-microservices-right-for-my-application"></a>Подходят ли микрослужбы моему приложению?

Возможно. Все больше команд разработчиков в корпорации Майкрософт начинают разрабатывать облачные приложения для решения бизнес-задач. Многие из них оценили преимущества подхода с использованием микрослужб. Например, в поисковой системе Bing микрослужбы разрабатываются с использованием этого подхода уже в течение нескольких лет. Для других команд этот подход был новым. Они столкнулись со сложными проблемами, которые им не удалось решить. Именно поэтому платформа Service Fabric быстро заслужила популярность как предпочтительная технология для создания служб.

Платформа Service Fabric призвана упростить процесс создания приложений для микрослужб, устраняя необходимость в дорогостоящих изменениях. Принцип использования платформы: создание небольшого приложения, масштабирование по мере необходимости, удаление устаревших служб, добавление новых служб и развитие приложения по мере использования клиентами. Мы знаем: чтобы сделать микрослужбы более доступными для большинства разработчиков, следует решить еще множество проблем. Контейнеры и модель программирования на основе субъектов — примеры маленьких шагов на пути к этой цели. Мы уверены, что появится еще множество инноваций, позволяющих упростить разработку приложений.


## <a name="next-steps"></a>Дальнейшие действия

* [Microservices: An application revolution powered by the cloud](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/) (Микрослужбы. Революция приложений в облаке)
* [Центр архитектуры Azure: Проектирование микрослужб в Azure](https://docs.microsoft.com/azure/architecture/microservices/)
* [Рекомендации по Azure Service Fabric приложения и кластера](service-fabric-best-practices-overview.md)
* [Общие сведения о терминологии Service Fabric](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
