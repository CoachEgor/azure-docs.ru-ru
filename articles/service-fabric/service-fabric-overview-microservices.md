---
title: Введение в микросервисы на Azure
description: Общие сведения о том, почему создание облачных приложений с использованием микрослужб важно для разработки современных приложений и как платформа Azure Service Fabric позволяет достичь этой цели.
ms.topic: conceptual
ms.date: 01/07/2020
ms.custom: sfrev
ms.openlocfilehash: af18a6cb45808c0af5ec2782a3fd2100e3b7bf99
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75750617"
---
# <a name="why-use-a-microservices-approach-to-building-applications"></a>Зачем использовать подход микрослужб для создания приложений

Для разработчиков программного обеспечения, факторинг приложения в компонентные части не является чем-то новым. Как правило, используется многоуровневый подход с магазином бэк-энда, бизнес-логикой среднего уровня и интерфейсом интерфейса интерфейса интерфейса интерфейса интерфейса (UI). За *has* последние несколько лет изменилось то, что разработчики строят распределенные приложения для облака.

Вот некоторые меняющиеся потребности бизнеса:

* Сервис, созданный и работающий в масштабе для охвата клиентов в новых географических регионах.
* Более быстрая доставка функций и возможностей для гибкого реагирования на потребности клиентов.
* Более эффективное использование ресурсов, позволяющее снизить затраты.

Эти бизнес-потребности определяют *способ* сборки приложений.

Более подробную информацию о подходе Azure к микрослужбам можно узнать в [микрослужбах Microservices: революция приложений, основанная на облаке.](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)

## <a name="monolithic-vs-microservices-design-approach"></a>Подход к проектированию монолитных и микросервисов

По прошествии времени приложения развиваются. Успешные приложения развиваются за счет использования. Неудачные приложения не развиваются и в конечном итоге изунились. Вот вопрос: сколько вы знаете о ваших требованиях сегодня и что они будут в будущем? Например, предположим, что вы строите приложение для отчетности для отдела в вашей компании. Вы уверены, что приложение применяется только в рамках вашей компании, и что отчеты не будут храниться долго. Ваш подход будет отличаться от подхода, скажем, создания сервиса, который предоставляет видеоконтент десяткам миллионов клиентов.

Иногда, получить что-то из двери в качестве доказательства концепции является движущей силой. Вы знаете, что приложение может быть переработано позже. Там мало смысла в чрезмерной инженерии то, что никогда не привыкает. С другой стороны, когда компании строят для облака, ожидание роста и использования. Рост и масштаб непредсказуемы. Мы хотим быстро прототипировать, зная, что мы находимся на пути, который может справиться с будущим успехом. Подход, который применяют небольшие новые компании, включает сборку, измерение, анализ данных и повторение всего цикла.

В эпоху клиента/сервера мы, как правило, фокусировали на создании многоуровневых приложений, используя конкретные технологии на каждом уровне. Для описания этих подходов появился термин *монолитное* применение. Интерфейсы находились как бы между уровнями, а в рамках самого уровня компоненты были более тесно связаны. Разработчики разработали и учли классы, которые были собраны в библиотеки и объединены в несколько исполняемых файлов и DLL.

Есть преимущества монолитного подхода к дизайну. Монолитные приложения часто проще проектировать, а вызовы между компонентами быстрее, потому что эти вызовы часто пересекают межпроцессовую связь (IPC). Кроме того, каждый тестирует один продукт, который, как правило, более эффективное использование людских ресурсов. Недостатком является то, что существует плотное соединение между многоуровневыми слоями, и вы не можете масштабировать отдельные компоненты. Если вам нужно сделать исправления или обновления, вы должны ждать других, чтобы закончить их тестирования. Сложнее быть ловким.

Микрослужбы устраняют эти недостатки и более тесно согласуются с предыдущими бизнес-требованиями. Но они также имеют как льготы, так и обязательства. Преимущества микрослужб состоят в том, что обычно каждая из них включает в себя простые бизнес-функции, а также поддерживает возможность независимого вертикального масштабирования, тестирования, развертывания и управления. Одним из важных преимуществ подхода микрослужб является то, что команды руководствуются скорее бизнес-сценариями, чем технологией. Небольшие группы разрабатывают микрослужбу на основе сценария клиента и используют любые технологии, которые они хотят использовать.

Иными словами, организации не нужно стандартизировать технологии для поддержки своих приложений для микрослужб. Отдельные команды, владеющие службами, могут делать то, что они считают целесообразным, исходя из собственных знаний или подходящих действий для решения задачи. На практике предпочтительнее набор рекомендуемых технологий, таких как определенный магазин НоСЗЛ или веб-прикладная база.

Недостатком микрослужб является то, что вам приходится управлять более отдельными объектами и иметь дело с более сложными развертываниями и версиями. Увеличивается сетевой трафик между микрослужбами, как и соответствующие сетевые просечения. Много болтливых, гранулированных услуг может вызвать кошмар производительности. Без инструментов, помогая просматривать эти зависимости, трудно увидеть всю систему.

Стандарты заставляют подход микрослужб работать, указывая, как общаться и терпимо относиться только к тому, что вам нужно от службы, а не по жестким контрактам. Важно определить эти контракты заранее в дизайне, потому что службы обновляются независимо друг от друга. При разработке приложений с использованием микрослужб выделяется еще одна характеристика — мелкомодульная сервисноориентированная архитектура (SOA).

***В самом простом варианте проектирования микрослужб речь идет о разъединенной федерации услуг с независимыми изменениями в каждом и согласованных стандартах связи.***

По мере того, как производится все больше облачных приложений, люди обнаруживают, что такое разложение общего приложения на независимые, ориентированные на сценарии службы является лучшим долгосрочным подходом.

## <a name="comparison-between-application-development-approaches"></a>Сравнение подходов к разработке приложений

![Разработка приложений на платформе Service Fabric][Image1]

1) Монолитное приложение содержит функциональность, специфичную для доменов, и обычно делится на функциональные слои, такие как веб, бизнес и данные.

2) Масштабируется монолитное приложение, клонируя его на нескольких серверах/виртуальных машинах/контейнерах.

3) В приложениях, состоящих из микрослужб, функциональные возможности распределены между отдельными службами меньшего размера.

4) Подход с использованием микрослужб дает возможность масштабировать приложения, развертывая каждую службу независимо от других и создавая экземпляры этих служб на разных серверах и виртуальных машинах и в разных контейнерах.

Проектирование с помощью подхода микрослужб не подходит для всех проектов, но оно более тесно согласуется с бизнес-целями, описанными ранее. Начиная с монолитного подхода может иметь смысл, если вы знаете, что у вас будет возможность переработать код позже в дизайн микрослужб. Но чаще всего разработчики сначала создают монолитное приложение, а затем медленно и поэтапно разделяют его, начиная с функциональных областей, в которых следует увеличить масштабируемость и гибкость.

При использовании подхода микрослужб вы создаете приложение из множества небольших служб. Эти службы работают в контейнерах, развернутых в кластере машин. Небольшие группы разрабатывают службу, которая фокусируется на сценарии и независимо тестирует, тестирует, развертывает и масштабирует каждую службу, чтобы все приложение могло развиваться.

## <a name="what-is-a-microservice"></a>Что такое микрослужба

Существует много определений микрослужб. Но большинство из этих характеристик микросервисов широко признаны:

* Инкапсуляция сценария клиента или бизнес-сценария. Какую проблему вы решаете?
* Разработка небольшими командами разработчиков.
* Написано на любом языке программирования, используя любые рамки.
* Состоит из кода и опционально состояния, оба из которых независимо versioned, deployed, и масштабируется.
* Взаимодействие с другими микрослужбами с помощью четко определенных интерфейсов и протоколов.
* Ит., уникальные имена (URL-адреса), которые используются для решения их местонахождения.
* Обеспечение стабильности работы и доступности в случае сбоя.

Подводя итог:

***Приложения, состоящие из микрослужб, формируются из небольших ориентированных на клиента служб с независимым управлением версиями и масштабированием, которые взаимодействуют по стандартным протоколам с применением четко определенных интерфейсов.***

### <a name="written-in-any-programming-language-using-any-framework"></a>Написано на любом языке программирования с использованием любых рамок

Как разработчики, мы хотим быть свободными в выборе языка или платформы, в зависимости от наших навыков и потребностей сервиса, который мы создаем. Для некоторых служб вы можете оценить преимущества производительности сс выше всего остального. Для других, простота управляемой разработки, которую вы получаете от C или Java может быть более важным. В некоторых случаях может потребоваться использование определенной библиотеки партнеров, технологии хранения данных или метода предоставления услуг клиентам.

После выбора технологии необходимо рассмотреть вопрос об управлении эксплуатацией или жизненным циклом и масштабировании службы.

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>Возможность независимого управления версиями, развертывания и масштабирования кода и состояния

Независимо от того, как вы пишете микрослужбы, код и, по желанию, состояние, должны самостоятельно развертывать, модернизировать и масштабировать. Эту проблему трудно решить, потому что все сводится к выбору технологий. Для масштабирования понимание того, как разделить (или осколок) как код, так и состояние, является сложной задачей. Когда код и государство используют различные технологии, что является общим сегодня, сценарии развертывания для вашей микрослужбы должны быть в состоянии масштабировать их обоих. Это разделение также о гибкости и гибкости, так что вы можете обновить некоторые из микрослужб без необходимости обновления всех из них сразу.

Вернемся к нашему сравнению монолитных и микросервисных подходов на мгновение. На этой диаграмме показаны различия в подходах к хранению состояния:

#### <a name="state-storage-for-the-two-approaches"></a>Государственное хранение для двух подходов

![Хранилище состояний платформы Service Fabric][Image2]

***Монолитный подход слева имеет единую базу данных и уровни конкретных технологий.***

***Подход микрослужб справа имеет график взаимосвязанных микрослужб, где состояние обычно отнесено к микрослужбе и используются различные технологии.***

Монолитное приложение, как правило, использует отдельную базу данных. Преимущество использования одной базы данных заключается в том, что она находится в одном месте, что упрощает развертывание. У каждого компонента может быть одна таблица для хранения данных о состоянии. Сложность состоит в том, что командам разработчиков необходимо строго разграничивать состояния. Неизбежно у кого-то возникнет соблазн добавить столбец в существующую таблицу клиентов, сделать соединение между таблицами и создать зависимости на уровне хранения. Однако в таком случае будет невозможно масштабировать отдельные компоненты.

При подходе с использованием микрослужб каждая служба управляет собственным состоянием и хранит данные о нем. Каждая служба отвечает за масштабирование кода и состояния для обеспечения соответствия собственным требованиям. Недостатком является то, что при необходимости создания представлений или запросов данных приложения необходимо запрашивать запрос в нескольких государственных магазинах. Эта проблема обычно решается отдельной микрослужбой, которая создает представление в коллекции микрослужб. Если вам необходимо выполнить несколько импровизированных запросов на данных, следует записать данные каждой микрослужбы в службу складирования данных для автономной аналитики.

Микросервисы являются версиями. Различные версии микрослужбы могут работать бок о бок. Более новая версия микрослужбы может выйти из строя во время обновления и должна быть отката на более раннюю версию. Версия также полезна для A/B-тестирования, где разные пользователи сталкиваются с различными версиями службы. Например, обычно микрослужба обновляется для определенного набора клиентов для тестирования новых функциональных возможностей, прежде чем внедрять ее более широко.

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>Взаимодействие с другими микрослужбами с применением четко определенных интерфейсов и протоколов

За последние 10 лет была опубликована обширная информация, описывающая коммуникационные модели в архитектурах, ориентированных на обслуживание. Сейчас, как правило, для взаимодействия между службами используется REST, протоколы HTTP и TCP, а также формат сериализации XML или JSON. С точки зрения интерфейса, речь идет о принятии веб-дизайна подход. Но ничто не должно помешать вам использовать двоичные протоколы или собственные форматы данных. Просто имейте в виду, что людям будет труднее использовать ваши микрослужбы, если эти протоколы и форматы не являются открытыми.

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>Уникальное имя (URL-адрес), используемое для распознавания расположения

Возможность адресации микрослужбы должна существовать независимо от того, где она находится. Если вы думаете о машинах и какой из них работает частности микрослужбы, все может пойти плохо быстро.

Микрослужба должна иметь уникальное имя, позволяющее обнаружить ее расположение, подобно тому, как DNS разрешает URL-адрес для конкретного компьютера. Микрослужбам нужны адресные имена, которые не зависят от инфраструктуры, на которой они работают. Это означает наличие связи между развертыванием службы и ее обнаружением, то есть необходим реестр служб. При сбое машины служба регистрации должна сообщить вам, куда была перемещена служба.

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>Стабильность работы и доступность в случае сбоя

Устранение неожиданных сбоев — одна из самых труднорешаемых задач, особенно в распределенной системе. Большая часть кода, который мы пишем как разработчики, предназначена для обработки исключений. Во время тестирования мы также тратим больше всего времени на обработку исключений. Процесс более вовлечен, чем написание кода для обработки сбоев. Что происходит, когда машина, на которой работает микрослужба, выходит из строя? Вы должны обнаружить сбой, который является трудной проблемой сама по себе. Но вам также нужно перезапустить микрослужбу.

Для доступности микрослужба должна быть устойчивой к сбоям и иметь возможность перезапускать на другой машине. В дополнение к этим требованиям устойчивости, данные не должны быть потеряны, и данные должны оставаться последовательными.

Устойчивости трудно достичь при возникновении сбоев во время обновления приложения. Микрослужбе, работающей с системой развертывания, не требуется восстановление. Он должен определить, может ли он продолжать двигаться вперед к новой версии или откат к предыдущей версии для поддержания согласованного состояния. Вам нужно рассмотреть несколько вопросов, например, достаточно ли машин, чтобы продолжать двигаться вперед и как восстановить предыдущие версии микрослужбы. Для принятия этих решений, необходимо микрослужба для исформирования медицинской информации.

### <a name="reports-health-and-diagnostics"></a>Передача информации о работоспособности и диагностических данных

Это может показаться очевидным, и это часто упускается из виду, но микрослужба должна сообщить о своем здоровье и диагностике. В противном случае, у вас есть мало понимания его здоровья с точки зрения операций. Сложность заключается не только в выявлении связи между диагностическими событиями для ряда независимых служб, но и в сопоставлении расхождений в показаниях часов компьютера для определения порядка событий. Как и при взаимодействии с микрослужбами с использованием согласованных протоколов и форматов данных, необходимо стандартизировать способ ведения журнала событий работоспособности и диагностических событий, которые в конечном счете оказываются в хранилище событий, к которому можно обращаться для просмотра данных и создания запросов. При подходе микрослужб разные группы должны согласовать единый формат регистрации. В приложении должен использоваться согласованный подход к просмотру диагностических событий.

Данные о работоспособности и диагностические данные — это не одно и то же. Отчет о работоспособности микрослужбы — это данные о ее текущем состоянии, необходимые для принятия соответствующих мер. Хорошим примером является работа с механизмами обновления и развертывания для обеспечения доступности. Хотя служба в настоящее время может быть неработоспособной из-за сбоя процесса или перезагрузки машины, служба все еще может работать. Последнее, что вам нужно, это сделать ситуацию хуже, начав обновление. Наилучший подход заключается в том, чтобы сначала исследовать или дать время для восстановления микрослужбы. События работоспособности микрослужбы помогают принимать обоснованные решения и фактически помогают создавать службы с возможностью самовосстановления.

## <a name="guidance-for-designing-microservices-on-azure"></a>Руководство по проектированию микрослужб на Azure

Посетите архитектурный центр Azure, чтобы найти рекомендации по [проектированию и созданию микрослужб на Azure.](https://docs.microsoft.com/azure/architecture/microservices/)

## <a name="service-fabric-as-a-microservices-platform"></a>Платформа микрослужб Service Fabric

Технология Azure Fabric появилась после перехода microsoft от доставки коробок продуктов, которые, как правило, были монолитными, к предоставлению услуг. Опыт создания и эксплуатации крупных сервисов, таких как база данных Azure S'L и Azure Cosmos DB, формирует сядебную ткань обслуживания. Платформа развивалась с течением времени, как больше услуг принял его. Service Fabric работает не только в среде Azure, но и в автономных развертываниях Windows Server.

***Целью Service Fabric является решение трудных задач создания и запуска сервиса и эффективного использования инфраструктурных ресурсов, чтобы команды могли решать бизнес-задачи с помощью подхода микрослужб.***

Service Fabric позволяет создавать приложения в рамках подхода с использованием микрослужб, предоставляя следующее:

* Платформа, которая предоставляет системные службы для развертывания, обновления, обнаружения и перезапуска служб, в которых произошел сбой, а также обнаружения служб, маршрутизации сообщений, управления состоянием и мониторинга работоспособности.
* Возможность развертывания приложений либо в контейнерах, либо в качестве процессов. Service Fabric — это контейнер и оркестратор процессов.
* Продуктивные программные AAP для создания приложений в качестве микрослужб: [ASP.NET Core, Надежные субъекты и надежные службы.](service-fabric-choose-framework.md) К примеру, вы можете получать информацию о работоспособности и данные диагностики, а также пользоваться преимуществами встроенных средств, обеспечивающих высокую доступность.

***Сервис Fabric агностик о том, как вы строите свой сервис, и вы можете использовать любую технологию. Но он предоставляет встроенные программные AA, которые облегчают создание микрослужб.***

### <a name="migrating-existing-applications-to-service-fabric"></a>Перенос существующих приложений в Service Fabric

Service Fabric позволяет повторно использовать существующий код и модернизировать его новыми микрослужбами. Есть пять этапов модернизации приложения, и вы можете начать и остановить на любом этапе. Этапы:

1) начать с традиционного монолитного приложения.  
2) Перенос. Используйте контейнеры или исполнители гостевых номеров для размещения существующего кода в Service Fabric.  
3) Модернизации. Добавление новых микрослужб наряду с существующим контейнерным кодом.  
4) Инновациям. Разбейте монолитное применение на микрослужбы в зависимости от необходимости.  
5) Преобразование приложений в микрослужбы. Преобразуйте существующие монолитные приложения или создайте новые приложения greenfield.

![Миграция в микрослужбы][Image3]

Помните, что вы можете *начать и остановить на любом из этих этапов*. Вам не нужно переходить к следующему этапу. 

Рассмотрим примеры для каждого из этих этапов.

**Перенос**  
По двум причинам многие компании мигрируют в контейнеры существующих монолитных приложений:

* Снижение затрат либо за счет консолидации и удаления существующего оборудования, либо из-за работы приложений с более высокой плотностью.
* Последовательный контракт на развертывание между разработкой и операциями.

Снижение затрат происходит непросто. В корпорации Майкрософт многие существующие приложения подвергаются контейнеризации, что приводит к экономии на миллионы долларов. Последовательное развертывание труднее оценить, но не менее важно. Это означает, что разработчики могут выбирать технологии, которые им подходят, но операции будут принимать только один метод развертывания и управления приложениями. Это облегчает операции от необходимости иметь дело со сложностью поддержки различных технологий, не заставляя разработчиков выбирать только определенные из них. По сути, каждое приложение контейнерно в автономные изображения развертывания.

На этом многие организации останавливаются. Они уже имеют преимущества контейнеров, и Service Fabric предоставляет полный опыт управления, включая развертывание, обновления, версии, откаты и мониторинг работоспособности.

**Модернизация**  
Модернизация – это добавление новых служб наряду с существующим контейнерным кодом. Если вы собираетесь писать новый код, лучше всего делать небольшие шаги по пути микрослужб. Это может означать добавление новой конечной точки REST API или новой бизнес-логики. Таким образом, вы начинаете процесс создания новых микрослужб и практикуете их разработку и развертывание.

**Инновациям**  
Подход с использованием микрослужб позволит учесть изменяющиеся требования бизнеса. На этом этапе необходимо решить, следует ли начать разделение монолитного приложения на службы или инновации. Классическим примером является то, что база данных, используемая в очереди рабочего процесса, становится узким местом обработки. По мере увеличения количества запросов рабочих процессов работа должна распределяться соответственно масштабу. Возьмем эту конкретную часть приложения, которая не масштабируется, или которая должна обновляться чаще, и разделить его как микрослужбы и инновации.

**Преобразование приложений в микрослужбы**  
На этом этапе приложение полностью состоит из (или разделено) на микрослужбы. Чтобы достичь этой точки, вы сделали путешествие микрослужб. Вы можете начать здесь, но сделать это без платформы микроуслуг, чтобы помочь вам требует значительных инвестиций.

### <a name="are-microservices-right-for-my-application"></a>Подходят ли микрослужбы моему приложению?

Возможно. В корпорации Майкрософт, по мере того как все больше команд начали строить для облака по бизнес-причинам, многие из них осознали преимущества подхода, аналогичного микрослужбе. Bing, например, уже много лет использует микросервисы. Для других команд этот подход был новым. Они столкнулись со сложными проблемами, которые им не удалось решить. Вот почему Service Fabric получила тягу как технология строительных услуг.

Цель юбиляра состоит в том, чтобы уменьшить сложность создания приложений для микрослужб, чтобы вам не пришлось пройти через столько дорогостоящих редизайнов. Принцип использования платформы: создание небольшого приложения, масштабирование по мере необходимости, удаление устаревших служб, добавление новых служб и развитие приложения по мере использования клиентами. Мы знаем: чтобы сделать микрослужбы более доступными для большинства разработчиков, следует решить еще множество проблем. Контейнеры и модель программирования актера являются примерами небольших шагов в этом направлении. Мы уверены, что появится больше инноваций, чтобы упростить подход к микроуслугам.

## <a name="next-steps"></a>Дальнейшие действия

* [Микрослужбы: революция в области приложений на основе облака](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)
* [Архитектурный центр Azure: создание микрослужб на Azure](https://docs.microsoft.com/azure/architecture/microservices/)
* [Рекомендации по приложению и кластеру Azure Service Fabric](service-fabric-best-practices-overview.md)
* [Общие сведения о терминологии Service Fabric](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
