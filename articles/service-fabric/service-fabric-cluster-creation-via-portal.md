---
title: Создание кластера Service Fabric на портале Azure | Документы Майкрософт
description: Узнайте, как настроить защищенный кластер Service Fabric в Azure с помощью портала Azure и Azure Key Vault.
services: service-fabric
documentationcenter: .net
author: athinanthny
manager: chackdan
editor: vturecek
ms.assetid: 426c3d13-127a-49eb-a54c-6bde7c87a83b
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 09/06/2018
ms.author: atsenthi
ms.openlocfilehash: 123795730e8468591bb02fa7c756ad48222dff82
ms.sourcegitcommit: b4f201a633775fee96c7e13e176946f6e0e5dd85
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2019
ms.locfileid: "68600018"
---
# <a name="create-a-service-fabric-cluster-in-azure-using-the-azure-portal"></a>Создание кластера Service Fabric в Azure с помощью портала Azure
> [!div class="op_single_selector"]
> * [Azure Resource Manager](service-fabric-cluster-creation-via-arm.md)
> * [Портал Azure](service-fabric-cluster-creation-via-portal.md)
> 
> 

Это пошаговое руководство поможет выполнить настройку кластера Service Fabric (Linux или Windows) в Azure с помощью портала Azure. Данное руководство описывает следующие действия:

* Создание кластера в Azure с помощью портала Azure.
* Аутентификация администраторов с помощью сертификатов.

> [!NOTE]
> Для более сложных вариантов безопасности, таких как проверка подлинности пользователей с Azure Active Directory и настройка сертификатов для безопасности приложений, [Создайте кластер с помощью Azure Resource Manager][create-cluster-arm].
> 
> 

## <a name="cluster-security"></a>Безопасность кластера 
Сертификаты используются в Service Fabric, чтобы обеспечить функции аутентификации и шифрования для защиты различных аспектов кластера и его приложений. Дополнительные сведения о том, как сертификаты используются в Service Fabric, см. в статье [Сценарии защиты кластера Service Fabric][service-fabric-cluster-security].

Если вы впервые создаете кластер Service Fabric или развертываете кластер для тестовых рабочих нагрузок, можно перейти к следующему разделу (**Создание кластера на портале Azure**) и запустить создание в системе сертификатов, необходимых для кластеров, которые выполняют тестовые рабочие нагрузки. Если вы настраиваете кластер для рабочих нагрузок, тогда продолжайте чтение.

#### <a name="cluster-and-server-certificate-required"></a>Сертификат кластера и сервера (обязательно)
Этот сертификат требуется для защиты кластера и предотвращения несанкционированного доступа к нему. Он обеспечивает безопасность кластера несколькими способами.

* **Аутентификация в кластере** позволяет аутентифицировать обмен данными между узлами для федерации кластера. Только узлы, которые могут подтвердить свою подлинность с помощью этого сертификата, могут присоединиться к кластеру.
* **Аутентификация сервера** позволяет аутентифицировать конечные точки управления кластера в клиенте управления, чтобы он "знал", что обращается к настоящему кластеру. Этот сертификат также предоставляет SSL для API управления HTTPS и Service Fabric Explorer по протоколу HTTPS.

Для этого сертификат должен отвечать следующим требованиям:

* Сертификат должен содержать закрытый ключ.
* Сертификат должен быть создан для обмена ключами, которые можно экспортировать в файл обмена личной информацией (PFX-файл).
* **Имя субъекта сертификата должно совпадать с доменным именем**, которое используется для обращения к кластеру Service Fabric. Это необходимо, чтобы предоставить протокол SSL для конечных точек управления HTTPS в кластере и Service Fabric Explorer. Невозможно получить SSL-сертификат от центра сертификации (ЦС) для домена `.cloudapp.azure.com` . Необходимо получить имя личного домена для кластера. При запросе сертификата из ЦС имя субъекта сертификата должно совпадать с именем личного домена, используемого для кластера.

#### <a name="client-authentication-certificates"></a>Сертификаты проверки подлинности клиента
Дополнительные сертификаты клиента используются для аутентификации администраторов при выполнении задач управления кластером. Service Fabric имеет два уровня доступа: **администратор** и **пользователь только для чтения**. Необходимо использовать хотя бы один сертификат для административного доступа. Для получения дополнительного доступа на уровне пользователя необходимо предоставить отдельный сертификат. Дополнительные сведения о ролях доступа см. в разделе [Управление доступом на основе ролей для клиентов Service Fabric][service-fabric-cluster-security-roles].

Для работы с Service Fabric не нужно передавать сертификаты проверки подлинности клиента в хранилище ключей. Эти сертификаты должны предоставляться только пользователям, уполномоченным осуществлять управление кластером. 

> [!NOTE]
> Azure Active Directory является рекомендуемым способом аутентификации клиентов при допуске к операциям управления кластером. Чтобы использовать Azure Active Directory, необходимо [создать кластер с помощью Azure Resource Manager][create-cluster-arm].
> 
> 

#### <a name="application-certificates-optional"></a>Сертификаты приложения (необязательно)
В кластере можно установить любое количество дополнительных сертификатов для обеспечения безопасности приложений. Перед созданием кластера рассмотрите сценарии безопасности приложений, которые требуют установки сертификатов на узлах, в том числе:

* шифрование и расшифровка значений конфигурации приложений;
* шифрование данных между узлами во время репликации. 

При [создании кластера с помощью портала Azure](https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/service-fabric/service-fabric-cluster-creation-via-portal.md) настройка сертификатов приложения недоступна. Чтобы настроить сертификаты приложений во время установки кластера, необходимо [создать кластер с помощью Azure Resource Manager][create-cluster-arm]. Также можно добавить сертификаты приложения в кластер после его создания.

## <a name="create-cluster-in-the-azure-portal"></a>Создание кластера на портале Azure

Создание рабочего кластера в соответствии с потребностями вашего приложения требует определенного планирования, поэтому настоятельно рекомендуется прочесть и изучить документ с [рекомендациями по планированию кластера Service Fabric][service-fabric-cluster-capacity] . 

### <a name="search-for-the-service-fabric-cluster-resource"></a>Поиск кластерных ресурсов Service Fabric

Войдите на [портале Azure][azure-portal].
Чтобы добавить новый шаблон ресурсов, щелкните **Создать ресурс**. Найдите шаблон "Кластер Service Fabric" в **Marketplace** в разделе **Все**.
Выберите в списке **Кластер Service Fabric** .

![поиск шаблона кластера Service Fabric на портале Azure.][SearchforServiceFabricClusterTemplate]

Перейдите к колонке **Кластер Service Fabric** и выберите **Создать**.

В колонке **Создание кластера Service Fabric** необходимо выполнить четыре шага:

### <a name="1-basics"></a>1. Основные сведения
![Снимок экрана создания новой группы ресурсов.][CreateRG]

В колонке "Основные сведения" требуется указать основные сведения для кластера.

1. Введите имя кластера.
2. Введите **имя пользователя** и **пароль** для удаленного рабочего стола виртуальных машин.
3. Выберите **подписку** , в которой вы хотите развернуть кластер, особенно при наличии нескольких подписок.
4. Создайте **группу ресурсов**. Рекомендуется присвоить ей имя, совпадающее с именем кластера. Это облегчит дальнейший поиск, особенно при внесении изменений в развертывание или удалении кластера.
   
   > [!NOTE]
   > Хотя вы можете использовать существующую группу ресурсов, рекомендуется создать новую. Это позволяет легко удалить кластеры и все используемые ими ресурсы.
   > 
   > 
5. Выберите **расположение**, в котором требуется создать кластер. Если вы планируете использовать имеющийся сертификат, который уже отправлен в хранилище ключей, необходимо использовать тот же регион, в котором расположено ваше хранилище ключей. 

### <a name="2-cluster-configuration"></a>2. Конфигурация кластера
![Создание типа узла][CreateNodeType]

Настройте узлы кластера. Он определяет размер виртуальных машин, их количество и свойства. Кластер может содержать узлы нескольких типов, однако первичный узел (тот, который вы задали на портале) должен включать не менее пяти виртуальных машин, так как на узлах такого типа расположены системные службы Service Fabric. Не настраивайте параметры **Свойства размещения** , так как стандартное свойство размещения NodeTypeName добавляется автоматически.

> [!NOTE]
> Распространенный сценарий для нескольких типов узлов — это приложение, содержащее интерфейсную и серверную службы. Интерфейсную службу нужно разместить на виртуальных машинах меньшего размера (например, D2_V2) с портами, открытыми для доступа через Интернет, а серверную службу — на более крупных виртуальных машинах (D3_V2, D6_V2, D15_V2 и т. д.) без портов, имеющих выход в Интернет.
> 

1. Выберите имя для типа узла (от 1 до 12 буквенно-цифровых символов).
2. Минимальный **размер** виртуальных машин для первичного узла зависит от выбранного для кластера **уровня устойчивости**. Значение по умолчанию для уровня устойчивости — bronze (бронзовый). Дополнительные сведения о устойчивости см. в статье [как выбрать отказоустойчивость кластера Service Fabric][service-fabric-cluster-durability].
3. Выберите **размер виртуальной машины**. Виртуальные машины серии D оснащены твердотельными накопителями (SSD) и настоятельно рекомендуются для приложений с отслеживанием состояния. Не используйте SKU виртуальной машины с частичными ядрами и менее чем 10 ГБ свободного места на диске. Сведения о выборе размера виртуальной машины см. в документе с рекомендациями по [планированию кластера Service Fabric][service-fabric-cluster-capacity] .
4.  **Кластеры с одним узлом и тремя узлами** предназначены для использования только в целях тестирования. Эти кластеры не поддерживаются для выполнения производственных задач.
5. Выберите **первоначальную емкость набора масштабирования виртуальных машин** для типа узла. Количество виртуальных машин для типа узла можно увеличить или уменьшить позже, но минимальное количество виртуальных машин на первичном узле — пять для рабочих нагрузок рабочей среды. Для других типов узлов можно задать минимум одну виртуальную машину. Минимальное **количество** виртуальных машин для первичного узла зависит от выбранного для кластера уровня **надежности**.  
6. Настройте **пользовательские конечные точки**. Это поле позволяет ввести список портов с разделителями-запятыми. С помощью Azure Load Balancer для приложений будет открыт общий доступ через Интернет к указанным здесь портам. Например, если вы планируете развернуть в своем кластере веб-приложение, то введите здесь "80", чтобы разрешить в этом кластере трафик через порт 80. Дополнительные сведения о конечных точках см. в разделе [взаимодействие с приложениями][service-fabric-connect-and-communicate-with-services] .
7. **Включите обратный прокси-сервер**.  [Обратный прокси-сервер Service Fabric](service-fabric-reverseproxy.md) помогает микрослужбам, работающим в кластере Service Fabric, обнаруживать другие службы с конечными точками HTTP и взаимодействовать с этими службами.
8. Вернитесь в колонку **Конфигурация кластера** и в разделе **+ Показать дополнительные параметры** настройте **диагностику** кластера. Диагностика в кластере включена по умолчанию. Это упрощает устранение неполадок. Если вы хотите отключить систему диагностики, установите переключатель **Состояние** в положение **Выкл**. Отключать систему диагностики **не** рекомендуется. Если проект Application Insights уже создан, тогда предоставьте его ключ, чтобы направить трассировку приложения к нему.
9. **Включите службу DNS**.  [Служба DNS](service-fabric-dnsservice.md) является дополнительной службой, которая позволяет находить другие службы с помощью протокола DNS.
10. Выберите **режим обновления Service Fabric**, который необходимо задать для кластера. Если требуется, чтобы система автоматически получала последнюю версию и выполняла попытку обновить до нее кластер, выберите пункт **Автоматически**. Если вы хотите выбирать поддерживаемую версию, задайте режим **Вручную**. Дополнительные сведения о режиме обновления структуры см [. в документе Service Fabric обновления кластера.][service-fabric-cluster-upgrade]

> [!NOTE]
> Корпорация Майкрософт поддерживает только кластеры под управлением поддерживаемых версий Service Fabric. Выбрав режим **Вручную**, вы принимаете на себя ответственность за обновление кластера до поддерживаемой версии.
> 

### <a name="3-security"></a>3. безопасность
![Снимок экрана конфигураций безопасности на портал Azure.][BasicSecurityConfigs]

Чтобы облегчить процесс настройки надежных тестовых кластеров, мы предоставили параметр **Базовый**. Если у вас уже имеется сертификат, который отправлен в [хранилище ключей](/azure/key-vault/) (и оно включено для развертывания), тогда используйте параметр **Пользовательский**.

#### <a name="basic-option"></a>Параметр "Базовый"
Следуйте инструкциям на экране, чтобы добавить или повторно использовать хранилище ключей и добавить сертификат. Добавление сертификата является синхронным процессом, поэтому придется подождать создания сертификата.

Не покидайте экран до завершения процесса.

![CreateKeyVault]

После создания хранилища ключей измените политики доступа для хранилища ключей. 

![CreateKeyVault2]

Щелкните **Изменить политики доступа**, затем **Показать политики расширенного доступа** и включите доступ к виртуальным машинам Azure для развертывания. Рекомендуется также включить развертывание шаблона. Сделав выбор, не забудьте нажать кнопку **Сохранить** и закрыть панель **Политики доступа**.

![CreateKeyVault3]

Укажите имя сертификата и нажмите кнопку **ОК**.

![CreateKeyVault4]

#### <a name="custom-option"></a>Параметр "Пользовательский"
Пропустите этот раздел, если вы уже выполнили действия, описанные для параметра **Базовый**.

![SecurityCustomOption]

Чтобы заполнить страницу "Безопасность", вам потребуются исходное хранилище ключей, URL-адрес сертификата и его отпечаток. Если у вас нет этой информации, откройте еще одно окно браузера и на портале Azure сделайте следующее:

1. Перейдите в службу хранилища ключей.
2. Выберите вкладку "Свойства", скопируйте значение идентификатора ресурса и вставьте его в поле исходного хранилища ключей в другом окне браузера. 

    ![CertInfo0]

3. Теперь выберите вкладку "Сертификаты".
4. Щелкните отпечаток сертификата, после чего вы перейдете на страницу версий.
5. Щелкните идентификаторы GUID, которые показаны под текущей версией.

    ![CertInfo1]

6. Отобразится экран, похожий на показанный ниже. Скопируйте шестнадцатеричное значение отпечатка SHA-1 и вставьте его в поле отпечатка сертификата в другом окне браузера.
7. Скопируйте идентификатор секрета и вставьте его в поле URL-адреса сертификата в другом окне браузера.

    ![CertInfo2]

Установите флажок **Настройка дополнительных параметров**, чтобы ввести сертификаты клиента в поля **Клиент администратора** и **Клиент только для чтения**. В эти поля введите отпечаток сертификата клиента администратора и отпечаток сертификата клиента только для чтения (при наличии). Когда администраторы пытаются подключиться к кластеру, им предоставляется доступ только в том случае, если у них есть сертификат с отпечатком, соответствующим указанным здесь значениям.  

### <a name="4-summary"></a>4. сводка

Теперь вы готовы к развертыванию кластера. Перед этим скачайте сертификат. Для этого перейдите по ссылке в большом синем информационном поле. Сохраните сертификат в надежном месте. Он необходим для подключения к кластеру. Так как у скачанного сертификата нет пароля, рекомендуется добавить его.

Для завершения создания кластера щелкните **Создать**. При необходимости можно скачать шаблон.

![Резюме]

Ход создания кластера будет отображаться в области уведомлений. (Щелкните значок колокольчика рядом со строкой состояния в правом верхнем углу экрана.) Если вы щелкнули **закрепить в начальной панели** при создании кластера, вы увидите, что **Service Fabric кластер** будет закреплен на **начальной** доске. Этот процесс может занять некоторое время. 

Чтобы выполнить операции управления в кластере с помощью Powershell или CLI, необходимо подключиться к кластеру. Дополнительные сведения см. в статье [Безопасное подключение к кластеру](service-fabric-connect-to-secure-cluster.md).

## <a name="view-your-cluster-status"></a>Просмотр состояния кластера
![Снимок экрана сведений о кластере на панели мониторинга.][ClusterDashboard]

После создания кластера его можно просмотреть на портале.

1. Щелкните **Обзор** и выберите **Кластеры Service Fabric**.
2. Найдите нужный кластер и щелкните его.
3. На панели мониторинга отобразятся подробные сведения о кластере, включая общедоступную конечную точку кластера и ссылку на Service Fabric Explorer.

В разделе **Монитор узла** колонки панели мониторинга кластера отображается количество работоспособных и неработоспособных виртуальных машин. Дополнительные сведения о работоспособности кластера см. в статье о [Service Fabric модели исправности][service-fabric-health-introduction].

> [!NOTE]
> Для постоянной работы кластеров Service Fabric требуется определенное количество узлов, чтобы все время поддерживать доступность и сохранять состояние, которое называется "поддержание кворума". Таким образом, обычно не рекомендуется завершать работу всех компьютеров в кластере, пока не будет выполнено [полное резервное копирование состояния][service-fabric-reliable-services-backup-restore].
> 
> 

## <a name="remote-connect-to-a-virtual-machine-scale-set-instance-or-a-cluster-node"></a>Удаленное подключение к экземпляру из набора масштабирования виртуальных машин или узлу кластера
Каждый из типов узлов, задаваемый в кластере, отражается на конфигурации масштабируемого набора виртуальных машин. <!--See [Remote connect to a Virtual Machine Scale Set instance][remote-connect-to-a-vm-scale-set] for details. -->

## <a name="next-steps"></a>Дальнейшие действия
На этом этапе у вас имеется защищенный кластер, использующий сертификаты для аутентификации управления. Далее [подключитесь к этому кластеру](service-fabric-connect-to-secure-cluster.md) и узнайте, как [управлять секретами приложений](service-fabric-application-secret-management.md).  Кроме того, узнайте [о вариантах поддержки Service Fabric](service-fabric-support.md).

<!-- Links -->
[azure-powershell]: https://azure.microsoft.com/documentation/articles/powershell-install-configure/
[service-fabric-rp-helpers]: https://github.com/ChackDan/Service-Fabric/tree/master/Scripts/ServiceFabricRPHelpers
[azure-portal]: https://portal.azure.com/
[key-vault-get-started]: ../key-vault/key-vault-overview.md
[create-cluster-arm]: service-fabric-cluster-creation-via-arm.md
[service-fabric-cluster-security]: service-fabric-cluster-security.md
[service-fabric-cluster-security-roles]: service-fabric-cluster-security-roles.md
[service-fabric-cluster-capacity]: service-fabric-cluster-capacity.md
[service-fabric-cluster-durability]: service-fabric-cluster-capacity.md#the-durability-characteristics-of-the-cluster
[service-fabric-connect-and-communicate-with-services]: service-fabric-connect-and-communicate-with-services.md
[service-fabric-health-introduction]: service-fabric-health-introduction.md
[service-fabric-reliable-services-backup-restore]: service-fabric-reliable-services-backup-restore.md
[remote-connect-to-a-vm-scale-set]: service-fabric-cluster-nodetypes.md
[service-fabric-cluster-upgrade]: service-fabric-cluster-upgrade.md

<!--Image references-->
[SearchforServiceFabricClusterTemplate]: ./media/service-fabric-cluster-creation-via-portal/SearchforServiceFabricClusterTemplate.png
[CreateRG]: ./media/service-fabric-cluster-creation-via-portal/CreateRG.png
[CreateNodeType]: ./media/service-fabric-cluster-creation-via-portal/NodeType.png
[BasicSecurityConfigs]: ./media/service-fabric-cluster-creation-via-portal/BasicSecurityConfigs.PNG
[CreateKeyVault]: ./media/service-fabric-cluster-creation-via-portal/CreateKeyVault.PNG
[CreateKeyVault2]: ./media/service-fabric-cluster-creation-via-portal/CreateKeyVault2.PNG
[CreateKeyVault3]: ./media/service-fabric-cluster-creation-via-portal/CreateKeyVault3.PNG
[CreateKeyVault4]: ./media/service-fabric-cluster-creation-via-portal/CreateKeyVault4.PNG
[CertInfo0]: ./media/service-fabric-cluster-creation-via-portal/CertInfo0.PNG
[CertInfo1]: ./media/service-fabric-cluster-creation-via-portal/CertInfo1.PNG
[CertInfo2]: ./media/service-fabric-cluster-creation-via-portal/CertInfo2.PNG
[SecurityCustomOption]: ./media/service-fabric-cluster-creation-via-portal/SecurityCustomOption.PNG
[DownloadCert]: ./media/service-fabric-cluster-creation-via-portal/DownloadCert.PNG
[Сводка]: ./media/service-fabric-cluster-creation-via-portal/Summary.PNG
[SecurityConfigs]: ./media/service-fabric-cluster-creation-via-portal/SecurityConfigs.png
[Notifications]: ./media/service-fabric-cluster-creation-via-portal/notifications.png
[ClusterDashboard]: ./media/service-fabric-cluster-creation-via-portal/ClusterDashboard.png
[cluster-security-cert-installation]: ./media/service-fabric-cluster-creation-via-arm/cluster-security-cert-installation.png
