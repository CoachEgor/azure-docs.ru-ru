---
title: Доставка и повторная попытка - Azure Event Grid IoT Edge Документы Майкрософт
description: Доставка и повторная попытка в Event Grid на IoT Edge.
author: VidyaKukke
manager: rajarv
ms.author: vkukke
ms.reviewer: spelluru
ms.date: 10/29/2019
ms.topic: article
ms.service: event-grid
services: event-grid
ms.openlocfilehash: 7df283b12a0d04d2b785c13a2f12b03115581e79
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76841718"
---
# <a name="delivery-and-retry"></a>Доставка и повторные попытки доставки

Сетка событий обеспечивает надежную доставку. Он пытается доставить каждое сообщение по крайней мере один раз для каждой соответствующей подписки немедленно. Если конечная точка абонента не подтверждает получение события или если есть сбой, Event Grid повторно йлотисдоставкы на основе фиксированного **графика повтора** и **политики повтора.**  По умолчанию модуль Event Grid предоставляет абоненту одно событие одновременно. Полезная нагрузка, однако, представляет собой массив с одним событием. Модуль может доставить несколько событий одновременно, включив функцию вывода пакетирования. Подробную информацию об этой функции можно узнать в [пакете выходов.](delivery-output-batching.md)  

> [!IMPORTANT]
>Поддержка данных событий не сохраняется. Это означает, что передислокация или перезапуск модуля Event Grid приведет к потере любых событий, которые еще не доставлены.

## <a name="retry-schedule"></a>Расписание повтора

Event Grid ждет ответа до 60 секунд после доставки сообщения. Если конечная точка абонента не ACK ответ, то сообщение будет enqueued в одном из наших обратно от очередей для последующих повторов.

Есть две предварительно настроенные отстающие очереди, которые определяют расписание, по которому будет предпринята повторная попытка. К ним относятся:

| Расписание | Описание |
| ---------| ------------ |
| 1 минута | Сообщения, которые в конечном итоге здесь пытаются каждую минуту.
| 10 минут. | Сообщения, которые заканчиваются здесь, пытаются каждые 10-ю минуту.

### <a name="how-it-works"></a>Принцип работы

1. Сообщение поступает в модуль Event Grid. Предпринимается попытка доставить его немедленно.
1. Если доставка не удается, то сообщение заготавлив в 1-минутную очередь и повторно через минуту.
1. Если доставка продолжает сбой, то сообщение загонится в 10-минутную очередь и повторно перестраивается каждые 10 минут.
1. Поставки применяются до тех пор, пока не будут достигнуты ограничения политики повторной попытки.

## <a name="retry-policy-limits"></a>Ограничения политики повторного рейза

Существует две конфигурации, определяющие политику повторной попытки. К ним относятся:

* Максимальное количество попыток
* Время проведения мероприятия (TTL)

Событие будет удалено, если будет достигнут какой-либо из пределов политики повторной попытки. Сам график повторной работы был описан в разделе Расписание повтора. Конфигурация этих ограничений может быть выполнена либо для всех абонентов, либо для подписки. В следующем разделе описаны детали каждого из них.

## <a name="configuring-defaults-for-all-subscribers"></a>Настройка по умолчанию для всех абонентов

Есть два `brokers__defaultMaxDeliveryAttempts` свойства: `broker__defaultEventTimeToLiveInSeconds` и которые могут быть настроены как часть развертывания Event Grid, которая контролирует повторную попытку по умолчанию для всех абонентов.

| Имя свойства | Описание |
| ---------------- | ------------ |
| `broker__defaultMaxDeliveryAttempts` | Максимальное количество попыток доставить событие. Значение по умолчанию: 30.
| `broker__defaultEventTimeToLiveInSeconds` | Событие TTL в секундах, после которых событие будет удалено, если не доставлено. Значение по умолчанию: **7200** секунд

## <a name="configuring-defaults-per-subscriber"></a>Настройка по умолчанию на одного абонента

Вы также можете указать ограничения политики повторной притязаний на основе подписки.
Ознакомьтесь с нашей [документацией API](api.md) для получения информации о том, как настроить настройку по умолчанию на одного абонента. По умолчанию уровень подписки перекрывает конфигурации уровня модуля.

## <a name="examples"></a>Примеры

Следующий пример устанавливает политику повторной попытки в модуле Event Grid с maxNumberOfAttempts 3 и Событие TTL 30 минут

```json
{
  "Env": [
    "broker__defaultMaxDeliveryAttempts=3",
    "broker__defaultEventTimeToLiveInSeconds=1800"
  ],
  "HostConfig": {
    "PortBindings": {
      "4438/tcp": [
        {
          "HostPort": "4438"
        }
      ]
    }
  }
}
```

Следующий пример устанавливает подписку на веб-крючок с maxNumberOfAttempts No 3 и событие TTL 30 минут

```json
{
 "properties": {
  "destination": {
   "endpointType": "WebHook",
   "properties": {
    "endpointUrl": "<your_webhook_url>",
    "eventDeliverySchema": "eventgridschema"
   }
  },
  "retryPolicy": {
   "eventExpiryInMinutes": 30,
   "maxDeliveryAttempts": 3
  }
 }
}
```
