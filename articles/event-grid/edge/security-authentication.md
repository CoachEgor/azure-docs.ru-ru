---
title: Безопасность и аутентификация - Azure Event Grid IoT Edge Документы Майкрософт
description: Безопасность и аутентификация в Event Grid на IoT Edge.
author: VidyaKukke
manager: rajarv
ms.author: vkukke
ms.reviewer: spelluru
ms.date: 10/06/2019
ms.topic: article
ms.service: event-grid
services: event-grid
ms.openlocfilehash: 5dfa17fd702b76e2cfaa7a91066dbc6749c1069e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76844519"
---
# <a name="security-and-authentication"></a>Безопасность и проверка подлинности

Безопасность и аутентификация — это передовая концепция, которая требует в первую очередь знакомства с основами Event Grid. Начните [здесь,](concepts.md) если вы новичок в Event Grid на IoT Edge. Модуль Event Grid основывается на существующей инфраструктуре безопасности на IoT Edge. Обратитесь к [этой документации](../../iot-edge/security.md) для получения подробной информации и настройки.

В следующих разделах подробно описано, как эти параметры защищены и проверены:

* Конфигурация TLS
* Входящие проверки подлинности клиента
* Проверка подлинности исходящих серверов
* Исходящие проверки подлинности клиента

>[!IMPORTANT]
>Модуль безопасности и аутентификации модулей Event Grid - существующая инфраструктура, доступная на IoT Edge. Предполагается, что подсистема IoT Edge является безопасной.

>[!IMPORTANT]
>Конфигурация Event Grid **безопасна по умолчанию.** Следующие подразделы объясняют все варианты и возможное значение (ы), которые можно использовать для переопределения аспектов проверки подлинности. Поймите влияние перед внесением каких-либо изменений. Для того чтобы все изменения вступили в силу, модуль Event Grid должен быть передислоцирован.

## <a name="tls-configuration-aka-server-authentication"></a>Конфигурация TLS (также ака проверки подлинности сервера)

Модуль Event Grid содержит как конечные точки HTTP, так и HTTPS. Каждый модуль IoT Edge присваивается сертификатом сервера по модону безопасности IoT Edge. Мы используем сертификат сервера для обеспечения безопасности конечных точек. По истечении срока действия модуль автоматически обновляется с новым сертификатом от daemon безопасности IoT Edge.

По умолчанию допускается только сообщение HTTPS. Это поведение можно переопределить с помощью **inbound__serverAuth__tlsPolicy** конфигурации. Следующая таблица отражает возможное значение (ы) этого свойства.

| Возможные значения | Описание |
| ---------------- | ------------ |
| Strict | По умолчанию. Включает только HTTPS
| Активировано | Включает как HTTP, так и HTTPS
| Выключено | Включает только HTTP

## <a name="inbound-client-authentication"></a>Входящие проверки подлинности клиента

Клиенты являются субъектами, выполняющими управленческие и/или выполняемые операции. Клиентами могут быть другие модули IoT Edge, не-IoT-приложения.

Модуль Event Grid поддерживает два типа проверки подлинности клиента:

* Общая подпись доступа (SAS) на основе ключей
* сертификатна

По умолчанию модуль Event Grid настроен для приема только проверки подлинности на основе сертификатов. При запуске модуль Event Grid извлекает "TrustBundle" из daemon безопасности IoT Edge и использует его для проверки любого сертификата клиента. Сертификаты клиентов, которые не решаются `UnAuthorized`с этой цепочкой, будут отклонены.

### <a name="certificate-based-client-authentication"></a>Проверка подлинности клиента на основе сертификатов

Проверка подлинности на основе сертификатов ведется по умолчанию. Вы можете отключить проверку подлинности на основе сертификатов через **inbound__clientAuth__clientCert__enabled**собственности. Следующая таблица отражает возможное значение (ы).

| Возможные значения | Описание |
| ----------------  | ------------ |
| Да | По умолчанию. Требуется, чтобы все запросы в модуль Event Grid были представлены сертификатом клиента. Кроме того, вам нужно будет настроить **inbound__clientAuth__clientCert__source.**
| false | Не заставляйте клиента предъявить сертификат.

Следующая таблица отражает возможное значение (ы) для **inbound__clientAuth__clientCert__source**

| Возможные значения | Описание |
| ---------------- | ------------ |
| IoT Edge | По умолчанию. Использует Trustbundle IoT Edge для проверки всех сертификатов клиентов.

Если клиент представляет самоподписанную подпись, по умолчанию модуль Event Grid отклоняет такие запросы. Вы можете разрешить самостоятельно подписанные сертификаты клиента через **inbound__clientAuth__clientCert__allowUnknownCA** собственность. Следующая таблица отражает возможное значение (ы).

| Возможные значения | Описание |
| ----------------  | ------------|
| Да | По умолчанию. Позволяет успешно представить сертификаты, подписанные самостоятельно.
| false | Не будет запросов, если представлены самоподписанные сертификаты.

>[!IMPORTANT]
>В производственных сценариях может потребоваться установить **inbound__clientAuth__clientCert__allowUnknownCA** **на ложные.**

### <a name="sas-key-based-client-authentication"></a>Проверка подлинности клиента на основе ключей SAS

Помимо проверки подлинности на основе сертификатов, модуль Event Grid также может выполнять аутентификацию на основе SAS Key. Ключ SAS подостоит секрету, настроенной в модуле Event Grid, который он должен использовать для проверки всех входящих вызовов. Клиенты должны указать секрет в http Header 'aeg-sas-key'. Запрос будет отклонен, `UnAuthorized` если он не совпадает.

Конфигурация для управления подлинностью ключа SAS **inbound__clientAuth__sasKeys__enabled.**

| Возможные значения | Описание  |
| ----------------  | ------------ |
| Да | Позволяет sAS на основе ключей проверки подлинности. Требуется **inbound__clientAuth__sasKeys__key1** или **inbound__clientAuth__sasKeys__key2**
| false | По умолчанию. Проверка подлинности на основе SAS Key отключена.

 **inbound__clientAuth__sasKeys__key1** и **inbound__clientAuth__sasKeys__key2** являются ключами, которые настраивают модуль Event Grid для проверки на наличие входящих запросов. По крайней мере один из ключей должен быть настроен. Клиент, делающих запрос, должен будет представить ключ как часть заголовка запроса '**aeg-sas-key'.** Если оба ключа настроены, клиент может представить один из ключей.

> [!NOTE]
>Вы можете настроить оба метода проверки подлинности. В таком случае ключ SAS проверяется первым и только в случае сбоя выполняется проверка подлинности на основе сертификата. Для успешного запроса для успешного выполнения этого метода проверки подлинности должен быть успешным.

## <a name="outbound-client-authentication"></a>Исходящие проверки подлинности клиента

Клиент в исходящих контексте относится к модулю Event Grid. Выполняемые операции доставляют события подписчикам. Подписные модули рассматриваются как сервер.

Каждый модуль IoT Edge присваивается сертификатом идентификации по daemon безопасности IoT Edge. Мы используем удостоверение личности для исходящих звонков. По истечении срока действия модуль автоматически обновляется с новым сертификатом от daemon безопасности IoT Edge.

Конфигурация для управления исходящими проверками подлинности клиента **является outbound__clientAuth__clientCert__enabled.**

| Возможные значения | Описание |
| ----------------  | ------------ |
| Да | По умолчанию. Для представления сертификата требуется все исходящие запросы от модуля Event Grid. Потребности в настройке **outbound__clientAuth__clientCert__source.**
| false | Не требуйте от модуля Event Grid сертификата.

Конфигурация, контролирующая источник **сертификата, outbound__clientAuth__clientCert__source.**

| Возможные значения | Описание |
| ---------------- | ------------ |
| IoT Edge | По умолчанию. Использует сертификат идентификации модуля, настроенный на daemon безопасности IoT Edge.

### <a name="outbound-server-authentication"></a>Проверка подлинности исходящих серверов

Одним из типов назначения для абонента Event Grid является "Webhook". По умолчанию для таких абонентов принимаются только конечные точки HTTPS.

Конфигурация для управления политикой назначения webhook **outbound__webhook__httpsOnly.**

| Возможные значения | Описание |
| ----------------  | ------------ |
| Да | По умолчанию. Позволяет только абонентам с конечным пунктом HTTPS.
| false | Позволяет абонентам с помощью http или HTTPS endpoint.

По умолчанию модуль Event Grid будет проверять серверный сертификат абонента. Вы можете пропустить проверку, переопределив **outbound__webhook__skipServerCertValidation.** Возможны следующие значения:

| Возможные значения | Описание |
| ----------------  | ------------ |
| Да | Не проверяйте сертификат сервера абонента.
| false | По умолчанию. Проверка серверного сертификата абонента.

Если сертификат абонента подписан самостоятельно, то по умолчанию модуль Event Grid откажется от таких подписчиков. Чтобы позволить самостоятельно подписанному сертификату, вы можете переопределить **outbound__webhook__allowUnknownCA**. Следующая таблица отражает возможное значение (ы).

| Возможные значения | Описание |
| ----------------  | ------------ |
| Да | По умолчанию. Позволяет успешно представить сертификаты, подписанные самостоятельно.
| false | Не будет запросов, если представлены самоподписанные сертификаты.

>[!IMPORTANT]
>В производственных сценариях вы хотите установить **outbound__webhook__allowUnknownCA** **ложным.**

> [!NOTE]
>Среда IoT Edge генерирует сертификаты, подписанные самостоятельно. Рекомендация заключается в создании сертификатов, выданных авторизованными CAs для производственных нагрузок и установить **allowUnknownCA** свойство как на входящих и исходящих на **ложные**.

## <a name="summary"></a>Сводка

Модуль Event Grid **защищен по умолчанию.** Рекомендуем хранить эти значения по умолчанию для развертывания в производственном направлении.

Ниже приведены руководящие принципы для использования при настройке:

* Разрешить только запросы HTTPS в модуль.
* Разрешить только проверку подлинности клиента на основе сертификатов. Разрешить только те сертификаты, которые выдаются известными CAs. Запретить самоподписанные сертификаты.
* Запретить проверку подлинности клиента на основе SASKey.
* Всегда приспоивайте удостоверение личности модуля Event Grid на исходящих вызовах.
* Разрешить только httpS абонентов для типов назначения Webhook.
* Всегда проверяйте сертификат сервера абонента для типов назначения Webhook. Разрешить только сертификаты, выданные известными CAs. Запретить самоподписанные сертификаты.

По умолчанию модуль Event Grid развертывается со следующей конфигурацией:

 ```json
 {
  "Env": [
    "inbound__serverAuth__tlsPolicy=strict",
    "inbound__serverAuth__serverCert__source=IoTEdge",
    "inbound__clientAuth__sasKeys__enabled=false",
    "inbound__clientAuth__clientCert__enabled=true",
    "inbound__clientAuth__clientCert__source=IoTEdge",
    "inbound__clientAuth__clientCert__allowUnknownCA=true",
    "outbound__clientAuth__clientCert__enabled=true",
    "outbound__clientAuth__clientCert__source=IoTEdge",
    "outbound__webhook__httpsOnly=true",
    "outbound__webhook__skipServerCertValidation=false",
    "outbound__webhook__allowUnknownCA=true"
  ],
  "HostConfig": {
    "PortBindings": {
      "4438/tcp": [
        {
          "HostPort": "4438"
        }
      ]
    }
  }
}
```
