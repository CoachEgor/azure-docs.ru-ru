---
title: Сетевая безопасность для ресурсов Azure Event Grid
description: В этой статье описывается, как настроить доступ из частных конечных точек
services: event-grid
author: VidyaKukke
ms.service: event-grid
ms.topic: conceptual
ms.date: 03/11/2020
ms.author: vkukke
ms.openlocfilehash: ed3b70ad267252981110e7970bc5c5fad6cf4b4b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79300158"
---
# <a name="network-security-for-azure-event-grid-resources"></a>Сетевая безопасность для ресурсов Azure Event Grid
В этой статье описывается, как использовать следующие функции безопасности в Azure Event Grid: 

- Теги обслуживания для выход (предварительный просмотр)
- Правила IP Firewall для входа (предварительный просмотр)
- Частные конечные точки для входа (предварительный просмотр)


## <a name="service-tags"></a>Теги служб
Тег службы представляет собой группу префиксов IP-адресов из данной службы Azure. Корпорация Майкрософт управляет адресными префиксами, охватываемыми тегом службы, и автоматически обновляет тег службы по мере изменения адресов, снижая сложность частых обновлений правил сетевой безопасности. Для получения дополнительной информации о тегах услуг смотрите [обзор тегов службы](../virtual-network/service-tags-overview.md).

Теги служб можно использовать для определения элементов управления доступом к сети в  [группах сетевой безопасности](../virtual-network/security-overview.md#security-rules)или [Azure Firewall.](../firewall/service-tags.md) При создании правил безопасности используйте теги служб вместо конкретных IP-адресов. Указывая имя тега службы (например, **AzureEventGrid)** в соответствующем *поле источника* или *назначения* правила, можно разрешить или отклонить трафик для соответствующей службы.

| Сервисный тег | Назначение | Можно использовать входящие или исходящие? | Может быть региональным? | Можно ли использовать с Azure Firewall? |
| --- | -------- |:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| AzureEventGrid | Сетка событий Azure. <br/><br/>*Примечание:* Этот тег охватывает конечные точки Azure Event Grid в южной части США, на востоке США, в Восточном 2, На западе США 2 и только в Центральном районе США. | both | нет | нет |


## <a name="ip-firewall"></a>Брандмауэр IP-адресов 
Azure Event Grid поддерживает ip-элементы управления доступом для публикации в темах и доменах. С помощью IP-элементов управления можно ограничить издателей темой или доменом только набором утвержденных наборов машин и облачных служб. Эта функция дополняет [механизмы аутентификации,](security-authentication.md) поддерживаемые Event Grid.

По умолчанию тема и домен доступны из Интернета до тех пор, пока запрос поставляется с проверкой подлинности и авторизации. С помощью IP-брандмауэра его можно ограничить только набором IP-адресов или диапазонов IP-адресов в обозначении [CIDR (Classless Inter-Domain Routing).](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) Издатели, начиная с любого другого IP-адреса, будут отклонены и получат ответ 403 (Запрещенный).


## <a name="private-endpoints"></a>Частные конечные точки
Вы можете использовать [частные конечные точки,](../private-link/private-endpoint-overview.md) чтобы позволить проникновение событий непосредственно из виртуальной сети в ваши темы и домены надежно по [частной ссылке,](../private-link/private-link-overview.md) не проходя через общественный Интернет. Частная конечная точка — это специальный сетевой интерфейс для службы Azure в VNet. При создании частной конечной точки для вашей темы или домена обеспечивается безопасная связь между клиентами на Вашем VNet и ресурсе Event Grid. Частной конечной точке присваивается IP-адрес из диапазона IP-адресов вашего VNet. Соединение между частной конечной точкой и службой Event Grid использует безопасную частную ссылку.

![Диаграмма архитектуры](./media/network-security/architecture-diagram.png)

Использование частных конечных точек для ресурса Event Grid позволяет:

- Безопасный доступ к вашей теме или домену из сети VNet через магистральной сети Microsoft, в отличие от общедоступного Интернета.
- Безопасное подключение из закрытых сетей, которые подключаются к VNet с помощью VPN или ExpressRoutes с частными пирингами.

При создании частной конечной точки для темы или домена в VNet владелец ресурса отправляется запрос на согласие. Если пользователь, запрашивающий создание частной конечной точки, также является владельцем ресурса, этот запрос на согласие автоматически утверждается. В противном случае соединение находится в **состоянии ожидания** до утверждения. Приложения в VNet могут легко подключаться к службе Event Grid через частную конечную точку, используя те же строки соединения и механизмы авторизации, которые они использовали бы в противном случае. Владельцы ресурсов могут управлять запросами на согласие и частными конечными точками через вкладку **Private endpoints** для ресурса на портале Azure.

### <a name="connect-to-private-endpoints"></a>Подключение к частным конечным точкам
Издатели на VNet, использующие частную конечную точку, должны использовать ту же строку соединения для темы или домена, как клиенты, подключающиеся к публичной конечной точке. Разрешение DNS автоматически направляет соединения из VNet в тему или домен по частной ссылке. Event Grid создает [частную зону DNS,](../dns/private-dns-overview.md) присоединенную к VNet с необходимым обновлением для частных конечных точек, по умолчанию. Однако, если вы используете свой собственный DNS-сервер, возможно, потребуется внести дополнительные изменения в конфигурацию DNS.

### <a name="dns-changes-for-private-endpoints"></a>Изменения DNS для частных конечных точек
При создании частной конечной точки запись DNS CNAME для ресурса обновляется до псевдонима в поддомене с приставкой. `privatelink` По умолчанию создается частная зона DNS, которая соответствует поддомену частной ссылки. 

При решении темы или URL-адреса из-за пределов VNet с частной конечной точкой, он решает сятвую к общедоступной конечной точке службы. Записи ресурсов DNS для 'topicA', при ее разрешении **из-за пределов VNet,** размещающей частную конечную точку, будут:

| name                                          | Тип      | Значение                                         |
| --------------------------------------------- | ----------| --------------------------------------------- |  
| `topicA.westus.eventgrid.azure.net`             | CNAME     | `topicA.westus.privatelink.eventgrid.azure.net` |
| `topicA.westus.privatelink.eventgrid.azure.net` | CNAME     | \<azure трафик менеджер профиля\>

Вы можете отказать или контролировать доступ для клиента за пределами VNet через публичную конечную точку с помощью [брандмауэра IP.](#ip-firewall) 

При разрешении с VNet, где размещается частная конечная точка, URL-адрес темы или домена разрешается с IP-адресом частной конечной точки. Записи ресурсов DNS для темы 'topicA', при ее разрегулировании **изнутри VNet,** принимающей частную конечную точку, будут:

| name                                          | Тип      | Значение                                         |
| --------------------------------------------- | ----------| --------------------------------------------- |  
| `topicA.westus.eventgrid.azure.net`             | CNAME     | `topicA.westus.privatelink.eventgrid.azure.net` |
| `topicA.westus.privatelink.eventgrid.azure.net` | Объект         | 10.0.0.5

Такой подход позволяет получить доступ к теме или домену, используя одну и ту же строку подключения для клиентов в VNet, принимающих частные конечные точки, и клиентов за пределами VNet.

Если вы используете пользовательский DNS-сервер в вашей сети, клиенты могут решить F-DN для темы или конечная точка домена на частный IP-адрес конечных точек. Навлажив ажиотажный DNS-сервер, чтобы делегировать свой личный поддомен в частную зону DNS для VNet, или настроить записи A для `topicOrDomainName.regionName.privatelink.eventgrid.azure.net` с частным IP-адресом endpoint.

Рекомендуемое название зоны `privatelink.eventgrid.azure.net`DNS .

### <a name="private-endpoints-and-publishing"></a>Частные конечные точки и публикация

В следующей таблице описаны различные состояния частного соединения конечной точки и влияние на публикацию:

| Состояние соединения   |  Успешно публиковать (Да/Нет) |
| ------------------ | -------------------------------|
| Approved           | Да                            |
| Отклонено           | нет                             |
| Ожидает            | нет                             |
| Отключено       | нет                             |

Для успешной публикации должно быть **утверждено**состояние соединения частной конечных точек. Если соединение отклонено, оно не может быть одобрено с помощью портала Azure. Единственная возможность заключается в том, чтобы удалить соединение и создать новое.

## <a name="pricing-and-quotas"></a>Цены и квоты
**Частные конечные точки** доступны только с темами и доменами премиум-уровня. Event Grid позволяет создавать до 64 частных конечных соединений по теме или домену. Чтобы перейти от базового уровня к премиум-уровню, [см.](update-tier.md)

Функция **IP Firewall** доступна как в базовых, так и в премиум-уровнях Event Grid. Мы позволяем создавать до 16 правил IP Firewall по теме или домену.


## <a name="next-steps"></a>Дальнейшие действия
Вы можете настроить брандмауэр IP для ресурса Event Grid, чтобы ограничить доступ через общедоступный Интернет только из определенного набора IP-адресов или диапазонов IP-адресов. Для пошаговых инструкций [см.](configure-firewall.md)

Можно настроить частные конечные точки, чтобы ограничить доступ только из выбранных виртуальных сетей. Для пошаговых инструкций [см.](configure-private-endpoints.md)
