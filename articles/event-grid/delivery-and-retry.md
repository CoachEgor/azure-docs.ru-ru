---
title: Доставка и повторные попытки доставки сетки событий Azure
description: В статье описывается, как сетка событий Azure передает события и обрабатывает недоставленные сообщения.
services: event-grid
author: spelluru
ms.service: event-grid
ms.topic: conceptual
ms.date: 05/15/2019
ms.author: spelluru
ms.openlocfilehash: b4bfdd3e9cdf99314dc55907ba163adc6cd39423
ms.sourcegitcommit: 24fd3f9de6c73b01b0cee3bcd587c267898cbbee
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/20/2019
ms.locfileid: "65952885"
---
# <a name="event-grid-message-delivery-and-retry"></a>Доставка и повторные попытки доставки сообщений сетки событий

В этой статье описывается, как Сетка событий Azure обрабатывает события, когда доставка не подтверждена.

Сетка событий обеспечивает надежную доставку. Она обеспечивает доставку каждого сообщения по крайней мере один раз для каждой подписки. Отправка событий для зарегистрированных веб-перехватчиков каждой подписки осуществляется мгновенно. Если конечная точка не подтверждает получения события, "Сетка событий" предпринимает повторную попытку доставить событие.

Сейчас служба "Сетка событий Azure" отправляет каждое событие непосредственно подписчикам. Каждый подписчик получает массив с одним событием.

## <a name="retry-schedule-and-duration"></a>График повторных попыток и длительность

"Сетка событий" ожидает в течение 30 секунд ответ после доставки сообщения. Через 30 секунд Если конечная точка не отвечает, сообщение помещается в очередь для повторной попытки. Для доставки событий сетка событий использует политику экспоненциального увеличения задержки повтора. Сетка событий предпринимает повторные попытки доставки по следующему расписанию на наилучшим возможным образом:

- 10 с
- 30 секунд
- 1 минута
- 5 мин
- 10 минут
- 30 минут
- 1 час
- Каждый час в течение 24 часов

Если конечная точка отвечает в течение трех минут, "Сетка событий" будет пытаться удалить события из очереди повторного выполнения на наилучшим возможным образом, но по-прежнему могут быть получены повторяющиеся элементы.

Сетка событий добавляет небольшой случайный выбор для всех шагов повторных попыток и рационально пропустить некоторые повторных попыток, если конечной точки неработоспособна согласованно, работу в течение длительного периода или кажется перегруженным.

Для детерминированного поведения, задать срок жизни событий и попыток доставки max в [политики повтора подписки](manage-event-delivery.md).

По умолчанию служба "Сетка событий" завершает срок действия всех событий, которые не были доставлены в течение 24 часов. [Политику повтора можно настроить](manage-event-delivery.md) во время создания подписки на события. Укажите максимальное число попыток доставки (по умолчанию — 30) и срок жизни события (по умолчанию — 1440 минут).

## <a name="dead-letter-events"></a>События недоставленных сообщений

Когда службе "Сетка событий Azure" не удается доставить событие, она может отправлять его в учетною запись хранилища. Этот процесс называется перемещение в очередь недоставленных сообщений. По умолчанию в службе "Сетка событий Azure" не включено перемещение в очередь недоставленных сообщений. Чтобы его включить, необходимо указать учетную запись хранения недоставленных событий при создании подписки на событие. Можно извлекать события из этой учетной записи хранения, чтобы продолжать доставку.

"Сетка событий" отправляет событие расположение недоставленных в том случае, когда действие выполнялось все повторные попытки. Если "Сетка событий" получает код ответа 400 (ошибка запроса) или 413 (слишком большой запрос), она немедленно отправляет событие в конечную точку события недоставленных сообщений. Эти коды отклика указывают, что доставка события никогда не будет выполнена успешно.

Предусмотрена 5-минутная задержка между последней попыткой доставить событие и доставкой этого события в расположение недоставленных сообщений. Эта задержка предназначена для уменьшения количества операций в хранилище BLOB-объектов. Если расположение недоставленных сообщений недоступно в течение четырех часов, событие удаляется.

Прежде чем задать параметры расположения недоставленных сообщений, необходимо создать учетную запись хранения с контейнером. При создании подписки на событие необходимо ввести конечную точку для этого контейнера. Конечная точка имеет следующий формат: `/subscriptions/<subscription-id>/resourceGroups/<resource-group-name>/providers/Microsoft.Storage/storageAccounts/<storage-name>/blobServices/default/containers/<container-name>`

Может потребоваться получать уведомления, когда события был отправлен в расположение недоставленных сообщений. Чтобы использовать службу "Сетка событий Azure" для реагирования на недоставленные события, [создайте подписку на события](../storage/blobs/storage-blob-event-quickstart.md?toc=%2fazure%2fevent-grid%2ftoc.json) для хранилища больших двоичных объектов недоставленных сообщений. Каждый раз, когда ваше хранилище больших двоичных объектов недоставленных сообщений получает недоставленное событие, служба "Сетка событий Azure" уведомляет вашего обработчика. Обработчик отвечает действиями, которые необходимо предпринять для согласования недоставленных событий.

Пример настройки расположения недоставленных сообщений, см. в разделе [Недоставленные сообщения и политики повтора](manage-event-delivery.md).

## <a name="message-delivery-status"></a>Состояние доставки сообщения

Сетка событий использует коды ответов HTTP для подтверждения получения событий. 

### <a name="success-codes"></a>Коды успешной доставки

Следующие коды ответов HTTP указывают, что событие было успешно доставлено в веб-перехватчик. В этом случае сетка события считает доставку выполненной.

- 200 ОК
- 202 — принято

### <a name="failure-codes"></a>Коды сбоя доставки

Следующие коды ответов HTTP указывают на то, что попытка доставить событие завершилась сбоем.

- 400 — недопустимый запрос
- 401 — недостаточно прав
- 404 Не найдено
- 408 — истекло время ожидания запроса
- 413 — размер запрашиваемой сущности слишком большой
- 414 — слишком длинный универсальный код ресурса (URI)
- 429 — слишком много запросов
- 500 — Внутренняя ошибка сервера
- 503 — Служба недоступна
- 504 — Истекло время ожидания шлюза

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о том, как просмотреть состояние доставки событий, см. в статье [Мониторинг доставки сообщений Сетки событий](monitor-event-delivery.md).
* Чтобы настроить параметры доставки событий, см. в разделе [Недоставленные сообщения и политики повтора](manage-event-delivery.md).