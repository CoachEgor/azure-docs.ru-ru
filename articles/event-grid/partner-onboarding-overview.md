---
title: Подключение в качестве партнера Сетки событий Azure
description: Подключение в качестве типа партнерского раздела Сетки событий Azure. Сведения о модели ресурсов и процессе публикации для партнерских разделов.
services: event-grid
author: banisadr
ms.service: event-grid
ms.topic: conceptual
ms.date: 05/18/2020
ms.author: babanisa
ms.openlocfilehash: 2a1f35b86e21099c9fdd0397ae8a3b20aed3cd5d
ms.sourcegitcommit: 0690ef3bee0b97d4e2d6f237833e6373127707a7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83758832"
---
# <a name="onboard-as-an-azure-event-grid-partner"></a>Подключение в качестве партнера Сетки событий Azure

В этой статье описано, как в частном порядке использовать ресурсы партнера Сетки событий и как настроить общедоступный тип партнерского раздела.

Для использования типов ресурсов Сетки событий, связанных с публикацией событий в качестве партнера Сетки событий, не требуется специального разрешения. На самом деле, если вы собираетесь стать партнером, их можно использовать как для публикации событий в частном порядке в собственных Подписках Azure, так и для тестирования модели ресурсов.

## <a name="becoming-an-event-grid-partner"></a>Как стать партнером Сетки событий

Если вы хотите стать общедоступным партнером Сетки событий, сначала заполните [эту форму](https://aka.ms/gridpartnerform), а затем обратитесь к команде по Сетке событий по адресу [GridPartner@microsoft.com](mailto:gridpartner@microsoft.com).

## <a name="how-partner-topics-work"></a>Как работают партнерские разделы
Партнерские разделы используют существующую архитектуру, которая уже используется в службе "Сетка событий" для публикации событий из таких ресурсов Azure, как служба хранилища и Центр Интернета вещей. Затем для всех пользователей предоставляется общий доступ к этим средствам. Использование этих средств по умолчанию является частным только для Подписки Azure. Чтобы сделать события общедоступными, заполните приведенную выше форму и [обратитесь к команде Сетки событий](mailto:gridpartner@microsoft.com).

Партнерские разделы позволяют публиковать события в службе "Сетка событий Azure" для мультитенантного использования.

### <a name="onboarding-and-event-publishing-overview"></a>Общие сведения о подключении и публикации событий

#### <a name="partner-flow"></a>Партнерский поток

1. Создайте клиент Azure, если он еще не создан.
1. С помощью CLI создайте`partnerRegistration` Сетки событий. Этот ресурс включает такие сведения, как отображаемое имя, описание, универсальный код ресурса (URI) настройки и т. д.

    ![Создание партнерского раздела](./media/partner-onboarding-how-to/create-partner-registration.png)

1. Создайте один или несколько `partnerNamespaces` в каждом регионе, в котором необходимо опубликовать события. При этом служба "Сетка событий" подготовит конечную точку публикации (например, `https://contoso.westus-1.eventgrid.azure.net/api/events`) и ключи доступа.

    ![Создание пространства имен партнера](./media/partner-onboarding-how-to/create-partner-namespace.png)

1. Предоставьте клиентам возможность указать в системе, что им необходим партнерский раздел.
1. Обратитесь к команде Сетки событий, чтобы сообщить нам о том, что ваш тип партнерского раздела должен стать общедоступным.

#### <a name="customer-flow"></a>Поток клиента

1. Ваш клиент посетит портал Azure, чтобы отметить идентификатор подписки Azure и группу ресурсов, в которых они хотели бы создать партнерский раздел.
1. Клиент будет запрашивать партнерский раздел через вашу систему. В ответ вы создадите туннель событий для пространства имен партнера.
1. Служба "Сетка событий" создаст **ожидающий** партнерский раздел в подписке Azure и группе ресурсов клиента.

    ![Создание канала событий](./media/partner-onboarding-how-to/create-event-tunnel-partner-topic.png)

1. Клиент активирует партнерский раздел с помощью портала Azure. Теперь события могут передаваться из вашей службы в подписку Azure клиента.

    ![Активация партнерского раздела](./media/partner-onboarding-how-to/activate-partner-topic.png)

## <a name="resource-model"></a>Модель ресурсов

Ниже приведена модель ресурсов для партнерских разделов.

### <a name="partner-registrations"></a>Регистрация партнеров
* Ресурс: `partnerRegistrations`.
* Кем используется. Участники
* Описание. Записывает глобальные метаданные партнера SaaS (например, имя, отображаемое имя, описание, URI настройки).
    
    Создание и обновление регистрации партнера — это самостоятельная операция для партнеров. Эта возможность самостоятельной операции позволяет партнерам создавать и тестировать полный сквозной поток.
    
    Клиенты могут обнаруживать только утвержденные в Microsoft регистрации партнеров.
* Область. Создана в подписке Azure партнера. Метаданные видны клиентам после обеспечения открытого доступа.

### <a name="partner-namespaces"></a>Пространства имен партнеров
* Ресурс: partnerNamespaces.
* Кем используется. Участники
* Описание. Предоставляет региональный ресурс для публикации событий клиентов. Каждое пространство имен партнера имеет конечную точку публикации и ключи проверки подлинности. Пространство имен также представляет способ запроса партнерского раздела для данного клиента и создание списка активных клиентов.
* Область. Размещена в подписке партнера.

### <a name="event-channel"></a>Канал событий
* Ресурс: `partnerNamespaces/eventChannels`.
* Кем используется. Участники
* Описание. Туннели событий являются зеркальным отображением партнерского раздела клиента. Создав туннель событий и указав подписку Azure клиента и группу ресурсов в метаданных, вы отправляете в Сетку событий сигнал создать партнерский раздел для клиента. Служба "Сетка событий" выполнит вызов ARM для создания соответствующего партнерского раздела в подписке клиента. Партнерский раздел будет создан в состоянии "Ожидание". Между каждым туннелем событий и партнерским разделом существует связь "один к одному".
* Область. Размещена в подписке партнера.

### <a name="partner-topics"></a>Партнерские разделы
* Ресурс: `partnerTopics`.
* Кем используется. Клиенты
* Описание. Партнерские разделы похожи на пользовательские и системные разделы в Сетке событий. Каждый партнерский раздел связан с конкретным "источником" (например, `Contoso:myaccount`) и конкретным типом партнерского раздела (например, Contoso). Клиенты создают подписки на события в партнерском разделе для маршрутизации событий в различные обработчики событий.

    Клиенты не могут напрямую создать этот ресурс. Единственный способ создать партнерский раздел — выполнение операции партнера по созданию туннеля событий.
* Область. Размещена в подписке клиента.

### <a name="partner-topic-types"></a>Типы партнерских разделов
* Ресурс: `partnerTopicTypes`.
* Кем используется. Клиенты
* Описание. Типы партнерских разделов — это типы ресурсов на уровне клиента, позволяющие клиентам обнаруживать список утвержденных типов партнерских разделов. URL-адрес будет выглядеть следующим образом: https://management.azure.com/providers/Microsoft.EventGrid/partnerTopicTypes).
* Область. Global

## <a name="publishing-events-to-event-grid"></a>Публикация событий в Сетке событий
При создании пространства имен партнера в регионе Azure вы получите региональную конечную точку и соответствующие ключи проверки подлинности. Опубликуйте пакеты событий в этой конечной точке для всех туннелей событий клиентов в этом пространстве имен. На основе поля "источник" в событии Сетка событий Azure будет сопоставлять каждое событие с соответствующими партнерскими разделами.

### <a name="event-schema-cloudevents-v10"></a>Схема событий: CloudEvents версии 1.0
Опубликуйте события в службе "Сетка событий Azure" с помощью схемы CloudEvents 1.0. Сетка событий поддерживает как структурированный, так и пакетный режим. CloudEvents 1.0 — единственная поддерживаемая схема событий для пространств имен партнеров.

### <a name="example-flow"></a>Пример потока

1.  Служба публикации выполняет запрос HTTP POST к `https://contoso.westus2-1.eventgrid.azure.net/api/events?api-version=2018-01-01`.
2.  Добавьте в запрос значение заголовка aeg-sas-key, содержащее ключ для проверки подлинности. Этот ключ подготавливается во время создания пространства имен партнера. Например, допустимое значение заголовка — aeg-sas-key: VXbGWce53249Mt8wuotr0GPmyJ/nDT4hgdEj9DpBeRr38arnnm5OFg==.
3.  Задайте для заголовка Content-Type (Тип содержимого) значение application/cloudevents-batch+json; charset=UTF-8.
4.  Выполните запрос HTTP POST к указанному выше URL-адресу публикации с пакетом событий, соответствующих этому региону. Пример:

``` json
[
{
    "specversion" : "1.0-rc1",
    "type" : "com.contoso.ticketcreated",
    "source" : " com.contoso.account1",
    "subject" : "tickets/123",
    "id" : "A234-1234-1234",
    "time" : "2019-04-05T17:31:00Z",
    "comexampleextension1" : "value",
    "comexampleothervalue" : 5,
    "datacontenttype" : "application/json",
    "data" : {
          object-unique-to-each-publisher
    }
},
{
    "specversion" : "1.0-rc1",
    "type" : "com.contoso.ticketclosed",
    "source" : "https://contoso.com/account2",
    "subject" : "tickets/456",
    "id" : "A234-1234-1234",
    "time" : "2019-04-05T17:31:00Z",
    "comexampleextension1" : "value",
    "comexampleothervalue" : 5,
    "datacontenttype" : "application/json",
    "data" : {
          object-unique-to-each-publisher
    }
}
]
```

После отправки данных в конечную точку пространства имен партнера вы получите ответ. Ответ — это стандартный код ответа HTTP. Ниже приведены некоторые распространенные ответы:

| Результат                             | Ответ              |
|------------------------------------|-----------------------|
| Успешно                            | 200 ОК                |
| Неправильный формат данных события    | 400 — недопустимый запрос       |
| Недопустимый ключ доступа                 | 401 — недостаточно прав      |
| Неправильная конечная точка                 | 404 — не найдено         |
| Массив или событие превышает допустимый размер | 413 (слишком большой объем полезных данных) |

## <a name="reference"></a>Справочник

  * [Swagger](https://github.com/ahamad-MS/azure-rest-api-specs/blob/master/specification/eventgrid/resource-manager/Microsoft.EventGrid/preview/2020-04-01-preview/EventGrid.json)
  * [Шаблон ARM](https://docs.microsoft.com/azure/templates/microsoft.eventgrid/allversions)
  * [Схема шаблона ARM](https://github.com/Azure/azure-resource-manager-schemas/blob/master/schemas/2020-04-01-preview/Microsoft.EventGrid.json)
  * [Интерфейсы REST API](https://docs.microsoft.com/rest/api/eventgrid/version2020-04-01-preview/partnernamespaces)
  * [Расширение CLI](https://docs.microsoft.com/cli/azure/ext/eventgrid/?view=azure-cli-latest)

### <a name="sdks"></a>Пакеты SDK
  * [.NET](https://www.nuget.org/packages/Microsoft.Azure.Management.EventGrid/5.3.1-preview)
  * [Python](https://pypi.org/project/azure-mgmt-eventgrid/3.0.0rc6/)
  * [Java](https://search.maven.org/artifact/com.microsoft.azure.eventgrid.v2020_04_01_preview/azure-mgmt-eventgrid/1.0.0-beta-3/jar)
  * [Ruby](https://rubygems.org/gems/azure_mgmt_event_grid/versions/0.19.0)
  * [JS](https://www.npmjs.com/package/@azure/arm-eventgrid/v/7.0.0)
  * [GO](https://github.com/Azure/azure-sdk-for-go)


## <a name="next-steps"></a>Next Steps
- [Общие сведения о партнерских разделах](partner-topics-overview.md)
- [Форма подключения партнерских разделов](https://aka.ms/gridpartnerform)
- [Партнерский раздел Auth0](auth0-overview.md)
- [Использование партнерского раздела Auth0](auth0-how-to.md)
