---
title: Шлюз данных на территории для служб анализа Azure (ru) Документы Майкрософт
description: Локальный шлюз данных необходим тогда, когда сервер служб Analysis Services в Azure будет подключен к локальным источникам данных.
author: minewiskan
ms.service: azure-analysis-services
ms.topic: conceptual
ms.date: 01/21/2020
ms.author: owend
ms.reviewer: minewiskan
ms.openlocfilehash: 648646b6f973762245c344cd2629a874a219b170
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76310158"
---
# <a name="connecting-to-on-premises-data-sources-with-on-premises-data-gateway"></a>Подключение к источникам данных с помощью шлюза данных on-premises

Локальный шлюз данных обеспечивает защищенную передачу данных между локальными источниками данных и серверами служб Azure Analysis Services в облаке. В дополнение к работе с несколькими серверами аналитического анализа Azure в одном регионе, последняя версия шлюза также работает с приложениями Azure Logic Apps, Power BI, Power Apps и Power Automate. В то время как шлюз, который вы устанавливаете, одинаков во всех этих службах, службы анализа Azure и логические приложения имеют некоторые дополнительные шаги.

Информация, представленная здесь, специфична для работы служб анализа Azure с шлюзом данных. Чтобы узнать больше о шлюзе в целом и как он работает с другими службами, [см.](/data-integration/gateway/service-gateway-onprem)

Для служб анализа Azure настройка шлюза в первый раз представляет собой четырехсерийный процесс:

- **Скачивание и запуск программы установки.** На этом шаге устанавливается служба шлюза на компьютер организации. Войдите в Azure с помощью учетной записи своего [клиента](/previous-versions/azure/azure-services/jj573650(v=azure.100)#what-is-an-azure-ad-tenant) Azure AD. Учетные записи Azure B2B (гостевые) не поддерживаются.

- **Регистрация шлюза.** На этом шаге следует указать имя и ключ восстановления для шлюза и выбрать регион. Таким образом шлюз регистрируется в облачной службе шлюза. Ваш шлюз может быть зарегистрирован в любом регионе, но рекомендуется находиться в том же регионе, что и серверы аналитических служб. 

- **Создайте ресурс шлюза в Azure** - На этом этапе вы создаете ресурс шлюза в Azure.

- **Подключите свои серверы к ресурсу шлюза** - После того, как у вас есть шлюз ресурса, вы можете начать подключение серверов к нему. Вы можете подключить несколько серверов и другие ресурсы при условии, что они находятся в одном регионе.



## <a name="how-it-works"></a><a name="how-it-works"> </a>Как это работает
Установленный на компьютере в вашей организации шлюз работает как служба Windows, **локальный шлюз данных**. Эта локальная служба зарегистрирована в облачной службе шлюза с помощью служебной шины Azure. Затем для подписки Azure создается ресурс шлюза данных On-premises. Серверы аналитических служб Azure затем подключены к ресурсу шлюза Azure. Если моделям вашего сервера необходимо подключиться к локальным источникам данных для запросов или обработки, запрос и поток данных проходит через ресурс шлюза, служебную шину Azure, локальную службу локального шлюза данных и источники данных. 

![Принцип работы](./media/analysis-services-gateway/aas-gateway-how-it-works.png)

Запросы и поток данных

1. Облачная служба создает запрос с зашифрованными учетными данными для локального источника. Затем запрос отправляется в очередь, чтобы его обработал шлюз.
2. Облачная служба шлюза анализирует запрос и отправляет его в [служебную шину Azure](https://azure.microsoft.com/documentation/services/service-bus/).
3. Локальный шлюз данных опрашивает служебную шину Azure, чтобы проверить наличие ожидающих запросов.
4. Шлюз получает запрос, расшифровывает учетные данные и подключается к источникам данных, используя эти учетные данные.
5. Затем шлюз отправляет запрос к источнику данных для выполнения.
6. Результаты отправляются из источника данных обратно в шлюз, а затем в облачную службу и на сервер.

## <a name="installing"></a>Установка

При установке для среды анализа Azure важно следовать шагам, описанным в [установке, и настроить шлюз данных для служб анализа Azure.](analysis-services-gateway-install.md) Эта статья специфична для служб анализа Azure. Она включает в себя дополнительные шаги, необходимые для настройки ресурса шлюза данных в Azure и подключения сервера аналитических служб Azure к ресурсу.

## <a name="ports-and-communication-settings"></a>Порты и настройки связи

Шлюз создает исходящее подключение к служебной шине Azure. Он обменивается данными через исходящие порты: TCP 443 (по умолчанию), а также 5671, 5672 и 9350–9354.  Шлюзу не требуются входящие порты.

Возможно, потребуется включить IP-адреса для области данных в брандмауэр. Вы можете скачать [список IP-адресов центра обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=56519). Список обновляется раз в неделю. IP-адреса, перечисленные в списке центра обработки данных Azure, находятся в нотации CIDR. Дополнительные сведения о CIDR см. [здесь](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing).

Ниже приведены полностью квалифицированные доменные имена, используемые шлюзом.

| Имена доменов | Исходящие порты | Описание |
| --- | --- | --- |
| *.powerbi.com |80 |HTTP для скачивания установщика. |
| *.powerbi.com |443 |HTTPS |
| *.analysis.windows.net |443 |HTTPS |
| login.windows.net, login.live.com, aadcdn.msauth.net |443 |HTTPS |
| *.servicebus.windows.net |5671–5672 |Протокол AMQP |
| *.servicebus.windows.net |443, 9350–9354 |Прослушиватели ретрансляции служебной шины по протоколу TCP (порт 443 требуется для получения маркера контроля доступа). |
| *.frontend.clouddatahub.net |443 |HTTPS |
| *.core.windows.net |443 |HTTPS |
| login.microsoftonline.com |443 |HTTPS |
| *.msftncsi.com |443 |Используется для проверки подключения к Интернету, если шлюз недоступен для службы Power BI. |
| *.microsoftonline-p.com |443 |Используется для проверки подлинности в зависимости от конфигурации. |
| dc.services.visualstudio.com  |443 |Используется AppInsights для сбора телеметрии. |

### <a name="forcing-https-communication-with-azure-service-bus"></a><a name="force-https"></a>Принудительное использование протокола HTTPS для связи со служебной шиной Azure

Можно настроить шлюз для принудительного использования протокола HTTPS для связи со служебной шиной Azure вместо прямого подключения TCP. Однако это может значительно снизить производительность. Для этого можно отредактировать файл *Microsoft.PowerBI.DataMovement.Pipeline.GatewayCore.dll.config*, изменив значение `AutoDetect` на `Https`. Обычно этот файл находится в расположении *C:\Program Files\On-premises data gateway*.

```
<setting name="ServiceBusSystemConnectivityModeString" serializeAs="String">
    <value>Https</value>
</setting>
```

## <a name="next-steps"></a>Дальнейшие действия 

Следующие статьи включены в общий контент шлюза данных On-premises, который применяется ко всем службам, которые поддерживает шлюз:

* [На-предпосылки данных шлюз часто задаваемые вопросы](https://docs.microsoft.com/data-integration/gateway/service-gateway-onprem-faq)   
* [Использование приложения локального шлюза данных](https://docs.microsoft.com/data-integration/gateway/service-gateway-app)   
* [Администрирование на уровне клиента](https://docs.microsoft.com/data-integration/gateway/service-gateway-tenant-level-admin)
* [Настройка настроек прокси](https://docs.microsoft.com/data-integration/gateway/service-gateway-proxy)   
* [Настройка параметров связи](https://docs.microsoft.com/data-integration/gateway/service-gateway-communication)   
* [Настройка файлов журнала](https://docs.microsoft.com/data-integration/gateway/service-gateway-log-files)   
* [Устранение неполадок](https://docs.microsoft.com/data-integration/gateway/service-gateway-tshoot)
* [Отслеживание и оптимизация производительности шлюза](https://docs.microsoft.com/data-integration/gateway/service-gateway-performance)
