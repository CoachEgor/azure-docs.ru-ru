---
title: Управление ролями и пользователями базы данных в службах Azure Analysis Services | Документация Майкрософт
description: Узнайте, как управлять ролями и пользователями базы данных на сервере служб Analysis Services в Azure.
author: minewiskan
ms.service: azure-analysis-services
ms.topic: conceptual
ms.date: 04/15/2020
ms.author: owend
ms.reviewer: minewiskan
ms.openlocfilehash: b7e3cc2b9d35eafcb875efa167821a8e9ad80146
ms.sourcegitcommit: b55d7c87dc645d8e5eb1e8f05f5afa38d7574846
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81454209"
---
# <a name="manage-database-roles-and-users"></a>Управление ролями и пользователями базы данных

На уровне шаблона базы данных всем пользователям должна быть назначена роль. Роли определяют пользователей с определенными разрешениями для шаблона базы данных. Любой пользователь или группа безопасности, добавленные в роль, должны иметь учетную запись в клиенте Azure AD в одной подписке с сервером. 

Способ определения ролей отличается в зависимости от используемого средства, но на результат это не влияет.

Разрешения ролей включают следующие:
*  **Администратор**. Пользователи имеют полный набор прав в отношении базы данных. Роли базы данных с разрешениями администратора и администраторы сервера — это не одно и тоже.
*  **Процесс**. Пользователи могут подключаться к базе данных и выполнять операции обработки, а также анализировать данные шаблона базы данных.
*  **Чтение**. Пользователи могут использовать клиентское приложение, чтобы подключиться к шаблону базы данных и анализировать его данные.

При создании проекта табликовой модели вы создаете роли и добавляете пользователей или групп к этим ролям, используя Role Manager в Visual Studio с проектами аналитических служб. При развертывании на сервере используйте студию управления серверами S'L (SSMS), [аналитические службы PowerShell cmdlets](https://docs.microsoft.com/analysis-services/powershell/analysis-services-powershell-reference)или [язык сценариев табулярной модели](https://docs.microsoft.com/analysis-services/tmsl/tabular-model-scripting-language-tmsl-reference) (TMSL) для добавления или удаления ролей и пользователей.

При добавлении **группы безопасности**используйте `obj:groupid@tenantid`.

## <a name="to-add-or-manage-roles-and-users-in-visual-studio"></a>Добавление или управление ролями и пользователями в Visual Studio  
  
1.  В **Tabular Model Explorer**, правой кнопкой **роли**.  
  
2.  В **роли менеджера**, нажмите **Новый**.  
  
3.  Введите имя для роли.  
  
     По умолчанию имя стандартной роли последовательно нумеруется для каждой новой роли. Мы рекомендуем ввести имя, которое четко определяет тип участника, например "Финансовые менеджеры" или "Специалисты по кадровым вопросам".  
  
4.  Выберите одно из следующих разрешений:  
  
    |Разрешение|Описание|  
    |----------------|-----------------|  
    |**Нет**|Участники не могут читать или изменять схему модели и не могут зазировать данные.|  
    |**Чтение**|Участники могут запрашивать данные (на основе фильтров строк), но не могут изменять схему шаблона.|  
    |**Чтение и обработка**|Участники могут запрашивать данные (на основе фильтров на уровне строк), а также выполнять операции обработки и массовой обработки, но не могут изменять схему шаблона.|  
    |**Процесс**|Члены могут выполнять операции «Обработать» и «Обработать все». Не удается прочитать или изменить схему модели и не задавить данные.|  
    |**Администратора**|Участники могут изменять схему шаблона и выполнять запрос всех данных.|   
  
5.  Если у роли, которую вы создаете, есть разрешения "Чтение" или "Чтение и обработка", вы можете добавить фильтры строк с помощью формулы DAX. Щелкните вкладку **Фильтры строк**, выберите таблицу, а затем щелкните поле **Фильтр DAX** и введите формулу DAX.
  
6.  Нажмите **Участники** > **Добавить Внешние**.  
  
8.  В разделе **Добавить внешнего участника** введите пользователей или группы в клиенте Azure AD, указав адреса электронной почты. После того как вы нажмете кнопку "ОК" и закроете диспетчер ролей, роли и участники ролей появятся в обозревателе табличных моделей. 
 
     ![Роли и пользователи в обозревателе табличных моделей](./media/analysis-services-database-users/aas-roles-tmexplorer.png)

9. Выполните развертывание на сервере Azure Analysis Services.


## <a name="to-add-or-manage-roles-and-users-in-ssms"></a>Добавление ролей и пользователей в SSDT и управление ими

Чтобы добавить роли и пользователей в развернутый шаблон базы данных, вы должны быть подключены к серверу от имени администратора сервера или роли базы данных с разрешениями администратора.

1. В объекте Exporer, правой кнопкой **мыши Роли** > **Новая роль**.

2. В области **Создание роли** введите имя и описание роли.

3. Выберите разрешение.

   |Разрешение|Описание|  
   |----------------|-----------------|  
   |**Полный доступ (администратор)**|Участники могут изменять схему шаблона, обрабатывать и запрашивать все данные.| 
   |**Process Database**|Члены могут выполнять операции «Обработать» и «Обработать все». Не могут изменять схему модели и просматривать данные.|  
   |**Чтение**|Участники могут запрашивать данные (на основе фильтров строк), но не могут изменять схему шаблона.|  
  
4. Щелкните **Членство**, а затем введите пользователя или группу в клиенте Azure AD, указав адрес электронной почты.

     ![Добавление пользователя](./media/analysis-services-database-users/aas-roles-adduser-ssms.png)

5. Если у роли, которую вы создаете, есть разрешение "Чтение", вы можете добавить фильтры строк с помощью формулы DAX. Щелкните **Фильтры строк**, выберите таблицу, а затем введите формулу DAX в поле **Фильтр DAX**. 

## <a name="to-add-roles-and-users-by-using-a-tmsl-script"></a>Добавление ролей и пользователей с помощью сценария TMSL

Вы можете выполнить сценарий TMSL в окне XMLA в SSMS или с помощью PowerShell. Используйте команду [CreateOrReplace](https://docs.microsoft.com/analysis-services/tmsl/createorreplace-command-tmsl) и объект [Роли](https://docs.microsoft.com/analysis-services/tmsl/roles-object-tmsl).

**Пример скрипта TMSL**

В этом примере внешний пользователь B2B и группа добавляются в роль "Аналитик" с разрешениями на чтение для базы данных SalesBI. Внешний пользователь и группа должны находиться в одном клиенте Azure AD.

```
{
  "createOrReplace": {
    "object": {
      "database": "SalesBI",
      "role": "Analyst"
    },
    "role": {
      "name": "Users",
      "description": "All allowed users to query the model",
      "modelPermission": "read",
      "members": [
        {
          "memberName": "user1@contoso.com",
          "identityProvider": "AzureAD"
        },
        {
          "memberName": "group1@adventureworks.com",
          "identityProvider": "AzureAD"
        }
      ]
    }
  }
}
```

## <a name="to-add-roles-and-users-by-using-powershell"></a>Добавление ролей и пользователей с помощью PowerShell

Модуль [SqlServer](https://docs.microsoft.com/analysis-services/powershell/analysis-services-powershell-reference) предоставляет командлеты для конкретных задач управления базой данных, а также командлет общего назначения Invoke-ASCmd, который принимает запрос TMSL или сценарий. Следующие командлеты используются для управления ролями базы данных и пользователями.
  
|Командлет|Описание|
|------------|-----------------| 
|[Адди-РольМбер](https://docs.microsoft.com/powershell/module/sqlserver/Add-RoleMember)|Добавление участника в роль базы данных.| 
|[Remove-RoleMember](https://docs.microsoft.com/powershell/module/sqlserver/remove-rolemember)|Удаление участника из роли базы данных.|   
|[Invoke-ASCmd](https://docs.microsoft.com/powershell/module/sqlserver/invoke-ascmd)|Выполнение сценария TMSL.|

## <a name="row-filters"></a>Фильтры строк  

Фильтры строк определяют, какие строки в таблице могут запросить участники определенной роли. Фильтры строк для каждой таблицы модели определяются с помощью формул DAX.  
  
Они могут быть определены только для ролей с разрешениями "Чтение" и "Чтение и обработка". По умолчанию если фильтр строк не определен для конкретной таблицы, участники могут запросить все строки в таблице при условии, что не применена перекрестная фильтрация из другой таблицы.
  
 Фильтрам строк требуется формула DAX, которая должна возвращать значение TRUE или FALSE, чтобы определить строки, которые могут запросить участники этой определенной роли. Строки, не включенные в формулу DAX, запросить нельзя. Например, таблица Клиентов со следующим выражением фильтров строки, *«Клиенты» (страна) и «США»,* участники роли продаж могут видеть только клиентов в США.  
  
Фильтры строк применяются к указанным строкам и связанным с ними строкам. Когда таблица содержит несколько связей, фильтры применяют защиту к связи, которая является активной. Фильтры строк пересекаются с другими фильтрами строк, определенными для связанных таблиц, например:  
  
|Таблица|Выражение DAX|  
|-----------|--------------------|  
|Регион|=Region[Country]="USA"|  
|Категория продукта|=ProductCategory[Name]="Bicycles"|  
|Transactions|=Transactions[Year]=2016|  
  
 В конечном результате участники могут запрашивать следующие строки данных: для региона — США, для категории продукта — велосипед, для года — 2016. Пользователи не могут запрашивать транзакции за пределами США, транзакции, не связанные с велосипедами, а также транзакции, произошедшие не в 2016 году, пока они не станут участниками другой роли, предоставляющей эти разрешения.
  
 Вы можете использовать фильтр *=FALSE()*, чтобы запретить доступ ко всем строкам для всей таблицы.

## <a name="next-steps"></a>Следующие шаги

  [Управление администраторами серверов](analysis-services-server-admins.md)   
  [Управление службами Azure Analysis Services с помощью PowerShell](analysis-services-powershell.md)  
  [Справочник по языку TMSL](https://docs.microsoft.com/analysis-services/tmsl/tabular-model-scripting-language-tmsl-reference)

