---
title: Перемещение учетной записи службы автоматизации Azure в другую подписку
description: В этой статье описывается перемещение учетной записи службы автоматизации в другую подписку.
services: automation
ms.service: automation
ms.subservice: process-automation
author: mgoedtel
ms.author: magoedte
ms.date: 03/11/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 1aa759a2984764169eb28935e095d0f7c0f90c08
ms.sourcegitcommit: 3dc1a23a7570552f0d1cc2ffdfb915ea871e257c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75969826"
---
# <a name="move-your-azure-automation-account-to-another-subscription"></a>Перемещение учетной записи службы автоматизации Azure в другую подписку

Azure предоставляет возможность перемещения некоторых ресурсов в новую группу ресурсов или подписку. Ресурсы можно перемещать с помощью портал Azure, PowerShell, Azure CLI или REST API. Дополнительные сведения о процессе см. в статье [Перемещение ресурсов в новую группу ресурсов или подписку](../../azure-resource-manager/management/move-resource-group-and-subscription.md).

Учетные записи службы автоматизации Azure — это один из ресурсов, которые можно переместить. В этой статье вы узнаете, как переместить учетные записи автоматизации в другой ресурс или подписку.

Ниже приведены общие действия по перемещению учетной записи службы автоматизации.

1. Удалите свои решения.
2. Удалить связь с рабочей областью.
3. Перемещение учетной записи службы автоматизации.
4. Удалите и повторно создайте учетные записи запуска от имени.
5. Повторно включите решения.

## <a name="remove-solutions"></a>Удалить решения

Чтобы отменить связь рабочей области с учетной записью службы автоматизации, необходимо удалить эти решения из рабочей области:
- **Отслеживание изменений и Инвентаризация**
- **Управление обновлениями**
- **Запуск и завершение виртуальных машин в нерабочее время**

В группе ресурсов найдите каждое решение и выберите **Удалить**. На странице **удаление ресурсов** подтвердите ресурсы, которые необходимо удалить, и выберите **Удалить**.

![Удаление решений из портал Azure](../media/move-account/delete-solutions.png)

Эту же задачу можно выполнить с помощью командлета [Remove-AzureRmResource](/powershell/module/azurerm.resources/remove-azurermresource) , как показано в следующем примере:

```azurepowershell-interactive
$workspaceName = <myWorkspaceName>
$resourceGroupName = <myResourceGroup>
Remove-AzureRmResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "ChangeTracking($workspaceName)" -ResourceGroupName $resourceGroupName
Remove-AzureRmResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "Updates($workspaceName)" -ResourceGroupName $resourceGroupName
Remove-AzureRmResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "Start-Stop-VM($workspaceName)" -ResourceGroupName $resourceGroupName
```

### <a name="additional-steps-for-startstop-vms"></a>Дополнительные действия для запуска и отмены виртуальных машин

Для решения " **Запуск и завершение виртуальных машин** " необходимо также удалить правила генерации оповещений, созданные решением.

В портал Azure перейдите к группе ресурсов и выберите **мониторинг** > **оповещения** > **Управление правилами оповещений**.

![Страница "оповещения", на которой показаны выбранные правила оповещений](../media/move-account/alert-rules.png)

На странице **правила** вы увидите список оповещений, настроенных в этой группе ресурсов. Решение " **Запуск и завершение виртуальных машин** " создает три правила генерации оповещений:

* AutoStop_VM_Child
* ScheduledStartStop_Parent
* SequencedStartStop_Parent

Выберите эти три правила генерации оповещений, а затем нажмите кнопку **Удалить**. Это действие удалит эти правила генерации оповещений.

![Страница правил, запрашивающая подтверждение удаления для выбранных правил](../media/move-account/delete-rules.png)

> [!NOTE]
> Если на странице **правила** не отображаются правила генерации оповещений, измените **состояние** , чтобы показать **Отключенные** оповещения, так как они могли быть отключены.

Когда правила генерации оповещений будут удалены, удалите группу действий, созданную для уведомлений о решении " **Запуск и завершение виртуальных машин** ".

В портал Azure выберите **мониторинг** > **оповещения** > **Управление группами действий**.

Выберите **StartStop_VM_Notification** из списка. На странице Группа действий выберите **Удалить**.

![Страница "Группа действий" выберите Удалить.](../media/move-account/delete-action-group.png)

Аналогичным образом можно удалить группу действий с помощью PowerShell с командлетом [Remove-azurermactiongroup:](/powershell/module/azurerm.insights/remove-azurermactiongroup) , как показано в следующем примере:

```azurepowershell-interactive
Remove-AzureRmActionGroup -ResourceGroupName <myResourceGroup> -Name StartStop_VM_Notification
```

## <a name="unlink-your-workspace"></a>Отмена связи с рабочей областью

В портал Azure выберите **учетная запись службы автоматизации** > **связанные ресурсы** > **связанная Рабочая область**. Выберите **Удалить связь с рабочей областью** , чтобы отменить связь рабочей области с учетной записью службы автоматизации.

![Отмена связи рабочей области с учетной записью службы автоматизации](../media/move-account/unlink-workspace.png)

## <a name="move-your-automation-account"></a>Перемещение учетной записи службы автоматизации

После удаления предыдущих элементов можно продолжить удаление учетной записи службы автоматизации и ее модулей Runbook. В портал Azure перейдите к группе ресурсов учетной записи службы автоматизации. Выберите **переместить** > **переместить в другую подписку**.

![Страница "Группа ресурсов": перемещение в другую подписку](../media/move-account/move-resources.png)

Выберите ресурсы в группе ресурсов, которые необходимо переместить. Убедитесь, что вы включили **учетную запись службы автоматизации**, **Runbook**и **log Analytics ресурсы рабочей области** .

После завершения перемещения необходимо выполнить дополнительные действия, чтобы сделать все работу.

## <a name="re-create-run-as-accounts"></a>Повторное создание учетных записей запуска от имени

[Учетные записи запуска от имени](../manage-runas-account.md) создают субъект-службу в Azure Active Directory для проверки подлинности с помощью ресурсов Azure. При изменении подписок учетная запись службы автоматизации больше не использует существующую учетную запись запуска от имени.

Перейдите к учетной записи службы автоматизации в новой подписке и выберите **учетные записи запуска от имени** в разделе **Параметры учетной записи**. Вы увидите, что учетные записи запуска от имени отображаются как незавершенные сейчас.

![Учетные записи запуска от имени неполны](../media/move-account/run-as-accounts.png)

Выберите каждую учетную запись запуска от имени. На странице **Свойства** выберите **Удалить** , чтобы удалить учетную запись запуска от имени.

> [!NOTE]
> Если у вас нет разрешений на создание или Просмотр учетных записей запуска от имени, вы увидите следующее сообщение: `You do not have permissions to create an Azure Run As account (service principal) and grant the Contributor role to the service principal.`, чтобы узнать о разрешениях, необходимых для настройки учетной записи запуска от имени, см. раздел [разрешения, необходимые для настройки учетных записей запуска от имени](../manage-runas-account.md#permissions).

После удаления учетных записей запуска от имени выберите **создать** в разделе **учетная запись запуска от имени Azure**. На странице **Добавление учетной записи запуска от имени Azure** выберите **создать** , чтобы создать учетную запись запуска от имени и субъект-службу. Повторите предыдущие шаги с **классической учетной записью запуска от имени Azure**.

## <a name="enable-solutions"></a>включение решений;

После повторного создания учетных записей запуска от имени вы повторно включите решения, удаленные до перемещения. Чтобы включить **Отслеживание изменений и инвентаризацию** и **Управление обновлениями**, выберите соответствующую возможность в учетной записи службы автоматизации. Выберите Log Analytics рабочую область, которую вы переместили, и нажмите кнопку **включить**.

![Повторное включение решений в перемещенной учетной записи службы автоматизации](../media/move-account/reenable-solutions.png)

Компьютеры, подключенные к решениям, будут отображаться при подключении существующей рабочей области Log Analytics.

Чтобы включить в решение " **Запуск и завершение виртуальных машин** в нерабочее время", необходимо повторно развернуть решение. В разделе **связанные ресурсы**выберите **Запуск и завершение виртуальных машин** > **получите дополнительные сведения о решении** > **CREATE** для запуска развертывания и включите его.

На странице **Добавление решения** выберите рабочую область log Analytics и учетную запись службы автоматизации.

![Меню добавления решений](../media/move-account/add-solution-vm.png)

Подробные инструкции по настройке решения см. в статье [Запуск и остановка виртуальных машин в нерабочее время решение в службе автоматизации Azure](../automation-solution-vm-management.md).

## <a name="post-move-verification"></a>Проверка после перемещения

После завершения перемещения проверьте следующий список задач, которые необходимо проверить:

|Возможность|Тесты|Ссылка для устранения неполадок|
|---|---|---|
|Модули runbook|Модуль Runbook может быть успешно запущен и подключен к ресурсам Azure.|[Устранение неполадок с модулями Runbook](../troubleshoot/runbooks.md)
|Система управления версиями|Вы можете выполнить синхронизацию вручную в репозитории системы управления версиями.|[Интеграция системы управления версиями](../source-control-integration.md)|
|Отслеживание изменений и Инвентаризация|Убедитесь, что вы видите текущие данные инвентаризации с ваших компьютеров.|[Устранение неполадок отслеживания изменений](../troubleshoot/change-tracking.md)|
|Управление обновлениями|Убедитесь, что вы видите свои компьютеры, и они находятся в работоспособном состоянии.</br>Запустите тестовое развертывание обновлений программного обеспечения.|[Устранение неполадок управления обновлениями](../troubleshoot/update-management.md)|
|Общие ресурсы|Убедитесь, что отображаются все общие ресурсы, такие как [учетные данные](../shared-resources/credentials.md), [переменные](../shared-resources/variables.md)и т. д.|

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о перемещении ресурсов в Azure см. в статье [Перемещение ресурсов в Azure](../../azure-resource-manager/management/move-support-resources.md).
