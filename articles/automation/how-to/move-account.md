---
title: Перемещение учетной записи службы автоматизации Azure в другую подписку
description: В этой статье описывается, как переместить учетную запись службы автоматизации в другую подписку.
services: automation
ms.service: automation
ms.subservice: process-automation
author: mgoedtel
ms.author: magoedte
ms.date: 03/11/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: bfb2f2d1d0f6a0d11784847344cd3dbcafdb0959
ms.sourcegitcommit: 0fda81f271f1a668ed28c55dcc2d0ba2bb417edd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2020
ms.locfileid: "82900999"
---
# <a name="move-your-azure-automation-account-to-another-subscription"></a>Перемещение учетной записи службы автоматизации Azure в другую подписку

Служба автоматизации Azure позволяет перемещать некоторые ресурсы в новую группу ресурсов или подписку. Ресурсы можно перемещать с помощью портал Azure, PowerShell, Azure CLI или REST API. Дополнительные сведения о процессе см. в статье [Перемещение ресурсов в новую группу ресурсов или подписку](../../azure-resource-manager/management/move-resource-group-and-subscription.md).

Учетная запись службы автоматизации — это один из ресурсов, которые можно переместить. Из этой статьи вы узнаете, как переместить учетные записи автоматизации в другой ресурс или подписку. Ниже приведены общие действия по перемещению учетной записи службы автоматизации.

1. Удалите свои решения.
2. Удалить связь с рабочей областью.
3. Перемещение учетной записи службы автоматизации.
4. Удалите и повторно создайте учетные записи запуска от имени.
5. Повторно включите решения.

>[!NOTE]
>В этой статье вы работаете с модулем Azure PowerShell AZ. Вы по-прежнему можете использовать модуль AzureRM. Дополнительные сведения о совместимости с модулем AZ и AzureRM см. [в статье Знакомство с новым модулем Azure PowerShell AZ](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0). Инструкции по установке AZ Module в гибридной рабочей роли Runbook см. в статье [Установка модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0). Для учетной записи службы автоматизации модули можно обновить до последней версии, используя [обновление модулей Azure PowerShell в службе автоматизации Azure](../automation-update-azure-modules.md).

## <a name="remove-solutions"></a>Удалить решения

Чтобы отменить связь рабочей области с учетной записью службы автоматизации, необходимо удалить эти решения из рабочей области:

- Отслеживание изменений и инвентаризация
- Управление обновлениями
- Запуск и остановка виртуальных машин в нерабочее время

1. Найдите группу ресурсов на портале Azure.
2. Найдите каждое решение и выберите **Удалить** на странице **удаление ресурсов** .

    ![Снимок экрана: удаление решений из портал Azure](../media/move-account/delete-solutions.png)

При желании вы можете удалить решения с помощью командлета [Remove-азресаурце](https://docs.microsoft.com/powershell/module/Az.Resources/Remove-AzResource?view=azps-3.7.0) :

```azurepowershell-interactive
$workspaceName = <myWorkspaceName>
$resourceGroupName = <myResourceGroup>
Remove-AzResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "ChangeTracking($workspaceName)" -ResourceGroupName $resourceGroupName
Remove-AzResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "Updates($workspaceName)" -ResourceGroupName $resourceGroupName
Remove-AzResource -ResourceType 'Microsoft.OperationsManagement/solutions' -ResourceName "Start-Stop-VM($workspaceName)" -ResourceGroupName $resourceGroupName
```

### <a name="remove-alert-rules-for-the-startstop-vms-during-off-hours-solution"></a>Удаление правил генерации оповещений для решения "запуск/завершение виртуальных машин в нерабочее время"

Для этого решения также необходимо удалить правила генерации оповещений, созданные решением.

1. В портал Azure перейдите к группе ресурсов и выберите **мониторинг** > **оповещения** > **Управление правилами оповещений**.

   ![Снимок экрана: страница "оповещения", в которой отображаются выбранные правила оповещений](../media/move-account/alert-rules.png)

2. На странице **правила** вы увидите список оповещений, настроенных в этой группе ресурсов. Решение создает следующие правила.

    * AutoStop_VM_Child
    * ScheduledStartStop_Parent
    * SequencedStartStop_Parent

3. Выберите правила по одному, а затем нажмите кнопку **Удалить** , чтобы удалить их.

    ![Снимок экрана страницы правил с запросом подтверждения удаления для выбранных правил](../media/move-account/delete-rules.png)

    > [!NOTE]
    > Если на странице **правила** не отображаются правила генерации оповещений, измените значение поля **состояние** на **отключено** , чтобы показать отключенные оповещения. Возможно, вы отключили их.

4. При удалении правил генерации оповещений необходимо удалить группу действий, созданную для уведомлений решения "запуск/завершение виртуальных машин в нерабочее время". В портал Azure выберите **монитор** > **оповещения** > **Управление группами действий**.

5. Выберите **StartStop_VM_Notification**. 

6. На странице Группа действий выберите **Удалить**.

    ![Снимок экрана со страницей "Группа действий"](../media/move-account/delete-action-group.png)

При желании вы можете удалить группу действий с помощью командлета [Remove-азактионграуп](https://docs.microsoft.com/powershell/module/az.monitor/remove-azactiongroup?view=azps-3.7.0) :

```azurepowershell-interactive
Remove-AzActionGroup -ResourceGroupName <myResourceGroup> -Name StartStop_VM_Notification
```

## <a name="unlink-your-workspace"></a>Отмена связи с рабочей областью

Теперь вы можете удалить связь с рабочей областью:

1. В портал Azure выберите**связанная Рабочая область** > **связанные ресурсы** >  **учетной записи службы автоматизации**. 

2. Выберите **Удалить связь с рабочей областью** , чтобы отменить связь рабочей области с учетной записью службы автоматизации.

    ![Снимок экрана: отмена связи рабочей области с учетной записью службы автоматизации](../media/move-account/unlink-workspace.png)

## <a name="move-your-automation-account"></a>Перемещение учетной записи службы автоматизации

Теперь вы можете переместить учетную запись службы автоматизации и ее модули Runbook. 

1. В портал Azure перейдите к группе ресурсов учетной записи службы автоматизации. Выберите **переместить** > **переместить в другую подписку**.

    ![Снимок экрана: страница "Группа ресурсов", перемещение в другую подписку](../media/move-account/move-resources.png)

2. Выберите ресурсы в группе ресурсов, которые необходимо переместить. Убедитесь, что вы включили учетную запись службы автоматизации, модули Runbook и ресурсы рабочей области Log Analytics.

## <a name="re-create-run-as-accounts"></a>Повторное создание учетных записей запуска от имени

[Учетные записи запуска от имени](../manage-runas-account.md) создают субъект-службу в Azure Active Directory для проверки подлинности с помощью ресурсов Azure. При изменении подписок учетная запись службы автоматизации больше не использует существующую учетную запись запуска от имени. Чтобы повторно создать учетные записи запуска от имени, сделайте следующее:

1. Перейдите к учетной записи службы автоматизации в новой подписке и выберите **учетные записи запуска от имени** в разделе **Параметры учетной записи**. Вы увидите, что учетные записи запуска от имени отображаются как незавершенные сейчас.

    ![Снимок экрана учетных записей запуска от имени, Отображение незавершенных](../media/move-account/run-as-accounts.png)

2. Удалите учетные записи запуска от имени по одной за раз, выбрав **Удалить** на странице **свойства** . 

    > [!NOTE]
    > Если у вас нет разрешений на создание или Просмотр учетных записей запуска от имени, появится следующее сообщение: `You do not have permissions to create an Azure Run As account (service principal) and grant the Contributor role to the service principal.` дополнительные сведения см. в разделе [разрешения, необходимые для настройки учетных записей запуска от имени](../manage-runas-account.md#permissions).

3. После удаления учетных записей запуска от имени выберите **создать** в разделе **учетная запись запуска от имени Azure**. 

4. На странице **Добавление учетной записи запуска от имени Azure** выберите **создать** , чтобы создать учетную запись запуска от имени и субъект-службу. 

5. Повторите описанные выше действия с классической учетной записью запуска от имени Azure.

## <a name="enable-solutions"></a>включение решений;

После повторного создания учетных записей запуска от имени необходимо повторно включить решения, удаленные до перемещения. 

1. Чтобы включить решение "Отслеживание изменений и Инвентаризация", выберите **Отслеживание изменений и Инвентаризация** в учетной записи службы автоматизации. Выберите рабочую область Log Analytics, которую вы переместили, и выберите **включить**.

2. Повторите шаг 1 для решения "Управление обновлениями".

    ![Снимок экрана: повторное включение решений в перемещенной учетной записи службы автоматизации](../media/move-account/reenable-solutions.png)

3. Компьютеры, подключенные к решениям, отображаются при подключении существующей рабочей области Log Analytics. Чтобы включить решение "запуск/завершение виртуальных машин в нерабочее время", необходимо повторно развернуть решение. В разделе **связанные ресурсы**выберите **Запуск и завершение виртуальных машин** > дополнительные**сведения о и включите решение** > **Создание** решения для запуска развертывания.

4. На странице **Добавление решения** выберите рабочую область log Analytics и учетную запись службы автоматизации.

    ![Снимок экрана: меню "добавить решение"](../media/move-account/add-solution-vm.png)

5. Настройте решение, как описано в статье [Запуск/завершение виртуальных машин в нерабочее время в службе автоматизации Azure](../automation-solution-vm-management.md).

## <a name="verify-the-move"></a>Проверка перемещения

После завершения перемещения убедитесь, что включены перечисленные ниже возможности. 

|Возможности|Тесты|Устранение неполадок|
|---|---|---|
|Модули runbook|Модуль Runbook может быть успешно запущен и подключен к ресурсам Azure.|[Устранение неполадок с модулями runbook](../troubleshoot/runbooks.md)
|Система управления версиями|Вы можете выполнить синхронизацию вручную в репозитории системы управления версиями.|[Интеграция системы управления версиями](../source-control-integration.md)|
|Отслеживание изменений и инвентаризация|Убедитесь, что вы видите текущие данные инвентаризации с ваших компьютеров.|[Устранение неполадок отслеживания изменений](../troubleshoot/change-tracking.md)|
|Управление обновлениями|Убедитесь, что вы видите свои компьютеры и что они работоспособны.</br>Запустите тестовое развертывание обновлений программного обеспечения.|[Устранение неполадок управления обновлениями](../troubleshoot/update-management.md)|
|Общие ресурсы|Убедитесь, что отображаются все общие ресурсы, такие как [учетные данные](../shared-resources/credentials.md) и [переменные](../shared-resources/variables.md).|

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о перемещении ресурсов в Azure см. в статье [Перемещение ресурсов в Azure](../../azure-resource-manager/management/move-support-resources.md).
