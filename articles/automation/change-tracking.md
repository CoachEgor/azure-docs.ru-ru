---
title: Отслеживание изменений с помощью службы автоматизации Azure
description: Решение для отслеживания изменений помогает выявлять изменения программного обеспечения и служб Windows в среде.
services: automation
ms.service: automation
ms.subservice: change-inventory-management
author: georgewallace
ms.author: gwallace
ms.date: 04/29/2019
ms.topic: conceptual
manager: carmonm
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 4f917c45030ad70a2ab76fed877bd822d1902f82
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "64927287"
---
# <a name="track-changes-in-your-environment-with-the-change-tracking-solution"></a>Отслеживание изменений в среде с помощью решения для отслеживания изменений

В этой статье приведены сведения о настройке решения "Отслеживание изменений", позволяющего легко обнаруживать изменения в среде. Это решение отслеживает изменения в программном обеспечении и файлах Windows и Linux, разделах реестра Windows, службах Windows и управляющих программах Linux. что, в свою очередь, позволяет точно определять проблемы с работоспособностью.

Данные об изменениях установленного ПО, служб, файлов и реестра Windows и управляющих программ Linux на наблюдаемых серверах отправляются в службу Azure Monitor в облаке для обработки. К полученным данным применяется логика и облачная служба записывает данные. С помощью сведений на панели мониторинга «Отслеживание изменений» можно без труда обнаружить изменения, внесенные в инфраструктуру серверов.

> [!NOTE]
> Azure Automation отслеживания изменений отслеживает изменения в виртуальных машинах. Для отслеживания изменений свойств в Azure Resource Manager, см. в разделе график ресурсов Azure [журнал изменений](../governance/resource-graph/how-to/get-resource-changes.md).

## <a name="supported-windows-operating-systems"></a>Поддерживаемые операционные системы Windows

Для агента Windows официально поддерживаются следующие версии операционной системы Windows:

* Windows Server 2008 R2 или более поздней версии

## <a name="supported-linux-operating-systems"></a>Поддерживаемые операционные системы Linux

Официально поддерживаются следующие дистрибутивы Linux. Однако агент Linux может выполняться и на других дистрибутивах, помимо следующих: Если не указано иное, все вспомогательные версии поддерживаются для каждого основного номера версии в списке.  

### <a name="64-bit"></a>64-разрядная

* CentOS 6 и 7
* Amazon Linux 2017.09
* Oracle Linux 6 и 7
* Red Hat Enterprise Linux Server 6 и 7
* Debian GNU/Linux 8 и 9
* Ubuntu Linux 14.04 LTS, 16.04 LTS и 18.04 LTS
* SUSE Linux Enterprise Server 12

### <a name="32-bit"></a>32-битная

* CentOS 6
* Oracle Linux 6
* Red Hat Enterprise Linux Server 6
* Debian GNU/Linux 8 и 9
* Ubuntu Linux 14.04 LTS и 16.04 LTS

## <a name="onboard"></a>Включение решения для отслеживания изменений и инвентаризации

Чтобы начать отслеживание изменений, включите решение отслеживания изменений и инвентаризации. Подключить это решение на виртуальных машинах можно несколькими способами. Ниже приведены рекомендуемые и поддерживаемые способы подключения решения:

* [на одной виртуальной машине](automation-onboard-solutions-from-vm.md);
* [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md);
* [в учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md);
* [с помощью модуля runbook службы автоматизации Azure](automation-onboard-solutions.md).

## <a name="configuring-change-tracking-and-inventory"></a>Настройка решения для отслеживания изменений и инвентаризации

Сведения о подключении компьютеров к решению см. в статье [Подключение решений для управления обновлениями, отслеживания изменений и инвентаризации](automation-onboard-solutions-from-automation-account.md). Когда у вас есть подключение компьютера с помощью решения "Отслеживание изменений" и "Учет", вы можете настроить элементы для отслеживания. Если вы добавляете новый файл или раздел реестра для отслеживания, они включаются для обоих решений: "Отслеживание изменений" и "Инвентаризация".

Для отслеживания изменений в файлах в Windows и Linux используются MD5-хэши файлов. Затем эти хэши применяются, чтобы определить, вносились ли изменения с момента последней инвентаризации.

### <a name="configure-linux-files-to-track"></a>Настройка отслеживания файлов Linux

Чтобы настроить отслеживание файла на компьютере с Linux, сделайте следующее:

1. В учетной записи службы автоматизации в разделе **Управление конфигурацией** выберите **Отслеживание изменений**. Щелкните **Изменить параметры** (символ шестеренки).
2. На странице **Отслеживание изменений** выберите **Файлы Linux**, нажмите кнопку **+ Добавить**, чтобы добавить новый файл для отслеживания.
3. В окне **Add Linux File for Change Tracking** (Добавление файла Linux для отслеживания изменений) введите сведения о файле или каталоге, для которых необходимо выполнить отслеживание, и щелкните **Сохранить**.

|Свойство  |ОПИСАНИЕ  |
|---------|---------|
|Enabled     | Определяет, применяется ли параметр.        |
|Имя элемента     | Понятное имя файла для отслеживания.        |
|Группа     | Имя группы для логического группирования файлов.        |
|Укажите путь     | Путь для проверки наличия файла. Например: /etc/*.conf.       |
|Тип пути     | Тип элемента для отслеживания (возможными значениями могут быть "Файл" и "Каталог").        |
|Рекурсия     | Определяет, используется ли рекурсия при поиске отслеживаемого элемента.        |
|Использовать sudo     | Этот параметр определяет, используется ли sudo для проверки наличия элемента.         |
|Ссылки     | Этот параметр определяет работу символических ссылок при обзоре каталогов.<br> **Пропустить** — игнорирование символических ссылок без включения ссылочных файлов и каталогов.<br>**Переходить** — переход по символическим ссылкам во время рекурсий и включение ссылочных файлов и каталогов.<br>**Управлять** — переход по символическим ссылкам и разрешение изменения полученного содержимого.     |
|Отправка содержимого файла для всех параметров| Включение или отключение отправки содержимого файла для отслеженных изменений. Доступные параметры: **true** или **false**.|

> [!NOTE]
> Однако использовать ссылку "Управлять" не рекомендуется. Получение содержимого файлов не поддерживается.

### <a name="configure-windows-files-to-track"></a>Настройка отслеживания файлов Windows

Чтобы настроить отслеживание изменений в файлах на компьютере Windows, сделайте следующее:

1. В учетной записи службы автоматизации в разделе **Управление конфигурацией** выберите **Отслеживание изменений**. Щелкните **Изменить параметры** (символ шестеренки).
2. На странице **Отслеживание изменений** выберите **Файлы Windows**, нажмите кнопку **+ Добавить**, чтобы добавить новый файл для отслеживания.
3. В окне **Add Windows File for Change Tracking** (Добавление файла Windows для отслеживания изменений) введите сведения о файле, для которого необходимо выполнить отслеживание, и щелкните **Сохранить**.

|Свойство  |ОПИСАНИЕ  |
|---------|---------|
|Enabled     | Определяет, применяется ли параметр.        |
|Имя элемента     | Понятное имя файла для отслеживания.        |
|Группа     | Имя группы для логического группирования файлов.        |
|Укажите путь     | Путь для проверки наличия файла. Например, c:\temp\\\\*.txt.<br>Вы также можете использовать переменные среды, такие как %winDir%\System32\\\*.*       |
|Рекурсия     | Определяет, используется ли рекурсия при поиске отслеживаемого элемента.        |
|Отправка содержимого файла для всех параметров| Включение или отключение отправки содержимого файла для отслеженных изменений. Доступные параметры: **true** или **false**.|

## <a name="wildcard-recursion-and-environment-settings"></a>Параметры среды, подстановочные знаки и рекурсия

Рекурсия позволяет вам указывать подстановочные знаки для упрощения отслеживания в каталогах и переменные среды, которые позволяют отслеживать файлы в разных средах с несколькими или динамическими именами дисков. Ниже указан список общей информации, которую вы должны знать при настройке рекурсии.

* Для отслеживания нескольких файлов необходимы подстановочные знаки.
* Подстановочные знаки могут использоваться только в последнем сегменте пути (например, `c:\folder\*file*` или `/etc/*.conf`)
* Если у переменной среды недопустимый путь, проверка будет успешной, но запуск ресурса по этому пути завершится сбоем.
* При настройке избегайте общих путей, таких как `c:\*.*`, так как это приведет к переходу к большому количеству папок.

## <a name="configure-file-content-tracking"></a>Настройка отслеживания содержимого файла

Вы можете просмотреть содержимое файла до и после изменения с помощью отслеживания изменений содержимого файла. Это доступно для файлов Windows и Linux и для каждого изменения в файле, содержимое файла сохраняется в учетной записи хранения и отображает файл до и после изменений во встроенном или параллельном режиме. Дополнительные сведения см. в разделе [Просмотр содержимого отслеживаемого файла](change-tracking-file-contents.md).

![просмотр изменений в файле](./media/change-tracking-file-contents/view-file-changes.png)

### <a name="configure-windows-registry-keys-to-track"></a>Настройка отслеживания разделов реестра Windows

Чтобы настроить разделы реестра для отслеживания на компьютерах с Windows, сделайте следующее:

1. В учетной записи службы автоматизации в разделе **Управление конфигурацией** выберите **Отслеживание изменений**. Щелкните **Изменить параметры** (символ шестеренки).
2. На странице **Отслеживание изменений** выберите **Реестр Windows** и нажмите кнопку **+ Добавить**, чтобы добавить новый раздел реестра для отслеживания.
3. В окне **Add Windows Registry for Change Tracking** (Добавление реестра Windows для отслеживания изменений) введите сведения о ключе, для которого необходимо выполнить отслеживание, и щелкните **Сохранить**.

|Свойство  |ОПИСАНИЕ  |
|---------|---------|
|Enabled     | Определяет, применяется ли параметр.        |
|Имя элемента     | Понятное имя раздела реестра для отслеживания.        |
|Группа     | Имя группы для логического группирования разделов реестра.        |
|Раздел реестра Windows   | Путь для проверки раздела реестра. Например:  HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Common Startup      |

## <a name="limitations"></a>Ограничения

Сейчас решение для отслеживания изменений не поддерживает следующие элементы.

* Рекурсия для отслеживания реестра Windows
* Сетевые файловые системы

Другие ограничения:

* в текущей версии столбец и значения **Максимальный размер файла** не используются;
* при сборе более 2500 файлов в течение тридцатиминутного цикла производительность решения может снизиться;
* при интенсивном сетевом трафике изменение записей может занять до 6 часов;
* если изменение конфигурации выполняется на отключенном компьютере, он может внести изменения, относящиеся к предыдущей конфигурации.

## <a name="known-issues"></a>Известные проблемы

В настоящее время известны следующие проблемы решения для отслеживания изменений.

* Для компьютеров Windows Server 2016 Core RS3 не собираются исправления обновлений.
* Управляющие программы Linux может показать измененное состояние, несмотря на то, что не вносилось. Это обусловлено как `SvcRunLevels` поле фиксируется.

## <a name="change-tracking-data-collection-details"></a>Сведения о сборе данных отслеживания изменений.

В следующей таблице указана частота сбора данных для типов изменений. Моментальный снимок данных текущего состояния для каждого типа обновляется по меньшей мере каждые 24 часа:

| **Тип изменения** | **Frequency** |
| --- | --- |
| Реестр Windows | 50 минут |
| Файловый ресурс Windows | 30 минут |
| Файловый ресурс Linux | 15 минут |
| Службы Windows | от 10 секунд до 30 минут</br> Значение по умолчанию: 30 минут |
| Управляющие программы Linux | 5 мин |
| Программное обеспечение Windows | 30 минут |
| Программное обеспечение Linux | 5 мин |

В следующей таблице приведены ограничения по отслеживаемым элементам для одного компьютера при использовании решения "Отслеживание изменений".

| **Ресурс** | **Ограничение**| **Примечания** |
|---|---|---|
|Файл|500||
|Реестр|250||
|Программное обеспечение Windows|250|Обновления программного обеспечения не учитываются|
|Пакеты Linux|1250||
|Службы|250||
|Daemon|250||

Средний показатель использования данных Log Analytics для компьютера, использующего решения "Отслеживание изменений" и "Инвентаризация — примерно 40 МБ в месяц. Это приблизительное значение, которое может отличаться в зависимости от среды. Мы рекомендуем вам провести мониторинг среды, чтобы узнать точные данные об использовании.

### <a name="windows-service-tracking"></a>Отслеживание служб Windows

Периодичность сбора по умолчанию для служб Windows — 30 минут. Чтобы настроить периодичность, перейдите к **Отслеживанию изменений**. В разделе **Параметры изменения** на вкладке **Службы Windows** есть ползунок, с помощью которого можно изменить периодичность сбора для служб Windows, выбрав значение от 10 секунд до 30 минут. Переместите ползунок к желаемой периодичности, она будет сохранена автоматически.

![Ползунок служб Windows](./media/change-tracking/windowservices.png)

Агент отслеживает только изменения, это позволяет оптимизировать производительность агента. Если вы установите высокое пороговое значение, изменения могут быть пропущены, когда служба вернется в исходное состояние. Если вы установите меньший период, то запишете изменения, которые в противном случае будут упущены.

> [!NOTE]
> Хотя агент может отслеживать изменения с 10-секундным интервалом, потребуется несколько минут, чтобы данные отобразились на портале. В эти несколько минут изменения по-прежнему отслеживаются и записываются.
  
### <a name="registry-key-change-tracking"></a>Отслеживание изменений в разделах реестра

Целью отслеживания изменений в разделах реестра является точное определение точек расширения, в которых может быть активирован сторонний код или вредоносная программа. Ниже представлен список предварительно настроенных разделов реестра. Эти разделы настроены, но не включены для отслеживания. Чтобы отслеживать эти разделы реестра, необходимо включить каждый из них.

> [!div class="mx-tdBreakAll"]
> |  |
> |---------|
> |**HKEY\_LOCAL\_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers**     |
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.    |
> |**HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup**     |
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются сценарии, выполняемые при запуске.     |
> |**HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown**    |
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются сценарии, выполняемые при завершении работы.     |
> |**HKEY\_LOCAL\_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run**     |
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются разделы, загружаемые перед входом пользователя в учетную запись Windows. Этот раздел используется для 32-разрядных программ, выполняющихся на 64-разрядных компьютерах.    |
> |**HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Active Setup\Installed Components**     |
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются изменения параметров приложения.     |
> |**HKEY\_LOCAL\_MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.|
> |**HKEY\_LOCAL\_MACHINE\Software\Classes\Directory\Shellex\CopyHookHandlers**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.|
> |**HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживается регистрация обработчика дополнительных значков.|
|**HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживается регистрация обработчика дополнительных значков для 32-битных программ, работающих на 64-разрядных компьютерах.|
> |**HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer. Используется для доступа к модели DOM текущей страницы и управления навигацией.|
> |**HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer. Используется для получения доступа к модели DOM текущей страницы и управления навигацией для 32-разрядных программ, работающих на 64-разрядных компьютерах.|
> |**HKEY\_LOCAL\_MACHINE\Software\Microsoft\Internet Explorer\Extensions**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов.|
> |**HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Internet Explorer\Extensions**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов для 32-битных программ, работающих на 64-разрядных компьютерах.|
> |**HKEY\_LOCAL\_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Drivers32**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются 32-битные драйверы, связанные с устройствами wavemapper — wave1 и wave2, msacm.imaadpcm, .msadpcm, .msgsm610 и vidc. Ознакомьтесь с разделом о [драйверах] в файле SYSTEM.INI.|
> |**HKEY\_LOCAL\_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживаются 32-битные драйверы, связанные с устройствами wavemapper — wave1 и wave2, msacm.imaadpcm, .msadpcm, .msgsm610 и vidc для 32-битных программ, работающих на 64-разрядных компьютерах. Ознакомьтесь с разделом о [драйверах] в файле SYSTEM.INI.|
> |**HKEY\_LOCAL\_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDlls**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживается список известных или часто используемых системных библиотек DLL. Эта система предотвращает использование ненадежных разрешений каталога приложений за счет удаления версий вредоносной программы типа "Троянский конь" системных библиотек DLL.|
> |**HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify**|
|&nbsp;&nbsp;&nbsp;&nbsp;Отслеживается список пакетов, получающих уведомления о событиях из Winlogon — интерактивной модели поддержки входа в систему для операционной системы Windows.|

## <a name="network-requirements"></a>Требования к сети

Для Отслеживания изменений требуются следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure Government  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|
|*.azure-automation.net|*.azure-automation.us|

## <a name="use-change-tracking"></a>Использование функции отслеживания изменений

После того как решение включено, вы можете просмотреть сводку изменений для ваших отслеживаемых компьютеров, выбрав **Отслеживание изменений** в разделе **Управление конфигурацией** в вашей учетной записи автоматизации.

Вы можете просмотреть изменения, внесенные на компьютерах, и более подробно рассмотреть каждое событие. Вверху диаграммы находятся раскрывающиеся списки. С их помощью можно отфильтровать диаграмму и подробные сведения по типу изменения и диапазону времени. Кроме того, вы можете щелкнуть на диаграмме и перетащить, чтобы выбрать нужный диапазон времени. **Измените тип** будет иметь одно из следующих значений **события**, **управляющие программы**, **файлы**, **реестра**,  **Программное обеспечение**, **служб Windows**. Категория показывает тип изменения и может быть **Added**, **Modified**, или **удалено**.

![image of Change Tracking dashboard](./media/change-tracking/change-tracking-dash01.png)

Если щелкнуть изменение или событие, появятся подробные сведения об этом изменении. Как видно из примера, тип запуска службы был изменен с "Ручной" на "Автоматический".

![изображения со сведениями об отслеживании изменений](./media/change-tracking/change-tracking-details.png)

## <a name="search-logs"></a>Поиск по журналам

Кроме подробных сведений, которые предоставляются на портале, можно выполнить поиск по журналам. С помощью **отслеживания изменений** страницы, перейдите **Log Analytics**, откроется **журналы** страницы.

### <a name="sample-queries"></a>Примеры запросов

Следующая таблица содержит примеры запросов поиска по журналу для получения записей об изменениях, собранных этим решением.

|Запрос  |ОПИСАНИЕ  |
|---------|---------|
|ConfigurationData<br>&#124; where   ConfigDataType == "WindowsServices" and SvcStartupType == "Auto"<br>&#124; where SvcState == "Stopped"<br>&#124; summarize arg_max(TimeGenerated, *) by SoftwareName, Computer         | Показывает самые последние записи инвентаризации для служб Windows, для которых установлено значение "Автоматический" и которые были остановлены.<br>Результаты ограничены самой последней записью для определенного компьютера и имени ПО.      |
|ConfigurationChange<br>&#124; where ConfigChangeType == "Software" and ChangeCategory == "Removed"<br>&#124; order by TimeGenerated desc|Показывает записи об изменениях для удаленного программного обеспечения.|

## <a name="alert-on-changes"></a>Оповещения об изменениях

Ключевой возможностью отслеживания изменений и инвентаризации является возможность оповещения о состоянии конфигурации и любых изменениях состояния конфигурации гибридной среды.  

В следующем примере на снимке экрана показано, что файл `C:\windows\system32\drivers\etc\hosts` был изменен на компьютере. Этот файл важен, потому что файл Hosts используется Windows для преобразования имен узлов в IP-адреса и имеет приоритет даже над DNS, что может привести к проблемам с подключением или к перенаправлению трафика на вредоносные или иные опасные веб-сайты.

![Диаграмма, отображающая изменение файла hosts](./media/change-tracking/changes.png)

Чтобы продолжить анализ этого изменения, перейдите к поиску в журнале, щелкнув **Log Analytics**. Попав в поиск по журналу, найдите изменения содержимого в файле Hosts с помощью запроса `ConfigurationChange | where FieldsChanged contains "FileContentChecksum" and FileSystemPath contains "hosts"`. Этот запрос выполняет поиск изменений, которые включали изменение содержимого файла для файлов, полный путь к которым содержит слово "hosts". Вы также можете запросить конкретный файл, изменив путь к его полностью определенной форме (например, `FileSystemPath == "c:\windows\system32\drivers\etc\hosts"`).

После того как запрос вернет желаемые результаты, нажмите кнопку **Новое правило генерации оповещений** в журнале поиска, чтобы открыть страницу создания оповещения. Вы также можете перейти к этой возможности с помощью **Azure Monitor** на портале Azure. В процессе создания оповещения проверьте наш запрос еще раз и измените логику оповещения. В этом случае вы хотите, чтобы оповещение активировалось, если на всех машинах среды обнаружено хотя бы одно изменение.

![Рисунок, демонстрирующий запрос на изменение для отслеживания изменений в файле hosts](./media/change-tracking/change-query.png)

После установки логики условий назначьте группы действий для выполнения действий в ответ на срабатывание оповещения. В этом случае настроены сообщения электронной почты, и необходимо создать билет ITSM.  Вы также можете выполнить множество других полезных действий, таких как запуск функции Azure, модуля runbook службы автоматизации, веб-перехватчика или приложения логики.

![Изображение с настройкой группы действий для оповещения об изменении](./media/change-tracking/action-groups.png)

После установки всех параметров и логики оповещение можно применить к среде.

### <a name="alert-suggestions"></a>Предложения оповещений

Хотя оповещение об изменениях в файле Hosts является хорошим приложением оповещений для данных отслеживания изменений или инвентаризации, существует много других сценариев оповещения, включая случаи, определенные вместе с их примерами запросов в разделе ниже.

|Запрос  |ОПИСАНИЕ  |
|---------|---------|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Files" и FileSystemPath содержит " c:\\windows\\system32\\drivers\\"|Полезно для отслеживания изменений в системных критических файлах|
|ConfigurationChange <br>&#124; где FieldsChanged содержит "FileContentChecksum" и FileSystemPath == "c:\\windows\\system32\\drivers\\etc\\hosts"|Полезно для отслеживания изменений в файлах конфигурации ключа|
|ConfigurationChange <br>&#124; где ConfigChangeType == "WindowsServices" и SvcName содержит "w3svc" и SvcState == "Stopped"|Полезно для отслеживания изменений в системных критически важных службах|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Daemons" и SvcName содержит "ssh" и SvcState != "Running"|Полезно для отслеживания изменений в системных критически важных службах|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Software" и ChangeCategory == "Added"|Полезно для сред, которые требуют заблокированных конфигураций программного обеспечения|
|ConfigurationData <br>&#124; где SoftwareName содержит "Monitoring Agent" и CurrentVersion != "8.0.11081.0"|Полезно для просмотра, на каких машинах установлена устаревшая или несовместимая версия программного обеспечения. Он сообщает о последнем сообщенном состоянии конфигурации, а не об изменениях.|
|ConfigurationChange <br>&#124; где RegistryKey == "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\QualityCompat"| Полезно для отслеживания изменений в важных антивирусных ключах|
|ConfigurationChange <br>&#124; где RegistryKey содержит "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy"| Полезно для отслеживания изменений в параметрах брандмауэра|

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании решения отслеживания изменений см. в следующем руководстве:

> [!div class="nextstepaction"]
> [Устранение неполадок при изменениях в среде](automation-tutorial-troubleshoot-changes.md)

* Используйте [при поиске по журналам в Azure Monitor журналы](../log-analytics/log-analytics-log-searches.md) Чтобы просмотреть подробные данные отслеживания изменений.