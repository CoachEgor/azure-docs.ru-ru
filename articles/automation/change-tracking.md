---
title: Общие сведения о Отслеживание изменений и инвентаризации в службе автоматизации Azure
description: Отслеживание изменений и Инвентаризация позволяют обнаруживать изменения программного обеспечения и служб Майкрософт, которые возникают в вашей среде.
services: automation
ms.subservice: change-inventory-management
ms.date: 01/28/2019
ms.topic: conceptual
ms.openlocfilehash: 1208e08f7b85e893ba754bdbdf71a2da4f68c90a
ms.sourcegitcommit: eaec2e7482fc05f0cac8597665bfceb94f7e390f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82509077"
---
# <a name="overview-of-change-tracking-and-inventory"></a>Общие сведения о Отслеживание изменений и инвентаризации

В этой статье рассказывается о Отслеживание изменений и инвентаризации в службе автоматизации Azure. Эта функция отслеживает изменения в виртуальных машинах и серверной инфраструктуре, помогая выявить проблемы в работе и окружающей среде программного обеспечения, управляемого диспетчером пакетов распространения. Элементы, которые отправляются с помощью Отслеживание изменений и инвентаризации, включают: 

- Программное обеспечение Windows
- Программное обеспечение Linux (пакеты)
- Файлы Windows и Linux
- Разделы реестра Windows
- Службы Майкрософт
- Управляющие программы Linux

Отслеживание изменений и Инвентаризация получают данные из службы Azure Monitor в облаке. Azure отправляет изменения в установленное программное обеспечение, службы Майкрософт, реестр и файлы Windows и управляющие программы Linux на наблюдаемых серверах для Azure Monitor обработки. Облачная служба применяет логику к полученным данным, записывает их и делает доступной. 

> [!NOTE]
> Сведения об отслеживании изменений свойств Azure Resource Manager см. в статье [Журнал изменений](../governance/resource-graph/how-to/get-resource-changes.md)графа ресурсов Azure.

Отслеживание изменений и данные инвентаризации сейчас не поддерживают следующие элементы:

* Рекурсия для отслеживания реестра Windows
* Сетевые файловые системы
* Различные методы установки
* ***exe** файлы для Windows

Другие ограничения:

* в текущей версии столбец и значения **Максимальный размер файла** не используются;
* Если вы соберете более 2500 файлов в течение 30-минутного цикла сбора, производительность решения может быть снижена.
* При высокой интенсивности сетевого трафика изменение записей может занять до шести часов.
* При изменении конфигурации при выключении компьютера компьютер может публиковать изменения, принадлежащие к предыдущей конфигурации.

В настоящее время Отслеживание изменений и инвентаризации столкнулись со следующими проблемами:

* Для компьютеров Windows Server 2016 Core RS3 не собираются исправления обновлений.
* Управляющие программы Linux могут показывать измененное состояние, даже если изменения не происходили. Эта проблема возникает из-за способа записи `SvcRunLevels` данных в журнал Azure Monitor [ConfigurationChange](https://docs.microsoft.com/azure/azure-monitor/reference/tables/configurationchange) .

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Отслеживание изменений и Инвентаризация и агенты Azure Monitor Log Analytics поддерживаются в операционных системах Windows и Linux.

### <a name="windows-operating-systems"></a>Операционные системы Windows

Официально поддерживаемая версия операционной системы Windows — Windows Server 2008 R2 или более поздней версии.

### <a name="linux-operating-systems"></a>Операционные системы Linux

Дистрибутивы Linux, описанные ниже, официально поддерживаются агентом Log Analytics для Linux. Однако агент Linux может выполняться и на других дистрибутивах, помимо следующих: Если не указано иное, все вспомогательные версии поддерживаются для каждого основного номера версии в списке.

#### <a name="64-bit-linux-operating-systems"></a>64-разрядные операционные системы Linux

* CentOS 6 и 7
* Amazon Linux 2017.09
* Oracle Linux 6 и 7
* Red Hat Enterprise Linux Server 6 и 7
* Debian GNU/Linux 8 и 9
* Ubuntu Linux 14.04 LTS, 16.04 LTS и 18.04 LTS
* SUSE Linux Enterprise Server 12

#### <a name="32-bit-linux-operating-systems"></a>32-разрядные операционные системы Linux

* CentOS 6
* Oracle Linux 6
* Red Hat Enterprise Linux Server 6
* Debian GNU/Linux 8 и 9
* Ubuntu Linux 14.04 LTS и 16.04 LTS

## <a name="network-requirements"></a>Требования к сети

Для Отслеживание изменений и инвентаризации требуются сетевые адреса, перечисленные в следующей таблице. Для обмена данными с этими адресами используется порт 443.

|Azure Public  |Azure для государственных организаций  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|
|*.azure-automation.net|*.azure-automation.us|

## <a name="change-tracking-and-inventory-user-interface"></a>Пользовательский интерфейс Отслеживание изменений и инвентаризации

Используйте Отслеживание изменений и инвентаризацию в портал Azure, чтобы просмотреть сводку изменений для наблюдаемых компьютеров. Чтобы получить доступ к этой функции, выберите **Отслеживание изменений** в разделе **Управление конфигурацией** в учетной записи службы автоматизации. 

![Панель мониторинга Отслеживание изменений](./media/change-tracking/change-tracking-dash01.png)

Раскрывающиеся списки доступны в верхней части панели мониторинга, чтобы ограничить диаграмму отслеживания изменений и подробные сведения на основе типа изменения и диапазонов времени. Кроме того, вы можете щелкнуть на диаграмме и перетащить, чтобы выбрать нужный диапазон времени. 

Вы можете щелкнуть изменение или событие, чтобы отобразить сведения о нем. Доступны следующие типы изменений:

* События
* Управляющие программы
* Файлы
* Реестр
* Программное обеспечение
* Службы Майкрософт

Вы можете добавлять, изменять или удалять каждое изменение. В приведенном ниже примере можно увидеть изменение типа запуска службы с "вручную" на "автоматически".

![Сведения о Отслеживание изменений](./media/change-tracking/change-tracking-details.png)

## <a name="tracking-of-file-changes"></a>Отслеживание изменений в файлах

Для отслеживания изменений в файлах в Windows и Linux Отслеживание изменений и Инвентаризация используют хэши MD5 файлов. Эта функция использует хэши, чтобы определить, были ли внесены изменения с момента последнего учета.

## <a name="tracking-of-file-content-changes"></a>Отслеживание изменений содержимого файлов

Отслеживание изменений и инвентаризация позволяет просматривать содержимое файла Windows или Linux до и после изменения файла. Для каждого изменения файла Отслеживание изменений и инвентаризации сохраняют содержимое файла в [учетной записи хранения Azure](../storage/common/storage-create-storage-account.md). При отслеживании файла его содержимое можно просмотреть до или после изменения. Содержимое можно просмотреть как в строке, так и параллельно. 

![Просмотр изменений в файле](./media/change-tracking/view-file-changes.png)

## <a name="tracking-of-registry-keys"></a>Отслеживание разделов реестра

Отслеживание изменений и Инвентаризация позволяют отслеживать изменения в разделах реестра. Мониторинг позволяет определить точки расширения, в которых может активироваться сторонний код и вредоносные программы. В следующей таблице перечислены предварительно настроенные (но не включенные) разделы реестра. Для трассировки этих ключей необходимо включить каждый из них.

> [!div class="mx-tdBreakAll"]
> |Ключ реестра | Назначение |
> | --- | --- |
> |`HKEY\LOCAL\MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers` | Отслеживает общие записи автозапуска, которые напрямую подключаются к проводнику Windows и обычно выполняются внутри процесса с помощью **Explorer. exe**.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup` | Отслеживаются сценарии, выполняемые при запуске.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown` | Отслеживаются сценарии, выполняемые при завершении работы.
> |`HKEY\LOCAL\MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run` | Отслеживает ключи, которые загружаются перед входом пользователя в учетную запись Windows. Ключ используется для 32-разрядных приложений, работающих на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\SOFTWARE\Microsoft\Active Setup\Installed Components` | Отслеживаются изменения параметров приложения.
> |`HKEY\LOCAL\MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers` | Отслеживает общие записи автозапуска, которые напрямую подключаются к проводнику Windows и обычно выполняются внутри процесса с помощью **Explorer. exe**.
> |`HKEY\LOCAL\MACHINE\Software\Classes\Directory\Shellex\CopyHookHandlers` | Отслеживает общие записи автозапуска, которые напрямую подключаются к проводнику Windows и обычно выполняются внутри процесса с помощью **Explorer. exe**.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers` | Отслеживается регистрация обработчика дополнительных значков.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers` | Отслеживает регистрацию обработчика наложения значков для 32-разрядных приложений, работающих на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects` | Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer. Используется для доступа к модели DOM текущей страницы и управления навигацией.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects` | Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer. Используется для доступа к модель DOM (DOM) текущей страницы и управления навигацией для 32-разрядных приложений, выполняющихся на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Internet Explorer\Extensions` | Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Internet Explorer\Extensions` | Мониторы для новых расширений Internet Explorer, например настраиваемые меню инструментов и настраиваемые кнопки на панели инструментов для 32-разрядных приложений, работающих на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Drivers32` | Отслеживает 32-разрядные драйверы, связанные с устройствами wavemapper, wave1 и Wave2, MSACM. imaadpcm,. msadpcm,. msgsm610 и vidc. Аналогично разделу [Drivers] в файле **System. ini** .
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32` | Отслеживает 32-разрядные драйверы, связанные с устройствами wavemapper, wave1 и Wave2, MSACM. imaadpcm,. msadpcm,. msgsm610 и vidc для 32-разрядных приложений, работающих на 64-разрядных компьютерах. Аналогично разделу [Drivers] в файле **System. ini** .
> |`HKEY\LOCAL\MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDlls` | Отслеживает список известных или часто используемых системных библиотек DLL. Эта система предотвращает использование слабых разрешений каталога приложений путем удаления в системных библиотеках «троянских коней».
> |`HKEY\LOCAL\MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify` | Отслеживает список пакетов, которые могут получать уведомления о событиях от **Winlogon. exe**, интерактивную модель поддержки входа в систему для Windows.

## <a name="support-for-file-integrity-monitoring-in-azure-security-center"></a>Поддержка мониторинга целостности файлов в центре безопасности Azure

Отслеживание изменений и Инвентаризация используют [средство мониторинга целостности файлов центра безопасности Azure (FIM)](https://docs.microsoft.com/azure/security-center/security-center-file-integrity-monitoring). Хотя FIM наблюдает только за файлами и реестрами, полная функция Отслеживание изменений и инвентаризации также включает отслеживание:

- Изменения программного обеспечения
- Службы Майкрософт
- Управляющие программы Linux

## <a name="recursion-support"></a>Поддержка рекурсии

Отслеживание изменений и Инвентаризация поддерживают рекурсию, что позволяет указывать подстановочные знаки для упрощения отслеживания в каталогах. Рекурсия также предоставляет переменные среды, позволяющие контролировать файлы в разных средах с несколькими или динамическими именами дисков. В следующем списке приведены общие сведения, которые следует учитывать при настройке рекурсии.

* Для отслеживания нескольких файлов необходимы подстановочные знаки.
* Подстановочные знаки могут использоваться только в последнем сегменте пути, например **\\c:\u1087? АПКА File*** или **/etc/*. conf**.
* Если переменной среды назначен недопустимый путь, проверка завершается успешно, но во время выполнения путь завершается ошибкой.
* Не используйте общие имена путей при задании пути, так как этот тип параметра может вызвать слишком много папок для обхода.

## <a name="change-tracking-and-inventory-data-collection"></a>Сбор данных Отслеживание изменений и инвентаризации

В следующей таблице показана частота сбора данных для типов изменений, поддерживаемых Отслеживание изменений и инвентаризации. Для каждого типа моментальный снимок данных текущего состояния также обновляется по крайней мере каждые 24 часа.

| **Изменение типа** | **Частота** |
| --- | --- |
| Реестр Windows | 50 минут |
| Файловый ресурс Windows | 30 минут |
| Файловый ресурс Linux | 15 минут |
| Службы Майкрософт | от 10 секунд до 30 минут</br> Значение по умолчанию — 30 минут |
| Управляющие программы Linux | 5 мин |
| Программное обеспечение Windows | 30 минут |
| Программное обеспечение Linux | 5 мин |

В следующей таблице показаны ограничения количества элементов для каждого компьютера для Отслеживание изменений и инвентаризации.

| **Ресурс** | **Ограничение** |
|---|---|---|
|Файл|500|
|Реестр|250|
|Программное обеспечение Windows (не включая исправления) |250|
|Пакеты Linux|1250|
|Службы|250|
|Управляющие программы|250|

Среднее Log Analytics использования данных для компьютера, использующего Отслеживание изменений и инвентаризацию, составляет примерно 40 МБ в месяц. Это приблизительное значение, которое может отличаться в зависимости от среды. Мы рекомендуем вам провести мониторинг среды, чтобы узнать точные данные об использовании.

### <a name="microsoft-service-data"></a>Данные службы Майкрософт

Частота сбора по умолчанию для служб Майкрософт составляет 30 минут. Частоту можно настроить с помощью ползунка на вкладке **службы Майкрософт** в разделе **изменить параметры**. 

![Ползунок служб Майкрософт](./media/change-tracking/windowservices.png)

Чтобы оптимизировать производительность, агент Log Analytics отслеживает только изменения. Установка высокого порогового значения может пропускать изменения, если служба возвращается к исходному состоянию. Установка меньшего значения частоты позволяет перехватывать изменения, которые могут быть пропущены в противном случае.

> [!NOTE]
> Несмотря на то, что агент может отслеживанию изменений до 10 секунд, данные по-прежнему понимают несколько минут для вывода в портал Azure. Изменения, происходящие в течение времени, которые отображаются на портале, по-прежнему будут записываться и записываться в журнал.

## <a name="support-for-alerts-on-configuration-state"></a>Поддержка оповещений о состоянии конфигурации

Ключевой возможностью Отслеживание изменений и инвентаризации является оповещение об изменениях в состоянии конфигурации гибридной среды. Многие полезные действия можно активировать в ответ на предупреждения, например действия с функциями Azure, модули Runbook службы автоматизации, веб-перехватчики и т. д. Предупреждение об изменениях в файле **C:\windows\system32\drivers\etc\hosts** для компьютера — это одно хорошее применение оповещений для отслеживание изменений и данных инвентаризации. Существует множество других сценариев для предупреждений, включая сценарии запросов, определенные в следующей таблице. 

|query  |Описание  |
|---------|---------|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Files" и FileSystemPath содержит " c:\\windows\\system32\\drivers\\"|Полезно для отслеживания изменений в критических для системы файлах.|
|ConfigurationChange <br>&#124; где FieldsChanged содержит "FileContentChecksum" и FileSystemPath == "c:\\windows\\system32\\drivers\\etc\\hosts"|Полезно для отслеживания изменений в файлах конфигурации ключей.|
|ConfigurationChange <br>&#124;, где Конфигчанжетипе = = "службы Майкрософт" и SvcName содержат "W3SVC" и Свкстате = = "Stopped"|Полезно для отслеживания изменений в службах, критических для системы.|
|ConfigurationChange <br>&#124;, где Конфигчанжетипе = = "управляющие программы" и SvcName содержат "SSH" и Свкстате! = "работает"|Полезно для отслеживания изменений в службах, критических для системы.|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Software" и ChangeCategory == "Added"|Полезен для сред, требующих заблокированных конфигураций программного обеспечения.|
|ConfigurationData <br>&#124;, где SoftwareName содержит "Monitoring Agent" и CurrentVersion! = "8.0.11081.0"|Используется для просмотра компьютеров, на которых установлена устаревшая или несоответствующая версия программного обеспечения. Этот запрос сообщает о состоянии последней отправленной конфигурации, но не сообщает об изменениях.|
|ConfigurationChange <br>&#124;, где RegistryKey = = @ "\\HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion куалитикомпат"| Полезно для отслеживания изменений важных антивирусных ключей.|
|ConfigurationChange <br>&#124;, где RegistryKey содержит параметр @\\"\\HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\SharedAccess параметры фиреваллполици"| Полезно для отслеживания изменений в настройках брандмауэра.|

## <a name="next-steps"></a>Следующие шаги

* Сведения о работе с Отслеживание изменений и инвентаризации в модулях Runbook см. в разделе [управление отслеживание изменений и инвентаризацией](change-tracking-file-contents.md).
* Сведения об устранении ошибок с помощью Отслеживание изменений и инвентаризации см. в разделе [Устранение неполадок отслеживание изменений и инвентаризации](automation-tutorial-troubleshoot-changes.md).
* Используйте [Поиск по журналам в Azure Monitor журналов](../log-analytics/log-analytics-log-searches.md) для просмотра подробных данных отслеживания изменений.
