---
title: Отслеживание изменений с помощью службы автоматизации Azure
description: Решение для отслеживания изменений помогает выявлять изменения программного обеспечения и служб Windows в среде.
services: automation
ms.subservice: change-inventory-management
ms.date: 01/28/2019
ms.topic: conceptual
ms.openlocfilehash: d84566c7680081561f60d4825f25a9ce19e02b24
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81682977"
---
# <a name="track-environment-changes-with-change-tracking"></a>Отслеживайте изменения среды с помощью отслеживания изменений

В этой статье приведены сведения о настройке решения "Отслеживание изменений", позволяющего легко обнаруживать изменения в среде. Решение отслеживает следующие изменения конфигурации, чтобы помочь вам определить операционные проблемы:

- Программное обеспечение Windows
- Программное обеспечение Linux (пакеты)
    >[!NOTE]
    >Отслеживание изменений отслеживает только программное обеспечение, управляемое с помощью менеджера пакетов распределения.

- Файлы Windows и Linux
- Ключи реестра Windows
- Службы Windows
- Управляющие программы Linux

После включения решения можно просмотреть резюме изменений для контролируемых компьютеров, выбрав **отслеживание изменений** под **управлением конфигурации** в учетной записи автоматизации.

> [!NOTE]
> Отслеживание изменений в автоматизации Azure отслеживает изменения в виртуальных машинах. Чтобы отслеживать изменения свойств управления ресурсами Azure, смотрите [историю изменений из графика](../governance/resource-graph/how-to/get-resource-changes.md)ресурсов Azure.

Вы можете просмотреть изменения, внесенные на компьютерах, и более подробно рассмотреть каждое событие. Вверху диаграммы находятся раскрывающиеся списки. С их помощью можно отфильтровать диаграмму и подробные сведения по типу изменения и диапазону времени. Кроме того, вы можете щелкнуть на диаграмме и перетащить, чтобы выбрать нужный диапазон времени. **Тип изменения** будет одним из следующих значений **События**, **Daemons**, **Файлы**, **реестр**, **программное обеспечение**, **Windows Услуги**. Категория показывает тип изменения и может быть **добавлена, изменена**или **удалена.** **Added**

![image of Change Tracking dashboard](./media/change-tracking/change-tracking-dash01.png)

Если щелкнуть изменение или событие, появятся подробные сведения об этом изменении. Как видно из примера, тип запуска службы был изменен с "Ручной" на "Автоматический".

![изображения со сведениями об отслеживании изменений](./media/change-tracking/change-tracking-details.png)

Данные об изменениях установленного ПО, служб, файлов и реестра Windows и управляющих программ Linux на наблюдаемых серверах отправляются в службу Azure Monitor в облаке для обработки. К полученным данным применяется логика и облачная служба записывает данные. С помощью сведений на панели мониторинга «Отслеживание изменений» можно без труда обнаружить изменения, внесенные в инфраструктуру серверов.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

### <a name="windows-operating-systems"></a>Операционные системы Windows

Для агента Windows официально поддерживаются следующие версии операционной системы Windows:

* Windows Server 2008 R2 и более поздние версии

### <a name="linux-operating-systems"></a>Операционные системы Linux

Официально поддерживаются следующие дистрибутивы Linux. Однако агент Linux может выполняться и на других дистрибутивах, помимо следующих: Если не указано иное, все вспомогательные версии поддерживаются для каждого основного номера версии в списке.

#### <a name="64-bit"></a>64-разрядная

* CentOS 6 и 7
* Amazon Linux 2017.09
* Oracle Linux 6 и 7
* Red Hat Enterprise Linux Server 6 и 7
* Debian GNU/Linux 8 и 9
* Ubuntu Linux 14.04 LTS, 16.04 LTS и 18.04 LTS
* SUSE Linux Enterprise Server 12

#### <a name="32-bit"></a>32-битная

* CentOS 6
* Oracle Linux 6
* Red Hat Enterprise Linux Server 6
* Debian GNU/Linux 8 и 9
* Ubuntu Linux 14.04 LTS и 16.04 LTS

## <a name="limitations"></a>Ограничения

Сейчас решение для отслеживания изменений не поддерживает следующие элементы.

* Рекурсия для отслеживания реестра Windows
* Сетевые файловые системы
* Различные методы установки
* ***.exe** файлы для Windows

Другие ограничения:

* в текущей версии столбец и значения **Максимальный размер файла** не используются;
* Если вы соберете более 2500 файлов в 30-минутном цикле сбора, производительность решения может быть ухудшилась.
* При высоком сетевом трафике отображение записей изменений может занять до шести часов.
* При изменении конфигурации при выключении компьютера компьютер может опубликовать изменения, относящиеся к предыдущей конфигурации.

## <a name="known-issues"></a>Известные проблемы

В настоящее время известны следующие проблемы решения для отслеживания изменений.

* Для компьютеров Windows Server 2016 Core RS3 не собираются исправления обновлений.
* Linux Daemons может показать измененное состояние, даже несмотря на то, что изменений не произошло. Это связано с `SvcRunLevels` тем, как захвачено поле.

## <a name="network-requirements"></a>Требования к сети

Отслеживание изменений требует следующих адресов. Связь по этим адресам используется в порту 443.

|Azure Public  |Azure для государственных организаций  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|
|*.azure-automation.net|*.azure-automation.us|

## <a name="wildcard-recursion-and-environment-settings"></a>Параметры среды, подстановочные знаки и рекурсия

Рекурсия позволяет вам указывать подстановочные знаки для упрощения отслеживания в каталогах и переменные среды, которые позволяют отслеживать файлы в разных средах с несколькими или динамическими именами дисков. Ниже указан список общей информации, которую вы должны знать при настройке рекурсии.

* Для отслеживания нескольких файлов необходимы подстановочные знаки.
* Wildcards используется только в последнем сегменте пути, например, c: s: файл folder\\или /etc/.conf.
* Если переменная среды имеет недействительный путь, проверка выполняется успешно, но при запуске инвентаря этот путь завершается.
* Избегайте общих путей при настройке пути, так как этот тип настройки может привести к тому, что слишком много папок будет пройдено.

## <a name="change-tracking-data-collection-details"></a>Сведения о сборе данных отслеживания изменений.

В следующей таблице указана частота сбора данных для типов изменений. Моментальный снимок данных текущего состояния для каждого типа обновляется по меньшей мере каждые 24 часа:

| **Тип изменения** | **Частота** |
| --- | --- |
| Реестр Windows | 50 минут |
| Файловый ресурс Windows | 30 минут |
| Файловый ресурс Linux | 15 минут |
| Службы Windows | от 10 секунд до 30 минут</br> Значение по умолчанию — 30 минут |
| Управляющие программы Linux | 5 мин |
| Программное обеспечение Windows | 30 минут |
| Программное обеспечение Linux | 5 мин |

В следующей таблице приведены ограничения по отслеживаемым элементам для одного компьютера при использовании решения "Отслеживание изменений".

| **Ресурс** | **Ограничение**| **Примечания** |
|---|---|---|
|Файл|500||
|Реестр|250||
|Программное обеспечение Windows|250|Не включает в себя программное обеспечение hotfixes|
|Пакеты Linux|1250||
|Службы|250||
|Управляющая программа|250||

Среднее использование данных Log Analytics для машины, использующей отслеживание изменений, составляет примерно 40 МБ в месяц. Это приблизительное значение, которое может отличаться в зависимости от среды. Мы рекомендуем вам провести мониторинг среды, чтобы узнать точные данные об использовании.

### <a name="windows-service-tracking"></a>Отслеживание служб Windows

Периодичность сбора по умолчанию для служб Windows — 30 минут. Чтобы настроить периодичность, перейдите к **Отслеживанию изменений**. В разделе **Параметры изменения** на вкладке **Службы Windows** есть ползунок, с помощью которого можно изменить периодичность сбора для служб Windows, выбрав значение от 10 секунд до 30 минут. Переместите ползунок к желаемой периодичности, она будет сохранена автоматически.

![Ползунок служб Windows](./media/change-tracking/windowservices.png)

Агент отслеживает только изменения, это позволяет оптимизировать производительность агента. Если вы установите высокое пороговое значение, изменения могут быть пропущены, когда служба вернется в исходное состояние. Если вы установите меньший период, то запишете изменения, которые в противном случае будут упущены.

> [!NOTE]
> Хотя агент может отслеживать изменения с 10-секундным интервалом, потребуется несколько минут, чтобы данные отобразились на портале. В эти несколько минут изменения по-прежнему отслеживаются и записываются.

### <a name="registry-key-change-tracking"></a>Отслеживание изменений в разделах реестра

Целью отслеживания изменений в разделах реестра является точное определение точек расширения, в которых может быть активирован сторонний код или вредоносная программа. Ниже представлен список предварительно настроенных разделов реестра. Эти разделы настроены, но не включены для отслеживания. Чтобы отслеживать эти разделы реестра, необходимо включить каждый из них.

> [!div class="mx-tdBreakAll"]
> |Ключ реестра | Назначение |
> |---------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
> |`HKEY\LOCAL\MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers` | Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup` | Отслеживаются сценарии, выполняемые при запуске.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown` | Отслеживаются сценарии, выполняемые при завершении работы.
> |`HKEY\LOCAL\MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run` | Отслеживаются разделы, загружаемые перед входом пользователя в учетную запись Windows. Этот раздел используется для 32-разрядных программ, выполняющихся на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\SOFTWARE\Microsoft\Active Setup\Installed Components` | Отслеживаются изменения параметров приложения.
> |`HKEY\LOCAL\MACHINE\Software\Classes\Directory\ShellEx\ContextMenuHandlers` | Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.
> |`HKEY\LOCAL\MACHINE\Software\Classes\Directory\Shellex\CopyHookHandlers` | Отслеживаются общие записи автозапуска, привязывающиеся непосредственно к проводнику Windows и выполняющиеся с внутрипроцессным файлом Explorer.exe.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers` | Отслеживается регистрация обработчика дополнительных значков.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers` | Отслеживается регистрация обработчика дополнительных значков для 32-битных программ, работающих на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects` | Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer. Используется для доступа к модели DOM текущей страницы и управления навигацией.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects` | Отслеживаются новые подключаемые модули вспомогательных объектов браузера для Internet Explorer. Используется для получения доступа к модели DOM текущей страницы и управления навигацией для 32-разрядных программ, работающих на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Internet Explorer\Extensions` | Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Internet Explorer\Extensions` | Отслеживаются новые расширения Internet Explorer, например пользовательские меню инструментов и пользовательские кнопки панели инструментов для 32-битных программ, работающих на 64-разрядных компьютерах.
> |`HKEY\LOCAL\MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Drivers32` | Отслеживаются 32-битные драйверы, связанные с устройствами wavemapper — wave1 и wave2, msacm.imaadpcm, .msadpcm, .msgsm610 и vidc. Ознакомьтесь с разделом о [драйверах] в файле SYSTEM.INI.
> |`HKEY\LOCAL\MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32` | Отслеживаются 32-битные драйверы, связанные с устройствами wavemapper — wave1 и wave2, msacm.imaadpcm, .msadpcm, .msgsm610 и vidc для 32-битных программ, работающих на 64-разрядных компьютерах. Ознакомьтесь с разделом о [драйверах] в файле SYSTEM.INI.
> |`HKEY\LOCAL\MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDlls` | Отслеживается список известных или часто используемых системных библиотек DLL. Эта система предотвращает использование ненадежных разрешений каталога приложений за счет удаления версий вредоносной программы типа "Троянский конь" системных библиотек DLL.
> |`HKEY\LOCAL\MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify` | Отслеживается список пакетов, получающих уведомления о событиях из Winlogon — интерактивной модели поддержки входа в систему для операционной системы Windows.

## <a name="enable-change-tracking"></a><a name="onboard"></a>Включить отслеживание изменений

Чтобы начать отслеживать изменения, необходимо включить решение отслеживания изменений. Есть много способов, чтобы бортовые машины для отслеживания изменений. Ниже приведены рекомендуемые и поддерживаемые способы подключения решения:

* [на одной виртуальной машине](automation-onboard-solutions-from-vm.md);
* [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md);
* [в учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md);
* [с помощью модуля runbook службы автоматизации Azure](automation-onboard-solutions.md).

## <a name="configure-change-tracking"></a>Настройка отслеживания изменений

Чтобы узнать, как на бортовых компьютерах к решению, [см.](automation-onboard-solutions-from-automation-account.md) После того, как у вас есть машина на борту с решением отслеживания изменений, вы можете настроить элементы для отслеживания. При включении нового ключа файла или реестра для отслеживания включен оставить его для отслеживания изменений.

Для отслеживания изменений в файлах в Windows и Linux используются MD5-хэши файлов. Затем эти хэши применяются, чтобы определить, вносились ли изменения с момента последней инвентаризации.

## <a name="enable-file-integrity-monitoring-in-azure-security-center"></a>Включить мониторинг целостности файлов в Центре безопасности Azure

Центр безопасности Azure добавил мониторинг целостности файлов (FIM), который построен на отслеживании изменений Azure. В то время как FIM отслеживает только файлы и реестры, полное решение отслеживания изменений также включает в себя:

- Изменения программного обеспечения
- службы Windows
- Linux Daemons

Если вы уже включили FIM и хотели бы опробовать полное решение отслеживания изменений, вам необходимо выполнить следующие шаги. Настройки не удаляются этим процессом.

> [!NOTE]
> Включение полного решения отслеживания изменений может привести к дополнительным расходам, для получения дополнительной информации, [см.](https://azure.microsoft.com/pricing/details/automation/)

1. Удалите решение мониторинга, перейдя в рабочее пространство и обнаружив его в [списке установленных решений мониторинга.](../azure-monitor/insights/solutions.md#list-installed-monitoring-solutions)
2. Нажмите на название решения, чтобы открыть свою сводную страницу, а затем нажмите на Удалить, как подробно описано в [Удалить решение мониторинга](../azure-monitor/insights/solutions.md#remove-a-monitoring-solution).
3. Повторное включение решения путем навигации по учетной записи Автоматизации и выбора **отслеживания изменений** под **управлением конфигурации.**
4. Подтвердите детали настройки рабочего пространства и нажмите **Enable.**

## <a name="configure-file-content-change-tracking"></a>Настройка отслеживания содержимого файла

Вы можете просматривать содержимое до и после изменения файла с отслеживанием изменения содержимого файла. Эта функция доступна для файлов Windows и Linux. Для каждого изменения файла содержимое файла хранится в учетной записи хранилища. Файл отображается до и после изменения, встраиваемый или бок о бок. Дополнительные сведения см. в разделе [Просмотр содержимого отслеживаемого файла](change-tracking-file-contents.md).

![просмотр изменений в файле](./media/change-tracking-file-contents/view-file-changes.png)

## <a name="configure-windows-registry-keys-to-track"></a>Настройка отслеживания разделов реестра Windows

Чтобы настроить разделы реестра для отслеживания на компьютерах с Windows, сделайте следующее:

1. В учетной записи автоматизации выберите **отслеживание изменений** под **управлением конфигурации.** Щелкните **Изменить параметры** (символ шестеренки).
2. На странице Отслеживание изменений выберите **Реестр Windows** и нажмите кнопку **+ Добавить**, чтобы добавить новый раздел реестра для отслеживания.
3. В окне **Add Windows Registry for Change Tracking** (Добавление реестра Windows для отслеживания изменений) введите сведения о ключе, для которого необходимо выполнить отслеживание, и щелкните **Сохранить**.

|Свойство.  |Описание  |
|---------|---------|
|Активировано     | Определяет, применяется ли параметр.        |
|Имя элемента     | Понятное имя раздела реестра для отслеживания.        |
|Группа     | Имя группы для логического группирования разделов реестра.        |
|Раздел реестра Windows   | Путь для проверки раздела реестра. Например, HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Common Startup.      |

## <a name="configure-file-tracking-on-windows"></a>Настройка отслеживания файлов в Windows

Используйте следующие шаги для настройки отслеживания файлов на компьютерах Windows:

1. В учетной записи автоматизации выберите **отслеживание изменений** под **управлением конфигурации.** Щелкните **Изменить параметры** (символ шестеренки).
2. На странице Отслеживание изменений выберите **Файлы Windows**, нажмите кнопку **+ Добавить**, чтобы добавить новый файл для отслеживания.
3. В окне **Add Windows File for Change Tracking** (Добавление файла Windows для отслеживания изменений) введите сведения о файле, для которого необходимо выполнить отслеживание, и щелкните **Сохранить**.

|Свойство.  |Описание  |
|---------|---------|
|Активировано     | Правда, если параметр применяется, и ложные в противном случае.        |
|Имя элемента     | Понятное имя файла для отслеживания.        |
|Группа     | Имя группы для логического группирования файлов.        |
|Укажите путь     | Путь проверки файла, например, **c:\\\***<br>Можно также использовать переменные среды, такие как `%winDir%\System32\\\*.*`.       |
|Рекурсия     | Правда, если рекурсия используется при поиске элемента для отслеживания, и ложные в противном случае.        |
|Отправка содержимого файла для всех параметров| Верно для загрузки содержимого файла на отслеживаемые изменения, и ложные в противном случае.|

## <a name="configure-file-tracking-on-linux"></a>Настройка отслеживания файлов на Linux

Чтобы настроить отслеживание файла на компьютере с Linux, сделайте следующее:

1. В учетной записи автоматизации выберите **отслеживание изменений** под **управлением конфигурации.** Щелкните **Изменить параметры** (символ шестеренки).
2. На странице Отслеживание изменений выберите **Файлы Linux**, нажмите кнопку **+ Добавить**, чтобы добавить новый файл для отслеживания.
3. На **добавлении Linux файл для отслеживания изменений**, введите информацию для файла или каталога, чтобы отслеживать и нажмите **Сохранить**.

|Свойство.  |Описание  |
|---------|---------|
|Активировано     | Определяет, применяется ли параметр.        |
|Имя элемента     | Понятное имя файла для отслеживания.        |
|Группа     | Имя группы для логического группирования файлов.        |
|Укажите путь     | Путь для проверки наличия файла. Например: /etc/*.conf.       |
|Тип пути     | Тип элемента для отслеживания (возможными значениями могут быть "Файл" и "Каталог").        |
|Рекурсия     | Определяет, используется ли рекурсия при поиске отслеживаемого элемента.        |
|Использовать sudo     | Этот параметр определяет, используется ли sudo для проверки наличия элемента.         |
|Ссылки     | Этот параметр определяет работу символических ссылок при обзоре каталогов.<br> **Пропустить** — игнорирование символических ссылок без включения ссылочных файлов и каталогов.<br>**Следуйте** - Следует символические ссылки во время рекурсии, а также включает в себя файлы / каталоги ссылки.<br>**Управлять** — переход по символическим ссылкам и разрешение изменения полученного содержимого.     |
|Отправка содержимого файла для всех параметров| Включение или отключение отправки содержимого файла для отслеженных изменений. Доступные параметры: **True** или **False**.|

> [!NOTE]
> Однако использовать ссылку "Управлять" не рекомендуется. Получение содержимого файлов не поддерживается.

## <a name="search-logs"></a>Поиск по журналам

Вы можете выполнять различные поисковые запросы в отношении журналов для записей изменений. С открытием страницы отслеживания изменений нажмите **Log Analytics,** это открывает страницу журналов. Следующая таблица содержит примеры запросов поиска по журналу для получения записей об изменениях, собранных этим решением.

|Запрос  |Описание  |
|---------|---------|
|ConfigurationData<br>&#124; where   ConfigDataType == "WindowsServices" and SvcStartupType == "Auto"<br>&#124; where SvcState == "Stopped"<br>&#124; summarize arg_max(TimeGenerated, *) by SoftwareName, Computer         | Показывает самые последние записи инвентаризации для служб Windows, для которых установлено значение "Автоматический" и которые были остановлены.<br>Результаты ограничены самой последней записью для определенного компьютера и имени ПО.      |
|ConfigurationChange<br>&#124; where ConfigChangeType == "Software" and ChangeCategory == "Removed"<br>&#124; order by TimeGenerated desc|Показывает записи об изменениях для удаленного программного обеспечения.|

## <a name="alert-on-changes"></a>Оповещения об изменениях

Ключевой возможностью отслеживания изменений является оповещение о состоянии конфигурации и любых изменениях состояния конфигурации гибридной среды. Следующий пример показывает, что файл **C: «окна» 32»драйверы и хосты** были изменены на машине. Этот файл важен, потому что Windows использует его для решения имен хоста с IP-адресами. Эта операция имеет приоритет над DNS и может привести к проблемам с подключением или перенаправлению трафика на вредоносные или иные опасные веб-сайты.

![Диаграмма, отображающая изменение файла hosts](./media/change-tracking/changes.png)

Чтобы продолжить анализ этого изменения, перейдите к поиску в журнале, щелкнув **Log Analytics**. Попав в поиск по журналу, найдите изменения содержимого в файле Hosts с помощью запроса `ConfigurationChange | where FieldsChanged contains "FileContentChecksum" and FileSystemPath contains "hosts"`. Этот запрос выполняет поиск изменений, которые включали изменение содержимого файла для файлов, полный путь к которым содержит слово "hosts". Вы также можете запросить конкретный файл, изменив путь к его полностью определенной форме (например, `FileSystemPath == "c:\windows\system32\drivers\etc\hosts"`).

После того, как запрос возвращает желаемые результаты, нажмите **«Новое правило оповещения»** в поиске журнала, чтобы открыть страницу создания оповещения. Вы также можете перейти к этой возможности с помощью **Azure Monitor** на портале Azure. 

Проверьте запрос еще раз и измените логику оповещения. В этом случае вы хотите, чтобы оповещение активировалось, если на всех машинах среды обнаружено хотя бы одно изменение.

![Рисунок, демонстрирующий запрос на изменение для отслеживания изменений в файле hosts](./media/change-tracking/change-query.png)

После установки логики условий назначьте группы действий для выполнения действий в ответ на срабатывание оповещения. В этом случае настроены сообщения электронной почты, и необходимо создать билет ITSM.  Вы также можете выполнить множество других полезных действий, таких как запуск функции Azure, модуля runbook службы автоматизации, веб-перехватчика или приложения логики.

![Изображение с настройкой группы действий для оповещения об изменении](./media/change-tracking/action-groups.png)

После установки всех параметров и логики оповещение можно применить к среде.

### <a name="alert-suggestions"></a>Предложения оповещений

В то время как оповещение об изменениях в файле хоста является одним из хороших приложений оповещений для отслеживания изменений или данных инвентаризации, существует еще много сценариев оповещения, включая случаи, определенные вместе с их примерами запросов в разделе ниже.

|Запрос  |Описание  |
|---------|---------|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Files" и FileSystemPath содержит " c:\\windows\\system32\\drivers\\"|Полезно для отслеживания изменений в системных критических файлах|
|ConfigurationChange <br>&#124; где FieldsChanged содержит "FileContentChecksum" и FileSystemPath == "c:\\windows\\system32\\drivers\\etc\\hosts"|Полезно для отслеживания изменений в файлах конфигурации ключа|
|ConfigurationChange <br>&#124; где ConfigChangeType == "WindowsServices" и SvcName содержит "w3svc" и SvcState == "Stopped"|Полезно для отслеживания изменений в системных критически важных службах|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Daemons" и SvcName содержит "ssh" и SvcState != "Running"|Полезно для отслеживания изменений в системных критически важных службах|
|ConfigurationChange <br>&#124; где ConfigChangeType == "Software" и ChangeCategory == "Added"|Полезно для сред, которые требуют заблокированных конфигураций программного обеспечения|
|ConfigurationData <br>&#124; где SoftwareName содержит "Monitoring Agent" и CurrentVersion != "8.0.11081.0"|Полезно для просмотра, на каких машинах установлена устаревшая или несовместимая версия программного обеспечения. Он сообщает о последнем сообщенном состоянии конфигурации, а не об изменениях.|
|ConfigurationChange <br>&#124; где RegistryKey »\\»HKEY_LOCAL_MACHINE\\\\ПРОГРАММНОе\\обеспечение\\Microsoft Windows ТекущаяВерсия КачествоCompat"| Полезно для отслеживания изменений в важных антивирусных ключах|
|ConfigurationChange <br>&#124;, где RegistryKey\\содержит\\"HKEY_LOCAL_MACHINE\\\\SYSTEM\\CurrentControlSet Услуги\\SharedAccess Параметры FirewallPolicy"| Полезно для отслеживания изменений в параметрах брандмауэра|

## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения об использовании решения отслеживания изменений см. в следующем руководстве:

> [!div class="nextstepaction"]
> [Устранение неполадок при изменениях в среде](automation-tutorial-troubleshoot-changes.md)

* Используйте [поиск в журналах Azure Monitor для](../log-analytics/log-analytics-log-searches.md) просмотра подробных данных отслеживания изменений.
