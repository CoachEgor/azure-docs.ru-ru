---
title: Решение для управления обновлениями в Azure
description: В этой статье описывается, как с помощью решения Azure Управление обновлениями управлять обновлениями для компьютеров под управлением Windows и Linux.
services: automation
ms.subservice: update-management
ms.date: 02/27/2020
ms.topic: conceptual
ms.openlocfilehash: c76b14e4f08ec930159498da4a35fdad0341929e
ms.sourcegitcommit: 7b25c9981b52c385af77feb022825c1be6ff55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79278510"
---
# <a name="update-management-solution-in-azure"></a>Решение для управления обновлениями в Azure

С помощью решения Управление обновлениями в службе автоматизации Azure можно управлять обновлениями операционной системы для компьютеров под управлением Windows и Linux в Azure, в локальных средах и в других облачных средах. Вы можете быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять процессом установки необходимых обновлений для серверов.

Вы можете включить Управление обновлениями для виртуальных машин (ВМ), используя следующие методы:

- Из [учетной записи службы автоматизации Azure](automation-onboard-solutions-from-automation-account.md) для одной или нескольких компьютеров Azure и вручную для компьютеров, не относящихся к Azure.

- Для одной виртуальной машины Azure со страницы виртуальной машины в портал Azure. Этот сценарий доступен для виртуальных машин [Linux](../virtual-machines/linux/tutorial-config-management.md#enable-update-management) и [Windows](../virtual-machines/windows/tutorial-config-management.md#enable-update-management) .

- Для [нескольких виртуальных машин Azure](manage-update-multi.md) , выбрав их на странице **виртуальные машины** в портал Azure. 

> [!NOTE]
> Управление обновлениями решение требует связывания рабочей области Log Analytics с учетной записью службы автоматизации. Полный список поддерживаемых регионов см. в статье [сопоставления рабочих областей Azure](./how-to/region-mappings.md). Сопоставления регионов не влияют на возможность управления виртуальными машинами в отдельном регионе из учетной записи службы автоматизации.

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../includes/azure-monitor-log-analytics-rebrand.md)]

Доступен [шаблон Azure диспетчер ресурсов](automation-update-management-deploy-template.md) , который позволяет развертывать решение Управление обновлениями в новой или существующей учетной записи службы автоматизации и в log Analytics рабочей области в подписке.

## <a name="solution-overview"></a>Обзор решения

Компьютеры под управлением Управление обновлениями используют следующие конфигурации для выполнения оценки и обновления развертываний.

* Агент Log Analytics для Windows или Linux
* служба настройки требуемого состояния PowerShell;
* гибридные рабочие роли Runbook службы автоматизации;
* Центр обновления Майкрософт или Windows Server Update Services (WSUS) для компьютеров Windows

На следующей схеме показано, как решение оценивает и применяет обновления безопасности ко всем подключенным компьютерам Windows Server и Linux в рабочей области.

![Поток процесса управления обновлениями](./media/automation-update-management/update-mgmt-updateworkflow.png)

Управление обновлениями можно использовать для внутренних подключенных компьютеров в нескольких подписках одного и того же клиента.

После выпуска пакета он занимает от 2 до 3 часов, чтобы исправление отображалось для компьютеров Linux для оценки. Для компьютеров под Windows для оценки исправления после его выпуска требуется 12 – 15 часов.

После того как компьютер завершит проверку соответствия обновлений требованиям, Агент пересылает данные в неполное Azure Monitor журналов. На компьютере Windows проверка соответствия выполняется каждые 12 часов по умолчанию.

Помимо расписания проверки, проверка соответствия обновлений инициируется в течение 15 минут после перезапуска агента Log Analytics, до установки обновления и после установки обновления.

Для компьютера Linux проверка соответствия выполняется каждый час по умолчанию. Если агент Log Analytics перезапускается, проверка соответствия инициируется в течение 15 минут.

Решение содержит сведения о том, насколько актуальны компьютеры в зависимости от того, с каким источником вы настраиваете синхронизацию. Если компьютер Windows настроен для передачи отчетов службам WSUS в зависимости от времени последней синхронизации служб WSUS с Центр обновления Майкрософт, результаты могут отличаться от показанных Центр обновления Майкрософт. Такое поведение одинаково для компьютеров Linux, настроенных для передачи отчетов в локальный репозиторий, а не в общедоступный репозиторий.

> [!NOTE]
> Для правильной передачи данных в службу решению управления обновлениями требуется, чтобы были включены определенные URL-адреса и порты. Дополнительные сведения о требованиях см. в разделе [Настройка сети](automation-hybrid-runbook-worker.md#network-planning).

Можно развертывать и устанавливать обновления программного обеспечения на компьютерах, для которых требуются обновления, путем создания запланированного развертывания. Обновления, классифицированные как *необязательные* , не включаются в область развертывания для компьютеров Windows. В область развертывания включаются только необходимые обновления.

Запланированное развертывание определяет, какие целевые компьютеры получают применимые обновления. Это можно сделать, явно указав определенные компьютеры или выбрав [группу компьютеров](../azure-monitor/platform/computer-groups.md) на основе поиска по журналам определенного набора компьютеров (или в [запросе Azure](automation-update-management-query-logs.md) , который динамически выбирает виртуальные машины Azure в соответствии с указанными критериями). Эти группы отличаются от [конфигурации области](../azure-monitor/insights/solution-targeting.md), которая используется только для определения того, какие компьютеры получают пакеты управления, которые включают решение.

Можно также указать расписание для утверждения и задать период времени, в течение которого можно установить обновления. Этот период называется окном обслуживания. 20-минутный интервал периода обслуживания резервируется для перезагрузки, предполагая, что один из них необходим и выбран соответствующий параметр перезагрузки. Если исправление занимает больше времени, чем ожидалось, и в период обслуживания меньше 20 минут, перезагрузка не выполняется.

Обновления устанавливаются с помощью Runbook в службе автоматизации Azure. Вы не можете просматривать эти модули Runbook, и они не нуждаются в какой бы то ни было конфигурации. При создании развертывания обновления создается расписание, которое запускает главный Runbook обновления в указанное время для включенных компьютеров. Этот Runbook запускает для каждого агента дочерний Runbook, который устанавливает необходимые обновления.

На дату и время, указанные в развертывании обновлений, целевые компьютеры выполняют развертывание параллельно. Перед установкой выполняется проверка, чтобы убедиться, что обновления по-прежнему необходимы. Для клиентских компьютеров с WSUS, если обновления не утверждены в WSUS, развертывание обновления завершается сбоем.

Наличие компьютера, зарегистрированного для Управление обновлениями в нескольких Log Analytics рабочих областях (также называемых многосетевых интерфейсами), не поддерживается.

## <a name="clients"></a>Клиенты

### <a name="supported-client-types"></a>Поддерживаемые типы клиентов

В следующей таблице перечислены операционные системы, поддерживаемые для оценки обновлений. Для установки исправлений требуется Гибридная Рабочая роль Runbook. Сведения о требованиях к гибридной рабочей роли Runbook см. в руководствах по установке для установки [гибридной рабочей роли Runbook Windows](automation-windows-hrw-install.md) и [гибридной рабочей роли Runbook Linux](automation-linux-hrw-install.md#installing-a-linux-hybrid-runbook-worker).

|Операционная система  |Примечания  |
|---------|---------|
|Windows Server 2019 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2016 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2012 R2 (Datacenter/Standard)<br><br>Windows Server 2012 || 
|Windows Server 2008 R2 (RTM и SP1 Standard)| Управление обновлениями поддерживает только выполнение оценок для этой операционной системы. Установка исправлений не поддерживается, так как [Гибридная Рабочая роль Runbook](automation-windows-hrw-install.md) не поддерживается для Windows Server 2008 R2. |
|CentOS 6 (x86 или x64) и 7 (x64).      | Агентам Linux требуется доступ к репозиторию обновлений. Для установки исправлений на основе классификации необходимо, чтобы `yum` возвращали данные безопасности, которые CentOS отсутствуют в выпусках RTM. Дополнительные сведения об исправлениях на основе классификации в CentOS см. в [статье классификации обновлений в Linux](automation-view-update-assessments.md#linux-2).          |
|Red Hat Enterprise 6 (x86 или x64) и 7 (x64).     | Агентам Linux требуется доступ к репозиторию обновлений.        |
|SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)     | Агентам Linux требуется доступ к репозиторию обновлений.        |
|Ubuntu 14.04 LTS, 16.04 LTS и 18.04 LTS (x86/x64)      |Агентам Linux требуется доступ к репозиторию обновлений.         |

> [!NOTE]
> Масштабируемые наборы виртуальных машин Azure можно управлять с помощью Управление обновлениями. Управление обновлениями работает с самими экземплярами, а не с базовым образом. Необходимо запланировать обновления последовательно, чтобы не все экземпляры виртуальных машин обновлялись одновременно.
> Чтобы добавить узлы для масштабируемых наборов виртуальных машин, выполните действия, описанные в разделе подключение [компьютера без Azure](automation-tutorial-installed-software.md#onboard-a-non-azure-machine).

### <a name="unsupported-client-types"></a>Неподдерживаемые типы клиентов

В следующей таблице перечислены неподдерживаемые операционные системы.

|Операционная система  |Примечания  |
|---------|---------|
|Клиент Windows     | Клиентские операционные системы (например, Windows 7 и Windows 10) не поддерживаются.        |
|Nano Server Windows Server 2016     | Не поддерживается.       |
|Узлы службы Kubernetes Azure | Не поддерживается. Используйте процесс установки исправлений, описанный в статье [Установка обновлений безопасности и ядра для узлов Linux в службе Kubernetes Azure (AKS)](../aks/node-updates-kured.md) .|

### <a name="client-requirements"></a>Требования к клиенту

Ниже приведены сведения о требованиях клиента, зависящих от операционной системы. Дополнительные рекомендации см. в разделе [планирование сети](#ports).

#### <a name="windows"></a>Windows

Агенты Windows должны быть настроены для взаимодействия с сервером WSUS или для них требуется доступ к Центр обновления Майкрософт.

Управление обновлениями можно использовать с Configuration Manager. Дополнительные сведения о сценариях интеграции см. в статье [интеграция Configuration Manager с Управление обновлениями](oms-solution-updatemgmt-sccmintegration.md#configuration). Требуется [log Analytics агент Windows](../azure-monitor/platform/agent-windows.md) . Агент устанавливается автоматически, если вы подключите виртуальную машину Azure.

По умолчанию виртуальные машины Windows, развернутые из Azure Marketplace, настроены на получение автоматических обновлений из службы Центр обновления Windows. Это поведение не изменяется при добавлении этого решения или добавлении виртуальных машин Windows в рабочую область. Если вы не управляете обновлениями с помощью этого решения, будет применено поведение по умолчанию (автоматическое применение обновлений).

> [!NOTE]
> Пользователь может изменить групповая политика таким образом, чтобы перезагрузка компьютера могла выполняться только пользователем, а не системой. Управляемые компьютеры могут зависнуть, если у Управление обновлениями нет прав на перезагрузку компьютера без вмешательства пользователя вручную.
>
> Дополнительные сведения см. в разделе [Настройка параметров групповая политика для автоматическое обновление](https://docs.microsoft.com/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates).

#### <a name="linux"></a>Linux

Для Linux компьютеру требуется доступ к репозиторию обновлений. Репозиторий обновлений может быть общедоступным или частным. Для взаимодействия с решением "Управление обновлениями" требуется TLS 1.1 или TLS 1.2. В этом решении не поддерживается агент Log Analytics для Linux, настроенный для передачи отчетов в более чем одну Log Analytics рабочую область. На компьютере также должен быть установлен Python 2. x.

Сведения о том, как установить агент Log Analytics для Linux и загрузить последнюю версию, см. в статье [log Analytics Agent for Linux](../azure-monitor/platform/agent-linux.md). Сведения об установке агента Log Analytics для Windows см. [в разделе Подключение компьютеров Windows к Azure Monitor](../log-analytics/log-analytics-windows-agent.md).

Виртуальные машины, созданные на основе образов Red Hat Enterprise Linux по требованию (RHEL), доступных в Azure Marketplace, регистрируются для доступа к [инфраструктуре Red Hat Update Framework (RHUI)](../virtual-machines/workloads/redhat/redhat-rhui.md) , которая развернута в Azure. Любой другой дистрибутив Linux должен быть обновлен из репозитория файлов в сети распространения с помощью поддерживаемых методов распространения.

## <a name="permissions"></a>Разрешения

Для создания развертываний обновлений и управления ими требуются определенные разрешения. Дополнительные сведения об этих разрешениях см. в разделе [доступ на основе ролей — Управление обновлениями](automation-role-based-access-control.md#update-management).

## <a name="solution-components"></a>Компоненты решения

Решение состоит из приведенных ниже ресурсов. Эти ресурсы автоматически добавляются в учетную запись службы автоматизации при включении решения. 

### <a name="hybrid-worker-groups"></a>Группы гибридных рабочих ролей

После включения этого решения любой компьютер Windows, подключенный к рабочей области Log Analytics, автоматически настраивается как гибридная Рабочая роль Runbook для поддержки модулей Runbook, включенных в это решение.

Каждый компьютер под управлением Windows, управляемый решением, отображается в области **группы гибридных рабочих** ролей в качестве **системной группы гибридных рабочих ролей** для учетной записи службы автоматизации. В решениях используется *имя узла FQDN_GUID* соглашения об именовании. Вы не можете выбрать эти группы с помощью модулей Runbook в своей учетной записи. При попытайтесь выполнить попытку не удастся. Эти группы предназначены для поддержки только этого решения по управлению.

Вы можете добавить компьютер Windows в группу гибридных рабочих ролей Runbook в учетной записи службы автоматизации, чтобы обеспечить поддержку модулей Runbook службы автоматизации, если вы используете одну и ту же учетную запись как для решения, так и для членства в группе гибридной рабочей роли Runbook. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

### <a name="management-packs"></a>Пакеты управления

Если группа управления System Center Operations Manager [подключена к log Analytics рабочей области](../azure-monitor/platform/om-agents.md), в Operations Manager устанавливаются следующие пакеты управления. Эти пакеты управления также устанавливаются на напрямую подключенных компьютерах Windows после добавления решения. Управлять и настраивать эти пакеты управления не требуется.

* Пакет аналитики оценки обновления Microsoft System Center Advisor (Microsoft.IntelligencePacks.UpdateAssessment);
* Microsoft.IntelligencePack.UpdateAssessment.Configuration (Microsoft.IntelligencePack.UpdateAssessment.Configuration);
* пакет управления развертыванием обновлений.

> [!NOTE]
> Если у вас есть группа управления Operations Manager 1807 или 2019, подключенная к рабочей области Log Analytics с агентами, настроенными в группе управления для получения данных журнала, необходимо переопределить следующее правило, чтобы управлять ими с помощью Управление обновлениями: Переопределите параметр **исауторегистратионенаблед** и задайте для него значение **true** в правиле **Microsoft. IntelligencePacks. AzureAutomation. HybridAgent. init** .

Дополнительные сведения об обновлении пакетов управления решениями см. в разделе [Connect Operations Manager to Azure Monitor Logs](../azure-monitor/platform/om-agents.md).

> [!NOTE]
> Чтобы полностью управлять компьютерами с агентом Operations Manager с помощью Управление обновлениями, агент должен быть обновлен до агента Log Analytics для Windows или Linux. Чтобы узнать, как обновить агент, см. [эту статью](https://docs.microsoft.com/system-center/scom/deploy-upgrade-agents). В средах, использующих Operations Manager, необходимо запустить System Center Operations Manager 2012 R2 UR 14 или более поздней версии.

## <a name="data-collection"></a>сбор данных

### <a name="supported-agents"></a>Поддерживаемые агенты

В приведенной ниже таблице описаны подключенные источники, которые поддерживает это решение.

| Подключенный источник | Поддерживается | Description |
| --- | --- | --- |
| Агенты Windows |Да |Решение собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Да |Решение собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Да |Решение собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления.<br/><br/>Прямое подключение агента Operations Manager к Azure Monitor журналов не требуется. Данные пересылаются из группы управления в рабочую область Log Analytics. |

### <a name="collection-frequency"></a>Частота сбора

Сканирование выполняется дважды в день для каждого управляемого компьютера Windows. Каждые 15 минут вызывается API Windows, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие.

Сканирование выполняется каждый час для каждого управляемого компьютера Linux.

Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

Средний уровень использования данных Azure Monitor журналов для компьютера, использующего Управление обновлениями, составляет примерно 25 мегабайт (МБ) в месяц. Это значение является только приближением и может изменяться в зависимости от среды. Рекомендуется отслеживать среду, чтобы отслеживать точное использование. Дополнительные сведения об анализе использования данных см. в разделе [Управление использованием и стоимостью](../azure-monitor/platform/manage-cost-storage.md).

## <a name="ports"></a>Планирование сети

Для Управления обновлениями требуются следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure для государственных организаций  |
|---------|---------|
|*.ods.opinsights.azure.com    | *.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net | *.blob.core.usgovcloudapi.net|
|*.azure-automation.net | *.azure-automation.us|

Для компьютеров Windows необходимо также разрешить передачу трафика на любые конечные точки, необходимые для Центр обновления Windows. Обновленный список обязательных конечных точек можно найти в [проблемах, связанных с HTTP/proxy](/windows/deployment/update/windows-update-troubleshooting#issues-related-to-httpproxy). Если у вас есть локальный [Центр обновления Windows сервер](/windows-server/administration/windows-server-update-services/plan/plan-your-wsus-deployment), необходимо также разрешить трафик на сервер, указанный в [ключе WSUS](/windows/deployment/update/waas-wu-settings#configuring-automatic-updates-by-editing-the-registry).

Для компьютеров с Red Hat Linux см. раздел [IP-адреса для серверов доставки содержимого RHUI](../virtual-machines/workloads/redhat/redhat-rhui.md#the-ips-for-the-rhui-content-delivery-servers) для требуемых конечных точек. Другие дистрибутивы Linux см. в документации поставщика.

Дополнительные сведения о портах, необходимых для гибридной рабочей роли Runbook, см. в разделе [порты ролей гибридной рабочей роли](automation-hybrid-runbook-worker.md#hybrid-worker-role).

Рекомендуется использовать адреса, указанные при определении исключений. IP-адреса можно скачать [Microsoft Azure диапазоны IP-адресов центра обработки данных](https://www.microsoft.com/download/details.aspx?id=41653). Этот файл обновляется еженедельно и отражает развернутые в данный момент диапазоны и все будущие изменения в диапазонах IP-адресов.

Следуйте инструкциям в разделе [Подключение компьютеров без доступа к Интернету](../azure-monitor/platform/gateway.md) для настройки компьютеров, у которых нет доступа к Интернету.

## <a name="update-classifications"></a>Классификации обновлений

В следующих таблицах содержатся списки классификаций обновлений в Управлении обновлениями с определениями для каждой классификации.

### <a name="windows"></a>Windows

|Классификация  |Description  |
|---------|---------|
|критические обновления;     | Обновление для конкретной проблемы, которая относится к критической, не связанной с безопасностью ошибке.        |
|Обновления для системы безопасности     | Обновление для ошибки, связанной с безопасностью конкретного продукта.        |
|накопительные пакеты обновления;     | Накопительный набор исправлений, упакованных в один пакет для удобства развертывания.        |
|пакеты дополнительных компонентов;     | Новые функции продукта, которые распространяются вне выпуска продукта.        |
|пакеты обновления;     | Накопительный набор исправлений, применяемых к приложению.        |
|обновления определений;     | Обновление для вирусов или других файлов определений.        |
|Инструменты     | Служебная программа или функция, которая помогает выполнить одну или несколько задач.        |
|Обновления     | Обновление приложения или файла, установленного в настоящее время.        |

### <a name="linux-2"></a>Linux

|Классификация  |Description  |
|---------|---------|
|критические обновления и обновления для системы безопасности;     | Обновления для конкретной проблемы или проблемы, связанной с безопасностью продукта.         |
|Другие обновления     | Все остальные обновления, не являющиеся критически важными или не являющиеся обновлениями для системы безопасности.        |

В Linux Управление обновлениями может различать критические обновления и обновления системы безопасности в облаке при отображении данных оценки из-за обогащения данных в облаке. Для исправления в решении по управлению обновлениями используются данные классификации, доступные на компьютере. В отличие от других дистрибутивов, CentOS не содержит эту информацию в RTM. Если у вас есть компьютеры CentOS, настроенные для возврата данных безопасности для следующей команды, Управление обновлениями можете выполнить исправление на основе классификаций.

```bash
sudo yum -q --security check-update
```

В настоящее время нет поддерживаемого метода для включения собственной классификации — доступность данных в CentOS. В настоящее время для клиентов, которые могли включить этот вариант самостоятельно, предоставляется только лучшая поддержка. 

Для классификации обновлений в Red Hat Enterprise версии 6 необходимо установить подключаемый модуль Yum-Security. В Red Hat Enterprise Linux 7 подключаемый модуль уже является частью yum, поэтому нет необходимости устанавливать ничего. Дополнительные сведения см. в следующей [статье базы знаний](https://access.redhat.com/solutions/10021)Red Hat.

## <a name="integrate-with-configuration-manager"></a>Интеграция с Configuration Manager

Клиенты, которые вкладывают в конечную точку Майкрософт Configuration Manager для управления компьютерами, серверами и мобильными устройствами, также полагаются на надежность и зрелости Configuration Manager, чтобы помочь им управлять обновлениями программного обеспечения. Configuration Manager входит в их цикл управления обновлением программного обеспечения (SUM).

Сведения о том, как интегрировать решение по управлению с Configuration Manager, см. в статье [интеграция Configuration Manager с Управление обновлениями](oms-solution-updatemgmt-sccmintegration.md).

### <a name="third-party-updates-on-windows"></a>Сторонние обновления в Windows

Управление обновлениями использует локально настроенный репозиторий обновлений для обновления поддерживаемых систем Windows. Это либо WSUS, либо Центр обновления Windows. Такие средства, как [System Center Updates Publisher](https://docs.microsoft.com/configmgr/sum/tools/updates-publisher) (Updates Publisher), позволяют импортировать и публиковать пользовательские обновления с помощью WSUS. Этот сценарий позволяет Управление обновлениями обновлять компьютеры, использующие Configuration Manager в качестве репозитория обновлений программного обеспечения стороннего производителя. Чтобы узнать, как настроить Updates Publisher, см. статью [Установка Updates Publisher](https://docs.microsoft.com/configmgr/sum/tools/install-updates-publisher).

## <a name="onboard"></a>Включение решения "Управление обновлениями"

Чтобы начать обновление систем, необходимо включить решение Управление обновлениями. Ниже приведены рекомендуемые и поддерживаемые методы для адаптации решения.

- [на одной виртуальной машине](automation-onboard-solutions-from-vm.md);

- [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md);

- [в учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md);

- [с помощью модуля runbook службы автоматизации Azure](automation-onboard-solutions.md).

- [С помощью шаблона Azure Resource Manager](automation-update-management-deploy-template.md)

## <a name="next-steps"></a>Дальнейшие действия

Чтобы ознакомиться с общими вопросами об этом решении, изучите [вопросы и ответы](automation-faq.md) по службе автоматизации Azure.
