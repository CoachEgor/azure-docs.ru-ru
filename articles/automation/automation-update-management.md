---
title: Решение для управления обновлениями в Azure
description: Цель этой статьи — помочь вам понять, как использовать решение по управлению обновлениями Azure для управления обновлениями на компьютерах Windows и Linux.
services: automation
ms.service: automation
ms.subservice: update-management
author: bobbytreed
ms.author: robreed
ms.date: 05/22/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 1751e8d67f59285d011df33a2d4d1d6d8abcec6a
ms.sourcegitcommit: 0576bcb894031eb9e7ddb919e241e2e3c42f291d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2019
ms.locfileid: "72376051"
---
# <a name="update-management-solution-in-azure"></a>Решение для управления обновлениями в Azure

Решение Управление обновлениями в службе автоматизации Azure можно использовать для управления обновлениями операционной системы для компьютеров под управлением Windows и Linux в Azure, в локальных средах или в других поставщиках облачных служб. Благодаря ему вы сможете быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять установкой необходимых обновлений на серверах.

Вы можете включить управление обновлениями для виртуальных машин непосредственно из учетной записи службы автоматизации Azure. Сведения о включении управления обновлениями для виртуальных машин из учетной записи службы автоматизации см. в статье [Управление обновлениями для нескольких виртуальных машин Azure](manage-update-multi.md). Вы также можете включить решение "Управление обновлениями" для виртуальной машины на странице виртуальной машины на портале Azure. Этот сценарий доступен для виртуальных машин [Linux](../virtual-machines/linux/tutorial-config-management.md#enable-update-management) и [Windows](../virtual-machines/windows/tutorial-config-management.md#enable-update-management).

> [!NOTE]
> Управление обновлениями решение требует связывания рабочей области Log Analytics с учетной записью службы автоматизации. Полный список поддерживаемых регионов см. в статье [сопоставления рабочих областей Azure](./how-to/region-mappings.md). Сопоставления регионов не влияют на возможность управления виртуальными машинами в отдельном регионе, чем ваша учетная запись службы автоматизации.

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../includes/azure-monitor-log-analytics-rebrand.md)]

## <a name="solution-overview"></a>Обзор решения

Ниже перечислены конфигурации, которые используются компьютерами, управляемыми с помощью решения "Управление обновлениями", для выполнения развертываний оценок и обновлений:

* Microsoft Monitoring Agent (MMA) для Windows или Linux;
* служба настройки требуемого состояния PowerShell;
* гибридные рабочие роли Runbook службы автоматизации;
* службы Центра обновления Майкрософт или Windows Server Update Services (WSUS) для компьютеров с Windows.

На схеме ниже показано концептуальное представление потока данных и его поведения, а также, как решение анализирует и применяет обновления безопасности ко всем подключенным компьютерам Windows Server и Linux в рабочей области:

![Поток процесса управления обновлениями](./media/automation-update-management/update-mgmt-updateworkflow.png)

Управление обновлениями можно использовать для внутренних подключенных компьютеров в нескольких подписках одного и того же клиента.

После выпуска пакета он занимает 2-3 часов для отображения исправления на компьютерах Linux для оценки. Исправление для оценки компьютеров под управлением Windows появиться через 12–15 часов после выпуска.

После того как компьютер выполнит проверку соответствия обновлений требованиям, Агент пересылает данные в неполное Azure Monitor журналов. На компьютере с Windows проверка на соответствие по умолчанию выполняется каждые 12 часов.

Помимо расписания проверки в течение 15 минут после перезапуска MMA запускается проверка на соответствие обновлений. Это происходит перед установкой обновления и после нее.

Для компьютера Linux проверка соответствия выполняется каждый час по умолчанию. При перезапуске агента MMA проверка соответствия инициируется в течение 15 минут.

Решение формирует отчет по актуальности состояния компьютера в зависимости от настроенного для синхронизации источника. Если компьютер с Windows настроен на отправку отчетов в службы WSUS в зависимости от последней синхронизации WSUS с центром обновления Майкрософт, результаты центра обновления Майкрософт могут быть недостоверными. Это поведение касается компьютеров под управлением Linux, настроенных на отправку отчета в локальный, а не общедоступный репозиторий.

> [!NOTE]
> Для правильной передачи данных в службу решению управления обновлениями требуется, чтобы были включены определенные URL-адреса и порты. Дополнительные сведения о требованиях см. в разделе [Настройка сети](automation-hybrid-runbook-worker.md#network-planning).

Вы можете развернуть и установить обновления программного обеспечения на компьютерах, требующих обновлений с помощью запланированного развертывания. *Необязательные* обновления не включены в область развертывания для компьютеров с Windows. В область развертывания включаются только необходимые обновления.

Запланированное развертывание определяет, какие целевые компьютеры получают применимые обновления, путем явного указания компьютеров или выбора [группы компьютеров](../azure-monitor/platform/computer-groups.md) на основе поиска по журналам определенного набора компьютеров или [запроса Azure](automation-update-management-query-logs.md) . Это позволяет динамически выбирать виртуальные машины Azure в соответствии с указанными критериями. Эти группы отличаются от [конфигурации области](../azure-monitor/insights/solution-targeting.md), которая используется только для определения того, какие компьютеры получают пакеты управления, которые включают решение.

Вы также можете указать расписание для назначения и подтверждения периода времени, в течение которого могут быть установлены обновления. Этот период времени называется окном обслуживания. 24 минуты периода обслуживания зарезервированы для перезагрузки, если требуется перезагрузка и вы выбрали соответствующий параметр перезагрузки. Если установка исправления занимает больше времени, чем ожидалось, и в период обслуживания приходится менее двадцати минут, перезагрузка не выполняется.

Обновления устанавливаются с помощью Runbook в службе автоматизации Azure. Эти модули Runbook нельзя просмотреть, и они не требуют настройки. При создании развертывания обновлений оно создает расписание, по которому в указанное время для компьютеров, включенных в развертывание, запускается главный Runbook обновлений. Этот Runbook запускает для каждого агента дочерний Runbook, который устанавливает необходимые обновления.

Целевой компьютер будет параллельно выполнять развертывания согласно дате и времени, указанным в развертывании обновлений. Перед установкой выполняется проверка, чтобы убедиться, что обновления по-прежнему необходимы. Если обновления для клиентских компьютеров WSUS не утверждены службой WSUS, развертывание обновлений завершится сбоем.

Наличие компьютера, зарегистрированного для Управление обновлениями в нескольких Log Analytics рабочих областях (многоадресная поддержка), не поддерживается.

## <a name="clients"></a>Клиенты

### <a name="supported-client-types"></a>Поддерживаемые типы клиентов

В следующей таблице приведен список поддерживаемых операционных систем для оценки обновлений. Для установки исправлений требуется Гибридная Рабочая роль Runbook. Сведения о требованиях гибридной рабочей роли Runbook см. в руководствах по установке для [Windows роли Runbook](automation-windows-hrw-install.md#installing-the-windows-hybrid-runbook-worker) и [Linux роли Runbook](automation-linux-hrw-install.md#installing-a-linux-hybrid-runbook-worker).

|Операционная система  |Заметки  |
|---------|---------|
|Windows Server 2019 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2016 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2012 R2 (Datacenter/Standard)<br><br>Windows Server 2012<br><br>Windows Server 2008 R2 (RTM и SP1 Standard)||
|CentOS 6 (x86 или x64) и 7 (x64).      | У агентов Linux должен быть доступ к репозиторию обновлений. Для исправления на основе классификации требуется, чтобы программа yum вернула данные безопасности, которых нет в CentOS, без дополнительной настройки. Дополнительные сведения об исправлениях на основе классификации в CentOS см. в [статье классификации обновлений в Linux](#linux-2) .          |
|Red Hat Enterprise 6 (x86 или x64) и 7 (x64).     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|Ubuntu 14.04 LTS, 16.04 LTS и 18.04 LTS (x86/x64)      |У агентов Linux должен быть доступ к репозиторию обновлений.         |

> [!NOTE]
> Для управления масштабируемыми наборами виртуальных машин Azure можно использовать Управление обновлениями. Управление обновлениями работает с самими экземплярами, а не с базовым образом. Необходимо запланировать обновления в пошаговом процессе, чтобы не обновлять все экземпляры виртуальных машин одновременно.
> Узлы VMSS можно добавить, выполнив действия, описанные в разделе подключение [компьютера, не являющегося машиной Azure](automation-tutorial-installed-software.md#onboard-a-non-azure-machine).

### <a name="unsupported-client-types"></a>Неподдерживаемые типы клиентов

В следующей таблице перечислены неподдерживаемые операционные системы:

|Операционная система  |Заметки  |
|---------|---------|
|Клиент Windows     | Клиентские операционные системы (например, Windows 7 и Windows 10) не поддерживаются.        |
|Nano Server Windows Server 2016     | Не поддерживается.       |
|Узлы службы Kubernetes Azure | Не поддерживается. Используйте процесс исправления, описанный в статьи [применение обновлений безопасности и ядра для узлов Linux в службе Kubernetes Azure (AKS)](../aks/node-updates-kured.md) .|

### <a name="client-requirements"></a>Требования к клиенту

В приведенных ниже сведениях описываются требования для клиента, относящиеся к операционной системе.  Кроме того, следует ознакомиться с руководством по [планированию сети](#ports) .

#### <a name="windows"></a>Windows

На агентах Windows необходимо настроить связь с сервером служб WSUS или доступ к Центру обновления Майкрософт.

Решение "Управление обновлениями" можно использовать вместе с System Center Configuration Manager. Дополнительные сведения о сценариях интеграции см. в разделе [Параметр Configuration](oms-solution-updatemgmt-sccmintegration.md#configuration). [Агент Windows](../azure-monitor/platform/agent-windows.md) является обязательным компонентом. При подключении виртуальной машины Azure этот агент устанавливается автоматически.

Виртуальные машины с Windows, развернутые по умолчанию из Azure Marketplace, настроены для получения автоматических обновлений из службы обновлений Windows. Поведение не изменяется при добавлении этого решения или виртуальных машин Windows в эту рабочую область. Если вы не управляете обновлениями с помощью этого решения, будет применено поведение по умолчанию (автоматическое применение обновлений).

> [!NOTE]
> Пользователь может изменить групповая политика, чтобы перезагрузка компьютера выполнялась только пользователем, а не системой. Управляемые компьютеры могут зависнуть, если Управление обновлениями не имеет прав на перезагрузку компьютера без вмешательства пользователя.
>
> Дополнительные сведения см. в разделе [Настройка параметров групповая политика для автоматическое обновление](https://docs.microsoft.com/en-us/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates).

#### <a name="linux"></a>Linux

У компьютеров под управлением Linux должен быть доступ к репозиторию обновлений. Репозиторий обновлений может быть общедоступным или частным. Для взаимодействия с решением "Управление обновлениями" требуется TLS 1.1 или TLS 1.2. Это решение не поддерживает агент Log Analytics для Linux, в котором настроена отправка отчетов в несколько рабочих областей Azure Log Analytics.  На компьютере также должен быть установлен Python 2. x.

Сведения о том, как установить агент Log Analytics для Linux и загрузить последнюю версию, см. в статье [log Analytics Agent for Linux](https://github.com/microsoft/oms-agent-for-linux). Дополнительные сведения об установке агента Log Analytics для Windows см. в разделе [Microsoft Monitoring Agent для Windows](../log-analytics/log-analytics-windows-agent.md).

Виртуальным машинам, которые созданы на основе доступных в Azure Marketplace предоставляемых по запросу образов Red Hat Enterprise Linux (RHEL), обеспечивается доступ к развернутому в Azure решению [Red Hat Update Infrastructure (RHUI)](../virtual-machines/virtual-machines-linux-update-infrastructure-redhat.md). Любой другой дистрибутив Linux должен быть обновлен с помощью интернет-репозитория дистрибутивов посредством поддерживаемых методов.

## <a name="permissions"></a>Разрешения

Для создания развертываний обновлений и управления ими требуются определенные разрешения. Дополнительные сведения об этих разрешениях см. в разделе, посвященном [управлению обновлениями с доступом на основе ролей](automation-role-based-access-control.md#update-management).

## <a name="solution-components"></a>Компоненты решения

Решение состоит из приведенных ниже ресурсов. Они добавляются в учетную запись службы автоматизации. Эти ресурсы являются либо непосредственно подключенными агентами, либо они находятся в группе управления, связанной с Operations Manager.

### <a name="hybrid-worker-groups"></a>Группы гибридных рабочих ролей

После включения этого решения любой подключенный к рабочей области Log Analytics компьютер с Windows будет автоматически настроен в качестве гибридной рабочей роли Runbook для поддержки модулей Runbook, которые входят в это решение.

Для каждого компьютера с Windows, управляемого этим решением, эти роли будут указаны на странице **групп гибридных рабочих ролей** как **группа гибридных рабочих ролей системы** для учетной записи службы автоматизации. Используется соглашение об именовании *Имя узла FQDN_GUID*. Вы не можете выбрать эти группы с помощью модулей Runbook в своей учетной записи. При попытке произойдет сбой. Эти группы предназначены только для поддержки решения для управления.

Вы можете добавить компьютеры с Windows в группу гибридных рабочих ролей Runbook в учетной записи службы автоматизации, чтобы обеспечить поддержку модулей Runbook службы автоматизации, если вы используете одну и ту же учетную запись для решения и для участия в группе гибридных рабочих ролей Runbook. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

### <a name="management-packs"></a>Пакеты управления

Если группа управления System Center Operations Manager подключена к рабочей области Log Analytics, в Operations Manager будут установлены следующие пакеты. После добавления этого решения пакеты управления также будут установлены на компьютерах с Windows, подключенных напрямую. Управлять и настраивать эти пакеты управления не требуется.

* Пакет аналитики оценки обновления Microsoft System Center Advisor (Microsoft.IntelligencePacks.UpdateAssessment);
* Microsoft.IntelligencePack.UpdateAssessment.Configuration (Microsoft.IntelligencePack.UpdateAssessment.Configuration);
* пакет управления развертыванием обновлений.

> [!NOTE]
> Если у вас есть группа управления Operations Manager 1807 или 2019 с агентами, настроенными на уровне группы управления, которые будут связаны с рабочей областью, то текущим решением для их отображения является переопределение **исауторегистратионенаблед** на **true** в правило **Microsoft. IntelligencePacks. AzureAutomation. HybridAgent. init** .

Дополнительные сведения об обновлении пакетов управления решениями см. в разделе [Connect Operations Manager to Azure Monitor Logs](../azure-monitor/platform/om-agents.md).

> [!NOTE]
> Для полнофункционального управления системами с агентом Operations Manager при помощи решения "Управление обновлениями" агент необходимо обновить до Microsoft Monitoring Agent. Чтобы узнать, как обновить агент, см. [эту статью](https://docs.microsoft.com/system-center/scom/deploy-upgrade-agents). Для сред, использующих Operations Manager, требуется System Center Operations Manager 2012 R2 UR 14 или более поздней версии.

## <a name="data-collection"></a>Сбор данных

### <a name="supported-agents"></a>Поддерживаемые агенты

В следующей таблице описаны подключенные источники, поддерживаемые этим решением.

| Подключенный источник | Поддерживается | Описание |
| --- | --- | --- |
| Агенты Windows |ДА |Решение собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |ДА |Решение собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |ДА |Решение собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления.<br/>Прямое подключение агента Operations Manager к Azure Monitor журналов не требуется. Данные пересылаются из группы управления в рабочую область Log Analytics. |

### <a name="collection-frequency"></a>Частота сбора

Дважды в день выполняется проверка каждого управляемого компьютера Windows. Каждые 15 минут вызывается API Windows, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие.

Сканирование выполняется каждый час для каждого управляемого компьютера Linux.

Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

В среднем Azure Monitor записывает сведения об использовании данных для компьютера, использующего Управление обновлениями, приблизительно 25 МБ в месяц. Это приблизительное значение, которое может отличаться в зависимости от среды. Мы рекомендуем вам провести мониторинг среды, чтобы узнать точные данные об использовании.

## <a name="ports"></a>Планирование сети

Для Управления обновлениями требуются следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure для государственных организаций  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|
|*.azure-automation.net|*.azure-automation.us|

Для компьютеров Windows необходимо также разрешить передачу трафика на любые конечные точки, необходимые для Центр обновления Windows.  Обновленный список обязательных конечных точек можно найти в [проблемах, связанных с HTTP/proxy](/windows/deployment/update/windows-update-troubleshooting#issues-related-to-httpproxy). Если у вас есть локальный [Центр обновления Windows сервер](/windows-server/administration/windows-server-update-services/plan/plan-your-wsus-deployment), необходимо также разрешить трафик на сервер, указанный в [ключе WSUS](/windows/deployment/update/waas-wu-settings#configuring-automatic-updates-by-editing-the-registry).

Для компьютеров с Red Hat Linux обратитесь к IP-адресам [серверов доставки содержимого RHUI](../virtual-machines/linux/update-infrastructure-redhat.md#the-ips-for-the-rhui-content-delivery-servers) для требуемых конечных точек. Другие дистрибутивы Linux см. в документации поставщика.

Дополнительные сведения о портах, которым необходима гибридная рабочая роль Runbook, см. в статье [Автоматизация ресурсов в центре обработки данных или облаке с помощью гибридной рабочей роли Runbook](automation-hybrid-runbook-worker.md#hybrid-worker-role).

При определении исключений рекомендуется использовать адреса из списка. Если вам нужны IP-адреса, вы можете скачать [список диапазонов IP-адресов центров обработки данных Microsoft Azure](https://www.microsoft.com/download/details.aspx?id=41653). Файл обновляется еженедельно, и в нем отражаются развернутые в настоящее время диапазоны и все предстоящие изменения диапазонов IP-адресов.

Следуйте инструкциям в разделе [Подключение компьютеров без доступа к Интернету](../azure-monitor/platform/gateway.md) для настройки компьютеров, не имеющих доступа к Интернету.

## <a name="view-update-assessments"></a>Просмотр оценок обновлений

Выберите **Управление обновлениями** в своей учетной записи службы автоматизации, чтобы просмотреть состояние компьютеров.

В этом представлении содержатся сведения о ваших компьютерах, отсутствующих обновлениях, развертываниях обновлений и запланированных развертываниях обновлений. В **столбце соответствия** указано время, когда компьютер в последний раз оценивался. В столбце **Готовность к обновлению агента** можно увидеть, работоспособен ли агент обновления. Если есть проблема, щелкните ссылку, чтобы перейти к документации по устранению неполадок, где можно найти шаги для устранения проблемы.

Чтобы запустить поиск по журналам, который возвращает информацию о компьютере, обновлении или развертывании, выберите элемент из списка. При этом откроется страница **поиска по журналам** с запросом на выбранный элемент:

![Представление по умолчанию решения "Управление обновлениями"](media/automation-update-management/update-management-view.png)

## <a name="view-missing-updates"></a>Просмотр отсутствующих обновлений

Выберите **Отсутствующие обновления**, чтобы просмотреть список обновлений, отсутствующих на ваших компьютерах. Каждое обновление перечислено и может быть выбрано. Отображается информация о количестве компьютеров, которым оно требуется, операционная система и ссылка для получения дополнительных сведений. В области **Поиск журналов** отображаются дополнительные сведения об обновлениях.

![Отсутствующие обновления](./media/automation-view-update-assessments/automation-view-update-assessments-missing-updates.png)

## <a name="update-classifications"></a>Классификации обновлений

В следующих таблицах содержатся списки классификаций обновлений в Управлении обновлениями с определениями для каждой классификации.

### <a name="windows"></a>Windows

|классификация;  |Описание  |
|---------|---------|
|критические обновления;     | Обновление для конкретной проблемы, которая относится к критической, не связанной с безопасностью ошибке.        |
|обновления для системы безопасности;     | Обновление для ошибки, связанной с безопасностью конкретного продукта.        |
|накопительные пакеты обновления;     | Накопительный набор исправлений, упакованных в один пакет для удобства развертывания.        |
|пакеты дополнительных компонентов;     | Новые функции продукта, которые распространяются вне выпуска продукта.        |
|пакеты обновления;     | Накопительный набор исправлений, применяемых к приложению.        |
|обновления определений;     | Обновление для вирусов или других файлов определений.        |
|Средства     | Служебная программа или функция, которая помогает выполнить одну или несколько задач.        |
|Обновления     | Обновление приложения или файла, установленного в настоящее время.        |

### <a name="linux-2"></a>Linux

|классификация;  |Описание  |
|---------|---------|
|критические обновления и обновления для системы безопасности;     | Обновления для конкретной проблемы или проблемы, связанной с безопасностью продукта.         |
|Другие обновления     | Все другие обновления, которые не являются критическими или обновлениями для системы безопасности.        |

В Linux решение по управлению обновлениями позволяет различать в облаке критически важные обновления и обновления безопасности при отображении данных оценки в связи с обогащением данных в облаке. Для исправления в решении по управлению обновлениями используются данные классификации, доступные на компьютере. В отличие от других дистрибутивов, в CentOS эти сведения недоступны без дополнительной настройки. Если у вас есть компьютеры CentOS, настроенные возвращать данные безопасности для следующей команды, решение по управлению обновлениями сможет выполнять исправления на основе классификаций.

```bash
sudo yum -q --security check-update
```

В настоящее время отсутствуют поддерживаемые методы настройки исходной доступности данных классификации в CentOS. Сейчас для клиентов, которые включили ее самостоятельно, предоставляется только возможная поддержка.

## <a name="integrate-with-system-center-configuration-manager"></a>Интеграция с System Center Configuration Manager

Клиенты, которые инвестировали в System Center Configuration Manager для управления ПК, серверами и мобильными устройствами, также полагаются на надежность и зрелость Configuration Manager, чтобы помочь им управлять обновлениями программного обеспечения. Configuration Manager входит в их цикл управления обновлением программного обеспечения (SUM).

Сведения об интеграции решения по управлению с Sytem Center Configuration Manager см. в статье [Интеграция Integrate System Center Configuration Manager с решением "Управление обновлениями"](oms-solution-updatemgmt-sccmintegration.md).

### <a name="third-party-patches-on-windows"></a>Исправления сторонних производителей в Windows

Управление обновлениями использует локально настроенный репозиторий обновлений для обновления поддерживаемых систем Windows. Это либо WSUS, либо Центр обновления Windows. Такие средства, как [System Center Updates Publisher](/sccm/sum/tools/updates-publisher) (Updates Publisher) позволяют публиковать пользовательские обновления в WSUS. Этот сценарий позволяет Управление обновлениями исправлять компьютеры, использующие System Center Configuration Manager в качестве репозитория обновлений программного обеспечения стороннего производителя. Чтобы узнать, как настроить Updates Publisher, см. статью [Установка Updates Publisher](/sccm/sum/tools/install-updates-publisher).

## <a name="patch-linux-machines"></a>Исправление компьютеров Linux

В следующих разделах объясняются возможные проблемы, которые могут возникнуть при установке исправлений Linux.

### <a name="unexpected-os-level-upgrades"></a>Непредвиденные обновления на уровне ОС

В некоторых вариантах Linux, таких как Red Hat Enterprise Linux, обновления на уровне ОС можно реализовывать через пакеты. Это может привести к запуску управления обновлениями, когда изменяется номер версии операционной системы. Так как решение "Управление обновлениями" использует те же методы для обновления пакетов, что и администратор на компьютерах Linux в локальной среде, такое поведение является преднамеренным.

Чтобы избежать обновления версии ОС при запуске решения "Управление обновлениями", нужно использовать функцию **исключения**.

В Red Hat Enterprise Linux именем пакета для исключения должно быть имя redhat-release-server.x86_64.

![Исключаемые пакеты для Linux](./media/automation-update-management/linuxpatches.png)

### <a name="critical--security-patches-arent-applied"></a>Критически важные исправления или исправления системы безопасности не применяются

При развертывании обновлений на компьютер Linux вы можете выбрать категории обновлений. Это позволит отфильтровать обновления, которые применяются на компьютерах, до тех, что соответствуют указанным критериям. Этот фильтр применяется локально на компьютере при развертывании обновления.

Поскольку Управление обновлениями выполняет обогащение обновлений в облаке, некоторые обновления могут помечаться в Управление обновлениями, что влияет на безопасность, даже если на локальном компьютере нет этих сведений. В результате, если вы применяете критические обновления для компьютера Linux, вы можете столкнуться с обновлениями, которые не помечены как влияющие на безопасность на таком компьютере, но при этом они не будут применены.

Тем не менее решение "Управление обновлениями" может по-прежнему сообщать о том, что обновления не совместимы с этим компьютером, так как оно содержит дополнительные сведения о соответствующем обновлении.

Развертывание обновлений на основе их классификации не поддерживается в CentOS без дополнительной настройки. Чтобы правильно развернуть обновления для CentOS, выберите все классификации для гарантированной установки обновлений. В SUSE выбор *только* "Другие обновления" в качестве классификации может привести к тому, что некоторые обновления безопасности также будут установлены, если сначала потребуются обновления безопасности, связанные с zypper (диспетчер пакетов) или его зависимостями. Это поведение является ограничением zypper. В некоторых случаях вам может потребоваться перезапустить развертывание обновлений. Для проверки обратитесь к журналу обновлений.

### <a name="multi-tenant"></a>Развертывание обновлений между клиентами

Если компьютеры в другом клиенте Azure отправляют отчеты в решение "Управления обновлениями" о том, что необходимы исправления, вам необходимо использовать следующее обходное решение, чтобы запланировать их. Вы можете использовать командлет [New-AzureRmAutomationSchedule](/powershell/module/azurerm.automation/new-azurermautomationschedule) с переходом `-ForUpdate`для создания расписания, а также можете использовать командлет [New-AzureRmAutomationSoftwareUpdateConfiguration](/powershell/module/azurerm.automation/new-azurermautomationsoftwareupdateconfiguration
) и задать параметр `-NonAzureComputer` для компьютеров другого клиента. Ниже приведен пример, как это сделать.

```azurepowershell-interactive
$nonAzurecomputers = @("server-01", "server-02")

$startTime = ([DateTime]::Now).AddMinutes(10)

$sched = New-AzureRmAutomationSchedule -ResourceGroupName mygroup -AutomationAccountName myaccount -Name myupdateconfig -Description test-OneTime -OneTime -StartTime $startTime -ForUpdate

New-AzureRmAutomationSoftwareUpdateConfiguration  -ResourceGroupName $rg -AutomationAccountName <automationAccountName> -Schedule $sched -Windows -NonAzureComputer $nonAzurecomputers -Duration (New-TimeSpan -Hours 2) -IncludedUpdateClassification Security,UpdateRollup -ExcludedKbNumber KB01,KB02 -IncludedKbNumber KB100
```

## <a name="onboard"></a>Включение решения "Управление обновлениями"

Чтобы начать установку исправлений системы, нужно включить решение "Управление обновлениями". Подключить это решение на виртуальных машинах можно несколькими способами. Ниже приведены рекомендуемые и поддерживаемые способы подключения решения:

* [на одной виртуальной машине](automation-onboard-solutions-from-vm.md);
* [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md);
* [в учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md);
* [с помощью модуля runbook службы автоматизации Azure](automation-onboard-solutions.md).

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с руководством ниже, чтобы узнать, как управлять обновлениями для виртуальных машин Windows.

> [!div class="nextstepaction"]
> [Устранение неполадок при изменениях в среде](automation-tutorial-update-management.md)

* Используйте поиск по журналам в [Azure Monitor журналов](../log-analytics/log-analytics-log-searches.md) для просмотра подробных сведений об обновлениях.
* [Создавайте оповещения](automation-tutorial-update-management.md#configure-alerts) о состоянии развертывания обновлений.

* Чтобы узнать, как взаимодействовать с Управлением обновлениями с помощью REST API, ознакомьтесь со статьей [Software Update Configurations](/rest/api/automation/softwareupdateconfigurations) (Конфигурации обновления программного обеспечения).
* Чтобы узнать, как устранить неполадки с решением управления обновлениями, ознакомьтесь с [этой статьей](troubleshoot/update-management.md).
