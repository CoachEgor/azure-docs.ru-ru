---
title: Решение для управления обновлениями в Azure
description: В этой статье описывается, как использовать решение Управления обновлением Azure для управления обновлениями для windows и Linux.
services: automation
ms.subservice: update-management
ms.date: 02/27/2020
ms.topic: conceptual
ms.openlocfilehash: c76b14e4f08ec930159498da4a35fdad0341929e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79278510"
---
# <a name="update-management-solution-in-azure"></a>Решение для управления обновлениями в Azure

Вы можете использовать решение управления обновлением в Azure Automation для управления обновлениями операционных систем для компьютеров Windows и Linux в Azure, в условиях, связанных с использованием новых данных, и в других облачных средах. Вы можете быстро оценить состояние доступных обновлений на всех агентах и управлять процессом установки необходимых обновлений для серверов.

Управление обновлениями для виртуальных машин (VMs) можно включить следующими методами:

- В [Azure Automation приходится](automation-onboard-solutions-from-automation-account.md) на одну или несколько машин Azure и вручную для машин, не относясь к Azure.

- Для одного Azure VM со страницы виртуальной машины на портале Azure. Этот сценарий доступен для [Linux](../virtual-machines/linux/tutorial-config-management.md#enable-update-management) и [Windows](../virtual-machines/windows/tutorial-config-management.md#enable-update-management) VMs.

- Для [нескольких виртуальных проектов Azure,](manage-update-multi.md) выбрав их со **страницы виртуальных машин** на портале Azure. 

> [!NOTE]
> Решение update Management требует привязки рабочего пространства Log Analytics к учетной записи автоматизации. Окончательный список поддерживаемых регионов можно узнать в [отображении рабочего пространства Azure.](./how-to/region-mappings.md) Картирование регионов не влияет на возможность управления ввосажным вывЕспутем в отдельном регионе от учетной записи Автоматизации.

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../includes/azure-monitor-log-analytics-rebrand.md)]

Доступен шаблон Azure [Resource Manager Manager,](automation-update-management-deploy-template.md) который позволяет развертывать решение управления обновлением в новом или существующем рабочем пространстве автоматизации и анализа журналов в подписке.

## <a name="solution-overview"></a>Обзор решения

Машины, управляемые управлением обновлением, используют следующие конфигурации для выполнения оценки и обновления развертываний:

* Агент аналитики журналов для Windows или Linux
* служба настройки требуемого состояния PowerShell;
* гибридные рабочие роли Runbook службы автоматизации;
* Службы обновления Microsoft Update или Windows Server (WSUS) для компьютеров Windows

Следующая диаграмма иллюстрирует, как решение оценивает и применяет обновления безопасности для всех подключенных Windows Server и Linux-машин в рабочей области:

![Поток процесса управления обновлениями](./media/automation-update-management/update-mgmt-updateworkflow.png)

Управление обновлениями можно использовать для внутренних подключенных компьютеров в нескольких подписках одного и того же клиента.

После того, как пакет выпущен, это занимает от 2 до 3 часов для патча, чтобы показать для Linux машин для оценки. Для компьютеров Windows требуется от 12 до 15 часов, чтобы патч появился для оценки после его выпуска.

После того, как машина завершает сканирование для обновления соответствия, агент перенаправляет информацию оптом в журналы Azure Monitor. На компьютере Windows сканирование соответствия проводится каждые 12 часов по умолчанию.

В дополнение к графику сканирования, сканирование на соответствие обновлению начинается в течение 15 минут после перезапуска агента Log Analytics, до установки обновления и после установки обновления.

Для машины Linux сканирование соответствия выполняется каждый час по умолчанию. При перезапущени агенте Log Analytics в течение 15 минут начинается сканирование соответствия требованиям.

В решении сообщается, что современная машина основана на том, с каким источником вы настроены для синхронизации. Если машина Windows настроена для отчета перед WSUS, в зависимости от того, когда WSUS в последний раз синхронизировался с обновлением Microsoft, результаты могут отличаться от того, что показывает обновление Microsoft. Это поведение то же самое для Linux-машин, которые настроены для отчета в локальное репо, а не в публичное репо.

> [!NOTE]
> Для правильной передачи данных в службу решению управления обновлениями требуется, чтобы были включены определенные URL-адреса и порты. Дополнительные сведения о требованиях см. в разделе [Настройка сети](automation-hybrid-runbook-worker.md#network-planning).

Вы можете развернуть и установить обновления программного обеспечения на машинах, которые требуют обновления, создавая запланированное развертывание. Обновления, классифицированные как *Факультативные,* не включены в область развертывания для компьютеров Windows. В область развертывания включаются только необходимые обновления.

Запланированное развертывание определяет, какие целевые машины получают соответствующие обновления. Он делает это либо путем явного указания определенных машин, либо путем выбора [компьютерной группы,](../azure-monitor/platform/computer-groups.md) основанной на поиске в журнале определенного набора машин (или на [запросе Azure,](automation-update-management-query-logs.md) который динамически выбирает VMs Azure на основе определенных критериев). Эти группы отличаются от [конфигурации области,](../azure-monitor/insights/solution-targeting.md)которая используется только для определения того, какие машины получают пакеты управления, которые позволяют использовать решение.

Вы также указать расписание для утверждения и указания периода времени, в течение которого могут быть установлены обновления. Этот период называется окном обслуживания. 20-минутный пролет окна обслуживания зарезервирован для перезагрузки, если предположить, что один из них необходим, и вы выбрали подходящий вариант перезагрузки. Если исправление занимает больше времени, чем ожидалось, и в окне обслуживания меньше 20 минут, перезагрузка не произойдет.

Обновления устанавливаются с помощью Runbook в службе автоматизации Azure. Вы не можете просмотреть эти runbooks, и они не требуют какой-либо конфигурации. При создании развертывания обновления создается расписание, в которое запускается мастер-обновление runbook в указанное время для включенных машин. Этот Runbook запускает для каждого агента дочерний Runbook, который устанавливает необходимые обновления.

В дату и время, указанное в развертывании обновления, целевые машины выполняют развертывание параллельно. Перед установкой выполняется проверка, чтобы убедиться, что обновления по-прежнему необходимы. Для клиентских машин WSUS, если обновления не утверждены в WSUS, развертывание обновления завершается неудачей.

Наличие машины, зарегистрированной для управления обновлением в более чем одном рабочем пространстве Log Analytics (также называемом мультихомингом), не поддерживается.

## <a name="clients"></a>Клиенты

### <a name="supported-client-types"></a>Поддерживаемые типы клиентов

В следующей таблице перечислены поддерживаемые операционные системы для оценки обновлений. Патчинг требует гибридного работника Runbook. Для получения информации о требованиях hybrid Runbook worker [Windows Hybrid Runbook Worker](automation-windows-hrw-install.md) см. [Linux Hybrid Runbook Worker](automation-linux-hrw-install.md#installing-a-linux-hybrid-runbook-worker)

|Операционная система  |Примечания  |
|---------|---------|
|Windows Server 2019 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2016 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2012 R2 (Datacenter/Standard)<br><br>Windows Server 2012 || 
|Windows Server 2008 R2 (RTM и SP1 Standard)| Управление обновлением поддерживает только выполнение оценок для этой операционной системы, исправление не поддерживается, так как [гибридный Runbook Worker](automation-windows-hrw-install.md) не поддерживается для Windows Server 2008 R2. |
|CentOS 6 (x86 или x64) и 7 (x64).      | Агентам Linux требуется доступ к репозиторию обновления. Исправление на `yum` основе классификации требует возврата данных безопасности, которых centOS не имеет в своих релизах RTM. Для получения дополнительной информации о классификационных [Update classifications on Linux](automation-view-update-assessments.md#linux-2)патчах на CentOS см.          |
|Red Hat Enterprise 6 (x86 или x64) и 7 (x64).     | Агентам Linux требуется доступ к репозиторию обновления.        |
|SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)     | Агентам Linux требуется доступ к репозиторию обновления.        |
|Ubuntu 14.04 LTS, 16.04 LTS и 18.04 LTS (x86/x64)      |Агентам Linux требуется доступ к репозиторию обновления.         |

> [!NOTE]
> Наборы виртуальных машин Azure можно управлять с помощью управления обновлениями. Управление обновлением работает на самих экземплярах, а не на базовом изображении. Вам нужно будет запланировать обновления поэтапным образом, чтобы не все экземпляры VM обновлялись одновременно.
> Можно добавить узлы для виртуальных наборов масштабов машины, выполнив ступеньки под [бортовой машиной, не являйщемся Azure.](automation-tutorial-installed-software.md#onboard-a-non-azure-machine)

### <a name="unsupported-client-types"></a>Неподдерживаемые типы клиентов

В следующей таблице перечислены неподдерживаемые операционные системы:

|Операционная система  |Примечания  |
|---------|---------|
|Клиент Windows     | Клиентские операционные системы (например, Windows 7 и Windows 10) не поддерживаются.        |
|Nano Server Windows Server 2016     | Не поддерживается.       |
|Сервисные узлы Azure Kubernetes | Не поддерживается. Используйте процесс исправления, описанный в [обновлениях безопасности и ядра Для использования в обновлениях Linux в службе Azure Kubernetes (AKS)](../aks/node-updates-kured.md)|

### <a name="client-requirements"></a>Требования к клиенту

Ниже приводится информация о требованиях клиентов к ОС. Для получения дополнительных рекомендаций [см.](#ports)

#### <a name="windows"></a>Windows

Агенты Windows должны быть настроены для связи с сервером WSUS, или они требуют доступа к обновлению Майкрософт.

Управление обновлениями можно использовать с помощью менеджера конфигурации. Чтобы узнать больше о сценариях интеграции, [см.](oms-solution-updatemgmt-sccmintegration.md#configuration) [Требуется агент Log Analytics Windows.](../azure-monitor/platform/agent-windows.md) Агент устанавливается автоматически, если вы садитесь на посадку в Azure VM.

По умолчанию, Windows VMs, развернутые из Azure Marketplace, настроены на автоматическое обновление от службы обновления Windows. Это поведение не меняется при добавлении этого решения или добавлении в рабочее пространство для вхадных вашего рабочего пространства. Если вы не управляете обновлениями с помощью этого решения, будет применено поведение по умолчанию (автоматическое применение обновлений).

> [!NOTE]
> Пользователь может изменить политику группы, чтобы перезагрузка машины выполнялась только пользователем, а не системой. Управляемые машины могут застрять, если управление обновлением не имеет прав на перезагрузку машины без ручного взаимодействия с пользователем.
>
> Для получения дополнительной [информации](https://docs.microsoft.com/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates)см.

#### <a name="linux"></a>Linux

Для Linux машина требует доступа к репозиторию обновления. Репозиторий обновлений может быть общедоступным или частным. Для взаимодействия с решением "Управление обновлениями" требуется TLS 1.1 или TLS 1.2. Агент аналитики журнала для Linux, настроенный для отчета в более чем одном рабочем пространстве Log Analytics, не поддерживается этим решением. Машина также должна иметь Python 2.x установлен.

Для получения информации о том, как установить агент Log Analytics для Linux и скачать последнюю версию, [см.](../azure-monitor/platform/agent-linux.md) Для получения информации о том, как установить агент log Analytics для Windows, [см.](../log-analytics/log-analytics-windows-agent.md)

ВМ, созданные на основе изображений Red Hat Enterprise Linux (RHEL), доступных в Azure Marketplace, зарегистрированы для доступа к [инфраструктуре обновления Red Hat (RHUI),](../virtual-machines/workloads/redhat/redhat-rhui.md) развернутой в Azure. Любой другой дистрибутив Linux должен обновляться из онлайн-хранилища файлов дистрибутива с помощью поддерживаемых методов дистрибутива.

## <a name="permissions"></a>Разрешения

Для создания развертываний обновлений и управления ими требуются определенные разрешения. Чтобы узнать об этих [Role-based access – Update Management](automation-role-based-access-control.md#update-management)разрешениях, см.

## <a name="solution-components"></a>Компоненты решения

Решение состоит из приведенных ниже ресурсов. Эти ресурсы автоматически добавляются в учетную запись автоматизации при включении решения. 

### <a name="hybrid-worker-groups"></a>Группы гибридных рабочих ролей

После включения этого решения любая машина Windows, непосредственно подключенная к рабочему пространству Log Analytics, автоматически настраивается в качестве гибридного runbook Worker для поддержки рун, включенных в это решение.

Каждая машина Windows, управляемая решением, указана в **панели гибридных групп работников** в качестве **гибридной рабочей группы системы** для учетной записи Automation. Решения используют конвенцию FQDN_GUID именования *Hostname.* Вы не можете выбрать эти группы с помощью модулей Runbook в своей учетной записи. Если вы попытаетесь, попытка не удается. Эти группы призваны поддерживать только это решение управления.

Вы можете добавить машину Windows в группу Hybrid Runbook Worker в учетной записи Автоматизации для поддержки runbooks автоматизации, если вы используете одну и ту же учетную запись как для решения, так и для членства в группе Hybrid Runbook Worker. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

### <a name="management-packs"></a>Пакеты управления

Если группа управления управлением операциями ВАшего центра работает над системой «Система» [и подключена к рабочей области Log Analytics,](../azure-monitor/platform/om-agents.md)в операционном менеджере установлены следующие пакеты управления. Эти пакеты управления также устанавливаются на непосредственно подключенные компьютеры Windows после добавления решения. Управлять и настраивать эти пакеты управления не требуется.

* Пакет аналитики оценки обновления Microsoft System Center Advisor (Microsoft.IntelligencePacks.UpdateAssessment);
* Microsoft.IntelligencePack.UpdateAssessment.Configuration (Microsoft.IntelligencePack.UpdateAssessment.Configuration);
* пакет управления развертыванием обновлений.

> [!NOTE]
> Если у вас есть группа управления Operations Manager 1807 или 2019, подключенная к рабочей области Log Analytics с агентами, настроенными в группе управления для сбора данных журнала, вам необходимо переопределить следующее правило, чтобы управлять ими с помощью управления обновлением: переопределить параметр **IsAutoRegistrationEnabled** и установить в **Истинном** в **Microsoft.IntelligencePacks.AzureAutomation.HybridAgent.Init** правило.

Для получения дополнительной информации о том, как обновляются пакеты управления решениями, [см.](../azure-monitor/platform/om-agents.md)

> [!NOTE]
> Для машин с агентом «Снятель операций», которыми полностью управляет управление обновлением, агент должен быть обновлен до агента Log Analytics для Windows или Linux. Чтобы узнать, как обновить агент, см. [эту статью](https://docs.microsoft.com/system-center/scom/deploy-upgrade-agents). В средах, в нее используется менеджер операций, необходимо запустить диспетчер атлетового центра 2012 R2 UR 14 или позже.

## <a name="data-collection"></a>сбор данных

### <a name="supported-agents"></a>Поддерживаемые агенты

В приведенной ниже таблице описаны подключенные источники, которые поддерживает это решение.

| Подключенный источник | Поддерживается | Описание |
| --- | --- | --- |
| Агенты Windows |Да |Решение собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Да |Решение собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Да |Решение собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления.<br/><br/>Не требуется прямое подключение агента управления операциями к журналам Azure Monitor. Данные пересылаются из группы управления в рабочую область Log Analytics. |

### <a name="collection-frequency"></a>Частота сбора

Сканирование выполняется два раза в день для каждой управляемой машины Windows. Каждые 15 минут вызывается API Windows, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие.

Сканирование выполняется каждый час для каждой управляемой машины Linux.

Отображение обновленных данных с управляемых машин может занять от 30 минут до 6 часов.

Среднее использование данных журналами Azure Monitor для машины с использованием управления обновлением составляет примерно 25 мегабайт (МБ) в месяц. Это значение является лишь приближением и может быть изменено в зависимости от среды. Мы рекомендуем вам следить за окружающей средой, чтобы отслеживать ваше точное использование. Для получения дополнительной информации для анализа использования данных [см.](../azure-monitor/platform/manage-cost-storage.md)

## <a name="network-planning"></a><a name="ports"></a>Планирование сети

Для Управления обновлениями требуются следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure для государственных организаций  |
|---------|---------|
|*.ods.opinsights.azure.com    | *.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net | *.blob.core.usgovcloudapi.net|
|*.azure-automation.net | *.azure-automation.us|

Для компьютеров Windows необходимо также разрешить трафик на любые конечные точки, требуемые обновлением Windows. Вы можете найти обновленный список необходимых конечных точек в [вопросах, связанных с HTTP/Proxy](/windows/deployment/update/windows-update-troubleshooting#issues-related-to-httpproxy). Если у вас есть локальный [сервер обновления Windows,](/windows-server/administration/windows-server-update-services/plan/plan-your-wsus-deployment)необходимо также разрешить трафик на сервер, указанный в [ключе WSUS.](/windows/deployment/update/waas-wu-settings#configuring-automatic-updates-by-editing-the-registry)

Для машин Red Hat [IPs for the RHUI content delivery servers](../virtual-machines/workloads/redhat/redhat-rhui.md#the-ips-for-the-rhui-content-delivery-servers) Linux см. Для других дистрибутивов Linux ознакомьтесь с документацией поставщика.

Для получения дополнительной информации о портах, необходимых для гибридного работника Runbook, [см.](automation-hybrid-runbook-worker.md#hybrid-worker-role)

Мы рекомендуем использовать адреса, перечисленные при определении исключений. Для IP-адресов можно загрузить [IP-диапазоны Центра обработки данных Microsoft Azure.](https://www.microsoft.com/download/details.aspx?id=41653) Этот файл обновляется еженедельно, и он отражает развернутые в настоящее время диапазоны и любые предстоящие изменения в диапазонах IP.

Следуйте инструкциям в [Connect компьютеров без доступа в Интернет](../azure-monitor/platform/gateway.md) для настройки машин, которые не имеют доступа в Интернет.

## <a name="update-classifications"></a>Классификации обновлений

В следующих таблицах содержатся списки классификаций обновлений в Управлении обновлениями с определениями для каждой классификации.

### <a name="windows"></a>Windows

|Классификация  |Описание  |
|---------|---------|
|критические обновления;     | Обновление для конкретной проблемы, которая относится к критической, не связанной с безопасностью ошибке.        |
|Обновления для системы безопасности     | Обновление для ошибки, связанной с безопасностью конкретного продукта.        |
|накопительные пакеты обновления;     | Накопительный набор исправлений, упакованных в один пакет для удобства развертывания.        |
|пакеты дополнительных компонентов;     | Новые функции продукта, которые распространяются вне выпуска продукта.        |
|пакеты обновления;     | Накопительный набор исправлений, применяемых к приложению.        |
|обновления определений;     | Обновление для вирусов или других файлов определений.        |
|Инструменты     | Служебная программа или функция, которая помогает выполнить одну или несколько задач.        |
|Обновления     | Обновление приложения или файла, установленного в настоящее время.        |

### <a name="linux"></a><a name="linux-2"></a>Linux

|Классификация  |Описание  |
|---------|---------|
|критические обновления и обновления для системы безопасности;     | Обновления для конкретной проблемы или проблемы, связанной с безопасностью продукта.         |
|Другие обновления     | Все другие обновления, которые не являются критическими по своему характеру или которые не являются обновлениями безопасности.        |

Для Linux управление обновлениями может проводить различие между критическими обновлениями и обновлениями безопасности в облаке при отображении данных оценки за счет обогащения данных в облаке. Для исправления в решении по управлению обновлениями используются данные классификации, доступные на компьютере. В отличие от других дистрибутивов, CentOS не имеет этой информации, доступной в версии RTM. Если у вас есть машины CentOS, настроенные для возврата данных безопасности для следующей команды, управление обновлением может патч на основе классификаций.

```bash
sudo yum -q --security check-update
```

В настоящее время нет поддерживаемого метода, позволяющего обеспечить наличие нативных классификационных данных на CentOS. В настоящее время клиентам, которые могли бы самостоятельно это сделать, предоставляется только поддержка, которая могла бы воспользоваться этой проблемой. 

Чтобы классифицировать обновления на версии Red Hat Enterprise 6, необходимо установить плагин для безопасности yum. На Red Hat Enterprise Linux 7, плагин уже является частью сам yum, нет необходимости устанавливать что-либо. Для получения дополнительной информации, [knowledge article](https://access.redhat.com/solutions/10021)см.

## <a name="integrate-with-configuration-manager"></a>Интеграция с Configuration Manager

Клиенты, которые инвестировали в Microsoft Endpoint Configuration Manager для управления ПК, серверами и мобильными устройствами, также полагаются на силу и зрелость Configuration Manager, чтобы помочь им управлять обновлениями программного обеспечения. Configuration Manager входит в их цикл управления обновлением программного обеспечения (SUM).

Чтобы узнать, как интегрировать решение управления с configuration Manager, [см.](oms-solution-updatemgmt-sccmintegration.md)

### <a name="third-party-updates-on-windows"></a>Сторонние обновления на Windows

Управление обновлением опирается на локально настроенный репозиторий обновления для обновления поддерживаемых систем Windows. Это либо WSUS, либо обновление Windows. Такие инструменты, как [System Center Обновления Издатель](https://docs.microsoft.com/configmgr/sum/tools/updates-publisher) (Обновление Издатель) позволяет импортировать и публиковать пользовательские обновления с WSUS. Этот сценарий позволяет управлению обновлениями обновлять машины, которые используют configuration Manager в качестве репозитория обновления с помощью стороннего программного обеспечения. Чтобы узнать, как настроить Updates Publisher, см. статью [Установка Updates Publisher](https://docs.microsoft.com/configmgr/sum/tools/install-updates-publisher).

## <a name="enable-update-management"></a><a name="onboard"></a>Включить управление обновлением

Чтобы начать обновление систем, необходимо включить решение управления обновлением. Ниже приведены рекомендуемые и поддерживаемые методы, чтобы на борту решения:

- [на одной виртуальной машине](automation-onboard-solutions-from-vm.md);

- [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md);

- [в учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md);

- [с помощью модуля runbook службы автоматизации Azure](automation-onboard-solutions.md).

- [С шаблоном управления ресурсами Azure](automation-update-management-deploy-template.md)

## <a name="next-steps"></a>Дальнейшие действия

Просмотрите часто [задаваемые вопросы](automation-faq.md) автоматизации Azure, чтобы просмотреть общие вопросы об этом решении.
