---
title: Решение для управления обновлениями в Azure
description: В этой статье описывается, как использовать решение Azure Управление обновлениями для управления обновлениями компьютеров под управлением Windows и Linux.
services: automation
ms.subservice: update-management
ms.date: 01/14/2020
ms.topic: conceptual
ms.openlocfilehash: 0cf47538f7db1cef629c2b58a9fbde16640a50ae
ms.sourcegitcommit: 49e14e0d19a18b75fd83de6c16ccee2594592355
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2020
ms.locfileid: "75945128"
---
# <a name="update-management-solution-in-azure"></a>Решение для управления обновлениями в Azure

С помощью решения Управление обновлениями в службе автоматизации Azure можно управлять обновлениями операционной системы для компьютеров под управлением Windows и Linux в Azure, в локальных средах и в других поставщиках облачных служб. Благодаря ему вы сможете быстро оценить состояние доступных обновлений на всех компьютерах агентов и управлять установкой необходимых обновлений на серверах.

Вы можете включить Управление обновлениями для виртуальных машин (ВМ) непосредственно из учетной записи службы автоматизации Azure. Дополнительные сведения см. в статье [Управление обновлениями для нескольких виртуальных машин](manage-update-multi.md). Управление обновлениями для виртуальной машины можно также включить на странице виртуальной машины в портал Azure. Этот сценарий доступен для виртуальных машин [Linux](../virtual-machines/linux/tutorial-config-management.md#enable-update-management) и [Windows](../virtual-machines/windows/tutorial-config-management.md#enable-update-management) .

> [!NOTE]
> Управление обновлениями решение требует связывания рабочей области Log Analytics с учетной записью службы автоматизации. Полный список поддерживаемых регионов см. в статье [сопоставления рабочих областей Azure](./how-to/region-mappings.md). Сопоставления регионов не влияют на возможность управления виртуальными машинами в отдельном регионе из учетной записи службы автоматизации.

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../includes/azure-monitor-log-analytics-rebrand.md)]

## <a name="solution-overview"></a>Обзор решения

Компьютеры под управлением Управление обновлениями используют следующие конфигурации для выполнения оценки и обновления развертываний.

* Microsoft Monitoring Agent (MMA) для Windows или Linux;
* служба настройки требуемого состояния PowerShell;
* гибридные рабочие роли Runbook службы автоматизации;
* службы Центра обновления Майкрософт или Windows Server Update Services (WSUS) для компьютеров с Windows.

На следующей схеме показано, как решение оценивает и применяет обновления безопасности ко всем подключенным компьютерам Windows Server и Linux в рабочей области.

![Поток процесса управления обновлениями](./media/automation-update-management/update-mgmt-updateworkflow.png)

Управление обновлениями можно использовать для внутренних подключенных компьютеров в нескольких подписках одного и того же клиента.

После выпуска пакета он занимает от 2 до 3 часов, чтобы исправление отображалось для компьютеров Linux для оценки. Для компьютеров под Windows для оценки исправления после его выпуска требуется 12 – 15 часов.

После того как компьютер выполнит проверку соответствия обновлений требованиям, Агент пересылает данные в неполное Azure Monitor журналов. На компьютере с Windows проверка на соответствие по умолчанию выполняется каждые 12 часов.

Помимо расписания проверки в течение 15 минут после перезапуска MMA запускается проверка на соответствие обновлений. Это происходит перед установкой обновления и после нее.

Для компьютера Linux проверка соответствия выполняется каждый час по умолчанию. При перезапуске агента MMA проверка соответствия инициируется в течение 15 минут.

Решение формирует отчет по актуальности состояния компьютера в зависимости от настроенного для синхронизации источника. Если компьютер Windows настроен для передачи отчетов службам WSUS в зависимости от времени последней синхронизации служб WSUS с Центр обновления Майкрософт, результаты могут отличаться от показанных Центр обновления Майкрософт. Это поведение касается компьютеров под управлением Linux, настроенных на отправку отчета в локальный, а не общедоступный репозиторий.

> [!NOTE]
> Для правильной передачи данных в службу решению управления обновлениями требуется, чтобы были включены определенные URL-адреса и порты. Дополнительные сведения о требованиях см. в разделе [Настройка сети](automation-hybrid-runbook-worker.md#network-planning).

Вы можете развернуть и установить обновления программного обеспечения на компьютерах, требующих обновлений с помощью запланированного развертывания. *Необязательные* обновления не включены в область развертывания для компьютеров с Windows. В область развертывания включаются только необходимые обновления.

Запланированное развертывание определяет, какие целевые компьютеры получат применимые обновления. Это можно сделать, явно указав определенные компьютеры или выбрав [группу компьютеров](../azure-monitor/platform/computer-groups.md) на основе поиска по журналам определенного набора компьютеров (или в [запросе Azure](automation-update-management-query-logs.md) , который динамически выбирает виртуальные машины Azure в соответствии с указанными критериями). Эти группы отличаются от [конфигурации области](../azure-monitor/insights/solution-targeting.md), которая используется только для определения того, какие компьютеры получают пакеты управления, которые включают решение.

Можно также указать расписание для утверждения и задать период времени, в течение которого можно установить обновления. Этот период называется окном обслуживания. 20-минутный интервал периода обслуживания резервируется для перезагрузки, предполагая, что один из них необходим и выбран соответствующий параметр перезагрузки. Если исправление занимает больше времени, чем ожидалось, и в период обслуживания меньше 20 минут, перезагрузка не выполняется.

Обновления устанавливаются с помощью Runbook в службе автоматизации Azure. Вы не можете просматривать эти модули Runbook, и они не нуждаются в какой бы то ни было конфигурации. При создании развертывания обновления создается расписание, которое запускает главный Runbook обновления в указанное время для включенных компьютеров. Этот Runbook запускает для каждого агента дочерний Runbook, который устанавливает необходимые обновления.

Целевой компьютер будет параллельно выполнять развертывания согласно дате и времени, указанным в развертывании обновлений. Перед установкой выполняется проверка, чтобы убедиться, что обновления по-прежнему необходимы. Для клиентских компьютеров с WSUS, если обновления не утверждены в WSUS, развертывание обновления завершается сбоем.

Наличие компьютера, зарегистрированного для Управление обновлениями более чем в одной Log Analytics рабочей области (многосетевых), не поддерживается.

## <a name="clients"></a>Клиенты

### <a name="supported-client-types"></a>Поддерживаемые типы клиентов

В следующей таблице перечислены операционные системы, поддерживаемые для оценки обновлений. Для установки исправлений требуется Гибридная Рабочая роль Runbook. Сведения о требованиях к гибридной рабочей роли Runbook см. в руководствах по установке для установки [гибридной рабочей роли Runbook Windows](automation-windows-hrw-install.md#installing-the-windows-hybrid-runbook-worker) и [гибридной рабочей роли Runbook Linux](automation-linux-hrw-install.md#installing-a-linux-hybrid-runbook-worker).

|Операционная система  |Примечания  |
|---------|---------|
|Windows Server 2019 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2016 (Datacenter/Datacenter Core/Standard)<br><br>Windows Server 2012 R2 (Datacenter/Standard)<br><br>Windows Server 2012<br><br>Windows Server 2008 R2 (RTM и SP1 Standard)||
|CentOS 6 (x86 или x64) и 7 (x64).      | У агентов Linux должен быть доступ к репозиторию обновлений. Для установки исправлений на основе классификации необходимо, чтобы `yum` возвращали данные безопасности, которые CentOS отсутствуют в выпусках RTM. Дополнительные сведения об исправлениях на основе классификации в CentOS см. в [статье классификации обновлений в Linux](#linux-2).          |
|Red Hat Enterprise 6 (x86 или x64) и 7 (x64).     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|Ubuntu 14.04 LTS, 16.04 LTS и 18.04 LTS (x86/x64)      |У агентов Linux должен быть доступ к репозиторию обновлений.         |

> [!NOTE]
> Масштабируемые наборы виртуальных машин Azure можно управлять с помощью Управление обновлениями. Управление обновлениями работает с самими экземплярами, а не с базовым образом. Необходимо запланировать обновления последовательно, чтобы не все экземпляры виртуальных машин обновлялись одновременно.
> Чтобы добавить узлы для масштабируемых наборов виртуальных машин, выполните действия, описанные в разделе подключение [компьютера без Azure](automation-tutorial-installed-software.md#onboard-a-non-azure-machine).

### <a name="unsupported-client-types"></a>Неподдерживаемые типы клиентов

В следующей таблице перечислены неподдерживаемые операционные системы.

|Операционная система  |Примечания  |
|---------|---------|
|Клиент Windows     | Клиентские операционные системы (например, Windows 7 и Windows 10) не поддерживаются.        |
|Nano Server Windows Server 2016     | Не поддерживается.       |
|Узлы службы Kubernetes Azure | Не поддерживается. Используйте процесс установки исправлений, описанный в статье [Установка обновлений безопасности и ядра для узлов Linux в службе Kubernetes Azure (AKS)](../aks/node-updates-kured.md) .|

### <a name="client-requirements"></a>Требования к клиенту

Ниже приведены сведения о требованиях клиента, зависящих от операционной системы. Дополнительные рекомендации см. в разделе [планирование сети](#ports).

#### <a name="windows"></a>Windows

Агенты Windows должны быть настроены для взаимодействия с сервером WSUS, или они должны иметь доступ к Центр обновления Майкрософт.

Решение "Управление обновлениями" можно использовать вместе с System Center Configuration Manager. Дополнительные сведения о сценариях интеграции см. в разделе [Параметр Configuration](oms-solution-updatemgmt-sccmintegration.md#configuration). [Агент Windows](../azure-monitor/platform/agent-windows.md) является обязательным компонентом. Агент устанавливается автоматически, если вы подключите виртуальную машину Azure.

По умолчанию виртуальные машины Windows, развернутые из Azure Marketplace, настроены на получение автоматических обновлений из службы Центр обновления Windows. Это поведение не изменяется при добавлении этого решения или добавлении виртуальных машин Windows в рабочую область. Если вы не управляете обновлениями с помощью этого решения, будет применено поведение по умолчанию (автоматическое применение обновлений).

> [!NOTE]
> Пользователь может изменить групповая политика таким образом, чтобы перезагрузка компьютера могла выполняться только пользователем, а не системой. Управляемые компьютеры могут зависнуть, если у Управление обновлениями нет прав на перезагрузку компьютера без вмешательства пользователя вручную.
>
> Дополнительные сведения см. в разделе [Настройка параметров групповая политика для автоматическое обновление](https://docs.microsoft.com/windows-server/administration/windows-server-update-services/deploy/4-configure-group-policy-settings-for-automatic-updates).

#### <a name="linux"></a>Linux

У компьютеров под управлением Linux должен быть доступ к репозиторию обновлений. Репозиторий обновлений может быть общедоступным или частным. Для взаимодействия с решением "Управление обновлениями" требуется TLS 1.1 или TLS 1.2. В этом решении не поддерживается агент Log Analytics для Linux, настроенный для передачи отчетов в более чем одну Log Analytics рабочую область. На компьютере также должен быть установлен Python 2. x.

Сведения о том, как установить агент Log Analytics для Linux и загрузить последнюю версию, см. в статье [log Analytics Agent for Linux](https://github.com/microsoft/oms-agent-for-linux). Сведения об установке агента Log Analytics для Windows см. [в разделе Подключение компьютеров Windows к Azure Monitor](../log-analytics/log-analytics-windows-agent.md).

Виртуальные машины, созданные на основе образов Red Hat Enterprise Linux по требованию (RHEL), доступных в Azure Marketplace, регистрируются для доступа к [инфраструктуре Red Hat Update Framework (RHUI)](../virtual-machines/virtual-machines-linux-update-infrastructure-redhat.md) , которая развернута в Azure. Любой другой дистрибутив Linux должен быть обновлен из репозитория файлов в сети распространения с помощью поддерживаемых методов распространения.

## <a name="permissions"></a>Разрешения

Для создания развертываний обновлений и управления ими требуются определенные разрешения. Дополнительные сведения об этих разрешениях см. в разделе [доступ на основе ролей — Управление обновлениями](automation-role-based-access-control.md#update-management).

## <a name="solution-components"></a>Компоненты решения

Решение состоит из приведенных ниже ресурсов. Они добавляются в учетную запись службы автоматизации. Эти ресурсы являются либо непосредственно подключенными агентами, либо они находятся в группе управления, связанной с Operations Manager.

### <a name="hybrid-worker-groups"></a>Группы гибридных рабочих ролей

После включения этого решения любой подключенный к рабочей области Log Analytics компьютер с Windows будет автоматически настроен в качестве гибридной рабочей роли Runbook для поддержки модулей Runbook, которые входят в это решение.

Для каждого компьютера с Windows, управляемого этим решением, эти роли будут указаны на странице **групп гибридных рабочих ролей** как **группа гибридных рабочих ролей системы** для учетной записи службы автоматизации. В решениях используется *имя узла FQDN_GUID* соглашения об именовании. Вы не можете выбрать эти группы с помощью модулей Runbook в своей учетной записи. При попытайтесь выполнить попытку не удастся. Эти группы предназначены только для поддержки решения для управления.

Вы можете добавить компьютеры с Windows в группу гибридных рабочих ролей Runbook в учетной записи службы автоматизации, чтобы обеспечить поддержку модулей Runbook службы автоматизации, если вы используете одну и ту же учетную запись для решения и для участия в группе гибридных рабочих ролей Runbook. Эта функция добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

### <a name="management-packs"></a>Пакеты управления

Если группа управления System Center Operations Manager подключена к рабочей области Log Analytics, в Operations Manager будут установлены следующие пакеты. После добавления этого решения пакеты управления также будут установлены на компьютерах с Windows, подключенных напрямую. Управлять и настраивать эти пакеты управления не требуется.

* Пакет аналитики оценки обновления Microsoft System Center Advisor (Microsoft.IntelligencePacks.UpdateAssessment);
* Microsoft.IntelligencePack.UpdateAssessment.Configuration (Microsoft.IntelligencePack.UpdateAssessment.Configuration);
* пакет управления развертыванием обновлений.

> [!NOTE]
> Предположим, что у вас есть группа управления Operations Manager 1807 или 2019 с агентами, настроенными на уровне группы управления, чтобы связать их с рабочей областью. Текущий обходной путь, чтобы отобразить их, — это переопределить **исауторегистратионенаблед** на **true** в правиле **Microsoft. IntelligencePacks. AzureAutomation. HybridAgent. init** .

Дополнительные сведения об обновлении пакетов управления решениями см. в разделе [Connect Operations Manager to Azure Monitor Logs](../azure-monitor/platform/om-agents.md).

> [!NOTE]
> Для систем с агентом Operations Manager: для полного управления агентом с помощью Управление обновлениями агент должен быть обновлен до MMA. Чтобы узнать, как обновить агент, см. [эту статью](https://docs.microsoft.com/system-center/scom/deploy-upgrade-agents). В средах, использующих Operations Manager, необходимо запустить System Center Operations Manager 2012 R2 UR 14 или более поздней версии.

## <a name="data-collection"></a>сбор данных

### <a name="supported-agents"></a>Поддерживаемые агенты

В приведенной ниже таблице описаны подключенные источники, которые поддерживает это решение.

| Подключенный источник | Поддерживается | Description |
| --- | --- | --- |
| Агенты Windows |Да |Решение собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Да |Решение собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Да |Решение собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе обновления.<br/><br/>Прямое подключение агента Operations Manager к Azure Monitor журналов не требуется. Данные пересылаются из группы управления в рабочую область Log Analytics. |

### <a name="collection-frequency"></a>Частота сбора

Дважды в день выполняется проверка каждого управляемого компьютера Windows. Каждые 15 минут вызывается API Windows, чтобы запросить время последнего обновления и определить, изменилось ли состояние. Если состояние изменилось, запускается проверка на соответствие.

Сканирование выполняется каждый час для каждого управляемого компьютера Linux.

Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

Средний уровень использования данных Azure Monitor журналов для компьютера, использующего Управление обновлениями, составляет примерно 25 мегабайт (МБ) в месяц. Это значение является только приближением и может изменяться в зависимости от среды. Рекомендуется отслеживать среду, чтобы отслеживать точное использование.

## <a name="ports"></a>Планирование сети

Для Управления обновлениями требуются следующие адреса. Взаимодействие с этими адресами выполняется через порт 443.

|Azure Public  |Azure для государственных организаций  |
|---------|---------|
|*.ods.opinsights.azure.com     |*.ods.opinsights.azure.us         |
|*.oms.opinsights.azure.com     | *.oms.opinsights.azure.us        |
|*.blob.core.windows.net|*.blob.core.usgovcloudapi.net|
|*.azure-automation.net|*.azure-automation.us|

Для компьютеров Windows необходимо также разрешить передачу трафика на любые конечные точки, необходимые для Центр обновления Windows. Обновленный список обязательных конечных точек можно найти в [проблемах, связанных с HTTP/proxy](/windows/deployment/update/windows-update-troubleshooting#issues-related-to-httpproxy). Если у вас есть локальный [Центр обновления Windows сервер](/windows-server/administration/windows-server-update-services/plan/plan-your-wsus-deployment), необходимо также разрешить трафик на сервер, указанный в [ключе WSUS](/windows/deployment/update/waas-wu-settings#configuring-automatic-updates-by-editing-the-registry).

Для компьютеров с Red Hat Linux см. раздел [IP-адреса для серверов доставки содержимого RHUI](../virtual-machines/linux/update-infrastructure-redhat.md#the-ips-for-the-rhui-content-delivery-servers) для требуемых конечных точек. Другие дистрибутивы Linux см. в документации поставщика.

Дополнительные сведения о портах, которым необходима гибридная рабочая роль Runbook, см. в статье [Автоматизация ресурсов в центре обработки данных или облаке с помощью гибридной рабочей роли Runbook](automation-hybrid-runbook-worker.md#hybrid-worker-role).

Рекомендуется использовать адреса, указанные при определении исключений. IP-адреса можно скачать [Microsoft Azure диапазоны IP-адресов центра обработки данных](https://www.microsoft.com/download/details.aspx?id=41653). Этот файл обновляется еженедельно и отражает развернутые в данный момент диапазоны и все будущие изменения в диапазонах IP-адресов.

Следуйте инструкциям в разделе [Подключение компьютеров без доступа к Интернету](../azure-monitor/platform/gateway.md) для настройки компьютеров, у которых нет доступа к Интернету.

## <a name="view-update-assessments"></a>Просмотр оценок обновления

Выберите **Управление обновлениями** в своей учетной записи службы автоматизации, чтобы просмотреть состояние компьютеров.

В этом представлении содержатся сведения о ваших компьютерах, отсутствующих обновлениях, развертываниях обновлений и запланированных развертываниях обновлений. В столбце **соответствие** можно увидеть время последней оценки компьютера. В столбце **готовность агента обновления** можно проверить работоспособность агента обновления. Если возникла проблема, выберите ссылку для перехода к документации по устранению неполадок, которая поможет устранить проблему.

Чтобы выполнить поиск по журналам, который возвращает сведения о компьютере, обновлении или развертывании, выберите соответствующий элемент в списке. При этом откроется страница **поиска по журналам** с запросом на выбранный элемент:

![Представление по умолчанию решения "Управление обновлениями"](media/automation-update-management/update-management-view.png)

## <a name="view-missing-updates"></a>Просмотр отсутствующих обновлений

Выберите **Отсутствующие обновления**, чтобы просмотреть список обновлений, отсутствующих на ваших компьютерах. Каждое обновление перечислено и может быть выбрано. Отображается информация о количестве компьютеров, которым оно требуется, операционная система и ссылка для получения дополнительных сведений. В области **Поиск журналов** отображаются дополнительные сведения об обновлениях.

![отсутствующие обновления.](./media/automation-view-update-assessments/automation-view-update-assessments-missing-updates.png)

## <a name="update-classifications"></a>Классификации обновлений

В следующих таблицах содержатся списки классификаций обновлений в Управлении обновлениями с определениями для каждой классификации.

### <a name="windows"></a>Windows

|Классификация  |Description  |
|---------|---------|
|критические обновления;     | Обновление для конкретной проблемы, которая относится к критической, не связанной с безопасностью ошибке.        |
|Обновления для системы безопасности     | Обновление для ошибки, связанной с безопасностью конкретного продукта.        |
|накопительные пакеты обновления;     | Накопительный набор исправлений, упакованных в один пакет для удобства развертывания.        |
|пакеты дополнительных компонентов;     | Новые функции продукта, которые распространяются вне выпуска продукта.        |
|пакеты обновления;     | Накопительный набор исправлений, применяемых к приложению.        |
|обновления определений;     | Обновление для вирусов или других файлов определений.        |
|Средства     | Служебная программа или функция, которая помогает выполнить одну или несколько задач.        |
|Обновления     | Обновление приложения или файла, установленного в настоящее время.        |

### <a name="linux-2"></a>Linux

|Классификация  |Description  |
|---------|---------|
|критические обновления и обновления для системы безопасности;     | Обновления для конкретной проблемы или проблемы, связанной с безопасностью продукта.         |
|Другие обновления     | Все остальные обновления, не являющиеся критически важными или не являющиеся обновлениями для системы безопасности.        |

В Linux Управление обновлениями может различать критические обновления и обновления системы безопасности в облаке при отображении данных оценки из-за обогащения данных в облаке. Для исправления в решении по управлению обновлениями используются данные классификации, доступные на компьютере. В отличие от других дистрибутивов, CentOS не содержит эту информацию в RTM. Если у вас есть компьютеры CentOS, настроенные для возврата данных безопасности для следующей команды, Управление обновлениями можете выполнить исправление на основе классификаций.

```bash
sudo yum -q --security check-update
```

В настоящее время нет поддерживаемого метода для включения собственной классификации — доступность данных в CentOS. В настоящее время для клиентов, которые могли включить этот вариант самостоятельно, предоставляется только лучшая поддержка. 

Для классификации обновлений в Red Hat Enterprise версии 6 необходимо установить подключаемый модуль Yum-Security. В Red Hat Enterprise Linux 7 подключаемый модуль уже является частью yum, поэтому нет необходимости устанавливать ничего. Дополнительные сведения см. в следующей [статье базы знаний](https://access.redhat.com/solutions/10021)Red Hat.

## <a name="integrate-with-system-center-configuration-manager"></a>Интеграция с System Center Configuration Manager

Клиенты, которые инвестировали в System Center Configuration Manager для управления ПК, серверами и мобильными устройствами, также полагаются на надежность и зрелость Configuration Manager, чтобы помочь им управлять обновлениями программного обеспечения. Configuration Manager входит в их цикл управления обновлением программного обеспечения (SUM).

Сведения об интеграции решения по управлению с Sytem Center Configuration Manager см. в статье [Интеграция Integrate System Center Configuration Manager с решением "Управление обновлениями"](oms-solution-updatemgmt-sccmintegration.md).

### <a name="third-party-patches-on-windows"></a>Исправления сторонних производителей в Windows

Управление обновлениями использует локально настроенный репозиторий обновлений для обновления поддерживаемых систем Windows. Это либо WSUS, либо Центр обновления Windows. Такие средства, как [System Center Updates Publisher](/sccm/sum/tools/updates-publisher) (Updates Publisher) позволяют публиковать пользовательские обновления в WSUS. Этот сценарий позволяет Управление обновлениями исправлять компьютеры, использующие System Center Configuration Manager в качестве репозитория обновлений программного обеспечения стороннего производителя. Чтобы узнать, как настроить Updates Publisher, см. статью [Установка Updates Publisher](/sccm/sum/tools/install-updates-publisher).

## <a name="patch-linux-machines"></a>Исправление компьютеров Linux

В следующих разделах объясняются потенциальные проблемы с установкой исправлений для Linux дистрибутивов.

### <a name="unexpected-os-level-upgrades"></a>Непредвиденные обновления на уровне ОС

В некоторых вариантах Linux, таких как Red Hat Enterprise Linux, обновление на уровне ОС может происходить через пакеты. Это может привести к запуску управления обновлениями, когда изменяется номер версии операционной системы. Так как решение "Управление обновлениями" использует те же методы для обновления пакетов, что и администратор на компьютерах Linux в локальной среде, такое поведение является преднамеренным.

Чтобы избежать обновления версии ОС с помощью Управление обновлениями, используйте функцию **исключения** .

В Red Hat Enterprise Linux именем пакета для исключения должно быть имя redhat-release-server.x86_64.

![Исключаемые пакеты для Linux](./media/automation-update-management/linuxpatches.png)

### <a name="criticalsecurity-patches-arent-applied"></a>Критические исправления и обновления для системы безопасности не применяются

При развертывании обновлений на компьютер Linux вы можете выбрать категории обновлений. Этот параметр фильтрует обновления, примененные к компьютеру, который соответствует указанным критериям. Этот фильтр применяется локально на компьютере при развертывании обновления.

Поскольку Управление обновлениями выполняет обогащение обновлений в облаке, некоторые обновления могут помечаться в Управление обновлениями, что влияет на безопасность, даже если на локальном компьютере нет этих сведений. В результате, если вы применяете критические обновления к компьютеру Linux, могут возникать обновления, не помеченные как имеющие влияние на систему безопасности на этом компьютере, поэтому обновления не применяются. Тем не менее Управление обновлениями может сообщить о том, что компьютер не соответствует требованиям, так как он содержит дополнительные сведения о соответствующем обновлении.

Развертывание обновлений по классификации обновлений не работает в RTM версий CentOS. Чтобы правильно развернуть обновления для CentOS, выберите все классификации, чтобы убедиться, что обновления применены. Для SUSE, выбрав *только* **другие обновления** в качестве классификации, можно также установить некоторые обновления безопасности, если обновления безопасности, связанные с zypper (диспетчером пакетов) или его зависимостями, требуются первыми. Это поведение является ограничением zypper. В некоторых случаях может потребоваться перезапустить развертывание обновлений. Для проверки обратитесь к журналу обновлений.

### <a name="multi-tenant"></a>Развертывание обновлений между клиентами

Если у вас есть компьютеры в другом клиенте Azure, которые подготавливает отчеты к Управление обновлениями, которые необходимо исправить, для их планирования необходимо использовать следующее решение. Вы можете использовать командлет [New-AzureRmAutomationSchedule](/powershell/module/azurerm.automation/new-azurermautomationschedule) с параметром `-ForUpdate`, чтобы создать расписание, и использовать командлет [New-азурермаутоматионсофтвареупдатеконфигуратион](/powershell/module/azurerm.automation/new-azurermautomationsoftwareupdateconfiguration
) и передать компьютеры в другом клиенте в параметр `-NonAzureComputer`. В приведенном ниже примере показано, как это сделать.

```azurepowershell-interactive
$nonAzurecomputers = @("server-01", "server-02")

$startTime = ([DateTime]::Now).AddMinutes(10)

$sched = New-AzureRmAutomationSchedule -ResourceGroupName mygroup -AutomationAccountName myaccount -Name myupdateconfig -Description test-OneTime -OneTime -StartTime $startTime -ForUpdate

New-AzureRmAutomationSoftwareUpdateConfiguration  -ResourceGroupName $rg -AutomationAccountName <automationAccountName> -Schedule $sched -Windows -NonAzureComputer $nonAzurecomputers -Duration (New-TimeSpan -Hours 2) -IncludedUpdateClassification Security,UpdateRollup -ExcludedKbNumber KB01,KB02 -IncludedKbNumber KB100
```

## <a name="onboard"></a>Включение решения "Управление обновлениями"

Чтобы начать установку исправлений системы, нужно включить решение "Управление обновлениями". Подключить это решение на виртуальных машинах можно несколькими способами. Ниже приведены рекомендуемые и поддерживаемые способы подключения решения:

* [на одной виртуальной машине](automation-onboard-solutions-from-vm.md);
* [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md);
* [в учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md);
* [с помощью модуля runbook службы автоматизации Azure](automation-onboard-solutions.md).

## <a name="next-steps"></a>Дальнейшие действия

Используйте следующее руководство, чтобы узнать, как управлять обновлениями для виртуальных машин Windows.

> [!div class="nextstepaction"]
> [Устранение неполадок при изменениях в среде](automation-tutorial-update-management.md)

* Используйте поиск по журналам в [Azure Monitor журналов](../log-analytics/log-analytics-log-searches.md) для просмотра подробных сведений об обновлениях.
* [Создавайте оповещения](automation-tutorial-update-management.md#configure-alerts) о состоянии развертывания обновлений.

* Сведения о том, как взаимодействовать с Управление обновлениями с помощью REST API, см. в разделе [конфигурации обновлений программного обеспечения](/rest/api/automation/softwareupdateconfigurations).
* Сведения об устранении неполадок в Управление обновлениями см. в разделе [Устранение неполадок Управление обновлениями](troubleshoot/update-management.md).
