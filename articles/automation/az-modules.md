---
title: Поддержка модулей Az в службе автоматизации Azure
description: В этой статье содержится информация об использовании модулей Az в Azure Automation.
services: automation
ms.subservice: shared-capabilities
ms.date: 02/08/2019
ms.topic: conceptual
ms.openlocfilehash: a8d6d25a2ba7f0040b13982f14f3d6081ac32f15
ms.sourcegitcommit: 0450ed87a7e01bbe38b3a3aea2a21881f34f34dd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2020
ms.locfileid: "80637992"
---
# <a name="az-module-support-in-azure-automation"></a>Поддержка модулей Az в службе автоматизации Azure

Azure Automation поддерживает использование [модуля Azure PowerShell Az](/powershell/azure/new-azureps-module-az?view=azps-1.1.0) в ваших runbooks. Модуль свертывания Az не импортируется автоматически в любых новых или существующих учетных записях автоматизации. 

## <a name="considerations"></a>Рекомендации

При использовании модулей Az в Azure Automation необходимо учитывать несколько вещей:

* Решения более высокого уровня в учетной записи автоматизации могут использовать рунки и модули. Поэтому редактирование runbooks или модули обновления потенциально могут вызвать проблемы с вашими решениями. Перед импортом новых модулей Az необходимо тщательно протестировать все рунбуки и решения в отдельной учетной записи Automation. 

* Любые изменения модулей могут негативно повлиять на решение [Start/Stop.](automation-solution-vm-management.md) 

* Импорт модуля Az в учетной записи автоматизации не автоматически импортирует модуль в сеансе PowerShell, который использует runbooks. Модули импортируются в сеанс PowerShell в следующих ситуациях:

    * Когда беговая книга вызывает cmdlet из модуля
    * Когда runbook импортирует модуль явно `Import-Module` с cmdlet
    * Когда runbook импортирует другой модуль в зависимости от модуля

> [!NOTE]
> Мы не рекомендуем изменять модули и книги в учетных записях автоматизации, которые содержат какие-либо решения. Это положение не является специфическим для модулей Az. Это следует учитывать при внесении любых изменений в учетную запись Автоматизации.

> [!IMPORTANT]
> Убедитесь, что запуски в учетной записи Автоматизации импортируют либо модули Az, либо модули [AzureRM,](https://www.powershellgallery.com/packages/AzureRM/6.13.1) но не оба, в сеанс PowerShell. Если runbook импортирует модули Az перед модулями AzureRM, запуск завершается. Однако ошибка, отображающая [Get_SerializationSettings](troubleshoot/runbooks.md#get-serializationsettings) cmdlet появляется в потоках работ, и cmdlets может не выполнить должным образом. Если runbook импортирует модули AzureRM перед модулями Az, запуск также завершается. Однако в этом случае вы получаете ошибку в потоках задания, в ходе чего следует, что Az и AzureRM не могут быть импортированы в одном сеансе или использованы в одной и той же книге.

## <a name="migrating-to-az-modules"></a>Переход к модулям Az

Мы рекомендуем протестировать миграцию в модули Az в учетной записи автоматизации тестирования. После создания учетной записи можно использовать инструкции в этом разделе для работы с модулями.

### <a name="stop-and-unschedule-all-runbooks-that-use-azurerm-modules"></a>Остановить и разпланировать все запуски, в которые используются модули AzureRM

Чтобы убедиться, что вы не запустите существующие runbooks, которые используют модули AzureRM, остановите и разогнайте все затронутые руны. Вы можете увидеть, какие графики существуют и какие графики удалить, запустив код, похожий на этот пример:

  ```powershell-interactive
  Get-AzureRmAutomationSchedule -AutomationAccountName "<AutomationAccountName>" -ResourceGroupName "<ResourceGroupName>" | Remove-AzureRmAutomationSchedule -WhatIf
  ```

Важно, чтобы рассмотреть каждое расписание отдельно, чтобы убедиться, что вы можете перенести его в будущем для ваших runbooks, если это необходимо.

### <a name="import-the-az-modules"></a>Импорт модулей Az

>[!NOTE]
>Импорт юнков требуется только для модулей Az. Не импортируйте модуль свертывания Az, так как он включает в себя все модули Az. Это указание касается всех модулей.

Модуль [Az.Accounts](https://www.powershellgallery.com/packages/Az.Accounts/1.1.0) является зависимостью для других модулей Az. По этой причине, ваши runbooks должны импортировать этот модуль в учетную запись автоматизации, прежде чем импортировать любые другие модули.

Импорт модулей на портале Azure:

1. Из учетной записи автоматизации выберите **Модули** под **общими ресурсами.** 
2. Нажмите кнопку **Обзор коллекции**, чтобы открыть страницу Обзор коллекции.  
3. В панели поиска, например, `Az.Accounts`введите имя модуля. 
4. На странице модуля PowerShell щелкните **«Импорт»,** чтобы импортировать модуль в учетную запись автоматизации.

![Импортные модули из аккаунта Автоматизации](media/az-modules/import-module.png)

Этот процесс импорта также может быть выполнен через [галерею PowerShell](https://www.powershellgallery.com) путем поиска модуля для импорта. Как только вы найдете модуль, выберите его, выберите вкладку **Azure Automation** и нажмите **Развертывание в Azure Automation.**

![Импорт модулей непосредственно из коллекции](media/az-modules/import-gallery.png)

## <a name="testing-your-runbooks"></a>Тестирование беговых книг

После того как вы импортировали модули Az в учетную запись Автоматизация, вы можете начать редактировать свои runbooks для использования модулей. Большинство cmdlets имеют те же названия, что и для модуля AzureRM, за исключением того, что префикс AzureRM (или AzureRm) был изменен на Az. Список модулей, не выполняемых в этой конвенции о присвоении имен, смотрите [список исключений.](/powershell/azure/migrate-from-azurerm-to-az#update-cmdlets-modules-and-parameters)

Один из способов проверить модификацию runbook для использования новых `Enable-AzureRmAlias -Scope Process` cmdlets является использование в начале runbook. Добавляя эту команду в свой runbook, скрипт может работать без изменений.

## <a name="after-migration-details"></a>Подробная информация о послемиграции

После завершения миграции не пытайтесь запускать запущенные книги с помощью модулей AzureRM в учетной записи Автоматизации. Также рекомендуется не импортировать и не обновлять модули AzureRM в учетной записи. Рассмотрим учетную запись, перенесенную в Az, и работайте только с модулями Az. 

При создании новой учетной записи Автоматизации по-прежнему устанавливаются существующие модули AzureRM. Вы все еще можете обновить учебники с помощью cmdlets AzureRM. Тем не менее, вы не должны запускать эти runbooks.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании модулей Az см. в статье [Get started with Azure PowerShell](/powershell/azure/get-started-azureps?view=azps-1.1.0) (Начало работы с Azure PowerShell).
