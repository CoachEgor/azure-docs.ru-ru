---
title: Поддержка модулей Az в службе автоматизации Azure
description: В этой статье содержится информация об использовании модулей Az в Azure Automation.
services: automation
ms.subservice: shared-capabilities
ms.date: 02/08/2019
ms.topic: conceptual
ms.openlocfilehash: 776834937d81a3ba84e3c1db56496a7d951d7982
ms.sourcegitcommit: 980c3d827cc0f25b94b1eb93fd3d9041f3593036
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80548361"
---
# <a name="az-module-support-in-azure-automation"></a>Поддержка модулей Az в службе автоматизации Azure

Azure Automation поддерживает использование [модуля Azure PowerShell Az](/powershell/azure/new-azureps-module-az?view=azps-1.1.0) в ваших runbooks. Модуль Az не импортируется автоматически в новых или существующих учетных записях автоматизации. 

## <a name="considerations"></a>Рекомендации

При использовании модуля Az в службе автоматизации Azure необходимо учитывать много нюансов. Runbooks и модули могут быть использованы решениями более высокого уровня в вашей учетной записи Автоматизация. Изменение модулей runbook или обновление модулей может вызвать проблемы с модулями runbook. Перед импортом новых `Az` модулей необходимо тщательно протестировать все рунбуки и решения в отдельной учетной записи Automation. Любые изменения модулей могут негативно повлиять на решение [Start/Stop.](automation-solution-vm-management.md) Мы не рекомендуем изменять модули и книги в учетных записях автоматизации, которые содержат какие-либо решения. Это поведение не относится к модулям Az. Такое поведение следует учитывать при внесении любых изменений в учетную запись Автоматизации.

Импорт модуля `Az` в учетной записи автоматизации не автоматически импортирует модуль в сеансе PowerShell, который используются в runbooks. Модули импортируются в сеанс PowerShell в следующих ситуациях:

* если командлет из модуля вызывается из модуля runbook;
* если модуль runbook импортирует его явным образом с помощью командлета `Import-Module`;
* если в сеанс PowerShell импортируется другой модуль в зависимости от модуля.

> [!IMPORTANT]
> Важно убедиться, что runbooks в учетной `Az` записи Автоматизации либо импортировать или `AzureRM` модули в PowerShell сессий, используемых runbooks, а не оба. Если `Az` импортируется `AzureRM` раньше в runbook, runbook завершается, но ошибка, ссылающаяся на [Get_SerializationSettings](troubleshoot/runbooks.md#get-serializationsettings) cmdlet появляется в потоках работы и cmdlets не может быть должным образом выполнена. Если вы `AzureRM` импортируете, а затем, `Az`ваш runbook по-прежнему завершается, `Az` `AzureRM` но вы получаете ошибку в рабочих потоков о том, что оба и не могут быть импортированы в той же сессии или используется в той же книге.

## <a name="migrating-to-az-modules"></a>Переход к модулям Az

Рекомендуется протестировать миграцию в модули Az в учетной записи автоматизации тестирования. После создания учетной записи Automation можно использовать инструкции в этом разделе для работы с модулями.

### <a name="stop-and-unschedule-all-runbooks-that-use-azurerm-cmdlets"></a>Остановить и развести все runbooks, которые используют AzureRM cmdlets

Чтобы убедиться, что не выполняются какие-либо имеющиеся модули runbook, использующие командлеты `AzureRM`, необходимо выполнить остановку и отменить запланированное выполнение всех модулей runbook, использующих модули `AzureRM`. Вы можете увидеть, какие графики существуют и какие графики должны быть удалены, запустив код, похожий на этот пример.

  ```powershell-interactive
  Get-AzureRmAutomationSchedule -AutomationAccountName "<AutomationAccountName>" -ResourceGroupName "<ResourceGroupName>" | Remove-AzureRmAutomationSchedule -WhatIf
  ```

Важно, чтобы рассмотреть каждое расписание отдельно, чтобы убедиться, что вы можете перенести его в будущем для ваших runbooks, если это необходимо.

### <a name="import-the-az-modules"></a>Импорт модулей Az

Импортируйте только те модули Az, которые необходимы модулям runbook. Не импортируйте модуль `Az` свертывания, `Az.*` так как он включает в себя все модули. Это указание касается всех модулей.

Модуль [Az.Accounts](https://www.powershellgallery.com/packages/Az.Accounts/1.1.0) является зависимостью для других модулей `Az.*`. По этой причине этот модуль должен быть импортирован в учетную запись автоматизации, прежде чем импортировать другие модули.

Из учетной записи автоматизации выберите **Модули** под **общими ресурсами.** Нажмите кнопку **Обзор коллекции**, чтобы открыть страницу **Обзор коллекции**.  На панели поиска введите имя модуля (например, `Az.Accounts`). На странице модуля PowerShell щелкните **«Импорт»,** чтобы импортировать модуль в учетную запись автоматизации.

![Импортные модули из аккаунта Автоматизации](media/az-modules/import-module.png)

Этот процесс импорта также может быть выполнен через [галерею PowerShell](https://www.powershellgallery.com) путем поиска модуля для импорта. Найдя модуль, выберите его и на вкладке **Служба автоматизации Azure** щелкните **Deploy to Azure Automation** (Развертывание в службе автоматизации Azure).

![Импорт модулей непосредственно из коллекции](media/az-modules/import-gallery.png)

## <a name="testing-your-runbooks"></a>Тестирование беговых книг

После `Az` того, как модули будут импортированы в учетную запись Автоматизации, вы можете начать редактировать свои runbooks для использования модулей Az. Большинство cmdlets имеют те же названия, за исключением того, что `AzureRM` было изменено на `Az`. Список модулей, не соблюдаемых в этой конвенции о присвоении имен, смотрите [список исключений.](/powershell/azure/migrate-from-azurerm-to-az#update-cmdlets-modules-and-parameters)

Один из способов проверить модификацию runbook для использования новых `Enable-AzureRMAlias -Scope Process` cmdlets является использование в начале runbook. Добавляя эту команду в свой runbook, скрипт может работать без изменений.

## <a name="after-migration-details"></a>Подробная информация о послемиграции

После завершения миграции не пытайтесь больше `AzureRM` запускать запущенные книги с помощью модулей в учетной записи Automation. Также рекомендуется не импортировать и `AzureRM` не обновлять модули в учетной записи. Рассмотрим учетную `Az`запись мигрировали, и работать только с `Az` модулями. 

При создании новой учетной записи Автоматизации существующие `AzureRM` модули по-прежнему устанавливаются. Вы все еще можете обновить `AzureRM` учебник runbooks с cmdlets. Вы не должны запускать эти runbooks.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения об использовании модулей Az см. в статье [Get started with Azure PowerShell](/powershell/azure/get-started-azureps?view=azps-1.1.0) (Начало работы с Azure PowerShell).
