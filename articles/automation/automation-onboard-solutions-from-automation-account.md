---
title: Сведения о том, как подключить решения для управления обновлениями, отслеживания изменений и инвентаризации в службе автоматизации Azure
description: Сведения о том, как на виртуальной машине Azure подключить решения для управления обновлениями, отслеживания изменений и инвентаризации, входящие в состав службы автоматизации Azure
services: automation
ms.date: 4/11/2019
ms.topic: conceptual
ms.custom: mvc
ms.openlocfilehash: cf82dddf281e8e6f1348884702e32330dee4781b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79278679"
---
# <a name="onboard-update-management-change-tracking-and-inventory-solutions"></a>Подключение решений для управления обновлениями, отслеживания изменений и инвентаризации

Служба автоматизации Azure предоставляет решения для управления обновлениями безопасности операционной системы, отслеживания изменений и инвентаризации компонентов, установленных на компьютерах. Существует много способов разместить решение на виртуальных машинах: [из свойств виртуальной машины](automation-onboard-solutions-from-vm.md), [из списка виртуальных машин](automation-onboard-solutions-from-browse.md) в учетной записи Службы автоматизации или с помощью модуля [runbook](automation-onboard-solutions.md). В этой статье рассматривается подключение таких решений из учетной записи службы автоматизации.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите в Azure (https://portal.azure.com).

## <a name="enable-solutions"></a>включение решений;

Перейдите к учетной записи автоматизации и выберите либо **инвентаризации** или **отслеживания изменений** под **управлением конфигурации.**

Выберите рабочую область и учетную запись Log Analytics и нажмите **Enable,** чтобы включить решение. Процесс включения решения может занять до 15 минут.

![Подключение решения для инвентаризации](media/automation-onboard-solutions-from-automation-account/onboardsolutions.png)

> [!NOTE]
> При включении решений только определенные регионы поддерживают связывание рабочей области Log Analytics и учетной записи службы автоматизации.
>
> Список поддерживаемых пар отображения можно узнать на [сайте Region mapping для автоматизации учетной записи и рабочего пространства log Analytics.](how-to/region-mappings.md)

Решение для отслеживания изменений и инвентаризации позволяет [отслеживать изменения](automation-vm-change-tracking.md) и [выполнять инвентаризацию](automation-vm-inventory.md) на виртуальных машинах. На этом этапе нужно включить решение на виртуальной машине.

Когда решение отслеживания изменений и инвентаризации, направляющееся на бортовое уведомление, выберите **управление обновлением** под **управлением обновления.**

Решение Update Management позволяет управлять обновлениями и патчами для ваших Vms-технологий Azure и гибридных vMs. Вы можете оценить состояние доступных обновлений, запланировать установку необходимых обновлений и просмотреть результаты развертывания для проверки того, что обновления были успешно применены к ним.

На странице включения решения выбрано рабочее пространство Log Analytics, что и на предыдущем этапе. Нажмите **Включить** на борт решения управления обновлением. Процесс включения решения может занять до 15 минут.

![Подключение решения по обновлению](media/automation-onboard-solutions-from-automation-account/onboardsolutions2.png)

## <a name="scope-configuration"></a>Конфигурация области

В каждом решении используется конфигурация области в пределах рабочей области для определения целевых компьютеров, на которых будет внедрено решение. Конфигурация области представляет собой группу из одного или нескольких сохраненных поисковых запросов, которая используется для ограничения области применения решения к конкретным компьютерам. Чтобы получить доступ к конфигурациям scope, в учетной записи Автоматизации под **соответствующими ресурсами**выберите **Рабочее пространство.** Затем в рабочей области под **источниками данных Рабочей области**выберите **Конфигурации области.**

Если в выбранной рабочей области еще нет решений "Управление обновлениями" или "Отслеживание изменений", создаются следующие конфигурации области:

* **MicrosoftDefaultScopeConfig-ChangeTracking**;

* **MicrosoftDefaultScopeConfig-Updates**.

Если в выбранной рабочей области уже есть решение, то оно не развертывается повторно и конфигурация области не добавляется.

## <a name="saved-searches"></a>Сохраненные поисковые запросы

Когда компьютер добавляется в решения "Управление обновлениями" или "Отслеживание изменений" и "Инвентаризация", он появляется в одном из двух сохраненных поисковых запросов в рабочей области. Эти сохраненные поисковые запросы содержат компьютеры, которым будут назначены соответствующие решения.

Перейдите в рабочее пространство Log Analytics и выберите **Сохраненные поиски** в **рамках Общего**поиска. Два сохраненных поисковых запроса, используемые в этих решениях, показаны в следующей таблице:

|name     |Категория  |Псевдоним  |
|---------|---------|---------|
|MicrosoftDefaultComputerGroup     |  ChangeTracking       | ChangeTracking__MicrosoftDefaultComputerGroup        |
|MicrosoftDefaultComputerGroup     | Обновления        | Updates__MicrosoftDefaultComputerGroup         |

Выберите один из сохраненных поисковых запросов, чтобы просмотреть запрос, используемый для заполнения группы. На следующем рисунке показан запрос и его результаты:

![Сохраненные поисковые запросы](media/automation-onboard-solutions-from-automation-account/savedsearch.png)

## <a name="onboard-azure-vms"></a>Подключение виртуальных машин Azure

Из учетной записи автоматизации выберите **инвентаризации** или **отслеживания изменений** под **управлением конфигурации**, или **управление обновлением** под **управлением обновления.**

Щелкните **+ Добавить виртуальные машины Azure**, выберите одну или несколько виртуальных машин из списка. Виртуальные машины, которые нельзя включить, обозначаются серым цветом и становятся недоступными. Вазовые вм" могут существовать в любом регионе независимо от местонахождения вашей учетной записи автоматизации. На странице **Включение управления обновлениями** щелкните **Включить**. Это действие добавляет выбранные виртуальные машины в сохраненный в этом решении запрос поиска группы компьютеров.

![Включение виртуальных машин Azure](media/automation-onboard-solutions-from-automation-account/enable-azure-vms.png)

## <a name="onboard-a-non-azure-machine"></a>Подключение компьютера, не относящегося к Azure

Компьютеры, не зарегистрированные в Azure, необходимо добавлять вручную. Из учетной записи автоматизации выберите **инвентаризации** или **отслеживания изменений** под **управлением конфигурации**, или **управление обновлением** под **управлением обновления.**

Щелкните **Добавить компьютер, не связанный с Azure**. Это действие откроет новое окно браузера с [инструкциями о том, как установить и настроить Microsoft Monitoring Agent на виртуальной машине](../azure-monitor/platform/log-analytics-agent.md), чтобы она начала отправлять отчеты в решение. Для подключения виртуальной машины, управляемой с помощью System Center Operations Manager, новый агент не требуется. Сведения о рабочей области указываются в существующем агенте.

## <a name="onboard-machines-in-the-workspace"></a>Подключение компьютеров в рабочей области

Чтобы включить решения, следует добавить в службу автоматизации Azure виртуальные машины, установленные вручную или уже отправляющие отчеты в рабочую область. Из учетной записи автоматизации выберите **инвентаризации** или **отслеживания изменений** под **управлением конфигурации**, или **управление обновлением** под **управлением обновления.**

Выберите **Управление компьютерами**. Это действие открывает страницы **Управление компьютерами**. На этой странице можно включить решение на выбранном наборе компьютеров, на всех доступных компьютерах, или же включить его как для всех текущих компьютеров, так и для всех будущих. Кнопка **Управление компьютерами** может оказаться неактивна, если выбран параметр **Включить для всех доступных и будущих компьютеров**.

![Сохраненные поисковые запросы](media/automation-onboard-solutions-from-automation-account/managemachines.png)

### <a name="all-available-machines"></a>Все доступные компьютеры

Чтобы включить решение для всех доступных компьютеров, выберите **Включить для всех доступных компьютеров**. Это действие отключает возможность добавления компьютеров по отдельности. Эта задача добавляет все имена компьютеров, отправляющих отчеты в рабочую область, в сохраненный запрос поиска группы компьютеров. Если установлен этот флажок, отключается кнопка **Управление машинами**.

### <a name="all-available-and-future-machines"></a>Все доступные и будущие компьютеры

Чтобы включить решение для всех доступных и будущих компьютеров, установите флажок **Включить для всех доступных и будущих компьютеров**. Этот параметр удаляет сохраненные поисковые запросы и конфигурации области из рабочей области. Это действие открывает решение для всех компьютеров, относящихся и не относящихся к Azure, которые отправляют отчеты в рабочую область. Это действие отключает кнопку **Управление компьютерами** без возможности восстановления, так как не остается ни одной конфигурации области.

Можно добавить конфигурации scope назад, добавив первоначальные сохраненные поиски обратно. Для получения дополнительной информации [см.](#saved-searches)

### <a name="selected-machines"></a>Выбранные компьютеры

Чтобы включить решение для одной или нескольких машин, выберите **Включить на выбранных машинах** и нажмите **Добавить** рядом с каждой машиной, которую вы хотите добавить в решение. Эта задача добавляет выбранные имена компьютеров в сохраненный запрос поиска группы компьютеров для решения.

## <a name="unlink-workspace"></a>Удаление связи с рабочей областью

Следующие решения зависят от рабочей области Log Analytics:

* [Управление обновлениями](automation-update-management.md)
* [Отслеживание изменений](automation-change-tracking.md)
* [Запуск и остановка виртуальных машин в нерабочее время](automation-solution-vm-management.md)

Если вы решите, что больше не хотите интегрировать учетную запись Автоматизации в рабочее пространство Log Analytics, вы можете отсоединить свою учетную запись непосредственно с портала Azure.  Прежде чем продолжить, необходимо удалить описанные выше решения, иначе вы не сможете выполнить эту процедуру. Найдите в статье решение, которое вы импортировали, чтобы узнать, как его удалить.

Удалив эти решения, выполните следующие действия, чтобы отменить привязку учетной записи службы автоматизации.

> [!NOTE]
> Некоторые решения, в том числе решения для мониторинга Azure SQL более ранних версий, могли создать ресурсы службы автоматизации. Их также потребуется удалить, прежде чем удалить связь с рабочей областью.

1. На портале Azure откройте страницу своей учетной записи службы автоматизации и на этой странице выберите **Связанная рабочая область** в разделе с отметкой **Связанные ресурсы** слева.

2. На странице "Отмена связи с рабочей областью" нажмите кнопку **Отменить связь с рабочей областью**.

   ![Страница "Отмена связи с рабочей областью"](media/automation-onboard-solutions-from-automation-account/automation-unlink-workspace-blade.png).

   Появится запрос на продолжение действия.

3. Пока служба автоматизации Azure пытается отменить привязку учетной записи к рабочей области Log Analytics, вы можете отслеживать ход выполнения этой задачи в меню **Уведомления**.

Если вы используете решение управления обновлениями, при необходимости можно удалить следующие элементы, которые больше не нужны после удаления решения.

* Расписание обновлений - Каждый будет иметь имена, которые соответствуют созданным развертываниям обновлений.

* Гибридные рабочие группы, созданные для решения - Каждый будет назван так же, как machine1.contoso.com_9ceb8108-26c9-4051-b6b3-227600d715c8).

Если вы использовали действие запуска и (или) остановки виртуальных машин, когда решение не работало, может потребоваться удаление следующих элементов, которые больше не нужны после удаления решения.

* Расписание запуска и остановки виртуальной машины.
* Рабочие роли Runbook запуска и остановки виртуальной машины.
* Переменные

Кроме того, вы также можете отсоединить рабочее пространство из учетной записи автоматизации из рабочего пространства Log Analytics. В рабочем пространстве выберите **учетную запись автоматизации** под **соответствующими ресурсами.** На странице учетной записи автоматизации выберите **учетную запись Unlink.**

## <a name="clean-up-resources"></a>Очистка ресурсов

Чтобы удалить виртуальную машину для Управления обновлениями, необходимо сделать следующее.

* В рабочей области Log Analytics удалите виртуальную машину из сохраненных поисковых запросов конфигурации области `MicrosoftDefaultScopeConfig-Updates`. Сохраненные поисковые запросы хранятся на вкладке **Общие** рабочей области.
* Удалите [Microsoft Monitoring Agent](../azure-monitor/learn/quick-collect-windows-computer.md#clean-up-resources) или [Агент Log Analytics для Linux](../azure-monitor/learn/quick-collect-linux-computer.md#clean-up-resources).

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать, как использовать то или иное решение, ознакомьтесь с соответствующими руководствами.

* [Управление обновлениями Windows в службе автоматизации Azure](automation-tutorial-update-management.md)

* [Получение данных об установленном программном обеспечении на виртуальных машинах Azure и других компьютерах](automation-tutorial-installed-software.md)

* [Устранение неполадок при изменениях в среде](automation-tutorial-troubleshoot-changes.md)
