---
title: Обновление модулей Azure в службе автоматизации Azure
description: В этой статье описывается, как можно обновить общие модули Azure PowerShell, предоставленные по умолчанию в службе автоматизации Azure.
services: automation
ms.service: automation
ms.subservice: process-automation
author: georgewallace
ms.author: gwallace
ms.date: 03/11/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 03174e6336589f8aa49a7fc7197da1301ff54400
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "61304327"
---
# <a name="how-to-update-azure-powershell-modules-in-azure-automation"></a>Как обновить модули Azure PowerShell в службе автоматизации Azure

При обновлении модулей Azure в учетной записи службы автоматизации рекомендуется использовать [модуль runbook для обновления модулей Azure](https://github.com/Microsoft/AzureAutomation-Account-Modules-Update) (теперь предоставляется с открытым кодом). Кроме того, на портале по-прежнему доступна кнопка **Обновить модули Azure**. Чтобы узнать больше об использовании модуля runbook с открытым кодом, см. раздел [Обновление модулей Azure с помощью модуля runbook с открытым кодом](#open-source).

Наиболее распространенные модули Azure PowerShell приведены в каждой учетной записи автоматизации по умолчанию. Группа разработчиков Azure регулярно обновляет модули Azure. В учетной записи службы автоматизации мы предоставляем способ обновления модулей в учетной записи, когда на портале доступны новые версии.

Так как модули регулярно обновляются специалистами группы продуктов, то изменения могут затронуть и входящие в них командлеты. Данное действие может негативно повлиять на работу модулей Runbook. Это зависит от типа изменения. Например, возможно переименование параметра или полное прекращение поддержки командлета.

Чтобы избежать негативного влияния на модули Runbook и автоматизируемые ими процессы, выполните предварительное тестирование и проверку. Если у вас нет выделенной учетной записи службы автоматизации, предназначенной для этой цели, то рекомендуется ее создать, чтобы протестировать различные сценарии в процессе разработки модулей Runbook. Тестирование должно включать повторяющиеся изменения, такие как обновление модулей PowerShell. 

Если вы разрабатываете скрипты локально, при тестировании рекомендуется хранить локально те же версии модуля, которые доступны в вашей учетной записи службы автоматизации. Так вы гарантированно получите те же результаты. После проверки результатов и применения необходимых изменений можно перейти к процессу переноса их в рабочую среду.

> [!NOTE]
> Новая учетная запись службы автоматизации может не содержать последние модули.

## <a name="open-source"></a>Обновление модулей Azure с помощью модуля runbook с открытым кодом

Чтобы приступить к использованию модуля runbook **Update-AutomationAzureModulesForAccount** для обновления модулей Azure, скачайте его из [этого репозитория](https://github.com/Microsoft/AzureAutomation-Account-Modules-Update) на сайте GitHub. После этого вы сможете импортировать его в свою учетную запись службы автоматизации или выполнить в качестве скрипта. Соответствующие инструкции можно найти в [репозитории модуля runbook для обновления модулей Azure](https://github.com/Microsoft/AzureAutomation-Account-Modules-Update).

### <a name="considerations"></a>Рекомендации

Ниже приведены некоторые рекомендации по использованию этого процесса для обновления модулей Azure.

* Если вы импортируете этот модуль runbook с исходным именем `Update-AutomationAzureModulesForAccount`, он переопределит внутренний модуль runbook, которому будет присвоено это имя. В результате импортированный модуль runbook будет выполняться при нажатии кнопки **Обновить модули Azure** или при вызове этого модуля runbook напрямую через API Azure Resource Manager для этой учетной записи службы автоматизации.

* Этот модуль runbook поддерживает обновление только **Azure** и **AzureRm** модули в данный момент. [Модули Azure PowerShell Az](/powershell/azure/new-azureps-module-az) поддерживаются в учетных записях службы автоматизации, но не могут быть заменены этого модуля runbook.

* Не рекомендуется запускать этот модуль runbook в учетных записях службы автоматизации, которые содержат модули Az.

* Перед запуском этого модуля runbook убедитесь, что для вашей учетной записи службы автоматизации созданы [учетные данные для учетной записи запуска от имени Azure](manage-runas-account.md).

* Вы можете использовать этот код не как модуль runbook, а как обычный скрипт PowerShell: сначала войдите в Azure с помощью командлета [Connect-AzureRmAccount](/powershell/module/azurerm.profile/connect-azurermaccount), а затем передайте в скрипт параметр `-Login $false`.

* Если вы хотите выполнять этот модуль runbook в национальных облаках, используйте параметр `AzureRmEnvironment`, чтобы передать в модуль runbook нужную среду.  Приемлемые значения: **AzureCloud**, **AzureChinaCloud**, **AzureGermanCloud** и **AzureUSGovernment**. Эти значения можно получить с помощью командлета `Get-AzureRmEnvironment | select Name`. Если не передать значение этому параметру, модуль Runbook по умолчанию будет использовать общедоступное облако Azure **AzureCloud**.

* Если нужно использовать конкретную версию модуля Azure PowerShell вместо последней доступной в коллекции PowerShell, передайте эти версии в необязательном параметре `ModuleVersionOverrides` модуля runbook **Update-AutomationAzureModulesForAccount**. Примеры см. в модуле runbook [Update-AutomationAzureModulesForAccount.ps1](https://github.com/Microsoft/AzureAutomation-Account-Modules-Update/blob/master/Update-AutomationAzureModulesForAccount.ps1
). Модули Azure PowerShell, которые не упомянуты в параметре `ModuleVersionOverrides`, обновляются до последних версий из коллекции PowerShell. Если в параметр `ModuleVersionOverrides` не передано ничего, все модули обновляются последними версиями из коллекции PowerShell, как при нажатии кнопки **Обновить модули Azure**.

## <a name="update-azure-modules-in-the-azure-portal"></a>Обновление модулей Azure на портале Azure

1. На странице "Модули" вашей учетной записи службы автоматизации есть параметр **Обновить модули Azure**. Он всегда включен.<br><br> ![Параметр "Обновить модули Azure" на странице "Модули"](media/automation-update-azure-modules/automation-update-azure-modules-option.png)

   > [!NOTE]
   > Перед обновлением модулей Azure рекомендуется обновить их в тестовой учетной записи автоматизации. Это позволит до обновления убедиться в том, что существующие скрипты работают ожидаемым образом.
   >
   > Кнопка **Обновить модули Azure** доступна только в общедоступном облаке. Она недоступна в [независимых регионах](https://azure.microsoft.com/global-infrastructure/). Чтобы обновить модули Azure, воспользуйтесь модулем runbook **Update-AutomationAzureModulesForAccount**. Вы можете скачать его из [репозитория модуля runbook для обновления модулей Azure](https://github.com/Microsoft/AzureAutomation-Account-Modules-Update). Чтобы узнать больше об использовании модуля runbook с открытым кодом, см. раздел [Обновление модулей Azure с помощью модуля runbook с открытым кодом](#open-source).

2. Щелкните **Обновить модули Azure**, после чего появится уведомление с запросом о продолжении.<br><br> ![Уведомление об обновлении модулей Azure](media/automation-update-azure-modules/automation-update-azure-modules-popup.png)

3. Щелкните **Да**, чтобы начать процесс обновления модулей. Процесс обновления следующих модулей занимает около 15–20 минут:

   * Таблицы Azure
   * Azure.Storage;
   * AzureRm.Automation;
   * AzureRm.Compute;
   * AzureRm.Profile;
   * AzureRm.Resources;
   * AzureRm.Sql;
   * AzureRm.Storage.

     Если модули уже обновлены, процесс будет завершен через несколько секунд. После завершения процесса обновления вы получите уведомление.<br><br> ![Состояние обновления Update Azure Modules (Обновление модулей Azure)](media/automation-update-azure-modules/automation-update-azure-modules-updatestatus.png)

     Модули .NET Core AzureRm (AzureRm.*.Core) не поддерживаются в службе автоматизации Azure и не могут быть импортированы.

> [!NOTE]
> При запуске нового запланированного задания служба автоматизации Azure использует модули последней версии в вашей учетной записи службы автоматизации.  

При использовании командлетов из этих модулей Azure PowerShell в модулях runbook этот процесс обновления необходимо выполнять примерно каждый месяц, чтобы гарантировать наличие последних модулей. Служба автоматизации Azure использует подключение `AzureRunAsConnection` для проверки подлинности при обновлении модулей. Если срок действия субъекта-службы истек или он больше не существует на уровне подписки, обновление модуля завершится сбоем.

## <a name="known-issues"></a>Известные проблемы

Имеется известная проблема с обновлением модулей AzureRM в учетную запись службы автоматизации, который находится в группу ресурсов с помощью числовое имя, которое начинается с 0. Чтобы обновить модули Azure в учетной записи службы автоматизации, он должен быть в группе ресурсов с буквенно-цифровое имя. Группы ресурсов, числовой, имена которых начинаются с 0 — не удалось обновить модули AzureRM в данный момент.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения см. на странице [модуля runbook с открытым кодом для обновления модулей Azure](https://github.com/Microsoft/AzureAutomation-Account-Modules-Update).
