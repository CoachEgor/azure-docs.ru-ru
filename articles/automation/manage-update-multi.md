---
title: Управление обновлениями для нескольких виртуальных машин Azure
description: В этой статье описывается управление обновлениями для виртуальных машин Azure.
services: automation
ms.service: automation
ms.subservice: update-management
author: bobbytreed
ms.author: robreed
ms.date: 04/02/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 0a4990673479c913777a5a7c410460d3d3b31264
ms.sourcegitcommit: f811238c0d732deb1f0892fe7a20a26c993bc4fc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2019
ms.locfileid: "67478318"
---
# <a name="manage-updates-for-multiple-machines"></a>Управление обновлениями для нескольких виртуальных машин

С помощью решения по управлению обновлениями вы можете управлять обновлениями и исправлениями виртуальных машин Windows и Linux. В учетной записи [службы автоматизации Azure](automation-offering-get-started.md) вы можете сделать следующее:

- подключить виртуальные машины;
- оценить состояние доступных обновлений;
- запланировать установку необходимых обновлений;
- проверить результаты развертывания, чтобы убедиться, что обновления были успешно применены на всех виртуальных машинах, для которых включено управление обновлениями.

## <a name="prerequisites"></a>Технические условия

Чтобы использовать решение "Управление обновлениями", требуется:

- Виртуальная машина или компьютер, где установлена одна из поддерживаемых операционных систем.

## <a name="supported-operating-systems"></a>Поддерживаемые операционные системы

Решение управления обновлениями поддерживается в приведенных ниже операционных системах.

|Операционная система  |Примечания  |
|---------|---------|
|Windows Server 2008, Windows Server 2008 R2 RTM    | Поддерживает только оценки обновлений.         |
|Windows Server 2008 R2 с пакетом обновления 1 и более поздней версии     |Windows PowerShell, начиная с версии 4.0. ([Скачать WMF 4.0](https://www.microsoft.com/download/details.aspx?id=40855).)</br> Для повышения надежности рекомендуем использовать Windows PowerShell 5.1. ([Скачать WMF 5.1](https://www.microsoft.com/download/details.aspx?id=54616).)         |
|CentOS 6 (x86 или x64) и 7 (x64).      | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|Red Hat Enterprise 6 (x86 или x64) и 7 (x64).     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|SUSE Linux Enterprise Server 11 (x86 или x64) и 12 (x64)     | У агентов Linux должен быть доступ к репозиторию обновлений.        |
|Ubuntu 14.04 LTS, 16.04 LTS и 18.04 LTS (x86/x64)      |У агентов Linux должен быть доступ к репозиторию обновлений.         |

> [!NOTE]
> Чтобы обновления применялись только в период обслуживания в Ubuntu, повторно настройте пакет unattended-upgrades и отключите автоматическое обновление. Дополнительные сведения см. в разделе об [автоматических обновлениях руководства по Ubuntu Server](https://help.ubuntu.com/lts/serverguide/automatic-updates.html).

У агентов Linux должен быть доступ к репозиторию обновлений.

Это решение не поддерживает агент Log Analytics для Linux, в котором настроена отправка отчетов в несколько рабочих областей Azure Log Analytics.

## <a name="enable-update-management-for-azure-virtual-machines"></a>Включение управления обновлениями для виртуальных машин Azure

На портале Azure откройте учетную запись службы автоматизации и выберите **Управление обновлениями**.

Выберите **Добавить виртуальные машины Azure**.

![Вкладка "Добавить виртуальную машину Azure"](./media/manage-update-multi/update-onboard-vm.png)

Выберите виртуальную машину для подключения. 

В разделе **Включение управления обновлениями** нажмите кнопку **Включить**, чтобы подключить виртуальную машину.

![Диалоговое окно "Включение управления обновлениями"](./media/manage-update-multi/update-enable.png)

После подключения управление обновлениями будет включено для виртуальной машины.

## <a name="enable-update-management-for-non-azure-virtual-machines-and-computers"></a>Включение управления обновлениями для виртуальных машин Azure и компьютеров

Чтобы узнать, как включить управление обновлениями для компьютеров и виртуальных машин Windows, отличных от Azure, см. в разделе [компьютеров Windows подключаться к службе Azure Monitor в Azure](../log-analytics/log-analytics-windows-agent.md).

Чтобы узнать, как включить управление обновлениями для компьютеров и виртуальных машин Azure Linux, см. в разделе [подключение компьютеров Linux к Azure Monitor журналы](../log-analytics/log-analytics-agent-linux.md).

## <a name="view-computers-attached-to-your-automation-account"></a>Просмотр сведений о компьютерах, подключенных к учетной записи службы автоматизации

Включив управление обновлениями для компьютеров, можно просмотреть сведения о них, нажав кнопку **Компьютеры**. Это такие сведения, как *имя компьютера*, *состояние соответствия*, *среда*, *тип ОС*, *установленные критически важные обновления и обновления для системы безопасности*, *другие установленные обновления* и *состояние готовности к обновлению агента*.

  ![Просмотр вкладки "Компьютеры"](./media/manage-update-multi/update-computers-tab.png)

Если управление обновлениями недавно включено для компьютеров, возможно, они еще не оценивались. Для таких компьютеров будет отображаться состояние соответствия **Без оценки**. Вот список возможных значений состояния соответствия:

- **Соответствует**: компьютеры, на которых установлены все критически важные обновления и обновления для системы безопасности.

- **Не соответствует**: компьютеры, на которых отсутствует как минимум одно критически важное обновление или обновление для системы безопасности.

- **Без оценки**: данные оценки обновления не были получены от компьютера в течение ожидаемого отрезка времени. Для компьютеров Linux период времени ожидания является за последний час. Для компьютеров Windows это последние 12 часов.

Чтобы просмотреть состояние агента, перейдите по ссылке в столбце **Готовность к обновлению агента**. Откроется область **гибридной рабочей роли** со сведениями о состоянии этой роли. Ниже приведен пример агента, который долгое время не был подключен к решению "Управление обновлениями".

![Просмотр вкладки "Компьютеры"](./media/manage-update-multi/update-agent-broken.png)

## <a name="view-an-update-assessment"></a>Просмотр оценки обновлений

После включения решения "Управление обновлениями" отобразится панель **Управление обновлениями**. На вкладке **Отсутствующие обновления** можно просмотреть список отсутствующих обновлений.

## <a name="collect-data"></a>Сбор данных

Агенты, установленные на виртуальных машинах и компьютерах, собирают данные об обновлениях и отправляют их в решение управления обновлениями Azure.

### <a name="supported-agents"></a>Поддерживаемые агенты

В приведенной ниже таблице описаны подключенные источники, которые поддерживает это решение.

| Подключенный источник | Поддерживаются | Описание |
| --- | --- | --- |
| Агенты Windows |Да |Решение управления обновлениями собирает сведения об обновлениях системы с агентов Windows и запускает установку требуемых обновлений. |
| Агенты Linux |Да |Решение управления обновлениями собирает сведения об обновлениях системы с агентов Linux и запускает установку требуемых обновлений для поддерживаемых дистрибутивов. |
| Группа управления Operations Manager |Да |Решение управления обновлениями собирает сведения о системных обновлениях с агентов, состоящих в подключенной группе управления. |
| Учетная запись хранения Azure |Нет |В службе хранилища Azure не хранятся сведения о системных обновлениях. |

### <a name="collection-frequency"></a>Частота сбора

По завершении сканирования на предмет соответствия обновлений компьютера, агент переадресовывает сведения в пакетном режиме журналы Azure Monitor. На компьютере с Windows проверка на соответствие по умолчанию выполняется каждые 12 часов.

Помимо расписания проверки в течение 15 минут после перезапуска MMA запускается проверка на соответствие обновлений. Это происходит перед установкой обновления и после нее.

Для компьютера Linux проверка на соответствия по умолчанию выполняется каждый час. При перезапуске агента MMA проверка соответствия инициируется в течение 15 минут.

Отображение обновленных данных с управляемых компьютеров на панели мониторинга может занять от 30 минут до 6 часов.

## <a name="schedule-an-update-deployment"></a>Планирование развертывания обновлений

Чтобы установить обновления, составьте план развертывания в рамках графика выпуска и периода обслуживания. Вы можете выбрать типы обновлений, которые будут включены в развертывание. Например, можно включить только критические обновления или обновления для системы безопасности и исключить накопительные пакеты обновления.

Новое развертывание обновления для одной или нескольких виртуальных машин можно запланировать, щелкнув **Запланировать развертывание обновлений** в разделе **Управление обновлениями**.

В области **Новое развертывание обновления** укажите следующие сведения:

- **Имя**. Введите уникальное имя для идентификации развертывания обновлений.
- **Операционная система**. Выберите **Windows** или **Linux**.
- **Группы для обновления (предварительная версия)** . Определите запрос на основе сочетания подписки, группы ресурсов, расположения и тегов для создания динамической группы виртуальных машин Azure, чтобы включить в развертывание. Дополнительные сведения о [динамических группах](automation-update-management.md#using-dynamic-groups).
- **Компьютеры, на которые нужно установить обновления**. Выберите "Сохраненные поисковые запросы", группу "Импортировано" или выберите "Компьютеры", чтобы выбрать компьютеры, которые требуется обновить. Если выберете **Компьютеры**, готовность к обновлению будет показана в столбце **Готовность к обновлению агента**. Вы можете просмотреть состояние работоспособности компьютера перед планированием развертывания обновлений. Дополнительные сведения о различных способах создания групп компьютеров в журналах Azure Monitor см. в статье [Группы компьютеров в запросах к журналам Azure Monitor](../azure-monitor/platform/computer-groups.md).

  ![Область "Новое развертывание обновления"](./media/manage-update-multi/update-select-computers.png)

- **Классификации обновлений**. Выберите типы программного обеспечения, которые будут включены в развертывание обновления. Описание типов классификации обновлений см. в этом [разделе](automation-update-management.md#update-classifications). Ниже приведены типы классификации:
  - критические обновления;
  - обновления для системы безопасности;
  - накопительные пакеты обновления;
  - пакеты дополнительных компонентов;
  - пакеты обновления;
  - обновления определений;
  - Средства
  - Обновления

- **Обновления для включения или исключения**. После этого откроется страница **включения и исключения**. Обновления, которые можно включить или исключить, находятся на отдельных вкладках. Дополнительные сведения об обработке исключений см. в разделе о [поведении включения](automation-update-management.md#inclusion-behavior).

- **Параметры расписания**. Вы можете принять дату и время по умолчанию (на 30 минут позже текущего времени) либо указать другое время.

   Кроме того, можно указать, происходит ли развертывание один раз или повторяется по расписанию. Чтобы настроить регулярное расписание, в разделе **Повторение** щелкните параметр **Повторяющееся**.

   ![Диалоговое окно "Параметры расписания"](./media/manage-update-multi/update-set-schedule.png)

- **Сценарии предварительного и последующего выполнения**. Выберите сценарии, которые будут выполняться до и после развертывания. Дополнительные сведения см. в статье [Управление сценариями предварительного и последующего выполнения (предварительная версия)](pre-post-scripts.md).
- **Период обслуживания (минуты)** . Укажите период времени, в течение которого произойдет обновление развертывания. Этот параметр позволяет гарантировать, что изменения выполняются в рамках заданного периода обслуживания.

- **Управление перезагрузкой**. Этот параметр определяет способ обработки для развертывания обновлений после перезагрузки.

   |Параметр|Описание|
   |---|---|
   |Перезагрузка при необходимости| **(По умолчанию)** . Перезагрузка запускается при необходимости, если позволяет окно обслуживания.|
   |Всегда выполнять перезагрузку|Перезагрузка запускается независимо от того, требуется ли она. |
   |Никогда не перезагружать|Независимо от того, требуется ли перезагрузка, перезагрузки сбрасываются.|
   |Только перезагрузка без установки обновлений.|Этот параметр игнорирует установку обновлений, а только запускает перезагрузку.|

Завершив настройку расписания, нажмите кнопку **Создать**, чтобы вернуться к панели мониторинга состояния. В таблице **Запланированные** отобразится созданное расписание развертываний.

> [!NOTE]
> Управление обновлениями поддерживает развертывание обновлений из Центра обновлений Windows и предварительное скачивание исправлений. Для этого необходимо внести изменения в исправляемые системы. Просмотрите [этот раздел](automation-update-management.md#firstparty-predownload), чтобы узнать, как настроить эти параметры в своих системах.

## <a name="view-results-of-an-update-deployment"></a>Просмотр результатов развертывания обновлений

После запуска запланированного развертывания можно контролировать его состояние на вкладке **Развертывания обновлений** раздела **Управление обновлениями**.

Если развертывание выполняется в этот момент, отображается состояние **Выполняется**. Когда развертывание успешно завершится, состояние изменится на **Успешно**.

В случае сбоя одного или нескольких обновлений при развертывании для состояния отобразится значение **Частичный сбой**.

![Состояние обновления развертывания](./media/manage-update-multi/update-view-results.png)

Щелкните завершенное развертывание обновлений, чтобы просмотреть панель мониторинга этого развертывания.

В области **Результаты обновления** отображаются общее количество обновлений и результаты развертывания на виртуальной машине. В таблице справа представлен подробный разбор каждого обновления и результатов установки. Результаты установки могут принимать одно из следующих значений:

- **Попытка не предпринималась**. Обновление не установлено из-за недостатка времени в соответствии с заданным периодом обслуживания.
- **Успешно**. Обновление выполнено.
- **Сбой**. Обновление не выполнено.

Чтобы просмотреть все записи журнала, созданные при развертывании, щелкните **Все журналы**.

Щелкните плитку "Выходные данные", чтобы просмотреть поток заданий модуля runbook, который управляет развертыванием обновления на целевой виртуальной машине.

Чтобы просмотреть подробные сведения об ошибках развертывания, щелкните **Ошибки**.

## <a name="next-steps"></a>Дальнейшие действия

- Дополнительные сведения об управлении обновлениями, включая журналы, выходные данные и ошибки, см. в статье [Решение для управления обновлениями в Azure](../operations-management-suite/oms-solution-update-management.md).

