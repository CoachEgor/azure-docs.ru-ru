---
title: Подключение решений "Управление обновлениями", "Отслеживание изменений" и "Инвентаризация" на виртуальной машине Azure
description: Сведения о том, как на виртуальной машине Azure подключить решения "Управление обновлениями", "Отслеживание изменений" и "Инвентаризация", входящие в состав службы автоматизации Azure.
services: automation
author: georgewallace
ms.author: gwallace
ms.date: 03/20/2019
ms.topic: conceptual
ms.service: automation
ms.custom: mvc
manager: carmonm
ms.openlocfilehash: 38b5b233d21c0c5d79d7bcb6a145e6232b238b0e
ms.sourcegitcommit: 778e7376853b69bbd5455ad260d2dc17109d05c1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/23/2019
ms.locfileid: "66133123"
---
# <a name="onboard-update-management-change-tracking-and-inventory-solutions-from-an-azure-virtual-machine"></a>Подключение решений "Управление обновлениями", "Отслеживание изменений" и "Инвентаризация" на виртуальной машине Azure

Служба автоматизации Azure предоставляет решения для управления обновлениями безопасности операционной системы, отслеживания изменений и инвентаризации компонентов, установленных на компьютерах. Подключить решения на виртуальных машинах можно несколькими способами. Вы можете подключить решение на одной виртуальной машине, [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md), в [учетной записи службы автоматизации](automation-onboard-solutions-from-automation-account.md) или с помощью [модуля runbook](automation-onboard-solutions.md). В этой статье описано, как подключать такие решения на виртуальной машине Azure.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу https://portal.azure.com.

## <a name="enable-the-solutions"></a>Включение решений

Перейдите к существующей виртуальное машине. В разделе **Операции** выберите **Управление обновлениями**, **Инвентаризация** или **Отслеживание изменений**. Виртуальная машина может существовать в любом регионе независимо от того, расположение учетной записи службы автоматизации. При адаптации решения из виртуальной Машины необходимо иметь `Microsoft.OperationalInsights/workspaces/read` разрешение, чтобы определить, является ли виртуальная машина подключена к рабочей области. Дополнительные сведения о дополнительных разрешений, которые необходимы в целом, см. в разделе [разрешения, необходимые для подключения решений на компьютерах](automation-role-based-access-control.md#onboarding).

Чтобы включить решение только для одной виртуальной машины, выберите параметр **Включить для этой виртуальной машины**. Чтобы включить решение для нескольких виртуальных машин, выберите **Включить для виртуальных машин в этой подписке** и **Щелкните здесь, чтобы выбрать включаемые компьютеры**. Сведения о том, как включить решения для нескольких виртуальных машин, см. в статье [Подключение решений для управления обновлениями, отслеживания изменений и инвентаризации](automation-onboard-solutions-from-automation-account.md).

Чтобы включить решение, выберите рабочую область Azure Log Analytics и учетную запись службы автоматизации, а затем щелкните **Включить**. Процесс включения решения может занять до 15 минут.

![Включение решения "Управление обновлениями"](media/automation-onboard-solutions-from-vm/onboard-solution.png)

Перейти к другим решениям и нажмите кнопку **Включить**. Рабочая область Log Analytics и раскрывающиеся списки для учетной записи службы автоматизации отключены, так как эти решения использовать одну рабочую область и учетная запись службы автоматизации в качестве ранее включенном решении.

> [!NOTE]
> Для **отслеживания изменений** и **инвентаризации** используется одно и то же решение. При включении одного параметра включается и другой.

## <a name="scope-configuration"></a>Конфигурация области

В каждом решении используется конфигурация области в пределах рабочей области для определения целевых компьютеров, на которых будет внедрено решение. Конфигурация области представляет собой группу из одного или нескольких сохраненных поисковых запросов, используемых для ограничения области применения решения к конкретным компьютерам. Чтобы получить доступ к конфигурациям области, в учетной записи службы автоматизации в разделе **Связанные ресурсы** выберите **Рабочая область**. В рабочей области в разделе **Источники данных рабочей области** выберите **Конфигурации области**.

Если в выбранной рабочей области еще нет решений "Управление обновлениями" или "Отслеживание изменений", создаются следующие конфигурации области:

* **MicrosoftDefaultScopeConfig-ChangeTracking**;

* **MicrosoftDefaultScopeConfig-Updates**.

Если в выбранной рабочей области уже есть решение, то оно не развертывается повторно и конфигурация области не добавляется.

Нажмите кнопку с многоточием (**…**) для любой из конфигураций и выберите **Изменить**. В области **Изменение конфигурации области** щелкните **Выбрать группу компьютеров**. На панели **Группы компьютеров** отображаются сохраненные поисковые запросы, которые используются для создания конфигурации области.

## <a name="saved-searches"></a>Сохраненные поисковые запросы

При добавлении компьютера в решениях "Управление обновлениями" или "Отслеживание изменений" и "Инвентаризация" он добавляется в один из двух сохраненных поисковых запросов в рабочей области. Сохраненные поисковые запросы содержат данные о компьютерах, которым будут назначены соответствующие решения.

Перейдите в рабочую область. В разделе **Общие** выберите **Сохраненные поисковые запросы**. Два сохраненных поисковых запроса, используемые в этих решениях, показаны в следующей таблице:

|ИМЯ     |Категория  |Alias  |
|---------|---------|---------|
|MicrosoftDefaultComputerGroup     |  ChangeTracking       | ChangeTracking__MicrosoftDefaultComputerGroup        |
|MicrosoftDefaultComputerGroup     | Обновления        | Updates__MicrosoftDefaultComputerGroup         |

Выберите один из сохраненных поисковых запросов, чтобы просмотреть запрос, используемый для заполнения группы. На следующем рисунке показан запрос и его результаты:

![Сохраненные поисковые запросы](media/automation-onboard-solutions-from-vm/logsearch.png)

## <a name="unlink-workspace"></a>Удаление связи с рабочей областью

Следующие решения зависят от рабочей области Log Analytics:

* [Управление обновлениями](automation-update-management.md)
* [Отслеживание изменений](automation-change-tracking.md)
* [Запуск и остановка виртуальных машин в нерабочее время](automation-solution-vm-management.md)

Если вы решили, что больше не требуется интеграция учетной записи службы автоматизации с рабочей областью Log Analytics, вы можете отменить привязку учетной записи непосредственно с портала Azure.  Прежде чем продолжить, необходимо удалить решения, которые упоминались ранее. Иначе вы не сможете выполнить эту процедуру. Найдите в статье решение, которое вы импортировали, чтобы узнать, как его удалить.

Удалив эти решения, выполните следующие действия, чтобы отменить привязку учетной записи службы автоматизации.

> [!NOTE]
> Некоторые решения, в том числе решения для мониторинга Azure SQL более ранних версий, могли создать ресурсы службы автоматизации. Их также потребуется удалить, прежде чем удалить связь с рабочей областью.

1. На портале Azure откройте свою учетную запись службы автоматизации и на странице этой учетной записи выберите **Связанная рабочая область** в разделе **Связанные ресурсы** слева.

2. На странице "Отмена связи с рабочей областью" нажмите кнопку **Отменить связь с рабочей областью**.

   ![Страница "Отмена связи с рабочей областью"](media/automation-onboard-solutions-from-vm/automation-unlink-workspace-blade.png).

   Появится запрос на подтверждение удаления.

3. Пока служба автоматизации Azure пытается отменить привязку учетной записи к рабочей области Log Analytics, вы можете отслеживать ход выполнения этой задачи в меню **Уведомления**.

Если вы используете решение управления обновлениями, при необходимости можно удалить следующие элементы, которые больше не нужны после удаления решения.

* Обновление расписаний. Каждый элемент имеет имя, которое соответствует созданному вами развертыванию обновления.

* Группы гибридных рабочих ролей, созданные для решения. Каждая группа будет иметь приблизительно такое имя: machine1.contoso.com_9ceb8108-26c9-4051-b6b3-227600d715c8.

Если вы используете решение запуска и остановки виртуальных машин в нерабочее время, при необходимости можно удалить следующие элементы, которые больше не нужны после удаления решения.

* Расписание запуска и остановки виртуальной машины.
* Рабочие роли Runbook запуска и остановки виртуальной машины.
* Переменные

В качестве альтернативы можно также удалить связь рабочей области из учетной записи службы автоматизации из рабочей области Log Analytics. В рабочей области, выберите **учетной записи службы автоматизации** под **связанные ресурсы**. На странице учетной записи службы автоматизации выберите **отменить привязку учетной записи**.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы узнать, как использовать то или иное решение, ознакомьтесь с соответствующими руководствами:

* [Управление обновлениями Windows при помощи службы автоматизации Azure](automation-tutorial-update-management.md)
* [Получение данных об установленном программном обеспечении на виртуальных машинах Azure и других компьютерах](automation-tutorial-installed-software.md)
* [Устранение неполадок при изменениях в среде](automation-tutorial-troubleshoot-changes.md)
