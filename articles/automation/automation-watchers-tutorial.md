---
title: Создание задачи наблюдателя в учетной записи службы автоматизации Azure
description: Узнайте, как создать задачу наблюдателя в учетной записи службы автоматизации Azure, чтобы отслеживать создание файлов в папке.
services: automation
ms.subservice: process-automation
ms.topic: conceptual
ms.date: 10/30/2018
ms.openlocfilehash: 1175350e7f9f4db92d7d59eba0cc66ac4bb49f5f
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81617351"
---
# <a name="create-an-azure-automation-watcher-tasks-to-track-file-changes-on-a-local-machine"></a>Создание задач службы "Наблюдатель за автоматизацией Azure" для отслеживания изменений файлов на локальном компьютере

Служба автоматизации Azure использует задачу наблюдателя для поиска событий и запуска действий с помощью модулей Runbook PowerShell. Задача наблюдателя содержит две части: наблюдатель и действие. Модуль Runbook наблюдателя запускается с интервалом, определенным в задаче "наблюдатель", и выводит данные в Runbook действия. 

В этом руководстве пошагово описывается создание задачи службы "Наблюдатель" для отслеживания добавления новых файлов в каталог. Вы научитесь:

> [!div class="checklist"]
> * Импорт runbook службы "Наблюдатель"
> * Создание переменной службы автоматизации
> * Создание runbook действия
> * Создание задачи службы "Наблюдатель"
> * Активация службы "Наблюдатель"
> * Изучение выходных данных

## <a name="prerequisites"></a>Предварительные требования

Ниже перечислены необходимые условия для выполнения инструкций из этого руководства.

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для хранения runbook наблюдателя, runbook действия и задачи наблюдателя.
* [Гибридная рабочая роль runbook](automation-hybrid-runbook-worker.md), в которой выполняется задача наблюдателя.
* Модули Runbook PowerShell. Модули Runbook рабочего процесса PowerShell не поддерживаются задачами наблюдателя.

> [!NOTE]
> Задачи наблюдателя не поддерживаются в Azure для Китая.

## <a name="import-a-watcher-runbook"></a>Импорт runbook службы "Наблюдатель"

В этом руководстве для поиска новых файлов в каталоге используется runbook службы "Наблюдатель" **Watch-NewFile**. Runbook службы "Наблюдатель" получает время последней записи в файлы в папке и ищет файлы, для которых это значение не превышает заданный предел.

Этот процесс импорта можно выполнить с помощью [коллекция PowerShell](https://www.powershellgallery.com).

1. Перейдите на страницу коллекции для [ватч-невфиле. ps1](https://gallery.technet.microsoft.com/scriptcenter/Watcher-runbook-that-looks-36fc82cd).
2. На вкладке Служба **автоматизации Azure** щелкните **развернуть в службе автоматизации Azure**.

Вы также можете импортировать этот модуль Runbook в учетную запись службы автоматизации на портале, выполнив следующие действия.

1. Откройте учетную запись службы автоматизации и щелкните на странице Модули Runbook.
2. Щелкните **Обзор коллекции**.
3. Найдите **модуль Runbook наблюдателя**, выберите **модуль Runbook наблюдателя, который ищет новые файлы в каталоге**, и нажмите кнопку **Импорт**.
  ![Импорт runbook службы автоматизации с помощью пользовательского интерфейса](media/automation-watchers-tutorial/importsourcewatcher.png)
4. Присвойте Runbook имя и описание и нажмите кнопку **ОК** , чтобы импортировать модуль Runbook в учетную запись службы автоматизации.
5. Щелкните **Изменить**, затем щелкните **Опубликовать**. При появлении запроса нажмите кнопку **Да** , чтобы опубликовать модуль Runbook.

## <a name="create-an-automation-variable"></a>Создание переменной службы автоматизации

[Переменная службы автоматизации](automation-variables.md) используется для хранения меток времени, которые приведенный выше runbook считывает из каждого файла и сохраняет.

1. Выберите **переменные** в разделе **Общие ресурсы** и щелкните **+ Добавить переменную**.
1. Введите Watch-NewFileTimestamp в поле имя.
1. Выберите значение DateTime для типа.
1. Нажмите кнопку **создать** , чтобы создать переменную автоматизации.

## <a name="create-an-action-runbook"></a>Создание runbook действия

Runbook действия используется в задаче службы "Наблюдатель" для работы с данными, передаваемыми в нее из runbook службы "Наблюдатель". Необходимо импортировать предопределенный Runbook действия **Process-NewFile** из [коллекция PowerShell](https://www.powershellgallery.com). 

Создание Runbook действия.

1. Перейдите на страницу коллекции для [процесс-невфиле. ps1](https://gallery.technet.microsoft.com/scriptcenter/Watcher-action-that-b4ff7cdf).
2. На вкладке Служба **автоматизации Azure** щелкните **развернуть в службе автоматизации Azure**.

Этот модуль Runbook также можно импортировать в учетную запись службы автоматизации из портал Azure:

1. Перейдите к учетной записи службы автоматизации и выберите **модули Runbook** в разделе **Автоматизация процессов**.
1. Щелкните **Обзор коллекции**.
1. Найдите **действие наблюдателя**, выберите **действие наблюдателя, которое обрабатывает события, активируемые модулем Runbook наблюдателя**, и нажмите кнопку **Импорт**.
  ![Импорт runbook действия с помощью пользовательского интерфейса](media/automation-watchers-tutorial/importsourceaction.png)
1. Присвойте Runbook имя и описание и нажмите кнопку **ОК** , чтобы импортировать модуль Runbook в учетную запись службы автоматизации.
1. Щелкните **Изменить**, затем щелкните **Опубликовать**. При появлении запроса нажмите кнопку **Да** , чтобы опубликовать модуль Runbook.

## <a name="create-a-watcher-task"></a>Создание задачи службы "Наблюдатель"

На этом шаге вы настроите задачу наблюдателя, ссылающуюся на наблюдателя и модули Runbook действий, определенные в предыдущих разделах.

1. Перейдите к учетной записи службы автоматизации и выберите **Задачи наблюдателя** в разделе **Автоматизация процессов**.
1. Выберите страницу задачи наблюдателя и щелкните **+ Добавить задачу наблюдателя**.
1. Введите **WatchMyFolder** в качестве имени.

1. Выберите **Настройка наблюдателя** и щелкните Runbook **Watch-NewFile** .

1. Введите следующие значения параметров.

   * **FOLDERPATH** — папка в гибридной рабочей роли Runbook, в которой создаются новые файлы, например **д:\ексамплефилес**.
   * **Расширение — расширение** для конфигурации. Оставьте поле пустым, чтобы обрабатывались все расширения файлов.
   * **Рекурсивная** операция. Оставьте это значение по умолчанию.
   * **Параметры запуска** — Настройка для запуска модуля Runbook. Выберите гибридную рабочую роль.

1. Нажмите кнопку **ОК**, а затем **выберите** , чтобы вернуться на страницу наблюдателя.
1. Выберите **Настройка действия** и выберите Runbook **Process-NewFile** .
1. Введите следующие значения параметров.

   * **EVENTDATA** — данные событий. Не указывайте. Данные передаются из runbook наблюдателя.
   * **Параметры запуска** — Настройка для запуска модуля Runbook. Оставьте это в Azure, так как Runbook выполняется в службе автоматизации Azure.

1. Нажмите кнопку **ОК**, а затем **выберите** , чтобы вернуться на страницу наблюдателя.
1. Нажмите кнопку **ОК** , чтобы создать задачу наблюдателя.

![Настройка действия службы "Наблюдатель" с помощью пользовательского интерфейса](media/automation-watchers-tutorial/watchertaskcreation.png)

## <a name="trigger-a-watcher"></a>Активация службы "Наблюдатель"

Необходимо выполнить тест, как описано ниже, чтобы убедиться, что задача наблюдателя работает должным образом. 

1. Удаленно в гибридную рабочую роль Runbook. 
2. Откройте **PowerShell** и создайте тестовый файл в папке.

```azurepowerShell-interactive
New-Item -Name ExampleFile1.txt
```

В следующем примере показаны ожидаемые выходные данные.

```output
    Directory: D:\examplefiles


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       12/11/2017   9:05 PM              0 ExampleFile1.txt
```

## <a name="inspect-the-output"></a>Изучение выходных данных

1. Перейдите к учетной записи службы автоматизации и выберите **Задачи наблюдателя** в разделе **Автоматизация процессов**.
1. Выберите задачу наблюдателя **WatchMyFolder**.
1. Щелкните **Просмотр потоков наблюдателя** в разделе **потоки** , чтобы увидеть, что наблюдатель нашел новый файл и запустил Runbook действия.
1. Чтобы просмотреть задания Runbook действия, щелкните **Просмотреть задания действия наблюдателя**. Для просмотра сведений о задании можно выбрать каждое задание.

   ![Задания действия службы "Наблюдатель" в пользовательском интерфейсе](media/automation-watchers-tutorial/WatcherActionJobs.png)

Ожидаемые выходные данные при обнаружении нового файла можно увидеть в следующем примере.

```output
Message is Process new file...

Passed in data is @{FileName=D:\examplefiles\ExampleFile1.txt; Length=0}
```

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Импорт runbook службы "Наблюдатель"
> * Создание переменной службы автоматизации
> * Создание runbook действия
> * Создание задачи службы "Наблюдатель"
> * Активация службы "Наблюдатель"
> * Изучение выходных данных

Перейдите по ссылке для получения дополнительных сведений о создании собственного runbook.

> [!div class="nextstepaction"]
> [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-powershell.md).

