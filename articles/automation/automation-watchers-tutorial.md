---
title: Создание задачи наблюдателя в учетной записи службы автоматизации Azure
description: Узнайте, как создать задачу наблюдателя в учетной записи службы автоматизации Azure, чтобы отслеживать создание файлов в папке.
services: automation
ms.subservice: process-automation
ms.topic: conceptual
ms.date: 10/30/2018
ms.openlocfilehash: 1175350e7f9f4db92d7d59eba0cc66ac4bb49f5f
ms.sourcegitcommit: eefb0f30426a138366a9d405dacdb61330df65e7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81617351"
---
# <a name="create-an-azure-automation-watcher-tasks-to-track-file-changes-on-a-local-machine"></a>Создание задач службы "Наблюдатель за автоматизацией Azure" для отслеживания изменений файлов на локальном компьютере

Azure Automation использует задачу наблюдения для поиска событий и запуска действий с помощью runbooks PowerShell. Задача наблюдателя состоит из двух частей: наблюдателя и действия. Запуск watcher работает с интервалом, определенным в задаче наблюдателя, и выводит данные в запуск действия. 

В этом руководстве пошагово описывается создание задачи службы "Наблюдатель" для отслеживания добавления новых файлов в каталог. Вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Импорт runbook службы "Наблюдатель"
> * Создание переменной службы автоматизации
> * Создание runbook действия
> * Создание задачи службы "Наблюдатель"
> * Активация службы "Наблюдатель"
> * Изучение выходных данных

## <a name="prerequisites"></a>Предварительные требования

Ниже перечислены необходимые условия для выполнения инструкций из этого руководства.

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для хранения runbook наблюдателя, runbook действия и задачи наблюдателя.
* [Гибридная рабочая роль runbook](automation-hybrid-runbook-worker.md), в которой выполняется задача наблюдателя.
* Книги PowerShell. Runbooks Workflow PowerShell не поддерживаются задачами наблюдения.

> [!NOTE]
> Задачи наблюдения не поддерживаются в Azure China.

## <a name="import-a-watcher-runbook"></a>Импорт runbook службы "Наблюдатель"

В этом руководстве для поиска новых файлов в каталоге используется runbook службы "Наблюдатель" **Watch-NewFile**. Runbook службы "Наблюдатель" получает время последней записи в файлы в папке и ищет файлы, для которых это значение не превышает заданный предел.

Этот процесс импорта может быть сделано через [powerShell Галерея](https://www.powershellgallery.com).

1. Перейдите на страницу галереи [для Watch-NewFile.ps1](https://gallery.technet.microsoft.com/scriptcenter/Watcher-runbook-that-looks-36fc82cd).
2. Под вкладкой **Azure Automation** нажмите **«Развертывание в Автоматизации Azure».**

Вы также можете импортировать этот runbook в свой аккаунт автоматизации с портала, используя следующие шаги.

1. Откройте учетную запись службы автоматизации и щелкните на странице Модули Runbook.
2. Нажмите **Просмотр галереи**.
3. Поиск **Watcher runbook**, выберите **Watcher runbook, который ищет новые файлы в каталоге,** и нажмите **Импорт**.
  ![Импорт runbook службы автоматизации с помощью пользовательского интерфейса](media/automation-watchers-tutorial/importsourcewatcher.png)
4. Дайте Runbook имя и описание и нажмите **OK,** чтобы импортировать runbook в свой аккаунт автоматизации.
5. Щелкните **Изменить**, затем щелкните **Опубликовать**. При запросе нажмите **«Да»,** чтобы опубликовать книгу.

## <a name="create-an-automation-variable"></a>Создание переменной службы автоматизации

[Переменная службы автоматизации](automation-variables.md) используется для хранения меток времени, которые приведенный выше runbook считывает из каждого файла и сохраняет.

1. Выберите **переменные** под **общими ресурсами** и нажмите **кнопку и добавьте переменную**.
1. Введите Watch-NewFileTimestamp для названия.
1. Выберите DateTime для типа.
1. Нажмите **Создать** для создания переменной автоматизации.

## <a name="create-an-action-runbook"></a>Создание runbook действия

Runbook действия используется в задаче службы "Наблюдатель" для работы с данными, передаваемыми в нее из runbook службы "Наблюдатель". Вы должны импортировать предопределенный запуск действий под названием **Process-NewFile** из [галереи PowerShell.](https://www.powershellgallery.com) 

Для создания запуска действия:

1. Перейдите на страницу галереи для [Process-NewFile.ps1](https://gallery.technet.microsoft.com/scriptcenter/Watcher-action-that-b4ff7cdf).
2. Под вкладкой **Azure Automation** нажмите **«Развертывание в Автоматизации Azure».**

Вы также можете импортировать этот сборник в свою учетную запись Автоматизации с портала Azure:

1. Перейдите к учетной записи автоматизации и выберите **Runbooks** под **автоматизацией процессов.**
1. Нажмите **Просмотр галереи**.
1. Поиск **действий Watcher,** выберите **действие Watcher, которое обрабатывает события, вызванные runbook наблюдателя,** и нажмите **«Импорт».**
  ![Импорт runbook действия с помощью пользовательского интерфейса](media/automation-watchers-tutorial/importsourceaction.png)
1. Дайте Runbook имя и описание и нажмите **OK,** чтобы импортировать runbook в свой аккаунт автоматизации.
1. Щелкните **Изменить**, затем щелкните **Опубликовать**. При запросе нажмите **«Да»,** чтобы опубликовать книгу.

## <a name="create-a-watcher-task"></a>Создание задачи службы "Наблюдатель"

На этом этапе вы настраиваете задачу наблюдателя, ссылаясь на часы наблюдения и запуски действий, определенные в предыдущих разделах.

1. Перейдите к учетной записи Автоматизации и выберите **задачи Watcher** в рамках **автоматизации процессов.**
1. Выберите страницу задач Watcher и нажмите **кнопку «Добавить задачу наблюдателя».**
1. Введите **WatchMyFolder** в качестве имени.

1. Выберите **наверстывание наблюдателя** и выберите runbook **Watch-NewFile.**

1. Введите следующие значения параметров.

   * **FOLDERPATH** - Папка на гибридном Runbook Worker, где создаются новые файлы, например, **d:'examplefiles**.
   * **EXTENSION** - Расширение для конфигурации. Оставьте поле пустым, чтобы обрабатывались все расширения файлов.
   * **RECURSE** - Рекурсивная операция. Оставьте это значение как значение по умолчанию.
   * **RUN SETTINGS** - Настройка для запуска runbook. Выберите гибридную рабочую роль.

1. Нажмите **OK,** а затем **выберите,** чтобы вернуться на страницу Watcher.
1. Выберите **действие настройки** и выберите runbook **Process-NewFile.**
1. Введите следующие значения параметров.

   * **EVENTDATA** - Данные событий. Не указывайте. Данные передаются из runbook наблюдателя.
   * **Настройки выполнения** - Настройка для запуска runbook. Оставьте как Azure, так как этот запуск работает в Azure Automation.

1. Нажмите **OK,** а затем **выберите,** чтобы вернуться на страницу Watcher.
1. Нажмите **OK,** чтобы создать задачу наблюдателя.

![Настройка действия службы "Наблюдатель" с помощью пользовательского интерфейса](media/automation-watchers-tutorial/watchertaskcreation.png)

## <a name="trigger-a-watcher"></a>Активация службы "Наблюдатель"

Необходимо выполнить тест, описанный ниже, чтобы убедиться, что задача наблюдателя работает как ожидалось. 

1. Удаленный в гибридный Runbook работника. 
2. Откройте **PowerShell** и создайте тестовый файл в папке.

```azurepowerShell-interactive
New-Item -Name ExampleFile1.txt
```

В следующем примере показаны ожидаемые выходные данные.

```output
    Directory: D:\examplefiles


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       12/11/2017   9:05 PM              0 ExampleFile1.txt
```

## <a name="inspect-the-output"></a>Изучение выходных данных

1. Перейдите к учетной записи Автоматизации и выберите **задачи Watcher** в рамках **автоматизации процессов.**
1. Выберите задачу наблюдателя **WatchMyFolder**.
1. Нажмите на **потоки просмотра view** в **Streams,** чтобы увидеть, что наблюдатель нашел новый файл и запустил запуск акции.
1. Чтобы увидеть задания runbook, нажмите на **задания действий наблюдателя View.** Каждое задание может быть выбрано для просмотра деталей задания.

   ![Задания действия службы "Наблюдатель" в пользовательском интерфейсе](media/automation-watchers-tutorial/WatcherActionJobs.png)

Ожидаемые выходные данные при обнаружении нового файла можно увидеть в следующем примере.

```output
Message is Process new file...

Passed in data is @{FileName=D:\examplefiles\ExampleFile1.txt; Length=0}
```

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Импорт runbook службы "Наблюдатель"
> * Создание переменной службы автоматизации
> * Создание runbook действия
> * Создание задачи службы "Наблюдатель"
> * Активация службы "Наблюдатель"
> * Изучение выходных данных

Перейдите по ссылке для получения дополнительных сведений о создании собственного runbook.

> [!div class="nextstepaction"]
> [Мой первый PowerShell runbook](automation-first-runbook-textual-powershell.md).

