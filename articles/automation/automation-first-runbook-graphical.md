---
title: Создание графического модуля runbook в службе автоматизации Azure
description: Учебник, в котором описывается создание, тестирование и публикация простого графического модуля Runbook.
keywords: Runbook, шаблон Runbook, служба автоматизации Runbook и Azure Runbook
services: automation
ms.subservice: process-automation
ms.date: 04/13/2018
ms.topic: conceptual
ms.openlocfilehash: e208982145f0c3178a26526c73af81ab009a8d46
ms.sourcegitcommit: 0cc25b792ad6ec7a056ac3470f377edad804997a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/25/2020
ms.locfileid: "77605195"
---
# <a name="my-first-graphical-runbook"></a>Первый графический Runbook

> [!div class="op_single_selector"]
> * [Графический](automation-first-runbook-graphical.md)
> * [PowerShell](automation-first-runbook-textual-powershell.md)
> * [Рабочий процесс PowerShell](automation-first-runbook-textual.md)
> * [Python](automation-first-runbook-textual-python2.md)
> 

В данном учебнике описана процедура создания [графического модуля Runbook](automation-runbook-types.md#graphical-runbooks) в службе автоматизации Azure. Начните с простого модуля Runbook, который тестирует и публикует, и изучите, как отвести состояние задания Runbook. Затем измените модуль Runbook, чтобы он фактически управлял ресурсами Azure, в этом случае запускает виртуальную машину Azure. Выполните инструкции из руководства, чтобы сделать модуль Runbook более надежным, добавив параметры Runbook и условные ссылки.

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Инструкции по установке AZ Module в гибридной рабочей роли Runbook см. в статье [Установка модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0). Для учетной записи службы автоматизации можно обновить модули до последней версии, используя [обновление модулей Azure PowerShell в службе автоматизации Azure](automation-update-azure-modules.md).

## <a name="prerequisites"></a>предварительные требования

Для работы с этим учебником требуется:

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) , чтобы хранить модуль Runbook и выполнять проверку подлинности ресурсов Azure. Эта учетная запись должна иметь разрешение на запуск и остановку виртуальной машины.
* Виртуальная машина Azure. Так как вы останавливаете и запускаете этот компьютер, он не должен быть рабочей виртуальной машиной.

## <a name="step-1---create-runbook"></a>Шаг 1. Создание нового модуля Runbook

Начните с создания простого модуля Runbook, который выводит текст "Hello World".

1. На портале Azure выберите свою учетную запись службы автоматизации. 

    Страница учетной записи в службе автоматизации позволяет быстро получить представление о ресурсах, доступных в этой учетной записи. Некоторые ресурсы уже должны быть доступны. Большая часть этих ресурсов включает модули, автоматически включаемые в новую учетную запись службы автоматизации. У вас также должен быть ресурс учетных данных, связанный с подпиской.
2. Выберите **модули Runbook** в разделе **Автоматизация процессов** , чтобы открыть список модулей Runbook.
3. Создайте новый Runbook, выбрав **+ создать Runbook**.
4. Присвойте Runbook имя "MyFirstRunbook-графическая".
5. В этом случае будет создан [графический модуль Runbook](automation-graphical-authoring-intro.md). Выберите **графический** **тип для типа Runbook**.<br> ![Новый Runbook](media/automation-first-runbook-graphical/create-new-runbook.png)<br>
6. Щелкните **Создать** , чтобы создать модуль Runbook и открыть графический редактор.

## <a name="step-2---add-activities"></a>Шаг 2. Добавление действий

Элемент управления "Библиотека" в левой части редактора позволяет добавлять действия в модуль Runbook. Добавьте командлет **Write-Output** для вывода текста при помощи модуля runbook.

1. В элементе управления "Библиотека" щелкните поле поиска и введите "Write-Output". Результаты поиска показаны на следующем рисунке: <br> ![Microsoft.PowerShell.Utility](media/automation-first-runbook-graphical/search-powershell-cmdlet-writeoutput.png)
1. Прокрутите список до конца. Щелкните правой кнопкой мыши **запись-вывод** и выберите команду **Добавить в холст**. Кроме того, можно нажать кнопку с многоточием (...) рядом с именем командлета, а затем выбрать **Добавить на холст**.
1. Щелкните **Write-Output** на холсте. Откроется страница управления конфигурацией, где можно настроить выбранное действие.
1. По умолчанию поле **метки** имеет имя командлета, но его можно изменить на более понятное. Измените его на "запись Hello World в выходные данные".
1. Щелкните **Параметры**, чтобы указать значения параметров командлета.

   Некоторые командлеты имеют несколько наборов параметров, и необходимо выбрать, какой из них следует использовать. В этом случае **запись-Output** имеет только один набор параметров.

1. Выберите параметр *InputObject* . Этот параметр используется для указания текста, отправляемого в поток вывода.
1. Раскрывающееся меню **источник данных** содержит источники, которые можно использовать для заполнения значения параметра. В этом меню выберите **выражение PowerShell**. 

   Выходные данные таких источников можно использовать в качестве другого действия, ресурса службы автоматизации или выражения PowerShell. В этом случае выходными данными является просто "Hello World". Для этого воспользуйтесь выражением PowerShell и укажите строку.<br>

1. В поле **выражение** введите "Hello World" и дважды нажмите кнопку **ОК** , чтобы вернуться на холст.
1. Сохраните модуль Runbook, щелкнув **Сохранить**.

## <a name="step-3---test-the-runbook"></a>Шаг 3. Тестирование модуля Runbook

Прежде чем публиковать модуль Runbook, чтобы сделать его доступным в рабочей среде, необходимо проверить его, чтобы убедиться, что он работает правильно. Тестирование модуля Runbook запускает его черновую версию и позволяет просматривать выходные данные в интерактивном режиме.

1. Выберите **область тестирования** , чтобы открыть область тестирования.
1. Щелкните **Пуск** , чтобы начать тестирование. Активным должен быть только этот параметр.
1. Обратите внимание, что создается [Задание Runbook](automation-runbook-execution.md) , а его состояние отображается на панели.

   Состояние задания начинается в очереди, что означает, что задание ожидает, пока Рабочая роль Runbook в облаке станет доступной. Состояние меняется на запуск, когда Рабочая роль заявляет задание. Наконец, при запуске модуля Runbook происходит состояние выполняется.

1. После завершения задания Runbook в тестовом пагн отображаются выходные данные. В этом случае отображается «Hello World».<br> ![Hello World](media/automation-first-runbook-graphical/runbook-test-results.png)
1. Закройте область тестирования, чтобы вернуться на холст.

## <a name="step-4---publish-and-start-the-runbook"></a>Шаг 4. Публикация и запуск модуля Runbook

Созданный модуль Runbook по-прежнему находится в режиме черновика. Прежде чем запустить модуль в рабочей среде, его нужно опубликовать. При публикации модуля Runbook существующая опубликованная версия перезаписывается черновой версией. В нашем случае опубликованной версии не существует, поскольку модуль runbook создан только что.

1. Выберите **Опубликовать**, чтобы опубликовать runbook, и нажмите кнопку **Да** в появившемся запросе.
1. Прокрутите влево, чтобы просмотреть модуль Runbook на странице модули Runbook, и обратите внимание, что для параметра **Состояние создания** установлено значение Опубликовано.
1. Прокрутите экран вправо, чтобы просмотреть страницу MyFirstRunbook-графическая.

   Параметры в верхней части окна позволяют запустить модуль Runbook сейчас, запланировать время запуска в будущем или создать веб- [перехватчик](automation-webhooks.md) , чтобы модуль Runbook можно было запустить через вызов HTTP.

1. Чтобы запустить runbook, выберите **Запуск** и нажмите кнопку **Да** в появившемся запросе.
1. Откроется область задания для задания Runbook, которое было создано. Убедитесь, что **состояние задания** отображается как завершено.
1. Нажмите кнопку **выходные данные** , чтобы открыть страницу вывод, где можно увидеть "Hello World".
1. Закройте страницу выходных данных.
1. Щелкните **Все журналы** , чтобы открыть область "Потоки" для задания Runbook. В потоке вывода должно отображаться только "Hello World". 

    Обратите внимание, что на панели «потоки» могут отображаться другие потоки для задания Runbook, такие как потоки подробных сведений и ошибок, если Runbook выполняет запись в них.
1. Закройте панель потоки и область заданий, чтобы вернуться к MyFirstRunbook-графической странице.
1. Чтобы просмотреть все задания для модуля Runbook, выберите **задания** в разделе **ресурсы**. На странице задания перечислены все задания, созданные модулем Runbook. В списке должно отобразиться только одно задание, так как задание выполняется только один раз.
1. Щелкните имя задания, чтобы открыть ту же область заданий, которая была просмотрена при запуске модуля Runbook. Используйте эту панель для просмотра сведений о любом задании, созданном для модуля Runbook.

## <a name="step-5---create-variable-assets"></a>Шаг 5. Создание ресурсов для переменных

Вы протестировали и опубликовали модуль Runbook, но пока не все полезно для управления ресурсами Azure. Перед настройкой модуля Runbook для проверки подлинности необходимо создать переменную для хранения идентификатора подписки, настроить действие для проверки подлинности, а затем ссылаться на переменную. Включение ссылки на контекст подписки позволяет легко работать с несколькими подписками.

1. Скопируйте идентификатор подписки из параметра **подписки** в области навигации.
1. На странице учетные записи службы автоматизации в разделе **Общие ресурсы**выберите **переменные** .
1. Выберите **+ Добавить переменную**.
1. На странице Новая переменная внесите следующие параметры в указанные поля.

    * **Имя** — введите "AzureSubscriptionId".
    * **Значение** — введите идентификатор подписки. 
    * **Тип** --удерживать выбранную строку.
    * **Шифрование** — используйте значение по умолчанию.
1. Щелкните **Создать** , чтобы создать переменную.

## <a name="step-6---add-authentication"></a>Шаг 6. Добавление проверки подлинности

Теперь, когда у вас есть переменная для хранения идентификатора подписки, можно настроить для модуля Runbook проверку подлинности с учетными данными запуска от имени для вашей подписки. Для этого добавьте подключение запуска от имени Azure в качестве ресурса. Кроме того, необходимо добавить командлет [Connect-азаккаунт](https://docs.microsoft.com/powershell/module/az.accounts/Connect-AzAccount?view=azps-3.5.0) и командлет [Set-азконтекст](https://docs.microsoft.com/powershell/module/az.accounts/Set-AzContext?view=azps-3.5.0) на холст.

>[!NOTE]
>Для модулей Runbook PowerShell **Add-азаккаунт** и **Add-AzureRMAccount** являются псевдонимами для **Connect-азаккаунт**. Обратите внимание, что эти псевдонимы недоступны для графических модулей Runbook. Графический модуль Runbook может использовать только сам **Connect-азаккаунт** .

1. Перейдите к модулю Runbook и выберите **изменить** на странице MyFirstRunbook-графическая.
1. Запись "запись Hello World в вывод" больше не нужна. Просто нажмите кнопку с многоточием и выберите **Удалить**.
1. В элементе управления "Библиотека" разверните узел **ресурсы**, а затем — **подключения**. Добавьте "AzureRunAsConnection" на холст, выбрав **Добавить в холст**.
1. В элементе управления "Библиотека" введите "Connect-Азаккаунт" в поле поиска.
1. Добавьте **Connect-азаккаунт** на холст.
1. Наведите указатель мыши на элемент **Get Run As Connection** (Получить подключение запуска от имени), чтобы в нижней части элемента появился кружок. Щелкните окружность и перетащите стрелку к **Connect-азаккаунт** , чтобы сформировать ссылку. Модуль Runbook запускается с **подключением Get Запуск от имени** и затем запускает **Connect-азаккаунт**.<br> ![Создание связи между действиями](media/automation-first-runbook-graphical/runbook-link-auth-activities.png)
1. На холсте выберите **Connect-азаккаунт**. В области управления конфигурацией в поле **Метка** введите "вход в Azure".
1. Щелкните **Параметры**, после чего появится страница Конфигурация параметров действия.
1. Командлет **Connect-азаккаунт** имеет несколько наборов параметров, и необходимо выбрать один из них перед указанием значений параметров. Щелкните **набор параметров** , а затем выберите набор параметров ServicePrincipalCertificate.
1. Параметры для этого набора параметров отображаются на странице конфигурации параметров действия. Щелкните **APPLICATIONID**.<br> ![добавить параметры учетной записи Azure](media/automation-first-runbook-graphical/Add-AzureRmAccount-params.png)
1. На странице значение параметра внесите следующие параметры и нажмите кнопку **ОК**.

   * **Источник данных** — выберите **выход действия**.
   * Список источников данных — выберите пункт **получить Запуск от имени подключения**.
   * **Путь к полю** — введите "applicationId". Вы указываете имя свойства для пути к полю, так как действие выводит объект с несколькими свойствами.
1. Щелкните **CERTIFICATETHUMBPRINT**, а затем на странице значение параметра внесите следующие параметры и нажмите кнопку **ОК**.

    * **Источник данных** — выберите **выход действия**.
    * Список источников данных — выберите пункт **получить Запуск от имени подключения**.
    * **Путь к полю** — введите CertificateThumbprint.
1. Щелкните **SERVICEPRINCIPAL**, а на странице значение параметра выберите ConstantValue в поле **источник данных** . Выберите вариант **true (истина**). и нажмите кнопку **ОК**.
1. Щелкните **TENANTID**и на странице значение параметра установите следующие параметры. По завершении нажмите кнопку **ОК** дважды.

    * **Источник данных** — выберите **выход действия**. 
    * Список источников данных — выберите пункт **получить Запуск от имени подключения**.
    * **Путь к полю** — введите "TenantId". 
1. В элементе управления "Библиотека" в поле поиска введите "Set-Азконтекст".
1. Добавьте **Set-азконтекст** на холст.
1. На холсте выберите **Set-азконтекст** . В области управления конфигурацией в поле **Метка** введите "укажите идентификатор подписки".
1. Щелкните **Параметры**, чтобы открыть страницу "Конфигурация параметров действия".
1. Командлет **Set-азконтекст** имеет несколько наборов параметров, и необходимо выбрать один из них перед указанием значений параметров. Щелкните **набор параметров** , а затем выберите набор параметров SubscriptionId.
1. Параметры для этого набора параметров отображаются на странице конфигурации параметров действия. Щелкните **SubscriptionID**.
1. На странице значение параметра выберите ресурс- **контейнер переменной** для поля **источник данных** и выберите **AzureSubscriptionId** из списка источник. По завершении нажмите кнопку **ОК** дважды.
1. Наведите указатель мыши на элемент **Login to Azure** (Выполнить вход в Azure), чтобы в нижней части элемента появился кружок. Щелкните этот кружок и перетащите стрелку к элементу **Specify Subscription Id**(Указать идентификатор подписки). 

Теперь модуль Runbook должен выглядеть примерно так: <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-auth-config.png)

## <a name="step-7---add-activity-to-start-a-virtual-machine"></a>Шаг 7. Добавление действия для запуска виртуальной машины

Теперь необходимо добавить действие **Start-AzVM** для запуска виртуальной машины. Вы можете выбрать любую виртуальную машину в подписке Azure. Теперь вы прописано это имя в командлет [Start-AzVM](https://docs.microsoft.com/powershell/module/az.compute/start-azvm?view=azps-3.5.0) .

1. В элементе управления "Библиотека" введите **Start-AZ** в поле поиска.
2. Добавьте **Start-AzVM** на холст, а затем щелкните и перетащите его под загрузкой **Укажите идентификатор подписки**.
1. Наведите указатель мыши на элемент **Specify Subscription Id** (Указать идентификатор подписки), чтобы в нижней части элемента появился кружок. Щелкните окружность и перетащите стрелку в **Start-AzVM**.
1. Выберите **Start-AzVM**. Щелкните **Параметры** , а затем **набор параметров** , чтобы просмотреть наборы для действия.
1. Выберите набор параметров **ResourceGroupNameParameterSetName** . Поля **ResourceGroupName** и **Name** имеют восклицательные точки рядом с ними, чтобы указать, что они являются обязательными параметрами. Обратите внимание, что оба поля предполагают строковые значения.
1. Выберите параметр **Имя**. Выберите **выражение PowerShell** для поля **источник данных** . Для виртуальной машины, используемой для запуска этого модуля Runbook, введите имя компьютера, заключенное в двойные кавычки. Нажмите кнопку **ОК**.
1. Выберите **ResourceGroupName**. Используйте значение Expression PowerShell для поля **источник данных** и введите имя группы ресурсов, заключенное в двойные кавычки. Нажмите кнопку **ОК**.
1. Щелкните **Тестовая область**, чтобы проверить модуль runbook.
1. Щелкните **Пуск** , чтобы начать тестирование. После завершения работы убедитесь, что виртуальная машина запущена. 

Теперь модуль Runbook должен выглядеть примерно так: <br>![Настройка проверки подлинности Runbook](media/automation-first-runbook-graphical/runbook-startvm.png)

## <a name="step-8---add-additional-input-parameters"></a>Шаг 8. Добавление дополнительных входных параметров

Сейчас модуль Runbook запускает виртуальную машину в группе ресурсов, указанной для командлета **Start-AzVM** . Модуль Runbook будет полезнее, если указать имя и группу ресурсов при запуске модуля Runbook. Давайте добавим входные параметры в модуль Runbook, чтобы обеспечить эту функциональность.

1. Откройте графический редактор, нажав кнопку **изменить** на панели MyFirstRunbook-графическая.
1. Выберите **Входные и выходные данные**, а затем выберите **Добавить входные данные**, чтобы открыть область входных параметров для runbook.
1. Внесите следующие параметры в указанные поля и нажмите кнопку **ОК**.
   * **Имя** — укажите *VMName*.
   * **Тип** — параметр строки сохраняется.
   * **Обязательное** — измените значение на Да.
1. Создайте второй обязательный входной параметр с именем *ResourceGroupName* и нажмите кнопку **ОК** , чтобы закрыть область вход и выход.<br> ![Входные параметры Runbook](media/automation-first-runbook-graphical/start-azurermvm-params-outputs.png)
1. Выберите действие **Start-AzVM** и нажмите кнопку **Параметры**.
1. Измените **имя** поля **источника данных** на **Вход Runbook**. Затем выберите **VMName**.
1. Измените значение поля **источник данных** для **ResourceGroupName** на **Вход Runbook** и выберите **ResourceGroupName**.<br> ![параметры Start-AzVM](media/automation-first-runbook-graphical/start-azurermvm-params-runbookinput.png)
1. Сохраните модуль Runbook и откройте область тестирования. Теперь вы можете указать значения двух входных переменных, которые будут использоваться в тесте.
1. Закройте область тестирования.
1. Щелкните **Опубликовать** , чтобы опубликовать новую версию модуля Runbook.
1. Завершите работу виртуальной машины, которая была запущена ранее.
1. Щелкните **Пуск** , чтобы запустить модуль Runbook. Введите значения для **VMName** и **ResourceGroupName** для виртуальной машины, которую вы будете запускать.
1. После завершения работы модуля Runbook убедитесь, что виртуальная машина запущена.

## <a name="step-9---create-a-conditional-link"></a>Шаг 9. Создание условной связи

Теперь вы можете изменить модуль Runbook таким образом, чтобы он попытался запустить виртуальную машину только в том случае, если она еще не запущена. Для этого добавьте командлет [Get-AzVM](https://docs.microsoft.com/powershell/module/Az.Compute/Get-AzVM?view=azps-3.5.0) , который получает состояние экземпляра виртуальной машины. Затем можно добавить модуль кода рабочего процесса PowerShell с именем Get Status с фрагментом кода PowerShell, чтобы определить состояние виртуальной машины: запущена или остановлена. Условная ссылка из модуля Get Status запускается только в **том случае,** если текущее запущенное состояние — Stopped. В конце этой процедуры модуль Runbook использует командлет **Write-Output** для вывода сообщения о том, что виртуальная машина успешно запущена.

1. Откройте MyFirstRunbook-графическая в графическом редакторе.
1. Удалите связь между **указаниями идентификатор подписки** и **Start-AzVM** , щелкнув ее, а затем нажав клавишу **Delete**.
1. В элементе управления "Библиотека" введите "Get-AZ" в поле поиска.
1. Добавьте **Get-AzVM** на холст.
1. Выберите **Get-AzVM** , а затем **параметр SET** , чтобы просмотреть наборы для командлета **Get-AzVM**. 
1. Выберите набор параметров Жетвиртуалмачинеинресаурцеграупнамепарамсет. Рядом с полями **ResourceGroupName** и **Name** есть восклицательные точки, указывающие, что они указывают обязательные параметры. Обратите внимание, что оба поля предполагают строковые значения.
1. В разделе **источник данных** для параметра **имя**выберите **входные данные Runbook**, а затем **VMName**. Нажмите кнопку **ОК**.
1. В разделе **источник данных** для **ResourceGroupName**выберите **Вход Runbook**, а затем **ResourceGroupName**. Нажмите кнопку **ОК**.
1. В разделе **источник данных** для параметра **состояние**выберите **постоянное значение**, а затем — **true**. Нажмите кнопку **ОК**.
1. Создайте ссылку, **указав идентификатор подписки** в **Get-AzVM**.
1. В элементе управления "Библиотека" разверните **элемент Управление Runbook** и добавьте **код** на холст.  
1. Создайте ссылку из **Get-AzVM** в **Code**.  
1. Щелкните **код** и в области Конфигурация измените метку, чтобы **получить состояние**.
1. Выберите **код** и откроется страница редактор кода.  
1. В редакторе кода вставьте следующий фрагмент кода.

    ```powershell-interactive
     $StatusesJson = $ActivityOutput['Get-AzVM'].StatusesText
     $Statuses = ConvertFrom-Json $StatusesJson
     $StatusOut =""
     foreach ($Status in $Statuses){
     if($Status.Code -eq "Powerstate/running"){$StatusOut = "running"}
     elseif ($Status.Code -eq "Powerstate/deallocated") {$StatusOut = "stopped"}
     }
     $StatusOut
     ```

1. Создайте ссылку из **Get Status** в **Start-AzVM**.<br> ![Runbook с модулем кода](media/automation-first-runbook-graphical/runbook-startvm-get-status.png)  
1. Выберите ссылку и в области Конфигурация измените **условие применить** на Да. Обратите внимание, что ссылка превращается в пунктирную линию, указывая, что целевое действие выполняется только в том случае, если условие разрешается в true.  
1. В качестве **выражения условия**введите `$ActivityOutput['Get Status'] -eq "Stopped"`. **Start-AzVM** теперь выполняется только в том случае, если виртуальная машина остановлена.
1. В элементе управления "Библиотека" разверните узел **Командлеты** и выберите **Microsoft.PowerShell.Utility**.
1. Дважды добавьте командлет **Write-Output** на холст.
1. Для первого элемента управления **Write-Output** щелкните **Параметры** и измените значение **метки** , чтобы **уведомить о запуске ВМ**.
1. Для параметра **InputObject**измените значение в поле **источник данных** на **выражение PowerShell**и введите выражение "$VMName успешно запущено".
1. Во втором элементе управления " **запись-вывод** " щелкните **Параметры** и измените значение **метки** , чтобы **уведомить о сбое запуска виртуальной машины**.
1. Для параметра **InputObject**измените значение в поле **источник данных** на **выражение PowerShell**и введите выражение "$VMName не удалось запустить".
1. Создайте ссылки из **Start-AzVM** , чтобы **уведомить запущенную виртуальную машину** и **не удалось уведомить о запуске виртуальной машины**.
1. Выберите ссылку, чтобы **уведомить запущенную виртуальную машину** , и измените **условие применить** на true.
1. В поле **выражение условия**введите `$ActivityOutput['Start-AzVM'].IsSuccessStatusCode -eq $true`. Этот элемент управления **Write-Output** теперь выполняется только в том случае, если виртуальная машина запускается успешно.
1. Перейдите по ссылке, чтобы **уведомить о сбое запуска виртуальной машины** , и измените **условие применения** на true.
1. В поле **выражение условия** введите `$ActivityOutput['Start-AzVM'].IsSuccessStatusCode -ne $true`. Этот элемент управления **Write-Output** теперь выполняется только в том случае, если виртуальная машина не была успешно запущена. Теперь runbook должен выглядеть примерно так: <br> ![Runbook с командлетом Write-Output](media/automation-first-runbook-graphical/runbook-startazurermvm-complete.png)
1. Сохраните модуль Runbook и откройте область тестирования.
1. Запустите модуль Runbook с остановленной виртуальной машиной, и компьютер должен запуститься.

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о графической разработке в службе автоматизации Azure см. в [этой статье](automation-graphical-authoring-intro.md).
* Сведения о том, как начать работу с модулями Runbook, см. в статье [Мой первый модуль Runbook PowerShell](automation-first-runbook-textual-powershell.md).
* Чтобы приступить к работе с модулями Runbook рабочих процессов PowerShell, обратитесь к статье [Первый Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md).