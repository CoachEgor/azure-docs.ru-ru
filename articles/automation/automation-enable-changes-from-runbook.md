---
title: Включение отслеживания изменений и инвентаризации службы автоматизации Azure в модуле runbook
description: В этой статье рассказывается, как включить отслеживание изменений и инвентаризацию в модуле runbook.
services: automation
ms.topic: conceptual
ms.date: 05/10/2018
ms.custom: mvc
ms.openlocfilehash: 2728964d5bbf83b42251068ffbdea223ff6bd85e
ms.sourcegitcommit: 1692e86772217fcd36d34914e4fb4868d145687b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2020
ms.locfileid: "84171095"
---
# <a name="enable-change-tracking-and-inventory-from-a-runbook"></a>Включение Отслеживания изменений и инвентаризации в последовательности runbook

В этой статье описывается, как с помощью модуля runbook применить функцию [Отслеживание изменений и инвентаризация](change-tracking.md) к виртуальным машинам в вашей среде. Чтобы включить большое количество виртуальных машин Azure, сначала необходимо включить существующую виртуальную машину с помощью Отслеживания изменений и инвентаризации. 

> [!NOTE]
> При использовании Отслеживания изменений и инвентаризации только определенные регионы поддерживают связывание рабочей области Log Analytics с учетной записью службы автоматизации. Список поддерживаемых пар сопоставлений см. в статье о [сопоставлении региона для учетной записи службы автоматизации и рабочей области Log Analytics](how-to/region-mappings.md).

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для управления компьютерами.
* [Виртуальная машина](../virtual-machines/windows/quick-create-portal.md).

## <a name="enable-change-tracking-and-inventory"></a>Включение решения для отслеживания изменений и инвентаризации 

1. На портале Azure щелкните элемент **Учетные записи службы автоматизации**, а затем выберите в списке нужную учетную запись службы автоматизации.
1. В области **Управление конфигурацией** выберите элемент **Учет**.
1. Выберите существующую рабочую область Log Analytics или создайте новую. 
1. Выберите **Включить**.

    ![Включение решения для отслеживания изменений и инвентаризации](media/automation-enable-changes-from-runbook/inventory-onboard.png)

## <a name="select-azure-vm-to-manage"></a>Выбор виртуальной машины Azure для управления

Если функция "Отслеживание изменений и инвентаризация" включена, можно добавить виртуальную машину Azure для управления с помощью этой функции.

1. В учетной записи службы автоматизации выберите **Отслеживание изменений** или **Инвентаризация** в разделе **Управление конфигурацией**.

2. Щелкните элемент **Добавить виртуальные машины Azure**, чтобы добавить виртуальную машину.

3. Выберите нужную виртуальную машину из списка и щелкните элемент **Включить**. Будет активировано Отслеживание изменений и инвентаризация для этой виртуальной машины.

   ![Включение Отслеживания изменений и инвентаризации для виртуальной машины](media/automation-enable-changes-from-runbook/enable-change-tracking.png)

    > [!NOTE]
    > Если вы попытаетесь включить другую функцию до завершения установки Отслеживания изменений и инвентаризации, появится следующее сообщение: `Installation of another solution is in progress on this or a different virtual machine. When that installation completes the Enable button is enabled, and you can request installation of the solution on this virtual machine.`

## <a name="install-and-update-modules"></a>установка и обновление модулей;

Нужно обновить модули Azure до последних версий и импортировать модуль [Az.OperationalInsights](https://docs.microsoft.com/powershell/module/az.operationalinsights/?view=azps-3.7.0), чтобы включить Отслеживание изменений и инвентаризацию для виртуальной машины.

1. В учетной записи службы автоматизации выберите элемент **Модули** в области **Общие ресурсы**. 
2. Выберите **Обновить модули Azure**, чтобы обновить модули Azure до последней версии. 
3. Щелкните вариант **Да**, чтобы обновить все существующие модули Azure до последней версии.

    ![Обновление модулей](media/automation-enable-changes-from-runbook/update-modules.png)

4. Вернитесь к параметру **Модули** в разделе **Общие ресурсы**. 
5. Щелкните **Обзор коллекции**, чтобы открыть коллекцию модулей. 
6. Найдите модуль Az.OperationalInsights и импортируйте его в учетную запись автоматизации.

    ![Импорт модуля OperationalInsights](media/automation-enable-changes-from-runbook/import-operational-insights-module.png)

## <a name="import-a-runbook-to-enable-change-tracking-and-inventory"></a>Импорт модуля runbook для включения функции "Отслеживание изменений и инвентаризация"

1. В учетной записи службы автоматизации выберите **Модули Runbook** в области **Автоматизация процессов**.
2. Выберите **Обзор коллекции**.
3. Найдите параметр `update and change tracking`.
4. Выберите нужный модуль runbook и щелкните элемент **Импорт** на странице "Просмотр исходного кода". 
5. Нажмите кнопку **ОК**, чтобы импортировать runbook в учетную запись службы автоматизации.

   ![Импорт модуля runbook для настройки](media/automation-enable-changes-from-runbook/import-from-gallery.png)

6. На странице сведений о runbook щелкните элемент **Изменить**, а затем — элемент **Опубликовать**. 
7. На панели публикации runbook выберите вариант **Да**, чтобы опубликовать этот модуль runbook.

## <a name="start-the-runbook"></a>Запуск модуля runbook

Для запуска модуля runbook необходимо включить функцию "Отслеживание изменений и инвентаризация" для виртуальной машины Azure. Для этого понадобится существующая виртуальная машина и группа ресурсов с включенной функцией для параметров.

1. Откройте runbook с именем **Enable-MultipleSolution**.

   ![Модули runbook для нескольких решений](media/automation-enable-changes-from-runbook/runbook-overview.png)

1. Нажмите кнопку "Пуск" и введите значения параметров в следующих полях:

   * **VMNAME** — имя существующей виртуальной машины, добавляемой в Отслеживание изменений и инвентаризацию. Оставьте это поле пустым, чтобы добавить все виртуальные машины в группе ресурсов.
   * **VMRESOURCEGROUP** — имя группы ресурсов для включения виртуальных машин.
   * **SUBSCRIPTIONID** — идентификатор подписки новой включаемой виртуальной машины. Оставьте это поле пустым, чтобы использовать подписку рабочей области. При использовании другого идентификатора подписки добавьте учетную запись запуска для учетной записи службы автоматизации в качестве участника подписки.
   * **ALREADYONBOARDEDVM** — имя виртуальной машины, которая уже включена вручную для изменений.
   * **ALREADYONBOARDEDVMRESOURCEGROUP** — имя группы ресурсов, в которую входит виртуальная машина.
   * **SOLUTIONTYPE** — введите **ChangeTracking** (Отслеживание изменений).

   ![Параметры модуля runbook Enable-MultipleSolution](media/automation-enable-changes-from-runbook/runbook-parameters.png)

1. Выберите **ОК**, чтобы выполнить задание runbook.
1. Отслеживайте ход выполнения и наличие ошибок на странице задания runbook.

## <a name="next-steps"></a>Дальнейшие действия

* Сведения о планировании выполнения модуля runbook см. в статье [Управление расписаниями в службе автоматизации Azure](shared-resources/schedules.md).
* Дополнительные сведения о работе с этой возможностью см. в статье [Управление решением для Отслеживания изменений и инвентаризации](change-tracking-file-contents.md).
* Сведения об устранении общих проблем в работе этой функции см. в статье [Устранение неполадок с Отслеживанием изменений и инвентаризацией](troubleshoot/change-tracking.md).