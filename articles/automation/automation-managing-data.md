---
title: Управление данными службы автоматизации Azure
description: Эта статья содержит несколько разделов об управлении средой службы автоматизации Azure.  Сейчас включает в себя хранение данных и резервное копирование для аварийного восстановления службы автоматизации Azure.
services: automation
ms.subservice: shared-capabilities
ms.date: 03/23/2020
ms.topic: conceptual
ms.openlocfilehash: f917e9c64a932d75fd0f6b14c9e0f35808467355
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80984663"
---
# <a name="managing-azure-automation-data"></a>Управление данными службы автоматизации Azure

Эта статья содержит несколько разделов, посвященных управлению данными в среде службы автоматизации Azure.

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Инструкции по установке модуля Az в гибридной рабочей роли Runbook см. в статье об [установке модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0). Чтобы обновить модули в учетной записи службы автоматизации, см. руководство по [обновлению модулей Azure PowerShell в службе автоматизации Azure](automation-update-azure-modules.md).

## <a name="data-retention"></a>Хранение данных

При удалении ресурса в службе автоматизации Azure он будет храниться в течение нескольких дней в целях аудита перед окончательным удалением. В течение этого времени ресурс не отображается или не используется. Эта политика также применяется к ресурсам, принадлежащим к удаленной учетной записи службы автоматизации.

В следующей таблице кратко описана политика хранения для различных ресурсов.

| Данные | Политика |
|:--- |:--- |
| Учетные записи |Учетная запись окончательно удаляется через 30 дней после ее удаления пользователем. |
| Ресурсы |Ресурс окончательно удаляется через 30 дней после его удаления пользователем или через 30 дней после удаления пользователем учетной записи, содержащей ресурс. |
| Узлы DSC |Узел DSC окончательно удаляется через 30 дней после отмены регистрации из учетной записи службы автоматизации с помощью портал Azure или командлета [Unregister-азаутоматиондскноде](https://docs.microsoft.com/powershell/module/az.automation/unregister-azautomationdscnode?view=azps-3.7.0) в Windows PowerShell. Узел также окончательно удаляется через 30 дней после удаления пользователем учетной записи, в которой находится узел. |
| Задания |Задание удаляется и окончательно удаляется через 30 дней после изменения, например после завершения задания, при остановке или приостановке. |
| Модули |Модуль окончательно удаляется через 30 дней после его удаления пользователем или через 30 дней после удаления пользователем учетной записи, содержащей модуль. |
| Конфигурации узлов и MOF-файлы |Старая Конфигурация узла окончательно удаляется через 30 дней после создания новой конфигурации узла. |
| Отчеты узла |Отчет узла окончательно удаляется через 90 дней после создания нового отчета для этого узла. |
| Модули runbook |Модуль Runbook окончательно удаляется через 30 дней после удаления пользователем ресурса или через 30 дней после удаления пользователем учетной записи, содержащей ресурс. |

Политика хранения применяется ко всем пользователям и в настоящее время не может быть настроена. Тем не менее, если необходимо поддерживать более длительный период времени, можно [перенаправить данные заданий службы автоматизации Azure в журналы Azure Monitor](automation-manage-send-joblogs-log-analytics.md).

## <a name="data-backup"></a>Резервное копирование данных

При удалении учетной записи службы автоматизации в Azure все объекты в этой учетной записи удаляются. Объекты включают модули Runbook, модулей, конфигурации, параметры, задания и ресурсы. Их невозможно восстановить после удаления учетной записи. Чтобы создать резервную копию содержимого учетной записи службы автоматизации перед ее удалением, можно использовать следующие сведения.

### <a name="runbooks"></a>Модули runbook

Модули Runbook можно экспортировать в файлы сценариев с помощью портала Azure или командлета [Get-AzureAutomationRunbookDefinition](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azureautomationrunbookdefinition) в Windows PowerShell. Эти файлы сценариев можно импортировать в другую учетную запись службы автоматизации, как описано в разделе [Управление модулями Runbook в службе автоматизации Azure](manage-runbooks.md).

### <a name="integration-modules"></a>Модули интеграции

Вы не можете экспортировать модули интеграции из службы автоматизации Azure. Их необходимо сделать доступными за пределами учетной записи службы автоматизации.

### <a name="assets"></a>Ресурсы

Вы не можете экспортировать ресурсы службы автоматизации Azure: сертификаты, подключения, учетные данные, расписания и переменные. Вместо этого можно использовать командлеты портал Azure и Azure, чтобы заметкуть сведения об этих ресурсах. Затем используйте эти сведения для создания ресурсов, используемых модулями Runbook, которые импортируются в другую учетную запись службы автоматизации.

Вы не можете получить значения для зашифрованных переменных или полей пароля учетных данных с помощью командлетов. Если эти значения неизвестны, их можно получить в модуле Runbook. Сведения о получении значений переменных см. [в разделе ресурсы переменных в службе автоматизации Azure](shared-resources/variables.md). Дополнительные сведения о получении значений учетных данных см. [в статье ресурсы учетных данных в службе автоматизации Azure](shared-resources/credentials.md).

 ### <a name="dsc-configurations"></a>Конфигурации DSC

Вы можете экспортировать конфигурации DSC в файлы скриптов с помощью портал Azure или командлета [Export-азаутоматиондскконфигуратион](https://docs.microsoft.com/powershell/module/az.automation/export-azautomationdscconfiguration?view=azps-3.7.0
) в Windows PowerShell. Вы можете импортировать и использовать эти конфигурации в другой учетной записи службы автоматизации.

## <a name="geo-replication-in-azure-automation"></a>Георепликация в службе автоматизации Azure

Георепликация является стандартом в учетных записях службы автоматизации Azure. При настройке учетной записи вы выбираете основной регион. Внутренняя служба георепликации службы автоматизации автоматически назначает учетной записи дополнительный регион. Затем служба постоянно создает резервные копии данных учетной записи из основного региона в дополнительный. Полный список первичного и вторичного регионов можно найти в [области непрерывности бизнес-процессов и аварийном восстановлении (BCDR): Парные регионы Azure](https://docs.microsoft.com/azure/best-practices-availability-paired-regions). 

Резервная копия, созданная службой георепликации службы автоматизации, является полной копией ресурсов автоматизации, конфигураций и т. д. Эта резервная копия может использоваться в том случае, если основной регион выходит из строя и теряет данные. В маловероятном случае потери данных для основного региона Корпорация Майкрософт пытается ее восстановить. Если компания не может восстановить основные данные, она использует автоматическую отработку отказа и информирует вас о ситуации с помощью подписки Azure. 

Служба георепликации службы автоматизации недоступна для внешних клиентов напрямую, если есть региональный сбой. Если вы хотите поддерживать конфигурацию автоматизации и модули Runbook во время региональных сбоев:

1. Выберите дополнительный регион для связывания с географическим регионом вашей основной учетной записи автоматизации.

2. Создайте учетную запись службы автоматизации в дополнительном регионе.

3. В основной учетной записи экспортируйте модули Runbook в виде файлов скриптов.

4. Импортируйте модули Runbook в учетную запись службы автоматизации в дополнительном регионе.

## <a name="next-steps"></a>Дальнейшие шаги

* Дополнительные сведения о защите ресурсов в службе автоматизации Azure см. в статье [Шифрование безопасных ресурсов в службе автоматизации Azure](automation-secure-asset-encryption.md).

* Дополнительные сведения о георепликации см. в статье [Создание и использование активной георепликации](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).