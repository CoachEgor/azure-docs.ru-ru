---
title: Внедрение решений по обновлению, отслеживанию изменений и инвентаризации в службу автоматизации Azure
description: Узнайте, как подключить решения по обновлению и отслеживанию изменений к службе автоматизации Azure.
services: automation
ms.topic: tutorial
ms.date: 05/10/2018
ms.custom: mvc
ms.openlocfilehash: 721157c333e381799ef08930c667c51a51a4fd6a
ms.sourcegitcommit: b55d7c87dc645d8e5eb1e8f05f5afa38d7574846
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81457626"
---
# <a name="onboard-update-change-tracking-and-inventory-solutions-to-azure-automation"></a>Внедрение решений по обновлению, отслеживанию изменений и инвентаризации в службу автоматизации Azure

В этом руководстве описаны следующие шаги по автоматическому внедрению в службу автоматизации Azure решений по обновлению и отслеживанию изменений, а также инвентаризации виртуальных машин:

> [!div class="checklist"]
> * подключение виртуальной машины Azure;
> * включение решений;
> * установка и обновление модулей;
> * импорт модуля runbook для подключения;
> * Запуск модуля runbook

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Инструкции по установке модуля Az в гибридной рабочей роли Runbook см. в статье об [установке модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0). Чтобы обновить модули в учетной записи службы автоматизации, см. руководство по [обновлению модулей Azure PowerShell в службе автоматизации Azure](automation-update-azure-modules.md).

## <a name="prerequisites"></a>Предварительные требования

Ниже перечислены необходимые условия для выполнения инструкций из этого руководства.

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для управления компьютерами.
* [Виртуальная машина](../virtual-machines/windows/quick-create-portal.md) для подключения.

## <a name="onboard-an-azure-vm"></a>подключение виртуальной машины Azure;

Существует несколько способов подключения решений на виртуальных машинах: подключить решение [на одной виртуальной машине](automation-onboard-solutions-from-vm.md), [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md), [из учетной записи Службы автоматизации](automation-onboard-solutions-from-automation-account.md) или с помощью модуля runbook. В этом руководстве рассматривается включение решения "Управление обновлениями" через модуль runbook. Чтобы подключить виртуальные машины Azure в масштабе, необходимо подключить к существующей виртуальной машине решение по отслеживанию изменений или управлению обновлениями. На этом этапе следует подключить к виртуальной машине решения по управлению обновлениями и отслеживанию изменений.

### <a name="enable-change-tracking-and-inventory"></a>Включение решения для отслеживания изменений и инвентаризации

Эти решения позволяют [отслеживать изменения](automation-vm-change-tracking.md) и [выполнять инвентаризацию](automation-vm-inventory.md) на виртуальных машинах. На этом этапе вы включите решения на виртуальной машине.

1. На портале Azure щелкните элемент **Учетные записи службы автоматизации**, а затем выберите в списке нужную учетную запись службы автоматизации.
1. В области **Управление конфигурацией** выберите элемент **Учет**.
1. Выберите существующую рабочую область Log Analytics или создайте новую. 
1. Выберите **Включить**.

    ![Подключение решения по обновлению](media/automation-onboard-solutions/inventory-onboard.png)

### <a name="enable-update-management"></a>Включение управления обновлениями

Решение по управлению обновлениями позволяет управлять обновлениями и исправлениями виртуальных машин Azure под управлением Windows. Можно оценить состояние доступных обновлений, назначить время установки необходимых обновлений и проверить результаты развертывания, чтобы убедиться, что обновления на виртуальной машине были успешно применены. На этом этапе нужно включить решение для виртуальной машины.

1. В области **Управление обновлениями** для учетной записи службы автоматизации выберите элемент **Управление обновлениями**.
1. Выбранная рабочая область Log Analytics — это рабочая область, которая использовалась на предыдущем шаге. Нажмите кнопку **Включить**, чтобы подключить решение для управления обновлениями. Во время установки решения для управления обновлениями отображается синий баннер. 

    ![Подключение решения по обновлению](media/automation-onboard-solutions/update-onboard.png)

### <a name="select-azure-vm-to-be-managed"></a>Выбор виртуальной машины Azure для управления

Теперь, когда решения включены, можно добавить виртуальную машину Azure для подключения к ней этих решений.

1. В учетной записи службы автоматизации выберите **Отслеживание изменений** в разделе **Управление конфигурацией**. 
2. На странице "Отслеживание изменений" щелкните элемент **Добавить виртуальные машины Azure**, чтобы добавить виртуальную машину.

3. Выберите нужную виртуальную машину из списка и щелкните элемент **Включить**. Будут активированы решения по отслеживанию изменений и инвентаризации для этой виртуальной машины.

   ![Включение решения по обновлению для виртуальной машины](media/automation-onboard-solutions/enable-change-tracking.png)

4. Получив уведомление о завершении подключения виртуальной машины, выберите элемент **Управление обновлениями** в области **Управление обновлениями**.

5. Щелкните элемент **Добавить виртуальные машины Azure**, чтобы добавить виртуальную машину.

6. Выберите виртуальную машину из списка и щелкните **Включить**. Будет включено решение по управлению обновлениями для виртуальной машины.

   ![Включение решения по обновлению для виртуальной машины](media/automation-onboard-solutions/enable-update.png)

> [!NOTE]
> Если вы не дождетесь, пока завершится выполнение другого решения, при включении следующего появится такое сообщение: `Installation of another solution is in progress on this or a different virtual machine. When that installation completes the Enable button is enabled, and you can request installation of the solution on this virtual machine.`

## <a name="install-and-update-modules"></a>установка и обновление модулей;

Нужно обновить модули Azure до последних версий и импортировать модуль [Az.OperationalInsights](https://docs.microsoft.com/powershell/module/az.operationalinsights/?view=azps-3.7.0), чтобы автоматизировать подключение решения.

## <a name="update-azure-modules"></a>Обновление модулей Azure

1. В учетной записи службы автоматизации выберите элемент **Модули** в области **Общие ресурсы**. 
2. Выберите **Обновить модули Azure**, чтобы обновить модули Azure до последней версии. 
3. Щелкните вариант **Да**, чтобы обновить все существующие модули Azure до последней версии.

![Обновление модулей](media/automation-onboard-solutions/update-modules.png)

### <a name="install-azoperationalinsights-module"></a>Установка модуля Az.OperationalInsights

1. В учетной записи службы автоматизации выберите **Модули** в области **Общие ресурсы**. 
2. Щелкните **Обзор коллекции**, чтобы открыть коллекцию модулей. 
3. Найдите модуль Az.OperationalInsights и импортируйте его в учетную запись автоматизации.

![Импорт модуля OperationalInsights](media/automation-onboard-solutions/import-operational-insights-module.png)

## <a name="import-the-onboarding-runbook"></a>импорт модуля runbook для подключения;

1. В учетной записи службы автоматизации выберите **Модули Runbook** в области **Автоматизация процессов**.
1. Выберите **Обзор коллекции**.
1. Найдите параметр `update and change tracking`.
3. Выберите нужный модуль runbook и щелкните элемент **Импорт** на странице "Просмотр исходного кода". 
4. Нажмите кнопку **ОК**, чтобы импортировать runbook в учетную запись службы автоматизации.

   ![Импорт модуля runbook для подключения](media/automation-onboard-solutions/import-from-gallery.png)

6. На странице сведений о runbook щелкните элемент **Изменить**, а затем — элемент **Опубликовать**. 
7. На панели публикации runbook выберите вариант **Да**, чтобы опубликовать этот модуль runbook.

## <a name="start-the-runbook"></a>Запуск модуля runbook

Чтобы запустить этот модуль runbook, нужно уже подключенное к виртуальной машине Azure решение по отслеживанию изменений или обновлению. Модуль принимает в качестве параметров уже существующую виртуальную машину и группу ресурсов, к которой подключена система.

1. Откройте runbook с именем **Enable-MultipleSolution**.

   ![Модули runbook для нескольких решений](media/automation-onboard-solutions/runbook-overview.png)

1. Нажмите кнопку "Пуск" и введите следующие значения параметров.

   * **VMNAME** — оставьте пустым. Это имя существующей виртуальной машины, которую нужно подключить к решению по обновлению или отслеживанию изменений. Если оставить это значение пустым, будут подключены все виртуальные машины в группе ресурсов.
   * **VMRESOURCEGROUP** — имя группы ресурсов для подключения виртуальных машин.
   * **SUBSCRIPTIONID** — оставьте пустым. Это идентификатор подписки новой подключаемой виртуальной машины. Если оставить это значение пустым, будет использоваться подписка рабочей области. Если вы укажете идентификатор другой подписки, учетная запись запуска от имени в учетной записи автоматизации будет добавлена в роль участника для указанной подписки.
   * **ALREADYONBOARDEDVM** — имя виртуальной машины, которая была вручную подключена к решению по обновлению или отслеживанию изменений.
   * **ALREADYONBOARDEDVMRESOURCEGROUP** — имя группы ресурсов, в которую входит виртуальная машина.
   * **SOLUTIONTYPE** — введите тип решения **Updates** (Обновления) или **ChangeTracking** (Отслеживание изменений).

   ![Параметры модуля runbook Enable-MultipleSolution](media/automation-onboard-solutions/runbook-parameters.png)

1. Выберите **ОК**, чтобы выполнить задание runbook.
1. Отслеживайте ход выполнения и наличие ошибок на странице задания runbook.

## <a name="clean-up-resources"></a>Очистка ресурсов

Чтобы удалить виртуальную машину для Управления обновлениями, необходимо сделать следующее.

1. В рабочей области Log Analytics удалите виртуальную машину из сохраненных поисковых запросов в конфигурации области `MicrosoftDefaultScopeConfig-Updates`. Сохраненные поисковые запросы хранятся на вкладке **Общие** рабочей области.
2. Удалите [Агент Log Analytics для Windows](../azure-monitor/learn/quick-collect-windows-computer.md#clean-up-resources) или [Агент Log Analytics для Linux](../azure-monitor/learn/quick-collect-linux-computer.md#clean-up-resources).

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * подключение виртуальной машины Azure вручную;
> * установка и обновление необходимых модулей Azure;
> * импорт модуля runbook, который подключает виртуальные машины Azure;
> * запуск модуля runbook, который автоматически подключает виртуальные машины Azure.

Перейдите по ссылке для получения дополнительных сведений о планировании модулей runbook.

> [!div class="nextstepaction"]
> [Создание расписания для модулей runbook](automation-schedules.md)
