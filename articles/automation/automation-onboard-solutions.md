---
title: Внедрение решений по обновлению и отслеживанию изменений в службу автоматизации Azure
description: Узнайте, как подключить решения по обновлению и отслеживанию изменений к службе автоматизации Azure.
services: automation
ms.service: automation
author: eamonoreilly
ms.author: eamono
manager: carmonm
ms.topic: tutorial
ms.date: 05/10/2018
ms.custom: mvc
ms.openlocfilehash: cacd9206eb0213d410a11ee3a2dcf5c0e28989c6
ms.sourcegitcommit: 0576bcb894031eb9e7ddb919e241e2e3c42f291d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/15/2019
ms.locfileid: "72372820"
---
# <a name="onboard-update-and-change-tracking-solutions-to-azure-automation"></a>Внедрение решений по обновлению и отслеживанию изменений в службу автоматизации Azure

В этом руководстве описаны следующие шаги по автоматическому внедрению в службу автоматизации Azure решений по обновлению и отслеживанию изменений, а также инвентаризации виртуальных машин:

> [!div class="checklist"]
> * подключение виртуальной машины Azure;
> * включение решений;
> * установка и обновление модулей;
> * импорт модуля runbook для подключения;
> * Запуск модуля runbook

## <a name="prerequisites"></a>Предварительные требования

Ниже перечислены необходимые условия для выполнения инструкций из этого руководства.

* Подписка Azure. Если у вас ее нет, [активируйте преимущества для подписчиков MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) или [зарегистрируйте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
* [Учетная запись службы автоматизации](automation-offering-get-started.md) для управления компьютерами.
* [Виртуальная машина](../virtual-machines/windows/quick-create-portal.md) для подключения.

## <a name="onboard-an-azure-vm"></a>подключение виртуальной машины Azure;

Существует несколько способов подключения решений на виртуальных машинах: подключить решение можно [на одной виртуальной машине](automation-onboard-solutions-from-vm.md), [на нескольких виртуальных машинах](automation-onboard-solutions-from-browse.md) [в учетной записи Службы автоматизации](automation-onboard-solutions-from-automation-account.md) или с помощью модуля runbook. В этом руководстве рассматривается включение решения "Управление обновлениями" через модуль runbook. Чтобы подключить виртуальные машины Azure в масштабе, необходимо подключить к существующей виртуальной машине решение по отслеживанию изменений или управлению обновлениями. На этом этапе следует подключить к виртуальной машине решения по управлению обновлениями и отслеживанию изменений.

### <a name="enable-change-tracking-and-inventory"></a>Включение решения для отслеживания изменений и инвентаризации

Решение для отслеживания изменений и инвентаризации позволяет [отслеживать изменения](automation-vm-change-tracking.md) и [выполнять инвентаризацию](automation-vm-inventory.md) на виртуальных машинах. На этом этапе нужно включить решение на виртуальной машине.

1. В меню слева выберите **Учетные записи службы автоматизации**, а затем выберите в списке нужную учетную запись службы автоматизации.
1. В области **Управление конфигурацией** выберите **Учет**.
1. Выберите существующую или создайте новую рабочую область Log Analytics. Нажмите кнопку **Включить**.

![Подключение решения по обновлению](media/automation-onboard-solutions/inventory-onboard.png)

Когда завершится подключение решений по отслеживанию изменений и инвентаризации, щелкните **Управление обновлениями** в области **Управление конфигурацией**.

### <a name="enable-update-management"></a>Включение управления обновлениями

Решение по управлению обновлениями позволяет управлять обновлениями и исправлениями виртуальных машин Azure под управлением Windows. Можно оценить состояние доступных обновлений, назначить время установки необходимых обновлений и проверить результаты развертывания, чтобы убедиться, что обновления на виртуальной машине были успешно применены. На этом этапе нужно включить решение для виртуальной машины.

1. В учетной записи службы автоматизации в области **Управление обновлениями** выберите **Управление обновлениями**.
1. Выбранная рабочая область Log Analytics является той же рабочей областью, которая использовалась на предыдущем шаге. Нажмите кнопку **Включить**, чтобы подключить решение для управления обновлениями.

![Подключение решения по обновлению](media/automation-onboard-solutions/update-onboard.png)

Во время установки решения для управления обновлениями отображается синий баннер. Когда решение будет включено, в области **Управление конфигурацией** выберите **Отслеживание изменений**, чтобы перейти к следующему шагу.

### <a name="select-azure-vm-to-be-managed"></a>Выбор виртуальной машины Azure для управления

Теперь, когда решения включены, можно добавить виртуальную машину Azure для подключения к ней этих решений.

1. В учетной записи службы автоматизации на странице **Отслеживание изменений** выберите **+ Добавить виртуальную машину Azure**.

1. Выберите виртуальную машину из списка и щелкните **Включить**. Это действие активирует решение по отслеживанию изменений и инвентаризации для этой виртуальной машины.

   ![Включение решения по обновлению для виртуальной машины](media/automation-onboard-solutions/enable-change-tracking.png)

1. Получив уведомление о завершении подключения виртуальной машины, в учетной записи службы автоматизации в области **Управление обновлениями** выберите **Управление обновлениями**.

1. Выберите **+ Добавить виртуальную машину Azure** для добавления виртуальной машины.

1. Выберите виртуальную машину из списка и щелкните **Включить**. Это действие включает решение по управлению обновлениями для виртуальной машины.

   ![Включение решения по обновлению для виртуальной машины](media/automation-onboard-solutions/enable-update.png)

> [!NOTE]
> Если вы не ожидаете завершения другого решения, при включении следующего решения появляется такое сообщение: *Выполняется установка другого решения на этой или другой виртуальной машине. Когда она завершится, кнопка "Включить" активируется и вы сможете запросить установку решения на этой виртуальной машине.*

## <a name="install-and-update-modules"></a>Установка и обновление модулей

Чтобы успешно автоматизировать подключение решения, необходимо обновить все модули Azure до последних версий и импортировать модуль `AzureRM.OperationalInsights`.

## <a name="update-azure-modules"></a>Обновление модулей Azure

В учетной записи службы автоматизации в области **Общие ресурсы** выберите **Модули**. Выберите **Обновить модули Azure**, чтобы обновить модули Azure до последней версии. При появлении запроса на обновление всех существующих модулей Azure до последней версии щелкните **Да**.

![Обновление модулей](media/automation-onboard-solutions/update-modules.png)

### <a name="install-azurermoperationalinsights-module"></a>Установка модуля AzureRM.OperationalInsights

На странице **Модули** выберите **Обзор коллекции**, чтобы открыть коллекцию модулей. Найдите модуль AzureRM.OperationalInsights и импортируйте его в учетную запись автоматизации.

![Импорт модуля OperationalInsights](media/automation-onboard-solutions/import-operational-insights-module.png)

## <a name="import-the-onboarding-runbook"></a>Импорт модуля runbook для подключения

1. В учетной записи службы автоматизации в области **Автоматизация процессов** выберите **Модули Runbook**.
1. Выберите **Обзор коллекции**.
1. Выполните поиск по строке **обновление и отслеживание изменений**, щелкните модуль runbook и выберите **Импорт** на странице **Просмотр источника**. Чтобы импортировать модуль runbook в учетную запись службы автоматизации, щелкните **ОК**.

   ![Импорт модуля runbook для подключения](media/automation-onboard-solutions/import-from-gallery.png)

1. На странице **Модуль Runbook** выберите **Изменить**, а затем **Опубликовать**. В диалоговом окне **Опубликовать модуль Runbook** выберите **Да**, чтобы опубликовать модуль runbook.

## <a name="start-the-runbook"></a>Запуск модуля runbook

Чтобы запустить этот модуль runbook, нужно иметь уже подключенную к Azure решение по отслеживанию изменений или обновлению. Модуль принимает в качестве параметров уже существующую виртуальную машину и группу ресурсов, к которой подключена система.

1. Откройте модуль runbook с именем Enable-MultipleSolution.

   ![Модули runbook для нескольких решений](media/automation-onboard-solutions/runbook-overview.png)

1. Нажмите кнопку "Пуск" и введите следующие значения параметров.

   * **VMNAME** — оставьте пустым. Это имя существующей виртуальной машины, которую нужно подключить к решению по обновлению или отслеживанию изменений. Если оставить это значение пустым, будут подключены все виртуальные машины в группе ресурсов.
   * **VMRESOURCEGROUP** — имя группы ресурсов для подключения виртуальных машин.
   * **SUBSCRIPTIONID** — оставьте пустым. Это идентификатор подписки новой подключаемой виртуальной машины. Если оставить это значение пустым, будет использоваться подписка рабочей области. Если вы укажете идентификатор другой подписки, учетная запись запуска от имени в учетной записи автоматизации будет добавлена в роль участника для указанной подписки.
   * **ALREADYONBOARDEDVM** — имя виртуальной машины, которая была вручную подключена к решению по обновлению или отслеживанию изменений.
   * **ALREADYONBOARDEDVMRESOURCEGROUP** — имя группы ресурсов, в которую входит нужная виртуальная машина.
   * **SOLUTIONTYPE** — введите значение **Updates** или **ChangeTracking**.

   ![Параметры модуля runbook Enable-MultipleSolution](media/automation-onboard-solutions/runbook-parameters.png)

1. Выберите **ОК**, чтобы выполнить задание runbook.
1. Отслеживайте ход выполнения и наличие ошибок на странице задания runbook.

## <a name="clean-up-resources"></a>Очистка ресурсов

Чтобы удалить виртуальную машину для Управления обновлениями, необходимо сделать следующее.

* В рабочей области Log Analytics удалите виртуальную машину из сохраненных поисковых запросов конфигурации области `MicrosoftDefaultScopeConfig-Updates`. Сохраненные поисковые запросы хранятся на вкладке **Общие** рабочей области.
* Удалите [Microsoft Monitoring Agent](../azure-monitor/learn/quick-collect-windows-computer.md#clean-up-resources) или [Агент Log Analytics для Linux](../azure-monitor/learn/quick-collect-linux-computer.md#clean-up-resources).

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * подключение виртуальной машины Azure вручную;
> * установка и обновление необходимых модулей Azure;
> * импорт модуля runbook, который подключает виртуальные машины Azure;
> * запуск модуля runbook, который автоматически подключает виртуальные машины Azure.

Перейдите по ссылке для получения дополнительных сведений о планировании модулей runbook.

> [!div class="nextstepaction"]
> [Создание расписания для модулей runbook](automation-schedules.md)
