---
title: Обработка ошибок в графических модулях Runbook в службе автоматизации Azure
description: В этой статье описывается, как реализовать логику обработки ошибок в графических модулях Runbook в службе автоматизации Azure.
services: automation
ms.subservice: process-automation
ms.date: 03/16/2018
ms.topic: conceptual
ms.openlocfilehash: f1aa605b3e6f32b260ea4a9eee9c056277fcd12d
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "79367080"
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a>Обработка ошибок в графических модулях Runbook в службе автоматизации Azure

Ключевым принципом разработки для графического модуля Runbook службы автоматизации Azure является идентификация проблем, которые могут возникнуть во время выполнения модуля Runbook. например состояние успеха, состояния ожидаемых ошибок и условия непредвиденных ошибок.

Часто при возникновении неустранимой ошибки, возникающей при выполнении действия Runbook, Windows PowerShell обрабатывает это действие, обрабатывая любое следующее действие, независимо от ошибки. Ошибка, вероятнее всего, вызовет исключение, но следующее действие по-прежнему может быть выполнено.

Графический модуль Runbook должен включать код обработки ошибок для решения проблем с выполнением. Для проверки выходных данных действия или обработки ошибки можно использовать действие кода PowerShell, определить условную логику для выходной ссылки действия или применить другой метод.

Графические модули runbook службы автоматизации Azure теперь включают возможность обработки ошибок. Теперь можно преобразовывать исключения в устранимые ошибки и создавать ссылки ошибок между действиями. Улучшенный процесс позволяет модулю Runbook перехватывать ошибки и управлять реализованными или непредвиденными условиями. 

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Инструкции по установке модуля Az в гибридной рабочей роли Runbook см. в статье об [установке модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0). Чтобы обновить модули в учетной записи службы автоматизации, см. руководство по [обновлению модулей Azure PowerShell в службе автоматизации Azure](automation-update-azure-modules.md).

## <a name="powershell-error-types"></a>Типы ошибок PowerShell

Типы ошибок PowerShell, которые могут возникать во время выполнения модуля Runbook, завершаются ошибками и устранимыми ошибками.
 
### <a name="terminating-error"></a>Ошибка прерывания

Устранимая ошибка — это серьезная ошибка во время выполнения, которая полностью останавливает выполнение команды или скрипта. К примерам относятся несуществующие командлеты, синтаксические ошибки, препятствующие запуску командлета, и другие неустранимые ошибки.

### <a name="non-terminating-error"></a>Неустранимая ошибка

Неустранимая ошибка — это несерьезная ошибка, которая позволяет продолжить выполнение, несмотря на состояние ошибки. К примерам относятся ошибки, связанные с ошибками, например файлы, не найденные, и проблемы с разрешениями.

## <a name="when-to-use-error-handling"></a>Применение обработки ошибок

Используйте обработку ошибок в модуле Runbook, когда критическое действие вызывает ошибку или исключение. Важно предотвратить обработку следующего действия в модуле Runbook и соответствующим образом обработать ошибку. Обработка ошибки особенно важна, если модули Runbook поддерживают бизнес-процессы или операции службы.

Для каждого действия, которое может вызвать ошибку, можно добавить ссылку на ошибку, указывающую на любое другое действие. Действие назначения может иметь любой тип, включая действие кода, вызов командлета, вызов другого модуля Runbook и т. д. Конечное действие также может иметь исходящие ссылки (обычные или ссылки ошибок). Ссылки позволяют модулю Runbook реализовать сложную логику обработки ошибок, не прибегая к действиям с кодом.

Рекомендуется создать выделенный модуль Runbook для обработки ошибок с общей функциональностью, но этот подход не является обязательным. Например, рассмотрим модуль Runbook, который пытается запустить виртуальную машину и установить на ней приложение. Если виртуальная машина запускается неправильно, она выполняет следующие действия:

1. Отправляет уведомление об этой проблеме.
2. Запускает другой модуль Runbook, который автоматически подготавливает новую виртуальную машину.

Одно из решений — наличие ссылки на ошибку в модуле Runbook, указывающего на действие, которое обрабатывает шаг 1. Например, модуль Runbook может подключить `Write-Warning` командлет к действию на шаге 2, например командлет [Start-азаутоматионрунбук](https://docs.microsoft.com/powershell/module/az.automation/start-azautomationrunbook?view=azps-3.5.0) .

Это поведение можно также обобщить для использования во многих модулях Runbook, поместив эти два действия в отдельный модуль обработки ошибок. Прежде чем исходный модуль Runbook вызовет эту ошибку при обработке модуля Runbook, он может создать пользовательское сообщение из его данных, а затем передать его в качестве параметра в Runbook обработки ошибок.

## <a name="how-to-use-error-handling"></a>Способы использования обработки ошибок

Каждое действие в модуле Runbook имеет параметр конфигурации, который включает исключения в неустранимые ошибки. Эта функция отключена по умолчанию. Рекомендуется включить этот параметр для всех действий, в которых модуль Runbook обрабатывает ошибки. Этот параметр гарантирует, что модуль Runbook будет обрабатывать как завершающие, так и неустранимые ошибки в действии как неустранимые ошибки, используя ссылку на ошибку.  

После включения параметра конфигурации необходимо создать в модуле Runbook действие, которое обрабатывает ошибку. Если действие приводит к возникновению ошибки, соблюдаются ссылки на исходящие ошибки. Обычные ссылки не соблюдаются, даже если действие также создает обычные выходные данные.<br><br> ![Пример ссылки ошибки в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/error-link-example.png)

В следующем примере модуль Runbook получает переменную, которая содержит имя компьютера виртуальной машины. Затем он пытается запустить виртуальную машину со следующим действием.<br><br> ![Пример обработки ошибок Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

`Get-AutomationVariable` Действие и командлет [Start-AzVM](https://docs.microsoft.com/powershell/module/Az.Compute/Start-AzVM?view=azps-3.5.0) настраиваются для преобразования исключений в ошибки. Если при получении переменной или запуске виртуальной машины возникли проблемы, код создает ошибки.<br><br> ![Параметры](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)действий обработки ошибок модуля Runbook службы автоматизации.

Ссылки на ошибки передаются из этих действий `error management` в одно действие кода. Это действие настраивается с помощью простого выражения PowerShell, которое `throw` использует ключевое слово для отмены обработки `$Error.Exception.Message` вместе с для получения сообщения, описывающего текущее исключение.<br><br> ![Пример кода для обработки ошибок модуля Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)

## <a name="next-steps"></a>Дальнейшие шаги

* Дополнительные сведения о ссылках и их типах в графических модулях Runbook см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md#links-and-workflow).

* Дополнительные сведения о выполнении модулей Runbook, наблюдении за заданиями Runbook и другие технические сведения см. [в разделе Выполнение Runbook в службе автоматизации Azure](automation-runbook-execution.md).