---
title: Обработка ошибок в графических модулях Runbook в службе автоматизации Azure
description: В этой статье описывается, как реализовать логику обработки ошибок в графических модулях Runbook в службе автоматизации Azure.
services: automation
ms.subservice: process-automation
ms.date: 03/16/2018
ms.topic: conceptual
ms.openlocfilehash: f1aa605b3e6f32b260ea4a9eee9c056277fcd12d
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79367080"
---
# <a name="error-handling-in-azure-automation-graphical-runbooks"></a>Обработка ошибок в графических модулях Runbook в службе автоматизации Azure

Ключевым принципом проектирования для графического runbook Azure Automation является выявление проблем, с которыми может столкнуться runbook во время выполнения. например состояние успеха, состояния ожидаемых ошибок и условия непредвиденных ошибок.

Часто, если происходит ошибка, не прекращающаяся, windows PowerShell обрабатывает действие, обрабатывая любые действия, которые последуют, независимо от ошибки. Ошибка, вероятнее всего, вызовет исключение, но следующее действие по-прежнему может быть выполнено.

Графический runbook должен включать код обработки ошибок для решения проблем с исполнением. Для проверки вывода действия или обработки ошибки можно использовать действие кода PowerShell, определить условную логику на выходном звене действия или применить другой метод.

Графические модули runbook службы автоматизации Azure теперь включают возможность обработки ошибок. Теперь можно преобразовывать исключения в устранимые ошибки и создавать ссылки ошибок между действиями. Улучшенный процесс позволяет runbook ловить ошибки и управлять реализованными или неожиданными условиями. 

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Для инструкций по установке модуля Az на гибридном Runbook Worker [см.](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0) Для учетной записи Автоматизация вы можете обновить свои модули до последней версии, используя [как обновить модули Azure PowerShell в Azure Automation.](automation-update-azure-modules.md)

## <a name="powershell-error-types"></a>Типы ошибок PowerShell

Типы ошибок PowerShell, которые могут возникать при выполнении runbook, прекращают ошибки и ошибки, не прекращающиеся.
 
### <a name="terminating-error"></a>Ошибка прекращения

Ошибка прекращения — это серьезная ошибка во время выполнения, которая полностью останавливает выполнение команды или скрипта. Примеры включают в себя несуществующие cmdlets, ошибки синтаксиса, которые предотвращают смдлет от работы, и другие фатальные ошибки.

### <a name="non-terminating-error"></a>Ошибка непрекращения

Ошибка, не прекращающаяся, является несерьезной ошибкой, которая позволяет продолжить выполнение, несмотря на условие ошибки. Примеры включают операционные ошибки, такие как файл не найденных ошибок и проблем с разрешениями.

## <a name="when-to-use-error-handling"></a>Применение обработки ошибок

Используйте обработку ошибок в runbook, когда критическая деятельность бросает ошибку или исключение. Важно предотвратить обработку следующего действия в runbook и надлежащим образом урегулировать ошибку. Обработка ошибки особенно важна, когда ваши runbooks поддерживают процесс бизнес-операций или сервисных операций.

Для каждого действия, которое может привести к ошибке, можно добавить ссылку на ошибку, указывающую на любое другое действие. Направление действия могут быть любого типа, включая действие кода, вызов cmdlet, вызов другого runbook и так далее. Активность назначения также может иметь исходящие ссылки, регулярные или ссылки на ошибку. Ссылки позволяют runbook реализовывать сложную логику обработки ошибок, не прибегая к действию кода.

Рекомендуемая практика заключается в создании специального запуска для обработки ошибок с общей функциональностью, но эта практика не является обязательной. Например, рассмотрим запуск, который пытается запустить виртуальную машину и установить на нее приложение. Если VM не начинает сят в правильном направлении, он:

1. Отправляет уведомление об этой проблеме.
2. Запускает другой runbook, который автоматически предусматривает новый VM вместо.

Одним из решений является иметь ссылку на ошибку в runbook, указывающую на деятельность, которая обрабатывает первый шаг. Например, запуск может подключить `Write-Warning` cmdlet к действию для вогогошага, например, [к cmdlet Start-AzAutomationRunbook.](https://docs.microsoft.com/powershell/module/az.automation/start-azautomationrunbook?view=azps-3.5.0)

Вы также можете обобщить это поведение для использования во многих runbooks, поместив эти два действия в отдельную книгу обработки ошибок. Прежде чем ваш оригинальный runbook вызывает эту обработку ошибок runbook, он может построить пользовательское сообщение из своих данных, а затем передать его в качестве параметра для обработки ошибок runbook.

## <a name="how-to-use-error-handling"></a>Способы использования обработки ошибок

Каждое действие в беговой книге имеет настройку конфигурации, которая превращает исключения в ошибки, не прекращающиеся. Эта функция отключена по умолчанию. Мы рекомендуем включить эту настройку на любой деятельности, где ваша книга обрабатывает ошибки. Эта настройка гарантирует, что runbook обрабатывает как прекращение, так и непрекращающиеся ошибки в деятельности как ошибки, не прекращающиеся, используя ссылку на ошибку.  

После включения настройки конфигурации пусть в runbook создадут действие, обрабатывающее ошибку. Если действие приводит к ошибке, следует исходящие ссылки на ошибку. Регулярные ссылки не следуют, даже если деятельность производит регулярные производства, а также.<br><br> ![Пример ссылки ошибки в модуле Runbook службы автоматизации](media/automation-runbook-graphical-error-handling/error-link-example.png)

В следующем примере в беговой книге извлекается переменная, содержащая имя компьютера VM. Затем он пытается начать VM со следующей деятельностью.<br><br> ![Пример обработки ошибок в беговой книге автоматизации](media/automation-runbook-graphical-error-handling/runbook-example-error-handling.png)<br><br>      

Действие `Get-AutomationVariable` и cmdlet [Start-AzVM](https://docs.microsoft.com/powershell/module/Az.Compute/Start-AzVM?view=azps-3.5.0) настроены для преобразования исключений в ошибки. При проблемах с получением переменной или запуском VM код генерирует ошибки.<br><br> ![Автоматизация параметров обработки](media/automation-runbook-graphical-error-handling/activity-blade-convertexception-option.png)ошибок runbook.

Ссылки на ошибку перетекают из этих действий в одно `error management` действие кода. Это действие настроено с помощью простого `throw` выражения PowerShell, которое использует ключевое слово, чтобы остановить обработку, а `$Error.Exception.Message` также получить сообщение, описывающие текущее исключение.<br><br> ![Пример обработки ошибок в работе с системой автоматизации runbook](media/automation-runbook-graphical-error-handling/runbook-example-error-handling-code.png)

## <a name="next-steps"></a>Дальнейшие действия

* Дополнительные сведения о ссылках и их типах в графических модулях Runbook см. в статье [Графическая разработка в службе автоматизации Azure](automation-graphical-authoring-intro.md#links-and-workflow).

* Чтобы узнать больше о выполнении Runbook, мониторинге заданий runbook и других технических деталях, [см.](automation-runbook-execution.md)