---
title: Сведения о том, как на нескольких виртуальных машинах подключить решения из Службы автоматизации Azure для управления обновлениями, отслеживания изменений и инвентаризации
description: Сведения о том, как на виртуальной машине Azure подключить решения для управления обновлениями, отслеживания изменений и инвентаризации, входящие в состав службы автоматизации Azure
services: automation
ms.date: 04/11/2019
ms.topic: article
ms.custom: mvc
ms.openlocfilehash: f5f18e9365b09f06c1bd4f25a8efe909cc308dad
ms.sourcegitcommit: 31ef5e4d21aa889756fa72b857ca173db727f2c3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81537021"
---
# <a name="enable-update-management-change-tracking-and-inventory-solutions-on-multiple-vms"></a>Подключение решений для управления обновлениями, отслеживания изменений и инвентаризации на нескольких виртуальных машинах

Служба автоматизации Azure предоставляет решения для управления обновлениями безопасности операционной системы, отслеживания изменений и инвентаризации компонентов, установленных на компьютерах. Существует несколько способов подключения решений на виртуальных машинах: [непосредственно на виртуальной машине](automation-onboard-solutions-from-vm.md), [в учетной записи Службы автоматизации](automation-onboard-solutions-from-automation-account.md), в окне со списком виртуальных машин и с помощью [модуля runbook](automation-onboard-solutions.md). В этой статье рассматривается подключение таких решений в окне со списком виртуальных машин Azure.

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите в Azure (https://portal.azure.com).

## <a name="enable-solutions"></a>включение решений;

На портале Azure перейдите в раздел **Виртуальные машины**.

Используя флажки, выберите виртуальные машины, на которых нужно подключить решения для управления обновлениями, отслеживания изменений или инвентаризации. Одновременно можно подключить не более трех групп ресурсов. Вазовые вм" могут существовать в любом регионе независимо от местонахождения вашей учетной записи автоматизации.

![Список виртуальных машин](media/automation-onboard-solutions-from-browse/vmlist.png)
> [!TIP]
> Отфильтруйте список виртуальных машин, а затем установите верхний флажок, чтобы выбрать все виртуальные машины в отфильтрованном списке.

На панели команд щелкните **Службы** и выберите **Отслеживание изменений**, **Учет** или **Управление обновлениями**.

> [!NOTE]
> Отслеживание изменений и инвентаризации используют одно и то же решение. Когда один включен, другой включен, а также.

На рисунке ниже выбрано управление обновлениями. Отслеживание изменений и инвентаризация имеют одинаковую планировку и поведение.

В списке виртуальных машин отображаются только те виртуальные машины, которые находятся в одной и той же подписке и в том же расположении. Если виртуальные машины находятся в более чем трех группах ресурсов, будут выбраны первые три группы.

### <a name="onboarding-limitations"></a><a name="resource-group-limit"></a>Ограничения подключения

Для количества групп ресурсов для подключения установлены [ограничения развертывания Resource Manager](../azure-resource-manager/templates/cross-resource-group-deployment.md). Развертывание диспетчера ресурсов, не следует путать с развертыванием обновлений, ограничено 5 группами ресурсов в разбивке. Чтобы обеспечить целостность подключения, 2 группы зарезервированы для настройки рабочей области Log Analytics, учетной записи службы автоматизации и связанных ресурсов. Для развертывания можно выбрать 3 оставшиеся группы. Это ограничение распространяется только на одновременный борт, а не на количество групп ресурсов, которыми можно управлять с помощью решения Automation.

Вы также можете использовать runbook для посадки, для получения дополнительной информации, [см. бортовое обновление и изменение решений отслеживания Azure Automation.](automation-onboard-solutions.md)

С помощью фильтров выберите виртуальные машины из разных подписок, расположений и групп ресурсов.

![Подключение решения для управления обновлениями](media/automation-onboard-solutions-from-browse/onboardsolutions.png)

Просмотрите выбор рабочего пространства и учетной записи Log Analytics. По умолчанию выбрана существующая рабочая область и учетная запись Службы автоматизации. Если вы хотите использовать другую рабочую область Log Analytics и учетную запись службы автоматизации, щелкните флажок **Настраиваемая** и выберите нужный вариант в окне **Настраиваемая конфигурация**. После выбора рабочей области Log Analytics выполняется проверка, чтобы определить, связана ли рабочая область с учетной записью службы автоматизации. Если связь установлена, отобразится следующее. По завершении нажмите кнопку **ОК**.

![Выбор рабочей области и учетной записи](media/automation-onboard-solutions-from-browse/selectworkspaceandaccount.png)

Если связь с учетной записью не установлена, отобразится показанный ниже экран. Выберите учетную запись Службы автоматизации и по завершении нажмите кнопку **ОК**.

![Рабочая область отсутствует](media/automation-onboard-solutions-from-browse/no-workspace.png)

> [!NOTE]
> При включении решений только определенные регионы поддерживают связывание рабочей области Log Analytics и учетной записи службы автоматизации.
>
> Список поддерживаемых пар отображения можно узнать на [сайте Region mapping для автоматизации учетной записи и рабочего пространства log Analytics.](how-to/region-mappings.md)

Если какую-то виртуальную машину не нужно подключать, снимите флажок рядом с ее именем. Если виртуальную машину подключить невозможно, флажок рядом с ее именем стоять не будет.

Нажмите кнопку **Включить**, чтобы включить решение. Процесс включения решения может занять до 15 минут.

## <a name="unlink-workspace"></a>Удаление связи с рабочей областью

Следующие решения зависят от рабочей области Log Analytics:

* [Управление обновлениями](automation-update-management.md)
* [Отслеживание изменений](automation-change-tracking.md)
* [Запуск/остановка ВМ в нерабочее время](automation-solution-vm-management.md)

Если вы решите, что больше не хотите интегрировать учетную запись Автоматизации в рабочее пространство Log Analytics, вы можете отсоединить свою учетную запись непосредственно с портала Azure. Прежде чем продолжить, необходимо удалить решения, которые упоминались ранее. Иначе вы не сможете выполнить эту процедуру. Найдите в статье решение, которое вы импортировали, чтобы узнать, как его удалить.

Удалив эти решения, выполните следующие действия, чтобы отменить привязку учетной записи службы автоматизации.

> [!NOTE]
> Некоторые решения, в том числе решения для мониторинга Azure SQL более ранних версий, могли создать ресурсы службы автоматизации. Их также потребуется удалить, прежде чем удалить связь с рабочей областью.

1. На портале Azure откройте свою учетную запись службы автоматизации и на странице этой учетной записи выберите **Связанная рабочая область** в разделе **Связанные ресурсы** слева.

2. На странице "Отмена связи с рабочей областью" нажмите кнопку **Отменить связь с рабочей областью**.

   ![Страница "Отмена связи с рабочей областью"](media/automation-onboard-solutions-from-browse/automation-unlink-workspace-blade.png).

   Появится запрос на подтверждение удаления.

3. Пока служба автоматизации Azure пытается отменить привязку учетной записи к рабочей области Log Analytics, вы можете отслеживать ход выполнения этой задачи в меню **Уведомления**.

Если вы используете решение управления обновлениями, при необходимости можно удалить следующие элементы, которые больше не нужны после удаления решения.

* Обновление расписаний. Каждый элемент имеет имя, которое соответствует созданному вами развертыванию обновления.

* Группы гибридных рабочих ролей, созданные для решения. Каждая группа будет иметь приблизительно такое имя: machine1.contoso.com_9ceb8108-26c9-4051-b6b3-227600d715c8.

Если вы используете решение запуска и остановки виртуальных машин в нерабочее время, при необходимости можно удалить следующие элементы, которые больше не нужны после удаления решения.

* Расписание запуска и остановки виртуальной машины.
* Рабочие роли Runbook запуска и остановки виртуальной машины.
* Переменные

Кроме того, вы также можете отсоединить рабочее пространство из учетной записи автоматизации из рабочего пространства Log Analytics. В рабочем пространстве выберите **учетную запись автоматизации** под **соответствующими ресурсами.** На странице учетной записи автоматизации выберите **учетную запись Unlink.**

## <a name="troubleshooting"></a>Устранение неполадок

При посадке нескольких машин, могут быть `Cannot enable`машины, которые показывают, как . У этого могут быть разные причины. Следующие разделы показывают `Cannot enable` возможные причины для состояния на VM при попытке на борту.

### <a name="vm-reports-to-a-different-workspace-workspacename--change-configuration-to-use-it-for-enabling"></a>Виртуальная машина относится к другой рабочей области: \<имя рабочей области\>.  Чтобы подключить виртуальную машину, измените ее конфигурацию

**Причина**. Эта ошибка показывает, что виртуальная машина, которую вы пытаетесь подключить, относится к другой рабочей области.

**Решение**: Нажмите **Использовать в качестве конфигурации,** чтобы изменить целевую учетную запись автоматизации и лог Аналитика рабочего пространства.

### <a name="vm-reports-to-a-workspace-that-is-not-available-in-this-subscription"></a>Виртуальная машина относится к рабочей области, которая недоступна в этой подписке

**Причина**. Причин может быть несколько:

* рабочая область находится в другой подписке;
* рабочая область больше не существует;
* рабочая область находится в группе ресурсов, к которой у вас нет доступа.

**Решение**. Найдите учетную запись Службы автоматизации, связанную с рабочей областью, к которой относится виртуальная машина, и подключите виртуальную машину, изменив область конфигурации.

### <a name="vm-operating-system-version-or-distribution-is-not-supported"></a>Версия или дистрибутив операционной системы виртуальной машины не поддерживается

**Причина**. Не все дистрибутивы Linux и версии Windows поддерживают выбранное решение.

**Решение**. См. [список клиентов](automation-update-management.md#clients), которые поддерживает это решение.

### <a name="classic-vms-cannot-be-enabled"></a>Невозможно подключить классические виртуальные машины

**Причина**. Виртуальные машины, использующие классическую модель развертывания, не поддерживаются.

**Решение:** Перенос виртуальной машины в модель развертывания диспетчера ресурсов. Сведения о том, как это сделать, см. в статье [Поддерживаемый платформой перенос ресурсов IaaS из классической модели в модель Azure Resource Manager](../virtual-machines/windows/migration-classic-resource-manager-overview.md).

### <a name="vm-is-stopped-deallocated"></a>Виртуальная машина остановлена (освобождена)

**Причина**. Виртуальная машина не находится в состоянии **Работает**.

**Решение**. Чтобы подключить виртуальную машину к решению, машина должна работать. Щелкните **Запустить ВМ**, чтобы запустить виртуальную машину, не покидая страницы.

## <a name="clean-up-resources"></a>Очистка ресурсов

Чтобы удалить виртуальную машину для Управления обновлениями, необходимо сделать следующее.

* В рабочей области Log Analytics удалите виртуальную машину из сохраненных поисковых запросов конфигурации области `MicrosoftDefaultScopeConfig-Updates`. Сохраненные поисковые запросы хранятся на вкладке **Общие** рабочей области.
* Удалите [агент log Analytics для Windows](../azure-monitor/learn/quick-collect-windows-computer.md#clean-up-resources) или агента log Analytics для [Linux.](../azure-monitor/learn/quick-collect-linux-computer.md#clean-up-resources)

## <a name="next-steps"></a>Следующие шаги

Теперь, когда решение включено для ваших виртуальных машин, посетите статью обзора управления обновлением, чтобы узнать, как создать **развертывание обновлений** для ваших машин.

> [!div class="nextstepaction"]
> [Управление обновлениями - Управление обновлениями и исправлениями для вс-под управления Azure](./automation-tutorial-update-management.md)

Дополнительные руководства по решениям и сведения о работе с ними:

* [Управление обновлениями Windows в службе автоматизации Azure](automation-tutorial-update-management.md)

* [Получение данных об установленном программном обеспечении на виртуальных машинах Azure и других компьютерах](automation-tutorial-installed-software.md)

* [Устранение неполадок при изменениях в среде](automation-tutorial-troubleshoot-changes.md)
