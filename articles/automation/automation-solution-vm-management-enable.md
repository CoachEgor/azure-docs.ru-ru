---
title: Включение запуска и остановки виртуальных машин службы автоматизации Azure в течение нерабочее время
description: В этой статье описывается, как включить решение "Запуск и завершение" для виртуальной машины службы автоматизации Azure для виртуальных машин Azure.
services: automation
ms.subservice: process-automation
ms.date: 04/01/2020
ms.topic: conceptual
ms.openlocfilehash: d47daa29c65f847fdeb33b9e24a892ac1f31b52a
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82096968"
---
# <a name="enable-azure-automation-startstop-vms-solution"></a>Включение решения "Запуск и завершение работы службы автоматизации Azure"

Чтобы добавить **Запуск и остановка виртуальных машин в нерабочее время** решение в новую или существующую учетную запись службы автоматизации и связанную log Analytics рабочую область, выполните следующие действия. После завершения процесса адаптации настройте переменные для настройки решения.

>[!NOTE]
>Чтобы использовать это решение с классическими виртуальными машинами, требуется Классическая учетная запись запуска от имени, которая не создается по умолчанию. Инструкции по созданию классической учетной записи запуска от имени см. в статье [Создание классической учетной записи запуска от имени](automation-create-standalone-account.md#create-a-classic-run-as-account).
>

## <a name="enable-solution"></a>Включение решения

1. Войдите на [портал](https://portal.azure.com)Azure.

2. Найдите и выберите **учетные записи службы автоматизации**.

3. На странице учетные записи службы автоматизации выберите учетную запись службы автоматизации из списка.

4. В учетной записи службы автоматизации выберите **Пуск/останавливает виртуальную машину** в разделе **связанные ресурсы**. На этой странице можно щелкнуть **Дополнительные сведения и включение решения**. Если решение для запуска и остановки виртуальных машин уже развернуто, щелкните **Настройка решения** и найдите его в списке.

   ![Включение из учетной записи службы автоматизации](./media/automation-solution-vm-management/enable-from-automation-account.png)

   > [!NOTE]
   > Это решение также можно развернуть из любого места на портале Azure, щелкнув **Создать ресурс**. На странице "Marketplace" введите ключевое слово, например **Start** или **Start/Stop**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Кроме того, можно ввести одно или несколько ключевых слов из полного имени решения и нажать клавишу ВВОД. Выберите **Запуск и остановка виртуальных машин в нерабочее время** в результатах поиска.

5. На странице **Запуск и остановка виртуальных машин в нерабочее время** просмотрите сводные данные о выбранном решении и щелкните **Создать**.

   ![Портал Azure](media/automation-solution-vm-management/azure-portal-01.png)

6. Появится страница Добавление решения. Вам будет предложено настроить решение, прежде чем импортировать его в подписку службы автоматизации.

   ![Страница "Добавление решения" в решении по управлению виртуальными машинами](media/automation-solution-vm-management/azure-portal-add-solution-01.png)

7. На странице Добавление решения выберите **Рабочая область**. Выберите рабочую область Log Analytics, связанную с подпиской Azure, в которой находится учетная запись службы автоматизации. Если у вас нет рабочей области, выберите **Создать рабочую область**. На странице Log Analytics Рабочая область выполните следующие действия.

   - Укажите имя новой рабочей области Log Analytics, например **контосолаворкспаце**.
   - Выберите **подписку** для связи, выбрав ее из раскрывающегося списка, если выбранное по умолчанию значение не подходит.
   - В качестве **группы ресурсов** можно использовать имеющуюся группу или создать новую.
   - Выберите **Расположение**.
   - Выберите **ценовую категорию**. Выберите параметр **За ГБ (отдельный)**. В журналах Azure Monitor обновлены [цены](https://azure.microsoft.com/pricing/details/log-analytics/) , а уровень "на ГБ" является единственным вариантом.

   > [!NOTE]
   > При включении решений поддерживаются только определенные регионы для связывания рабочей области Log Analytics и учетной записи службы автоматизации.
   >
   > Список поддерживаемых пар сопоставлений см. в разделе [сопоставление регионов для учетной записи службы автоматизации и log Analytics рабочей области](how-to/region-mappings.md).

8. Указав необходимые сведения на странице Рабочая область Log Analytics, щелкните **Создать**. Вы можете отслеживать ход выполнения, выбрав в меню **Уведомления**. После завершения вновь отобразится страница Добавление решения.

9. На странице Добавление решения выберите **Учетная запись службы автоматизации**. При создании новой рабочей области Log Analytics можно создать новую учетную запись службы автоматизации, которая будет связана с ней, или выбрать существующую учетную запись службы автоматизации, которая еще не связана с Log Analytics рабочей областью. Выберите существующую учетную запись службы автоматизации или щелкните **создать учетную запись службы**автоматизации, а затем на странице Добавление учетной записи службы автоматизации укажите следующие сведения.
 
   - В поле **Имя** введите имя учетной записи службы автоматизации.

     Все остальные параметры заполняются автоматически в зависимости от выбранной рабочей области Log Analytics. Эти параметры невозможно изменить. По умолчанию проверка подлинности модулей Runbook, добавленных в это решение, осуществляется с помощью учетной записи запуска от имени Azure. Нажмите кнопку **ОК**, чтобы проверить параметры конфигурации и создать учетную запись службы автоматизации. Ход создания можно просмотреть в разделе **Уведомления** в меню.

10. Наконец, на странице Добавление решения выберите **Конфигурация**. Появится страница Параметры.

    ![Страница "Параметры" решения](media/automation-solution-vm-management/azure-portal-add-solution-02.png)

   В ней будет предложено выполнить следующие действия.
  
   - Укажите значение **Target ResourceGroup Names** (Имена целевых групп ресурсов). Это имена групп ресурсов с виртуальными машинами, которыми должно управлять данное решение. Вы можете указать несколько имен, используя в качестве разделителя запятые (в именах не учитывается регистр). Если необходимо использовать виртуальные машины во всех группах ресурсов в рамках подписки, используйте подстановочный знак. Это значение хранится в переменных **External_Start_ResourceGroupNames** и **External_Stop_ResourceGroupNames**.
  
   - Укажите значение **VM Exclude List (string)** (Список исключаемых виртуальных машин (строка)). Это список, содержащий одну или несколько виртуальных машин из целевой группы ресурсов. Вы можете указать несколько имен, используя в качестве разделителя запятые (в именах не учитывается регистр). Поддерживается использование подстановочных знаков. Это значение хранится в переменной **External_ExcludeVMNames**.
  
   - Выберите значение **Расписание**. Выберите дату и время для расписания. Будет создано повторяющееся ежедневное расписание, начиная с выбранного времени. Выбрать другой регион невозможно. Чтобы настроить для расписания использование конкретного часового пояса после настройки решения, ознакомьтесь с разделом [Изменение расписания запуска и завершения работы](automation-solution-vm-management-config.md#modify-the-startup-and-shutdown-schedules).
  
   - Чтобы получать **уведомления по электронной почте** от группы действий, оставьте значение по умолчанию **Да** и укажите допустимый адрес электронной почты. Если вы указали значение **Нет**, но впоследствии решили, что вы хотите получать уведомления по электронной почте, то вы можете изменить [группу действий](../azure-monitor/platform/action-groups.md), созданную с допустимыми адресами электронной почты, разделенными запятыми. Кроме того, необходимо включить такие правила генерации оповещений:

     - AutoStop_VM_Child
     - Scheduled_StartStop_Parent
     - Sequenced_StartStop_Parent

     > [!IMPORTANT]
     > Значение по умолчанию **Target ResourceGroup Names** (Имена целевых групп ресурсов) — **&ast;**. Оно охватывает все виртуальные машины в подписке. Если вы не хотите, чтобы решение было нацелено на все виртуальные машины в подписке, это значение необходимо обновить, указав список имен групп ресурсов, прежде чем включать расписания.

11. Завершив начальную настройку обязательных параметров решения, нажмите кнопку **ОК**, чтобы закрыть страницу Параметры, и щелкните **Создать**. 

После проверки всех параметров решение будет развернуто в вашей подписке. Этот процесс может занять несколько секунд. Ход его выполнения можно просмотреть в разделе меню **Уведомления**.

> [!NOTE]
> Если у вас есть подписка поставщика облачных решений Azure (Azure CSP), после завершения развертывания в учетной записи службы автоматизации перейдите к **переменным** в разделе **Общие ресурсы** и задайте для переменной [External_EnableClassicVMs](automation-solution-vm-management.md#variables) **значение false**. Это предотвратит поиск ресурсов в классической виртуальной машине со стороны решения.

## <a name="next-steps"></a>Дальнейшие шаги

Теперь, когда решение включено, его можно [настроить](automation-solution-vm-management-config.md) для поддержки требований управления виртуальной машиной.