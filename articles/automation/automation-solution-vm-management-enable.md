---
title: Включить решение Start/Stop VMs в нерабочее время
description: В этой статье описывается, как включить решение Azure Automation Start/Stop VM для виртуальных машин Azure.
services: automation
ms.subservice: process-automation
ms.date: 04/01/2020
ms.topic: conceptual
ms.openlocfilehash: 7b619d3c9b4b334e637d6a1c456256cb33ad5134
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81261386"
---
# <a name="enable-azure-startstop-vms-solution"></a>Включить решение Azure Start/Stop VMs

Выполните следующие шаги, чтобы добавить Start/Stop VMs в нерабочее время решения для новой или существующей учетной записи автоматизации и связаны журнал Analytics рабочего пространства. После завершения процесса посадки на работу настройте переменные для настройки решения.

>[!NOTE]
>Чтобы использовать это решение с помощью Классических VMs, вам нужна учетная запись Classic Run As, которая не создается по умолчанию. Для получения инструкций по созданию учетной записи Classic Run As [см.](automation-create-standalone-account.md#create-a-classic-run-as-account)
>

## <a name="enable-solution"></a>Включение решения

1. Войти на [портал](https://portal.azure.com)Azure .

2. Поиск и выбор **учетных записей автоматизации.**

3. На странице **учетных записей автоматизации** выберите учетную запись Автоматизации из списка.

4. Из учетной записи автоматизации выберите **Start/Stop VM** под **соответствующими ресурсами.** На этой странице можно щелкнуть **Дополнительные сведения и включение решения**. Если решение для запуска и остановки виртуальных машин уже развернуто, щелкните **Настройка решения** и найдите его в списке.

   ![Включение из учетной записи службы автоматизации](./media/automation-solution-vm-management/enable-from-automation-account.png)

   > [!NOTE]
   > Это решение также можно развернуть из любого места на портале Azure, щелкнув **Создать ресурс**. На странице "Marketplace" введите ключевое слово, например **Start** или **Start/Stop**. Как только вы начнете вводить символы, список отфильтруется соответствующим образом. Кроме того, можно ввести одно или несколько ключевых слов из полного имени решения и нажать клавишу ВВОД. Выберите **Запуск и остановка виртуальных машин в нерабочее время** в результатах поиска.

5. На странице **Запуск и остановка виртуальных машин в нерабочее время** просмотрите сводные данные о выбранном решении и щелкните **Создать**.

   ![Портал Azure](media/automation-solution-vm-management/azure-portal-01.png)

6. Появится страница **Добавление решения**. В ней будет предложено настроить решение перед его импортом в подписку службы автоматизации.

   ![Страница "Добавление решения" в решении по управлению виртуальными машинами](media/automation-solution-vm-management/azure-portal-add-solution-01.png)

7. На странице **Добавление решения** выберите **Рабочая область**. Выберите рабочую область Log Analytics, связанную с подпиской Azure, в которой находится учетная запись службы автоматизации. Если у вас нет рабочей области, выберите **Создать рабочую область**. На странице **рабочего пространства Log Analytics** выполните следующие действия:

   - Укажите имя для нового **рабочего пространства Log Analytics,** например "ContosoLAWorkspace".
   - Выберите **подписку** для ссылки, выбрав из списка выпадающих, если выбранный по умолчанию не подходит.
   - В качестве **группы ресурсов** можно использовать имеющуюся группу или создать новую.
   - Выберите **местоположение**.
   - Выберите **уровень ценообразования.** Выберите параметр **За ГБ (отдельный)**. В журналах Azure Monitor обновились [цены,](https://azure.microsoft.com/pricing/details/log-analytics/) и уровень Per GB является единственным вариантом.

   > [!NOTE]
   > При включении решений только определенные регионы поддерживают связывание рабочей области Log Analytics и учетной записи службы автоматизации.
   >
   > Список поддерживаемых пар отображения можно узнать на [сайте Region mapping для автоматизации учетной записи и рабочего пространства log Analytics.](how-to/region-mappings.md)

8. Указав необходимые сведения на странице **Рабочая область Log Analytics**, щелкните **Создать**. Вы можете отслеживать ход выполнения, выбрав в меню **Уведомления**. После завершения вновь отобразится страница **Добавление решения**.

9. На странице **Добавление решения** выберите **Учетная запись службы автоматизации**. При создании рабочей области Log Analytics вы можете создать учетную запись службы автоматизации и связать ее с этой рабочей областью или выбрать имеющуюся учетную запись, которая уже связана с ней. Выберите имеющуюся учетную запись или щелкните **Создать учетную запись службы автоматизации** и на странице **Добавление учетной записи службы автоматизации** укажите следующие сведения:
 
   - В поле **Имя** введите имя учетной записи службы автоматизации.

     Все остальные параметры заполняются автоматически в зависимости от выбранной рабочей области Log Analytics. Эти параметры невозможно изменить. По умолчанию проверка подлинности модулей Runbook, добавленных в это решение, осуществляется с помощью учетной записи запуска от имени Azure. Нажмите кнопку **ОК**, чтобы проверить параметры конфигурации и создать учетную запись службы автоматизации. Ход создания можно просмотреть в разделе **Уведомления** в меню.

10. Наконец, на странице **Добавление решения** выберите **Конфигурация**. Появится страница **Параметры**.

    ![Страница "Параметры" решения](media/automation-solution-vm-management/azure-portal-add-solution-02.png)

   В ней будет предложено выполнить следующие действия.
  
   - Укажите значение **Target ResourceGroup Names** (Имена целевых групп ресурсов). Это имена групп ресурсов с виртуальными машинами, которыми должно управлять данное решение. Вы можете указать несколько имен, используя в качестве разделителя запятые (в именах не учитывается регистр). Если необходимо использовать виртуальные машины во всех группах ресурсов в рамках подписки, используйте подстановочный знак. Это значение хранится в переменных **External_Start_ResourceGroupNames** и **External_Stop_ResourceGroupNames**.
  
   - Укажите значение **VM Exclude List (string)** (Список исключаемых виртуальных машин (строка)). Это список, содержащий одну или несколько виртуальных машин из целевой группы ресурсов. Вы можете указать несколько имен, используя в качестве разделителя запятые (в именах не учитывается регистр). Поддерживается использование подстановочных знаков. Это значение хранится в переменной **External_ExcludeVMNames**.
  
   - Выберите значение **Расписание**. Выберите дату и время для расписания. Повторяющийся ежедневный график будет создан, начиная с выбранного времени. Выбрать другой регион невозможно. Чтобы настроить для расписания использование конкретного часового пояса после настройки решения, ознакомьтесь с разделом [Изменение расписания запуска и завершения работы](automation-solution-vm-management-config.md#modify-the-startup-and-shutdown-schedules).
  
   - Чтобы получать **уведомления по электронной почте** от группы действий, оставьте значение по умолчанию **Да** и укажите допустимый адрес электронной почты. Если вы указали значение **Нет**, но впоследствии решили, что вы хотите получать уведомления по электронной почте, то вы можете изменить [группу действий](../azure-monitor/platform/action-groups.md), созданную с допустимыми адресами электронной почты, разделенными запятыми. Кроме того, необходимо включить такие правила генерации оповещений:

     - AutoStop_VM_Child
     - Scheduled_StartStop_Parent
     - Sequenced_StartStop_Parent

     > [!IMPORTANT]
     > Значение по умолчанию **Target ResourceGroup Names** (Имена целевых групп ресурсов) — **&ast;**. Оно охватывает все виртуальные машины в подписке. Если вы не хотите, чтобы решение было нацелено на все виртуальные машины в подписке, это значение необходимо обновить, указав список имен групп ресурсов, прежде чем включать расписания.

11. Завершив начальную настройку обязательных параметров решения, нажмите кнопку **ОК**, чтобы закрыть страницу **Параметры**, и щелкните **Создать**. 

После проверки всех параметров решение будет развернуто в вашей подписке. Этот процесс может занять несколько секунд. Ход его выполнения можно просмотреть в разделе меню **Уведомления**.

> [!NOTE]
> Если у вас есть подписка на облачные решения Azure (Azure CSP) после завершения развертывания в **учетной записи** автоматизации, перейдите к переменным под **общими ресурсами** и установите [**External_EnableClassicVMs**](automation-solution-vm-management.md#variables) переменную **на False.** Это предотвратит поиск ресурсов в классической виртуальной машине со стороны решения.

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда у вас есть решение включено, вы можете [настроить](automation-solution-vm-management-config.md) его для поддержки ваших требований к управлению VM.