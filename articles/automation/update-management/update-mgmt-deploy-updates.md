---
title: Создание развертываний обновлений для службы автоматизации Azure Управление обновлениями
description: В этой статье описывается, как запланировать развертывания обновлений и просматривать их состояние.
services: automation
ms.subservice: update-management
ms.date: 08/20/2020
ms.topic: conceptual
ms.openlocfilehash: 4336ba272dd83ad2a35060c1c7524a564b928484
ms.sourcegitcommit: 6fc156ceedd0fbbb2eec1e9f5e3c6d0915f65b8e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/21/2020
ms.locfileid: "88717699"
---
# <a name="how-to-deploy-updates-and-review-results"></a>Развертывание обновлений и результатов проверки

В этой статье описывается, как запланировать развертывание обновлений и просматривать процесс после завершения развертывания.

## <a name="sign-in-to-the-azure-portal"></a>Вход на портал Azure

Войдите на [портал Azure](https://portal.azure.com)

## <a name="schedule-an-update-deployment"></a>Планирование развертывания обновлений

При планировании развертывания обновлений создается ресурс [расписания](../shared-resources/schedules.md), связанный с модулем runbook **Patch-MicrosoftOMSComputers**, который обрабатывает установку обновления на целевых компьютерах. Для установки обновлений задайте расписание развертывания, соответствующее вашему графику выпуска и периоду обслуживания. Вы можете выбрать типы обновлений, которые будут включены в развертывание. Например, можно включить только критические обновления или обновления для системы безопасности и исключить накопительные пакеты обновления.

>[!NOTE]
>Если вы удалите ресурс расписания с помощью портала Azure или PowerShell после создания развертывания, это приведет к прерыванию запланированного развертывания обновлений и ошибке при попытке повторной настройки ресурса расписания на портале. Ресурс расписания можно удалить только удалив соответствующее расписание развертывания.  

Чтобы запланировать развертывание обновлений:

1. Войдите в учетную запись службы автоматизации и выберите в области **Управление обновлениями** раздел **Управление обновлениями**. Нажмите **Запланировать развертывание обновлений**.

2. В разделе **новое развертывание обновлений**в поле **имя** введите уникальное имя для развертывания.

3. Выберите операционную систему для развертывания обновлений.

4. В области **Группы для обновления (предварительная версия)** определите запрос, объединяющий подписку, группу ресурсов, расположения и теги для создания динамической группы виртуальных машин Azure, которую нужно включить в развертывание. Узнайте, [как использовать динамические группы с Управлением обновлениями](update-mgmt-groups.md).

5. В области **Обновляемые компьютеры** выберите сохраненный поисковый запрос, импортированную группу либо нажмите в раскрывающемся меню пункт **Компьютеры** и укажите нужные компьютеры. Так вы сможете проверить готовность агента Log Analytics для каждого компьютера. Дополнительные сведения о различных способах создания групп компьютеров в журналах Azure Monitor см. в статье [Группы компьютеров в запросах к журналам Azure Monitor](../../azure-monitor/platform/computer-groups.md).

6. В области **Классификации обновлений** укажите [классификации обновлений](update-mgmt-view-update-assessments.md#work-with-update-classifications) продуктов. Для каждого продукта отмените выбор всех поддерживаемых классификаций обновлений, кроме тех, которые нужно включить в развертывание обновлений.

    Если развертывание предполагает применение только выбранного набора обновлений, необходимо отменить выбор всех предварительно выбранных классификаций обновлений при настройке параметра **включить или исключить обновления** , как описано в следующем шаге. Это гарантирует, что на целевых компьютерах будут установлены только те обновления, которые вы указали для *включения* в это развертывание.

7. Используйте регион " **включить или исключить обновления** ", чтобы добавить или исключить выбранные обновления из развертывания. На странице **включение/исключение** введите идентификаторы статей базы знаний для включения или исключения.

   > [!IMPORTANT]
   > Помните: исключения переопределяют включения. Например, если вы определите правило исключения `*`, решение "Управление обновлениями" не установит ни одного исправления и пакета, так как они все будут исключены. Исключенные исправления будут отображаться как отсутствующие на компьютере. На компьютерах под управлением Linux: если вы включите пакет с зависимым пакетом, который был исключен, решение "Управление обновлениями" не установит основной пакет.

   > [!NOTE]
   > Замененные обновления нельзя включать в развертывание.

8. Выберите **Параметры расписания**. Время начала по умолчанию — на 30 минут позднее текущего времени. В будущем можно изменить время начала на любое другое начиная с 10 минут.

9. Используйте поле **повторение** , чтобы указать, выполняется ли развертывание один раз или использует повторяющееся расписание, а затем нажмите кнопку **ОК**.

10. В области **Сценарии предварительного и последующего выполнения (предварительная версия)** выберите сценарии, которые будут выполняться до и после развертывания. Узнайте, [как управлять сценариями предварительного и последующего выполнения](update-mgmt-pre-post-scripts.md).
    
11. В поле **Период обслуживания (минуты)** укажите, сколько времени может длиться установка обновлений. При указании периода обслуживания учитывайте следующие особенности.

    * Период обслуживания определяет количество устанавливаемых обновлений.
    * Решение "Управление обновлениями" не останавливает установку новых обновлений, если приближается окончание периода обслуживания.
    * Решение "Управление обновлениями" не прекращает выполняющиеся обновления, если время периода обслуживания истекло.
    * Если период обслуживания в Windows превышен, это часто обусловлено тем, что установка пакета обновления занимает много времени.

    > [!NOTE]
    > Чтобы обновления применялись в Ubuntu только в период обслуживания, отключите в пакете `Unattended-Upgrade` автоматическое обновление. Инструкции по настройке пакета см. в разделе [Автоматические обновления](https://help.ubuntu.com/lts/serverguide/automatic-updates.html) руководства по Ubuntu Server.

12. В поле **Параметры перезагрузки** укажите, нужно ли перезагружать компьютеры при развертывании обновлений. Доступны следующие варианты: 
    * Reboot if necessary (Перезагружать при необходимости) (по умолчанию).
    * Всегда выполнять перезагрузку
    * Никогда не перезагружать
    * Только перезагрузка (без установки обновлений)

    > [!NOTE]
    > Разделы реестра, перечисленные в разделе [Registry keys used to manage restart](/windows/deployment/update/waas-restart#registry-keys-used-to-manage-restart) (Разделы реестра, используемые для управления перезапуском), могут вызвать событие перезагрузки, даже если для **параметров перезагрузки** установлено значение **Никогда не перезагружать**.

13. Завершив настройку расписания развертывания, нажмите кнопку **создать**.

    ![Панель параметров расписания обновлений](./media/update-mgmt-deploy-updates/manageupdates-schedule-win.png)

14. Вы вернетесь к панели мониторинга состояния. Чтобы посмотреть созданное расписание, выберите **Запланированные развертывания обновлений**.

## <a name="schedule-an-update-deployment-programmatically"></a>Программное планирование развертывания обновлений

Чтобы узнать, как создать развертывание обновлений с помощью REST API, ознакомьтесь со статьей [Software Update Configurations — Create](/rest/api/automation/softwareupdateconfigurations/create) (Конфигурации обновления программного обеспечения. Создание).

Развертывание еженедельного обновления можно создать с помощью примера модуля runbook. Дополнительные сведения об этом модуле runbook см. в статье [Create a weekly update deployment for one or more VMs in a resource group](https://gallery.technet.microsoft.com/scriptcenter/Create-a-weekly-update-2ad359a1) (Создание развертывания еженедельного обновления для одной или нескольких виртуальных машин в группе ресурсов).

## <a name="check-deployment-status"></a>Проверка состояния развертывания

После запуска запланированного развертывания можно контролировать его состояние на вкладке **Развертывания обновлений** раздела **Управление обновлениями**. Во время выполнения развертывания отображается состояние **Выполняется**. Когда развертывание успешно завершится, состояние изменится на **Выполнено**. В случае сбоя одного или нескольких обновлений в развертывании устанавливается состояние **Частичный сбой**.

## <a name="view-results-of-a-completed-update-deployment"></a>Просмотр результатов выполненного развертывания обновлений

После завершения развертывания можно выбрать его, чтобы увидеть его результаты.

[![Обновить панель мониторинга состояния развертывания для определенного развертывания](./media/update-mgmt-deploy-updates/manageupdates-view-results.png)](./media/update-mgmt-deploy-updates/manageupdates-view-results-expanded.png#lightbox)

В разделе **Результаты обновления** содержится сводная информация об общем количестве обновлений и результатах их развертывания на целевых виртуальных машинах. В таблице справа представлена подробная информация о каждом обновлении и результатах его установки.

Возможные значения:

* **Попытка не предпринималась**. Обновление не установлено из-за недостатка времени (т. е. слишком короткого периода обслуживания).
* **Не выбрано**. Обновление не включено в развертывание.
* **Выполнено**. Обновление успешно установлено.
* **Сбой**. Обновление не удалось установить.

Чтобы просмотреть все записи журнала, созданные при этом развертывании, выберите **Все журналы**.

Чтобы просмотреть поток заданий для модуля runbook, который управляет развертыванием обновлений на целевых виртуальных машинах, выберите **Выходные данные**.

Чтобы просмотреть подробные сведения об ошибках развертывания, выберите **Ошибки**.

## <a name="next-steps"></a>Дальнейшие действия

Сведения о создании оповещений о результатах развертывания обновлений см. в статье [Создание оповещений для управление обновлениями](update-mgmt-configure-alerts.md).