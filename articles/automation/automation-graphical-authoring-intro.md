---
title: Графическая разработка в службе автоматизации Azure
description: Графическая разработка позволяет создавать модули Runbook для службы автоматизации Azure без работы с кодом. Эта статья содержит вводные сведения о графическом создании и всю информацию, необходимую, чтобы приступить к созданию графического Runbook.
services: automation
ms.subservice: process-automation
ms.date: 03/16/2018
ms.topic: conceptual
ms.openlocfilehash: c1af4b0dac4b50e01b62b02f606be9fdd89d2ad1
ms.sourcegitcommit: 512d4d56660f37d5d4c896b2e9666ddcdbaf0c35
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/14/2020
ms.locfileid: "79367335"
---
# <a name="graphical-authoring-in-azure-automation"></a>Графическая разработка в службе автоматизации Azure

Графическая разработка позволяет создавать модули Runbook для службы автоматизации Azure без сложностей базового кода Windows PowerShell или рабочего процесса PowerShell. Вы можете добавлять действия на холст из библиотеки командлетов и модулей Runbook, связывать их вместе и настраивать их для формирования рабочего процесса. Если вы когда-либо работали с System Center Orchestrator или Service Management Automation (SMA), графическая разработка должна показаться знакомой. Эта статья содержит введение в основные понятия, необходимые для начала создания графического модуля Runbook.

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Инструкции по установке AZ Module в гибридной рабочей роли Runbook см. в статье [Установка модуля Azure PowerShell](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0). Для учетной записи службы автоматизации можно обновить модули до последней версии, используя [обновление модулей Azure PowerShell в службе автоматизации Azure](automation-update-azure-modules.md).

## <a name="graphical-runbooks"></a>Графические модули Runbook

Все модули Runbook в службе автоматизации Azure являются рабочими процессами Windows PowerShell. Графические модули Runbook и графические модули Runbook рабочих процессов PowerShell создают код PowerShell, который выполняется, но их нельзя просматривать или изменять. Графический Runbook можно преобразовать в графический модуль Runbook рабочего процесса PowerShell и наоборот. Однако эти модули Runbook нельзя преобразовать в текстовый модуль Runbook. Кроме того, графический редактор автоматизации не может импортировать текстовый Runbook.

## <a name="overview-of-graphical-editor"></a>Обзор графического редактора

Графический редактор можно открыть на портале Azure, создав или открыв для редактирования графический Runbook.

![Графическая рабочая область](media/automation-graphical-authoring-intro/runbook-graphical-editor.png)

В следующих разделах описываются элементы управления в графическом редакторе.

### <a name="canvas-control"></a>Canvas - элемент управления

Элемент управления Canvas позволяет проектировать модуль Runbook. Вы можете добавить действия из узлов в элемент управления "Библиотека" в модуль Runbook и соединить их со ссылками, чтобы определить логику Runbook. В нижней части холста есть элементы управления, позволяющие увеличить и уменьшить масштаб.

### <a name="library-control"></a>Элемент управления "Библиотека"

Элемент управления "Библиотека" позволяет выбрать [действия](#activities) для добавления в модуль Runbook. Вы добавляете их на холст, где их можно подключить к другим действиям. Элемент управления "Библиотека" включает в себя разделы, определенные в следующей таблице.

| Section | Description |
|:--- |:--- |
| Командлеты |Все командлеты, которые можно использовать в модуле Runbook. Командлеты группируются по модулям. Доступны все модули, установленные в учетной записи службы автоматизации. |
| Модули runbook |Модули Runbook в учетной записи службы автоматизации. Эти модули Runbook можно добавить на холст, чтобы использовать его в качестве дочерних модулей Runbook. Показаны только те модули Runbook, которые имеют тот же тип ядра, что и редактируемый модуль Runbook. Для графических модулей Runbook отображаются только модули Runbook на основе PowerShell. Для графических модулей Runbook рабочего процесса PowerShell отображаются только модули Runbook на основе рабочих процессов PowerShell. |
| Активы |[Ресурсы службы автоматизации](/previous-versions/azure/dn939988(v=azure.100)) в учетной записи службы автоматизации, которые можно использовать в модуле Runbook. Добавление ресурса в модуль Runbook добавляет действие рабочего процесса, которое получает выбранный ресурс. В случае ресурсов переменных можно либо добавить действие для получения переменной, либо задать переменную. |
| Элемент управления "Runbook" |Управление действиями, которые могут использоваться в текущем модуле Runbook. Действие соединения принимает несколько входов и ожидает их завершения, прежде чем продолжить рабочий процесс. Действие Code запускает одну или несколько строк кода PowerShell или рабочего процесса PowerShell в зависимости от графического типа Runbook. Это действие можно использовать в пользовательском коде или функции, которую не удается реализовать иными способами. |

### <a name="configuration-control"></a>Элемент управления "Конфигурация"

Элемент управления конфигурацией позволяет указать сведения для объекта, выбранного на холсте. Свойства, доступные в этом элементе управления, зависят от типа выбранного объекта. При выборе параметра в элементе управления конфигурацией он открывает дополнительные колонки для предоставления дополнительных сведений.

### <a name="test-control"></a>Элемент управления "Тест"

Элемент управления "Тест" не отображается при первом запуске графического редактора. Он открывается при интерактивном тестировании графического модуля Runbook.

## <a name="activities"></a>Действия

Действия являются стандартными блоками модуля Runbook. Действием может быть командлет PowerShell, дочерний Runbook или рабочий процесс. Вы можете добавить действие в модуль Runbook, щелкнув его правой кнопкой мыши в элементе управления "Библиотека" и выбрав **Добавить на холст**. Затем можно щелкнуть и перетащить действие, чтобы поместить его на холсте туда, куда необходимо. Расположение действия на холсте не влияет на работу модуля Runbook. Вы можете разместить модуль Runbook любым способом, наиболее подходящим для визуализации его работы.

![Добавить на холст](media/automation-graphical-authoring-intro/add-to-canvas-revised20165.png)

Выберите действие на холсте, чтобы настроить его свойства и параметры в колонке конфигурация. Метку действия можно изменить на имя, которое вы найдете в описательном виде. Модуль Runbook по-прежнему запускает исходный командлет. Вы просто изменяете отображаемое имя, которое использует графический редактор. Обратите внимание, что метка должна быть уникальной в пределах модуля Runbook.

### <a name="parameter-sets"></a>Наборы параметров

Набор параметров определяет обязательные и необязательные параметры, которые принимают значения для определенного командлета. Все командлеты имеют по крайней мере один набор параметров, а некоторые имеют несколько наборов. Если командлет имеет несколько наборов параметров, необходимо выбрать один из них, прежде чем можно будет настроить параметры. Набор параметров, используемый действием, можно изменить, выбрав **набор параметров** и выбрав другой набор. В этом случае все значения параметров, которые уже настроены, теряются.

В следующем примере командлет [Get-AzVM](https://docs.microsoft.com/powershell/module/az.compute/get-azvm?view=azps-3.5.0) имеет три набора параметров. В примере используется один набор с именем **листвиртуалмачинеинресаурцеграуппарамсет**с одним необязательным параметром для возврата всех виртуальных машин в группе ресурсов. В примере также используется набор параметров **набор параметров getvirtualmachineinresourcegroupparamset** для указания возвращаемой виртуальной машины. Этот набор имеет два обязательных параметра и один необязательный параметр.

![Набор параметров](media/automation-graphical-authoring-intro/get-azurermvm-parameter-sets.png)

#### <a name="parameter-values"></a>Значения параметра

При указании значения для параметра вы выбираете источник данных, чтобы определить, как будет указано значение. Источники данных, доступные для конкретного параметра, зависят от допустимых значений этого параметра. Например, значение NULL недоступно для параметра, который не допускает значений NULL.

| Источник данных | Description |
|:--- |:--- |
| Постоянное значение |Введите значение для параметра. Этот источник данных доступен только для следующих типов данных: Int32, Int64, String, Boolean, DateTime и Switch. |
| Выходные данные действия |Используйте выходные данные действия, предшествующего текущему действию в рабочем процессе. Будут перечислены все допустимые действия. Для значения параметра используйте только действие, которое создает выходные данные. Если действие выводит объект с несколькими свойствами, можно ввести имя определенного свойства после выбора действия. |
| Входные данные Runbook |Выберите входные данные Runbook в качестве входных данных для параметра действия. |
| Ресурс переменной |Выберите переменную службы автоматизации в качестве входных данных. |
| Ресурс учетных данных |Выберите учетные данные службы автоматизации в качестве входных данных. |
| Ресурс сертификата |Выберите сертификат службы автоматизации в качестве входных данных. |
| Ресурс подключения |Выберите подключение службы автоматизации в качестве входных данных. |
| Выражение PowerShell |Укажите простое [выражение PowerShell](#powershell-expressions). Выражение вычисляется перед действием, а результат используется для значения параметра. Вы можете использовать переменные, чтобы ссылаться на выходные данные действия или входной параметр Runbook. |
| Не настроено |Удалите все ранее настроенные значения. |

#### <a name="optional-additional-parameters"></a>Необязательные дополнительные параметры

Для всех командлетов можно предоставить дополнительные параметры. Это общие параметры PowerShell или другие пользовательские параметры. Графический редактор представляет текстовое поле, в котором можно указать параметры с помощью синтаксиса PowerShell. Например, чтобы использовать общий параметр `Verbose`, необходимо указать `-Verbose:$True`.

### <a name="retry-activity"></a>Повтор действий

Функция повтора для действия позволяет запускать его несколько раз до тех пор, пока не будет выполнено определенное условие, во многом подобно циклу. Эту функцию можно использовать для действий, которые должны выполняться несколько раз, подвержены ошибкам, могут потребовать более одной попытки успешного выполнения или проверить выходные данные действия для допустимых данных.

Включая для действия режим повтора, можно задать условие и значение задержки. Задержка — это время (в секундах или минутах) ожидания модуля runbook перед повторным выполнением действия. Если задержка не указана, действие выполняется снова сразу после завершения.

![Задержка повтора действия](media/automation-graphical-authoring-intro/retry-delay.png)

Условие повтора — это выражение PowerShell, которое вычисляется после каждого выполнения действия. Если выражение имеет значение true, действие выполняется снова. Если выражение имеет значение false, действие не выполняется снова, а модуль Runbook переходит к следующему действию.

![Задержка повтора действия](media/automation-graphical-authoring-intro/retry-condition.png)

Условие повтора может использовать переменную с именем `RetryData`, которая предоставляет доступ к сведениям о повторных попытках действия. У этой переменной есть свойства, приведенные в таблице ниже.

| Свойство | Description |
|:--- |:--- |
| `NumberOfAttempts` |Количество запусков действия. |
| `Output` |Результат последнего выполнения действия. |
| `TotalDuration` |Время с момента первого запуска действия. |
| `StartedAt` |Время первого запуска действия (в формате UTC). |

Ниже приведены примеры условий повторного выполнения действий.

```powershell-interactive
# Run the activity exactly 10 times.
$RetryData.NumberOfAttempts -ge 10
```

```powershell-interactive
# Run the activity repeatedly until it produces any output.
$RetryData.Output.Count -ge 1
```

```powershell-interactive
# Run the activity repeatedly until 2 minutes has elapsed.
$RetryData.TotalDuration.TotalMinutes -ge 2
```

Когда вы настроите для действия условия запуска повторных попыток, действие будет отображать два напоминания. Одна из них представлена в действии, а другая отображается при проверке конфигурации действия.

![Визуальные индикаторы повторения действия](media/automation-graphical-authoring-intro/runbook-activity-retry-visual-cue.png)

### <a name="workflow-script-control"></a>Элемент управления сценария рабочего процесса

Элемент управления сценария рабочего процесса — это специальное действие, которое принимает сценарий рабочего процесса PowerShell или PowerShell в зависимости от типа создаваемого графического модуля Runbook. Этот элемент управления предоставляет функциональные возможности, которые могут быть недоступны другим средствам. Он не может принимать параметры, но может использовать переменные для выходных данных действия и входных параметров Runbook. Все выходные данные действия добавляются в операцию DataBus. Исключением является вывод без исходящей ссылки. в этом случае выходные данные добавляются в выходные данные модуля Runbook.

Например, следующий код выполняет вычисления с датами, используя входную переменную Runbook с именем `NumberOfDays`. Затем вычисленное значение DateTime отправляется в качестве выходных данных для использования последующими действиями в модуле Runbook.

```powershell-interactive
$DateTimeNow = (Get-Date).ToUniversalTime()
$DateTimeStart = ($DateTimeNow).AddDays(-$NumberOfDays)}
$DateTimeStart
```

## <a name="links-and-workflow"></a>Связи и рабочий процесс

Ссылка в графическом модуле Runbook соединяет два действия. Она отображается на холсте как стрелка от исходного действия к действию назначения. Действия выполняются в направлении стрелки: действие назначения запускается после завершения исходного действия.

### <a name="link-creation"></a>Создание ссылки

Можно создать связь между двумя действиями, выбрав исходное действие и щелкнув окружность в нижней части фигуры. Перетащите стрелку к действию назначения и отпустите ее.

![Создание связи](media/automation-graphical-authoring-intro/create-link-revised20165.png)

Выберите связь, чтобы настроить ее свойства в колонке "Конфигурация". Свойства включают тип ссылки, описанный в следующей таблице.

| Тип связи | Description |
|:--- |:--- |
| Pipeline |Действие назначения выполняется один раз для каждого выходного объекта из исходного действия. Действие назначения не выполняется, если исходное действие не создает выходные данные. Выходные данные из исходного действия доступны в виде объекта. |
| Последовательность |Действие назначения выполняется только один раз при получении выходных данных от исходного действия. Выходные данные из исходного действия доступны в виде массива объектов. |

### <a name="start-of-activity"></a>Начало действия

Графический модуль runbook начнется с любых действий, у которых нет входящей связи. Часто в качестве начального действия для модуля Runbook выступает только одно действие. Если у нескольких действий нет входящей связи, модуль Runbook запускается параллельно. Затем, по завершении каждого из них, он будет переходить по связям, выполняя другие действия.

### <a name="link-conditions"></a>Условия связи

При указании условия для ссылки действие назначения выполняется только в том случае, если условие разрешается в значение true. Обычно в условии используется переменная `ActivityOutput` для получения выходных данных из исходного действия.

Для связи конвейера необходимо указать условие для одного объекта. Модуль Runbook оценивает условие для каждого выходного объекта в исходном действии. Затем выполняется целевое действие для каждого объекта, удовлетворяющего условию. Например, с исходным действием `Get-AzVM`можно использовать следующий синтаксис для связи условного конвейера, чтобы получить только виртуальные машины в группе ресурсов с именем group1.

```powershell-interactive
$ActivityOutput['Get Azure VMs'].Name -match "Group1"
```

Для последовательности ссылок Runbook вычисляет условие только один раз, так как возвращается один массив, содержащий все объекты из исходного действия. В связи с этим модуль Runbook не может использовать ссылку на последовательность для фильтрации, как это можно сделать с помощью связи конвейера. Ссылка на последовательность может просто определить, выполняется ли следующее действие.

Например, выполните следующий набор действий в модуле Runbook для **запуска виртуальной машины** :

![Условная связь с последовательностями](media/automation-graphical-authoring-intro/runbook-conditional-links-sequence.png)

Модуль Runbook использует три различные последовательные ссылки, которые проверяют значения входных параметров `VMName` и `ResourceGroupName`, чтобы определить необходимое действие. Возможные действия: запуск одной виртуальной машины, запуск всех виртуальных машин в группе ресурсов или запуск всех виртуальных машин в подписке. Ниже приведена логика условия для связи последовательности между `Connect to Azure` и `Get single VM`.

```powershell-interactive
<#
Both VMName and ResourceGroupName runbook input parameters have values
#>
(
(($VMName -ne $null) -and ($VMName.Length -gt 0))
) -and (
(($ResourceGroupName -ne $null) -and ($ResourceGroupName.Length -gt 0))
)
```

При использовании условной связи данные из исходного действия, доступные для других действий в этой ветви, фильтруются по условию. Если действие является источником нескольких ссылок, данные, доступные для действий в каждой ветви, зависят от условия в связи, соединяющейся с этой ветвью.

Например, действие `Start-AzVM` в модуле Runbook, приведенное ниже, запускает все виртуальные машины. Действие включает две условные связи. Первая условная ссылка использует выражение `$ActivityOutput['Start-AzVM'].IsSuccessStatusCode -eq $true` для фильтрации успешного завершения действия `Start-AzVM`. Вторая условная ссылка использует выражение `$ActivityOutput['Start-AzVM'].IsSuccessStatusCode -ne $true` для фильтрации, если `Start-AzVm` действия не удается запустить виртуальную машину.

![Пример условной связи](media/automation-graphical-authoring-intro/runbook-conditional-links.png)

Любое действие, следующее за первой ссылкой и использующее выходные данные действия из `Get-AzureVM`, получает только те виртуальные машины, которые были запущены в момент запуска `Get-AzureVM`. Любое действие, следующее за второй ссылкой, получает только те виртуальные машины, которые были остановлены во время выполнения `Get-AzureVM`. Действие, следующее по третьей связи, получит все виртуальные машины вне зависимости от того, запущены они или нет.

### <a name="junctions"></a>Соединения

Соединение — это специальное действие, которое ожидает завершения всех входящих ветвей. Это позволяет модулю Runbook одновременно выполнять несколько действий и убедиться, что все они завершены, прежде чем переходить к.

Хотя соединение может иметь неограниченное число входящих связей, только одна из этих ссылок может быть конвейером. Число входящих последовательных связей не ограничено. Вы можете создать соединение с несколькими входящими связями конвейера и сохранить модуль Runbook, но при его запуске произойдет сбой.

В приведенном ниже примере показана часть Runbook, которая запускает набор виртуальных машин, одновременно скачивая исправления для них. Он использует соединение, чтобы убедиться, что оба процесса выполняются до того, как модуль Runbook продолжит работу.

![Соединение](media/automation-graphical-authoring-intro/runbook-junction.png)

### <a name="cycles"></a>Cycles

Цикл формируется, когда целевое действие связывается с исходным действием или с другим действием, которое в конечном итоге связывается с источником. Графическая разработка в настоящее время не поддерживает циклы. Если runbook содержит циклический процесс, он будет сохранен правильно, но при его выполнении произойдет ошибка.

![Циклический процесс](media/automation-graphical-authoring-intro/runbook-cycle.png)

### <a name="data-sharing-between-activities"></a>Обмен данными между действиями

Любые данные, которые действие выводит с исходящей ссылкой, записываются в объект DataBus для модуля Runbook. Любое действие в Runbook может использовать данные в шине данных, чтобы заполнить значения параметров или добавить эти данные в код сценария. Действие может обращаться к выходным данным любого предыдущего действия в рабочем процессе.

То, как данные записываются в шину данных, зависит от типа связи действия. Для связи конвейера данные выводятся в виде нескольких объектов. Для последовательности ссылок данные выводятся в виде массива. Если имеется только одно значение, оно выводится как одноэлементный массив.

У модуля Runbook есть два способа доступа к данным в DataBus: 
* Используйте источник выходных данных действия.
* Используйте источник данных выражения PowerShell.

Первый механизм использует источник выходных данных действия для заполнения параметра другого действия. Если выходным объектом является объект, модуль Runbook может указать одно свойство.

![выходные данные действия](media/automation-graphical-authoring-intro/activity-output-datasource-revised20165.png)

Второй механизм доступа к данным получает выходные данные действия в источнике данных выражения PowerShell или действие сценария рабочего процесса с переменной `ActivityOutput`, используя приведенный ниже синтаксис. Если выходным объектом является объект, модуль Runbook может указать одно свойство.

```powershell-interactive
$ActivityOutput['Activity Label']
$ActivityOutput['Activity Label'].PropertyName
```

### <a name="checkpoints"></a>Контрольные точки

Вы можете задать [контрольные точки](automation-powershell-workflow.md#checkpoints) в графическом модуле Runbook рабочего процесса PowerShell, выбрав пункт создать **контрольную точку Runbook** для любого действия. Это настраивает создание контрольной точки после выполнения действия.

![Контрольная точка](media/automation-graphical-authoring-intro/set-checkpoint.png)

Контрольные точки включены только в графических модулях Runbook рабочих процессов PowerShell и недоступны в графических модулях Runbook. Если модуль Runbook использует командлеты Azure, он должен выполнять все действия с контрольными точками с действием `Connect-AzAccount`. Операция подключения используется в случае, если модуль Runbook приостановлен и должен перезапуститься из этой контрольной точки в другом рабочем процессе.

## <a name="runbook-input-and-output"></a>Входные и выходные данные Runbook

### Входные данные Runbook<a name="runbook-input"></a>

Для модуля Runbook требуются входные данные от пользователя, запускающего модуль Runbook, через портал Azure или из другого модуля Runbook, если текущий объект используется в качестве дочернего. Например, для модуля Runbook, который создает виртуальную машину, пользователю может потребоваться предоставить такую информацию в качестве имени виртуальной машины и других свойств при каждом запуске модуля Runbook.

Модуль Runbook принимает входные данные, определяя один или несколько входных параметров. Пользователь предоставляет значения для этих параметров при каждом запуске модуля Runbook. Когда пользователь запускает модуль Runbook с помощью портал Azure, пользователю предлагается указать значения для каждого входного параметра, поддерживаемого модулем Runbook.

При создании модуля Runbook можно получить доступ к его входным параметрам, щелкнув **Ввод и вывод** на панели инструментов Runbook. Откроется элемент управления вход и выход, где можно изменить существующий входной параметр или создать новый, нажав кнопку **Добавить вход**.

![Добавить входные данные](media/automation-graphical-authoring-intro/runbook-edit-add-input.png)

Каждый входной параметр определяется с помощью свойств, указанных в следующей таблице:

| Свойство | Description |
|:--- |:--- |
| Имя | Обязательный элемент. Имя параметра. Имя должно быть уникальным в пределах модуля Runbook. Оно должно начинаться с буквы и может содержать только буквы, цифры и символы подчеркивания. Имя не может содержать пробелы. |
| Description |Необязательный параметр. Описание назначения для входного параметра. |
| Тип | Необязательный параметр. Предполагаемый тип данных значения параметра. Портал Azure предоставит соответствующий элемент управления для типа данных каждого параметра при запросе ввода его значения. Поддерживаются следующие типы параметров: String, Int32, Int64, Decimal, Boolean, DateTime и Object. Если тип данных не выбран, по умолчанию используется строка.|
| Обязательный | Необязательный параметр. Параметр, указывающий, должно ли быть указано значение для параметра. При выборе `yes`при запуске модуля Runbook необходимо указать значение. Если выбрать `no`, то при запуске модуля Runbook значение не требуется, и можно будет использовать значение по умолчанию. Модуль Runbook не может быть запущен, если не указано значение для каждого обязательного параметра, для которого не определено значение по умолчанию. |
| Значение по умолчанию | Необязательный параметр. Значение, используемое для параметра, если оно не передается при запуске модуля Runbook. Чтобы задать значение по умолчанию, выберите `Custom`. Выберите `None`, если не нужно указывать значение по умолчанию. |

### <a name="runbook-output"></a>Выходные данные runbook

Графическая разработка сохраняет данные, созданные любым действием, не имеющим исходящей ссылки на [выходные данные модуля Runbook](https://docs.microsoft.com/azure/automation/automation-runbook-output-and-messages). Выходные данные сохраняются заданием Runbook и доступны родительскому модулю Runbook, если Runbook используется как дочерний.

## <a name="powershell-expressions"></a>Выражения PowerShell

Одним из преимуществ графической разработки является то, что он позволяет создавать модули Runbook с минимальными знаниями о PowerShell. Однако в настоящее время необходимо знать несколько экземпляров PowerShell для заполнения определенных [значений параметров](#activities) и для установки [условий связи](#links-and-workflow). В этом разделе содержатся краткие сведения о выражениях PowerShell. Полные сведения о PowerShell можно найти в статье [Создание сценариев с помощью Windows PowerShell](https://technet.microsoft.com/library/bb978526.aspx).

### <a name="powershell-expression-data-source"></a>Выражение PowerShell как источник данных

Можно использовать выражение PowerShell в качестве источника данных для заполнения значения [параметра действия](#activities) результатами кода PowerShell. Выражение может быть единственной строкой кода, которая выполняет простую функцию или несколько строк, выполняющих некоторую сложную логику. Любые выходные данные команды, не присвоенные переменной, выводятся в значении параметра.

Например, следующая команда выводит текущую дату.

```powershell-interactive
Get-Date
```

Следующий фрагмент кода создает строку из текущей даты и присваивает ее переменной. Код отправляет содержимое переменной в выходные данные.

```powershell-interactive
$string = "The current date is " + (Get-Date)
$string
```

Следующие команды оценивают текущую дату и возвращают строку, указывающую, является ли текущий день выходом или днем недели.

```powershell-interactive
$date = Get-Date
if (($date.DayOfWeek = "Saturday") -or ($date.DayOfWeek = "Sunday")) { "Weekend" }
else { "Weekday" }
```

### <a name="activity-output"></a>Выходные данные действия

Чтобы использовать выходные данные предыдущего действия в модуле Runbook, используйте переменную `ActivityOutput` со следующим синтаксисом.

```powershell-interactive
$ActivityOutput['Activity Label'].PropertyName
```

Например, можно использовать действие со свойством, которое требует имя виртуальной машины. В этом случае модуль Runbook может использовать следующее выражение.

```powershell-interactive
$ActivityOutput['Get-AzureVM'].Name
```

Если для свойства требуется объект виртуальной машины, а не просто имя, модуль Runbook возвращает весь объект, используя следующий синтаксис.

```powershell-interactive
$ActivityOutput['Get-AzureVM']
```

Модуль Runbook может использовать выходные данные действия в более сложном выражении, как показано ниже. Это выражение объединяет текст с именем виртуальной машины.

```powershell-interactive
"The computer name is " + $ActivityOutput['Get-AzureVM'].Name
```

### <a name="conditions"></a>Условия

Используйте [операторы сравнения](https://technet.microsoft.com/library/hh847759.aspx) для сравнения значений или определения того, соответствует ли значение указанному шаблону. Сравнение возвращает значение true или false.

Например, следующее условие определяет, остановлена ли виртуальная машина из действия с именем `Get-AzureVM`.

```powershell-interactive
$ActivityOutput["Get-AzureVM"].PowerState –eq "Stopped"
```

Следующее условие определяет, находится ли одна и та же виртуальная машина в любом состоянии, кроме остановленного.

```powershell-interactive
$ActivityOutput["Get-AzureVM"].PowerState –ne "Stopped"
```

Несколько условий в модуле Runbook можно объединить с помощью [логического оператора](https://technet.microsoft.com/library/hh847789.aspx), например `-and` или `-or`. Например, в следующем условии проверяется, находится ли виртуальная машина в предыдущем примере в состоянии остановка или остановка.

```powershell-interactive
($ActivityOutput["Get-AzureVM"].PowerState –eq "Stopped") -or ($ActivityOutput["Get-AzureVM"].PowerState –eq "Stopping")
```

### <a name="hashtables"></a>хэш-таблицы;

[Хэш-таблицы](https://technet.microsoft.com/library/hh847780.aspx) — это пары "имя — значение", которые полезны для возвращения набора значений. Также может отображаться таблица Hashtable, называемая словарем. Свойства для некоторых действий предполагают наличие хэш-таблицы, а не простого значения.

Создайте хэш-таблицу, используя следующий синтаксис. Он может содержать любое количество записей, но каждый из них определяется по имени и значению.

```powershell-interactive
@{ <name> = <value>; [<name> = <value> ] ...}
```

Например, следующее выражение создает хэш-таблицу, которая будет использоваться в качестве источника данных для параметра действия, который ожидает хэш-таблицу значений для поиска в Интернете.

```powershell-interactive
$query = "Azure Automation"
$count = 10
$h = @{'q'=$query; 'lr'='lang_ja';  'count'=$Count}
$h
```

В следующем примере для заполнения хэш-таблицы используются выходные данные действия, именуемого `Get Twitter Connection`.

```powershell-interactive
@{'ApiKey'=$ActivityOutput['Get Twitter Connection'].ConsumerAPIKey;
    'ApiSecret'=$ActivityOutput['Get Twitter Connection'].ConsumerAPISecret;
    'AccessToken'=$ActivityOutput['Get Twitter Connection'].AccessToken;
    'AccessTokenSecret'=$ActivityOutput['Get Twitter Connection'].AccessTokenSecret}
```

## <a name="authenticating-to-azure-resources"></a>Аутентификация для доступа к ресурсам Azure

В службе автоматизации Azure для модулей runbook, которые управляют ресурсами Azure, требуется проверка подлинности. [Учетная запись запуска от имени](automation-create-runas-account.md), также называемая субъектом-службой, является механизмом по умолчанию, который Runbook службы автоматизации использует для доступа к ресурсам Azure Resource Manager в вашей подписке. Эту функцию можно добавить в графический модуль Runbook, добавив ресурс подключения `AzureRunAsConnection`, который использует командлет PowerShell [Get-AutomationConnection](https://technet.microsoft.com/library/dn919922%28v=sc.16%29.aspx) , на холст. Можно также добавить командлет [Connect-азаккаунт](/powershell/module/az.accounts/connect-azaccount) . Этот сценарий показан в следующем примере.

![Действия аутентификации запуска от имени](media/automation-graphical-authoring-intro/authenticate-run-as-account.png)

Действие `Get Run As Connection` или `Get-AutomationConnection`настроено с использованием источника данных постоянного значения с именем `AzureRunAsConnection`.

![Конфигурация подключения запуска от имени](media/automation-graphical-authoring-intro/authenticate-runas-parameterset.png)

Следующее действие, `Connect-AzAccount`, добавляет учетную запись запуска от имени, прошедшей проверку подлинности, для использования в модуле Runbook.

![Набор параметров Connect-Азаккаунт](media/automation-graphical-authoring-intro/authenticate-conn-to-azure-parameter-set.png)

>[!NOTE]
>Для модулей Runbook PowerShell `Add-AzAccount` и `Add-AzureRMAccount` являются псевдонимами для `Connect-AzAccount`. Обратите внимание, что эти псевдонимы недоступны для графических модулей Runbook. Графический модуль Runbook может использовать только `Connect-AzAccount`.

Для полей параметров **APPLICATIONID**, **CERTIFICATETHUMBPRINT**и **TENANTID**укажите имя свойства для пути к полю, так как действие выводит объект с несколькими свойствами. В противном случае при попытке выполнить проверку подлинности произойдет сбой выполнения модуля Runbook. Это минимальные требования для проверки подлинности модуля Runbook с использованием учетной записи запуска от имени.

Некоторые Подписчики создают учетную запись службы автоматизации с помощью [учетной записи пользователя Azure AD](automation-create-aduser-account.md) для управления классическим развертыванием Azure или для Azure Resource Managerных ресурсов. Чтобы обеспечить обратную совместимость для этих подписчиков, механизм проверки подлинности, используемый в модуле Runbook, является командлетом `Add-AzureAccount` с [ресурсом учетных данных](automation-credentials.md). Ресурс представляет Active Directory пользователя с доступом к учетной записи Azure.

Вы можете включить эту функцию для графического модуля Runbook, добавив ресурс учетных данных на холст, а затем действие `Add-AzureAccount`, которое использует ресурс учетных данных для своих входных данных. См. указанный ниже пример.

![Действия аутентификации](media/automation-graphical-authoring-intro/authentication-activities.png)

Модуль Runbook должен пройти проверку подлинности в начале и после каждой контрольной точки. Поэтому необходимо использовать действие `Add-AzureAccount` после любого действия `Checkpoint-Workflow`. Не нужно использовать дополнительные действия с учетными данными.

![Выходные данные действия](media/automation-graphical-authoring-intro/authentication-activity-output.png)

## <a name="exporting-and-importing-a-graphical-runbook"></a>Экспорт и импорт графического модуля Runbook

Можно экспортировать только опубликованную версию графического модуля Runbook. Если модуль Runbook еще не опубликован, кнопка **Экспорт** недоступна. При нажатии кнопки **Экспорт** модуль Runbook загружается на локальный компьютер. Имя файла совпадает с именем модуля Runbook с расширением **graphrunbook** .

Вы можете импортировать графический или графический файл Runbook рабочего процесса PowerShell, выбрав параметр **импорта** при добавлении модуля Runbook. При выборе файла для импорта можно оставить то же самое имя или указать новое. В поле **тип Runbook** отображается тип модуля Runbook после того, как он оценивает выбранный файл. При попытке выбрать другой недопустимый тип, графический редактор выводит сообщение о наличии потенциальных конфликтов и в процессе преобразования могут возникнуть синтаксические ошибки.

![Импортировать Runbook](media/automation-graphical-authoring-intro/runbook-import-revised20165.png)

## <a name="testing-a-graphical-runbook"></a>Тестирование графического Runbook

Каждый графический модуль Runbook в службе автоматизации Azure имеет черновую версию и опубликованную версию. Можно запустить только опубликованную версию, в то время как можно изменить только черновую версию. Изменения, внесенные в черновик, не влияют на опубликованную версию. Когда черновик готов к использованию, вы публикуете его, который перезаписывает текущую опубликованную версию с черновой версией.

Черновую версию модуля Runbook можно проверить в портал Azure, при этом опубликованная версия не изменится. Кроме того, можно проверить новый модуль Runbook перед его публикацией, чтобы убедиться, что модуль Runbook правильно работает перед заменой версий. Тестирование модуля Runbook выполняет черновую версию и обеспечивает завершение всех выполняемых действий. Журнал заданий не создается, но выходные данные отображаются в области вывода теста.

Откройте тестовый элемент управления для графического модуля Runbook, открыв модуль Runbook для редактирования и щелкнув **область тестирования**. Проверочный элемент управления запрашивает входные параметры, и вы можете запустить модуль Runbook, нажав кнопку **запустить**.

## <a name="publishing-a-graphical-runbook"></a>Публикация графического Runbook

Опубликуйте графический модуль Runbook, открыв модуль Runbook для редактирования и нажав кнопку **опубликовать**. Возможные состояния модуля Runbook:

* Создать — модуль Runbook еще не опубликован. 
* Опубликовано — модуль Runbook опубликован.
* В поле "Изменить" — модуль Runbook был изменен после публикации, а черновые и опубликованные версии различаются.

![Состояния Runbook](media/automation-graphical-authoring-intro/runbook-statuses-revised20165.png)

У вас есть возможность вернуться к опубликованной версии модуля Runbook. Эта операция порождает все изменения, внесенные с момента последней публикации модуля Runbook. Он заменяет черновую версию модуля Runbook опубликованной версией.

## <a name="next-steps"></a>Next Steps

* Сведения о том, как начать работу с модулями Runbook рабочих процессов PowerShell, см. в статье [Первый Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md).
* Чтобы приступить к работе с графическими модулями Runbook, см. раздел [Мой первый графический модуль Runbook](automation-first-runbook-graphical.md).
* Дополнительные сведения о типах модулей Runbook и их преимуществах и ограничениях см. в статье [типы Runbook службы автоматизации Azure](automation-runbook-types.md).
* Сведения о проверке подлинности с помощью учетной записи запуска от имени службы автоматизации см. в статье [Настройка учетной записи запуска от имени Azure](automation-sec-configure-azure-runas-account.md).
