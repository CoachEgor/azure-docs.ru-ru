---
title: Графическая разработка в службе автоматизации Azure
description: Графическая разработка позволяет создавать модули Runbook для службы автоматизации Azure без работы с кодом. Эта статья содержит вводные сведения о графическом создании и всю информацию, необходимую, чтобы приступить к созданию графического Runbook.
services: automation
ms.subservice: process-automation
ms.date: 03/16/2018
ms.topic: conceptual
ms.openlocfilehash: cf8ced05066923c94e80628651d8983560601d69
ms.sourcegitcommit: b80aafd2c71d7366838811e92bd234ddbab507b6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/16/2020
ms.locfileid: "81406050"
---
# <a name="graphical-authoring-in-azure-automation"></a>Графическая разработка в службе автоматизации Azure

Графическое авторство позволяет создавать runbooks для Azure Automation без сложностей базового кода Windows PowerShell или PowerShell Workflow. Можно добавить действия в холст из библиотеки cmdlets и runbooks, связать их вместе и настроить их для формирования рабочего процесса. Если вы когда-либо работали с System Center Orchestrator или автоматизации управления обслуживанием (SMA), графическое авторство должно выглядеть знакомо. Эта статья содержит введение в концепции, необходимые для начала создания графического runbook.

>[!NOTE]
>Эта статья была изменена и теперь содержит сведения о новом модуле Az для Azure PowerShell. Вы по-прежнему можете использовать модуль AzureRM, исправления ошибок для которого будут продолжать выпускаться как минимум до декабря 2020 г. Дополнительные сведения о совместимости модуля Az с AzureRM см. в статье [Introducing the new Azure PowerShell Az module](https://docs.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-3.5.0) (Знакомство с новым модулем Az для Azure PowerShell). Для инструкций по установке модуля Az на гибридном Runbook Worker [см.](https://docs.microsoft.com/powershell/azure/install-az-ps?view=azps-3.5.0) Для учетной записи Автоматизация вы можете обновить свои модули до последней версии, используя [как обновить модули Azure PowerShell в Azure Automation.](automation-update-azure-modules.md)

## <a name="graphical-runbooks"></a>Графические модули Runbook

Все книги в Автоматизации Azure являются рабочими процессами Windows PowerShell. Графические руны и графические runbook PowerShell Workflow генерируют код PowerShell, который работают работники автоматизации, но который нельзя просматривать или изменять. Можно преобразовать графический runbook в графический справочник PowerShell Workflow, и наоборот. Тем не менее, вы не можете преобразовать эти runbooks в текстовый runbook. Кроме того, графический редактор Automation не может импортировать текстовую книгу.

## <a name="overview-of-graphical-editor"></a>Обзор графического редактора

Графический редактор можно открыть на портале Azure, создав или открыв для редактирования графический Runbook.

![Графическая рабочая область](media/automation-graphical-authoring-intro/runbook-graphical-editor.png)

В следующих разделах описываются элементы управления в графическом редакторе.

### <a name="canvas-control"></a>Canvas - элемент управления

Управление Canvas позволяет разрабатывать беговую книгу. Можно добавить действия из узлов управления библиотекой в руническую книгу и соединить их со ссылками для определения логики runbook. В нижней части холста есть элементы управления, которые позволяют увеличить и увеличить.

### <a name="library-control"></a>Элемент управления "Библиотека"

Управление библиотекой позволяет выбрать [действия](#activities) для добавления в свою книгу. Вы добавляете их в холст, где вы можете подключить их к другим действиям. Элемент управления библиотекой включает разделы, определенные в следующей таблице.

| Section | Описание |
|:--- |:--- |
| Командлеты |Все cmdlets, которые могут быть использованы в вашей runbook. Командлеты группируются по модулям. Все модули, установленные в учетной записи Automation, доступны. |
| Модули runbook |Книги в вашей учетной записи Автоматизация. Вы можете добавить эти runbooks на холст, который будет использоваться в качестве детских runbooks. Отображаются только рунбуки того же типа ядра, что и отредактированный runbook. Для графических runbooks отображаются только на основе PowerShell. Для графических runbooks PowerShell Workflow отображаются только на основе runbooks на основе рабочего процесса PowerShell. |
| Активы |[Активы автоматизации](/previous-versions/azure/dn939988(v=azure.100)) в учетной записи Автоматизации, которые можно использовать в своем сборнике. Добавление актива в runbook добавляет рабочее занятие, которое получает выбранный актив. В случае ресурсов переменных можно либо добавить действие для получения переменной, либо задать переменную. |
| Элемент управления "Runbook" |Управление действиями, которые могут быть использованы в текущем runbook. Действие junction требует нескольких входов и ждет, пока все они не будут завершены, прежде чем продолжить рабочий процесс. Действие Code запускает одну или несколько строк кода PowerShell или PowerShell Workflow, в зависимости от графического типа runbook. Это действие можно использовать в пользовательском коде или функции, которую не удается реализовать иными способами. |

### <a name="configuration-control"></a>Элемент управления "Конфигурация"

Элемент управления конфигурации позволяет предоставить подробную информацию для объекта, выбранного на холсте. Свойства, доступные в этом элементе управления, зависят от типа выбранного объекта. При выборе опции в элементе управления конфигурацией открывается дополнительные лопасти для предоставления дополнительной информации.

### <a name="test-control"></a>Элемент управления "Тест"

Элемент управления "Тест" не отображается при первом запуске графического редактора. Он открывается, когда вы интерактивно тестируете графический Runbook.

## <a name="activities"></a>Действия

Действия являются стандартными блоками модуля Runbook. Деятельность может быть Смдлет PowerShell, детская книга или рабочий процесс. Вы можете добавить действие в книгу runbook, нажав на него в управлении библиотекой и выбрав **Добавить в холст.** Затем можно щелкнуть и перетащить действие, чтобы поместить его на холсте туда, куда необходимо. Расположение действия на холсте не влияет на работу рунки. Вы можете выложить свой runbook каким-либо образом вы найдете наиболее подходящим для визуализации его работы.

![Добавить на холст](media/automation-graphical-authoring-intro/add-to-canvas-cmdlet.png)

Выберите действие на холсте, чтобы настроить его свойства и параметры в лезвии конфигурации. Вы можете изменить метку действия на имя, которое вы найдете описательным. В runbook по-прежнему работает оригинальный cmdlet. Вы просто меняете имя дисплея, которое использует графический редактор. Обратите внимание, что метка должна быть уникальной в runbook.

### <a name="parameter-sets"></a>Наборы параметров

Набор параметров определяет обязательные и необязательные параметры, которые принимают значения для определенного командлета. Все cmdlets имеют по крайней мере один набор параметров, а некоторые из них имеют несколько наборов. Если cmdlet имеет несколько наборов параметров, необходимо выбрать тот, который можно использовать, прежде чем вы сможете настроить параметры. Вы можете изменить набор параметров, используемый действием, выбрав **набор параметров** и выбрав другой набор. В этом случае все значения параметра, которые вы уже настроены, теряются.

В следующем примере смдлет [Get-AzVM](https://docs.microsoft.com/powershell/module/az.compute/get-azvm?view=azps-3.5.0) имеет три набора параметров. В примере используется один набор под названием **ListVirtualMachineInResourceGroupParamSet**, с одним дополнительным параметром, для возвращения всех виртуальных машин в группу ресурсов. В примере также используется параметр **GetVirtualMachineInResourceGroupParamSet** для определения виртуальной машины для возврата. Этот набор имеет два обязательных параметра и один дополнительный параметр.

![Набор параметров](media/automation-graphical-authoring-intro/get-azvm-parameter-sets.png)

#### <a name="parameter-values"></a>Значения параметра

При указании значения для параметра вы выбираете источник данных, чтобы определить, как будет указано значение. Источники данных, доступные для конкретного параметра, зависят от допустимых значений для этого параметра. Например, значение NULL недоступно для параметра, который не допускает значений NULL.

| Источник данных | Описание |
|:--- |:--- |
| Постоянное значение |Введите значение для параметра. Этот источник данных доступен только для следующих типов данных: Int32, Int64, String, Boolean, DateTime, Switch. |
| Выходные данные действия |Используйте выход из действия, предшествующегося текущему действию в рабочем процессе. Будут перечислены все допустимые действия. Для значения параметра используйте только действие, которое производит выход. Если действие выводит объект с несколькими свойствами, можно ввести имя определенного свойства после выбора объекта. |
| Входные данные Runbook |Выберите входный ввод runbook в качестве ввода для параметра действия. |
| Ресурс переменной |Выберите переменную автоматизации в качестве ввода. |
| Ресурс учетных данных |Выберите учетные данные автоматизации в качестве ввода. |
| Ресурс сертификата |Выберите сертификат автоматизации в качестве ввода. |
| Ресурс подключения |Выберите соединение автоматизации в качестве ввода. |
| Выражение PowerShell |Укажите простое [выражение PowerShell.](#powershell-expressions) Выражение оценивается до действия и результат используется для значения параметра. Вы можете использовать переменные, чтобы ссылаться на выходные данные действия или входной параметр Runbook. |
| Не настроено |Очистите любое значение, которое было настроено ранее. |

#### <a name="optional-additional-parameters"></a>Необязательные дополнительные параметры

Для всех командлетов можно предоставить дополнительные параметры. Это параметры PowerShell или другие пользовательские параметры. Графический редактор представляет текстовое окно, где вы можете предоставить параметры с помощью синтаксиса PowerShell. Например, для `Verbose` использования общего параметра `-Verbose:$True`следует указать.

### <a name="retry-activity"></a>Повтор действий

Функция повторная попытка для действия позволяет выполнять ее несколько раз до тех пор, пока не будет выполнено определенное условие, подобно циклу. Эту функцию можно использовать для действий, которые должны работать несколько раз, подвержены ошибкам, может потребоваться несколько попыток успеха или тестировать информацию о результатах действия для достоверных данных.

Включая для действия режим повтора, можно задать условие и значение задержки. Задержка — это время (в секундах или минутах) ожидания модуля runbook перед повторным выполнением действия. Если вы не укажете задержку, действие выполняется сразу же после завершения.

![Задержка повтора действия](media/automation-graphical-authoring-intro/retry-delay.png)

Условие повторной попытки — это выражение PowerShell, которое оценивается каждый раз, когда выполняется действие. Если выражение решается на True, действие выполняется снова. Если выражение переходит к false, действие не выполняется снова, и запуск переходит к следующему действию.

![Задержка повтора действия](media/automation-graphical-authoring-intro/retry-condition.png)

Условие повторной попытки может `RetryData` использовать переменную, которая обеспечивает доступ к информации о повторах действий. У этой переменной есть свойства, приведенные в таблице ниже.

| Свойство | Описание |
|:--- |:--- |
| `NumberOfAttempts` |Количество запусков действия. |
| `Output` |Результат последнего выполнения действия. |
| `TotalDuration` |Время с момента первого запуска действия. |
| `StartedAt` |Время (в формате UTC), когда действие было впервые запущено. |

Ниже приведены примеры условий повторной попытки действий.

```powershell-interactive
# Run the activity exactly 10 times.
$RetryData.NumberOfAttempts -ge 10
```

```powershell-interactive
# Run the activity repeatedly until it produces any output.
$RetryData.Output.Count -ge 1
```

```powershell-interactive
# Run the activity repeatedly until 2 minutes has elapsed.
$RetryData.TotalDuration.TotalMinutes -ge 2
```

Когда вы настроите для действия условия запуска повторных попыток, действие будет отображать два напоминания. Один из них представлен в действии, а другой отображается при просмотре конфигурации действия.

![Визуальные индикаторы повторения действия](media/automation-graphical-authoring-intro/runbook-activity-retry-visual-cue.png)

### <a name="workflow-script-control"></a>Элемент управления сценария рабочего процесса

Управление скриптом рабочего процесса — это специальная деятельность, которая принимает сценарий PowerShell или PowerShell Workflow, в зависимости от типа графического runbook, накоторогорного. Этот элемент управления обеспечивает функциональность, которая может быть недоступна другими средствами. Он не может принимать параметры, но может использовать переменные для выходных данных действия и входных параметров Runbook. Любой вывод действия добавляется в databus. Исключением является выход без исходящих ссылок, и в этом случае вывод добавляется к выходу в сборник.

Например, следующий код выполняет расчеты дат с `NumberOfDays`помощью входно-переменной ввода runbook, названной. Затем он отправляет расчетное значение DateTime в качестве вывода, используемого последующими действиями в runbook.

```powershell-interactive
$DateTimeNow = (Get-Date).ToUniversalTime()
$DateTimeStart = ($DateTimeNow).AddDays(-$NumberOfDays)}
$DateTimeStart
```

## <a name="links-and-workflow"></a>Связи и рабочий процесс

Связь в графическом Runbook соединяет два действия. Она отображается на холсте как стрелка от исходного действия к действию назначения. Действия выполняются в направлении стрелки: действие назначения запускается после завершения исходного действия.

### <a name="link-creation"></a>Создание ссылки

Можно создать связь между двумя действиями, выбрав действие источника и нажав на круг в нижней части формы. Перетащите стрелку к действию назначения и отпустите ее.

![Создание связи](media/automation-graphical-authoring-intro/create-link-options.png)

Выберите связь, чтобы настроить ее свойства в колонке "Конфигурация". Свойства включают тип ссылки, который описан в следующей таблице.

| Тип связи | Описание |
|:--- |:--- |
| Pipeline |Активность назначения выполняется один раз для каждого вывода объекта из исходного действия. Действие назначения не выполняется, если исходное действие не создает выходные данные. Выходные данные из исходного действия доступны в виде объекта. |
| Последовательность |Активность назначения выполняется только один раз, когда получает выход из исходного действия. Выходные данные из исходного действия доступны в виде массива объектов. |

### <a name="start-of-activity"></a>Начало действия

Графический модуль runbook начнется с любых действий, у которых нет входящей связи. Часто существует только одно действие, которое выступает в качестве стартового действия для runbook. Если несколько действий не имеют входящих ссылок, запуск запускается с параллельного запуска. Затем, по завершении каждого из них, он будет переходить по связям, выполняя другие действия.

### <a name="link-conditions"></a>Условия связи

Когда вы указываете условие на ссылке, действие назначения выполняется только в том случае, если условие соответствует действительности. Обычно используется `ActivityOutput` переменная в состоянии для получения вывода из действия источника.

Для соединения конвейера необходимо указать условие для одного объекта. В runbook оценивается состояние каждого вывода объекта по действию источника. Затем он запускает направление деятельности для каждого объекта, который удовлетворяет условие. Например, при исходной `Get-AzVM`активности можно использовать следующий синтаксис для условного конвейерного соединения для извлечения только виртуальных машин в группе ресурсов под названием Group1.

```powershell-interactive
$ActivityOutput['Get Azure VMs'].Name -match "Group1"
```

Для ссылки последовательности запуск запускает состояние только один раз, так как возвращается один массив, содержащий все объекты из действия источника. Из-за этого runbook не может использовать ссылку последовательности для фильтрации, как это возможно с соединением конвейера. Ссылка последовательности может просто определить, является ли запущено следующее действие.

Например, возьмем следующий набор мероприятий в нашем runbook **Start VM:**

![Условная связь с последовательностями](media/automation-graphical-authoring-intro/runbook-conditional-links-sequence.png)

В runbook используются три различные ссылки последовательности, которые проверяют значения параметров ввода `VMName` и `ResourceGroupName` определяют соответствующие действия. Возможные действия: запуск одного VM, запуск всех вм в группе ресурсов или запуск всех вс-да в подписке. Для последовательности `Connect to Azure` связи `Get single VM`между и , вот логика условия:

```powershell-interactive
<#
Both VMName and ResourceGroupName runbook input parameters have values
#>
(
(($VMName -ne $null) -and ($VMName.Length -gt 0))
) -and (
(($ResourceGroupName -ne $null) -and ($ResourceGroupName.Length -gt 0))
)
```

При использовании условной связи данные из исходного действия, доступные для других действий в этой ветви, фильтруются по условию. Если действие является источником нескольких ссылок, данные, доступные для действий в каждой ветке, зависят от состояния в подключении к этой ветке.

Например, `Start-AzVM` действие в runbook ниже начинается все виртуальные машины. Действие включает две условные связи. Первая условная `$ActivityOutput['Start-AzVM'].IsSuccessStatusCode -eq $true` ссылка использует `Start-AzVM` выражение для фильтрации, если действие успешно завершено. Вторая условная `$ActivityOutput['Start-AzVM'].IsSuccessStatusCode -ne $true` ссылка использует `Start-AzVm` выражение для фильтрации, если действие не может запустить виртуальную машину.

![Пример условной связи](media/automation-graphical-authoring-intro/runbook-conditional-links.png)

Любое действие, которое следует за `Get-AzureVM` первой ссылкой и использует выход активности `Get-AzureVM` только, получает виртуальные машины, которые были запущены в момент запуска. Любая деятельность, которая следует за вторым звеном, получает `Get-AzureVM` только виртуальные машины, которые были остановлены в момент запуска. Действие, следующее по третьей связи, получит все виртуальные машины вне зависимости от того, запущены они или нет.

### <a name="junctions"></a>Соединения

Соединение — это специальное действие, которое ожидает завершения всех входящих ветвей. Это позволяет runbook выполнять несколько действий параллельно и гарантировать, что все были завершены, прежде чем двигаться дальше.

В то время как соединение может иметь неограниченное количество входящих ссылок, только одна из этих ссылок может быть конвейером. Число входящих последовательных связей не ограничено. Можно создать соединение с несколькими входящими соединениями конвейера и сохранить рунбук, но он выйдет из строя при запуске.

В приведенном ниже примере показана часть Runbook, которая запускает набор виртуальных машин, одновременно скачивая исправления для них. Он использует соединение, чтобы гарантировать, что оба процесса будут завершены до запуска книги продолжается.

![Соединение](media/automation-graphical-authoring-intro/runbook-junction.png)

### <a name="cycles"></a>Cycles

Цикл формируется, когда активность назначения ссылается на свою активность источника или на другое действие, которое в конечном итоге ссылается на его источник. Графическое авторство в настоящее время не поддерживает циклы. Если runbook содержит циклический процесс, он будет сохранен правильно, но при его выполнении произойдет ошибка.

![Циклический процесс](media/automation-graphical-authoring-intro/runbook-cycle.png)

### <a name="data-sharing-between-activities"></a>Обмен данными между мероприятиями

Любые данные, которые выводит деятельность с исходящих ссылками, записываются в шины данных для runbook. Любое действие в Runbook может использовать данные в шине данных, чтобы заполнить значения параметров или добавить эти данные в код сценария. Действие может обращаться к выходным данным любого предыдущего действия в рабочем процессе.

То, как данные записываются в шину данных, зависит от типа связи действия. Для соединения конвейера данные вывесещеются как несколько объектов. Для последовательной связи данные выводятся в виде массива. Если есть только одно значение, это выход в виде одного элемента массива.

В вашем runbook есть два способа доступа к данным на databus: 
* Используйте источник данных вывода активности.
* Используйте источник данных выражения PowerShell.

Первый механизм использует источник данных вывода активности для заполнения параметра другого действия. Если вывод является объектом, в книге runbook можно указать одно свойство.

![выход активности](media/automation-graphical-authoring-intro/activity-output-datasource-revised20165.png)

Второй механизм доступа к данным извлекает выход действия в источнике данных выражения `ActivityOutput` PowerShell или действия скрипта рабочего процесса с переменной, используя показанный ниже синтаксис. Если вывод является объектом, в книге runbook можно указать одно свойство.

```powershell-interactive
$ActivityOutput['Activity Label']
$ActivityOutput['Activity Label'].PropertyName
```

### <a name="checkpoints"></a>Контрольные точки

Вы можете установить [контрольно-пропускные пункты](automation-powershell-workflow.md#checkpoints) в графическом runbook PowerShell Workflow, выбрав **беговую книгу checkpoint** на любом занятии. Это настраивает создание контрольной точки после выполнения действия.

![Контрольная точка](media/automation-graphical-authoring-intro/set-checkpoint.png)

Контрольные точки включены только в графических сборниках PowerShell Workflow и не доступны в графических учебниках. Если в книге runbook используются cmdlets Azure, `Connect-AzAccount` он должен следовать любому действию с помощью контрольно-пропускного пункта с помощью действия. Операция подключения используется в случае приостановки выполнения и должна быть перезапущена с этого контрольно-пропускного пункта на другого работника.

## <a name="runbook-input-and-output"></a>Входные и выходные данные Runbook

### <a name="runbook-input"></a>Вход Runbook<a name="runbook-input"></a>

Запуск требует ввода либо от пользователя, запускающего книгу через портал Azure, либо от другой runbook, если текущая книга используется в качестве ребенка. Например, для runbook, которая создает виртуальную машину, пользователю может потребоваться предоставить такую информацию, как имя виртуальной машины и другие свойства каждый раз, когда запускать книгу запуска.

Runbook принимает входные, определяя один или несколько параметров ввода. Пользователь предоставляет значения для этих параметров каждый раз, когда запуск запуска. Когда пользователь запускает книгу запуска с помощью портала Azure, пользователю предлагается предоставить значения для каждого параметра ввода, поддерживаемого беговой книгой.

При авторе runbook можно получить доступ к ее параметрам ввода, нажав на панель инструментов **и выходных** данных в хитровом журнале. Откроется элемент управления Вход и выход, в котором можно изменить существующий входной параметр или создать новый, нажав кнопку **Добавить входные данные**.

![Добавить входные данные](media/automation-graphical-authoring-intro/runbook-edit-add-input.png)

Каждый входной параметр определяется с помощью свойств, указанных в следующей таблице:

| Свойство | Описание |
|:--- |:--- |
| Имя | Обязательный элемент. Имя параметра. Название должно быть уникальным в runbook. Она должна начинаться с буквы и может содержать только буквы, цифры и подчеркнутые. Имя не может содержать пробел. |
| Описание |Необязательный параметр. Описание цели для входиного параметра. |
| Тип | Необязательный параметр. Предполагаемый тип данных значения параметра. Портал Azure предоставит соответствующий элемент управления для типа данных каждого параметра при запросе ввода его значения. Поддерживаются параметры строкового, логического, объектного типа, а также типа Int32, Int64, DateTime и типа десятичного числа. Если тип данных не выбран, то по умолчанию используется значение строковоготипа.|
| Обязательный | Необязательный параметр. Установка определяет, должно ли быть предусмотрено значение параметра. Если вы `yes`выберете, значение должно быть предоставлено при запуске. Если вы `no`выберете значение не требуется при запуске runbook, и значение по умолчанию может быть использовано. Запуск не может начаться, если вы не предоставляете значение для каждого обязательного параметра, не имеющем значения по умолчанию. |
| Значение по умолчанию | Необязательный параметр. Значение, используемое для параметра, если он не пройден при запуске. Чтобы установить значение `Custom`по умолчанию, выберите. Выберите, `None` если вы не хотите предоставлять значение по умолчанию. |

### <a name="runbook-output"></a>Выходные данные runbook

Графическое авторство сохраняет данные, созданные любым действием, не имеющим исходящие ссылки на [выход из runbook.](https://docs.microsoft.com/azure/automation/automation-runbook-output-and-messages) Выходные данные сохраняются заданием Runbook и доступны родительскому модулю Runbook, если Runbook используется как дочерний.

## <a name="powershell-expressions"></a>Выражения PowerShell

Одним из преимуществ графического авторства является то, что он позволяет создавать runbook с минимальными знаниями PowerShell. В настоящее время, однако, вам нужно знать немного PowerShell для заполнения [определенных значений параметров](#activities) и для установления [условий ссылки.](#links-and-workflow) В этом разделе представлено быстрое введение в выражения PowerShell. Полные сведения о PowerShell можно найти в статье [Создание сценариев с помощью Windows PowerShell](https://technet.microsoft.com/library/bb978526.aspx).

### <a name="powershell-expression-data-source"></a>Выражение PowerShell как источник данных 

Выражение PowerShell можно использовать в качестве источника данных для заполнения значения [параметра действия](#activities) результатами кода PowerShell. Выражение может быть одной строкой кода, которая выполняет простую функцию или несколько строк, выполняющие некоторую сложную логику. Любые выходные данные команды, не присвоенные переменной, выводятся в значении параметра.

Например, следующая команда выводит текущую дату.

```powershell-interactive
Get-Date
```

Следующий фрагмент кода создает строку из текущей даты и присваивает ее переменной. Код отправляет содержимое переменной на вывод.

```powershell-interactive
$string = "The current date is " + (Get-Date)
$string
```

Следующие команды оценивают текущую дату и возвращают строку с указанием, является ли текущий день выходным или будним днем.

```powershell-interactive
$date = Get-Date
if (($date.DayOfWeek = "Saturday") -or ($date.DayOfWeek = "Sunday")) { "Weekend" }
else { "Weekday" }
```

### <a name="activity-output"></a>Выходные данные действия

Чтобы использовать вывод из предыдущего действия в `ActivityOutput` беговой книге, используйте переменную со следующим синтаксисом.

```powershell-interactive
$ActivityOutput['Activity Label'].PropertyName
```

Например, можно иметь действие с свойством, которое требует названия виртуальной машины. В этом случае в runbook можно использовать следующее выражение.

```powershell-interactive
$ActivityOutput['Get-AzureVM'].Name
```

Если свойство требует объект виртуальной машины, а не только имя, runbook возвращает весь объект, используя следующий синтаксис.

```powershell-interactive
$ActivityOutput['Get-AzureVM']
```

В runbook можно использовать вывод действия в более сложном выражении, например в следующем. Это выражение притягивает текст к названию виртуальной машины.

```powershell-interactive
"The computer name is " + $ActivityOutput['Get-AzureVM'].Name
```

### <a name="conditions"></a>Условия

Используйте [операторы сравнения](https://technet.microsoft.com/library/hh847759.aspx) для сравнения значений или определения того, соответствует ли значение указанному шаблону. Сравнение возвращает значение либо True или False.

Например, следующее условие определяет, остановлена ли `Get-AzureVM` виртуальная машина из названного действия в настоящее время.

```powershell-interactive
$ActivityOutput["Get-AzureVM"].PowerState –eq "Stopped"
```

Следующее условие определяет, находится ли та же виртуальная машина в любом состоянии, кроме остановленного.

```powershell-interactive
$ActivityOutput["Get-AzureVM"].PowerState –ne "Stopped"
```

Вы можете присоединиться к нескольким условиям в своей `-or`runbook с помощью [логического оператора,](https://technet.microsoft.com/library/hh847789.aspx)например, `-and` или . Например, следующее условие проверяет, находится ли виртуальная машина в предыдущем примере в состоянии остановки или остановки.

```powershell-interactive
($ActivityOutput["Get-AzureVM"].PowerState –eq "Stopped") -or ($ActivityOutput["Get-AzureVM"].PowerState –eq "Stopping")
```

### <a name="hashtables"></a>хэш-таблицы;

[Hashtables](https://technet.microsoft.com/library/hh847780.aspx) — это пары именных значений, которые полезны для возвращения набора значений. Вы также можете увидеть хэштабили, именуемый словарем. Свойства для определенных видов деятельности ожидают хэш-табло вместо простого значения.

Создайте хэш-таблицу, используя следующий синтаксис. Он может содержать любое количество записей, но каждый определяется именем и значением.

```powershell-interactive
@{ <name> = <value>; [<name> = <value> ] ...}
```

Например, следующее выражение создает хэшбит, который будет использоваться в качестве источника данных для параметра активности, который ожидает хэштаблицу значений для поиска в Интернете.

```powershell-interactive
$query = "Azure Automation"
$count = 10
$h = @{'q'=$query; 'lr'='lang_ja';  'count'=$Count}
$h
```

В следующем примере используется `Get Twitter Connection` выход из действия, вызванного для заполнения хэшбита.

```powershell-interactive
@{'ApiKey'=$ActivityOutput['Get Twitter Connection'].ConsumerAPIKey;
    'ApiSecret'=$ActivityOutput['Get Twitter Connection'].ConsumerAPISecret;
    'AccessToken'=$ActivityOutput['Get Twitter Connection'].AccessToken;
    'AccessTokenSecret'=$ActivityOutput['Get Twitter Connection'].AccessTokenSecret}
```

## <a name="authenticating-to-azure-resources"></a>Аутентификация для доступа к ресурсам Azure

В службе автоматизации Azure для модулей runbook, которые управляют ресурсами Azure, требуется проверка подлинности. [Учетная запись Run As,](automation-create-runas-account.md)которую также называют основой службы, — это механизм выполнения системы автоматизации для доступа к ресурсам Azure Resource Manager в подписке. Эту функциональность можно добавить в графический `AzureRunAsConnection` справочник, добавив в холст актив подключения, который использует cmdlet PowerShell [Get-AutomationConnection.](https://technet.microsoft.com/library/dn919922%28v=sc.16%29.aspx) Вы также можете добавить [cmdlet Connect-AzAccount.](/powershell/module/az.accounts/connect-azaccount) Этот сценарий проиллюстрирован в следующем примере.

![Действия аутентификации запуска от имени](media/automation-graphical-authoring-intro/authenticate-run-as-account.png)

Действие, `Get Run As Connection` или `Get-AutomationConnection`, настроено с постоянным названным `AzureRunAsConnection`источником данных значения.

![Конфигурация подключения запуска от имени](media/automation-graphical-authoring-intro/authenticate-runas-parameterset.png)

Следующее действие, `Connect-AzAccount`добавляет аутентифицированный Run As учетную запись для использования в runbook.

![Набор параметров Connect-AzAccount](media/automation-graphical-authoring-intro/authenticate-conn-to-azure-parameter-set.png)

>[!NOTE]
>Для PowerShell runbooks, `Add-AzAccount` и `Add-AzureRMAccount` псевдонимы для `Connect-AzAccount`. Обратите внимание, что эти псевдонимы не доступны для графических runbooks. Графический runbook может `Connect-AzAccount` использовать только себя.

Для параметров **полей APPLICATIONID,** **CERTIFICATETHUMBPRINT**и **TENANTID**укажите название свойства для траектории поля, так как действие выводит объект с несколькими свойствами. В противном случае, когда запуск выполняется, он завершается при попытке проверки подлинности. Это минимальные требования для проверки подлинности модуля Runbook с использованием учетной записи запуска от имени.

Некоторые абоненты создают учетную запись Автоматизации, используя [учетную запись пользователя Azure AD](automation-create-aduser-account.md) для управления классическим развертыванием Azure или для ресурсов Azure Resource Manager. Для поддержания обратной совместимости для этих подписчиков механизм проверки `Add-AzureAccount` подлинности для использования в вашем runbook является cmdlet с [активом учетных данных.](automation-credentials.md) Актив представляет пользователя Active Directory с доступом к учетной записи Azure.

Эту функциональность можно включить для графического runbook, добавив в холст `Add-AzureAccount` актив учетных данных, после чего будет работать актив, который использует ресурс учетных данных для ввода. См. указанный ниже пример.

![Действия аутентификации](media/automation-graphical-authoring-intro/authentication-activities.png)

Беговая книга должна быть проверена в начале и после каждого контрольно-пропускного пункта. Таким образом, `Add-AzureAccount` вы должны `Checkpoint-Workflow` использовать деятельность после любого действия. Вам не нужно использовать дополнительную учетную запись.

![Выходные данные действия](media/automation-graphical-authoring-intro/authentication-activity-output.png)

## <a name="exporting-and-importing-a-graphical-runbook"></a>Экспорт и импорт графического модуля Runbook

Можно экспортировать только опубликованную версию графического модуля Runbook. Если книга runbook еще не опубликована, кнопка **Экспорт** отключена. При нажатии кнопки **«Экспорт»** на ваш локальный компьютер загружается книга runbook. Название файла совпадает с названием runbook с расширением **.graphrunbook.**

Можно импортировать графический или графический файл runbook PowerShell, выбрав опцию **Импорта** при добавлении runbook. При выборе файла для импорта можно сохранить то же имя или предоставить новое. Поле **Runbook Type** отображает тип runbook после оценки выбранного файла. Если вы попытаетесь выбрать другой тип, который не является правильным, графический редактор представляет сообщение, отмечая, что есть потенциальные конфликты и могут быть ошибки синтаксиса во время преобразования.

![Импортировать Runbook](media/automation-graphical-authoring-intro/runbook-import.png)

## <a name="testing-a-graphical-runbook"></a>Тестирование графического Runbook

Каждый графический справочник в Azure Automation имеет версию проекта и опубликованную версию. Вы можете запустить только опубликованную версию, в то время как вы можете только отодвить версию проекта. Изменения, внесенные в черновик, не влияют на опубликованную версию. Когда версия Draft готова к использованию, вы публикуете ее, которая перезаписывает текущую опубликованную версию с вашей версией проекта.

Можно протестировать версию проекта запуска на портале Azure, оставив опубликованную версию без изменений. Кроме того, вы можете протестировать новую книгу до его опубликования, чтобы вы могли проверить, что runbook работает правильно, прежде чем любой версии замены. Тестирование runbook выполняет версию draft и гарантирует выполнение любых действий. История задания не создается, но панель тестового вывода отображает выход.

Откройте тест-контроль для графического runbook, открыв книгу для отсечения, а затем нажав **тест панели**. Контроль теста подсказывает параметры ввода, и вы можете запустить runbook, нажав **Кнопку Start.**

## <a name="publishing-a-graphical-runbook"></a>Публикация графического Runbook

Опубликовать графический runbook, открыв runbook для редактирования, а затем нажав **Опубликовать**. Возможные статусы для runbook:

* Новый - книга пока не опубликована. 
* Опубликовано - книга была опубликована.
* При редактировании - книга была отредактирована после того, как она была опубликована, а черновой и опубликованный версии отличаются.

![Состояния Runbook](media/automation-graphical-authoring-intro/runbook-statuses-revised20165.png)

У вас есть возможность вернуться к опубликованной версии runbook. Эта операция выбрасывает любые изменения, внесенные с момента последнего опубликования runbook. Он заменяет черновой вариант runbook с опубликованной версией.

## <a name="next-steps"></a>Next Steps

* Сведения о том, как начать работу с модулями Runbook рабочих процессов PowerShell, см. в статье [Первый Runbook рабочего процесса PowerShell](automation-first-runbook-textual.md).
* Чтобы начать работу с графических runbooks, [см.](automation-first-runbook-graphical.md)
* Чтобы узнать больше о типах runbook [Azure Automation runbook types](automation-runbook-types.md)и их преимуществах и ограничениях, см.
* Чтобы понять, как проверить подлинность с помощью учетной записи Automation Run As, [см.](automation-sec-configure-azure-runas-account.md)
* Для справки PowerShell cmdlet [см.](https://docs.microsoft.com/powershell/module/az.automation/?view=azps-3.7.0#automation
)
