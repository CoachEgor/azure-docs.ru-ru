---
title: Приступая к работе с конфигурацией состояния службы автоматизации Azure
description: Описание и примеры наиболее распространенных задач в конфигурации состояния службы автоматизации Azure
services: automation
ms.service: automation
ms.subservice: dsc
author: mgoedtel
ms.author: magoedte
ms.date: 04/15/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 45d56daee20d95230f77db249028883165acb951
ms.sourcegitcommit: 309a9d26f94ab775673fd4c9a0ffc6caa571f598
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/09/2020
ms.locfileid: "82995779"
---
# <a name="get-started-with-azure-automation-state-configuration"></a>Приступая к работе с конфигурацией состояния службы автоматизации Azure

Эта статья содержит пошаговое руководство по выполнению наиболее распространенных задач с помощью конфигурации состояния службы автоматизации Azure, таких как создание, импорт и компиляция конфигураций, предоставление компьютерам возможности управления и просмотра отчетов. Сведения о конфигурации состояния обзора см. в разделе [Общие сведения о конфигурации состояния](automation-dsc-overview.md). Документацию по DSC см. в статье [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview).

Если требуется образец среды, которая уже настроена без выполнения действий, описанных в этой статье, можно использовать [шаблон управляемого узла службы автоматизации Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/101-automation-configuration). Этот шаблон настраивает среду DSC, включая виртуальную машину Azure, управляемую с помощью Configuration State (DSC).

## <a name="prerequisites"></a>Предварительные требования

Для выполнения примеров из этой статьи необходимо следующее.

- Учетная запись службы автоматизации Azure. Указания по созданию учетной записи запуска от имени пользователя для службы автоматизации Azure см. в статье [Проверка подлинности модулей Runbook в Azure с помощью учетной записи запуска от имени](automation-sec-configure-azure-runas-account.md).
- Виртуальная машина Azure Resource Manager (не классическая) под управлением [поддерживаемой операционной системы](automation-dsc-overview.md#operating-system-requirements). Инструкции по созданию виртуальной машины см. в статье [Создание первой виртуальной машины Windows на портале Azure](../virtual-machines/virtual-machines-windows-hero-tutorial.md).

## <a name="create-a-dsc-configuration"></a>Создание конфигурации DSC

Создайте простую [конфигурацию DSC](/powershell/scripting/dsc/configurations/configurations), которая обеспечивает наличие или отсутствие компонента Windows **веб-сервера** (IIS) в зависимости от назначения узлов.

1. Запустите [VSCode](https://code.visualstudio.com/docs) (или любой текстовый редактор).
1. Введите следующий текст:

    ```powershell
    configuration TestConfig
    {
        Node IsWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Present'
                Name                 = 'Web-Server'
                IncludeAllSubFeature = $true
            }
        }

        Node NotWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Absent'
                Name                 = 'Web-Server'
            }
        }
    }
    ```
1. Сохраните файл как **TestConfig. ps1**.

Эта конфигурация вызывает один ресурс в каждом блоке узла, [ресурсе WindowsFeature](/powershell/scripting/dsc/reference/resources/windows/windowsfeatureresource). Этот ресурс гарантирует наличие или отсутствие компонента **веб-сервера** .

## <a name="import-a-configuration-into-azure-automation"></a>Импорт конфигурации в службу автоматизации Azure

Теперь импортируйте конфигурацию в учетную запись службы автоматизации.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) перейдите на вкладку **конфигурации** и нажмите кнопку **Добавить**.
1. На панели импорт конфигурации перейдите к `TestConfig.ps1` файлу на своем компьютере.

   ![Снимок экрана: колонка **Импорт конфигурации**](./media/automation-dsc-getting-started/AddConfig.png)

1. Нажмите кнопку **ОК**.

## <a name="view-a-configuration-in-azure-automation"></a>Просмотр конфигурации в службе автоматизации Azure

После импорта конфигурацию можно просмотреть на портале Azure.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись службы автоматизации выберите **Конфигурация состояния (DSC)** в разделе **Управление конфигурацией**.
1. На странице Конфигурация состояния (DSC) перейдите на вкладку **конфигурации** , а затем щелкните **TestConfig**. Это имя конфигурации, импортированной в предыдущей процедуре.
1. В области Конфигурация TestConfig щелкните **Просмотр источника конфигурации**.

   ![Снимок экрана: колонка "TestConfig configuration" (Конфигурация TestConfig)](./media/automation-dsc-getting-started/ViewConfigSource.png)

   Откроется панель источника конфигурации TestConfig, в которой отобразится код PowerShell для конфигурации.

## <a name="compile-a-configuration-in-azure-automation"></a>Компиляция конфигурации в службе автоматизации Azure

Прежде чем применить требуемое состояние к узлу, конфигурацию DSC, определяющую это состояние, следует компилировать в одну или несколько конфигураций узла (MOF-документы) и разместить на опрашивающем сервере Automation DSC. Более подробное описание компиляции конфигураций в конфигурации состояния (DSC) см. в разделе конфигурации [компиляции в конфигурации состояния службы автоматизации Azure](automation-dsc-compile.md).
Дополнительные сведения о компилировании конфигураций см. в статье [Конфигурации DSC](/powershell/scripting/dsc/configurations/configurations).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Конфигурация состояния (DSC) перейдите на вкладку **конфигурации** , а затем щелкните **TestConfig**. Это имя ранее импортированной конфигурации.
1. На панели конфигурация TestConfig нажмите кнопку **компилировать**, а затем нажмите кнопку **Да**. Запустится задание компиляции.

   ![Снимок экрана: страница TestConfig configuration (Конфигурация TestConfig) с выделенной кнопкой "Скомпилировать"](./media/automation-dsc-getting-started/CompileConfig.png)

> [!NOTE]
> При компиляции конфигурации в службе автоматизации Azure она автоматически развертывает на опрашивающем сервере все созданные MOF-файлы конфигурации узла.

## <a name="view-a-compilation-job"></a>Просмотр задания компиляции

После запуска компиляции ее можно просмотреть на плитке **задания компиляции** на странице **Конфигурация** . На плитке **Задания компиляции** отображаются выполняющиеся, выполненные и невыполненные задания. При открытии области задания компиляции отображаются сведения об этом задании, включая все возникшие ошибки или предупреждения, входные параметры, используемые в конфигурации, и журналы компиляции.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Конфигурация состояния (DSC) перейдите на вкладку **конфигурации** , а затем щелкните **TestConfig**. Это имя ранее импортированной конфигурации.
1. В разделе **задания компиляции**выберите задание компиляции для просмотра. Откроется область Задание компиляции с пометкой Дата начала задания компиляции.

   ![Снимок экрана: страница "Задание компиляции"](./media/automation-dsc-getting-started/CompilationJob.png)

1. Щелкните любую плитку в области задание компиляции, чтобы просмотреть дополнительные сведения о задании.

## <a name="view-node-configurations"></a>Просмотр конфигураций узлов

При успешном выполнении задания компиляции создается одна или несколько конфигураций узлов. Конфигурация узла — это MOF-документ, который развертывается на опрашивающем сервере и готов к извлечению и применению одним или несколькими узлами. Конфигурации узлов в учетной записи службы автоматизации можно просмотреть на странице конфигурации состояния (DSC). Имя конфигурации узла имеет форму `ConfigurationName.NodeName`.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Скомпилированные конфигурации**.

   ![Снимок экрана: вкладка "Скомпилированные конфигурации"](./media/automation-dsc-getting-started/NodeConfigs.png)

## <a name="enable-an-azure-resource-manager-vm-for-management-with-state-configuration"></a>Включение Azure Resource Manager виртуальной машины для управления с помощью конфигурации состояния

Вы можете использовать конфигурацию состояния для управления виртуальными машинами Azure (классическими и диспетчер ресурсовными), локальными виртуальными машинами, компьютерами Linux, виртуальными машинами AWS и локальными физическими компьютерами. В этой статье вы узнаете, как включить только Azure Resource Manager виртуальных машин. Дополнительные сведения о включении компьютеров других типов см. [в разделе Включение управления для компьютеров с помощью конфигурации состояния службы автоматизации Azure](automation-dsc-onboarding.md).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Конфигурация состояния (DSC) выберите вкладку **узлы** , а затем нажмите кнопку **+ Добавить**.

   ![Снимок экрана: страница "Узлы DSC" с выделенной кнопкой "Добавить виртуальную машину Azure"](./media/automation-dsc-getting-started/OnboardVM.png)

1. В области виртуальные машины выберите свою виртуальную машину.
1. В области сведений о виртуальной машине щелкните **+ Connect**.

   > [!IMPORTANT]
   > Виртуальная машина должна быть виртуальной машиной Azure Resource Manager, работающей под управлением [поддерживаемой операционной системы](automation-dsc-overview.md#operating-system-requirements).

2. На странице Регистрация выберите имя конфигурации узла для применения к виртуальной машине в поле **имя конфигурации узла** . На этом этапе указывать имя необязательно. Вы можете изменить назначенную конфигурацию узла после включения узла.

3. Установите флажок **Перезагрузить узел при необходимости** и нажмите кнопку **ОК**.

   ![Снимок экрана: колонка "Регистрация"](./media/automation-dsc-getting-started/RegisterVM.png)

   Указанная конфигурация узла применяется к виртуальной машине с интервалами, указанными в значении параметра **периодичность режима конфигурации**. Виртуальная машина проверяет наличие обновлений конфигурации узла с интервалами, указанными в значении **частоты обновления** . Дополнительные сведения об использовании этих значений см. в статье [Настройка локального диспетчера конфигураций](/powershell/scripting/dsc/managing-nodes/metaConfig).

Azure запускает процесс включения виртуальной машины. Когда он будет завершен, виртуальная машина появится на вкладке **Узлы** на странице Настройка состояния (DSC) в учетной записи автоматизации.

## <a name="view-the-list-of-managed-nodes"></a>Просмотр списка управляемых узлов

Список всех компьютеров, включенных для управления, можно просмотреть в учетной записи службы автоматизации на вкладке **узлы** страницы Конфигурация состояния (DSC).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Узлы**.

## <a name="view-reports-for-managed-nodes"></a>Просмотр отчетов для управляемых узлов

Каждая конфигурация состояния времени выполняет проверку согласованности на управляемом узле, узел отправляет отчет о состоянии обратно на опрашивающий сервер. Отчеты для соответствующего узла можно посмотреть на его странице.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) перейдите на вкладку **узлы** . Здесь можно просмотреть общие сведения о состоянии конфигурации и сведения для каждого узла.

   ![Снимок экрана страницы "Узел"](./media/automation-dsc-getting-started/NodesTab.png)

1. На вкладке **Узлы** выберите запись узла, чтобы открыть область отчетов. Выберите отчет, в котором нужно просмотреть дополнительные сведения.

   ![Снимок экрана: колонка отчетов](./media/automation-dsc-getting-started/NodeReport.png)

В колонке для отдельного отчета можно увидеть следующие сведения о состоянии для соответствующей проверки согласованности.

- Состояние отчета. Возможны следующие значения:
    * Соответствует. узел соответствует проверке.
   * Сбой: конфигурация не прошла проверку.
   * Не соответствует — узел находится в `ApplyandMonitor` режиме, а компьютер не находится в нужном состоянии.
- Время начала проверки согласованности.
- Общее время выполнения проверки согласованности.
- Тип проверки согласованности.
- Все ошибки, в том числе код и сообщение ошибки.
- Все ресурсы DSC, используемые в конфигурации, и состояние каждого ресурса (указывает, находится ли узел в требуемом состоянии для этого ресурса). Вы можете щелкнуть каждый ресурс, чтобы получить более подробные сведения об этом ресурсе.
- Имя, IP-адрес и режим конфигурации узла.

Кроме того, можно щелкнуть **Просмотреть необработанный отчет**, чтобы просмотреть фактические данные, которые узел отправляет на сервер.
Дополнительные сведения об использовании этих данных см. в статье [Использование сервера отчетов DSC](/powershell/scripting/dsc/pull-server/reportserver).

После включения узла перед тем как будет доступен первый отчет, может пройти некоторое время. После включения узла может потребоваться подождать до 30 минут для первого отчета.

## <a name="reassign-a-node-to-a-different-node-configuration"></a>Переназначить узел другой конфигурации узла

Узел можно назначить для использования конфигурации, которая отличается от назначенной изначально.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, который необходимо переназначить.
1. На странице этого узла нажмите кнопку **Назначить конфигурацию узла**.

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNode.png)

1. На странице Назначить конфигурацию узла выберите конфигурацию, которой необходимо назначить узел, и нажмите кнопку **ОК**.

    ![Снимок экрана: страница "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNodeConfig.png)

## <a name="unregister-a-node"></a>Отмена регистрации узла

Если вы больше не хотите, чтобы узел управлялся конфигурацией состояния, его можно отменить.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, регистрацию которого необходимо отменить.
1. На панели для этого узла нажмите кнопку **отменить регистрацию**.

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Отменить регистрацию"](./media/automation-dsc-getting-started/UnregisterNode.png)

## <a name="related-articles"></a>Похожие статьи

- [Обзор службы "Настройка состояния службы автоматизации Azure"](automation-dsc-overview.md)
- [Подключение компьютеров для управления с помощью службы "Настройка состояния службы автоматизации Azure"](automation-dsc-onboarding.md)
- [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview)
- [Страница с ценами на "Настройка состояния службы автоматизации Azure"](https://azure.microsoft.com/pricing/details/automation/)
- [Az.Automation](https://docs.microsoft.com/powershell/module/az.automation/?view=azps-3.7.0#automation)