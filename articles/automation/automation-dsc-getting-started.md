---
title: Начало работы со службой "Настройка состояния службы автоматизации Azure"
description: Описание и примеры самых распространенных задач в "Настройка состояния службы автоматизации Azure"
services: automation
ms.service: automation
ms.subservice: dsc
author: mgoedtel
ms.author: magoedte
ms.date: 04/15/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 9fce9a769dd6d88c9926913d22716666284938c1
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74850964"
---
# <a name="getting-started-with-azure-automation-state-configuration"></a>Начало работы со службой "Настройка состояния службы автоматизации Azure"

В этой статье описано, как выполнять самые распространенные задачи с помощью "Настройка состояния службы автоматизации Azure", например создание, импорт и компилирование конфигураций, подключение компьютеров для управления, а также просмотр отчетов. Обзор "Настройка состояния службы автоматизации Azure" см. в статье с [обзором этой службы](automation-dsc-overview.md). Документацию по DSC см. в статье [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview).

В этой статье описаны пошаговые инструкции по использованию "Настройка состояния службы автоматизации Azure". Если необходим пример среды, настроенной без выполнения действий, описанных в этой статье, можно использовать следующий шаблон Resource Manager: [шаблон управляемого узла службы автоматизации Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/101-automation-configuration). Этот шаблон позволяет настроить полнофункциональную среду "Настройка состояния службы автоматизации Azure", в том числе виртуальную машину Azure, которой управляет "Настройка состояния службы автоматизации Azure".

## <a name="prerequisites"></a>Предварительные требования

Для выполнения примеров из этой статьи необходимо следующее.

- Учетная запись службы автоматизации Azure. Указания по созданию учетной записи запуска от имени пользователя для службы автоматизации Azure см. в статье [Проверка подлинности модулей Runbook в Azure с помощью учетной записи запуска от имени](automation-sec-configure-azure-runas-account.md).
- Менеджер ресурсов Azure VM (не Классический) работает [с поддерживаемой операционной системой.](automation-dsc-overview.md#operating-system-requirements) Инструкции по созданию виртуальной машины см. в статье [Создание первой виртуальной машины Windows на портале Azure](../virtual-machines/virtual-machines-windows-hero-tutorial.md).

## <a name="creating-a-dsc-configuration"></a>Создание конфигурации DSC

Создайте простую [конфигурацию DSC](/powershell/scripting/dsc/configurations/configurations), которая обеспечивает наличие или отсутствие компонента Windows **веб-сервера** (IIS) в зависимости от назначения узлов.

1. Запустите [VSCode](https://code.visualstudio.com/docs) (или любой текстовый редактор).
1. Введите следующий текст:

    ```powershell
    configuration TestConfig
    {
        Node IsWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Present'
                Name                 = 'Web-Server'
                IncludeAllSubFeature = $true
            }
        }

        Node NotWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Absent'
                Name                 = 'Web-Server'
            }
        }
    }
    ```
1. Сохраните файл как `TestConfig.ps1`.

При этой конфигурации в каждом блоке узла вызывается один ресурс, [ресурс WindowsFeature](/powershell/scripting/dsc/reference/resources/windows/windowsfeatureresource), что обеспечивает наличие или отсутствие компонента **веб-сервера** .

## <a name="importing-a-configuration-into-azure-automation"></a>Импорт конфигурации в службу автоматизации Azure

Теперь импортируйте конфигурацию в учетную запись службы автоматизации.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Конфигурации**, а затем щелкните **+ Добавить**.
1. На странице **Импорт конфигурации** перейдите к файлу `TestConfig.ps1` на своем компьютере.

   ![Снимок экрана: колонка **Импорт конфигурации**](./media/automation-dsc-getting-started/AddConfig.png)

1. Нажмите кнопку **ОК**.

## <a name="viewing-a-configuration-in-azure-automation"></a>Просмотр конфигурации в службе автоматизации Azure

После импорта конфигурацию можно просмотреть на портале Azure.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице **учетной записи Automation** выберите **конфигурацию состояния (DSC)** под **управлением конфигурации.**
1. На странице **Настройка состояния (DSC)** выберите вкладку **Конфигурации**, а затем щелкните **TestConfig** (это имя конфигурации, импортированной при выполнении предыдущей процедуры).
1. На странице **Настройка TestConfig** щелкните **Просмотреть источник конфигурации**.

   ![Снимок экрана: колонка "TestConfig configuration" (Конфигурация TestConfig)](./media/automation-dsc-getting-started/ViewConfigSource.png)

   Откроется страница **Источник конфигурации TestConfig**, в которой будет отображаться код PowerShell для конфигурации.

## <a name="compiling-a-configuration-in-azure-automation"></a>Компилирование конфигурации в службе автоматизации Azure

Прежде чем применить требуемое состояние к узлу, конфигурацию DSC, определяющую это состояние, следует компилировать в одну или несколько конфигураций узла (MOF-документы) и разместить на опрашивающем сервере Automation DSC. Подробное описание компилирования конфигураций в "Настройка состояния службы автоматизации Azure" см. в [этой статье](automation-dsc-compile.md).
Дополнительные сведения о компилировании конфигураций см. в статье [Конфигурации DSC](/powershell/scripting/dsc/configurations/configurations).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Конфигурации**, а затем щелкните **TestConfig** (имя импортированной ранее конфигурации).
1. На странице **Настройка TestConfig** щелкните **Скомпилировать**, а затем нажмите кнопку **Да**. Запустится задание компиляции.

   ![Снимок экрана: страница TestConfig configuration (Конфигурация TestConfig) с выделенной кнопкой "Скомпилировать"](./media/automation-dsc-getting-started/CompileConfig.png)

> [!NOTE]
> Во время компилирования конфигурации в службе автоматизации Azure MOF-файлы любой созданной конфигурации узла автоматически развертываются на опрашивающем сервере.

## <a name="viewing-a-compilation-job"></a>Просмотр задания компиляции

После запуска компиляции задание можно просмотреть на плитке **Задания компиляции** на странице **Конфигурация**. На плитке **Задания компиляции** отображаются выполняющиеся, выполненные и невыполненные задания. При открытии на странице задания компиляции отображаются сведения об этом задании, в том числе все обнаруженные ошибки или предупреждения, входные параметры, используемые в конфигурации, и журналы компиляции.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Конфигурации**, а затем щелкните **TestConfig** (имя импортированной ранее конфигурации).
1. В разделе **Задания компиляции** выберите задание компиляции, которое нужно просмотреть. Откроется страница **Задание компиляции** с датой начала задания компиляции.

   ![Снимок экрана: страница "Задание компиляции"](./media/automation-dsc-getting-started/CompilationJob.png)

1. Чтобы просмотреть дополнительные сведения о задании, щелкните любую плитку на странице **Задание компиляции**.

## <a name="viewing-node-configurations"></a>Просмотр конфигураций узлов

При успешном выполнении задания компиляции создается одна или несколько конфигураций узлов. Конфигурация узла — это MOF-документ, который развертывается на опрашивающем сервере и готов к извлечению и применению одним или несколькими узлами. Конфигурации узлов можно просмотреть в учетной записи службы автоматизации на странице **Настройка состояния (DSC)**. Имя конфигурации узла имеет следующий формат: *имя_конфигурации*.*имя_узла*.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. В колонке **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Скомпилированные конфигурации**.

   ![Снимок экрана: вкладка "Скомпилированные конфигурации"](./media/automation-dsc-getting-started/NodeConfigs.png)

## <a name="onboarding-an-azure-vm-for-management-with-azure-automation-state-configuration"></a>Подключение виртуальной машины Azure для управления с использованием "Настройка состояния службы автоматизации Azure"

С помощью службы "Настройка состояния службы автоматизации Azure" можно управлять виртуальными машинами Azure (классическими или Resource Manager), локальными виртуальными машинами, компьютерами Linux, виртуальными машинами AWS и локальными физическими компьютерами. Из этой статьи вы узнали, как подключать только виртуальные машины Azure Resource Manager. Дополнительные сведения о подключении машин других типов см. в статье [Подключение компьютеров для управления с помощью Azure Automation DSC](automation-dsc-onboarding.md).

### <a name="to-onboard-an-azure-resource-manager-vm-for-management-by-azure-automation-state-configuration"></a>Чтобы подключить виртуальную машину Azure Resource Manager для управления с помощью "Настройка состояния службы автоматизации Azure"

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. В колонке **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** на вкладке **Узлы** щелкните **+ Добавить**.

   ![Снимок экрана: страница "Узлы DSC" с выделенной кнопкой "Добавить виртуальную машину Azure"](./media/automation-dsc-getting-started/OnboardVM.png)

1. На странице **Виртуальные машины** выберите свою виртуальную машину.
1. На странице сведений **Виртуальная машина** выберите **+ Подключить**.

   > [!IMPORTANT]
   > Это должен быть VM-менеджер ресурсов Azure, работающий [с поддерживаемой операционной системой.](automation-dsc-overview.md#operating-system-requirements)

2. На странице **Регистрация** в поле **Имя конфигурации узла** выберите имя конфигурации узла, которое необходимо применить к виртуальной машине. На этом этапе указывать имя необязательно. После подключения узла назначенную конфигурацию узла можно изменить.
   Установите флажок **Перезагрузить узел при необходимости** и нажмите кнопку **ОК**.

   ![Снимок экрана: колонка "Регистрация"](./media/automation-dsc-getting-started/RegisterVM.png)

   Указанная конфигурация узла применяется к виртуальной машине с периодичностью, указанной в поле **Частота обновления режима настройки**. Виртуальная машина проверяет наличие обновлений для конфигурации узла с периодичностью, указанной в поле **Частота обновления**. Дополнительные сведения об использовании этих значений см. в статье [Настройка локального диспетчера конфигураций](/powershell/scripting/dsc/managing-nodes/metaConfig).

Azure запускает процесс подключения виртуальной машины. Когда он будет завершен, виртуальная машина появится на вкладке **Узлы** на странице **Настройка состояния (DSC)** в учетной записи автоматизации.

## <a name="viewing-the-list-of-managed-nodes"></a>Просмотр списка управляемых узлов

Список всех виртуальных машин, подключенных для управления, можно просмотреть в учетной записи службы автоматизации на вкладке **Узлы** на странице **Настройка состояния (DSC)**.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. В колонке **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Узлы**.

## <a name="viewing-reports-for-managed-nodes"></a>Просмотр отчетов для управляемых узлов

Каждый раз, когда "Настройка состояния службы автоматизации Azure" проверяет согласованность на управляемом узле, узел отправляет отчет о состоянии на опрашивающий сервер. Отчеты для соответствующего узла можно посмотреть на его странице.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. В колонке **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **конфигурации состояния (DSC)** нажмите на вкладку **«Узлы».** Здесь вы можете увидеть обзор состояния конфигурации и детали для каждого узла.

   ![Снимок экрана страницы "Узел"](./media/automation-dsc-getting-started/NodesTab.png)

1. На вкладке **Узлы** выберите запись узла, чтобы открыть область отчетов. Выберите отчет, в котором нужно просмотреть дополнительные сведения.

   ![Снимок экрана: колонка отчетов](./media/automation-dsc-getting-started/NodeReport.png)

В колонке для отдельного отчета можно увидеть следующие сведения о состоянии для соответствующей проверки согласованности.

- Состояние отчета. Находится ли узел в состоянии "Совместимый" или "Несовместимый", а конфигурация — в состоянии "Сбой" (когда для узла установлен режим **ApplyandMonitor**, а виртуальная машина находится не в требуемом состоянии).
- Время начала проверки согласованности.
- Общее время выполнения проверки согласованности.
- Тип проверки согласованности.
- Все ошибки, в том числе код и сообщение ошибки.
- Все ресурсы DSC, используемые в конфигурации, и состояние каждого ресурса (находится ли узел в требуемом состоянии для этого ресурса). Щелкните каждый ресурс, чтобы получить дополнительные сведения о нем.
- Имя, IP-адрес и режим конфигурации узла.

Кроме того, можно щелкнуть **Просмотреть необработанный отчет**, чтобы просмотреть фактические данные, которые узел отправляет на сервер.
Дополнительные сведения об использовании этих данных см. в статье [Использование сервера отчетов DSC](/powershell/scripting/dsc/pull-server/reportserver).

После подключения узла первый отчет станет доступным через некоторое время. Может пройти около 30 минут, прежде чем первый отчет станет доступным после подключения узла.

## <a name="reassigning-a-node-to-a-different-node-configuration"></a>Переназначение узла другой конфигурации

Узел можно назначить для использования конфигурации, которая отличается от назначенной изначально.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. В колонке **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, который необходимо переназначить.
1. На странице этого узла нажмите кнопку **Назначить конфигурацию узла**.

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNode.png)

1. На странице **Назначить конфигурацию узла** выберите конфигурацию, которой необходимо назначить узел, и нажмите кнопку **ОК**.

    ![Снимок экрана: страница "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNodeConfig.png)

## <a name="unregistering-a-node"></a>Отмена регистрации узла

Если больше не требуется управлять узлом с использованием DSC службы автоматизации Azure, можно отменить регистрацию.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. В колонке **Учетная запись автоматизации** в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице **Настройка состояния (DSC)** выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, регистрацию которого необходимо отменить.
1. На странице для этого узла нажмите кнопку **Unregister** (Отменить регистрацию).

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Отменить регистрацию"](./media/automation-dsc-getting-started/UnregisterNode.png)

## <a name="related-articles"></a>Связанные статьи

- [Обзор службы "Настройка состояния службы автоматизации Azure"](automation-dsc-overview.md)
- [Подключение компьютеров для управления с помощью службы "Настройка состояния службы автоматизации Azure"](automation-dsc-onboarding.md)
- [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview)
- [Статья с командлетами "Настройка состояния службы автоматизации Azure"](/powershell/module/azurerm.automation/#automation)
- [Страница с ценами на "Настройка состояния службы автоматизации Azure"](https://azure.microsoft.com/pricing/details/automation/)
