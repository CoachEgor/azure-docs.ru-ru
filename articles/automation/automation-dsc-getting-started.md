---
title: Начало работы с конфигурацией состояния автоматизации Azure
description: Описание и примеры самых распространенных задач в "Настройка состояния службы автоматизации Azure"
services: automation
ms.service: automation
ms.subservice: dsc
author: mgoedtel
ms.author: magoedte
ms.date: 04/15/2019
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 43268d5b48b44fffefa222f566c40151c85a5895
ms.sourcegitcommit: d6e4eebf663df8adf8efe07deabdc3586616d1e4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/15/2020
ms.locfileid: "81392173"
---
# <a name="get-started-with-azure-automation-state-configuration"></a>Начало работы с конфигурацией состояния автоматизации Azure

В этой статье описано, как выполнять самые распространенные задачи с помощью "Настройка состояния службы автоматизации Azure", например создание, импорт и компилирование конфигураций, подключение компьютеров для управления, а также просмотр отчетов. Обзор "Настройка состояния службы автоматизации Azure" см. в статье с [обзором этой службы](automation-dsc-overview.md). Документацию по DSC см. в статье [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview).

В этой статье описаны пошаговые инструкции по использованию "Настройка состояния службы автоматизации Azure". Если необходим пример среды, настроенной без выполнения действий, описанных в этой статье, можно использовать следующий шаблон Resource Manager: [шаблон управляемого узла службы автоматизации Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/101-automation-configuration). Этот шаблон позволяет настроить полнофункциональную среду "Настройка состояния службы автоматизации Azure", в том числе виртуальную машину Azure, которой управляет "Настройка состояния службы автоматизации Azure".

## <a name="prerequisites"></a>Предварительные требования

Для выполнения примеров из этой статьи необходимо следующее.

- Учетная запись службы автоматизации Azure. Указания по созданию учетной записи запуска от имени пользователя для службы автоматизации Azure см. в статье [Проверка подлинности модулей Runbook в Azure с помощью учетной записи запуска от имени](automation-sec-configure-azure-runas-account.md).
- Менеджер ресурсов Azure VM (не Классический) работает [с поддерживаемой операционной системой.](automation-dsc-overview.md#operating-system-requirements) Инструкции по созданию виртуальной машины см. в статье [Создание первой виртуальной машины Windows на портале Azure](../virtual-machines/virtual-machines-windows-hero-tutorial.md).

## <a name="creating-a-dsc-configuration"></a>Создание конфигурации DSC

Создайте простую [конфигурацию DSC](/powershell/scripting/dsc/configurations/configurations), которая обеспечивает наличие или отсутствие компонента Windows **веб-сервера** (IIS) в зависимости от назначения узлов.

1. Запустите [VSCode](https://code.visualstudio.com/docs) (или любой текстовый редактор).
1. Введите следующий текст:

    ```powershell
    configuration TestConfig
    {
        Node IsWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Present'
                Name                 = 'Web-Server'
                IncludeAllSubFeature = $true
            }
        }

        Node NotWebServer
        {
            WindowsFeature IIS
            {
                Ensure               = 'Absent'
                Name                 = 'Web-Server'
            }
        }
    }
    ```
1. Сохранить файл как **TestConfig.ps1**.

Эта конфигурация вызывает один ресурс в каждом блоке узлов, [ресурс WindowsFeature.](/powershell/scripting/dsc/reference/resources/windows/windowsfeatureresource) Этот ресурс обеспечивает наличие или отсутствие функции **Web-Server.**

## <a name="importing-a-configuration-into-azure-automation"></a>Импорт конфигурации в службу автоматизации Azure

Теперь импортируйте конфигурацию в учетную запись службы автоматизации.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице конфигурации состояния (DSC) щелкните **вкладку Конфигурации,** а затем нажмите **«Добавить».**
1. На панели конфигурации импорта просматривайте `TestConfig.ps1` файл на компьютере.

   ![Снимок экрана: колонка **Импорт конфигурации**](./media/automation-dsc-getting-started/AddConfig.png)

1. Нажмите кнопку **ОК**.

## <a name="viewing-a-configuration-in-azure-automation"></a>Просмотр конфигурации в службе автоматизации Azure

После импорта конфигурацию можно просмотреть на портале Azure.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице учетной записи Automation выберите **конфигурацию состояния (DSC)** под **управлением конфигурации.**
1. На странице конфигурации состояния (DSC) щелкните **вкладку Конфигурации,** а затем нажмите **TestConfig.** Это название конфигурации, импортированной в предыдущей процедуре.
1. На панели конфигурации TestConfig нажмите **на источник конфигурации View.**

   ![Снимок экрана: колонка "TestConfig configuration" (Конфигурация TestConfig)](./media/automation-dsc-getting-started/ViewConfigSource.png)

   Открывается панель исходного стекла Конфигурации TestConfig, отображающая код PowerShell для конфигурации.

## <a name="compiling-a-configuration-in-azure-automation"></a>Компилирование конфигурации в службе автоматизации Azure

Прежде чем применить требуемое состояние к узлу, конфигурацию DSC, определяющую это состояние, следует компилировать в одну или несколько конфигураций узла (MOF-документы) и разместить на опрашивающем сервере Automation DSC. Подробное описание компилирования конфигураций в "Настройка состояния службы автоматизации Azure" см. в [этой статье](automation-dsc-compile.md).
Дополнительные сведения о компилировании конфигураций см. в статье [Конфигурации DSC](/powershell/scripting/dsc/configurations/configurations).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице конфигурации состояния (DSC) щелкните **вкладку Конфигурации,** а затем нажмите **TestConfig.** Это название ранее импортированной конфигурации.
1. На панели конфигурации TestConfig нажмите **«Компилер»,** а затем нажмите **«Да».** Запустится задание компиляции.

   ![Снимок экрана: страница TestConfig configuration (Конфигурация TestConfig) с выделенной кнопкой "Скомпилировать"](./media/automation-dsc-getting-started/CompileConfig.png)

> [!NOTE]
> При компилации конфигурации в Azure Automation он автоматически развертывает любые созданные файлы MOF-конфигурации узлов на сервер pull.

## <a name="viewing-a-compilation-job"></a>Просмотр задания компиляции

После начала компиляции можно просмотреть ее в плитке **«Вакансии компиляции»** на странице **Конфигурации.** На плитке **Задания компиляции** отображаются выполняющиеся, выполненные и невыполненные задания. При открытии панели выполнения задания отображается информация об этом задания, включая любые ошибки или предупреждения, параметры ввода, используемые в конфигурации, и журналы компиляции.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице конфигурации состояния (DSC) щелкните **вкладку Конфигурации,** а затем нажмите **TestConfig.** Это название ранее импортированной конфигурации.
1. В **заданиях компиляции**выберите задания компиляции для просмотра. Открывается панель компиляции вакансии с маркировкой с датой начала выполнения задания компиляции.

   ![Снимок экрана: страница "Задание компиляции"](./media/automation-dsc-getting-started/CompilationJob.png)

1. Нажмите на любую плитку в панели компиляции Вакансия, чтобы увидеть более подробную информацию о работе.

## <a name="viewing-node-configurations"></a>Просмотр конфигураций узлов

При успешном выполнении задания компиляции создается одна или несколько конфигураций узлов. Конфигурация узла — это MOF-документ, который развертывается на опрашивающем сервере и готов к извлечению и применению одним или несколькими узлами. Конфигурации узлов можно просматривать в учетной записи Автоматизации на странице конфигурации состояния (DSC). Конфигурация узла имеет имя `ConfigurationName.NodeName`с формой.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Скомпилированные конфигурации**.

   ![Снимок экрана: вкладка "Скомпилированные конфигурации"](./media/automation-dsc-getting-started/NodeConfigs.png)

## <a name="onboarding-an-azure-vm-for-management-with-azure-automation-state-configuration"></a>Подключение виртуальной машины Azure для управления с использованием "Настройка состояния службы автоматизации Azure"

Можно использовать конфигурацию Azure Automation State Configuration для управления VMs-ресурсами Azure (как классическими, так и ресурсными менеджерами), наемных вм: ВМ, Linux-машин, AWS VMs и на емких физических машинах. Из этой статьи вы узнали, как подключать только виртуальные машины Azure Resource Manager. Дополнительные сведения о подключении машин других типов см. в статье [Подключение компьютеров для управления с помощью Azure Automation DSC](automation-dsc-onboarding.md).

### <a name="to-onboard-an-azure-resource-manager-vm-for-management-by-azure-automation-state-configuration"></a>Чтобы подключить виртуальную машину Azure Resource Manager для управления с помощью "Настройка состояния службы автоматизации Azure"

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице конфигурации состояния (DSC) выберите вкладку **«Узлы»,** а затем щелкните **и перебавьте.**

   ![Снимок экрана: страница "Узлы DSC" с выделенной кнопкой "Добавить виртуальную машину Azure"](./media/automation-dsc-getting-started/OnboardVM.png)

1. На панели виртуальных машин выберите VM.
1. На панели детали виртуальной машины, нажмите **кнопку и подключите**.

   > [!IMPORTANT]
   > VM должен быть менеджером ресурсов Azure VM, работающим [с поддерживаемой операционной системой.](automation-dsc-overview.md#operating-system-requirements)

2. На странице Регистрации выберите имя конфигурации узла, чтобы применить сятр в поле **имени конфигурации узлов.** На этом этапе указывать имя необязательно. После подключения узла назначенную конфигурацию узла можно изменить.

3. Установите флажок **Перезагрузить узел при необходимости** и нажмите кнопку **ОК**.

   ![Снимок экрана: колонка "Регистрация"](./media/automation-dsc-getting-started/RegisterVM.png)

   Указанная конфигурация узла применяется к VM с интервалами, указанными значением, указанным для **частоты режима конфигурации.** VM проверяет обновления конфигурации узлов с интервалами, указанными значением **обновления частоты.** Дополнительные сведения об использовании этих значений см. в статье [Настройка локального диспетчера конфигураций](/powershell/scripting/dsc/managing-nodes/metaConfig).

Azure запускает процесс подключения виртуальной машины. Когда он будет завершен, виртуальная машина появится на вкладке **Узлы** на странице Настройка состояния (DSC) в учетной записи автоматизации.

## <a name="viewing-the-list-of-managed-nodes"></a>Просмотр списка управляемых узлов

Список всех виртуальных машин, подключенных для управления, можно просмотреть в учетной записи службы автоматизации на вкладке **Узлы** на странице Настройка состояния (DSC).

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Узлы**.

## <a name="viewing-reports-for-managed-nodes"></a>Просмотр отчетов для управляемых узлов

Каждый раз, когда "Настройка состояния службы автоматизации Azure" проверяет согласованность на управляемом узле, узел отправляет отчет о состоянии на опрашивающий сервер. Отчеты для соответствующего узла можно посмотреть на его странице.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице конфигурации состояния (DSC) нажмите на вкладку **«Узлы».** Здесь вы можете увидеть обзор состояния конфигурации и детали для каждого узла.

   ![Снимок экрана страницы "Узел"](./media/automation-dsc-getting-started/NodesTab.png)

1. На вкладке **Узлы** выберите запись узла, чтобы открыть область отчетов. Выберите отчет, в котором нужно просмотреть дополнительные сведения.

   ![Снимок экрана: колонка отчетов](./media/automation-dsc-getting-started/NodeReport.png)

В колонке для отдельного отчета можно увидеть следующие сведения о состоянии для соответствующей проверки согласованности.

- Статус отчета. Возможны следующие значения:
    * Совместимый - узла соответствует чеку.
   * Не удалось - конфигурация не прошла проверку.
   * Не соответствует - узел `ApplyandMonitor` находится в режиме и машина находится не в нужном состоянии.
- Время начала проверки согласованности.
- Общее время выполнения проверки согласованности.
- Тип проверки согласованности.
- Все ошибки, в том числе код и сообщение ошибки.
- Любые ресурсы DSC, используемые в конфигурации, и состояние каждого ресурса (независимо от того, находится ли узла в нужном состоянии для этого ресурса). Вы можете нажать на каждый ресурс, чтобы получить более подробную информацию для этого ресурса.
- Имя, IP-адрес и режим конфигурации узла.

Кроме того, можно щелкнуть **Просмотреть необработанный отчет**, чтобы просмотреть фактические данные, которые узел отправляет на сервер.
Дополнительные сведения об использовании этих данных см. в статье [Использование сервера отчетов DSC](/powershell/scripting/dsc/pull-server/reportserver).

После подключения узла первый отчет станет доступным через некоторое время. Может пройти около 30 минут, прежде чем первый отчет станет доступным после подключения узла.

## <a name="reassigning-a-node-to-a-different-node-configuration"></a>Переназначение узла другой конфигурации

Узел можно назначить для использования конфигурации, которая отличается от назначенной изначально.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, который необходимо переназначить.
1. На странице этого узла нажмите кнопку **Назначить конфигурацию узла**.

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNode.png)

1. На странице Назначить конфигурацию узла выберите конфигурацию, которой необходимо назначить узел, и нажмите кнопку **ОК**.

    ![Снимок экрана: страница "Назначить конфигурацию узла"](./media/automation-dsc-getting-started/AssignNodeConfig.png)

## <a name="unregistering-a-node"></a>Отмена регистрации узла

Если больше не требуется управлять узлом с использованием DSC службы автоматизации Azure, можно отменить регистрацию.

1. Войдите на [портал Azure](https://portal.azure.com).
1. Слева щелкните **Все ресурсы**, а затем — имя учетной записи службы автоматизации.
1. На странице Учетная запись автоматизации в разделе **Управление конфигурацией** выберите **Настройка состояния (DSC)**.
1. На странице Настройка состояния (DSC) выберите вкладку **Узлы**.
1. На вкладке **Узлы** щелкните имя узла, регистрацию которого необходимо отменить.
1. На панели для этого узла нажмите **Unregister.**

    ![Снимок экрана: страница сведений "Узел" с выделенной кнопкой "Отменить регистрацию"](./media/automation-dsc-getting-started/UnregisterNode.png)

## <a name="related-articles"></a>Связанные статьи

- [Обзор службы "Настройка состояния службы автоматизации Azure"](automation-dsc-overview.md)
- [Подключение компьютеров для управления с помощью службы "Настройка состояния службы автоматизации Azure"](automation-dsc-onboarding.md)
- [Общие сведения о службе настройки требуемого состояния Windows PowerShell](/powershell/scripting/dsc/overview/overview)
- [Страница с ценами на "Настройка состояния службы автоматизации Azure"](https://azure.microsoft.com/pricing/details/automation/)
- [Az.Automation](https://docs.microsoft.com/powershell/module/az.automation/?view=azps-3.7.0#automation)