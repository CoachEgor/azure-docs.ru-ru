---
title: Обзор гибридной рабочей роли Runbook в службе автоматизации Azure
description: Эта статья содержит общие сведения о гибридной рабочей роли Runbook, которую можно использовать для выполнения модулей runbook на компьютерах в локальном центре обработки данных или центре обработки данных поставщика облачных служб.
services: automation
ms.subservice: process-automation
ms.date: 07/16/2020
ms.topic: conceptual
ms.openlocfilehash: 69680fbb442b4e636b72f480ed21f36924362a13
ms.sourcegitcommit: 3d79f737ff34708b48dd2ae45100e2516af9ed78
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "87024832"
---
# <a name="hybrid-runbook-worker-overview"></a>Обзор гибридной рабочей роли Runbook

Модули Runbook в службе автоматизации Azure не будут иметь доступ к ресурсам в других облаках или локальной среде, так как они выполняются на платформе облака Azure. Вы можете использовать функцию гибридной рабочей роли Runbook в службе автоматизации Azure для запуска модулей Runbook непосредственно на компьютере, на котором размещается роль, и для ресурсов в среде, чтобы управлять этими локальными ресурсами. Модули Runbook хранятся и управляются в службе автоматизации Azure, а затем доставляются на один или несколько назначенных машин.

Эта функция проиллюстрирована на следующем изображении.

![Обзор гибридной рабочей роли Runbook](media/automation-hybrid-runbook-worker/automation.png)

Гибридная Рабочая роль Runbook может выполняться в операционной системе Windows или Linux. Это зависит от того, [log Analytics агент](../azure-monitor/platform/log-analytics-agent.md) передает отчеты в [рабочую область Azure Monitor log Analytics](../azure-monitor/platform/design-logs-deployment.md). Рабочая область предназначена не только для наблюдения за машиной поддерживаемой операционной системы, но также для загрузки компонентов, необходимых для гибридной рабочей роли Runbook.

Каждый гибридный компонент Runbook Worker является членом группы гибридных компонентов Runbook Worker, которая указывается при установке агента. Группа может включать одного агента, но в нее можно установить несколько агентов для обеспечения высокого уровня доступности. Каждый компьютер может содержать одну гибридную рабочую роль Runbook, которая создает отчеты для одной учетной записи службы автоматизации.

Когда вы запускаете модуль runbook в гибридной рабочей роли Runbook, вы выбираете группу для его выполнения. Каждый компонент Worker в группе опрашивает службу автоматизации, чтобы узнать, доступны ли какие-либо задания. Если задание доступно, его получает первая рабочая роль. Время обработки очереди заданий зависит от профиля оборудования и загрузки гибридной рабочей роли. Указание конкретной рабочей роли невозможно.

Используйте гибридную рабочую роль Runbook вместо [песочницы Azure](automation-runbook-execution.md#runbook-execution-environment), так как у нее нет многих присущих песочнице [ограничений](../azure-resource-manager/management/azure-subscription-service-limits.md#automation-limits) в отношении места на диске, памяти и сетевых сокетов. Ограничения гибридной рабочей роли связаны только с собственными ресурсами рабочей роли.

> [!NOTE]
> Гибридные рабочие роли Runbook не ограничены пределом времени [справедливого распределения](automation-runbook-execution.md#fair-share), как песочницы Azure.

## <a name="hybrid-runbook-worker-installation"></a>Установка гибридной рабочей роли Runbook

Процесс установки гибридной рабочей роли Runbook зависит от операционной системы. В таблице ниже указаны типы развертывания.

|Операционная система  |Типы развертывания  |
|---------|---------|
|Windows     | [Автоматическое](automation-windows-hrw-install.md#automated-deployment)<br>[Вручную](automation-windows-hrw-install.md#manual-deployment)        |
|Linux     | [Python](automation-linux-hrw-install.md#install-a-linux-hybrid-runbook-worker)        |

Рекомендуемый способ установки заключается в том, чтобы полностью автоматизировать процесс настройки компьютера Windows с помощью модуля Runbook службы автоматизации Azure. Если это нецелесообразно, можно выполнить пошаговую процедуру, чтобы вручную установить и настроить роль. Для компьютеров с Linux для установки агента запустите скрипт Python.

## <a name="network-planning"></a><a name="network-planning"></a>Планирование сети

Чтобы гибридная рабочая роль Runbook могла подключаться к службе автоматизации Azure и регистрироваться в ней, ей нужен доступ к номерам портов и URL-адресам, описанным в этом разделе. Кроме того, у рабочей роли должен быть доступ к [портам и URL-адресам, необходимым для того, чтобы агент Log Analytics](../azure-monitor/platform/agent-windows.md) мог подключиться к рабочей области Log Analytics в Azure Monitor.

[!INCLUDE [azure-monitor-log-analytics-rebrand](../../includes/azure-monitor-log-analytics-rebrand.md)]

Для гибридной рабочей роли Runbook необходимы следующие порт и URL-адрес:

* Порт: только исходящий интернет-трафик через TCP-порт 443.
* Глобальный URL-адрес:`*.azure-automation.net`
* Глобальный URL-адрес US Gov (Вирджиния):`*.azure-automation.us`
* Служба агента:`https://<workspaceId>.agentsvc.azure-automation.net`

При наличии учетной записи службы автоматизации, определенной для конкретного региона, можно ограничить обмен данными гибридной рабочей роли Runbook соответствующим региональным центром обработки данных. Проверьте [записи DNS, используемые службой автоматизации Azure](how-to/automation-region-dns-records.md) для необходимых записей DNS.

### <a name="proxy-server-use"></a>Использование прокси-сервера

Если вы используете прокси-сервер для обмена данными между службой автоматизации Azure и компьютерами, на которых выполняется агент Log Analytics, убедитесь, что соответствующие ресурсы доступны. Время ожидания запросов от гибридной рабочей роли Runbook и служб автоматизации составляет 30 секунд. После трех попыток запрос завершится ошибкой.

### <a name="firewall-use"></a>Использование брандмауэра

Если доступ к Интернету ограничивается брандмауэром, вам нужно изменить его настройки, чтобы разрешить доступ. Если в качестве прокси-сервера используется шлюз Log Analytics, он должен быть настроен для гибридных рабочих ролей Runbook. См. статью о [настройке шлюза Log Analytics для поддержки гибридных рабочих ролей службы автоматизации](../azure-monitor/platform/gateway.md).

### <a name="service-tags"></a>Теги служб

Служба автоматизации Azure поддерживает теги службы виртуальной сети Azure, начиная с тега службы [гуестандхибридманажемент](../virtual-network/service-tags-overview.md). Теги службы можно использовать для определения элементов управления доступом к сети для [групп безопасности сети](../virtual-network/security-overview.md#security-rules) или [брандмауэра Azure](../firewall/service-tags.md). Теги службы можно использовать вместо конкретных IP-адресов при создании правил безопасности. Указав имя тега службы **гуестандхибридманажемент** в соответствующем поле источника или назначения правила, можно разрешить или запретить трафик для службы автоматизации. Этот тег службы не поддерживает более детализированный контроль за счет ограниченного диапазона IP-адресов в определенном регионе.

Тег службы службы автоматизации Azure предоставляет только IP-адреса, используемые в следующих сценариях:

* Активация веб-перехватчиков в виртуальной сети
* Разрешить гибридным рабочим процессам Runbook или агентам конфигурации состояния в виртуальной сети взаимодействовать со службой автоматизации

>[!NOTE]
>Тег службы **гуестандхибридманажемент** сейчас не поддерживает выполнение задания Runbook в песочнице Azure, только непосредственно в гибридной рабочей роли Runbook.

## <a name="support-for-impact-level-5-il5"></a>Поддержка уровня влияния 5 (IL5)

Гибридную рабочую роль Runbook службы автоматизации Azure можно использовать в Azure для государственных организаций, чтобы обеспечить поддержку рабочих нагрузок уровня 5 в любой из следующих двух конфигураций:

* [Изолированная виртуальная машина](../azure-government/documentation-government-impact-level-5.md#isolated-virtual-machines). При развертывании они используют весь физический узел для виртуальной машины, предоставляя необходимый уровень изоляции, необходимый для поддержки рабочих нагрузок IL5.

* [Выделенные узлы Azure](../azure-government/documentation-government-impact-level-5.md#azure-dedicated-hosts), которые предоставляют физические серверы, на которых можно разместить одну или несколько виртуальных машин, выделенных для одной подписки Azure.

>[!NOTE]
>Изоляция вычислений через гибридную рабочую роль Runbook доступна для коммерческих облаков Azure и государственных организаций США. 

## <a name="update-management-on-hybrid-runbook-worker"></a>Управление обновлениями в гибридной рабочей роли Runbook

Если включена служба автоматизации Azure [Управление обновлениями](automation-update-management.md) , любой компьютер, подключенный к рабочей области log Analytics, автоматически настраивается в качестве гибридного рабочего процесса Runbook. Каждая рабочая роль может поддерживать модули runbook, связанные с управлением обновлениями.

Настроенный таким образом компьютер не зарегистрирован ни в одной группе гибридных рабочих ролей Runbook, которая уже определена в вашей учетной записи службы автоматизации. Вы можете добавить компьютер в группу гибридных рабочих ролей Runbook, но необходимо использовать одну и ту же учетную запись как для Управление обновлениями, так и для членства в группе гибридной рабочей роли Runbook. Эта функция была добавлена в версии 7.2.12024.0 гибридной рабочей роли Runbook.

### <a name="update-management-addresses-for-hybrid-runbook-worker"></a>Адреса для решения по управлению обновлениями в гибридной рабочей роли Runbook

Поверх стандартных адресов и портов, необходимых для гибридной рабочей роли Runbook, Управление обновлениями предъявляют дополнительные требования к конфигурации сети, описанные в разделе « [планирование сети](automation-update-management.md#ports) ».

## <a name="azure-automation-state-configuration-on-a-hybrid-runbook-worker"></a>Использование State Configuration службы автоматизации Azure в гибридной рабочей роли Runbook

Вы можете использовать [State Configuration службы автоматизации Azure](automation-dsc-overview.md) в гибридной рабочей роли Runbook. Для управления конфигурацией серверов, поддерживающих гибридную рабочую роль Runbook, необходимо добавить эти серверы в качестве узлов DSC. Дополнительные сведения см. в статье [Подключение компьютеров для управления с помощью State Configuration службы автоматизации Azure](automation-dsc-onboarding.md).

## <a name="runbooks-on-a-hybrid-runbook-worker"></a>Модули runbook в гибридной рабочей роли Runbook

Возможно, у вас есть модули Runbook, которые управляют ресурсами на локальном компьютере или работают с ресурсами в локальной среде, в которой развернута Гибридная Рабочая роль Runbook. В этом случае можно выбрать запуск модулей runbook в гибридной рабочей роли, а не в учетной записи службы автоматизации. Модули runbook, выполняемые в гибридной рабочей роли Runbook, по структуре идентичны тем, что выполняются в учетной записи службы автоматизации. См. статью [Запуск модулей Runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md).

### <a name="hybrid-runbook-worker-jobs"></a>Задания гибридной рабочей роли Runbook

Задания гибридной рабочей роли Runbook выполняются в локальной учетной записи **System** в Windows или в учетной записи [nxautomation](automation-runbook-execution.md#log-analytics-agent-for-linux) в Linux. Служба автоматизации Azure обрабатывает задания в гибридных рабочих ролях Runbook несколько иначе, чем задания, выполняемые в песочницах Azure. См. раздел [Среда выполнения runbook](automation-runbook-execution.md#runbook-execution-environment).

При перезагрузке компьютера, выполняющего гибридную рабочую роль Runbook, все выполняемые задания runbook запускаются заново, с самого начала или с последней контрольной точки, если это runbook рабочих процессов PowerShell. Если задание runbook перезапускается более трех раз, его выполнение приостанавливается.

### <a name="runbook-permissions-for-a-hybrid-runbook-worker"></a>Разрешения runbook для гибридной рабочей роли Runbook

Модули runbook, запущенные в гибридной рабочей роли Runbook, обращаются к ресурсам за пределами Azure, поэтому они не могут использовать стандартный метод аутентификации модулей runbook в Azure. Модуль runbook предоставляет собственную аутентификацию для локальных ресурсов или настраивает ее с помощью [управляемых удостоверений для ресурсов Azure](../active-directory/managed-identities-azure-resources/tutorial-windows-vm-access-arm.md#grant-your-vm-access-to-a-resource-group-in-resource-manager). Также вы можете указать учетную запись запуска от имени, чтобы предоставить контекст пользователя для всех модулей runbook.

## <a name="next-steps"></a>Дальнейшие действия

* Чтобы узнать, как настроить модули runbook для автоматизации процессов в локальном центре обработки данных или другой облачной среде, см. статью [Запуск модулей runbook в гибридной рабочей роли Runbook](automation-hrw-run-runbooks.md).

* Дополнительные сведения см. в статье [Устранение неполадок с гибридными рабочими ролями Runbook](troubleshoot/hybrid-runbook-worker.md#general).
