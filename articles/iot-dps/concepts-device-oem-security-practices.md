---
title: Методы обеспечения безопасности для производителей - Служба обеспечения устройств Azure IoT
description: Обзор ы общей практики безопасности для производителей oE-производителей оборудования, которые готовят устройства для регистрации в Службе обеспечения устройств Azure IoT (DPS).
author: timlt
ms.author: timlt
ms.date: 3/02/2020
ms.topic: conceptual
ms.service: iot-dps
ms.custom: iot-p0-scenario, iot-devices-deviceOEM
ms.reviewer: nberdy
ms.openlocfilehash: 3854f353e4ea0b78c0162681e0b89d37419105d8
ms.sourcegitcommit: c5661c5cab5f6f13b19ce5203ac2159883b30c0e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80529521"
---
# <a name="security-practices-for-azure-iot-device-manufacturers"></a>Методы обеспечения безопасности для производителей устройств Azure IoT
Поскольку все больше производителей выпускают устройства IoT, полезно определить рекомендации по общей практике. В этой статье кратко излагаются рекомендуемые методы безопасности для рассмотрения при производстве устройств для использования с Azure IoT устройств Службы обеспечения (DPS).  

> [!div class="checklist"]
> * Выбор вариантов проверки подлинности устройства
> * Установка сертификатов на устройствах IoT
> * Интеграция модуля надежной платформы (TPM) в производственный процесс

## <a name="selecting-device-authentication-options"></a>Выбор вариантов проверки подлинности устройства
Конечная цель любой меры безопасности устройств IoT заключается в создании безопасного решения IoT. Но такие вопросы, как аппаратные ограничения, стоимость и уровень экспертизы безопасности, влияют на то, какие варианты вы выберете. Кроме того, ваш подход к безопасности влияет на то, как ваши устройства IoT подключаются к облаку. Хотя необходимо учитывать [несколько элементов безопасности IoT,](https://www.microsoft.com/research/publication/seven-properties-highly-secure-devices/) ключевым элементом, с которым сталкивается каждый клиент, является тип проверки подлинности. 

Три широко используемых типа аутентификации: сертификаты X.509, модули trusted Platform (TPM) и симметричные клавиши. В то время как существуют другие типы аутентификации, большинство клиентов, создающие решения на Azure IoT, используют один из этих трех типов. В остальной части этой статьи исследования плюсы и минусы использования каждого типа проверки подлинности.

### <a name="x509-certificate"></a>Сертификат X.509
Сертификаты X.509 являются типом цифровой идентификации, который можно использовать для проверки подлинности. Стандарт сертификата X.509 задокументирован в [IETF RFC 5280](https://tools.ietf.org/html/rfc5280). В Azure IoT существует два способа проверки подлинности сертификатов:
- Отпечаток. Алгоритм отпечатков пальцев работает на сертификате для генерации гексадецимальной строки. Генерируемая строка является уникальным идентификатором для сертификата. 
- Проверка подлинности CA на основе полной цепочки. Цепочка сертификатов — это иерархический список всех сертификатов, необходимых для проверки подлинности сертификата конечной сущности (EE). Чтобы проверить подлинность сертификата EE, необходимо проверить подлинность каждого сертификата в цепочке, включая доверенный корневой CA. 

Плюсы для X.509:
- X.509 — самый безопасный тип аутентификации, поддерживаемый в Azure IoT.
- X.509 обеспечивает высокий уровень контроля для целей управления сертификатами.
- Многие поставщики могут предоставить решения для проверки подлинности на основе X.509.

Минусы для X.509:
- Многим клиентам, возможно, придется полагаться на внешних поставщиков для получения сертификатов.
- Управление сертификатами может быть дорогостоящим и добавляет к общей стоимости решения.
- Управление сертификатом жизненного цикла может быть затруднено, если логистика не продумана. 

### <a name="trusted-platform-module-tpm"></a>Доверенный платформенный модуль (TPM)
TPM, также известный как [ISO/IEC 11889,](https://www.iso.org/standard/66510.html)является стандартом для надежного создания и хранения криптографических ключей. TPM также относится к виртуальному или физическому устройству вв./о, которое взаимодействует с модулями, реализуемыми в стандарте. Устройство TPM может существовать как дискретное оборудование, интегрированное оборудование, модуль на основе прошивки или модуль на основе программного обеспечения. 

Есть два ключевых различия между TPMs и симметричными ключами: 
- Чипы TPM также могут хранить сертификаты X.509.
- TPM-подтверждение в DPS использует клавишу одобрения TPM (EK), форму асимметричной аутентификации. При асимметричной аутентификации для шифрования используется открытый ключ, а для расшифровки используется отдельный закрытый ключ. В отличие от этого, симметричные ключи используют симметричную аутентификацию, где частный ключ используется как для шифрования, так и для расшифровки. 

Плюсы для TPM:
- TPMs включены в качестве стандартного оборудования на многих устройствах Windows, со встроенной поддержкой операционной системы. 
- TPM-аттестация легче обеспечить, чем симметричное подтверждение ключа на основе общего доступа (SAS).
- Вы можете легко истечь и обновить или свернуть учетные данные устройства. DPS автоматически свертывает учетные данные Концентратора IoT всякий раз, когда устройство TPM должно быть перезаготовино.

Минусы для TPM: 
- TPMs являются сложными и могут быть трудными в использовании. 
- Разработка приложений с TPMs затруднена, если у вас нет физического TPM или эмулятора качества.
- Возможно, вам придется перепроектировать доску устройства, чтобы включить TPM в оборудование. 
- Если вы свернуть EK на TPM, он разрушает идентичность TPM и создает новый. Несмотря на то, что физический чип остается неизменным, он имеет новую идентичность в вашем решении IoT.

### <a name="symmetric-key"></a>Симметричный ключ
С помощью симметричных ключей тот же ключ используется для шифрования и расшифровки сообщений. В результате один и тот же ключ известен как устройству, так и службе, которая проверяет его подлинность. Azure IoT поддерживает симметричные ключевые соединения на основе токенов SAS. Симметричная аутентификация ключей требует значительной ответственности владельца за обеспечение безопасности ключей и достижение равного уровня безопасности с помощью x.509 аутентификации. Если вы используете симметричные клавиши, рекомендуемая практика заключается в защите ключей с помощью аппаратного модуля безопасности (HSM).

Плюсы для симметричного ключа:
- Использование симметричных ключей является самым простым и дешевым способом начать работу с аутентификацией.
- Использование симметричных клавиш упрощает процесс, потому что нет ничего лишнего для создания. 

Минусы для симметричного ключа: 
- Симметричные клавиши требуют значительных усилий для обеспечения ключа. Один и тот же ключ распределяется между устройством и облаком, что означает, что ключ должен быть защищен в двух местах. В отличие от этого, проблема с сертификатами TPM и X.509 доказывает владение открытым ключом, не раскрывая частный ключ.
- Симметричные клавиши упрощает соблюдение некачественных методов обеспечения безопасности. Общей тенденцией с симметричными ключами является жесткий код незашифрованных ключей на устройствах. Хотя эта практика удобна, она делает ключи уязвимыми. Вы можете уменьшить некоторые риски, надежно храпая симметричный ключ на устройстве. Однако, если приоритетом в конечном счете является безопасность, а не удобство, используйте сертификаты X.509 или TPM для проверки подлинности. 

### <a name="shared-symmetric-key"></a>Общий симметричный ключ
Существует вариация симметричной проверки подлинности ключей, известная как общий симметричный ключ. Этот подход предполагает использование одного и того же симметричного ключа во всех устройствах. Рекомендация состоит в том, чтобы избегать использования общих симметричных ключей на устройствах. 

Pro для общего симметричного ключа:
- Простой в реализации и недорогой для производства в масштабе. 

Минусы для общего симметричного ключа: 
- Очень уязвимы для атаки. Преимущество легкой реализации намного перевешивает риск. 
- Любой человек может выдавать себя за ваши устройства, если они получают общий ключ.
- Если вы полагаетесь на общий симметричный ключ, который становится скомпрометированным, вы, скорее всего, потеряете контроль над устройствами. 

### <a name="making-the-right-choice-for-your-devices"></a>Правильный выбор для устройств
Чтобы выбрать метод проверки подлинности, убедитесь, что вы учитывайте преимущества и затраты каждого подхода для вашего уникального производственного процесса.  Для проверки подлинности устройств, как правило, существует обратная связь между тем, насколько безопасным является данный подход, и тем, насколько он удобен.  

## <a name="installing-certificates-on-iot-devices"></a>Установка сертификатов на устройствах IoT
Если вы используете сертификаты X.509 для проверки подлинности устройств IoT, в этом разделе содержатся рекомендации по интеграции сертификатов в производственный процесс. Вам нужно будет принять несколько решений.  К ним относятся решения об общих переменных сертификатов, о том, когда создавать сертификаты и когда их устанавливать. 

Если вы привыкли использовать пароли, вы можете спросить, почему вы не можете использовать один и тот же сертификат во всех ваших устройствах, так же, как вы сможете использовать тот же пароль во всех ваших устройствах. Во-первых, использование одного и того же пароля везде опасно. Эта практика подвергла компании крупным DDoS-атакам, в том числе той, которая сняла DNS на Восточном побережье США несколько лет назад. Никогда не используйте один и тот же пароль везде, даже с личными учетными записями. Во-вторых, сертификат не пароль, это уникальная личность. Пароль подован секретному коду, который каждый может использовать, чтобы открыть дверь в защищенном здании.  Это то, что вы знаете, и вы могли бы дать пароль для тех, кто получить вход.  Сертификат подостоит водительское удостоверение с вашей фотографией и другими деталями, которые вы можете показать охраннику, чтобы попасть в охраняемый дом. Это связано с тем, кто ты есть.  При условии, что охранник точно соответствует людям с водительскими правами, только вы можете использовать свои права (идентификации), чтобы получить вход. 

### <a name="variables-involved-in-certificate-decisions"></a>Переменные, участвующие в решениях по сертификатам
Рассмотрим следующие переменные и то, как каждая из них влияет на общий производственный процесс. 

#### <a name="where-the-certificate-root-of-trust-comes-from"></a>Откуда берется корень сертификата доверия
Управлять инфраструктурой ключом общественности (PKI) может быть дорогостоящим и сложным.  Особенно, если ваша компания не имеет никакого опыта управления PKI. Вам доступны следующие действия:
- Используйте сторонний PKI. Вы можете купить промежуточные сертификаты подписи у стороннего поставщика сертификатов. Или вы можете использовать частный сертификат органа (CA). 
- Используйте самоуправляемый PKI. Вы можете поддерживать свою собственную систему PKI и создавать собственные сертификаты.
- Воспользуйтесь службой безопасности [Azure Sphere.](https://azure.microsoft.com/services/azure-sphere/) Эта опция применяется только к устройствам Azure Sphere. 

#### <a name="where-certificates-are-stored"></a>Где хранятся сертификаты
Есть несколько факторов, которые влияют на решение о том, где хранятся сертификаты. Эти факторы включают тип устройства, ожидаемую прибыль (можете ли вы позволить себе безопасное хранилище), возможности устройства и существующую технологию безопасности на устройстве, которое вы можете использовать. Следуйте приведенным ниже рекомендациям.
- В модуле аппаратной безопасности (HSM). Использование HSM настоятельно рекомендуется. Проверьте, установлен ли на доске управления устройства HSM. Если вы знаете, что у вас нет HSM, работайте с производителем оборудования, чтобы определить HSM, который отвечает вашим потребностям.
- В безопасном месте на диске, например, в доверенной среде выполнения (TEE).
- В локальной файловой системе или в магазине сертификатов. Например, в магазине сертификатов Windows. 

#### <a name="connectivity-at-the-factory"></a>Связь на заводе
Связь на заводе определяет, как и когда вы получите сертификаты для установки на устройствах. Варианты подключения следующие:
- Подключения. Наличие подключения является оптимальным, это упрощает процесс генерации сертификатов локально. 
- Нет подключения. В этом случае для генерации сертификатов устройств локально и в автономном режиме используется подписанный сертификат из ЦА. 
- Нет подключения. В этом случае можно получить сертификаты, которые были созданы заранее. Или вы можете использовать автономный PKI для генерации сертификатов локально.

#### <a name="audit-requirement"></a>Требование аудита
В зависимости от типа устройств, которые вы производите, у вас может быть нормативное требование для создания аудиторского следа того, как идентификаторы устройств устанавливаются на устройствах. Аудит добавляет значительные производственные затраты. Так что в большинстве случаев, только сделать это, если это необходимо. Если вы не уверены в необходимости проведения аудита, обратитесь в юридический отдел вашей компании. Варианты аудита: 
- Не чувствительная отрасль. Аудит не требуется.
- Чувствительная промышленность. Сертификаты должны быть установлены в безопасном помещении в соответствии с требованиями сертификации соответствия. Если вам нужна защищенная комната для установки сертификатов, вы, вероятно, уже знаете, как сертификаты устанавливаются в ваших устройствах. И вы, вероятно, уже есть система аудита на месте. 

#### <a name="length-of-certificate-validity"></a>Длина действия сертификата
Как и водительские права, сертификаты имеют срок действия, который устанавливается при их создании. Вот варианты длины сертификата действительности:
- Обновление не требуется.  Этот подход использует длительный период обновления, поэтому вам никогда не придется продлевать сертификат в течение всего срока службы устройства. Хотя такой подход удобен, он также является рискованным.  Вы можете уменьшить риск, используя безопасное хранилище, как HSM на ваших устройствах. Однако рекомендуемая практика заключается в том, чтобы избежать использования сертификатов длительного пользования.
- Требуется обновление.  Вам необходимо обновить сертификат в течение всего срока службы устройства. Продолжительность действия сертификата зависит от контекста, и вам понадобится стратегия обновления.  Стратегия должна включать в себя, где вы получаете сертификаты, и какой тип более-воздух функциональность ваших устройств должны использовать в процессе обновления. 

### <a name="when-to-generate-certificates"></a>Когда создавать сертификаты
Возможности подключения к Интернету на вашем заводе повлияют на ваш процесс создания сертификатов. У вас есть несколько вариантов, когда для создания сертификатов: 

- Предварительно загруженные сертификаты.  Некоторые поставщики HSM предлагают услуги премиум-класса, в которых поставщик HSM устанавливает сертификаты для клиента. Во-первых, клиенты дают поставщику HSM доступ к сертификату подписи. Затем поставщик HSM устанавливает сертификаты, подписанные этим сертификатом подписи, на каждый HSM, который покупает клиент. Все, что клиент должен сделать, это установить HSM на устройстве. Хотя эта услуга добавляет затраты, она помогает оптимизать процесс производства.  И решается вопрос о том, когда устанавливать сертификаты.
- Сертификаты, созданные устройством.  Если ваши устройства генерируют сертификаты внутри компании, необходимо извлечь из устройства общедоступный сертификат X.509, чтобы зарегистрировать его в DPS. 
- Подключенная фабрика.  Если на фабрике есть подключение, вы можете создавать сертификаты устройств, когда они вам нужны.
- Оффлайн завод с вашим собственным PKI. Если на фабрике нет подключения, и вы используете свой собственный PKI с автономной поддержкой, вы можете создавать сертификаты, когда они вам нужны.
- Оффлайн завод с сторонним PKI. Если на фабрике нет подключения, и вы используете стороннюю PKI, вы должны создать сертификаты заранее. И необходимо будет создавать сертификаты из места, которое имеет подключение. 

### <a name="when-to-install-certificates"></a>Когда устанавливать сертификаты
После создания сертификатов для устройств IoT можно установить их в устройствах. 

Если вы используете предварительно загруженные сертификаты с HSM, процесс упрощается. После установки HSM на устройстве код устройства может получить к нему доступ. Затем вы позвоните в AIS HSM, чтобы получить доступ к сертификату, хранящимся в HSM. Этот подход является наиболее удобным для вашего производственного процесса. 

Если вы не используете предварительно загруженный сертификат, вы должны установить сертификат как часть производственного процесса. Самый простой подход заключается в установке сертификата в HSM в то же время, что вы мигать исходное изображение прошивки. Ваш процесс должен добавить шаг для установки изображения на каждом устройстве. После этого шага, вы можете запустить окончательные проверки качества и любые другие шаги, прежде чем упаковать и отправить устройство. 

Есть программные средства, которые позволяют запустить процесс установки и окончательной проверки качества в один шаг. Эти инструменты можно изменить для создания сертификата или вытащить сертификат из предварительно созданного хранилища сертификатов. Затем программное обеспечение может установить сертификат, где вам нужно установить его. Программные средства такого типа позволяют осуществлять производство по качеству продукции в масштабе. 

После того, как на устройствах установлены сертификаты, следующим шагом будет обучение регистрации устройств с [помощью DPS.](about-iot-dps.md) 

## <a name="integrating-a-tpm-into-the-manufacturing-process"></a>Интеграция TPM в производственный процесс
Если вы используете TPM для проверки подлинности устройств IoT, этот раздел предлагает рекомендации. Руководство охватывает широко используемые устройства TPM 2.0, которые имеют код проверки подлинности сообщений (HMAC) ключевой поддержки. Спецификация TPM для чипов TPM является стандартом ISO, который поддерживается Группой надежных вычислений. Для получения дополнительной информации о [TPM 2.0](https://trustedcomputinggroup.org/tpm-library-specification/) TPM см. [ISO/IEC 11889](https://www.iso.org/standard/66510.html) 

### <a name="taking-ownership-of-the-tpm"></a>Принятие на себя ответственности за TPM
Важным шагом в производстве устройства с чипом TPM является владение TPM. Этот шаг необходим для того, чтобы вы могли предоставить ключ владельцу устройства. Первым шагом является извлечение ключа одобрения (EK) из устройства. Следующим шагом является фактически ездовые права собственности. Как вы это сработаете, зависит от того, какую TPM и операционную систему вы используете. При необходимости свяжитесь с производителем TPM или разработчиком операционной системы устройства, чтобы определить, как претендовать на право собственности. 

В процессе производства вы можете извлечь EK и претендовать на право собственности в разное время, что добавляет гибкости. Многие производители пользуются этой гибкостью, добавляя модуль безопасности оборудования (HSM) для повышения безопасности своих устройств. В этом разделе содержатся рекомендации о том, когда следует извлечения ЭК, когда следует претендовать на право собственности на ТПМ, а также о соображениях интеграции этих шагов в производственные сроки. 

> [!IMPORTANT]
> Следующее руководство предполагает использование дискретной, прошивки или интегрированной TPM. В местах, где это применимо, руководство добавляет заметки об использовании недискретного или программного обеспечения TPM. Если вы используете программное обеспечение TPM, могут быть дополнительные шаги, которые это руководство не включает. Программное обеспечение TPMs имеют множество реализаций, которые выходят за рамки данной статьи.  В целом, можно интегрировать программное обеспечение TPM в следующую общую временную шкалу производства. Однако, хотя программное обеспечение, эмулированное TPM, подходит для прототипирования и тестирования, оно не может обеспечить такой же уровень безопасности, как дискретная, прошивка или интегрированная TPM. В качестве общей практики избегайте использования программного обеспечения TPM в производстве.

### <a name="general-manufacturing-timeline"></a>Общие сроки производства
Следующая шкала времени показывает, как TPM проходит производственный процесс и попадает в устройство. Каждый производственный процесс уникален, и эта шкала времени показывает наиболее распространенные закономерности. Хронология предлагает рекомендации о том, когда принимать определенные действия с ключами. 

#### <a name="step-1-tpm-is-manufactured"></a>Шаг 1: TPM производится
- Если вы покупаете TPMs у производителя для использования в ваших устройствах, посмотреть, если они будут извлекать клавиши общественного одобрения (EK_pubs) для вас. Полезно, если производитель предоставляет список EK_pubs с отгруженные устройства. 
    > [!NOTE]
    > Производитель TPM может предоставить доступ к списку регистрации, используя общие политики доступа в службу обеспечения.  Этот подход позволяет им добавлять TPMs в список регистрации для вас.  Но это на ранних стадиях производственного процесса, и это требует доверия к производителю TPM. Делайте это на свой страх и риск. 

- Если вы производите TPMs для продажи производителям устройств, подумайте о том, чтобы предоставить своим клиентам список EK_pubs вместе с их физическими TPM.  Предоставление клиентам EK_pubs экономит шаг в их процессе. 
- Если вы производите TPMs для использования с вашими собственными устройствами, определить, какой момент в вашем процессе является наиболее удобным для извлечения EK_pub. Вы можете извлечь EK_pub в любой из оставшихся точек временной шкалы. 

#### <a name="step-2-tpm-is-installed-into-a-device"></a>Шаг 2: TPM устанавливается в устройство
На этом этапе производственного процесса вы должны знать, с каким экземпляром DPS будет использоваться устройство. В результате можно добавить устройства в список регистрации для автоматического подготовки. Для получения дополнительной информации об автоматическом устройстве подготовки, см [документация DPS](about-iot-dps.md).
- Если вы еще не извлекли EK_pub, сейчас хорошее время, чтобы сделать это. 
- В зависимости от процесса установки TPM, этот шаг также является хорошим временем, чтобы взять на себя ответственность за TPM. 

#### <a name="step-3-device-has-firmware-and-software-installed"></a>Шаг 3: Устройство имеет прошивку и программное обеспечение установлено
На этом этапе установите клиент DPS вместе с областью ID и глобальным URL-адресом для подготовки.
- Теперь это последний шанс извлечь EK_pub. Если третья сторона установит программное обеспечение на вашем устройстве, это хорошая идея, чтобы извлечь EK_pub в первую очередь.
- Этот момент в производственном процессе идеально подходит для того, чтобы взять на себя ответственность за TPM.  
    > [!NOTE]
    > Если вы используете программное обеспечение TPM, вы можете установить его сейчас.  Извлеките EK_pub в то же время.

#### <a name="step-4-device-is-packaged-and-sent-to-the-warehouse"></a>Шаг 4: Устройство упаковано и отправлено на склад
Устройство может сидеть на складе в течение 6-12 месяцев перед развертыванием. 

#### <a name="step-5-device-is-installed-into-the-location"></a>Шаг 5: Устройство устанавливается в место
После того, как устройство прибывает в свое окончательное место, оно проходит автоматизированную подготовку с DPS.

Для получения дополнительной [информации см.](concepts-auto-provisioning.md) [TPM attestation](concepts-tpm-attestation.md) 

## <a name="resources"></a>Ресурсы

В дополнение к рекомендуемой практике безопасности в этой статье Azure IoT предоставляет ресурсы, помогающие выбрать безопасное оборудование и создать безопасные развертывания IoT: 
- [Рекомендации по безопасности](../iot-fundamentals/security-recommendations.md) Azure IoT для руководства процессом развертывания. 
- [Центр безопасности Azure](https://azure.microsoft.com/services/security-center/) предлагает службу, которая поможет создать безопасные развертывания IoT. 
- Для оценки аппаратной среды можно ознакомиться в документе, [оценивающей безопасность IoT.](https://download.microsoft.com/download/D/3/9/D3948E3C-D5DC-474E-B22F-81BA8ED7A446/Evaluating_Your_IOT_Security_whitepaper_EN_US.pdf) 
- Для получения помощи в [The Right Secure Hardware for your IoT Deployment](https://download.microsoft.com/download/C/0/5/C05276D6-E602-4BB1-98A4-C29C88E57566/The_right_secure_hardware_for_your_IoT_deployment_EN_US.pdf)выборе защищенного оборудования см. 