---
title: Диагностика и устранение неполадок отключается от Azure IoT Hub DPS
description: Научитесь диагностировать и устранить распространенные ошибки при подключении к устройству для службы обеспечения устройств Azure IoT (DPS)
author: xujing-ms
manager: nberdy
ms.service: iot-dps
services: iot-dps
ms.topic: conceptual
ms.date: 09/09/2019
ms.author: xujing
ms.openlocfilehash: 3cbab09c6b50abb590cfe9f2720713a8fa547aa7
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75646478"
---
# <a name="troubleshooting-with-azure-iot-hub-device-provisioning-service"></a>Устранение проблем с помощью службы обеспечения устройств Концентратора Azure IoT

Проблемы с подключением устройств IoT могут быть затруднены из-за того, что существует множество возможных моментов сбоев, таких как сбои в аттестации, сбои в регистрации и т.д. В этой статье содержатся рекомендации по выявлению и устранению неполадок в связи с устройством через [Azure Monitor.](https://docs.microsoft.com/azure/azure-monitor/overview)

## <a name="using-azure-monitor-to-view-metrics-and-set-up-alerts"></a>Использование Azure Monitor для просмотра метрик и настройки оповещений

Следующая процедура описывает, как просматривать и настраивать оповещения на метрике службы обеспечения устройств IoT Hub. 

1. Войдите на [портал Azure](https://portal.azure.com).

2. Просмотрите службу обеспечения устройств IoT Hub.

3. Выберите **метрики**.

4. Выберите нужную метрику. 
   <br />В настоящее время существует три метрики для DPS:

    | Имя метрики | Описание |
    |-------|------------|
    | Попытки аттестации | Количество устройств, которые пытались проверить подлинность с помощью службы обеспечения устройств|
    | Попытки регистрации | Количество устройств, которые пытались зарегистрироваться в IoT Hub после успешной проверки подлинности|
    | Назначенное устройство | Количество устройств, успешно назначенных к центру IoT|

5. Выберите желаемый метод агрегации для создания визуального представления метрики. 

6. Чтобы настроить оповещение метрики, выберите **новые правила оповещения** из верхнего правого лезвия, аналогичным образом вы можете перейти к лезвию **оповещения** и выбрать **новые правила оповещения.**

7. Выберите **Условие Добавления,** затем выберите нужную метрику и порог, следуя запросам.

Чтобы узнать больше, смотрите [Что такое классические оповещения в Microsoft Azure?](../azure-monitor/platform/alerts-overview.md)

## <a name="using-log-analytic-to-view-and-resolve-errors"></a>Использование Log Analytic для просмотра и устранения ошибок

1. Войдите на [портал Azure](https://portal.azure.com).

2. Перейдите в центр Интернета вещей.

3. Выберите **Параметры диагностики**.

4. Выберите **Включить диагностику**.

5. Включите необходимые журналы для сбора.

    | Имя журнала | Описание |
    |-------|------------|
    | DeviceOperations | Логи, связанные с событиями подключения устройства |
    | ServiceOperations | Журналы событий, связанные с использованием сервиса SDK (например, создание или обновление групп регистрации)|

6. Включите **Отправить в журнал Analytics** [(см. цены](https://azure.microsoft.com/pricing/details/log-analytics/)). 

7. Перейдите на вкладку **Журналы** на портале Azure под ресурсом службы обеспечения устройств.

8. Нажмите **Выполнить,** чтобы просмотреть последние события.

9. Если есть результаты, `OperationName` `ResultType`ищите , , `ResultSignature`и `ResultDescription` (сообщение об ошибке), чтобы получить более подробную информацию об ошибке.


## <a name="common-error-codes"></a>Коды распространенных ошибок
Сведения в этой таблице помогут вам понять и устранить распространенные ошибки.

| Код ошибки| Описание | Код состояния HTTP |
|-------|------------|------------|
| 400 | Тело запроса не является действительным; например, его нельзя разогнать, или объект не может быть проверен.| 400 Плохой формат |
| 401 | Токен авторизации не может быть проверен; например, срок действия этого запроса истек или не применяется к URI запроса. Этот код ошибки также возвращается на устройства как часть потока аттестации TPM. | 401 — недостаточно прав|
| 404 | Экземпляр Службы обеспечения устройств или ресурс (например, регистрация) не существует. |404 — не найдено |
| 412 | ETag в запросе не соответствует ETag существующего ресурса, в соответствии с RFC7232. | 412 Неудалось предварительное условие |
| 429 | Операции замедляются службой. Для конкретных ограничений [IoT Hub Device Provisioning Service limits](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#iot-hub-device-provisioning-service-limits)обслуживания см. | 429 Слишком много запросов |
| 500 | Произошла внутренняя ошибка. | 500 — Внутренняя ошибка сервера|
