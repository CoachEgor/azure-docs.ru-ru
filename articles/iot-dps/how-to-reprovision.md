---
title: Повторная подготовка устройств в Службе подготовки устройств к добавлению в Центр Интернета вещей Azure | Документация Майкрософт
description: Повторная подготовка устройств с помощью экземпляра службы подготовки устройств.
author: wesmc7777
ms.author: v-yiso
origin.date: 04/04/2019
ms.date: 05/06/2019
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: 92680a453d93c8dc0189c6ae376449a8e7a22076
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60627354"
---
# <a name="how-to-reprovision-devices"></a>Повторная подготовка устройств

Во время жизненного цикла решения Интернета вещей часто приходится перемещать устройства между Центрами Интернета вещей. Причинами этого перемещения могут быть следующие сценарии.

* **Географическое расположение**: Устройство после перемещения между расположениями задержки в сети повышается благодаря наличию устройства перенесены в центр Интернета вещей ближе к расположениям.

* **Мультитенантность**: Устройство может использовать в одном решении Интернета вещей, но, Переназначено или в аренду на нового клиента, или на сайте клиента. Обслуживание этого нового клиента может выполняться с помощью другого Центра Интернета вещей.

* **Изменение решения**: Устройство может быть перемещена в новое или обновленное решение Интернета вещей. Для этого переопределения устройству может потребоваться взаимодействовать с новым Центром Интернета вещей, подключенным к другим компонентам серверной части. 

* **Карантин**: Аналогичным образом решение изменения. Неисправное, скомпрометированное или устаревшее устройство может быть переназначено Центру Интернета вещей, где оно может пройти обновление и вернуться в состояние соответствия требованиям. Когда устройство будет работать надлежащим образом, оно переносится в свой основной центр.

Более с более подробным обзором повторной подготовки, см. в разделе [устройства Интернета вещей, повторная Подготовка понятия](concepts-device-reprovision.md).


## <a name="configure-the-enrollment-allocation-policy"></a>Настройка политики распределения регистрации

Политика распределения определяет, как устройства, связанные с регистрацией, будут распределены или назначены Центру Интернета вещей после повторной подготовки.

Ниже приведены инструкции по настройке политики распределения для регистрации устройства.

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему экземпляру службы подготовки устройств.

2. Щелкните **Управление регистрациями** и выберите группу регистраций или индивидуальную регистрацию, которую нужно настроить для повторной подготовки. 

3. В разделе **Выберите способ назначения устройств для Центров** выберите одну из следующих политик распределения:

    * **Наименьшая задержка**. Эта политика назначает устройства связанный центр Интернета вещей, которая становится причиной минимальной задержки связи между устройством и центром Интернета вещей. Этот параметр позволяет устройству осуществлять обмен данными с ближайшим Центром Интернета вещей на основе расположения. 
    
    * **Равномерно Взвешенное распределение**: Эта политика распределяет устройства между связанные центры Интернета вещей, на основе распределения веса, назначенных каждой связанный центр Интернета вещей. Эта политика позволяет распределять нагрузку устройств в группе связанных центров на основе весовых коэффициентов выделения, настроенных для этих центров. Этот параметр рекомендуется при подготовке устройств только в одном Центре Интернета вещей. Это значение по умолчанию. 
    
    * **Статическая конфигурация**: Эта политика требует, перечислены в записи регистрации для устройства должны быть подготовлены нужного центра Интернета вещей. Эта политика позволяет вам указать один конкретный Центр Интернета вещей, которому вы хотите назначить устройства.

4. В разделе **Select the IoT hubs this group can be assigned to** (Выберите Центры Интернета вещей, которым может быть назначена эта группа) выберите связанные Центры Интернета вещей, которые вы хотите включить в политику распределения. При необходимости добавьте новый связанный Центр Интернета вещей, нажав кнопку **Link a new IoT Hub** (Привязать новый Центр Интернета вещей).

    При политике распределения **Наименьшая задержка** выбранные центры будут включены в оценку задержки, чтобы определить ближайший центр для назначения устройства.

    При использовании политики **Равномерно взвешенное распределение** устройства будут распределять нагрузку по выбранным центрам на основе их настроенных весовых коэффициентов выделения и их текущей нагрузки устройств.

    Для политики **статической конфигурации** нужно выбрать Центр Интернета вещей, которому необходимо назначить устройства.

4. Щелкните **Сохранить** или перейдите к следующему разделу, чтобы установить политику повторной подготовки.

    ![Выбор политики распределения регистрации](./media/how-to-reprovision/enrollment-allocation-policy.png)



## <a name="set-the-reprovisioning-policy"></a>Установка политики повторной подготовки

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему экземпляру службы подготовки устройств.

2. Щелкните **Управление регистрациями** и выберите группу регистраций или индивидуальную регистрацию, которую нужно настроить для повторной подготовки.

3. В разделе **Select how you want device data to be handled on re-provision to a different IoT hub** (Выберите способ обработки данных устройства при повторной подготовке в другом Центре Интернета вещей) выберите одну из следующих политик повторной подготовки:

    * **Повторную подготовку и перенос данных**: Эта политика выполняет действие, когда связанные с записью регистрации устройства отправляет новый запрос на инициализацию. В зависимости от конфигурации записи регистрации устройство может быть переназначено другому Центру Интернета вещей. При смене Центров Интернета вещей происходит удаление регистрации устройства в начальном Центре Интернета вещей. Все сведения о состоянии устройства из этого начального Центра Интернета вещей будут перенесены в новый Центр Интернета вещей. Во время переноса устройство находится в состоянии **Идет назначение**.

    * **Повторно подготовить и установить для начальной конфигурации**: Эта политика выполняет действие, когда связанные с записью регистрации устройства отправляет новый запрос на инициализацию. В зависимости от конфигурации записи регистрации устройство может быть переназначено другому Центру Интернета вещей. При смене Центров Интернета вещей происходит удаление регистрации устройства в начальном Центре Интернета вещей. Данные начальной конфигурации, полученные экземпляром службы подготовки во время подготовки устройства, предоставляются в новый Центр Интернета вещей. Во время переноса устройство находится в состоянии **Идет назначение**.

4. Щелкните **Сохранить**, чтобы включить повторную подготовку устройства на основе изменений.

    ![Выбор политики распределения регистрации](./media/how-to-reprovision/reprovisioning-policy.png)



## <a name="send-a-provisioning-request-from-the-device"></a>Отправка запроса на подготовку с устройства

Чтобы устройства были повторно подготовлены на основе изменений конфигурации, выполненных в предыдущих разделах, эти устройства должны запросить повторную подготовку. 

Частота отправки устройством запроса на подготовку зависит от сценария. Тем не менее рекомендуется запрограммировать устройства на отправку запроса подготовки в экземпляр службы подготовки устройств при перезагрузке и поддерживать [метод](../iot-hub/iot-hub-devguide-direct-methods.md) запуска подготовки вручную по требованию. Подготовка также может быть вызвана установкой [требуемого свойства](../iot-hub/iot-hub-devguide-device-twins.md#desired-property-example). 

Политика повторной подготовки в записи регистрации определяет способ обработки этих запросов экземпляром службы подготовки устройств и выясняет необходимость переноса данных о состоянии устройства во время повторной подготовки. К отдельным регистрациям и группам регистраций применяются одни и те же политики.

Например, код отправки запросов на подготовку с устройства во время последовательности загрузки см. в статье об [автоматической подготовке имитированного устройства](quick-create-simulated-device.md).


## <a name="next-steps"></a>Дальнейшие действия

- Чтобы узнать дополнительные Reprovisioning, см. в разделе [инициализацию понятия устройства Интернета вещей](concepts-device-reprovision.md) 
- Чтобы узнать дополнительные отзыва, см. в разделе [как отменить подготовку устройств, которые были автоматически подготовлены](how-to-unprovision-devices.md) 











