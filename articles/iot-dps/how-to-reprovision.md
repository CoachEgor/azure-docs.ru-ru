---
title: Повторная подготовка устройств в службе подготовки устройств для центра Интернета вещей Azure
description: Узнайте, как повторно подготовить устройства с помощью экземпляра службы подготовки устройств и зачем это нужно.
author: wesmc7777
ms.author: wesmc
ms.date: 04/04/2019
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
ms.openlocfilehash: f28dc20a107e9dfdbf252ea614ed4007eafddcd4
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2019
ms.locfileid: "74229707"
---
# <a name="how-to-reprovision-devices"></a>Повторная подготовка устройств

Во время жизненного цикла решения Интернета вещей часто приходится перемещать устройства между Центрами Интернета вещей. Причинами этого перемещения могут быть следующие сценарии.

* **Географическое положение**: при перемещении устройства между расположениями сетевая задержка снижается за счет переноса устройства в Центр Интернета вещей ближе к каждому расположению.

* **Мультитенантность**: устройство может использоваться в одном решении Интернета вещей, но переназначаться или предоставляться в аренду новому клиенту или расположению клиента. Обслуживание этого нового клиента может выполняться с помощью другого Центра Интернета вещей.

* **Смена решения**: устройство может быть перемещено в новое или обновленное решение Интернета вещей. Для этого переопределения устройству может потребоваться взаимодействовать с новым Центром Интернета вещей, подключенным к другим компонентам серверной части. 

* **Карантин**: аналогичен смене решения. Неисправное, скомпрометированное или устаревшее устройство может быть переназначено Центру Интернета вещей, где оно может пройти обновление и вернуться в состояние соответствия требованиям. Когда устройство будет работать надлежащим образом, оно переносится в свой основной центр.

Более подробные сведения о повторной подготовке см. в статье [Основные понятия повторной инициализации устройств в центре Интернета вещей](concepts-device-reprovision.md).


## <a name="configure-the-enrollment-allocation-policy"></a>Настройка политики распределения регистрации

Политика распределения определяет, как устройства, связанные с регистрацией, будут распределены или назначены Центру Интернета вещей после повторной подготовки.

Ниже приведены инструкции по настройке политики распределения для регистрации устройства.

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему экземпляру службы подготовки устройств.

2. Щелкните **Управление регистрациями** и выберите группу регистраций или индивидуальную регистрацию, которую нужно настроить для повторной подготовки. 

3. В разделе **Выберите способ назначения устройств для Центров** выберите одну из следующих политик распределения:

    * **Наименьшая задержка**. Эта политика назначает устройства связанным Центрам Интернета вещей так, чтобы задержка при обмене данными между устройствами и Центрами Интернета вещей была наименьшей. Этот параметр позволяет устройству осуществлять обмен данными с ближайшим Центром Интернета вещей на основе расположения. 
    
    * **Равномерно взвешенное распределение**. Эта политика распределяет устройства между связанными Центрами Интернета вещей на основе весового коэффициента выделения, присвоенного каждому такому центру. Эта политика позволяет распределять нагрузку устройств в группе связанных центров на основе весовых коэффициентов выделения, настроенных для этих центров. Этот параметр рекомендуется при подготовке устройств только в одном Центре Интернета вещей. Это значение по умолчанию. 
    
    * **Static configuration** (Статическая конфигурация). Для использования этой политики необходимый Центр Интернета вещей должен быть указан в записи регистрации для подготавливаемого устройства. Эта политика позволяет вам указать один конкретный Центр Интернета вещей, которому вы хотите назначить устройства.

4. В разделе **Select the IoT hubs this group can be assigned to** (Выберите Центры Интернета вещей, которым может быть назначена эта группа) выберите связанные Центры Интернета вещей, которые вы хотите включить в политику распределения. При необходимости добавьте новый связанный Центр Интернета вещей, нажав кнопку **Link a new IoT Hub** (Привязать новый Центр Интернета вещей).

    При политике распределения **Наименьшая задержка** выбранные центры будут включены в оценку задержки, чтобы определить ближайший центр для назначения устройства.

    При использовании политики **Равномерно взвешенное распределение** устройства будут распределять нагрузку по выбранным центрам на основе их настроенных весовых коэффициентов выделения и их текущей нагрузки устройств.

    Для политики **статической конфигурации** нужно выбрать Центр Интернета вещей, которому необходимо назначить устройства.

4. Щелкните **Сохранить** или перейдите к следующему разделу, чтобы установить политику повторной подготовки.

    ![Выбор политики распределения регистрации](./media/how-to-reprovision/enrollment-allocation-policy.png)



## <a name="set-the-reprovisioning-policy"></a>Установка политики повторной подготовки

1. Войдите на [портал Azure](https://portal.azure.com) и перейдите к своему экземпляру службы подготовки устройств.

2. Щелкните **Управление регистрациями** и выберите группу регистраций или индивидуальную регистрацию, которую нужно настроить для повторной подготовки.

3. В разделе **Select how you want device data to be handled on re-provision to a different IoT hub** (Выберите способ обработки данных устройства при повторной подготовке в другом Центре Интернета вещей) выберите одну из следующих политик повторной подготовки:

    * **Re-provision and migrate data** (Повторная подготовка и перенос данных). Эта политика начинает действовать, когда устройства, связанные с записью регистрации, отправляют новый запрос на подготовку. В зависимости от конфигурации записи регистрации устройство может быть переназначено другому Центру Интернета вещей. При смене Центров Интернета вещей происходит удаление регистрации устройства в начальном Центре Интернета вещей. Все сведения о состоянии устройства из этого начального Центра Интернета вещей будут перенесены в новый Центр Интернета вещей. Во время переноса устройство находится в состоянии **Идет назначение**.

    * **Re-provision and reset to initial config** (Повторная подготовка и сброс до начальной конфигурации). Эта политика начинает действовать, когда устройства, связанные с записью регистрации, отправляют новый запрос на подготовку. В зависимости от конфигурации записи регистрации устройство может быть переназначено другому Центру Интернета вещей. При смене Центров Интернета вещей происходит удаление регистрации устройства в начальном Центре Интернета вещей. Данные начальной конфигурации, полученные экземпляром службы подготовки во время подготовки устройства, предоставляются в новый Центр Интернета вещей. Во время переноса устройство находится в состоянии **Идет назначение**.

4. Щелкните **Сохранить**, чтобы включить повторную подготовку устройства на основе изменений.

    ![Выбор политики распределения регистрации](./media/how-to-reprovision/reprovisioning-policy.png)



## <a name="send-a-provisioning-request-from-the-device"></a>Отправка запроса на подготовку с устройства

Чтобы устройства были повторно подготовлены на основе изменений конфигурации, выполненных в предыдущих разделах, эти устройства должны запросить повторную подготовку. 

Частота отправки устройством запроса на подготовку зависит от сценария. Тем не менее рекомендуется запрограммировать устройства на отправку запроса подготовки в экземпляр службы подготовки устройств при перезагрузке и поддерживать [метод](../iot-hub/iot-hub-devguide-direct-methods.md) запуска подготовки вручную по требованию. Подготовка также может быть вызвана установкой [требуемого свойства](../iot-hub/iot-hub-devguide-device-twins.md#desired-property-example). 

Политика повторной подготовки в записи регистрации определяет способ обработки этих запросов экземпляром службы подготовки устройств и выясняет необходимость переноса данных о состоянии устройства во время повторной подготовки. К отдельным регистрациям и группам регистраций применяются одни и те же политики.

Например, код отправки запросов на подготовку с устройства во время последовательности загрузки см. в статье об [автоматической подготовке имитированного устройства](quick-create-simulated-device.md).


## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о повторной подготовке см. в статье [Основные понятия повторной инициализации устройств центра Интернета вещей](concepts-device-reprovision.md) . 
- Дополнительные сведения об отмене подготовки см. в статье [как отменить подготовку устройств, которые были подготовлены ранее](how-to-unprovision-devices.md) . 











