---
title: Устранение неполадок с Кэшем Azure для Redis на стороне сервера
description: Узнайте, как решить общие проблемы на стороне сервера с azure Cache для Redis, такие как давление памяти, высокий процессор, длительные команды или ограничения пропускной способности.
author: yegu-ms
ms.author: yegu
ms.service: cache
ms.topic: conceptual
ms.date: 10/18/2019
ms.openlocfilehash: a68c27de304a0da6470745ee4abf69590d9bf78c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79277938"
---
# <a name="troubleshoot-azure-cache-for-redis-server-side-issues"></a>Устранение неполадок с Кэшем Azure для Redis на стороне сервера

В этом разделе рассматриваются проблемы устранения неполадок, возникающие из-за состояния кэша Azure для Redis или виртуальной машины (ы) хостинга.

- [Нехватка памяти на сервере Redis](#memory-pressure-on-redis-server)
- [Высокое использование процессора или загрузка сервера](#high-cpu-usage-or-server-load)
- [Долго выполняющиеся команды](#long-running-commands)
- [Ограничение пропускной способности на стороне сервера](#server-side-bandwidth-limitation)

> [!NOTE]
> Шаги по устранению проблем в этой статье также включают в себя указания по выполнению команд Redis и мониторингу различных метрик производительности. Дополнительные сведения и указания см. в разделе [Дополнительные сведения](#additional-information).
>

## <a name="memory-pressure-on-redis-server"></a>Нехватка памяти на сервере Redis

Нехватка памяти на сервере кэширования служит причиной всевозможных проблем с производительностью, которые вызывают задержку обработки запросов. При попадании давления памяти система может переходить к диску. Именно _ошибки страниц_ существенно замедляют работу системы. Нехватка памяти может возникнуть по следующим причинам.

- Кэш заполняется данными, приближаемыми к максимальной емкости.
- Редис наблюдает высокую фрагментацию памяти. Эта фрагментация чаще всего вызвана хранением крупных объектов, так как Redis оптимизирован для небольших объектов.

Redis предоставляет две статистики через команду [INFO,](https://redis.io/commands/info) которые могут помочь вам определить эту проблему: "used_memory" и "used_memory_rss". Вы можете [просмотреть эти метрики](cache-how-to-monitor.md#view-metrics-with-azure-monitor) с помощью портала.

Есть несколько возможных изменений, которые вы можете внести, чтобы помочь сохранить использование памяти здоровым:

- [Настройте политику памяти](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) и параметры времени завершения срока действия ключей. Эта политика может быть недостаточной, если у вас есть фрагментация.
- [Настройте значение maxmemory-reserved](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) , которого будет достаточно, чтобы компенсировать фрагментацию памяти.
- Разбейте большие кэшированные объекты на меньшие связанные объекты.
- [Создавайте оповещения](cache-how-to-monitor.md#alerts) о таких метриках, как использованная память, чтобы получать уведомления заранее о потенциальных последствиях.
- [Масштабируйте](cache-how-to-scale.md) до большего размера кэша с большей емкостью памяти.

## <a name="high-cpu-usage-or-server-load"></a>Высокое использование процессора или загрузка сервера

Высокая загрузка сервера или использование процессора означает, что сервер не может обрабатывать запросы своевременно. Сервер может быть медленным, чтобы ответить и не в состоянии идти в ногу с запросом ставки.

[Мониторинг метрик,](cache-how-to-monitor.md#view-metrics-with-azure-monitor) таких как нагрузка на процессор или сервер. Понаблюдайте за пиками загрузки ЦП, которые соответствуют времени ожидания.

Существует несколько изменений, которые можно внести для уменьшения высокой нагрузки на сервер:

- Исследуйте, что вызывает пики процессора, такие как [долгосрочные команды, отмеченные](#long-running-commands) ниже, или ошибка страницы из-за высокого давления памяти.
- [Создавайте оповещения](cache-how-to-monitor.md#alerts) о таких метриках, как процессор или загрузка сервера, чтобы получать уведомления заранее о потенциальных последствиях.
- [Масштабируйте](cache-how-to-scale.md) до большего размера кэша с большей емкостью процессора.

## <a name="long-running-commands"></a>Долго выполняющиеся команды

Некоторые команды Redis являются более дорогостоящими в выполнении, чем другие. [Документация команд Redis](https://redis.io/commands) показывает сложность времени каждой команды. Поскольку обработка команд Redis является однопоточной, команда, для запуска которого требуется время, блокирует все остальные, которые приходят после нее. Необходимо просмотреть команды, которые вы выдаете серверу Redis, чтобы понять их влияние на производительность. Например, команда [KEYS](https://redis.io/commands/keys) часто используется, не зная, что это операция O(N). Вы можете избежать KEYS, используя [SCAN](https://redis.io/commands/scan) для уменьшения шипов процессора.

Используя команду [SLOWLOG,](https://redis.io/commands/slowlog) можно измерить дорогостоящие команды, выполняемые на сервере.

## <a name="server-side-bandwidth-limitation"></a>Ограничение пропускной способности на стороне сервера

Различные размеры кэша имеют различную пропускную способность сети. Если сервер превышает доступную пропускную способность, данные не будут отправлены клиенту так быстро. Запросы клиентов могут отойти, потому что сервер не может доставить данные к клиенту достаточно быстро.

Метрики "Кэш Читать" и "Кэш запись" могут быть использованы, чтобы увидеть, сколько сервера стороне пропускной способности используется. Вы можете [просмотреть эти метрики](cache-how-to-monitor.md#view-metrics-with-azure-monitor) на портале.

Для смягчения ситуаций, когда использование пропускной способности сети близко к максимальной емкости:

- Изменение поведения вызова клиента для снижения спроса на сеть.
- [Создавайте оповещения](cache-how-to-monitor.md#alerts) по таким показателям, как чтение кэша или запись кэша, чтобы получать уведомления заранее о возможных последствиях.
- [Масштабирование](cache-how-to-scale.md) до большего размера кэша с большей пропускной способностью сети.

## <a name="additional-information"></a>Дополнительные сведения

- [Устранение неполадок с Кэшем Azure для Redis на стороне клиента](cache-troubleshoot-client.md)
- [Какое предложение и размер кэша Azure для Redis мне следует использовать?](cache-faq.md#what-azure-cache-for-redis-offering-and-size-should-i-use)
- [Как измерить и протестировать производительность моего кэша?](cache-faq.md#how-can-i-benchmark-and-test-the-performance-of-my-cache)
- [Как отслеживать кэш Redis для Azure?](cache-how-to-monitor.md)
- [Как выполнять команды Redis?](cache-faq.md#how-can-i-run-redis-commands)
