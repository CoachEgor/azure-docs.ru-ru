---
title: Как настроить георепликацию для Кэша Azure для Redis Документы Майкрософт
description: Узнайте, как реплицировать экземпляры кэша Redis для Azure между географическими регионами.
author: yegu-ms
ms.service: cache
ms.topic: conceptual
ms.date: 03/06/2019
ms.author: yegu
ms.openlocfilehash: ce50c665fa79c361f638fda4ec373d5215c407f8
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "74129429"
---
# <a name="how-to-set-up-geo-replication-for-azure-cache-for-redis"></a>Как настроить георепликацию для Кэша Azure для Redis

Георепликация предоставляет механизм связывания двух экземпляров кэша Redis для Azure категории "Премиум". Один кэш выбирается в качестве основного связанного кэша, а другой — в качестве вторичного связанного кэша. Дополнительный связанный кэш становится доступным только для чтения, и в него реплицируются данные, записанные в основной кэш. Эту функцию можно использовать для репликации кэша в разные регионы Azure. В этой статье содержится руководство по настройке георепликации для кэша Azure Уровня Premium для экземпляров Redis.

## <a name="geo-replication-prerequisites"></a>Предварительные требования георепликации

Для настройки георепликации между двумя кэшами необходимо выйти на следующие предпосылки:

- Оба кэша являются кэшами [премиум-уровня.](cache-premium-tier-intro.md)
- Оба кэша находятся в одной подписке Azure.
- Вторичный связанный кэш — это либо тот же размер кэша, либо больший размер кэша, чем основной связанный кэш.
- Оба кэша создаются и находятся в запущенном состоянии.

Некоторые функции не поддерживаются георепликацией:

- Настойчивость не поддерживается георепликацией.
- Кластеризация поддерживается, если оба кэширования включены и имеют одинаковое количество осколков.
- Кэши в том же VNET поддерживаются.
- Кэши в различных ВНЕТ поддерживаются оговорками. [См.](#can-i-use-geo-replication-with-my-caches-in-a-vnet)

После настройки георепликации следующие ограничения применяются к паре связанных кэшов:

- Дополнительный связанный кэш доступен только для чтения, то есть из него можно считывать данные, но нельзя записать данные в него. 
- Любые данные, которые были в дополнительном связанном кэше до добавления связи, удаляются. Однако если георепликация позже удалена, реплицированные данные остаются во вторичном подключенном кэше.
- Вы не можете [масштабировать](cache-how-to-scale.md) ни кэш, пока кэши связаны.
- Нельзя [изменять количество осколков,](cache-how-to-premium-clustering.md) если кэш включен кластеризации.
- Ни на одном из кэше не удастся включить сохраняемость.
- Вы можете [экспортировать](cache-how-to-import-export-data.md#export) из любого кэша.
- Вы не можете [импортировать](cache-how-to-import-export-data.md#import) во вторичном подключенном кэше.
- Нельзя удалять либо связанный кэш, либо группу ресурсов, содержащую их, до тех пор, пока вы не отключите кэш. Дополнительные сведения см. в разделе [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- Если кэши находятся в разных регионах, затраты на выход сети применяются к данным, перемещаемым по регионам. Дополнительные сведения см. в разделе [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- Автоматическое сбой не происходит между первичным и вторичным связанным кэшем. Для получения дополнительной информации и информации о [How does failing over to the secondary linked cache work?](#how-does-failing-over-to-the-secondary-linked-cache-work) том, как выполнить работу клиентского приложения, см.

## <a name="add-a-geo-replication-link"></a>Добавление ссылки на георепликацию

1. Чтобы связать два кэша для георепликации, кулак щелкните **Георепликацию** из меню ресурса кэша, который вы собираетесь стать основным связанным кэшем. Далее щелкните **Ссылку репликации кэша** из лезвия **георепликации.**

    ![Добавление связи](./media/cache-how-to-geo-replication/cache-geo-location-menu.png)

2. Нажмите на имя предполагаемого вторичного кэша из списка **совместимых кэшей.** Если вторичный кэш не отображается в списке, убедитесь, что [предпосылок георепликации](#geo-replication-prerequisites) для вторичного кэша выполнены. Чтобы отфильтровать кэши по регионам, щелкните область на карте, чтобы отобразить только те кэши в списке **совместимых кэшей.**

    ![Кэши, совместимые с георепликацией](./media/cache-how-to-geo-replication/cache-geo-location-select-link.png)
    
    Вы также можете начать процесс соединения или просмотреть сведения о вторичном кэше с помощью контекстного меню.

    ![Контекстное меню георепликации](./media/cache-how-to-geo-replication/cache-geo-location-select-link-context-menu.png)

3. Чтобы связывать два кэша друг с другом и начать процесс репликации, нажмите кнопку **Связь**.

    ![Связывание кэшей](./media/cache-how-to-geo-replication/cache-geo-location-confirm-link.png)

4. Ход выполнения процесса репликации можно просмотреть в колонке **Георепликация**.

    ![Состояние связывания](./media/cache-how-to-geo-replication/cache-geo-location-linking.png)

    Состояние связывания также можно просмотреть в колонке **Обзор** как для основного кэша, так и для дополнительного.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-status.png)

    По завершении процесса репликации **Состояние связи** изменится на **Успешно**.

    ![Состояние кэша](./media/cache-how-to-geo-replication/cache-geo-location-link-successful.png)

    Основной связанный кэш остается доступным для использования в процессе соединения. Вторичный связанный кэш недоступен до завершения процесса соединения.

## <a name="remove-a-geo-replication-link"></a>Удалить ссылку на георепликацию

1. Чтобы удалить связь между двумя кэшами и остановить георепликацию, щелкните **кэши Unlink** из лезвия **geo-replication.**
    
    ![Удаление связи кэшей](./media/cache-how-to-geo-replication/cache-geo-location-unlink.png)

    По завершения процесса удаления связи дополнительный кэш станет доступным как для чтения, так и для записи.

>[!NOTE]
>При удалении ссылки георепликации реплицированные данные из первичного связанного кэша остаются во вторичном кэше.
>
>

## <a name="geo-replication-faq"></a>Часто задаваемые вопросы по георепликации

- [Могу ли я использовать георепликацию с кэшем стандартного или базового уровня?](#can-i-use-geo-replication-with-a-standard-or-basic-tier-cache)
- [Можно ли использовать кэш во время связывания или удаления связи?](#is-my-cache-available-for-use-during-the-linking-or-unlinking-process)
- [Можно ли связать больше двух кэшей?](#can-i-link-more-than-two-caches-together)
- [Можно ли связать два кэша из разных подписок Azure?](#can-i-link-two-caches-from-different-azure-subscriptions)
- [Можно ли связать два кэша с разными размерами?](#can-i-link-two-caches-with-different-sizes)
- [Могу ли я использовать георепликацию с включенным кластеризом?](#can-i-use-geo-replication-with-clustering-enabled)
- [Могу ли я использовать георепликацию с кэшами в VNET?](#can-i-use-geo-replication-with-my-caches-in-a-vnet)
- [Что такое расписание репликации для георепликации Redis?](#what-is-the-replication-schedule-for-redis-geo-replication)
- [Сколько времени занимает георепликация?](#how-long-does-geo-replication-replication-take)
- [Гарантируется ли точка восстановления репликации?](#is-the-replication-recovery-point-guaranteed)
- [Могу ли я использовать PowerShell или Azure CLI для управления георепликацией?](#can-i-use-powershell-or-azure-cli-to-manage-geo-replication)
- [Сколько стоит реплицировать мои данные между регионами Azure?](#how-much-does-it-cost-to-replicate-my-data-across-azure-regions)
- [Почему произошел сбой операции, когда я попытался удалить связанный кэш?](#why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache)
- [Какой регион лучше использовать для дополнительного связанного кэша?](#what-region-should-i-use-for-my-secondary-linked-cache)
- [Как выполнить отработку отказа в дополнительный связанный кэш?](#how-does-failing-over-to-the-secondary-linked-cache-work)

### <a name="can-i-use-geo-replication-with-a-standard-or-basic-tier-cache"></a>Могу ли я использовать георепликацию с кэшем стандартного или базового уровня?

Нет, георепликация доступна только для кэшов уровня Premium.

### <a name="is-my-cache-available-for-use-during-the-linking-or-unlinking-process"></a>Можно ли использовать кэш во время связывания или удаления связи?

- При подключении основной связанный кэш остается доступным, пока завершается процесс соединения.
- При подключении вторичный связанный кэш недоступен до завершения процесса соединения.
- При развязывания оба кэша остаются доступными, пока процесс развязывания завершается.

### <a name="can-i-link-more-than-two-caches-together"></a>Можно ли связать больше двух кэшей?

Нет, вы можете связать только два тайника вместе.

### <a name="can-i-link-two-caches-from-different-azure-subscriptions"></a>Можно ли связать два кэша из разных подписок Azure?

Нет. Оба кэша должны относиться к одной подписке Azure.

### <a name="can-i-link-two-caches-with-different-sizes"></a>Можно ли связать два кэша с разными размерами?

Да, если размер дополнительного связанного кэша больше размера основного связанного кэша.

### <a name="can-i-use-geo-replication-with-clustering-enabled"></a>Могу ли я использовать георепликацию с включенным кластеризом?

Да, если оба кэша имеют одинаковое число сегментов.

### <a name="can-i-use-geo-replication-with-my-caches-in-a-vnet"></a>Могу ли я использовать георепликацию с кэшами в VNET?

Да, георепликация тайников в ВНЕС поддерживается оговорками:

- Георепликация между кэшами в одной виртуальной сети поддерживается.
- Поддерживается также георепликация между кэшами в различных ВНЕТ.
  - Если VNET находятся в одном регионе, вы можете подключить их с помощью [внимательных vNET](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) или [VPN Gateway VNET-to-VNET.](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways#V2V)
  - Если VNET находятся в разных регионах, георепликация с помощью пиринга VNET не поддерживается из-за ограничения балансироворов основных внутренних нагрузок. Для получения дополнительной информации о ограничениях вобласти в систему VNET [см.](https://docs.microsoft.com/azure/virtual-network/virtual-network-manage-peering#requirements-and-constraints) Рекомендуемое решение заключается в использовании VPN Gateway VNET-к-VNET соединение.

Используя [этот шаблон Azure,](https://azure.microsoft.com/resources/templates/201-redis-vnet-geo-replication/)вы можете быстро развернуть два геореплицитированных кэша в VNET, подключенный к VPN Gateway VNET-to-VNET.

### <a name="what-is-the-replication-schedule-for-redis-geo-replication"></a>Что такое расписание репликации для георепликации Redis?

Репликация непрерывна и асинхронна и не происходит по определенному графику. Все записи, сделанные на первичном мгновенно и асинхронно реплицируются на вторичном.

### <a name="how-long-does-geo-replication-replication-take"></a>Сколько времени занимает георепликация?

Репликация является инкрементной, асинхронной и непрерывной, и время, затраченное не сильно отличается от задержки в разных регионах. При определенных обстоятельствах вторичный кэш может потребоваться для полной синхронизации данных с первичного. Время репликации в этом случае зависит от ряда факторов, таких как: нагрузка на основной кэш, доступная пропускная способность сети и межрегиональная задержка. Мы обнаружили, что время репликации для полной 53-GB гео-реплицируемой пары может быть где угодно между 5 до 10 минут.

### <a name="is-the-replication-recovery-point-guaranteed"></a>Гарантируется ли точка восстановления репликации?

Для кэша в гео-реплицируемом режиме сохранение отключено. Если геореплицированная пара не связана между собой, например, сбой, инициированный клиентом, вторичный связанный кэш сохраняет свои синхронизированные данные до этого момента. В таких ситуациях точка восстановления не гарантируется.

Чтобы получить точку восстановления, [Экспорт](cache-how-to-import-export-data.md#export) из любого кэша. Позже можно [импортировать](cache-how-to-import-export-data.md#import) в основной кэш.

### <a name="can-i-use-powershell-or-azure-cli-to-manage-geo-replication"></a>Могу ли я использовать PowerShell или Azure CLI для управления георепликацией?

Да, георепликация может управляться с помощью портала Azure, PowerShell или Azure CLI. Для получения дополнительной [PowerShell docs](https://docs.microsoft.com/powershell/module/az.rediscache/?view=azps-1.4.0#redis_cache) информации см. [Azure CLI docs](https://docs.microsoft.com/cli/azure/redis/server-link?view=azure-cli-latest)

### <a name="how-much-does-it-cost-to-replicate-my-data-across-azure-regions"></a>Сколько стоит реплицировать мои данные между регионами Azure?

При использовании георепликации данные из первичного связанного кэша реплицируются в вторичный связанный кэш. Передача данных не взимается, если два связанных кэша находятся в одном регионе. Если два связанных кэша находятся в разных регионах, плата за передачу данных — это стоимость сети, передаваемых в обоих регионах. Для получения дополнительной [информации, см.](https://azure.microsoft.com/pricing/details/bandwidth/)

### <a name="why-did-the-operation-fail-when-i-tried-to-delete-my-linked-cache"></a>Почему произошел сбой операции, когда я попытался удалить связанный кэш?

Гео-реплицированные кэши и их группы ресурсов не могут быть удалены при подключении до тех пор, пока не будет удалена ссылка на георепликацию. При попытке удалить группу ресурсов, в которую входит один из них или оба связанных кэша, остальные ресурсы в группе ресурсов удаляются, но группа ресурсов остается в состоянии `deleting`, а все связанные кэши в группе ресурсов остаются в состоянии `running`. Чтобы полностью удалить группу ресурсов и связанные кэши внутри нее, отключите кэши, как описано в [ссылке Удалить георепликацию.](#remove-a-geo-replication-link)

### <a name="what-region-should-i-use-for-my-secondary-linked-cache"></a>Какой регион лучше использовать для дополнительного связанного кэша?

Как правило, кэш может существовать в том же регионе Azure, что и приложение, которое получает к нему доступ. Для приложений с отдельными первичными и резервными регионами рекомендуется, чтобы ваши первичные и вторичные кэши существовали в тех же регионах. Дополнительные сведения о парах регионов см. в статье [Непрерывность бизнес-процессов и аварийное восстановление в службах BizTalk: пары регионов Azure](../best-practices-availability-paired-regions.md).

### <a name="how-does-failing-over-to-the-secondary-linked-cache-work"></a>Как выполнить отработку отказа в дополнительный связанный кэш?

Автоматическое сбой в регионах Azure не поддерживается для геореплицированных кэшов. В сценарии аварийного восстановления клиенты должны скоординированно восставать весь стек приложений в области резервного копирования. Разрешение отдельным компонентам приложения самостоятельно решать, когда переключаться на резервные приложения, может негативно сказаться на производительности. Одним из ключевых преимуществ Redis является то, что это магазин с очень низкой задержкой. Если основное приложение клиента находится в другом регионе, чем его кэш, добавленное время в оба конца будет иметь заметное влияние на производительность. По этой причине мы избегаем автоматического сбоя из-за проблем с переходной доступностью.

Чтобы запустить сбой, инициированный клиентом, сначала отключите кэш. Затем измените клиент Redis, чтобы использовать конечную точку соединения (ранее связанного) вторичного кэша. Когда два кэша не связаны между собой, вторичный кэш снова становится обычным кэшем для записи чтения и принимает запросы непосредственно от клиентов Redis.

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с дополнительными сведениями о [кэше Redis для Azure категории "Премиум"](cache-premium-tier-intro.md).
