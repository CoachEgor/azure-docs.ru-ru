---
title: Удалите TLS 1.0 и 1.1 из использования с Azure Кэш для Redis
description: Узнайте, как удалить TLS 1.0 и 1.1 из приложения при общении с Azure Cache для Redis
author: yegu-ms
ms.service: cache
ms.topic: conceptual
ms.date: 10/22/2019
ms.author: yegu
ms.openlocfilehash: 809fbe85a9783777d5dbef86357bd5a386bd6f81
ms.sourcegitcommit: 8dc84e8b04390f39a3c11e9b0eaf3264861fcafc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2020
ms.locfileid: "81261250"
---
# <a name="remove-tls-10-and-11-from-use-with-azure-cache-for-redis"></a>Удалите TLS 1.0 и 1.1 из использования с Azure Кэш для Redis

Существует отраслевой толчок к исключительному использованию версии 1.2 по безопасности транспортного уровня (TLS) или позже. TLS версии 1.0 и 1.1, как известно, подвержены атакам, таким как BEAST и POODLE, и имеют другие общие уязвимости и воздействия (CVE) недостатки. Они также не поддерживают современные методы шифрования и наборы шифров, рекомендованные стандартами соответствия платежной индустрии (PCI). Этот [блог безопасности TLS](https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/) объясняет некоторые из этих уязвимостей более подробно.

В рамках этих усилий мы внедрем в Azure Кэш для Redis следующие изменения:

* **Фаза 1:** Мы наберем минимальную версию TLS по умолчанию на 1,2 для вновь созданных экземпляров кэша. (Раньше это был TLS 1.0.) Существующие экземпляры кэша не будут обновляться в этой точке. При необходимости вам будет разрешено [изменить минимальную версию TLS](cache-configure.md#access-ports) до 1,0 или 1,1 для обратной совместимости. Это изменение может быть сделано через портал Azure или другие AA-аДИ управления.
* **Фаза 2:** Мы прекратим поддерживать версии TLS 1.0 и 1.1. После этого изменения приложение будет обязано использовать TLS 1.2 или позже для связи с кэшем.

Кроме того, как часть этого изменения, мы будем удалять поддержку для старых, небезопасных шифров.  Наши поддерживаемые пакеты шифов будут ограничены следующими вариантами, когда кэш настроен с минимальной версией TLS 1.2.

* TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384
* TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256

В этой статье содержится общее руководство о том, как обнаружить зависимости от этих более ранних версий TLS и удалить их из приложения.

Даты, когда эти изменения вступают в силу:

| Облако               | Дата начала фазы 1 | Дата начала фазы 2      |
|---------------------|--------------------|-------------------------|
| Azure (глобальная)      |  13 января 2020 г.  | 11 мая 2020 г. (продлен) |
| Azure для государственных организаций    |  13 марта 2020 года    | 11 мая 2020 г.            |
| Azure для Германии       |  13 марта 2020 года    | 11 мая 2020 г.            |
| Azure для Китая         |  13 марта 2020 года    | 11 мая 2020 г.            |

## <a name="check-whether-your-application-is-already-compliant"></a>Проверьте, соответствует ли ваше приложение требованиям

Самый простой способ узнать, будет ли приложение работать с TLS 1.2, это установить минимальное значение **версии TLS** на TLS 1.2 на тесте или постановке кэша, который он использует. **Параметр минимальной версии TLS** находится в [расширенных настройках](cache-configure.md#advanced-settings) экземпляра кэша на портале Azure. Если приложение продолжает функционировать, как ожидалось, после этого изменения, оно, вероятно, соответствует требованиям. Возможно, потребуется настроить некоторые клиентские библиотеки Redis, используемые вашим приложением специально для включения TLS 1.2, чтобы они могли подключиться к Кэшу Azure для Redis по этому протоколу безопасности.

## <a name="configure-your-application-to-use-tls-12"></a>Нанастройка приложения для использования TLS 1.2

Большинство приложений используют библиотеки клиентов Redis для связи с их кэшами. Вот инструкции для настройки некоторых популярных библиотек клиентов, на различных языках программирования и в средах, чтобы использовать TLS 1.2.

### <a name="net-framework"></a>.NET Framework

Клиенты Redis .NET используют самую раннюю версию TLS по умолчанию на .NET Framework 4.5.2 или ранее, а также используют последнюю версию TLS на .NET Framework 4.6 или позже. Если вы используете старую версию рамочного соглашения .NET, вы можете включить TLS 1.2 вручную:

* **StackExchange.Redis:** `ssl=true` Установите `sslprotocols=tls12` и в строке соединения.
* **ServiceStack.Redis:** Следуйте инструкциям [ServiceStack.Redis](https://github.com/ServiceStack/ServiceStack.Redis#servicestackredis-ssl-support) и требует, как минимум, ServiceStack.Redis v5.6.

### <a name="net-core"></a>.NET Core

Клиенты Redis .NET Core используют последнюю версию TLS по умолчанию.

### <a name="java"></a>Java

Клиенты Redis Java используют TLS 1.0 в Java-версии 6 или раньше. Джедаи, Листья и Редиссон не могут подключиться к Кэшу Azure для Redis, если TLS 1.0 отключен в кэше. Обновление платформы Java для использования новых версий TLS.

Для Java 7 клиенты Redis не используют TLS 1.2 по умолчанию, но могут быть настроены для него. Jedis позволяет указать базовые настройки TLS со следующим фрагментом кода:

``` Java
SSLSocketFactory sslSocketFactory = (SSLSocketFactory) SSLSocketFactory.getDefault();
SSLParameters sslParameters = new SSLParameters();
sslParameters.setEndpointIdentificationAlgorithm("HTTPS");
sslParameters.setProtocols(new String[]{"TLSv1.2"});
 
URI uri = URI.create("rediss://host:port");
JedisShardInfo shardInfo = new JedisShardInfo(uri, sslSocketFactory, sslParameters, null);
 
shardInfo.setPassword("cachePassword");
 
Jedis jedis = new Jedis(shardInfo);
```

Клиенты Lettuce и Redisson пока не поддерживают указание версии TLS, поэтому они сломается, если кэш принимает только соединения TLS 1.2. Исправления для этих клиентов в настоящее время рассматриваются, так что проверить с этими пакетами для обновленной версии с этой поддержкой.

В Java 8 TLS 1.2 используется по умолчанию и не должен требовать обновления конфигурации клиента в большинстве случаев. Чтобы быть в безопасности, проверьте свое приложение.

### <a name="nodejs"></a>Node.js

Узлы Redis и IORedis используют TLS 1.2 по умолчанию.

### <a name="php"></a>PHP

#### <a name="predis"></a>Предис
 
* Версии раньше, чем PHP 7: Predis поддерживает только TLS 1.0. Эти версии не работают с TLS 1.2; необходимо обновиться, чтобы использовать TLS 1.2.
 
* PHP 7.0 до PHP 7.2.1: Predis использует только TLS 1.0 или 1.1 по умолчанию. Вы можете использовать следующий обходной путь для использования TLS 1.2. Укажите TLS 1.2 при создании экземпляра клиента:

  ``` PHP
  $redis=newPredis\Client([
      'scheme'=>'tls',
      'host'=>'host',
      'port'=>6380,
      'password'=>'password',
      'ssl'=>[
          'crypto_type'=>STREAM_CRYPTO_METHOD_TLSv1_2_CLIENT,
      ],
  ]);
  ```

* PHP 7.3 и более поздние версии: Predis использует последнюю версию TLS.

#### <a name="phpredis"></a>PhpRedis

PhpRedis не поддерживает TLS ни в одной версии PHP.

### <a name="python"></a>Python

Redis-py использует TLS 1.2 по умолчанию.

### <a name="go"></a>GO

Redigo использует TLS 1.2 по умолчанию.

## <a name="additional-information"></a>Дополнительные сведения

- [Настройка кэша Azure для Redis](cache-configure.md)
