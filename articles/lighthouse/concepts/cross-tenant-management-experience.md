---
title: Интерфейсы управления для различных клиентов
description: Делегированное управление ресурсами Azure предоставляет интерфейсы управления для различных клиентов.
ms.date: 04/24/2020
ms.topic: conceptual
ms.openlocfilehash: 51cd464da417bfd1d6d4ff52e2a2595a7ce77fe6
ms.sourcegitcommit: 67bddb15f90fb7e845ca739d16ad568cbc368c06
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82201709"
---
# <a name="cross-tenant-management-experiences"></a>Интерфейсы управления для различных клиентов

Вы, как поставщик услуг, можете использовать [делегированное управление ресурсами Azure](../concepts/azure-delegated-resource-management.md), чтобы управлять ресурсами Azure для нескольких клиентов из собственного арендатора на [портале Azure](https://portal.azure.com). Большинство задач и служб могут выполняться для делегированных ресурсов Azure в управляемых арендаторах. В этой статье описываются некоторые расширенные сценарии, в которых можно эффективно использовать делегированное управление ресурсами Azure.

> [!NOTE]
> Управление делегированными ресурсами Azure можно также использовать [в рамках предприятия, в котором есть несколько клиентов Azure AD](enterprise.md) , чтобы упростить администрирование между клиентами.

## <a name="understanding-customer-tenants"></a>Общие сведения о клиентах пользователей

В Azure Active Directory (Azure AD) клиент представляет организацию. Это выделенный экземпляр Azure AD, который организация получает при создании связи с корпорацией Майкрософт, подписавшись на Azure, Microsoft 365 или другие службы. Каждый клиент Azure AD отделен от остальных клиентов Azure AD и имеет собственный идентификатор клиента (GUID). Дополнительные сведения см. в статье [Что такое Azure Active Directory](../../active-directory/fundamentals/active-directory-whatis.md).

Как правило, чтобы управлять ресурсами Azure для клиента, поставщики услуг должны будут входить на портал Azure, используя учетную запись, связанную с клиентом этого пользователя. При этом необходимо будет, чтобы администратор в клиенте пользователя создавал учетные записи пользователей и управлял ими для поставщика услуг.

Благодаря системе делегированного управления ресурсами Azure процесс подключения указывает пользователей в клиенте поставщика услуг, которые смогут получать доступ к подпискам, группам ресурсов и ресурсам и управлять ими в клиенте пользователя. Эти пользователи могут затем войти на портал Azure, используя собственные учетные данные. На портале Azure они могут управлять ресурсами, принадлежащими всем клиентам, к которым у них есть доступ. Это можно сделать, посетив страницу [Мои клиенты](../how-to/view-manage-customers.md) на портале Azure или работая напрямую в контексте подписки этого клиента на портале Azure или через API.

Система делегированного управления ресурсами Azure обеспечивает большую гибкость в управлении ресурсами для нескольких клиентов без необходимости входа в разные учетные записи разных клиентов. Например, поставщик услуг может иметь два клиента с разными обязанностями и уровнями доступа. С помощью делегированного управления ресурсами Azure полномочные пользователи могут войти в клиент поставщика услуг для доступа к этим ресурсам.

![Ресурсы клиента, управляемые с помощью одного клиента поставщика услуг](../media/azure-delegated-resource-management-service-provider-tenant.jpg)

## <a name="apis-and-management-tool-support"></a>Поддержка интерфейсов API и средств управления

Вы можете выполнять задачи управления делегированными ресурсами непосредственно на портале или с помощью интерфейсов API и средств управления (таких как Azure CLI и Azure PowerShell). Все существующие API можно использовать для работы с делегированными ресурсами, если их функциональные возможности поддерживаются для распределенного управления арендаторами и у пользователя есть соответствующие разрешения.

Командлет Azure PowerShell [Get-азсубскриптион](https://docs.microsoft.com/powershell/module/Az.Accounts/Get-AzSubscription?view=azps-3.5.0) показывает значение **tenantID** для каждой подписки, что позволяет определить, принадлежит ли возвращенная Подписка к клиенту поставщика услуг или к клиенту управляемого клиента.

Аналогичным образом Azure CLI команды, например [AZ Account List](https://docs.microsoft.com/cli/azure/account?view=azure-cli-latest#az-account-list) , отображают атрибуты **хометенантид** и **манажедбитенантс** .

> [!TIP]
> Если вы не видите эти значения при использовании Azure CLI, попробуйте очистить кэш, выполнив `az account clear` , за `az login --identity`которым следует.

Мы также предоставляем интерфейсы API, относящиеся к выполнению делегированных задач управления ресурсами Azure. Дополнительные сведения см. в разделе **Справочные материалы**.

## <a name="enhanced-services-and-scenarios"></a>Расширенные службы и сценарии

Большинство задач и служб могут выполняться для делегированных ресурсов в управляемых арендаторах. Ниже приведены некоторые основные сценарии, в которых распределенное управление арендаторами может быть эффективным.

[Azure Arc для серверов (предварительная версия)](../../azure-arc/servers/overview.md).

- [Подключение компьютеров под управлением Windows Server или Linux извне Azure](../../azure-arc/servers/quickstart-onboard-portal.md) к делегированным подпискам и (или) группам ресурсов в Azure.
- Управление подключенными компьютерами с помощью конструкций Azure, таких как Политика Azure и добавление тегов.

Служба [автоматизации Azure](../../automation/index.yml):

- Использование учетных записей службы автоматизации для получения доступа к делегированным ресурсам клиента и работы с ними.

[Azure Backup](../../backup/index.yml):

- Резервное копирование и восстановление данных пользователей в клиентах.
- Используйте [Обозреватель резервных копий](../../backup/monitor-azure-backup-with-backup-explorer.md) для просмотра оперативной информации об элементах резервного копирования (включая ресурсы Azure, которые еще не настроены для резервного копирования) и сведения о мониторинге (задания и оповещения) для делегированных подписок. В настоящее время обозреватель резервного копирования доступен только для данных виртуальной машины Azure.
- Используйте [отчеты по резервному копированию](../../backup/configure-reports.md) в делегированных подписках для мониторинга исторических тенденций, анализа потребления хранилища резервных копий и аудита резервных копий и восстановления.

[Служба Kubernetes Azure (AKS)](../../aks/index.yml):

- Управление размещенными средами Kubernetes, а также развертывание контейнерных приложений и управление ими в клиентах пользователей.

[Azure Monitor](../../azure-monitor/index.yml):

- Просмотр оповещений для делегированных подписок с возможностью просмотра оповещений во всех подписках.
- Просмотр сведений журнала действий для делегированных подписок.
- Log Analytics: запрос данных из удаленных рабочих областей клиентов в нескольких клиентах
- Создание оповещений в арендаторах клиентов, которые инициируют автоматизацию (например, Runbook службы автоматизации Azure или Функции Azure) в арендаторе поставщика службы через веб-перехватчики.

[Сеть Azure](../../networking/networking-overview.md):

- Развертывание и управление [виртуальной сетью Azure (VNet)](../../virtual-network/index.yml) и виртуальными сетевыми картами (vNIC) в клиентах клиентов
- Развертывание и настройка [брандмауэра Azure](../../firewall/overview.md) для защиты ресурсов виртуальной сети клиентов
- Управление службами подключения, такими как [Виртуальные глобальные сети Azure](../../virtual-wan/virtual-wan-about.md), [ExpressRoute](../../expressroute/expressroute-introduction.md)и [VPN-шлюзы](../../vpn-gateway/vpn-gateway-about-vpngateways.md) для клиентов
- Использование Azure Лигхсаусе для поддержки ключевых сценариев для [программы MSP в сети Azure](../../networking/networking-partners-msp.md)


[Политика Azure](../../governance/policy/index.yml):

- Моментальные снимки соответствия, отображающие сведения о назначенных политиках в делегированных подписках.
- Создание и изменение определений политики в делегированной подписке.
- Назначение пользовательских определений политики в делегированной подписке.
- Клиенты видят политики, созданные поставщиком услуг, наряду с политиками, которые они создали сами.
- Может [исправлять ошибки deployIfNotExists или изменят назначения в арендаторе клиента](../how-to/deploy-policy-remediation.md).

[Граф ресурсов Azure](../../governance/resource-graph/index.yml):

- Теперь включает идентификатор клиента в возвращенные результаты запроса, позволяя определить, принадлежит ли подписка клиенту пользователя или клиенту поставщика услуг.

[Центр безопасности Azure](../../security-center/index.yml):

- Видимость различных клиентов
  - Отслеживание соответствия политикам безопасности и обеспечение безопасности для ресурсов всех клиентов
  - Непрерывный мониторинг соответствия нормативным требованиям для нескольких клиентов в одном представлении.
  - Мониторинг, рассмотрение и определение приоритетных практических рекомендаций по безопасности с вычислением оценки безопасности.
- Управление состоянием безопасности для различных клиентов.
  - Управление политиками безопасности.
  - Выполнение действий с ресурсами, которые не соответствуют практическим рекомендациям по безопасности.
  - Сбор и хранение данных, связанных с безопасностью.
- Обнаружение угроз для различных клиентов и защита от них.
  - Обнаружение угроз для ресурсов клиентов
  - Применение дополнительных элементов управления защитой от угроз, таких как JIT-доступ к виртуальной машине.
  - Повышение уровня защиты конфигурации группы безопасности сети с помощью адаптивной защиты сети.
  - Обеспечение работы только тех приложений и процессов на серверах, которые должны использоваться с адаптивными элементами управления приложениями.
  - Мониторинг изменений важных файлов и записей реестра с помощью мониторинга целостности файлов (FIM).

[Sentinel Azure](../../sentinel/multiple-tenants-service-providers.md):

- Управление ресурсами Sentinel Azure [в клиентах клиентов](../../sentinel/multiple-tenants-service-providers.md)
- [Мониторинг атак и Просмотр оповещений системы безопасности для нескольких клиентов](https://techcommunity.microsoft.com/t5/azure-sentinel/using-azure-lighthouse-and-azure-sentinel-to-monitor-across/ba-p/1043899)

[Работоспособность службы Azure](../../service-health/index.yml):

- Мониторинг работоспособности ресурсов клиента с помощью службы "Работоспособность ресурсов Azure".
- Отслеживание работоспособности служб Azure, которые используют клиенты.

[Azure Site Recovery](../../site-recovery/index.yml):

- Управление параметрами аварийного восстановления для виртуальных машин Azure в пользовательских клиентах (обратите внимание, что учетные записи RunAs нельзя использовать для копирования расширений виртуальных машин).

[Виртуальные машины Azure](../../virtual-machines/index.yml):

- Использование расширений виртуальных машин для выполнения задач настройки и автоматизации после развертывания виртуальных машин Azure в пользовательских клиентах.
- Использование диагностики загрузки для устранения неполадок с виртуальными машинами Azure в пользовательских клиентах.
- Получение доступа к виртуальным машинам с помощью последовательной консоли в пользовательских клиентах.
- Интегрируйте виртуальные машины с Azure KeyVault для паролей, секретов или криптографических ключей для шифрования дисков с помощью [управляемого удостоверения в политике](https://github.com/Azure/Azure-Lighthouse-samples/tree/master/templates/create-keyvault-secret), гарантируя, что секреты хранятся в Key Vault в клиентских клиентах.
- Обратите внимание, что вы не можете использовать Azure Active Directory для удаленного входа на виртуальные машины в клиентах клиентов.

Запросы в службу поддержки.

- Откройте запросы в службу поддержки для делегированных ресурсов с помощью колонки **Справка и поддержка** на портале Azure (выбирая план поддержки, доступный для делегированной области).

## <a name="current-limitations"></a>Текущие ограничения
Во всех сценариях необходимо учитывать следующие текущие ограничения.

- Запросы, обрабатываемые службой Azure Resource Manager, можно выполнять с помощью делегированного управления ресурсами Azure. URI операций для этих запросов начинаются с `https://management.azure.com`. Однако запросы, обрабатываемые экземпляром типа ресурса (например, KeyVault секреты доступа или доступа к данным хранилища), не поддерживаются с помощью делегированного управления ресурсами Azure. URI операций для этих запросов обычно начинаются с адреса, уникального для вашего экземпляра, например `https://myaccount.blob.core.windows.net` или `https://mykeyvault.vault.azure.net/`. Последние также обычно являются операциями с данными, а не операциями управления. 
- При назначении ролей должны использоваться [встроенные роли](../../role-based-access-control/built-in-roles.md) управления доступом на основе ролей (RBAC). В настоящее время все встроенные роли поддерживаются для делегированного управления ресурсами Azure, за исключением роли "Владелец" и любых встроенных ролей с разрешением [DataActions](../../role-based-access-control/role-definitions.md#dataactions). Роль "Администратор доступа пользователей" поддерживается только для [назначения ролей управляемым удостоверениям](../how-to/deploy-policy-remediation.md#create-a-user-who-can-assign-roles-to-a-managed-identity-in-the-customer-tenant).  Пользовательские роли и [роли классического администратора подписки](../../role-based-access-control/classic-administrators.md) не поддерживаются.
- Хотя вы можете подключить подписки, использующие Azure Databricks, пользователи в управляющем клиенте в настоящее время не смогут запускать Azure Databricks рабочие области в делегированной подписке.
- Хотя вы можете подключить подписки и группы ресурсов для делегированного управления ресурсами Azure, которые имеют блокировки ресурсов, эти блокировки не будут препятствовать выполнению действий в управляющем клиенте. [Запрет назначений](../../role-based-access-control/deny-assignments.md) , защищающих управляемые системой ресурсы, такие как созданные управляемыми приложениями Azure или схемы Azure (назначенные системой назначения Deny), не позволяют пользователям, работающим в управлении клиентом, работать с этими ресурсами; Однако в настоящее время пользователи в клиенте клиента не могут создавать собственные назначения Deny (назначаемые пользователем назначения).
- Пользователи в управляющем клиенте не будут иметь доступа для просмотра сведений о выставлении счетов для делегированной подписки клиента, даже если у них есть встроенная роль, которая обычно разрешает доступ. Это связано с тем, что доступ к сведениям о выставлении счетов требует дополнительных действий, которые в настоящее время поддерживаются только для пользователей в пределах одного клиента.

## <a name="next-steps"></a>Дальнейшие шаги

- Подключите клиентов к делегированному управлению ресурсами Azure с помощью [шаблонов Azure Resource Manager](../how-to/onboard-customer.md) или путем [публикации предложения частных или общедоступных управляемых служб в Azure Marketplace](../how-to/publish-managed-services-offers.md).
- [Просматривайте клиентов и управляйте ими](../how-to/view-manage-customers.md), перейдя в раздел **Мои клиенты** на портале Azure.
