---
title: 'Выполнение скрипта R: Справочник по модулям'
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать модуль выполнить сценарий R в Машинное обучение Azure для выполнения кода R.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: xiaoharper
ms.author: peterlu
ms.date: 06/01/2019
ms.openlocfilehash: f9aae1302f0d83c27d5d8f01745ddecbaeea9467
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73497875"
---
# <a name="execute-r-script"></a>Выполнение сценария R

В этой статье описывается, как использовать модуль « **выполнение скрипта r** » для выполнения кода R в конвейере конструктора машинное обучение Azure (Предварительная версия).

С помощью R можно выполнять задачи, которые сейчас не поддерживаются существующими модулями, такими как: 
- Создание пользовательских преобразований данных
- Использование собственных метрик для вычисления прогнозов
- Создание моделей с использованием алгоритмов, которые не реализованы как автономные модули в конструкторе

## <a name="r-version-support"></a>Поддержка версии R

Машинное обучение Azure конструктор использует распределение R по CRAN (всеобъемлющую сеть с архивом R). Текущая используемая версия — CRAN 3.5.1.

## <a name="supported-r-packages"></a>Поддерживаемые пакеты R

Среда R предварительно устанавливается с более чем 100 пакетами. Полный список см. в разделе [предварительно установленные пакеты R](#pre-installed-r-packages).

Можно также добавить следующий код в любой модуль **выполнить сценарий R** и просмотреть установленные пакеты.

```R
azureml_main <- function(dataframe1, dataframe2){
  print("R script run.")
  dataframe1 <- data.frame(installed.packages())
  return(list(dataset1=dataframe1, dataset2=dataframe2))
}
```

## <a name="installing-r-packages"></a>Установка пакетов R
Чтобы установить дополнительные пакеты R, используйте метод `install.packages()`. Не забудьте указать репозиторий CRAN. Пакеты устанавливаются для каждого модуля « **выполнение скрипта r** » и не являются общими для других модулей « **выполнение скрипта r** ».

В этом примере показано, как установить Zoo:
```R
# R version: 3.5.1
# The script MUST contain a function named azureml_main
# which is the entry point for this module.

# The entry point function can contain up to two input arguments:
#   Param<dataframe1>: a R DataFrame
#   Param<dataframe2>: a R DataFrame
azureml_main <- function(dataframe1, dataframe2){
  print("R script run.")
  
  if(!require(zoo)) install.packages("zoo",repos = "http://cran.us.r-project.org")
  library(zoo)
  # Return datasets as a Named List
  return(list(dataset1=dataframe1, dataset2=dataframe2))
}
```
 > [!NOTE]
  > Убедитесь, что пакет уже существует, прежде чем устанавливать его, чтобы избежать повторения установки. Как и `  if(!require(zoo)) install.packages("zoo",repos = "http://cran.us.r-project.org")` в приведенном выше примере кода. Повторная установка может привести к превышению времени ожидания запроса веб-службы.     

## <a name="how-to-configure-execute-r-script"></a>Настройка выполнения сценария R

Модуль **выполнить сценарий R** содержит образец кода, который можно использовать в качестве отправной точки. Чтобы настроить модуль **выполнить сценарий R** , укажите набор входных данных и код для выполнения.

![Модуль R-Module](media/module/execute-r-script.png)

Наборы данных, хранящиеся в конструкторе, автоматически преобразуются в кадр с данными R при загрузке с этим модулем.

1.  Добавьте модуль **выполнить сценарий R** в конвейер.

  

1. Подключите любые входные данные, необходимые для скрипта. Входные значения необязательны и могут включать данные и дополнительный код R.

    * **DataSet1**: ссылка на первый вход в качестве `dataframe1`. Входной набор данных должен быть отформатирован в виде CSV-файла, TSV, ARFF, либо можно подключить набор данных Машинное обучение Azure.

    * **DataSet2**: ссылка на второй вход в качестве `dataframe2`. Этот набор данных также должен быть отформатирован в виде файла CSV, TSV, ARFF или набора данных Машинное обучение Azure.

    * **Пакет скриптов**. третий вход принимает ZIP-файлы. ZIP-файл может содержать несколько файлов и несколько типов файлов.

1. В текстовом поле **Скрипт r** введите или вставьте допустимый скрипт R.

    Чтобы помочь вам приступить к работе, в текстовом поле « **Скрипт R** » предварительно заполняется образец кода, который можно изменить или заменить.
    
```R
# R version: 3.5.1
# The script MUST contain a function named azureml_main
# which is the entry point for this module.

# The entry point function can contain up to two input arguments:
#   Param<dataframe1>: a R DataFrame
#   Param<dataframe2>: a R DataFrame
azureml_main <- function(dataframe1, dataframe2){
  print("R script run.")

  # If a zip file is connected to the third input port, it is
  # unzipped under "./Script Bundle". This directory is added
  # to sys.path.

  # Return datasets as a Named List
  return(list(dataset1=dataframe1, dataset2=dataframe2))
}
```

 * Скрипт должен содержать функцию с именем `azureml_main`, которая является точкой входа для этого модуля.

 * Функция точки входа может содержать до двух входных аргументов: `Param<dataframe1>` и `Param<dataframe2>`
 
   > [!NOTE]
    > Данные, передаваемые в модуль **выполнить сценарий R** , указываются как `dataframe1` и `dataframe2`, что отличается от конструктора машинное обучение Azure (ссылка конструктора `dataset1`, `dataset2`). Убедитесь, что входные данные правильно рефернецед в скрипте.  
 
    > [!NOTE]
    >  Существующий код R может потребовать незначительных изменений для выполнения в конвейере конструктора. Например, входные данные, которые вы предоставляете в формате CSV, должны быть явно преобразованы в набор данных, прежде чем их можно будет использовать в коде. Типы данных и столбцов, используемые в языке R, также отличаются некоторыми способами от типов данных и столбцов, используемых в конструкторе.

1.  **Случайное начальное**значение: введите значение, которое будет использоваться в среде R в качестве значения случайного начального номера. Этот параметр эквивалентен вызову `set.seed(value)` в коде R.  

1. Запустили конвейер.  

## <a name="results"></a>Результаты

Модули **выполнения сценариев r** могут возвращать несколько выходов, но они должны быть представлены в виде кадров данных R. Данные автоматически преобразуются в наборы данных в конструкторе для совместимости с другими модулями.

Стандартные сообщения и ошибки из R возвращаются в журнал модуля.

## <a name="sample-scripts"></a>Примеры сценариев

Существует множество способов расширения конвейера с помощью пользовательского скрипта R.  В этом разделе приведен пример кода для распространенных задач.


### <a name="add-r-script-as-an-input"></a>Добавление скрипта R в качестве входных данных

Модуль **выполнить сценарий r** поддерживает произвольные файлы R script в качестве входных данных. Для этого их необходимо отправить в рабочую область как часть ZIP-файла.

1. Чтобы отправить ZIP-файл, содержащий код R, в рабочую область, нажмите кнопку **создать**, выберите **набор данных**, а затем выберите **из локального файла** и **ZIP-файла** .  

1. Убедитесь, что сжатый файл доступен в списке **сохраненные наборы данных** .

1.  Подключите набор данных к порту ввода **пакета сценариев** .

1. Все файлы, содержащиеся в ZIP-файле, доступны во время выполнения конвейера. 

    Если файл пакета скрипта содержит структуру каталогов, структура сохраняется. Тем не менее, необходимо изменить код, чтобы в начале **пакета Directory./script** был указан путь.

### <a name="process-data"></a>Обработка данных

В следующем примере показано, как масштабировать и нормализовать входные данные.

```R
# R version: 3.5.1
# The script MUST contain a function named azureml_main
# which is the entry point for this module.
# The entry point function can contain up to two input arguments:
#   Param<dataframe1>: a R DataFrame
#   Param<dataframe2>: a R DataFrame
azureml_main <- function(dataframe1, dataframe2){
  print("R script run.")
  # If a zip file is connected to the third input port, it is
  # unzipped under "./Script Bundle". This directory is added
  # to sys.path.
  series <- dataframe1$width
  # find the maximum and minimum values of width column in dataframe1
  max_v <- max(series)
  min_v <- min(series)
  # calculate the scale and bias
  scale <- max_v - min_v
  bias <- min_v / dis
  # apply min-max normalizing
  dataframe1$width <- dataframe1$width / scale - bias
  dataframe2$width <- dataframe2$width / scale - bias
  # Return datasets as a Named List
  return(list(dataset1=dataframe1, dataset2=dataframe2))
}
 ```

### <a name="read-a-zip-file-as-input"></a>Чтение ZIP-файла в качестве входных данных

В этом примере показано, как использовать набор данных в ZIP-файле в качестве входных данных для модуля « **выполнение скрипта R** ».

1. Создайте файл данных в формате CSV и назовите его "мидатафиле. csv".
1. Создайте ZIP-файл и добавьте CSV-файл в архив.
1. Отправьте сжатый ZIP-файл в рабочую область Машинное обучение Azure. 
1. Подключите результирующий набор данных к **скриптбундле** входному модулю **выполнения скрипта R** .
1. Используйте следующий код для чтения CSV-данных из ZIP-файла.

```R
azureml_main <- function(dataframe1, dataframe2){
  print("R script run.")
  mydataset<-read.csv("./Script Bundle/mydatafile.csv",encoding="UTF-8");  
  # Return datasets as a Named List
  return(list(dataset1=mydataset, dataset2=dataframe2))
}
```

### <a name="replicate-rows"></a>Репликация строк

В этом примере показано, как реплицировать положительные записи в наборе данных для балансировки образца:

```R
azureml_main <- function(dataframe1, dataframe2){
  data.set <- dataframe1[dataframe1[,1]==-1,]  
  # positions of the positive samples
  pos <- dataframe1[dataframe1[,1]==1,]
  # replicate the positive samples to balance the sample  
  for (i in 1:20) data.set <- rbind(data.set,pos)  
  row.names(data.set) <- NULL
  # Return datasets as a Named List
  return(list(dataset1=data.set, dataset2=dataframe2))
}
```

### <a name="pass-r-objects-between-execute-r-script-modules"></a>Передача объектов R между модулями выполнения скрипта R

Объекты R можно передавать между экземплярами модуля **выполнить сценарий R** с помощью внутреннего механизма сериализации. В этом примере предполагается, что необходимо переместить объект R с именем `A` между двумя модулями **выполнение скрипта r** .

1. Добавьте в конвейер первый модуль **выполнить сценарий r** и введите следующий код в текстовом поле **Скрипт r** , чтобы создать сериализованный объект `A` в виде столбца в таблице выходных данных модуля:  
  
    ```R
    azureml_main <- function(dataframe1, dataframe2){
      print("R script run.")
      # some codes generated A
      
      serialized <- as.integer(serialize(A,NULL))  
      data.set <- data.frame(serialized,stringsAsFactors=FALSE)

      return(list(dataset1=data.set, dataset2=dataframe2))
    }
    ```

    Явное преобразование в целочисленный тип выполняется потому, что функция сериализации выводит данные в формате R `Raw`, который не поддерживается конструктором.

1. Добавьте второй экземпляр модуля **выполнить сценарий R** и подключите его к порту вывода предыдущего модуля.

1. Введите следующий код в текстовом поле **Скрипт R** , чтобы извлечь `A` объекта из таблицы входных данных. 

    ```R
    azureml_main <- function(dataframe1, dataframe2){
      print("R script run.")
      A <- unserialize(as.raw(dataframe1$serialized))  
      # Return datasets as a Named List
      return(list(dataset1=dataframe1, dataset2=dataframe2))
    }
    ```

## <a name="pre-installed-r-packages"></a>Предварительно установленные пакеты R

Текущий список предварительно установленных пакетов R, доступных для использования:

|              |            | 
|--------------|------------| 
| Package      | Version (версия)    | 
| аскпасс      | 1,1        | 
| ассертсат   | 0.2.1      | 
| бэкпортированным    | 1.1.4      | 
| из         | 3.5.1      | 
| base64enc    | 0,1 – 3      | 
| BH           | 1.69.0-1   | 
| Связыватель        | 0.1.1      | 
| биндркпп     | 0.2.2      | 
| битопс       | 1.0 – 6      | 
| boot         | 1.3 – 22     | 
| брум        | 0.5.2      | 
| вызывающий объект        | 3.2.0      | 
| курсор        | 6.0 – 84     | 
| катулс      | 1.17.1.2   | 
| целлранжер   | 1.1.0      | 
| class        | 7.3 – 15     | 
| CLI          | 1.1.0      | 
| Коллекция        | 0.6.0      | 
| cluster      | 2.0.7-1    | 
| кодетулс    | 0,2-16     | 
| колорспаце   | 1.4 – 1      | 
| Компилятора     | 3.5.1      | 
| мелки       | 1.3.4      | 
| Листывания         | 3.3        | 
| Data. Table   | 1.12.2     | 
| наборов данных     | 3.5.1      | 
| DBI          | 1.0.0      | 
| дбплир       | 1.4.1      | 
| digest       | 0.6.19     | 
| dplyr        | 0.7.6      | 
| e1071        | 1.7 – 2      | 
| evaluate     | 0,14       | 
| фанси        | 0.4.0      | 
| форкатс      | 0.3.0      | 
| foreach      | 1.4.4      | 
| сторонняя      | 0,8 — 71     | 
| зависимости           | 1.3.1      | 
| гдата        | 2.18.0     | 
| Универсальные шаблоны     | 0.0.2      | 
| ggplot2      | 3.2.0      | 
| glmnet       | 2.0 — 18     | 
| Приклейте         | 1.3.1      | 
| говер        | 0.2.1      | 
| гплотс       | 3.0.1.1    | 
| рисунка     | 3.5.1      | 
| грдевицес    | 3.5.1      | 
| Сетки         | 3.5.1      | 
| гтабле       | 0.3.0      | 
| гтулс       | 3.8.1      | 
| не задан        | 2.1.0      | 
| высокая степень        | 0,8        | 
| хмс          | 0.4.2      | 
| хтмлтулс    | 0.3.6      | 
| хттр         | 1.4.0      | 
| ипред        | 0.9-9      | 
| итераторы    | 1.0.10     | 
| жсонлите     | 1.6        | 
| кернсмус   | 23E-15    | 
| книтр        | 1,23       | 
| меток     | 0,3        | 
| Lattice      | 0,20 — 38    | 
| лава         | 1.6.5      | 
| лазевал     | 0.2.2      | 
| лубридате    | 1.7.4      | 
| магриттр     | 1.5        | 
| Markdown     | 1          | 
| ДОБАВЛЕНИИ         | 7.3 — 51.4   | 
| Таблицу       | 1.2 – 17     | 
| Метод      | 3.5.1      | 
| мгкв         | 1,8 – 28     | 
| формата         | 0,7        | 
| моделметрикс | 1.2.2      | 
| модель       | 0.1.4      | 
| мунселл      | 0.5.0      | 
| нлме         | 3.1 – 140    | 
| ннет         | 7.3 – 12     | 
| нумдерив     | 2016.8-1.1 | 
| OpenSSL      | 1.4        | 
| распараллеливани     | 3.5.1      | 
| фундаменталь       | 1.4.1      | 
| пкгконфиг    | 2.0.2      | 
| плогр        | 0.2.0      | 
| плир         | 1.8.4      | 
| преттюнитс  | 1.0.2      | 
| процесскс     | 3.3.1      | 
| продлим      | 2018.04.18 | 
| ход выполнения     | 1.2.2      | 
| PS           | 1.3.0      | 
| пуррр        | 0.3.2      | 
| куадпрог     | 1,5 – 7      | 
| куантмод     | 0,4 – 15     | 
| R6           | 2.4.0      | 
| randomForest | 4.6-14     | 
| рколорбревер | 1.1 – 2      | 
| ркпп         | 1.0.1      | 
| ркппролл     | 0.3.0      | 
| DataReader        | 1.3.1      | 
| реадксл       | 1.3.1      | 
| Рецепты      | 0.1.5      | 
| сопоставить      | 1.0.1      | 
| репрекс       | 0.3.0      | 
| reshape2     | 1.4.3      | 
| ретикулате   | 1,12       | 
| рланг        | 0.4.0      | 
| rmarkdown    | 1,13       | 
| рокр         | 1.0 – 7      | 
| rpart        | 4.1 – 15     | 
| рстудиоапи   | 0,1        | 
| рвест        | 0.3.4      | 
| вдоль       | 1.0.0      | 
| Выбор      | 0,4 — 1      | 
| привод      | 7.3 – 11     | 
| сплайнов      | 3.5.1      | 
| скуарем      | 2017.10-1  | 
| stats        | 3.5.1      | 
| stats4       | 3.5.1      | 
| стринги      | 1.4.3      | 
| Строка      | 1.3.1      | 
| выживаемости     | 2.44-1.1   | 
| sys          | 3.2        | 
| тклтк        | 3.5.1      | 
| тиббле       | 2.1.3      | 
| Очистка        | 0.8.3      | 
| тидиселект   | 0.2.5      | 
| тидиверсе    | 1.2.1      | 
| timeDate     | 3043,102   | 
| тинитекс      | 0,13       | 
| средства        | 3.5.1      | 
| тсериес      | 0,10-47    | 
| ттр          | 0.23-4     | 
| обратно         | 1.1.4      | 
| utils        | 3.5.1      | 
| вктрс        | 0.1.0      | 
| виридислите  | 0.3.0      | 
| усами      | 0,3-2      | 
| с помощью        | 2.1.2      | 
| ксфун         | 0,8        | 
| xml2         | 1.2.0      | 
| XTS          | 0,11-2     | 
| YAML         | 2.2.0      | 
| зеаллот      | 0.1.0      | 
| зоопарк          | 1.8-6      | 

## <a name="next-steps"></a>Дальнейшие действия

См. [набор модулей, доступных](module-reference.md) для машинное обучение Azure. 
