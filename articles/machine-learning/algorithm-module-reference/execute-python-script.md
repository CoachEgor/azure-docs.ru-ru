---
title: 'Выполнение скрипта Python: Справочник по модулям'
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать модуль выполнение скрипта Python в Машинное обучение Azure для выполнения кода Python.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 04/27/2020
ms.openlocfilehash: 9b2114672db755efba1818505c8f399ac01aea71
ms.sourcegitcommit: 999ccaf74347605e32505cbcfd6121163560a4ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/08/2020
ms.locfileid: "82983607"
---
# <a name="execute-python-script-module"></a>Выполнить модуль скрипта Python

В этой статье описывается модуль в Машинное обучение Azure Designer (Предварительная версия).

Используйте этот модуль для выполнения кода Python. Дополнительные сведения об архитектуре и принципах разработки Python см. [в следующей статье](https://docs.microsoft.com/azure/machine-learning/machine-learning-execute-python-scripts).

С помощью Python можно выполнять задачи, которые сейчас не поддерживаются существующими модулями, такими как:

+ Визуализация данных с помощью`matplotlib`
+ Использование библиотек Python для перечисления наборов данных и моделей в рабочей области
+ Чтение, Загрузка и обработка данных из источников, не поддерживаемых модулем [Импорт данных](./import-data.md)
+ Запуск собственного кода глубокого обучения 


Машинное обучение Azure использует дистрибутив Python Anaconda, который включает множество стандартных служебных программ для обработки данных. Мы будем обновлять версию Anaconda автоматически. Текущая версия:
 -  Anaconda 4.5 + дистрибутив для Python 3,6 

Предварительно установленные пакеты:
-    ADAL = = 1.2.2
-    applicationinsights = = 0.11.9
-    attr = = 19.3.0
-    Azure-Common = = 1.1.25
-    Azure-Core = = 1.3.0
-    Azure-графрбак = = 0.61.1
-    Azure-Identity = = 1.3.0
-    Azure-управление-авторизация = = 0.60.0
-    Azure-управление-containerregistry = = 2.8.0
-    Azure-управление-keyvault = = 2.2.0
-    Azure-управление-ресурс = = 8.0.1
-    Azure-управление-хранилище = = 8.0.0
-    Azure-Storage-BLOB = = 1.5.0
-    Azure-Storage — Common = = 1.4.2
-    azureml-Core = = 1.1.5.5
-    azureml-onподготовительная — Native = = 14.1.0
-    azureml-"Подготовка к вы1.3.5У"
-    azureml — значения по умолчанию = = 1.1.5.1
-    azureml-Designer-Classic-modules = = 0.0.118
-    azureml-Designer-Core = = 0.0.31
-    azureml-Designer-Internal = = 0.0.18
-    azureml-Model-Management-SDK = = 1.0.1 B6. post1
-    azureml-конвейер-Core = = 1.1.5
-    azureml-телеметрии = = 1.1.5.3
-    однопортные. темпфиле = = 1.0
-    однопортные. WeakRef = = 1.0. post1
-    boto3 = = 1.12.29
-    ботокоре = = 1.15.29
-    качетулс = = 4.0.0
-    Сертификация = = 2019.11.28
-    кффи = = 1.12.3
-    чардет = = 3.0.4
-    щелчок = = 7.1.1
-    клаудпиккле = = 1.3.0
-    конфигпарсер = = 3.7.4
-    contextlib2 = = 0.6.0. post1
-    Шифрование = = 2.8
-    Cycle = = 0.10.0
-    детализировать подобные = = 0.3.1.1
-    дистрибутив = = 1.4.0
-    DOCKER = = 4.2.0
-    докутилс = = 0.15.2
-    dotnetcore2 = = 2.1.13
-    Flask = = 1.0.3
-    фусепи = = 3.0.1
-    женсим = = 3.8.1
-    Google-API-Core = = 1.16.0
-    Google-auth = = 1.12.0
-    Google-Cloud-Core = = 1.3.0
-    Google-Cloud-Storage = = 1.26.0
-    Google-reвозобновляет работу — носитель = = 0.5.0
-    гуглеапис-Common-идентификаторы = = 1.51.0
-    гуникорн = = 19.9.0
-    IDNA = = 2.9
-    дисбаланс — сведения = = 0.4.3
-    исодате = = 0.6.0
-    итсданжераус = = 1.1.0
-    жипнэй = = 0.4.3
-    Jinja2 = = 2.11.1
-    jmespath = = 0.9.5
-    жоблиб = = 0.14.0
-    JSON-Logging-корректировка = = 0,2
-    жсонпиккле = = 1.3
-    жсонсчема = = 3.0.1
-    кивисолвер = = 1.1.0
-    лиак-arff = = 2.4.0
-    lightgbm = = 2.2.3
-    маркупсафе = = 1.1.1
-    Matplotlib = = 3.1.3
-    more-итертулс = = 6.0.0
-    msal-Extensions = = 0.1.3
-    msal = = 1.1.0
-    мсрест = = 0.6.11
-    мсрестазуре = = 0.6.3
-    НДг-хттпсклиент = = 0.5.1
-    нимбусмл = = 1.6.1
-    NumPy = = 1.18.2
-    оауслиб = = 3.1.0
-    Pandas = = 0.25.3
-    пасспек = = 0.7.0
-    PIP = = 20.0.2
-    порталоккер = = 1.6.0
-    protobuf = = 3.11.3
-    pyarrow = = 0.16.0
-    pyasn1-modules = = 0.2.8
-    pyasn1 = = 0.4.8
-    пикпарсер = = 2,20
-    пикриптодомекс = = 3.7.3
-    пижвт = = 1.7.1
-    pyopenssl = = 19.1.0
-    пипарсинг = = 2.4.6
-    пирсистент = = 0.16.0
-    Python-датеутил = = 2.8.1
-    питз = = 2019.3
-    запросы — оауслиб = = 1.3.0
-    запросы = = 2.23.0
-    RSA = = 4.0
-    руамел. YAML = = 0.15.89
-    s3transfer = = 0.3.3
-    scikit — сведения = = 0.22.2
-    SciPy = = 1.4.1
-    секретстораже = = 3.1.2
-    setuptools = = 46.1.1. post20200323
-    шесть = = 1.14.0
-    Smart-Open = = 1.10.0
-    urllib3 = = 1.25.8
-    WebSocket-Client = = 0.57.0
-    веркзеуг = = 0.16.1
-    Wheel = = 0.34.2

 Чтобы установить другие пакеты, отсутствующие в списке предварительно установленных, например *scikit-Разное*, добавьте в скрипт следующий код: 

 ```python
import os
os.system(f"pip install scikit-misc")
```
> [!NOTE]
> Если конвейер содержит несколько модулей выполнения скриптов Python и требуются те же пакеты, которые отсутствуют в списке предварительно установленных, установите пакеты в каждом модуле соответственно. 

## <a name="upload-files"></a>Отправка файлов
**Скрипт Execute Python** поддерживает передачу файлов с помощью [пакета SDK для машинное обучение Azure Python](https://docs.microsoft.com/python/api/azureml-core/azureml.core.run%28class%29?view=azure-ml-py#upload-file-name--path-or-stream-).

В следующем примере показано, как передать файл изображения в модуль **выполнение скрипта Python** :

```Python

# The script MUST contain a function named azureml_main
# which is the entry point for this module.

# imports up here can be used to
import pandas as pd

# The entry point function must have two input arguments:
#   Param<dataframe1>: a pandas.DataFrame
#   Param<dataframe2>: a pandas.DataFrame
def azureml_main(dataframe1 = None, dataframe2 = None):

    # Execution logic goes here
    print(f'Input pandas.DataFrame #1: {dataframe1}')

    from matplotlib import pyplot as plt
    plt.plot([1, 2, 3, 4])
    plt.ylabel('some numbers')
    img_file = "line.png"
    plt.savefig(img_file)

    from azureml.core import Run
    run = Run.get_context(allow_offline=True)
    run.upload_file(f"graphics/{img_file}", img_file)

    # Return value must be of a sequence of pandas.DataFrame
    # E.g.
    #   -  Single return value: return dataframe1,
    #   -  Two return values: return dataframe1, dataframe2
    return dataframe1,
}
```

После завершения выполнения конвейера можно просмотреть изображение на правой панели модуля.

> [!div class="mx-imgBorder"]
> ![Отправлено — изображение](media/module/upload-image-in-python-script.png)

## <a name="how-to-configure-execute-python-script"></a>Настройка выполнения скрипта Python

Модуль **выполнение скрипта Python** содержит пример кода Python, который можно использовать в качестве отправной точки. Чтобы настроить модуль **выполнения скрипта Python** , укажите набор входных данных и код Python для выполнения в текстовом поле **скрипт Python** .

1. Добавьте модуль **выполнение скрипта Python** в конвейер.

2. Добавьте и подключитесь к наборам данных **dataSet1** из конструктора, которые вы хотите использовать для ввода. Сослаться на этот набор данных в скрипте Python как **DataFrame1**.

    Использование набора данных является необязательным, если требуется создать данные с помощью Python или использовать код Python для импорта данных непосредственно в модуль.

    Этот модуль поддерживает добавление второго набора данных в **DataSet2**. Сослаться на второй набор данных в скрипте Python как DataFrame2.

    Наборы данных, хранящиеся в Машинное обучение Azure, автоматически преобразуются в данные **Pandas** . frames при загрузке с помощью этого модуля.

    ![Выполнить входную карту Python](media/module/python-module.png)

4. Чтобы включить новые пакеты или код Python, добавьте сжатый ZIP-файл, содержащий эти настраиваемые ресурсы, в **пакет сценариев**. Вход в **пакет сценариев** должен быть ZIP-файлом, переданным в рабочую область в виде набора данных типа файлов. Набор данных можно загрузить на странице ресурсов « **наборы** данных», а затем перетащить модуль DataSet из списка **Мои наборы** , расположенного в левом дереве модулей на странице Создание конструктора. 

    Любой файл, содержащийся в загруженном ZIP-архиве, можно использовать во время выполнения конвейера. Если архив содержит структуру каталогов, структура сохраняется, но необходимо добавить в путь каталог с именем **src** .

5. В текстовом поле **скрипт Python** введите или вставьте допустимый скрипт Python.

    > [!NOTE]
    > Будьте внимательны при написании сценария и убедитесь в отсутствии синтаксических ошибок, таких как использование необъявленных объектов или неимпортированных модулей. Также обратите особое внимание на список предварительно установленных модулей. Чтобы импортировать модули, которых нет в списке, установите соответствующие пакеты в скрипте, например
    >  ``` Python
    > import os
    > os.system(f"pip install scikit-misc")
    > ```
    
    Текстовое поле **скрипта Python** предварительно заполнено некоторыми инструкциями в комментариях и примерами кода для доступа к данным и вывода данных. Этот код необходимо изменить или заменить. Обязательно следуйте соглашениям Python о отступах и регистре.

    + Скрипт должен содержать функцию с именем `azureml_main` в качестве точки входа для этого модуля.
    + Функция точки входа должна иметь два входных аргумента `Param<dataframe1>` : `Param<dataframe2>`и, даже если эти аргументы не используются в скрипте.
    + ZIP-файлы, подключенные к третьему порту ввода, являются распакованными и хранятся `.\Script Bundle`в каталоге, который также добавляется в `sys.path`Python. 

    Поэтому, если ZIP-файл содержит `mymodule.py`, импортируйте его `import mymodule`с помощью.

    + В конструктор можно вернуть два набора данных, которые должны быть последовательностью типа `pandas.DataFrame`. Вы можете создавать другие выходные данные в коде Python и записывать их непосредственно в службу хранилища Azure.

6. Отправьте конвейер или выберите модуль и нажмите кнопку **Выполнить выбранные** , чтобы выполнить только скрипт Python.

    Все данные и код загружаются в виртуальную машину и выполняются с помощью указанной среды Python.

## <a name="results"></a>Результаты

Результаты любых вычислений, выполняемых внедренным кодом Python, должны быть предоставлены как Pandas. Таблица данных, которая автоматически преобразуется в формат набора Машинное обучение Azure, чтобы можно было использовать результаты с другими модулями в конвейере.

Модуль возвращает два набора данных:  
  
+ **Набор данных Results 1**, определяемый первым возвращенным Pandas кадр данных в скрипте Python

+ **Result DataSet 2**, определяемый вторым возвращенным кадром данных Pandas в скрипте Python


## <a name="next-steps"></a>Дальнейшие действия

См. [набор модулей, доступных](module-reference.md) для машинное обучение Azure. 