---
title: 'Обнаружение аномалий на основе PCA: Справочник по модулям'
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать модуль обнаружения аномалий на основе PCA для создания модели обнаружения аномалий на основе анализа основных компонентов (PCA).
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 02/22/2020
ms.openlocfilehash: 0672b9769feae65c73a6f752a268968a7bad9e4b
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "79502988"
---
# <a name="pca-based-anomaly-detection"></a>Обнаружение аномалий на основе анализа первичных компонентов

В этой статье описывается, как использовать модуль **обнаружения аномалий на основе PCA** в машинное обучение Azure Designer (Предварительная версия) для создания модели обнаружения аномалий на основе анализа основных компонентов (PCA).

Этот модуль помогает создать модель в сценариях, где можно легко получить обучающие данные из одного класса, например допустимые транзакции, но при этом трудно получить достаточное количество выборок целевых аномалий. 

Например, для обнаружения мошеннических транзакций очень часто у вас недостаточно примеров мошенничества для обучения, но есть много примеров хороших транзакций. Модуль **обнаружения аномалий на основе PCA** решает проблему, анализируя доступные функции, чтобы определить, что представляет собой "нормальный" класс, и применить метрики расстояния для определения вариантов, представляющих аномалии. Это позволяет обучить модель с использованием существующих несбалансированных данных.

## <a name="more-about-principal-component-analysis"></a>Подробнее об анализе главных компонентов

*Анализ основных компонентов*, который часто сокращается до PCA, является установленным методом в машинном обучении. PCA часто используется в разведочном анализе данных, так как он позволяет выявить внутреннюю структуру данных и объясняет их дисперсию.

PCA выполняется путем анализа данных с несколькими переменными. Он выполняет поиск корреляции между переменными и определяет сочетание значений, которые лучше всего фиксируют различия результатов. Эти объединенные значения функций используются для создания более компактного пространства функций, называемого *основными компонентами*.

Для обнаружения аномалий анализируются все новые входные данные, и алгоритм обнаружения аномалий рассчитывает свою проекцию на основе собственных векторов, а также нормализованную ошибку реконструкции. Нормализованная ошибка используется в качестве оценки аномалии. Чем больше значение ошибки, тем больше аномалий в экземпляре.

Дополнительные сведения о работе PCA и о реализации обнаружения аномалий см. в следующих документах:

- [Случайный алгоритм для анализа основных компонентов](https://arxiv.org/abs/0809.2274). Рокхлин, Сзлан и Тижерт

- [Поиск структуры со случайностью: алгоритмы вероятностная для создания приблизительных декомпозиций матриц](http://users.cms.caltech.edu/~jtropp/papers/HMT11-Finding-Structure-SIREV.pdf) (Загрузка PDF). Халко, Мартинссон и тропп.

## <a name="how-to-configure-pca-anomaly-detection"></a>Настройка обнаружения аномалий PCA

1. Добавьте модуль **обнаружения аномалий на основе PCA** в конвейер в конструкторе. Этот модуль можно найти в категории **обнаружение аномалий** .

2. На правой панели модуля **обнаружения аномалий на основе PCA** установите флажок **режим обучения** и укажите, следует ли обучить модель с помощью определенного набора параметров, или используйте функцию очистки параметров, чтобы найти наилучшие параметры.

    - **Один параметр**: Выберите этот параметр, если вы умеете настраивать модель и предоставляете конкретный набор значений в качестве аргументов.

3. **Число компонентов, используемых в PCA**: укажите количество выходных компонентов или компонентов, которые требуется вывести.

    Решение о том, сколько компонентов следует включить, является важной частью экспериментов, использующих PCA. Общее руководство заключается в том, что не следует включать то же количество компонентов PCA, что и переменные. Вместо этого следует начать с меньшего числа компонентов и увеличить их до тех пор, пока не будет выполнено определенное условие.

    Наилучшие результаты получаются, когда количество выходных компонентов **меньше** числа доступных столбцов в наборе данных.

4. Укажите объем избыточной выборки для выполнения случайного обучения PCA. При проблемах обнаружения аномалий несбалансированные данные затрудняют применение стандартных методик PCA. Указав некоторый объем избыточной выборки, можно увеличить количество целевых экземпляров.

    Если указано значение 1, то избыточная выборка не выполняется. Если указать любое значение выше 1, то для обучения модели будут созданы дополнительные примеры.

    В зависимости от того, используется ли параметр "Очистка параметров", есть два варианта:

    - **Параметр избыточной выборки для случайного PCA**: введите одно целое число, представляющее отношение избыточной выборки к классу с обычным классом. (Доступно при использовании метода обучения с **одним параметром** ).

    > [!NOTE]
    > Невозможно просмотреть набор данных с перевыборкой. Дополнительные сведения о том, как избыточная выборка используется с PCA, см. в разделе [Технические примечания](#technical-notes).

5. **Включить входные функции означает нормализацию**: Выберите этот параметр, чтобы нормализовать все функции ввода в среднее значение, равное нулю. Обычно для PCA рекомендуется нормализация или масштабирование до нуля, так как целью PCA является максимально увеличить дисперсию между переменными.

     Этот параметр установлен по умолчанию. Снимите этот флажок, если значения уже нормализованы с помощью другого метода или масштаба.

6. Подключите обучающий набор данных с тегами и один из обучающих модулей:

    - Если для параметра **создать режим** обучения задано значение **один параметр**, используйте модуль " [обучение модели обнаружения аномалий](train-anomaly-detection-model.md) ".

7. Отправьте конвейер.

## <a name="results"></a>Результаты

По завершении обучения можно либо сохранить обученную модель, либо подключить ее к модулю [Оценка модели](score-model.md) для прогнозирования оценок аномалий.

Для оценки результатов модели обнаружения аномалий требуются некоторые дополнительные действия.

1. Убедитесь, что столбец оценки доступен в обоих наборах данных.

    Если вы попытаетесь оценить модель обнаружения аномалий и получите ошибку "нет столбца оценки в вычисляемом наборе данных для сравнения", это означает, что вы используете стандартный набор данных для оценки, который содержит столбец меток, но не имеет оценок вероятности. Необходимо выбрать набор данных, соответствующий выходным данным схемы для моделей обнаружения аномалий, которые включают в себя оцененные **метки** и столбец « **вероятности оценки** ».

2. Убедитесь, что столбцы меток помечены

    Иногда метаданные, связанные со столбцом меток, удаляются на графе конвейера. Если это происходит, то при использовании модуля " [Оценка модели](evaluate-model.md) " для сравнения результатов двух моделей обнаружения аномалий может возникнуть ошибка "отсутствует столбец меток в столбце с показателями" или "отсутствует столбец меток в вычисляемом наборе данных для сравнения".

    Эту ошибку можно избежать, добавив модуль [изменить метаданные](edit-metadata.md) перед модулем [Анализ модели](evaluate-model.md) . С помощью селектора столбцов выберите столбец класс, а затем в раскрывающемся списке **поля** выберите **Метка**.

3. Используйте [сценарий выполнения Python](execute-python-script.md) для настройки категорий столбцов меток как 1 (положительный, нормальный) и 0 (отрицательный, Аномальный).

    ````
    label_column_name = 'XXX'
    anomaly_label_category = YY
    dataframe1[label_column_name] = dataframe1[label_column_name].apply(lambda x: 0 if x == anomaly_label_category else 1)
    ````

    
## <a name="technical-notes"></a>Технические примечания

Этот алгоритм использует PCA для приблизительного подпространства, содержащего класс нормали. Подпространство состоит из основе собственных векторов, связанного с верхним еиженвалуес матрицы ковариации данных. Для каждого нового входа детектор аномалий сначала рассчитывает свою проекцию на основе собственных векторов, а затем вычислит нормализованную ошибку реконструкции. Эта ошибка является показателем аномалии. Чем выше эта ошибка, тем более аномальным является экземпляр. Дополнительные сведения о вычислении обычного пространства см. в разделе Википедии: [анализ основных компонентов](https://wikipedia.org/wiki/Principal_component_analysis) . 


## <a name="next-steps"></a>Дальнейшие шаги

См. [набор модулей, доступных](module-reference.md) для машинное обучение Azure. 

Список ошибок, характерных для модулей конструктора, см. [в разделе исключения и коды ошибок для конструктора (Предварительная версия)](designer-error-codes.md) .