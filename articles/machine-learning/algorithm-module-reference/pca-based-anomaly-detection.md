---
title: 'PCA-обнаружение аномалий на основе: Ссылка на модуль'
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать модуль обнаружения аномалий на основе PCA для создания модели обнаружения аномалий на основе основного анализа компонентов (PCA).
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: likebupt
ms.author: keli19
ms.date: 02/22/2020
ms.openlocfilehash: 0672b9769feae65c73a6f752a268968a7bad9e4b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79502988"
---
# <a name="pca-based-anomaly-detection"></a>Обнаружение аномалий на основе анализа главных компонентов

В этой статье описывается, как использовать модуль обнаружения **аномалий на основе PCA** в конструкторе машинного обучения Azure (предварительный просмотр) для создания модели обнаружения аномалий на основе основного анализа компонентов (PCA).

Этот модуль помогает построить модель в сценариях, где легко получить обучающие данные из одного класса, такие как действительные транзакции, но трудно получить достаточное количество образцов целевых аномалий. 

Например, для обнаружения мошеннических транзакций очень часто у вас недостаточно примеров мошенничества для обучения, но есть много примеров хороших транзакций. Модуль **обнаружения аномалий на основе PCA** решает проблему, анализируя доступные функции, чтобы определить, что представляет собой "нормальный" класс, и применяя показатели расстояния для выявления случаев, представляющих аномалии. Это позволяет тренировать модель с использованием существующих несбалансированных данных.

## <a name="more-about-principal-component-analysis"></a>Подробнее об анализе главных компонентов

*Основной компонентный анализ*, который часто сокращенно PCA, является установленным методом в машинном обучении. PCA часто используется в разведочном анализе данных, так как он позволяет выявить внутреннюю структуру данных и объясняет их дисперсию.

PCA выполняется путем анализа данных с несколькими переменными. Он выполняет поиск корреляции между переменными и определяет сочетание значений, которые лучше всего фиксируют различия результатов. Эти комбинированные значения функций используются для создания более компактного пространства функций, называемого *основными компонентами.*

Для обнаружения аномалий анализируется каждый новый вход, и алгоритм обнаружения аномалий вычисляет его проекцию на эйгенвевторы вместе с нормализованной ошибкой реконструкции. Нормализованная ошибка используется в качестве оценки аномалии. Чем больше значение ошибки, тем больше аномалий в экземпляре.

Для получения дополнительной информации о том, как работает PCA, и о реализации для обнаружения аномалий, см.

- [Рандомизированный алгоритм анализа основных компонентов.](https://arxiv.org/abs/0809.2274) Рохлин, Шлан и Тайгерт

- [Поиск структуры с случайностью: Вероятностные алгоритмы для построения приблизительного разложения матрицы](http://users.cms.caltech.edu/~jtropp/papers/HMT11-Finding-Structure-SIREV.pdf) (PDF скачать). Халко, Мартинссон и Тропп.

## <a name="how-to-configure-pca-anomaly-detection"></a>Как настроить обнаружение аномалий PCA

1. Добавьте модуль **обнаружения аномалий на основе PCA** в конвейер в проектировщике. Этот модуль можно найти в категории **обнаружения аномалий.**

2. В правой панели модуля **обнаружения аномалий на основе PCA** щелкните опцию **режима обучения** и укажите, хотите ли вы обучить модель с помощью определенного набора параметров, или использовать развертки параметров, чтобы найти лучшие параметры.

    - **Единый параметр**: Выберите этот параметр, если вы знаете, как настроить модель, и предоставить определенный набор значений в качестве аргументов.

3. **Количество компонентов для использования в PCA**: Укажите количество выходных объектов или компонентов, которые вычисляются.

    Решение о том, сколько компонентов включить является важной частью разработки эксперимента с использованием PCA. Общее руководство заключается в том, что не следует включать такое же количество компонентов PCA, как и переменные. Вместо этого следует начать с небольшого количества компонентов и увеличить их до тех пор, пока не будут выполнены некоторые критерии.

    Наилучшие результаты получены, когда количество выходных компонентов **меньше, чем** количество столбцов объектов, доступных в наборе данных.

4. Укажите количество перевыборки для выполнения рандомизированного обучения PCA. При проблемах обнаружения аномалий несбалансированные данные затрудняли применение стандартных методов PCA. Указывая некоторое количество проб, можно увеличить количество целевых экземпляров.

    Если указать 1, не выполняется перевыборка. Если указать какое-либо значение выше 1, создаются дополнительные образцы для использования в обучении модели.

    Есть два варианта, в зависимости от того, используете ли вы параметр развертки или нет:

    - **Параметр перевыборки для рандомизированного PCA**: Введите одно целое число, которое представляет собой соотношение перевыборки класса меньшинства по сравнению с обычным классом. (Доступно при использовании метода тренировки **единого параметра.)**

    > [!NOTE]
    > Невозможно просмотреть набор данных, выданный образцами. Для получения дополнительной информации о том, как используется oversampling с PCA, [см.](#technical-notes)

5. **Включить функцию ввода означает нормализацию:** Выберите эту опцию, чтобы нормализовать все входные объекты в среднем ноль. Нормализация или масштабирование до нуля, как правило, рекомендуется для PCA, потому что цель PCA заключается в максимизации дисперсии между переменными.

     Этот параметр выбран по умолчанию. Отберите этот параметр, если значения уже нормализованы с использованием другого метода или масштаба.

6. Подключите помеченный набор обучаемых данных и один из учебных модулей:

    - При установке опции **режим аиф-тренера** Create для **single Parameter**используйте модуль модели [обнаружения аномалий поездной аномалии.](train-anomaly-detection-model.md)

7. Отправить конвейер.

## <a name="results"></a>Результаты

Когда обучение завершено, вы можете либо сохранить обученную модель, либо подключить ее к модулю [Модели оценки,](score-model.md) чтобы предсказать оценки аномалий.

Оценка результатов модели обнаружения аномалий требует некоторых дополнительных шагов:

1. Убедитесь, что столбец оценки доступен в обоих наборах данных

    Если вы попытаетесь оценить модель обнаружения аномалий и получить ошибку, "В наборе набранных данных нет столбца баллов для сравнения", это означает, что вы используете типичный набор данных оценки, содержащий столбец метки, но не оценивает вероятность. Необходимо выбрать набор данных, который соответствует выходу схемы для моделей обнаружения аномалий, который включает в себя столбец **«Забил»** и **«Забил вероятности».**

2. Убедитесь, что столбцы меток помечены

    Иногда метаданные, связанные с столбцом метки, удаляются в графике конвейера. Если это произойдет, при использовании модуля [«Оценка модели»](evaluate-model.md) для сравнения результатов двух моделей обнаружения аномалий может возникнуть ошибка: «В наборе данных нет столбца метки» или «В наборе набранных данных нет столбца метки для сравнения».

    Эту ошибку можно избежать, добавив модуль [Edit Metadata](edit-metadata.md) перед модулем [«Оценка модели».](evaluate-model.md) Используйте селектор столбца для выбора столбца класса, а в списке выпадающих **полей** выберите **метку.**

3. Используйте [сценарий Выполнения Python](execute-python-script.md) для настройки категорий столбцов метки как 1 (положительный, нормальный) и 0 (отрицательный, ненормальный).

    ````
    label_column_name = 'XXX'
    anomaly_label_category = YY
    dataframe1[label_column_name] = dataframe1[label_column_name].apply(lambda x: 0 if x == anomaly_label_category else 1)
    ````

    
## <a name="technical-notes"></a>Технические примечания

Этот алгоритм использует PCA для приблизительного подпространства, содержащего нормальный класс. Подпространство охватывается эйгенвевторами, связанными с верхними эйгенвалями матрицы ковариантности данных. Для каждого нового ввода детектор аномалий сначала вычисляет свою проекцию на эйгенвекторах, а затем вычисляет нормализованную ошибку реконструкции. Эта ошибка является аномалией оценка. Чем выше ошибка, тем аномальнее экземпляр. Подробнее о том, как вычисляется [Principal Component Analysis](https://wikipedia.org/wiki/Principal_component_analysis) нормальное пространство, см. 


## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь с [набором модулей, доступных](module-reference.md) для машинного обучения Azure. 

См [Исключения и коды ошибок для конструктора (предварительный просмотр)](designer-error-codes.md) для списка ошибок, характерных для модулей конструктора.