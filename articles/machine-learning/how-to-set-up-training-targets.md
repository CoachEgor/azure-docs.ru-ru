---
title: Использование целевых объектов вычислений для обучения моделей
titleSuffix: Azure Machine Learning
description: Настройте среды обучения (целевые объекты вычислений) для обучения моделей машинного обучения. Вы можете с легкостью переключаться между средами обучения. Начните обучение на локальном компьютере. Если вам потребуется горизонтально увеличить масштаб, переключитесь на облачный целевой объект вычислений.
services: machine-learning
author: sdgilley
ms.author: sgilley
ms.reviewer: sgilley
ms.service: machine-learning
ms.subservice: core
ms.topic: how-to
ms.date: 06/11/2020
ms.custom: seodec18, tracking-python
ms.openlocfilehash: 253d2c80f5a6ff96ba9249eddd127abb74f79a33
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85515811"
---
# <a name="set-up-and-use-compute-targets-for-model-training"></a>Настройка и использование целевых объектов вычислений для обучения моделей 
[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-basic-enterprise-sku.md)]

С помощью решения "Машинное обучение Azure" вы можете обучать модель, используя разные вычислительные ресурсы или среды, которые вместе называются [__целевыми объектами вычислений__](concept-azure-machine-learning-architecture.md#compute-targets). Они могут быть локальными или облачными. Например, это может быть Вычислительная среда Машинного обучения Azure, Azure HDInsight или удаленная виртуальная машина.  Можно также создать целевые объекты вычислений для развертывания моделей, как описано в статье [Развертывание моделей с помощью Службы машинного обучения Azure](how-to-deploy-and-where.md).

Для создания целевых объектов вычислений и управления ими можно использовать пакет SDK Студию машинного обучения Azure, Azure CLI или расширение VS Code для Машинного обучения Azure. Если у вас есть целевые объекты вычислений, созданные другой службой (например, кластером HDInsight), вы можете подключить их к своей рабочей области Машинного обучения Azure.
 
В этой статье вы узнаете об использовании разных целевых объектов вычисления для обучения моделей.  Шаги для всех вычислительных целей выполняются в том же рабочем процессе.
1. __Создание__ целевого объекта вычислений, если такого еще нет.
2. __Присоединение__ целевого объекта вычислений в рабочую область.
3. __Настройка__ целевого объекта вычислений так, чтобы он содержал необходимые сценарии зависимости среды и пакет Python.


>[!NOTE]
> Код в этой статье протестирован с помощью пакета SDK для Машинного обучения Azure версии 1.0.74.

## <a name="compute-targets-for-training"></a>Целевые объекты вычислений для обучения

Машинное обучение Azure по-разному поддерживает разные целевые объекты вычислений. Жизненный цикл разработки обычной модели начинается с разработки и экспериментов с небольшим объемом данных. На этом этапе мы рекомендуем использовать локальную среду. Например, ваш локальный компьютер или облачную виртуальную машину. По мере перехода к обучению на больших наборах данных или при выполнении распределенного обучения мы рекомендуем использовать Вычислительную среду Машинного обучения Azure, чтобы создать одно- или многоузловой кластер, который автоматически масштабируется при каждой отправке запроса на запуск. Можно также подключить собственный вычислительный ресурс, хотя не все сценарии могут поддерживаться. Подробнее об этом рассказывается ниже.

[!INCLUDE [aml-compute-target-train](../../includes/aml-compute-target-train.md)]


> [!NOTE]
> Машинное обучение Azure COMPUTE Clusters можно создать как постоянный ресурс или динамически создать при запросе запуска. Созданные при запуске целевые объекты вычислений будут удалены после завершения обучающего запуска, поэтому объекты вычислений, созданные таким способом, невозможно использовать повторно.

## <a name="whats-a-run-configuration"></a>Что являет собой конфигурация запуска?

При обучении этот учебный сценарий обычно запускают на локальном компьютере, а затем запускают в другом целевом объекте вычислений. Машинное обучение Azure позволяет запускать сценарий для различных целевых объектов вычислений без необходимости изменения сценария.

Вам нужно лишь определить среду для каждого целевого объекта вычислений с помощью **конфигурации запуска**.  Затем, если вы хотите запустить обучающий эксперимент на другом целевом объекте вычислений, укажите конфигурацию запуска для этого вычисления. Дополнительные сведения о том, как задать среду и привязать ее к конфигурации запуска см. в статье [Создание сред для обучения и развертывания и управление ими](how-to-use-environments.md).

Дополнительные сведения об [отправке экспериментов](#submit) см. в конце этой статьи.

## <a name="whats-an-estimator"></a>Что такое оценщик?

Чтобы облегчить обучение модели с использованием популярных платформ, в пакете SDK Машинного обучения Azure для Python предоставляется альтернативная высокоуровневая абстракция — класс оценщика.  Этот класс позволяет легко создавать конфигурации запуска. Вы можете создать и использовать универсальный [оценщик](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.estimator?view=azure-ml-py) для отправки сценариев обучения, использующих любую выбранную платформу обучения (например, scikit-learn). Мы рекомендуем использовать для обучения оценщик, так как он автоматически конструирует внедренные объекты, например среду или объекты RunConfiguration. Если вы хотите получить более полный контроль над созданием этих объектов и указать, какие пакеты следует установить для запуска эксперимента, выполните [эти шаги](#amlcompute), чтобы отправить обучающие эксперименты, используя объект RunConfiguration в Вычислительной среде Машинного обучения.

Машинное обучение Azure предоставляет специальные оценщики для [PyTorch](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.pytorch?view=azure-ml-py), [TensorFlow](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.tensorflow?view=azure-ml-py), [Chainer](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.chainer?view=azure-ml-py) и [Ray RLlib](how-to-use-reinforcement-learning.md).

Дополнительные сведения см. в статье [Обучение моделей Машинного обучения с использованием оценщиков](how-to-train-ml-models.md).

## <a name="whats-an-ml-pipeline"></a>Что такое конвейер Машинного обучения?

С помощью конвейеров Машинного обучения можно оптимизировать рабочий процесс. Конвейеры обеспечивают простоту, скорость, мобильность и возможность повторного использования. При создании конвейеров с помощью Машинного обучения Azure можно сосредоточиться на том, в чем вы являетесь специалистом, — машинном обучении, не отвлекаясь на инфраструктуру и автоматизацию.

Конвейеры Машинного обучения состоят из нескольких **шагов** , которые являются в них отдельными вычислительными единицами. Каждый шаг может выполняться независимо и использовать изолированные вычислительные ресурсы. Такой подход позволяет нескольким специалистам по обработке данных работать с одним и тем же конвейером без избыточного потребления вычислительных ресурсов, а также упрощает использование различных типов вычислений и размеров для каждого шага.

> [!TIP]
> При обучении моделей конвейеры Машинного обучения могут использовать конфигурацию запуска или оценщики.

Хотя конвейеры Машинного обучения могут обучать модели, они также могут подготавливать данные перед обучением и развертывать модели после его завершения. Одним из основных вариантов использования конвейеров является пакетная оценка. Дополнительные сведения см. в статье [Конвейеры: оптимизация рабочих процессов машинного обучения](concept-ml-pipelines.md).

## <a name="set-up-in-python"></a>Настройка в Python

Чтобы настроить эти целевые объекты вычислений, используйте следующие разделы.

* [Локальный компьютер](#local)
* [Вычислительный кластер Машинного обучения Azure](#amlcompute)
* [Вычислительная операция Машинного обучения Azure](#instance)
* [Удаленные виртуальные машины](#vm)
* [Azure HDInsight](#hdinsight)


### <a name="local-computer"></a><a id="local"></a>Локальный компьютер

1. **Создание и присоединение**. Нет необходимости создавать или присоединять целевой объект вычислений, чтобы использовать локальный компьютер в качестве среды обучения.  

1. **Настройка**.  При использовании локального компьютера в качестве целевого объекта вычислений обучающий код запускается в вашей [среде разработки](how-to-configure-environment.md).  Если эта среда уже содержит пакеты Python, необходимо использовать среду, управляемую пользователем.

 [!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/local.py?name=run_local)]

Теперь, после подключения вычислительной среды и настройки запуска, следующий шаг — [отправить запрос на запуск обучения](#submit).

### <a name="azure-machine-learning-compute-cluster"></a><a id="amlcompute"></a>Кластер Машинное обучение Azure COMPUTE

Кластер Машинное обучение Azure COMPUTE — это управляемая инфраструктура вычислений, которая позволяет легко создавать одно или несколько вычислений. Она создается в регионе вашей рабочей области и является ресурсом, который можно использовать совместно с другими пользователями в этой рабочей области. Вычислительная среда автоматически масштабируется при отправке задания, а также может быть размещена в виртуальной сети Azure. Она выполняется в контейнерной среде, упаковывая зависимости вашей модели в [контейнер Docker](https://www.docker.com/why-docker).

Вычислительную среду Машинного обучения Azure можно использовать для распространения процесса обучения в кластере вычислительных узлов на основе ЦП или GPU, размещенном в облаке. Дополнительные сведения о размерах виртуальных машин, которые содержат GPU, см. в статье [Размеры виртуальных машин, оптимизированных для GPU](https://docs.microsoft.com/azure/virtual-machines/linux/sizes-gpu). 

Вычислительная среда Машинного обучения Azure имеет ограничения по умолчанию, такие как количество ядер, которые могут быть выделены. Дополнительные сведения см. в статье [Управление квотами для ресурсов Azure и их запрашивание](https://docs.microsoft.com/azure/machine-learning/how-to-manage-quotas).

Вы можете также использовать виртуальные машины с низким приоритетом для выполнения части или всех рабочих нагрузок. Эти виртуальные машины не обеспечены гарантиями доступности и могут быть замещены при использовании. Замещенное задание перезапускается, а не возобновляется.  Тарифы на виртуальные машины с низким приоритетом ниже по сравнению с обычными виртуальными машинами. Ознакомьтесь с разделом [Планирование затрат и управление ими](https://docs.microsoft.com/azure/machine-learning/concept-plan-manage-cost).

> [!TIP]
> Кластеры обычно масштабируются до 100 узлов при наличии достаточной квоты для требуемого числа ядер. По умолчанию кластеры настроены с поддержкой взаимодействия между их узлами, например для поддержки заданий MPI. Однако вы можете масштабировать кластеры до тысяч узлов. Для этого просто [отправьте запрос в службу поддержки](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest) и попросите добавить свою подписку, рабочую область или конкретный кластер в список разрешений для отключения взаимодействия между узлами. 

Вычислительную среду Машинного обучения Azure можно многократно использовать при различных запусках. Результаты вычислений могут использоваться совместно с другими пользователями в рабочей области. Они сохраняются для последующих запусков, а число узлов в них автоматически масштабируется в зависимости от числа отправленных запросов на запуск и заданного для кластера значения max_nodes. С помощью параметра min_nodes можно контролировать минимально доступное количество узлов.

[!INCLUDE [min-nodes-note](../../includes/machine-learning-min-nodes.md)]

1. **Создание и присоединение**. Чтобы создать постоянный ресурс Вычислительной среды машинного обучения Azure в Python, необходимо указать свойства **vm_size** и **max_nodes**. Затем Машинное обучение Azure использует интеллектуальные значения по умолчанию для остальных свойств. Когда вычислительная среда не используется, она автоматически масштабируется до нуля узлов.   Выделенные виртуальные машины создаются для выполнения заданий по мере необходимости.
    
    * **vm_size**. Семейство виртуальных машин узлов, создаваемых Вычислительной средой Машинного обучения Azure.
    * **max_nodes**. Максимальное количество узлов для автомасштабирования при запуске задания в Вычислительной среде Машинного обучения Azure.
    
   [!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/amlcompute2.py?name=cpu_cluster)]

   При создании Вычислительной среды машинного обучения Azure вы можете также настроить несколько дополнительных свойств. Эти свойства позволяют создать постоянный кластер фиксированного размера, который может размещаться в существующей виртуальной сети Azure в вашей подписке.  Дополнительные сведения см. в разделе о [классе AmlCompute](https://docs.microsoft.com/python/api/azureml-core/azureml.core.compute.amlcompute.amlcompute?view=azure-ml-py
    ).
    
   Или вы можете создать и присоединить постоянный ресурс Вычислительной среды Машинного обучения в [Студии машинного обучения Azure](#portal-create).

1. **Настройка**. Создайте конфигурацию запуска для постоянного целевого объекта вычислений.

   [!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/amlcompute2.py?name=run_amlcompute)]

Теперь, после подключения вычислительной среды и настройки запуска, следующий шаг — [отправить запрос на запуск обучения](#submit).


### <a name="azure-machine-learning-compute-instance"></a><a id="instance"></a>Вычислительная операция Машинного обучения Azure

[Машинное обучение Azure вычислительный экземпляр](concept-compute-instance.md) — это управляемая вычислительная инфраструктура, которая позволяет легко создавать одну виртуальную машину. Вычислительные ресурсы создаются в регионе рабочей области, но в отличие от вычислительного кластера, экземпляр нельзя использовать совместно с другими пользователями в рабочей области. Кроме того, экземпляр не масштабируется автоматически.  Необходимо закрыть ресурс, чтобы предотвратить постоянную плату.

Вычислительный экземпляр может параллельно запускать несколько заданий и иметь очередь заданий. 

Экземпляры вычислений могут безопасно выполнять задания в [среде виртуальной сети](how-to-enable-virtual-network.md#compute-instance), не требуя, чтобы предприятия открывали порты SSH. Задание выполняется в контейнерной среде и упаковывает зависимости модели в контейнер DOCKER. 

1. **Создание и присоединение**. 
    
    [! Notebook-Python [] (~/Мачинелеарнингнотебукс/хов-то-усе-азуремл/Траининг/траин-он-компутеинстанце/траин-он-компутеинстанце.ипинб? Name = create_instance)]

1. **Настройка**: создание конфигурации запуска.
    
    ```python
    
    from azureml.core import ScriptRunConfig
    from azureml.core.runconfig import DEFAULT_CPU_IMAGE
    
    src = ScriptRunConfig(source_directory='', script='train.py')
    
    # Set compute target to the one created in previous step
    src.run_config.target = instance
    
    # Set environment
    src.run_config.environment = myenv
     
    run = experiment.submit(config=src)
    ```

Дополнительные команды, полезные для вычислительных экземпляров, см. в разделе Записная книжка Training [-On-компутеинстанце](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/training/train-on-computeinstance/train-on-computeinstance.ipynb). Эта записная книжка также доступна в папке **Samples** в студии *обучения/обучения-on-компутеинстанце*.

Теперь, когда вы присоединяете вычисление и настроили выполнение, следующим шагом является [Отправка обучающего запуска](#submit) .


### <a name="remote-virtual-machines"></a><a id="vm"></a>Удаленные виртуальные машины

Машинное обучение Azure также поддерживает использование собственных вычислительных ресурсов и подключение их к рабочей области. К такому типу ресурсов относится произвольная удаленная виртуальная машина, если она доступна из Машинного обучения Azure. Ресурсом может быть виртуальная машина Azure, удаленный или локальный сервер в вашей организации. В частности, указав IP-адрес и учетные данные (имя пользователя и пароль или ключ SSH), можно использовать любую доступную виртуальную машину для удаленного запуска.

Можно использовать системную среду Conda, существующую среду Python или контейнер Docker. Для выполнения контейнера Docker на виртуальной машине должен быть запущен модуль Docker. Эта функция особенно удобна в случаях, когда необходима более гибкая облачная среда разработки и проведения экспериментов, чем локальный компьютер.

Используйте виртуальную машину Azure для обработки и анализа данных (DSVM) в качестве выбранной виртуальной машины Azure для этого сценария. Эта виртуальная машина является предварительно настроенной обработкой и анализом данных и средой разработки искусственного интеллекта в Azure. Виртуальная машина предлагает выбор средств и платформ для разработки машинного обучения в течение всего жизненного цикла. Дополнительных сведения об использовании DSVM со Службой машинного обучения Azure см. в статье [Настройка среды разработки для Машинного обучения Azure](https://docs.microsoft.com/azure/machine-learning/how-to-configure-environment#dsvm).

1. **Создание**. Создайте DSVM перед ее использованием для обучения модели. Подробные сведения о создании этого ресурса см. в разделе [Подготовка виртуальной машины Linux (Ubuntu) для обработки и анализа данных](https://docs.microsoft.com/azure/machine-learning/data-science-virtual-machine/dsvm-ubuntu-intro).

    > [!WARNING]
    > Машинное обучение Azure поддерживает только виртуальные машины под управлением **Ubuntu**. Поэтому создаваемая виртуальная или существующая виртуальная машина, которую вы выбираете, должна работать под управлением Ubuntu.
    > 
    > Для Машинное обучение Azure также требуется, чтобы виртуальная машина соимела __общедоступный IP-адрес__.

1. **Присоединение**. Чтобы присоединить имеющуюся виртуальную машину как целевой объект вычислений, необходимо указать для нее ИД ресурса, имя входа и пароль. Идентификатор ресурса виртуальной машины можно создать с помощью идентификатора подписки, имени группы ресурсов и имени виртуальной машины, используя следующий строковый формат: `/subscriptions/<subscription_id>/resourceGroups/<resource_group>/providers/Microsoft.Compute/virtualMachines/<vm_name>`

 
   ```python
   from azureml.core.compute import RemoteCompute, ComputeTarget

   # Create the compute config 
   compute_target_name = "attach-dsvm"
   
   attach_config = RemoteCompute.attach_configuration(resource_id='<resource_id>',
                                                   ssh_port=22,
                                                   username='<username>',
                                                   password="<password>")

   # Attach the compute
   compute = ComputeTarget.attach(ws, compute_target_name, attach_config)

   compute.wait_for_completion(show_output=True)
   ```

   Кроме того, можно присоединить DSVM к рабочей области, [используя Студию машинного обучения Azure](#portal-reuse).

1. **Настройка**. Создайте конфигурацию запуска для целевого объекта вычислений DSVM. Для создания и настройки среды обучения на DSVM используются Docker и Conda.

   [!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/dsvm.py?name=run_dsvm)]


Теперь, после подключения вычислительной среды и настройки запуска, следующий шаг — [отправить запрос на запуск обучения](#submit).

### <a name="azure-hdinsight"></a><a id="hdinsight"></a>Azure HDInsight 

Azure HDInsight — это популярная платформа для анализа больших данных. Она предоставляет Apache Spark, который можно использовать для обучения модели.

1. **Создание**.  Прежде чем использовать кластер HDInsight для обучения модели, создайте его. Инструкции по созданию Spark в кластере HDInsight см. в статье [Краткое руководство. Создание кластера Apache Spark в HDInsight с помощью шаблона](https://docs.microsoft.com/azure/hdinsight/spark/apache-spark-jupyter-spark-sql). 

    > [!WARNING]
    > Для Машинное обучение Azure требуется, чтобы кластер HDInsight имел __общедоступный IP-адрес__.

    При создании кластера необходимо указать имя пользователя SSH и пароль. Запишите эти значения — они вам потребуются при использовании HDInsight в качестве целевого объекта вычислений.
    
    После создания кластера подключитесь к нему с помощью имени узла \<clustername> -SSH.azurehdinsight.NET, где \<clustername> — это имя, указанное для кластера. 

1. **Присоединение**. Чтобы присоединить кластер HDInsight в качестве целевого объекта вычислений, необходимо указать ИД ресурса, имя пользователя и пароль для кластера HDInsight. Идентификатор ресурса кластера HDInsight можно создать с помощью идентификатора подписки, имени группы ресурсов и имени кластера HDInsight, используя следующий строковый формат: `/subscriptions/<subscription_id>/resourceGroups/<resource_group>/providers/Microsoft.HDInsight/clusters/<cluster_name>`

    ```python
   from azureml.core.compute import ComputeTarget, HDInsightCompute
   from azureml.exceptions import ComputeTargetException

   try:
    # if you want to connect using SSH key instead of username/password you can provide parameters private_key_file and private_key_passphrase

    attach_config = HDInsightCompute.attach_configuration(resource_id='<resource_id>',
                                                          ssh_port=22, 
                                                          username='<ssh-username>', 
                                                          password='<ssh-pwd>')
    hdi_compute = ComputeTarget.attach(workspace=ws, 
                                       name='myhdi', 
                                       attach_configuration=attach_config)

   except ComputeTargetException as e:
    print("Caught = {}".format(e.message))

   hdi_compute.wait_for_completion(show_output=True)
   ```

   Кроме того, можно присоединить кластер HDInsight к рабочей области, [используя Студию машинного обучения Azure](#portal-reuse).

1. **Настройка**. Создайте конфигурацию запуска для целевого объекта вычислений HDI. 

   [!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/hdi.py?name=run_hdi)]


Теперь, после подключения вычислительной среды и настройки запуска, следующий шаг — [отправить запрос на запуск обучения](#submit).


### <a name="azure-batch"></a><a id="azbatch"></a>Пакетная служба Azure 

Пакетная служба Azure используется для эффективного запуска приложений для крупномасштабных параллельных и высокопроизводительных вычислений (HPC) в облаке. В конвейере Машинного обучения Azure для отправки заданий в пул виртуальных машин пакетной службы Azure можно использовать AzureBatchStep.

Чтобы присоединить пакетную службу Azure в качестве целевого объекта вычислений, используйте пакет SDK Машинного обучения Azure и укажите следующие сведения.

-    **Azure Batch compute name** (Имя пакетного вычисления пакетной службы Azure). Понятное имя, используемое для вычислений в рабочей области.
-    **Имя учетной записи для пакетной службы Azure**. Имя учетной записи пакетной службы Azure.
-    **Группа ресурсов**. Группа ресурсов, в которой содержится учетная запись пакетной службы Azure.

Следующий код демонстрирует, как присоединить пакетную службу в качестве целевого объекта вычислений.

```python
from azureml.core.compute import ComputeTarget, BatchCompute
from azureml.exceptions import ComputeTargetException

# Name to associate with new compute in workspace
batch_compute_name = 'mybatchcompute'

# Batch account details needed to attach as compute to workspace
batch_account_name = "<batch_account_name>"  # Name of the Batch account
# Name of the resource group which contains this account
batch_resource_group = "<batch_resource_group>"

try:
    # check if the compute is already attached
    batch_compute = BatchCompute(ws, batch_compute_name)
except ComputeTargetException:
    print('Attaching Batch compute...')
    provisioning_config = BatchCompute.attach_configuration(
        resource_group=batch_resource_group, account_name=batch_account_name)
    batch_compute = ComputeTarget.attach(
        ws, batch_compute_name, provisioning_config)
    batch_compute.wait_for_completion()
    print("Provisioning state:{}".format(batch_compute.provisioning_state))
    print("Provisioning errors:{}".format(batch_compute.provisioning_errors))

print("Using Batch compute:{}".format(batch_compute.cluster_resource_id))
```

## <a name="set-up-in-azure-machine-learning-studio"></a>Настройка в Студии машинного обучения Azure

Вы можете получить доступ к целевым объектам вычислений, связанным с вашей рабочей областью, в Студии машинного обучения Azure.  С помощью Студии можно выполнять следующие задачи.

* [Просмотр целевых объектов вычислений](#portal-view), которые присоединены к рабочей области.
* [Создание целевого объекта вычислений](#portal-create) в рабочей области.
* [Присоединение целевого объекта вычислений](#portal-reuse), созданного за пределами рабочей области


После того как целевой объект будет создан и присоединен к рабочему пространству, вы будете использовать его в конфигурации запуска с объектом `ComputeTarget`. 

```python
from azureml.core.compute import ComputeTarget
myvm = ComputeTarget(workspace=ws, name='my-vm-name')
```

### <a name="view-compute-targets"></a><a id="portal-view"></a>Просмотр целевых объектов вычислений


Чтобы просмотреть целевые объекты вычислений для своей рабочей области, сделайте следующее:

1. Перейдите в [Студию машинного обучения Azure](https://ml.azure.com).
 
1. В разделе __Приложения__ выберите __Вычисления__.

    [![Просмотр вкладки вычислений](./media/how-to-set-up-training-targets/azure-machine-learning-service-workspace.png)](./media/how-to-set-up-training-targets/azure-machine-learning-service-workspace-expanded.png)

### <a name="create-a-compute-target"></a><a id="portal-create"></a>Создание целевого объекта вычислений

Выполните указанные выше шаги, чтобы просмотреть список целевых объектов вычислений. Затем выполните следующие действия, чтобы создать целевой объект вычислений. 

1. Щелкните значок плюса (+), чтобы добавить целевой объект вычислений.

    ![Добавление целевого объекта вычислений](./media/how-to-set-up-training-targets/add-compute-target.png) 

1. Введите имя для целевого объекта вычислений. 

1. Выберите **Вычислительная среда Машинного обучения** в качестве типа вычислительной среды для среды __обучения__. 

    >[!NOTE]
    >Вычислительная среда Машинного обучения Azure — это единственный ресурс управляемых вычислений, который вы можете создать в Студии машинного обучения Azure.  После создания все вычислительные ресурсы можно присоединить.

1. Заполните форму. Введите значения для обязательных свойств, в частности, укажите **семейство виртуальных машин** и **максимальное количество узлов**, до которого можно развернуть вычислительный объект.  

1. Нажмите кнопку __создания__.


1. Чтобы увидеть состояние операции создания, выберите целевой объект вычислений из списка.

    ![Выбор целевого объекта вычислений, чтобы просмотреть состояние операции создания](./media/how-to-set-up-training-targets/View_list.png)

1. Ниже приведены сведения о выбранном целевом объекте вычислений. 

    ![Просмотр сведений о целевом объекте вычислений](./media/how-to-set-up-training-targets/compute-target-details.png) 

### <a name="attach-compute-targets"></a><a id="portal-reuse"></a>Присоединение целевых объектов вычислений

Чтобы использовать целевые объекты вычислений, созданные за пределами рабочей области Машинного обучения Azure, необходимо их присоединить. Присоединение целевого объекта вычислений сделает его доступным для рабочей области.

Выполните описанные ранее шаги, чтобы просмотреть список целевых объектов вычислений. Выполните следующие действия, чтобы присоединить целевой объект вычислений. 

1. Щелкните значок плюса (+), чтобы добавить целевой объект вычислений. 
1. Введите имя для целевого объекта вычислений. 
1. Выберите тип вычислительной среды, который нужно подключить для __обучения__.

    > [!IMPORTANT]
    > Не все типы вычислительных сред можно присоединить из Студии машинного обучения Azure. Типы вычислительных сред, которые в настоящее время можно подключить для обучения:
    >
    > * Удаленная виртуальная машина.
    > * Azure Databricks (для использования в конвейерах машинного обучения).
    > * Azure Data Lake Analytics (для использования в конвейерах машинного обучения).
    > * Azure HDInsight

1. Заполните форму и укажите значения для обязательных свойств.

    > [!NOTE]
    > Корпорация Майкрософт рекомендует использовать ключи SSH, так как они безопаснее, чем пароли. Пароли подвержены атакам методом подбора. Ключи SSH задействуют криптографические подписи. Сведения о создании ключей SSH для использования на Виртуальных машинах Azure см. в следующих документах:
    >
    > * [Создание и использование ключей SSH в Linux или macOS](https://docs.microsoft.com/azure/virtual-machines/linux/mac-create-ssh-keys)
    > * [Создание и использование ключей SSH в Windows](https://docs.microsoft.com/azure/virtual-machines/linux/ssh-from-windows)

1. Выберите __Подключить__. 
1. Чтобы просмотреть состояние операции подключения, выберите целевой объект вычислений из списка.

## <a name="set-up-with-cli"></a>Настройка с помощью интерфейса командной строки

Чтобы получить доступ к целевым объектам вычислений, которые связаны с вашей рабочей областью, используйте [расширение CLI](reference-azure-machine-learning-cli.md) для Машинного обучения Azure.  Вы можете использовать Azure CLI для таких целей.

* Создание управляемого целевого объекта вычислений.
* Обновление управляемого целевого объекта вычислений.
* Присоединение управляемого целевого объекта вычислений.

Дополнительные сведения см. в разделе [Управление ресурсами](reference-azure-machine-learning-cli.md#resource-management).

## <a name="set-up-with-vs-code"></a>Настройка с помощью VS Code

Чтобы получить доступ к целевым объектам вычислений, которые связаны с вашей рабочей областью, а также создать их и управлять ими, можно использовать [расширение VS Code](tutorial-train-deploy-image-classification-model-vscode.md#configure-compute-targets) для Машинного обучения Azure.

## <a name="submit-training-run-using-azure-machine-learning-sdk"></a><a id="submit"></a>Отправка запроса на запуск выполнения обучения с помощью пакета SDK для Машинного обучения Azure

После создания конфигурации запуска, используйте ее для выполнения эксперимента.  Шаблон кода для отправки запуска на выполнение обучения одинаковый для всех типов целевых объектов вычислений.

1. Создание эксперимента для запуска
1. Выполните прогон.
1. Дождитесь завершения прогона.

> [!IMPORTANT]
> При отправке запроса на запуск выполнения обучения создается моментальный снимок каталога, содержащего сценарии обучения, и отправляется на целевой объект вычислений. Он также хранится в составе эксперимента в рабочей области. Если изменить файлы и отправить запрос на запуск выполнения снова, будут переданы только измененные файлы.
>
> [!INCLUDE [amlinclude-info](../../includes/machine-learning-amlignore-gitignore.md)]
> 
> Дополнительные сведения см. в разделе о [моментальных снимках](concept-azure-machine-learning-architecture.md#snapshots).

### <a name="create-an-experiment"></a>Создание эксперимента

Сначала создайте эксперимент в рабочей области.

[!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/local.py?name=experiment)]

### <a name="submit-the-experiment"></a>Отправка эксперимента

Отправка эксперимента с помощью объекта `ScriptRunConfig`.  Этот объект включает в себя следующее.

* **source_directory**: исходный каталог, который содержит сценарий обучения.
* **script**: определение сценария обучения.
* **run_config**: конфигурация запуска, которая, в свою очередь, определяет, где будет проходить обучение.

Например, чтобы использовать [локальную конфигурацию](#local) целевого объекта, выполните следующее.

[!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/local.py?name=local_submit)]

Переключите тот же эксперимент для запуска в другом целевом объекте вычислений, используя другую конфигурацию запуска, такую ​​как [amlcompute target](#amlcompute).

[!code-python[](~/aml-sdk-samples/ignore/doc-qa/how-to-set-up-training-targets/amlcompute2.py?name=amlcompute_submit)]

> [!TIP]
> В этом примере для обучения по умолчанию используется только один узел целевого объекта вычислений. Чтобы использовать несколько узлов, задайте в качестве значения `node_count` конфигурации запуска их число. Например, следующий код задает в качестве количества узлов, используемых для обучения, число четыре.
>
> ```python
> src.run_config.node_count = 4
> ```

Также вы можете:

* отправить эксперимент с объектом `Estimator`, как показано в разделе [Обучение моделей машинного обучения с использованием средства оценки](how-to-train-ml-models.md);
* Отправьте запрос на запуск HyperDrive для [настройки гиперпараметров](how-to-tune-hyperparameters.md).
* Отправьте эксперимент с помощью расширения [VS Code](tutorial-train-deploy-image-classification-model-vscode.md#train-the-model).

Дополнительные сведения см. в документации по [ScriptRunConfig](https://docs.microsoft.com/python/api/azureml-core/azureml.core.scriptrunconfig?view=azure-ml-py) и [RunConfiguration](https://docs.microsoft.com/python/api/azureml-core/azureml.core.runconfiguration?view=azure-ml-py).

## <a name="create-run-configuration-and-submit-run-using-azure-machine-learning-cli"></a>Создание конфигурации запуска и отправка запроса на запуск выполнения с помощью CLI Машинного обучения Azure

[Azure CLI](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest) и [расширение CLI Машинного обучения](reference-azure-machine-learning-cli.md) можно использовать для создания конфигураций запуска и отправки запросов на запуск для различных целевых объектов вычислений. В следующих примерах предполагается, что у вас уже есть рабочая область машинного обучения Azure и вы вошли в Azure с помощью команды `az login` интерфейса командной строки. 

[!INCLUDE [select-subscription](../../includes/machine-learning-cli-subscription.md)] 

### <a name="create-run-configuration"></a>Создание конфигурации запуска

Самый простой способ создать конфигурацию запуска — перейти к папке, содержащей скрипты Python машинного обучения, и воспользоваться командой CLI.

```azurecli
az ml folder attach
```

Эта команда создает вложенную папку `.azureml`, содержащую файлы шаблонов конфигурации запуска для различных целевых объектов вычислений. Вы можете скопировать и изменить эти файлы, чтобы настроить конфигурацию, например добавить пакеты Python или изменить параметры Docker.  

### <a name="structure-of-run-configuration-file"></a>Структура файла конфигурации запуска

Для файла конфигурации запуска используется формат YAML со следующими разделами:
 * выполняемый скрипт и его аргументы;
 * имя целевого объекта вычислений: local или имя вычисления в рабочей области;
 * параметры для выполнения запуска: платформа, коммуникатор для распределенных запусков, максимальная длительность и количество вычислительных узлов;
 * раздел "Среда" (дополнительные сведения о полях в этом разделе см. в статье [Создание сред для обучения и развертывания и управление ими](how-to-use-environments.md));
   * Чтобы указать пакеты Python, которые нужно установить для запуска, создайте [файл среды conda](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#create-env-file-manually) и задайте значение поля __condaDependenciesFile__.
 * сведения журнала выполнения, позволяющие указать папку файла журнала, а также включить или отключить сбор выходных данных и моментальные снимки журнала выполнения;
 * сведения о конфигурации, касающиеся выбранной платформы;
 * сведения о ссылках на данные и хранилище данных;
 * сведения о конфигурации, касающиеся Вычислительной среды Машинного обучения и необходимые для создания нового кластера.

Полную схему runconfig см. в примере [JSON-файла](https://github.com/microsoft/MLOps/blob/b4bdcf8c369d188e83f40be8b748b49821f71cf2/infra-as-code/runconfigschema.json).

### <a name="create-an-experiment"></a>Создание эксперимента

Сначала создайте эксперимент для запусков.

```azurecli
az ml experiment create -n <experiment>
```

### <a name="script-run"></a>Запуск скрипта

Чтобы отправить запрос на запуск скрипта, воспользуйтесь следующей командой.

```azurecli
az ml run submit-script -e <experiment> -c <runconfig> my_train.py
```

### <a name="hyperdrive-run"></a>Запуск HyperDrive

Используя HyperDrive с Azure CLI, можно запускать выполнение для настройки параметров. Сначала создайте файл конфигурации HyperDrive в следующем формате. Дополнительные сведения о параметрах настройки гиперпараметров см. в статье [Настройка гиперпараметров модели](how-to-tune-hyperparameters.md).

```yml
# hdconfig.yml
sampling: 
    type: random # Supported options: Random, Grid, Bayesian
    parameter_space: # specify a name|expression|values tuple for each parameter.
    - name: --penalty # The name of a script parameter to generate values for.
      expression: choice # supported options: choice, randint, uniform, quniform, loguniform, qloguniform, normal, qnormal, lognormal, qlognormal
      values: [0.5, 1, 1.5] # The list of values, the number of values is dependent on the expression specified.
policy: 
    type: BanditPolicy # Supported options: BanditPolicy, MedianStoppingPolicy, TruncationSelectionPolicy, NoTerminationPolicy
    evaluation_interval: 1 # Policy properties are policy specific. See the above link for policy specific parameter details.
    slack_factor: 0.2
primary_metric_name: Accuracy # The metric used when evaluating the policy
primary_metric_goal: Maximize # Maximize|Minimize
max_total_runs: 8 # The maximum number of runs to generate
max_concurrent_runs: 2 # The number of runs that can run concurrently.
max_duration_minutes: 100 # The maximum length of time to run the experiment before cancelling.
```

Добавьте этот файл вместе с файлами конфигурации запуска. Затем отправьте запрос на запуск HyperDrive с помощью следующей команды.
```azurecli
az ml run submit-hyperdrive -e <experiment> -c <runconfig> --hyperdrive-configuration-name <hdconfig> my_train.py
```

Запишите данные раздела *arguments* в схеме runconfig и *пространство параметров* в файле конфигурации HyperDrive. Они содержат аргументы командной строки, передаваемые в скрипт обучения. Значение в схеме runconfig остается неизменным для каждой итерации, в то время как диапазон в файле конфигурации HyperDrive меняется. Не указывайте один и тот же аргумент в обоих файлах.

Дополнительные сведения по этим командам интерфейса командной строки ```az ml``` см. в [справочной документации](reference-azure-machine-learning-cli.md).

<a id="gitintegration"></a>

## <a name="git-tracking-and-integration"></a>Отслеживание и интеграция Git

При выполнении запуска обучения, в котором исходный каталог является локальным репозиторием Git, сведения о репозитории хранятся в журнале выполнения. Дополнительные сведения см. в статье [Интеграция с Git для Машинного обучения Azure](concept-train-model-git-integration.md).

## <a name="notebook-examples"></a>Примеры записных книжек

Посмотрите примеры обучения различных целевых объектов вычислений в следующих записных книжках.
* [how-to-use-azureml/training](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/training)
* [tutorials/img-classification-part1-training.ipynb](https://github.com/Azure/MachineLearningNotebooks/blob/master/tutorials/image-classification-mnist-data/img-classification-part1-training.ipynb)

[!INCLUDE [aml-clone-in-azure-notebook](../../includes/aml-clone-for-examples.md)]

## <a name="next-steps"></a>Дальнейшие действия

* [Руководство. по обучению модели классификации изображений с помощью Службы машинного обучения Azure](tutorial-train-models-with-aml.md). В нем используется управляемый целевой объект вычислений для обучения модели.
* Узнайте, как [эффективно настроить гиперпараметры](how-to-tune-hyperparameters.md) для создания улучшенных моделей.
* После обучения модели узнайте о [способах и расположениях развертывания моделей](how-to-deploy-and-where.md).
* Обзор справочника по пакету SDK [класса RunConfiguration](https://docs.microsoft.com/python/api/azureml-core/azureml.core.runconfig.runconfiguration?view=azure-ml-py).
* [Использование Машинного обучения Azure с виртуальными сетями Microsoft Azure](how-to-enable-virtual-network.md)
