---
title: Сетевая изоляция и конфиденциальность
titleSuffix: Azure Machine Learning
description: Используйте изолированную виртуальную сеть Azure с машинным обучением Azure для безопасного экспериментирования, обучения, анализа и оценки.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.reviewer: larryfr
ms.author: aashishb
author: aashishb
ms.date: 07/07/2020
ms.topic: conceptual
ms.custom: how-to, contperfq4, devx-track-python
ms.openlocfilehash: 58f0a25ebeb7fb715cfba27d7482a031d1fe8c32
ms.sourcegitcommit: b8702065338fc1ed81bfed082650b5b58234a702
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2020
ms.locfileid: "88121210"
---
# <a name="network-isolation-during-training-and-inference-with-private-endpoints-and-virtual-networks"></a>Сетевая изоляция во время обучения и вывода с частными конечными точками и виртуальными сетями
[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-basic-enterprise-sku.md)]

В этой статье вы узнаете, как защитить жизненный цикл машинного обучения с помощью изоляции Машинное обучение Azure заданий обучения и вывода в виртуальной сети Azure. __Виртуальная сеть__ выполняет роль границы безопасности, изолируя ресурсы Azure от общедоступного Интернета. Также вы можете подключить виртуальную сеть Azure к локальной сети. Объединяя сети, вы получаете возможность безопасно обучать модели и обращаться к развернутым моделям для формирования выводов.

Доступ к рабочей области Машинное обучение Azure можно получить из виртуальной сети с помощью __частной конечной точки__. Частная конечная точка — это набор частных IP-адресов в виртуальной сети, а доступ к рабочей области ограничен виртуальной сетью. Частная конечная точка позволяет снизить риск утечка данных. Дополнительные сведения о частных конечных точках см. в статье [Приватный канал Azure](/azure/private-link/private-link-overview).

> [!NOTE]
> При использовании Mozilla Firefox могут возникнуть проблемы с доступом к рабочей области через частную конечную точку. Проблема может быть связана с параметром DNS по протоколу HTTPS в браузере. Для решения этой проблемы мы рекомендуем использовать Microsoft ребр или Google Chrome.

Машинное обучение Azure полагается на другие службы Azure для хранения данных и вычислительных ресурсов (используется для обучения и развертывания моделей). Эти ресурсы также можно создать в виртуальной сети. Например, можно использовать вычислительные ресурсы Машинного обучения Azure для обучения модели с последующим развертыванием модели в службе Azure Kubernetes (AKS). 

## <a name="prerequisites"></a>Предварительные требования

+ [Рабочая область](how-to-manage-workspace.md) Машинного обучения Azure.

+ Рабочие знание общих принципов [службы виртуальной сети Azure](https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview) и [IP-сетей](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm).

+ Существующие виртуальная сеть и подсеть для использования с вычислительными ресурсами.

+ Чтобы развернуть ресурсы в виртуальной сети или подсети, учетная запись пользователя должна иметь разрешения на доступ к следующим действиям в элементах управления доступом на основе ролей (RBAC) Azure.

    - "Microsoft. Network/virtualNetworks/соединение/действие" для ресурса виртуальной сети.
    - "Microsoft. Network/virtualNetworks/подсеть/соединение/действие" в ресурсе подсети.

    Дополнительные сведения о сетях RBAC с сетью см. в разделе [встроенные сетевые роли](/azure/role-based-access-control/built-in-roles#networking) .

## <a name="secure-your-workspace"></a>Защита рабочей области

Рабочая область Машинное обучение Azure может иметь __общедоступную конечную__ точку или __закрытую конечную точку__. Общедоступная конечная точка — это набор IP-адресов, доступных в общедоступном Интернете, а частная конечная точка — это набор частных IP-адресов в виртуальной сети. 

Чтобы ограничить доступ к рабочей области только по частным IP-адресам, используйте закрытую конечную точку.

Так как взаимодействие с рабочей областью разрешено только из виртуальной сети, все среды разработки, использующие эту рабочую область, должны быть членами виртуальной сети. Например, виртуальная машина в виртуальной сети.

> [!IMPORTANT]
> Частная конечная точка не влияет на плоскость управления Azure (операции управления), такие как удаление рабочей области или управление ресурсами вычислений. Например, создание, обновление или удаление целевого объекта вычислений. Эти операции выполняются через общедоступный Интернет в нормальном режиме.
>
> Частная конечная точка предотвращает доступ к рабочей области извне виртуальной сети.

Для некоторых сочетаний ресурсов с частной конечной точкой требуется рабочая область выпуска Enterprise Edition. Используйте следующую таблицу, чтобы понять, в каких сценариях требуется выпуск Enterprise.

| Сценарий | Enterprise</br>edition | Basic</br>edition |
| ----- |:-----:|:-----:| 
| Нет виртуальной сети или частной конечной точки | ✔ | ✔ |
| Рабочая область без закрытой конечной точки. Другие ресурсы (кроме реестра контейнеров Azure) в виртуальной сети | ✔ | ✔ |
| Рабочая область без закрытой конечной точки. Другие ресурсы с закрытой конечной точкой | ✔ | |
| Рабочая область с частной конечной точкой. Другие ресурсы (кроме реестра контейнеров Azure) в виртуальной сети | ✔ | ✔ |
| Рабочая область и другие ресурсы с закрытой конечной точкой | ✔ | |
| Рабочая область с частной конечной точкой. Другие ресурсы без частной конечной точки или виртуальной сети | ✔ | ✔ |
| Реестр контейнеров Azure в виртуальной сети | ✔ | |
| Ключи, управляемые клиентом для рабочей области | ✔ | |

> [!WARNING]
> 
> Машинное обучение Azureные экземпляры вычислений не поддерживаются в рабочей области, где включена частная конечная точка.
>
> Машинное обучение Azure не поддерживает использование службы Azure Kubernetes, для которой включена частная конечная точка. Вместо этого можно использовать службу Azure Kubernetes в виртуальной сети. Дополнительные сведения см. в разделе [Защита заданий экспериментирования и анализа Машинного обучения Azure в виртуальной сети Azure](how-to-enable-virtual-network.md)

Дополнительные сведения о частных конечных точках в Azure см. в статье о [частной ссылке Azure](/azure/private-link/private-link-overview) .

### <a name="create-a-workspace-that-uses-a-private-endpoint"></a>Создание рабочей области, использующей закрытую конечную точку

Вы можете создать новую рабочую область с частной конечной точкой с помощью Машинное обучение Azure пакета SDK, интерфейса командной строки, шаблона Azure Resource Manager или портал Azure.

__Требования__

* Для виртуальной сети, используемой с частной конечной точкой, политики сети должны быть отключены. Дополнительные сведения см. в разделе [отключение сетевых политик для частной конечной точки](/azure/private-link/disable-private-endpoint-network-policy).

__Ограничения__

* Вы не можете подключиться к рабочей области через общедоступный Интернет, только в пределах виртуальной сети.

* Если несколько рабочих областей создаются с помощью частных конечных точек и они используют одну и ту же закрытую зону DNS, то в __связи виртуальной сети__ частной зоны DNS добавляется только первая Рабочая область.

    Чтобы обойти это ограничение, вручную добавьте ссылку на виртуальную сеть для дополнительных рабочих областей. Дополнительные сведения см. [в разделе что такое связь виртуальной сети](/azure/dns/private-dns-virtual-network-links).

__Конфигурация__

Сведения о создании рабочей области с помощью виртуальной сети и частной конечной точки вместе с другими параметрами конфигурации см. в следующих статьях:

* [Используйте шаблон Azure Resource Manager, чтобы создать рабочую область для машинное обучение Azure](how-to-create-workspace-template.md).
* [Создание рабочих областей на портале](how-to-manage-workspace.md).
* [Создание рабочих областей с Azure CLI](how-to-manage-workspace-cli.md).
* Сведения об использовании пакета SDK для Python см. в справочной документации по [приватиндпоинтконфиг](https://docs.microsoft.com/python/api/azureml-core/azureml.core.private_endpoint.privateendpointconfig?view=azure-ml-py) и [рабочей области. Create ()](https://docs.microsoft.com/python/api/azureml-core/azureml.core.workspace.workspace?view=azure-ml-py#create-name--auth-none--subscription-id-none--resource-group-none--location-none--create-resource-group-true--sku--basic---friendly-name-none--storage-account-none--key-vault-none--app-insights-none--container-registry-none--cmk-keyvault-none--resource-cmk-uri-none--hbi-workspace-false--default-cpu-compute-target-none--default-gpu-compute-target-none--private-endpoint-config-none--private-endpoint-auto-approval-true--exist-ok-false--show-output-true-) .

<a id="amlcompute"></a>

## <a name="machine-learning-studio"></a>Машинное обучение Studio

__Требования__

* Для доступа к данным в учетной записи хранения учетная запись хранения должна находиться в той же виртуальной сети, что и Рабочая область.

* Если данные хранятся в виртуальной сети, необходимо использовать [управляемое удостоверение](../active-directory/managed-identities-azure-resources/overview.md) рабочей области, чтобы предоставить Studio доступ к данным.

    > [!IMPORTANT]
    > Хотя большая часть Studio работает с данными, хранящимися в виртуальной сети, интегрированные записные книжки __не имеют__. Интегрированные записные книжки не поддерживают использование хранилища, которое находится в виртуальной сети. Вместо этого можно использовать записные книжки Jupyter из вычислительного экземпляра. Дополнительные сведения см. в разделе [COMPUTE clusters & Instances](#compute-instance) .

    Если вы не предоставляете доступ к Studio, появится сообщение об ошибке, поэтому `Error: Unable to profile this dataset. This might be because your data is stored behind a virtual network or your data does not support profile.` следующие операции будут недоступны:

    * Предварительный просмотр данных в студии.
    * Визуализируйте данные в конструкторе.
    * Отправьте Аутомл эксперимент.
    * Запустите проект меток.

__Ограничения__

* Машинное обучение Azure Studio поддерживает считывание данных из следующих типов хранилища в виртуальной сети:

    * Большой двоичный объект Azure
    * Хранилище Azure Data Lake Storage 1-го поколения
    * Azure Data Lake Storage 2-го поколения
    * База данных SQL Azure

__Конфигурация__

* __Настройте хранилища данных для использования управляемого удостоверения__ для доступа к данным. Эти действия позволяют добавить управляемое удостоверение рабочей __области в службу__ хранилища с помощью управления доступом на основе ресурсов Azure (RBAC). Доступ для __чтения__ позволяет рабочей области получить параметры брандмауэра и убедиться, что данные не покидают виртуальную сеть.

    1. В студии выберите __хранилища данных__.

    1. Чтобы создать новое хранилище данных, выберите __+ создать хранилище данных__. Чтобы обновить существующий объект, выберите хранилище данных и щелкните __обновить учетные данные__.

    1. В параметрах хранилища данных выберите __Да__ , __чтобы разрешить машинное обучение Azure службе доступ к хранилищу с помощью управляемого удостоверения рабочей области__.

    > [!NOTE]
    > Для вступления этих изменений в силу может потребоваться до 10 минут.

* Для __хранилища BLOB-объектов Azure__управляемое удостоверение рабочей области также должно быть добавлено как [модуль чтения данных большого двоичного объекта](../role-based-access-control/built-in-roles.md#storage-blob-data-reader) , чтобы он мог считывать данные из хранилища BLOB-объектов.

* Конструктор использует учетную запись хранения, подключенную к рабочей области, для хранения выходных данных по умолчанию. Однако можно указать, что он будет хранить выходные данные в любом хранилище данных, к которому у вас есть доступ. Если в вашей среде используются виртуальные сети, эти элементы управления можно использовать для обеспечения безопасности и доступности данных. Чтобы задать новое хранилище по умолчанию для конвейера, выполните следующие действия.

    1. В черновике конвейера щелкните **значок шестеренки параметров** рядом с заголовком конвейера.
    1. Выберите запись **хранилища данных выборки по умолчанию** .
    1. Укажите новое хранилище данных.

    Можно также переопределить хранилище данных по умолчанию для каждого модуля. Это позволяет управлять местом хранения для каждого отдельного модуля.

    1. Выберите модуль, выходные данные которого необходимо указать.
    1. Разверните раздел **Параметры вывода** .
    1. Выберите **параметр переопределить параметры вывода по умолчанию**.
    1. Выберите **задать параметры вывода**.
    1. Укажите новое хранилище данных.

* При использовании __Azure Data Lake Storage 2-го поколения__можно использовать как RBAC, так и списки управления доступом в стиле POSIX для управления доступом к данным в виртуальной сети.

    Чтобы использовать RBAC, добавьте управляемое удостоверение рабочей области в роль [читателя данных BLOB](../role-based-access-control/built-in-roles.md#storage-blob-data-reader) . Дополнительные сведения см. в разделе [Управление доступом на основе ролей](../storage/blobs/data-lake-storage-access-control.md#role-based-access-control).

    Чтобы использовать списки управления доступом, управляемому удостоверению рабочей области можно назначить доступ, как и любой другой принцип безопасности. Дополнительные сведения см. [в разделе списки управления доступом для файлов и каталогов](../storage/blobs/data-lake-storage-access-control.md#access-control-lists-on-files-and-directories).

* __Azure Data Lake Storage 1-го поколения__ поддерживает только списки управления доступом в стиле POSIX. Можно назначить доступ управляемой идентификации рабочей области для ресурсов точно так же, как любой другой принцип безопасности. Дополнительные сведения см. [в разделе Контроль доступа в Azure Data Lake Storage 1-го поколения](../data-lake-store/data-lake-store-access-control.md).

* Чтобы получить доступ к данным, хранящимся в __базе данных SQL Azure__ с помощью управляемого удостоверения, необходимо создать автономного пользователя SQL, сопоставляемого с управляемым удостоверением. Дополнительные сведения о создании пользователя из внешнего поставщика см. в статье [Создание автономных пользователей, сопоставленных с удостоверениями Azure AD](../azure-sql/database/authentication-aad-configure.md#create-contained-users-mapped-to-azure-ad-identities).

    После создания автономного пользователя SQL предоставьте ему разрешения с помощью [команды T-SQL GRANT](https://docs.microsoft.com/sql/t-sql/statements/grant-object-permissions-transact-sql).

* При __доступе к студии из ресурса внутри виртуальной сети__ (например, вычислительного экземпляра или виртуальной машины) необходимо разрешить исходящий трафик из виртуальной сети в студии. 

    Например, если вы используете группы безопасности сети (NSG) для ограничения исходящего трафика, добавьте правило в назначение __тега службы__ для __азурефронтдур. интерфейс__.

## <a name="use-datastores-and-datasets"></a>Использование хранилищ данных и наборов DataSet

> [!NOTE]
> В этом разделе рассматриваются сведения об использовании хранилища данных и DataSet для интерфейса SDK. Дополнительные сведения о работе с Studio см. в разделе [машинное обучение Studio](#machine-learning-studio).

__Ограничения__

По умолчанию Машинное обучение Azure выполняет проверку достоверности данных и учетных данных при попытке доступа к данным с помощью пакета SDK. Если данные находятся за виртуальной сетью, Машинное обучение Azure не сможет получить доступ к данным и не сможет проверить их. Чтобы обойти эту проблему, пропустите проверку при создании хранилищ данных и DataSets.

* При использовании __хранилища данных__:

    Azure Data Lake Store Gen1 и Azure Data Lake Store по умолчанию пропускают проверку, поэтому дальнейшие действия не требуются. Однако для следующих служб можно использовать аналогичный синтаксис для пропуска проверки хранилища данных:

    - Хранилище BLOB-объектов Azure
    - Общая папка Azure
    - PostgreSQL
    - База данных SQL Azure

    В следующем примере кода создается хранилище данных BLOB-объектов Azure и задаются наборы `skip_validation=True` .

    ```python
    blob_datastore = Datastore.register_azure_blob_container(workspace=ws,  
                                                            datastore_name=blob_datastore_name,  
                                                            container_name=container_name,  
                                                            account_name=account_name, 
                                                            account_key=account_key, 
                                                            skip_validation=True ) // Set skip_validation to true
    ```

* При использовании __набора данных__:

    Синтаксис для пропуска проверки набора данных аналогичен для следующих типов наборов данных:
    - Файл с разделителями
    - JSON 
    - Parquet
    - SQL
    - Файл

    Следующий код создает новый набор данных JSON и задает `validate=False` .

    ```python
    json_ds = Dataset.Tabular.from_json_lines_files(path=datastore_paths, 
                                                   validate=False) 
    ```

## <a name="azure-storage-account"></a>Учетная запись хранения Azure

> [!IMPORTANT]
> Вы можете разместить _учетную запись хранения по умолчанию_ для машинное обучение Azure и _учетные записи хранения, отличные от используемых по умолчанию_ , в виртуальной сети.

__Требования__

* Учетная запись хранения должна находиться в той же виртуальной сети и подсети, что и экземпляры или кластеры вычислительных ресурсов, используемые для обучения или аналитики.

__Конфигурация__

Чтобы защитить учетную запись хранения Azure, используемую рабочей областью, включите __закрытую конечную точку__ или __конечную точку службы__ для учетной записи хранения в виртуальной сети.

* Сведения о настройке учетной записи хранения для использования __частной конечной точки__см. в статье [использование частных конечных точек](/azure/storage/common/storage-private-endpoints.md) .

* Чтобы настроить учетную запись хранения для использования __конечной точки службы__, выполните следующие действия.

    1. Чтобы добавить учетную запись хранения в виртуальную сеть, используемую рабочей областью, используйте информацию из раздела __предоставление доступа из виртуальной сети__ статьи [Настройка брандмауэров службы хранилища Azure и виртуальных сетей](/azure/storage/common/storage-network-security#grant-access-from-a-virtual-network) .
    1. Чтобы разрешить доступ из служб Майкрософт в виртуальной сети (например, Машинное обучение Azure), используйте информацию из раздела " __исключения__ " в статье [Настройка брандмауэров и виртуальных сетей службы хранилища Azure](/azure/storage/common/storage-network-security#exceptions) .
    1. При работе с пакетом SDK для Машинного обучения Azure среда разработки должна иметь возможность подключения к учетной записи хранения Azure. Если учетная запись хранения находится в виртуальной сети, брандмауэр должен разрешить доступ с IP-адреса среды разработки. Чтобы добавить IP-адрес среды разработки, используйте сведения в разделе __предоставление доступа из диапазона IP-адресов в Интернете__ статьи [Настройка брандмауэров службы хранилища Azure и виртуальных сетей](/azure/storage/common/storage-network-security#grant-access-from-an-internet-ip-range) .

## <a name="azure-container-registry"></a>Реестр контейнеров Azure

__Требования__

* Рабочая область Машинного обучения Azure (выпуск Enterprise). Сведения об обновлении см. в разделе [Обновление до выпуска Enterprise](how-to-manage-workspace.md#upgrade).
* Регион Машинное обучение Azure рабочей области должен быть [включен](https://docs.microsoft.com/azure/private-link/private-link-overview#availability). 
* Реестр контейнеров Azure должен иметь версию Premium. Дополнительные сведения об обновлении см. в разделе [Изменение SKU](/azure/container-registry/container-registry-skus#changing-skus).
* Реестр контейнеров Azure должен находиться в той же виртуальной сети и подсети, что и учетная запись хранения и целевые объекты вычислений, используемые для обучения или аналитики.
* Рабочая область Машинного обучения Azure должна содержать [кластер вычислительных ресурсов Машинного обучения Azure](how-to-set-up-training-targets.md#amlcompute).

__Ограничения__

* Если ACR находится за виртуальной сетью, Машинное обучение Azure не может использовать его напрямую для создания образов Docker. Вместо этого для построения образов используется кластер вычислений.

__Конфигурация__

1. Чтобы найти имя реестра контейнеров Azure для рабочей области, используйте один из следующих методов.

    __Портал Azure__

    В разделе "Обзор" вашей рабочей области значение __Реестр__ позволяет перейти в реестр контейнеров Azure.

    :::image type="content" source="./media/how-to-enable-virtual-network/azure-machine-learning-container-registry.png" alt-text="Реестр контейнеров Azure для рабочей области" border="true":::.

    __Azure CLI__

    Если вы [установили расширение машинного обучения для интерфейса командной строки Azure](reference-azure-machine-learning-cli.md), можно использовать команду `az ml workspace show` для отображения сведений о рабочей области.

    ```azurecli-interactive
    az ml workspace show -w yourworkspacename -g resourcegroupname --query 'containerRegistry'
    ```

    Эта команда возвращает значение следующего вида: `"/subscriptions/{GUID}/resourceGroups/{resourcegroupname}/providers/Microsoft.ContainerRegistry/registries/{ACRname}"`. Последняя часть строки — это имя реестра контейнеров Azure для рабочей области.

1. Чтобы ограничить доступ к виртуальной сети, выполните действия, описанные в разделе [Настройка сетевого доступа для реестра](../container-registry/container-registry-vnet.md#configure-network-access-for-registry). При добавлении виртуальной сети выберите виртуальную сеть и подсеть для ресурсов Машинного обучения Azure.

1. Используйте пакет SDK Python для Машинного обучения Azure, чтобы настроить кластер вычислительных ресурсов для создания образов Docker. В следующем фрагменте кода показано, как это сделать.

    ```python
    from azureml.core import Workspace
    # Load workspace from an existing config file
    ws = Workspace.from_config()
    # Update the workspace to use an existing compute cluster
    ws.update(image_build_compute = 'mycomputecluster')
    ```

    > [!IMPORTANT]
    > Учетная запись хранения, кластер вычислений и реестр контейнеров Azure должны находиться в одной подсети виртуальной сети.
    
    Дополнительную информацию см. в справочном руководстве по методу [update()](https://docs.microsoft.com/python/api/azureml-core/azureml.core.workspace.workspace?view=azure-ml-py#update-friendly-name-none--description-none--tags-none--image-build-compute-none--enable-data-actions-none-).

1. Чтобы обеспечить взаимодействие рабочей области с экземпляром записи контроля доступа, примените следующий шаблон Azure Resource Manager:

    > [!WARNING]
    > Этот шаблон включает закрытую конечную точку для рабочей области и изменяет ее на корпоративную рабочую область. Эти изменения отменить нельзя.

    ```json
    {
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "keyVaultArmId": {
        "type": "string"
        },
        "workspaceName": {
        "type": "string"
        },
        "containerRegistryArmId": {
        "type": "string"
        },
        "applicationInsightsArmId": {
        "type": "string"
        },
        "storageAccountArmId": {
        "type": "string"
        },
        "location": {
        "type": "string"
        }
    },
    "resources": [
        {
        "type": "Microsoft.MachineLearningServices/workspaces",
        "apiVersion": "2019-11-01",
        "name": "[parameters('workspaceName')]",
        "location": "[parameters('location')]",
        "identity": {
            "type": "SystemAssigned"
        },
        "sku": {
            "tier": "enterprise",
            "name": "enterprise"
        },
        "properties": {
            "sharedPrivateLinkResources":
    [{"Name":"Acr","Properties":{"PrivateLinkResourceId":"[concat(parameters('containerRegistryArmId'), '/privateLinkResources/registry')]","GroupId":"registry","RequestMessage":"Approve","Status":"Pending"}}],
            "keyVault": "[parameters('keyVaultArmId')]",
            "containerRegistry": "[parameters('containerRegistryArmId')]",
            "applicationInsights": "[parameters('applicationInsightsArmId')]",
            "storageAccount": "[parameters('storageAccountArmId')]"
        }
        }
    ]
    }
    ```

## <a name="key-vault-instance"></a>Экземпляр хранилища ключей 

__Требования__

__Ограничения__

__Конфигурация__ 

Чтобы использовать Машинное обучение Azure возможности экспериментов с Azure Key Vault за виртуальной сетью, используйте статью [Azure Key Vault Настройка брандмауэров и виртуальных сетей](/azure/key-vault/general/network-security) .

> [!IMPORTANT]
> При выполнении действий, описанных в этой статье, используйте ту же виртуальную сеть, которая используется ресурсами для вычислений экспериментирования. Необходимо также __разрешить доверенным службам Майкрософт обходить этот брандмауэр__.

## <a name="compute-clusters--instances"></a><a name="compute-instance"></a>Вычислительные кластеры и экземпляры 

__Требования__

* Виртуальная сеть должна размещаться в той же подписке и том же регионе, что и рабочая область Машинного обучения Azure.
* Указанная для экземпляра или кластера вычислительных ресурсов подсеть должна иметь достаточное (то есть соответствующее количеству виртуальных машин, являющихся целевыми объектами) количество неназначенных IP-адресов. Если в подсети нет достаточного количества свободных IP-адресов, вычислительный кластер будет выделен частично.
* Если вы планируете защитить виртуальную сеть путем ограниченного трафика, для службы вычислений должны остаться открытыми некоторые порты.
* Если вы собираетесь разместить в одной виртуальной сети несколько экземпляров или кластеров вычислительных ресурсов, может потребоваться увеличить квоту для одного или нескольких ресурсов.
* Если учетные записи хранения Azure для рабочей области также предусмотрены в виртуальной сети, они должны находиться в той же виртуальной сети, что и экземпляр или кластер вычислительных ресурсов Машинного обучения Azure. 
* Для работы функциональности Jupyter экземпляра вычислительных ресурсов необходимо убедиться, что связь через веб-сокет не отключена.

__Ограничения__

* Экземпляр или кластер вычислительных ресурсов машинного обучения автоматически выделяет дополнительные сетевые ресурсы __в группе ресурсов, которая содержит виртуальную сеть__. Для каждого экземпляра или кластера вычислительных ресурсов служба выделяет следующие ресурсы:

    * Одна группа безопасности сети
    * Один общедоступный IP-адрес
    * Один балансировщик нагрузки
    
    Для __кластеров вычислений__эти ресурсы удаляются (и создаются повторно) каждый раз, когда кластер масштабируется до 0 узлов.
    
    Для __вычислительного экземпляра__ ресурсы удерживаются до тех пор, пока экземпляр не будет удален (при остановке ресурсы не удаляются).

    Эти ресурсы ограничены [квотами ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits) в подписке.

__Конфигурация__

* Чтобы создать кластер вычислительных ресурсов машинного обучения, выполните следующие действия.

    1. Войдите в [студию Машинного обучения Azure](https://ml.azure.com/), выберите свою подписку и рабочую область.
    1. Слева выберите пункт __Вычисление__.
    1. Выберите __обучающие кластеры__ в центре, а затем — __+__ .
    1. В диалоговом окне __Новый обучающий кластер__ разверните раздел __Дополнительные параметры__.
    1. Чтобы настроить этот вычислительный ресурс для использования виртуальной сети, выполните следующие действия в разделе __Настройка виртуальной сети__.

        1. В раскрывающемся списке __Группа ресурсов__ выберите группу ресурсов, которая содержит виртуальную сеть.
        1. В раскрывающемся списке __Виртуальная сеть__выберите виртуальную сеть, которая содержит подсеть.
        1. В раскрывающемся списке __Подсеть__ выберите подсеть для использования.

    ![Параметры виртуальной сети для вычислительной среды машинного обучения](./media/how-to-enable-virtual-network/amlcompute-virtual-network-screen.png)

    Вы также можете создать кластер Вычислительной среды Машинного обучения с помощью пакета SDK для Машинного обучения Azure. Следующий код создает новый кластер Вычислительной среды Машинного обучения в подсети `default`, размещенной в виртуальной сети с именем `mynetwork`:

    ```python
    from azureml.core.compute import ComputeTarget, AmlCompute
    from azureml.core.compute_target import ComputeTargetException

    # The Azure virtual network name, subnet, and resource group
    vnet_name = 'mynetwork'
    subnet_name = 'default'
    vnet_resourcegroup_name = 'mygroup'

    # Choose a name for your CPU cluster
    cpu_cluster_name = "cpucluster"

    # Verify that cluster does not exist already
    try:
        cpu_cluster = ComputeTarget(workspace=ws, name=cpu_cluster_name)
        print("Found existing cpucluster")
    except ComputeTargetException:
        print("Creating new cpucluster")

        # Specify the configuration for the new cluster
        compute_config = AmlCompute.provisioning_configuration(vm_size="STANDARD_D2_V2",
                                                            min_nodes=0,
                                                            max_nodes=4,
                                                            vnet_resourcegroup_name=vnet_resourcegroup_name,
                                                            vnet_name=vnet_name,
                                                            subnet_name=subnet_name)

        # Create the cluster with the specified name and configuration
        cpu_cluster = ComputeTarget.create(ws, cpu_cluster_name, compute_config)

        # Wait for the cluster to be completed, show the output log
        cpu_cluster.wait_for_completion(show_output=True)
    ```

    Когда завершится процесс создания, переходите в своем эксперименте к обучению модели с помощью кластера. Дополнительные сведения вы найдете в статье [Настройка целевых объектов вычислений для обучения моделей](how-to-set-up-training-targets.md).

    [!INCLUDE [low-pri-note](../../includes/machine-learning-low-pri-vm.md)]

* Если вы используете записные книжки в экземпляре Azure COMPUTE, необходимо убедиться, что ваша Записная книжка работает на вычислительном ресурсе, который находится за той же виртуальной сетью и подсетью, что и ваши данные. 

    Настройте экземпляр вычислений в той же виртуальной сети во время создания в разделе **Дополнительные параметры**  >  **Настройка виртуальной сети**. Нельзя добавить существующий вычислительный экземпляр в виртуальную сеть.

* Если вы планируете защитить виртуальную сеть путем запрета сетевого трафика из общедоступного Интернета в Интернет, необходимо разрешить входящие подключения из пакетной службы Azure.

    Пакетная служба добавляет группы безопасности сети на уровне сетевых интерфейсов, подключенных к виртуальным машинам. Эти группы безопасности сети автоматически настраивают правила для входящего и исходящего трафика, чтобы разрешить следующий трафик:

    - Входящий TCP-трафик на портах 29876 и 29877 с __тега службы__ __BatchNodeManagement__.

    - (Необязательно.) Входящий трафик по протоколу TCP через порт 22, чтобы разрешить удаленный доступ. Используйте этот порт только в том случае, если вы хотите подключиться по протоколу SSH на общедоступном IP-адресе.

    - Исходящий трафик в виртуальную сеть на любом порту.

    - Исходящий трафик в Интернет на любом порту.

    - Для вычислительного экземпляра входящий TCP-трафик через порт 44224 из __тега службы__ __AzureMachineLearning__.

    > [!IMPORTANT]
    > Соблюдайте осторожность, если вы изменяете или добавляете правила для входящего и исходящего трафика в группах безопасности сети, настроенных для пакетной службы. Если группа безопасности сети заблокирует связь с вычислительными узлами, вычислительная служба установит для этих вычислительных узлов состояние "Непригодно".
    >
    > Вам не нужно указывать группы безопасности сети на уровне подсети, так как пакетная служба Azure настраивает собственные группы. Однако если подсеть, содержащая Машинное обучение Azure COMPUTE, имеет связанный группы безопасности сети или брандмауэр, необходимо также разрешить указанный выше трафик.

* Если вы не хотите использовать правила для исходящего трафика по умолчанию и хотите ограничить исходящий доступ в виртуальной сети, выполните следующие действия.

    1. Запретите исходящие интернет-подключения с помощью правил NSG.
    1. Ограничьте исходящий трафик для __экземпляра вычислительных ресурсов__ или __кластера вычислительных ресурсов__ следующими элементами.
        - Служба хранилища Azure, с помощью __тега службы__ __Storage.RegionName__, где `{RegionName}` — имя региона Azure.
        - Реестр контейнеров Azure, с помощью __тега службы__ __AzureContainerRegistry.RegionName__, где `{RegionName}` — имя региона Azure.
        - Машинное обучение Azure, с помощью __тега службы__ __AzureMachineLearning__
        - Azure Resource Manager, с помощью __тега службы__ __AzureResourceManager__
        - Azure Active Directory, с помощью __тега службы__ __AzureActiveDirectory__

    > [!NOTE]
    > Если вы планируете использовать образы DOCKER по умолчанию, предоставляемые корпорацией Майкрософт, и включите управляемые пользователем зависимости, необходимо также использовать следующие __теги служб__:
    >
    > * __MicrosoftContainerRegistry__
    > * __AzureFrontDoor.FirstParty__
    >
    > Эта конфигурация необходима при наличии кода, аналогичного приведенным ниже фрагментам, в рамках сценариев обучения.
    >
    > __Обучение работе с RunConfig__
    > ```python
    > # create a new runconfig object
    > run_config = RunConfiguration()
    > 
    > # configure Docker 
    > run_config.environment.docker.enabled = True
    > # For GPU, use DEFAULT_GPU_IMAGE
    > run_config.environment.docker.base_image = DEFAULT_CPU_IMAGE 
    > run_config.environment.python.user_managed_dependencies = True
    > ```
    >
    > __Обучение работе с оценщиком__
    > ```python
    > est = Estimator(source_directory='.',
    >                 script_params=script_params,
    >                 compute_target='local',
    >                 entry_script='dummy_train.py',
    >                 user_managed=True)
    > run = exp.submit(est)
    > ```

* Если вы используете [принудительное туннелирование](/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm) с машинное обучение Azureным вычислением, необходимо разрешить обмен данными с общедоступным Интернетом из подсети, содержащей ресурс вычислений. Это взаимодействие используется для планирования задач и доступа к службе хранилища Azure.

    Это можно сделать двумя способами:

    * Используйте [NAT виртуальной сети](../virtual-network/nat-overview.md). Шлюз NAT обеспечивает исходящее подключение к Интернету для одной или нескольких подсетей в виртуальной сети. Дополнительные сведения см. в статье [проектирование виртуальных сетей с помощью ресурсов шлюза NAT](../virtual-network/nat-gateway-resource.md).

    * Добавьте [определяемые пользователем маршруты (определяемые пользователем маршруты)](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview) в подсеть, которая содержит ресурс вычислений. Установите UDR для каждого IP-адреса, используемого пакетной службой Azure в регионе, где находятся ваши ресурсы. UDR позволяют пакетной службе взаимодействовать с вычислительными узлами с целью планирования задач. Также добавьте IP-адрес для службы Машинного обучения Azure, где существуют ресурсы, так как это необходимо для доступа к вычислительным экземплярам. Чтобы получить список IP-адресов пакетной службы и службы Машинного обучения Azure, используйте один из следующих методов.

        * Скачайте [диапазоны IP-адресов Azure и теги службы](https://www.microsoft.com/download/details.aspx?id=56519) и найдите в файле `BatchNodeManagement.<region>` и `AzureMachineLearning.<region>`, где `<region>` — ваш регион Azure.

        * Для загрузки информации используйте [интерфейс командной строки Azure](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest). В следующем примере скачиваются сведения об IP-адресе и фильтруются сведения для региона Восток США 2.

            ```azurecli-interactive
            az network list-service-tags -l "East US 2" --query "values[?starts_with(id, 'Batch')] | [?properties.region=='eastus2']"
            az network list-service-tags -l "East US 2" --query "values[?starts_with(id, 'AzureMachineLearning')] | [?properties.region=='eastus2']"
            ```
        
        При добавлении определяемого пользователем маршрута укажите маршрут для каждого связанного префикса IP-адреса пакетной службы, а также задайте для параметра__Тип следующего прыжка__ значение __Интернет__. 

        В дополнение к любым определяемые пользователем маршруты, которые вы определяете, исходящий трафик в службу хранилища Azure должен быть разрешен через Ваше локальное сетевое устройство. В частности, URL-адреса для этого трафика относятся к следующим формам: `<account>.table.core.windows.net` , `<account>.queue.core.windows.net` и `<account>.blob.core.windows.net` . 

        См. дополнительные сведения в разделе [Создание пула пакетной службы Azure в виртуальной сети](../batch/batch-virtual-network.md#user-defined-routes-for-forced-tunneling).

<a id="aksvnet"></a>

## <a name="azure-kubernetes-service"></a>Служба Azure Kubernetes

__Требования__

* Экземпляр службы Azure Kubernetes Service (AKS) и виртуальная сеть Azure должны находиться в одном регионе. Если вы защищаете учетные записи хранения Azure, используемые рабочей областью в виртуальной сети, они должны находиться в той же виртуальной сети, что и экземпляр AKS.

* Чтобы __спланировать IP-адресацию__ для кластера, следуйте предварительным требованиям в статье [Настройка расширенной сети в Azure KUBERNETES Service (AKS)](https://docs.microsoft.com/azure/aks/configure-azure-cni#prerequisites) .

* Чтобы ограничить входящие и исходящие подключения к кластеру AKS, следуйте указаниям в статье управление исходящим [трафиком для узлов кластера в службе Azure Kubernetes](/azure/aks/limit-egress-traffic) , чтобы убедиться, что _Исходящие_ подключения из AKS настроены правильно. Требования к _входящему_ соединению (при их наличии) вызываются в разделе конфигурации ниже.

__Ограничения__

* Если вы хотите использовать службу Azure Kubernetes с включенной частной ссылкой, необходимо подключить ее к рабочей области. Нельзя создать кластер Azure Kubernetes Service с частной ссылкой из Машинное обучение Azure (пакет SDK, портал, CLI и т. д.).

__Конфигурация__

> [!IMPORTANT]
> Этот раздел содержит несколько конфигураций. Выберите тот, который лучше подходит для ваших потребностей.

* Чтобы __использовать AKS за виртуальной сетью, используйте общедоступную подсистему балансировки нагрузки__:

    1. Создайте или Подключите кластер AKS. При __создании__ нового кластера необходимо указать виртуальную сеть, которая будет использоваться для кластера.
    
        В следующем примере показано, как создать новый кластер AKS с помощью пакета SDK для Python:

        ```python
        from azureml.core.compute import ComputeTarget, AksCompute

        # Create the compute configuration and set virtual network information
        config = AksCompute.provisioning_configuration(location="eastus2")
        config.vnet_resourcegroup_name = "mygroup"
        config.vnet_name = "mynetwork"
        config.subnet_name = "default"
        config.service_cidr = "10.0.0.0/16"
        config.dns_service_ip = "10.0.0.10"
        config.docker_bridge_cidr = "172.17.0.1/16"

        # Create the compute target
        aks_target = ComputeTarget.create(workspace=ws,
                                        name="myaks",
                                        provisioning_configuration=config)
        ```

        При наличии существующего кластера AKS, который уже находится за виртуальной сетью, используйте сведения из статьи [развертывание в Azure Kubernetes](how-to-deploy-azure-kubernetes-service.md#attach-an-existing-aks-cluster) .

    1. Убедитесь, что в группе безопасности сети, управляющей виртуальной сетью, включено правило безопасности __входящего трафика__ для конечной точки оценки, чтобы ее можно было вызывать извне виртуальной сети.

* Чтобы __использовать AKS за виртуальной сетью с частным подсистемой балансировки нагрузки__:

    1. Создайте или Подключите кластер AKS. При __создании__ нового кластера необходимо указать виртуальную сеть, которая будет использоваться для кластера.
    
        В следующем примере показано, как создать новый кластер AKS с помощью пакета SDK для Python:

        ```python
        from azureml.core.compute import ComputeTarget, AksCompute

        # Create the compute configuration and set virtual network information
        config = AksCompute.provisioning_configuration(location="eastus2")
        config.vnet_resourcegroup_name = "mygroup"
        config.vnet_name = "mynetwork"
        config.subnet_name = "default"
        config.service_cidr = "10.0.0.0/16"
        config.dns_service_ip = "10.0.0.10"
        config.docker_bridge_cidr = "172.17.0.1/16"

        # Create the compute target
        aks_target = ComputeTarget.create(workspace=ws,
                                        name="myaks",
                                        provisioning_configuration=config)
        ```

        При наличии существующего кластера AKS, который уже находится за виртуальной сетью, используйте сведения из статьи [развертывание в Azure Kubernetes](how-to-deploy-azure-kubernetes-service.md#attach-an-existing-aks-cluster) .

    1. Чтобы найти субъект-службу или идентификатор управляемого удостоверения для AKS, используйте следующие Azure CLI команды. Замените `<aks-cluster-name>` именем кластера. Замените `<resource-group-name>` именем группы ресурсов, которая _содержит кластер AKS_:

        ```azurecli-interactive
        az aks show -n <aks-cluster-name> --resource-group <resource-group-name> --query servicePrincipalProfile.clientId
        ``` 

        Если эта команда возвращает значение `msi` , используйте следующую команду, чтобы указать идентификатор субъекта для управляемого удостоверения:

        ```azurecli-interactive
        az aks show -n <aks-cluster-name> --resource-group <resource-group-name> --query identity.principalId
        ```
    1. Чтобы узнать идентификатор группы ресурсов, содержащей виртуальную сеть, используйте следующую команду. Замените `<resource-group-name>` именем группы ресурсов, _содержащей виртуальную сеть_.

        ```azurecli-interactive
        az group show -n <resource-group-name> --query id
        ```

    1. Чтобы добавить субъект-службу или управляемое удостоверение в качестве участника сети, используйте следующую команду. Замените `<SP-or-managed-identity>` идентификатором, возвращенным для субъекта-службы или управляемого удостоверения. Замените `<resource-group-id>` идентификатором, возвращенным для группы ресурсов, содержащей виртуальную сеть.

        ```azurecli-interactive
        az role assignment create --assignee <SP-or-managed-identity> --role 'Network Contributor' --scope <resource-group-id>
        ```

    1. Чтобы обновить кластер AKS для использования __частного балансировщика нагрузки__, используйте пакет SDK для Python. В следующем фрагменте кода показано, как обновить существующий кластер AKS, который был добавлен или присоединен к рабочей области.
    
        ```python
        import azureml.core
        from azureml.core.compute.aks import AksUpdateConfiguration
        from azureml.core.compute import AksCompute

        # ws = workspace object. Creation not shown in this snippet
        aks_target = AksCompute(ws,"myaks")

        # Change to the name of the subnet that contains AKS
        subnet_name = "default"
        # Update AKS configuration to use an internal load balancer
        update_config = AksUpdateConfiguration(None, "InternalLoadBalancer", subnet_name)
        aks_target.update(update_config)
        # Wait for the operation to complete
        aks_target.wait_for_completion(show_output = True)
        ```

* Чтобы __присоединить AKS с помощью частной конечной точки__:

    1. Используйте следующую команду Azure CLI, чтобы получить __идентификатор подсети__ подсети, которую будет использовать кластер AKS. Например, подсеть по умолчанию для виртуальной сети:
    
        ```azurecli
        az network vnet show -g myresourcegroup -n myvnet --query subnets[].id
        ```
        
        Эта команда возвращает массив идентификаторов для подсетей в виртуальной сети. Ниже приведен пример JSON из виртуальной сети, имеющей только одну подсеть.

        ```json
        [
            "/subscriptions/GUID/resourceGroups/myresourcegroup/providers/Microsoft.Network/virtualNetworks/myvnet/subnets/default"
        ]
        ```

        Если возвращается несколько идентификаторов, выберите тот, который вы хотите использовать.

    1. Чтобы создать частную конечную точку кластера AKS, используйте сведения в разделе " __Дополнительные сетевые подключения__ " статьи [Создание частного кластера службы Azure Kubernetes](/azure/aks/private-clusters#advanced-networking) . При создании кластера используйте идентификатор подсети из предыдущей команды с `--vnet-subnet-id` параметром.

    1. Чтобы подключить кластер, используйте сведения из статьи [развертывание в Azure Kubernetes](how-to-deploy-azure-kubernetes-service.md#attach-an-existing-aks-cluster) .

    > [!TIP]
    > При использовании этой конфигурации и ограничении исходящего трафика из кластера AKS вам не нужно разрешать обмен данными через порты __1194__ или __9000__. Другие порты, которые следует разрешить, см. в руководстве по [управлению трафиком исходящего трафика для узлов кластера в службе Azure Kubernetes](/azure/aks/limit-egress-traffic) .

## <a name="use-azure-container-instances-aci"></a>Использование экземпляров контейнеров Azure (ACI)

__Требования__

* Экземпляры контейнеров Azure динамически создаются при развертывании модели. Чтобы Машинное обучение Azure могло создать ACI в виртуальной сети, необходимо включить __делегирование подсети__ для подсети, используемой в развертывании.

__Ограничения__

* Виртуальная сеть должна находиться в той же группе ресурсов, что и Рабочая область Машинное обучение Azure.

* Реестр контейнеров Azure (запись контроля доступа) для рабочей области также не может находиться в виртуальной сети.

__Конфигурация__

Чтобы использовать ACI в виртуальной сети своей рабочей области, выполните следующие действия.

1. Чтобы включить делегирование подсети в виртуальной сети, используйте сведения, приведенные в статье [Добавление или удаление делегирования подсети](../virtual-network/manage-subnet-delegation.md). Делегирование можно включить при создании виртуальной сети или добавить в существующую сеть.

    > [!IMPORTANT]
    > При включении делегирования используйте `Microsoft.ContainerInstance/containerGroups` в качестве значения __Делегировать подсеть службе__.

2. Разверните модель с помощью [AciWebservice.deploy_configuration()](https://docs.microsoft.com/python/api/azureml-core/azureml.core.webservice.aci.aciwebservice?view=azure-ml-py#deploy-configuration-cpu-cores-none--memory-gb-none--tags-none--properties-none--description-none--location-none--auth-enabled-none--ssl-enabled-none--enable-app-insights-none--ssl-cert-pem-file-none--ssl-key-pem-file-none--ssl-cname-none--dns-name-label-none--primary-key-none--secondary-key-none--collect-model-data-none--cmk-vault-base-url-none--cmk-key-name-none--cmk-key-version-none--vnet-name-none--subnet-name-none-), используйте параметры `vnet_name` и `subnet_name`. Задайте для этих параметров имя виртуальной сети и подсеть, в которой включено делегирование.

## <a name="azure-databricks"></a>Azure Databricks

__Требования__

* Виртуальная сеть должна размещаться в той же подписке и том же регионе, что и рабочая область Машинного обучения Azure.
* Если учетные записи хранения Azure для рабочей области также предусмотрены в виртуальной сети, они должны находиться в той же виртуальной сети, что и кластер Azure Databricks.
* В дополнение к подсетям __databricks-private__ и __databricks-public__, используемым Azure Databricks, необходимо также создать подсеть __по умолчанию__ для виртуальной сети.

__Ограничения__

__Конфигурация__

Конкретные сведения об использовании Azure Databricks с виртуальной сетью см. в разделе [Развертывание Azure Databricks в виртуальной сети Azure](https://docs.azuredatabricks.net/administration-guide/cloud-configurations/azure/vnet-inject.html).

<a id="vmorhdi"></a>

## <a name="virtual-machine-or-hdinsight-cluster"></a>Виртуальная машина или кластер HDInsight

__Требования__

* Машинное обучение Azure поддерживает только виртуальные машины под управлением Ubuntu.
* На виртуальной машине или в кластере HDInsight должен быть включен порт SSH.

__Ограничения__

__Конфигурация__

1. Создайте виртуальную машину или кластер HDInsight с помощью портала Azure или Azure CLI, а затем поместите кластер в виртуальную сеть Azure. Дополнительные сведения см. в следующих статьях:

    * [Создание и администрирование виртуальных сетей Azure для виртуальных машин Linux](https://docs.microsoft.com/azure/virtual-machines/linux/tutorial-virtual-network)

    * [Расширение возможностей HDInsight с помощью виртуальной сети Azure](https://docs.microsoft.com/azure/hdinsight/hdinsight-extend-hadoop-virtual-network).

1. Для виртуальных машин Azure на основе Linux автоматически создается NSG. Этот NSG разрешает доступ к порту 22 из любого источника. Если требуется ограничить доступ к порту SSH, необходимо разрешить доступ из Машинное обучение Azure. Чтобы сохранить доступ для машинного обучения Azure, необходимо разрешить доступ из __исходной службы__ с помощью __тега исходной службы__ __азуремачинелеарнинг__. Например, следующие Azure CLI команды изменяют правило SSH, разрешая доступ только из Машинное обучение Azure.

    ```azurecli
    # Get default SSH rule
    nsgrule=$(az network nsg rule list --resource-group myResourceGroup --nsg-name myNetworkSecurityGroup --query [0].name -o tsv)
    # Update network security group rule to limit SSH to source service.
    az network nsg rule update --resource-group myResourceGroup --nsg-name myNetworkSecurityGroupBackEnd \
    --name $nsgrule --protocol tcp --direction inbound --priority 100 \
    --source-address-prefix AzureMachineLearning --source-port-range '*' --destination-address-prefix '*' \
    --destination-port-range 22 --access allow
    ```

    Дополнительные сведения см. в разделе [Создание групп безопасности сети](/azure/virtual-machines/linux/tutorial-virtual-network#create-network-security-groups) в виртуальных сетях Azure для виртуальных машин Linux.
    
    Используйте правила входящего трафика по умолчанию для группы безопасности сети. Дополнительные сведения см. в описании стандартных правил безопасности в статье [о группах безопасности](https://docs.microsoft.com/azure/virtual-network/security-overview#default-security-rules).

1. Подключите виртуальную машину или кластер HDInsight к рабочей области Машинного обучения Azure. Дополнительные сведения вы найдете в статье [Настройка целевых объектов вычислений для обучения моделей](how-to-set-up-training-targets.md).

## <a name="next-steps"></a>Дальнейшие действия

* [Используйте машинное обучение Azure рабочую область за брандмауэром Azure](how-to-access-azureml-behind-firewall.md).
* [Настройка сред обучения](how-to-set-up-training-targets.md)
* [Настройка частных конечных точек](how-to-configure-private-link.md)
* [Где следует развертывать модели](how-to-deploy-and-where.md)
* [Использование TLS для защиты веб-службы с помощью Машинного обучения Azure](how-to-secure-web-service.md).
