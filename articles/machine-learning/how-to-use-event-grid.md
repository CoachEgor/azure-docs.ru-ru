---
title: Создание рабочих процессов машинного обучения на основе событий
titleSuffix: Azure Machine Learning
description: Узнайте, как использовать сетку событий с Машинное обучение Azure для включения решений, управляемых событиями.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: shipatel
author: shivp950
ms.reviewer: larryfr
ms.date: 03/11/2020
ms.openlocfilehash: 2a1440dcda27a487c89be4ac63e624a2bb6b393a
ms.sourcegitcommit: f7d057377d2b1b8ee698579af151bcc0884b32b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2020
ms.locfileid: "82111884"
---
# <a name="create-event-driven-machine-learning-workflows-preview"></a>Создание рабочих процессов машинного обучения на основе событий (Предварительная версия)

Служба " [Сетка событий Azure](https://docs.microsoft.com/azure/event-grid/) " поддерживает события машинное обучение Azure. Вы можете подписываться и использовать такие события, как изменение состояния выполнения, завершение выполнения, регистрация модели, развертывание модели и определение расхождения данных в рабочей области.

Дополнительные сведения о типах событий см. в статье [интеграция машинное обучение Azure с помощью сетки событий](concept-event-grid-integration.md) и [машинное обучение Azure схемы сетки событий](/azure/event-grid/event-schema-machine-learning).

Используйте сетку событий, чтобы включить такие распространенные сценарии, как:

* Отправка сообщений электронной почты при сбое выполнения и завершении выполнения
* Использование функции Azure после регистрации модели
* Потоковая передача событий из Машинное обучение Azure в различные конечные точки
* Запускать конвейер машинного обучения при обнаружении смещения

> [!NOTE] 
> В настоящее время события Рунстатусчанжед запускаются только при **сбое** состояния выполнения
>

## <a name="prerequisites"></a>Предварительные условия
* Участник или владелец доступ к рабочей области Машинное обучение Azure, для которой будут создаваться события.

### <a name="configure-eventgrid-using-the-azure-portal"></a>Настройка EventGrid с помощью портал Azure

1. Откройте [портал Azure](https://portal.azure.com) и перейдите в рабочую область машинное обучение Azure.

1. На панели слева выберите __события__ и щелкните **подписки на события**. 

    ![Селект-евентс-ин-воркспаце. png](./media/how-to-use-event-grid/select-event.png)

1. Выберите тип события для использования. Например, на следующем снимке экрана выбрана __Зарегистрированная модель__, __Развернутая модель__, __выполненная работа__и __обнаружено смещение набора данных__:

    ![Тип добавления события](./media/how-to-use-event-grid/add-event-type-updated.png)

1. Выберите конечную точку, в которую будет опубликовано событие. На следующем снимке экрана __концентратор событий__ является выбранной конечной точкой:

    ![выбор обработчика событий](./media/how-to-use-event-grid/select-event-handler.png)

После подтверждения выбора нажмите кнопку __создать__. После настройки эти события будут отправлены в конечную точку.


### <a name="configure-eventgrid-using-the-cli"></a>Настройка EventGrid с помощью интерфейса командной строки

Можно либо установить последнюю [Azure CLI](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest), либо использовать Azure Cloud Shell, предоставляемый в рамках подписки Azure.

Чтобы установить расширение сетки событий, используйте следующую команду в CLI:

```azurecli-interactive
az add extension --name eventgrid
```

В следующем примере показано, как выбрать подписку Azure и создать новую подписку на события для Машинное обучение Azure:

```azurecli-interactive
# Select the Azure subscription that contains the workspace
az account set --subscription "<name or ID of the subscription>"

# Subscribe to the machine learning workspace.
az eventgrid event-subscription create \
  --name {eventGridFilterName} \
  --source-resource-id "/subscriptions/{subId}/resourceGroups/{rgName}/ \providers/Microsoft.MachineLearningServices/workspaces/{wsName}" \
  --endpoint {event handler endpoint} \
  --included-event-types Microsoft.MachineLearningServices.ModelRegistered \
  --subject-begins-with "models/mymodelname"
```

## <a name="filter-events"></a>Фильтрация событий

При настройке событий можно применять фильтры только для запуска на конкретных данных событий. В приведенном ниже примере для событий изменения состояния выполнения можно выполнить фильтрацию по типам выполнения. Событие активируется только при соблюдении условий. Сведения о данных событий, которые можно фильтровать, см. в [схеме сетки событий машинное обучение Azure](/azure/event-grid/event-schema-machine-learning) . 

1. Перейдите к портал Azure, выберите новую подписку или существующую. 

1. Перейдите на вкладку Фильтры и прокрутите вниз до пункта дополнительные фильтры. Для **ключа** и **значения**укажите типы свойств, по которым требуется выполнить фильтрацию. Здесь можно увидеть, что событие будет запущено только тогда, когда тип запуска является запуском конвейера или этапом конвейера.  

    :::image type="content" source="media/how-to-use-event-grid/select-event-filters.png" alt-text="Фильтрация событий":::

## <a name="sample-send-email-alerts"></a>Пример: отправка оповещений по электронной почте

Используйте [Azure Logic Apps](https://docs.microsoft.com/azure/logic-apps/) , чтобы настроить сообщения электронной почты для всех событий. Настройте с условиями и укажите получателей, чтобы обеспечить совместную работу и осведомленность в разных командах.

1. В портал Azure перейдите в рабочую область Машинное обучение Azure и выберите вкладку события на панели слева. Здесь выберите __Logic Apps (приложения логики__). 

    ![SELECT-Logic-AP](./media/how-to-use-event-grid/select-logic-ap.png)

1. Войдите в пользовательский интерфейс приложения логики и выберите Машинное обучение служба в качестве типа раздела. 

    ![SELECT-Topic-Type](./media/how-to-use-event-grid/select-topic-type.png)

1. Выберите события для уведомления. Например, на следующем снимке экрана __рункомплетед__.

    ![SELECT-Event-рункомплете](./media/how-to-use-event-grid/select-event-runcomplete.png)

1. Можно использовать метод фильтрации в приведенном выше разделе или добавить фильтры, чтобы активировать приложение логики только для подмножества типов событий. На следующем снимке экрана используется __Фильтр префикса__ __/датадрифтид/рунс/__ .

    ![Filter — события](./media/how-to-use-event-grid/filtering-events.png)

1. Затем добавьте шаг для использования этого события и выполните поиск по электронной почте. Существует несколько разных учетных записей почты, которые можно использовать для получения событий. Также можно настроить условия отправки оповещений по электронной почте.

    ![SELECT-email — действие](./media/how-to-use-event-grid/select-email-action.png)

1. Выберите __Отправить сообщение электронной почты__ и заполните параметры. В теме можно включить __Тип события__ и __раздел__ , помогающие отфильтровать события. Также можно включить ссылку на страницу рабочей области для выполнения в тексте сообщения. 

    ![Настройка — текст сообщения](./media/how-to-use-event-grid/configure-email-body.png)

1. Чтобы сохранить это действие, выберите **Сохранить как** в левом углу страницы. На появившейся правой панели Подтвердите создание этого действия.

    ![подтверждение-Logic-App-CREATE](./media/how-to-use-event-grid/confirm-logic-app-create.png)


## <a name="sample-trigger-retraining-when-data-drift-occurs"></a>Пример: повторное обучение триггера при потере данных

Модели со временем устаревают и не остаются полезными в контексте, в котором они выполняются. Одним из способов определить, стоит ли переучить модель, является обнаружение смещения данных. 

В этом примере показано, как использовать службу "Сетка событий" с приложением логики Azure для запуска повторного обучения. В примере конвейер фабрики данных Azure активируется, когда происходит смещение данных между обучением модели и обслуживанием наборов данных.

Перед началом работы выполните следующие действия.

* Настройка монитора набора данных для [обнаружения смещения данных]( https://aka.ms/datadrift) в рабочей области
* Создайте опубликованный [конвейер фабрики данных Azure](https://docs.microsoft.com/azure/data-factory/).

В этом примере простой конвейер фабрики данных используется для копирования файлов в хранилище больших двоичных объектов и запуска опубликованного конвейера Машинное обучение. Дополнительные сведения об этом сценарии см. в [статье настройка машинное обучение шага в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/transform-data-machine-learning-service) .

![ADF-млпипелине-Stage](./media/how-to-use-event-grid/adf-mlpipeline-stage.png)

1. Начните с создания приложения логики. Перейдите в [портал Azure](https://portal.azure.com), выполните поиск по запросу Logic Apps и выберите Создать.

    ![Поиск — Logic-App](./media/how-to-use-event-grid/search-for-logic-app.png)

1. Введите запрошенные сведения. Чтобы упростить работу, используйте ту же подписку и группу ресурсов, что и конвейер фабрики данных Azure, и Машинное обучение Azure рабочую область.

    ![Настройка-Logic-App-for-ADF](./media/how-to-use-event-grid/set-up-logic-app-for-adf.png)

1. После создания приложения логики выберите __при возникновении события ресурса сетки событий__. 

    ![Выбор-событие-сетка-триггер](./media/how-to-use-event-grid/select-event-grid-trigger.png)

1. Войдите в систему и укажите сведения о событии. В качестве __имени ресурса__ укажите имя рабочей области. Задайте для __типа события__ значение __датасетдрифтдетектед__.

    ![имя входа и Добавление события](./media/how-to-use-event-grid/login-and-add-event.png)

1. Добавьте новый шаг и выполните поиск по запросу __фабрики данных Azure__. Выберите __создать запуск конвейера__. 

    ![Create-адфпипелине — запуск](./media/how-to-use-event-grid/create-adfpipeline-run.png)

1. Войдите в систему и укажите опубликованный конвейер фабрики данных Azure для запуска.

    ![Укажите-ADF-конвейер](./media/how-to-use-event-grid/specify-adf-pipeline.png)

1. Сохраните и создайте приложение логики с помощью кнопки **сохранить** в верхнем левом углу страницы. Чтобы просмотреть приложение, перейдите к рабочей области в [портал Azure](https://portal.azure.com) и щелкните **события**.

    ![Отображение логики приложения в веб-перехватчике](./media/how-to-use-event-grid/show-logic-app-webhook.png)

Теперь конвейер фабрики данных активируется при отсмещении. Просмотрите сведения о выполнении смещения данных и конвейера машинного обучения на [новом портале рабочей области](https://ml.azure.com). 

![представление — в рабочей области](./media/how-to-use-event-grid/view-in-workspace.png)

## <a name="sample-deploy-a-model-based-on-tags"></a>Пример. Развертывание модели на основе тегов

Объект модели Машинное обучение Azure содержит параметры, на которых можно выполнить сведение развертываний, таких как имя модели, версия, тег и свойство. Событие регистрации модели может активировать конечную точку, и вы можете использовать функцию Azure для развертывания модели на основе значений этих параметров.

Пример см. в [https://github.com/Azure-Samples/MachineLearningSamples-NoCodeDeploymentTriggeredByEventGrid](https://github.com/Azure-Samples/MachineLearningSamples-NoCodeDeploymentTriggeredByEventGrid) репозитории и выполните действия, описанные в файле **сведений** .

## <a name="next-steps"></a>Дальнейшие шаги

* Дополнительные сведения о доступных событиях см. в описании [схемы событий машинное обучение Azure](/azure/event-grid/event-schema-machine-learning) .
