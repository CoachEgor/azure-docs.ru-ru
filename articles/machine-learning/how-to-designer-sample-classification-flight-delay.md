---
title: 'Конструктор: пример прогнозирования задержки рейсов'
titleSuffix: Azure Machine Learning
description: Создание классификатора и использование настраиваемого кода R для прогнозирования задержки рейсов с помощью конструктора Машинного обучения Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: sample
author: likebupt
ms.author: keli19
ms.reviewer: peterlu
ms.date: 12/25/2019
ms.openlocfilehash: d459350572d68cc5dcbbfd56933483404b94f918
ms.sourcegitcommit: 42517355cc32890b1686de996c7913c98634e348
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2020
ms.locfileid: "76963288"
---
# <a name="build-a-classifier--use-r-to-predict-flight-delays-with-azure-machine-learning-designer"></a>Создание классификатора и использование языка R для прогнозирования задержки рейсов с помощью конструктора Машинного обучения Azure

**Конструктор (предварительная версия) — пример 6**

[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-enterprise-sku.md)]

Этот конвейер прогнозирует, будет ли задержан запланированный пассажирский рейс более чем на 15 минут, на основе исторических сведений о рейсах и метеорологических данных. Здесь можно задействовать подход, применяемый для решения задач классификации. При этом данные прогнозирования разделяются на два класса: сведения о задержке рейсов и сведения о соблюдении расписания.

Вот финальная версия графа конвейера для нашего примера:

[![Граф конвейера](media/how-to-designer-sample-classification-flight-delay/pipeline-graph.png)](media/how-to-designer-sample-classification-flight-delay/pipeline-graph.png#lightbox)

## <a name="prerequisites"></a>Предварительные требования

[!INCLUDE [aml-ui-prereq](../../includes/aml-ui-prereq.md)]

4. Щелкните пример 6, чтобы открыть его.

## <a name="get-the-data"></a>Получение данных

В этом примере используется набор данных о задержке рейсов **Flight Delays Data**. Он входит в коллекцию данных TranStats Министерства транспорта США. В этом наборе данных содержатся сведения о задержке рейсов за период с апреля по октябрь 2013 года. Набор данных предварительно обработан следующим образом:

* Данные отфильтрованы по 70 самым загруженным аэропортам в континентальной части США.
* Отмененные рейсы отмечены как задержанные более чем на 15 минут.
* Рейсы с отклонением удалены.
* Выбрано 14 столбцов.

Сведения о рейсах дополняются набором метеорологических данных **Weather Dataset**. Метеорологические сведения включают данные почасовых наземных метеорологических наблюдений из Национального управления океанических и атмосферных исследований, а также данные наблюдения с метеорологических станций в аэропортах за тот же период, что и набор данных о рейсах. Эти данные предварительно обработаны следующим образом:

* Идентификаторы метеорологических станций сопоставлены с соответствующими идентификаторами аэропортов.
* Сведения с метеорологических станций, не связанных с 70 самыми загруженными аэропортами, были удалены.
* Столбец Date (Дата) разделен на отдельные столбцы: Year (Год), Month (Месяц) и Day (День).
* Выбрано 26 столбцов.

## <a name="pre-process-the-data"></a>Предварительная обработка данных.

Перед анализом, как правило, требуется определенная предварительная обработка набора данных.

![обработка данных](./media/how-to-designer-sample-classification-flight-delay/data-process.png)

### <a name="flight-data"></a>Данные о рейсах

Значения в столбцах **Carrier** (Перевозчик), **OriginAirportID** (Идентификатор аэропорта вылета) и **DestAirportID** (Идентификатор аэропорта прибытия) сохраняются как целые числа. Но это категориальные атрибуты. Преобразуйте их соответствующим образом с помощью модуля **изменения метаданных**.

![изменение метаданных](./media/how-to-designer-sample-classification-flight-delay/edit-metadata.png)

Затем с помощью модуля **выбора столбцов** в наборе данных исключите следующие столбцы, которые могут вызвать утечку целевых данных: **DepDelay**, **DepDel15**, **ArrDelay**, **Canceled**, **Year**. 

Чтобы объединить записи о рейсах с почасовыми метеорологическими записями, используйте время вылета по расписанию как один из ключей объединения. Чтобы выполнить объединение, значения в столбце CSRDepTime нужно округлить в меньшую сторону до ближайшего часа. Это можно сделать в модуле **выполнения скрипта R**. 

### <a name="weather-data"></a>Метеоданные

Столбцы с большим числом отсутствующих значений исключаются с помощью модуля **столбцов проекта**. Сюда входят все столбцы со строковыми значениями: **ValueForWindCharacter**, **WetBulbFarenheit**, **WetBulbCelsius**, **PressureTendency**, **PressureChange**, **SeaLevelPressure** и **StationPressure**.

После этого к оставшимся столбцам применяется модуль **очистки отсутствующих данных**, чтобы удалить строки с отсутствующими данными.

Время метеонаблюдений округляется до ближайшего полного часа. Время запланированного рейса и время метеорологических наблюдений округляется в противоположных направлениях, чтобы гарантировать, что модель использует сведения о времени метеонаблюдений перед сведениями о времени запланированного рейса. 

Так как метеорологические данные передаются по местному времени, разница между часовыми поясами учитывается путем вычитания значения столбцов часовых поясов из запланированного времени вылета и времени метеорологических наблюдений. Эти операции выполняются с помощью модуля **выполнения скрипта R**.

### <a name="joining-datasets"></a>Объединение наборов данных

Записи о рейсах объединяются с метеорологическими данными для аэропорта вылета (**OriginAirportID**) с помощью модуля **объединения данных**.

 ![объединение сведений о рейсах и метеорологических данных по аэропорту вылета](./media/how-to-designer-sample-classification-flight-delay/join-origin.png)


Записи о рейсах объединяются с метеорологическими данными для аэропорта прибытия (**DestAirportID**).

 ![объединение сведений о рейсах и метеорологических данных по аэропорту прибытия](./media/how-to-designer-sample-classification-flight-delay/join-destination.png)

### <a name="preparing-training-and-test-samples"></a>Подготовка примеров для обучения и проверки

Модуль **разделения данных** позволяет разбить данные на записи с апреля по сентябрь для обучения и записи за октябрь для проверки.

 ![Разделение данных для обучения и проверки](./media/how-to-designer-sample-classification-flight-delay/split.png)

Столбцы года, месяца и часового пояса удаляются из обучающего набора данных с помощью модуля выбора столбцов.

## <a name="define-features"></a>Определение признаков

В машинном обучении признаки — это отдельные измеримые свойства интересующих вас объектов. Чтобы определить эффективный набор признаков, требуется экспериментирование и знание предметной области. Некоторые свойства лучше подходят для прогнозирования цели, чем другие. Кроме того, у некоторых признаков может быть сильная взаимосвязь с другими признаками. При этом в модель не будут добавляться новые сведения. Эти признаки можно удалить.

Для создания модели можно использовать все доступные признаки или выбрать подмножество признаков.

## <a name="choose-and-apply-a-learning-algorithm"></a>Выбор и применение алгоритма обучения

Создайте модель с помощью модуля **двухклассовой логистической регрессии** и обучите ее на основе набора данных для обучения. 

В результате применения модуля **обучения модели** создается обученная модель классификации, которую можно использовать для оценки новых значений с целью прогнозирования. Создайте оценки на основе обученных моделей с помощью набора для проверки. Затем проанализируйте и сравните качество моделей с использованием модуля **анализа модели**.
Когда вы запустите конвейер, вы сможете просмотреть выходные данные модуля **оценки модели**. Для этого щелкните порт вывода и включите **визуализацию**. Выходные данные включают оцененные метки и сведения о вероятности для меток.

Наконец, чтобы проверить качество результатов, добавьте модуль **анализа модели** на холст конвейера и подключите левый порт ввода к порту вывода модуля оценки модели. Запустите конвейер и просмотрите выходные данные модуля **анализа модели**. Для этого щелкните порт вывода и включите **визуализацию**.

## <a name="evaluate"></a>Evaluate
В тестовом наборе AUC модели логистической регрессии имеет значение 0,631.

 ![evaluate](media/how-to-designer-sample-classification-flight-delay/sample6-evaluate-1225.png)

## <a name="next-steps"></a>Дальнейшие действия

Изучите другие примеры, доступные для использования с конструктором:

- [Пример 1. Регрессия: прогнозирование цен на автомобили](how-to-designer-sample-regression-automobile-price-basic.md)
- [Пример 2. Регрессия: сравнение алгоритмов для прогнозирования цен на автомобили](how-to-designer-sample-regression-automobile-price-compare-algorithms.md)
- [Пример 3. Классификация с выбором признаков: прогнозирование дохода](how-to-designer-sample-classification-predict-income.md)
- [Пример 4. Классификация: прогнозирование кредитного риска (с учетом затрат)](how-to-designer-sample-classification-credit-risk-cost-sensitive.md)
- [Пример 5. Классификация: прогнозирование оттока клиентов](how-to-designer-sample-classification-churn.md)
- [Пример 7. Классификация текста: набор данных Wikipedia SP 500](how-to-designer-sample-text-classification.md)