---
title: Выполнение сценариев машинного обучения Python
titleSuffix: Azure Machine Learning Studio
description: Узнайте, как использовать Python в студии машинного обучения Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: studio
ms.topic: conceptual
author: xiaoharper
ms.author: amlstudiodocs
ms.custom: previous-author=heatherbshapiro, previous-ms.author=hshapiro
ms.date: 03/12/2019
ms.openlocfilehash: 4b4f3877b56752756050de0af226571ac2a93293
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60750827"
---
# <a name="execute-python-machine-learning-scripts-in-azure-machine-learning-studio"></a>Выполнение сценариев Python в Студии машинного обучения Azure

Python является ценным средством в наборе инструментов многих специалистов по анализу данных. Он используется на каждой стадии рабочие процессы обычно машинного обучения, включая просмотр данных, извлечения признаков, обучение модели и проверки и развертывания.

В этой статье описывается, как можно использовать модуль Execute Python Script использования кода Python в эксперименты в студии машинного обучения и веб-служб.

## <a name="using-the-execute-python-script-module"></a>С помощью модуля Execute Python Script

Основной интерфейс Python в студии – [Execute Python Script] [ execute-python-script] модуля. Она принимает до трех входных данных и выдавать два вида выходных данных, аналогичную [выполнение скрипта R] [ execute-r-script] модуля. Код Python вводится в поле параметра через специально именованной точки входа функции с именем `azureml_main`.

![Запустить модуль сценария Python](./media/execute-python-scripts/execute-machine-learning-python-scripts-module.png)

![Пример кода python в поле параметра модуля](./media/execute-python-scripts/embedded-machine-learning-python-script.png)

### <a name="input-parameters"></a>Входные параметры

Входные данные в модуль Python, представляются как кадры данных Pandas. `azureml_main` Функция принимает до двух необязательно кадров данных Pandas в качестве параметров.

Сопоставление входных портов и параметров функции выполняется по позиционному принципу:

- Первый подключенный входной порт сопоставляется с первым параметром функции.
- Второй входной порт (если он подключен) сопоставляется со вторым параметром функции.
- Третий набор входных данных используется для [импортировать дополнительные модули Python](#import-modules).

Более подробная семантика как сопоставления входных портов с параметрами `azureml_main` функции, показаны ниже.

![Таблица конфигурации порта ввода и итоговую подпись Python](./media/execute-python-scripts/python-script-inputs-mapped-to-parameters.png)

### <a name="output-return-values"></a>Возвращаемые значения выходных данных

`azureml_main` Функция должна возвращать один данных Pandas, содержащийся в Python [последовательности](https://docs.python.org/2/c-api/sequence.html) например кортеж, список или массив NumPy. Первый элемент из этой последовательности возвращается первый выходной порт модуля. Второй выходной порт модуля используется для [визуализации](#visualizations) и не требует возвращаемого значения. Эта схема показана ниже.

![Сопоставление входных портов с параметрами и возвращаемого значения с выходной порт](./media/execute-python-scripts/map-of-python-script-inputs-outputs.png)

## <a name="translation-of-input-and-output-data-types"></a>Преобразование типов входных и выходных данных

Наборы данных Studio не так же, как кадры данных Panda. В результате входных наборов данных студии преобразуются в таблице данных Pandas и выходные кадры данных преобразуются обратно в наборы данных Studio. В ходе этого процесса преобразования также выполняются следующие переводы:

 **Тип данных Python** | **Трансляция Studio** |
| --- | --- |
| Строками и числовыми значениями| Преобразуются как есть |
| Pandas «Н/д» | Установлен статус «Отсутствует значение» |
| Векторы индексов | Не поддерживается * |
| Имена столбцов нестроковые | Вызовите `str` на имена столбцов |
| Повторяющиеся имена столбцов | Добавьте числовой суффикс. (1), (2), (3), и т. д.

**Все кадры входных данных в функции Python будут всегда содержать 64-разрядный числовой индекс от 0 до количества строк минус 1*

## <a id="import-modules"></a>Импорт существующих модулей сценариев Python

Серверная часть, используемая для выполнения Python на основе [Anaconda](https://store.continuum.io/cshop/anaconda/), широко используется дистрибутива Python. Он поставляется с рядом с 200 наиболее распространенные пакеты Python, используемые в ориентированных на данные рабочих нагрузок. Studio не поддерживает использование систем управления пакета, таких как Pip или Conda для установки и управления внешними библиотеками.  Если обнаружится необходимость включать дополнительные библиотеки, используйте следующий сценарий в качестве руководства.

Распространенным вариантом применения является включение существующих сценариев Python в эксперименты Studio. [Execute Python Script] [ execute-python-script] модуль принимает ZIP-файл, содержащий модули Python, на третий входной порт. Этот файл распаковывается во время выполнения в среда выполнения, а его содержимое добавляется в путь к библиотеке интерпретатора Python. После этого функция точки входа `azureml_main` может импортировать эти модули напрямую. 

Рассмотрим в качестве примера файл Hello.py, содержащий простую функцию Hello, World.

![Определяемые пользователем функции в файле Hello.py](./media/execute-python-scripts/figure4.png)

Далее мы создаем файл Hello.zip, содержащий файл Hello.py:

![ZIP-файл, содержащий пользовательский код Python](./media/execute-python-scripts/figure5.png)

Отправьте ZIP-файл в качестве набора данных в студию. Затем создайте и запустите эксперимент, использующий код Python в файле Hello.zip, подключив его к третьему входному порту модуля **Execute Python Script** модуля, как показано на следующем рисунке.

![Пример эксперимента с Hello.zip в качестве входных данных модуль выполнение сценария Python](./media/execute-python-scripts/figure6a.png)

![Пользовательский код Python, загрузить как ZIP-файл](./media/execute-python-scripts/figure6b.png)

В выходных данных модуля можно увидеть, что ZIP-файл был распакован, и функция `print_hello` была выполнена.

![Выходные данные модуля с определяемой пользователем функции](./media/execute-python-scripts/figure7.png)

## <a name="accessing-azure-storage-blobs"></a>Доступ к большим двоичным объектам службы хранилища Azure

Вы сможете использовать данные, хранящиеся в учетную запись хранилища BLOB-объектов Azure, выполнив приведенные ниже действия:

1. Скачайте [пакета хранилища BLOB-объектов Azure для Python](https://azuremlpackagesupport.blob.core.windows.net/python/azure.zip) локально.
1. Загрузите ZIP-файл в рабочую область студии как набор данных.
1. Создайте объект BlobService с `protocol='http'`

```
from azure.storage.blob import BlockBlobService

# Create the BlockBlockService that is used to call the Blob service for the storage account
block_blob_service = BlockBlobService(account_name='account_name', account_key='account_key', protocol='http')
```

1. Отключить **требуется безопасное перемещение** в хранилище **конфигурации** вкладке "Настройка"

![Отключить на портале Azure требуется безопасное перемещение](./media/execute-python-scripts/disable-secure-transfer-required.png)

## <a name="operationalizing-python-scripts"></a>Выполнение сценариев Python

При публикации в качестве веб-службы вызываются любые модули [Execute Python Script][execute-python-script] (Выполнение сценария Python) в оценивающем эксперименте. Например на следующем рисунке показан эксперимент по оценке, содержащий код для оценки одного выражения Python.

![Рабочая область студии для веб-службы](./media/execute-python-scripts/figure3a.png)

![Выражение Python Pandas](./media/execute-python-scripts/python-script-with-python-pandas.png)

Веб-служба, созданная в этом эксперименте бы выполнить следующие действия:

1. Использовать выражение Python качестве входных данных (в виде строки)
1. Отправить выражение Python к интерпретатору Python
1. Возвращает таблицу, содержащую выражение и результат вычисления.

## <a id="visualizations"></a>Работа с визуализациями

Может возвратить созданные с помощью MatplotLib графики [Execute Python Script][execute-python-script]. Однако график не автоматически перенаправляться к изображениям, чем при использовании языка R. Поэтому пользователь должен явным образом сохранить любые графики в PNG-файлы.

Чтобы создавать изображения с помощью MatplotLib, выполните следующие действия.

1. Переключитесь в серверной части «AGG» из модуля подготовки отчетов на базе Qt. по умолчанию.
1. Создайте новый объект рисунка.
1. Получите ось и постройте все графики в него.
1. Сохраните рисунок в PNG-файл.

Этот процесс показан на следующем рисунке, создаваемые с помощью функции scatter_matrix в Pandas матрица точечной диаграммы.

![Код для сохранения фигур MatplotLib для изображений](./media/execute-python-scripts/figure-v1-8.png)

![Щелкните визуализировать на модуле выполнение сценария Python для просмотра данных](./media/execute-python-scripts/figure-v2-9a.png)

![Визуализация графиков, для примера эксперимента, с помощью кода Python](./media/execute-python-scripts/figure-v2-9b.png)

Существует возможность получить несколько рисунков, сохраняя их в разных изображениях. Среда выполнения Studio собирает все изображения и объединяет их для визуализации.

## <a name="advanced-examples"></a>Дополнительные примеры

Среда Anaconda, установленная в Studio содержит общие пакеты, такие как NumPy, SciPy и Scikits-Learn. Эти пакеты можно эффективно использовать для обработки данных в конвейере машинного обучения.

Например в следующем эксперименте и сценарии показано использование объединенных учеников в Scikits-Learn для вычисления оценки важности компонента для набора данных. Показатели можно использовать для выполнения контролируемого выбора компонентов перед передачей в другой модели.

Ниже показана функция Python, используемая для вычисления оценки важности и упорядочивания компонентов на основе этой оценки:

![Функции по ранжированию компонентов с оценок](./media/execute-python-scripts/figure8.png)

Затем следующий эксперимент вычисляет и возвращает оценки важности компонентов в наборе данных "Диабет у индейцев пима" в Студии машинного обучения Azure.

![Эксперимент по ранжированию компонентов в наборе данных диабет у Индейцев Пима, с помощью Python](./media/execute-python-scripts/figure9a.png)

![Визуализация вывода модуля Execute Python Script](./media/execute-python-scripts/figure9b.png)

## <a name="limitations"></a>Ограничения

[Execute Python Script] [ execute-python-script] модуль в настоящее время имеет следующие ограничения:

### <a name="sandboxed-execution"></a>Выполнение в изолированном режиме

Среда выполнения Python хранятся в настоящее время в изолированной среде и не разрешает доступ к сети или локальной файловой системы в сохраняемом виде. Все файлы, сохраненные локально, изолированы и удаляются после завершения выполнения модуля. С помощью кода Python нельзя получить доступ к большинству каталогов на компьютере, на котором он выполняется, за исключением текущего каталога и его подкаталогов.

### <a name="lack-of-sophisticated-development-and-debugging-support"></a>Отсутствие сложных разработки и поддержку отладки

В настоящее время модуль Python не поддерживает возможности интегрированной среды разработки, такие как Intellisense и отладка. Кроме того, при сбое модуля во время выполнения доступен полный стек трассировки Python. Его необходимо просматривать в журнале выходных данных для модуля. Сейчас мы советуем вам разрабатывать и отлаживать сценарии Python в таких средах, как IPython, а затем импортировать код в модуль.

### <a name="single-data-frame-output"></a>Выходной кадр данных Single

Точке входа Python разрешено возвращать только один кадр данных в качестве выходных данных. Не сейчас невозможно возвращать такие произвольные объекты Python как обученные модели, непосредственно Studio среду выполнения. Как и в модуле [Execute R Script][execute-r-script] (Выполнить сценарий R) с такими же ограничениями, во многих случаях возможно поместить объект в массив байтов, а затем возвратить его в кадр данных.

### <a name="inability-to-customize-python-installation"></a>Невозможность настроить установку Python

Сейчас единственный возможный способ добавить пользовательские модули Python — применение механизма с использованием ZIP-файла, описанного выше. Хотя это возможно в небольших модулей, он не подходит для больших модулей (особенно модули с встроенными библиотеками DLL) или большого количества модулей.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительную информацию можно найти в [Центре разработчика Python](https://azure.microsoft.com/develop/python/).

<!-- Module References -->
[execute-python-script]: https://docs.microsoft.com/azure/machine-learning/studio-module-reference/execute-python-script
[execute-r-script]: https://docs.microsoft.com/azure/machine-learning/studio-module-reference/execute-r-script