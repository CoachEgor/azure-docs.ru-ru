---
title: Выполнение скриптов Python
titleSuffix: ML Studio (classic) - Azure
description: Узнайте, как использовать модуль Execute Python Script для использования кода Python в экспериментах Machine Learning Studio (классических) и веб-сервисах.
services: machine-learning
ms.service: machine-learning
ms.subservice: studio
ms.topic: conceptual
author: likebupt
ms.author: keli19
ms.custom: previous-author=heatherbshapiro, previous-ms.author=hshapiro
ms.date: 03/12/2019
ms.openlocfilehash: c79f6bd63fa5d8d8c6b22ff271d8ca513a94fd64
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79218081"
---
# <a name="execute-python-machine-learning-scripts-in-azure-machine-learning-studio-classic"></a>Выполнение скриптов машинного обучения Python в студии машинного обучения Azure (классический)

[!INCLUDE [Notebook deprecation notice](../../../includes/aml-studio-notebook-notice.md)]

Python является ценным инструментом в сундуке инструмента многих ученых данных. Он используется на каждом этапе типичных рабочих процессов машинного обучения, включая исследование данных, извлечение функций, обучение модели и проверку, а также развертывание.

В этой статье описывается, как можно использовать модуль Execute Python Script для использования кода Python в своих экспериментах (классических) и веб-сервисах Azure Machine Learning Studio (классических).

## <a name="using-the-execute-python-script-module"></a>Использование модуля «Выполнить сценарий Python»

Основной интерфейс Python в studio (классический) находится через модуль [Execute Python Script.][execute-python-script] Он принимает до трех входов и производит до двух выходов, похожих на модуль [Execute R Script.][execute-r-script] Код Python вводится в параметр-поле через специально `azureml_main`названную функцию начальной точки под названием.

![Выполнить модуль Python Script](./media/execute-python-scripts/execute-machine-learning-python-scripts-module.png)

![Пример кода питона в коробке параметров модуля](./media/execute-python-scripts/embedded-machine-learning-python-script.png)

### <a name="input-parameters"></a>Входные параметры

Входы в модуль Python подвергаются воздействию Pandas DataFrames. Функция `azureml_main` принимает до двух дополнительных Pandas DataFrames в качестве параметров.

Сопоставление входных портов и параметров функции выполняется по позиционному принципу:

- Первый подключенный входной порт сопоставляется с первым параметром функции.
- Второй входной порт (если он подключен) сопоставляется со вторым параметром функции.
- Третий вход используется для [импорта дополнительных модулей Python.](#import-modules)

Ниже приведены более подробные семантики того, `azureml_main` как порты ввода отображаются к параметрам функции.

![Таблица конфигураций порта ввода и полученная подпись Python](./media/execute-python-scripts/python-script-inputs-mapped-to-parameters.png)

### <a name="output-return-values"></a>Значения возврата вывода

Функция `azureml_main` должна вернуть один Pandas DataFrame, упакованный в [последовательность](https://docs.python.org/2/c-api/sequence.html) Python, такую как туляк, список или массив NumPy. Первый элемент этой последовательности возвращается в первый выходной порт модуля. Второй выходной порт модуля используется для [визуализации](#visualizations) и не требует значения возврата. Эта схема приведена ниже.

![Отображение входных портов к параметрам и значение возврата в выходной порт](./media/execute-python-scripts/map-of-python-script-inputs-outputs.png)

## <a name="translation-of-input-and-output-data-types"></a>Перевод типов входных и выходных данных

Наборы данных студии не совпадают с Panda DataFrames. В результате наборы входных данных в Studio (классические) преобразуются в Pandas DataFrame, а выходные DataFrames преобразуются обратно в наборы данных Studio (классические). В процессе преобразования также выполняются следующие переводы:

 **Тип данных python** | **Процедура студийного перевода** |
| --- | --- |
| Строки и цифры| Перевод как есть |
| Панды 'NA' | Перевод как «Недостающая ценность» |
| Векторы индексов | Неподдерживается |
| Имена столбцов без строк | Звоните `str` по именам столбцов |
| Дублирование названий столбцов | Добавить числовый суффикс: (1), (2), (3) и так далее.

**Все рамки входных данных в функции Python всегда имеют 64-битный численный индекс от 0 до числа строк минус 1*

## <a name="importing-existing-python-script-modules"></a><a id="import-modules"></a>Импорт существующих модулей сценариев Python

Бэкэнд, используемый для выполнения Python, основан на [Anaconda](https://www.anaconda.com/distribution/), широко используемом научном распределении Python. Он поставляется с почти 200 наиболее распространенными пакетами Python, используемыми в рабочих нагрузках, ориентированных на данные. Студия (классика) в настоящее время не поддерживает использование систем управления пакетами, таких как Pip или Conda для установки и управления внешними библиотеками.  Если вы обнаружите необходимость включения дополнительных библиотек, используйте следующий сценарий в качестве руководства.

Общим примером использования является включение существующих скриптов Python в студийные (классические) эксперименты. Модуль [Execute Python Script][execute-python-script] принимает почтовый файл, содержащий модули Python в третьем порту ввода. Этот файл распаковывается во время выполнения в среда выполнения, а его содержимое добавляется в путь к библиотеке интерпретатора Python. После этого функция точки входа `azureml_main` может импортировать эти модули напрямую. 

В качестве примера рассмотрим файл Hello.py, содержащий простую функцию "Здравствуйте, мир".

![Функция, определяемая пользователем в Hello.py файле](./media/execute-python-scripts/figure4.png)

Далее мы создаем файл Hello.zip, содержащий файл Hello.py:

![Файл, содержащий код Python, определенный пользователем](./media/execute-python-scripts/figure5.png)

Загрузите почтовый файл в виде набора данных в Studio (классический). Затем создайте и запустите эксперимент, который использует код Python в файле Hello.zip, прикрепив его к третьему входном порту модуля **Execute Python Script,** как показано на следующем изображении.

![Пример эксперимента с Hello.zip в качестве ввода в модуль Execute Python Script](./media/execute-python-scripts/figure6a.png)

![Код Python, определяемый пользователем, загруженный в виде почтового файла](./media/execute-python-scripts/figure6b.png)

В выходных данных модуля можно увидеть, что ZIP-файл был распакован, и функция `print_hello` была выполнена.

![Вывод модуля с указанием функции, определяемой пользователем](./media/execute-python-scripts/figure7.png)

## <a name="accessing-azure-storage-blobs"></a>Доступ к блокиции хранения Azure

С помощью следующих шагов можно получить доступ к данным, хранящимся в учетной записи хранилища Azure Blob Storage:

1. Загрузите [пакет хранилища Azure Blob для Python](https://azuremlpackagesupport.blob.core.windows.net/python/azure.zip) локально.
1. Загрузите почтовый файл в рабочее пространство Studio (классическое) в качестве набора данных.
1. Создайте объект BlobService с`protocol='http'`

```
from azure.storage.blob import BlockBlobService

# Create the BlockBlockService that is used to call the Blob service for the storage account
block_blob_service = BlockBlobService(account_name='account_name', account_key='account_key', protocol='http')
```

1. Отключить **безопасную передачу, требуемую** во вкладке **настройки настройки настройки** настройки хранилища

![Отогивание безопасной передачи требуется на портале Azure](./media/execute-python-scripts/disable-secure-transfer-required.png)

## <a name="operationalizing-python-scripts"></a>Выполнение сценариев Python

При публикации в качестве веб-службы вызываются любые модули [Execute Python Script][execute-python-script] (Выполнение сценария Python) в оценивающем эксперименте. Например, на рисунке ниже показан скоринговый эксперимент, содержащий код для оценки одного выражения Python.

![Студия рабочего пространства для веб-сервиса](./media/execute-python-scripts/figure3a.png)

![Выражение python Pandas](./media/execute-python-scripts/python-script-with-python-pandas.png)

Веб-служба, созданная в результате этого эксперимента, будет предпринимать следующие действия:

1. Возьмите выражение Python в качестве ввода (как строка)
1. Отправить выражение Python переводчику Python
1. Возвращает таблицу, содержащую как выражение, так и оцениваемый результат.

## <a name="working-with-visualizations"></a><a id="visualizations"></a>Работа с визуализациями

Участки, созданные с помощью MatplotLib, могут быть возвращены [сценарием Execute Python.][execute-python-script] Однако сюжеты не перенаправляются автоматически на изображения, как при использовании R. Таким образом, пользователь должен явно сохранять любые участки в файлах PNG.

Для создания изображений из MatplotLib необходимо предпринять следующие шаги:

1. Переключите бэкэнд на "AGG" с рендера на основе по умолчанию.
1. Создайте новый объект фигуры.
1. Получить оси и генерировать все участки в нее.
1. Сохраните фигуру в файле PNG.

Этот процесс проиллюстрирован на следующих изображениях, которые создают матрицу рассеяния с использованием функции scatter_matrix в пандах.

![Код для сохранения фигурОк MatplotLib для изображений](./media/execute-python-scripts/figure-v1-8.png)

![Нажмите на визуализацию модуля Execute Python Script для просмотра цифр](./media/execute-python-scripts/figure-v2-9a.png)

![Визуализация участков для образца эксперимента с использованием кода Python](./media/execute-python-scripts/figure-v2-9b.png)

Можно вернуть несколько цифр, сохранив их в разных изображениях. Студия (классический) время выполнения подбирает все изображения и конкатирует их для визуализации.

## <a name="advanced-examples"></a>Дополнительные примеры

Среда Anaconda, установленная в Studio (классическая), содержит общие пакеты, такие как NumPy, SciPy и Scikits-Learn. Эти пакеты могут быть эффективно использованы для обработки данных в конвейере машинного обучения.

Например, следующий эксперимент и сценарий иллюстрируют использование учащихся ансамблей в Scikits-Learn для вычисления оценок значимости объектов для набора данных. Оценки могут быть использованы для выполнения контролируемого выбора функций, прежде чем подается в другую модель.

Ниже показана функция Python, используемая для вычисления оценки важности и упорядочивания компонентов на основе этой оценки:

![Функция ранжирования объектов по баллам](./media/execute-python-scripts/figure8.png)

Следующий эксперимент затем вычисляет и возвращает значение оценки функций в "Pima индийский диабет" набор данных в Azure Machine Learning Studio (классический):

![Эксперимент по ранжировать функции в наборе данных Pima Indian Diabetes с помощью Python](./media/execute-python-scripts/figure9a.png)

![Визуализация вывода модуля сценария выполнения Python](./media/execute-python-scripts/figure9b.png)

## <a name="limitations"></a>Ограничения

Модуль [Execute Python Script][execute-python-script] в настоящее время имеет следующие ограничения:

### <a name="sandboxed-execution"></a>Песочница исполнения

Время выполнения Python в настоящее время песочнице и не позволяет получить доступ к сети или локальной файловой системе в постоянном порядке. Все файлы, сохраненные локально, изолированы и удаляются после завершения выполнения модуля. С помощью кода Python нельзя получить доступ к большинству каталогов на компьютере, на котором он выполняется, за исключением текущего каталога и его подкаталогов.

### <a name="lack-of-sophisticated-development-and-debugging-support"></a>Отсутствие сложной поддержки разработки и отладки

 В настоящее время модуль Python не поддерживает возможности интегрированной среды разработки, такие как Intellisense и отладка. Кроме того, при сбое модуля во время выполнения доступен полный стек трассировки Python. Его необходимо просматривать в журнале выходных данных для модуля. Сейчас мы советуем вам разрабатывать и отлаживать сценарии Python в таких средах, как IPython, а затем импортировать код в модуль.

### <a name="single-data-frame-output"></a>Выход единого кадра данных

 Точке входа Python разрешено возвращать только один кадр данных в качестве выходных данных. В настоящее время невозможно вернуть произвольные объекты Python, такие как обученные модели непосредственно обратно в studio (классическое) время выполнения. Как и в модуле [Execute R Script][execute-r-script] (Выполнить сценарий R) с такими же ограничениями, во многих случаях возможно поместить объект в массив байтов, а затем возвратить его в кадр данных.

### <a name="inability-to-customize-python-installation"></a>Неспособность настроить установку Python

Сейчас единственный возможный способ добавить пользовательские модули Python — применение механизма с использованием ZIP-файла, описанного выше. Хотя это возможно для небольших модулей, это громоздким для больших модулей (особенно модулей с родной DLLs) или большое количество модулей.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительную информацию можно найти в [Центре разработчика Python](https://azure.microsoft.com/develop/python/).

<!-- Module References -->
[execute-python-script]: https://docs.microsoft.com/azure/machine-learning/studio-module-reference/execute-python-script
[execute-r-script]: https://docs.microsoft.com/azure/machine-learning/studio-module-reference/execute-r-script
