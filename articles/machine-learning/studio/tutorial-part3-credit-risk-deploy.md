---
title: Руководство 3. Развертывание модели кредитных рисков
titleSuffix: ML Studio (classic) - Azure
description: Подробный учебник по созданию решения прогнозной аналитики для оценки кредитных рисков в классической версии Студии машинного обучения Azure. Это руководство представляет собой третью, заключительную часть серии руководств. В нем описывается развертывание модели в качестве веб-службы.
keywords: credit risk, predictive analytics solution,risk assessment, deploy, web service
author: sdgilley
ms.author: sgilley
services: machine-learning
ms.service: machine-learning
ms.subservice: studio
ms.topic: tutorial
ms.date: 02/11/2019
ms.openlocfilehash: 4e8e8a114a06029ef9a81d92b60afd575bc9661f
ms.sourcegitcommit: 35715a7df8e476286e3fee954818ae1278cef1fc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/08/2019
ms.locfileid: "73839483"
---
# <a name="tutorial-3-deploy-credit-risk-model---azure-machine-learning-studio-classic"></a>Руководство 3. Развертывание модели кредитных рисков в Студии машинного обучения Azure (классической)

В этом руководстве подробно описывается процесс разработки решения прогнозной аналитики. Мы создадим в Студии машинного обучения (классической) простую модель,  а затем развернем ее в качестве веб-службы машинного обучения Azure.  Эта развернутая модель позволяет создавать прогнозы на основе новых данных. Это руководство представляет собой **третью, заключительную часть серии руководств**.

Предположим, требуется спрогнозировать кредитный риск претендентов на кредит на основе сведений, которые они предоставляют в заявке на кредит.  

Оценка кредитных рисков — это сложная задача. Мы немного упростим ее для этого руководства. На примере этой задачи вы создадите решение прогнозной аналитики с помощью Студии машинного обучения Microsoft Azure (классической). Для этого вы используете классическую версию Студии машинного обучения Azure и веб-службу машинного обучения. 

В этом руководстве из трех частей описание начинается с общедоступных данных по кредитным рискам.  Затем необходимо разработать и обучить модель прогнозирования.  и, наконец, развернете модель в качестве веб-службы.

В [первой части учебника](tutorial-part1-credit-risk.md) вы создали рабочую область Студии машинного обучения (классической), отправили в нее данные и создали эксперимент.

[Вторая часть руководства](tutorial-part2-credit-risk-train.md) посвящена обучению и оценке моделей.

В этой части руководства вы выполните следующие действия:

> [!div class="checklist"]
> * Подготовка к развертыванию
> * Развертывание веб-службы
> * Тестирование веб-службы
> * Управление веб-службой
> * Доступ к веб-службе

## <a name="prerequisites"></a>Предварительные требования

Выполните действия, описанные во [второй части этого руководства](tutorial-part2-credit-risk-train.md).

## <a name="prepare-for-deployment"></a>Подготовка к развертыванию
Чтобы другие пользователи могли применить модель прогнозирования, созданную с помощью этого руководства, ее можно развернуть как веб-службу в Azure.

Вплоть до этого момента вы экспериментировали с обучением модели. Но развернутая служба больше не будет обучаться. Теперь она создает новые прогнозы на основе нашей модели, оценивая введенные пользователем данные. Поэтому мы собираемся выполнить некоторую подготовку для преобразования этого эксперимента из ***обучающего*** в ***прогнозный***. 

Подготовка к развертыванию проводится в три этапа:  

1. Удаление одной из моделей
1. Преобразование *обучающего эксперимента* в *прогнозный эксперимент*
1. Развертывание прогностического эксперимента в качестве веб-службы

### <a name="remove-one-of-the-models"></a>Удаление одной из моделей

Прежде всего необходимо немного сократить этот эксперимент. Сейчас в эксперименте есть две разные модели, но для развертывания в качестве веб-службы используется только одна.  

Допустим, вы решили, что модель дерева с усилением подходит для эксперимента лучше, чем модель опорных векторов. Поэтому сначала мы удалим модуль [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов) и все модули, которые использовались для его обучения. Сначала создайте копию эксперимента, нажав кнопку **Сохранить как** в нижней части полотна эксперимента.

Необходимо удалить следующие модули:  

* [Two-Class Support Vector Machine][two-class-support-vector-machine] (Двухклассовый метод опорных векторов);
* модули [Train Model][train-model] (Обучение модели) и [Score Model][score-model] (Оценка модели), которые были к нему подключены;
* оба модуля [Normalize Data][normalize-data] (Нормализация данных);
* [Evaluate Model][evaluate-model] (Анализ модели) — так как процесс анализа уже завершен.

Поочередно выберите каждый из этих модулей и нажмите клавишу DELETE или щелкните модуль правой кнопкой мыши и выберите **Delete** (Удалить). 

![Выделяет, какие модули необходимо удалить, чтобы удалить модель метода опорных векторов.](./media/tutorial-part3-credit-risk-deploy/publish3a.png)

Теперь ваша модель должна выглядеть примерно так:

![Итог эксперимента, когда модель метода опорных векторов удалена.](./media/tutorial-part3-credit-risk-deploy/publish3.png)

Теперь мы готовы к развертыванию этой модели с использованием модуля [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево принятия решений).

### <a name="convert-the-training-experiment-to-a-predictive-experiment"></a>Преобразование обучающего эксперимента в прогностический эксперимент

Чтобы подготовить модель к развертыванию, следует преобразовать обучающий эксперимент в прогнозный. Этот процесс состоит из трех этапов.

1. Сохраните обученную модуль и замените обучающие модули.
1. удаление из эксперимента модулей, которые были необходимы только для обучения;
1. Определение расположений для получения входных данных и создания выходных данных веб-службы.

Эти действия можно выполнять вручную. Вы также можете выполнить все три шага автоматически. Для этого щелкните в нижней части холста эксперимента **Set Up Web Service** (Настроить веб-службу) и выберите **Predictive Web Service** (Прогнозная веб-служба).

> [!TIP]
> Процесс преобразования обучающего эксперимента в прогнозный эксперимент см. в статье [How to prepare your model for deployment in Azure Machine Learning Studio (classic)](convert-training-experiment-to-scoring-experiment.md) (Подготовка модели к развертыванию в Студии машинного обучения Azure (классической)).

При щелчке **Set Up Web Service**(Настроить веб-службу) происходит следующее.

* Обученная модель сохраняется как отдельный модуль **Trained Model** (Обученная модель) и доступна в палитре модулей слева от холста эксперимента (в разделе **Trained Models** (Обученные модели)).
* Удаляются следующие модули, которые мы использовали для обучения:
  * [Two-Class Boosted Decision Tree][two-class-boosted-decision-tree] (Двухклассовое увеличивающееся дерево принятия решений);
  * [Train Model][train-model] (Обучение модели);
  * [Split Data][split] (Разделение данных);
  * второй модуль [Execute R Script][execute-r-script] (Выполнение скрипта R), который использовался для тестовых данных.
* Сохраненная обученная модель добавляется обратно в эксперимент.
* Добавляются модули **Web service input** (Входные данные веб-службы) и **Web service output** (Выходные данные веб-службы). Они определяют, откуда поступают пользовательские данные при обращении к веб-службе и какие данные возвращаются.

> [!NOTE]
> Как можно заметить, эксперимент сохраняется на двух вкладках, которые добавляются в верхней части холста эксперимента. Исходный обучающий эксперимент теперь размещается на вкладке **Training experiment** (Обучающий эксперимент), а только что созданный прогнозный эксперимент — на вкладке **Predictive experiment** (Прогнозный эксперимент). В качестве веб-службы следует развертывать именно прогнозный эксперимент.

С этим экспериментом необходимо выполнить одно дополнительное действие.
Ранее вы добавили два модуля [Execute R Script][execute-r-script] (Выполнение скрипта R), чтобы реализовать функцию взвешивания данных. Это необходимо только для обучения и тестирования, поэтому из итоговой модели эти модули можно удалить.
Студия машинного обучения (классическая) уже удалила один из модулей [Execute R Script][execute-r-script] (Выполнение скрипта R) при удалении модуля [Split Data][split] (Разделение данных). Теперь можно удалить второй модуль и подключить модуль [Metadata Editor][metadata-editor] (Редактор метаданных) непосредственно к модулю [Score Model][score-model] (Оценка модели).    

Теперь наш эксперимент должен выглядеть следующим образом:  

![Оценка обученной модели](./media/tutorial-part3-credit-risk-deploy/publish4.png)


> [!NOTE]
> Возможно, вас удивляет, почему мы оставили набор данных UCI German Credit Card Data в прогнозном эксперименте. Служба будет использовать только данные пользователя. Изначальный набор данных больше не используется, зачем же оставлять его в модели?
> 
> Действительно, службе не нужны исходные данные кредитных карт. Но по-прежнему нужна схема для этих данных, включающая такие сведения, как общее число столбцов, а также какие столбцы являются числовыми. Эти данные схемы необходимы для интерпретации пользовательских данных. Эти компоненты остаются подключенными, чтобы при запуске службы модуль оценки имел схему набора данных. Данные не используются, используется только схема.  
> 
>Важно отметить, что если ваш исходный набор данных содержал метку, то ожидаемая схема из веб-входа также ожидает столбец с меткой! Прежде чем подключать веб-вход и набор данных для обучения в общий модуль, нужно удалить метку и любые другие данные, которые были в наборе для обучения, но не будут находиться в веб-входах. 
> 

Запустите эксперимент в последний раз (нажмите **Выполнить**). Чтобы убедиться в том, что модуль по-прежнему работает, щелкните выходные данные модуля [Score Model][score-model] (Оценка модели) и выберите **View Results** (Просмотреть результаты). Вы увидите, что изначальные данные отображаются вместе со значением кредитного риска (расчетные метки) и оценочным значением вероятности (расчетные вероятности). 

## <a name="deploy-the-web-service"></a>Развертывание веб-службы
Эксперимент можно развернуть в виде классической веб-службы или новой веб-службы на основе Azure Resource Manager.

### <a name="deploy-as-a-classic-web-service"></a>Развертывание в виде классической веб-службы
Чтобы развернуть классическую веб-службу на основе нашего эксперимента, щелкните **Deploy Web Service** (Развернуть веб-службу) под холстом и выберите пункт **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]). Студия машинного обучения (классическая) развернет эксперимент как веб-службу и откроет панель мониторинга для этой веб-службы. Отсюда можно вернуться к эксперименту (**View snapshot** (Просмотр моментального снимка) или **View latest** (Просмотр последних)) и выполнить простой тест веб-службы (см. раздел **Тестирование веб-службы** ниже). На этой странице также приведены сведения о создании приложений, которые могут обращаться к веб-службе (подробнее об этом в следующем шаге руководства).

![Панель мониторинга веб-службы](./media/tutorial-part3-credit-risk-deploy/publish6.png)


Службу можно настраивать на вкладке **КОНФИГУРАЦИЯ** . На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также задать более удобочитаемые метки для входных и выходных данных.  

![Настройка веб-службы](./media/tutorial-part3-credit-risk-deploy/publish5.png)


### <a name="deploy-as-a-new-web-service"></a>Развертывание в качестве новой веб-службы

> [!NOTE] 
> Для развертывания новой веб-службы у вас должен быть достаточный уровень разрешений в подписке, в которую выполняется развертывание веб-службы. Дополнительные сведения см. в статье [Управление веб-службой с помощью портала веб-служб машинного обучения Azure](manage-new-webservice.md). 

Чтобы развернуть новую веб-службу на основе нашего эксперимента, выполните следующее.

1. Щелкните под холстом действие **Deploy Web Service** (Развернуть веб-службу) и выберите **Deploy Web Service [New]** (Развернуть веб-службу [новую]). Студия машинного обучения (классическая) направит вас на страницу **развертывания эксперимента** в веб-службах Машинного обучения Azure.

1. Введите имя этой веб-службы. 

1. Выберите **план ценообразования** в списке существующих планов. Также можно нажать кнопку "Create new" (Создать), а затем ввести имя и выбрать вариант ежемесячной оплаты для нового плана. По умолчанию указаны уровни плана для вашего региона по умолчанию, и веб-служба развертывается именно в этом регионе.

1. Щелкните **Развернуть**.

Через несколько минут откроется **страница быстрого запуска** для новой веб-службы.

Службу можно настраивать на вкладке **Configure** (Конфигурация). Здесь вы можете изменить заголовок службы или ввести для нее описание. 

Чтобы проверить работу веб-службы, щелкните вкладку **Test** (Тестирование) (см. раздел **Тестирование веб-службы** ниже). Чтобы получить сведения о создании приложений, которые могут обращаться к веб-службе, щелкните вкладку **Consume** (Использование) (дополнительные сведения см. в следующем шаге этого руководства).

> [!TIP]
> После развертывания веб-службы ее можно обновить. Например, если требуется скорректировать модель, измените обучающий эксперимент, настройте параметры модели и нажмите кнопку **Deploy Web Service** (Развернуть веб-службу), а затем выберите вариант **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]) или **Deploy Web Service [New]** (Развернуть веб-службу [новую]). При повторном развертывании эксперимента веб-служба заменяется обновленной моделью.  
> 
> 

## <a name="test-the-web-service"></a>Тестирование веб-службы

При обращении к веб-службе пользовательские данные поступают в модуль **Web service input** (Входные данные веб-службы), а оттуда передаются для оценки в модуль [Score Model][score-model] (Оценка модели). Прогнозный эксперимент настроен так, чтобы модель ожидала поступления данных в том же формате, в котором был исходный набор данных о кредитных рисках.
Результаты возвращаются из веб-службы пользователю через модуль **Web service output** (Выходные данные веб-службы).

> [!TIP]
> Прогнозный эксперимент настроен так, чтобы из модуля [Score Model][score-model] (Оценка модели) возвращались полные результаты. Они включают все входные данные, а также значение кредитного риска и оценку вероятности. Но если нужно, вы можете возвращать что-нибудь другое, например только значение кредитного риска. Для этого добавьте модуль [Select Columns][select-columns] (Выбор столбцов) между модулями [Score Model][score-model] (Оценка модели) и **Web service output** (Выходные данные веб-службы), чтобы исключить ненужные столбцы из возвращаемых данных веб-службы. 
> 
> 

Классическую веб-службу можно протестировать в **Студии машинного обучения (классической)** или на портале **веб-служб Машинного обучения Azure**.
Новую веб-службу можно протестировать только на портале **веб-служб машинного обучения Azure**.

> [!TIP]
> При тестировании на портале веб-служб машинного обучения Azure можно подготовить с помощью портала образец данных для проверки службы "запрос-ответ". Для этого на странице **Настройка** выберите "Да" для параметра **Sample Data Enabled?** (Использовать образец данных?). Теперь, когда вы откроете вкладку "Запрос-ответ" на странице **Тестирование**, портал создаст образец данных на основе исходного набора данных о кредитных рисках.

### <a name="test-a-classic-web-service"></a>Тестирование классической веб-службы

Классическую веб-службу можно протестировать в Студии машинного обучения (классической) или на портале веб-служб Машинного обучения Azure. 

#### <a name="test-in-machine-learning-studio-classic"></a>Тестирование в Студии машинного обучения (классической)

1. На странице **DASHBOARD** (Панель мониторинга) нажмите кнопку **Test** (Тестировать) в разделе **Default Endpoint** (Конечная точка по умолчанию). Появится диалоговое окно, предлагающее ввести входные данные для службы. Это те же столбцы, которые были в исходном наборе данных о кредитных рисках.  

1. Введите набор данных и нажмите кнопку **ОК**. 

#### <a name="test-in-the-machine-learning-web-services-portal"></a>Тестирование на портале веб-служб машинного обучения

1. На странице **DASHBOARD** (Панель мониторинга) нажмите кнопку **Test preview** (Предварительный просмотр теста) в разделе **Default Endpoint** (Конечная точка по умолчанию). На портале веб-служб машинного обучения Azure откроется страница тестирования конечной точки веб-службы, где будет предложено ввести входные данные для службы. Это те же столбцы, которые были в исходном наборе данных о кредитных рисках.

2. Щелкните **Test Request-Response** (Тестировать "запрос-ответ"). 

### <a name="test-a-new-web-service"></a>Тестирование новой веб-службы

Новую веб-службу можно протестировать только на портале веб-служб машинного обучения Azure.

1. На портале [веб-служб машинного обучения Azure](https://services.azureml.net/quickstart) щелкните **Test** (Тестировать) в верхней части страницы. Откроется страница **Test** (Тестирование), на которой можно ввести данные для службы. Отображаемые поля ввода соответствуют столбцам, которые существовали в исходном наборе данных о кредитных рисках. 

1. Введите набор данных и щелкните **Test Request-Response**(Тестировать "запрос-ответ").

Результаты теста отображаются в правой части страницы, в столбце выходных данных. 


## <a name="manage-the-web-service"></a>Управление веб-службой

Развернутой веб-службой (классической или новой) можно управлять с помощью портала [веб-служб Машинного обучения Microsoft Azure](https://services.azureml.net/quickstart).

Вот как можно отслеживать производительность веб-службы.

1. Войдите на портал [веб-служб Машинного обучения Microsoft Azure](https://services.azureml.net/quickstart).
1. Щелкните **Веб-службы**.
1. Щелкните нужную веб-службу.
1. Щелкните **Панель мониторинга**.

## <a name="access-the-web-service"></a>Доступ к веб-службе

На предыдущем шаге этого руководства вы развернули веб-службу, использующую модель прогнозирования кредитных рисков. Теперь пользователи могут отправлять в нее данные и получать результаты. 

Это веб-служба Azure, которая может получать и возвращать данные с помощью REST API одним из двух способов:  

* **Запрос и ответ** — пользователь отправляет одну или несколько строк данных о кредитах в службу с помощью протокола HTTP, а служба в качестве ответа возвращает один или несколько наборов результатов.
* **Пакетное выполнение** — пользователь сохраняет одну или несколько строк данных о кредитах в BLOB-объекте Azure, а затем отправляет адрес BLOB-объекта в Azure. Служба оценивает все строки данных во входном BLOB-объекте, сохраняет результаты в другом BLOB-объекте и возвращает URL-адрес данного контейнера.  

Быстрее и проще всего получить доступ к классической веб-службе через [веб-приложение службы "запрос-ответ" машинного обучения Azure](https://azure.microsoft.com/marketplace/partners/microsoft/azuremlaspnettemplateforrrs/) или [шаблон веб-приложения службы пакетного выполнения машинного обучения Azure](https://azure.microsoft.com/marketplace/partners/microsoft/azuremlbeswebapptemplate/).

С помощью шаблонов веб-служб можно создать пользовательское веб-приложение, которое "знает" входные данные вашей веб-службы и ожидаемые результаты. Вам нужно всего лишь предоставить доступ к веб-службе и данным, а шаблон выполнит все остальные действия.

Дополнительные сведения об использовании шаблонов веб-приложений см.в статье [Использование веб-службы машинного обучения Azure с шаблоном веб-приложения](/azure/machine-learning/studio/consume-web-services).



## <a name="clean-up-resources"></a>Очистка ресурсов

[!INCLUDE [machine-learning-studio-clean-up](../../../includes/machine-learning-studio-clean-up.md)]

## <a name="next-steps"></a>Дополнительная информация

В рамках этого руководства вы выполнили следующие действия:

> [!div class="checklist"]
> * Подготовка к развертыванию
> * Развертывание веб-службы
> * Тестирование веб-службы
> * Управление веб-службой
> * Доступ к веб-службе

Можно также разработать настраиваемое приложение для доступа к веб-службе с помощью стартового кода в языках программирования R, C# и Python.

> [!div class="nextstepaction"]
> [Как использовать веб-службу Студии машинного обучения Azure](consume-web-services.md)

<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[metadata-editor]: https://msdn.microsoft.com/library/azure/370b6676-c11c-486f-bf73-35349f842a66/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/
[select-columns]: https://msdn.microsoft.com/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/
