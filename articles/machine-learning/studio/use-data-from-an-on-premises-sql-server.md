---
title: Локальный сервер SQL Server
titleSuffix: Azure Machine Learning Studio
description: Использование данных из локальной базы данных SQL Server для выполнения расширенной аналитики с помощью Студии машинного обучения Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: studio
ms.topic: conceptual
author: xiaoharper
ms.author: amlstudiodocs
ms.custom: seodec18
ms.date: 03/13/2017
ms.openlocfilehash: 9590728cec663b36c889dc26a6216c3d474244e4
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60735465"
---
# <a name="perform-analytics-with-azure-machine-learning-studio-using-an-on-premises-sql-server-database"></a>Выполнение аналитики с помощью студии машинного обучения Azure на основе данных из локальной базы данных SQL Server

Зачастую на предприятиях, работающих с локальными данными, используются преимущества масштабируемости и гибкости облака для рабочих нагрузок машинного обучения. Но при этом на предприятиях не хотят нарушать свои текущие бизнес-процессы и рабочие процессы, перемещая их локальные данные в облако. Студия машинного обучения Azure теперь поддерживает чтение данных из локальной базы данных SQL Server и последующим обучением и оценкой модели по этим данным. Больше не требуется вручную копировать и синхронизировать данные между облаком и локальным сервером. Вместо этого модуль **Импорт данных** в Студии машинного обучения Azure теперь может считывать данные для заданий обучения и оценки непосредственно из локальной базы данных SQL Server.

Эта статья содержит общие сведения о передаче данных локального сервера SQL Server в Студию машинного обучения Azure. Предполагается, что вы знакомы с основными понятиями Studio, как рабочие области, модули, наборы данных, эксперименты, *и т.д.*.

> [!NOTE]
> Эта функция недоступна для бесплатных рабочих областей. Дополнительные сведения о ценах на машинное обучение и его уровнях см. [здесь](https://azure.microsoft.com/pricing/details/machine-learning/).
>
>

<!-- -->



## <a name="install-the-data-factory-self-hosted-integration-runtime"></a>Установка локальной среды выполнения интеграции фабрики данных
Для доступа к SQL Server в локальную базу данных в студии машинного обучения Azure, необходимо загрузить и установить локальную среду выполнения интеграции фабрики данных, ранее известный как шлюз управления данными. При настройке подключения шлюза в студии машинного обучения вы сможете скачать и установить среду выполнения интеграции с помощью диалогового окна **Скачивание и регистрация шлюза данных**.


Среду выполнения интеграции также можно установить заранее, скачав и запустив пакет установки MSI из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=39717). С помощью пакета установки MSI также можно обновить существующую среду выполнения интеграции до последней версии с сохранением всех параметров.

Для установки локальной среды выполнения интеграции фабрики данных необходимо выполнить следующие предварительные требования:

* Для локальной среды выполнения интеграции фабрики данных необходима 64-разрядная операционная система с установленной платформой .NET Framework 4.6.1 или более поздней версии.
* Поддерживаемые версии ОС Windows: Windows 10 , Windows Server 2012, Windows Server 2012 R2 и Windows Server 2016. 
* Рекомендуемая конфигурация для компьютера, на котором будет размещена среда выполнения интеграции: четырехъядерный процессор с тактовой частотой не менее 2 ГГц, не менее 8 ГБ ОЗУ и не менее 80 ГБ дискового пространства.
* Когда хост-компьютер переходит в режим гибернации, среда выполнения интеграции перестает отвечать на запросы данных. Поэтому перед установкой среды выполнения интеграции на компьютере следует настроить соответствующую схему управления питанием. Если компьютер настроен для использования режима гибернации, то во время установки среды выполнения отобразится соответствующее сообщение.
* Так как циклы копирования выполняются с определенной частотой, ресурсы компьютера (ЦП, память) используются нерегулярно: есть пиковые нагрузки, и есть время простоя. Использование ресурсов также зависит от объема перемещаемых данных. Когда выполняется несколько заданий копирования, в пиковые периоды уровень использования ресурсов системы повышается. Выше приведены минимальные требования к конфигурации, технически являющейся достаточной. Мы рекомендуем всегда иметь больше ресурсов, чем указано для минимальной конфигурации, так как нагрузка зависит от объема перемещаемых данных.

При настройке локальной среды выполнения интеграции фабрики данных учитывайте следующее:

* На одном компьютере может быть установлен только один экземпляр среды выполнения интеграции.
* Для нескольких локальных источников данных можно использовать одну среду выполнения интеграции.
* Несколько сред выполнения интеграции на разных компьютерах можно подключить к одному и тому же локальному источнику данных.
* Настройка сред выполнения интеграции для одной рабочей области одновременно. Сейчас среды выполнения интеграции не могут совместно использоваться в нескольких рабочих областях.
* Для одной рабочей области можно настроить несколько сред выполнения интеграции. Например можно использовать среду выполнения Интеграции, который подключен к тестовым источникам данных во время разработки и рабочей среды выполнения Интеграции, когда вы будете готовы к вводу в эксплуатацию.
* Среда выполнения интеграции необязательно должна находиться на том же компьютере, что и источник данных. Но если он расположен вблизи источника данных, это ускоряет подключение шлюза к этому источнику. Мы рекомендуем установить среду выполнения интеграции на компьютере, отличном от того, на котором размещен локальный источник данных, чтобы среда выполнения интеграции не конкурировала с источником данных за использование ресурсов.
* При наличии среды выполнения Интеграции, установленной на компьютере, который обслуживает сценариев Power BI или фабрики данных Azure, установите отдельные среды выполнения Интеграции для студии машинного обучения на другом компьютере.

  > [!NOTE]
  > Локальная среда выполнения интеграции фабрики данных и шлюз Power BI не могут находиться на одном и том же компьютере.
  >
  >
* Необходимо использовать локальную среду IR фабрики данных для студии машинного обучения Azure, даже если вы используете Azure ExpressRoute для других типов данных. Источник данных следует считать локальным (то есть защищенным брандмауэром), даже если используется ExpressRoute. Для связи между студией машинного обучения и источником данных следует использовать локальную среду выполнения интеграции фабрики данных.

Дополнительные сведения о предварительных требованиях для установки, этапах установки и устранении неполадок см. в статье [Среда выполнения интеграции в фабрике данных](../../data-factory/concepts-integration-runtime.md).

## <a name="span-idusing-the-data-gateway-step-by-step-walk-classanchorspan-idtoc450838866-classanchorspanspaningress-data-from-your-on-premises-sql-server-database-into-azure-machine-learning"></a><span id="using-the-data-gateway-step-by-step-walk" class="anchor"><span id="_Toc450838866" class="anchor"></span></span>Ввод данных из локальной базы данных SQL Server в Машинное обучение Azure
В этом пошаговом руководстве будет настроить среду выполнения интеграции фабрики данных Azure в рабочей области машинного обучения Azure, настройте его и затем считывать данные из базы данных SQL Server в локальной.

> [!TIP]
> Прежде чем начать, отключите блокирование всплывающих окон в браузере для `studio.azureml.net`. Если вы используете браузер Google Chrome, скачайте и установите один из нескольких подключаемых модулей, доступных в интернет-магазине Google Chrome в разделе [расширений для приложений Click Once](https://chrome.google.com/webstore/search/clickonce?_category=extensions).
>
> [!NOTE]
> Локальная среда выполнения интеграции фабрики данных Azure ранее называлась "шлюзом управления данными". В этом пошаговом руководстве она по-прежнему будет называться "шлюзом".  

### <a name="step-1-create-a-gateway"></a>Шаг 1. Создание шлюза
Первым шагом является создание и настройка шлюза для доступа к локальной базы данных SQL.

1. Войдите в [Студию машинного обучения Azure](https://studio.azureml.net/Home/) и выберите необходимую рабочую область.
2. Щелкните колонку **Параметры** слева и выберите вкладку **Шлюзы данных** вверху.
3. Щелкните **НОВЫЙ ШЛЮЗ ДАННЫХ** в нижней части экрана.

    ![Новый шлюз данных](./media/use-data-from-an-on-premises-sql-server/new-data-gateway-button.png)
4. В диалоговом окне **Новый шлюз данных** введите **имя шлюза** и при необходимости добавьте его **описание**. Щелкните стрелку в нижнем правом углу, чтобы перейти к следующему шагу настройки.

    ![Ввод имени и описания шлюза данных](./media/use-data-from-an-on-premises-sql-server/new-data-gateway-dialog-enter-name.png)
5. В диалоговом окне Download and register data gateway (Скачивание и регистрация шлюза данных) скопируйте ключ регистрации шлюза в буфер обмена.

    ![Download and register data gateway (Скачивание и регистрация шлюза данных)](./media/use-data-from-an-on-premises-sql-server/download-and-register-data-gateway.png)
6. <span id="note-1" class="anchor"></span>Если вы еще не скачали и не установили шлюз управления данными Майкрософт, щелкните **Download data management gateway**(Скачать шлюз управления данными). Вы перейдете в Центр загрузки Майкрософт, где можно выбрать нужную версию шлюза, скачать ее и установить. Дополнительные сведения о необходимых условиях для установки, этапах установки и устранении неполадок можно найти в подразделах в начале статьи [Перемещение данных между локальными источниками и облаком при помощи шлюза управления данными](../../data-factory/tutorial-hybrid-copy-portal.md).
7. После установки шлюза откроется диспетчер конфигурации шлюза управления данными и появится диалоговое окно **Регистрация шлюза** . Вставьте **ключ регистрации шлюза**, скопированный в буфер обмена, и нажмите кнопку **Зарегистрировать**.
8. Если вы уже установили шлюз, запустите диспетчер конфигурации шлюза управления данными. Щелкните **Изменить ключ**, вставьте **ключ регистрации шлюза**, скопированный в буфер обмена на предыдущем шаге, и нажмите кнопку **ОК**.
9. Когда установка будет завершена, отобразится диалоговое окно **Регистрация шлюза** для диспетчера конфигурации шлюза управления данными Майкрософт. Вставьте ключ регистрации шлюза, скопированный в буфер обмена на предыдущем шаге, и щелкните **Зарегистрировать**.

    ![Зарегистрировать шлюз](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-register-gateway.png)
10. Настройка шлюза будет завершена после задания следующих значений на вкладке **Главная** в диспетчере конфигурации шлюза управления данными Майкрософт.

    * В полях **Имя шлюза** и **Имя экземпляра** указывается имя шлюза.
    * Для параметра **Регистрация** установлено значение **Зарегистрировано**.
    * В поле **Состояние** установлено значение **Запущено**.
    * В строке состояния внизу отображается надпись **Подключение к облачной службе шлюза управления данными установлено** и зеленый флажок.

      ![Диспетчер шлюза управления данными](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-registered.png)

      При успешной регистрации также обновляется Студия машинного обучения Azure.

    ![Успешная регистрация шлюза](./media/use-data-from-an-on-premises-sql-server/gateway-registered.png)
11. В диалоговом окне **Download and register data gateway** (Скачивание и регистрация шлюза данных) щелкните галочку, чтобы завершить настройку. На странице **Параметры** отображается состояние шлюза "В сети". В области справа можно просмотреть состояние и другие полезные сведения.

    ![Параметры шлюза](./media/use-data-from-an-on-premises-sql-server/gateway-status.png)
12. В диспетчере конфигурации шлюза управления данными Майкрософт перейдите на вкладку **Сертификат** . Сертификат, указанный на этой вкладке, используется для шифрования и расшифровывания учетных данных локального хранилища данных, указанного на портале. Это созданный по умолчанию сертификат. Корпорация Майкрософт рекомендует заменить его собственным сертификатом, сохраненном в системе управления сертификатами. Чтобы использовать вместо него собственный сертификат, щелкните **Изменить** .

    ![Изменение сертификата шлюза](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-certificate.png)
13. (Необязательно.) Если для устранения проблем со шлюзом вы хотите использовать подробное ведение журнала, то в диспетчере конфигурации шлюза управления данными перейдите на вкладку **Диагностика** и установите флажок **Включить запись подробных сведений в журнал для устранения неполадок**. Данные журналов можно изучить в средстве просмотра событий Windows, развернув узел **Журналы приложений и служб** -&gt; **Шлюз управления данными**. На вкладке **Диагностика** можно также проверить подключение к локальному источнику данных через шлюз.

    ![Включение ведения подробного журнала](./media/use-data-from-an-on-premises-sql-server/data-gateway-configuration-manager-verbose-logging.png)

На этом завершается процесс установки шлюза в студии машинного обучения Azure.
Теперь все готово к использованию локальных данных.

В Студии машинного обучения можно создать и настроить несколько шлюзов для каждой рабочей области. Например, можно использовать один шлюз, который будет подключаться к тестовым источникам данных во время разработки, и второй шлюз для подключения к рабочим источникам данных. Студия машинного обучения Azure дает возможность настроить несколько шлюзов в зависимости от вашей корпоративной среде. В настоящее время шлюз нельзя совместно использовать между несколькими рабочими областями, и на одном компьютере можно установить только один шлюз. Дополнительные сведения см. в статье [Перемещение данных между локальными источниками и облаком с помощью шлюза управления данными](../../data-factory/tutorial-hybrid-copy-portal.md).

### <a name="step-2-use-the-gateway-to-read-data-from-an-on-premises-data-source"></a>Шаг 2. Использование шлюза для чтения данных из локального источника данных
После настройки шлюза можно добавить в эксперимент модуль **Импорт данных** , который вводит данные из локальной базы данных SQL Server.

1. В Студии машинного обучения выберите вкладку **Эксперименты**, щелкните **+Создать** в левом нижнем углу и выберите **пустой эксперимент** (либо один из примеров экспериментов).
2. Найдите и перетащите модуль **Импорт данных** на холст эксперимента.
3. Внизу холста нажмите кнопку **Сохранить как** . Введите «Azure Studio на локальном SQL Server руководство по машинному обучению» название эксперимента, выберите рабочую область и нажмите кнопку **ОК** флажок.

   ![Сохранение эксперимента с новым именем](./media/use-data-from-an-on-premises-sql-server/experiment-save-as.png)
4. Щелкните модуль **Импорт данных**, чтобы выбрать его, а затем в области **Свойства** справа от полотна в раскрывающемся списке **Источник данных** выберите "Локальная база данных SQL".
5. Выберите **шлюз данных** , который вы установили и зарегистрировали. Вы можете установить еще один шлюз, выбрав "(Добавить шлюз данных…)".

   ![Выбор шлюза данных для модуля импорта данных](./media/use-data-from-an-on-premises-sql-server/import-data-select-on-premises-data-source.png)
6. Введите **имя сервера базы данных SQL** и **имя базы данных SQL**, а также **SQL-запрос к базе данных**, который требуется выполнить.
7. Нажмите кнопку **Enter values** (Введите значения) в разделе **Имя пользователя и пароль** и введите учетные данные базы данных. Можно использовать встроенную аутентификацию Windows или аутентификацию SQL Server, в зависимости от настроек локального сервера SQL Server.

   ![Ввод учетных данных базы данных](./media/use-data-from-an-on-premises-sql-server/database-credentials.png)

   Сообщение "values required" (Требуются значения) изменится на "values set" (Значения заданы) с зеленой галочкой. Необходимо только один раз ввести учетные данные, если только не изменится информация о базе данных или пароль. Студия машинного обучения Azure использует сертификат, который использовался при установке шлюза, для шифрования учетных данных в облаке. Azure никогда не хранит локальные учетные данные без шифрования.

   ![Свойства модуля "Импорт данных"](./media/use-data-from-an-on-premises-sql-server/import-data-properties-entered.png)
8. Щелкните **ЗАПУСТИТЬ** , чтобы выполнить эксперимент.

После завершения эксперимента можно визуализировать данные, импортированные из базы данных, щелкнув порт вывода модуля **Import Data** (Импорт данных) и выбрав **Visualize** (Визуализировать).

После завершения разработки эксперимента можно развернуть и ввести в эксплуатацию свою модель. С помощью службы выполнения пакетов из локальной базы данных SQL Server, настроенной в модуле **Импорт данных** , будут считываться данные, которые будут использоваться для оценки. Хотя вы можете для оценки локальных данных использовать службу ответа на запросы, вместо нее корпорация Майкрософт рекомендует использовать [надстройку Excel](excel-add-in-for-web-services.md) . В настоящее время запись в локальную базу данных SQL Server через модуль **Экспорт данных** не поддерживается в экспериментах или опубликованных веб-службах.
