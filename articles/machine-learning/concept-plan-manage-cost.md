---
title: Планирование затрат и управление ими
titleSuffix: Azure Machine Learning
description: Планирование и управление затратами для Машинное обучение Azure с анализом затрат в портал Azure. При создании моделей машинного обучения изучите дополнительные советы по экономии затрат, чтобы снизить затраты.
author: sdgilley
ms.author: sgilley
ms.custom: subject-cost-optimization
ms.reviewer: nigup
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.date: 05/08/2020
ms.openlocfilehash: f20abffa429add8edcbffba16529c467cb9506fe
ms.sourcegitcommit: 3be3537ead3388a6810410dfbfe19fc210f89fec
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "89651107"
---
# <a name="plan-and-manage-costs-for-azure-machine-learning"></a>Планирование и управление затратами для Машинное обучение Azure

В этой статье описывается планирование и управление затратами для Машинное обучение Azure. Во первых, вы используете калькулятор цен Azure, чтобы помочь спланировать затраты перед добавлением ресурсов. После добавления ресурсов Azure ознакомьтесь с оценочными затратами. Наконец, используйте советы по экономии затрат при обучении модели с управляемыми Машинное обучение Azureными кластерами.

После начала работы с Машинное обучение Azure ресурсами используйте функции управления затратами для установки бюджетов и отслеживания затрат. Также ознакомьтесь с прогнозными затратами и выявление тенденций расходов для выявления областей, в которых может потребоваться выполнить действие.

Изучите, что затраты на Машинное обучение Azure являются частью ежемесячных затрат в счете Azure. Если вы используете другие службы Azure, вам будет выставлен счет за все службы и ресурсы Azure, используемые в вашей подписке Azure, в том числе на сторонние службы. В этой статье описывается планирование и управление затратами для Машинное обучение Azure. После ознакомления с управлением затратами на Машинное обучение Azure примените аналогичные методы для управления затратами для всех служб Azure, используемых в вашей подписке.

При обучении моделей машинного обучения используйте управляемые Машинное обучение Azure вычислений-кластеры, чтобы воспользоваться преимуществами дополнительных советов по экономии ресурсов:

* Настройка кластеров для обучения для автоматического масштабирования
* Установка квот для подписки и рабочих областей
* Настройка политик завершения для обучающего запуска
* Использование виртуальных машин с низким приоритетом (ВМ)
* Использование зарезервированного экземпляра виртуальной машины Azure

## <a name="prerequisites"></a>Предварительные требования

Анализ стоимости поддерживает различные типы учетных записей Azure. Полный список поддерживаемых типов учетных записей см. в статье [Understand Cost Management data](../cost-management-billing/costs/understand-cost-mgt-data.md) (Интерпретация данных службы "Управление затратами"). Чтобы просмотреть данные о затратах, нужен как минимум доступ на чтение для учетной записи Azure. 

Дополнительные сведения о назначении доступа к данным службы "Управление затратами" Azure см. в [этой статье](../cost-management-billing/costs/assign-access-acm-data.md).

## <a name="estimate-costs"></a>Оценка затрат

Используйте [Калькулятор цен Azure](https://azure.microsoft.com/pricing/calculator/) , чтобы оценить затраты перед созданием ресурсов в учетной записи машинное обучение Azure. Слева выберите **AI + машинное обучение**, а затем выберите **машинное обучение Azure** , чтобы начать.  

На следующем снимке экрана показана оценка затрат с помощью калькулятора:

:::image type="content" source="media/concept-plan-manage-cost/capacity-calculator-cost-estimate.png" alt-text="Оценка затрат в калькуляторе Azure":::

Когда вы добавляете новые ресурсы в рабочую область, вернитесь к этому калькулятору и добавьте в него тот же ресурс, чтобы обновить оценки затрат.

Пока выпуск Enterprise Edition находится на этапе предварительной версии, дополнительная плата за МАШИНное обучение не взимается. Если выпуск Enterprise Edition становится общедоступным, у него будет плата (для обучения и появления).  Дополнительные сведения см. в разделе [цены на машинное обучение Azure](https://azure.microsoft.com/pricing/details/machine-learning/).

## <a name="get-cost-alerts"></a>Получение оповещений о затратах

Создавайте [бюджеты](../cost-management/tutorial-acm-create-budgets.md) для управления затратами и создавайте [оповещения](../cost-management/cost-mgt-alerts-monitor-usage-spending.md) , которые автоматически уведомляют заинтересованных лиц о трате аномалий и чрезмерной трате рисков. Оповещения основываются на расходах по сравнению с пороговыми значениями бюджета и затрат. Бюджеты и оповещения создаются для подписок Azure и групп ресурсов, поэтому они полезны в рамках общей стратегии мониторинга затрат. Однако бюджеты и оповещения могут иметь ограниченную функциональность для управления отдельными затратами на обслуживание Azure, так как они предназначены для мониторинга затрат на более высоком уровне.

## <a name="monitor-costs"></a>Мониторинг затрат

При использовании ресурсов с Машинное обучение Azure взимается плата. Затраты на единицу использования ресурсов Azure зависят от временных интервалов (секунды, минуты, часы и дни) или использования единиц запросов. После начала использования Машинное обучение Azure затраты изменяются. Просмотрите эти затраты на панели [анализ затрат](../cost-management/quick-acm-cost-analysis.md) в портал Azure.

Вы можете просматривать затраты в диаграммах и таблицах для различных временных интервалов. Вы также можете просматривать затраты по бюджету и прогнозируемым затратам. Переключение на более длинные представления с течением времени помогает определить тенденции расходов и узнать, где могла произойти чрезмерное расходование. Если вы создали бюджеты, Узнайте, где они превышены.  

Для Машинное обучение не будет отображаться отдельная область службы.  Вместо этого вы увидите различные ресурсы, добавленные в рабочие области Машинное обучение.

## <a name="use-azure-machine-learning-compute-cluster-amlcompute"></a>Использование кластера Машинное обучение Azure Compute (Амлкомпуте)

С постоянно изменяющимися данными вам потребуются быстрый и оптимизированный процесс обучения и переобучение модели для поддержания точных моделей. Однако непрерывное обучение происходит по затратам, особенно для моделей глубокого обучения на графических процессорах. 

Машинное обучение Azure пользователи могут использовать управляемый Машинное обучение Azureный кластер, который также называется Амлкомпуте. Амлкомпуте поддерживает различные параметры GPU и ЦП. Амлкомпуте внутренне размещено от имени подписки с Машинное обучение Azure. Она обеспечивает такую же безопасность корпоративного уровня, как обеспечение безопасности и соответствия требованиям, а также управление ими в облачном масштабировании Azure IaaS.

Поскольку эти кластеры вычислений находятся в инфраструктуре IaaS Azure, вы можете развертывать, масштабировать и управлять обучением, используя те же требования безопасности и соответствия требованиям, что и остальная часть инфраструктуры.  Эти развертывания выполняются в вашей подписке и подчиняются правилам управления. Дополнительные сведения о [машинное обучение Azure COMPUTE](how-to-create-attach-compute-sdk.md#amlcompute).

## <a name="configure-training-clusters-for-autoscaling"></a>Настройка кластеров обучения для автоматического масштабирования

Автоматическое масштабирование кластеров в зависимости от требований вашей рабочей нагрузки помогает сократить затраты, чтобы использовать только необходимые компоненты.

Кластеры Амлкомпуте предназначены для динамического масштабирования в зависимости от рабочей нагрузки. Кластер можно масштабировать до максимального количества настраиваемых узлов. По мере завершения каждого выполнения кластер выдает узлы и масштабирует их до настроенного минимального числа узлов.

[!INCLUDE [min-nodes-note](../../includes/machine-learning-min-nodes.md)]

Кроме того, можно настроить период бездействия узла перед уменьшением масштаба. По умолчанию время простоя до уменьшения масштаба равно 120 секунд.

+ Если вы выполняете меньше итеративных экспериментов, сократите это время, чтобы сэкономить затраты.
+ При выполнении высокоитеративного эксперимента для разработки и тестирования может потребоваться увеличить время, чтобы не платить за постоянное масштабирование после каждого изменения в обучающем сценарии или среде.

Кластеры Амлкомпуте можно настроить для изменения требований рабочей нагрузки в портал Azure с помощью [класса пакета SDK для амлкомпуте](https://docs.microsoft.com/python/api/azureml-core/azureml.core.compute.amlcompute.amlcompute?view=azure-ml-py&preserve-view=true), [амлкомпуте интерфейса командной строки](https://docs.microsoft.com/cli/azure/ext/azure-cli-ml/ml/computetarget/create?view=azure-cli-latest#ext-azure-cli-ml-az-ml-computetarget-create-amlcompute)с [интерфейсами API](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/machinelearningservices/resource-manager/Microsoft.MachineLearningServices/stable).

```azurecli
az ml computetarget create amlcompute --name testcluster --vm-size Standard_NC6 --min-nodes 0 --max-nodes 5 --idle-seconds-before-scaledown 300
```

## <a name="set-quotas-on-resources"></a>Установка квот для ресурсов

Амлкомпуте поставляется с [квотой (или лимитом) конфигурации](how-to-manage-quotas.md#azure-machine-learning-compute). Эта квота связана с семейством виртуальных машин (например, сериями Dv2, сериями NCv3) и зависит от региона для каждой подписки. Подписки начинаются с небольших значений по умолчанию, но с помощью этого параметра можно управлять объемом ресурсов Амлкомпуте, доступных для всплывающих подписке. 

Также настройте [квоту уровня рабочей области для семейства виртуальных машин](how-to-manage-quotas.md#workspace-level-quota)для каждой рабочей области в подписке. Это позволяет более детально контролировать затраты, которые могут повлечься в каждой рабочей области, и ограничивать определенные семейства виртуальных машин. 

Чтобы задать квоты на уровне рабочей области, начните с [портал Azure](https://portal.azure.com).  Выберите любую рабочую область в подписке и выберите **использование + квоты** на левой панели. Затем перейдите на вкладку **Настройка квот** , чтобы просмотреть квоты. Для задания квоты требуются привилегии в области действия подписки, так как это параметр влияет на несколько рабочих областей.

## <a name="set-run-autotermination-policies"></a>Задание политик автозавершения запуска 

В некоторых случаях следует настроить запуски обучения, чтобы ограничить их длительность или завершить их на раннем этапе. Например, при использовании встроенной настройки параметров или автоматизированного машинного обучения Машинное обучение Azure.

Вот несколько вариантов:
* Определите параметр, вызываемый `max_run_duration_seconds` в RunConfiguration, чтобы определить максимальную продолжительность, с которой может продлить запуск, в зависимости от выбранного вами типа вычислений (локальное или удаленное облачное вычисление).
* Для [настройки параметров помощника](how-to-tune-hyperparameters.md#early-termination)Определите политику раннего завершения из политики бандит, политики остановки медианы или политики выбора усечения. Для дальнейшего управления очисткой параметров используйте такие параметры, как `max_total_runs` или `max_duration_minutes` .
* Для [автоматического машинного обучения](how-to-configure-auto-train.md#exit)настройте аналогичные политики завершения с помощью  `enable_early_stopping` флага. Кроме того, используйте такие свойства, как `iteration_timeout_minutes` и, `experiment_timeout_minutes` чтобы управлять максимальной длительностью выполнения или для всего эксперимента.

## <a name="use-low-priority-vms"></a><a id="low-pri-vm"></a> Использование виртуальных машин с низким приоритетом

Azure позволяет использовать избыточную емкость в качестве виртуальных машин с низким приоритетом в масштабируемых наборах виртуальных машин, пакетах и службах Машинное обучение. Эти выделения предварительно емптибле, но имеют уменьшенную стоимость по сравнению с выделенными виртуальными машинами. Как правило, для пакетных рабочих нагрузок рекомендуется использовать виртуальные машины с низким приоритетом. Их также следует использовать там, где прерывания можно восстановить либо с помощью повторной отправки (для пакетной обработки), либо с помощью перезагрузки (для обучения глубокого обучения с помощью контрольных точек).

Виртуальные машины с низким приоритетом имеют отдельную квоту, отделенную от значения выделенной квоты, которое входит в семейство виртуальных машин. Дополнительные сведения [о квотах амлкомпуте](how-to-manage-quotas.md).

 Виртуальные машины с низким приоритетом не работают для вычислений, так как они должны поддерживать интерактивные возможности записной книжки.

## <a name="use-reserved-instances"></a>Использование зарезервированных экземпляров

Другим способом экономии денег на вычислительных ресурсах является зарезервированный экземпляр виртуальной машины Azure. С этим предложением вы зафиксируете условия на один год или три года. Эти скидки находятся в диапазоне до 72% цен с оплатой по мере использования и применяются непосредственно к месячному счету за использование Azure.

Машинное обучение Azure COMPUTE поддерживает зарезервированные экземпляры по сути. Если вы приобретаете зарезервированный экземпляр на один или три года, мы будем автоматически применять скидку к Машинное обучение Azure управляемым вычислительным средам.


## <a name="next-steps"></a>Дальнейшие действия

См. также:
* [Управление квотами ресурсов и их увеличение](how-to-manage-quotas.md)
* [Управление затратами с помощью анализа затрат](../cost-management-billing/costs/quick-acm-cost-analysis.md).
* Создание Машинное обучение Azure вычислений с помощью [пакета SDK](how-to-create-attach-compute-sdk.md#amlcompute) или в [студии](how-to-create-attach-compute-studio.md#amlcompute).
