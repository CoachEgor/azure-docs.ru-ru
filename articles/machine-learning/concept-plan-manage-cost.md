---
title: Планирование затрат и управление ими
titleSuffix: Azure Machine Learning
description: Планирование и управление затратами для Машинное обучение Azure с анализом затрат в портал Azure. При создании моделей машинного обучения изучите дополнительные советы по экономии затрат, чтобы снизить затраты.
author: sdgilley
ms.author: sgilley
ms.custom: subject-cost-optimization
ms.reviewer: nigup
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.date: 04/22/2020
ms.openlocfilehash: b777e6a45bdfe78889366982a6c28e10e21c4fbc
ms.sourcegitcommit: c535228f0b77eb7592697556b23c4e436ec29f96
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "82857000"
---
# <a name="plan-and-manage-costs-for-azure-machine-learning"></a>Планирование и управление затратами для Машинное обучение Azure

В этой статье описывается планирование и управление затратами для Машинное обучение Azure. Во первых, вы используете калькулятор цен Azure, чтобы помочь спланировать затраты перед добавлением ресурсов. После добавления ресурсов Azure ознакомьтесь с оценочными затратами. Наконец, используйте советы по экономии затрат при обучении модели с управляемыми Машинное обучение Azureными кластерами.

После начала работы с Машинное обучение Azure ресурсами используйте функции управления затратами для установки бюджетов и отслеживания затрат. Также ознакомьтесь с прогнозными затратами и выявление тенденций расходов для выявления областей, в которых может потребоваться выполнить действие.

Изучите, что затраты на Машинное обучение Azure являются частью ежемесячных затрат в счете Azure. Если вы используете другие службы Azure, вам будет выставлен счет за все службы и ресурсы Azure, используемые в вашей подписке Azure, в том числе на сторонние службы. В этой статье описывается планирование и управление затратами для Машинное обучение Azure. После ознакомления с управлением затратами на Машинное обучение Azure примените аналогичные методы для управления затратами для всех служб Azure, используемых в вашей подписке.

При обучении моделей машинного обучения используйте управляемые Машинное обучение Azure вычислений-кластеры, чтобы воспользоваться преимуществами дополнительных советов по экономии ресурсов:

* Настройка кластеров для обучения для автоматического масштабирования
* Установка квот для подписки и рабочих областей
* Настройка политик завершения для обучающего запуска
* Использование виртуальных машин с низким приоритетом (ВМ)
* Использование зарезервированного экземпляра виртуальной машины Azure

## <a name="prerequisites"></a>Предварительные требования

Анализ стоимости поддерживает различные типы учетных записей Azure. Полный список поддерживаемых типов учетных записей см. в статье [Understand Cost Management data](../cost-management-billing/costs/understand-cost-mgt-data.md) (Интерпретация данных службы "Управление затратами"). Чтобы просмотреть данные о затратах, нужен как минимум доступ на чтение для учетной записи Azure. 

Дополнительные сведения о назначении доступа к данным службы "Управление затратами" Azure см. в [этой статье](../cost-management-billing/costs/assign-access-acm-data.md).

## <a name="estimate-costs"></a>Расчет стоимости

Используйте [Калькулятор цен Azure](https://azure.microsoft.com/pricing/calculator/) , чтобы оценить затраты перед созданием ресурсов в учетной записи машинное обучение Azure. Слева выберите **AI + машинное обучение**, а затем выберите **машинное обучение Azure** , чтобы начать.  

На следующем снимке экрана показана оценка затрат с помощью калькулятора:

:::image type="content" source="media/concept-plan-manage-cost/capacity-calculator-cost-estimate.png" alt-text="Оценка затрат в калькуляторе Azure":::

Когда вы добавляете новые ресурсы в рабочую область, вернитесь к этому калькулятору и добавьте в него тот же ресурс, чтобы обновить оценки затрат.

Пока выпуск Enterprise Edition находится на этапе предварительной версии, дополнительная плата за МАШИНное обучение не взимается. Если выпуск Enterprise Edition становится общедоступным, у него будет плата машинного обучения (для обучения и появления).  Дополнительные сведения см. [машинное обучение Azure ценах](https://azure.microsoft.com/pricing/details/machine-learning/).

## <a name="get-cost-alerts"></a>Получение оповещений о затратах

Создавайте [бюджеты](../cost-management/tutorial-acm-create-budgets.md) для управления затратами и создавайте [оповещения](../cost-management/cost-mgt-alerts-monitor-usage-spending.md) , которые автоматически уведомляют заинтересованных лиц о трате аномалий и чрезмерной трате рисков. Оповещения основываются на расходах по сравнению с пороговыми значениями бюджета и затрат. Бюджеты и оповещения создаются для подписок Azure и групп ресурсов, поэтому они полезны в рамках общей стратегии мониторинга затрат. Однако бюджеты и оповещения могут иметь ограниченную функциональность для управления отдельными затратами на обслуживание Azure, так как они предназначены для мониторинга затрат на более высоком уровне.

## <a name="monitor-costs"></a>Мониторинг затрат

При использовании ресурсов с Машинное обучение Azure взимается плата. Затраты на единицу использования ресурсов Azure зависят от временных интервалов (секунды, минуты, часы и дни) или использования единиц запросов. После начала использования Машинное обучение Azure затраты изменяются. Просмотрите эти затраты на панели [анализ затрат](../cost-management/quick-acm-cost-analysis.md) в портал Azure.

Просмотр затрат в диаграммах и таблицах для различных временных интервалов. Некоторые примеры относятся к дню, текущему, предыдущему месяцу и году. Также просмотрите затраты на бюджет и прогнозируемые затраты. Переключение на более длительные представления с течением времени помогает определить тенденции расходов и узнать, где могла произойти чрезмерная трата. Если вы создали бюджеты, Узнайте, где они превышены.  

Для Машинное обучение не будет отображаться отдельная область службы.  Вместо этого вы увидите различные ресурсы, добавленные в рабочие области Машинное обучение.

## <a name="use-amlcompute"></a>Использование Амлкомпуте

С постоянно изменяющимися данными вам потребуются быстрый и оптимизированный процесс обучения и переобучение модели для поддержания точных моделей. Однако непрерывное обучение происходит по затратам, особенно для моделей глубокого обучения на графических процессорах. 

Машинное обучение Azure пользователи могут использовать управляемый Машинное обучение Azureный кластер, который также называется Амлкомпуте. Амлкомпуте поддерживает различные параметры GPU и ЦП. Амлкомпуте внутренне размещается от имени подписки с Машинное обучение Azure, но обеспечивает ту же безопасность корпоративного уровня, что и управление в масштабе облака Azure IaaS.

Поскольку эти кластеры вычислений находятся в инфраструктуре IaaS Azure, вы можете развертывать, масштабировать и управлять обучением, используя те же требования безопасности и соответствия требованиям, что и остальная часть инфраструктуры.  Эти развертывания выполняются в вашей подписке и подчиняются правилам управления. Дополнительные сведения о [машинное обучение Azure COMPUTE](how-to-set-up-training-targets.md#amlcompute).

## <a name="configure-training-clusters-for-autoscaling"></a>Настройка кластеров обучения для автоматического масштабирования

Автоматическое масштабирование кластеров в зависимости от требований вашей рабочей нагрузки помогает сократить затраты, чтобы использовать только необходимые компоненты. Кластеры Амлкомпуте предназначены для динамического масштабирования в зависимости от требований рабочей нагрузки. Кластер можно масштабировать до максимального количества подготовленных узлов и в пределах квоты, назначенной для подписки. По мере завершения каждого выполнения кластер выдаст узлы и автоматически масштабировать их до указанного минимального числа узлов.

Помимо установки минимального и максимального количества узлов, настройте период бездействия узла перед уменьшением масштаба. По умолчанию время простоя до уменьшения масштаба равно 120 секунд.

+ Если вы выполняете меньше итеративных экспериментов, сократите это время, чтобы сэкономить затраты. 
+ При выполнении высокоитеративного эксперимента для разработки и тестирования может потребоваться увеличить это, чтобы не платить за постоянное масштабирование после каждого изменения в обучающем сценарии или среде.

Кластеры Амлкомпуте можно настроить для изменения требований рабочей нагрузки в портал Azure с помощью [класса пакета SDK для амлкомпуте](https://docs.microsoft.com/python/api/azureml-core/azureml.core.compute.amlcompute.amlcompute?view=azure-ml-py), [амлкомпуте интерфейса командной строки](https://docs.microsoft.com/cli/azure/ext/azure-cli-ml/ml/computetarget/create?view=azure-cli-latest#ext-azure-cli-ml-az-ml-computetarget-create-amlcompute)с [интерфейсами API](https://github.com/Azure/azure-rest-api-specs/tree/master/specification/machinelearningservices/resource-manager/Microsoft.MachineLearningServices/stable).

```azure cli
az ml computetarget create amlcompute --name testcluster --vm-size Standard_NC6 --min-nodes 0 --max-nodes 5 --idle-seconds-before-scaledown 300
```

## <a name="set-quotas-on-resources"></a>Установка квот для ресурсов

Так же, как и другие ресурсы вычислений Azure, Амлкомпуте поставляется с внутренней [конфигурацией квоты (или ограничения)](how-to-manage-quotas.md#azure-machine-learning-compute). Эта квота связана с семейством виртуальных машин (например, сериями Dv2, сериями NCv3) и зависит от региона для каждой подписки. Подписки начинаются с небольших значений по умолчанию, но с помощью этого параметра можно управлять объемом ресурсов Амлкомпуте, доступных для всплывающих подписке. 

Также настройте [квоту уровня рабочей области для семейства виртуальных машин](how-to-manage-quotas.md#workspace-level-quota)для каждой рабочей области в подписке. Это позволяет более детально контролировать затраты, которые могут повлечься в каждой рабочей области, и ограничивать определенные семейства виртуальных машин. 

Чтобы задать квоты на уровне рабочей области, начните с [портал Azure](https://portal.azure.com).  Выберите любую рабочую область в подписке и выберите **использование + квоты** на левой панели. Затем перейдите на вкладку **Настройка квот** , чтобы просмотреть квоты. Для установки этой квоты требуются привилегии в области действия подписки, так как это параметр влияет на несколько рабочих областей.

## <a name="set-run-auto-termination-policies"></a>Задать политики автоматического завершения выполнения 

Настройте запуски обучения, чтобы ограничить их длительность, или прерывать их на раннем этапе в случае определенных условий, особенно при использовании встроенных возможностей настройки или автоматического Машинное обучение параметров Машинное обучение Azure. 

Вот несколько вариантов:
* Определите параметр, вызываемый `max_run_duration_seconds` в RunConfiguration, чтобы определить максимальную продолжительность, с которой может продлить запуск, в зависимости от выбранного вами типа вычислений (локальное или удаленное облачное вычисление).
* Для [настройки параметров помощника](how-to-tune-hyperparameters.md#early-termination)Определите политику раннего завершения из политики бандит, политики остановки медианы или политики выбора усечения. Кроме того, также используйте такие параметры, `max_total_runs` как `max_duration_minutes` или, для дальнейшего управления различными выявлением параметров.
* Для [автоматического машинного обучения](how-to-configure-auto-train.md#exit)настройте аналогичные политики завершения с помощью `enable_early_stopping` флага. Кроме того, используйте такие `iteration_timeout_minutes` свойства `experiment_timeout_minutes` , как и, чтобы управлять максимальной длительностью выполнения или для всего эксперимента.

## <a name="use-low-priority-vms"></a>Использование виртуальных машин с низким приоритетом

Azure позволяет использовать избыточную емкость в качестве виртуальных машин с низким приоритетом в масштабируемых наборах виртуальных машин, пакетах и службах Машинное обучение. Эти выделения предварительно емптибле, но имеют уменьшенную стоимость по сравнению с выделенными виртуальными машинами. В общем случае мы рекомендуем использовать виртуальные машины с низким приоритетом для рабочих нагрузок пакетной службы или место, где можно восстановить перерывы с помощью повторной отправки (для формирования пакетов) или с помощью перезагрузки (для обучения глубокого обучения с помощью контрольных точек).

Виртуальные машины с низким приоритетом имеют отдельную квоту, отделенную от значения выделенной квоты, которое входит в семейство виртуальных машин. Дополнительные сведения [о квотах амлкомпуте](how-to-manage-quotas.md).

Задайте приоритет виртуальной машины одним из следующих способов:

* В студии при создании виртуальной машины выберите **низкий приоритет** .

* В пакете SDK для Python задайте `vm_priority` атрибут в конфигурации подготовки.  

    ```python
    compute_config = AmlCompute.provisioning_configuration(vm_size='STANDARD_D2_V2',
                                                               vm_priority='lowpriority',
                                                               max_nodes=4)
    ```

* С помощью интерфейса командной строки установите `vm-priority`:

    ```azurecli-interactive
    az ml computetarget create amlcompute --name lowpriocluster --vm-size Standard_NC6 --max-nodes 5 --vm-priority lowpriority
    ```

 Виртуальные машины с низким приоритетом не работают для вычислений, так как они должны поддерживать интерактивные возможности записной книжки. 

## <a name="use-reserved-instances"></a>Использование зарезервированных экземпляров

Зарезервированный экземпляр виртуальной машины Azure предоставляет еще один способ получения огромного энергосбережения на вычислительных ресурсах за один или три года. Эти скидки находятся в диапазоне до 72% цен с оплатой по мере использования и применяются непосредственно к месячному счету за использование Azure.

Машинное обучение Azure COMPUTE поддерживает зарезервированные экземпляры по сути. Поэтому, если вы приобрели зарезервированный экземпляр на один год или три года, он будет автоматически применен к управляемым вычислительным средам, используемым в Машинное обучение Azure без необходимости дополнительной настройки с конца.


## <a name="next-steps"></a>Дальнейшие шаги

* Дополнительные сведения об управлении затратами с помощью [анализа затрат](../cost-management-billing/costs/quick-acm-cost-analysis.md).
* Дополнительные сведения о [машинное обучение Azure COMPUTE](how-to-set-up-training-targets.md#amlcompute).