---
title: Управление ресурсами и квотами
titleSuffix: Azure Machine Learning
description: Сведения о квотах на ресурсы для Машинного обучения Azure и о том, как запросить дополнительную квоту.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.reviewer: jmartens
author: nishankgu
ms.author: nigup
ms.date: 05/08/2020
ms.topic: conceptual
ms.custom: troubleshooting,contperfq4
ms.openlocfilehash: a25dcc187c1bb172106a3972c1cb57dfd473bc2f
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "91322382"
---
# <a name="manage--increase-quotas-for-resources-with-azure-machine-learning"></a>Управление квотами на ресурсы для Машинного обучения Azure и их увеличение


В этой статье вы узнаете о предварительно настроенных ограничениях на ресурсы Azure для подписки [машинное обучение Azure](overview-what-is-azure-ml.md) и о том, какие квоты вы можете управлять. Эти ограничения применяются во избежание перерасхода бюджета из-за мошенничества, а также для соблюдения ограничений по объемам ресурсов Azure. 

Как и в других службах Azure, существуют ограничения на некоторые ресурсы, связанные со службой Машинного обучения Azure. Эти ограничения варьируются в зависимости от ограничения на количество [рабочих областей](concept-workspace.md) и ограничения на фактический объем базовых вычислений, используемых для обучения или формирования/оценки моделей. 

Помните об этих ограничениях при разработке и увеличении масштаба ресурсов службы Машинного обучения Azure для производственных рабочих нагрузок. Например, если в кластере не удается достичь целевого числа узлов, возможно, вы достигли ограничения ядер Вычислительной среды Машинного обучения Azure для подписки. Если ограничение или квоту требуется сделать выше значения ограничения по умолчанию, бесплатно отправьте запрос в службу поддержки клиентов. Из-за ограничений по объемам ресурсов Azure ограничения не могут быть увеличены выше значения максимального предела, как показано в таблицах ниже. Если столбца "Максимальное ограничение" нет, то ресурс не имеет настраиваемого ограничения.


Наряду с управлением квотами вы также можете научиться [планировать & управления затратами машинное обучение Azure](concept-plan-manage-cost.md).

## <a name="special-considerations"></a>Специальные рекомендации

+ Квота — это кредитный лимит, а не гарантия наличия ресурсов. Если вам нужны ресурсы в очень большом объеме, обратитесь в службу поддержки Azure. Кроме того, можно [увеличить квоты](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-quota-errors).

+ Квоты являются общими для всех служб в подписках, включая службу Машинного обучения Azure. Единственным исключением является Вычислительная среда Машинного обучения Azure, для которой применяется отдельная квота вычислительных ядер. При оценке потребности в емкости обязательно вычислите использование квоты во всех службах.

+ Ограничения по умолчанию зависят от типа категории, например бесплатной пробной версии, оплаты по мере использования и серии виртуальной машины (Dv2, F, G и т. д).

## <a name="default-resource-quotas"></a>Квоты ресурсов по умолчанию

Ниже представлена разбивка квот по различным типам ресурсов в подписке Azure.

> [!IMPORTANT]
> Границы могут измениться. Последнюю версию всегда можно найти в [документе](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits/) по квотам на уровне службы для всех ресурсов Azure.

### <a name="virtual-machines"></a>Виртуальные машины
Для каждой подписки Azure существует ограничение на количество виртуальных машин в службах или в автономном режиме. Для ядер виртуальных машин действует региональное общее ограничение и региональное ограничение размера на серию (Dv2, F и т. д.), которые применяются отдельно. Например, рассмотрим подписку с ограничением до 30 ядер виртуальных машин с восточной части США, 30 ядер серии A и 30 ядер серии D. Для этой подписки допускается развертывание 30 виртуальных машин A1 или 30 виртуальных машин D1 или сочетания виртуальных машин обоих типов, при котором должно быть не более 30 ядер (например, 10 виртуальных машин A1 и 20 виртуальных машин D1).

[!INCLUDE [azure-subscription-limits-azure-resource-manager](../../includes/azure-subscription-limits-azure-resource-manager.md)]

### <a name="azure-machine-learning-compute"></a>Вычислительная среда Машинного обучения Azure;
В [Вычислительной среде Машинного обучения Azure](concept-compute-target.md#azure-machine-learning-compute-managed) есть квота по умолчанию для количества ядер и уникальных ресурсов компьютера, разрешенных для каждого региона в подписке. Она отделена от квоты для количества ядер виртуальной машины, которая указана выше, и ограничения на количество ядер не являются общими для двух типов ресурсов, поскольку AmlCompute представляет собой управляемую службу, которая развертывает ресурсы в модели с размещением от имени пользователя.

Доступные ресурсы:
+ Число выделенных ядер на регион по умолчанию составляет от 24 до 300 в зависимости от типа предложения подписки с более высоким значением по умолчанию для типов предложений EA и CSP.  Количество выделенных ядер для каждой подписки можно увеличить, и оно отличается для каждого семейства виртуальных машин. Некоторые специализированные семейства виртуальных машин, такие как NCv2, NCv3 или ND, начинаются с 0 ядер по умолчанию. Чтобы обсудить варианты увеличения, обратитесь в службу поддержки Azure с запросом увеличения квоты.

+ Для ядер с низким приоритетом на регион по умолчанию установлено ограничение от 100 до 3000 ядер в зависимости от типа предложения подписки с более высоким значением по умолчанию для типов предложений EA и CSP. Количество ядер с низким приоритетом для каждой подписки можно увеличить, и оно является одним значением в разных семействах виртуальных машин. Чтобы обсудить варианты увеличения, обратитесь в службу поддержки Azure.

+ Количество кластеров для каждого региона по умолчанию ограничено 200 ядер. Они являются общими для обучающего кластера и вычислительного экземпляра (который при определении квоты рассматривается как кластер с одним узлом). Свяжитесь со службой поддержки Azure, чтобы оставить запрос на повышение лимита.

+ Ниже приведены другие строгие ограничения, которые нельзя превышать.

| **Ресурс** | **Максимальное ограничение** |
| --- | --- |
| Максимальное количество рабочих областей на группу ресурсов | 800 |
| Максимальное число узлов в одном ресурсе Вычислительной среды Машинного обучения Azure (AmlCompute) | 100 узлов |
| Максимальное количество процессов MPI в GPU на узел | 1–4 |
| Максимальное количество рабочих ролей GPU на узел | 1–4 |
| Максимальное время существования задания | 21 день<sup>1</sup> |
| Максимальное время существования задания на узле с низким приоритетом | 7 дней<sup>2</sup> |
| Максимальное количество серверов параметров на узел | 1 |

<sup>1</sup> Максимальное время существования означает время от начала запуска и до завершения. Завершенные запуски сохраняются в течение неограниченного времени. Данные для запусков, которые не были завершены в течение максимального времени существования, недоступны.
<sup>2</sup> Задания на узле с низким приоритетом могут быть вытеснены в любое время, когда существует ограничение емкости. Рекомендуется реализовать контрольные точки в задании.

### <a name="azure-machine-learning-pipelines"></a>Конвейеры Машинного обучение Azure
Для [конвейеров Машинного обучения Azure](concept-ml-pipelines.md) существует квота на количество шагов в конвейере и количество запусков опубликованных конвейеров на основе расписания для каждого региона в подписке.
- Максимально допустимое число шагов в конвейере — 30 000.
- Максимальное число запусков на основе расписания и операций получения больших двоичных объектов для расписаний, запускаемых на основе блога, для подписок на подписку в месяц — 100 000.

### <a name="container-instances"></a>Экземпляры контейнеров

Также существует ограничение на количество экземпляров контейнера, которые можно развертывать в определенный период времени (по часам) или по всей вашей подписке.
Ограничения см. в разделе [ограничения экземпляров контейнеров](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits#container-instances-limits).

### <a name="storage"></a>Память
Существует ограничение на количество учетных записей хранения в регионе, а также в рамках данной подписки. Ограничение по умолчанию в 250 учетных записей включает учетные записи хранения ценовой категории "Стандартный" и "Премиум". Если требуется более 250 учетных записей хранения в заданном регионе, обратитесь с запросом в [службу поддержки Azure](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest/). Команда разработчиков службы хранилища Azure рассмотрит вашу аргументацию и может утвердить до 250 учетных записей хранения для заданного региона.


## <a name="workspace-level-quota"></a>Квота уровня рабочей области

Для более эффективного управления выделением ресурсов для целевых объектов Машинного обучения Azure (Amlcompute) между различными [рабочими областями](concept-workspace.md) мы реализовали функцию, которая позволяет распределять квоты уровня подписки (по семейству виртуальных машин) и настраивать их на уровне рабочей области. По умолчанию все рабочие области имеют ту же квоту, что и квота уровня подписки для любого семейства виртуальных машин. Однако по мере увеличения количества рабочих областей, а также по мере того, как рабочие нагрузки разного приоритета начинают совместно использовать одни и те же ресурсы, пользователям требуется способ более эффективного совместного использования емкости, чтобы избежать проблем, связанных с состязанием за ресурсы. Управляемое вычисление в составе службы Машинного обучения Azure позволяет пользователям возможность задавать максимальную квоту для конкретного семейства виртуальных машин в каждой рабочей области. Это аналогично распределению емкости между рабочими областями, и пользователи могут выбрать также избыточное выделение для максимального использования. 

Чтобы задать квоты на уровне рабочей области, перейдите к любой рабочей области в подписке и щелкните **Использование + квоты** на панели слева. Затем перейдите на вкладку **Настройка квот**, чтобы просмотреть квоты, развернуть семейство виртуальных машин и задать квоту для любой рабочей области, указанной в этом семействе виртуальных машин. Помните, что нельзя задать отрицательное значение или значение выше квоты уровня подписки. Кроме того, как вы должны заметить, по умолчанию всем рабочим областям назначается вся квота подписки, чтобы обеспечить полное использование выделенной квоты.

[![Квота уровня рабочей области службы Машинного обучения Azure](./media/how-to-manage-quotas/azure-machine-learning-workspace-quota.png)](./media/how-to-manage-quotas/azure-machine-learning-workspace-quota.png)


> [!NOTE]
> Для задания квоты на уровне рабочей области необходимы разрешения уровня подписки. Это гарантирует, что отдельные владельцы рабочей области не смогут изменить или увеличить свои квоты и не начинают использование ресурсов, настроенных отдельно для другой рабочей области. Таким образом, администратор подписки лучше всего подходит для выделения и распределения этих квот в рабочих областях.



## <a name="view-your-usage-and-quotas"></a>Просмотр сведений об использовании и квотах

Квота на Машинное обучение Azure вычислений в вашей подписке управляется отдельно от других квот ресурсов Azure. Чтобы просмотреть эту квоту, необходимо выполнить детализацию Службы машинного обучения Azure.  

1. На панели слева выберите **Служба машинного обучения** и в появившемся списке выберите любую рабочую область.

2. В следующей колонке в разделе **Поддержка и устранение неполадок** выберите **Использование и квоты**, чтобы просмотреть текущие квоты и их использование.

3. Выберите подписку, для которой нужно просмотреть квоты. Не забудьте выполнить фильтрацию по нужному региону.

4. Теперь можно переключаться между представлением уровня подписки и представлением уровня рабочей области.
    + **Представление подписки**. В этом представлении можно просматривать сведения об использовании квоты на количество ядер по семейству виртуальных машин, развернув их по рабочей области, а также разворачивать их по реальным именам кластеров. Это представление является оптимальным для быстрого получения сведений об использовании ядер конкретным семейством виртуальных машин, чтобы просмотреть разбивку по рабочим областям, а также дальнейшее распределение по основным кластерам для каждой из этих рабочих областей. В этом представлении общим соглашением является "(использование/квота)", где "использование" — это текущее количество масштабируемых ядер, а "квота" — это логическое максимальное число ядер, до которого можно масштабировать ресурс. Для каждой **рабочей области** квота должна быть квотой уровня рабочей области (как описано выше). Она определяет максимальное количество ядер, которое можно масштабировать для конкретного семейства виртуальных машин. Для **кластера** квота фактически является количеством ядер, соответствующему максимальному количеству узлов, до которого кластер может масштабироваться в соответствии со свойством max_nodes.
    
    + **Представление рабочей области**. В этом представлении можно просматривать сведения об использовании квоты на количество ядер по рабочим областям, развернув их по реальным именам кластеров. Это представление является оптимальным для быстрого получения сведений об использовании ядер конкретной рабочей областью, чтобы просмотреть разбивку по семействам виртуальных машин, а также дальнейшее распределение по основным кластерам для каждого из этих семейств.

На портале Azure можно с легкостью просмотреть квоту для различных других ресурсов Azure, таких как виртуальные машины, хранилище и сеть.

1. На левой панели выберите **Все службы**, а затем в общей категории выберите **Подписки**.

2. Из списка подписок выберите ту, квоту которой нужно просмотреть.

3. Выберите **использование и квоты** , чтобы просмотреть текущие ограничения и использование квоты. Используйте фильтры для выбора поставщика и расположений. 

## <a name="request-quota-increases"></a>Запрос на увеличение квоты

Если ограничение или квоту требуется сделать выше значения ограничения по умолчанию, [бесплатно отправьте запрос в службу поддержки клиентов](https://ms.portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest/).

Ограничения не могут превышать значение максимального ограничения, показанное в таблицах. Если максимальное ограничение отсутствует, то ресурс не имеет настраиваемого ограничения. [См. пошаговые инструкции по увеличению квоты](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-quota-errors).

При запросе увеличения квоты вам необходимо выбрать службу, для которой необходимо повысить квоту. Это могут быть квоты Службы машинного обучения Azure, службы "Экземпляры контейнера" или службы хранилища. Кроме использования Вычислительной среды Машинного обучения Azure, можно нажать кнопку **Запросить квоту** при просмотре квоты, выполнив описанные выше указания.

> [!NOTE]
> [Бесплатная пробная версия подписки](https://azure.microsoft.com/offers/ms-azr-0044p) не предусматривает возможность увеличения ограничения и квоты. При наличии [бесплатной пробной версии подписки](https://azure.microsoft.com/offers/ms-azr-0044p) ее можно обновить до подписки [с оплатой по мере использования](https://azure.microsoft.com/offers/ms-azr-0003p/). Дополнительные сведения см. в статье [Upgrade your Free Trial or Microsoft Imagine Azure subscription to Pay-As-You-Go](../billing/billing-upgrade-azure-subscription.md) (Обновление бесплатной пробной версии подписки или подписки Microsoft Imagine Azure до подписки с оплатой по мере использования) и [Вопросы и ответы о бесплатной учетной записи Azure](https://azure.microsoft.com/free/free-account-faq).

## <a name="private-endpoint-and-private-dns-quota-increases"></a>Увеличение частной конечной точки и частной квоты DNS

Существуют ограничения на количество частных конечных точек и частных зон DNS, которые могут быть созданы в подписке. Хотя Машинное обучение Azure создает ресурсы в подписке (клиент), существуют сценарии, которые создают ресурсы в подписке, принадлежащей корпорации Майкрософт. В следующих сценариях может потребоваться запросить квоту для подписки, принадлежащей корпорации Майкрософт:

* __Рабочая область с включенной частной связью с ключом, управляемым клиентом (CMK)__
* __Реестр контейнеров Azure для рабочей области, расположенной за виртуальной сетью__
* __Подключение закрытой ссылки с включенным кластером службы Azure Kubernetes Service в рабочую область__.

Чтобы запросить скидку для этих сценариев, выполните следующие действия.

1. [Создайте запрос в службу поддержки Azure](/azure/azure-portal/supportability/how-to-create-azure-support-request#create-a-support-request) и выберите следующие параметры в разделе " __Основные сведения__ ":

    | Поле | Выбор |
    | ----- | ----- |
    | Тип проблемы | Технический |
    | Служба | Мои службы. Выберите __машинное обучение__ в раскрывающемся списке. |
    | Тип проблемы | Настройка рабочей области, пакет SDK и интерфейс командной строки |
    | Подтип проблемы | Проблема при подготовке рабочей области или управлении ею |

2. В разделе __сведения__ введите в поле __Описание__ нужный регион Azure и сценарий, который планируется использовать. Если необходимо запросить увеличение квоты для нескольких подписок, следует также вывести список идентификаторов подписок в этом поле.

3. Чтобы создать запрос, используйте __CREATE__ .

## <a name="next-steps"></a>Дальнейшие действия

+ [Планирование затрат для Машинного обучения Azure и управление ими](concept-plan-manage-cost.md)
