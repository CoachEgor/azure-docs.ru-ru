---
title: Корпоративная безопасность
titleSuffix: Azure Machine Learning
description: 'Безопасное использование машинного обучения Azure: аутентификация, авторизация, сетевая безопасность, шифрование данных и мониторинг.'
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: aashishb
author: aashishb
ms.reviewer: larryfr
ms.date: 03/13/2020
ms.openlocfilehash: 359fd7fc787db5710deca75dd562215d25ed9148
ms.sourcegitcommit: ced98c83ed25ad2062cc95bab3a666b99b92db58
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80437488"
---
# <a name="enterprise-security-for-azure-machine-learning"></a>Корпоративная безопасность для машинного обучения Azure

В этой статье вы узнаете об особенностях безопасности, доступных для машинного обучения Azure.

При использовании облачного сервиса наилучшей практикой является ограничение доступа только к пользователям, которые в ней нуждаются. Начните с понимания модели проверки подлинности и авторизации, используемой службой. Вы также можете ограничить доступ к сети или безопасно соединить ресурсы в вашей персональной сети с облаком. Шифрование данных также имеет жизненно важное значение, как в состоянии покоя, так и в то время как данные перемещаются между службами. Наконец, необходимо иметь возможность контролировать службу и создавать журнал аудита всех действий.

> [!NOTE]
> Информация в этой статье работает с версией SDK SDK Для машинного обучения Azure 1.0.83.1 или выше.

## <a name="authentication"></a>Аутентификация

Многофакторная аутентификация поддерживается, если для его использования настроен активный каталог Azure Active . Вот процесс проверки подлинности:

1. Клиент впишется в Azure AD и получает токен менеджера ресурсов Azure.  Пользователи и директора служб полностью поддерживаются.
1. Клиент представляет токен менеджеру ресурсов Azure и всему машинному обучению Azure.
1. Служба машинного обучения предоставляет токен службы машинного обучения для целевой вычислить пользователя (например, Machine Learning Compute). Этот маркер используется целью вычислений пользователя для вызова обратно в службу машинного обучения после завершения выполнения. Область ограничена рабочим пространством.

[![Аутентификация в машинном обучении Azure](media/concept-enterprise-security/authentication.png)](media/concept-enterprise-security/authentication-expanded.png#lightbox)

Для получения дополнительной информации [см. Настройка аутентификации для ресурсов машинного обучения Azure и рабочих процессов.](how-to-setup-authentication.md) В этой статье приводится информация и примеры по аутентификации, в том числе с использованием основ служб и автоматизированных рабочих процессов.

### <a name="authentication-for-web-service-deployment"></a>Проверка подлинности для развертывания веб-службы

Azure Machine Learning поддерживает две формы аутентификации для веб-сервисов: ключ и токен. Каждая веб-служба может включить только одну форму проверки подлинности одновременно.

|Метод проверки подлинности|Описание|Экземпляры контейнеров Azure|AKS|
|---|---|---|---|
|Ключ|Ключи статичны и не нуждаются в обновлении. Ключи можно регенерировать вручную.|По умолчанию отключено| По умолчанию включено|
|Токен|Срок действия токенов истекает по истечении определенного периода времени и должен быть обновлен.| Недоступно| По умолчанию отключено |

Примеры кода приведены в [разделе аутентификации веб-службы.](how-to-setup-authentication.md#web-service-authentication)

## <a name="authorization"></a>Авторизация

Вы можете создать несколько рабочих областей, и каждая рабочая область может совместно использоваться несколькими пользователями. Когда вы делитесь рабочим пространством, вы можете контролировать доступ к нему, назначая следующие роли пользователям:

* Владелец
* Участник
* Читатель

В следующей таблице перечислены некоторые основные операции по машинному обучению Azure и роли, которые могут их выполнять:

| Работа машинного обучения Azure | Владелец | Участник | Читатель |
| ---- |:----:|:----:|:----:|
| Создание рабочей области | ✓ | ✓ | |
| Общая рабочая область | ✓ | |  |
| Обновление рабочего пространства для издания Enterprise | ✓ | |
| Создание вычислительной цели | ✓ | ✓ | |
| Прикрепить цель вычислений | ✓ | ✓ | |
| Прикрепить хранилища данных | ✓ | ✓ | |
| Выполнение эксперимента | ✓ | ✓ | |
| Просмотр запусков/метрик | ✓ | ✓ | ✓ |
| Регистрация модели | ✓ | ✓ | |
| Создание образа | ✓ | ✓ | |
| Развертывание веб-службы | ✓ | ✓ | |
| Просмотр моделей/изображений | ✓ | ✓ | ✓ |
| Позвоните в веб-сервис | ✓ | ✓ | ✓ |

Если встроенные роли не отвечают вашим потребностям, можно создавать пользовательские роли. Пользовательские роли поддерживаются только для операций на рабочем пространстве и машинного обучения. Пользовательские роли могут читать, писать или удалять разрешения в рабочем пространстве и на вычислительном ресурсе в этом рабочем пространстве. Вы можете сделать роль доступной на определенном уровне рабочей области, на определенном уровне группы ресурсов или на определенном уровне подписки. Для получения дополнительной информации смотрите [управление пользователями и ролями в рабочем пространстве Azure Machine Learning.](how-to-assign-roles.md)

> [!WARNING]
> В настоящее время Azure Machine Learning не поддерживается в рамках совместной работы Azure Active Directory.

### <a name="securing-compute-targets-and-data"></a>Обеспечение безопасности вычислительных целей и данных

Владельцы и участники могут использовать все вычислительные цели и хранилища данных, которые подключены к рабочей области.  

Каждое рабочее пространство также имеет связанную систему, назначенную управляемой имитатор, которая имеет то же имя, что и рабочее пространство. Управляемая идентификация имеет следующие разрешения на прилагаемые ресурсы, используемые в рабочей области.

Для получения дополнительной информации об управляемых идентификаторах [см. Управляемые идентификаторы для ресурсов Azure.](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview)

| Ресурс | Разрешения |
| ----- | ----- |
| Рабочая область | Участник |
| Учетная запись хранения | участник данных BLOB-объектов хранилища; |
| Хранилище ключей | Доступ ко всем ключам, секретам, сертификатам |
| Реестр контейнеров Azure | Участник |
| Группа ресурсов, содержащая рабочее пространство | Участник |
| Группа ресурсов, содержащая хранилище ключей (если она отличается от той, которая содержит рабочее пространство) | Участник |

Мы не рекомендуем админостам отменять доступ управляемого удостоверения к ресурсам, упомянутым в предыдущей таблице. Восстановить доступ можно с помощью операции resync keys.

Azure Machine Learning создает дополнительное приложение `aml-` `Microsoft-AzureML-Support-App-`(имя начинается с или) с доступом на уровне авторов в вашей подписке для каждого региона рабочего пространства. Например, если у вас есть одно рабочее пространство в Восточной ЧАСТИ США и одно в Северной Европе в той же подписке, вы увидите два из этих приложений. Эти приложения позволяют машинному обучению Azure помочь вам управлять вычислительными ресурсами.

## <a name="network-security"></a>Безопасность сети

Для вычислений ресурсов Azure Machine Learning опирается на другие службы Azure. Вычислительные ресурсы (целевые объекты вычислений) используются для обучения и развертывания моделей. Вы можете создать эти вычислительные цели в виртуальной сети. Например, можно использовать виртуальную машину Azure Data Science для обучения модели, а затем развернуть модель в AKS.  

Для получения дополнительной информации смотрите [Как проводить эксперименты и выводы в виртуальной сети.](how-to-enable-virtual-network.md)

Вы также можете включить частную ссылку Azure для рабочего пространства. Private Link позволяет ограничивать связь с рабочим пространством из виртуальной сети Azure. Для получения дополнительной информации [см.](how-to-configure-private-link.md)

> [!TIP]
> Вы можете объединить виртуальную сеть и Private Link вместе для защиты связи между рабочим пространством и другими ресурсами Azure. Тем не менее, некоторые комбинации требуют рабочего пространства корпоративного издания. Используйте следующую таблицу, чтобы понять, какие сценарии требуют издания Enterprise:
>
> | Сценарий | Enterprise</br>edition | Basic</br>edition |
> | ----- |:-----:|:-----:| 
> | Нет виртуальной сети или частной ссылки | ✔ | ✔ |
> | Рабочее пространство без частной ссылки. Другие ресурсы (кроме реестра контейнеров Azure) в виртуальной сети | ✔ | ✔ |
> | Рабочее пространство без частной ссылки. Другие ресурсы с частным ссылкой | ✔ | |
> | Рабочее пространство с частной ссылкой. Другие ресурсы (кроме реестра контейнеров Azure) в виртуальной сети | ✔ | ✔ |
> | Рабочее пространство и любой другой ресурс с частной ссылкой | ✔ | |
> | Рабочее пространство с частной ссылкой. Другие ресурсы без частной ссылки или виртуальной сети | ✔ | ✔ |
> | Реестр контейнеров Azure в виртуальной сети | ✔ | |
> | Управляемые клиентами ключи для рабочего пространства | ✔ | |
> 

> [!WARNING]
> Предварительный просмотр экземпляров Azure Machine Learning не поддерживается в рабочей области, где включена приватная ссылка.
> 
> Azure Machine Learning не поддерживает использование службы Azure Kubernetes с включенной частной ссылкой. Вместо этого вы можете использовать службу Azure Kubernetes в виртуальной сети. Для получения дополнительной информации смотрите задания и задания по поиску информации [Secure Azure ML в виртуальной сети Azure.](how-to-enable-virtual-network.md)

## <a name="data-encryption"></a>Шифрование данных

### <a name="encryption-at-rest"></a>Шифрование при хранении

> [!IMPORTANT]
> Если рабочее пространство содержит конфиденциальные данные, мы рекомендуем установить [hbi_workspace флаг](https://docs.microsoft.com/python/api/azureml-core/azureml.core.workspace(class)?view=azure-ml-py#create-name--auth-none--subscription-id-none--resource-group-none--location-none--create-resource-group-true--sku--basic---friendly-name-none--storage-account-none--key-vault-none--app-insights-none--container-registry-none--cmk-keyvault-none--resource-cmk-uri-none--hbi-workspace-false--default-cpu-compute-target-none--default-gpu-compute-target-none--exist-ok-false--show-output-true-) при создании рабочего пространства. Это контролирует объем данных, собираемых корпорацией Майкрософт для диагностических целей, и позволяет дополнительно шировать в управляемых средах Майкрософт.

Для получения дополнительной информации о том, [Azure data encryption at rest](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest)как шифрование в состоянии покоя работает в Azure, см.

#### <a name="azure-blob-storage"></a>Хранилище BLOB-объектов Azure

Azure Machine Learning хранит моментальные снимки, выходные данные и журналы в учетной записи хранения Azure Blob, которая привязана к рабочему пространству машинного обучения Azure и подписке. Все данные, хранящиеся в хранилище Azure Blob, шифруются в состоянии покоя с помощью ключей, управляемых корпорацией Майкрософт.

Для получения информации о том, как использовать собственные ключи для данных, хранящихся в хранилище Azure Blob, можно ознакомиться с [шифрованием Azure Storage с ключами, управляемыми клиентами, в Azure Key Vault.](../storage/common/storage-encryption-keys-portal.md)

Учебные данные обычно также хранятся в хранилище Azure Blob, чтобы они были доступны для обучаемых вычислительных целей. Это хранилище не управляется Azure Machine Learning, а устанавливается для вычисления целей в качестве удаленной файловой системы.

Если вам нужно __повернуть или отозвать__ ключ, вы можете сделать это в любое время. При вращении ключа учетная запись хранилища начнет использовать новый ключ (последняя версия) для шифрования данных в состоянии покоя. При отзыве (отключении) ключа учетная запись хранилища заботится о сбое запросов. Обычно для того, чтобы ротация или отзыв были эффективными, обычно требуется час.

Для получения информации о регенерации ключей доступа [см.](how-to-change-storage-access-key.md)

#### <a name="azure-cosmos-db"></a>Azure Cosmos DB

Azure Machine Learning хранит метрики и метаданные в экземпляре Azure Cosmos DB. Этот экземпляр связан с подпиской Майкрософт, управляемой Azure Machine Learning. Все данные, хранящиеся в Azure Cosmos DB, шифруются в состоянии покоя с помощью ключей, управляемых корпорацией Майкрософт.

Чтобы использовать собственные (управляемые клиентом) ключи для шифрования экземпляра Azure Cosmos DB, можно создать специальный экземпляр Cosmos DB для использования в рабочем пространстве. Мы рекомендуем этот подход, если вы хотите хранить свои данные, такие как информация об истории выполнения, за пределами экземпляра Multi-tenant Cosmos DB, размещенного в нашей подписке Майкрософт. 

Для обеспечения подготовки экземпляра Cosmos DB в подписке с ключами, управляемыми клиентом, выполните следующие действия:

* Включите ключевые возможности, управляемые клиентами для Cosmos DB. В это время необходимо запросить доступ к этой возможности. Для этого, пожалуйста, свяжитесь с [cosmosdbpm@microsoft.com](mailto:cosmosdbpm@microsoft.com).

* Зарегистрируйте поставщиков ресурсов Azure Machine Learning и Azure Cosmos DB в подписке, если это еще не сделано.

* Авторизуйте приложение машинного обучения (в identity и Access Management) с разрешениями участников по подписке.

    ![Авторизут приложение «Azure Machine Learning App» в области идентификации и управления доступом на портале](./media/concept-enterprise-security/authorize-azure-machine-learning.png)

* Используйте следующие параметры при создании рабочего пространства Azure Machine Learning. Оба параметра являются обязательными и поддерживаются в шаблонах SDK, CLI, REST AIS и resource Manager.

    * `resource_cmk_uri`: Этот параметр является полным ресурсом URI управляемого ключа клиента в хранилище ключа, включая [информацию о версии для ключа.](../key-vault/about-keys-secrets-and-certificates.md#objects-identifiers-and-versioning) 

    * `cmk_keyvault`: Этот параметр является идентификатором ресурсов хранилища ключей в вашей подписке. Это хранилище ключей должно находиться в том же регионе и подписке, что вы будете использовать для рабочего пространства Машинного обучения Azure. 
    
        > [!NOTE]
        > Этот экземпляр хранилища ключей может отличаться от хранилища ключей, созданного ВСУ при предоставлении рабочего пространства. Если вы хотите использовать тот же экземпляр хранилища ключей для рабочего пространства, пройдите то же хранилище ключей, одновременно припомощи рабочее пространство с помощью [key_vault параметра.](https://docs.microsoft.com/python/api/azureml-core/azureml.core.workspace(class)?view=azure-ml-py#create-name--auth-none--subscription-id-none--resource-group-none--location-none--create-resource-group-true--sku--basic---friendly-name-none--storage-account-none--key-vault-none--app-insights-none--container-registry-none--cmk-keyvault-none--resource-cmk-uri-none--hbi-workspace-false--default-cpu-compute-target-none--default-gpu-compute-target-none--exist-ok-false--show-output-true-) 

Этот экземпляр Cosmos DB создан в группе ресурсов, управляемой корпорацией Майкрософт, в вашей подписке. 

> [!IMPORTANT]
> * Если вам нужно удалить этот экземпляр Cosmos DB, необходимо удалить рабочее пространство Azure Machine Learning, которое использует его. 
> * Блоки [__запроса__](../cosmos-db/request-units.md) по умолчанию для этой учетной записи Cosmos DB установлен на уровне __8000.__ Изменение этого значения не поддерживается. 

Если вам нужно __повернуть или отозвать__ ключ, вы можете сделать это в любое время. При вращении ключа Cosmos DB начнет использовать новый ключ (последняя версия) для шифрования данных в состоянии покоя. При отзыве (отключении) ключа, Cosmos DB заботится о неудачных запросах. Обычно для того, чтобы ротация или отзыв были эффективными, обычно требуется час.

Для получения дополнительной информации о ключах, [Configure customer-managed keys for your Azure Cosmos DB account](../cosmos-db/how-to-setup-cmk.md)управляемых клиентами с помощью Cosmos DB, см.

#### <a name="azure-container-registry"></a>Реестр контейнеров Azure

Все изображения контейнеров в вашем реестре (Azure Container Registry) шифруются в состоянии покоя. Azure автоматически шифрует изображение перед его хранением и расшифровывает его, когда Azure Machine Learning вытягивает изображение.

Чтобы использовать собственные (управляемые клиентом) ключи для шифрования реестра контейнеров Azure, необходимо создать свой собственный ACR и прикрепить его при подготовке рабочего пространства или зашифровать экземпляр по умолчанию, который создается во время подготовки рабочего пространства.

Например, создание рабочего пространства с использованием существующего реестра контейнеров Azure см.

* [Создайте рабочее пространство для машинного обучения Azure с помощью Azure CLI.](how-to-manage-workspace-cli.md)
* [Используйте шаблон менеджера ресурсов Azure для создания рабочего пространства для машинного обучения Azure](how-to-create-workspace-template.md)

#### <a name="azure-container-instance"></a>Экземпляр контейнера Azure

Можно шифровать развернутый ресурс Azure Container Instance (ACI) с помощью ключей, управляемых клиентами. Управляемый клиентом ключ, используемый для ACI, может храниться в Хранилище ключей Azure для вашего рабочего пространства. Для получения информации о генерации ключа [см. Шифрование данных с помощью ключа, управляемого клиентом.](../container-instances/container-instances-encrypt-data.md#generate-a-new-key)

Чтобы использовать ключ при развертывании модели в Azure Container `AciWebservice.deploy_configuration()`Instance, создайте новую конфигурацию развертывания с помощью. Предоставьте ключевую информацию по следующим параметрам:

* `cmk_vault_base_url`URL-адрес хранилища ключей, содержащий ключ.
* `cmk_key_name`: Имя ключа.
* `cmk_key_version`: Версия ключа.

Для получения дополнительной информации о создании и использовании конфигурации развертывания см.

* [AciWebservice.deploy_configuration()](https://docs.microsoft.com/python/api/azureml-core/azureml.core.webservice.aci.aciwebservice?view=azure-ml-py#deploy-configuration-cpu-cores-none--memory-gb-none--tags-none--properties-none--description-none--location-none--auth-enabled-none--ssl-enabled-none--enable-app-insights-none--ssl-cert-pem-file-none--ssl-key-pem-file-none--ssl-cname-none--dns-name-label-none--primary-key-none--secondary-key-none--collect-model-data-none--cmk-vault-base-url-none--cmk-key-name-none--cmk-key-version-none-) справка
* [Где и как развернуть](how-to-deploy-and-where.md)
* [Развертывание веб-служб в Экземплярах контейнеров Azure](how-to-deploy-azure-container-instance.md).

Для получения дополнительной информации об использовании ключа, управляемого клиентом, с помощью ACI см. [Шифрование данных с ключом, управляемым клиентом.](../container-instances/container-instances-encrypt-data.md#encrypt-data-with-a-customer-managed-key)

#### <a name="azure-kubernetes-service"></a>Служба Azure Kubernetes

В любое время можно шифровать развернутый ресурс службы Azure Kubernetes с помощью ключей, управляемых клиентами. Для получения дополнительной информации смотрите [принесите свои собственные ключи с Azure Kubernetes Service](../aks/azure-disk-customer-managed-keys.md). 

Этот процесс позволяет шифровать как данные, так и диск ОС развернутых виртуальных машин в кластере Kubernetes.

> [!IMPORTANT]
> Этот процесс работает только с версией AKS K8s 1.17 или выше. 13 января 2020 года Azure Machine Learning добавила поддержку AKS 1.17.

#### <a name="machine-learning-compute"></a>Вычислительные вычисления машинного обучения

Диск ОС для каждого вычислительного узла, хранящегося в Azure Storage, шифруется с помощью ключей, управляемых Корпорацией Майкрософт, в учетных записях хранения данных Azure Machine Learning. Эта цель вычислений эфемерна, и кластеры обычно сокращаются, когда не стоят в очереди. Базовая виртуальная машина де-подготовлена, а диск ОС удаляется. Шифрование azure Disk не поддерживается для диска ОС.

Каждая виртуальная машина также имеет локальный временный диск для операций ОС. При желании можно использовать диск для подготовки данных по этапу обучения. Диск зашифрован по умолчанию для рабочих `hbi_workspace` областей `TRUE`с набором параметра. Эта среда недолговечна только на время выполнения, а поддержка шифрования ограничена только ключами, управляемыми системой.

#### <a name="azure-databricks"></a>Azure Databricks

Лазурные databricks можно использовать в конвейерах машинного обучения Azure. По умолчанию файловая система Databricks (DBFS), используемая Azure Databricks, шифруется с помощью ключа, управляемого Корпорацией Майкрософт. Для настройки Azure Databricks для использования [Configure customer-managed keys on default (root) DBFS](/azure/databricks/security/customer-managed-keys-dbfs)ключей, управляемых клиентами, см.

### <a name="encryption-in-transit"></a>Шифрование при передаче

Вы можете использовать TLS для обеспечения внутренней связи между микрослужбами Azure Machine Learning и для обеспечения внешних вызовов в конечную точку. Весь доступ к хранилищам Azure также осуществляется через защищенный канал.

Для получения дополнительной информации [см.](https://docs.microsoft.com/azure/machine-learning/how-to-secure-web-service)

### <a name="using-azure-key-vault"></a>Использование Azure Key Vault

Azure Machine Learning использует экземпляр Azure Key Vault, связанный с рабочим пространством, для хранения учетных данных различных видов:

* Строка соединения сопутствуенного хранилища
* Пароли к экземплярам репозитория контейнеров Azure
* Строки подключения к хранилищам данных

Пароли sSH и ключи для вычисления целей, таких как Azure HDInsight и VMs, хранятся в отдельном хранилище ключей, связанном с подпиской Майкрософт. Azure Machine Learning не хранит паролей или ключей, предоставленных пользователями. Вместо этого он генерирует, разрешает и хранит свои собственные sSH-ключи для подключения к VMs и HDInsight для запуска экспериментов.

Каждое рабочее пространство имеет связанную систему, назначенную управляемой имитатором, которая имеет то же имя, что и рабочее пространство. Эта управляемая идентификация имеет доступ ко всем ключам, секретам и сертификатам в хранилище ключей.

## <a name="data-collection-and-handling"></a>Сбор и обработка данных

### <a name="microsoft-collected-data"></a>Корпорация Майкрософт собрала данные

Корпорация Майкрософт может собирать идентифицирующую информацию, не являющуюся пользователем, например имена ресурсов (например, имя набора данных или название эксперимента машинного обучения) или переменные среды работы для диагностических целей. Все эти данные хранятся с помощью ключей, управляемых корпорацией Майкрософт, в хранилище, размещенном в принадлежащих корпорации Майкрософт подписках, и следуют [стандартной политике конфиденциальности и стандартам обработки данных корпорации Майкрософт.](https://privacy.microsoft.com/privacystatement)

Корпорация Майкрософт также рекомендует не хранить конфиденциальную информацию (например, секреты ключей учетной записи) в переменных среды. Переменные среды регистрируются, шифруются и хранятся нами. Аналогичным образом при именовании [runid](https://docs.microsoft.com/python/api/azureml-core/azureml.core.run%28class%29?view=azure-ml-py)избегайте включения конфиденциальной информации, такой как имена пользователей или секретные имена проектов. Эта информация может отображаться в журналах телеметрии, доступных для инженеров службы поддержки Майкрософт.

Вы можете отказаться от сбора диагностических данных, установив `hbi_workspace` параметр `TRUE` при подготовке рабочего пространства. Эта функция поддерживается при использовании шаблонов AzureML Python SDK, CLI, REST AIS или шаблонов Менеджера ресурсов Azure.

### <a name="microsoft-generated-data"></a>Данные, генерируемые корпорацией Майкрософт

При использовании таких служб, как автоматизированное машинное обучение, корпорация Майкрософт может генерировать переходные, предварительно обработанные данные для обучения нескольких моделей. Эти данные хранятся в хранилище данных в рабочем пространстве, что позволяет надлежащим образом обеспечивать соблюдение элементов управления доступом и шифрования.

Можно также зашифровать [диагностическую информацию, зарегистрированную из развернутой конечной точки,](how-to-enable-app-insights.md) в экземплярAzнного приложения.

## <a name="monitoring"></a>Наблюдение

### <a name="metrics"></a>Метрики

Для просмотра и мониторинга метрик для рабочего пространства Azure Machine Learning можно использовать метрики Azure Monitor. На [портале Azure](https://portal.azure.com)выберите рабочее пространство, а затем выберите **метрики:**

[![Скриншот, показывающий метрики примеров для рабочего пространства](media/concept-enterprise-security/workspace-metrics.png)](media/concept-enterprise-security/workspace-metrics-expanded.png#lightbox)

Метрики включают информацию о пробегах, развертываниях и регистрациях.

Для получения дополнительной информации смотрите [метрики в Azure Monitor](/azure/azure-monitor/platform/data-platform-metrics).

### <a name="activity-log"></a>Журнал действий

Можно просмотреть журнал действий рабочего пространства, чтобы увидеть различные операции, выполняемые в рабочем пространстве. В журнале содержится основная информация, например название операции, инициатор события и метка времени.

На этом скриншоте показан журнал активности рабочего пространства:

[![Скриншот, показывающий журнал активности рабочего пространства](media/concept-enterprise-security/workspace-activity-log.png)](media/concept-enterprise-security/workspace-activity-log-expanded.png#lightbox)

Сведения о запросе на скоринг хранятся в Application Insights. Application Insights создается в подписке при создании рабочего пространства. Зарегистрированная информация включает такие области, как:

* HTTPMethod
* UserAgent
* ВычислитьТип
* RequestUrl
* StatusCode
* RequestId
* Duration

> [!IMPORTANT]
> Некоторые действия в рабочем пространстве Машинного Обучения Azure не регистрировать информацию в журнале действий. Например, не регистрируется начало учебного забега и регистрация модели.
>
> Некоторые из этих действий отображаются в области **действий** рабочей области, но эти уведомления не указывают, кто инициировал действие.

## <a name="data-flow-diagrams"></a>Диаграммы потока данных

### <a name="create-workspace"></a>Создание рабочей области

Следующая диаграмма показывает рабочий процесс рабочего пространства.

* Вы регистрируетесь в Azure AD от одного из поддерживаемых клиентов Azure Machine Learning (Azure CLI, Python SDK, портал Azure) и запрашиваете соответствующий маркер менеджера ресурсов Azure.
* Для создания рабочего пространства вы называете менеджера ресурсов Azure. 
* Менеджер ресурсов Azure связывается с поставщиком ресурсов Azure Machine Learning, чтобы предоставить рабочее пространство.

Дополнительные ресурсы создаются в подписке пользователя во время создания рабочего пространства:

* Key Vault (для хранения секретов)
* Учетная запись хранения Azure (включая blob и долю файла)
* Реестр контейнеров Azure (для хранения изображений Docker для выводов/скоринга и экспериментов)
* Приложение Исследования (для хранения телеметрии)

Пользователь также может предоставить другие вычислительные цели, которые прилагаются к рабочей области (например, служба Azure Kubernetes или VMs) по мере необходимости.

[![Создание рабочего потока рабочего пространства](media/concept-enterprise-security/create-workspace.png)](media/concept-enterprise-security/create-workspace-expanded.png#lightbox)

### <a name="save-source-code-training-scripts"></a>Сохранить исходный код (учебные скрипты)

На следующей диаграмме отображается рабочий процесс снимка кода.

С рабочим пространством Машинного обучения Azure связаны каталоги (эксперименты), содержащие исходный код (учебные сценарии). Эти скрипты хранятся в локальной машине и в облаке (в хранилище Azure Blob для подписки). Снимки кода используются для выполнения или проверки для исторического аудита.

[![Рабочий процесс снимка кода](media/concept-enterprise-security/code-snapshot.png)](media/concept-enterprise-security/code-snapshot-expanded.png#lightbox)

### <a name="training"></a>Обучение

На следующей диаграмме показан учебный рабочий процесс.

* Машинное обучение Azure вызывается с идентификатором моментального снимка для снимка кода, сохраненного в предыдущем разделе.
* Azure Machine Learning создает идентификатор запуска (необязательно) и маркер службы машинного обучения, который позже используется вычислительными целями, такими как Machine Learning Compute/VMs, для связи с службой машинного обучения.
* Вы можете выбрать либо управляемую вычислительную цель (например, Machine Learning Compute) или неуправляемую вычислительную цель (например, VMs) для выполнения обучающих заданий. Вот потоки данных для обоих сценариев:
   * VMs/HDInsight, доступ к которым имеют учетные данные SSH в хранилище ключей в подписке Майкрософт. Azure Machine Learning запускает код управления на вычислительной цели, которая:

   1. Подготавливает окружающую среду. (Docker является опцией для vMs и локальных компьютеров. Ознакомьтесь с следующими шагами для Machine Learning Compute, чтобы понять, как работают эксперименты на контейнерах Docker.)
   1. Загружает код.
   1. Настройка переменных и конфигураций среды.
   1. Запускает пользовательские скрипты (снимок кода, упомянутый в предыдущем разделе).

   * Machine Learning Compute, доступ к которому осуществляется с помощью удостоверения, управляемого рабочим пространством.
Поскольку Machine Learning Compute является управляемой вычислительной целью (т.е. управляемой корпорацией Майкрософт), она выполняется по подписке Майкрософт.

   1. Дистанционное строительство Docker стартует, если это необходимо.
   1. Код управления записывается на общий общий раздел файлов Azure пользователя.
   1. Контейнер запускается с первоначальной командой. То есть код управления, описанный на предыдущем этапе.

#### <a name="querying-runs-and-metrics"></a>Запуски запросов и метрики

На диаграмме потока ниже этот шаг происходит, когда цель обучения вычисляет метрики выполнения обратно в Azure Machine Learning из хранилища в базе данных Cosmos DB. Клиенты могут позвонить в Azure Machine Learning. Машинное обучение, в свою очередь, вытащит метрики из базы данных Cosmos DB и вернет их клиенту.

[![Учебный рабочий процесс](media/concept-enterprise-security/training-and-metrics.png)](media/concept-enterprise-security/training-and-metrics-expanded.png#lightbox)

### <a name="creating-web-services"></a>Создание веб-сервисов

Следующая диаграмма показывает рабочий процесс выводов. Вывод, или оценка модели, — это фаза, на которой развернутая модель используется для прогнозирования, чаще всего на производственных данных.

Дополнительные сведения:

* Пользователь регистрирует модель с помощью такого клиента, как Azure Machine Learning SDK.
* Пользователь создает изображение с помощью модели, файла оценки и других зависимостей модели.
* Изображение Docker создается и хранится в реестре контейнеров Azure.
* Веб-служба развертывается в вычислительную цель (Container Instances/AKS) с использованием изображения, созданного на предыдущем этапе.
* Сведения о запросе на скоринг хранятся в Application Insights, которая находится в подписке пользователя.
* Телеметрия также перенагражна подписке Microsoft/Azure.

[![Рабочий процесс выводов](media/concept-enterprise-security/inferencing.png)](media/concept-enterprise-security/inferencing-expanded.png#lightbox)

## <a name="next-steps"></a>Следующие шаги

* [Безопасные веб-сервисы Машинного обучения Azure с помощью TLS](how-to-secure-web-service.md)
* [Потребляйте модель машинного обучения, развернутую в виде веб-сервиса](how-to-consume-web-service.md)
* [Run batch predictions on large data sets with Azure Machine Learning service](how-to-use-parallel-run-step.md) (Составление пакетных прогнозов для больших наборов данных с помощью Службы машинного обучения Azure)
* [Мониторинг моделей машинного обучения Azure с помощью приложений Insights](how-to-enable-app-insights.md)
* [Сбор данных для моделей в рабочей среде](how-to-enable-data-collection.md)
* [Azure машинного обучения SDK](https://docs.microsoft.com/python/api/overview/azure/ml/intro?view=azure-ml-py)
* [Используйте машинное обучение Azure с помощью виртуальной сети Azure](how-to-enable-virtual-network.md)
* [Recommenders](https://github.com/Microsoft/Recommenders) (Системы рекомендаций)
* [Создание API рекомендаций в режиме реального времени в Azure](https://docs.microsoft.com/azure/architecture/reference-architectures/ai/real-time-recommendation)
