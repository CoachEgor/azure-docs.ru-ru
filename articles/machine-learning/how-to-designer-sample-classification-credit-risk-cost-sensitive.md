---
title: 'Конструктор: прогнозирование кредитного риска (пример)'
titleSuffix: Azure Machine Learning
description: Создание классификатора и использование настраиваемых скриптов Python для прогнозирования кредитных рисков с помощью конструктора Машинного обучения Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: sample
author: likebupt
ms.author: keli19
ms.reviewer: peterlu
ms.date: 12/25/2019
ms.openlocfilehash: ed8ee9b1c711ee0056377154379b8df56e0785df
ms.sourcegitcommit: 42517355cc32890b1686de996c7913c98634e348
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/02/2020
ms.locfileid: "76964606"
---
# <a name="build-a-classifier--use-python-scripts-to-predict-credit-risk-using-azure-machine-learning-designer"></a>Создание классификатора и использование скриптов Python для прогнозирования кредитных рисков с помощью конструктора Машинного обучения Azure

**Конструктор (предварительная версия) — пример 4**

[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-enterprise-sku.md)]

В этой статье показано, как создать сложный конвейер машинного обучения с помощью конструктора (предварительная версия). Вы узнаете, как реализовать пользовательскую логику с помощью скриптов Python и сравнить несколько моделей, чтобы выбрать наилучший вариант.

В этом примере показано, как обучить классификатор для прогнозирования кредитного риска с помощью таких предоставляемых приложением для кредитования сведений, как история кредита, возраст и количество кредитных карт. Но вы можете использовать эту статью, чтобы решить свои задачи, связанные с машинным обучением.

Вот финальная версия графа этого конвейера:

[![Граф конвейера](./media/how-to-designer-sample-classification-credit-risk-cost-sensitive/graph.png)](./media/how-to-designer-sample-classification-credit-risk-cost-sensitive/graph.png#lightbox)

## <a name="prerequisites"></a>Предварительные требования

[!INCLUDE [aml-ui-prereq](../../includes/aml-ui-prereq.md)]

4. Щелкните пример 4, чтобы открыть его.

## <a name="data"></a>Данные

В этом примере используется набор данных German Credit Card из репозитория UC Irvine. Он содержит 1000 примеров с 20 признаками и одной меткой. Каждый пример представляет собой человека. 20 признаков включают в себя числовые и категориальные признаки. См. сведения на [веб-сайте UCI](https://archive.ics.uci.edu/ml/datasets/Statlog+%28German+Credit+Data%29). Последний столбец — это метка, которая обозначает кредитный риск и имеет только два возможных значения: 1 — высокий кредитный риск и 2 — низкий кредитный риск.

## <a name="pipeline-summary"></a>Сводка по конвейеру

В этом конвейере сравниваются два разных подхода к созданию моделей для решения этой проблемы:

- обучение с помощью исходного набора данных;
- обучение с помощью реплицированного набора данных.

Оба этих подхода позволяют анализировать модели на основе тестового набора данных с репликацией, чтобы обеспечить согласованность результатов с функцией затрат. Протестируйте два классификатора с использованием обоих подходов: **двухклассового метода опорных векторов** и **двухклассового увеличивающегося дерева принятия решений**.

Затраты, связанные с неправильной классификацией низкого уровня риска как высокого имеет значение 1, а затраты, связанные с неправильной классификацией высокого уровня риска как низкого — значение 5. Для учета затрат, связанных с неправильной классификацией, мы используем модуль **выполнения скрипта Python**.

Вот граф этого конвейера:

[![Граф конвейера](./media/how-to-designer-sample-classification-credit-risk-cost-sensitive/graph.png)](./media/how-to-designer-sample-classification-credit-risk-cost-sensitive/graph.png#lightbox)

## <a name="data-processing"></a>Обработка данных

Начните с использования модуля **редактора метаданных**, чтобы добавить имена столбцов для замены имен столбцов по умолчанию более понятными именами, полученными из описания набора данных на сайте UCI. Укажите новые имена столбцов в виде значений с разделителями-запятыми в соответствующее поле для имени **нового столбца** модуля **редактора метаданных**.

Затем создайте наборы данных для обучения и тестирования, используемые для разработки модели прогнозирования рисков. Разделите исходный набор данных на обучающие и тестовые наборы одинакового размера с помощью модуля **разделения данных**. Чтобы создать наборы одинакового размера укажите для **доли строк в первом наборе выходных данных** значение 0,7.

### <a name="generate-the-new-dataset"></a>Создание набора данных

Так как затраты, связанные с неправильной оценкой, сопряжены с высокими расходами, определите эти затраты следующим образом.

- Для случаев с высоким риском, неправильно классифицированных как случаи с низким риском: 5
- Для случаев с низким риском, неправильно классифицированных как случаи с высоким риском: 1

Чтобы отразить эту функцию затрат, создайте новый набор данных. В этом новом наборе данных каждый пример высокого риска реплицируется пять раз. При этом число примеров низкого риска не изменяется. Перед репликацией разбейте данные на наборы данных для обучения и тестирования, чтобы предотвратить появление дублирование строк в двух наборах.

Чтобы реплицировать данные с высоким риском, вставьте следующий код Python в модуль **выполнения скрипта Python**:

```Python
import pandas as pd

def azureml_main(dataframe1 = None, dataframe2 = None):

    df_label_1 = dataframe1[dataframe1.iloc[:, 20] == 1]
    df_label_2 = dataframe1[dataframe1.iloc[:, 20] == 2]

    result = df_label_1.append([df_label_2] * 5, ignore_index=True)
    return result,
```

Модуль **выполнения скрипта Python** выполняет репликацию обоих наборов данных.

### <a name="feature-engineering"></a>Проектирование признаков

Для работы **двухклассового метода опорных векторов** требуются нормализованные данные. Поэтому используйте модуль **нормализации данных** для нормализации диапазонов всех числовых признаков с помощью преобразования `tanh`. Преобразование `tanh` преобразует все числовые признаки в значения в диапазоне от 0 до 1 с сохранением общего распределения значений.

Модуль **двухклассового метода опорных векторов** обрабатывает строковые признаки, преобразуя их сначала в категориальные, а затем в двоичные признаки со значением 0 или 1. Поэтому вам не нужно нормализовать эти признаки.

## <a name="models"></a>Модели

Так как вы применили два классификатора — **двухклассовый метод опорных векторов** (SVM) и **двухклассовое увеличивающееся дерево принятия решений**, — а также два набора данных, всего вы создадите четыре модели:

- SVM с обучением на основе исходных данных;
- SVM с обучением на основе реплицированных данных;
- увеличивающееся дерево принятия решений с обучением на основе исходных данных;
- увеличивающееся дерево принятия решений с обучением на основе реплицированных данных.

В этом примере используется стандартный рабочий процесс обработки и анализа данных для создания, обучения и тестирования моделей.

1. Инициализируйте алгоритмы машинного обучения, используя **двухклассовый метод опорных векторов** и **двухклассовое увеличивающееся дерево принятия решений**.
1. Используйте модуль **обучения модели**, чтобы применить алгоритм к данным и создать фактическую модель.
1. Используйте модуль **оценки модели**, чтобы получить оценки на основе тестовых примеров.

На следующей схеме показана часть этого конвейера, в котором исходные и реплицированные обучающие наборы используются для обучения двух разных моделей SVM. Модуль **обучения модели** подключается к набору данных для обучения, а модуль **оценки модели** — к набору данных для тестирования.

![Граф конвейера](./media/how-to-designer-sample-classification-credit-risk-cost-sensitive/score-part.png)

На этапе анализа конвейера вычисляется точность каждой из четырех моделей. Для этого конвейера используйте модуль **оценки модели**, чтобы сравнить примеры с одинаковыми затратами, связанными с неправильной классификацией.

Модуль **оценки модели** может вычислять метрики производительности в двух оцененных моделях. Таким образом, можно использовать один экземпляр модуля **оценки модели**, чтобы оценить две модели SVM, а другой экземпляр модуля **оценки модели** для вычисления двух моделей увеличивающегося дерева принятия решений.

Обратите внимание, что в качестве входных данных для модуля **оценки модели** используется реплицированный набор данных для тестирования. Иными словами, окончательные оценки точности описывают затраты, связанные с неправильным получением меток.

## <a name="combine-multiple-results"></a>Объединение нескольких результатов

Модуль **оценки модели** создает таблицу с одной строкой, содержащей разные метрики. Чтобы создать единый набор результатов оценки точности, сначала используется модуль **добавления строк** для объединения результатов в одну таблицу. Затем используется следующий скрипт Python в модуле **выполнения скрипта Python** для добавления имени модели и включению обучающего подхода для каждой строки в таблице результатов:

```Python
import pandas as pd

def azureml_main(dataframe1 = None, dataframe2 = None):

    new_cols = pd.DataFrame(
            columns=["Algorithm","Training"],
            data=[
                ["SVM", "weighted"],
                ["SVM", "unweighted"],
                ["Boosted Decision Tree","weighted"],
                ["Boosted Decision Tree","unweighted"]
            ])

    result = pd.concat([new_cols, dataframe1], axis=1)
    return result,
```

## <a name="results"></a>Результаты

Для просмотра результатов конвейера щелкните правой кнопкой мыши визуализацию выходных данных последнего модуля **выбора столбцов в наборе данных**.

![Визуализация выходных данных](media/how-to-designer-sample-classification-credit-risk-cost-sensitive/sample4-lastselect-1225.png)

В первом столбце перечисляются алгоритмы машинного обучения, используемые для создания модели.

Во втором столбце указывается тип набора данных для обучения.

Третий столбец содержит значение анализа точности с учетом затрат.

Эти результаты демонстрируют то, что наивысшая точность обеспечивается моделью, созданной с помощью **двухклассового метода опорных векторов** и обученной на основе реплицированного набора данных для обучения.

## <a name="clean-up-resources"></a>Очистка ресурсов

[!INCLUDE [aml-ui-cleanup](../../includes/aml-ui-cleanup.md)]

## <a name="next-steps"></a>Дальнейшие действия

Изучите другие примеры, доступные для использования с конструктором:

- [Пример 1. Регрессия: прогнозирование цен на автомобили](how-to-designer-sample-regression-automobile-price-basic.md)
- [Пример 2. Регрессия: сравнение алгоритмов для прогнозирования цен на автомобили](how-to-designer-sample-regression-automobile-price-compare-algorithms.md)
- [Пример 3. Классификация с выбором признаков: прогнозирование дохода](how-to-designer-sample-classification-predict-income.md)
- [Пример 5. Классификация: прогнозирование оттока клиентов](how-to-designer-sample-classification-churn.md)
- [Пример 6. Классификация: прогнозирование задержки рейсов](how-to-designer-sample-classification-flight-delay.md)
- [Пример 7. Классификация текста: набор данных Wikipedia SP 500](how-to-designer-sample-text-classification.md)
