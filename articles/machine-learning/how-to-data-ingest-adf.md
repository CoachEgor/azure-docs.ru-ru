---
title: Прием данных с помощью Фабрики данных Azure
titleSuffix: Azure Machine Learning
description: Узнайте, как создать конвейер приема данных с помощью фабрики данных Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.author: iefedore
author: eedorenko
manager: davete
ms.reviewer: larryfr
ms.date: 03/01/2020
ms.topic: conceptual
ms.custom: how-to, tracking-python
ms.openlocfilehash: 80e912cb5d4cf428c406242b06c30ccf56ccd6ca
ms.sourcegitcommit: a76ff927bd57d2fcc122fa36f7cb21eb22154cfa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87326330"
---
# <a name="data-ingestion-with-azure-data-factory"></a>Прием данных с помощью Фабрики данных Azure

Из этой статьи вы узнаете, как создать конвейер приема данных с помощью фабрики данных Azure (ADF). Этот конвейер используется для приема данных для использования с Машинное обучение Azure. Фабрика данных Azure позволяет легко извлекать, преобразовывать и загружать данные (ETL). После преобразования и загрузки данных в хранилище их можно использовать для обучения моделей машинного обучения.

Простое преобразование данных можно обрабатывать с помощью собственных действий ADF и инструментов, таких как [поток данных](https://docs.microsoft.com/azure/data-factory/control-flow-execute-data-flow-activity). Когда речь идет о более сложных сценариях, данные могут обрабатываться с помощью пользовательского кода. Например, код Python или R.

Существует несколько распространенных способов использования фабрики данных Azure для преобразования данных во время приема. Каждый метод имеет свои достоинства и недостатки, которые определяют, подходит ли он для конкретного варианта использования:

| Метод | Плюсы | Минусы |
| ----- | ----- | ----- |
| ADF + функции Azure | Низкая задержка, бессерверные вычислений</br>Функции с отслеживанием состояния</br>Многократно используемые функции | Хорошо работает только для кратковременной обработки |
| ADF + пользовательский компонент | Крупномасштабные параллельные вычисления</br>Подходит для интенсивных алгоритмов | Перенос кода в исполняемый файл</br>Сложность обработки зависимостей и операций ввода-вывода |
| Блокнот ADF + Azure Databricks | Apache Spark</br>Собственная среда Python | Может быть дорогостоящим</br>Создание кластеров изначально занимает некоторое время и увеличивает задержку

## <a name="adf-with-azure-functions"></a>ADF с функциями Azure

![Функция ADF](media/how-to-data-ingest-adf/adf-function.png)

Функции Azure позволяют запускать небольшие фрагменты кода (функции), не беспокоясь о инфраструктуре приложений. В этом случае данные обрабатываются с помощью пользовательского кода Python, упакованного в функцию Azure. 

Функция вызывается с помощью [действия функции Azure ADF](https://docs.microsoft.com/azure/data-factory/control-flow-azure-function-activity). Этот подход является хорошим вариантом для упрощенных преобразований данных. 

* Преимущества.
    * Данные обрабатываются в бессерверных расчетах с относительно низкой задержкой.
    * Конвейер ADF может вызывать [устойчивую функцию Azure](/azure/azure-functions/durable/durable-functions-overview) , которая может реализовать сложный поток преобразования данных. 
    * Сведения о преобразовании данных являются абстрактными для функции Azure, которую можно повторно использовать и вызывать из других мест.
* Недостатки.
    * Функции Azure необходимо создать перед использованием с ADF
    * Функции Azure хороши только для кратковременной обработки данных.

## <a name="adf-with-custom-component-activity"></a>ADF с действием настраиваемого компонента

![ADF-кустомкомпонент](media/how-to-data-ingest-adf/adf-customcomponent.png)

В этом случае данные обрабатываются с помощью пользовательского кода Python, упакованного в исполняемый файл. Он вызывается с помощью [действия настраиваемого компонента ADF](https://docs.microsoft.com/azure/data-factory/transform-data-using-dotnet-custom-activity). Этот подход лучше подходит для больших данных, чем предыдущий метод.

* Преимущества.
    * Данные обрабатываются в пуле [пакетной службы Azure](https://docs.microsoft.com/azure/batch/batch-technical-overview) , который обеспечивает крупномасштабные параллельные и высокопроизводительные вычисления.
    * Может использоваться для запуска интенсивных алгоритмов и обработки значительных объемов данных.
* Недостатки.
    * Пул пакетной службы Azure необходимо создать перед использованием с ADF
    * Помимо проектирования, связанной с переносом кода Python в исполняемый файл. Сложность обработки зависимостей и входных и выходных параметров

## <a name="adf-with-azure-databricks-python-notebook"></a>Файл ADF с записной книжкой Azure Databricks Python

![ADF — кирпичы](media/how-to-data-ingest-adf/adf-databricks.png)

[Azure Databricks](https://azure.microsoft.com/services/databricks/) — это платформа аналитики на основе Apache Spark в Microsoft Cloud.

В этом методе преобразование данных выполняется в [записной книжке Python](https://docs.microsoft.com/azure/data-factory/transform-data-using-databricks-notebook), которая выполняется в кластере Azure Databricks. Возможно, это самый распространенный подход, использующий всю мощь службы Azure Databricks. Он предназначен для распределенной обработки данных в масштабе.

* Преимущества.
    * Данные преобразуются в самую мощную службу Azure для обработки данных, резервная копия которой задается средой Apache Spark
    * Собственная поддержка Python вместе с платформами и библиотеками для обработки и анализа данных, включая TensorFlow, PyTorch и scikit-учиться
    * Нет необходимости упаковывать код Python в функции или исполняемые модули. Код работает как есть.
* Недостатки.
    * Azure Databricks инфраструктуру необходимо создать перед использованием с ADF
    * Может быть дорогостоящей в зависимости от конфигурации Azure Databricks
    * Вращение кластеров вычислений из "холодного" режима занимает некоторое время, что приводит к высокой задержке решения. 
    

## <a name="consuming-data-in-azure-machine-learning-pipelines"></a>Использование данных в конвейерах Машинное обучение Azure

![AML — набор данных](media/how-to-data-ingest-adf/aml-dataset.png)

Преобразованные данные из конвейера ADF сохраняются в хранилище данных (например, в большом двоичном объекте Azure). Машинное обучение Azure может получать доступ к этим данным с помощью [хранилищ](https://docs.microsoft.com/azure/machine-learning/how-to-access-data#create-and-register-datastores) данных и [DataSets](https://docs.microsoft.com/azure/machine-learning/how-to-create-register-datasets).

При каждом запуске конвейера ADF данные сохраняются в другом месте в хранилище. Чтобы передать расположение в Машинное обучение Azure, конвейер ADF вызывает конвейер Машинное обучение Azure. При вызове конвейера машинного обучения расположение данных и идентификатор запуска отправляются в качестве параметров. Затем конвейер машинного обучения может создать хранилище данных или набор данных с помощью расположения. 

> [!TIP]
> Наборы данных [поддерживают управление версиями](https://docs.microsoft.com/azure/machine-learning/how-to-version-track-datasets), поэтому конвейер машинного обучения может зарегистрировать новую версию DataSet, которая указывает на самые последние данные из конвейера ADF.

После доступа к данным через хранилище данных или набор данных их можно использовать для обучения модели машинного обучения. Процесс обучения может быть частью того же конвейера ML, который вызывается из ADF. Или это может быть отдельный процесс, например экспериментирование в записной книжке Jupyter.

Так как наборы данных поддерживают управление версиями, и каждый запуск из конвейера создает новую версию, легко понять, какая версия используется для обучения модели.

## <a name="next-steps"></a>Дальнейшие действия

* [Запуск записной книжки кирпичей в фабрике данных Azure](https://docs.microsoft.com/azure/data-factory/transform-data-using-databricks-notebook)
* [Доступ к данным в службах хранилища Azure](https://docs.microsoft.com/azure/machine-learning/how-to-access-data#create-and-register-datastores)
* [Обучение моделей с помощью наборов данных в Машинное обучение Azure](https://docs.microsoft.com/azure/machine-learning/how-to-train-with-datasets)
* [DevOps для конвейера приема данных](https://docs.microsoft.com/azure/machine-learning/how-to-cicd-data-ingestion)

