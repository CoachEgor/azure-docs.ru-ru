---
title: Добавление признаков в Аутомл экспериментах
titleSuffix: Azure Machine Learning
description: Узнайте, какие параметры Добавление признаков Машинное обучение Azure предложения и как инженерные функции поддерживаются в автоматизированных экспериментах ML.
author: nibaccam
ms.author: nibaccam
ms.reviewer: nibaccam
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.custom: how-to
ms.date: 05/28/2020
ms.openlocfilehash: 31df880d9d6d586491d115d9b70de9f85bc980b2
ms.sourcegitcommit: 11e2521679415f05d3d2c4c49858940677c57900
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2020
ms.locfileid: "87502925"
---
# <a name="featurization-in-automated-machine-learning"></a>Добавление признаков в автоматизированном машинном обучении

[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-basic-enterprise-sku.md)]

В этом руководство вы узнаете следующее:

- Какие параметры Добавление признаков Машинное обучение Azure предложения.
- Как настроить эти функции для [автоматических экспериментов машинного обучения](concept-automated-ml.md).

*Проектирование* признаков — это процесс использования базы данных предметной области для создания функций, помогающих оптимизировать алгоритмы машинного обучения (ml). В Машинное обучение Azure методики масштабирования и нормализации данных применяются для упрощения проектирования функций. В совокупности эти методы и инженерные функции называются *Добавление признаков* в автоматизированном машинном обучении или *аутомл*.

В этой статье предполагается, что вы уже знакомы с настройкой эксперимента Аутомл. Дополнительные сведения о конфигурации см. в следующих статьях:

- Для первого интерфейса: [Настройте автоматические эксперименты ml с помощью машинное обучение Azure пакета SDK для Python](how-to-configure-auto-train.md).
- Для работы с низким кодом или без кода: [Создание, проверка и развертывание автоматизированных моделей машинного обучения с помощью машинное обучение Azure Studio](how-to-use-automated-ml-for-ml-models.md).

## <a name="configure-featurization"></a>Настройка Добавление признаков

В каждом автоматическом эксперименте машинного обучения [Автоматические методики масштабирования и нормализации](#featurization) применяются к данным по умолчанию. Эти методы являются типами Добавление признаков, которые помогают *некоторым* алгоритмам, которые чувствительны к функциям различных масштабов. Однако можно также включить дополнительные Добавление признаков, такие как *отсутствующие значения добавления отсутствующих*, *Кодировка*и *преобразования*.

> [!NOTE]
> Действия по автоматическому Добавление признакову машинного обучения (например, нормализация компонентов, обработка недостающих данных или преобразование текста в числовой) становятся частью базовой модели. При использовании модели для прогнозов те же действия Добавление признаков, которые применяются во время обучения, автоматически применяются к входным данным.

Для экспериментов, настроенных с помощью пакета SDK для Python, можно включить или отключить параметр Добавление признаков, а затем указать шаги Добавление признаков, которые будут использоваться в эксперименте. Если вы используете Машинное обучение Azure Studio, см. [инструкции по включению Добавление признаков](how-to-use-automated-ml-for-ml-models.md#customize-featurization).

В следующей таблице показаны допустимые параметры для `featurization` в [классе аутомлконфиг](/python/api/azureml-train-automl-client/azureml.train.automl.automlconfig.automlconfig):

|Конфигурация Добавление признаков | Описание|
------------- | ------------- |
|`"featurization": 'auto'`| Указывает, что в рамках предварительной обработки [шаги снятие и добавление признаков данных](#featurization) должны выполняться автоматически. Это значение по умолчанию.|
|`"featurization": 'off'`| Указывает, что добавление признаков шаги не должны выполняться автоматически.|
|`"featurization":`&nbsp;`'FeaturizationConfig'`| Указывает, что необходимо использовать настраиваемые шаги Добавление признаков. [Узнайте, как настроить конструирование признаков](#customize-featurization).|

<a name="featurization"></a>

## <a name="automatic-featurization"></a>Автоматическое выделение признаков

В следующей таблице перечислены методы, автоматически применяемые к данным. Эти методы применяются для экспериментов, настроенных с помощью пакета SDK или студии. Чтобы отключить это поведение, задайте `"featurization": 'off'` в `AutoMLConfig` объекте.

> [!NOTE]
> Если вы планируете экспортировать модели, созданные Аутомл, в [модель ONNX](concept-onnx.md), в формате ONNX поддерживаются только параметры Добавление признаков, обозначенные звездочкой ("*"). Узнайте больше о [преобразовании моделей в ONNX](concept-automated-ml.md#use-with-onnx).

|Добавление признаков &nbsp; шаги| Описание |
| ------------- | ------------- |
|**Удалить большую кратность или функции вариативности*** |Удалите эти компоненты из наборов обучения и проверки. Применяется к функциям со всеми отсутствующими значениями с одинаковым значением во всех строках или с большим количеством элементов (например, с помощью хэшей, идентификаторов или идентификаторов GUID).|
|**Отсутствующие значения аппроксимация*** |Для числовых функций аппроксимация с средним значением в столбце.<br/><br/>Для характеристик категорий аппроксимация с наиболее частым значением.|
|**Создание дополнительных компонентов*** |Для признаков даты и времени: год, месяц, день, день недели, день года, квартал, неделя года, час, минута, секунда.<br><br> *Для задач прогнозирования* создаются следующие дополнительные функции даты и времени: ISO-год, полугодовой год, календарный месяц в виде строки, недели, дня недели в виде строки, дня квартала, дня года, AM/PM (0, если час находится перед полуднем (12 РМ), 1 в противном случае), AM/PM в виде строки, часа дня (12hr базис)<br/><br/>Для текстовых характеристик: частота терминов на основе униграмм, биграмм и триграммов. Дополнительные сведения о [том, как это делается с помощью Берт.](#bert-integration)|
|**Преобразование и кодирование***|Преобразуйте числовые функции, которые имеют несколько уникальных значений, в функции категорий.<br/><br/>Для функций категоризации с низким количеством элементов используется односторонняя кодировка. Для функций категоризации с высоким количеством элементов используется односторонняя хэш-кодировка.|
|**Внедрение слов**|Текстовый характеризатора преобразует векторы текстовых маркеров в векторы предложений с помощью предварительно обученной модели. Каждый вектор внедрения слова в документе объединяется с остальными для создания вектора возможностей документа.|
|**Кодирование целевых объектов**|Для функций классификации на этом шаге каждая категория сопоставляется со средним целевым значением для задач регрессии, а также с вероятностью класса для каждого класса при возникновении проблем с классификацией. Весовые коэффициенты на основе частоты и перекрестная проверка на уровне k применяются для уменьшения перегонки сопоставления и шума, вызванных категориями разреженных данных.|
|**Кодирование целевого текста**|При вводе текста для получения вероятности каждого класса применяется линейная модель с накоплением, в которой используются наборы слов.|
|**Весовой коэффициент свидетельства**|Вычисляет весовой коэффициент свидетельства как меру корреляции категориальных столбцов с целевым столбцом. Вое вычисляется как журнал соотношения между вероятностями в классе и вне класса. Этот шаг создает один столбец числового компонента для каждого класса и устраняет необходимость явно аппроксимация отсутствующие значения и обработку выбросов.|
|**Расстояние в кластере**|Обучение модели кластеризации с k-средних по всем числовым столбцам. Создает *новые* функции (по одной новой числовой функции на кластер), которые содержат расстояние от каждого образца до центроид каждого кластера.|

## <a name="data-guardrails"></a>Проверки данных

*Снятие данных* помогают определить потенциальные проблемы с данными (например, отсутствующие значения или [дисбаланс класса](concept-manage-ml-pitfalls.md#identify-models-with-imbalanced-data)). Они также помогают выполнять корректирующие действия для улучшения результатов.

Применяются снятие данных:

- **Для экспериментов с пакетом SDK**: при `"featurization": 'auto'` `validation=auto` указании параметров или в `AutoMLConfig` объекте.
- **Для экспериментов Studio**: Если автоматическая Добавление признаков включена.

Вы можете ознакомиться с снятие данных для своего эксперимента:

- Путем настройки `show_output=True` при отправке эксперимента с помощью пакета SDK.

- В студии на вкладке **Data снятие (данные** ) автоматического запуска ml.

### <a name="data-guardrail-states"></a>Состояния гуардраил данных

Снятие данных отображает одно из трех состояний:

|Состояние| Описание |
|----|---- |
|**Пройдено**| Проблемы с данными не обнаружены, никаких действий не требуется. |
|**Готово**| К данным применены изменения. Мы рекомендуем ознакомиться с действиями по исправлению, которые были выполнены Аутомл, чтобы убедиться, что изменения согласованы с ожидаемыми результатами. |
|**Оповещено**| Обнаружена ошибка данных, но ее не удалось исправлено. Мы рекомендуем вам исправить и устранить проблему.|

### <a name="supported-data-guardrails"></a>Поддерживаемые снятие данных

В следующей таблице описаны поддерживаемые в настоящее время снятие данных и связанные с ними состояния, которые могут появиться при отправке эксперимента.

Проверка|Состояние|Условие&nbsp;запуска&nbsp;
---|---|---
**Аппроксимация отсутствующих значений признаков** |Passed <br><br><br> Готово| В данных для обучения не обнаружено ни одного отсутствующего значения признака. Дополнительные сведения об [отсутствующем значении добавления отсутствующих.](https://docs.microsoft.com/azure/machine-learning/how-to-use-automated-ml-for-ml-models#advanced-featurization-options) <br><br> В обучающих данных обнаружены отсутствующие значения компонентов, и они были добавленные.
**Обработка признаков высокой кратности** |Passed <br><br><br> Готово| Ваши входные данные проанализированы, и не обнаружены функции высокой кратности. <br><br> В ваших входных данных обнаружены функции высокой кратности, которые были обработаны.
**Обработка разделения при проверке** |Готово| Конфигурация проверки была установлена в `'auto'` , а обучающие данные содержат *менее 20 000 строк*. <br> Каждая итерация обученной модели была проверена с помощью перекрестной проверки. Дополнительные сведения о [данных проверки](https://docs.microsoft.com/azure/machine-learning/how-to-configure-auto-train#train-and-validation-data). <br><br> Конфигурация проверки была установлена в `'auto'` , а обучающие данные содержат *более 20 000 строк*. <br> Входные данные разделены на набор данных для обучения и набор данных для проверки, который используется для проверки модели.
**Обнаружение балансировки классов** |Passed <br><br><br><br><br> Оповещено <br><br><br><br> Готово| Входные данные проанализированы. Все классы в данных для обучения сбалансированы. Набор данных считается сбалансированным, если каждый класс имеет хорошее представление в наборе данных, как измеряется по числу и соотношениям выборок. <br><br> Во входных данных обнаружены несбалансированные классы. Чтобы исправить уровень смещения модели, устраните проблему с балансировкой. Дополнительные сведения об [несбалансированных данных](https://docs.microsoft.com/azure/machine-learning/concept-manage-ml-pitfalls#identify-models-with-imbalanced-data). <br><br> В входных данных обнаружены несбалансированные классы, и логика очистки была определена для применения балансировки.
**Обнаружение проблем с памятью** |Passed <br><br><br><br> Готово |<br> Были проанализированы выбранные значения (горизонт, запаздывание, пошаговое окно) и обнаружены потенциальные проблемы нехватки памяти. Дополнительные сведения о [конфигурациях прогнозирования](https://docs.microsoft.com/azure/machine-learning/how-to-auto-train-forecast#configure-and-run-experiment)временных рядов. <br><br><br>Выбранные значения (горизонт, запаздывание, пошаговое окно) были проанализированы и потенциально могут привести к нехватке памяти для эксперимента. Настройки запаздывания или последовательного окна отключены.
**Обнаружение частоты** |Passed <br><br><br><br> Готово |<br> Временные ряды были проанализированы, и все точки данных согласовываются с обнаруженной частотой. <br> <br> Временные ряды были проанализированы, и обнаружены точки данных, которые не совпадают с обнаруженной частотой. Эти точки данных удалены из набора данных. Дополнительные сведения о [подготовке данных для прогнозирования временных рядов](https://docs.microsoft.com/azure/machine-learning/how-to-auto-train-forecast#preparing-data).

## <a name="customize-featurization"></a>Настройка Добавление признаков

Вы можете настроить параметры Добавление признаков, чтобы убедиться, что данные и функции, используемые для обучения результатов модели ML, соответствуют прогнозам.

Чтобы настроить феатуризатионс, укажите  `"featurization": FeaturizationConfig` в `AutoMLConfig` объекте. Если вы используете Машинное обучение Azure Studio для эксперимента, см. инструкции в [статье](how-to-use-automated-ml-for-ml-models.md#customize-featurization). Чтобы настроить добавление признаков для типов задач прогнозирования, см. [инструкции по прогнозированию](how-to-auto-train-forecast.md#customize-featurization).

Поддерживаемые настройки

|Настройка|Определение|
|--|--|
|**Изменение назначения столбца**|Переопределение автоматического обнаруженного типа компонента для указанного столбца.|
|**Изменение параметра преобразователя** |Обновите параметры для указанного преобразователя. В настоящее время поддерживает *импутер* (среднее, наиболее частые и медиана) и *хашонехотенкодер*.|
|**Удаление столбцов** |Указывает столбцы для удаления из признаками.|
|**Блокирование преобразователей**| Указывает блочные преобразователи для использования в процессе Добавление признаков.|

Создайте `FeaturizationConfig` объект с помощью вызовов API:

```python
featurization_config = FeaturizationConfig()
featurization_config.blocked_transformers = ['LabelEncoder']
featurization_config.drop_columns = ['aspiration', 'stroke']
featurization_config.add_column_purpose('engine-size', 'Numeric')
featurization_config.add_column_purpose('body-style', 'CategoricalHash')
#default strategy mean, add transformer param for for 3 columns
featurization_config.add_transformer_params('Imputer', ['engine-size'], {"strategy": "median"})
featurization_config.add_transformer_params('Imputer', ['city-mpg'], {"strategy": "median"})
featurization_config.add_transformer_params('Imputer', ['bore'], {"strategy": "most_frequent"})
featurization_config.add_transformer_params('HashOneHotEncoder', [], {"number_of_bits": 3})
```

## <a name="bert-integration"></a>Интеграция БЕРТ 
[Берт](https://techcommunity.microsoft.com/t5/azure-ai/how-bert-is-integrated-into-azure-automated-machine-learning/ba-p/1194657) используется в слое Добавление признаков автоматизированного ml. На этом уровне мы определим, содержит ли столбец произвольный текст или другие типы данных, такие как метки времени или простые числа, и мы создание признаков соответствующим образом. Для БЕРТ мы Точная настройка и обучение модели с помощью предоставленных пользователем меток, а затем выводите внедренные документы (для БЕРТ это окончательное скрытое состояние, связанное с специальным маркером [CLS]), как функции наряду с другими функциями, такими как функции на основе метки времени (например, день недели) или числа, которые имеют многие стандартные наборы данных. 

Чтобы включить БЕРТ, следует использовать функцию вычислений GPU для обучения. Если используется вычислительная среда ЦП, то вместо БЕРТ Аутомл включит Билстм DNN характеризатора. Чтобы вызвать БЕРТ, необходимо задать "enable_dnn: true" в automl_settings и использовать вычисление GPU (например, vm_size = "STANDARD_NC6" или более высокий графический процессор). Пример см. [в этой записной книжке](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/classification-text-dnn/auto-ml-classification-text-dnn.ipynb).

Аутомл выполняет следующие действия, в случае с БЕРТ (Обратите внимание, что для выполнения этих элементов необходимо установить "enable_dnn: true" в automl_settings.)

1. Предварительная обработка, включая разметку всех текстовых столбцов (вы увидите "Стрингкаст" в сводке Добавление признаков финальной модели. Посетите [эту записную книжку](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/classification-text-dnn/auto-ml-classification-text-dnn.ipynb) , чтобы увидеть пример того, как создать сводку Добавление признаков для модели с помощью `get_featurization_summary()` метода.

```python
text_transformations_used = []
for column_group in fitted_model.named_steps['datatransformer'].get_featurization_summary():
    text_transformations_used.extend(column_group['Transformations'])
text_transformations_used
```

2. Объединяет все текстовые столбцы в один текстовый столбец, поэтому в окончательной модели вы увидите «Стрингконкаттрансформер». 

> [!NOTE]
> Наша реализация БЕРТ ограничивает общую длину текста учебной выборки до 128 маркеров. Это означает, что все текстовые столбцы при объединении в идеале должны иметь длину не более 128 маркеров. В идеале, если имеется несколько столбцов, необходимо очистить каждый столбец таким, чтобы это условие было удовлетворено. Например, если в данных есть два текстовых столбца, то оба столбца текста должны быть очищены до 64 токенов each (предполагая, что оба столбца должны быть одинаково представлены в последнем объединенном текстовом столбце) перед передачей данных Аутомл. Для сцепленных столбцов длины >128 маркеры, уровень БЕРТного маркера будет усекать эти входные данные до токенов 128.

3. На шаге "Очистка компонентов" Аутомл сравнивает БЕРТ с базовым (набором слов "функции" + "предварительно обученные слова") на примере данных и определяет, будет ли БЕРТ предоставляться точность. Если он определяет, что БЕРТ работает лучше, чем базовый план, Аутомл использует БЕРТ для текста Добавление признаков в качестве оптимальной стратегии Добавление признаков и переходит к феатуризинг всем данным. В этом случае в окончательной модели вы увидите «Претраинедтекстдннтрансформер».

Обычно БЕРТ работает дольше большинства других феатуризерс. Его можно ускоряют, предоставив больше вычислений в кластере. Аутомл будет распространять БЕРТ обучение по нескольким узлам, если они доступны (максимум 8 узлов). Это можно сделать, задав для параметра [max_concurrent_iterations](https://docs.microsoft.com/python/api/azureml-train-automl-client/azureml.train.automl.automlconfig.automlconfig?view=azure-ml-py) значение выше 1. Для повышения производительности рекомендуется использовать номера SKU с возможностями RDMA (например, "STANDARD_NC24r" или "STANDARD_NC24rs_V3").

Аутомл в настоящее время поддерживает около 100 языков и, в зависимости от языка набора данных, Аутомл выбирает соответствующую модель БЕРТ. Для данных на немецком языке мы используем модель Германии БЕРТ. Для английского языка используется модель на английском языке БЕРТ. Для всех других языков используется многоязыковая модель БЕРТ.

В следующем коде активируется модель Германии БЕРТ, так как для языка набора данных задано значение "DEU", 3-буквенный код языка для Германии в соответствии с [классификацией ISO](https://iso639-3.sil.org/code/deu):

```python
from azureml.automl.core.featurization import FeaturizationConfig

featurization_config = FeaturizationConfig(dataset_language='deu')

automl_settings = {
    "experiment_timeout_minutes": 120,
    "primary_metric": 'accuracy', 
# All other settings you want to use 
    "featurization": featurization_config,
    
  "enable_dnn": True, # This enables BERT DNN featurizer
    "enable_voting_ensemble": False,
    "enable_stack_ensemble": False
}
```

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как настроить автоматические эксперименты ML:

    * Для первого интерфейса: [Настройте автоматические эксперименты ml с помощью пакета SDK для машинное обучение Azure](how-to-configure-auto-train.md).
    * Для работы с низким кодом или без кода: [создавайте автоматические эксперименты ML в машинное обучение Azure Studio](how-to-use-automated-ml-for-ml-models.md).

* Узнайте больше о том, [как и где можно развернуть модель](how-to-deploy-and-where.md).

* Узнайте больше о [том, как обучить модель регрессии с помощью автоматического машинного обучения](tutorial-auto-train-models.md) или [обучения с помощью автоматизированного машинного обучения на удаленном ресурсе](how-to-auto-train-remote.md).
