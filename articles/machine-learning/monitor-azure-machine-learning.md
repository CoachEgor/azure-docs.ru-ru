---
title: Мониторинг машинного обучения Azure (ru) Документы Майкрософт
description: Узнайте, как использовать Azure Monitor для просмотра, анализа и создания оповещений о метриках из Azure Machine Learning.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.reviewer: larryfr
ms.author: aashishb
author: aashishb
ms.date: 03/05/2020
ms.openlocfilehash: eb4f46322bec57fb4412d3ddebb345640556ca5c
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78399104"
---
# <a name="monitoring-azure-machine-learning"></a>Мониторинг машинного обучения Azure

В этой статье описаны данные мониторинга, генерируемые Azure Machine Learning. В нем также описывается, как можно использовать Azure Monitor для анализа данных и определения оповещений.

> [!TIP]
> Информация в этом документе предназначена в первую очередь для администраторов, так как в ней описывается мониторинг для машинного обучения Azure. Если вы являетесь специалистом по обработке данных или разработчиком и хотите отслеживать информацию, характерную для обучаемых моделей, смотрите следующие документы:
>
> * [Запуск, мониторинг и отмена тренировочных забегов](how-to-manage-runs.md)
> * [Запись метрик для учебных запусков](how-to-track-experiments.md)
> * [Отслеживание экспериментов с помощью потока ML](how-to-use-mlflow.md)
> * [Визуализация выполняется с помощью TensorBoard](how-to-monitor-tensorboard.md)

## <a name="azure-monitor"></a>Azure Monitor

Azure Machine Learning регистрирует мониторинг данных с помощью Azure Monitor, который является полноценным сервисом мониторинга стеков в Azure. Azure Monitor предоставляет полный набор функций для мониторинга ресурсов Azure. Он также может отслеживать ресурсы в других облаках и на месте.

Начните с [обзора azure Monitor,](/azure/azure-monitor/overview)в котором представлен обзор возможностей мониторинга. Следующие разделы основывается на этой информации, предоставляя специфику использования Azure Monitor с Azure Machine Learning.

Чтобы понять затраты, связанные с Azure Monitor, [см.](/azure/azure-monitor/platform/usage-estimated-costs) Чтобы понять время, необходимое для отображения данных в Azure Monitor, см. [время приема данных журнала.](/azure/azure-monitor/platform/data-ingestion-time)

## <a name="monitoring-data-from-azure-machine-learning"></a>Мониторинг данных машинного обучения Azure

Azure Machine Learning собирает те же данные мониторинга, что и другие ресурсы Azure, которые описаны в [данных мониторинга с ресурсов Azure.](/azure/azure-monitor/insights/monitor-azure-resource#monitoring-data) Для получения подробной ссылки на журналы и метрики, созданные Azure Machine Learning, можно ознакомиться с [рекомендацией мониторинга данных Azure Machine Learning.](monitor-resource-reference.md)

## <a name="analyzing-metric-data"></a>Анализ метрических данных

Вы можете анализировать метрики для машинного обучения Azure, **открывая метрики** из меню **Azure Monitor.** Подробную информацию об использовании этого инструмента можно узнать из-за использования этого инструмента с [помощью Azure Metrics Explorer.](/azure/azure-monitor/platform/metrics-getting-started)

Все метрики для машинного обучения Azure находятся в рабочей области службы **машинного обучения**namespace.

![Metrics Explorer с выбранным рабочим пространством службы машинного обучения](./media/monitor-azure-machine-learning/metrics.png)

### <a name="filtering-and-splitting"></a>Фильтрация и расщепление

Для метрик, поддерживающих размеры, можно применить фильтры с использованием значения измерения. Например, фильтрация **активных ядер** `cpu-cluster`для **названия кластера** . 

Можно также разделить метрику по размеру, чтобы визуализировать сравнение различных сегментов метрики друг с другом. Например, расщепление **типа шага конвейера** для просмотра количества типов шагов, используемых в конвейере.

Для получения дополнительной информации о фильтрации и [расщеплении см.](/azure/azure-monitor/platform/metrics-charts)

## <a name="alerts"></a>видны узлы

Вы можете получить доступ к оповещениям для машинного обучения Azure, открыв **оповещения** из меню **Azure Monitor.** Смотрите [создание, представление и управление метрическими оповещениями с помощью Azure Monitor](/azure/azure-monitor/platform/alerts-metric) для получения подробной информации о создании оповещений.

В следующей таблице перечислены общие и рекомендуемые правила оповещения метрики для машинного обучения Azure:

| Тип оповещения | Условие | Описание |
|:---|:---|:---|
| Развертывание модели не удалось | Тип агрегации: Всего, Оператор: больше, чем пороговое значение: 0 | При сбой одного или нескольких развертываний моделей |
| Процент использования квот | Тип агрегации: Средний, Оператор: больше, чем пороговое значение: 90| Когда процент использования квот превышает 90% |
| Непригодные узлы | Тип агрегации: Всего, Оператор: больше, чем пороговое значение: 0 | Когда есть один или несколько непригодных узлов |

## <a name="configuration"></a>Параметр Configuration

> [!IMPORTANT]
> __Метрики для машинного обучения Azure не нужно настраивать,__ они собираются автоматически и доступны в Metrics Explorer для мониторинга и оповещения.

Можно добавить диагностическую настройку для настройки следующих функций:

* Архивирование информации о журналах и метриках в учетной записи хранения Azure.
* Информация о журнале потока и метриках в концентратор событий Azure.
* Отправка информации о журналах и метриках в аналитику журналов Azure Monitor.

Включение этих параметров требует дополнительных служб Azure (учетная запись хранения, концентратор событий или аналитика журналов), что может увеличить стоимость. Чтобы рассчитать сметную стоимость, посетите [калькулятор ценообразования Azure.](https://azure.microsoft.com/pricing/calculator)

Для получения дополнительной информации о создании диагностической настройки [см. Создать диагностическую настройку для сбора журналов платформ и метрик в Azure.](/azure/azure-monitor/platform/diagnostic-settings)

Вы можете настроить следующие журналы для машинного обучения Azure:

| Категория | Описание |
|:---|:---|
| AmlComputeКластерСобытие | События из кластеров вычисляет машинное обучение Azure. |
| AmlComputeКластерНодеВент | События из узлов в вычислительном кластере Azure Machine Learning. |
| AmlComputeJobEvent | События из заданий, работающих на вычислениях машинного обучения Azure. |

> [!NOTE]
> При включении метрик в диагностической настройке информация о измерении в настоящее время не включается в состав информации, отправляемых в учетную запись хранения, концентратор событий или аналитику журналов.

## <a name="analyzing-log-data"></a>Анализ данных журнала

Использование аналитики журналов Azure Monitor необходимо создать диагностическую конфигурацию и включить __отправку информации__в журнал Analytics. Для получения дополнительной информации смотрите раздел [Конфигурация.](#configuration)

Данные в журналах Azure Monitor хранятся в таблицах, при этом каждая таблица имеет свой собственный набор уникальных свойств. Azure Machine Learning хранит данные в следующих таблицах:

| Таблица | Описание |
|:---|:---|
| AmlComputeКластерСобытие | События из кластеров вычисляет машинное обучение Azure. |
| AmlComputeКластерНодеВент | События из узлов в вычислительном кластере Azure Machine Learning. |
| AmlComputeJobEvent | События из заданий, работающих на вычислениях машинного обучения Azure. |

> [!IMPORTANT]
> При выборе **журналов** из меню машинного обучения Azure аналитика входа открывается с областью запроса, установленной в текущем рабочем пространстве. Это означает, что журнал запросов будет включать только данные из этого ресурса. Если требуется запустить запрос, включающий данные из других баз данных или данные из других служб Azure, выберите **журналы** из меню **Azure Monitor.** Подробнее о [возможности запроса и временном диапазоне в журнале Azure Monitor Analytics](/azure/azure-monitor/log-query/scope/) смотрите.

Подробную ссылку на журналы и метрики можно узнать о журналах и метриках, [см.](monitor-resource-reference.md)

### <a name="sample-queries"></a>Примеры запросов

Ниже приведены запросы, которые можно использовать для мониторинга ресурсов машинного обучения Azure: 

+ Получить неудачные рабочие места в течение последних пяти дней:

    ```Kusto
    AmlComputeJobEvent
    | where TimeGenerated > ago(5d) and EventType == "JobFailed"
    | project  TimeGenerated , ClusterId , EventType , ExecutionState , ToolType
    ```

+ Получите записи для конкретного имени задания:

    ```Kusto
    AmlComputeJobEvent
    | where JobName == "automl_a9940991-dedb-4262-9763-2fd08b79d8fb_setup"
    | project  TimeGenerated , ClusterId , EventType , ExecutionState , ToolType
    ```

+ Получайте кластерные события за последние пять дней для кластеров, где размер VM Standard_D1_V2:

    ```Kusto
    AmlComputeClusterEvent
    | where TimeGenerated > ago(4d) and VmSize == "STANDARD_D1_V2"
    | project  ClusterName , InitialNodeCount , MaximumNodeCount , QuotaAllocated , QuotaUtilized
    ```

+ Получите узлы, выделенные за последние восемь дней:

    ```Kusto
    AmlComputeClusterNodeEvent
    | where TimeGenerated > ago(8d) and NodeAllocationTime  > ago(8d)
    | distinct NodeId
    ```

## <a name="next-steps"></a>Дальнейшие действия

- Для справки о журналах и [Azure Machine Learning monitoring data reference](monitor-resource-reference.md)метриках см.
- Информацию о работе с квотами, связанными с машинным обучением Azure, можно узнать о [квотах Управления и запроса для ресурсов Azure.](how-to-manage-quotas.md)
- Подробнее о мониторинге ресурсов Azure можно узнать [в отделах мониторинга ресурсов Azure с помощью Azure Monitor.](/azure/azure-monitor/insights/monitor-azure-resource)
