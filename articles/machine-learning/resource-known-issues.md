---
title: Известные проблемы и устранение неполадок
titleSuffix: Azure Machine Learning
description: Получите список известных проблем, обходных пути и устранения неполадок для машинного обучения Azure.
services: machine-learning
author: j-martens
ms.author: jmartens
ms.reviewer: mldocs
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.date: 03/31/2020
ms.openlocfilehash: 22a24d01f606cd3f76a0de950351feb3d964da54
ms.sourcegitcommit: efefce53f1b75e5d90e27d3fd3719e146983a780
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80478912"
---
# <a name="known-issues-and-troubleshooting-azure-machine-learning"></a>Известные проблемы и устранение неполадок в машинном обучении Azure

Эта статья поможет вам найти и исправить ошибки или сбои, с которыми вы можете столкнуться при использовании машинного обучения Azure.

## <a name="diagnostic-logs"></a>Журналы диагностики

Иногда при обращении за помощью полезно предоставить диагностические сведения. Чтобы увидеть некоторые журналы: 
1. Посетите [студию машинного обучения Azure](https://ml.azure.com). 
1. На левой стороне выберите **Эксперимент** 
1. Выберите эксперимент.
1. Выберите пробег.
1. Сверху выберите **выходы и журналы**.

> [!NOTE]
> В ходе обучения Azure Machine Learning регистрирует информацию из различных источников, таких как AutoML или контейнер Docker, который выполняет учебную работу. Многие из этих журналов не документированы. Если вы столкнулись с проблемами и обратились в службу поддержки майкрософт, они смогут использовать эти журналы во время устранения неполадок.


## <a name="resource-quotas"></a>Квоты ресурсов

Дополнительные сведения о квотах ресурсов в службе "Машинное обучение Azure" см. [здесь](how-to-manage-quotas.md).

## <a name="installation-and-import"></a>Установка и импорт

* **Сообщение об ошибке: не удается удалить "PyYAML"**

    Azure Machine Learning SDK для Python: `distutils` PyYAML является установленным проектом. Поэтому невозможно точно определить, какие файлы принадлежат ему в случае частичного удаления. Чтобы продолжить установку SDK игнорируя эту ошибку, используйте:
    
    ```Python
    pip install --upgrade azureml-sdk[notebooks,automl] --ignore-installed PyYAML
    ```

* **Сообщение об ошибке: для родного azureml-dataprep не найдено совпадений**

    В дистрибутиве Python 3.7.4 Anaconda есть ошибка, которая ломает установку azureml-sdk. Этот вопрос обсуждается в этом [выпуске GitHub](https://github.com/ContinuumIO/anaconda-issues/issues/11195)
    
    Это можно обойти, создав новую среду Conda с помощью этой команды:
    ```bash
    conda create -n <env-name> python=3.7.3
    ```
    Что создает среду Conda с помощью Python 3.7.3, который не имеет проблемы с установкой присутствует в 3.7.4.

* **Сбой Databricks при установке пакетов**

    Установка Azure Machine Learning SDK выходит из строя на Azure Databricks при установке дополнительных пакетов. Некоторые пакеты, такие как `psutil`, могут приводить к конфликтам. Чтобы избежать ошибок установки, установите пакеты, заморозив версию библиотеки. Эта проблема связана с Databricks, а не с SDK для машинного обучения Azure. Вы можете возникнуть эта проблема с другими библиотеками, тоже. Пример
    
    ```python
    psutil cryptography==1.5 pyopenssl==16.0.0 ipython==2.2.0
    ```

    Кроме того, можно использовать сценарии init, если вы продолжаете сталкиваться с проблемами установки с библиотеками Python. Этот подход официально не поддерживается. Для получения дополнительной [информации](https://docs.azuredatabricks.net/user-guide/clusters/init-scripts.html#cluster-scoped-init-scripts)см.

* **Ошибка импорта Databricks: не удается импортировать название «Timedelta» из 'pandas._libs.tslibs':** Если вы видите эту ошибку при использовании автоматизированного машинного обучения, запустите две следующие строки в блокноте:
    ```
    %sh rm -rf /databricks/python/lib/python3.7/site-packages/pandas-0.23.4.dist-info /databricks/python/lib/python3.7/site-packages/pandas
    %sh /databricks/python/bin/pip install pandas==0.23.4
    ```

* **Ошибка импорта Databricks: Нет модуля под названием 'pandas.core.indexes':** Если вы видите эту ошибку при использовании автоматизированного машинного обучения:

    1. Запустите эту команду для установки двух пакетов в кластер Azure Databricks:
    
       ```bash
       scikit-learn==0.19.1
       pandas==0.22.0
       ```
    
    1. Отсоедините, а затем прикрепите кластер к блокноту.
    
    Если эти шаги не решат проблему, попробуйте перезапустить кластер.

* **Databricks FailToSendFeather:** Если `FailToSendFeather` вы видите ошибку при чтении данных в кластере Azure Databricks, обратитесь к следующим решениям:
    
        * Upgrade `azureml-sdk[automl]` package to the latest version.
        * Add `azureml-dataprep` version 1.1.8 or above.
        * Add `pyarrow` version 0.11 or above.
        `

## <a name="create-and-manage-workspaces"></a>Создание рабочих областей и управление ими

> [!WARNING]
> Перемещение рабочего пространства Azure Machine Learning в другую подписку или перемещение подписки на новый арендатор не поддерживается. Это может привести к ошибкам.

* **Портал Azure**: Если вы идете непосредственно для просмотра рабочего пространства из ссылки общего обмена из SDK или портала, вы не сможете просмотреть обычную страницу **Обзор** с информацией о подписке в расширении. Кроме того, вы не сможете переключиться на другую рабочую область. Если вам нужно просмотреть другое рабочее пространство, перейдите непосредственно в [студию машинного обучения Azure](https://ml.azure.com) и ищите имя рабочего пространства.

## <a name="set-up-your-environment"></a>Настройка среды

* **Проблема создания AmlCompute:** Существует редкая вероятность того, что некоторые пользователи, создавшие рабочее пространство Azure Machine Learning с портала Azure до выпуска GA, не смогут создать AmlCompute в этом рабочем пространстве. Вы можете либо повысить запрос на поддержку службы, либо создать новое рабочее пространство через портал или SDK, чтобы немедленно разблокировать себя.

## <a name="work-with-data"></a>Работа с данными

### <a name="overloaded-azurefile-storage"></a>Перегруженное хранилище AzureFile

Если вы получили `Unable to upload project files to working directory in AzureFile because the storage is overloaded`ошибку, применить следующие обходные пути.

Если вы используете общую часть файлов для других рабочих нагрузок, таких как передача данных, рекомендуется использовать капли, чтобы доля файлов была бесплатной для отправки. Можно также разделить рабочую нагрузку между двумя различными рабочими пространствами.

### <a name="datasets-and-data-preparation"></a>Наборы данных и подготовка данных

Это известные проблемы для наборов данных машинного обучения Azure.

*  **TypeError: FileNotFound: Нет такого файла или каталога**: Эта ошибка возникает, если путь файла, который вы предоставляете, не находится там, где находится файл. Необходимо убедиться, что способ отсылки к файлу соответствует тому, где вы смонтировали набор данных в вычислительной цели. Для обеспечения детерминированного состояния мы рекомендуем использовать абстрактный путь при установке набора данных в вычислительную цель. Например, в следующем коде мы устанавливаем набор данных под корень `/tmp`файловой системы вычислительной цели. 
    
    ```python
    # Note the leading / in '/tmp/dataset'
    script_params = {
        '--data-folder': dset.as_named_input('dogscats_train').as_mount('/tmp/dataset'),
    } 
    ```

    Если вы не включаете ведущую передний слэш,'/', вам нужно префиксировать рабочий каталог, например, `/mnt/batch/.../tmp/dataset` на цель вычисления, чтобы указать, где вы хотите, чтобы набор данных был установлен.

### <a name="data-labeling-projects-issues"></a>Проблемы с маркировкой данных


|Проблема  |Решение  |
|---------|---------|
|Можно использовать только наборы данных, созданные в хранилищах данных blob     |  это известное ограничение текущего выпуска.       |
|После создания, проект показывает "Инициализация" в течение длительного времени     | Вручную обновите страницу. Инициализация должна осуществляться примерно со скоростью 20 точек данных в секунду. Отсутствие автообновления является известной проблемой.         |
|При просмотре изображений недавно помеченные изображения не отображаются     |   Чтобы загрузить все помеченные изображения, выберите **первую** кнопку. **Первая** кнопка передаст вас обратно в передней части списка, но загружает все помеченные данные.      |
|Нажатие клавиши Esc при маркировке для обнаружения объектов создает метку нулевого размера в левом верхнем углу. Отправка меток в этом состоянии не удается.     |   Удалите метку, нажав на перекрестную отметку рядом с ней.  |

## <a name="azure-machine-learning-designer-issues"></a>Проблемы дизайнера машинного обучения Azure

Известные проблемы с дизайнером.

* **Долгое время подготовки вычислений:** Это может быть несколько минут или даже больше, когда вы впервые подключиться к или создать вычислительную цель. 

## <a name="train-models"></a>Обучение моделей

* **ModuleErrors (не назван модуль)**: Если вы работаете в ModuleErrors во время отправки экспериментов в Azure ML, это означает, что обучающий скрипт ожидает установку пакета, но он не добавлен. Как только вы предоставите название пакета, Azure ML установит пакет в среду, используемую для обучения. 

    Если вы используете [Оценщиков для отправки экспериментов,](concept-azure-machine-learning-architecture.md#estimators) вы можете указать имя пакета через `pip_packages` или `conda_packages` параметр в оценщике на основе того, из какого источника вы хотите установить пакет. Вы также можете указать файл yml `conda_dependencies_file`со всеми вашими зависимостями, использующими `pip_requirements_file` или перечислить все ваши требования пипса в файле txt с использованием параметра. Если у вас есть собственный объект Azure ML Environment, который требуется переопределить изображение по `environment` умолчанию, используемое оценщиком, можно указать эту среду по параметру конструктора оценщика.

    Azure ML также предоставляет специальные оценщики для Tensorflow, PyTorch, Chainer и SKLearn. Использование этих оценщиков гарантирует, что основные зависимости фреймворка устанавливаются от вашего имени в среде, используемой для обучения. У вас есть возможность указать дополнительные зависимости, как описано выше. 
 
    Azure ML поддерживает докер изображения и их содержимое можно увидеть в [AzureML контейнеров](https://github.com/Azure/AzureML-Containers).
    В соответствующей рамочной документации перечислены рамочные зависимости - [Chainer,](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.chainer?view=azure-ml-py#remarks) [PyTorch,](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.pytorch?view=azure-ml-py#remarks) [TensorFlow,](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.tensorflow?view=azure-ml-py#remarks) [SKLearn.](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.sklearn.sklearn?view=azure-ml-py#remarks)

    > [!Note]
    > Если вы считаете, что определенный пакет достаточно распространен для добавления в сохраненные в Azure ML изображения и среды, пожалуйста, поднимите проблему GitHub в [контейнерах AzureML.](https://github.com/Azure/AzureML-Containers) 
 
* **NameError (имя не определено), AttributeError (Объект не имеет атрибута)**: Это исключение должно исходить от ваших скриптов обучения. Вы можете посмотреть файлы журнала с портала Azure, чтобы получить более подробную информацию о конкретном имени, не определенном или атрибуте ошибки. Из SDK можно использовать `run.get_details()` для поиска сообщения об ошибке. В этом также будет указаны все файлы журнала, созданные для выполнения. Пожалуйста, не забудьте взглянуть на ваш сценарий обучения и исправить ошибку, прежде чем повторно отправлять запустить. 

* **Горвод был закрыт**: В большинстве случаев, если вы столкнулись с "AbortedError: Horovod был закрыт" это исключение означает, что было основное исключение в одном из процессов, которые вызвали Горовод закрыть. Каждое звание в заданиях MPI получает свой собственный файл журнала в Azure ML. Эти журналы `70_driver_logs`названы . В случае распределенного обучения, имена журналов суффиксируются с, `_rank` чтобы было легче дифференцировать журналы. Чтобы найти точную ошибку, которая привела к отключению Горовода, пройдите все файлы журнала и ищите `Traceback` в конце driver_log файлов. Один из этих файлов даст вам фактическое основное исключение. 

* **Выполнить или поэкспериментировать удаление**: Эксперименты можно архивировать с помощью метода [Experiment.archive](https://docs.microsoft.com/python/api/azureml-core/azureml.core.experiment(class)?view=azure-ml-py#archive--) или из представления вкладки Experiment в клиенте студии Azure Machine Learning с помощью кнопки «Архивный эксперимент». Это действие скрывает эксперимент от запросов и представлений списка, но не удаляет его.

    Постоянное удаление отдельных экспериментов или запусков в настоящее время не поддерживается. Для получения дополнительной информации об удалении ресурсов Рабочего пространства [см.](how-to-export-delete-data.md)

* **Метрический документ слишком велик:** Azure Machine Learning имеет внутренние ограничения на размер метрических объектов, которые могут быть зарегистрированы сразу из обучаемого запуска. Если при регистрации метрика, оцениваемого в списке, вы сталкиваетесь с ошибкой «Метриум документ слишком велик», попробуйте разделить список на более мелкие части, например:

    ```python
    run.log_list("my metric name", my_metric[:N])
    run.log_list("my metric name", my_metric[N:])
    ```

    Внутренне Azure ML конкатирует блоки с тем же метрическим именем в смежный список.

## <a name="automated-machine-learning"></a>Автоматическое машинное обучение

* **Тензор ный поток**: Автоматизированное машинное обучение в настоящее время не поддерживает версию потока тензора 1.13. Установка этой версии приведет к прекращению работы зависимостей пакетов. Мы работаем, чтобы исправить эту проблему в будущем выпуске.

* **Диаграммы эксперимента**: Диаграммы классификации (точные диаграммы классификации, ROC, кривая усиления etc.) показанные в автоматизированных итерациях эксперимента ML не рендеризируют правильно в интерфейсе пользователя с 4/12. Диаграммы в настоящее время показывают обратные результаты, где более эффективные модели показаны с более низкими результатами. В настоящее время проводится расследование в отношении решения.

* **Databricks отменяют запуск автоматизированного машинного обучения:** При использовании возможностей автоматического машинного обучения на Azure Databricks, чтобы отменить запуск и запустить новый запуск эксперимента, перезапустите кластер Azure Databricks.

* **Databricks >10 итераций для автоматизированного машинного обучения:** В автоматизированных настройках `show_output` машинного обучения, если у вас есть более 10 итераций, установленных `False` при отправке запуска.

* **Виджет Databricks для SDK машинного обучения Azure и автоматизированного машинного обучения:** виджет Azure Machine Learning SDK не поддерживается в блокноте Databricks, потому что ноутбуки не могут разбирать HTML виджеты. Просмотреть виджет можно на портале, используя этот код Python в блокнотной ячейке Azure Databricks:

    ```
    displayHTML("<a href={} target='_blank'>Azure Portal: {}</a>".format(local_run.get_portal_url(), local_run.id))
    ```

## <a name="deploy--serve-models"></a>Развертывание и обслуживание моделей

Примите следующие действия для следующих ошибок:

|Error  | Решение  |
|---------|---------|
|Сбой построения изображения при развертывании веб-сервиса     |  Добавьте в файл Conda зависимость от пипса для конфигурации изображения «pynacl »1.2.1»       |
|`['DaskOnBatch:context_managers.DaskOnBatch', 'setup.py']' died with <Signals.SIGKILL: 9>`     |   Измените SKU для VMs, используемых в развертывании, на систему, которая имеет больше памяти. |
|Сбой FPGA     |  Вы не сможете развернуть модели на FPGA до тех пор, пока не будет запрошена и одобрена квота FPGA. Чтобы запросить доступ, заполните форму запроса квоты: https://aka.ms/aml-real-time-ai       |

### <a name="updating-azure-machine-learning-components-in-aks-cluster"></a>Обновление компонентов машинного обучения Azure в кластере AKS

Обновления компонентов машинного обучения Azure, установленные в кластере службы Azure Kubernetes, должны применяться вручную. 

Эти обновления можно применить, отделив кластер из рабочего пространства Машинного обучения Azure, а затем прикрепив кластер к рабочему пространству. Если TLS включен в кластере, при повторном подключении кластера необходимо предоставить сертификат TLS/SSL и закрытый ключ. 

```python
compute_target = ComputeTarget(workspace=ws, name=clusterWorkspaceName)
compute_target.detach()
compute_target.wait_for_completion(show_output=True)

attach_config = AksCompute.attach_configuration(resource_group=resourceGroup, cluster_name=kubernetesClusterName)

## If SSL is enabled.
attach_config.enable_ssl(
    ssl_cert_pem_file="cert.pem",
    ssl_key_pem_file="key.pem",
    ssl_cname=sslCname)

attach_config.validate_configuration()

compute_target = ComputeTarget.attach(workspace=ws, name=args.clusterWorkspaceName, attach_configuration=attach_config)
compute_target.wait_for_completion(show_output=True)
```

Если у вас больше нет сертификата TLS/SSL и закрытого ключа, или вы используете сертификат, генерируемый Azure Machine Learning, вы `kubectl` можете получить `azuremlfessl`файлы до отсоединения кластера, подключившись к кластеру с помощью и извлечения секрета.

```bash
kubectl get secret/azuremlfessl -o yaml
```

>[!Note]
>Kubernetes хранит секреты в закодированном формате базы-64. Вам нужно будет базы-64 `cert.pem` расшифровать и `key.pem` компоненты `attach_config.enable_ssl`секретов до предоставления их . 

### <a name="webservices-in-azure-kubernetes-service-failures"></a>Сбои web-сервисов в сбоях службы Azure Kubernetes

Многие сбои веб-службы в службе Azure Kubernetes можно `kubectl`отладить, подключившись к кластеру с помощью. Вы можете `kubeconfig.json` получить для кластера обслуживания Azure Kubernetes, запустив

```azurecli-interactive
az aks get-credentials -g <rg> -n <aks cluster name>
```

## <a name="authentication-errors"></a>Ошибки проверки подлинности

При выполнении операции управления на целевом объекте вычислений из удаленного задания вы получите одну из следующих ошибок:

```json
{"code":"Unauthorized","statusCode":401,"message":"Unauthorized","details":[{"code":"InvalidOrExpiredToken","message":"The request token was either invalid or expired. Please try again with a valid token."}]}
```

```json
{"error":{"code":"AuthenticationFailed","message":"Authentication failed."}}
```

Например, вы получите сообщение об ошибке, если попытаетесь создать или вложить целевой объект вычислений из конвейера Машинного обучения, который передается для удаленного выполнения.
