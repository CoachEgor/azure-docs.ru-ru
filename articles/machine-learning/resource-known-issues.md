---
title: Известные проблемы и устранение неполадок
titleSuffix: Azure Machine Learning
description: Получите список известных проблем, обходных путей и устранение неполадок для Машинное обучение Azure.
services: machine-learning
author: j-martens
ms.author: jmartens
ms.reviewer: mldocs
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.date: 11/04/2019
ms.openlocfilehash: 9824f5cfd7b42860079536232b8a5ad40ea608c9
ms.sourcegitcommit: f788bc6bc524516f186386376ca6651ce80f334d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2020
ms.locfileid: "75638363"
---
# <a name="known-issues-and-troubleshooting-azure-machine-learning"></a>Известные проблемы и устранение неполадок Машинное обучение Azure

Эта статья поможет вам найти и исправить ошибки или сбои, возникшие при использовании Машинное обучение Azure.

## <a name="outage-sr-iov-upgrade-to-ncv3-machines-in-amlcompute"></a>Сбой: обновление SR-IOV до NCv3 компьютеров в Амлкомпуте

Azure COMPUTE будет обновлять SKU NCv3, начиная с раннего ноября 2019 для поддержки всех реализаций и версий MPI, а также команд RDMA для виртуальных машин, оснащенных InfiniBand. Для этого потребуется короткий простой. [Дополнительные сведения об обновлении SR-IOV](https://azure.microsoft.com/updates/sriov-availability-on-ncv3-virtual-machines-sku).

В качестве клиента управляемого предложения для вычислений Машинное обучение Azure (Амлкомпуте) в настоящее время вносить изменения не требуется. В зависимости от [расписания обновления](https://azure.microsoft.com/updates/sr-iov-availability-schedule-on-ncv3-virtual-machines-sku) необходимо спланировать небольшой перерыв в работе. Служба принимает ответственность за обновление образов виртуальных машин на узлах кластера и автоматическое масштабирование кластера. После завершения обновления вы сможете использовать все другие дистрибутивы MPI (например, Опенмпи с Pytorch), помимо более высокой пропускной способности InfiniBand, низкой задержки и более высокой производительности распределенных приложений.

## <a name="azure-machine-learning-designer-issues"></a>Проблемы конструктора Машинное обучение Azure

Известные проблемы с конструктором.

### <a name="long-compute-preparation-time"></a>Длительное время подготовки вычислений

Создание вычислений или вызвать, в результате которых выполняется вычисление, может составлять несколько минут или даже дольше. Рабочая группа работает над оптимизацией.


### <a name="cannot-run-an-experiment-only-contains-a-dataset"></a>Невозможно запустить эксперимент содержит только набор данных 

Может потребоваться запустить эксперимент только с набором данных для визуализации набора данных. Однако в настоящее время нельзя запускать эксперимент, содержащий только набор данных. Мы активно исправляете эту неполадку.
 
Перед исправлением можно подключить набор данных к любому модулю преобразования данных (выберите столбцы в наборе данных, изменить метаданные, разделить данные и т. д.) и запустить эксперимент. Затем можно визуализировать набор данных. 

На рисунке ниже показано, как: ![висулизе-Data](./media/resource-known-issues/aml-visualize-data.png)

## <a name="sdk-installation-issues"></a>Проблемы с установкой пакета SDK

**Сообщение об ошибке: не удается удалить "PyYAML"**

Машинное обучение Azure SDK для Python: Пиямл — это дистутилс установленный проект. Поэтому невозможно точно определить, какие файлы принадлежат ему в случае частичного удаления. Чтобы продолжить установку SDK игнорируя эту ошибку, используйте:

```Python
pip install --upgrade azureml-sdk[notebooks,automl] --ignore-installed PyYAML
```

**Сообщение об ошибке: `ERROR: No matching distribution found for azureml-dataprep-native`**

В средстве распространения Python 3.7.4 Anaconda обнаружена ошибка, которая отменяет установку azureml-SDK. Эта проблема описана в этой [ошибке GitHub](https://github.com/ContinuumIO/anaconda-issues/issues/11195) . чтобы устранить эту ошибку, создайте новую среду Conda с помощью следующей команды:
```bash
conda create -n <env-name> python=3.7.3
```
Это создает среду Conda с помощью Python 3.7.3, которая не содержит проблем с установкой в 3.7.4.

## <a name="trouble-creating-azure-machine-learning-compute"></a>Проблема при создании Вычислительной среды Машинного обучения Azure

Существую небольшая вероятность того, что некоторые пользователи, создавшие свою рабочую область Машинного обучения Azure на портале Azure до выпуска общедоступной версии, не смогут создать Вычислительную среду Машинного обучения Azure в этой рабочей области. Можно отправить соответствующий запрос в службу поддержки или создать новую рабочую область с помощью портала или пакета SDK, чтобы немедленно устранить эту проблему.

## <a name="image-building-failure"></a>Сбой создания образа

Сбой создания образа при развертывании веб-службы. Обходным решением является добавление "pynacl==1.2.1" в качестве зависимости пика для файла Conda для конфигурации изображения.

## <a name="deployment-failure"></a>Сбой развертывания

Если отображается `['DaskOnBatch:context_managers.DaskOnBatch', 'setup.py']' died with <Signals.SIGKILL: 9>`, измените номер SKU для виртуальных машин, используемых в развертывании, на другой с большим объемом памяти.

## <a name="fpgas"></a>FPGA

Вы не сможете развернуть модели на FPGA до тех пор, пока не будет запрошена и одобрена квота FPGA. Чтобы запросить доступ, заполните форму запроса квоты: https://aka.ms/aml-real-time-ai

## <a name="automated-machine-learning"></a>Автоматическое машинное обучение

Автоматическое машинное обучение тензорные Flow в настоящее время не поддерживает тензорные Flow версии 1,13. Установка этой версии приведет к прекращению работы зависимостей пакетов. Мы работаем над устранением этой проблемы в будущем выпуске. 

### <a name="experiment-charts"></a>Диаграммы экспериментов

Диаграммы двоичной классификации (точность-отзыв, ROC, прибыль и т. д.), показанные в автоматизированных итерациях эксперимента ML, неправильно отображаются в пользовательском интерфейсе с 4/12. Графики диаграммы в настоящее время показывают обратные результаты, в которых более эффективные модели отображаются с более низкими результатами. Решение находится в процессе исследования.

## <a name="datasets-and-data-preparation"></a>Подготовка к работе с наборами данных и данными

Это известные проблемы для Машинное обучение Azure наборов данных.

### <a name="typeerror-filenotfound-no-such-file-or-directory"></a>Типиррор: FileNotFound: нет такого файла или каталога

Эта ошибка возникает, если указанный путь к файлу не находится там, где расположен файл. Необходимо убедиться в том, что путь к файлу соответствует месту подключения набора данных к целевому объекту вычислений. Чтобы обеспечить детерминированное состояние, рекомендуется использовать абстрактный путь при подключении набора данных к целевому объекту вычислений. Например, в следующем примере выполняется подключение набора данных в корне файловой системы целевого объекта вычислений `/tmp`. 

```python
# Note the leading / in '/tmp/dataset'
script_params = {
    '--data-folder': dset.as_named_input('dogscats_train').as_mount('/tmp/dataset'),
} 
```

Если не указать начальную косую черту ("/"), необходимо добавить к рабочему каталогу префикс "/", например `/mnt/batch/.../tmp/dataset` на целевом объекте вычислений, чтобы указать, где нужно подключить набор данных. 

### <a name="fail-to-read-parquet-file-from-http-or-adls-gen-2"></a>Не удалось считать файл Parquet из HTTP или ADLS Gen 2

Существует известная проблема в пакете SDK для 1.1.25 версии AzureML, которая вызывает сбой при создании набора данных путем считывания файлов Parquet из HTTP или ADLS Gen 2. Он завершится ошибкой с `Cannot seek once reading started.`. Чтобы устранить эту проблему, обновите `azureml-dataprep` до версии выше 1.1.26 или перейдите на более раннюю версию ниже 1.1.24.

```python
pip install --upgrade azureml-dataprep
```

### <a name="typeerror-mount-got-an-unexpected-keyword-argument-invocation_id"></a>Типиррор: для Mount () получен непредвиденный аргумент ключевого слова "invocation_id"

Эта ошибка возникает при наличии несовместимой версии между `azureml-core` и `azureml-dataprep`. Если вы видите эту ошибку, обновите пакет `azureml-dataprep` до более новой версии (больше или равной 1.1.29).

```python
pip install --upgrade azureml-dataprep
```

## <a name="databricks"></a>Databricks

Ниже описаны проблемы, которые могут возникать в службе "Машинное обучение Azure" и Databricks.

### <a name="failure-when-installing-packages"></a>Сбой при установке пакетов

Сбой установки пакета SDK Машинное обучение Azure на Azure Databricks при установке дополнительных пакетов. Некоторые пакеты, такие как `psutil`, могут приводить к конфликтам. Чтобы избежать ошибок установки, установите пакеты, зафиксировать версию библиотеки. Эта проблема связана с модулями связи, а не с пакетом SDK для Машинное обучение Azure. Эта проблема также может возникнуть и в других библиотеках. Пример:

```python
psutil cryptography==1.5 pyopenssl==16.0.0 ipython==2.2.0
```

Кроме того, можно использовать скрипты init, если возникают проблемы с установкой библиотек Python. Этот подход официально не поддерживается. Дополнительные сведения см. в разделе [сценарии инициализации с областью действия кластера](https://docs.azuredatabricks.net/user-guide/clusters/init-scripts.html#cluster-scoped-init-scripts).

### <a name="cancel-an-automated-machine-learning-run"></a>Отмена автоматического запуска машинного обучения

При использовании автоматизированных возможностей машинного обучения на Azure Databricks, чтобы отменить запуск и запустить новый запуск эксперимента, перезапустите кластер Azure Databricks.

### <a name="10-iterations-for-automated-machine-learning"></a>> 10 итераций для автоматического машинного обучения

Если в параметрах автоматического машинного обучения имеется более 10 итераций, задайте для `show_output` значение `False` при отправке выполнения.

### <a name="widget-for-the-azure-machine-learning-sdk-and-automated-machine-learning"></a>Мини-приложение для Машинное обучение Azure SDK и автоматического машинного обучения

Мини-приложение Машинное обучение Azure SDK не поддерживается в записях модуля обработки сообщений, так как записные книжки не могут анализировать графические элементы HTML. Вы можете просмотреть мини-приложение на портале с помощью этого кода Python в Azure Databricks записной книжке:

```
displayHTML("<a href={} target='_blank'>Azure Portal: {}</a>".format(local_run.get_portal_url(), local_run.id))
```

### <a name="import-error-no-module-named-pandascoreindexes"></a>Ошибка импорта: нет модуля с именем "Pandas. Core. indexes"

Если вы видите эту ошибку при использовании автоматического машинного обучения:

1. Выполните следующую команду, чтобы установить два пакета в кластере Azure Databricks: 

   ```
   scikit-learn==0.19.1
   pandas==0.22.0
   ```

1. Отсоедините и снова подключите кластер к записной книжке. 

Если эти действия не устранят проблему, попробуйте перезапустить кластер.

### <a name="failtosendfeather"></a>фаилтосендфеасер

Если при чтении данных в кластере Azure Databricks возникает ошибка `FailToSendFeather`, см. следующие решения.

* Обновите пакет `azureml-sdk[automl]` до последней версии.
* Добавьте `azureml-dataprep` версии 1.1.8 или более поздней.
* Добавьте `pyarrow` версии 0,11 или более поздней.

## <a name="azure-portal"></a>Портал Azure

При переходе непосредственно к просмотру рабочей области с помощью ссылки для общего доступа из пакета SDK или на портале невозможно будет отобразить обычную страницу обзора со сведениями о подписке в расширении. Кроме того, вы не сможете переключиться на другую рабочую область. Если вам нужно просмотреть другую рабочую область, это решение поможет перейти непосредственно к [машинное обучение Azure Studio](https://ml.azure.com) и найти имя рабочей области.

## <a name="diagnostic-logs"></a>Журналы диагностики

Иногда при обращении за помощью полезно предоставить диагностические сведения. Чтобы просмотреть некоторые журналы, откройте [машинное обучение Azure Studio](https://ml.azure.com) и перейдите в рабочую область и выберите **рабочую область > эксперимент > запустить > журналы**.  

> [!NOTE]
> Машинное обучение Azure записывает сведения из различных источников во время обучения, например Аутомл или контейнер DOCKER, который запускает задание обучения. Многие из этих журналов не документированы. Если возникли проблемы и вы можете обратиться в службу поддержки Майкрософт, они смогут использовать эти журналы во время устранения неполадок.

## <a name="activity-logs"></a>Журналы действий

Некоторые действия в рабочей области Машинное обучение Azure не заводят данные в журнал __действий__. Например, запуск обучения или регистрация модели.

Некоторые из этих действий отображаются в области __действия__ рабочей области, однако они не указывают, кто инициировал действие.

## <a name="resource-quotas"></a>Квоты ресурсов

Дополнительные сведения о квотах ресурсов в службе "Машинное обучение Azure" см. [здесь](how-to-manage-quotas.md).

## <a name="authentication-errors"></a>Ошибки проверки подлинности

При выполнении операции управления на целевом объекте вычислений из удаленного задания вы получите одну из следующих ошибок:

```json
{"code":"Unauthorized","statusCode":401,"message":"Unauthorized","details":[{"code":"InvalidOrExpiredToken","message":"The request token was either invalid or expired. Please try again with a valid token."}]}
```

```json
{"error":{"code":"AuthenticationFailed","message":"Authentication failed."}}
```

Например, вы получите сообщение об ошибке, если попытаетесь создать или вложить целевой объект вычислений из конвейера Машинного обучения, который передается для удаленного выполнения.

## <a name="overloaded-azurefile-storage"></a>Перегруженное хранилище Азурефиле

Если появляется `Unable to upload project files to working directory in AzureFile because the storage is overloaded`об ошибке, используйте следующие обходные пути.

Если вы используете общую папку для других рабочих нагрузок, таких как передача данных, рекомендуется использовать большие двоичные объекты, чтобы файловый ресурс можно было использовать для отправки запусков. Вы также можете разделить рабочую нагрузку между двумя разными рабочими областями.

## <a name="webservices-in-azure-kubernetes-service-failures"></a>Ошибки WebService в службе Kubernetes Azure 

Многие сбои WebService в службе Kubernetes Azure можно отлаживать, подключившись к кластеру с помощью `kubectl`. Вы можете получить `kubeconfig.json` для кластера службы Azure Kubernetes, выполнив

```bash
az aks get-credentials -g <rg> -n <aks cluster name>
```

## <a name="updating-azure-machine-learning-components-in-aks-cluster"></a>Обновление компонентов Машинное обучение Azure в кластере AKS

Обновления компонентов Машинное обучение Azure, установленных в кластере службы Azure Kubernetes, необходимо применять вручную. 

Эти обновления можно применить, отсоединив кластер от рабочей области Машинное обучение Azure, а затем повторно присоединив кластер к рабочей области. Если в кластере включен протокол SSL, необходимо предоставить SSL-сертификат и закрытый ключ при повторном подключении кластера. 

```python
compute_target = ComputeTarget(workspace=ws, name=clusterWorkspaceName)
compute_target.detach()
compute_target.wait_for_completion(show_output=True)

attach_config = AksCompute.attach_configuration(resource_group=resourceGroup, cluster_name=kubernetesClusterName)

## If SSL is enabled.
attach_config.enable_ssl(
    ssl_cert_pem_file="cert.pem",
    ssl_key_pem_file="key.pem",
    ssl_cname=sslCname)

attach_config.validate_configuration()

compute_target = ComputeTarget.attach(workspace=ws, name=args.clusterWorkspaceName, attach_configuration=attach_config)
compute_target.wait_for_completion(show_output=True)
```

Если у вас больше нет сертификата SSL и закрытого ключа или вы используете сертификат, созданный Машинное обучение Azure, вы можете получить файлы перед отсоединением кластера, подключившись к кластеру, используя `kubectl` и извлекая `azuremlfessl`секрет.

```bash
kubectl get secret/azuremlfessl -o yaml
```

>[!Note]
>Kubernetes сохраняет секреты в формате в кодировке Base-64. Необходимо сначала декодировать `cert.pem` и `key.pem` компоненты секретов, прежде чем предоставлять их `attach_config.enable_ssl`. 64 

## <a name="recommendations-for-error-fix"></a>Рекомендации по исправлению ошибок
Ниже приведены рекомендации Azure ML по устранению некоторых распространенных ошибок в МАШИНном обучении Azure.

### <a name="metric-document-is-too-large"></a>Размер документа метрики слишком велик
Машинное обучение Azure имеет внутренние ограничения на размер объектов метрик, которые могут быть записаны одновременно в ходе обучающего запуска. При возникновении ошибки "документ метрики слишком велик" при записи в журнал метрики, возвращающей значение типа List, попробуйте разделить список на меньшие фрагменты, например:

```python
run.log_list("my metric name", my_metric[:N])
run.log_list("my metric name", my_metric[N:])
```

 На внутреннем уровне Служба журнала выполнения объединяет блоки с одинаковым именем метрики в смежный список.

### <a name="moduleerrors-no-module-named"></a>Модулиррорс (без модуля с именем)
Если вы используете в Модулиррорс при отправке экспериментов в МАШИНном обучении Azure, это означает, что обучающий сценарий ожидает установки пакета, но он не добавляется. После предоставления имени пакета Azure ML установит пакет в среде, используемой для обучения. 

Если для отправки экспериментов используются средства [оценки](concept-azure-machine-learning-architecture.md#estimators) , можно указать имя пакета с помощью `pip_packages` или `conda_packages` параметр в средстве оценки на основе источника, для которого необходимо установить пакет. Можно также указать файл yml со всеми зависимостями, используя `conda_dependencies_file`или перечисляя все требования к PIP в TXT-файле, используя параметр `pip_requirements_file`.

МАШИНное обучение Azure также предоставляет средства оценки, зависящие от платформы, для Tensorflow, PyTorch, Chain и SKLearn. Используя эти средства оценки, вы убедитесь, что зависимости платформы установлены от вашего имени в среде, используемой для обучения. Есть возможность указать дополнительные зависимости, как описано выше. 
 
Образы DOCKER, поддерживаемые МАШИНным обучением Azure, и их содержимое можно просмотреть в [контейнерах AzureML](https://github.com/Azure/AzureML-Containers).
Зависимости, зависящие от платформы, перечислены в соответствующей документации по платформе — [цепочке](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.chainer?view=azure-ml-py#remarks), [PyTorch](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.pytorch?view=azure-ml-py#remarks), [TensorFlow](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.dnn.tensorflow?view=azure-ml-py#remarks), [SKLearn](https://docs.microsoft.com/python/api/azureml-train-core/azureml.train.sklearn.sklearn?view=azure-ml-py#remarks).

> [!Note]
> Если вы считаете, что определенный пакет является достаточно распространенным для добавления в образы и среды машинного обучения Azure, повысьте вопрос GitHub в [контейнерах AzureML](https://github.com/Azure/AzureML-Containers). 
 
 ### <a name="nameerror-name-not-defined-attributeerror-object-has-no-attribute"></a>Намиррор (имя не определено), Аттрибутиррор (у объекта нет атрибута)
Это исключение должно поступать из сценариев обучения. Чтобы получить дополнительные сведения о конкретном имени, которое не определено или об ошибке атрибута, можно просмотреть файлы журналов из портал Azure. Из пакета SDK можно использовать `run.get_details()`, чтобы просмотреть сообщение об ошибке. Также будут перечислены все файлы журналов, созданные для выполнения. Обязательно ознакомьтесь со сценарием обучения, исправьте ошибку, прежде чем повторять попытку. 

### <a name="horovod-is-shut-down"></a>Хоровод выключен
В большинстве случаев это исключение означает, что в одном из процессов, вызвавших хоровод завершение работы, произошло базовое исключение. Каждый рейтинг в задании MPI получает собственный выделенный файл журнала в МАШИНном обучении Azure. Эти журналы имеют имя `70_driver_logs`. В случае распределенного обучения имена журналов добавляются в суффиксы `_rank`, чтобы облегчить их различение. Чтобы найти точную ошибку, которая привела к хоровод завершению работы, просмотрите все файлы журнала и найдите `Traceback` в конце driver_log файлов. Один из этих файлов предоставит фактическое базовое исключение. 

## <a name="labeling-projects-issues"></a>Создание меток для проблем проектов

Известные проблемы с добавлением меток к проектам.

### <a name="only-datasets-created-on-blob-datastores-can-be-used"></a>Можно использовать только наборы данных, созданные в хранилищах BLOB-объектов.

Это известное ограничение текущего выпуска. 

### <a name="after-creation-the-project-shows-initializing-for-a-long-time"></a>После создания проект показывает "инициализацию" в течение длительного времени

Обновите страницу вручную. Инициализация должна продолжаться примерно 20 точек на секунду. Отсутствие автообновления является известной проблемой. 

### <a name="when-reviewing-images-newly-labeled-images-are-not-shown"></a>При просмотре изображений недавно помеченные изображения не отображаются

Чтобы загрузить все помеченные изображения, нажмите **первую** кнопку. **Первая** кнопка вернет вас к началу списка, но загрузит все помеченные данные.

### <a name="pressing-esc-key-while-labeling-for-object-detection-creates-a-zero-size-label-on-the-top-left-corner-submitting-labels-in-this-state-fails"></a>Нажатие клавиши ESC при пометке для обнаружения объектов создает метку нулевого размера в левом верхнем углу. Отправка меток в этом состоянии завершается ошибкой.

Удалите метку, щелкнув рядом с ней крестик.
