---
title: Тестирование кода обработки и анализа данных с помощью Azure DevOps Services — командный процесс обработки и анализа данных
description: Тестирование кода обработки и анализа данных в Azure на примере набора данных UCI для прогнозирования дохода совершеннолетних лиц с помощью командного процесса обработки и анализа данных и Azure DevOps Services
services: machine-learning
author: marktab
manager: cgronlun
editor: cgronlun
ms.service: machine-learning
ms.subservice: team-data-science-process
ms.topic: article
ms.date: 05/19/2018
ms.author: tdsp
ms.custom: seodec18, previous-author=weig, previous-ms.author=weig
ms.openlocfilehash: 10692fcb720be819dcf94a8ecbc541983ffc8853
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60336700"
---
# <a name="data-science-code-testing-on-azure-with-the-team-data-science-process-and-azure-devops-services"></a>Тестирование кода обработки и анализа данных в Azure с помощью командного процесса обработки и анализа данных и Azure DevOps Services
В этой статье приведены предварительные рекомендации по тестированию кода в рабочем потоке обработки и анализа данных. Такое тестирование предоставляет специалистам по обработке и анализу данных системный и эффективный способ проверки качества и ожидаемого результата выполнения созданного кода. Мы продемонстрируем тестирование кода на примере [проекта для командного процесса обработки и анализа данных (TDSP), основанного на наборе данных UCI с данными о доходе совершеннолетних лиц](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome), который мы опубликовали ранее. 

## <a name="introduction-on-code-testing"></a>Общие сведения о тестировании кода
В отрасли программного обеспечения уже долгое время стандартом считается "Модульное тестирование". Но в применении к обработке и анализу данных часто неясно, как его использовать и как тестировать код на некоторых этапах жизненного цикла обработки и анализа данных, таких как:

* Подготовка данных
* анализ качества данных;
* Моделирование
* Развертывание модели 

В этой статье вместо "модульного тестирования" мы используем термин "тестирование кода". Этим мы хотим подчеркнуть, что тестирование должно определить, предоставляет ли код "полностью ожидаемые" данные на конкретном этапе жизненного цикла обработки и анализа данных. Специалист, создающий тест, должен определить "ожидаемый" результат по конкретному назначению функции (например, проверка качества данных или моделирование).

Эта статья содержит ссылки на полезные ресурсы.

## <a name="azure-devops-for-the-testing-framework"></a>Azure DevOps для платформы тестирования
В этой статье описывается выполнение и автоматизация тестирования с помощью Azure DevOps. Вы можете использовать другие средства. Также мы продемонстрируем, как настроить автоматическую сборку на основе Azure DevOps и агентов сборки. В качестве агентов сборки мы применяем виртуальные машины для обработки и анализа данных Azure (DSVM).

## <a name="flow-of-code-testing"></a>Поток тестирования кода
Общий рабочий процесс тестирования кода в проекте обработки и анализа данных выглядит следующим образом: 

![Схема потока тестирования кода](./media/code-test/test-flow-chart.PNG)

    
## <a name="detailed-steps"></a>Подробные инструкции

Выполните следующие действия, чтобы установить и запустить систему тестирования кода и автоматизированной сборки с помощью агента сборки и Azure DevOps.

1. Создайте в Visual Studio проект классического приложения:

    ![Экран "Создание проекта" в Visual Studio](./media/code-test/create_project.PNG)

   Завершив создание проекта, вы сможете найти его на правой панели обозревателя решений:
    
    ![Процесс создания проекта](./media/code-test/create_python_project_in_vs.PNG)

    ![обозревателе решений](./media/code-test/solution_explorer_in_vs.PNG)

1. Передайте код проекта в репозиторий кода проекта Azure DevOps: 

    ![Репозиторий кода проекта](./media/code-test/create_repo.PNG)

1. Предположим, вы уже выполнили некоторые действия для подготовки данных: прием данных, проектирование функций и создание меток столбцов. Теперь вы хотите убедиться, что выполнение этого кода дает ожидаемые результаты. Вот пример кода, для которого можно выполнить тестирование и определить, правильно ли он обрабатывает данные:

    * Убедитесь, что создаются правильные имена столбцов:
    
      ![Код для сопоставления имен столбцов](./media/code-test/check_column_names.PNG)

    * Убедитесь, что установлены правильные уровни ответа:

      ![Код для сопоставления уровней](./media/code-test/check_response_levels.PNG)

    * Убедитесь, что получен обоснованный процент ответов:

      ![Код для процента ответов](./media/code-test/check_response_percentage.PNG)

    * Проверьте долю отсутствия данных для каждого столбца данных:
    
      ![Код для отсутствия данных](./media/code-test/check_missing_rate.PNG)


1. Завершив обработку данных и проектирование функций, а затем обучение эффективной модели, нужно проверить эту модель на правильность оценки для новых наборов данных. Следующие два теста позволят проверить уровни прогноза и распределение значений меток:

    * Проверка уровней прогноза:
    
      ![Код для проверки уровней прогноза](./media/code-test/check_prediction_levels.PNG)

    * Проверка распределения прогнозируемых значений:

      ![Код для проверки прогнозируемых значений](./media/code-test/check_prediction_values.PNG)

1. Соберите все тестовые функции в один скрипт Python с именем **test_funcs.py**:

    ![Скрипт Python с функциями тестирования](./media/code-test/create_file_test_func.PNG)


1. Завершив подготовку кода для тестирования, переходите к настройке среды тестирования в Visual Studio.

   Создайте файл Python с именем **test1.py**. В этом файле создайте класс, который включает все нужные тесты. Следующий пример содержит шесть подготовленных тестов:
    
    ![Файл Python со списком тестов в классе](./media/code-test/create_file_test1_class.PNG)

1. Эти тесты будут обнаруживаться автоматически, если вы укажете метку **codetest.testCase** после имени класса. Откройте обозреватель тестов в области справа и выберите **Run All** (Запустить все). Все тесты будут последовательно выполнены, и вы получите сведения об их успешности.

    ![Выполнение тестов](./media/code-test/run_tests.PNG)

1. Зарегистрируйте код в репозитории проекта с помощью команд Git. Новейшая версия вскоре появится в Azure DevOps.

    ![Команды Git для регистрации кода](./media/code-test/git_check_in.PNG)

    ![Новейшие версии в Azure DevOps](./media/code-test/git_check_in_most_recent_work.PNG)

1. Настройте автоматическую сборку и тестирование в Azure DevOps:

    a. В репозитории проекта выберите **Build and Release** (Сборка и выпуск), а затем щелкните **+Создать**, чтобы создать процесс сборки.

       ![Selections for starting a new build process](./media/code-test/create_new_build.PNG)

    2. Следуйте инструкциям на экране, чтобы выбрать расположение исходного кода, имя проекта, репозиторий и сведения о ветви.
    
       ![Source, name, repository, and branch information](./media/code-test/fill_in_build_info.PNG)

    c. Выберите шаблон. Так как у нас нет готового шаблона для проектов Python, выберите вариант **Пустой процесс**. 

       ![List of templates and "Empty process" button](./media/code-test/start_empty_process_template.PNG)

    d. Присвойте сборке имя и выберите агент. Здесь вы можете сохранить значение по умолчанию, если для завершения сборки нужно использовать DSVM. Дополнительные сведения о настройке агентов см. в статье [Build and Release Agents](https://docs.microsoft.com/azure/devops/pipelines/agents/agents?view=vsts) (Агенты сборки и выпуска).
    
       ![Build and agent selections](./media/code-test/select_agent.PNG)

    д. Выберите **+** в области слева, чтобы добавить задачу для этого этапа сборки. Для выполнения всех проверок мы будем запускать скрипт Python **test1.py**, а значит, в этой задаче следует указать команду PowerShell, запускающую код Python.
    
       !["Add tasks" pane with PowerShell selected](./media/code-test/add_task_powershell.PNG)

    Е. В области сведений о PowerShell укажите обязательные параметры, например имя и версию PowerShell. Выберите тип **Встроенный сценарий**. 
    
       In the box under **Inline Script**, you can type **python test1.py**. Make sure the environment variable is set up correctly for Python. If you need a different version or kernel of Python, you can explicitly specify the path as shown in the figure: 
    
       ![PowerShell details](./media/code-test/powershell_scripts.PNG)

    ж. Выберите **Save & queue** (Сохранить и поместить в очередь), чтобы завершить процесс конвейера сборки.

       !["Save & queue" button](./media/code-test/save_and_queue_build_definition.PNG)

Теперь при каждой новой фиксации в репозитории кода будет автоматически запускаться процесс сборки (здесь мы используем главную ветвь репозитория, но вы можете определить и любую другую). Этот процесс запускает на компьютере агента файл **test1.py**, который проверяет, правильно ли выполняются все определенные в коде действия. 

Если оповещения настроены верно, по завершении сборки вы получите сообщение по электронной почте. Также состояние сборки можно проверить в Azure DevOps. В случае неудачи вам будут предоставлены подробные сведения о сборке, позволяющие найти проблемный элемент.

![Сообщение по электронной почте об успешной сборке](./media/code-test/email_build_succeed.PNG)

![Уведомление в Azure DevOps об успешной сборке](./media/code-test/vs_online_build_succeed.PNG)

## <a name="next-steps"></a>Дальнейшие действия
* В [репозитории прогноза доходов UCI](https://github.com/Azure/MachineLearningSamples-TDSPUCIAdultIncome) представлены конкретные примеры модульных тестов для сценариев обработки и анализа данных.
* Выполните приведенные выше рекомендации и примеры для сценария прогнозирования доходов UCI в собственных проектах обработки и анализа данных.

## <a name="references"></a>Ссылки
* [Что такое процесс обработки и анализа данных группы?](https://aka.ms/tdsp)
* [Средства тестирования для Visual Studio](https://www.visualstudio.com/vs/features/testing-tools/)
* [Ресурсы для тестирования в Azure DevOps](https://www.visualstudio.com/team-services/)
* [Виртуальные машины для обработки и анализа данных](https://azure.microsoft.com/services/virtual-machines/data-science-virtual-machines/)
