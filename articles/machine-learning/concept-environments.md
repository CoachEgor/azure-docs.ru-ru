---
title: О средах машинного обучения Azure
titleSuffix: Azure Machine Learning
description: В этой статье изучите преимущества сред машинного обучения, которые позволяют воспроизводимые, проверяемые и портативные определения зависимостей машинного обучения в различных вычислительных целях.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: trbye
author: trevorbye
ms.date: 03/18/2020
ms.openlocfilehash: 50ddbffd00e0cbbd0641089613aaa40d03658c9e
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80064194"
---
# <a name="what-are-azure-machine-learning-environments"></a>Что такое среда машинного обучения Azure?
[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-basic-enterprise-sku.md)]

Среды машинного обучения Azure определяют пакеты Python, переменные среды и настройки программного обеспечения вокруг сценариев обучения и скоринга. Они также указывают время выполнения (Python, Spark или Docker). Среды управляются и версируются сущностями в рабочем пространстве машинного обучения, которые позволяют воспроизводимые, проверяемые и портативные рабочие процессы машинного обучения в различных вычислительных целях.

Объект можно `Environment` использовать на локальном вычислении для:
* Разработайте сценарий обучения.
* Повторное использование той же среды на Azure Machine Learning Compute для обучения модели в масштабе.
* Развертывание модели с той же средой.

Следующая диаграмма иллюстрирует, как можно `Environment` использовать один объект как в конфигурации запуска, так и для обучения, а также для настройки выводов и развертывания для развертывания веб-служб.

![Диаграмма среды в рабочем процессе машинного обучения](./media/concept-environments/ml-environment.png)

## <a name="types-of-environments"></a>Типы окружений

Среды можно в целом разделить на три категории: *куратор,* *управляемый пользователем*и *управляемый системой.*

Кураторские среды предоставляются Azure Machine Learning и доступны в вашем рабочем пространстве по умолчанию. Они содержат коллекции пакетов и настроек Python, которые помогут вам начать работу с различными платформами машинного обучения. 

В управляемых пользователем средах вы отвечаете за настройку среды и установку каждого пакета, который необходим скрипту обучения на вычислительную цель. Conda не проверяет вашу среду и не устанавливает что-либо для вас. Если вы определяете свою собственную `azureml-defaults` среду, `>= 1.0.45` вы должны перечислить с версией в качестве зависимости от пипсов. Этот пакет содержит функциональность, необходимую для размещения модели в качестве веб-службы.

Среды, управляемые системой, используются, когда требуется, чтобы [Conda](https://conda.io/docs/) управляла средой Python и зависимостями скриптов для вас. Служба принимает этот тип среды по умолчанию, из-за его полезности на удаленных вычислениях целей, которые не поддаются вручную.

## <a name="create-and-manage-environments"></a>Создание и управление средами

Вы можете создавать среды:

* Определение `Environment` новых объектов либо с помощью куратора среды, либо путем определения собственных зависимостей.
* Использование `Environment` существующих объектов из рабочего пространства. Такой подход обеспечивает согласованность и воспроизводимость с вашими зависимостями.
* Импорт из существующего определения среды Anaconda.
* Использование CLI машинного обучения Azure

Для конкретных образцов кода см. [Reuse environments for training and deployment](how-to-use-environments.md#create-an-environment) Среды также легко управлять через рабочее пространство. Они включают в себя следующие функции:

* Среды автоматически регистрируются в вашем рабочем пространстве при отправке эксперимента. Они также могут быть зарегистрированы вручную.
* Можно получить среды из рабочего пространства для обучения или развертывания или внести в определение среды правки.
* С помощью версий можно увидеть изменения в среде с течением времени, что обеспечивает воспроизводимость.
* Изображения Docker можно создавать автоматически из среды.

Для примеров кода см. раздел "Управление средами" [сред повторного использования для обучения и развертывания.](how-to-use-environments.md#manage-environments)

## <a name="environment-building-caching-and-reuse"></a>Здание среды, кэширование и повторное использование

Служба машинного обучения Azure строит определения среды в изображения докеров и средки conda. Он также кэширует среды, чтобы они могли быть повторно использованы в последующих обучаемых запусках и развертывании конечных точек обслуживания.

### <a name="building-environments-as-docker-images"></a>Среда построения как изображения Докера

Обычно при первой отправке запуска с помощью среды служба машинного обучения Azure вызывает [задачу сборки ACR](https://docs.microsoft.com/azure/container-registry/container-registry-tasks-overview) в реестре контейнеров Azure (ACR), связанном с рабочим пространством. Затем построенное изображение Docker кэшируется на ACR Рабочего пространства. В начале выполнения выполнения изображение извлекается целевой вычисляемым.

Сборка изображения состоит из двух этапов:

 1. Загрузка базового изображения и выполнение любых шагов Docker
 2. Создание среды conda в соответствии с зависимостями conda, указанными в определении среды.

Второй шаг опущен, если указано [пользовательские зависимости.](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment.pythonsection?view=azure-ml-py) В этом случае вы несете ответственность за установку любых пакетов Python, включив их в базовое изображение или указав пользовательские шаги Docker в течение первого шага. Вы также несете ответственность за указание правильного местоположения для выполнения Python.

### <a name="image-caching-and-reuse"></a>Кэширование изображения и повторное использование

Если вы используете то же определение среды для другого запуска, служба машинного обучения Azure повторно использует кэшированное изображение из ACR рабочего пространства. 

Для просмотра деталей кэшированного изображения используйте метод [Environment.get_image_details.](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment.environment?view=azure-ml-py#get-image-details-workspace-)

Чтобы определить, следует ли повторно использовать кэшированное изображение или построить новое, служба вычисляет [хэш-значение](https://en.wikipedia.org/wiki/Hash_table) из определения среды и сравнивает его с хэшами существующих сред. Хэш основан на:
 
 * Базовое значение свойства изображения
 * Пользовательские докер шаги значение свойства
 * Список пакетов Python в определении Conda
 * Список пакетов в определении Spark 

Хэш не зависит от имени среды или версии. Изменения определения среды, такие как добавление или удаление пакета Python или изменение версии пакета, приводит к изменению значения хэша и вызывает восстановление изображения. Однако, если вы просто переименуете свою среду или создаете новую среду с точными свойствами и пакетами существующей, то значение хэша остается прежним и используется кэшированное изображение.

Смотрите следующую диаграмму, на которой отображается три определения среды. Два из них имеют различное название и версию, но идентичные базовые изображения и пакеты Python. Они имеют тот же хэш и, следовательно, соответствуют тому же кэшированному изображению. Третья среда имеет различные пакеты и версии Python и, следовательно, соответствует другому кэшированному изображению.

![Диаграмма кэширования среды как изображения Докера](./media/concept-environments/environment-caching.png)

>[!IMPORTANT]
> Например, ```numpy```при создании среды с незакрепленной зависимостью пакетов эта среда будет продолжать использовать версию пакета, _установленную во время создания среды._ Кроме того, любая будущая среда с соответствующим определением будет продолжать использовать старую версию. 

Чтобы обновить пакет, укажите номер версии, ```numpy==1.18.1```чтобы заставить восстановить изображение, например. Обратите внимание, что будут установлены новые зависимости, в том числе вложенные, которые могут нарушить ранее работаващий сценарий.

> [!WARNING]
>  Метод [Environment.build](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment.environment?view=azure-ml-py#build-workspace--image-build-compute-none-) будет перестраивать кэшированное изображение с возможным побочным эффектом обновления незакрепленных пакетов и нарушения воспроизводимости для всех определений среды, соответствующих этому кэшированному изображению.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [создавать и использовать среды](how-to-use-environments.md) в Azure Machine Learning.
* Смотрите справочную документацию Python SDK для [класса среды.](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment(class)?view=azure-ml-py)
* Смотрите справочную документацию R SDK для [сред.](https://azure.github.io/azureml-sdk-for-r/reference/index.html#section-environments)
