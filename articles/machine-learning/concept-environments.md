---
title: Сведения о Машинное обучение Azure средах
titleSuffix: Azure Machine Learning
description: В этой статье вы узнаете о преимуществах сред машинного обучения, которые позволяют воспроизводимые, отслеживаемые и переносимые определения зависимостей машинного обучения в различных целевых вычислительных ресурсах.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: trbye
author: trevorbye
ms.date: 03/18/2020
ms.openlocfilehash: 50ddbffd00e0cbbd0641089613aaa40d03658c9e
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "80064194"
---
# <a name="what-are-azure-machine-learning-environments"></a>Что такое Машинное обучение Azure среды?
[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-basic-enterprise-sku.md)]

Среды Машинного обучения Azure определяют пакеты Python, переменные среды и настройки программного обеспечения, связанные с вашими сценариями обучения и оценок. Они также указывают время выполнения (Python, Spark или DOCKER). Среды — это управляемые и версии сущностей в рабочей области Машинное обучение, которые позволяют воспроизводимые, отслеживаемые и переносимые рабочие процессы машинного обучения в различных целевых объектах вычислений.

Объект можно использовать `Environment` в локальном вычислении для выполнения следующих действий.
* разработки сценария обучения;
* повторного использования той же среды в Вычислительной среде Машинного обучения для обучения модели в большом масштабе.
* Разверните модель в той же среде.

На следующей схеме показано, как можно использовать один `Environment` объект в конфигурации запуска, для обучения, а также для подготовки и настройки развертывания для развертываний веб-служб.

![Схема среды в рабочем процессе машинного обучения](./media/concept-environments/ml-environment.png)

## <a name="types-of-environments"></a>Типы окружений

Среды можно разделить на три категории: *проверенные*, *управляемые пользователем*и *управляемые системой*.

Проверенные среды предоставляются Машинное обучение Azure и доступны в рабочей области по умолчанию. Они содержат коллекции пакетов и параметров Python, которые помогут приступить к работе с различными платформами машинного обучения. 

В средах, управляемых пользователями, вы несете ответственность за настройку среды и установку каждого пакета, необходимого для выполнения сценария обучения на целевом объекте вычислений. Conda не проверяет вашу среду или не устанавливает ничего. При определении собственной среды необходимо перечислить `azureml-defaults` версию в `>= 1.0.45` качестве зависимости PIP. Этот пакет содержит функциональные возможности, необходимые для размещения модели в качестве веб-службы.

Если требуется, чтобы [Conda](https://conda.io/docs/) управлял средой Python и зависимостями скриптов, используются управляемые системой среды. Служба по умолчанию использует этот тип окружения из-за его полезности в удаленных целевых объектах вычислений, которые не настраиваются вручную.

## <a name="create-and-manage-environments"></a>Создание сред и управление ими

Вы можете создавать среды, выполнив следующие действия.

* Определение новых `Environment` объектов либо с помощью проверенной среды, либо путем определения собственных зависимостей.
* Использование существующих `Environment` объектов из рабочей области. Такой подход обеспечивает согласованность и воспроизводимость с зависимостями.
* Импорт из существующего определения среды Anaconda.
* Использование интерфейса командной строки Машинное обучение Azure

Конкретные примеры кода см. в разделе "Создание среды" статьи [повторное использование сред для обучения и развертывания](how-to-use-environments.md#create-an-environment). Кроме того, в рабочей области можно легко управлять средами. В их число входят следующие функциональные возможности.

* При отправке эксперимента среды автоматически регистрируются в рабочей области. Их также можно зарегистрировать вручную.
* Вы можете выбрать среды из рабочей области, чтобы использовать их для обучения или развертывания, или внести изменения в определение среды.
* С помощью управления версиями вы можете просматривать изменения в средах с течением времени, что гарантирует воспроизводимость.
* Образы DOCKER можно создавать автоматически из своих сред.

Примеры кода см. в разделе "Управление средами" раздела [повторное использование сред для обучения и развертывания](how-to-use-environments.md#manage-environments).

## <a name="environment-building-caching-and-reuse"></a>Создание, кэширование и повторное использование среды

Служба Машинное обучение Azure создает определения среды в образы DOCKER и среды conda. Он также кэширует окружения, чтобы их можно было использовать повторно в последующих учебных запусках и развертываниях конечных точек служб.

### <a name="building-environments-as-docker-images"></a>Создание сред как образов DOCKER

Как правило, при первой отправке выполнения с помощью среды служба Машинное обучение Azure вызывает [задачу сборки записей контроля](https://docs.microsoft.com/azure/container-registry/container-registry-tasks-overview) доступа в реестре контейнеров Azure (запись контроля доступа), связанную с рабочей областью. Затем встроенный образ DOCKER кэшируется в записи контроля доступа рабочей области. В начале выполнения выполнения образ извлекается целевым объектом вычислений.

Сборка образа состоит из двух этапов:

 1. Загрузка базового образа и выполнения всех действий DOCKER
 2. Создание среды conda в соответствии с зависимостями conda, указанными в определении среды.

Второй шаг опускается, если указаны [управляемые пользователем зависимости](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment.pythonsection?view=azure-ml-py). В этом случае вы несете ответственность за установку пакетов Python, включая их в базовый образ, или указание пользовательских шагов DOCKER на первом шаге. Вы также несете ответственность за указание правильного расположения исполняемого файла Python.

### <a name="image-caching-and-reuse"></a>Кэширование и повторное использование образов

Если вы используете одно и то же определение среды для другого запуска, служба Машинное обучение Azure повторно использует кэшированный образ из записи контроля доступа рабочей области. 

Чтобы просмотреть сведения о кэшированном изображении, используйте метод [Environment. get_image_details](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment.environment?view=azure-ml-py#get-image-details-workspace-) .

Чтобы определить, следует ли повторно использовать кэшированное изображение или создать новый, служба вычислит [хэш-значение](https://en.wikipedia.org/wiki/Hash_table) из определения среды и сравнивает его с хэшем существующих сред. Хэш основан на:
 
 * Значение свойства базового образа
 * Значение свойства настраиваемых шагов DOCKER
 * Список пакетов Python в определении Conda
 * Список пакетов в определении Spark 

Хэш не зависит от имени или версии среды. Изменение определения среды, например добавление или удаление пакета Python или изменение версии пакета, приводит к изменению значения хэша и активирует перестроение образа. Однако если вы просто переименовываете среду или создаете новую среду с точно такими свойствами и пакетами существующего, хэш-значение остается прежним и используется кэшированное изображение.

На следующей схеме показаны три определения среды. Два из них имеют разные имена и версии, но идентичны базовому образу и пакетам Python. Они имеют один и тот же хэш и поэтому соответствуют одному кэшированному изображению. Третья среда имеет разные пакеты и версии Python и, следовательно, соответствует другому кэшированному изображению.

![Схема кэширования окружения как образов DOCKER](./media/concept-environments/environment-caching.png)

>[!IMPORTANT]
> Например, при создании среды с незакрепленной зависимостью пакета ```numpy``` Эта среда будет использовать версию пакета, установленную _во время создания среды_. Кроме того, любая будущая среда с соответствующим определением будет использовать старую версию. 

Чтобы обновить пакет, укажите номер версии для принудительного перестроения образа, например ```numpy==1.18.1``` . Обратите внимание, что будут установлены новые зависимости, включая вложенные, которые могут нарушить работу ранее работающего сценария.

> [!WARNING]
>  Метод [Environment. Build](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment.environment?view=azure-ml-py#build-workspace--image-build-compute-none-) выполнит перестроение кэшированного образа с возможным побочным действием обновления незакрепленных пакетов и разрушением воспроизводимость для всех определений среды, соответствующих этому кэшированному изображению.

## <a name="next-steps"></a>Дальнейшие действия

* Узнайте, как [создавать и использовать среды](how-to-use-environments.md) в машинное обучение Azure.
* См. справочную документацию по пакету SDK для Python для [класса Environment](https://docs.microsoft.com/python/api/azureml-core/azureml.core.environment(class)?view=azure-ml-py).
* См. справочную документацию по пакету SDK R для [сред](https://azure.github.io/azureml-sdk-for-r/reference/index.html#section-environments).
