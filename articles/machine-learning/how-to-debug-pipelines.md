---
title: Отладка и устранение неполадок в конвейерах машинного обучения
titleSuffix: Azure Machine Learning
description: Отладка и устранение неполадок конвейеров машинного обучения в пакете SDK для Машинное обучение Azure для Python. Изучите распространенные ловушки для разработки конвейеров и советы по отладке сценариев до и во время удаленного выполнения.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
author: likebupt
ms.author: keli19
ms.date: 12/12/2019
ms.openlocfilehash: 5ba26584f08e705b24749a76d6f607aa84b48fab
ms.sourcegitcommit: 984c5b53851be35c7c3148dcd4dfd2a93cebe49f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/28/2020
ms.locfileid: "76769123"
---
# <a name="debug-and-troubleshoot-machine-learning-pipelines"></a>Отладка и устранение неполадок в конвейерах машинного обучения
[!INCLUDE [applies-to-skus](../../includes/aml-applies-to-basic-enterprise-sku.md)]

Из этой статьи вы узнаете, как выполнять отладку и устранение неполадок в [конвейерах машинного обучения](concept-ml-pipelines.md) в [машинное обучение Azure SDK](https://docs.microsoft.com/python/api/overview/azure/ml/intro?view=azure-ml-py) и [конструкторе машинное обучение Azure (Предварительная версия)](https://docs.microsoft.com/azure/machine-learning/concept-designer).

## <a name="debug-and-troubleshoot-in-the-azure-machine-learning-sdk"></a>Отладка и устранение неполадок в пакете SDK для Машинное обучение Azure
В следующих разделах представлен обзор распространенных ловушек при построении конвейеров, а также различные стратегии отладки кода, выполняемого в конвейере. При возникновении проблем с получением ожидаемого запуска конвейера используйте следующие советы.

### <a name="testing-scripts-locally"></a>Локальное тестирование скриптов

Одним из наиболее распространенных сбоев в конвейере является то, что присоединенный скрипт (скрипт очистки данных, Скрипт оценки и т. д.) не выполняется должным образом или содержит ошибки времени выполнения в удаленном контексте вычислений, которые трудно отладить в рабочей области на компьютере Azure. Learning Studio. 

Сами по себе конвейеры не могут выполняться локально, но выполнение сценариев на локальном компьютере позволяет выполнять отладку быстрее, поскольку не нужно ждать процесса сборки вычислений и среды. Для этого требуется выполнить некоторые действия по разработке:

* Если данные находятся в облачном хранилище данных, необходимо скачать данные и сделать их доступными для скрипта. Использование небольшого примера данных — хороший способ сократить время выполнения и получить отзыв о поведении сценария.
* При попытке имитировать промежуточный шаг конвейера может потребоваться вручную создать типы объектов, которые определенный сценарий ожидает на предыдущем шаге.
* Также потребуется определить собственную среду и реплицировать зависимости, определенные в удаленной среде вычислений.

После установки сценария для запуска в локальной среде гораздо проще выполнять задачи отладки, такие как:

* Присоединение пользовательской конфигурации отладки
* Приостановка выполнения и проверка состояния объекта
* Перехват типов или логических ошибок, которые не будут предоставляться до времени выполнения

> [!TIP] 
> Убедившись в том, что сценарий выполняется должным образом, на следующем шаге выполняется сценарий в одношаговом конвейере, прежде чем пытаться запустить его в конвейере с несколькими шагами.

### <a name="debugging-scripts-from-remote-context"></a>Отладка скриптов из удаленного контекста

Локальное тестирование скриптов — это отличный способ отладки основных фрагментов кода и сложной логики, прежде чем приступить к созданию конвейера, но в некоторый момент вам, скорее всего, придется отлаживать сценарии во время выполнения собственно конвейера, особенно при диагностике выполняемого поведения. во время взаимодействия между этапами конвейера. Мы рекомендуем свободно использовать инструкции `print()` в сценариях шагов, чтобы видеть состояние объекта и ожидаемые значения во время удаленного выполнения, аналогично отладке кода JavaScript.

Файл журнала `70_driver_log.txt` содержит: 

* Все печатные инструкции во время выполнения сценария
* Трассировка стека для скрипта 

Чтобы найти этот и другие файлы журнала на портале, сначала щелкните Запуск конвейера в рабочей области.

![Страница списка запусков конвейера](./media/how-to-debug-pipelines/pipelinerun-01.png)

Перейдите на страницу сведений о выполнении конвейера.

![Страница сведений о запуске конвейера](./media/how-to-debug-pipelines/pipelinerun-02.png)

Щелкните модуль для конкретного шага. Перейдите на вкладку **журналы** . Другие журналы включают сведения о процессе сборки образа среды и сценарии подготовки к выполнению.

![Вкладка журнала страницы сведений о запуске конвейера](./media/how-to-debug-pipelines/pipelinerun-03.png)

> [!TIP]
> Запуски для *опубликованных конвейеров* можно найти на вкладке " **конечные точки** " в рабочей области. Запуски для *неопубликованных конвейеров* можно найти в **экспериментах** или **конвейерах**.

### <a name="troubleshooting-tips"></a>Советы по устранению неполадок

В следующей таблице приведены распространенные проблемы во время разработки конвейера с потенциальными решениями.

| Проблема | Возможное решение |
|--|--|
| Не удалось передать данные в каталог `PipelineData` | Убедитесь, что в скрипте создан каталог, который соответствует расположению выходных данных шага в конвейере. В большинстве случаев входной аргумент определяет выходной каталог, а затем создает каталог явным образом. Чтобы создать выходной каталог, используйте `os.makedirs(args.output_dir, exist_ok=True)`. См. [руководство](tutorial-pipeline-batch-scoring-classification.md#write-a-scoring-script) по примеру сценария оценки, в котором показан этот шаблон разработки. |
| Ошибки зависимостей | Если вы разработали и тестировали сценарии локально, но нашли проблемы с зависимостями при выполнении на удаленном вычислении в конвейере, убедитесь, что зависимости и версии среды вычислений соответствуют вашей тестовой среде. |
| Неоднозначные ошибки с целевыми объектами вычислений | Удаление и повторное создание целевых объектов вычислений может решить определенные проблемы с целевыми объектами вычислений. |
| Конвейер не использует повторно шаги | Повторное использование шага включено по умолчанию, но убедитесь, что вы не отключили его на этапе конвейера. Если повторное использование отключено, для параметра `allow_reuse` на шаге будет задано значение `False`. |
| Конвейер перезапускается без необходимости | Чтобы обеспечить повторный запуск шагов только при изменении базовых данных или скриптов, установите соединение между каталогами для каждого шага. Если один и тот же исходный каталог используется для нескольких шагов, может возникнуть ненужное повторное использование. Используйте параметр `source_directory` объекта шага конвейера, чтобы указать на изолированный каталог для этого шага, и убедитесь, что вы не используете один и тот же путь `source_directory` для нескольких шагов. |

### <a name="logging-options-and-behavior"></a>Параметры ведения журнала и поведение

В таблице ниже приведены сведения о различных параметрах отладки для конвейеров. Он не является исчерпывающим списком, так как существуют другие варианты, кроме только Машинное обучение Azure, Python и Опенценсус, показанных здесь.

| Библиотека                    | Тип   | Пример                                                          | Место назначения                                  | Ресурсы                                                                                                                                                                                                                                                                                                                    |
|----------------------------|--------|------------------------------------------------------------------|----------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Пакет SDK для Машинное обучение Azure | Метрика | `run.log(name, val)`                                             | Пользовательский интерфейс портала Машинное обучение Azure             | [Как отвести эксперименты](how-to-track-experiments.md#available-metrics-to-track)<br>[класс azureml. Core. Run](https://docs.microsoft.com/python/api/azureml-core/azureml.core.run(class)?view=experimental)                                                                                                                                                 |
| Печать и ведение журнала Python    | Журнал    | `print(val)`<br>`logging.info(message)`                          | Журналы драйверов, конструктор Машинное обучение Azure | [Как отвести эксперименты](how-to-track-experiments.md#available-metrics-to-track)<br><br>[Ведение журнала Python](https://docs.python.org/2/library/logging.html)                                                                                                                                                                       |
| Опенценсус Python          | Журнал    | `logger.addHandler(AzureLogHandler())`<br>`logging.log(message)` | Application Insights трассировки                | [Отладка конвейеров в Application Insights](how-to-debug-pipelines-application-insights.md)<br><br>[Агенты OpenCensus Azure Monitor Exporter](https://github.com/census-instrumentation/opencensus-python/tree/master/contrib/opencensus-ext-azure)<br>[Cookbook ведения журнала Python](https://docs.python.org/3/howto/logging-cookbook.html) |

#### <a name="logging-options-example"></a>Пример параметров ведения журнала

```python
import logging

from azureml.core.run import Run
from opencensus.ext.azure.log_exporter import AzureLogHandler

run = Run.get_context()

# Azure ML Scalar value logging
run.log("scalar_value", 0.95)

# Python print statement
print("I am a python print statement, I will be sent to the driver logs.")

# Initialize python logger
logger = logging.getLogger(__name__)
logger.setLevel(args.log_level)

# Plain python logging statements
logger.debug("I am a plain debug statement, I will be sent to the driver logs.")
logger.info("I am a plain info statement, I will be sent to the driver logs.")

handler = AzureLogHandler(connection_string='<connection string>')
logger.addHandler(handler)

# Python logging with OpenCensus AzureLogHandler
logger.warning("I am an OpenCensus warning statement, find me in Application Insights!")
logger.error("I am an OpenCensus error statement with custom dimensions", {'step_id': run.id})
``` 

## <a name="debug-and-troubleshoot-in-azure-machine-learning-designer-preview"></a>Отладка и устранение неполадок в конструкторе Машинное обучение Azure (Предварительная версия)

В этом разделе приводятся общие сведения об устранении неполадок конвейеров в конструкторе.
Для конвейеров, созданных в конструкторе, **файлы журнала** можно найти на странице «разработка» или на странице «сведения о выполнении конвейера».

### <a name="access-logs-from-the-authoring-page"></a>Доступ к журналам со страницы "Создание и Настройка"

При отправке выполнения конвейера и остаться на странице Authoring (создание и настройка) можно найти файлы журналов, созданные для каждого модуля.

1. Выберите любой модуль на холсте разработки.
1. На панели "Свойства" перейдите на вкладку **журналы** .
1. Выберите файл журнала `70_driver_log.txt`

    ![Создание журналов модулей страниц](./media/how-to-debug-pipelines/pipelinerun-05.png)

### <a name="access-logs-from-pipeline-runs"></a>Доступ к журналам из запусков конвейера

Файлы журналов конкретных запусков можно также найти на странице сведений о выполнении конвейера в разделах **конвейеры** или **эксперименты** .

1. Выберите Запуск конвейера, созданный в конструкторе.
    ](./media/how-to-debug-pipelines/pipelinerun-04.png) страницы запуска конвейера ![
1. Выберите любой модуль в области просмотра.
1. На панели "Свойства" перейдите на вкладку **журналы** .
1. Выберите файл журнала `70_driver_log.txt`

## <a name="debug-and-troubleshoot-in-application-insights"></a>Отладка и устранение неполадок в Application Insights
Дополнительные сведения об использовании библиотеки Опенценсус Python таким образом см. в разделе [Отладка и устранение неполадок конвейеров машинного обучения в Application Insights](how-to-debug-pipelines-application-insights.md)

## <a name="next-steps"></a>Дальнейшие действия

* Обратитесь к Справочнику по пакету SDK, чтобы получить справку по пакету [azureml-конвейеры-Core](https://docs.microsoft.com/python/api/azureml-pipeline-core/?view=azure-ml-py) и пакету [azureml-конвейеры-этапов](https://docs.microsoft.com/python/api/azureml-pipeline-steps/?view=azure-ml-py) .

* См. список [исключений и кодов ошибок конструктора](algorithm-module-reference/designer-error-codes.md).
