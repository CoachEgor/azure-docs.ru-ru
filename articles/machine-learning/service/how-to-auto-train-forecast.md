---
title: Автоматическое обучение, прогнозная модель временных рядов
titleSuffix: Azure Machine Learning service
description: Узнайте, как использовать службы машинного обучения Azure, чтобы обучить временного ряда Регрессия модели прогнозирования с помощью автоматической машинного обучения.
services: machine-learning
author: trevorbye
ms.author: trbye
ms.service: machine-learning
ms.subservice: core
ms.reviewer: trbye
ms.topic: conceptual
ms.date: 05/02/2019
ms.openlocfilehash: c7f4b6d8aa614a460772fb7af11f9b83dc3fc979
ms.sourcegitcommit: 36c50860e75d86f0d0e2be9e3213ffa9a06f4150
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/16/2019
ms.locfileid: "65800813"
---
# <a name="auto-train-a-time-series-forecast-model"></a>Автоматическое обучение, прогнозная модель временных рядов

В этой статье вы узнаете, как обучить временных рядов регрессии модели прогнозирования с помощью автоматических в машинном обучении в службе машинного обучения Azure. Настройка модели прогнозирования аналогична настройке стандартной модели регрессии с помощью автоматических машинного обучения, но существуют определенные параметры и предварительной обработки действия по настройке для работы с данными временных рядов. В следующих примерах показано, как для:

* Подготовка данных для моделирования временного ряда
* Настройте определенные параметры временных рядов в [ `AutoMLConfig` ](/python/api/azureml-train-automl/azureml.train.automl.automlconfig) объекта
* Запустите прогнозы с данными временных рядов

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2X1GW]

## <a name="prerequisites"></a>Технические условия

* Рабочая область службы машинного обучения Azure. Чтобы создать рабочую область, см. в разделе [создать рабочую область службы машинного обучения Azure](setup-create-workspace.md).
* В этой статье предполагается, что базовые знания о настройке автоматического эксперимента машинного обучения. Выполните [руководстве](tutorial-auto-train-models.md) или [руководства](how-to-configure-auto-train.md) для см. в разделе Основные автоматизированные задачи машинного обучения шаблоны разработки эксперимента.

## <a name="preparing-data"></a>Подготовка данных

Наиболее важным отличием между прогнозирования тип задачи регрессии и регрессии типа задачи в рамках автоматических машинного обучения, включая в данных, представляющий допустимые временных рядов функция. Регулярные временных рядов имеет четко определенные и согласованное частоту и имеет значение в каждой точке образец в непрерывной временной интервал. Рассмотрим следующий моментальный снимок файла `sample.csv`.

    day_datetime,store,sales_quantity,week_of_year
    9/3/2018,A,2000,36
    9/3/2018,B,600,36
    9/4/2018,A,2300,36
    9/4/2018,B,550,36
    9/5/2018,A,2100,36
    9/5/2018,B,650,36
    9/6/2018,A,2400,36
    9/6/2018,B,700,36
    9/7/2018,A,2450,36
    9/7/2018,B,650,36

Этот набор данных является простым примером данных о ежедневных продажах для у организации есть два хранилища, А и б. Кроме того, имеется функция для `week_of_year` , обеспечивая модели для определения еженедельного сезонности. Поле `day_datetime` представляет очистки временных рядов с раз в день, а в поле `sales_quantity` целевой столбец для выполнения прогнозов. Считывать данные в таблице данных Pandas, а затем используйте `to_datetime` функции, чтобы убедиться, временной ряд `datetime` типа.

```python
import pandas as pd
data = pd.read_csv("sample.csv")
data["day_datetime"] = pd.to_datetime(data["day_datetime"])
```

В этом случае данные уже отсортированы по возрастанию по полю время `day_datetime`. Тем не менее при настройке эксперимент, убедитесь, что нужное время столбец отсортирован по возрастанию для построения допустимых временных рядов. Предположим, что данные содержат 1000 записей и добавьте детерминированным разбиения в данные для создания обучающих и проверочных наборов данных. Разделяйте целевое поле `sales_quantity` для создания прогноза обучения и тестовым групп.

```python
X_train = data.iloc[:950]
X_test = data.iloc[-50:]

y_train = X_train.pop("sales_quantity").values
y_test = X_test.pop("sales_quantity").values
```

> [!NOTE]
> При обучении модели для прогнозирования будущих значений, чтобы все компоненты, использованных в обучении может использоваться при выполнении прогнозов для горизонтов предполагаемого. Например при создании прогнозирования спроса, в том числе страницу для текущую цену акций может значительно увеличить точность обучения. Тем не менее если требуется прогноз с длинный период, вы не сможете прогнозировать будущие акций значения, соответствующие точкам будущих временных рядов и точности модели может ухудшиться.

## <a name="configure-and-run-experiment"></a>Настройка и запуск эксперимента

Для прогнозирования задачи, автоматических машинного обучения использует шаги предварительной обработки и оценки, характерные для данных временных рядов. Следующие этапы предварительной обработки выполняется:

* Определение временных рядов пример частоту (например почасовая, ежедневно, еженедельно) и создания новых записей для отсутствующих точками времени, чтобы ряд непрерывной.
* Добавить отсутствующие значения в столбцах функции (с помощью значения медианы столбца) и цель (с помощью прямого заполнением)
* Создание характеристик на основе интервала для включения основных эффектов по различным сериям
* Создание функции на основе времени для помощи в изучении сезонным
* Кодирование категориальных переменных для числовых величин

`AutoMLConfig` Объект определяет параметры и данные, необходимые для задач автоматических машинного обучения. Подобно регрессионная задача, стандартная обучения параметры определяются как тип задачи, число итераций, обучающие данные и количество перекрестной проверки. Для прогнозирования задачи, существуют дополнительные параметры, которые должны быть заданы, которые влияют на эксперимент. В следующей таблице описаны все параметры и их использование.

| Параметр | Описание | Обязательно для заполнения |
|-------|-------|-------|
|`time_column_name`|Используется для указания входных данных, используемые для построения временного ряда и вывод его частота столбец datetime.|✓|
|`grain_column_names`|Имена, определение групп отдельные ряды во входных данных. Если интервал не определен, набор данных считается один временных рядов.||
|`max_horizon`|Максимальное желаемое период прогноза в единицах частоты временных рядов.|✓|
|`target_lags`|*n* периодов времени для прямого lag целевые значения до обучения модели.||
|`target_rolling_window_size`|*n* исторических периоды, используемые для создания прогнозируемых значений, < = размер набора обучения. Если этот параметр опущен, *n* полного обучения устанавливается размер.||

Создайте необходимые параметры временных рядов как объект словаря. Задайте `time_column_name` для `day_datetime` поле в наборе данных. Определение `grain_column_names` параметр, чтобы убедиться, что **две отдельные группы временных рядов** создаются для набора данных — одну для магазина А и б. Наконец, `max_horizon` до 50 для прогнозирования для всего теста значение. Значение прогноза окна 10 периодов с `target_rolling_window_size`и задержка целевого значения 2 периода вперед с `target_lags` параметра.

```python
time_series_settings = {
    "time_column_name": "day_datetime",
    "grain_column_names": ["store"],
    "max_horizon": 50,
    "target_lags": 2,
    "target_rolling_window_size": 10
}
```

Теперь создадим стандартную `AutoMLConfig` объекта, указав `forecasting` тип задачи, а также отправка эксперимента. После завершения модели извлечения лучше всего выполнения итерации.

```python
from azureml.core.workspace import Workspace
from azureml.core.experiment import Experiment
from azureml.train.automl import AutoMLConfig
import logging

automl_config = AutoMLConfig(task='forecasting',
                             primary_metric='normalized_root_mean_squared_error',
                             iterations=10,
                             X=X_train,
                             y=y_train,
                             n_cross_validations=5,
                             enable_ensembling=False,
                             verbosity=logging.INFO,
                             **time_series_settings)

ws = Workspace.from_config()
experiment = Experiment(ws, "forecasting_example")
local_run = experiment.submit(automl_config, show_output=True)
best_run, fitted_model = local_run.get_output()
```

> [!NOTE]
> Для процедуры перекрестной проверки (перекрестной проверки) данные временных рядов может нарушать основные статистические данные каноническую стратегии перекрестная проверка K сверток, поэтому автоматизированные машинного обучения реализует последовательного процедуру проверки источника для создания сверток перекрестной проверки для данных временных рядов. Чтобы использовать эту процедуру, укажите `n_cross_validations` параметр в `AutoMLConfig` объекта. Вы можете обойти проверки и использования наборов с помощью собственных проверок `X_valid` и `y_valid` параметров.

### <a name="view-feature-engineering-summary"></a>Сводка по функциям проектирования для представления

Для типов задач временных рядов в автоматических машинного обучения можно просмотреть сведения см. в процессе реконструирования признаков. В следующем коде показано каждого необработанных признаков, а также следующие атрибуты:

* Имя необработанных признаков
* Число реконструированные признаки, сформированным из этой необработанных признаков
* Обнаружен тип
* Является ли функция была удалена
* Список преобразований, компонент для необработанных признаков

```python
fitted_model.named_steps['timeseriestransformer'].get_featurization_summary()
```

## <a name="forecasting-with-best-model"></a>Прогнозирование с помощью оптимальную модель

Используйте лучшие итерации модели для прогнозирования значений для проверочного набора данных.

```python
y_predict = fitted_model.predict(X_test)
y_actual = y_test.flatten()
```

Кроме того, можно использовать `forecast()` вместо функции `predict()`, которых спецификации начала прогнозов. В следующем примере сначала замените все значения в `y_pred` с `NaN`. Происхождение прогноза будет в конце обучающих данных таким образом, как обычно было бы при использовании `predict()`. Тем не менее если Вы заменили только во второй половине `y_pred` с `NaN`, функция останется числовые значения в первой половине без изменений, но прогноза `NaN` значения во втором полугодии. Функция возвращает спрогнозированные значения и выровненные функции.

Можно также использовать `forecast_destination` параметр в `forecast()` функции прогноза вплоть до указанной даты.

```python
y_query = y_test.copy().astype(np.float)
y_query.fill(np.nan)
y_fcst, X_trans = fitted_pipeline.forecast(X_test, y_query, forecast_destination=pd.Timestamp(2019, 1, 8))
```

Вычислить RMSE (среднеквадратическая погрешность) между `y_test` фактические значения, а также спрогнозированные значения в `y_pred`.

```python
from sklearn.metrics import mean_squared_error
from math import sqrt

rmse = sqrt(mean_squared_error(y_actual, y_predict))
rmse
```

Теперь, когда общая точность модели будет определено, реалистичные следующим шагом является использование модели для прогнозирования неизвестных будущих значений. Просто введите набор данных в тот же формат, что проверочный набор `X_test` , но в будущих значений даты и времени и полученный прогноза набора не спрогнозированные значения для каждого шага временных рядов. Предположим, что были последние записи в наборе данных временных рядов для 12/31/2018. Для прогнозирования спроса за следующий день (или любое количество периодов для прогнозирования, < = `max_horizon`), создайте одно время записи ряда для каждого магазина для 01/01/2019 г.

    day_datetime,store,week_of_year
    01/01/2019,A,1
    01/01/2019,A,1

Повторите шаги, необходимые, чтобы загрузить эти будущие данные в кадр данных, а затем запустите `best_run.predict(X_test)` для прогнозирования будущих значений.

> [!NOTE]
> Значения не может быть спрогнозирован для количества периодов, больше, чем `max_horizon`. Модель должна быть повторно обученной с большего размера горизонта для прогнозирования будущих значений за текущий период.

## <a name="next-steps"></a>Дальнейшие действия

* Выполните [руководстве](tutorial-auto-train-models.md) вы научитесь создавать эксперименты с автоматической машинного обучения.
* Представление [Azure Machine Learning и пакет SDK для Python](https://aka.ms/aml-sdk) справочной документации.
