---
title: Использование Visual Studio Code для машинного обучения
titleSuffix: Azure Machine Learning
description: Узнайте, как установить Машинное обучение Azure для Visual Studio Code и создать эксперимент в Машинное обучение Azure.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: jimgries
author: greazer
ms.date: 09/20/2019
ms.custom: seodec18
ms.openlocfilehash: a93c71a97cdb1f6296919a248cf7ef545f7b307f
ms.sourcegitcommit: 263a69b70949099457620037c988dc590d7c7854
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2019
ms.locfileid: "71269243"
---
# <a name="get-started-with-azure-machine-learning-for-visual-studio-code"></a>Приступая к работе с Azure Machine Learning for Visual Studio Code

В этой статье вы узнаете, как использовать **машинное обучение Azure для расширения Visual Studio Code** для обучения и развертывания моделей машинного обучения.

[Служба машинное обучение Azure](overview-what-is-azure-ml.md) упрощает создание, обучение и развертывание моделей машинного обучения.
+ Для обучения он обеспечивает поддержку запуска экспериментов локально или удаленно. Для каждого эксперимента можно зарегистрировать пользовательские метрики нескольких запусков для точной настройки параметров.
+ Вы также можете использовать службу Машинное обучение Azure, чтобы легко развертывать модели машинного обучения для потребностей тестирования и производства.

## <a name="prerequisites"></a>Предварительные требования

+ Если у вас еще нет подписки Azure, создайте бесплатную учетную запись Azure, прежде чем начинать работу. Попробуйте [бесплатную или платную версию машинное обучение Azure](https://aka.ms/AMLFree).

+ Установите [Visual Studio Code](https://code.visualstudio.com/docs/setup/setup-overview), Облегченный редактор кода, работающий в Windows, Mac и Linux.

+ [Установите Python 3,5 или более поздней версии](https://www.anaconda.com/download/).


## <a name="install-the-extension"></a>Установить расширение

При установке расширения Машинное обучение Azure автоматически устанавливаются два расширения. Они являются [расширением учетной записи Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account) и [расширением Microsoft Python](https://marketplace.visualstudio.com/items?itemName=ms-Python.Python). Дополнительные сведения об использовании расширения Python для редактирования, выполнения и отладки кода Python см. в руководстве по работе со [средой Python Hello-World](https://code.visualstudio.com/docs/Python/Python-tutorial).

Чтобы установить расширение Машинное обучение Azure, выполните следующие действия.

1. Откройте Visual Studio Code.

1. Перейдите на вкладку расширения и выполните поиск по запросу "Машинное обучение Azure".

1. На вкладке расширение выберите **установить**.

1. Вкладка приветствие расширения открывается в Visual Studio Code, а символ Azure (выделенный красным цветом на следующем снимке экрана) добавляется на панель действий.

   ![Значок Azure на панели действий Visual Studio Code](./media/vscode-tools-for-ai/azure-activity-bar.png)

1. В диалоговом окне выберите **Вход** и следуйте инструкциям на экране, чтобы пройти аутентификацию в Azure.

   Расширение учетной записи Azure, которое было установлено вместе с Машинное обучение Azure для расширения Visual Studio Code, помогает выполнять аутентификацию с помощью учетной записи Azure. Список команд см. на странице [расширения учетной записи Azure](https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account).

> [!TIP]
> Вы также можете скачать установщик расширений непосредственно из [машинное обучение Azure для расширения Visual Studio Code (Предварительная версия)](https://aka.ms/vscodetoolsforai).

## <a name="quickstart-with-azure-machine-learning"></a>Краткое руководство с Машинное обучение Azure
Существует несколько способов запуска сценариев обучения с помощью службы Машинное обучение Azure. Если вы только начинаете работу, давайте сначала рассмотрим, как быстро отправить обучающий сценарий для выполнения в Azure.

Если вы уже знакомы с концепциями Машинное обучение Azure и хотите получить дополнительные сведения о том, как управлять ими и использовать их с расширением, см. [машинное обучение Azure подробно с помощью VS Code](./how-to-vscode-tools.md#azure-machine-learning-in-depth-with-vs-code) ниже.

## <a name="run-an-existing-python-training-script-in-azure"></a>Запуск существующего сценария обучения Python в Azure
Если у вас есть имеющийся сценарий обучения, то расширение Машинное обучение Azure для VS Code не только обеспечивает отличное редактирование, отладку и управление исходным кодом, но также упрощает запуск и хранение метрик для сценария в Azure.

Давайте приступим. Вы можете использовать собственный сценарий обучения, если он готов, или клонировать пример [репозитория vscode-Tools-for-AI](https://github.com/microsoft/vscode-tools-for-ai). Это общедоступный репозиторий для проблем с этим расширением. В нем также содержится небольшая папка образца **mnist** , которую мы будем использовать в этом примере.

1. Откройте папку **mnist** в VS Code.

1. Создайте новую среду Python с помощью избранного пакета виртуальной среды или Anaconda и установите пакеты TensorFlow и NumPy.

1. Выберите новую среду, созданную в качестве интерпретатора Python, в левом нижнем углу строки состояния VS Code.

1. Откройте **Train.py** и запустите его, открыв отладчик и нажав кнопку выполнить (или просто нажмите клавишу F5).

   [![Запустить обучение MNIST](./media/vscode-tools-for-ai/run-mnist.gif)](./media/vscode-tools-for-ai/run-mnist.gif#lightbox)

Если все установлено правильно, скрипт будет запущен и создаст модель TensorFlow в папке Outputs.

[![Показывать модель TensorFlow](./media/vscode-tools-for-ai/show-tensorflow-model.gif)](./media/vscode-tools-for-ai/show-tensorflow-model.gif#lightbox)

Теперь, когда вы уверены, что сценарий выполняется правильно, давайте выполним его в Azure.

Это можно легко сделать без дополнительного изменения **Train.py**. Однако с помощью нескольких простых изменений можно использовать Машинное обучение Azure для автоматической записи важных метрик по своему усмотрению при каждом запуске обучения.

### <a name="make-azure-aware-of-your-run-metrics"></a>Обеспечение работы Azure с учетом метрик выполнения
Чтобы изменить проект, чтобы в Azure можно было учитывать важную информацию, выполните следующие действия.

1. Создайте файл с именем **amlrun.py** в той же папке, что и **Train.py**

    ```Python
    import azureml
    from azureml.core import Run

    # access the Azure ML run
    # init run param to check if running within AML
    def get_AMLRun():
        try:
            run = Run.get_submitted_run()
            return run
        except Exception as e:
            print("Caught = {}".format(e.message))
            return None
    ```

2. Импорт файла амлрун в **Train.py**

    ```Python
    ...
    from utils import prepare_data
    from amlrun import get_AMLRun
    ...
    ```
3. Инициализация объекта Run в **Train.py**

    ```Python
    ...
    init = tf.global_variables_initializer()
    saver = tf.train.Saver()
    run = get_AMLRun()
    ...
    ```
4. Запись метрик в Azure с помощью функции Run. log ():

    ```Python
    ...
            acc_val = acc_op.eval(feed_dict = {X: X_test, y: y_test})

            # log accuracies to AML logger if using AML
            if run != None:
                run.log('Validation Accuracy', np.float(acc_val))
                run.log('Training Accuracy', np.float(acc_train))

            print(epoch, '-- Training accuracy:', acc_train, '\b Validation
    ...
    ```
### <a name="run-the-script-in-azure"></a>Запуск скрипта в Azure
Вот и все! Теперь просто используйте расширение, чтобы запустить сценарий в облаке. Обратите внимание, что в следующем пошаговом руководстве видео выполняется Liberty сжатия времени, затрачиваемого на создание рабочей области машинного обучения Azure и вычислений, а также время, затрачиваемое на выполнение обучающего сценария.

   [![Запуск эксперимента машинного обучения Azure](./media/vscode-tools-for-ai/start-golden-path.gif)](./media/vscode-tools-for-ai/start-golden-path.gif#lightbox)

После нажатия кнопки выполнить эксперимент ответьте на запросы следующим образом:

1. Выберите подписку Azure.
1. Выберите, чтобы создать *новую* рабочую область машинного обучения Azure
1. Выберите набор предварительно настроенных шаблонов, чтобы инициализировать среду Python для выполнения. Шаблоны предоставляют отправную точку и параметры включения для:
    1. **PyTorch**, **TensorFlow**или **Scikit — обучение**
    1. Обучение по **единому** или **распределенному** вычислению
    1. **Общие** сведения о пользовательских средах
1. Убедитесь, что список пакетов PIP и conda для вашего скрипта завершен, добавив пакеты, которые не включены в шаблон.
1. Проверьте имена и спецификации по умолчанию для запуска эксперимента и щелкните ссылку **Отправить эксперимент** в файле JSON. Файл JSON не будет сохранен, так как это просто для просмотра или изменения параметров эксперимента перед отправкой.
1. Дождитесь, пока расширение заполнит все необходимые действия и запустит ваш сценарий.

    [![Обучение в облаке](./media/vscode-tools-for-ai/run-golden-path.gif)](./media/vscode-tools-for-ai/run-golden-path.gif#lightbox)

Через несколько секунд вы получите уведомление о том, что эксперимент был отправлен в Azure, где можно просмотреть ход его выполнения либо в портал Azure, щелкнув ссылку **Просмотреть эксперимент Run** в VS Code уведомлении, либо внутри VS Code, нажав кнопку Обновить. на вкладке Azure.

В данный момент Просмотр метрик выполнения поддерживается только в портал Azure. Приведенный выше канал **просмотр эксперимента** поможет перейти к выполнению, где вы увидите зарегистрированные Вами метрики.
[![Запуск эксперимента на портале](./media/vscode-tools-for-ai/experiment-run-on-portal.PNG)](./media/vscode-tools-for-ai/experiment-run-on-portal.PNG#lightbox)

## <a name="azure-machine-learning-in-depth-with-vs-code"></a>Машинное обучение Azure подробные сведения с VS Code

В приведенном выше пошаговом руководстве мы отправили эксперимент, следуя самым простым путям. Как вы могли заметить, расширение сводится к минимальным действиям, которыми необходимо управлять для запуска эксперимента. В этом разделе мы рассмотрим, как можно управлять всеми концепциями Машинное обучение Azure по отдельности, обеспечивая максимальный контроль.

Перед началом обучения и развертыванием моделей машинного обучения в Visual Studio Code необходимо создать [машинное обучение Azure рабочую область](concept-workspace.md) в облаке. Эта Рабочая область будет содержать ваши модели и ресурсы.

### <a name="create-a-workspace"></a>Создать рабочую область

1. На панели действий Visual Studio Code щелкните значок Azure. Появится боковая панель "Машинное обучение Azure".

    [![Создание рабочей области](./media/vscode-tools-for-ai/create-workspace.gif)](./media/vscode-tools-for-ai/create-workspace.gif#lightbox)


1. Щелкните правой кнопкой мыши подписку Azure и выберите **Create Workspace** (Создать рабочую область). По умолчанию создается имя, содержащее дату и время создания. Измените имя на **теамворкспаце** и нажмите клавишу ВВОД.

1. Выберите группу ресурсов из списка, если вы хотите выбрать или создать новую. При создании нового выберите расположение, ближайшее к расположению, в котором планируется развернуть модель. В этом случае мы выбрали **Западная часть США 2**.

1. После нажатия клавиши Ввод Машинное обучение Azure получит запрос на создание рабочей области. Вы получите уведомление об этом процессе в области уведомлений Visual Studio Code.

1. Разверните узел подписка, чтобы найти только что созданную рабочую область.

### <a name="create-an-experiment"></a>Создание эксперимента
В рабочей области можно создать один или несколько экспериментов, чтобы отслеживать и анализировать отдельные запуски обучения модели. Запуски можно выполнять в облаке Azure или на локальном компьютере.

1. Разверните рабочую область **теамворкспаце** . Щелкните узел **эксперименты** правой кнопкой мыши и выберите в контекстном меню команду **создать эксперимент** .

1. В командной строке введите имя эксперимента. На снимках экрана примера эксперимент называется **MNIST**.

1. Нажмите клавишу ВВОД, чтобы создать новый эксперимент. Новый эксперимент отображается в дереве в виде дочернего элемента узла **эксперименты** .

1. В рабочей области можно щелкнуть эксперимент, чтобы установить его в качестве **активного** эксперимента. **Активные** ссылки на эксперименты, которые поэкспериментируют в облаке с папкой, открытой в данный момент в Visual Studio Code. В этой папке должны находиться локальные скрипты Python. Установив активный эксперимент, ключевые метрики для всех учебных запусков будут храниться в эксперименте, независимо от того, где они выполняются.

    [![Создание эксперимента](./media/vscode-tools-for-ai/create-experiment.gif)](./media/vscode-tools-for-ai/create-experiment.gif#lightbox)


### <a name="create-and-manage-compute-targets"></a>Создание целевых объектов вычислений и управление ими

С Машинное обучение Azure для Visual Studio Code можно подготавливать данные, обучать модели и развертывать их локально и на удаленных целевых объектах вычислений.

Расширение поддерживает несколько удаленных целевых объектов вычислений для Машинное обучение Azure. Дополнительные сведения см. в полном списке поддерживаемых [целевых объектов вычислений для машинное обучение Azure](how-to-set-up-training-targets.md).

### <a name="create-compute-targets-for-azure-machine-learning-in-visual-studio-code"></a>Создание целевых объектов вычислений для Машинное обучение Azure в Visual Studio Code

Чтобы создать целевой объект вычислений, сделайте следующее:

1. На панели действий Visual Studio Code щелкните значок Azure. Появится боковая панель "Машинное обучение Azure".

1. В представлении в виде дерева разверните подписку Azure и Машинное обучение Azure рабочую область.

1. В узле рабочей области щелкните правой кнопкой мыши узел **Compute** (Вычисления) и выберите **Create Compute** (Создать вычислительный ресурс).

1. Выберите из списка тип целевого объекта вычислений.

1. В командной строке палитры команд выберите размер виртуальной машины. Можно отфильтровать вычисление по тексту, например "GPU".

1. В командной строке палитра команд введите имя целевого объекта вычислений.

1. После ввода имени будет создано вычисление с использованием параметров по умолчанию. Чтобы изменить параметры, щелкните правой кнопкой мыши новое вычисление и выберите команду **изменить вычисление**.

1. В открывшемся JSON внесите необходимые изменения, а затем щелкните CodeLens "сохранить и продолжить" (с помощью клавиатуры можно нажать клавиши CTRL + **SHIFT + p** , чтобы вызвать палитру команд и запустить **Azure ml: Команда "Сохранить** и продолжить")

Ниже приведен пример создания и изменения Машинное обучение Azure вычислений (Амлкомпуте).

[![Создание вычислений AML в Visual Studio Code](./media/vscode-tools-for-ai/create-remote-compute.gif)](./media/vscode-tools-for-ai/create-remote-compute.gif#lightbox)

#### <a name="the-run-configuration-file"></a>Файл конфигурации запуска

Чтобы запустить Машинное обучение Azure эксперимента на вычислений, необходимо соответствующим образом настроить расчеты. Файл конфигурации запуска — это механизм, с помощью которого указана среда.

Ниже приведен пример создания конфигурации запуска для Амлкомпуте, созданной выше.

[![Создание конфигурации запуска для вычислений](./media/vscode-tools-for-ai/create-runconfig.gif)](./media/vscode-tools-for-ai/create-runconfig.gif#lightbox)

Для запуска экспериментов машинного обучения Azure на локальном компьютере файл конфигурации запуска по-прежнему требуется. При создании локальной конфигурации запуска среда Python по умолчанию будет использовать путь к интерпретатору, заданному в VS Code.

### <a name="train-and-tune-models"></a>Обучение и тонкая настройка моделей

Использование расширения машинного обучения Azure для VS Code существует несколько способов запуска сценария обучения в эксперименте.

1. Щелкните правой кнопкой мыши обучающий сценарий и **выберите Azure ml: Запуск от имени эксперимента в Azure**
1. Щелкните значок выполнить эксперимент на панели инструментов.
1. Щелкните узел конфигурации запуска правой кнопкой мыши.
1. Используйте палитру команд VS Code для выполнения **машинного обучения Azure: Запустить эксперимент**

Чтобы запустить Машинное обучение Azure эксперимента, выполните следующие действия.

1. На панели действий Visual Studio Code щелкните значок Azure.

1. В представлении в виде дерева разверните подписку Azure и Машинное обучение Azure рабочую область.

1. В узле Рабочая область разверните узел **эксперименты** и щелкните правой кнопкой мыши эксперимент, который необходимо запустить.

1. Щелкните **Run Experiment** (Выполнить эксперимент).

1. Выберите имя файла Python, который вы хотите запустить для обучения модели, и нажмите клавишу ВВОД, чтобы отправить запрос на запуск. Примечание. Выбранный файл должен находиться в папке, открытой в данный момент в VS Code.

1. После отправки запуска **узел Run (запуск** ) появится под выбранным экспериментом. Этот узел используется для наблюдения за состоянием выполнений. Примечание. Для просмотра последнего состояния может потребоваться периодически обновлять окно.

Ниже приведен пример того, как запустить эксперимент на созданном ранее вычислении.

[![Запуск эксперимента локально](./media/vscode-tools-for-ai/run-experiment.gif)](./media/vscode-tools-for-ai/run-experiment.gif#lightbox)

### <a name="deploy-and-manage-models"></a>Развертывание моделей и управление ими
В Машинное обучение Azure можно развертывать модели машинного обучения и управлять ими в облаке и на границе.

#### <a name="register-your-model-to-azure-machine-learning-from-visual-studio-code"></a>Зарегистрируйте модель для Машинное обучение Azure из Visual Studio Code

Теперь, когда модель обучена, вы можете зарегистрировать ее в рабочей области. Вы можете отслеживание и развертывание зарегистрированных моделей.

Чтобы зарегистрировать модель, выполните следующие действия.

1. На панели действий Visual Studio Code щелкните значок Azure. Появится боковая панель "Машинное обучение Azure".

1. В представлении в виде дерева разверните подписку Azure и Машинное обучение Azure рабочую область.

1. В узле рабочей области щелкните правой кнопкой мыши **Models** (Модели) и выберите **Register Model** (Зарегистрировать модель).

1. В палитре команд в поле введите имя модели.

1. В списке выберите, следует ли передать **файл модели** (для отдельных моделей) или **папку модели** (для моделей с несколькими файлами, например TensorFlow).

1. Выберите папку или файл.

1. После завершения настройки свойств модели в правом нижнем углу окна выберите **Отправить**.

Ниже приведен пример регистрации модели для Машинное обучение Azure.

[![Регистрация модели в AML](./media/vscode-tools-for-ai/register-model.gif)](./media/vscode-tools-for-ai/register-model.gif#lightbox)


#### <a name="deploy-your-service-from-visual-studio-code"></a>Развертывание службы из Visual Studio Code

В Visual Studio Code можно развернуть веб-службу, чтобы:
+ Экземпляры контейнеров Azure (ACI) для тестирования.
+ Служба Azure Kubernetes (AKS) для рабочей среды.

Вам не нужно создавать контейнер ACI для предварительного тестирования, так как контейнеры ACI создаются по мере необходимости. Тем не менее, необходимо заранее настроить кластеры AKS. Дополнительные сведения см. в разделе [Развертывание моделей с помощью машинное обучение Azure](how-to-deploy-and-where.md).

Для развертывания веб-службы выполните следующие действия.

1. На панели действий Visual Studio Code щелкните значок Azure. Появится боковая панель "Машинное обучение Azure".

1. В древовидном представлении разверните подписку Azure и рабочую область Машинное обучение Azure.

1. В узле рабочей области, разверните узел **Models** (Модели).

1. Щелкните правой кнопкой мыши модель, которую необходимо развернуть, и выберите в контекстном меню пункт **развернуть службу из зарегистрированной модели** .

1. В палитре команд выберите целевой объект вычислений, в который требуется выполнить развертывание.

1. В палитре команд в поле введите имя для этой службы.

1. В палитре команд нажмите клавишу ВВОД на клавиатуре, чтобы найти и выбрать файл скрипта.

1. В палитре команд нажмите клавишу ВВОД на клавиатуре, чтобы найти и выбрать файл зависимостей conda.

1. Завершив настройку свойств службы, в правом нижнем углу окна выберите **Отправить** для развертывания. В файле свойств службы можно указать локальный файл DOCKER или файл Schema. JSON.

Теперь веб-служба развернута.

Ниже приведен пример развертывания веб-службы.

[![Развертывание веб-службы](./media/vscode-tools-for-ai/create-image.gif)](./media/vscode-tools-for-ai/create-image.gif#lightbox)

### <a name="experiment-with-additional-features"></a>Поэкспериментируйте с дополнительными функциями

Палитру команд можно использовать для доступа ко многим Машинное обучение Azure функциям в Visual Studio Code. Чтобы вызвать палитру команд, введите Ctrl + Shift + P. Здесь можно найти дополнительные возможности службы "МАШИНное обучение Azure" расширения.

[![Сочетания клавиш для Машинное обучение Azure Visual Studio Code](./media/vscode-tools-for-ai/commands.gif)](./media/vscode-tools-for-ai/commands.gif#lightbox)

## <a name="next-steps"></a>Следующие шаги

* Пошаговое руководство по обучению машинное обучение Azure за пределами Visual Studio Code [см. в разделе Учебник. обучению модели классификации изображений с помощью Службы машинного обучения Azure](tutorial-train-models-with-aml.md).
* Пошаговое руководство по локальному изменению, выполнению и отладке кода см. в [руководстве по использованию Hello World](https://code.visualstudio.com/docs/Python/Python-tutorial).
