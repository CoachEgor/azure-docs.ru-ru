---
title: Корпоративная безопасность
titleSuffix: Azure Machine Learning service
description: 'Безопасное использование службы Машинное обучение Azure: проверка подлинности, авторизация, сетевая безопасность, шифрование данных и мониторинг.'
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: aashishb
author: aashishb
ms.reviewer: larryfr
ms.date: 08/07/2019
ms.openlocfilehash: 510f58cc0b71fb75ac6f5e15fc883c3caf4a8f9a
ms.sourcegitcommit: d3dced0ff3ba8e78d003060d9dafb56763184d69
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2019
ms.locfileid: "69897986"
---
# <a name="enterprise-security-for-azure-machine-learning-service"></a>Корпоративная безопасность для службы Машинное обучение Azure

В этой статье вы узнаете о функциях безопасности, доступных в службе "машинное обучение Azure".

При использовании облачной службы рекомендуется ограничить доступ только тем пользователям, которым она нужна. Это начинается с понимания модели проверки подлинности и авторизации, используемой службой. Вам также может потребоваться ограничить доступ к сети или безопасно присоединять ресурсы в локальной сети с облаком. Шифрование данных также является жизненно важным, как неактивных, так и при перемещении данных между службами. Наконец, необходимо иметь возможность отслеживать службу и создавать журнал аудита всех действий.

## <a name="authentication"></a>Проверка подлинности

Многофакторная проверка подлинности поддерживается, если Azure Active Directory (Azure AD) настроен для этого.

* Клиент регистрируется в Azure AD и получает маркер Azure Resource Manager.  Пользователи и субъекты-службы поддерживаются полностью.
* Клиент предоставляет маркер для Azure Resource Manager & всех Машинное обучение Azure служб
* Служба Машинное обучение Azure предоставляет маркер Машинное обучение Azure для пользовательского вычислений. Например, Вычислительная среда Машинного обучения. Этот маркер используется пользователем для выполнения обратного вызова в службу Машинное обучение Azure (ограничивает область до рабочей области) после завершения выполнения.

[![Снимок экрана, показывающий, как работает проверка подлинности в службе Машинное обучение Azure](./media/enterprise-readiness/authentication.png)](./media/enterprise-readiness/authentication-expanded.png)

### <a name="authentication-for-web-service-deployment"></a>Проверка подлинности для развертывания веб-службы

Машинное обучение Azure поддерживает две формы проверки подлинности для веб-служб, ключей и маркеров. Каждая WebService может одновременно включать только одну форму проверки подлинности.

|Способ проверки подлинности|ACI|AKS|
|---|---|---|
|Ключ|Отключено по умолчанию| Включено по умолчанию|
|Токен| Недоступен| Отключено по умолчанию |

#### <a name="authentication-with-keys"></a>Проверка подлинности с помощью ключей

При включении проверки подлинности ключа для развертывания автоматически создаются ключи проверки подлинности.

* Проверка подлинности включена по умолчанию при развертывании в Службе Azure Kubernetes.
* Проверка подлинности отключена по умолчанию при развертывании в Экземплярах контейнеров Azure.

Чтобы включить проверку подлинности ключей `auth_enabled` , используйте параметр при создании или обновлении развертывания.

Если включена проверка подлинности ключа, можно использовать `get_keys` метод для получения первичного и вторичного ключа проверки подлинности:

```python
primary, secondary = service.get_keys()
print(primary)
```

> [!IMPORTANT]
> Если необходимо повторно создать ключ, используйте[`service.regen_key`](https://docs.microsoft.com/python/api/azureml-core/azureml.core.webservice(class)?view=azure-ml-py)

#### <a name="authentication-with-tokens"></a>Аутентификация с помощью токенов

При включении проверки подлинности с помощью маркеров для веб-службы пользователь должен предоставить веб-службе Машинное обучение Azure JSON Web Token для доступа к ней.

* При развертывании в службе Kubernetes Azure проверка подлинности по маркеру отключена по умолчанию.
* При развертывании в службе "экземпляры контейнеров Azure" Проверка подлинности с помощью маркеров не поддерживается.

Чтобы управлять проверкой подлинности `token_auth_enabled` на маркере, используйте параметр при создании или обновлении развертывания.

Если включена проверка подлинности токенов, можно `get_token` использовать метод для получения маркера JWT и срока действия маркера:

```python
token, refresh_by = service.get_token()
print(token)
```

> [!IMPORTANT]
> После `refresh_by` времени маркера потребуется запросить новый токен.
>
> Мы настоятельно рекомендуем создать рабочую область Машинное обучение Azure в том же регионе, что и кластер службы Azure Kubernetes. Для проверки подлинности с помощью маркера веб-служба выполнит вызов региона, в котором создана Рабочая область Машинное обучение Azure. Если регион рабочей области недоступен, вы не сможете получить маркер для веб-службы даже в том случае, если кластер находится в регионе, отличном от региона рабочей области. Это фактически приводит к недоступности аутентификация Azure AD, пока регион рабочей области не будет снова доступен. Кроме того, чем больше расстояние между регионом кластера и регионом рабочей области, тем дольше будет получена лексема.

## <a name="authorization"></a>Authorization

Вы можете создать несколько рабочих областей, и каждая рабочая область может совместно использоваться несколькими пользователями. При совместном использовании рабочей области вы управляете доступом к ней путем назначения пользователям следующих ролей:

* Ответственный
* участник;
* Читатель

В следующей таблице перечислены некоторые основные операции службы Машинное обучение Azure и роли, которые могут их выполнять.

| Операция службы Машинное обучение Azure | Ответственный | участник; | Читатель |
| ---- |:----:|:----:|:----:|
| Создать рабочую область | ✓ | ✓ | |
| Общий доступ к рабочей области | ✓ | |  |
| Создание вычислений | ✓ | ✓ | |
| Присоединить вычислений | ✓ | ✓ | |
| Присоединение хранилищ данных | ✓ | ✓ | |
| Запуск эксперимента | ✓ | ✓ | |
| Просмотр запусков и метрик | ✓ | ✓ | ✓ |
| Регистрация модели | ✓ | ✓ | |
| Создание образа | ✓ | ✓ | |
| Развертывание веб-службы | ✓ | ✓ | |
| Просмотр моделей и изображений | ✓ | ✓ | ✓ |
| Вызвать веб-службу | ✓ | ✓ | ✓ |

Если встроенные роли недостаточны для ваших нужд, можно также создать пользовательские роли. Поддерживаются только пользовательские роли для операций в рабочей области и Вычислительная среда Машинного обучения. Пользовательские роли могут иметь разрешения на чтение, запись или удаление в рабочей области и ресурсе вычислений в этой рабочей области. Роль можно сделать доступной на определенном уровне рабочей области, определенном уровне группы ресурсов или определенном уровне подписки. Дополнительные сведения см. [в статье Manage Users and Roles in a машинное обучение Azure Workspace](how-to-assign-roles.md) .

### <a name="securing-compute-and-data"></a>Обеспечение безопасности вычислений и данных

Владельцы и участники могут использовать все целевые объекты вычислений и хранилища данных, подключенные к рабочей области.  
Каждая Рабочая область также имеет связанное с системой управляемое удостоверение (с тем же именем, что и Рабочая область) со следующими разрешениями для подключенных ресурсов, используемых в рабочей области:

Дополнительные сведения об управляемых удостоверениях см. в статье [управляемые удостоверения для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview) .

| Resource | Разрешения |
| ----- | ----- |
| Рабочая область | Участник |
| Учетная запись хранения | Участник данных BLOB-объекта хранилища |
| Key Vault | Доступ ко всем ключам, секретам, сертификатам |
| Реестр контейнеров Azure | Участник |
| Группа ресурсов, содержащая рабочую область | Участник |
| Группа ресурсов, содержащая Key Vault (если она отличается от той, которая содержит рабочую область) | Участник |

Администраторам рекомендуется не отменять доступ управляемого удостоверения к упомянутым выше ресурсам. Доступ можно восстановить с помощью операции повторной синхронизации ключей.

Машинное обучение Azure служба создает дополнительное приложение (имя начинается с `aml-`) с доступом на уровне участника в подписке для каждого региона рабочей области. Для ex Если у вас есть рабочая область в восточной части США и другая рабочая область в Северной Европе в той же подписке, вы увидите два таких приложения. Это необходимо, чтобы служба Машинное обучение Azure могла помочь в управлении ресурсами вычислений.

## <a name="network-security"></a>Безопасность сети

Служба машинного обучения Azure использует вычислительные ресурсы других служб Azure. Вычислительные ресурсы (целевые объекты вычислений) используются для обучения и развертывания моделей. Эти целевые объекты вычислений могут создаваться в виртуальной сети. Например, вы можете обучить модель с помощью Виртуальной машины обработки и анализа данных корпорации Майкрософт, а затем развернуть модель в Службе Azure Kubernetes (AKS).  

Дополнительные сведения см. в разделе [как выполнять эксперименты и вывод в виртуальной сети](how-to-enable-virtual-network.md).

## <a name="data-encryption"></a>Шифрование данных

### <a name="encryption-at-rest"></a>Шифрование при хранении

#### <a name="azure-blob-storage"></a>Хранилище BLOB-объектов Azure

Служба Машинное обучение Azure хранит моментальные снимки, выходные данные и журналы в учетной записи хранилища BLOB-объектов Azure, привязанной к рабочей области службы Машинное обучение Azure, и находится в подписке пользователя. Все данные, хранящиеся в хранилище BLOB-объектов Azure, шифруются при хранении с помощью ключей, управляемых корпорацией Майкрософт.

Дополнительные сведения о том, как использовать собственные ключи для хранения данных, хранящихся в хранилище BLOB-объектов Azure, см. [в разделе Шифрование службы хранилища использование управляемых клиентом ключей в Azure Key Vault](https://docs.microsoft.com/azure/storage/common/storage-service-encryption-customer-managed-keys).

Обучающие данные, как правило, хранятся в хранилище BLOB-объектов Azure, чтобы они были доступны для обучения. Это хранилище не управляется Машинное обучение Azure но подключено для вычислений как Удаленная файловая система.

Сведения о повторном создании ключей доступа для учетных записей хранения Azure, используемых в рабочей области, см. в статье [Повторное создание ключей доступа к хранилищу](how-to-change-storage-access-key.md) .

#### <a name="cosmos-db"></a>Cosmos DB

Службы Машинное обучение Azure хранят метрики и метаданные в Cosmos DB, который находится в подписке Майкрософт, управляемой Машинное обучение Azure службой. Все данные, хранящиеся в Cosmos DB, шифруются при хранении с помощью ключей, управляемых корпорацией Майкрософт.

#### <a name="azure-container-registry-acr"></a>Реестр контейнеров Azure (запись контроля доступа)

Все образы контейнеров в реестре (записи контроля доступа) шифруются при хранении. Azure автоматически шифрует образ перед сохранением и расшифровывает его на лету, когда Машинное обучение Azure служба извлекает образ.

#### <a name="machine-learning-compute"></a>Вычислительная среда Машинного обучения

Диск операционной системы для каждого расчетного узла хранится в службе хранилища Azure с помощью ключей, управляемых корпорацией Майкрософт, в учетных записях хранения служб Машинное обучение Azure. Этот целевой объект вычислений является эфемерным, и кластеры, как правило, масштабируются, если нет запущенных в очереди. Базовая виртуальная машина не подготовлена и диск ОС удален. Шифрование дисков Azure не поддерживается для диска операционной системы.
Каждая виртуальная машина также имеет локальный временный диск для операций операционной системы. Диск можно также использовать для размещения обучающих данных. Диск не зашифрован.
Дополнительные сведения о том, как работает шифрование при работе в Azure, см. в статье шифрование неактивных [данных](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest)в Azure.

### <a name="encryption-in-transit"></a>Шифрование при передаче

С помощью SSL поддерживается как внутренний обмен данными между различными Машинное обучение Azure микрослужб, так и внешним обменом вызовом конечной точки оценки. Все доступ к хранилищу Azure также осуществляется по безопасному каналу.
Дополнительные сведения см. в статье [защита машинное обучение Azure веб-служб с помощью SSL](https://docs.microsoft.com/azure/machine-learning/service/how-to-secure-web-service).

### <a name="using-azure-key-vault"></a>Использование Azure Key Vault

Key Vault экземпляр, связанный с рабочей областью, используется службой Машинное обучение Azure для хранения учетных данных различных типов:

* Строка подключения связанной учетной записи хранения
* Пароли для экземпляров репозитория контейнеров Azure
* Строки подключения к хранилищам данных.

Пароли и ключи SSH для целевых объектов вычислений, таких как HDI HDInsight и VM, хранятся в отдельном Key Vault, связанном с подпиской Майкрософт. Машинное обучение Azure служба не сохраняет пароли или ключи, предоставленные пользователем, а создает, авторизует и сохраняет свои собственные ключи SSH для подключения к виртуальной машине или HDInsight для выполнения экспериментов.
Каждой рабочей области назначено связанное с системой управляемое удостоверение (с тем же именем, что и у рабочей области), которое имеет доступ ко всем ключам, секретам и сертификатам в Key Vault.

## <a name="monitoring"></a>Отслеживание

### <a name="metrics"></a>metrics

Метрики Azure Monitor можно использовать для просмотра и мониторинга метрик для рабочей области службы Машинное обучение Azure. В [портал Azure](https://portal.azure.com)выберите рабочую область, а затем щелкните ссылку __метрики__ .

[![Снимок экрана с примерами метрик для рабочей области](./media/enterprise-readiness/workspace-metrics.png)](./media/enterprise-readiness/workspace-metrics-expanded.png)

Метрики включают сведения о запусках, развертываниях и регистрациях.

Дополнительные сведения см. [в разделе метрики в Azure Monitor](/azure/azure-monitor/platform/data-platform-metrics).

### <a name="activity-log"></a>Журнал действий

Вы можете просмотреть журнал действий в рабочей области, чтобы просмотреть различные операции, выполняемые в рабочей области, и получить основные сведения, такие как имя операции, событие, инициированное, отметка времени и т. д.

На следующем снимке экрана показан журнал действий для рабочей области.

[![Снимок экрана, показывающий журнал действий в рабочей области](./media/enterprise-readiness/workspace-activity-log.png)](./media/enterprise-readiness/workspace-activity-log-expanded.png)

Сведения о запросе оценки хранятся в Application Insights, которое создается в подписке пользователя при создании рабочей области. Записанные в журнал данные включают такие поля, как HTTPMethod, UserAgent, Компутетипе, RequestUrl, StatusCode, RequestId, Duration и т. д.

> [!IMPORTANT]
> Некоторые действия в рабочей области Машинное обучение Azure не заводят данные в журнал действий. Например, запуск обучения или регистрация модели.
>
> Некоторые из этих действий отображаются в области __действия__ рабочей области, однако они не указывают, кто инициировал действие.

## <a name="data-flow-diagram"></a>Схема потока данных

### <a name="create-workspace"></a>Создать рабочую область

На следующей схеме показан рабочий процесс создание рабочей области.
Пользователь входит в Azure AD с любого поддерживаемого Машинное обучение Azure клиентов службы (CLI, пакет SDK для Python, портал Azure) и запрашивает соответствующий маркер Azure Resource Manager. Затем пользователь вызывает Azure Resource Manager, чтобы создать рабочую область.  Azure Resource Manager связывается с поставщиком ресурсов службы Машинное обучение Azure, чтобы подготавливать рабочую область.  Во время создания рабочей области в подписке клиента создаются дополнительные ресурсы:

* KeyVault (для хранения секретов)
* Учетная запись хранения Azure (включая большие двоичные объекты & общая папка)
* Реестр контейнеров Azure (для хранения образов DOCKER для определения/оценки и экспериментирования)
* Application Insights (для хранения данных телеметрии)

Другие расчеты, присоединенные к рабочей области (служба Kubernetes Azure, виртуальная машина и т. д.), также могут быть подготовлены клиентами по мере необходимости.

[![Снимок экрана: создание рабочего процесса рабочей области](./media/enterprise-readiness/create-workspace.png)](./media/enterprise-readiness/create-workspace-expanded.png)

### <a name="save-source-code-training-scripts"></a>Сохранить исходный код (обучающие сценарии)

На следующей диаграмме показан рабочий процесс моментального снимка кода.
Связанная с рабочей областью службы Машинное обучение Azure — это каталоги (эксперименты), которые содержат исходный код (обучающие скрипты).  Эти сценарии хранятся на локальном компьютере клиента и в облаке (в хранилище BLOB-объектов Azure в подписке клиента). Моментальные снимки кода используются для выполнения или проверки исторического аудита.

[![Снимок экрана: создание рабочего процесса рабочей области](./media/enterprise-readiness/code-snapshot.png)](./media/enterprise-readiness/code-snapshot-expanded.png)

### <a name="training"></a>Обучение

На следующей схеме показан рабочий процесс обучения.

* Машинное обучение Azure служба вызывается с ИДЕНТИФИКАТОРом моментального снимка для моментального снимка кода, сохраненного выше
* Машинное обучение Azure служба создает идентификатор запуска (необязательно) & Машинное обучение Azure токена службы, который позже используется целевыми объектами вычислений, такими как Вычислительная среда Машинного обучения/VM для обратного взаимодействия с Машинное обучение Azure службой.
* Можно выбрать либо управляемое вычисление (например, Вычислительная среда Машинного обучения) или неуправляемое вычисление (например, Виртуальная машина) для выполнения заданий обучения. Поток данных объясняется в обоих сценариях ниже.
* (Виртуальная машина/HDInsight — доступ с использованием учетных средств SSH в Key Vault в подписке Майкрософт) Машинное обучение Azure служба запускает код управления в целевом объекте вычислений, который:

   1. Подготавливает среду. (DOCKER также является вариантом для виртуальных машин и локальной виртуальной машины. Чтобы понять, как работает эксперимент в контейнере DOCKER, ознакомьтесь со следующими шагами: Вычислительная среда Машинного обучения.)
   1. Скачивает код.
   1. Настраивает переменные среды и конфигурации.
   1. Запускает пользовательский скрипт (моментальный снимок кода, упомянутый выше).

* (Вычислительная среда Машинного обучения — доступ с использованием удостоверения, управляемого рабочей областью) Поскольку Вычислительная среда Машинного обучения является управляемым вычислением, управляемым Майкрософт, в результате он выполняется в рамках подписки Майкрософт.

   1. При необходимости начинается Удаленная конструкция DOCKER.
   1. Записывает код управления в общую папку пользователя Azure.
   1. Запускает контейнер с начальной командой, то есть кодом управления, как описано в предыдущем шаге.

#### <a name="querying-runs-and-metrics"></a>Запросы на запуски и метрики

Этот шаг показан в последовательности, в которой обучающие данные записывают *метрики запуска* обратно в машинное обучение Azureную службу, из которой они хранятся в Cosmos DB. Клиенты могут вызвать службу Машинное обучение Azure, которая в свою очередь будет получать метрики из Cosmos DB и вернуть ее обратно клиенту.

[![Снимок экрана: создание рабочего процесса рабочей области](./media/enterprise-readiness/training-and-metrics.png)](./media/enterprise-readiness/training-and-metrics-expanded.png)

### <a name="creating-web-services"></a>Создание веб-служб

На следующей диаграмме показан рабочий процесс определения. Вывод или оценка модели — это этап, в котором развернутая модель используется для прогнозирования, чаще всего в рабочих данных.
Подробные сведения см. ниже:

* Пользователь регистрирует модель с помощью клиента, например пакета SDK для машинного обучения Azure
* Пользователь создает образ с помощью модели, файла оценки и других зависимостей модели.
* Образ DOCKER создается и сохраняется в записи контроля доступа
* WebService развертывается на целевом объекте вычислений (ACI/AKS) с помощью созданного выше образа
* Сведения о запросе оценки хранятся в Application Insights, которое находится в подписке пользователя.
* Данные телеметрии также отправляются в подписку Microsoft или Azure.

[![Снимок экрана: создание рабочего процесса рабочей области](./media/enterprise-readiness/inferencing.png)](./media/enterprise-readiness/inferencing-expanded.png)

## <a name="next-steps"></a>Следующие шаги

* [Защита веб-служб Машинного обучения Azure с помощью SSL](how-to-secure-web-service.md)
* [Использование модели Машинного обучения Azure, развернутой в качестве веб-службы](how-to-consume-web-service.md)
* [Run batch predictions on large data sets with Azure Machine Learning service](how-to-run-batch-predictions.md) (Составление пакетных прогнозов для больших наборов данных с помощью Службы машинного обучения Azure)
* [Мониторинг моделей машинного обучения в Azure с помощью Application Insights](how-to-enable-app-insights.md)
* [Сбор данных для моделей в рабочей среде](how-to-enable-data-collection.md)
* [What is the Azure Machine Learning SDK for Python?](https://docs.microsoft.com/python/api/overview/azure/ml/intro?view=azure-ml-py) (Что такое пакет SDK Службы машинного обучения Azure для Python?)
* [Securely run experiments and inferencing inside an Azure Virtual Network](how-to-enable-virtual-network.md) (Безопасное выполнение экспериментов и формирование выводов внутри виртуальной сети Azure)
* [Recommenders](https://github.com/Microsoft/Recommenders) (Системы рекомендаций)
* [Создание API рекомендаций в режиме реального времени в Azure](https://docs.microsoft.com/azure/architecture/reference-architectures/ai/real-time-recommendation)
