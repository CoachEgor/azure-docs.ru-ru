---
title: Корпоративная безопасность
titleSuffix: Azure Machine Learning
description: 'Безопасно используйте Машинное обучение Azure: Аутентификация, авторизация, безопасность сети, шифрование данных и мониторинг.'
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: aashishb
author: aashishb
ms.reviewer: larryfr
ms.date: 08/07/2019
ms.openlocfilehash: 309cef6ec058d8192bc7a6341b49a59c0000a305
ms.sourcegitcommit: 0fab4c4f2940e4c7b2ac5a93fcc52d2d5f7ff367
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/17/2019
ms.locfileid: "71035560"
---
# <a name="enterprise-security-for-azure-machine-learning"></a>Корпоративная безопасность для Машинное обучение Azure

В этой статье вы узнаете о функциях безопасности, доступных для Машинное обучение Azure.

При использовании облачной службы рекомендуется ограничить доступ только тем пользователям, которым она нужна. Начните с понимания модели проверки подлинности и авторизации, используемой службой. Вам также может потребоваться ограничить сетевой доступ или безопасно присоединять ресурсы в локальной сети с облаком. Шифрование данных также крайне важно, как при хранении, так и при перемещении данных между службами. Наконец, необходимо иметь возможность отслеживать службу и создавать журнал аудита всех действий.

## <a name="authentication"></a>Проверка подлинности

Многофакторная проверка подлинности поддерживается, если Azure Active Directory (Azure AD) настроен для использования. Ниже приведен процесс проверки подлинности.

1. Клиент входит в Azure AD и получает маркер Azure Resource Manager.  Пользователи и субъекты-службы поддерживаются полностью.
1. Клиент предоставляет маркер для Azure Resource Manager и для всех Машинное обучение Azure.
1. Служба Машинное обучение предоставляет маркер службы Машинное обучение для целевого объекта вычислений пользователя (например, Вычислительная среда Машинного обучения). Этот маркер используется целевым объектом вычислений пользователя для обратного вызова в службу Машинное обучение после завершения выполнения. Область ограничена рабочей областью.

[![Проверка подлинности в Машинное обучение Azure](./media/enterprise-readiness/authentication.png)](./media/enterprise-readiness/authentication-expanded.png)

### <a name="authentication-for-web-service-deployment"></a>Проверка подлинности для развертывания веб-службы

Машинное обучение Azure поддерживает две формы проверки подлинности для веб-служб: ключ и маркер. Каждая веб-служба в каждый момент времени может включать только одну форму проверки подлинности.

|Способ проверки подлинности|Экземпляры контейнеров Azure|AKS|
|---|---|---|
|Ключ|Отключено по умолчанию| Включено по умолчанию|
|Токен| Недоступен| Отключено по умолчанию |

#### <a name="authentication-with-keys"></a>Проверка подлинности с помощью ключей

При включении проверки подлинности ключа для развертывания автоматически создаются ключи проверки подлинности.

* Проверка подлинности включена по умолчанию при развертывании в службе Azure Kubernetes Service (AKS).
* При развертывании в службе "экземпляры контейнеров Azure" Проверка подлинности отключена по умолчанию.

Чтобы включить проверку подлинности ключей `auth_enabled` , используйте параметр при создании или обновлении развертывания.

Если включена проверка подлинности ключа, можно использовать `get_keys` метод для получения первичного и вторичного ключа проверки подлинности:

```python
primary, secondary = service.get_keys()
print(primary)
```

> [!IMPORTANT]
> Если вам нужно повторно создать ключ, используйте [`service.regen_key`](https://docs.microsoft.com/python/api/azureml-core/azureml.core.webservice(class)?view=azure-ml-py).

#### <a name="authentication-with-tokens"></a>Аутентификация с помощью токенов

При включении проверки подлинности с помощью маркеров для веб-службы пользователи должны предоставить веб-службе Машинное обучение Azure JSON Web Token для доступа к ней.

* При развертывании в службе Kubernetes Azure проверка подлинности по маркеру отключена по умолчанию.
* Проверка подлинности с помощью маркеров не поддерживается при развертывании в службе "экземпляры контейнеров Azure".

Чтобы управлять проверкой подлинности `token_auth_enabled` на маркере, используйте параметр при создании или обновлении развертывания.

Если включена проверка подлинности маркеров, можно использовать `get_token` метод для получения JSON Web Token (JWT) и срока действия маркера:

```python
token, refresh_by = service.get_token()
print(token)
```

> [!IMPORTANT]
> После `refresh_by` времени маркера необходимо запросить новый токен.
>
> Настоятельно рекомендуется создать рабочую область Машинное обучение Azure в том же регионе, что и кластер службы Azure Kubernetes. 
>
> Для проверки подлинности с помощью маркера веб-служба выполнит вызов региона, в котором создана Рабочая область Машинное обучение Azure. Если регион рабочей области недоступен, вы не сможете получить маркер для веб-службы, даже если ваш кластер находится в другом регионе из рабочей области. В результате аутентификация Azure AD недоступна, пока регион рабочей области не будет снова доступен. 
>
> Кроме того, чем больше расстояние между регионом кластера и регионом рабочей области, тем дольше будет получена лексема.

## <a name="authorization"></a>Authorization

Вы можете создать несколько рабочих областей, и каждая рабочая область может совместно использоваться несколькими пользователями. Когда вы предоставляете общий доступ к рабочей области, вы можете управлять доступом к ней, назначая пользователям следующие роли:

* Ответственный
* участник;
* Читатель

В следующей таблице перечислены некоторые основные операции Машинное обучение Azure и роли, которые могут их выполнять.

| Машинное обучение Azure операция | Ответственный | участник; | Читатель |
| ---- |:----:|:----:|:----:|
| Создать рабочую область | ✓ | ✓ | |
| Общая рабочая область | ✓ | |  |
| Создание целевого объекта вычислений | ✓ | ✓ | |
| Присоединить целевой объект вычислений | ✓ | ✓ | |
| Подключение хранилищ данных | ✓ | ✓ | |
| Выполнение эксперимента | ✓ | ✓ | |
| Просмотр запусков и метрик | ✓ | ✓ | ✓ |
| Регистрация модели | ✓ | ✓ | |
| Создание образа | ✓ | ✓ | |
| Развертывание веб-службы | ✓ | ✓ | |
| Просмотр моделей и изображений | ✓ | ✓ | ✓ |
| Вызвать веб-службу | ✓ | ✓ | ✓ |

Если встроенные роли не соответствуют вашим потребностям, можно создать пользовательские роли. Пользовательские роли поддерживаются только для операций в рабочей области и Вычислительная среда Машинного обучения. Пользовательские роли могут иметь разрешения на чтение, запись или удаление в рабочей области и на ресурсе вычислений в этой рабочей области. Роль можно сделать доступной на определенном уровне рабочей области, определенном уровне группы ресурсов или определенном уровне подписки. Дополнительные сведения см. [в статье Manage Users and Roles in a машинное обучение Azure Workspace](how-to-assign-roles.md).

### <a name="securing-compute-targets-and-data"></a>Обеспечение безопасности целевых объектов вычислений и данных

Владельцы и участники могут использовать все целевые объекты вычислений и хранилища данных, подключенные к рабочей области.  

Каждая Рабочая область также имеет связанное с системой управляемое удостоверение, которое имеет то же имя, что и Рабочая область. Управляемое удостоверение имеет следующие разрешения для подключенных ресурсов, используемых в рабочей области.

Дополнительные сведения об управляемых удостоверениях см. в статье [управляемые удостоверения для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview).

| Resource | Разрешения |
| ----- | ----- |
| Рабочая область | Участник |
| Учетная запись хранения | Участник данных BLOB-объекта хранилища |
| Хранилище ключей | Доступ ко всем ключам, секретам, сертификатам |
| Реестр контейнеров Azure | Участник |
| Группа ресурсов, содержащая рабочую область | Участник |
| Группа ресурсов, содержащая хранилище ключей (если оно отличается от того, в котором находится рабочая область) | Участник |

Не рекомендуется, чтобы администраторы отменяют доступ управляемого удостоверения к ресурсам, упомянутым в предыдущей таблице. Вы можете восстановить доступ с помощью операции повторной синхронизации ключей.

Машинное обучение Azure создает дополнительное приложение (имя начинается с `aml-` или `Microsoft-AzureML-Support-App-`) с доступом на уровне участника в подписке для каждого региона рабочей области. Например, если у вас есть одна рабочая область в восточной части США и другая рабочая область в Северной Европе в той же подписке, вы увидите два из этих приложений. Эти приложения позволяют Машинное обучение Azure, помогающие управлять ресурсами вычислений.

## <a name="network-security"></a>Безопасность сети

Машинное обучение Azure полагается на другие службы Azure для ресурсов вычислений. Вычислительные ресурсы (целевые объекты вычислений) используются для обучения и развертывания моделей. Эти целевые объекты вычислений можно создать в виртуальной сети. Например, можно использовать виртуальную машину Azure для обработки и анализа данных, чтобы обучить модель, а затем развернуть ее в AKS.  

Дополнительные сведения см. в разделе [как выполнять эксперименты и вывод в виртуальной сети](how-to-enable-virtual-network.md).

## <a name="data-encryption"></a>Шифрование данных

### <a name="encryption-at-rest"></a>Шифрование при хранении

#### <a name="azure-blob-storage"></a>Хранилище BLOB-объектов Azure

Машинное обучение Azure сохраняет моментальные снимки, выходные данные и журналы в учетной записи хранилища BLOB-объектов Azure, привязанной к рабочей области Машинное обучение Azure и вашей подписке. Все данные, хранящиеся в хранилище BLOB-объектов Azure, шифруются при хранении с помощью ключей, управляемых корпорацией Майкрософт.

Сведения о том, как использовать собственные ключи для хранения данных, хранящихся в хранилище BLOB-объектов Azure, см. [в разделе Шифрование службы хранилища Azure с помощью ключей, управляемых клиентом, в Azure Key Vault](https://docs.microsoft.com/azure/storage/common/storage-service-encryption-customer-managed-keys).

Обучающие данные, как правило, также хранятся в хранилище BLOB-объектов Azure, чтобы они были доступны для обучения целевых объектов вычислений. Это хранилище не управляется Машинное обучение Azure но подключено к целевым объектам вычислений как удаленную файловую систему.

Сведения о повторном создании ключей доступа для учетных записей хранения Azure, используемых в рабочей области, см. в разделе [Повторное создание ключей доступа к хранилищу](how-to-change-storage-access-key.md).

#### <a name="azure-cosmos-db"></a>Azure Cosmos DB

Машинное обучение Azure сохраняет метрики и метаданные в экземпляре Azure Cosmos DB, связанном с подпиской Майкрософт, управляемой Машинное обучение Azure. Все данные, хранящиеся в Azure Cosmos DB, шифруются при хранении с помощью ключей, управляемых корпорацией Майкрософт.

#### <a name="azure-container-registry"></a>Реестр контейнеров Azure

Все образы контейнеров в реестре (реестр контейнеров Azure) шифруются при хранении. Azure автоматически шифрует образ перед сохранением и расшифровывает его на лету, когда Машинное обучение Azure извлекает образ.

#### <a name="machine-learning-compute"></a>Вычислительная среда Машинного обучения

Диск операционной системы для каждого расчетного узла, хранящегося в службе хранилища Azure, шифруется с помощью ключей, управляемых корпорацией Майкрософт, в Машинное обучение Azure учетных записях хранения. Этот целевой объект вычислений является эфемерным, и кластеры, как правило, масштабируются вниз, если в очереди нет запусков. Базовая виртуальная машина не подготавливается, и диск ОС удаляется. Шифрование дисков Azure не поддерживается для диска ОС.

Каждая виртуальная машина также имеет локальный временный диск для операций операционной системы. При необходимости можно использовать диск для размещения обучающих данных. Диск не зашифрован.
Дополнительные сведения о том, как работает шифрование при работе в Azure, см. в статье [Шифрование неактивных данных](https://docs.microsoft.com/azure/security/fundamentals/encryption-atrest)в Azure.

### <a name="encryption-in-transit"></a>Шифрование при передаче

SSL можно использовать для защиты внутренней связи между Машинное обучение Azure микрослужбами и для защиты внешних вызовов конечной точки оценки. Все доступ к хранилищу Azure также осуществляется по безопасному каналу.

Дополнительные сведения см. [в статье Использование SSL для защиты веб-службы с помощью машинное обучение Azure](https://docs.microsoft.com/azure/machine-learning/service/how-to-secure-web-service).

### <a name="using-azure-key-vault"></a>Использование Azure Key Vault

Машинное обучение Azure использует экземпляр Azure Key Vault, связанный с рабочей областью, для хранения учетных данных различных типов:

* Строка подключения связанной учетной записи хранения
* Пароли для экземпляров репозитория контейнеров Azure
* Строки подключения к хранилищам данных

Пароли и ключи SSH для целевых вычислений, таких как Azure HDInsight и виртуальные машины, хранятся в отдельном хранилище ключей, связанном с подпиской Майкрософт. Машинное обучение Azure не хранит пароли или ключи, предоставленные пользователями. Вместо этого он создает, авторизует и сохраняет собственные ключи SSH для подключения к виртуальным машинам и HDInsight для выполнения экспериментов.

С каждой рабочей областью связано управляемое системное удостоверение с тем же именем, что и у рабочей области. Это управляемое удостоверение имеет доступ ко всем ключам, секретам и сертификатам в хранилище ключей.

## <a name="monitoring"></a>Отслеживание

### <a name="metrics"></a>metrics

Вы можете использовать метрики Azure Monitor, чтобы просматривать и отслеживать метрики для рабочей области Машинное обучение Azure. В [портал Azure](https://portal.azure.com)выберите рабочую область, а затем щелкните **метрики**:

[![Снимок экрана с примерами метрик для рабочей области](./media/enterprise-readiness/workspace-metrics.png)](./media/enterprise-readiness/workspace-metrics-expanded.png)

Метрики включают сведения о запусках, развертываниях и регистрациях.

Дополнительные сведения см. [в разделе метрики в Azure Monitor](/azure/azure-monitor/platform/data-platform-metrics).

### <a name="activity-log"></a>Журнал действий

Вы можете просмотреть журнал действий рабочей области, чтобы просмотреть различные операции, выполняемые в рабочей области. Журнал содержит основные сведения, такие как имя операции, инициатор события и отметка времени.

На этом снимке экрана показан журнал действий рабочей области.

[![Снимок экрана, показывающий журнал действий рабочей области](./media/enterprise-readiness/workspace-activity-log.png)](./media/enterprise-readiness/workspace-activity-log-expanded.png)

Сведения о запросе оценки хранятся в Application Insights. Application Insights создается в подписке при создании рабочей области. Записанные в журнал данные включают такие поля, как HTTPMethod, UserAgent, Компутетипе, RequestUrl, StatusCode, RequestId и Duration.

> [!IMPORTANT]
> Некоторые действия в рабочей области Машинное обучение Azure не заводят данные в журнал действий. Например, запуск обучающего запуска и регистрация модели не регистрируются.
>
> Некоторые из этих действий отображаются в области **действия** рабочей области, но эти уведомления не указывают, кто инициировал действие.

## <a name="data-flow-diagrams"></a>Схемы потоков данных

### <a name="create-workspace"></a>Создать рабочую область

На следующей схеме показан рабочий процесс создание рабочей области.

* Пользователь входит в Azure AD из одного из поддерживаемых Машинное обучение Azure клиентов (Azure CLI, пакета SDK для Python портал Azure) и запрашивает соответствующий маркер Azure Resource Manager.
* Пользователь вызывает Azure Resource Manager, чтобы создать рабочую область. 
* Azure Resource Manager обращается к поставщику ресурсов Машинное обучение Azure, чтобы подготавливать рабочую область.

Во время создания рабочей области в подписке пользователя создаются дополнительные ресурсы:

* Key Vault (для хранения секретов)
* Учетная запись хранения Azure (включая большой двоичный объект и файловый ресурс)
* Реестр контейнеров Azure (для хранения образов DOCKER для определения/оценки и экспериментирования)
* Application Insights (для хранения данных телеметрии)

При необходимости пользователь может также подготавливать другие целевые объекты вычислений, подключенные к рабочей области (например, службу Kubernetes Azure или виртуальные машины).

[![Создание рабочего процесса рабочей области](./media/enterprise-readiness/create-workspace.png)](./media/enterprise-readiness/create-workspace-expanded.png)

### <a name="save-source-code-training-scripts"></a>Сохранить исходный код (обучающие сценарии)

На следующей диаграмме показан рабочий процесс моментального снимка кода.

Связанная с рабочей областью Машинное обучение Azure — это каталоги (эксперименты), которые содержат исходный код (обучающие скрипты). Эти сценарии хранятся на локальном компьютере и в облаке (в хранилище BLOB-объектов Azure для вашей подписки). Моментальные снимки кода используются для выполнения или проверки исторического аудита.

[![Рабочий процесс моментального снимка кода](./media/enterprise-readiness/code-snapshot.png)](./media/enterprise-readiness/code-snapshot-expanded.png)

### <a name="training"></a>Обучение

На следующей схеме показан рабочий процесс обучения.

* Машинное обучение Azure вызывается с ИДЕНТИФИКАТОРом моментального снимка для моментального снимка кода, сохраненного в предыдущем разделе.
* Машинное обучение Azure создает идентификатор запуска (необязательно) и маркер службы Машинное обучение, который позже используется целевыми объектами вычислений, такими как Вычислительная среда Машинного обучения или виртуальные машины для взаимодействия со службой Машинное обучение.
* Для выполнения заданий обучения можно выбрать управляемый целевой объект вычислений (например, Вычислительная среда Машинного обучения) или неуправляемый целевой объект вычислений (например, виртуальные машины). Ниже приведены потоки данных для обоих сценариев.
   * Виртуальные машины/HDInsight, доступ к которым осуществляется с помощью учетных данных SSH в хранилище ключей в подписке Майкрософт. Машинное обучение Azure выполняет код управления на целевом объекте вычислений, который:

   1. Подготавливает среду. (DOCKER является вариантом для виртуальных машин и локальных компьютеров. Чтобы понять, как работают эксперименты в контейнерах DOCKER, ознакомьтесь со следующими шагами: Вычислительная среда Машинного обучения.)
   1. Скачивает код.
   1. Настраивает переменные и конфигурации среды.
   1. Запускает пользовательские сценарии (моментальный снимок кода, упомянутый в предыдущем разделе).

   * Вычислительная среда Машинного обучения, доступ к которым осуществляется с помощью удостоверения, управляемого рабочей областью.
Поскольку Вычислительная среда Машинного обучения является управляемым целевым объектом вычислений (т. е. управляется корпорацией Майкрософт), он выполняется в вашей подписке Майкрософт.

   1. При необходимости начинается Удаленная конструкция DOCKER.
   1. Код управления записывается в общую папку пользователя в службе файлов Azure.
   1. Контейнер запускается с помощью начальной команды. Это код управления, как описано в предыдущем шаге.

#### <a name="querying-runs-and-metrics"></a>Запросы на запуски и метрики

На приведенной ниже схеме потока этот шаг выполняется, когда целевой объект для обучения записывает метрики выполнения обратно в Машинное обучение Azure из хранилища в базе данных Cosmos DB. Клиенты могут вызывать Машинное обучение Azure. Машинное обучение будет включать метрики извлечения из базы данных Cosmos DB и возвращать их обратно клиенту.

[![Рабочий процесс обучения](./media/enterprise-readiness/training-and-metrics.png)](./media/enterprise-readiness/training-and-metrics-expanded.png)

### <a name="creating-web-services"></a>Создание веб-служб

На следующей диаграмме показан рабочий процесс определения. Вывод или оценка модели — это этап, в котором развернутая модель используется для прогнозирования, чаще всего в рабочих данных.

Дополнительные сведения:

* Пользователь регистрирует модель с помощью клиента, например пакета SDK для Машинное обучение Azure.
* Пользователь создает образ с помощью модели, файла оценки и других зависимостей модели.
* Образ DOCKER создается и сохраняется в реестре контейнеров Azure.
* Веб-служба развертывается на целевом объекте вычислений (instance Containers/AKS) с помощью образа, созданного на предыдущем шаге.
* Сведения о запросе оценки хранятся в Application Insights, который находится в подписке пользователя.
* Данные телеметрии также отправляются в подписку Microsoft/Azure.

[![Рабочий процесс определения](./media/enterprise-readiness/inferencing.png)](./media/enterprise-readiness/inferencing-expanded.png)

## <a name="next-steps"></a>Следующие шаги

* [Защита веб-служб Машинного обучения Azure с помощью SSL](how-to-secure-web-service.md)
* [Использование Машинное обучениеной модели, развернутой в качестве веб-службы](how-to-consume-web-service.md)
* [Run batch predictions on large data sets with Azure Machine Learning service](how-to-run-batch-predictions.md) (Составление пакетных прогнозов для больших наборов данных с помощью Службы машинного обучения Azure)
* [Мониторинг моделей машинного обучения в Azure с помощью Application Insights](how-to-enable-app-insights.md)
* [Сбор данных для моделей в рабочей среде](how-to-enable-data-collection.md)
* [Пакет SDK для Машинное обучение Azure](https://docs.microsoft.com/python/api/overview/azure/ml/intro?view=azure-ml-py)
* [Использование Машинное обучение Azure с виртуальной сетью Azure](how-to-enable-virtual-network.md)
* [Recommenders](https://github.com/Microsoft/Recommenders) (Системы рекомендаций)
* [Создание API рекомендаций в режиме реального времени в Azure](https://docs.microsoft.com/azure/architecture/reference-architectures/ai/real-time-recommendation)
