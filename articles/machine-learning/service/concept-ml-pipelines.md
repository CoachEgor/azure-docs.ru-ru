---
title: Что такое конвейеры машинного обучения
titleSuffix: Azure Machine Learning
description: В этой статье вы узнаете о преимуществах конвейеров машинного обучения, которые можно создать с помощью пакета SDK для Машинное обучение Azure для Python. Конвейеры машинного обучения используются специалистами по обработке и анализу данных для создания, оптимизации и администрирования рабочих процессов машинного обучения.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.author: laobri
author: lobrien
ms.date: 11/04/2019
ms.openlocfilehash: 85346a2334d240eceb0daa4519ce69b4eb4906cc
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73497461"
---
# <a name="what-are-azure-machine-learning-pipelines"></a>Что такое Машинное обучение Azure конвейеров?

Машинное обучение Azure Конвейеры позволяют создавать рабочие процессы в проектах машинного обучения. Эти рабочие процессы имеют ряд преимуществ. 

+ Простота
+ Speed
+ Повторяемости
+ Гибкость
+ Управление версиями и отслеживание
+ Модульность 
+ Контроль качества
+ Управление затратами

Эти преимущества становятся значительными, как только проект машинного обучения перейдет за пределы чистого исследования и в итерацию. Даже простые одноэтапные конвейеры могут быть полезными. Проекты машинного обучения часто находятся в сложном состоянии, и это может быть простым процессом выполнения простого процесса.

Узнайте, как [создать свой первый конвейер](how-to-create-your-first-pipeline.md).

![Конвейеры машинного обучения в Машинное обучение Azure](./media/concept-ml-pipelines/pipeline-flow.png)

<a name="compare"></a>
### <a name="which-azure-pipeline-technology-should-i-use"></a>Какую технологию конвейера Azure следует использовать?

Облако Azure предоставляет несколько других конвейеров с разными целями. В следующей таблице перечислены различные конвейеры и их использование.

| Конвейер | Действие | Канонический канал |
| ---- | ---- | ---- |
| Конвейеры Машинное обучение Azure | Определяет рабочие процессы машинного обучения для повторного использования, которые можно использовать в качестве шаблона для сценариев машинного обучения. | Модель > данных |
| [Конвейеры фабрики данных Azure](https://docs.microsoft.com/azure/data-factory/concepts-pipelines-activities) | Группирует действия перемещения данных, преобразования и управления, необходимые для выполнения задачи.  | Данные > данных |
| [Azure Pipelines](https://azure.microsoft.com/services/devops/pipelines/) | Непрерывная интеграция и доставка приложения в любую платформу или любое облако  | > Приложения или службы кода |

## <a name="what-can-azure-ml-pipelines-do"></a>Что могут выполнять конвейеры машинного обучения Azure?

Конвейер Машинное обучение Azure — это независимый исполняемый рабочий процесс полной задачи машинного обучения. Подзадачи инкапсулируются в виде последовательности шагов в конвейере. Конвейер Машинное обучение Azure может быть таким же простым, как и тот, который вызывает сценарий Python, поэтому _может_ выполнять практически любые действия. Конвейеры _должны_ сосредоточиться на задачах машинного обучения, таких как:

+ Подготовка данных, включая импорт, проверку и очистку, изменение и преобразование, нормализацию и промежуточное хранение
+ Настройка обучения, включая параметризации аргументов, пути и конфигурации ведения журналов и отчетов
+ Обучение и проверка эффективно и повторяемо, что может включать в себя указание конкретных подмножеств данных, различных вычислительных ресурсов оборудования, распределенной обработки и отслеживания хода выполнения.
+ Развертывание, включая управление версиями, масштабирование, подготовку и контроль доступа 

Независимые шаги позволяют нескольким специалистам по обработке данных работать в одном конвейере одновременно без чрезмерных ресурсов вычислений. Отдельные шаги также упрощают использование различных типов вычислений и размеров для каждого шага.

После создания конвейера часто нужно выполнить более тонкую настройку его цикла обучения. При повторном запуске конвейера выполняется переход к шагам, которые необходимо повторить, например обновленному сценарию обучения. Шаги, которые не нужно повторять, пропускаются. Тот же анализ применяется к неизмененным сценариям, используемым для достижения шага. Эти функции повторного использования позволяют избежать выполнения дорогостоящих и ресурсоемких действий, таких как прием и преобразование данных, если базовые данные не изменились.

С помощью Машинное обучение Azure можно использовать различные наборы средств и платформы, такие как PyTorch или TensorFlow, для каждого шага в конвейере. Azure координирует различные используемые [целевые объекты вычислений](concept-azure-machine-learning-architecture.md) , чтобы обеспечить общий доступ к промежуточным данным с помощью подчиненных целевых объектов вычислений.

[Метрики для экспериментов конвейера можно отслеживаниь](https://docs.microsoft.com/azure/machine-learning/service/how-to-track-experiments) непосредственно в портал Azure или на [целевой странице рабочей области (Предварительная версия)](https://ml.azure.com). После публикации конвейера можно настроить конечную точку RESTFUL, которая позволит перезапустить конвейер из любой платформы или стека.

Вкратце, все сложные задачи жизненного цикла машинного обучения можно использовать с конвейерами. Другие технологии конвейера Azure обладают собственными преимуществами, такими как [конвейеры фабрики данных Azure](https://docs.microsoft.com/azure/data-factory/concepts-pipelines-activities) для работы с данными и [Azure pipelines](https://azure.microsoft.com/services/devops/pipelines/) для непрерывной интеграции и развертывания. Но если ваше внимание уделяется машинному обучению, Машинное обучение Azure конвейеры, скорее всего, будут лучшим выбором для нужд рабочего процесса. 

## <a name="what-are-azure-ml-pipelines"></a>Что такое конвейеры машинного обучения Azure?

Конвейер машинного обучения Azure выполняет полный логический рабочий процесс с упорядоченной последовательностью шагов. Каждый шаг является дискретным действием обработки. Конвейеры выполняются в контексте Машинное обучение Azure [эксперимента](https://docs.microsoft.com/python/api/azureml-core/azureml.core.experiment.experiment?view=azure-ml-py).

На самых ранних стадиях проекта машинного обучения очень удобно иметь одну записную книжку Jupyter или сценарий Python, который выполняет всю работу рабочей области Azure и конфигурации ресурсов, подготовку данных, настройку запуска, обучение и проверку. Но так же, как функции и классы быстро становятся предпочтительными для одного императивного блока кода, рабочие процессы ML быстро становятся предпочтительными для монолитных записных книжек или сценариев. 

По разделение задачам машинного обучения конвейеры поддерживают императивную технику, которую компонент должен «делать (только) один». Модульность является очевидной для успешного выполнения проекта при программировании в группах, но даже при работе с ним даже в небольших проектах машинного обучения требуется отдельная задача, каждая из которых имеет хороший уровень сложности. К задачам относятся: Конфигурация рабочей области и доступ к данным, подготовка данных, определение модели, Настройка и развертывание. Хотя выходные данные одной или нескольких задач формируют входные данные в другой, точная информация о реализации любой из задач является, в лучшей степени, несущественными вычитаниями в следующем. В худшем случае вычислительное состояние одной задачи может вызвать ошибку в другой. 

### <a name="analyzing-dependencies"></a>Анализ зависимостей

Многие экосистемы программирования имеют средства для управления зависимостями ресурсов, библиотек или компиляции. Как правило, эти средства используют метки времени файлов для вычисления зависимостей. При изменении файла только он и его зависимые элементы обновляются (скачаны, перекомпилированы или упакованы). Конвейеры машинного обучения Azure значительно расширяют эту концепцию. Как и традиционные средства сборки, конвейеры вычисляют зависимости между шагами и выполняют только необходимые повторные вычисления. 

Анализ зависимостей в конвейерах машинного обучения Azure более сложен по сравнению с простыми метками времени. Каждый шаг может выполняться в различных аппаратных и программных средах. Подготовка данных может быть трудоемким процессом, но не нужно работать на оборудовании с мощными графическими процессорами. для некоторых шагов может потребоваться программное обеспечение, предназначенное для конкретной операционной системы, можно использовать распределенное обучение и т. д. Хотя экономия затрат на оптимизацию ресурсов может быть значительной, она может привести к невозможности ручного изменения всех различных вариантов аппаратных и программных ресурсов. Все это еще сложнее сделать, не внося ошибки в данные, передаваемые между шагами. 

Эта проблема решается конвейерами. Машинное обучение Azure автоматически управляет всеми зависимостями между этапами конвейера. Это может привести к ускорению и понижению работы образов DOCKER, подключению и отсоединению вычислений и перемещению данных между действиями в единообразном и автоматическом режиме.

### <a name="reusing-results"></a>Повторное использование результатов

Кроме того, выходные данные шага могут, если вы решили, использовать повторно. Если вы задаете повторное использование в качестве возможности и не используете восвычисление, то служба конвейера будет использовать кэшированную версию результатов этого шага. Такое повторное использование может значительно снизить время разработки. При наличии сложной задачи подготовки данных вы, вероятно, перезапустите ее чаще, чем это необходимо. Конвейеры отменяют эту заботу: при необходимости шаг будет выполнен, если нет, это не так.

Все эти анализ зависимостей, согласование и активация обрабатываются Машинное обучение Azure при создании экземпляра объекта [конвейера](https://docs.microsoft.com/api/azureml-pipeline-core/azureml.pipeline.core.pipeline(class)?view=azure-ml-py) , перед передачей в `Experiment`и вызова `submit()`. 

### <a name="coordinating-the-steps-involved"></a>Координация необходимых действий

При создании и запуске объекта `Pipeline` выполняются следующие общие действия:

+ Для каждого шага служба вычисляет требования для:
    + Аппаратные ресурсы для вычислений
    + Ресурсы ОС (образы DOCKER)
    + Ресурсы программного обеспечения (зависимости Conda и Virtualenv)
    + Входные данные 
+ Служба определяет зависимости между шагами, что приводит к динамическому графу выполнения
+ При выполнении каждого узла в графе выполнения:
    + Служба настраивает необходимую аппаратную и программную среду (возможно, повторное использование существующих ресурсов).
    + Этот шаг выполняется, предоставляя сведения о ведении журнала и мониторинге содержащегося в нем объекта `Experiment`.
    + После завершения шага его выходные данные подготавливаются в качестве входных данных для следующего шага и (или) записи в хранилище.
    + Ресурсы, которые больше не нужны, завершаются и отсоединяются

![Этапы конвейера](media/how-to-create-your-first-pipeline/run_an_experiment_as_a_pipeline.png)

## <a name="building-pipelines-with-the-python-sdk"></a>Создание конвейеров с помощью пакета SDK для Python

В [пакете SDK для машинное обучение Azure Python](https://docs.microsoft.com/python/api/overview/azure/ml/install?view=azure-ml-py)конвейер — это объект Python, определенный в модуле `azureml.pipeline.core`. Объект [конвейера](https://docs.microsoft.com/python/api/azureml-pipeline-core/azureml.pipeline.core.pipeline%28class%29?view=azure-ml-py) содержит упорядоченную последовательность из одного или нескольких объектов [пипелинестеп](https://docs.microsoft.com/api/azureml-pipeline-core/azureml.pipeline.core.builder.pipelinestep?view=azure-ml-py) . Класс `PipelineStep` является абстрактным, и фактические шаги будут подклассами, такими как [естиматорстеп](https://docs.microsoft.com/python/api/azureml-pipeline-steps/azureml.pipeline.steps.estimatorstep?view=azure-ml-py), [писонскриптстеп](https://docs.microsoft.com/python/api/azureml-pipeline-steps/azureml.pipeline.steps.pythonscriptstep?view=azure-ml-py)или [дататрансферстеп](https://docs.microsoft.com/python/api/azureml-pipeline-steps/azureml.pipeline.steps.datatransferstep?view=azure-ml-py). Класс [модулестеп](https://docs.microsoft.com/python/api/azureml-pipeline-steps/azureml.pipeline.steps.modulestep?view=azure-ml-py) содержит многократно используемую последовательность действий, которые могут совместно использоваться в конвейерах. `Pipeline` выполняется как часть `Experiment`.

Конвейер машинного обучения Azure связан с рабочей областью Машинное обучение Azure, а этап конвейера связан с целевым объектом вычислений, доступным в этой рабочей области. Дополнительные сведения см. в статьях [создание рабочих областей машинное обучение Azure и управление ими в портал Azure](https://docs.microsoft.com/azure/machine-learning/service/how-to-manage-workspace) или [целевые объекты вычислений в машинное обучение Azure?](https://docs.microsoft.com/azure/machine-learning/service/concept-compute-target).

В Машинное обучение Azure целевой объект вычислений — это среда, в которой выполняется этап машинного обучения. Программная среда может быть удаленной виртуальной машиной, Машинное обучение Azure вычислений, Azure Databricks, пакетной службы Azure и т. д. Аппаратная среда также может сильно различаться в зависимости от поддержки GPU, памяти, хранилища и т. д. Вы можете указать целевой объект вычислений для каждого шага, что обеспечивает детальное управление затратами. Для конкретного действия, объема данных и требований к производительности проекта можно использовать больше или менее мощных ресурсов. 

## <a name="building-pipelines-with-the-designer"></a>Создание конвейеров с помощью конструктора

Разработчики, предпочитающие визуальную область конструктора, могут использовать конструктор Машинное обучение Azure для создания конвейеров. Доступ к этому средству можно получить с помощью выбора **конструктора** на домашней странице рабочей области.  Конструктор позволяет перетаскивать шаги в область конструктора. Для быстрой разработки можно использовать существующие модули во множестве задач машинного обучения. существующие модули охватывают все от преобразования данных до выбора алгоритма для обучения развертыванию. Кроме того, можно создать полностью настраиваемый конвейер, объединив собственные шаги, определенные в скриптах Python.

При визуальном проектировании конвейеров входные и выходные данные шага отображаются как видимые. Можно перетаскивать подключения к данным, что позволяет быстро понять и изменить поток данных конвейера.
 
![Пример конструктора Машинное обучение Azure](./media/concept-ml-pipelines/visual-design-surface.gif)

### <a name="understanding-the-execution-graph"></a>Основные сведения о графике выполнения

Действия в конвейере могут зависеть от других шагов. Служба конвейера машинного обучения Azure выполняет работу по анализу и координации этих зависимостей. Узлы в результирующем графе выполнения представляют шаги по обработке. Каждый шаг может содержать создание или повторное использование определенного сочетания оборудования и программного обеспечения, повторное использование кэшированных результатов и т. д. Координация и оптимизация этого графа выполнения службы может значительно ускорить этап машинного обучения и снизить затраты. 

Поскольку шаги выполняются независимо, объекты для хранения входных и выходных данных, передаваемых между шагами, должны быть определены извне. Это роль [Reference](https://docs.microsoft.com/python/api/azureml-core/azureml.data.data_reference.datareference?view=azure-ml-py), [пипелинедата](https://docs.microsoft.com/python/api/azureml-pipeline-core/azureml.pipeline.core.pipelinedata?view=azure-ml-py)и связанных классов. Эти объекты данных связаны с объектом [DataStore](https://docs.microsoft.com/python/api/azureml-core/azureml.core.datastore%28class%29?view=azure-ml-py) , который инкапсулирует конфигурацию хранилища. Базовый класс `PipelineStep` всегда создается со строкой `name`, списком `inputs` и списком `outputs`. Как правило, он также имеет список `arguments` и часто имеет список `resource_inputs`. Подклассы, как правило, также имеют дополнительные аргументы (например, `PythonScriptStep` требует имя файла и путь к выполняемому сценарию). 

Граф выполнения — ациклический, но конвейеры можно запускать по повторяющемуся расписанию и запускать скрипты Python, которые могут записывать сведения о состоянии в файловую систему, что делает возможным создание сложных профилей. При проектировании конвейера, чтобы определенные шаги могли выполняться параллельно или асинхронно, Машинное обучение Azure прозрачно обрабатывает анализ зависимостей и координацию развертывания и вращения. Как правило, не нужно беспокоиться о деталях графа выполнения, но он доступен через атрибут [конвейера. Graph](https://docs.microsoft.com/python/api/azureml-pipeline-core/azureml.pipeline.core.pipeline.pipeline?view=azure-ml-py#attributes) . 


### <a name="a-simple-python-pipeline"></a>Простой конвейер Python

В этом фрагменте кода показаны объекты и вызовы, необходимые для создания и запуска базового `Pipeline`:

```python
ws = Workspace.from_config() 
blob_store = Datastore(ws, "workspaceblobstore")
compute_target = ws.compute_targets["STANDARD_NC6"]
experiment = Experiment(ws, 'MyExperiment') 

input_data = DataReference(
    datastore=Datastore(ws, blob_store),
    data_reference_name="test_data",
    path_on_datastore="20newsgroups/20news.pkl")

output_data = PipelineData(
    "output_data",
    datastore=blob_store,
    output_name="output_data1")

steps = [ PythonScriptStep(
    script_name="train.py",
    arguments=["--input", input_data, "--output", output_data],
    inputs=[input_data],
    outputs=[output_data],
    compute_target=compute_target,
    source_directory="myfolder"
) ]

pipeline = Pipeline(workspace=ws, steps=steps)

pipeline_run = experiment.submit(pipeline)
pipeline_run.wait_for_completion()
```

Фрагмент кода начинается с общих объектов Машинное обучение Azure, `Workspace`, `Datastore`, [ComputeTarget](https://docs.microsoft.com/python/api/azureml-core/azureml.core.computetarget?view=azure-ml-py)и `Experiment`. Затем код создает объекты для хранения `input_data` и `output_data`. Массив `steps` содержит один элемент, `PythonScriptStep`, который будет использовать объекты данных и выполняется в `compute_target`. Затем код создает экземпляр объекта `Pipeline`, передавая в нем рабочую область и массив шагов. Вызов `experiment.submit(pipeline)` начинает выполнение конвейера машинного обучения Azure. Вызов `wait_for_completion()` блокируется до завершения конвейера. 

## <a name="best-practices-when-using-pipelines"></a>Рекомендации по использованию конвейеров

Как видите, создание конвейера машинного обучения Azure немного сложнее, чем запуск скрипта. Для конвейеров требуется настроить и создать несколько объектов Python. 

В некоторых ситуациях рекомендуется использовать конвейер:

* В среде рабочей группы: Разделите задачи машинного обучения на несколько независимых шагов, чтобы разработчики могли работать и развивать свои программы независимо друг от друга. 

* При развертывании в или близком: наследите конфигурацию и используйте операции, управляемые событиями, чтобы остаться в изменяющихся данных.

* На ранних стадиях проекта ML или только для работы: используйте конвейеры для автоматизации сборки. Если вы начали беспокоиться о повторном создании конфигурации и вычислительном состоянии перед реализацией новой идеи, это сигнал, который можно использовать для автоматизации рабочего процесса с помощью конвейера. 

Можно легко стать энтузиазмом о повторном использовании кэшированных результатов, детализированном управлении затратами на вычисление и изоляции процессов, но у конвейеров есть затраты. Ниже приведены некоторые антишаблоны.

* Использование конвейеров в качестве единственного способа разделения проблем. Встроенные функции, объекты и модули Python позволяют избежать путаницы в программном состоянии! Этап конвейера гораздо дороже, чем вызов функции.

* Высокая связь между этапами конвейера. Если для рефакторинга зависимого шага часто требуется изменение выходных данных предыдущего шага, вполне вероятно, что отдельные шаги в настоящее время являются более затратными, чем преимущество. Еще один признак того, что шаги имеют более тесное связывание, — это аргументы для шага, которые не являются данными, но флаги для управления обработкой. 

* Преждевременно оптимизировать ресурсы для вычислений. Например, часто существует несколько этапов подготовки данных, и один часто может видеть «нет», где я могу использовать `MpiStep` для параллельного программирования, но здесь я могу использовать `PythonScriptStep` с менее мощным целевым объектом вычислений. ,» и т. д. И, возможно, в долгосрочном запуске создание детализированных действий, таких как, может оказаться целесообразным, особенно если есть возможность использовать кэшированные результаты, а не всегда перечислять. Но конвейеры не предназначены для замены модуля `multiprocessing`. 

Пока проект не станет большим или близким к развертыванию, конвейеры должны быть грубыми, а не детализированными. Если вы считаете, что проект машинного обучения включает в себя _этапы_ и конвейер, и предоставляет полный рабочий процесс для перемещения на определенном этапе, вы находитесь по нужному пути. 

## <a name="key-advantages"></a>Ключевые преимущества

Основные преимущества использования конвейеров для рабочих процессов машинного обучения:

|Ключевое преимущество|Description (Описание)|
|:-------:|-----------|
|**Автоматические&nbsp;выполнения**|Планирование выполнения шагов параллельно или в последовательности в надежном и автоматическом режиме. Подготовка и моделирование данных могут быть за последние дни или недели, а Конвейеры позволяют сосредоточиться на других задачах во время выполнения процесса. |
|**Разнородных вычислений**|Используйте несколько конвейеров, которые надежно скоординированы между разнородными и масштабируемыми вычислительными ресурсами и местами хранения. Эффективно используйте доступные вычислительные ресурсы, выполняя отдельные этапы конвейера для различных целевых объектов вычислений, таких как HDInsight, виртуальные машины обработки и анализа данных GPU, а также кирпичы.|
|**Повторное использование**|Создание шаблонов конвейера для конкретных сценариев, таких как переобучение и пакетная оценка. Активация опубликованных конвейеров из внешних систем с помощью простых вызовов RESTFUL.|
|**Отслеживание и управление версиями**|Вместо отслеживания данных и папок результатов вручную при выполнении итераций используйте пакет SDK для конвейеров, чтобы присваивать имена и определять версии источников данных, входных и выходных данных. Вы можете также отдельно управлять сценариями и данными для повышения эффективности.|
| **Модульность** | Отделение областей проблем и изоляция изменений позволяет программному обеспечению развиваться быстрее с более высоким качеством. | 
|**Документами**|Конвейеры позволяют специалистам по обработке и анализу данных совместно работать во всех областях процесса разработки машинного обучения, в то же время одновременно работая с этапами конвейера.|

## <a name="next-steps"></a>Дальнейшие действия

Конвейеры машинного обучения Azure — это мощное средство, которое начинает доставку ценности на стадии раннего развертывания. Значение увеличивается по мере роста группы и проекта. В этой статье объясняется, как указать конвейеры с помощью пакета SDK для Машинное обучение Azure Python и в Azure. Вы увидели простой исходный код и предоставили несколько доступных классов `PipelineStep`. Вы должны иметь представление о том, когда следует использовать конвейеры машинного обучения Azure и как они работают в Azure. 


+ Узнайте, как [создать свой первый конвейер](how-to-create-your-first-pipeline.md).

+ Узнайте, как [выполнять пакетные прогнозы для больших данных](tutorial-pipeline-batch-scoring-classification.md ).

+ См. справочную документацию по пакету SDK и [этапам](https://docs.microsoft.com/python/api/azureml-pipeline-steps/?view=azure-ml-py) [конвейера](https://docs.microsoft.com/python/api/azureml-pipeline-core/?view=azure-ml-py) .

+ Ознакомьтесь с примерами записных книжек Jupyter, демонстрирующими [машинное обучение Azure конвейеры](https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/machine-learning-pipelines). Узнайте, как [запускать записные книжки для изучения этой службы](samples-notebooks.md).
