---
title: Отладка и устранение неполадок в конвейерах машинного обучения
titleSuffix: Azure Machine Learning
description: Отладка и устранение неполадок конвейеров машинного обучения в пакете SDK для Машинное обучение Azure для Python. Изучите распространенные ловушки для разработки конвейеров и советы по отладке сценариев до и во время удаленного выполнения.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: conceptual
ms.reviewer: trbye
ms.author: trbye
author: trevorbye
ms.date: 10/03/2019
ms.openlocfilehash: fc19e864f00489d3ebc0162705af864785af0811
ms.sourcegitcommit: c22327552d62f88aeaa321189f9b9a631525027c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73497062"
---
# <a name="debug-and-troubleshoot-machine-learning-pipelines"></a>Отладка и устранение неполадок в конвейерах машинного обучения
[!INCLUDE [applies-to-skus](../../../includes/aml-applies-to-basic-enterprise-sku.md)]

Из этой статьи вы узнаете, как выполнять отладку и устранение неполадок в [конвейерах машинного обучения](concept-ml-pipelines.md) в [пакете SDK для машинное обучение Azure](https://docs.microsoft.com/python/api/overview/azure/ml/intro?view=azure-ml-py).

В следующих разделах представлен обзор распространенных ловушек при построении конвейеров, а также различные стратегии отладки кода, выполняемого в конвейере. При возникновении проблем с получением ожидаемого запуска конвейера используйте следующие советы. 

## <a name="testing-scripts-locally"></a>Локальное тестирование скриптов

Одним из наиболее распространенных сбоев в конвейере является то, что присоединенный скрипт (скрипт очистки данных, Скрипт оценки и т. д.) не выполняется должным образом или содержит ошибки времени выполнения в удаленном контексте вычислений, которые трудно отладить в рабочей области на компьютере Azure. Learning Studio. 

Сами по себе конвейеры не могут выполняться локально, но выполнение сценариев на локальном компьютере позволяет выполнять отладку быстрее, поскольку не нужно ждать процесса сборки вычислений и среды. Для этого требуется выполнить некоторые действия по разработке:

* Если данные находятся в облачном хранилище данных, необходимо скачать данные и сделать их доступными для скрипта. Использование небольшого примера данных — хороший способ сократить время выполнения и получить отзыв о поведении сценария.
* При попытке имитировать промежуточный шаг конвейера может потребоваться вручную создать типы объектов, которые определенный сценарий ожидает на предыдущем шаге.
* Также потребуется определить собственную среду и реплицировать зависимости, определенные в удаленной среде вычислений.

После установки сценария для запуска в локальной среде гораздо проще выполнять задачи отладки, такие как:

* Присоединение пользовательской конфигурации отладки
* Приостановка выполнения и проверка состояния объекта
* Перехват типов или логических ошибок, которые не будут предоставляться до времени выполнения

> [!TIP] 
> Убедившись в том, что сценарий выполняется должным образом, на следующем шаге выполняется сценарий в одношаговом конвейере, прежде чем пытаться запустить его в конвейере с несколькими шагами.

## <a name="debugging-scripts-from-remote-context"></a>Отладка скриптов из удаленного контекста

Локальное тестирование скриптов — это отличный способ отладки основных фрагментов кода и сложной логики, прежде чем приступить к созданию конвейера, но в некоторый момент вам, скорее всего, придется отлаживать сценарии во время выполнения собственно конвейера, особенно при диагностике выполняемого поведения. во время взаимодействия между этапами конвейера. Мы рекомендуем свободно использовать инструкции `print()` в сценариях шагов, чтобы видеть состояние объекта и ожидаемые значения во время удаленного выполнения, аналогично отладке кода JavaScript.

Файл журнала `70_driver_log.txt` содержит: 

* Все печатные инструкции во время выполнения сценария
* Трассировка стека для скрипта 

Чтобы найти этот и другие файлы журнала на портале, сначала щелкните конвейер в рабочей области.

![Страница "конвейеры" на портале](./media/how-to-debug-pipelines/pipeline-1.png)

Перейдите к родительскому запуску конвейера.

![Родительский запуск конвейеров](./media/how-to-debug-pipelines/pipeline-2.png)

Щелкните идентификатор запуска для конкретного шага.

![Страница "конвейеры" на портале](./media/how-to-debug-pipelines/pipeline-3.png)

Перейдите на вкладку **журналы** . Другие журналы включают сведения о процессе сборки образа среды и сценарии подготовки к выполнению.

![Страница "конвейеры" на портале](./media/how-to-debug-pipelines/pipeline-4.png)

> [!TIP]
> Запуски для *опубликованных конвейеров* можно найти на вкладке **конвейеры** в рабочей области на портале. Запуски для *неопубликованных конвейеров* можно найти в **экспериментах**.

## <a name="troubleshooting-tips"></a>Советы по устранению неполадок

В следующей таблице приведены распространенные проблемы во время разработки конвейера с потенциальными решениями.

| Проблема | Возможное решение |
|--|--|
| Не удалось передать данные в каталог `PipelineData` | Убедитесь, что в скрипте создан каталог, который соответствует расположению выходных данных шага в конвейере. В большинстве случаев входной аргумент определяет выходной каталог, а затем создает каталог явным образом. Чтобы создать выходной каталог, используйте `os.makedirs(args.output_dir, exist_ok=True)`. См. [руководство](tutorial-pipeline-batch-scoring-classification.md#write-a-scoring-script) по примеру сценария оценки, в котором показан этот шаблон разработки. |
| Ошибки зависимостей | Если вы разработали и тестировали сценарии локально, но нашли проблемы с зависимостями при выполнении на удаленном вычислении в конвейере, убедитесь, что зависимости и версии среды вычислений соответствуют вашей тестовой среде. |
| Неоднозначные ошибки с целевыми объектами вычислений | Удаление и повторное создание целевых объектов вычислений может решить определенные проблемы с целевыми объектами вычислений. |
| Конвейер не использует повторно шаги | Повторное использование шага включено по умолчанию, но убедитесь, что вы не отключили его на этапе конвейера. Если повторное использование отключено, для параметра `allow_reuse` на шаге будет задано значение `False`. |
| Конвейер перезапускается без необходимости | Чтобы обеспечить повторный запуск шагов только при изменении базовых данных или скриптов, установите соединение между каталогами для каждого шага. Если один и тот же исходный каталог используется для нескольких шагов, может возникнуть ненужное повторное использование. Используйте параметр `source_directory` объекта шага конвейера, чтобы указать на изолированный каталог для этого шага, и убедитесь, что вы не используете один и тот же путь `source_directory` для нескольких шагов. |

## <a name="next-steps"></a>Дальнейшие действия

* Обратитесь к Справочнику по пакету SDK, чтобы получить справку по пакету [azureml-конвейеры-Core](https://docs.microsoft.com/python/api/azureml-pipeline-core/?view=azure-ml-py) и пакету [azureml-конвейеры-этапов](https://docs.microsoft.com/python/api/azureml-pipeline-steps/?view=azure-ml-py) .

* Ознакомьтесь с [дополнительным руководством](tutorial-pipeline-batch-scoring-classification.md) по использованию конвейеров для пакетной оценки.
