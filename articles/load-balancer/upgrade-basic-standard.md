---
title: Обновление от базового публичного до стандартного публичного - Балансер загрузки Azure
description: В этой статье показано, как обновить балансер общественной нагрузки Azure с базового SKU на Standard SKU
services: load-balancer
author: irenehua
ms.service: load-balancer
ms.topic: article
ms.date: 01/23/2020
ms.author: irenehua
ms.openlocfilehash: a4c8b029b199915cce9a417430e67675a03d327f
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77659957"
---
# <a name="upgrade-azure-public-load-balancer"></a>Обновление баланса общественной нагрузки Azure
[Azure Standard Load Balancer](load-balancer-overview.md) предлагает богатый набор функциональных возможностей и высокую доступность за счет избыточности зон. Чтобы узнать больше о Загружение балансер SKU, [см.](https://docs.microsoft.com/azure/load-balancer/concepts-limitations#skus)

Есть три этапа обновления:

1. Перенести конфигурацию
2. Добавление VM в пулы бэкэнда standard Load Balancer
3. Создание исходящего правила на балансере нагрузки для исходящего соединения

Эта статья охватывает миграцию конфигурации. Добавление VM в пулы бэкэнда может варьироваться в зависимости от вашей конкретной среды. Тем не менее, некоторые высокого уровня, общие рекомендации [предоставляются](#add-vms-to-backend-pools-of-standard-load-balancer).

## <a name="upgrade-overview"></a>Общие сведения об обновлении

Доступен скрипт Azure PowerShell, который делает следующее:

* Создает стандартный балансосатор загрузки SKU в группе ресурсов и местоположении, указанном вами.
* Бесшовно копирует конфигурации Базового балансировора загрузки SKU для недавно созданного Standard Load Balancer.

### <a name="caveatslimitations"></a>Ограничения оговорок

* Сценарий поддерживает только обновление баланса общественной нагрузки. Для обновления внутреннего базового баланса нагрузки создайте стандартный балансировку внутренней нагрузки, если исходящие подключения нежелательны, и создайте стандартный балансосфер внутренней нагрузки и стандартный балансер общественной нагрузки, если требуется исходящие подключения.
* Стандартный балансоровка нагрузки имеет новый публичный адрес. Невозможно беспрепятственно перемещать IP-адреса, связанные с существующим балансом Basic Load Balancer, в Standard Load Balancer, поскольку они имеют различные SkRU.
* Если балансомер стандартной нагрузки создан в другом регионе, вы не сможете связать ВМ, существующие в старом регионе, с недавно созданным балансом стандартной нагрузки. Чтобы обойти это ограничение, убедитесь, что создать новый VM в новом регионе.
* Если ваш балансер нагрузки не имеет конфигурации IP-адреса переднего энда или пула бэкэнда, вы, скорее всего, поразите ошибку, управляя скриптом. Пожалуйста, убедитесь, что они не пусты.

## <a name="download-the-script"></a>Скачать сценарий

Скачать скрипт миграции из [галереи PowerShell](https://www.powershellgallery.com/packages/AzurePublicLBUpgrade/1.0).
## <a name="use-the-script"></a>Использование сценария

Есть два варианта для вас в зависимости от локальной настройки среды PowerShell и предпочтений:

* Если у вас нет установленных модулей Azure Az или нет ничего плохого в установке модулей Azure Az, лучшим вариантом является использование `Install-Script` опции для запуска скрипта.
* Если вам необходимо сохранить модули Azure Az, лучше всего загрузить скрипт и запустить его напрямую.

Чтобы определить, установлены ли модули `Get-InstalledModule -Name az`Azure Az, запустите. Если вы не видите `Install-Script` установленных модулей Az, то вы можете использовать метод.

### <a name="install-using-the-install-script-method"></a>Установка с помощью метода установки-скрипта

Для использования этой опции на компьютер не должны быть установлены модули Azure Az. Если они установлены, следующая команда отображает ошибку. Вы можете удалить модули Azure Az, либо использовать другой вариант для загрузки скрипта вручную и запуска его.
  
Выполните скрипт с помощью следующей команды:

`Install-Script -Name AzurePublicLBUpgrade`

Эта команда также устанавливает необходимые модули Az.  

### <a name="install-using-the-script-directly"></a>Установка с помощью сценария напрямую

Если у вас установлены некоторые модули Azure Az, которые не могут их удалить (или не хотите их унифицировать), вы можете вручную загрузить скрипт с помощью вкладки **Ручной загрузки** в ссылке загрузки скрипта. Скрипт загружается в виде необработанного файла nupkg. Чтобы установить скрипт из этого файла nupkg, [см.](/powershell/scripting/gallery/how-to/working-with-packages/manual-download)

Выполните следующее, чтобы запустить этот сценарий.

1. Используйте `Connect-AzAccount` для подключения к Azure.

1. Используйте `Import-Module Az` для импорта модулей Az.

1. Изучите необходимые параметры:

   * **oldRgName: «String»: Требуется** - это группа ресурсов для существующего базового баланса нагрузки, который вы хотите обновить. Чтобы найти это значение строки, перейдите на портал Azure, выберите исходный элемент Basic Load Balancer и нажмите **обзор** для балансоилира нагрузки. Группа ресурсов находится на этой странице.
   * **OldLBName: «String»: Требуется** - Это имя вашего существующего базового балансера, который вы хотите обновить. 
   * **newrgName: «String»: Требуется** - это группа ресурсов, в которой будет создан балансер стандартной нагрузки. Это может быть новая группа ресурсов или существующая. Если вы выбираете существующую группу ресурсов, обратите внимание, что имя балансора нагрузки должно быть уникальным в группе ресурсов. 
   * **newlocation: «String»: Требуется** - Это место, в котором будет создан балансер стандартной нагрузки. Рекомендуется унаследовать то же место расположение выбранного базового балансора на балансе стандартной нагрузки для лучшей связи с другими существующими ресурсами.
   * **newLBName: «String»: Требуется** - это имя для балансора стандартной нагрузки, которая будет создана.
1. Выполнить скрипт с использованием соответствующих параметров. Это может занять от пяти до семи минут, чтобы закончить.

    **Пример**

   ```azurepowershell
   AzurePublicLBUpgrade.ps1 -oldRgName "test_publicUpgrade_rg" -oldLBName "LBForPublic" -newrgName "test_userInput3_rg" -newlocation "centralus" -newLbName "LBForUpgrade"
   ```

### <a name="add-vms-to-backend-pools-of-standard-load-balancer"></a>Добавление VM в пулы бэкэнда standard Load Balancer

Во-первых, дважды проверьте, что скрипт успешно создал новый стандартный балансировка общественной нагрузки с точной конфигурацией, перенесенной из базового баланса общественной нагрузки. Вы можете проверить это с портала Azure.

Не забудьте отправить небольшое количество трафика через Standard Load Balancer в качестве ручного теста.
  
Вот несколько сценариев того, как вы добавляете VMs в резервные пулы недавно созданного Standard Public Load Balancer, и наши рекомендации по каждому из них:

* **Перемещение существующих VM из бэкэнд-пулов старого базового баланса общественной нагрузки в резервные пулы вновь созданного Standard Public Load Balancer.**
    1. Для выполнения задач в этом кратком руководстве войдите на [портал Azure](https://portal.azure.com).
 
    1. Выберите **все ресурсы** в левом меню, а затем выберите **недавно созданный Standard Load Balancer** из списка ресурсов.
   
    1. В разделе **Параметры** выберите **Внутренние пулы**.
   
    1. Выберите пул бэкэнда, который соответствует пулу бэкэнда базового баланса нагрузки, выберите следующее значение: 
      - **Виртуальная машина:** Падение вниз и выбрать виртуальные вымотка из соответствующего бэкэнд пула basic Load Balancer.
    1. Нажмите кнопку **Сохранить**.
    >[!NOTE]
    >Для вс-президентов, которые имеют общедоступные IP-адреса, сначала необходимо создать стандартные IP-адреса, где тот же IP-адрес не гарантируется. Отмежевать вМ от базовых IP-адресов и связать их с недавно созданными СТАНДАРТНЫми IP-адресами. После этого, вы будете последовать за инструкциями для того чтобы добавить VMs в пул бэкэнда балансора стандартной нагрузки. 

* **Создание новых VM для добавления в резервные пулы недавно созданного Standard Public Load Balancer.**
    * Дополнительные инструкции о том, как создать VM и связать его со стандартной нагрузкой балансер можно найти [здесь](https://docs.microsoft.com/azure/load-balancer/quickstart-load-balancer-standard-public-portal#create-virtual-machines).

### <a name="create-an-outbound-rule-for-outbound-connection"></a>Создание исходящего правила для исходящего соединения

Следуйте [инструкциям](https://docs.microsoft.com/azure/load-balancer/configure-load-balancer-outbound-portal#create-outbound-rule-configuration) по созданию исходящего правила, чтобы вы могли
* Определите исходящий NAT с нуля.
* Масштабируйте и настраивайте поведение существующего исходящего NAT.

## <a name="common-questions"></a>Часто задаваемые вопросы

### <a name="are-there-any-limitations-with-the-azure-powershell-script-to-migrate-the-configuration-from-v1-to-v2"></a>Существуют ли какие-либо ограничения со скриптом Azure PowerShell для переноса конфигурации из v1 в v2?

Да. Смотрите [Пещеры / Ограничения](#caveatslimitations).

### <a name="does-the-azure-powershell-script-also-switch-over-the-traffic-from-my-basic-load-balancer-to-the-newly-created-standard-load-balancer"></a>Переключается ли также скрипт Azure PowerShell с моего базового баланса нагрузки на недавно созданный балансер стандартной нагрузки?

Нет. Скрипт Azure PowerShell только мигрирует по конфигурации. Фактическая миграция трафика является вашей ответственностью и в вашем контроле.

### <a name="i-ran-into-some-issues-with-using-this-script-how-can-i-get-help"></a>Я столкнулся с некоторыми проблемами с использованием этого сценария. Как я могу получить помощь?
  
Вы можете отправить slbupgradesupport@microsoft.comэлектронное письмо, открыть кейс поддержки с помощью поддержки Azure или сделать и то, и другое.

## <a name="next-steps"></a>Дальнейшие действия

[Узнайте о балансе standard Load Balancer](load-balancer-overview.md)
