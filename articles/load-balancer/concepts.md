---
title: Основные понятия Azure Load Balancer
description: Обзор основных понятий для Azure Load Balancer
services: load-balancer
documentationcenter: na
author: asudbring
ms.service: load-balancer
ms.devlang: na
ms.topic: overview
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/05/2020
ms.author: allensu
ms.openlocfilehash: 2e2e11e1dc16fd99a82bc2fbdc7b72399bc6ae97
ms.sourcegitcommit: f57297af0ea729ab76081c98da2243d6b1f6fa63
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2020
ms.locfileid: "82871931"
---
# <a name="azure-load-balancer-concepts"></a>Основные понятия Azure Load Balancer

Load Balancer предоставляет указанные ниже возможности для приложений TCP и UDP. 

## <a name="load-balancing-algorithm"></a>Алгоритм балансировки нагрузки.
Вы можете создать правило балансировки нагрузки, чтобы распределять входящий трафик внешнего интерфейса между экземплярами внутреннего пула. Azure Load Balancer использует алгоритм хэширования для распределения входящих потоков (не байтов). Он заменяет заголовки в потоках к экземплярам внутреннего пула. Сервер может получать новые потоки, когда в результате проверки работоспособности получается работоспособная серверная конечная точка.

По умолчанию Load Balancer использует хэш с пятью кортежами.

Хэш включает перечисленные ниже компоненты.

- **Исходный IP-адрес**
- **Исходный порт**
- **Конечный IP-адрес**
- **Порт назначения**
- **Номер протокола IP для сопоставления потоков на доступные серверы**

Сопоставление с исходным IP-адресом создается с помощью хэша с двумя или тремя кортежами. Пакеты из одного потока всегда поступают на один и тот же экземпляр за внешним интерфейсом с балансировкой нагрузки. 

Если клиент запускает новый поток с того же исходного IP-адреса, меняется исходный порт. В результате использование хэша с пятью кортежами может привести к тому, что трафик перейдет к другой конечной точке серверной части.
Дополнительные сведения см. в разделе [Настройка режима распределения для Azure Load Balancer](./load-balancer-distribution-mode.md).

На представленном ниже рисунке показано распределение на основе хэша.

  ![Распространение на основе хэша](./media/load-balancer-overview/load-balancer-distribution.png)

  *Рисунок. Распространение на основе хэша*

## <a name="application-independence-and-transparency"></a>Прозрачность и независимость от приложения

Load Balancer не взаимодействует напрямую с протоколом TCP или UDP или уровнем приложения. Поддерживается любой сценарий приложения TCP или UDP. Load Balancer не берет на себя роль источника и (или) назначения для потоков, а также не взаимодействует с полезными данными потока. Load Balancer не предоставляет никаких функций шлюза на уровне приложения Подтверждения протокола всегда происходят непосредственно между клиентом и экземпляром пула серверной части. Ответом на входящий поток всегда является ответ от виртуальной машины. Когда поток поступает в виртуальную машину, исходный IP-адрес источника также сохраняется.

* За каждую конечную точку отвечает определенная виртуальная машина. Например, подтверждение TCP выполняется между клиентом и выбранной серверной виртуальной машиной. Ответ на запрос к внешнему интерфейсу — это ответ, созданный серверной виртуальной машиной. При успешной проверке связи с внешним интерфейсом вы подтверждаете сквозное соединение по крайней мере с одной серверной виртуальной машиной.
* Полезные данные приложения прозрачны для Load Balancer. Поддерживается любое приложение UDP или TCP.
* Так как Load Balancer не взаимодействует с полезными данными TCP и обеспечивают разгрузку TLS, вы можете создавать сложные сценарии с шифрованием. Использование Load Balancer значительно повышает масштаб для приложений TLS, завершая подключение TLS на самой виртуальной машине. Например, емкости ключей в сеансах TLS ограничиваются только типом и числом виртуальных машин, добавленных в серверный пул.

## <a name="load-balancer-terminology"></a>Терминология, связанная с Load Balancer
| Концепция | Что это означает? | Подробный документ |
| ---------- | ---------- | ----------|
Исходящие подключения | Потоки из внутреннего пула на общедоступные IP-адреса сопоставлены с интерфейсной частью. Azure преобразует исходящие подключения в IP-адрес общедоступного внешнего интерфейса через правила для исходящего трафика в подсистеме балансировки нагрузки. Такая конфигурация обеспечивает следующие преимущества: Упрощенное обновление и аварийное восстановление служб, так как внешний интерфейс можно динамически сопоставить с другим экземпляром службы. Упрощение управления списком управления доступом (ACL). ACL, выраженные как IP-адреса внешнего интерфейса, не меняются по мере увеличения или уменьшения масштаба или при повторном развертывании служб. Преобразование исходящих подключений для получения меньшего числа IP-адресов, чем количество компьютеров, может упростить ведение списка надежных получателей.| Дополнительные сведения о преобразовании сетевых адресов источника (SNAT) и Azure Load Balancer см. в разделе о [SNAT и Azure Load Balancer](load-balancer-outbound-connections.md#snat).
зоны доступности; | Load Balancer уровня "Стандартный" поддерживает дополнительные возможности в регионах, где доступны зоны доступности. Эти функции расширяют возможности стандартной подсистемы балансировки нагрузки.  Конфигурации Зон доступности доступны для общедоступных и внутренних экземпляров Load Balancer ценовой категории "Стандартный". Внешний интерфейс, избыточный между зонами, выдерживает сбой зоны благодаря использованию выделенной инфраструктуры во всех зонах одновременно. Кроме того, вы можете гарантировать использование внешнего интерфейса в определенной зоне. Зональные внешние интерфейсы обслуживаются только выделенной инфраструктурой в одной зоне. Для внутреннего пула доступна балансировка нагрузки между зонами. Любой ресурс виртуальной машины в виртуальной сети может входить во внутренний пул. Load Balancer ценовой категории "Базовый" не поддерживает зоны.| Дополнительные сведения см. в разделе с [подробным описанием возможностей, связанных с Зонами доступности](load-balancer-standard-availability-zones.md), и в [обзорной статье о Зонах доступности](../availability-zones/az-overview.md).
| Порты HA | Вы можете настроить правила балансировки нагрузки портов с высоким уровнем доступности, чтобы масштабировать приложение и сделать его более надежным. Эти правила обеспечивают балансировку нагрузки для каждого потока на недолго используемых портах внешнего IP-адреса внутренней подсистемы балансировки нагрузки. Кроме того, эта функция полезна в тех случаях, когда нецелесообразно или нежелательно указывать отдельные порты. Правило портов с высоким уровнем доступности позволяет реализовать сценарии "активный — пассивный" или "активный — активный" для n+1 элементов. Эти сценарии предназначены для виртуальных сетевых модулей и любых приложений, которым требуются большие диапазоны входящих портов. Можно использовать пробу работоспособности, чтобы определить, какие серверные части будут получать новые потоки.  Группу безопасности сети можно использовать для эмуляции сценария с диапазоном портов. Подсистема балансировки нагрузки категории "Базовый" не поддерживает порты высокого уровня доступности. | Ознакомьтесь со статьей [Общие сведения о портах с высоким уровнем доступности](load-balancer-ha-ports-overview.md).
| Несколько внешних интерфейсов | Load Balancer поддерживает несколько правил с несколькими внешними интерфейсами.  Load Balancer (цен. категория "Стандартный") позволяет применять эту возможность и для сценариев с исходящими подключениями. Правило для исходящего трафика отвечает за обратную ситуацию. Правило для исходящего трафика создает связь для исходящих подключений. Подсистема балансировки нагрузки категории "Стандартный" использует все внешние интерфейсы, связанные с ресурсом виртуальной машины, через правило балансировки нагрузки. Кроме того, в правиле балансировки нагрузки есть параметр, позволяющий отключить это правило для исходящих подключений. Также можно выбрать определенные внешние интерфейсы или не выбирать никаких. Для сравнения: подсистема балансировки нагрузки категории "Базовый" случайным образом выбирает один внешний интерфейс. У вас нет возможности влиять на выбор интерфейса.|


## <a name="limitations"></a><a name = "limitations"></a>Ограничения

- Правило подсистемы балансировки нагрузки не может охватывать две виртуальные сети.  Внешние интерфейсы и их внутренние экземпляры должны быть расположены в одной виртуальной сети.  

- Рабочие роли без виртуальной сети и другие службы платформы Майкрософт могут быть доступны из экземпляров, расположенных только за экземпляром Load Balancer ценовой категории "Стандартный". Вам не следует рассчитывать на такую доступность, так как сама служба или ее базовая платформа могут изменяться без уведомления. Если вам требуется возможность исходящих подключений при использовании подсистемы балансировки нагрузки категории "Стандартный", необходимо настроить [исходящие подключения](load-balancer-outbound-connections.md).

- Подсистема балансировки нагрузки обеспечивает балансировку нагрузки и перенаправление портов для конкретных протоколов TCP или UDP. Правила балансировки нагрузки и правила NAT для входящего трафика поддерживают TCP и UDP, но не другие протоколы IP, включая ICMP.

- Перенаправление исходящего потока от внутренней виртуальной машины к внешнему интерфейсу внутреннего экземпляра Load Balancer завершится сбоем.

- Перенаправление фрагментов IP-адресов не поддерживается в правилах балансировки нагрузки. В правилах балансировки нагрузки не поддерживается фрагментация IP-пакетов UDP и TCP. Для перенаправления существующих IP-фрагментов можно использовать правила балансировки нагрузки портов с высоким уровнем доступности. Дополнительные сведения см. в разделе [Обзор портов высокой доступности](load-balancer-ha-ports-overview.md).

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы приступить к работе с подсистемой балансировки нагрузки, создайте ее, создайте виртуальные машины с установленным пользовательским расширением IIS и распределяйте нагрузку веб-приложения между виртуальными машинами, как описано в статье [Краткое руководство. Создание Load Balancer (цен. категория "Стандартный") с помощью Azure CLI для распределения нагрузки между виртуальными машинами](quickstart-load-balancer-standard-public-portal.md).
- Ознакомьтесь со сведениями об [исходящих подключениях Azure Load Balancer](load-balancer-outbound-connections.md).
- [Дополнительные сведения об Azure Load Balancer](load-balancer-overview.md).
- Дополнительные сведения о [пробах работоспособности](load-balancer-custom-probe-overview.md).
- [Metrics and health diagnostics for Standard Load Balancer](load-balancer-standard-diagnostics.md) (Метрики и проверки работоспособности Load Balancer уровня "Стандартный")
- Узнайте больше о [группах безопасности сети](../virtual-network/security-overview.md).
