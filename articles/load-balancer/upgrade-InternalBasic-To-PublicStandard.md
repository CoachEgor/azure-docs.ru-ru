---
title: Обновление от базового публичного до стандартного публичного - Балансер загрузки Azure
description: В этой статье показано, как обновить балансер базовой внутренней нагрузки Azure до стандартного баланса общественной нагрузки
services: load-balancer
author: irenehua
ms.service: load-balancer
ms.topic: article
ms.date: 01/23/2020
ms.author: irenehua
ms.openlocfilehash: e3eca498e5716ae7c0a03e5e624d618899da8dc8
ms.sourcegitcommit: d57d2be09e67d7afed4b7565f9e3effdcc4a55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "81770400"
---
# <a name="upgrade-azure-internal-load-balancer---outbound-connection-required"></a>Обновление баланса внутренней нагрузки Azure - Требуется исходящие подключения
[Azure Standard Load Balancer](load-balancer-overview.md) предлагает богатый набор функциональных возможностей и высокую доступность за счет избыточности зон. Чтобы узнать больше о Загружение балансер SKU, [см.](https://docs.microsoft.com/azure/load-balancer/concepts-limitations#skus) Поскольку Standard Internal Load Balancer не обеспечивает исходящие соединения, мы предоставляем решение для создания стандартного баланса общественной нагрузки вместо.

Есть четыре этапа в обновлении:

1. Перенести конфигурацию в стандартный балансоровына общественной нагрузки
2. Добавление VM в пулы бэкэндов Standard Public Load Balancer
3. Настройка правил NSG для Subnet/VMs, которые следует воздержаться от/в Интернете

Эта статья охватывает миграцию конфигурации. Добавление VM в пулы бэкэнда может варьироваться в зависимости от вашей конкретной среды. Тем не менее, некоторые высокого уровня, общие рекомендации [предоставляются](#add-vms-to-backend-pools-of-standard-load-balancer).

## <a name="upgrade-overview"></a>Общие сведения об обновлении

Доступен скрипт Azure PowerShell, который делает следующее:

* Создает стандартный балансосиватель общественной нагрузки SKU в группе ресурсов и местоположении, которое вы указываете.
* Бесшовно копирует конфигурации Базового баланса внутренней нагрузки SKU для недавно созданного Standard Public Load Balancer.
* Создает исходящие правила, которые позволяют выйти подключения.

### <a name="caveatslimitations"></a>Ограничения оговорок

* Скрипт поддерживает обновление внутреннего баланса нагрузки, где требуется исходящие соединения. Если исходящие соединения не требуется для любого из VMs, обратитесь к [этой странице](upgrade-basicInternal-standard.md) для наилучшей практики.
* Стандартный балансоровка нагрузки имеет новый публичный адрес. Невозможно беспрепятственно перемещать IP-адреса, связанные с существующим балансом базовой внутренней нагрузки, в Стандартный балансатор общественной нагрузки, поскольку они имеют различные SkRU.
* Если балансомер стандартной нагрузки создан в другом регионе, вы не сможете связать ВМ, существующие в старом регионе, с недавно созданным балансом стандартной нагрузки. Чтобы обойти это ограничение, убедитесь, что создать новый VM в новом регионе.
* Если ваш балансер нагрузки не имеет конфигурации IP-адреса переднего энда или пула бэкэнда, вы, скорее всего, поразите ошибку, управляя скриптом.  Убедитесь, что они не пусты.

## <a name="download-the-script"></a>Скачать сценарий

Скачать скрипт миграции из [галереи PowerShell](https://www.powershellgallery.com/packages/AzureLBUpgrade/2.0).
## <a name="use-the-script"></a>Использование сценария

Есть два варианта для вас в зависимости от локальной настройки среды PowerShell и предпочтений:

* Если у вас нет установленных модулей Azure Az или нет ничего плохого в установке модулей Azure Az, лучшим вариантом является использование `Install-Script` опции для запуска скрипта.
* Если вам необходимо сохранить модули Azure Az, лучше всего загрузить скрипт и запустить его напрямую.

Чтобы определить, установлены ли модули `Get-InstalledModule -Name az`Azure Az, запустите. Если вы не видите `Install-Script` установленных модулей Az, то вы можете использовать метод.

### <a name="install-using-the-install-script-method"></a>Установка с помощью метода установки-скрипта

Для использования этой опции на компьютер не должны быть установлены модули Azure Az. Если они установлены, следующая команда отображает ошибку. Вы можете удалить модули Azure Az, либо использовать другой вариант для загрузки скрипта вручную и запуска его.
  
Выполните скрипт с помощью следующей команды:

`Install-Script -Name AzurePublicLBUpgrade`

Эта команда также устанавливает необходимые модули Az.  

### <a name="install-using-the-script-directly"></a>Установка с помощью сценария напрямую

Если у вас установлены некоторые модули Azure Az, которые не могут их удалить (или не хотите их унифицировать), вы можете вручную загрузить скрипт с помощью вкладки **Ручной загрузки** в ссылке загрузки скрипта. Скрипт загружается в виде необработанного файла nupkg. Чтобы установить скрипт из этого файла nupkg, [см.](/powershell/scripting/gallery/how-to/working-with-packages/manual-download)

Выполните следующее, чтобы запустить этот сценарий.

1. Используйте `Connect-AzAccount` для подключения к Azure.

1. Используйте `Import-Module Az` для импорта модулей Az.

1. Изучите необходимые параметры:

   * **oldRgName: «String»: Требуется** - это группа ресурсов для существующего базового баланса нагрузки, который вы хотите обновить. Чтобы найти это значение строки, перейдите на портал Azure, выберите исходный элемент Basic Load Balancer и нажмите **обзор** для балансоилира нагрузки. Группа ресурсов находится на этой странице.
   * **OldLBName: «String»: Требуется** - Это имя вашего существующего базового балансера, который вы хотите обновить. 
   * **newrgName: «String»: Требуется** - это группа ресурсов, в которой будет создан балансер стандартной нагрузки. Это может быть новая группа ресурсов или существующая. Если вы выбираете существующую группу ресурсов, обратите внимание, что имя балансора нагрузки должно быть уникальным в группе ресурсов. 
   * **newlocation: «String»: Требуется** - Это место, в котором будет создан балансер стандартной нагрузки. Мы рекомендуем унаследовать то же место расположение выбранного базового балансора на балансировку стандартной нагрузки для лучшей связи с другими существующими ресурсами.
   * **newLBName: «String»: Требуется** - это имя для балансора стандартной нагрузки, которая будет создана.
1. Выполнить скрипт с использованием соответствующих параметров. Это может занять от пяти до семи минут, чтобы закончить.

    **Пример**

   ```azurepowershell
   AzurePublicLBUpgrade.ps1 -oldRgName "test_publicUpgrade_rg" -oldLBName "LBForPublic" -newrgName "test_userInput3_rg" -newlocation "centralus" -newLbName "LBForUpgrade"
   ```

### <a name="add-vms-to-backend-pools-of-standard-load-balancer"></a>Добавление VM в пулы бэкэнда standard Load Balancer

Во-первых, дважды проверьте, что скрипт успешно создал новый стандартный балансировка общественной нагрузки с точной конфигурацией, перенесенной из базового баланса общественной нагрузки. Вы можете проверить это с портала Azure.

Не забудьте отправить небольшое количество трафика через Standard Load Balancer в качестве ручного теста.
  
Вот несколько сценариев того, как вы добавляете VMs в резервные пулы недавно созданного Standard Public Load Balancer, и наши рекомендации по каждому из них:

* **Перемещение существующих VM из бэкэнд-пулов старого базового баланса общественной нагрузки в резервные пулы вновь созданного Standard Public Load Balancer.**
    1. Для выполнения задач в этом кратком руководстве войдите на [портал Azure](https://portal.azure.com).
 
    1. Выберите **все ресурсы** в левом меню, а затем выберите **недавно созданный Standard Load Balancer** из списка ресурсов.
   
    1. В разделе **Параметры** выберите **Внутренние пулы**.
   
    1. Выберите пул бэкэнда, который соответствует пулу бэкэнда базового баланса нагрузки, выберите следующее значение: 
      - **Виртуальная машина:** Падение вниз и выбрать виртуальные вымотка из соответствующего бэкэнд пула basic Load Balancer.
    1. Щелкните **Сохранить**.
    >[!NOTE]
    >Для вс-президентов, которые имеют общедоступные IP-адреса, сначала необходимо создать стандартные IP-адреса, где тот же IP-адрес не гарантируется. Отмежевать вМ от базовых IP-адресов и связать их с недавно созданными СТАНДАРТНЫми IP-адресами. После этого, вы будете последовать за инструкциями для того чтобы добавить VMs в пул бэкэнда балансора стандартной нагрузки. 

* **Создание новых VM для добавления в резервные пулы недавно созданного Standard Public Load Balancer.**
    * Дополнительные инструкции о том, как создать VM и связать его со стандартной нагрузкой балансер можно найти [здесь](https://docs.microsoft.com/azure/load-balancer/quickstart-load-balancer-standard-public-portal#create-virtual-machines).

### <a name="create-an-outbound-rule-for-outbound-connection"></a>Создание исходящего правила для исходящего соединения

Следуйте [инструкциям](https://docs.microsoft.com/azure/load-balancer/configure-load-balancer-outbound-portal#create-outbound-rule-configuration) по созданию исходящего правила, чтобы вы могли
* Определите исходящий NAT с нуля.
* Масштабируйте и настраивайте поведение существующего исходящего NAT.

### <a name="create-nsg-rules-for-vms-which-to-refrain-communication-from-or-to-the-internet"></a>Создание правил NSG для вс-кодов, которые должны воздерживаться от общения с Интернетом или с Интернетом
Если вы хотите воздержаться от интернет-трафика от достижения ваших vMs, вы можете создать [правило NSG](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group) на сетевом интерфейсе VMs.

## <a name="common-questions"></a>Часто задаваемые вопросы

### <a name="are-there-any-limitations-with-the-azure-powershell-script-to-migrate-the-configuration-from-v1-to-v2"></a>Существуют ли какие-либо ограничения со скриптом Azure PowerShell для переноса конфигурации из v1 в v2?

Да. Смотрите [Пещеры / Ограничения](#caveatslimitations).

### <a name="does-the-azure-powershell-script-also-switch-over-the-traffic-from-my-basic-load-balancer-to-the-newly-created-standard-load-balancer"></a>Переключается ли также скрипт Azure PowerShell с моего базового баланса нагрузки на недавно созданный балансер стандартной нагрузки?

Нет. Скрипт Azure PowerShell только мигрирует по конфигурации. Фактическая миграция трафика является вашей ответственностью и в вашем контроле.

### <a name="i-ran-into-some-issues-with-using-this-script-how-can-i-get-help"></a>Я столкнулся с некоторыми проблемами с использованием этого сценария. Как я могу получить помощь?
  
Вы можете отправить slbupgradesupport@microsoft.comэлектронное письмо, открыть кейс поддержки с помощью поддержки Azure или сделать и то, и другое.

## <a name="next-steps"></a>Следующие шаги

[Узнайте о балансе standard Load Balancer](load-balancer-overview.md)
