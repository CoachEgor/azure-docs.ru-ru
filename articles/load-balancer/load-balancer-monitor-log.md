---
title: Мониторинг операций, событий и счетчиков для общедоступной службы Load Balancer ценовой категории "Базовый"
titleSuffix: Azure Load Balancer
description: Узнайте, как включить ведение журналов событий оповещений и проверки работоспособности для общедоступного Load Balancer ценовой категории "Базовый"
services: load-balancer
documentationcenter: na
author: asudbring
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.custom: seodec18
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/27/2018
ms.author: allensu
ms.openlocfilehash: 0a21af683d9fa7849d3e96c545983c9f40a8d4c6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "76935320"
---
# <a name="azure-monitor-logs-for-public-basic-load-balancer"></a>Журналы Azure Monitor для общедоступной службы Load Balancer (цен. категория "Базовый")

>[!IMPORTANT]
>Azure Load Balancer поддерживает два типа: категории "Базовый" и "Стандартный". В этой статье рассматривается Azure Load Balancer категории "Базовый". Дополнительные сведения о Load Balancer ценовой категории "Стандартный" см. в разделе [Обзор Azure Load Balancer уровня "Стандартный"](load-balancer-standard-overview.md), в котором предоставлены данные телеметрии с помощью многомерных метрик в Azure Monitor.

В Azure можно использовать различные виды журналов для управления Load Balancer ценовой категории "Базовый" и устранения возникающих в них неполадок. Доступ к некоторым из этих журналов можно получить через портал. Логи могут передаваться в концентратор событий или рабочее пространство Log Analytics. Все журналы можно извлечь из хранилища Azure blob и просматривать в различных инструментах, таких как Excel и Power BI.  В списке ниже приведены дополнительные сведения о различных типах журналов.

* **Журналы активности:** Для просмотра всех действий, представленных в подписке Azure, и их статуса можно использовать журналы активности View для [мониторинга действий на ресурсах.](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-audit) Журналы активности включены по умолчанию и могут быть просмотрены на портале Azure.
* **Журналы событий оповещений.** Эти журналы можно использовать для просмотра оповещений, создаваемых для подсистемы балансировки нагрузки. Данные о состоянии балансировщика нагрузки собираются каждые пять минут. В этом журнале делается запись, только если возникает событие оповещения балансировщика нагрузки.
* **Журналы проверки работоспособности**. Эти журналы можно использовать для просмотра проблем, обнаруженных при проверке работоспособности, включая сведения о числе экземпляров во внутреннем пуле, которые не получают запросы от подсистемы балансировки нагрузки из-за ошибок проверки работоспособности. Эти журналы записываются при изменении состояния в ходе проверки работоспособности.

> [!IMPORTANT]
> В настоящее время журналы Azure Monitor работают только для общедоступных балансироворов основных нагрузок. Журналы доступны только для ресурсов, развернутых в модели развертывания диспетчера ресурсов. Журналы нельзя использовать для ресурсов в классической модели развертывания. Дополнительные сведения о моделях развертывания см. в статье, посвященной [развертыванию с помощью Resource Manager и классическому развертыванию](../azure-resource-manager/management/deployment-models.md).

## <a name="enable-logging"></a>Включение ведения журналов

Ведение журнала действий автоматически включается для каждого ресурса Resource Manager. Включить журнал событий и зондов работоспособности, чтобы начать сбор данных, доступных через эти журналы. Вот как можно включить ведение журнала:

Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет балансировщика нагрузки, [создайте балансировщик нагрузки](https://docs.microsoft.com/azure/load-balancer/quickstart-create-basic-load-balancer-portal) перед продолжением.

1. На портале нажмите **группы ресурсов**.
2. Выберите>** \<группы ресурсов,**>где находится балансомер нагрузки.
3. Выберите балансилер нагрузки.
4. Выберите**настройки диагностики** **мониторинга.** > 
5. В **настройках диагностики** панели, в **настройках диагностики,** выберите **и добавить диагностическую настройку.**
6. В **настройках диагностики** создаваемая панель введите **myLBDiagnostics** в поле **name.**
7. У вас есть три варианта **настройки диагностики.**  Вы можете выбрать один, два или все три и настроить каждый для ваших требований:
   * **Архив учетной записи хранилища**
   * **Поток в центр событий**
   * **Отправка в Log Analytics**

    ### <a name="archive-to-a-storage-account"></a>"Архивировать в учетной записи хранения";
    Для этого процесса вам понадобится уже созданная учетная запись хранения.  Для создания учетной записи хранилища [см.](https://docs.microsoft.com/azure/storage/common/storage-quickstart-create-account?tabs=azure-portal)

    1. Выберите флажок рядом с **Архивом на учетную запись хранения.**
    2. Выберите **настройку,** чтобы открыть панель **учетной записи для хранения данных.**
    3. Выберите **подписку,** где была создана учетная запись хранилища в выдвижной коробке.
    4. Выберите имя учетной записи хранилища в **учетной записи Storage** в выдвижной коробке.
    5. Нажмите кнопку "ОК".

    ### <a name="stream-to-an-event-hub"></a>"Передать в концентратор событий";
    Для этого процесса потребуется уже созданный концентратор событий.  Для создания концентратора событий см. [Квикстарт: Создайте концентратор событий с помощью портала Azure](https://docs.microsoft.com/azure/event-hubs/event-hubs-create)

    1. Выберите флажок рядом с **Stream в концентратор событий**
    2. Выберите **настройку,** чтобы открыть панель **концентратора Select.**
    3. Выберите **подписку,** где был создан концентратор событий в выдвижной коробке.
    4. **Выберите пространство имен концентратора событий** в выдвижной коробке.
    5. **Выберите имя политики концентратора событий** в выдвижной коробке.
    6. Нажмите кнопку "ОК".

    ### <a name="send-to-log-analytics"></a>Отправка в Log Analytics
    Для этого процесса уже необходимо создать и настроить рабочее пространство аналитики журналов.  Для создания рабочего пространства анализа журналов на портале [Azure см.](https://docs.microsoft.com/azure/azure-monitor/learn/quick-create-workspace)

    1. Выберите флажок рядом с **Send to Log Analytics.**
    2. Выберите **подписку,** где рабочее пространство Log Analytics находится в выдвижной коробке.
    3. Выберите **рабочее пространство аналитики журнала** в выдвижной коробке.


8. Под разделом **LOG** в панели **настроек диагностики** выберите флажок рядом с обоими:
   * **LoadBalancerAlertEvent**
   * **LoadBalancerProbeHealthStatus**

9.  Под разделом **METRIC** в панели **настроек диагностики** выберите флажок рядом с:
   * **AllMetrics**

11. Проверить все выглядит правильно и нажмите **Сохранить** в верхней части панели **настройки настройки** создания.

## <a name="activity-log"></a>Журнал действий

Твжурнал активности генерируется по умолчанию. Журналы хранятся в течение 90 дней в хранилище журналов событий Azure. Узнайте больше об этих журналах, прочитав [журналы активности View для мониторинга действий в](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-audit) статье ресурсов.

## <a name="archive-to-storage-account-logs"></a>Архив журналов учетных записей хранения

### <a name="alert-event-log"></a>Журнал событий оповещений

Этот журнал создается только в том случае, если он включен для конкретной подсистемы балансировки нагрузки. События регистрируются в формате JSON и хранятся в учетной записи хранения, указанной при включении ведения журнала. Следующим примером является событие.

```json
{
    "time": "2016-01-26T10:37:46.6024215Z",
    "systemId": "32077926-b9c4-42fb-94c1-762e528b5b27",
    "category": "LoadBalancerAlertEvent",
    "resourceId": "/SUBSCRIPTIONS/XXXXXXXXXXXXXXXXX-XXXX-XXXX-XXXXXXXXX/RESOURCEGROUPS/RG7/PROVIDERS/MICROSOFT.NETWORK/LOADBALANCERS/WWEBLB",
    "operationName": "LoadBalancerProbeHealthStatus",
    "properties": {
        "eventName": "Resource Limits Hit",
        "eventDescription": "Ports exhausted",
        "eventProperties": {
            "public ip address": "40.117.227.32"
        }
    }
}
```

На выходе JSON отображается свойство *имен событий,* в котором будет описана причина создания балансораюли нагрузки. В этом случае оповещение было вызвано истощением порта TCP, вызванным ограничениями IP NAT (SNAT).

### <a name="health-probe-log"></a>Журнал проверки работоспособности

Этот журнал создается только в том случае, если он включен для конкретного балансировщика нагрузки, как описано выше. Данные хранятся в учетной записи хранения, указанной при включении ведения журнала. Создается контейнер с именем insights-logs-loadbalancerprobehealthstatus, и в журнал записываются следующие данные.

```json
{
    "records":[
    {
        "time": "2016-01-26T10:37:46.6024215Z",
        "systemId": "32077926-b9c4-42fb-94c1-762e528b5b27",
        "category": "LoadBalancerProbeHealthStatus",
        "resourceId": "/SUBSCRIPTIONS/XXXXXXXXXXXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXX/RESOURCEGROUPS/RG7/PROVIDERS/MICROSOFT.NETWORK/LOADBALANCERS/WWEBLB",
        "operationName": "LoadBalancerProbeHealthStatus",
        "properties": {
            "publicIpAddress": "40.83.190.158",
            "port": "81",
            "totalDipCount": 2,
            "dipDownCount": 1,
            "healthPercentage": 50.000000
        }
    },
    {
        "time": "2016-01-26T10:37:46.6024215Z",
        "systemId": "32077926-b9c4-42fb-94c1-762e528b5b27",
        "category": "LoadBalancerProbeHealthStatus",
        "resourceId": "/SUBSCRIPTIONS/XXXXXXXXXXXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXX/RESOURCEGROUPS/RG7/PROVIDERS/MICROSOFT.NETWORK/LOADBALANCERS/WWEBLB",
        "operationName": "LoadBalancerProbeHealthStatus",
        "properties": {
            "publicIpAddress": "40.83.190.158",
            "port": "81",
            "totalDipCount": 2,
            "dipDownCount": 0,
            "healthPercentage": 100.000000
        }
    }]
}
```

В выходных данных JSON в поле свойств отображаются основные сведения о состоянии проверки работоспособности. Свойство *dipDownCount* показывает общее количество экземпляров на бэк-энде, которые не получают сетевого трафика из-за неудачных ответов зонда.

### <a name="view-and-analyze-the-activity-log"></a>Просмотр и анализ журнала действий

Данные журнала действий можно просматривать и анализировать с помощью любого из следующих методов:

* **Инструменты Azure:** Извлекать информацию из журнала активности через Azure PowerShell, интерфейс командной строки Azure (CLI), API Azure REST или портал Azure. Пошаговые инструкции для каждого метода подробно описаны в статье [Операции аудита с помощью диспетчера ресурсов](../azure-resource-manager/management/view-activity-logs.md) .
* **Power BI.** Если у вас еще нет учетной записи [Power BI](https:// .microsoft.com/pricing) , ее можно опробовать бесплатно. Используя [пакет содержимого "Журналы аудита Azure" для Power BI](https:// .microsoft.com/documentation/ -content-pack-azure-audit-logs), можно анализировать данные с помощью предварительно настроенных панелей мониторинга или дополнительно настроить представление данных в зависимости от своих потребностей.

### <a name="view-and-analyze-the-health-probe-and-event-log"></a>Просмотр и анализ журналов событий и проверки работоспособности

Подключитесь к учетной записи хранилища и извлеките записи в журнале JSON для журналов событий и зондов работоспособности. Загружая файлы JSON, вы можете преобразовать их в CSV и просмотреть в Excel, Power BI или любом другом инструменте визуализации данных.

> [!TIP]
> Если вы знакомы с Visual Studio и основными понятиями изменения значений констант и переменных в C#, можно использовать [инструменты преобразования журналов](https://github.com/Azure-Samples/networking-dotnet-log-converter), доступные на сайте GitHub.

## <a name="stream-to-an-event-hub"></a>"Передать в концентратор событий";
При перекаче диагностической информации в концентратор событий ее можно использовать для централизованного анализа журналов в стороннем инструменте SIEM с интеграцией Azure Monitor. Для получения дополнительной информации смотрите [данные мониторинга Stream Azure в концентраторе событий](../azure-monitor/platform/stream-monitoring-data-event-hubs.md#partner-tools-with-azure-monitor-integration)

## <a name="send-to-log-analytics"></a>Отправка в Log Analytics
Ресурсы azure могут отправлять свою диагностическую информацию непосредственно в рабочее пространство Log Analytics, где сложные запросы могут быть запущены против информации для устранения неполадок и анализа.  Для получения дополнительной информации смотрите [журналы ресурсов «Сбор ресурсов Azure» в рабочем пространстве журнала Analytics в Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/resource-logs-collect-workspace)

## <a name="next-steps"></a>Дальнейшие действия

[Основные сведения о пробах подсистемы балансировки нагрузки](load-balancer-custom-probe-overview.md)
