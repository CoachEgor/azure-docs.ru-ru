---
title: Мониторинг операций, событий и счетчиков для общедоступной службы Load Balancer ценовой категории "Базовый"
titleSuffix: Azure Load Balancer
description: Узнайте, как включить ведение журнала для Azure Load Balancer
services: load-balancer
documentationcenter: na
author: asudbring
ms.service: load-balancer
ms.devlang: na
ms.topic: how-to
ms.custom: seodec18
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/05/2020
ms.author: allensu
ms.openlocfilehash: 6742723e24df83ac8112e224f1999f116ab82c94
ms.sourcegitcommit: 16c7fd8fe944ece07b6cf42a9c0e82b057900662
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/03/2020
ms.locfileid: "96572785"
---
# <a name="azure-monitor-logs-for-the-standard-azure-load-balancer"></a>Azure Monitor журналов для стандартных Azure Load Balancer

В Azure можно использовать различные типы журналов для управления и устранения неполадок стандартных подсистем балансировки нагрузки. Журналы можно передавать в концентратор событий или в рабочую область Log Analytics. Все журналы можно извлечь из хранилища BLOB-объектов Azure и просматривать в различных средствах, таких как Excel и Power BI.  В списке ниже приведены дополнительные сведения о различных типах журналов.

* **Журналы действий:** С помощью команды [Просмотр журналов действий можно отслеживать действия с ресурсами](../azure-resource-manager/management/view-activity-logs.md) , чтобы просмотреть все действия, отправляемые в ваши подписки Azure, и их состояние. Журналы действий включены по умолчанию и могут быть просмотрены в портал Azure. Эти журналы доступны как для базовых, так и для стандартных подсистем балансировки нагрузки.
* **Метрики Load Balancer (цен. Категория "Стандартный"):** Этот журнал можно использовать для запроса метрик, экспортированных в качестве журналов для стандартного Azure Load Balancer. Эти журналы доступны только для стандартных подсистем балансировки нагрузки.

> [!IMPORTANT]
> **Журналы событий проверки работоспособности и Load Balancer предупреждений в настоящее время не работают и перечислены в [известных проблемах для Azure Load Balancer](whats-new.md#known-issues).** 

> [!IMPORTANT]
> Журналы доступны только для ресурсов, развернутых в модели развертывания диспетчера ресурсов. Журналы нельзя использовать для ресурсов в классической модели развертывания. Дополнительные сведения о моделях развертывания см. в статье, посвященной [развертыванию с помощью Resource Manager и классическому развертыванию](../azure-resource-manager/management/deployment-models.md).

## <a name="enable-logging"></a>Включение ведения журналов

Ведение журнала действий автоматически включается для каждого ресурса Resource Manager. Включите ведение журнала событий и проверки работоспособности, чтобы начать сбор данных, доступных в этих журналах. Вот как можно включить ведение журнала:

Войдите на [портал Azure](https://portal.azure.com). Если у вас еще нет балансировщика нагрузки, [создайте балансировщик нагрузки](./quickstart-load-balancer-standard-public-portal.md) перед продолжением.

1. На портале щелкните **группы ресурсов**.
2. Выберите **\<resource-group-name>** , где находится балансировщик нагрузки.
3. Выберите подсистему балансировки нагрузки.
4. Выберите **Activity log**  >  **параметры диагностики** журнала действий.
5. В области **параметры диагностики** в разделе **параметры диагностики** выберите **+ Добавить параметр диагностики**.
6. В области создание **параметров диагностики** введите **Милбдиагностикс** в поле **имя** .
7. У вас есть три варианта **параметров диагностики**.  Вы можете выбрать один, два или все три и настроить каждый из них в соответствие с вашими требованиями:
   * **Архивировать в учетной записи хранения.**
   * **Передать в концентратор событий.**
   * **Отправить в Log Analytics.**

    ### <a name="archive-to-a-storage-account"></a>"Архивировать в учетной записи хранения";
    Для этого процесса потребуется учетная запись хранения, созданная ранее.  Сведения о создании учетной записи хранения см. в статье [Создание учетной записи хранения](../storage/common/storage-account-create.md?tabs=azure-portal) .

    1. Установите флажок **архивировать в учетную запись хранения**.
    2. Щелкните **настроить** , чтобы открыть панель **Выбор учетной записи хранения** .
    3. В раскрывающемся списке выберите **подписку** , в которой была создана учетная запись хранения.
    4. В раскрывающемся списке выберите имя учетной записи хранения в разделе **учетная запись хранения** .
    5. Нажмите кнопку "ОК".

    ### <a name="stream-to-an-event-hub"></a>"Передать в концентратор событий";
    Вам потребуется концентратор событий, уже созданный для этого процесса.  Сведения о создании концентратора событий см [. в разделе Краткое руководство. Создание концентратора событий с помощью портал Azure](../event-hubs/event-hubs-create.md)

    1. Установите флажок рядом с пунктом **потоковая передача в концентратор событий** .
    2. Щелкните **настроить** , чтобы открыть панель **Выбор концентратора событий** .
    3. В раскрывающемся списке выберите **подписку** , в которой был создан концентратор событий.
    4. В раскрывающемся списке **выберите пространство имен концентратора событий** .
    5. В раскрывающемся списке **выберите имя политики концентратора событий** .
    6. Нажмите кнопку "ОК".

    ### <a name="send-to-log-analytics"></a>Отправка в Log Analytics
    Для этого процесса необходимо, чтобы Рабочая область log Analytics была создана и настроена.  Сведения о создании рабочей области Log Analytics см. в разделе [создание log Analytics рабочей области на портал Azure](../azure-monitor/learn/quick-create-workspace.md)

    1. Установите флажок рядом с пунктом **отправить на log Analytics**.
    2. В раскрывающемся списке выберите **подписку** , в которой находится рабочая область log Analytics.
    3. Выберите **рабочую область log Analytics** в раскрывающемся списке.


8.  Под разделом **Метрика** в области " **параметры диагностики** " установите флажок рядом с: **аллметрикс** .

9. Убедитесь, что все выглядит правильно, и нажмите кнопку **сохранить** в верхней части панели Создание **параметров диагностики** .

## <a name="activity-log"></a>Журнал действий

Журнал действий создается по умолчанию. Его можно настроить для экспорта на уровне подписки, [следуя инструкциям в этой статье](https://docs.microsoft.com/azure/azure-monitor/platform/activity-log). Дополнительные сведения об этих журналах см. в статье [Просмотр журналов действий для отслеживания действий с ресурсами](../azure-resource-manager/management/view-activity-logs.md) .

### <a name="view-and-analyze-the-activity-log"></a>Просмотр и анализ журнала действий

Данные журнала действий можно просматривать и анализировать с помощью любого из следующих методов:

* **Средства Azure:** Получите сведения из журнала действий с помощью Azure PowerShell, интерфейса командной строки Azure (CLI), REST API Azure или портал Azure. Пошаговые инструкции для каждого метода подробно описаны в статье [Операции аудита с помощью диспетчера ресурсов](../azure-resource-manager/management/view-activity-logs.md) .
* **Power BI.** Если у вас еще нет учетной записи [Power BI](https://powerbi.microsoft.com/pricing) , ее можно опробовать бесплатно. С помощью [интеграции журналов аудита Azure для Power BI](https://powerbi.microsoft.com/integrations/azure-audit-logs/)можно проанализировать данные с помощью предварительно настроенных панелей мониторинга или настроить представления в соответствии с вашими требованиями.

## <a name="metrics-as-logs"></a>Метрики в качестве журналов
Используя метрики для ведения журналов функций экспорта, предоставляемых Azure Monitor, вы можете экспортировать метрики Load Balancer. Эти метрики будут создавать запись журнала для каждого интервала выборки в минуту.

Метрика на экспорт журналов включена на уровне ресурсов. Чтобы включить эти журналы, перейдите в колонку "параметры диагностики", выполните фильтрацию по группе ресурсов и выберите Load Balancer, для которых необходимо включить экспорт метрик. Когда Load Balancer страницу "параметры диагностики", выберите Аллметрикс, чтобы экспортировать допустимые метрики в качестве журналов.

Ограничения экспорта метрик см. в разделе [ограничения](#limitations) этой статьи.

### <a name="view-and-analyze-metrics-as-logs"></a>Просмотр и анализ метрик в качестве журналов
После включения Аллметрикс в параметрах диагностики для Load Balancer (цен. категория "Стандартный") при использовании концентратора событий или Log Analytics рабочей области эти журналы будут заполнены в таблице Азуремонитор. При экспорте в хранилище подключитесь к учетной записи хранения и получите записи журнала JSON для журналов событий и проверки работоспособности. После загрузки JSON-файлов их можно преобразовать в формат CSV и просматривать в Excel, Power BI или любом другом средстве визуализации данных. 

> [!TIP]
> Если вы знакомы с Visual Studio и основными понятиями изменения значений констант и переменных в C#, можно использовать [инструменты преобразования журналов](https://github.com/Azure-Samples/networking-dotnet-log-converter), доступные на сайте GitHub.

## <a name="stream-to-an-event-hub"></a>"Передать в концентратор событий";
Когда диагностические данные передаются в концентратор событий, их можно использовать для централизованного анализа журналов в средстве SIEM стороннего производителя с интеграцией Azure Monitor. Дополнительные сведения см. [в статье потоковая передача данных мониторинга Azure в концентратор событий](../azure-monitor/platform/stream-monitoring-data-event-hubs.md#partner-tools-with-azure-monitor-integration) .

## <a name="send-to-log-analytics"></a>Отправка в Log Analytics
Ресурсы в Azure могут отправлять диагностические сведения непосредственно в Log Analytics рабочую область, где можно выполнять сложные запросы к информации для устранения неполадок и анализа.  Дополнительные сведения см. в статье [Получение журналов ресурсов Azure в log Analytics рабочей области в Azure Monitor](../azure-monitor/platform/resource-logs.md#send-to-log-analytics-workspace)

## <a name="limitations"></a>Ограничения
В настоящее время существуют следующие ограничения при использовании функции "метрики для регистрации" при экспорте для подсистем балансировки нагрузки.
* Метрики в настоящее время отображаются с использованием внутренних имен при экспорте в качестве журналов. сопоставление можно найти в таблице ниже.
* Размерность метрик не сохраняется. Например, с метриками, такими как Дипаваилабилити (состояние проверки работоспособности), вы не сможете разделить или просмотреть по внутреннему IP-адресу.
* Используемые порты SNAT и выделенные метрики портов SNAT в настоящее время недоступны для экспорта в качестве журналов

## <a name="next-steps"></a>Next Steps
* [Проверьте доступные метрики для Load Balancer](https://docs.microsoft.com/azure/load-balancer/load-balancer-standard-diagnostics)
* [Создавайте и тестируйте запросы, следуя инструкциям Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/log-query/log-query-overview)
* Оставьте отзыв об этой статье или Load Balancer функциональных возможностях, используя приведенные ниже ссылки.
