---
title: Краткое руководство. Создание общедоступного Load Balancer на портале Azure
titleSuffix: Azure Load Balancer
description: В этом кратком руководстве вы узнаете, как создать Load Balancer с помощью портала Azure.
services: load-balancer
documentationcenter: na
author: asudbring
manager: twooley
Customer intent: I want to create a Load Balancer so that I can load balance internet traffic to VMs.
ms.service: load-balancer
ms.devlang: na
ms.topic: quickstart
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 01/08/2020
ms.author: allensu
ms.custom: mvc
ms.openlocfilehash: 4a5775be66f95fb69db761c2356a61f80068bc75
ms.sourcegitcommit: 5d6ce6dceaf883dbafeb44517ff3df5cd153f929
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76843877"
---
# <a name="quickstart-create-a-load-balancer-to-load-balance-vms-using-the-azure-portal"></a>Краткое руководство. Создание Load Balancer с помощью портала Azure для распределения нагрузки между виртуальными машинами

Балансировка нагрузки обеспечивает более высокий уровень доступности и масштабирования за счет распределения входящих запросов между несколькими виртуальными машинами. Вы можете использовать портал Azure для создания подсистемы балансировки нагрузки, чтобы распределять нагрузку виртуальных машин. В этом кратком руководстве показано, как распределять нагрузку между виртуальными машинами с помощью общедоступного Load Balancer.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу. 

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="create-a-load-balancer"></a>Создание Load Balancer

В этом разделе вы создадите Load Balancer, помогающий распределять нагрузку виртуальных машин. Вы можете создать общественный или внутренний Load Balancer. Вместе с общедоступным экземпляром Load Balancer необходимо также создать новый общедоступный IP-адрес, настроенный в качестве внешнего интерфейсного (с именем *LoadBalancerFrontend* по умолчанию).

1. Вверху слева выберите последовательно **Создать ресурс** > **Сети** > **Load Balancer**.
2. На вкладке **Основные сведения** страницы **Создание подсистемы балансировки нагрузки** введите или выберите следующие сведения, примите значения по умолчанию для остальных параметров и нажмите кнопку **Review + create** (Проверить и создать).

    | Параметр                 | Значение                                              |
    | ---                     | ---                                                |
    | Подписка               | Выберите свою подписку.    |    
    | Группа ресурсов         | Выберите **Создать** и в текстовом поле введите *myResourceGroupSLB*.|
    | Имя                   | *myLoadBalancer*                                   |
    | Регион         | Выберите **Западная Европа**.                                        |
    | Тип          | Щелкните **Общедоступный**.                                        |
    | номер SKU           | Выберите **Стандартный** или **Базовый**. Для производственных рабочих нагрузок компания Майкрософт рекомендует использовать цен. категорию "Стандартный".  |
    | Общедоступный IP-адрес | Выберите **Создать**. Если вы хотите использовать существующий общедоступный IP-адрес, выберите **Использовать существующий** |
    | Имя общедоступного IP-адреса              | Введите *myPublicIP* в текстовом поле.   |
    | Зона доступности | Введите *Избыточный в пределах зоны*, чтобы создать устойчивый Load Balancer. Чтобы создать зональный Load Balancer, выберите определенную зону 1, 2 или 3. |

3. На вкладке **Отзыв и создание** выберите **Создать**.   

    ![Создание подсистемы балансировки нагрузки уровня "Стандартный"](./media/quickstart-load-balancer-standard-public-portal/create-standard-load-balancer.png)

## <a name="create-load-balancer-resources"></a>Создание ресурсов Load Balancer

В этом разделе описано, как настроить параметры Load Balancer для внутреннего пула адресов и пробы работоспособности, а также как указать правила балансировки нагрузки.

### <a name="create-a-backend-pool"></a>Создание внутреннего пула

Для распределения трафика между виртуальными машинами, внутренний пул адресов содержит IP-адреса виртуальных сетевых карт, подключенных к Load Balancer. Создайте внутренний пул адресов *myBackendPool*, чтобы включить виртуальные машины для балансировки нагрузки интернет-трафика.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Серверные пулы**, затем щелкните **Добавить**.
3. На странице **Добавление серверного пула** введите имя *myBackEndPool* для серверного пула и выберите **Добавить**.

### <a name="create-a-health-probe"></a>Создание пробы работоспособности

Чтобы Load Balancer мог следить за состоянием приложения, необходимо использовать пробу работоспособности. Проба работоспособности динамически добавляет или удаляет виртуальные машины из Load Balancer на основе их ответа на проверки работоспособности. Создайте зонд работоспособности *myHealthProbe*, чтобы отслеживать работоспособность виртуальных машин.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Пробы работоспособности**, а затем щелкните **Добавить**.
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите *myHealthProbe*. |
    | Протокол | Выберите **HTTP**. |
    | Порт | Введите *80*.|
    | Интервал | В качестве **интервала** между попытками выполнения пробы (в секундах) введите *15*. |
    | Пороговое значение сбоя | Выберите **2** в качестве значения **порога состояния неработоспособности** или количества последовательных сбоев пробы, после которых виртуальная машина будет считаться неработоспособной.|
    | | |
4. Щелкните **ОК**.

### <a name="create-a-load-balancer-rule"></a>Создание правила подсистемы балансировки нагрузки
Правило подсистемы балансировки нагрузки позволяет определить распределение трафика между виртуальными машинами. Вы определяете конфигурацию внешнего IP-адреса для входящего трафика и пул внутренних IP-адресов для приема трафика, а также требуемый порт источника и назначения. Создайте правило Load Balancer *myLoadBalancerRuleWeb* для прослушивания порта 80 в интерфейсном сервере *FrontendLoadBalancer* и отправки трафика со сбалансированной нагрузкой во внутренний пул адресов *myBackEndPool*, также используя порт 80. 

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Правила балансировки нагрузки**, а затем щелкните **Добавить**.
3. Для настройки правила балансировки нагрузки используйте следующие значения:
    
    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите *myHTTPRule*. |
    | Протокол | Выберите **TCP**. |
    | Порт | Введите *80*.|
    | Серверный порт | Введите *80*. |
    | Серверный пул | Выберите *myBackendPool*.|
    | Проверка работоспособности | Выберите *myHealthProbe*. |
4. Сохраните остальные значения по умолчанию и нажмите кнопку **ОК**.


## <a name="create-backend-servers"></a>Создание внутренних серверов

В этом разделе описано, как создать виртуальную сеть, три виртуальные машины для внутреннего пула Load Balancer и установить службы IIS на виртуальных машинах для проверки Load Balancer.

### <a name="create-a-virtual-network"></a>Создание виртуальной сети
1. Вверху с левой стороны экрана последовательно выберите **Создать ресурс** > **Сети** > **Виртуальная сеть**.

1. В подменю **Создать виртуальную сеть** введите или выберите следующую информацию:

    | Параметр | Значение |
    | ------- | ----- |
    | Имя | Введите *myVNet*. |
    | Пространство адресов | Введите *10.1.0.0/16*. |
    | Подписка | Выберите свою подписку.|
    | Группа ресурсов | Выберите существующий ресурс *myResourceGroupSLB*. |
    | Расположение | Выберите **Западная Европа**.|
    | Имя подсети | Введите *myBackendSubnet*. |
    | Диапазон адреса подсети | Введите *10.1.0.0/24*. |
1. Сохраните остальные значения по умолчанию и нажмите кнопку **Создать**.

### <a name="create-virtual-machines"></a>Создание виртуальных машин
Номера SKU общедоступных IP-адресов и номера SKU Load Balancer должны совпадать. Для Load Balancer (цен. категория "Стандартный") используйте во внутреннем пуле только виртуальные машины с IP-адресами категории "Стандартный". В этом разделе вы создадите три виртуальные машины (*myVM1*, *myVM2* и *myVM3*) с общедоступным IP-адресом цен. категории "Стандартный" в трех различных зонах (*зона 1*, *зона 2* и *зона 3*), которые позже добавляются в созданный ранее внутренний пул Load Balancer. Если вы выбрали цен. категорию "Базовый", используйте виртуальные машины с IP-адресами такой же ценовой категории.

1. В верхней левой части портала выберите **Создать ресурс** > **Вычисления** > **Windows Server 2019 Datacenter**. 
   
1. В разделе **Создание виртуальной машины** введите или выберите следующие значения на вкладке **Основные сведения**:
   - **Подписка** > **Группа ресурсов**. Выберите **myResourceGroupSLB**.
   - **Сведения об экземпляре** > **Имя виртуальной машины**. Введите *myVM1*.
   - **Сведения об экземпляре** > **Регион**, затем выберите **Западная Европа**.
   - **Сведения об экземпляре** > **Параметры доступности**, затем выберите **Зоны доступности**. 
   - **Сведения об экземпляре** > **Зона доступности**, затем выберите **1**.
   - **Учетная запись администратора**. > Введите **имя пользователя**, **пароль** и **подтвердите пароль**.
   - Выберите вкладку **Сеть** или **Далее: диски**, затем **Далее: сеть**.
  
1. На вкладке **Сети** выберите следующее:
   - **Виртуальная сеть**: *myVnet*.
   - **Подсеть**: *MyBackendSubnet*.
   - Выберите **Общедоступный IP-адрес**, затем — **Создать**, в окне **Создать общедоступный IP-адрес** для **SKU** выберите **Стандартный**, а для **Зона доступности** — **Избыточное между зонами**, а затем нажмите кнопку **OK**. Если вы создали Load Balancer цен. категории "Базовый", выберите "Базовый". Для производственных рабочих нагрузок компания Майкрософт рекомендует использовать номера SKU цен. категории "Стандартный".
   - Чтобы создать группу безопасности сети (NSG) типа брандмауэра, в разделе **Группа безопасности сети** выберите **Дополнительно**. 
       1. В поле **Настройка группы безопасности сети** выберите **Создать новый**. 
       1. Введите *myNetworkSecurityGroup* и нажмите кнопку **ОК**.
   - Выполните следующие действия, чтобы сделать виртуальную машину частью внутреннего пула Load Balancer.
        - В разделе **Балансировка нагрузки** для параметра **Настроить эту виртуальную машину для работы с существующим решением по балансировке нагрузки?** выберите **Да**.
        - В разделе **Параметры балансировки нагрузки** для **параметров балансировки нагрузки** выберите **Балансировщик нагрузки Azure**.
        - Для параметра **Выберите подсистему балансировки нагрузки** выберите *myLoadBalancer*.
        - Выберите вкладку **Управление** или **Далее** > **Управление**.
2. На вкладке **Управление** в разделе **Мониторинг** задайте значение **Выкл.** для параметра **Диагностика загрузки**. 
1. Выберите **Review + create** (Просмотреть и создать).   
1. Проверьте параметры, а затем нажмите кнопку **Создать**.
1. Выполните шаги 2–6, чтобы создать еще две виртуальные машины с приведенными ниже параметрами (все остальные параметры совпадают с виртуальной машиной *myVM1*).

    | Параметр | Виртуальная машина 2| Виртуальная машина 3|
    | ------- | ----- |---|
    | Имя |  *myVM2* |*myVM3*|
    | Зона доступности | 2 |3|
    |Общедоступный IP-адрес| Номер SKU **Стандартный**|Номер SKU **Стандартный**|
    | Общедоступный IP-адрес — зона доступности| **Избыточное в пределах зоны** |**Избыточное в пределах зоны**|
    | Группа безопасности сети | Выберите имеющуюся группу *myNetworkSecurity*| Выберите имеющуюся группу *myNetworkSecurity*|

 ### <a name="create-nsg-rule"></a>Создание правила группы безопасности сети

В этом разделе описано, как создать правило группы безопасности сети, чтобы разрешить входящие подключения по протоколу HTTP.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем в списке ресурсов выберите группу **myNetworkSecurityGroup**, расположенную в группе ресурсов **myResourceGroupSLB**.
2. В разделе **Параметры** выберите **Правила безопасности для входящего трафика**, а затем щелкните **Добавить**.
3. Введите (выберите) следующие значения для правила безопасности для входящего трафика с именем *myHTTPRule*, чтобы разрешить входящие подключения HTTP через порт 80:
    - **Источник**. *Тег службы*
    -  **Тег службы источника**. *Интернет*;
    - **Диапазоны портов назначения**. *80*
    - **Протокол**. *TCP*
    - **Action** (Действие). *Разрешить*
    - **Приоритет**. *100*
    - **Имя**: *myHTTPRule* 
    - **Описание**: "*Разрешить HTTP* 
4. Выберите **Добавить**.
5. При необходимости повторите шаги для входящего правила протокола удаленного рабочего стола с приведенными ниже другими значениями.
   - **Диапазоны портов назначения**. Введите *3389*.
   - **Приоритет**. Введите *200*. 
   - **Name** (Имя). Введите *MyRDPRule*. 
   - **Описание**: Введите *Разрешить RDP*. 
 
### <a name="install-iis"></a>Установка служб IIS

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем в списке ресурсов выберите виртуальную машину **myVM1**, расположенную в группе ресурсов *myResourceGroupSLB*.
2. На странице **обзора** щелкните **Подключить**, чтобы подключиться по протоколу RDP к виртуальной машине.
5. Войдите в виртуальную машину, используя учетные данные, указанные во время ее создания. Откроется сеанс удаленного рабочего стола с виртуальной машиной *myVM1*.
6. На рабочем столе сервера перейдите к **Средства администрирования Windows**>**Windows PowerShell**.
7. В окне PowerShell выполните следующие команды, чтобы установить сервер IIS, удалить файл по умолчанию iisstart.htm и добавить новый файл iisstart.htm с именем виртуальной машины:

   ```azurepowershell-interactive
    
    # install IIS server role
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    
    # remove default htm file
     remove-item  C:\inetpub\wwwroot\iisstart.htm
    
    # Add a new htm file that displays server name
     Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
   ```
6. Закройте сеанс RDP для *myVM1*.
7. Повторите шаги 1–6, чтобы установить IIS и добавить обновленный файл iisstart.htm на *myVM2* и *myVM3*.

## <a name="test-the-load-balancer"></a>Тестирование Load Balancer
1. Найдите общедоступный IP-адрес для подсистемы балансировки нагрузки на экране **обзора**. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем — **myPublicIP**.

2. Скопируйте общедоступный IP-адрес и вставьте его в адресную строку браузера. В браузере отобразится страница по умолчанию веб-сервера IIS.

   ![Веб-сервер IIS](./media/tutorial-load-balancer-standard-zonal-portal/load-balancer-test.png)

Чтобы служба Load Balancer распределяла трафик по всем трем виртуальным машинам, вы можете настроить стандартную страницу веб-сервера IIS каждой из них, а затем принудительно обновить браузер с клиентского компьютера.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если больше нет необходимости в Load Balancer и всех связанных ресурсах, их можно удалить. Для этого выберите группу ресурсов (*myResouceGroupSLB*), содержащую Load Balancer, и щелкните **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

Из этого краткого руководства вы узнали, как создать Load Balancer (цен. категория "Стандартный"), подключить к ней виртуальные машины, настроить правило трафика Load Balancer, пробу работоспособности, а также протестировать Load Balancer. Дополнительные сведения о Azure Load Balancer см. в руководстве [Распределение нагрузки виртуальных машин в пределах зон доступности с помощью Load Balancer уровня "Стандартный" и портала Azure](tutorial-load-balancer-standard-public-zone-redundant-portal.md).

Дополнительные сведения см. в статье [Standard Load Balancer and Availability Zones](load-balancer-standard-availability-zones.md) (Azure Load Balancer ценовой категории "Стандартный" и зоны доступности).
