---
title: Что такое Azure Load Balancer (цен. категория "Стандартный")
titleSuffix: Azure Load Balancer
description: По этой схеме обучения приступайте к работе с обзором функций Load Balancer (цен. категория "Стандартный") Azure.
services: load-balancer
documentationcenter: na
author: asudbring
manager: twooley
ms.custom: seodec18
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 11/21/2019
ms.author: allensu
ms.openlocfilehash: 36035d844237115361ccb3c1e1bc0dcb91250881
ms.sourcegitcommit: 4c831e768bb43e232de9738b363063590faa0472
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2019
ms.locfileid: "74423875"
---
# <a name="azure-standard-load-balancer-overview"></a>Обзор Azure Load Balancer (цен. категория "Стандартный")

Azure Load Balancer позволяет масштабировать приложения и обеспечивать высокий уровень доступности для служб. Load Balancer может использоваться в сценариях входящих и исходящих подключений, обеспечивает низкую задержку и высокую пропускную способность, а также увеличение масштаба до миллионов потоков для всех приложений, которые используют протоколы TCP и UDP. 

В этой статье рассматривается Load Balancer уровня "Стандартный".  Общий обзор Azure Load Balancer см. в [этой статье](load-balancer-overview.md).

## <a name="what-is-standard-load-balancer"></a>Что такое Load Balancer уровня "Стандартный"

Load Balancer уровня "Стандартный" — это новый тип Load Balancer, предназначенный для всех приложений TCP и UDP с расширенным и более детальным набором функций, чем в Load Balancer уровня "Базовый".  Хотя между ними есть много общего, важно ознакомиться с различиями, изложенными в этой статье.

Load Balancer можно использовать в качестве внешней или внутренней подсистемы балансировки нагрузки. Виртуальную машину можно подключить к одному общедоступному и одному внутреннему ресурсу Load Balancer.

Функции ресурса Load Balancer всегда выражаются в виде внешнего интерфейса, правила, проверки работоспособности и определения серверного пула.  Ресурс может содержать несколько правил. Виртуальные машины можно поместить в серверный пул, указав его из ресурса сетевого интерфейса виртуальной машины.  При использовании масштабируемого набора виртуальных машин этот параметр передается через сетевой профиль и развертывается.

Одним ключевым аспектом является область виртуальной сети для ресурса.  Хотя Load Balancer уровня "Базовый" расположен в рамках области группы доступности, Load Balancer уровня "Стандартный" полностью интегрирован в область виртуальной сети и к нему применяются все понятия виртуальной сети.

Ресурсы Load Balancer представляют собой объекты, в которых можно выразить, как служба Azure должна запрограммировать свою мультитенантную инфраструктуру, чтобы получить сценарий, который необходимо создать.  Между ресурсами Load Balancer и фактической инфраструктурой нет прямой связи. При создании Load Balancer экземпляр не создается, емкость всегда доступна, а задержки запуска или масштабирования отсутствуют. 

>[!NOTE]
> Azure предоставляет набор полностью управляемых решений балансировки нагрузки для пользовательских сценариев. Если вы ищете прерывание протокола TLS ("разгрузка SSL") или запрос HTTP/HTTPS, обработка уровня приложения, см. в статье [что такое шлюз приложений Azure?](../application-gateway/overview.md) Если вы ищете глобальную балансировку нагрузки DNS, см [. статью что такое диспетчер трафика?](../traffic-manager/traffic-manager-overview.md) В комплексных сценариях может быть целесообразно объединить эти решения.
>
> Сравнение параметров балансировки нагрузки Azure см. в статье [Общие сведения о параметрах балансировки нагрузки в Azure](https://docs.microsoft.com/azure/architecture/guide/technology-choices/load-balancing-overview).

## <a name="why-use-standard-load-balancer"></a>Зачем использовать Load Balancer уровня "Стандартный"

Load Balancer уровня "Стандартный" позволяет масштабировать приложения и обеспечивать высокий уровень доступности в небольших развертываниях, а также в больших и сложных многозонных архитектурах.

В таблице ниже приведен обзор различий между Load Balancer уровня "Стандартный" и Load Balancer уровня "Базовый":

>[!NOTE]
> В новых проектах рекомендуем использовать Load Balancer (ценовая категория "Стандартный"). 

[!INCLUDE [comparison table](../../includes/load-balancer-comparison-table.md)]

Ознакомьтесь с [ограничениями службы для Load Balancer](https://aka.ms/lblimits), а также [ценами](https://aka.ms/lbpricing) и [соглашением об уровне обслуживания](https://aka.ms/lbsla).


### <a name="backend"></a>Серверный пул

Серверные пулы Load Balancer (цен. категория "Стандартный") охватывают любой ресурс виртуальной машины в виртуальной сети.  Он может содержать до 1000 серверных экземпляров.  Серверным экземпляром выступает IP-конфигурация, которая является свойством ресурса сетевого интерфейса.

Серверный пул может содержать отдельные виртуальные машины, группы доступности или масштабируемые наборы виртуальных машин.  Вы также можете смешивать ресурсы во внутреннем пуле. Во внутреннем пуле можно объединять до 150 ресурсов для каждого ресурса подсистемы балансировки нагрузки.

Вы можете спроектировать серверный пул, содержащий наименьшее количество ресурсов, чтобы в дальнейшем оптимизировать длительность операций управления.  Нет никаких различий в производительности или масштабировании плоскости данных.

### <a name="probes"></a>Пробы работоспособности
  
В Load Balancer (цен. категория "Стандартный") добавлена поддержка [проб работоспособности HTTPS](load-balancer-custom-probe-overview.md#httpprobe) (проба HTTP с оболочкой TLS) для точного мониторинга приложений HTTPS.  

Кроме того, когда во всем серверном пуле [пробы завершаются сбоем](load-balancer-custom-probe-overview.md#probedown), Load Balancer (цен. категория "Стандартный") обеспечивает дальнейшую работу всех установленных подключений по протоколу TCP (Load Balancer (цен. категория "Базовый") в таком случае прерывает все TCP-подключения ко всем экземплярам).

Дополнительные сведения см. в статье [Пробы работоспособности Load Balancer](load-balancer-custom-probe-overview.md).

### <a name="az"></a>Зоны доступности

>[!IMPORTANT]
>Ознакомьтесь [зоны доступности](../availability-zones/az-overview.md) по связанным темам, включая сведения о различных регионах.

Load Balancer уровня "Стандартный" поддерживает дополнительные возможности в регионах, где доступны зоны доступности.  Эти функции являются добавочными для всех Load Balancer уровня "Стандартный".  Конфигурации зон доступности доступны для общедоступных и внутренних Load Balancer уровня "Стандартный".

Незональные внешние интерфейсы по умолчанию становятся избыточными между зонами при развертывании в регионе с зонами доступности.   Внешний интерфейс, избыточный между зонами, выдерживает сбой зоны и обслуживается выделенной инфраструктурой во всех зонах одновременно. 

Кроме того, вы можете гарантировать использование внешнего интерфейса в определенной зоне. Зональные внешние интерфейсы разделяют участь соответствующей зоны и обслуживаются только выделенной инфраструктурой в одной зоне.

Для серверного пула доступна межзональная балансировка нагрузки, а любой ресурс виртуальной машины в виртуальной сети может быть частью серверного пула.

Ознакомьтесь со статьей [Azure Load Balancer уровня "Стандартный" и зоны доступности](load-balancer-standard-availability-zones.md).

### <a name="diagnostics"></a>Диагностика

Load Balancer уровня "Стандартный" предоставляет многомерные метрики через Azure Monitor.  Эти метрики можно отфильтровать, сгруппировать и разбить по предоставленным измерениям.  Они предоставляют текущие и исторические сведения о производительности и работоспособности службы.  Также поддерживается служба "Работоспособность ресурсов".  Ниже приведен краткий обзор поддерживаемых метрик диагностики.

| Метрика | ОПИСАНИЕ |
| --- | --- |
| Доступность виртуального IP-адреса | Load Balancer (цен. категория "Стандартный") непрерывно использует путь к данным из региона к внешнему интерфейсу Load Balancer, а затем в стек SDN, поддерживающий виртуальную машину. Пока остаются работоспособные экземпляры, измерение выполняется по тому же пути, что и трафик приложения с балансировкой нагрузки. Проверяется также путь к данным, который могут использовать ваши клиенты. Измерение является невидимым для приложения и не влияет на работоспособность других операций.|
| Доступность выделенного IP-адреса (DIP) | Load Balancer уровня "Стандартный" использует распределенную службу проверки работоспособности, которая контролирует состояние конечной точки приложения в соответствии с параметрами конфигурации. Эта метрика обеспечивает агрегированное или отфильтрованное представление для каждой отдельной конечной точки экземпляра в пуле Load Balancer.  Вы можете видеть, как Load Balancer просматривает работоспособность вашего приложения, как указано в конфигурации зонда работоспособности.
| Пакеты SYN | Load Balancer уровня "Стандартный" не прерывает TCP-подключения и не взаимодействует с потоками пакетов TCP и UDP. Потоки и их подтверждения всегда происходят между источником и экземпляром виртуальной машины. Чтобы оптимизировать устранение неполадок для всех сценариев протокола TCP, вы можете использовать счетчики пакетов SYN. С их помощью можно определить число попыток подключения TCP. Эта метрика указывает количество принятых пакетов TCP SYN.|
| Подключения SNAT | Load Balancer (цен. категория "Стандартный") передает число замаскированных исходящих потоков на общедоступный внешний интерфейс IP-адреса. SNAT-порты являются ограниченным ресурсом. Эта метрика может дать представление о том, насколько сильно ваше приложение зависит от SNAT для исходящих потоков.  Выводятся данные счетчиков для успешного и неудачного выполнения исходящих потоков SNAT. Эти данные помогают устранять неполадки и определять работоспособность исходящих потоков.|
| Счетчики байтов | Load Balancer (цен. категория "Стандартный") передает количество данных, обработанных каждым внешним интерфейсом.|
| Счетчики пакетов | Load Balancer (цен. категория "Стандартный") передает количество пакетов, обработанных каждым внешним интерфейсом.|

Ознакомьтесь со статьей [Metrics and health diagnostics for Standard Load Balancer](load-balancer-standard-diagnostics.md) (Метрики и проверки работоспособности Load Balancer уровня "Стандартный").

### <a name="haports"></a>Порты HA

Load Balancer уровня "Стандартный" поддерживает новый тип правил.  

Вы можете настроить правила балансировки нагрузки, чтобы масштабировать приложение и сделать его более надежным. При использовании правила балансировки нагрузки портов НА Load Balancer (цен. категория "Стандартный") предоставляет балансировку нагрузки по каждому потоку на каждом временном порту интерфейсного IP-адреса внутреннего Load Balancer (цен. категория "Стандартный").  Эта функция также полезна для других сценариев, где нецелесообразно или нежелательно указывать отдельные порты.

Правило балансировки нагрузки портов НА позволяет создавать сценарии n+1 в режиме "активный — пассивный" или "активный — активный" для виртуальных сетевых модулей и любых приложений, которым требуются большие диапазоны входящих портов.  Проверку работоспособности можно использовать для определения того, какие серверные части должны получать новые потоки.  Группу безопасности сети можно использовать для эмуляции сценария с диапазоном портов.

>[!IMPORTANT]
> Если вы планируете использовать виртуальный сетевой модуль, обратитесь к своему поставщику, чтобы узнать, был ли его продукт протестирован с использованием портов HA, и выполните предоставленные им конкретные рекомендации по реализации. 

Ознакомьтесь со статьей [Общие сведения о портах с высоким уровнем доступности](load-balancer-ha-ports-overview.md).

### <a name="securebydefault"></a>Обеспечение безопасности по умолчанию

Load Balancer уровня "Стандартный" полностью подключен к виртуальной сети.  Это частная закрытая сеть.  Так как Load Balancer уровня "Стандартный" и стандартные общедоступные IP-адреса позволяют подключаться к этой виртуальной сети извне ее пределов, эти ресурсы по умолчанию являются закрытыми, если не открыть их. Это означает, что группы безопасности сети (NSG) теперь используются, чтобы явно внести трафик в список разрешений.  Можно создать виртуальный центр обработки данных и с помощью группы безопасности сети настроить, когда он должен быть доступен.  Если у вас нет NSG в подсети или сетевого интерфейса ресурса виртуальной машины, трафик не может достичь этого ресурса.

Дополнительные сведения о группах безопасности сети и способах их применения в вашем сценарии см. в статье [Фильтрация сетевого трафика с помощью групп безопасности сети](../virtual-network/security-overview.md).

### <a name="outbound"></a>Исходящие подключения

Load Balancer поддерживает сценарии входящих и исходящих подключений.  Load Balancer (цен. категория "Стандартный") значительно отличается от Load Balancer (цен. категория "Базовый") в отношении исходящих подключений.

Преобразование адресов исходной сети (SNAT) используется для сопоставления внутренних частных IP-адресов в вашей виртуальной сети с общедоступными IP-адресами во внешних интерфейсах Load Balancer.

Load Balancer уровня "Стандартный" предоставляет новый [более надежный, масштабируемый и предсказуемый алгоритм SNAT](load-balancer-outbound-connections.md#snat), содержит новые возможности, удаляет неоднозначности и создает явные конфигурации, а не побочные эффекты. Эти изменения необходимы для возникновения новых функций. 

Это ключевые принципы, которые необходимо помнить при работе с Load Balancer уровня "Стандартный":

- Работа ресурса Load Balancer зависит от выполнения правила.  Все программирование Azure Load Balancer является производным от его конфигурации.
- Когда доступно несколько внешних интерфейсов, все они используются и каждый из них увеличивает количество доступных SNAT-портов.
- Если вы не хотите, чтобы какой-либо определенный внешний интерфейс использовался для исходящих подключений, вы можете исключить это.
- Исходящие сценарии — явные, а исходящих подключений не существует, пока они не были указаны.
- Правила балансировки нагрузки определяют способ программирования SNAT. Правила балансировки нагрузки зависят от протокола. SNAT зависит от протокола, и конфигурация должна это отражать, а не создавать побочный эффект.

#### <a name="multiple-frontends"></a>Несколько внешних интерфейсов
Если вам нужно больше портов SNAT, так как вы ожидаете или уже получаете большое количество запросов на исходящие подключения, можно добавить дополнительный порт SNAT путем настройки дополнительных внешних интерфейсов, правил и серверных пулов для тех же ресурсов виртуальных машин.

#### <a name="control-which-frontend-is-used-for-outbound"></a>Выбор внешнего интерфейса, который будет использоваться для исходящего трафика
Если необходимо ограничить исходящие подключения до исходящих только из определенного интерфейсного IP-адреса, можно отключить исходящие SNAT-подключения в правиле, которое выражает исходящие сопоставления.

#### <a name="control-outbound-connectivity"></a>Управление исходящими подключениями
Load Balancer уровня "Стандартный" существует в контексте виртуальной сети.  Это изолированная частная сеть.  Если связь с общедоступным IP-адресом отсутствует, подключение к общедоступным сетям запрещено.  К [конечным точкам службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md) можно получить доступ, так как они находятся внутри и расположены локально в виртуальной сети.  Если вы хотите установить исходящее подключение к пункту назначения извне виртуальной сети, у вас есть два варианта:
- присвоить ресурсу виртуальной машины общедоступный IP-адрес SKU "Стандартный" в качестве общедоступного IP-адреса уровня экземпляра или
- разместить ресурс виртуальной машины в серверном пуле общедоступного Load Balancer уровня "Стандартный".

Оба варианта позволяют выполнять исходящие подключения из виртуальной сети за ее пределы. 

Если у вас есть _только_ внутренний Load Balancer уровня "Стандартный", связанный с серверным пулом, в котором расположен ресурс виртуальной машины, ваша виртуальная машина может получить доступ только к ресурсам виртуальной машины и [конечным точкам службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).  Чтобы создать исходящее подключение, следуйте действиям, описанным в этом разделе выше.

Исходящее подключение к ресурсу виртуальной машины, не связанному со SKU "Стандартный", остается прежним.

Ознакомьтесь со статьей [Исходящие подключения в Azure](load-balancer-outbound-connections.md).

### <a name="multife"></a>Несколько внешних интерфейсов
Load Balancer поддерживает несколько правил с несколькими внешними интерфейсами.  В Load Balancer уровня "Стандартный" их можно использовать в сценариях исходящих подключений.  Сценарии исходящих подключений по существу являются противоположностью правила балансировки нагрузки входящих подключений.  Правило балансировки нагрузки входящих подключений также создает связь для исходящих подключений. Load Balancer (цен. категория "Стандартный") использует все внешние интерфейсы, связанные с ресурсом виртуальной машины, через правило балансировки нагрузки.  Кроме того, в правиле балансировки нагрузки есть параметр, позволяющий отключить это правило для исходящих подключений. Также можно выбрать определенные внешние интерфейсы или не выбирать никаких.

Для сравнения: Load Balancer уровня "Базовый" случайным образом выбирает один внешний интерфейс и невозможно узнать, какой из них был выбран.

Ознакомьтесь со статьей [Исходящие подключения в Azure](load-balancer-outbound-connections.md).

### <a name="operations"></a>Операции управления

Ресурсы Load Balancer уровня "Стандартный" существуют на совершенно новой платформе инфраструктуры.  Это позволяет ускорить операции управления для SKU "Стандартный", а время выполнения обычно составляет менее 30 секунд на ресурс SKU "Стандартный".  По мере увеличения серверных пулов в размере время, требуемое для их изменения, также увеличивается.

Ресурсы Load Balancer уровня "Стандартный" можно изменить. Кроме того, стандартные общедоступные IP-адреса можно перемещать из одной виртуальной машины в другую значительно быстрее.

## <a name="migration-between-skus"></a>Переход между номерами SKU

Номера SKU неизменяемы. Если вы хотите перейти с одного номера SKU ресурса на другой, выполните следующие действия.

>[!IMPORTANT]
>Прочтите этот документ полностью, чтобы понять различия между разными SKU и тщательно проверить свой сценарий.  Возможно, вам потребуется внести дополнительные изменения в сценарий.

### <a name="migrate-from-basic-to-standard-sku"></a>Переход с номера SKU "Базовый" на "Стандартный"

1. Создайте ресурс уровня "Стандартный" (Load Balancer и общедоступные IP-адреса по мере необходимости). Заново создайте свои правила и определения зонда.  Если ранее на порту 443/tcp использовалась проба TCP, рекомендуем изменить протокол пробы на HTTPS и добавить путь.

2. Создайте новую или обновите существующую группу NSG в сетевом интерфейсе или подсети, чтобы указать в списке разрешений трафик с балансировкой нагрузки, зонд и другой трафик, который нужно разрешить.

3. Удалите ресурсы номера SKU уровня "Базовый" (общедоступные IP-адреса и Load Balancer) для всех экземпляров виртуальной машины. Не забудьте также удалить все экземпляры виртуальной машины группы доступности.

4. Подключите все экземпляры виртуальной машины к новому ресурсу с номером SKU уровня "Стандартный".

### <a name="migrate-from-standard-to-basic-sku"></a>Переход с номера SKU "Стандартный" на "Базовый"

1. Создайте ресурс уровня "Базовый" (Load Balancer и общедоступные IP-адреса по мере необходимости). Заново создайте свои правила и определения зонда.  Измените пробу HTTPS на пробу TCP на порту 443/tcp. 

2. Удалите ресурсы номера SKU уровня "Стандартный" (общедоступные IP-адреса и Load Balancer) для всех экземпляров виртуальной машины. Не забудьте также удалить все экземпляры виртуальной машины группы доступности.

3. Подключите все экземпляры виртуальной машины к новому ресурсу с номером SKU уровня "Базовый".

>[!IMPORTANT]
>
>Существуют ограничения на использование номеров SKU "Стандартный" и "Базовый".
>
>Порты высокой доступности и диагностика номера SKU уровня "Стандартный" доступны только в номерах SKU уровня "Стандартный". Нельзя перейти с уровня "Стандартный" на уровень "Базовый" и сохранить эту функциональность.
>
>Оба SKU и уровня "Базовый", и уровня "Стандартный" имеют ряд различий, как описано в этой статье.  Убедитесь в том, что вы понимаете их, и подготовьтесь к ним.
>
>Необходимо использовать соответствующие номера SKU для Load Balancer и общедоступных IP-ресурсов. Невозможно объединить ресурсы номера SKU уровня "Базовый" и "Стандартный". Изолированные виртуальные машины, виртуальные машины в ресурсе группы доступности и ресурсы масштабируемого набора виртуальных машин нельзя подключить к обоим SKU одновременно.

## <a name="region-availability"></a>Регионы доступности

Load Balancer (цен. категория "Стандартный") сейчас доступен во всех регионах общедоступного облака.

## <a name="sla"></a>Соглашение об уровне обслуживания

Load Balancer уровня "Стандартный" доступен с соглашением об уровне обслуживания, гарантирующим доступность на уровне 99,99 %.  Дополнительные сведения см. в статье [Соглашение об уровне обслуживания для Load Balancer](https://aka.ms/lbsla).

## <a name="pricing"></a>Цены

За использование Load Balancer (цен. категория "Стандартный") взимается плата, размер которой зависит от таких факторов:

- количество настроенных правил балансировки нагрузки и правил для исходящего трафика (правила NAT для входящего трафика не учитываются в общем количестве правил);
- обработанного объема входящих и исходящих данных независимо от правил. 

Сведения о ценах на Load Balancer уровня "Стандартный" см. на [странице цен](https://azure.microsoft.com/pricing/details/load-balancer/).

## <a name="limitations"></a>Ограничения

- Номера SKU неизменяемы. Вы не можете изменить номер SKU существующего ресурса.
- Изолированный ресурс виртуальной машины, ресурс группы доступности или ресурс масштабируемого набора виртуальных машин могут ссылаться на один SKU, но никогда на оба.
- Правило Load Balancer не может охватывать две виртуальные сети.  Внешние интерфейсы и связанные серверные экземпляры должны быть расположены в одной виртуальной сети.  
- [Операции перемещения подписки](../azure-resource-manager/resource-group-move-resources.md) не поддерживаются для ресурсов LB и PIP номера SKU "Стандартный".
- Рабочие веб-роли без виртуальной сети и другие службы платформы Майкрософт могут быть доступны при использовании только внутренней подсистемы Load Balancer уровня "Стандартный" из-за побочного эффекта от того, как работают службы, созданные до использования виртуальной сети, и другие функции служб платформы. Вы не должны полагаться на это, так как соответствующая служба или базовая платформа могут измениться без уведомления. Вы всегда должны предполагать, что вам при необходимости нужно явно создать [исходящее подключение](load-balancer-outbound-connections.md) при использовании только Load Balancer уровня "Стандартный".
- Load Balancer — это продукт TCP или UDP для балансировки нагрузки и перенаправления портов для этих протоколов IP.  Правила балансировки нагрузки и правила NAT для входящих подключений поддерживаются для TCP и UDP, но не поддерживаются для других протоколов IP, в том числе ICMP. Load Balancer не завершает полезные данные потока UDP или TCP, не отвечает на них и не взаимодействует с ними каким-либо другим способом. Это не прокси-сервер. Успешная проверка подключения к внешнему интерфейсу должна проходить через канал по тому же протоколу, который используется в правиле балансировки нагрузки или NAT для входящих подключений (TCP или UDP), _и_ по крайней мере одна из ваших виртуальных машин должна генерировать ответ внешнего интерфейса для клиента.  Если ответ по каналу от внешнего интерфейса Load Balancer не получен, это означает, что никакие виртуальные машины не могли дать ответ.  С внешним интерфейсом Load Balancer невозможно взаимодействовать, если виртуальная машина не может отвечать.  Это также применимо к исходящим подключениям, в которых [SNAT с маскировкой портов](load-balancer-outbound-connections.md#snat) поддерживается только для TCP и UDP. Использование любых других протоколов IP, включая ICMP, также приведет к сбою.  Назначьте общедоступный IP-адрес на уровне экземпляра для обхода проблемы.
- В отличие от общедоступных Load Balancer, предоставляющих [исходящие подключения](load-balancer-outbound-connections.md) при переходе с частных IP-адресов виртуальной сети на общедоступные, внутренний Load Balancer не передает исходящие подключения на внешний интерфейс внутреннего Load Balancer, так как они оба расположены в частном диапазоне IP-адресов.  Это исключает вероятность возникновения нехватки SNAT внутри уникального частного пространства IP-адресов, когда преобразование не требуется.  Побочным эффектом является то, что если исходящий поток из виртуальной машины в серверном пуле направляется к внешнему интерфейсу внутреннего балансировщика нагрузки, в пуле которого она находится, _и_ сопоставляется с собой, оба маршрута потока не совпадают и поток не будет передан.  Если поток не сопоставляется с той же виртуальной машиной в серверном пуле, которая создала поток к внешнему интерфейсу, поток будет успешно передан.   Когда поток сопоставляется с собой, получается, что исходящий поток передается из виртуальной машины на внешний интерфейс, а соответствующий входящий поток поступает от виртуальной машины к себе. С точки зрения гостевой ОС входящие и исходящие части того же потока не совпадают в виртуальной машине. Стек TCP не будет распознавать эти половины одного потока как часть того же потока, так как источник и получатель не совпадают.  При сопоставлении потока с любой другой виртуальной машиной в серверном пуле половины потока будут соответствовать друг другу, и виртуальная машина сможет успешно реагировать на поток.  Симптомом этого сценария является периодическое истечение времени ожидания подключения. Есть несколько общих обходных решений для надежной реализации этого сценария (отправка исходящих потоков из серверного пула в серверные пулы, соответствующие внешнему интерфейсу внутреннего Load Balancer), которые включают либо размещение стороннего прокси-сервера за внутренним Load Balancer или [использование правил стиля DSR](load-balancer-multivip-overview.md).  Хотя вы можете использовать общедоступный Load Balancer в качестве обходного решения, полученный сценарий подвержен [исчерпанию SNAT](load-balancer-outbound-connections.md#snat) и без тщательного управления его следует избегать.

## <a name="next-steps"></a>Дополнительная информация

- Дополнительные сведения о [Load Balancer (цен. категория "Стандартный") и зонах доступности](load-balancer-standard-availability-zones.md).
- Дополнительные сведения о [пробах работоспособности](load-balancer-custom-probe-overview.md).
- Дополнительные сведения о [зонах доступности](../availability-zones/az-overview.md)
- [Metrics and health diagnostics for Standard Load Balancer](load-balancer-standard-diagnostics.md) (Метрики и проверки работоспособности Load Balancer уровня "Стандартный")
- [Поддерживаемые многомерные метрики](../azure-monitor/platform/metrics-supported.md#microsoftnetworkloadbalancers) для диагностики в [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md)
- Дополнительные сведения о [Load Balancer для исходящих подключений](load-balancer-outbound-connections.md).
- Сведения о [правилах для исходящего трафика](load-balancer-outbound-rules-overview.md).
- Сведения о [сбросе TCP-подключений при простое](load-balancer-tcp-reset.md).
- Дополнительные сведения об [использовании Load Balancer (цен. категория "Стандартный") с правилами балансировки нагрузки портов высокого уровня доступности](load-balancer-ha-ports-overview.md).
- Дополнительные сведения об [использовании Load Balancer с несколькими внешними интерфейсами](load-balancer-multivip-overview.md).
- [Что такое виртуальная сеть Azure?](../virtual-network/virtual-networks-overview.md)
- Узнайте больше о [группах безопасности сети](../virtual-network/security-overview.md).
- Дополнительные сведения о [конечных точках службы виртуальной сети](../virtual-network/virtual-network-service-endpoints-overview.md).
- Дополнительные сведения о некоторых других ключевых [сетевых возможностях](../networking/networking-overview.md) Azure.
- Дополнительные сведения о [Load Balancer](load-balancer-overview.md).
