---
title: Настройка балансировки и исходящих правил с помощью портала Azure
titleSuffix: Azure Load Balancer
description: В этой статье показано, как настроить балансировку нагрузки и правила исходящего в Standard Load Balancer с помощью портала Azure.
services: load-balancer
author: asudbring
ms.service: load-balancer
ms.topic: article
ms.date: 09/24/2019
ms.author: allensu
ms.openlocfilehash: b75f49155991bfc71f788ad88f166c0bec281841
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77590017"
---
# <a name="configure-load-balancing-and-outbound-rules-in-standard-load-balancer-by-using-the-azure-portal"></a>Налаживание балансировки нагрузки и исходящих правил в Standard Load Balancer с помощью портала Azure

В этой статье показано, как настроить исходящие правила в Standard Load Balancer с помощью портала Azure.  

Ресурс балансоровы нагрузочки содержит два передних конца и связанные с ними правила. У вас есть один передний конец для входящего трафика и другой передний конец для исходящего трафика.  

Каждый передний конец ссылается на общедоступный IP-адрес. В этом сценарии общедоступный IP-адрес для входящего трафика отличается от адреса исходящего трафика.   Правило балансировки нагрузки обеспечивает только балансировку входящих нагрузок. Исходящие правила контролируют перевод исходящих сетевых адресов (NAT) для VM.  

В сценарии используются два пула бэк-энда: один для входящего трафика и один для исходящего трафика. Эти пулы иллюстрируют возможности и обеспечивают гибкость сценария.

Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F), прежде чем начинать работу. 

## <a name="sign-in-to-azure"></a>Вход в Azure

Войти на портал Azure по адресу [https://portal.azure.com](https://portal.azure.com).

## <a name="create-a-load-balancer"></a>Создание балансировщика нагрузки

В этом разделе создается баланселер нагрузки, который загружает баланс виртуальных машин. Можно создать общественный баланселизатор нагрузки или внутренний балансер нагрузки. При создании балансиста общественной нагрузки создается новый общедоступный IP-адрес, настроенный в качестве фронтена для балансоилира нагрузки. Фронтенд будет называться **LoadBalancerFrontEnd** по умолчанию.

1. В верхней левой части экрана выберите **«Создайте** > **балансослер загрузки****сетей».** > 
2. Во **вкладке «Основы»** страницы **балансировора нагрузки Create** введите или выберите следующую информацию:

    | Параметр                 | Значение                                              |
    | ---                     | ---                                                |
    | Подписка               | Выберите свою подписку.    |    
    | Группа ресурсов         | Выберите **Создать** и в текстовом поле введите **myResourceGroupSLB**.|
    | name                   | **myLoadBalancer**                                   |
    | Регион         | Выберите **Западная Европа**.                                        |
    | Тип          | Щелкните **Общедоступный**.                                        |
    | номер SKU           | Выберите **Стандартный** или **Базовый**. Для производственных рабочих нагрузок компания Майкрософт рекомендует использовать цен. категорию "Стандартный". |
    | Общедоступный IP-адрес | Выберите **Создать**. Если у вас есть существующий общественный IP, который вы хотели бы использовать, выберите **Используйте существующий**.  Существующая публичная ИС должна быть **стандартной** SKU.  Основные общедоступные ИП не совместимы со балансивацией нагрузки **Standard** SKU.  |
    | Имя общедоступного IP-адреса              | Введите **myPublicIP** в текстовом поле.|
    | Зона доступности | Выберите **Зону-излишнюю** для создания упругого баланса нагрузки. Чтобы создать зональный Load Balancer, выберите определенную зону 1, 2 или 3. |

3. Примите по умолчанию для остальной части конфигурации.
4. Выберите **Обзор и создайте**

    > [!IMPORTANT]
    > Остальная часть этого quickstart предполагает, что **Стандартный** SKU выбран в процессе отбора SKU выше.

5. На вкладке **Отзыв и создание** выберите **Создать**.   

    ![Создание подсистемы балансировки нагрузки уровня "Стандартный"](./media/quickstart-load-balancer-standard-public-portal/create-standard-load-balancer.png)

## <a name="create-load-balancer-resources"></a>Создание ресурсов подсистемы балансировки нагрузки

В этом разделе описано, как настроить параметры подсистемы балансировки нагрузки для внутреннего пула адресов, пробы работоспособности, а также указать правила балансировки нагрузки.

### <a name="create-a-backend-pool"></a>Создание внутреннего пула.

Пул адресов бэкэнда содержит IP-адреса виртуальных NICs в пуле бэкэнда. Создайте внутренний пул адресов **myBackendPool**, чтобы включить виртуальные машины для балансировки нагрузки интернет-трафика.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Серверные пулы**, затем щелкните **Добавить**.
3. На странице **Добавление серверного пула** введите имя **myBackEndPool** для серверного пула и выберите **Добавить**.

### <a name="create-a-health-probe"></a>Создание пробы работоспособности

Зонд работоспособности используется для мониторинга состояния вашего приложения. Зонд работоспособности добавляет или удаляет VMs из балансомера нагрузки на основе их реакции на проверки здоровья. Создайте зонд работоспособности **myHealthProbe**, чтобы отслеживать работоспособность виртуальных машин.

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Пробы работоспособности**, а затем щелкните **Добавить**.
    
    | Параметр | Значение |
    | ------- | ----- |
    | name | Введите **myHealthProbe**. |
    | Протокол | Выберите **HTTP**. |
    | Порт | Введите **80**.|
    | Интервал | В качестве **интервала** между попытками выполнения пробы (в секундах) введите **15**. |
    | Пороговое значение сбоя | Выберите **2** в качестве значения **порога состояния неработоспособности** или количества последовательных сбоев пробы, после которых виртуальная машина будет считаться неработоспособной.|
    | | |
4. Нажмите кнопку **ОК**.

### <a name="create-a-load-balancer-rule"></a>Создание правила балансировщика нагрузки
Правило балансировщика нагрузки позволяет определить распределение трафика между виртуальными машинами. 

Вы определяете:
 - Конфигурация IP-адреса Frontend для входящего трафика.
 - Пул IP бэкэнда для получения трафика.
 - Необходимый источник и порт назначения. 

В следующем разделе создается:
 - Правило балансобаланса нагрузки **myHTTPRule** для прослушивания порта 80.
 - Frontend **LoadBalancerFrontEnd**.
 - Бэкэнд адрес бассейн **myBackEndPool** также с помощью порта 80. 

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.
2. В разделе **Параметры** выберите **Правила балансировки нагрузки**, а затем щелкните **Добавить**.
3. Для настройки правила балансировки нагрузки используйте следующие значения.
    
    | Параметр | Значение |
    | ------- | ----- |
    | name | Введите **myHTTPRule**. |
    | Протокол | Выберите **TCP**. |
    | Порт | Введите **80**.|
    | Серверный порт | Введите **80**. |
    | Серверный пул | Выберите **myBackendPool**.|
    | Проверка работоспособности | Выберите **myHealthProbe**. |
    | Создание неявных исходящих правил | Выберите вариант **Нет**. Мы создадим правила исходящих в более позднем разделе с использованием специального общедоступного IP-адреса. |
4. Сохраните остальные значения по умолчанию и нажмите кнопку **ОК**.

## <a name="create-outbound-rule-configuration"></a>Создание конфигурации исходящих правил
Правила исходящего баланса нагрузки настраивают исходящие SNAT для ВМ в пуле бэкэнда. 

### <a name="create-an-outbound-public-ip-address-and-frontend"></a>Создание исходящего публичного IP-адреса и фронтэнда

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.

2. В **настройках**выберите **конфигурацию Frontend IP,** затем выберите **Добавить.**

3. Используйте эти значения для настройки конфигурации IP-адреса переднего энда для исходящих:

    | Параметр | Значение |
    | ------- | ----- |
    | name | Введите **LoadBalancerFrontEndOutbound**. |
    | Версия IP | Выберите **IPv4**. |
    | Тип IP | Выберите **IP-адрес**.|
    | Общедоступный IP-адрес | Выберите **Создать**. В **добавлении общедоступного IP-адреса**введите **myPublicIPOutbound**.  Нажмите кнопку **ОК**. |

4. Нажмите кнопку **Добавить**.

### <a name="create-an-outbound-backend-pool"></a>Создание исходящего пула бэкэнда

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.

2. В разделе **Параметры** выберите **Серверные пулы**, затем щелкните **Добавить**.

3. На странице **бэкэндпула,** для имени, введите **myBackendPoolOutbound**, как имя для вашего бэкэнда пула, а затем выберите **Добавить.**

### <a name="create-outbound-rule"></a>Создание правила для исходящего трафика

1. В меню слева щелкните **Все службы**, выберите **Все ресурсы**, а затем из списка ресурсов выберите **myLoadBalancer**.

2. В **настройках**выберите **правила исходящих,** затем выберите **Добавить.**

3. Используйте эти значения для настройки исходящих правил:

    | Параметр | Значение |
    | ------- | ----- |
    | name | Введите **myOutboundRule**. |
    | Интерфейсный IP-адрес | Выберите **LoadBalancerFrontEndOutbound**. |
    | Время ожидания простоя (в минутах) | Переместите ползунок на 15 минут.|
    | TCP Перезагрузка | Выберите **Включено**.|
    | Серверный пул | Выберите **myBackendPoolOutbound** |
    | Распределение портов - > распределение порта | Выберите **вручную выбрать число исходящих портов** |
    | Исходящие порты - > Выберите | Выберите **Порты на экземпляр** |
    | Исходящие порты - > порты на экземпляр | Введите **10 000**. |

4. Нажмите кнопку **Добавить**.

## <a name="clean-up-resources"></a>Очистка ресурсов

Ставшие ненужными группу ресурсов, подсистему балансировки нагрузки и все связанные ресурсы можно удалить. Выберите группу ресурсов **myResourceGroupSLB,** содержащую балансизатор нагрузки, а затем выберите **Удалить.**

## <a name="next-steps"></a>Дальнейшие действия

В этой статье:
 - Вы создали стандартный балансера нагрузки.
 - Настроенкак как входящие, так и исходящие правила движения грузоподъемно-балансового баланса.
 - Настроил зонд работоспособности для VMs в пуле бэк-энда. 

Чтобы узнать больше, перейти к [учебникам для Azure Load Balancer](tutorial-load-balancer-standard-public-zone-redundant-portal.md).
