---
title: Переход с базового внутреннего на стандартный внутренний Azure Load Balancer
description: В этой статье показано, как обновить внутренний Load Balancer Azure с SKU "базовый" до SKU "Стандартный"
services: load-balancer
author: irenehua
ms.service: load-balancer
ms.topic: article
ms.date: 02/23/2020
ms.author: irenehua
ms.openlocfilehash: 543227ac9c07207112177dfaccbd00723b61a314
ms.sourcegitcommit: f27b045f7425d1d639cf0ff4bcf4752bf4d962d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/23/2020
ms.locfileid: "77566404"
---
# <a name="upgrade-azure-internal-load-balancer-from-basic-sku-to-standard-sku"></a>Обновление внутреннего Load Balancer Azure с SKU "базовый" до SKU "Стандартный"
[Azure Load Balancer (цен. Категория "Стандартный")](load-balancer-overview.md) предлагает широкий набор функций и высокий уровень доступности через избыточность зоны. Дополнительные сведения о Load Balancer SKU см. в разделе [Таблица сравнения](https://docs.microsoft.com/azure/load-balancer/concepts-limitations#skus).

Обновление выполняется в два этапа.

1. Перенос конфигурации
2. Добавление виртуальных машин в серверные пулы Load Balancer (цен. категория "Стандартный")

В этой статье рассматривается миграция конфигурации. Добавление виртуальных машин в серверные пулы может зависеть от конкретной среды. Однако некоторые общие рекомендации [предоставляются](#add-vms-to-backend-pools-of-standard-load-balancer)на высоком уровне.

## <a name="upgrade-overview"></a>Общие сведения об обновлении

Доступен сценарий Azure PowerShell, который выполняет следующие действия:

* Создает стандартный внутренний номер SKU Load Balancer в группе ресурсов и расположении, которое вы указали.
* Без проблем копирует конфигурации базового SKU уровня "базовый" Load Balancer на новый внутренний Load Balancer "Стандартный".

### <a name="caveatslimitations"></a>кавеатс\лимитатионс

* Скрипт поддерживает только внутреннее Load Balancer обновление. Для внутреннего базового Load Balancer обновления создайте стандартную внутреннюю Load Balancer, если не требуется исходящее подключение, и создайте стандартное внутреннее Load Balancer и стандартный внутренний Load Balancer, если необходимо исходящее подключение.
* Load Balancer (цен. категория "Стандартный") содержит новые общедоступные адреса. Невозможно легко переместить IP-адреса, связанные с существующими базовыми Load Balancer, в Load Balancer (цен. категория "Стандартный"), так как они имеют разные номера SKU.
* Если стандартный балансировщик нагрузки создан в другом регионе, вы не сможете связать существующие виртуальные машины в старом регионе с вновь созданной Load Balancer (цен. категория "Стандартный"). Чтобы обойти это ограничение, обязательно создайте новую виртуальную машину в новом регионе.
* Если у Load Balancer нет внешней IP-конфигурации или серверного пула, то, скорее всего, будет обнаружена ошибка, которая вызвала бы выполнение скрипта. Убедитесь, что они не пусты.

## <a name="download-the-script"></a>Скачивание скрипта

Скачайте скрипт миграции из [коллекция PowerShell](https://www.powershellgallery.com/packages/AzureILBUpgrade/1.0).
## <a name="use-the-script"></a>Использование скрипта

В зависимости от настроек и настроек локальной среды PowerShell существует два варианта.

* Если вы не установили модули Azure az или не хотите удалять модули Azure AZ, лучшим вариантом будет использование параметра `Install-Script` для запуска скрипта.
* Если вам нужно разместить модули Azure AZ, лучше скачать сценарий и запустить его напрямую.

Чтобы определить, установлены ли модули Azure AZ, запустите `Get-InstalledModule -Name az`. Если вы не видите ни одного установленного модуля AZ, то можете использовать метод `Install-Script`.

### <a name="install-using-the-install-script-method"></a>Установка с помощью метода Install-Script

Чтобы использовать этот параметр, на компьютере не должны быть установлены модули Azure AZ. Если они установлены, следующая команда выводит сообщение об ошибке. Можно либо удалить модули Azure AZ, либо воспользоваться другим параметром, чтобы скачать скрипт вручную и запустить его.
  
Выполните скрипт с помощью следующей команды:

`Install-Script -Name AzureILBUpgrade`

Эта команда также устанавливает необходимые модули AZ.  

### <a name="install-using-the-script-directly"></a>Установка непосредственно с помощью скрипта

Если у вас установлены некоторые модули Azure AZ и их невозможно удалить (или не хотите удалять их), можно вручную скачать скрипт, используя вкладку **Загрузка вручную** в ссылке Загрузить скрипт. Скрипт загружается как необработанный файл nupkg. Сведения об установке скрипта из этого файла nupkg см. в разделе [Загрузка пакета вручную](/powershell/scripting/gallery/how-to/working-with-packages/manual-download).

Чтобы запустить скрипт, выполните следующие действия.

1. Используйте `Connect-AzAccount` для подключения к Azure.

1. Для импорта модулей AZ используйте `Import-Module Az`.

1. Проверьте обязательные параметры:

   * **rgName: [строка]: обязательно** — это группа ресурсов для существующих базовых Load Balancer и новых Load Balancer (цен. Категория "Стандартный"). Чтобы найти это строковое значение, перейдите к портал Azure, выберите основной источник Load Balancer и щелкните **Обзор** подсистемы балансировки нагрузки. Группа ресурсов находится на этой странице.
   * **олдлбнаме: [строка]: обязательно** — это имя существующего балансировщика базовой подсистемы, которую требуется обновить. 
   * **newlocation: [строка]: required** — расположение, в котором будет создана Load Balancer (цен. Категория "Стандартный"). Рекомендуется наследовать то же расположение выбранного базового Load Balancer Load Balancer (цен. категория "Стандартный") для лучшего сопоставления с другими существующими ресурсами.
   * **невлбнаме: [строка]: required** — это имя создаваемого Load Balancer (цен. Категория "Стандартный").
1. Запустите скрипт, используя соответствующие параметры. Для завершения может потребоваться от 5 до семи минут.

    **Пример**

   ```azurepowershell
   ./AzureILBUpgrade.ps1 -rgName "test_InternalUpgrade_rg" -oldLBName "LBForInternal" -newlocation "centralus" -newLbName "LBForUpgrade"
   ```

### <a name="add-vms-to-backend-pools-of-standard-load-balancer"></a>Добавление виртуальных машин в серверные пулы Load Balancer (цен. категория "Стандартный")

Сначала убедитесь, что сценарий успешно создал новый стандартный внутренний Load Balancer с точной конфигурацией, перенесенной из базового внутреннего Load Balancer. Это можно проверить в портал Azure.

Не забудьте отправить небольшой объем трафика через Load Balancer (цен. категория "Стандартный") в качестве ручного теста.
  
Ниже приведено несколько сценариев добавления виртуальных машин в серверные пулы только что созданного стандартного внутреннего Load Balancer, а также рекомендации по каждому из них.

* **Перемещение существующих виртуальных машин из серверных пулов старых внутренних Load Balancer в серверные пулы только что созданных стандартных внутренних Load Balancer**.
    1. Для выполнения задач в этом кратком руководстве войдите на [портал Azure](https://portal.azure.com).
 
    1. Выберите **все ресурсы** в меню слева, а затем выберите **только что созданную Load Balancer (цен. Категория "Стандартный")** из списка ресурсов.
   
    1. В разделе **Параметры** выберите **Внутренние пулы**.
   
    1. Выберите внутренний пул, соответствующий внутреннему пулу базового Load Balancer, выберите следующее значение: 
      - **Виртуальная машина**: раскрывающийся список и выберите виртуальные машины из соответствующего серверного пула базовых Load Balancer.
    1. Нажмите кнопку **Сохранить**.
    >[!NOTE]
    >Для виртуальных машин, имеющих общедоступные IP-адреса, необходимо сначала создать стандартные, но не гарантируют, что IP-адрес не гарантируется. Отменяйте связь между виртуальными машинами и свяжите их с новыми стандартными IP-адресами. Затем вы сможете выполнить инструкции по добавлению виртуальных машин в серверный пул Load Balancer (цен. категория "Стандартный"). 

* **Создание новых виртуальных машин для добавления в серверные пулы только что созданного стандартного внутреннего Load Balancer**.
    * Дополнительные инструкции о том, как создать виртуальную машину и связать ее с Load Balancer (цен. категория "Стандартный"), можно найти [здесь](https://docs.microsoft.com/azure/load-balancer/quickstart-load-balancer-standard-public-portal#create-virtual-machines).

## <a name="common-questions"></a>Часто задаваемые вопросы

### <a name="are-there-any-limitations-with-the-azure-powershell-script-to-migrate-the-configuration-from-v1-to-v2"></a>Существуют ли какие либо ограничения в сценарии Azure PowerShell для переноса конфигурации с версии v1 на версию 2?

Да. См. раздел [предостережения/ограничения](#caveatslimitations).

### <a name="does-the-azure-powershell-script-also-switch-over-the-traffic-from-my-basic-load-balancer-to-the-newly-created-standard-load-balancer"></a>Также будет ли сценарий Azure PowerShell переключать трафик с базового Load Balancer на только что созданный Load Balancer (цен. категория "Стандартный")?

Нет. Сценарий Azure PowerShell только переносит конфигурацию. Фактический перенос трафика несет ответственность за ваш контроль.

### <a name="i-ran-into-some-issues-with-using-this-script-how-can-i-get-help"></a>При использовании этого сценария возникли проблемы. Как получить помощь?
  
Вы можете отправить электронное письмо по адресу slbupgradesupport@microsoft.com, открыть обращение в службу поддержки Azure или выполнить оба действия.

## <a name="next-steps"></a>Следующие шаги

[Обзор Azure Load Balancer уровня "Стандартный" (предварительная версия)](load-balancer-overview.md)
