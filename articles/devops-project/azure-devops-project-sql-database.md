---
title: Руководство. Развертывание приложения ASP.NET и кода базы данных SQL Azure с помощью Azure DevOps Starter
description: DevOps Starter позволяет легко начать работу в Azure. С помощью DevOps Starter вы можете развернуть приложение ASP.NET и код базы данных SQL Azure, выполнив несколько быстрых действий.
ms.author: mlearned
ms.manager: gwallace
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 03/24/2020
author: mlearned
ms.openlocfilehash: 93b150d47f1703662ebda5b017e1824cf74b7ab0
ms.sourcegitcommit: 58faa9fcbd62f3ac37ff0a65ab9357a01051a64f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "82233709"
---
# <a name="tutorial-deploy-your-aspnet-app-and-azure-sql-database-code-by-using-azure-devops-starter"></a>Руководство. Развертывание приложения ASP.NET и кода базы данных SQL Azure с помощью Azure DevOps Starter

Azure DevOps Starter представляет собой упрощенную процедуру, в которой можно перенести существующий код и репозиторий Git или выбрать пример приложения для создания конвейера непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure. 

DevOps Starter также:
* автоматически создавать ресурсы Azure, например базу данных SQL Azure;
* создавать и настраивать конвейер выпуска в Azure Pipelines, который включает конвейер сборки для непрерывной интеграции;
* настраивать конвейер выпуска для непрерывного развертывания; 
* создавать ресурс Azure Application Insights для мониторинга.

Изучив данный учебник, вы научитесь:

> [!div class="checklist"]
> * Развертывание приложения ASP.NET и кода базы данных SQL Azure с помощью Azure DevOps Starter
> * настройка Azure DevOps и подписки Azure; 
> * Просмотр конвейера CI
> * Просмотр конвейера CD
> * Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure
> * подключаться к базе данных SQL Azure; 
> * Очистка ресурсов

## <a name="prerequisites"></a>предварительные требования

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="create-a-project-in-devops-projects-for-an-aspnet-app-and-an-azure-sql-database"></a>Создание проекта в DevOps Projects для приложения ASP.NET и базы данных SQL Azure

DevOps Starter создает конвейер CI/CD в Azure Pipelines. Вы можете создать новую организацию Azure DevOps или использовать существующую. DevOps Starter также создает ресурсы Azure, такие как база данных SQL Azure, в подписке Azure по своему усмотрению.

1. Войдите на [портал Azure](https://portal.azure.com).

1. В поле поиска введите **DevOps Starter**, а затем выберите. Нажмите кнопку **Добавить** , чтобы создать новый.

    ![Панель мониторинга DevOps Starter](_img/azure-devops-starter-aks/search-devops-starter.png)

1. Выберите **.NET**, а затем **Далее**.

1. Для параметра **Выберите платформу приложений** выберите **ASP.NET**.

1. Выберите **Добавление базы данных** и нажмите кнопку **Далее**. Платформа приложений, выбранная ранее, определяет доступный тип целевого объекта развертывания службы Azure. 
    
1. Выберите **Далее**.

## <a name="configure-azure-devops-and-an-azure-subscription"></a>настройка Azure DevOps и подписки Azure;

1. Создайте новую организацию Azure DevOps или выберите существующую. 

1. Задайте имя проекта Azure DevOps. 

1. Выберите службы подписки Azure. При необходимости можно нажать кнопку **Изменить**, чтобы просмотреть дополнительные параметры конфигурации Azure и найти имя пользователя в разделе **Учетные данные для сервера базы данных**. Сохраните имя пользователя для следующих шагов этого руководства. Если вы выполняете этот дополнительных шаг, прежде чем нажать кнопку **Готово**, закройте область конфигурации Azure.
 
1. Нажмите кнопку **Готово**. Через несколько минут процесс завершится, и в портал Azure откроется панель мониторинга DevOps Starter. К панели мониторинга также можно перейти непосредственно из представления **Все ресурсы** на портале Azure. В области справа щелкните **Просмотр**, чтобы просмотреть запущенное приложение.
    
## <a name="examine-the-ci-pipeline"></a>Просмотр конвейера CI

DevOps Starter автоматически настраивает весь конвейер CI/CD в Azure Repos. Вы можете изучить и настроить конвейер. Чтобы изучить конвейер сборки Azure DevOps, выполните следующие действия:

1. В верхней части панели мониторинга DevOps Starter выберите **Сборка конвейеров**. На вкладке браузера отобразится конвейер сборки нового проекта.

1. Наведите указатель мыши на поле **Status (состояние** ), а затем нажмите кнопку с многоточием (...). В меню отображается несколько параметров, таких как добавление новой сборки в очередь, приостановка сборки и изменение конвейера сборки.

1. Выберите команду **Изменить**.

1. В этой области можно просмотреть различные задачи для конвейера сборки. В процессе сборки выполняются различные задачи, такие как получение исходного кода из репозитория Git, восстановление зависимостей и публикация полученных файлов, используемых для развертывания.

1. Выберите имя конвейера сборки в верхней части соответствующей области.

1. Измените имя конвейера сборки на более описательное, выберите **сохранить & очередь**, а затем нажмите кнопку **сохранить**.

1. Под именем конвейера сборки щелкните **Журнал**. В этой области отображается журнал аудита последних изменений сборки. Azure Pipelines отслеживает любые изменения, внесенные в конвейер сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**. DevOps Starter автоматически создает триггер CI, и каждая фиксация в репозитории запускает новую сборку. При необходимости выберите для процесса непрерывной интеграции включение или исключение ветвей.

1. Щелкните **Период удержания**. В зависимости от сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-cd-pipeline"></a>Просмотр конвейера CD

DevOps Starter автоматически создает и настраивает необходимые шаги для развертывания из Организации Azure DevOps в подписке Azure. Эти шаги включают настройку подключения к службе Azure для аутентификации Azure DevOps в подписке Azure. Средства автоматизации также создают конвейер CD, который обеспечивает непрерывное развертывание на виртуальной машине Azure. Чтобы получить дополнительные сведения о конвейере непрерывного развертывания в Azure DevOps, выполните следующие действия:

1. Выберите **Сборка и выпуск**, а затем — **Выпуски**. DevOps Starter создает конвейер выпуска для управления развертываниями в Azure.

1. Щелкните многоточие (…) рядом с конвейером выпуска и выберите **Изменить**. Конвейер выпуска содержит *конвейер*, в котором определен процесс выпуска.

1. В разделе **Артефакты** выберите **Удалить**. Конвейер сборки, который вы изучали на предыдущих этапах, создаст выходные данные для артефакта. 

1. Справа от значка **Удалить** выберите **Триггер непрерывного развертывания**. В этом конвейере выпуска активирован триггер непрерывного развертывания, выполняющий развертывание каждый раз, когда становится доступным новый артефакт сборки. При желании можно отключить триггер, чтобы выполнить развертывание вручную. 

    DevOps Starter устанавливает случайный пароль SQL и использует его для конвейера выпуска.
    
1. В области слева выберите **Переменные**. 

   > [!NOTE]
   > Указанное ниже действие нужно выполнить, только если вы изменили пароль SQL Server. Для пароля используется одна переменная.
  
1. Рядом с полем **Значение** нажмите значок с замком, введите новый пароль и щелкните **Сохранить**.

1. В области слева выберите **Задачи**, а затем выберите свою среду. Задачи — это действия, которые выполняются в процессе развертывания. Эти действия объединены в этапы. Для конвейера выпуска предусмотрен один этап, который состоит из задач *развертывания Службы приложений Azure* и *развертывания Базы данных SQL Azure*.

1. Выберите задачу *Execute Azure SQL* (Выполнить SQL Azure) и изучите различные свойства, используемые для развертывания SQL. В разделе **Пакет развертывания** задача использует файл *SQL DACPAC*.

1. В области справа выберите **Просмотреть выпуски**, чтобы отобразился журнал выпусков.

1. Щелкните многоточие (…) рядом с одним из выпусков и выберите **Открыть**. Отобразится меню с несколькими элементами, такими как сводка выпуска, связанные рабочие элементы и тесты.

1. Щелкните **Фиксации**. В этом представлении отображаются фиксации кода, связанные с текущим развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **журналы**. Журналы содержат полезную информацию о процессе развертывания. Их можно просматривать во время и после развертывания.

## <a name="commit-changes-to-azure-repos-and-automatically-deploy-them-to-azure"></a>Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure 

 > [!NOTE]
 > Ниже описан процесс проверки конвейера CI/CD путем простого изменения текста. Чтобы проверить процесс развертывания SQL, дополнительно можно изменить схему SQL Server в таблице.

Теперь вы готовы к совместной работе над приложением с использованием процесса CI/CD для автоматического развертывания последних результатов работы на своем веб-сайте. При каждом изменении в репозитории Git запускается сборка в Azure DevOps и конвейер CD выполняет развертывание в Azure. Используйте описанную в этом разделе процедуру или другой метод, чтобы зафиксировать изменения в репозитории. Изменение кода запускает процесс CI/CD, который автоматически развертывает изменения в Azure.

1. В области слева щелкните **Код** и откройте репозиторий.

1. Откройте каталог *SampleWebApplication\Views\Home*, нажмите значок многоточия (…) рядом с файлом *Index.cshtml*, а затем нажмите кнопку **Правка**. 

1. Внесите изменения в файл, например, измените определенный текст внутри одного из тегов div. 

1. В правом верхнем углу выберите **Зафиксировать**, после чего снова нажмите **Зафиксировать**, чтобы отправить изменения. Через несколько секунд начнется процесс сборки в Azure DevOps, после чего будет выполнена операция выпуска для развертывания изменений. Отслеживайте состояние сборки на панели мониторинга DevOps Starter или в браузере с помощью вашей организации Azure DevOps.

1. По завершении выпуска обновите приложение, чтобы проверить изменения.

## <a name="connect-to-the-azure-sql-database"></a>подключаться к базе данных SQL Azure;

Для подключения к базе данных SQL Azure вам нужны соответствующие разрешения.

1. На панели мониторинга DevOps Starter выберите **база данных SQL** , чтобы открыть страницу управления для базы данных SQL.
   
1. Выберите **Настройка брандмауэра для сервера**, а затем нажмите кнопку **Добавить IP-адрес клиента**. 

1. Щелкните **Сохранить**. Вашему IP-адресу клиента теперь разрешен доступ к ресурсу SQL Server в Azure.

1. Вернитесь к панели **База данных SQL**. 

1. В области справа выберите имя сервера, чтобы открыть страницу конфигурации **SQL Server**.

1. Выберите **Сброс пароля**, введите пароль для входа администратора SQL Server, а затем щелкните **Сохранить**. Запишите этот пароль, чтобы использовать его позднее в этом руководстве.

    Теперь при необходимости можно использовать клиентские средства, например SQL Server Management Studio или Visual Studio для подключения к SQL Server и базе данных Azure. Используйте свойство **Имя сервера** для подключения.

    Если при начальной настройке проекта в DevOps Projects вы не меняли имя пользователя для базы данных, в качестве имени пользователя будет использоваться префикс имени в вашем адресе электронной почты. Например, если ваш адрес электронной почты — *johndoe\@microsoft.com*, ваше имя пользователя — *johndoe*.

   > [!NOTE]
   > При изменении пароля для имени входа SQL необходимо изменить пароль в переменной конвейера выпуска, как описано в разделе [изучение конвейера компакт-диска](#examine-the-cd-pipeline) .

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы выполняете тестирование, можно очистить ресурсы, чтобы избежать дополнительных расходов. Можно удалить базу данных SQL Azure и связанные с ней ресурсы, созданные в рамках этого руководства, когда в них отпадет необходимость. Для этого используйте функцию **удаления** на панели мониторинга DevOps Starter.

> [!IMPORTANT]
> Следующая процедура безвозвратно удаляет ресурсы. Функция *удаления* уничтожает данные, созданные проектом в DevOps Starter в Azure и Azure DevOps, и вы не сможете получить их. Выполняйте эту процедуру только после того, как прочли предупреждение.

1. В портал Azure перейдите на панель мониторинга DevOps Starter.
2. В правом верхнем углу выберите **Удалить**. 
3. В окне предупреждения выберите **Да**, чтобы *удалить ресурсы без возможности восстановления*.

## <a name="next-steps"></a>Следующие шаги

Вы можете по желанию изменить эти конвейеры сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других конвейеров. В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * Развертывание приложения ASP.NET и кода базы данных SQL Azure с помощью Azure DevOps Starter
> * настройка Azure DevOps и подписки Azure; 
> * Просмотр конвейера CI
> * Просмотр конвейера CD
> * Фиксация изменений в Azure Repos и их автоматическое развертывание в Azure
> * подключаться к базе данных SQL Azure; 
> * Очистка ресурсов

См. дополнительные сведения о конвейере CI/CD:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) pipeline](https://docs.microsoft.com/azure/devops/pipelines/release/define-multistage-release-process?view=vsts) (Настройка многоэтапного конвейера для непрерывного развертывания)

## <a name="videos"></a>Видео

> [!VIDEO https://channel9.msdn.com/Events/Build/2018/BRK3308/player]
