---
title: Функции сетей
description: Узнайте о функциях сети в службе приложений Azure и о том, какие функции необходимы для обеспечения безопасности или функциональности сети.
author: ccompy
ms.assetid: 5c61eed1-1ad1-4191-9f71-906d610ee5b7
ms.topic: article
ms.date: 03/16/2020
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 79f85261115dbddcb0b04cd2863a90912de2ab87
ms.sourcegitcommit: efefce53f1b75e5d90e27d3fd3719e146983a780
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2020
ms.locfileid: "80474910"
---
# <a name="app-service-networking-features"></a>Функции сети Службы Приложений

Приложения в службе приложений Azure могут быть развернуты несколькими способами. По умолчанию приложения App Service, размещенные на прямую стороны, доступны для интернета и могут достигать только конечных точек, размещенных в Интернете. Однако многим приложениям для клиентов необходимо контролировать входящий и исходящий сетевой трафик. Есть несколько функций, доступных в Службе Приложений для удовлетворения этих потребностей. Задача состоит в том, чтобы знать, какая функция должна использоваться для решения данной проблемы. Этот документ предназначен для того, чтобы помочь клиентам определить, какая функция должна использоваться на основе некоторых примеров использования.

Для службы приложений Azure существует два основных типа развертывания. Существует мультитенантный государственный сервис, который размещает планы App Service в Бесплатных, Общих, Основных, Стандартных, Премиум и Premiumv2 цены SKUs. Кроме того, существует единый арендатор App Service Environment (ASE), в котором разыскиваются изолированные планы SKU App Service непосредственно в вашей виртуальной сети Azure (VNet). Функции, которые вы используете, будут варьироваться в зависимости от того, находитесь ли вы в мультитенантной службе или в ASE. 

## <a name="multi-tenant-app-service-networking-features"></a>Функции мультитенантных сетей Службы приложений 

Служба приложений Azure — это распределенная система. Роли, обрабатывающие входящие запросы HTTP/HTTPS, называются фронт-эндами. Роли, хосты рабочей нагрузки клиента, называются рабочими. Все роли в развертывании службы приложений существуют в мультитенантной сети. Поскольку в одном и том же блоке App Service много разных клиентов, вы не можете подключить сеть службы приложений непосредственно к вашей сети. Вместо подключения сетей нам нужны функции для обработки различных аспектов взаимодействия приложений. Функции, обрабатывающие запросы в ваше приложение, не могут быть использованы для решения проблем при совершении звонков из приложения. Аналогичным образом, функции, которые решают проблемы для вызовов из вашего приложения, не могут быть использованы для решения проблем с вашим приложением.  

| Входящие функции | Исходящие функции |
|---------------------|-------------------|
| Присвоенный адрес приложения | Гибридные подключения |
| Ограничения доступа | Шлюз требует интеграции VNet |
| Конечные точки службы | интеграция с виртуальной сетью; |

Если не указано иное, все функции могут быть использованы вместе. Вы можете смешивать функции для решения различных проблем.

## <a name="use-case-and-features"></a>Использование чехла и функций

Для любого данного случая использования может быть несколько способов решения проблемы.  Правильная функция для использования иногда объясняется причинами, выходящими за рамки только самого случая использования. Следующие случаи использования входящих предложить, как использовать функции сети Службы App для решения проблем, связанных с управлением трафиком, идущим в ваше приложение. 
 
| Случаи входящего использования | Компонент |
|---------------------|-------------------|
| Поддержка потребностей SSL на основе IP для вашего приложения | приложение назначенный адрес |
| Не является общим, выделенным входящим адресом для вашего приложения | приложение назначенный адрес |
| Ограничьте доступ к приложению из набора четко определенных адресов | Ограничения доступа |
| Ограничьте доступ к моему приложению из ресурсов в VNet | Конечные точки службы </br> Среда ASE с ILB </br> Частная конечная точка (Предварительный просмотр) |
| Разоблачить мое приложение на частном IP в моем VNet | Среда ASE с ILB </br> частный IP для входящих на шлюзе приложения с конечными точками обслуживания </br> Конечная точка обслуживания (Предварительный просмотр) |
| Защитите мое приложение с помощью WAF | Шлюз приложений - ILB ASE </br> Использование Шлюза приложений с конечными точками служб </br> Передняя дверь Azure с ограничениями доступа |
| Загрузка баланса трафика на мои приложения в разных регионах | Передняя дверь Azure с ограничениями доступа | 
| Трафик баланса нагрузки в одном регионе | [Использование Шлюза приложений с конечными точками служб][appgwserviceendpoints] | 

Следующие случаи исходящего использования показывают, как использовать функции сети Службы App для решения исходящих потребностей доступа для вашего приложения. 

| Случаи исходящего использования | Компонент |
|---------------------|-------------------|
| Доступ к ресурсам в виртуальной сети Azure в том же регионе | интеграция с виртуальной сетью; </br> ASE |
| Доступ к ресурсам в виртуальной сети Azure в другом регионе | Шлюз требует интеграции VNet </br> ASE и VNet пиринг |
| Доступ к ресурсам, защищенным конечными точками обслуживания | интеграция с виртуальной сетью; </br> ASE |
| Доступ к ресурсам в частной сети, не подключенной к Azure | Гибридные подключения |
| Доступ к ресурсам по схемам ExpressRoute | интеграция с виртуальной сетью; </br> ASE | 
| Безопасный исходящий трафик из вашего веб-приложения | Группы интеграции и сетевой безопасности VNet </br> ASE | 
| Маршрут исходящего трафика из вашего веб-приложения | Таблицы интеграции и маршрутов VNet </br> ASE | 


### <a name="default-networking-behavior"></a>Сетевое поведение по умолчанию

Подразделения службы поддержки приложений Azure поддерживают множество клиентов в каждом развертывании. Свободный и общий SKU планирует разместить нагрузки клиентов на нескольких арендаторов работников. Основные и выше планы размещают рабочие нагрузки клиентов, предназначенные только для одного плана службы приложений (ASP). Если у вас есть стандартный план службы приложений, то все приложения в этом плане будут работать на том же работнике. Если вы масштабируете работника, то все приложения в этом ASP будут реплицированы на новом работнике для каждого экземпляра в вашем ASP. Работники, которые используются для Premiumv2 отличаются от работников, используемых для других планов. Каждое развертывание Службы App имеет один IP-адрес, который используется для всего входящего трафика в приложения в развертывании службы приложений. Есть, однако, где-то от 4 до 11 адресов, используемых для совершения исходящих звонков. Эти адреса являются общими для всех приложений, в стыкаемых службами приложений. Исходящие адреса отличаются в зависимости от различных типов рабочих. Это означает, что адреса, используемые Free, Shared, Basic, Standard и Premium ASPs, отличаются от адресов, используемых для исходящих звонков из АСП Premiumv2. Если вы посмотрите в свойствах для вашего приложения, вы можете увидеть входящие и исходящие адреса, которые используются вашим приложением. Если вам нужно заблокировать зависимость с помощью IP ACL, используйте возможные OutboundAddresses. 

![Свойства приложения](media/networking-features/app-properties.png)

Служба приложений имеет ряд конечных точек, которые используются для управления службой.  Эти адреса публикуются в отдельном документе, а также находятся в теге IP-сервиса AppServiceManagement. Тег AppServiceManagement используется только в среде службы приложений (ASE), где необходимо разрешить такой трафик. Входящие адреса Службы App отслеживаются в теге IP-сервиса AppService. Нет тега IP-сервиса, содержащего исходящие адреса, используемые Службой app. 

![Служба приложений входящих и исходящих диаграммы](media/networking-features/default-behavior.png)

### <a name="app-assigned-address"></a>Присвоенный адрес приложения 

Функция присвоенного адреса приложения является ответвлением возможности SSL на основе IP и доступна путем настройки SSL с вашим приложением. Эта функция может быть использована для IP-звонков на основе SSL, но она также может быть использована, чтобы дать вашему приложению адрес, который есть только у него. 

![Схема присвоения адреса](media/networking-features/app-assigned-address.png)

При использовании назначенного приложения адреса трафик по-прежнему проходит через те же фронтовые роли, которые обрабатывают весь входящий трафик в блоке масштаба Службы App. Однако адрес, назначенный приложению, используется только вашим приложением. Случаи использования для этой функции должны:

* Поддержка потребностей SSL на основе IP для вашего приложения
* Установите специальный адрес для вашего приложения, который не является общим ни с чем другим

Вы можете узнать, как установить адрес в приложении с помощью учебника по [добавлению сертификата TLS/SSL в службе приложений Azure.][appassignedaddress] 

### <a name="access-restrictions"></a>Ограничения доступа 

Возможность ограничения доступа позволяет фильтровать **входящие** запросы на основе IP-адреса origination. Действие фильтрации происходит на передних ролях, которые находятся вверх по течению от ролей работника, где работают приложения. Поскольку фронтовые роли находятся в восходящем потоке от рабочих, возможность ограничения доступа может рассматриваться как защита сетевого уровня для ваших приложений. Функция позволяет создать список допустимых и отрицать адресные блоки, которые оцениваются в приоритетном порядке. Он похож на функцию Группы сетевой безопасности (NSG), которая существует в сети Azure.  Эту функцию можно использовать в ASE или в мультитенантной службе. При использовании с ILB ASE можно ограничить доступ из частных адресных блоков.

![Ограничения доступа](media/networking-features/access-restrictions.png)

Функция Ограничения доступа помогает в сценариях, где требуется ограничить IP-адреса, которые могут быть использованы для доступа к вашему приложению. Среди случаев использования для этой функции являются:

* Ограничьте доступ к приложению из набора четко определенных адресов 
* Ограничьте доступ к доступу через службу балансировки груза, такую как Azure Front Door. Если вы хотите заблокировать входящее движение на Переднюю дверь Azure, создайте правила, разрешив трафик от 147.243.0.0/16 и 2a01:111:2050::/44. 

![Ограничения доступа с передней дверью](media/networking-features/access-restrictions-afd.png)

Если вы хотите заблокировать доступ к приложению, чтобы его можно было получить только с ресурсов в вашей виртуальной сети Azure (VNet), вам нужен статический публичный адрес на любом источнике в vNet. Если у ресурсов нет общедоступного адреса, следует использовать функцию «Конечные точки службы». Узнайте, как включить эту функцию с учебником по [настройке ограничений доступа.][iprestrictions]

### <a name="service-endpoints"></a>Конечные точки служб

Конечные точки службы позволяют блокировать **входящий** доступ к приложению таким образом, что исходный адрес должен исходить от набора выбранных подсетей. Эта функция работает в сочетании с ограничениями доступа ip. Конечные точки обслуживания устанавливаются в том же пользовательском интерфейсе, что и ограничения доступа к IP. Можно создать список правил доступа, который включает общедоступные адреса, а также подсети в ваших VNets. Эта функция поддерживает такие сценарии, как:

![конечные точки служб](media/networking-features/service-endpoints.png)

* Настройка шлюза приложений с приложением для блокировки входящего трафика в приложении
* Ограничение доступа к приложению для ресурсов в VNet. Это может включать в себя виртуальные вым, ASEs, или даже другие приложения, которые используют VNet интеграции 

![конечные точки обслуживания с шлюзом приложения](media/networking-features/service-endpoints-appgw.png)

Подробнее о настройке конечных точек службы с приложением можно в учебнике по [настройке ограничений доступа к конечным точкам службы][serviceendpoints]

### <a name="private-endpoint-preview"></a>Частная конечная точка (Предварительный просмотр)

Private Endpoint — это сетевой интерфейс, который соединяет вас в частном порядке и надежно с вашим Web App по Azure Private Link. Private Endpoint использует частный IP-адрес из вашего VNet, эффективно врезультате web-приложения в вашем VNet. Эта функция предназначена только для **входящих** потоков в веб-приложение.
[Использование частных конечных точек для веб-приложения Azure (Предварительный просмотр)][privateendpoints]
 
### <a name="hybrid-connections"></a>Гибридные подключения

Гибридные соединения Службы Приложений позволяют вашим приложениям совершать **исходящие** вызовы в указанные конечные точки TCP. Конечная точка может быть на месте, в VNet или в любом месте, что позволяет исходящих трафика в Azure на порту 443. Функция требует установки ретранслятора под названием Гибридный менеджер соединения (HCM) на Windows Server 2012 или новый хост. HCM должен быть в состоянии достичь Azure Relay в порту 443. HCM можно загрузить с uI службы гибридных подключений App Service на портале. 

![Поток сети гибридных подключений](media/networking-features/hybrid-connections.png)

Функция гибридных подключений службы приложений построена на возможности гибридных соединений Azure Relay. Служба приложений использует специализированную форму функции, которая поддерживает только исходящие звонки из вашего приложения в устеже tCP и порт. Этот хост и порт нужно решить только на хосте, где установлен HCM. Когда приложение, в App Service, делает поиск DNS на хосте и порту, определенных в гибридном подключении, трафик автоматически перенаправляется, чтобы пройти через гибридное соединение и из гибридного менеджера соединения. Чтобы узнать больше о гибридных соединениях, прочитайте документацию о [гибридных соединениях Службы Приложений][hybridconn]

Эта функция обычно используется для:

* Доступ к ресурсам в частных сетях, которые не подключены к Azure с ПОМОЩЬю VPN или ExpressRoute
* Поддержка подъема и переноса предварительных приложений в Службу поддержки без необходимости перемещения вспомогательных баз данных  
* Безопасно обеспечить доступ к одному хостам и порту в гибридных соединениях. Большинство сетевых функций открывают доступ к сети, а с гибридными соединениями у вас есть только один хост и порт, до которых вы можете добраться.
* Сценарии покрытия, не охватываемые другими методами исходящего подключения
* Выполните разработку в App Service, где приложения могут легко использовать ресурсы на местах 

Поскольку функция позволяет получить доступ к локализованным ресурсам без входящего отверстия брандмауэра, она пользуется популярностью у разработчиков. Другие исходящие функции сети Службы App очень Azure Виртуальные сети связаны между собой. Гибридные соединения не имеют зависимости от прохождения через VNet и могут быть использованы для более широкого спектра сетевых потребностей. Важно отметить, что функция Гибридных соединений Службы Приложений не заботится или не знает, что вы делаете на ней. Это значит, что вы можете использовать его для доступа к базе данных, веб-службе или произвольной разъеме TCP на мэйнфрейме. Функция по существу туннели TCP пакетов. 

Хотя гибридные соединения популярны для разработки, он также используется в многочисленных производственных приложений, а также. Он отлично подходит для доступа к веб-службе или базе данных, но не подходит для ситуаций, связанных с созданием многих соединений. 

### <a name="gateway-required-vnet-integration"></a>Шлюз требует интеграции VNet 

Требуемая функция интеграции Службы приложения VNet позволяет приложению вносить **исходящие** запросы в виртуальную сеть Azure. Функция работает, подключив хост, на который работает ваше приложение, к шлюзу виртуальной сети на VNet с VPN от точки к сайту. При настройке функции приложение получает один из адресов от точки к сайту, назначенных каждому экземпляру. Эта функция позволяет получить доступ к ресурсам в VNets Classic или Resource Manager в любом регионе. 

![Шлюз требует интеграции VNet](media/networking-features/gw-vnet-integration.png)

Эта функция решает проблему доступа к ресурсам в других VNets и даже может быть использована для подключения через VNet к другим VNets или даже на месте. Он не работает с ExpressRoute подключен VNets, но делает с сайта на сайт VPN подключенных сетей. Обычно нецелесообразно использовать эту функцию из приложения в среде службы приложений (ASE), потому что ASE уже находится в вашем VNet. Случаи использования, которые эта функция решает:

* Доступ к ресурсам на частных ис-провайдерах в виртуальных сетях Azure 
* Доступ к ресурсам на местах, если есть сайт к сайту VPN 
* Доступ к ресурсам в заглянующих VNets 

Когда эта функция включена, приложение будет использовать DNS-сервер, с которым настроен пункт назначения VNet. Вы можете прочитать больше об этой функции в документации по [App Service VNet Интеграция][vnetintegrationp2s]. 

### <a name="vnet-integration"></a>интеграция с виртуальной сетью;

Требуемая функция интеграции VNet очень полезна, но по-прежнему не решает проблему доступа к ресурсам ExpressRoute. Помимо необходимости охвата через подключения ExpressRoute, есть необходимость для приложений, чтобы иметь возможность совершать звонки в службу конечных служб обеспеченных услуг. Для решения обеих этих дополнительных потребностей была добавлена еще одна возможность интеграции VNet. Новая функция интеграции VNet позволяет разместить бэкэнд приложения в подсети в ресурсном менеджере VNet в том же регионе. Эта функция недоступна в среде службы приложений, которая уже находится в VNet. Эта функция позволяет:

* Доступ к ресурсам в ВНес управления ресурсами в том же регионе
* Доступ к ресурсам, защищенным конечными точками обслуживания 
* Доступ к ресурсам, доступным через ЭкспрессRoute или VPN-соединения
* Обеспечение безопасности всего исходящего трафика 
* Сила туннелирования всех исходящих трафика. 

![интеграция с виртуальной сетью;](media/networking-features/vnet-integration.png)

Чтобы узнать больше об этой функции, прочитайте документы по [App Service VNet Интеграция][vnetintegration].

## <a name="app-service-environment"></a>Среда службы приложений 

Среда службы приложений (ASE) — это единое развертывание службы приложений Azure, которая работает в vNet. ASE позволяет использовать такие случаи, как:

* Доступ к ресурсам в VNet
* Доступ к ресурсам через ExpressRoute
* Разоблачить приложения с закрытым адресом в VNet 
* Доступ к ресурсам в разных конечных точках обслуживания 

С ASE вам не нужно использовать такие функции, как интеграция VNet или конечные точки обслуживания, потому что ASE уже находится в вашем VNet. Если вы хотите получить доступ к таким ресурсам, как S'L или Хранение, над конечными точками обслуживания, включите конечные точки обслуживания в подсети ASE. Если вы хотите получить доступ к ресурсам в VNet, не требуется дополнительная конфигурация.  Если вы хотите получить доступ к ресурсам через ExpressRoute, вы уже находитесь в VNet и не нужно настраивать что-либо на ASE или приложения внутри него. 

Поскольку приложения в ILB ASE могут быть выставлены на частный IP-адрес, вы можете легко добавить устройства WAF, чтобы разоблачить только приложения, которые вы хотите в Интернете и сохранить остальные в безопасности. Он поддается легкой разработке многоуровневых приложений. 

Есть некоторые вещи, которые еще не возможны из мультитенантной службы, которые от ASE. К ним относятся такие вещи, как:

* Выставлять приложения на частный IP-адрес
* Защищайте весь исходящий трафик с помощью элементов управления сетью, которые не являются частью вашего приложения 
* Размещение приложений в единой службе арендаторов 
* Масштабирование до гораздо большего числа экземпляров, чем это возможно в мультитенантной службе 
* Загрузите частные сертификаты клиентов CA для использования вашими приложениями с частными обеспеченными конечными точками CA 
* Force TLS 1.1 во всех приложениях, размещенных в системе, без возможности отключиться на уровне приложения 
* Предоставьте специальный адрес исходящих для всех приложений в вашем ASE, который не является общим для клиентов 

![ASE в VNet](media/networking-features/app-service-environment.png)

ASE предоставляет лучшую историю вокруг изолированного и посвященного хостинга приложений, но поставляются с некоторыми проблемами управления. Некоторые вещи, которые следует учитывать перед использованием оперативного ASE:
 
 * ASE работает внутри вашего VNet, но имеет зависимости за пределами VNet. Эти зависимости должны быть разрешены. Подробнее в [сетевых соображениях для среды службы приложений][networkinfo]
 * ASE не масштабируется сразу, как мультитенантная услуга. Необходимо предвидеть потребности в масштабировании, а не реактивно масштабировать. 
 * ASE имеет более высокую переднюю стоимость, связанную с ним. Для того, чтобы получить максимальную отдачу от вашего ASE, вы должны планировать положить много рабочих нагрузок в один ASE, а не использовать его для небольших усилий
 * Приложения в ASE не могут ограничивать доступ к некоторым приложениям в ASE, а не к другим.
 * ASE находится в подсети, и любые сетевые правила применяются ко всему трафику и от этого ASE. Если вы хотите назначить входящие правила дорожного движения только для одного приложения, используйте ограничения доступа. 

## <a name="combining-features"></a>Объединение функций 

Функции, отмеченные для мультитенантной службы, могут быть использованы вместе для решения более сложных случаев использования. Два из наиболее распространенных случаев использования описаны здесь, но они являются лишь примерами. Понимая, что делают различные функции, вы можете решить почти все потребности вашей системной архитектуры.

### <a name="inject-app-into-a-vnet"></a>Инъекционное приложение в VNet

Общий запрос — как разместить приложение в VNet. Размещение приложения в VNet означает, что входящие и исходящие конечные точки для приложения находятся в пределах VNet. ASE обеспечивает лучшее решение для решения этой проблемы, но, вы можете получить большую часть того, что необходимо в мультитенантной службы путем объединения функций. Например, можно размещать только приложения интрасети с частными входящими и исходящими адресами по:

* Создание шлюза приложения с частным входящим и исходящим адресом
* Обеспечение входящего трафика в приложении с помощью конечных точек обслуживания 
* Используйте новую интеграцию VNet, чтобы бэкэнд вашего приложения был в вашем VNet 

Этот стиль развертывания не даст вам специальный адрес для исходящего трафика в Интернет или даст вам возможность заблокировать весь исходящий трафик из вашего приложения.  Этот стиль развертывания даст вам многое из того, что вы бы только в противном случае получить с ASE. 

### <a name="create-multi-tier-applications"></a>Создание многоуровневых приложений

Многоуровневое приложение — это приложение, в котором приложения бэкэнда API могут быть доступны только с переднего уровня. Для создания многоуровневого приложения можно:

* Используйте интеграцию VNet для подключения бэкэнда веб-приложения с подсетью в VNet
* Используйте конечные точки обслуживания для обеспечения входящего трафика в вашем приложении API только из подсети, используемой вашим передним веб-приложением

![многоуровневое приложение](media/networking-features/multi-tier-app.png)

Вы можете использовать несколько фронтовых приложений с помощью одного и того же приложения API, используя VNet Integration из других передних приложений и конечных точек обслуживания из приложения API с их подсетями.  

<!--Links-->
[appassignedaddress]: https://docs.microsoft.com/azure/app-service/configure-ssl-certificate
[iprestrictions]: https://docs.microsoft.com/azure/app-service/app-service-ip-restrictions
[serviceendpoints]: https://docs.microsoft.com/azure/app-service/app-service-ip-restrictions
[hybridconn]: https://docs.microsoft.com/azure/app-service/app-service-hybrid-connections
[vnetintegrationp2s]: https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet
[vnetintegration]: https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet
[networkinfo]: https://docs.microsoft.com/azure/app-service/environment/network-info
[appgwserviceendpoints]: https://docs.microsoft.com/azure/app-service/networking/app-gateway-with-service-endpoints
[privateendpoints]: https://docs.microsoft.com/azure/app-service/networking/private-endpoint
