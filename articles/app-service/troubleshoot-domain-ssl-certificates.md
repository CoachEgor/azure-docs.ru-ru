---
title: Проблема домена и SSL сертификаты
description: Найдите решения общих проблем, с которыми можно столкнуться при настройке домена или SSL-сертификата в службе приложений Azure.
author: genlin
manager: dcscontentpm
tags: top-support-issue
ms.topic: article
ms.date: 03/01/2019
ms.author: genli
ms.custom: seodec18
ms.openlocfilehash: e299821b54692327cbb7d497af0295e3b93658cf
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "75966975"
---
# <a name="troubleshoot-domain-and-ssl-certificate-problems-in-azure-app-service"></a>Устранение неполадок с доменами и SSL-сертификатами в Службе приложений Azure

Эта статья содержит сведения о распространенных проблемах, которые могут возникнуть при настройке домена или SSL-сертификата для веб-приложений Azure в Службе приложений Azure. Кроме того, здесь описаны возможные причины этих проблем и способы их устранения.

Если в любой момент при изучении этой статьи вам потребуется дополнительная помощь, вы можете обратиться к экспертам по Azure на [форумах MSDN и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт поддержки Azure](https://azure.microsoft.com/support/options/) и выберите **«Получите поддержку».**


[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

## <a name="certificate-problems"></a>Проблемы сертификата

### <a name="you-cant-add-an-ssl-certificate-binding-to-an-app"></a>Не удается добавить привязку SSL-сертификата к приложению 

#### <a name="symptom"></a>Симптом

При добавлении привязки SSL появляется следующее сообщение об ошибке:

"Не удалось добавить привязку SSL. Не удалось назначить сертификат для существующего виртуального IP-адреса, так как этот сертификат уже используется для другого виртуального IP-адреса."

#### <a name="cause"></a>Причина

Эта проблема может возникнуть, если у вас есть несколько привязок SSL на основе IP-адреса для одного IP-адреса в нескольких приложениях. Например, у приложения A есть привязка SSL на основе IP-адреса со старым сертификатом. У приложения B есть привязка SSL на основе IP-адреса с новым сертификатом для того же IP-адреса. При обновлении привязки SSL приложения с помощью нового сертификата появится указанное выше сообщение об ошибке, так как этот же IP-адрес уже используется для другого приложения. 

#### <a name="solution"></a>Решение 

Чтобы устранить эту проблему, используйте один из следующих способов:

- Удалите привязку SSL на основе IP-адреса в приложении, в котором используется старый сертификат. 
- Создайте привязку SSL на основе IP-адреса, которая использует новый сертификат.

### <a name="you-cant-delete-a-certificate"></a>Не удается удалить сертификат 

#### <a name="symptom"></a>Симптом

При попытке удалить сертификат, появляется следующее сообщение об ошибке:

"Невозможно удалить сертификат, так как он сейчас используется в SSL-привязке. Ее необходимо удалить, чтобы можно было удалить сертификат."

#### <a name="cause"></a>Причина

Эта проблема может возникнуть, если сертификат используется другим приложением.

#### <a name="solution"></a>Решение

Удалите привязку SSL для этого сертификата из приложений. Затем попробуйте удалить сертификат. Если сертификат по-прежнему не удается удалить, очистите кэш веб-браузера, повторно откройте портал Azure в новом окне браузера. Затем попробуйте удалить сертификат.

### <a name="you-cant-purchase-an-app-service-certificate"></a>Не удается приобрести сертификат службы приложений 

#### <a name="symptom"></a>Симптом
Приобрести [сертификат службы приложений Azure](./configure-ssl-certificate.md#import-an-app-service-certificate) на портале Azure нельзя.

#### <a name="cause-and-solution"></a>Причина и решение
Эта проблема может возникать из-за любой из следующих причин:

- Служба приложений имеет план уровня "Бесплатный" или "Общий". Эти ценовые категории не поддерживают SSL. 

    **Решение**: Обновление плана службы приложений для приложения до стандарта.

- Подписка не имеет действительной кредитной карты.

    **Решение.** Добавьте действительную кредитную карту в подписку. 

- Предложение подписки не поддерживает покупку сертификата службы приложений, такого как Microsoft Student.  

    **Решение.** Обновите подписку. 

- Достигнуто максимальное количество покупок, предусмотренных для подписки.

    **Решение.** Для типов подписок с оплатой по мере использования и с Соглашением Enterprise предусмотрено не больше 10 покупок сертификатов службы приложений. Для других типов подписок ограничение равно 3. Чтобы увеличить это количество, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Сертификат службы приложений помечен как мошеннический. Отображается следующее сообщение об ошибке: "Ваш сертификат отмечен как потенциально мошеннический." Запрос находится на рассмотрении. Если сертификат не будет пригодным к удовечивым в течение 24 часов, обратитесь в службу поддержки Azure.

    **Решение.** Если сертификат помечен как мошеннический и проблема не будет устранена по прошествии 24 часов, сделайте следующее:

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. Перейдите к области **Сертификаты службы приложений**, а затем выберите сертификат.
    3. Выберите шаг **конфигурации** > сертификата**2: Проверка** > **проверки домена.** В результате будет отправлено электронное уведомление поставщику сертификата Azure для устранения проблемы.

## <a name="custom-domain-problems"></a>Проблемы пользовательских доменов

### <a name="a-custom-domain-returns-a-404-error"></a>Личный домен возвращает сообщение об ошибке 404 

#### <a name="symptom"></a>Симптом

При переходе на сайт с помощью имени личного домена отображается следующее сообщение об ошибке:

"Error 404-Web app not found" (Ошибка 404 — веб-приложение не найдено).

#### <a name="cause-and-solution"></a>Причина и решение

**Причина 1** 

На настроенном личном домене отсутствует запись A или CNAME. 

**Решение для причины 1**

- Если вы добавили запись A, убедитесь, что запись типа TXT также добавлена. Дополнительные сведения см. в разделе [Создание записи A](./app-service-web-tutorial-custom-domain.md#create-the-a-record).
- Если вам не нужно использовать корневой домен для приложения, рекомендуется использовать запись CNAME вместо записи A.
- Не используйте обе записи CNAME и A для одного домена. Эта проблема может привести к конфликту и предотвратить разрешение домена. 

**Причина 2** 

Веб-браузер может по-прежнему кэшировать старый IP-адрес для домена. 

**Решение для причины 2**

Очистите браузер. Для устройств Windows можно выполнить команду `ipconfig /flushdns`. С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес приложения. 

### <a name="you-cant-add-a-subdomain"></a>Не удалось добавить дочерний домен 

#### <a name="symptom"></a>Симптом

Не удается добавить новое имя узла в приложение, чтобы назначить поддомен.

#### <a name="solution"></a>Решение

- Обратитесь к администратору подписки, чтобы убедиться, что у вас есть разрешение на добавление имени узла в приложение.
- Если вам нужно больше поддоменов, мы рекомендуем вам изменить хостинг домена на службу доменных имен Azure (DNS). С помощью Azure DNS можно добавить в приложение до 500 имен узлов. Дополнительные сведения см. в записи блога о [добавлении поддомена](https://blogs.msdn.microsoft.com/waws/2014/10/01/mapping-a-custom-subdomain-to-an-azure-website/).

### <a name="dns-cant-be-resolved"></a>Не удается распознать службу доменных имен

#### <a name="symptom"></a>Симптом

Отображается следующее сообщение об ошибке:

"Не удается найти запись DNS".

#### <a name="cause"></a>Причина
Эта ошибка возникает по одной из следующих причин:

- Срок жизни не истек. Проверьте конфигурацию DNS своего домена, чтобы определить значение срока жизни, а затем подождите его окончания.
- Недопустимая конфигурация DNS.

#### <a name="solution"></a>Решение
- Подождите 48 часов. Спустя это время проблема устранится самостоятельно.
- Если вы можете изменить параметры срока жизни в конфигурации DNS, измените значение на 5 минут, чтобы увидеть, устранена ли проблема.
- С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес приложения. Если нет, настройте для записи A правильный IP-адрес приложения.

### <a name="you-need-to-restore-a-deleted-domain"></a>Нужно восстановить удаленный домен 

#### <a name="symptom"></a>Симптом
Домен больше не отображается на портале Azure.

#### <a name="cause"></a>Причина 
Возможно, домен случайно удален владельцем подписки.

#### <a name="solution"></a>Решение
Если домен удален меньше семи дней назад, процесс удаления не был запущен. В этом случае можно приобрести тот же домен снова на портале Azure в рамках одной подписки (Не забудьте ввести точное доменное имя в поле поиска.) Вы не будете платить снова за этот домен. Если домен был удален более семи дней назад, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) для получения помощи в восстановлении домена.

## <a name="domain-problems"></a>Проблемы домена

### <a name="you-purchased-an-ssl-certificate-for-the-wrong-domain"></a>Приобретен SSL-сертификат для неверного домена

#### <a name="symptom"></a>Симптом

Приобретен сертификат службы приложений для неверного домена. Не удается обновить сертификат для использования правильного домена.

#### <a name="solution"></a>Решение

Удалите этот сертификат, а затем приобретите новый.

Если текущий сертификат, который использует неверный домен, имеет состояние "Выдан", за него также выставляется счет. Плата за сертификаты службы приложений не возвращается, но вы можете обратиться в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), чтобы рассмотреть другие варианты. 

### <a name="an-app-service-certificate-was-renewed-but-the-app-shows-the-old-certificate"></a>Сертификат службы приложений был обновлен, но в приложении по-прежнему отображается старый сертификат 

#### <a name="symptom"></a>Симптом

Сертификат службы приложений обновлен, но приложение, использующее сертификат службы приложений, по-прежнему использует старый сертификат. Кроме того, вы получили предупреждение о том, что необходим протокол HTTP.

#### <a name="cause"></a>Причина 
Служба приложений автоматически синхронизирует ваш сертификат в течение 48 часов. Если вы изменяете или обновляете сертификат, иногда приложение по-прежнему извлекает старый сертификат, а не только что обновленный. Это связано с тем, что задание для синхронизации ресурсов сертификата еще не запущено. Нажмите синхронизацию. Операция синхронизации автоматически обновляет привязки хоста для сертификата в Службе App, не вызывая простоев для ваших приложений.
 
#### <a name="solution"></a>Решение

Вы можете принудительно выполнить синхронизацию сертификата. Для этого сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com). Выберите **Сертификаты службы приложений**, а затем — сертификат.
2. Выберите **Rekey и Sync,** а затем выберите **синхронизацию.** Синхронизация занимает некоторое время, чтобы закончить. 
3. После завершения синхронизации отобразится следующее уведомление: "Все ресурсы обновлены с использованием нового сертификата".

### <a name="domain-verification-is-not-working"></a>Проверка домена не работает 

#### <a name="symptom"></a>Симптом 
Прежде чем использовать сертификат службы приложений, необходимо выполнить проверку домена. Если щелкнуть **Проверить**, процесс завершится ошибкой.

#### <a name="solution"></a>Решение
Проверьте домен вручную, добавив запись типа TXT:
 
1.  Перейдите к поставщику службы доменных имен (DNS), на котором размещено доменное имя.
2.  Добавьте запись типа TXT для домена, использующего значение токена домена, показанного на портале Azure. 

Подождите несколько минут до запуска распространения данных в DNS, а затем нажмите кнопку **Обновить** для запуска проверки. 

В качестве альтернативы вы можете использовать метод веб-страницы HTML, чтобы вручную подтвердить свой домен. Этот метод позволяет центру сертификации подтвердить права на владение доменом, для которого выдан сертификат.

1.  Создайте HTML-файл с именем {токен проверки домена}.html. Содержимым этого файла должно быть значение токена проверки домена.
3.  Отправьте этот файл в корень веб-сервера, на котором размещается ваш домен.
4.  Выберите **Обновить**, чтобы проверить состояние сертификата. Проверка может занять несколько минут.

Например, если вы приобретаете стандартный сертификат для azure.com с токеном проверки домена 1234abcd, то веб-запрос, направленный по адресу https://azure.com/1234abcd.html, должен возвратить 1234abcd. 

> [!IMPORTANT]
> При заказе сертификата на проверку домена отводится всего 15 дней, по истечении которых сертификат отклоняется центром сертификации, а счет за этот сертификат не выставляется. В такой ситуации удалите этот сертификат и повторите попытку.
>
> 

### <a name="you-cant-purchase-a-domain"></a>Не удается приобрести домен

#### <a name="symptom"></a>Симптом
Не удается приобрести домен службы приложений на портале Azure.

#### <a name="cause-and-solution"></a>Причина и решение

Эта ошибка возникает по одной из следующих причин:

- Кредитная карта для подписки Azure отсутствует или недействительна.

    **Решение.** Добавьте действительную кредитную карту в подписку.

- Вы не являетесь владельцем подписки, поэтому у вас нет разрешения на покупку домена.

    **Решение.**[Назначьте роль "Владелец" ](../role-based-access-control/role-assignments-portal.md) своей учетной записи. Или свяжитесь с администратором, чтобы получить разрешение на приобретение домена.
- Вы достигли предельного числа приобретений доменов для подписки. Текущее ограничение — 20.

    **Решение.** Чтобы отправить запрос на увеличение ограничения, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Тип подписки Azure не поддерживает покупку домена службы приложений.

    **Решение.** Обновите подписку Azure до других типов подписки, например до подписки с оплатой по мере использования.

### <a name="you-cant-add-a-host-name-to-an-app"></a>Не удается добавить имя узла в приложение 

#### <a name="symptom"></a>Симптом

При добавлении имени узла процесс проверки и утверждения домена завершается ошибкой.

#### <a name="cause"></a>Причина 

Эта ошибка возникает по одной из следующих причин:

- У вас нет разрешения на добавление имени узла.

    **Решение.** Попросите администратора подписки дать вам разрешение на добавление имени узла.
- Не удается выполнить проверку владельца домена.

    **Решение.** Убедитесь, что запись CNAME или A настроены правильно. Чтобы сопоставить личный домен с приложением, создайте запись CNAME или A. Если вы хотите использовать корневой домен, необходимо воспользоваться записями типа A и TXT.

    |Тип записи|Узел|На что указывает|
    |------|------|-----|
    |Объект|@|IP-адрес приложения|
    |TXT|@|`<app-name>.azurewebsites.net`|
    |CNAME|www|`<app-name>.azurewebsites.net`|

## <a name="faq"></a>часто задаваемые вопросы

**Должен ли я настроить свой пользовательский домен для моего сайта, как только я покупаю его?**

При покупке домена на портале Azure приложение Службы приложений автоматически настраивается на использование этого пользовательского домена. Вам не нужно предпринимать никаких дополнительных шагов. Для получения дополнительной информации, смотреть [Azure App Service Self Help: Добавить пользовательские доменное имя](https://channel9.msdn.com/blogs/Azure-App-Service-Self-Help/Add-a-Custom-Domain-Name) на Channel9.

**Могу ли я использовать домен, приобретенный на портале Azure, чтобы вместо этого указать на VM Azure?**

Да, вы можете указать домен на VM. Дополнительные сведения см. в статье [Использование Azure DNS для указания параметров личного домена для службы Azure](../dns/dns-custom-domain.md).

**Является ли мой домен размещенным GoDaddy или Azure DNS?**

Домены Службы приложений используют GoDaddy для регистрации доменов и Azure DNS для размещения доменов. 

**Я автоматическое обновление включен, но все еще получил уведомление о продлении моего домена по электронной почте. Что мне делать?**

Если у вас есть автоматическое обновление включено, вам не нужно предпринимать никаких действий. Уведомление электронной почты предоставляется сообщить вам, что домен близок к истечению и возобновить вручную, если автоматическое обновление не включено.

**Будет ли с меня взиматься плата за размещение в домене Azure DNS?**

Начальная стоимость покупки домена распространяется только на регистрацию домена. В дополнение к стоимости регистрации, есть несучисленные расходы для Azure DNS на основе вашего использования. Для получения дополнительной информации, см [Azure DNS цены](https://azure.microsoft.com/pricing/details/dns/) для получения более подробной информации.

**Ранее я приобрел свой домен на портале Azure и хочу перейти от хостинга GoDaddy к хостингу Azure DNS. Как я могу это сделать?**

Перенос хостинга Azure DNS не является обязательным. Если вы хотите перейти на Azure DNS, опыт управления доменами на портале Azure предоставляет информацию о шагах, необходимых для перехода на Azure DNS. Если домен был приобретен через службу app, миграция с хостинга GoDaddy в Azure DNS является относительно бесшовной процедурой.

**Я хотел бы приобрести свой домен в домене Службы App, но могу ли я разместить свой домен на GoDaddy вместо Azure DNS?**

Начиная с 24 июля 2017 года домены Службы приложений, приобретенные на портале, размещаются на Azure DNS. Если вы предпочитаете использовать другой хостинг-провайдера, вы должны пойти на их веб-сайт, чтобы получить решение хостинга домена.

**Должен ли я платить за защиту конфиденциальности для моего домена?**

При покупке домена через портал Azure вы можете добавить конфиденциальность без дополнительной платы. Это одно из преимуществ покупки домена через службу приложений Azure.

**Если я решу, что мне больше не нужен мой домен, могу ли я вернуть свои деньги?**

При покупке домена с вас не взимается плата в течение пяти дней, в течение которых вы можете решить, что вам не нужен домен. Если вы решите, что вам не нужен домен в течение этого пятидневного периода, с вас не взимается плата. (.uk домены являются исключением из этого. Если вы покупаете домен .uk, с вас сразу же взимается плата и вы не можете быть возвращены.)

**Могу ли я использовать домен в другом приложении Azure App Service в моей подписке?**

Да. При доступе к пользовательским доменотам и лезвию SSL на портале Azure вы видите приобретенные домены. Вы можете настроить приложение, чтобы использовать любой из этих доменов.

**Могу ли я перенести домен из одной подписки на другую?**

Вы можете переместить домен в другую группу подписчиков/ресурсов с помощью cmdlet [Move-AzResource](https://docs.microsoft.com/powershell/module/az.Resources/Move-azResource) PowerShell.

**Как я могу управлять пользовательским доменом, если в настоящее время у меня нет приложения Azure App Service?**

Вы можете управлять своим доменом, даже если у вас нет Web App Service App App App App. Домен может использоваться для служб Azure, таких как Virtual machine, Storage и т.д. Если вы собираетесь использовать домен для Web Apps Службы App, то вам нужно включить Web App, которое не входит в план Бесплатного Сервиса Приложений, чтобы связать домен с вашим веб-приложением.

**Могу ли я переместить веб-приложение с пользовательским доменом на другую подписку или из App Service Environment v1 в V2?**

Да, вы можете перемещать веб-приложение по подписке. Следуйте инструкциям в [Отделе Ресурсов в Azure](../azure-resource-manager/management/move-resource-group-and-subscription.md). Есть несколько ограничений при перемещении веб-приложения. Для получения дополнительной [информации см.](../azure-resource-manager/management/move-limitations/app-service-move-limitations.md)

После перемещения веб-приложения привязки имен хоста доменов в настройках пользовательских доменов должны оставаться прежними. Для настройки привязки имен хоста не требуется никаких дополнительных шагов.
