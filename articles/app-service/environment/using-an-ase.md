---
title: Использование и управление средой службы приложений
description: Узнайте, как создавать, публиковать и масштабировать приложения в среде службы приложений. Найдите все общие задачи в этой статье.
author: ccompy
ms.assetid: a22450c4-9b8b-41d4-9568-c4646f4cf66b
ms.topic: article
ms.date: 01/01/2020
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 7ca6882aea7225dcb97c9f913267b2543de07fef
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "80133124"
---
# <a name="use-an-app-service-environment"></a>Использование среды службы приложений

Среда службы приложений (ASE) — это развертывание службы приложений Azure в поднете в экземпляре виртуальной сети Клиента. ASE состоит из:

- **Передние концы**: Где HTTP или HTTPS завершается в среде службы приложений.
- **Рабочие**: Ресурсы, в мещающие ваши приложения.
- **База данных**: Содержит информацию, определяющую среду.
- **Хранение**: Используется для размещения опубликованных клиентом приложений.

Вы можете развернуть ASE с внешним или внутренним виртуальным IP (VIP) для доступа к приложениям. Развертывание с внешним VIP обычно называется *внешним ASE*. Развертывание с внутренним VIP называется *ILB ASE,* поскольку он использует внутренний балансера нагрузки (ILB). Дополнительные сведения об ASE с ILB см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE].

## <a name="create-an-app-in-an-ase"></a>Создание приложения в ASE

Чтобы создать приложение в ASE, вы используете тот же процесс, что и при обычном создании приложения, но с небольшими различиями. При создании плана службы приложений:

- Вместо выбора географического расположения, в котором будет развернуто приложение, выберите ASE в качестве расположения.
- Все планы Службы приложений, созданные в ASE, могут быть только в изолированном ценовом уровне.

Если у вас нет ASE, вы можете создать его, следуя инструкциям в [создании среды службы приложений.][MakeExternalASE]

Создание приложения в ASE.

1. Выберите **Создать ресурс** > **Веб - Мобильное** > **веб-приложение**.

1. Введите имя приложения. Если вы уже выбрали план службы приложений в ASE, доменное имя приложения отражает доменное имя ASE:

    ![Выбор имени приложения][1]

1. Выберите подписку.

1. Введите имя для новой группы ресурсов или щелкните **Использовать существующий** и выберите вариант имени из раскрывающегося списка.

1. Выберите используемую операционную систему.

1. Выберите имеющийся план службы приложений в своей среде ASE или создайте его, сделав следующее:

    а. Из меню слева портала Azure выберите **ресурс > Web App.**

    b. Выберите подписку.

    c. Выберите или создайте группу ресурсов.

    d. Введите название вашего веб-приложения.

    д) Выберите **код** или **DockerContainer**.

    е) Выберите стек времени выполнения.

    ж. Выберите **Linux** или **Windows**. 

    h. Выберите список ASE в **регионе.** 

    i. Выберите или создайте новый план службы приложений. При создании нового плана службы приложений выберите подходящий **изолированный** размер SKU.

    ![Ценовая категория Isolated][2]

    > [!NOTE]
    > Приложения Linux и приложения Windows не могут быть в том же плане службы приложений, но они могут быть в той же среде службы приложений.
    >

1. Выберите **Обзор и создайте,** убедитесь, что информация верна, а затем выберите **Создать**.

## <a name="how-scale-works"></a>Как работает масштабирование

Каждая служба приложений выполняется в плане службы приложений. В средах службы приложений содержатся планы службы приложений, которые в свою очередь содержат приложения. При масштабе приложения вы также масштабируете план Службы приложений и все приложения в этом же плане.

При масштабе плана службы приложений необходимая инфраструктура добавляется автоматически. При добавлении инфраструктуры происходит задержка с масштабированием операций. Если вы делаете несколько операций масштаба в последовательности, первый запрос масштаба инфраструктуры работает на и другие в очереди. Когда первая операция масштаба завершается, другие запросы инфраструктуры работают вместе. А когда инфраструктура добавляется, планы Службы приложений назначаются по мере необходимости. Создание нового плана Службы Приложений само по себе является масштабной операцией, поскольку он запрашивает дополнительное оборудование.

В мультитенантной службе приложений масштабирование происходит немедленно, поскольку для его поддержки легко доступно пул ресурсов. В ASE нет такого буфера, и ресурсы выделяются в зависимости от потребностей.

В ASE можно масштабировать план службы приложений до 100 экземпляров. ASE может иметь до 201 общего экземпляра во всех планах Службы приложений в этом ASE.

## <a name="ip-addresses"></a>IP-адреса

Служба приложений может выделить специальному IP-адресу приложения. Эта возможность доступна после настройки SSL на основе IP, как описано в [Свяжите существующий пользовательский сертификат SSL в Службу приложений Azure.][ConfigureSSL] В ILB ASE нельзя добавлять больше IP-адресов, которые будут использоваться для SSL на основе IP.

С помощью внешнего ASE вы можете настроить SSL на основе IP для вашего приложения так же, как и в мультитенантной службе приложений. В ASE всегда есть один запасной адрес, до 30 IP-адресов. Каждый раз, когда вы используете один, другой добавляется так, что адрес всегда легко доступны. Для выделения другого IP-адреса требуется задержка во времени. Эта задержка предотвращает быстрое добавление IP-адресов.

## <a name="front-end-scaling"></a>Масштабирование внешнего интерфейса

При масштабе расширения планов службы приложений для их поддержки автоматически добавляются работники. Каждый ASE создается с двумя внешними интерфейсами. Передние концы автоматически масштабируются со скоростью одного переднего конца для каждого набора из 15 экземпляров плана App Service. Например, если у вас есть три плана Службы Приложений с пятью экземплярами каждый, у вас будет в общей сложности 15 экземпляров и три передних конца. Если масштабировать до 30 экземпляров, у вас есть четыре передних конца. Эта модель продолжается по мере масштабирования.

Количество передних концов, которые выделяются по умолчанию, хорошо подходит для умеренной нагрузки. Можно снизить соотношение до одного переднего конца для каждых пяти экземпляров. Вы также можете изменить размер передних концов. По умолчанию они являются единым ядром. На портале Azure можно изменить их размер до двух или четырех ядер.

За изменение соотношения или размеров переднего конца взимается плата. Дополнительные сведения см. на странице [цен на службу приложений Azure][Pricing]. Если вы хотите улучшить грузоподъемность вашего ASE, вы получите больше улучшений путем первого масштабирования до двухъядерных передних концов, прежде чем настроить соотношение шкалы. Изменение размера ядра передних концов приведет к обновлению вашего ASE и должно быть сделано за пределами обычных рабочих часов.

Ресурсы внешних интерфейсов являются конечной точкой HTTP/HTTPS для среды ASE. При сохранении конфигурации внешних интерфейсов по умолчанию показатель использования памяти на каждый внешний интерфейс обычно составляет примерно 60 %. Основной причиной масштабирования передних концов является использование процессора, который в первую очередь определяется трафиком HTTPS.

## <a name="app-access"></a>Доступ к приложениям

Во внешнем ASE суффикс домена, используемый для создания *приложения, — это .&lt; asename&gt;.p.azurewebsites.net*. Если ваш ASE назван _внешней асе_ и вы размещаете приложение под названием _contoso_ в этом ASE, вы достигнете его на следующих URL-адресах:

- contoso.external-ase.p.azurewebsites.net
- contoso.scm.external-ase.p.azurewebsites.net

Для получения информации о том, как создать внешний ASE, [см.][MakeExternalASE]

В ILB ASE, суффикс домена, используемый для создания *приложения.&lt; asename&gt;.appserviceenvironment.net*. Если ваш ASE назван _ilb-ase_ и вы размещаете приложение под названием _contoso_ в этом ASE, вы достигнете его на следующих URL-адресах:

- contoso.ilb-ase.appserviceenvironment.net
- contoso.scm.ilb-ase.appserviceenvironment.net

Для получения информации о том, как создать ILB ASE, [см.][MakeILBASE]

URL-адрес SCM используется для доступа к консоли Kudu или для публикации приложения с помощью Web Deploy. Сведения о консоли Kudu см. на странице [Kudu console for Azure App Service][Kudu] (Консоль Kudu для службы приложений Azure). Консоль Kudu предоставляет веб-интерфейс для отладки, передачи и редактирования файлов, а также многих других возможностей.

## <a name="publishing"></a>Публикация

В ASE, как и в мультитенантном App Service, вы можете опубликовать следующими методами:

- Веб-развертывание
- FTP
- Непрерывная интеграция (CI)
- функция перетаскивания в консоли Kudu;
- IDE, такие как Visual Studio, Eclipse или IntelliJ IDEA

С внешним ASE эти варианты публикации работают одинаково. Дополнительные сведения см. в статье [Развертывание приложения в службе приложений Azure][AppDeploy].

Публикация существенно отличается от ILB ASE, для которого конечные точки публикации доступны только через ILB. Внутренняя подсистема балансировки нагрузки расположена на частном IP-адресе в подсети ASE в виртуальной сети. Если у вас нет сетевого доступа к ILB, вы не можете публиковать какие-либо приложения на этом ASE. Как отмечено в [Создании и использовании ILB ASE,][MakeILBASE]вы должны настроить DNS для приложений в системе. Это требование включает конечную точку СКМ. Если конечные точки не определены должным образом, вы не можете опубликовать. Ваши IDEs также должны иметь сетевой доступ к ILB для публикации непосредственно к нему.

Без дополнительных изменений системы CI, базирующиеся в Интернете, такие как GitHub и Azure DevOps, не работают с ILB ASE, поскольку конечная точка публикации недоступна для интернета. Вы можете включить публикацию в ILB ASE от Azure DevOps, установив самостоятельный агент по выпуску в виртуальной сети, содержащей ILB ASE. Кроме того, можно также использовать систему CI, используюую модель притяжения, такую как Dropbox.

Для конечных точек публикации приложений в среде ASE с ILB используется домен, созданный вместе со средой. Вы можете увидеть его в профиле публикации приложения и в панели портала приложения (в **ОбзорЕ** > **Основы,** а также в **свойствах**).

## <a name="storage"></a>Хранилище

ASE имеет 1 ТБ хранения для всех приложений в ASE. План службы приложений в изолированном ценообразовании SKU имеет предел 250 ГБ по умолчанию. Если у вас есть пять или более планов Службы Приложений, будьте осторожны, чтобы не превысить 1-ТБ предел ASE. Если вам нужно больше лимита в 250 ГБ в одном плане Службы Приложения, обратитесь в службу поддержки, чтобы настроить лимит плана Службы поддержки приложений до максимум1 ТБ. При корректировке лимита плана во всех планах Службы приложений в ASE все еще существует ограничение в 1 ТБ.

## <a name="logging"></a>Ведение журнала

Вы можете интегрировать ASE с Azure Monitor для отправки журналов о ASE в хранилища Azure, концентраторы событий Azure или журналная аналитика. Эти элементы регистрируются сегодня:

| Ситуация | Сообщение |
|---------|----------|
| ASE нездорова | Указанный ASE неработоспособен из-за недействительной виртуальной конфигурации сети. ASE будет приостановлено, если нездоровое состояние будет продолжаться. Убедитесь, что руководящие https://docs.microsoft.com/azure/app-service/environment/network-infoпринципы, определенные здесь, соблюдаются: . |
| Субнет ASE почти вне пространства | Указанный ASE находится в подсети, которая почти вне пространства. Есть {0} остальные адреса. После того, как эти адреса исчерпаны, ASE не сможет масштабироваться.  |
| ASE приближается к общему лимиту экземпляров | Указанный ASE приближается к общему пределу экземпляра ASE. В настоящее время он содержит {0} экземпляры Плана службы приложений, насыпав максимум 201 экземпляром. |
| ASE не может достичь зависимости | Указанный ASE не в {0}состоянии достичь .  Убедитесь, что руководящие https://docs.microsoft.com/azure/app-service/environment/network-infoпринципы, определенные здесь, соблюдаются: . |
| ASE приостанавливается | Указанный ASE приостанавливается. Приостановка ASE может быть вызвана нехваткой учетной записи или недействительной конфигурацией виртуальной сети. Устранить первопричину и возобновить ASE, чтобы продолжить обслуживание трафика. |
| Началось обновление ASE | Началась модернизация платформы до указанного ASE. Ожидайте задержки в операциях масштабирования. |
| Обновление ASE завершено | Завершено обновление платформы до указанного ASE. |
| Началась шкала операций | План службы{0}приложений () начал масштабирование. Пожеланное {1} {2} состояние: Я работников.
| Масштабные операции завершены | План службы{0}приложений () закончил масштабирование. Текущее {1} состояние: Я{2} работников. |
| Операции масштаба не удались | План службы{0}приложений () не масштабируется. Текущее {1} состояние: Я{2} работников. |

Для включения в систему ASE:

1. На портале перейдите в **настройки диагностики.**
1. Выберите **Диагностическую настройку добавления.**
1. Укажите название интеграции журнала.
1. Выберите и назначайте нужные назначения журнала.
1. Выберите **AppServiceEnvironmentPlatformLogs**.

![Настройки диагностического журнала ASE][4]

Если вы интегрируетесь с Log Analytics, вы можете увидеть журналы, выбрав **журналы** с портала ASE и создав запрос против **AppServiceEnvironmentPlatformLogs.**

## <a name="upgrade-preference"></a>Предпочтение обновления

Если у вас несколько ASEs, вы можете захотеть обновить некоторые ASEs раньше других. В объекте ASE **HostingEnvironment Resource Manager** можно установить значение для **обновленияPreference.** Настройка **обновленияPreference** может быть настроена с помощью https://resources.azure.comшаблона, ARMClient или . Три возможных значения:

- **Нет:** Azure не будет обновлять ВАШ ASE в какой-либо конкретной партии. Это значение по умолчанию.
- **Рано**: Ваш ASE будет обновлен в первой половине обновления службы приложений.
- **Поздно**: Ваш ASE будет обновлен во второй половине обновления службы приложений.

Если вы используете, https://resources.azure.comвыполните следующие действия, чтобы установить значение **обновленияPreferences:**

1. Перейдите на resources.azure.com и войдите в учетную запись Azure.
1. Перейти через ресурсы\/\[\]\/подписки\/\[имя ресурсаГруппы ресурсов\/группы\/\[имен\]\/\]провайдеров\/Microsoft.Web хостингEnvironments ASE имя .
1. Выберите **Чтение/Запись** в верхней части.
1. Выберите **Изменить**.
1. Установите **обновлениеПредпочтение** к какому из трех значений вы хотите.
1. Выберите **патч**.

![ресурсы лазурный ком дисплей][5]

Функция **обновленияPreferences** имеет наибольший смысл, когда у вас есть несколько ASEs, потому что ваши "Ранние" ASEs будут обновлены до вашего "Поздно" ASEs. Если у вас есть несколько ASEs, вы должны установить вашу разработку и тестирование ASEs быть "Ранний", и ваши производства ASEs быть "Поздно".

## <a name="pricing"></a>Цены

Ценообразование SKU называется *изолированных* для использования только с ASEs. Все планы Службы приложений, размещенные в ASE, находятся в изолированном ценообразовании SKU. Изолированные тарифы для планов Службы приложений могут варьироваться в зависимости от региона.

В дополнение к цене ваших планов Службы приложений, есть фиксированная ставка для самого ASE. Фиксированная ставка не меняется с размером вашего ASE. Он платит за инфраструктуру ASE по ставке по умолчанию, которая составляет один дополнительный передний конец для каждых 15 экземпляров плана App Service.

Если скорость шкалы по умолчанию одного переднего конца для каждых 15 экземпляров плана App Service недостаточно быстрая, можно настроить соотношение, при котором добавляются передние концы, или размер передних концов. При изменении этого соотношения или размера оплачивается число ядер внешних интерфейсов, которые не были бы добавлены при использовании параметров по умолчанию.

Например, если установить значение коэффициента масштабирования 10, то внешний интерфейс будет добавляться для каждых 10 экземпляров в планах службы приложений. Фиксированная плата охватывает масштаб "1 внешний интерфейс на каждые 15 экземпляров". При значении коэффициента масштабирования 10 вам придется заплатить за третий внешний интерфейс, который добавляется при 10 экземплярах плана службы приложений. Но когда число дойдет до 15 экземпляров, вам не нужно будет ничего доплачивать, так как интерфейс был бы добавлен автоматически.

Если вы отрегулируете размер передних концов до двух ядер, но не регулируете соотношение, вы платите за дополнительные ядра. ASE создается с двумя передними концами, так что даже ниже порога автоматического масштабирования вы бы заплатили за два дополнительных ядра, если вы увеличили размер до двухъядерных передних концов.

Дополнительные сведения см. на странице [цен на службу приложений Azure][Pricing].

## <a name="delete-an-ase"></a>Удаление ASE

Чтобы удалить ASE, сделайте следующее:

1. Выберите **Удалить** в верхней части панели **среды службы приложений.**

1. Введите имя среды ASE, чтобы подтвердить ее удаление. При удалении ASE вы также удаляете весь контент в нем.

    ![Удаление ASE][3]

1. Нажмите кнопку **ОК**.

<!--Image references-->
[1]: ./media/using_an_app_service_environment/usingase-appcreate.png
[2]: ./media/using_an_app_service_environment/usingase-pricingtiers.png
[3]: ./media/using_an_app_service_environment/usingase-delete.png
[4]: ./media/using_an_app_service_environment/usingase-logsetup.png
[4]: ./media/using_an_app_service_environment/usingase-logs.png
[5]: ./media/using_an_app_service_environment/usingase-upgradepref.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/security-overview.md
[ConfigureASEv1]: app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: app-service-app-service-environment-intro.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: https://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/management/overview.md
[ConfigureSSL]: ../configure-ssl-certificate.md
[Kudu]: https://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../deploy-local-git.md
[ASEWAF]: app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
