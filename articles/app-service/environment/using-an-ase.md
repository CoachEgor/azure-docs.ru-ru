---
title: Использование ASE и управление ими
description: Как создавать, публиковать и масштабировать приложения в среде службы приложений Azure. Поиск типичных задач в одном документе.
author: ccompy
ms.assetid: a22450c4-9b8b-41d4-9568-c4646f4cf66b
ms.topic: article
ms.date: 05/28/2019
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: e5c127673e4b0cb6c68aaf0a9790abbf78758670
ms.sourcegitcommit: 48b7a50fc2d19c7382916cb2f591507b1c784ee5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2019
ms.locfileid: "74687096"
---
# <a name="use-an-app-service-environment"></a>Использование среды службы приложений #

Среда службы приложений — это развернутая служба приложений Azure в подсети виртуальной сети Azure клиента. В ее состав входит:

- **Внешние интерфейсы** —это то место, где завершается сеанс HTTP/HTTPS в среде службы приложений (ASE).
- **Рабочие роли** — это ресурсы, в которых размещаются приложения.
- **База данных** содержит сведения, определяющие среду.
- **Хранилище** используется для размещения опубликованных приложений клиента.

> [!NOTE]
> Существует две версии среды службы приложений: ASEv1 и ASEv2. В ASEv1 необходимо выполнить управление ресурсами, прежде чем их можно будет использовать. Сведения о настройке ASEv1 и управлении ими см. в статье [Настройка среды службы приложений][ConfigureASEv1]версии 1. Оставшаяся часть этой статьи посвящена ASEv2.
>
>

Вы можете развернуть ASE (ASEv1 и ASEv2) с использованием внешнего или внутреннего виртуального IP-адреса для доступа к приложению. Такой способ развертывания обычно называется внешней средой ASE. Внутренняя версия называется ASE с ILB, так как она использует внутренний балансировщик нагрузки (ILB). Дополнительные сведения о ILB ASE см. в статье [Создание и использование ilB ASE][MakeILBASE].

## <a name="create-an-app-in-an-ase"></a>Создание приложения в ASE ##

Приложение в ASE можно создать стандартно, но с некоторыми небольшими отличиями. При создании плана службы приложений:

- Вместо выбора географического расположения, в котором будет развернуто приложение, выберите ASE в качестве расположения.
- все планы службы приложений, создаваемые в ASE, должны находиться в ценовой категории Isolated.

Если у вас нет ASE, можно создать его, следуя инструкциям в разделе [Создание среды службы приложений][MakeExternalASE].

Создание приложения в ASE.

1. Последовательно выберите **Создать ресурс** > **Интернет+мобильные устройства** > **Веб-приложение**.

2. Введите имя приложения. Если вы уже выбрали план службы приложений в среде ASE, то доменное имя приложения будет отражать доменное имя среды ASE.

    ![Выбор имени приложения][1]

1. Выберите подписку.

1. Введите имя для новой группы ресурсов или щелкните **Использовать существующий** и выберите вариант имени из раскрывающегося списка.

1. Выберите используемую операционную систему. 

1. Выберите имеющийся план службы приложений в своей среде ASE или создайте его, сделав следующее:

    а) Выберите **Создать**.

    б) Укажите имя для своего плана службы приложений.

    в) В раскрывающемся списке **Расположение** выберите свою среду ASE. 
    
    г) Выберите ценовую категорию **Isolated**. Щелкните **Выбрать**.

    д) Нажмите кнопку **ОК**.
    
    ![Ценовая категория Isolated][2]

    > [!NOTE]
    > Приложения Linux и Windows не могут находиться в одном плане службы приложений, но могут находиться в одной среде службы приложений. 
    >

2. Нажмите кнопку **Создать**.

## <a name="how-scale-works"></a>Как работает масштабирование ##

Каждая служба приложений выполняется в плане службы приложений. Модель контейнера имеет такой вид: среды содержат планы служб приложений, а планы служб приложений содержат приложения. При масштабировании приложения выполняется масштабирование плана службы приложений, поэтому масштабируются все приложения в этом плане.

В версии ASEv2 при масштабировании плана службы приложений необходимая инфраструктура добавляется автоматически. При добавлении инфраструктуры операции масштабирования выполняются с задержкой. В ASEv1 требуемую инфраструктуру нужно добавить прежде чем можно будет создать или развернуть план службы приложений. 

В мультитенантной службе приложений масштабирование обычно выполняется немедленно, так как пул ресурсов доступен для его поддержки. В среде ASE такого буфера нет, поэтому ресурсы выделяются по мере необходимости.

ASE позволяет масштабировать до 100 экземпляров. Эти 100 экземпляров могут находиться в одном плане службы приложений или распределяться по разным планам.

## <a name="ip-addresses"></a>IP-адреса ##

Служба приложений имеет возможность предоставлять приложениям выделенные IP-адреса. Эта возможность доступна после настройки SSL на основе IP-адреса, как описано в статье [Привязка существующего ПОЛЬЗОВАТЕЛЬСКОГО SSL-сертификата к службе приложений Azure][ConfigureSSL]. В ASE явные исключения отсутствуют. В ASE с ILB невозможно добавить дополнительные IP-адреса для SSL на основе IP-адреса.

В версии ASEv1 IP-адреса необходимо выделить в качестве ресурсов, чтобы их можно было использовать. В ASEv2 они используется из приложения так же, как и в мультитенантной службе приложений. В ASEv2 всегда имеется один запасной адрес (до 30 IP-адресов). Каждый раз при использовании одного адреса добавляется еще один, чтобы всегда был доступный адрес. При выделении следующего IP-адреса возникает временная задержка, которая влияет на процесс быстрого добавления IP-адресов.

## <a name="front-end-scaling"></a>Масштабирование внешнего интерфейса ##

В среде ASEv2 при масштабировании планов службы приложений для их поддержки автоматически добавляются рабочие роли. Каждый ASE создается с двумя внешними интерфейсами. Кроме того, в планах службы приложений внешние интерфейсы автоматически масштабируются (по одному внешнему интерфейса на каждые 15 экземпляров). Например, если у вас есть 15 экземпляров, то вы имеете три внешних интерфейса. При масштабировании до 30 экземпляров у вас будет четыре внешних интерфейса, и так далее.

Для большинства сценариев такого количества внешних интерфейсов более чем достаточно. Тем не менее можно выполнять масштабирование быстрее. Вы можете установить маленький коэффициент (по одному внешнему интерфейсу на каждые пять экземпляров). За изменение коэффициента взимается плата. Дополнительные сведения см. в статье [цены на службу приложений Azure][Pricing].

Ресурсы внешних интерфейсов являются конечной точкой HTTP/HTTPS для среды ASE. При сохранении конфигурации внешних интерфейсов по умолчанию показатель использования памяти на каждый внешний интерфейс обычно составляет примерно 60 %. Рабочие нагрузки клиентов не выполняются во внешнем интерфейсе. Ключевым фактором, влияющим на внешний интерфейс в части масштабирования, является использование ЦП, которое определяется, в первую очередь, HTTPS-трафиком.

## <a name="app-access"></a>Доступ к приложениям ##

Во внешней среде ASE домен, использующийся при создании приложений, отличается от мультитенантной службы приложений. Он включает имя среды ASE. Дополнительные сведения о создании внешних ASE см. в статье [Создание среды службы приложений][MakeExternalASE]. Доменное имя во внешней среде ASE имеет формат *.&lt;asename&gt;.p.azurewebsites.net*. Например, если имя вашей среды ASE — _external-ase_, а имя размещаемого в этой среде приложения — _contoso_, то получить к нему доступ можно по следующим URL-адресам:

- contoso.external-ase.p.azurewebsites.net
- contoso.scm.external-ase.p.azurewebsites.net

URL-адрес contoso.scm.external-ase.p.azurewebsites.net используется для доступа к консоли Kudu или для публикации приложения с помощью веб-развертывания. Сведения о консоли KUDU см. в статье [консоль KUDU для службы приложений Azure][Kudu]. Консоль Kudu предоставляет веб-интерфейс для отладки, передачи и редактирования файлов, а также многих других возможностей.

В среде ASE ILB домен определяется во время развертывания. Дополнительные сведения о создании ASE ILB см. в статье [Создание и использование ilB ASE][MakeILBASE]. Если указать доменное имя _ilb-ase.info_, то приложения в данной среде ASE будут использовать этот домен при создании приложений. Если имя приложения — _contoso_, то URL-адреса будут следующими:

- contoso.ilb-ase.info
- contoso.scm.ilb-ase.info

## <a name="publishing"></a>Публикация ##

По аналогии с мультитенантной службой приложений в среде ASE для публикации можно использовать следующие средства:

- веб-развертывания;
- FTP;
- непрерывная интеграция;
- функция перетаскивания в консоли Kudu;
- интегрированная среда разработки (IDE), например Visual Studio, Eclipse или IntelliJ IDEA.

Во внешней среде ASE все эти параметры публикации ведут себя одинаково. Дополнительные сведения см. [в разделе Развертывание в службе приложений Azure][AppDeploy]. 

Публикация с помощью среды ASE с ILB существенно отличается. При использовании этой среды все конечные точки публикации доступны только через внутреннюю подсистему балансировки нагрузки (ILB). Внутренняя подсистема балансировки нагрузки расположена на частном IP-адресе в подсети ASE в виртуальной сети. Без сетевого доступа к внутренней подсистеме балансировки нагрузки в среде ASE не удастся опубликовать ни одного приложения. Как отмечалось при [создании и использовании ilB ASE][MakeILBASE], необходимо настроить DNS для приложений в системе. В эти настройки входит конечная точка SCM. Если они не определены должным образом, вы не сможете их опубликовать. В интегрированных средах разработки также требуется сетевой доступ к внутренней подсистеме балансировки нагрузки для публикации напрямую.

Готовые к работе системы непрерывной интеграции, такие как GitHub и Azure DevOps, не работают с ASE ILB, так как конечная точка публикации не доступна в Интернете. Для Azure DevOps это можно обойти, установив саморазмещаемый агент выпусков во внутренней сети, где он может связаться с ILB. Кроме того, можно использовать систему CI, которая использует модель извлечения, например Dropbox.

Для конечных точек публикации приложений в среде ASE с ILB используется домен, созданный вместе со средой. Это можно увидеть в профиле публикации приложения и в колонке приложения на портале (в разделе **Обзор** > **Основное** и в разделе **Свойства**). 

## <a name="pricing"></a>Стоимость ##

Ценовая категория (номер SKU) **Isolated** была создана для использования только с ASEv2. Все планы службы приложений, размещенные в ASEv2, относятся к ценовой категории (SKU) Isolated. Тарифы в плане службы приложений категории Isolated могут отличаться в зависимости от региона. 

Помимо цены плана службы приложений существует фиксированная плата за саму среду ASE. Эта плата не изменяется в зависимости от размера вашей среды ASE и взимается за инфраструктуру ASE. При этом применяется принцип масштабирования по умолчанию: 1 дополнительный внешний интерфейс на каждые 15 экземпляров плана службы приложений.  

Если принцип масштабирования по умолчанию (1 внешний интерфейс на каждые 15 экземпляров плана службы приложений) не соответствует имеющимся потребностям, то можно изменить число добавляемых внешних интерфейсов или их размер.  При изменении этого соотношения или размера оплачивается число ядер внешних интерфейсов, которые не были бы добавлены при использовании параметров по умолчанию.  

Например, если установить значение коэффициента масштабирования 10, то внешний интерфейс будет добавляться для каждых 10 экземпляров в планах службы приложений. Фиксированная плата охватывает масштаб "1 внешний интерфейс на каждые 15 экземпляров". При значении коэффициента масштабирования 10 вам придется заплатить за третий внешний интерфейс, который добавляется при 10 экземплярах плана службы приложений. Но когда число дойдет до 15 экземпляров, вам не нужно будет ничего доплачивать, так как интерфейс был бы добавлен автоматически.

Если изменить размер внешних интерфейсов до 2 ядер, но не изменить соотношение, то за дополнительные ядра будет взиматься плата.  Среда ASE создается с 2 внешними интерфейсами, поэтому даже ниже порогового значения автоматического масштабирования взимается плата за 2 дополнительных ядра, если размер внешних интерфейсов увеличен до 2 ядер.

Дополнительные сведения см. в статье [цены на службу приложений Azure][Pricing].

## <a name="delete-an-ase"></a>Удаление ASE ##

Чтобы удалить ASE, сделайте следующее: 

1. Воспользуйтесь функцией **удаления** в верхней части колонки **Среда службы приложений**. 

1. Введите имя среды ASE, чтобы подтвердить ее удаление. При удалении среды ASE также удаляются все ее содержимое. 

    ![Удаление ASE][3]

<!--Image references-->
[1]: ./media/using_an_app_service_environment/usingase-appcreate.png
[2]: ./media/using_an_app_service_environment/usingase-pricingtiers.png
[3]: ./media/using_an_app_service_environment/usingase-delete.png


<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/security-overview.md
[ConfigureASEv1]: app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: app-service-app-service-environment-intro.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: https://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../configure-ssl-certificate.md
[Kudu]: https://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../deploy-local-git.md
[ASEWAF]: app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
