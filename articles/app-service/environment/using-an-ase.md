---
title: Использование и управление Среда службы приложений
description: Как создавать, публиковать и масштабировать приложения в среде службы приложений Azure. Поиск типичных задач в одном документе.
author: ccompy
ms.assetid: a22450c4-9b8b-41d4-9568-c4646f4cf66b
ms.topic: article
ms.date: 01/01/2020
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 7be1676c8949cd30d5e1fe93a73afd75a5a9b67f
ms.sourcegitcommit: f27b045f7425d1d639cf0ff4bcf4752bf4d962d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/23/2020
ms.locfileid: "77565694"
---
# <a name="use-an-app-service-environment"></a>Использование среды службы приложений #

Среда службы приложений (ASE) — это развертывание службы приложений Azure в подсети в виртуальной сети Azure клиента. ASE состоит из следующих компонентов:

- **Внешние**интерфейсы. Внешние интерфейсы — это место, в котором HTTP/HTTPS завершает работу в среде службы приложений.
- **Рабочие роли** — это ресурсы, в которых размещаются приложения.
- **База данных** содержит сведения, определяющие среду.
- **Хранилище** используется для размещения опубликованных приложений клиента.

Вы можете развернуть ASE с внешним или внутренним виртуальным IP-адресом для доступа к приложению. Такой способ развертывания обычно называется внешней средой ASE. Внутренняя версия называется ASE с ILB, так как она использует внутренний балансировщик нагрузки (ILB). Дополнительные сведения о ILB ASE см. в статье [Создание и использование ilB ASE][MakeILBASE].

## <a name="create-an-app-in-an-ase"></a>Создание приложения в ASE ##

Приложение в ASE можно создать стандартно, но с некоторыми небольшими отличиями. При создании нового плана службы приложений (ASP):

- Вместо выбора географического расположения, в котором будет развернуто приложение, выберите ASE в качестве расположения.
- Все планы службы приложений, созданные в ASE, могут иметь только изолированную ценовую категорию.

Если у вас нет ASE, можно создать его, следуя инструкциям в разделе [Создание среды службы приложений][MakeExternalASE].

Создание приложения в ASE.

1. Последовательно выберите **Создать ресурс** > **Интернет+мобильные устройства** > **Веб-приложение**.

2. Введите имя приложения. Если вы уже выбрали план службы приложений в среде ASE, то доменное имя приложения будет отражать доменное имя среды ASE.

    ![Выбор имени приложения][1]

1. Выберите подписку.

1. Введите имя для новой группы ресурсов или щелкните **Использовать существующий** и выберите вариант имени из раскрывающегося списка.

1. Выберите используемую операционную систему. 

1. Выберите имеющийся план службы приложений в своей среде ASE или создайте его, сделав следующее:

    а. В меню портал Azure слева выберите **создать ресурс > веб-приложение**.

    б. Выберите подписку.
    
    в. Выберите или создайте группу ресурсов.
    
    . Укажите имя веб-приложения.
    
    д) Выберите код или Доккерконтаинер.
    
    е) Выберите Стек выполнения.
    
    ж. Выберите Linux или Windows. 
    
    h. Выберите ASE в раскрывающемся списке **регион** . 
    
    и. Выберите или создайте новый план службы приложений. При создании нового плана службы приложений выберите соответствующий размер **изолированного** SKU.
    
    ![Ценовая категория Isolated][2]

    > [!NOTE]
    > Приложения Linux и Windows не могут находиться в одном плане службы приложений, но могут находиться в одной среде службы приложений. 
    >

2. Выберите **проверить и создать** , а затем выберите **создать** , если сведения верны.

## <a name="how-scale-works"></a>Как работает масштабирование ##

Каждая служба приложений выполняется в плане службы приложений. В средах службы приложений содержатся планы службы приложений, которые в свою очередь содержат приложения. При масштабировании приложения выполняется масштабирование плана службы приложений, поэтому масштабируются все приложения в этом плане.

При масштабировании плана службы приложений необходимая инфраструктура добавляется автоматически. При добавлении инфраструктуры операции масштабирования выполняются с задержкой. Если выполнить несколько операций масштабирования последовательно, первый запрос на масштабирование инфраструктуры будет обрабатываться, а другие — в очереди. По завершении первой операции масштабирования все запросы инфраструктуры работают вместе. При добавлении инфраструктуры планы службы приложений назначаются соответствующим образом. Создание нового плана службы приложений само по себе является операцией масштабирования при запросе дополнительного оборудования. 

В службе приложений для клиентов масштабирование выполняется немедленно, так как для его поддержки доступен пул ресурсов. В среде ASE такого буфера нет, поэтому ресурсы выделяются по мере необходимости.

В ASE можно масштабировать план службы приложений до 100 экземпляров. ASE может иметь до 201 всего экземпляров во всех планах службы приложений, которые находятся в ASE. 

## <a name="ip-addresses"></a>IP-адреса ##

Служба приложений имеет возможность предоставлять приложениям выделенные IP-адреса. Возможность выделения выделенного IP-адреса для приложения доступна после настройки SSL на основе IP-адреса, как описано в статье [Привязка существующего настраиваемого SSL-сертификата к службе приложений Azure][ConfigureSSL]. В ILB ASE нельзя добавить дополнительные IP-адреса, которые будут использоваться для SSL на основе IP-адресов.

С помощью внешнего ASE можно настроить SSL на основе IP для приложения так же, как и в службе многоклиентских приложений. Всегда имеется один запасной адрес в ASE до 30 IP-адресов. Каждый раз при использовании одного адреса добавляется еще один, чтобы всегда был доступный адрес. При выделении следующего IP-адреса возникает временная задержка, которая влияет на процесс быстрого добавления IP-адресов.

## <a name="front-end-scaling"></a>Масштабирование внешнего интерфейса ##

При масштабировании планов службы приложений для их поддержки автоматически добавляются рабочие роли. Каждый ASE создается с двумя внешними интерфейсами. Внешний интерфейс автоматически масштабируется по скорости одного внешнего интерфейса для каждого 15 экземпляров плана службы приложений. Если у вас есть три плана службы приложений с пятью экземплярами, то у вас будет всего 15 экземпляров и три внешних интерфейса. Если вы масштабируете до 30 экземпляров, у вас есть четыре внешних интерфейса и т. д. 

Число внешних интерфейсов, выделенных по умолчанию, хорошо для средней нагрузки. Можно изменить соотношение до одного внешнего интерфейса для каждых пяти экземпляров. Также можно изменить размер внешних интерфейсов. По умолчанию они являются одним ядром. Вместо этого можно изменить размер внешних интерфейсов на портале на два или четыре основных размера. За изменение соотношения и размеров внешних интерфейсов взимается плата. Дополнительные сведения см. в статье [цены на службу приложений Azure][Pricing]. Если вы хотите увеличить емкость ASE, вы получите дополнительные улучшения, выполнив масштабирование до двух основных внешних интерфейсов, прежде чем настраивать коэффициент масштабирования. Изменение основного размера внешних интерфейсов приведет к обновлению ASE и должно выполняться за пределами обычного рабочего времени.

Внешние ресурсы — это конечная точка HTTP/HTTPS для ASE. При использовании конфигурации внешнего интерфейса по умолчанию использование памяти на стороне внешнего интерфейса постоянно составляет около 60 процентов. Основной причиной масштабирования внешних интерфейсов является ЦП, который в основном управляется трафиком HTTPS.

## <a name="app-access"></a>Доступ к приложениям ##

Во внешнем ASE суффиксом домена, используемым для создания приложения, является *.&lt;asename&gt;. p.azurewebsites.NET*. Если ASE имеет имя _External-ASE_ и вы размещаете приложение _contoso_ в этом ASEе, его можно получить по следующим URL-адресам:

- contoso.external-ase.p.azurewebsites.net
- contoso.scm.external-ase.p.azurewebsites.net

Дополнительные сведения о создании внешних ASE см. в статье [Создание среды службы приложений][MakeExternalASE] .

В ILB ASE суффикс домена, используемый для создания приложения, — это *.&lt;asename&gt;. appserviceenvironment.NET*. Если ASE имеет имя _ilB-ASE_ и вы размещаете приложение _contoso_ в этом ASE, его можно получить по следующим URL-адресам:

- contoso.ilb-ase.appserviceenvironment.net
- contoso.scm.ilb-ase.appserviceenvironment.net

Дополнительные сведения о создании ASE ILB см. в статье [Создание и использование ilB ASE][MakeILBASE]. 

URL-адрес SCM используется для доступа к консоли KUDU или для публикации приложения с помощью веб-развертывания. Сведения о консоли KUDU см. в статье [консоль KUDU для службы приложений Azure][Kudu]. Консоль Kudu предоставляет веб-интерфейс для отладки, передачи и редактирования файлов, а также многих других возможностей.

## <a name="publishing"></a>публикация ##

По аналогии с мультитенантной службой приложений в среде ASE для публикации можно использовать следующие средства:

- веб-развертывания;
- FTP;
- непрерывная интеграция;
- функция перетаскивания в консоли Kudu;
- интегрированная среда разработки (IDE), например Visual Studio, Eclipse или IntelliJ IDEA.

Во внешней среде ASE все эти параметры публикации ведут себя одинаково. Дополнительные сведения см. [в разделе Развертывание в службе приложений Azure][AppDeploy]. 

Публикация с помощью среды ASE с ILB существенно отличается. При использовании этой среды все конечные точки публикации доступны только через внутреннюю подсистему балансировки нагрузки (ILB). Внутренняя подсистема балансировки нагрузки расположена на частном IP-адресе в подсети ASE в виртуальной сети. Без сетевого доступа к внутренней подсистеме балансировки нагрузки в среде ASE не удастся опубликовать ни одного приложения. Как отмечалось при [создании и использовании ilB ASE][MakeILBASE], необходимо настроить DNS для приложений в системе. В эти настройки входит конечная точка SCM. Если они не определены должным образом, вы не сможете их опубликовать. В интегрированных средах разработки также требуется сетевой доступ к внутренней подсистеме балансировки нагрузки для публикации напрямую.

Готовые к работе системы непрерывной интеграции, такие как GitHub и Azure DevOps, не работают с ASE ILB, так как конечная точка публикации не доступна в Интернете. Вы можете включить публикацию в ILB ASE из DevOps Azure, установив собственный агент выпуска в виртуальной сети, содержащей ILB ASE. Кроме того, можно использовать систему CI, которая использует модель извлечения, например Dropbox.

Для конечных точек публикации приложений в среде ASE с ILB используется домен, созданный вместе со средой. Это можно увидеть в профиле публикации приложения и в колонке приложения на портале (в разделе **Обзор** > **Основное** и в разделе **Свойства**). 

## <a name="storage"></a>Память

У ASE есть 1 ТБ хранилища для всех приложений в ASE. План службы приложений для изолированного SKU по умолчанию имеет ограничение в 250 ГБ. Если у вас есть пять планов службы приложений, необходимо соблюдать осторожность, не превышающих ограничение в 1 ТБ ASE. Если вам требуется свыше 250 ГБ в одном плане службы приложений, обратитесь в службу поддержки, чтобы настроить ограничение для плана службы приложений на максимум 1 ТБ. Если пределы плана скорректированы, по всем планам службы приложений в ASE остается ограничение в 1 ТБ. 

## <a name="logging"></a>Logging ##

Вы можете интегрировать ASE с Azure Monitor для отправки журналов о ASE в хранилище, концентраторе событий или Log Analytics. В настоящее время регистрируются следующие элементы:

| Ситуация | Message |
|---------|----------|
| ASE неработоспособен | Указанный ASE является неработоспособным из-за недопустимой конфигурации виртуальной сети. Если неработоспособное состояние продолжает работать, ASE будет приостановлен. Убедитесь, что выполнены указанные здесь рекомендации: https://docs.microsoft.com/azure/app-service/environment/network-info |
| В подсети ASE почти недостаточно свободного пространства | Указанный ASE находится в подсети, в которой почти не хватает свободного пространства. Есть {0} оставшиеся адреса. Когда эти адреса будут исчерпаны, ASE не сможет масштабироваться.  |
| ASE приближается к общему ограничению экземпляров | Указанный ASE приближается к общему ограничению экземпляра ASE. В настоящее время он содержит {0} экземпляры плана службы приложений максимум 201 экземпляров. |
| ASE не удалось связаться с зависимостью | Указанный ASE не может достичь {0}.  Убедитесь, что выполнены указанные здесь рекомендации: https://docs.microsoft.com/azure/app-service/environment/network-info |
| ASE приостановлен | Указанный ASE приостановлен. Приостановка ASE может быть вызвана тем, что учетная запись шортфалл или недопустимая конфигурация виртуальной сети. Устраните основную причину и возобновите ASE, чтобы продолжить обслуживание трафика. |
| Начато обновление ASE | Начато обновление платформы до указанного ASE. Ожидание задержек в операциях масштабирования |
| Обновление ASE завершено | Обновление платформы до указанного ASE завершено |
| Операции масштабирования запущены | Начато масштабирование плана службы приложений ({0}). Требуемое состояние: {1} I{2} рабочих ролей 
| Операции масштабирования завершены | Масштабирование плана службы приложений ({0}) завершено. Текущее состояние: {1} I{2} рабочих ролей |
| Сбой операций масштабирования | Не удалось масштабировать план службы приложений ({0}). Текущее состояние: {1} I{2} рабочих ролей |

Чтобы включить ведение журнала в ASE, выполните следующие действия. 

1. Перейдите к параметрам диагностики на портале.  
1. Выберите Добавить параметр диагностики.
1. Укажите имя для интеграции журналов.
1. Проверьте и настройте нужные назначения журналов. 
1. Проверка Аппсервицеенвиронментплатформлогс

![Параметры журнала диагностики ASE][4]

При интеграции с Log Analytics можно просмотреть журналы, выбрав журналы на портале ASE и создав запрос к Аппсервицеенвиронментплатформлогс. 

## <a name="upgrade-preference"></a>Параметры обновления ##

Если у вас несколько среды ASE, может потребоваться обновить некоторые среды ASE перед другими. В объекте ASE HostingEnvironment диспетчер ресурсов можно задать значение для Упградепреференце. Параметр Упградепреференце можно настроить с помощью шаблона, ARMClient или https://resources.azure.com.  Выбор из трех значений:

* None — нет — по умолчанию. Это означает, что Azure будет обновлять ASE без определенного пакета.
* Ранний срок означает, что ваш ASE будет обновлен в первой половине обновлений службы приложений.
* Позднее-поздно означает, что ваш ASE будет обновлен во второй половине обновлений службы приложений.

При использовании https://resources.azure.comможно задать значение Упградепреференцес следующим образом:

1. Переход на resources.azure.com и вход с помощью учетной записи Azure
1. Навигация по подпискам\/\[имя подписки\]\/resourceGroups\/\[\]\/поставщиков\/Microsoft.\/ASE\/\[\]
1. Выбор команды "чтение и запись" в верхней части
1. Выберите Изменить.
1. Измените значение Упградепреференце на нужное из трех вариантов.
1. Выбор исправления

![ресурсы, отображаемые в Azure com][5]

Функция Упградепреференцес действительно имеет смысл, если у вас есть несколько среды ASE, так как "ранний" обновленный среды ASE будет обновлен до "поздней" среды ASE. Если у вас есть несколько среды ASE, вы должны установить для среды ASE разработки и тестирования значение "рано", а для рабочей среды ASE — "поздно".

## <a name="pricing"></a>Цены ##

SKU ценообразования называется **изолированным** только для использования с ASE. Все планы службы приложений, размещенные в ASE, относятся к категории SKU "изолированная цена". Тарифы в плане службы приложений категории Isolated могут отличаться в зависимости от региона. 

Помимо цены плана службы приложений существует фиксированная плата за саму среду ASE. Фиксированная ставка не меняется с учетом размера ASE и оплачивается для инфраструктуры ASE с частотой масштабирования по умолчанию для одного дополнительного интерфейса для каждого 15 экземпляров плана службы приложений.  

Если скорость масштабирования по умолчанию для одной внешней стороны для каждых 15 экземпляров плана службы приложений недостаточно быстра, можно настроить отношение, в котором добавляются внешние интерфейсы, или размер внешних интерфейсов.  При изменении соотношения или размера вы платите за внешние компоненты, которые не будут добавляться по умолчанию.  

Например, при изменении коэффициента масштабирования на 10 внешний интерфейс добавляется для каждых 10 экземпляров в планах службы приложений. Фиксированная плата охватывает коэффициент масштабирования одного внешнего интерфейса для каждых 15 экземпляров. С коэффициентом масштабирования, равного 10, плата взимается за третий интерфейс, который добавляется для 10 экземпляров плана службы приложений. Но когда число дойдет до 15 экземпляров, вам не нужно будет ничего доплачивать, так как интерфейс был бы добавлен автоматически.

Если вы настроили размер внешних интерфейсов на два ядра, но не измените соотношение, то платите за дополнительные ядра.  ASE создается с двумя внешними интерфейсами, поэтому даже под пороговым значением автоматического масштабирования вы платите за два дополнительных ядра, если увеличили размер до двух основных внешних интерфейсов.

Дополнительные сведения см. в статье [цены на службу приложений Azure][Pricing].

## <a name="delete-an-ase"></a>Удаление ASE ##

Чтобы удалить ASE, сделайте следующее: 

1. Воспользуйтесь функцией **удаления** в верхней части колонки **Среда службы приложений**. 

1. Введите имя среды ASE, чтобы подтвердить ее удаление. При удалении среды ASE также удаляются все ее содержимое. 

    ![Удаление ASE][3]

<!--Image references-->
[1]: ./media/using_an_app_service_environment/usingase-appcreate.png
[2]: ./media/using_an_app_service_environment/usingase-pricingtiers.png
[3]: ./media/using_an_app_service_environment/usingase-delete.png
[4]: ./media/using_an_app_service_environment/usingase-logsetup.png
[4]: ./media/using_an_app_service_environment/usingase-logs.png
[5]: ./media/using_an_app_service_environment/usingase-upgradepref.png


<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/security-overview.md
[ConfigureASEv1]: app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: app-service-app-service-environment-intro.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: https://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/management/overview.md
[ConfigureSSL]: ../configure-ssl-certificate.md
[Kudu]: https://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../deploy-local-git.md
[ASEWAF]: app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
