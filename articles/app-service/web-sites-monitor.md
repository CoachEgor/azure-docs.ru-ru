---
title: Мониторинг приложений
description: Узнайте, как выполнять мониторинг приложений в службе приложений Azure с помощью портала Azure. Понять квоты и метрики, которые сообщаются.
author: btardif
ms.assetid: d273da4e-07de-48e0-b99d-4020d84a425e
ms.topic: article
ms.date: 01/11/2019
ms.author: byvinyal
ms.custom: seodec18
ms.openlocfilehash: d84340730391abd7dba4d13202503d37941c09b5
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79500432"
---
# <a name="monitor-apps-in-azure-app-service"></a>Мониторинг приложений в службе приложений Azure
[Служба приложений Azure](https://go.microsoft.com/fwlink/?LinkId=529714) предоставляет встроенную функциональность мониторинга для веб-приложений, мобильных и API-приложений на [портале Azure.](https://portal.azure.com)

На портале Azure можно просматривать *квоты* и *метрики* для плана приложения и службы приложений, а также настраивать *метрики, основанные* на правилах *автоматического масштабирования.*

## <a name="understand-quotas"></a>Общие сведения о квотах

На приложения, размещенные в службе приложений, распространяются определенные ограничения на использование ресурсов. Эти ограничения определены в рамках плана службы приложений, связанного с приложением.

[!INCLUDE [app-service-dev-test-note](../../includes/app-service-dev-test-note.md)]

Если приложение используется в режиме плана *Бесплатный* или *Общий*, ограничения на использование ресурсов выражены в виде квот.

Если приложение используется в режиме плана *Базовый*, *Стандартный* или *Премиум*, ограничения выражаются в виде *размера* выделенных ресурсов ("Малый", "Средний" или "Большой") и *числа экземпляров* (1, 2, 3 и т. д.) плана службы приложений.

Для приложений, работающих в режиме плана "Бесплатный" или "Общий", предоставляются следующие квоты.

| Quota | Описание |
| --- | --- |
| **ЦП (короткое)** | Объем ресурсов ЦП, который может потребить приложение в течение 5 минут. Эта квота повторно назначается каждые 5 минут. |
| **ЦП (день)** | Общий объем ресурсов ЦП, который может потребить приложение в течение одного дня. Эта квота повторно назначается каждые 24 часа в полночь (в формате UTC); |
| **Память** | Общий объем ресурсов ЦП, который может потребить приложение. |
| **Пропускной способности** | Общий объем исходящей пропускной способности, который может использовать приложение в течение одного дня. Эта квота повторно назначается каждые 24 часа в полночь (в формате UTC); |
| **Файловая система** | Общий объем доступного пространства для хранения. |

Единственная квота, применимая к приложениям, размещенным в *Basic,* *Standard*и *Premium,* это Filesystem.

Дополнительные сведения об определенных квотах, ограничениях и функциях, доступных для разных номеров SKU службы приложений, см. в статье [Подписка Azure, границы, квоты и ограничения службы](../azure-resource-manager/management/azure-subscription-service-limits.md#app-service-limits).

### <a name="quota-enforcement"></a>Принудительное применение квот

Если квоты на использование ЦП (*короткое* и *день*), а также квота на *пропускную способность* будут превышены, работа приложения будет остановлена до сброса квоты. В течение этого времени все входящие запросы завершаются с ошибкой HTTP 403.

![Сообщение об ошибке "ошибка 403"][http403]

При превышении квоты на память приложение перезапускается.

При превышении квоты на файловую систему все операции записи завершаются сбоем. Записи в журналы также завершаются сбоем.

Квоты на использование можно увеличить или удалить из приложения путем изменения плана службы приложений.

## <a name="understand-metrics"></a>Общие сведения о метриках

> [!NOTE]
> **Использование файловой системы** является новой метрикой, развернутой по всему миру, никаких данных не ожидается, если вы не попали в белый список для частного предварительного просмотра.
> 

> [!IMPORTANT]
> **Среднее время отклика** будет униточено, чтобы избежать путаницы с метрическими агрегациями. Используйте **время отклика** в качестве замены.

Метрики предоставляют сведения о приложении или поведении плана службы приложений.

Для приложения доступны приведенные далее метрики.

| Метрика | Описание |
| --- | --- |
| **Время отклика** | Время, заработаваеное для приложения для обслуживания запросов, в считанные секунды. |
| **Среднее время отклика (унипражено)** | Среднее время, заработаваеное приложением для обслуживания запросов, в считанные секунды. |
| **средний размер рабочего набора памяти;** | Средний объем памяти в мегабайтах (МБ), используемый приложением |
| **Подключения** | Число связанных сокетов, существующих в песочнице (w3wp.exe и его дочерние процессы).  Связанный сокет создается путем вызова API bind() или connect() и остается до тех пор, пока не будет закрыт посредством методов CloseHandle() или closesocket(). |
| **Время ЦП:** | Количество времени ЦП (в секундах), используемого приложением Для получения дополнительной информации об этой метрике, [см.](#cpu-time-vs-cpu-percentage) |
| **Текущее число сборок** | Текущее количество сборок, загруженных по всем доменам приложений в этом приложении. |
| **Данные в** | Объем входящей пропускной способности, используемый приложением (в МиБ/с) |
| **Выходные данные** | Объем исходящей пропускной способности, используемый приложением (в МиБ/с) |
| **Использование файловой системы** | Процент квоты файловой системы, потребленной приложением. |
| **Сборок мусора поколения 0** | Количество удалений объектов поколения 0 сборкой мусора с момента запуска процесса приложения. Сборки мусора более высокого поколения включают все предыдущие поколения.|
| **Сборок мусора поколения 1** | Количество удалений объектов поколения 1 сборкой мусора с момента запуска процесса приложения. Сборки мусора более высокого поколения включают все предыдущие поколения.|
| **Сборок мусора поколения 2** | Количество удалений объектов поколения 2 сборкой мусора с момента запуска процесса приложения.|
| **Счетчик дескрипторов** | Общее количество дескрипторов, в данный момент открытых процессом приложения.|
| **HTTP 2xx** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния, большим или равным 200, но меньшим 300 |
| **HTTP 3xx:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния, большим или равным 300, но меньшим 400 |
| **HTTP 401:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния 401 |
| **HTTP 403:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния 403 |
| **HTTP 404:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния 404 |
| **HTTP 406:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния 406 |
| **HTTP 4xx:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния, большим или равным 400, но меньшим 500 |
| **Ошибки HTTP-сервера:** | Количество запросов, для которых возвращается ошибка HTTP с кодом состояния, большим или равным 500, но меньшим 600 |
| **Операции ввода-вывода: прочие, байт в секунду** | Скорость, с которой процесс приложения выдает байты на операции ввоза/ора при ввоза, не связанные с данными, например, операции управления.|
| **Операции ввода-вывода: прочих операций в секунду** | Скорость, с которой процесс приложения выдает операции ввоза/от, которые не читаются или не пишут операции.|
| **Операции ввода-вывода: чтение, байт в секунду** | Скорость, с которой процесс приложения считывает байты из операций ввода-вывода.|
| **Операции ввода-вывода: операций чтения в секунду** | Скорость, с которой процесс приложения вызывает операции ввода-вывода для чтения.|
| **Операции ввода-вывода: запись, байт в секунду** | Скорость, с которой процесс приложения записывает байты в операции ввода-вывода.|
| **Операции ввода-вывода: операций записи в секунду** | Скорость, с которой процесс приложения вызывает операции записи.|
| **рабочий набор памяти;** | Текущий объем используемой приложением памяти (в МиБ/с) |
| **Байты исключительного пользования** | Частные байты — это текущий размер памяти, который выделил процесс приложения, который не может быть передан другим процессам.|
| **Запросы** | Общее количество запросов, для которых возвращается ошибка HTTP (независимо от кода состояния) |
| **Запросов в очереди приложений** | Количество запросов в очереди запросов приложений.|
| **Число потоков** | Число активных потоков в процессе приложения.|
| **Всего доменов приложений** | Текущее количество доменов приложений, загруженных в это приложение.|
| **Всего выгруженных доменов приложений** | Общее количество доменов приложений, выгруженных с момента запуска приложения.|


Для плана службы приложений доступны следующие метрики.

> [!NOTE]
> Метрики плана службы приложений поддерживаются только для планов категорий *Базовый*, *Стандартный* и *Премиум*.
> 

| Метрика | Описание |
| --- | --- |
| **Процент использования ЦП** | средний процент использования ЦП всеми экземплярами плана; |
| **Процент использования памяти** | средний процент использование памяти всеми экземплярами плана; |
| **Данные в** | средний показатель использования входящей пропускной способности всеми экземплярами плана; |
| **Выходные данные** | средний показатель использования исходящей пропускной способности всеми экземплярами плана; |
| **Длина дисковой очереди** | среднее число запросов на чтение и запись, поставленных в очередь в хранилище. Высокая длина очереди диска является признаком приложения, которое может замедляться из-за чрезмерного ввоза диска/ O. |
| **Длина очереди HTTP:** | среднее число запросов HTTP, которые ставятся в очередь перед выполнением. Большая или увеличивающая длина очереди HTTP является признаком интенсивной нагрузки плана. |

### <a name="cpu-time-vs-cpu-percentage"></a>Время и процент использования ЦП
<!-- To do: Fix Anchor (#CPU-time-vs.-CPU-percentage) -->

Доступны две метрики, которые отражают использование ЦП.

**Время процессора**: Полезно для приложений, размещенных в свободных или общих планах, потому что одна из их квот определяется в минутах процессора, используемых приложением.

**Процент процессора**: Полезно для приложений, размещенных в основных, стандартных и премиум-планах, потому что они могут быть масштабированы. Процент процессора является хорошим показателем общего использования во всех экземплярах.

## <a name="metrics-granularity-and-retention-policy"></a>Степень детализации метрик и политика их хранения
Метрики для приложения и плана службы приложений записываются и обрабатываются в службе в соответствии со следующей степенью детализации и политиками хранения.

* **Минутные** метрики детализации хранятся в течение 30 часов.
* **Метрики** часовой детализации хранятся в течение 30 дней.
* **Дневные** метрики детализации хранятся в течение 30 дней.

## <a name="monitoring-quotas-and-metrics-in-the-azure-portal"></a>Мониторинг квот и метрик на портале Azure
Состояние квот и метрик, влияющих на приложение, можно просмотреть на [портале Azure](https://portal.azure.com).

![Диаграмма квот на портале Azure][quotas]

Чтобы найти квоты, выберите **Параметры** > **Квоты**. На диаграмме отображаются указанные далее сведения о квотах. 
1. Имя квоты.
1. Интервал повторного назначения.
1. Текущее ограничение.
1. Текущее значение.

![Метрическая диаграмма на][metrics] портале Azure Вы можете получить доступ к метрикам непосредственно со страницы **обзор** ресурса. Здесь вы увидите диаграммы, представляющие некоторые метрики приложений.

Нажатие на любой из этих диаграмм приведет вас к метрики зрения, где вы можете создать пользовательские диаграммы, запрос различных метрик и многое другое. 

Дополнительные сведения о метриках см. в статье о [данных мониторинга](../monitoring-and-diagnostics/insights-how-to-customize-monitoring.md).

## <a name="alerts-and-autoscale"></a>Оповещения и автомасштабирование
Метрики для плана приложения или службы приложений можно привязать к оповещениям. Для получения дополнительной [информации см.](../monitoring-and-diagnostics/insights-alerts-portal.md)

Приложения Службы поддержки приложений, размещенные в основных или более крупных планах App Service, поддерживают автомасштаб. Автомасштабирование позволяет настроить правила, которые отслеживают метрики плана службы приложений. Правила могут увеличивать или уменьшать число экземпляров, предоставляя дополнительные ресурсы при необходимости. Правила также помогают сократить расходы на чрезмерную подготовку приложений.

Дополнительные сведения об автомасштабировании см. в статьях [Начало работы с автомасштабированием в Azure](../monitoring-and-diagnostics/insights-how-to-scale.md) и [Рекомендации по автомасштабированию](../azure-monitor/platform/autoscale-best-practices.md).

[fzilla]:https://go.microsoft.com/fwlink/?LinkId=247914
[vmsizes]:https://go.microsoft.com/fwlink/?LinkID=309169

<!-- Images. -->
[http403]: ./media/web-sites-monitor/http403.png
[quotas]: ./media/web-sites-monitor/quotas.png
[metrics]: ./media/web-sites-monitor/metrics.png