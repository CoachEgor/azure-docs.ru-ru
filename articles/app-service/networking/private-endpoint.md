---
title: Подключайтесь к веб-приложению Azure с помощью частной конечной точки
description: Частное подключение к веб-приложению с помощью частной конечной точки Azure
author: ericgre
ms.assetid: 2dceac28-1ba6-4904-a15d-9e91d5ee162c
ms.topic: article
ms.date: 07/07/2020
ms.author: ericg
ms.service: app-service
ms.workload: web
ms.custom: fasttrack-edit, references_regions
ms.openlocfilehash: fdad2f7c2ce4f82529866b4235ebebab8da664d3
ms.sourcegitcommit: bcb962e74ee5302d0b9242b1ee006f769a94cfb8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/07/2020
ms.locfileid: "86054582"
---
# <a name="using-private-endpoints-for-azure-web-app-preview"></a>Использование частных конечных точек для веб-приложения Azure (предварительная версия)

> [!Note]
> После обновления предварительной версии мы выпустили функцию защиты от утечки данных.
>
> Предварительная версия доступна во всех общедоступных регионах для веб-приложений Windows и Linux PremiumV2 и приложений-функций эластичной базы данных (цен. категория "Премиум"). 

Вы можете использовать закрытую конечную точку для веб-приложения Azure, чтобы разрешить клиентам, находящимся в частной сети, безопасный доступ к приложению по приватному каналу. Частная конечная точка использует IP-адрес из адресного пространства Azure VNet. Сетевой трафик между клиентом и вашей частной сетью проходит через VNet и приватный канал в магистральной сети Майкрософт, что позволяет избежать рисков общедоступного Интернета.

Использование частной конечной точки для веб-приложения позволяет делать следующее.

- Защитить веб-приложение, настроив частную конечную точку, исключив публичное раскрытие.
- Безопасное подключаться к общим папкам Azure из офисных сетей, которые подключаются к VNet через VPN или ExpressRoute с частным пирингом.
- Избежать утечки данных из VNet. 

Если вам просто требуется безопасное подключение между сетью VNet и веб-приложением, конечная точка службы — самое простое решение. Если вам также нужно подключиться к веб-приложению из локальной среды через шлюз Azure, виртуальную сеть с региональным пирингом или глобальную одноранговую виртуальную сеть, это решение является закрытой конечной точкой.  

Дополнительные сведения см. в статье [Конечные точки][serviceendpoint].

## <a name="conceptual-overview"></a>Общие сведения

Частная конечная точка — это специальный сетевой интерфейс (NIC) для веб-приложения Azure в подсети в вашей виртуальной сети (VNet).
При создании частной конечной точки для веб-приложения обеспечивается безопасное подключение между клиентами в частной сети и веб-приложением. Частной конечной точке назначается IP-адрес из диапазона IP-адресов виртуальной сети.
Соединение между частной конечной точкой и веб-приложением использует защищенный [приватный канал][privatelink]. Частная конечная точка используется только для входящих потоков веб-приложения. Исходящие потоки не будут использовать эту частную конечную точку, но вы можете ввести исходящие потоки в сеть в другой подсети с помощью [функции интеграции VNet][vnetintegrationfeature].

Подсеть, в которой вы подключаетесь к частной конечной точке, может содержать другие ресурсы, не нужна выделенная пустая подсеть.
Вы также можете развернуть частную конечную точку в регионе, отличном от региона веб-приложения. 

> [!Note]
>Функция интеграции с виртуальной сетью не может использовать ту же подсеть, что и частная конечная точка. это ограничение компонента интеграции с виртуальной сетью.

С точки зрения безопасности

- При включении частных конечных точек для доступа к приложению вы отключаете любой публичный доступ к нему.
- В других виртуальных сетях и подсетях можно включить несколько частных конечных точек, в том числе в виртуальных сетях в других регионах.
- IP-адрес NIC частной конечной точки должен быть динамическим, но останется прежним, пока не будет удалена частная конечная точка.
- Сетевой карте частной конечной точки не может быть назначен NSG.
- Подсеть, в которой размещена частная конечная точка, может иметь NSG, но необходимо отключить применение политик сети для частной конечной точки. См. раздел [отключение сетевых политик для частных конечных точек][disablesecuritype]. В результате вы не можете фильтровать доступ к вашей частной конечной точке по NSG.
- При включении частной конечной точки для веб-приложения не оценивается конфигурация [ограничения доступа ][accessrestrictions] к веб-приложению.
- Вы можете исключить риск утечки данных из виртуальной сети, удалив все правила NSG, в которых назначение — это Интернет или службы Azure. При развертывании частной конечной точки для веб-приложения доступ к этому конкретному веб-приложению можно получить только через частную конечную точку. Если у вас есть другое веб-приложение, необходимо развернуть другую выделенную частную конечную точку для этого другого веб-приложения.

В журналах веб-протокола HTTP вашего приложения вы увидите исходный IP-адрес клиента. Эта функция реализуется с помощью протокола TCP-прокси и пересылает свойство IP-адреса клиента в веб-приложение. Дополнительные сведения см. в разделе [Получение сведений о подключении с помощью TCP Proxy v2][tcpproxy].


  > [!div class="mx-imgBorder"]
  > ![Глобальный обзор частной конечной точки веб-приложения](media/private-endpoint/global-schema-web-app.png)

## <a name="dns"></a>DNS

При использовании закрытой конечной точки для веб-приложения запрошенный URL-адрес должен совпадать с именем вашего веб-приложения. По умолчанию mywebappname.azurewebsites.net.

По умолчанию без частной конечной точки общедоступное имя веб-приложения является каноническим именем кластера.
Например, разрешение имен будет следующим:

|Имя |Type |Значение |
|-----|-----|------|
|mywebapp.azurewebsites.net|CNAME|clustername.azurewebsites.windows.net|
|clustername.azurewebsites.windows.net|CNAME|cloudservicename.cloudapp.net|
|cloudservicename.cloudapp.net|Объект|40.122.110.154| 


При развертывании частной конечной точки мы обновляем запись DNS, чтобы она указывала на каноническое имя mywebapp.privatelink.azurewebsites.net.
Например, разрешение имен будет следующим:

|Имя |Type |Значение |Комментарий |
|-----|-----|------|-------|
|mywebapp.azurewebsites.net|CNAME|mywebapp.privatelink.azurewebsites.net|
|mywebapp.privatelink.azurewebsites.net|CNAME|clustername.azurewebsites.windows.net|
|clustername.azurewebsites.windows.net|CNAME|cloudservicename.cloudapp.net|
|cloudservicename.cloudapp.net|Объект|40.122.110.154|< — этот общедоступный IP-адрес не является частной конечной точкой, вы получите ошибку 403.|

Необходимо настроить частный DNS-сервер или Azure DNS частную зону. для тестов можно изменить запись узла тестового компьютера.
Необходимо создать зону DNS: **privatelink.azurewebsites.NET**. Зарегистрируйте запись для веб-приложения, используя запись A и IP-адрес частной конечной точки.
Например, разрешение имен будет следующим:

|Имя |Type |Значение |Комментарий |
|-----|-----|------|-------|
|mywebapp.azurewebsites.net|CNAME|mywebapp.privatelink.azurewebsites.net|
|mywebapp.privatelink.azurewebsites.net|Объект|10.10.10.8|<--вы управляете этой записью в системе DNS, чтобы указать IP-адрес частной конечной точки.|

После этой конфигурации DNS можно получить доступ к веб-приложению в частном порядке с именем по умолчанию mywebappname.azurewebsites.net.


Если необходимо использовать настраиваемое DNS-имя, необходимо добавить пользовательское имя в веб-приложение. Во время предварительной версии пользовательское имя должно проверяться как любое пользовательское имя, используя разрешение общедоступного DNS. Дополнительные сведения см. в разделе [валидация пользовательского DNS][dnsvalidation].

Для консоли KUDU или KUDU REST API (например, развертывание с помощью собственных агентов Azure DevOps) необходимо создать две записи в Azure DNS частной зоне или пользовательском DNS-сервере. 

| Имя | Type | Значение |
|-----|-----|-----|
| mywebapp.privatelink.azurewebsites.net | Объект | приватиндпоинтип | 
| mywebapp.scm.privatelink.azurewebsites.net | Объект | приватиндпоинтип | 



## <a name="pricing"></a>Цены

Дополнительные сведения о ценах см. на [странице цен на службу "Приватный канал" Azure][pricing].

## <a name="limitations"></a>Ограничения

При использовании функции Azure в плане приложений-функций эластичной базы данных (цен. категория "Премиум") с частной конечной точкой для запуска или выполнения функции на веб-портале Azure необходимо иметь прямой доступ к сети, иначе возникнет ошибка HTTP 403. Иными словами, браузер должен иметь доступ к закрытой конечной точке для выполнения функции с веб-портала Azure. 

Во время предварительной версии для частной конечной точки предоставляется только рабочий слот, другие слоты должны быть достижимы из общедоступной конечной точки.

Мы регулярно улучшаем функцию приватного канала и частной конечной точки. Дополнительные сведения об ограничениях см. в [этой статье][pllimitations].

## <a name="next-steps"></a>Дальнейшие действия

- Сведения о развертывании частной конечной точки для веб-приложения с помощью портала см. в статье [как подключиться к веб-приложению с помощью портала][howtoguide1] .
- Сведения о развертывании закрытой конечной точки для веб-приложения с помощью Azure CLI см. в статье [как подключиться к веб-приложению с Azure CLI][howtoguide2]
- Сведения о развертывании закрытой конечной точки для веб-приложения с помощью PowerShell см. в статье [как подключиться к веб-][howtoguide3] приложению через PowerShell.



<!--Links-->
[serviceendpoint]: https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview
[privatelink]: https://docs.microsoft.com/azure/private-link/private-link-overview
[vnetintegrationfeature]: https://docs.microsoft.com/azure/app-service/web-sites-integrate-with-vnet
[disablesecuritype]: https://docs.microsoft.com/azure/private-link/disable-private-endpoint-network-policy
[accessrestrictions]: https://docs.microsoft.com/azure/app-service/app-service-ip-restrictions
[tcpproxy]: ../../private-link/private-link-service-overview.md#getting-connection-information-using-tcp-proxy-v2
[dnsvalidation]: https://docs.microsoft.com/azure/app-service/app-service-web-tutorial-custom-domain
[pllimitations]: https://docs.microsoft.com/azure/private-link/private-endpoint-overview#limitations
[pricing]: https://azure.microsoft.com/pricing/details/private-link/
[howtoguide1]: https://docs.microsoft.com/azure/private-link/create-private-endpoint-webapp-portal
[howtoguide2]: https://docs.microsoft.com/azure/app-service/scripts/cli-deploy-privateendpoint
[howtoguide3]: https://docs.microsoft.com/azure/app-service/scripts/powershell-deploy-private-endpoint
