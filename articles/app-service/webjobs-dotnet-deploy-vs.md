---
title: Разработка и развертывание веб-заданий с помощью Visual Studio в Azure
description: Сведения о разработке и развертывании веб-заданий Azure в службе приложений Azure с помощью Visual Studio.
services: app-service
documentationcenter: ''
author: ggailey777
manager: jeconnoc
ms.assetid: a3a9d320-1201-4ac8-9398-b4c9535ba755
ms.service: app-service
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.custom: vs-azure
ms.workload: azure-vs
ms.date: 02/18/2019
ms.author: glenga;david.ebbo;suwatch;pbatum;naren.soni
ms.openlocfilehash: 4d375b559019529bdc170ce6bab535481e0569e0
ms.sourcegitcommit: 4c2b9bc9cc704652cc77f33a870c4ec2d0579451
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/17/2019
ms.locfileid: "65873006"
---
# <a name="develop-and-deploy-webjobs-using-visual-studio---azure-app-service"></a>Разработка и развертывание веб-заданий в службе приложений Azure с помощью Visual Studio

В этой статье объясняется, как использовать Visual Studio для развертывания проекта консольного приложения в веб-приложение в [службы приложений](overview.md) как [веб-задания Azure](https://go.microsoft.com/fwlink/?LinkId=390226). Дополнительные сведения о развертывании веб-заданий с использованием [портала Azure](https://portal.azure.com) см. в руководстве по [выполнению фоновых задач с помощью веб-заданий](webjobs-create.md).

Вы можете опубликовать несколько веб-заданий для одного веб-приложения. Убедитесь, что каждый веб-задание в веб-приложение имеет уникальное имя.

Версии 3.x [Azure WebJobs SDK](webjobs-sdk-how-to.md) позволяет разрабатывать веб-заданий, запуск от имени приложений .NET Core, а версии 2.x поддерживает только .NET Framework. Способ развертывания проекта веб-заданий является разных проектов .NET Core и .NET Framework из них.

## <a name="webjobs-as-net-core-console-apps"></a>Веб-задания в качестве консольных приложений .NET Core

При использовании версии 3.x веб-заданий, можно создавать и публиковать веб-задания в качестве консольных приложений .NET Core. Пошаговые инструкции для создания и публикации консольное приложение .NET Core в Azure как веб-задания см. в разделе [приступить к работе с пакетом SDK для веб-заданий Azure для управляемых событиями фоновой обработки](webjobs-sdk-get-started.md).

> [!NOTE]
> Веб-заданий для .NET core не может быть связан с веб-проектов. Если необходимо выполнить развертывание веб-задания с помощью веб-приложения, следует выполнить [Создание веб-задания консольного приложения .NET Framework](#webjobs-as-net-framework-console-apps).  

### <a name="deploy-to-azure-app-service"></a>Развертывание в службе приложений Azure

Публикация веб-задания .NET Core в службе приложений из Visual Studio использует инструментарий же в качестве публикации приложения ASP.NET Core.

[!INCLUDE [webjobs-publish-net-core](../../includes/webjobs-publish-net-core.md)] 

### <a name="webjob-types"></a>Типы веб-заданий

По умолчанию веб-задания, опубликованных в среду .NET Core, консольный проект выполняется только при активации или по требованию. Вы также можете обновить проект, чтобы [запускаться по расписанию](#scheduled-execution) или постоянно.

[!INCLUDE [webjobs-alwayson-note](../../includes/webjobs-always-on-note.md)]

#### <a name="scheduled-execution"></a>Запланированных выполнений по требованию

При публикации консольное приложение .NET Core в Azure, новый *settings.job* файл добавляется в проект. Используйте этот файл, чтобы задать расписание выполнения для веб-задания. Дополнительные сведения см. в разделе [планирование активации веб-задания](#scheduling-a-triggered-webjob).

#### <a name="continuous-execution"></a>Непрерывного выполнения

Visual Studio можно использовать для изменения веб-задания для запуска постоянно в том случае, если Always On включена в Azure.

1. Если вы еще не сделали, [Публикация проекта в Azure](#deploy-to-azure-app-service).

1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите пункт **Опубликовать**.

1. В **публикации** вкладке, выберите **параметры**. 

1. В **параметры профиля** диалоговом окне выберите **Continuous** для **тип веб-задания**и выберите **Сохранить**.

    ![Диалоговое окно параметров публикации для веб-задания](./media/webjobs-dotnet-deploy-vs/publish-settings.png)

1. Выберите **публикации** для повторной публикации веб-задания с обновленными параметрами.

## <a name="webjobs-as-net-framework-console-apps"></a>Веб-заданий, как консольные приложения .NET Framework  

Когда Visual Studio развертывает проект консольного приложения с поддержкой веб-заданий для .NET Framework, он выполняет две задачи:

* Копирование файлов среды выполнения в соответствующую папку, в веб-приложения (*App_Data/заданий/continuous* для непрерывных веб-заданий и *App_Data/заданий/triggered* для запланированного или по требованию веб-заданий).
* Указание заданий [планировщика Azure](https://docs.microsoft.com/azure/scheduler/) для веб-заданий, которые запланированы на выполнение в определенное время. (Это не требуется для постоянных веб-заданий.)

Проект с поддержкой веб-заданий содержит следующие добавленные элементы.

* Пакет NuGet [Microsoft.Web.WebJobs.Publish](https://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) .
* Файл [webjob-publish-settings.json](#publishsettings) , который содержит параметры развертывания и планировщика. 

![Диаграмма, отображающая добавленные элементы в приложение консоли для реализации развертывания как веб-задания](./media/webjobs-dotnet-deploy-vs/convert.png)

Вы можете добавить эти элементы в существующий проект приложения консоли или использовать шаблон для создания нового проекта приложения консоли с поддержкой веб-заданий. 

Можно развернуть проект как веб-задание или связать его с веб-проектом для автоматического развертывания при каждом развертывании веб-проекта. Чтобы связать проекты, Visual Studio включает имя проекта с поддержкой веб-заданий в файле [webjobs-list.json](#webjobslist) веб-проекта.

![Диаграмма, отображающая проект веб-задания, связанный с веб-проектом](./media/webjobs-dotnet-deploy-vs/link.png)

### <a name="prerequisites"></a>Технические условия

Если вы используете Visual Studio 2015, установите [пакет Azure SDK для .NET (Visual Studio 2015)](https://azure.microsoft.com/downloads/).

Если вы используете Visual Studio 2019 г., установите [рабочую нагрузку разработки Azure](https://docs.microsoft.com/visualstudio/install/install-visual-studio#step-4---select-workloads).

### <a id="convert"></a> Включение развертывания веб-заданий для существующего проекта консольного приложения

Существует два варианта.

* [Включение автоматического развертывания с веб-проектом](#convertlink).

  Настройка существующего проекта приложения консоли для автоматического развертывания в качестве веб-приложения при развертывании веб-проекта. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

* [Включение развертывания без веб-проекта](#convertnolink).

  Настройка существующего проекта приложения консоли для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.

#### <a id="convertlink"></a> Включение автоматического развертывания веб-заданий с помощью веб-проекта

1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Добавить** > **Существующий проект как веб-задание Azure**.
   
    ![Существующий проект как веб-задание Azure](./media/webjobs-dotnet-deploy-vs/eawj.png)
   
    Откроется диалоговое окно [Добавление веб-задания Azure](#configure) .
2. В раскрывающемся списке **Имя проекта** выберите проект приложения консоли для добавления в качестве веб-задания.
   
    ![Выбор проекта в диалоговом окне "Добавление веб-задания Azure"](./media/webjobs-dotnet-deploy-vs/aaw1.png)
3. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и щелкните кнопку **ОК**. 

#### <a id="convertnolink"></a> Включение развертывания веб-заданий без веб-проекта
1. Щелкните правой кнопкой мыши проект консольного приложения в **обозревателе решений** и выберите **Опубликовать как веб-задание Azure…**. 
   
    ![Опубликовать как веб-задание Azure](./media/webjobs-dotnet-deploy-vs/paw.png)
   
    Появится диалоговое окно [Добавление веб-задания Azure](#configure) с проектом, выбранным в поле **Имя проекта** .
2. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и щелкните кнопку **ОК**.
   
   Откроется мастер **веб-публикации** .  Если вы не хотите сразу выполнить публикацию, закройте мастер. Указанные параметры сохраняются до момента [развертывания проекта](#deploy).

### <a id="create"></a>Создание нового проекта с поддержкой веб-заданий
Чтобы создать проект с поддержкой веб-заданий, можно использовать шаблон проекта приложения консоли и включить развертывание веб-заданий, как показано в [предыдущем разделе](#convert). В качестве альтернативы можно использовать шаблон создания проекта с поддержкой веб-заданий:

* [Использование шаблона создания проекта веб-заданий для отдельного веб-задания](#createnolink)
  
    Создайте проект и настройте его для развертывания в качестве веб-задания без ссылки на веб-проект. Используйте этот параметр, если нужно запустить веб-задание в веб-приложении самостоятельно, без веб-приложения, запущенного в веб-приложении. Это может понадобиться для независимого масштабирования ресурсов веб-заданий ресурсов веб-приложений.
* [Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом](#createlink)
  
    Создайте проект, настроенный для автоматического развертывания, как веб-задание при развертывании веб-проекта в том же решении. Используйте этот параметр, если нужно запустить веб-задание в том же веб-приложении, в котором запущено связанное веб-приложение.

> [!NOTE]
> Шаблон нового проекта веб-задания автоматически устанавливает пакеты NuGet и включает в файл *Program.cs* код для [пакета SDK веб-заданий](https://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/getting-started-with-windows-azure-webjobs). Если вы не хотите использовать пакет SDK для веб-заданий, удалите или измените инструкцию `host.RunAndBlock` в файле *Program.cs*.
> 
> 

#### <a id="createnolink"></a> Использование шаблона создания проекта веб-заданий для отдельного веб-задания
1. Щелкните **Файл** > **Создать проект**, а затем в диалоговом окне **Новый проект** выберите **Облако** > **Веб-задание Azure (.NET Framework)**.
   
    ![Диалоговое окно "Новый проект", отображающее шаблон веб-заданий](./media/webjobs-dotnet-deploy-vs/np.png)
2. Следуйте инструкциям, показанным ранее, чтобы [сделать проект приложения консоли независимым проектом веб-заданий](#convertnolink).

#### <a id="createlink"></a> Использование шаблона создания проекта с поддержкой веб-заданий для веб-задания, связанного с веб-проектом
1. Щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Добавить** > **Новый проект веб-задания Azure**.
   
    ![Запись меню "Новый проект веб-задания Azure"](./media/webjobs-dotnet-deploy-vs/nawj.png)
   
    Откроется диалоговое окно [Добавление веб-задания Azure](#configure) .
2. Заполните диалоговое окно [Добавление веб-задания Azure](#configure) и щелкните кнопку **ОК**.

### <a id="configure"></a>Диалоговое окно "Добавление веб-заданий Azure"
В диалогом окне **Добавить веб-задание Azure** можно указать имя веб-задания и настроить режим его выполнения. 

![Диалоговое окно "Добавление веб-заданий Azure"](./media/webjobs-dotnet-deploy-vs/aaw2.png)

Поля в этом диалоговом окне соответствуют полям в диалоговом окне **Добавление веб-задания** на портале Azure. Дополнительные сведения см. в разделе [Выполнение фоновых задач с помощью веб-заданий](webjobs-create.md).

> [!NOTE]
> * Дополнительные сведения о развертывании из командной строки см. в разделе [Включение предоставления веб-заданий Azure из командной строки или постоянно](https://azure.microsoft.com/blog/2014/08/18/enabling-command-line-or-continuous-delivery-of-azure-webjobs/).
> * Если после развертывания веб-задания принимается решение об изменении типа веб-задания и его повторного развертывания, нужно удалить файл *webjobs-publish-settings.json*. При этом Visual Studio снова покажет параметры публикации и можно будет изменить тип веб-задания.
> * Если вы развертываете веб-задание, а затем изменяете режим выполнения с постоянного на непостоянный или наоборот, Visual Studio создаст новое веб-задание в Azure при повторном развертывании. При изменении других параметров планирования но сохранении режима выполнения или при переключении между режимами "Запланировано" и "По запросу" Visual Studio обновляет существующее задание, а не создает новое.
> 
> 

### <a id="publishsettings"></a>webjob-publish-settings.json
При настройке консольного приложения для развертывания веб-заданий Visual Studio устанавливает пакет NuGet [Microsoft.Web.WebJobs.Publish](https://www.nuget.org/packages/Microsoft.Web.WebJobs.Publish/) и сохраняет сведения о планировании в файле *webjob-publish-settings.json* в папке *Properties* проекта веб-заданий. Вот пример этого файла:

        {
          "$schema": "http://schemastore.org/schemas/json/webjob-publish-settings.json",
          "webJobName": "WebJob1",
          "startTime": "null",
          "endTime": "null",
          "jobRecurrenceFrequency": "null",
          "interval": null,
          "runMode": "Continuous"
        }

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [https://schemastore.org](https://schemastore.org/schemas/json/webjob-publish-settings.json), и ее можно просмотреть здесь.  

### <a id="webjobslist"></a>webjobs-list.json
При связывании проекта с поддержкой веб-заданий с веб-проектом Visual Studio сохраняет имя проекта веб-заданий в файле *webjobs-list.json* в папке веб-проекта *Properties*. Список может содержать несколько проектов веб-заданий, как показано в следующем примере:

        {
          "$schema": "http://schemastore.org/schemas/json/webjobs-list.json",
          "WebJobs": [
            {
              "filePath": "../ConsoleApplication1/ConsoleApplication1.csproj"
            },
            {
              "filePath": "../WebJob1/WebJob1.csproj"
            }
          ]
        }

Вы можете изменить этот файл напрямую, и Visual Studio предоставит IntelliSense. Схема файла сохранена на сайте [https://schemastore.org](https://schemastore.org/schemas/json/webjobs-list.json), и ее можно просмотреть здесь.

### <a id="deploy"></a>Развертывание проекта веб-заданий
Проект веб-заданий, связанный с веб-проектом, развертывается автоматически с веб-проектом. Информацию о развертывании веб-проектов см. в левой области навигации **Практические руководства** > **Развертывание приложения**.

Чтобы развернуть проект веб-заданий, щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **Опубликовать как веб-задание Azure…**. 

![Опубликовать как веб-задание Azure](./media/webjobs-dotnet-deploy-vs/paw.png)

Для независимого веб-задания отобразится тот же мастер **веб-публикации** , который использовался для веб-проектов, но некоторые параметры будут недоступны для изменения.

## <a name="scheduling-a-triggered-webjob"></a>Планирование активации веб-задания

Веб-заданий использует *settings.job* файл, чтобы определить, когда выполняется веб-задания. Используйте этот файл, чтобы задать расписание выполнения для веб-задания. В следующем примере выполняется каждый час с 9: 00 до 17:

```json
{
    "schedule": "0 0 9-17 * * *"
}
```

Этот файл должен находиться в корневой папке веб-заданий, вдоль стороны сценария веб-задания, такие как `wwwroot\app_data\jobs\triggered\{job name}` или `wwwroot\app_data\jobs\continuous\{job name}`. При развертывании веб-задания из Visual Studio для свойств файла `settings.job` установите значение **Копировать, если новее**. 

Когда вы [Создание веб-задания на портале Azure](webjobs-create.md), создается файл settings.job.

[!INCLUDE [webjobs-alwayson-note](../../includes/webjobs-always-on-note.md)]

### <a name="cron-expressions"></a>Выражения CRON

Веб-заданий использует те же выражения CRON для планирования как триггер с таймером в функциях Azure. Дополнительные сведения о поддержке CRON, см. в разделе [справочнике по триггерам таймера](../azure-functions/functions-bindings-timer.md#cron-expressions).

### <a name="settingjob-reference"></a>Справочник по Setting.job

Веб-заданий, поддерживаются следующие параметры:

| **Параметр** | **Тип**  | **Описание** |
| ----------- | --------- | --------------- |
| `is_in_place` | Все | Позволяет задание для запуска на месте без сначала копируются во временную папку. Дополнительные сведения см. в разделе [рабочий каталог веб-заданий](https://github.com/projectkudu/kudu/wiki/WebJobs#webjob-working-directory). |
| `is_singleton` | Непрерывный | Веб-заданий можно запустите, только на одном экземпляре при масштабировании. Дополнительные сведения см. в разделе [непрерывной задание как одноэлементные](https://github.com/projectkudu/kudu/wiki/WebJobs-API#set-a-continuous-job-as-singleton). |
| `schedule` | Активируемые | Запуск веб-задания по расписанию на основе CRON. Дополнительные сведения см. в разделе [справочнике по триггерам таймера](../azure-functions/functions-bindings-timer.md#cron-expressions). |
| `stopping_wait_time`| Все | Позволяет контролировать поведение завершения работы. Дополнительные сведения см. в разделе [нормальное завершение работы](https://github.com/projectkudu/kudu/wiki/WebJobs#graceful-shutdown). |

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Подробнее о пакете SDK веб-заданий](webjobs-sdk-how-to.md)
