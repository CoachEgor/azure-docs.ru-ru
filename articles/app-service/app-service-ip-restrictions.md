---
title: Ограничения доступа к службе приложений Azure
description: Узнайте, как обезопасить приложение в службе приложений Azure, указав ограничения доступа.
author: ccompy
ms.assetid: 3be1f4bd-8a81-4565-8a56-528c037b24bd
ms.topic: article
ms.date: 06/06/2019
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: a02c099871ce9748f4c5f604900a7c4d57bb96b6
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79473529"
---
# <a name="azure-app-service-access-restrictions"></a>Ограничения доступа к службам приложений Azure #

Ограничения доступа позволяют определить список предписанных разрешений/отрицаний, который контролирует доступ к приложению. Список может включать IP-адреса или подсети виртуальной сети Azure. Когда есть одна или несколько записей, есть неявное "отказаться от всех", что существует в конце списка.

Возможности ограничения доступа работают со всеми службами App, размещаемыми рабочими нагрузками, включая; веб-приложения, приложения API, приложения Linux, контейнерные приложения Linux и функции.

При запросе в ваше приложение адрес FROM оценивается по правилам IP-адреса в списке ограничений доступа. Если адрес FROM находится в подсети, настроенной с конечными точками службы для Microsoft.Web, то исходная подсеть сравнивается с правилами виртуальной сети в списке ограничений доступа. Если доступ с этого адреса запрещен правилами в списке, служба возвращает код состояния [HTTP 403](https://en.wikipedia.org/wiki/HTTP_403).

Возможность ограничения доступа реализована в фронтовых ролях Службы App, которые находятся вверх по течению узлов, где работает ваш код. Таким образом, ограничения доступа фактически являются сетевыми ACL.

Возможность ограничения доступа к веб-приложению из виртуальной сети Azure (VNet) называется [конечными точками обслуживания.][serviceendpoints] Конечные точки обслуживания позволяют ограничить доступ к мультитенантной службе из выбранных подсетей. Она должна быть включена как на сетевой стороне, так и на службе, с помощью которого она включена. Он не работает, чтобы ограничить трафик для приложений, которые размещаются в среде службы приложений. Если вы находитесь в среде службы приложений, вы можете контролировать доступ к приложению с правилами IP-адреса.

![поток ограничений доступа](media/app-service-ip-restrictions/access-restrictions-flow.png)

## <a name="adding-and-editing-access-restriction-rules-in-the-portal"></a>Добавление и редактирование правил ограничения доступа на портале ##

Чтобы добавить правило ограничения доступа в приложение, используйте меню, чтобы открыть**ограничения доступа** **к сети**>и нажмите на **Настройку ограничений доступа**

![Сетевые возможности службы приложений](media/app-service-ip-restrictions/access-restrictions.png)  

Из uI-центра ограничений доступа можно просмотреть список правил ограничения доступа, определенных для вашего приложения.

![список ограничений доступа](media/app-service-ip-restrictions/access-restrictions-browse.png)

Список будет отображать все текущие ограничения, которые есть в вашем приложении. Если в приложении есть ограничение VNet, таблица покажет, включены ли конечные точки службы для Microsoft.Web. Если в приложении нет определенных ограничений, ваше приложение будет доступно из любого места.  

## <a name="adding-ip-address-rules"></a>Добавление правил IP-адресов

Вы можете нажать на **правило «Добавить»,** чтобы добавить новое правило ограничения доступа. После добавления правило немедленно вступает в действие. Правила применяются в порядке возрастания приоритета, начиная с наименьшего числа. После добавления даже одного правила действует неявный запрет всего, что было разрешено на текущий момент.

При создании правила необходимо выбрать правило allow/deny, а также тип правила. Вы также обязаны предоставить приоритетное значение и то, что вы ограничиваете доступ к.  Вы можете дополнительно добавить имя и описание к правилу.  

![добавить правило ограничения доступа IP](media/app-service-ip-restrictions/access-restrictions-ip-add.png)

Чтобы установить правило на основе IP-адреса, выберите тип IPv4 или IPv6. В нотации CIDR для IPv4- и IPv6-адресов должна быть указана нотация IP-адреса. Чтобы указать точный адрес, можно использовать формат 1.2.3.4/32, где первые четыре октета представляют IP-адрес, а /32 — маску. Нотацией CIDR IPv4 для всех адресов является 0.0.0.0/0. Чтобы узнать больше о нотации CIDR, можно прочитать раздел [Бесклассовая адресация](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing). 

## <a name="service-endpoints"></a>Конечные точки служб

Конечные точки обслуживания позволяют ограничить доступ к выбранным подсетям виртуальных сетевых сетей Azure. Чтобы ограничить доступ к определенной подсети, создайте правило ограничения с типом виртуальной сети. Вы можете выбрать подписку, VNet и подсеть, которые вы хотите разрешить или отказать в доступе. Если конечные точки службы еще не включены с помощью выбранной подсети Microsoft.Web, она автоматически будет включена для вас, если вы не проверите окно с просьбой не делать этого. Ситуация, когда вы хотели бы включить его в приложении, но не подсеть в значительной степени связано с, если у вас есть разрешения для включения конечных точек службы в подсети или нет. Если вам нужно получить кого-то другого, чтобы включить конечные точки службы в подсети, вы можете проверить окно и настроить приложение для конечных точек службы в ожидании его включения позже в подсети. 

![добавить правило ограничения доступа VNet](media/app-service-ip-restrictions/access-restrictions-vnet-add.png)

Конечные точки службы не могут использоваться для ограничения доступа к приложениям, запускаемым в среде службы приложений. Когда ваше приложение находится в среде службы приложений, вы можете контролировать доступ к приложению с помощью правил доступа к IP. 

С конечными точками обслуживания вы можете настроить приложение с помощью шлюзов приложений или других устройств WAF. Вы также можете настроить многоуровневые приложения с защищенными бэкэндами. Для получения более подробной информации о некоторых из возможных, прочитайте [функции сети и App Service](networking-features.md) и [интеграции шлюза приложений с конечными точками службы](networking/app-gateway-with-service-endpoints.md).

## <a name="managing-access-restriction-rules"></a>Управление правилами ограничения доступа

Вы можете нажать на любую строку, чтобы отсеять существующее правило ограничения доступа. Изменения вступают в силу немедленно, включая изменения порядка приоритетов.

![отменить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-ip-edit.png)

При изменении правила нельзя изменять тип между правилом IP-адреса и правилом виртуальной сети. 

![отменить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-vnet-edit.png)

Чтобы удалить правило, нажмите **...** **Remove**

![удалить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-delete.png)

## <a name="blocking-a-single-ip-address"></a>Блокировка одного IP-адреса ##

При добавлении первого правила ограничения IP служба добавит явное правило **Deny all** с приоритетом 2147483647. На практике явное **правило Deny all** будет выполняться последним правилом и будет блокировать доступ к любому IP-адресу, который явно не разрешен с помощью правила **Allow.**

Для сценария, когда пользователи хотят явно заблокировать один IP-адрес или блок IP-адреса, но разрешить доступ ко всему остальному, необходимо добавить явное правило **«Разрешить все».**

![блокировать единый IP-адрес](media/app-service-ip-restrictions/block-single-address.png)

## <a name="scm-site"></a>Сайт СКМ 

Помимо возможности контролировать доступ к приложению, вы также можете ограничить доступ к сайту scm, используемому вашим приложением. Скм сайт веб-развернуть конечную точку, а также консоль Kudu. Вы можете отдельно назначить ограничения доступа к сайту scm из приложения или использовать один и тот же набор как для приложения, так и для сайта scm. Когда вы проверяете поле, чтобы иметь те же ограничения, как ваше приложение, все зачерпнул. Если вы отослали поле, все настройки, которые вы имели ранее на сайте scm применяются. 

![список ограничений доступа](media/app-service-ip-restrictions/access-restrictions-scm-browse.png)

## <a name="programmatic-manipulation-of-access-restriction-rules"></a>Программные манипуляции правилами ограничения доступа ##

[Azure CLI](https://docs.microsoft.com/cli/azure/webapp/config/access-restriction?view=azure-cli-latest) и [Azure PowerShell](https://docs.microsoft.com/powershell/module/Az.Websites/Add-AzWebAppAccessRestrictionRule?view=azps-3.1.0) поддерживают редактирование ограничений доступа. Пример добавления ограничения доступа с помощью Azure CLI:

```azurecli-interactive
az webapp config access-restriction add --resource-group ResourceGroup --name AppName \
    --rule-name 'IP example rule' --action Allow --ip-address 122.133.144.0/24 --priority 100
```
Пример добавления ограничения доступа с помощью Azure PowerShell:

```azurepowershell-interactive
Add-AzWebAppAccessRestrictionRule -ResourceGroupName "ResourceGroup" -WebAppName "AppName"
    -Name "Ip example rule" -Priority 100 -Action Allow -IpAddress 122.133.144.0/24
```

Значения также можно устанавливать вручную с помощью операции [Azure REST API](https://docs.microsoft.com/rest/api/azure/) PUT на конфигурации приложения в Ресурсном менеджере или с помощью шаблона управления ресурсами Azure. Например, можно использовать resources.azure.com и изменить блок ipSecurityRestrictions, чтобы добавить необходимый код JSON.

Эти сведения в Resource Manager находятся здесь:

management.azure.com/subscriptions/**ИД_подписки**/resourceGroups/**группы_ресурсов**/providers/Microsoft.Web/sites/**имя_веб-приложения**/config/web?api-version=2018-02-01

Ниже показан синтаксис JSON для приведенного выше примера.
```json
{
  "properties": {
    "ipSecurityRestrictions": [
      {
        "ipAddress": "122.133.144.0/24",
        "action": "Allow",
        "priority": 100,
        "name": "IP example rule"
      }
    ]
  }
}
```

## <a name="azure-function-app-access-restrictions"></a>Ограничения доступа к функциям функции Azure

Ограничения доступа также доступны для функциональных приложений с той же функциональностью, что и планы службы приложений. Включение ограничений доступа отключит редактор кода портала для любых запрещенных ИП.

## <a name="next-steps"></a>Дальнейшие действия
[Ограничения доступа для функциональных приложений Azure](../azure-functions/functions-networking-options.md#inbound-ip-restrictions)

[Интеграция шлюзов приложений с конечными точками обслуживания](networking/app-gateway-with-service-endpoints.md)

<!--Links-->
[serviceendpoints]: https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview
