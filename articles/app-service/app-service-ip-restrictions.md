---
title: Ограничение доступа для IP-адресов
description: Узнайте, как защитить приложение в службе приложений Azure, явно список разрешений IP-адреса клиентов или диапазоны адресов.
author: ccompy
ms.assetid: 3be1f4bd-8a81-4565-8a56-528c037b24bd
ms.topic: article
ms.date: 06/06/2019
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: 64ce74c84f8f69e72510be76a1309e1a5ea42f2f
ms.sourcegitcommit: 265f1d6f3f4703daa8d0fc8a85cbd8acf0a17d30
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/02/2019
ms.locfileid: "74672187"
---
# <a name="azure-app-service-access-restrictions"></a>Ограничения доступа для службы приложений Azure #

Ограничения доступа позволяют определить упорядоченный по приоритету список разрешений и запретов, который управляет сетевым доступом к приложению. Список может включать IP-адреса или подсети виртуальной сети Azure. Если имеется одна или несколько записей, в конце списка существует неявный "Deny All".

Функция ограничений доступа работает со всеми рабочими нагрузками, размещенными в службе приложений, включая; веб-приложения, приложения API, приложения Linux, приложения контейнеров Linux и функции.

Когда в приложение вносится запрос, адрес отдается по правилам IP-адресов в списке ограничений доступа. Если адрес отправителя находится в подсети, для которой настроены конечные точки службы Microsoft. Web, исходная подсеть сравнивается с правилами виртуальной сети в списке ограничений доступа. Если доступ с этого адреса запрещен правилами в списке, служба возвращает код состояния [HTTP 403](https://en.wikipedia.org/wiki/HTTP_403).

Функции ограничений доступа реализуются в интерфейсных ролях службы приложений, которые являются вышестоящим потоком рабочих узлов, в которых выполняется код. Следовательно, ограничения доступа — это фактические сетевые списки ACL.

Возможность ограничения доступа к веб-приложению из виртуальной сети Azure называется [конечными точками службы][serviceendpoints]. Конечные точки службы позволяют ограничить доступ к службе с несколькими клиентами из выбранных подсетей. Он должен быть включен как на стороне сети, так и в службе, с которой она включена. Он не работает, чтобы ограничить трафик для приложений, размещенных в Среда службы приложений.  Если вы используете Среда службы приложений, вы можете управлять доступом к приложению с помощью правил IP-адресов.

![поток ограничений доступа](media/app-service-ip-restrictions/access-restrictions-flow.png)

## <a name="adding-and-editing-access-restriction-rules-in-the-portal"></a>Добавление и изменение правил ограничения доступа на портале ##

Чтобы добавить правило ограничения доступа в приложение, используйте меню, чтобы открыть **сетевые**>**ограничения доступа** , и щелкните **настроить ограничения доступа** .

![Сетевые возможности службы приложений](media/app-service-ip-restrictions/access-restrictions.png)  

В пользовательском интерфейсе ограничений доступа можно просмотреть список правил ограничения доступа, определенных для приложения.

![список ограничений доступа](media/app-service-ip-restrictions/access-restrictions-browse.png)

В списке будут показаны все текущие ограничения приложения. Если в приложении имеется ограничение виртуальной сети, в таблице будет показано, включены ли конечные точки службы для Microsoft. Web. Если в приложении нет определенных ограничений, приложение будет доступно из любого места.  

## <a name="adding-ip-address-rules"></a>Добавление правил IP-адресов

Вы можете щелкнуть **[+] добавить** , чтобы добавить новое правило ограничения доступа. После добавления правило немедленно вступает в действие. Правила применяются в порядке возрастания приоритета, начиная с наименьшего числа. После добавления даже одного правила действует неявный запрет всего, что было разрешено на текущий момент.

При создании правила необходимо выбрать параметр Разрешить или запретить, а также тип правила. Кроме того, необходимо указать значение приоритета и то, к чему вы ограничивают доступ.  При необходимости в правило можно добавить имя и описание.  

![Добавление правила ограничения доступа к IP-адресу](media/app-service-ip-restrictions/access-restrictions-ip-add.png)

Чтобы задать правило на основе IP-адреса, выберите тип IPv4 или IPv6. В нотации CIDR для IPv4- и IPv6-адресов должна быть указана нотация IP-адреса. Чтобы указать точный адрес, можно использовать формат 1.2.3.4/32, где первые четыре октета представляют IP-адрес, а /32 — маску. Нотацией CIDR IPv4 для всех адресов является 0.0.0.0/0. Чтобы узнать больше о нотации CIDR, можно прочитать раздел [Бесклассовая адресация](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing). 

## <a name="service-endpoints"></a>Конечные точки службы

Конечные точки службы позволяют ограничить доступ к выбранным подсетям виртуальной сети Azure. Чтобы ограничить доступ к определенной подсети, создайте правило ограничения с типом виртуальной сети. Вы можете выбрать подписку, виртуальную сеть и подсети, к которым вы хотите разрешить или запретить доступ. Если конечные точки службы еще не включены в Microsoft. Web для выбранной подсети, она будет автоматически включена, если не установить флажок. Ситуация, когда ее нужно включить в приложении, но не в самой подсети, в основном связана с тем, есть ли у вас разрешение на включение конечных точек службы в подсети. Если необходимо предоставить другим пользователям возможность включения конечных точек службы в подсети, можно установить флажок и настроить приложение для конечных точек службы, чтобы оно было включено позже в подсети. 

![Добавление правила ограничения доступа к виртуальной сети](media/app-service-ip-restrictions/access-restrictions-vnet-add.png)

Конечные точки службы нельзя использовать для ограничения доступа к приложениям, выполняемым в Среда службы приложений. Когда приложение находится в Среда службы приложений, вы можете управлять доступом к приложению с помощью правил доступа IP. 

С конечными точками службы можно настроить приложения с помощью шлюзов приложений или других устройств WAF. Кроме того, можно настроить многоуровневые приложения с защищенными серверными интерфейсами. Дополнительные сведения о некоторых возможностях см. в статье [Сетевые компоненты и служба приложений](networking-features.md).

## <a name="managing-access-restriction-rules"></a>Управление правилами ограничения доступа

Можно щелкнуть любую строку, чтобы изменить существующее правило ограничения доступа. Изменения вступают в силу немедленно, включая изменения порядка приоритетов.

![Изменение правила ограничения доступа](media/app-service-ip-restrictions/access-restrictions-ip-edit.png)

При изменении правила нельзя изменить тип между правилом IP-адреса и правилом виртуальной сети. 

![Изменение правила ограничения доступа](media/app-service-ip-restrictions/access-restrictions-vnet-edit.png)

Чтобы удалить правило, щелкните **...** для правила и выберите **Удалить**.

![удалить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-delete.png)

## <a name="blocking-a-single-ip-address"></a>Блокировка одного IP-адреса ##

При добавлении первого правила ограничения IP-адресов служба добавит явное правило **Deny All** с приоритетом 2147483647. На практике явное правило **Deny All** будет выполняться последним и будет блокировать доступ к любому IP-адресу, который явно не разрешен с помощью правила **allow** .

Для сценария, в котором пользователи хотят явным образом заблокировать один IP-адрес или блок IP-адресов, но разрешить все остальное, необходимо добавить явное правило **Разрешить все** .

![блокировать один IP-адрес](media/app-service-ip-restrictions/block-single-address.png)

## <a name="scm-site"></a>Сайт SCM 

Помимо возможности управления доступом к приложению, можно также ограничить доступ к сайту SCM, используемому приложением. Сайт SCM — это конечная точка веб-развертывания, а также консоль KUDU. Можно отдельно назначить ограничения доступа к сайту SCM из приложения или использовать тот же набор как для приложения, так и для сайта SCM. Если установить флажок, чтобы иметь те же ограничения, что и приложение, все будет пустым. Если снять флажок, будут применены все ранее настроенные параметры на сайте SCM. 

![список ограничений доступа](media/app-service-ip-restrictions/access-restrictions-scm-browse.png)

## <a name="programmatic-manipulation-of-access-restriction-rules"></a>Программное управление правилами ограничения доступа ##

В настоящее время нет интерфейса командной строки или PowerShell для новых ограничений доступа, но значения можно задать вручную с помощью операции [REST API размещения Azure](https://docs.microsoft.com/rest/api/azure/) в конфигурации приложения в Диспетчер ресурсов. Например, можно использовать resources.azure.com и изменить блок ipSecurityRestrictions, чтобы добавить необходимый код JSON.

Эти сведения в Resource Manager находятся здесь:

management.azure.com/subscriptions/**ИД_подписки**/resourceGroups/**группы_ресурсов**/providers/Microsoft.Web/sites/**имя_веб-приложения**/config/web?api-version=2018-02-01

Ниже показан синтаксис JSON для приведенного выше примера.

    {
      "properties": {
        "ipSecurityRestrictions": [
          {
            "ipAddress": "122.133.144.0/24",
            "action": "Allow",
            "tag": "Default",
            "priority": 100,
            "name": "IP example rule"
          }
        ]
      }
    }

## <a name="function-app-ip-restrictions"></a>Ограничения IP-адресов приложение-функция

Ограничения IP-адресов доступны для приложений-функций с теми же функциями, что и планы службы приложений. При включении ограничений IP-адресов редактор кода портала будет отключен для всех недопустимых адресов.

Дополнительные сведения см. [здесь](../azure-functions/functions-networking-options.md#inbound-ip-restrictions).


<!--Links-->
[serviceendpoints]: https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview
