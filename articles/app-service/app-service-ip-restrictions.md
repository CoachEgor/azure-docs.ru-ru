---
title: Ограничение доступа - службе приложений Azure | Документация Майкрософт
description: Как использовать ограничения доступа со службой приложений Azure
author: ccompy
manager: stefsch
editor: ''
services: app-service\web
documentationcenter: ''
ms.assetid: 3be1f4bd-8a81-4565-8a56-528c037b24bd
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 05/23/2019
ms.author: ccompy
ms.custom: seodec18
ms.openlocfilehash: be0de7e809565fce4171401760d11ef9de45724e
ms.sourcegitcommit: 509e1583c3a3dde34c8090d2149d255cb92fe991
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2019
ms.locfileid: "66236122"
---
# <a name="azure-app-service-access-restrictions"></a>Ограничения доступа к службе приложений Azure #

Ограничения доступа позволяют определять упорядоченный разрешает или запрещает список приоритетов, который управляет сетевой доступ к приложению. Список может содержать IP-адреса или подсети виртуальной сети Azure. При наличии одного или нескольких элементов, имеется неявный «запретить все», на которые существует в конце списка.

Возможность ограничения доступа работает с все службы приложений, размещенных рабочих загружает включая; веб-приложений, приложений API, приложения под управлением Linux, приложения-контейнеры Linux и функции.

При запросе к приложению, адрес ОТПРАВИТЕЛЯ сравнивается правилам IP-адресов в список ограничений доступа. Если в подсети, которая настраивается с помощью конечных точек службы для Microsoft.Web адреса ОТПРАВИТЕЛЯ, исходная сравнивается правила виртуальной сети в список ограничений доступа. Если доступ с этого адреса запрещен правилами в списке, служба возвращает код состояния [HTTP 403](https://en.wikipedia.org/wiki/HTTP_403).

Возможность ограничения доступа реализуется в ролях переднего плана службы приложений, которые являются вышестоящего рабочих узлов, где выполняется код. Таким образом ограничения доступа действуют списки управления сетевым доступом.

Возможность ограничить доступ к веб-приложения с виртуальной сетью Azure (VNet) называется [конечные точки службы][serviceendpoints]. Конечные точки службы позволяют ограничить доступ к службе несколько клиентов из выбранной подсети. Его необходимо включить на стороне сети как службе, которая включается с помощью. Он не работает для ограничения трафика для приложений, размещенных в среде службы приложений.  Если вы находитесь в среде службы приложений, можно управлять доступом к приложения с помощью правилам IP-адресов.

![процесс ограничения доступа](media/app-service-ip-restrictions/access-restrictions-flow.png)

## <a name="adding-and-editing-access-restriction-rules-in-the-portal"></a>Добавление и изменение правил ограничения доступа на портале ##

Чтобы добавить правило ограничения доступа к приложению, используйте меню, чтобы открыть **сети**>**ограничения доступа** и щелкнуть **настроить ограничения доступа**

![Сетевые возможности службы приложений](media/app-service-ip-restrictions/access-restrictions.png)  

В пользовательском Интерфейсе ограничения доступа можно просмотреть список правил ограничения доступа, определили для своего приложения.

![Список ограничений доступа](media/app-service-ip-restrictions/access-restrictions-browse.png)

В списке будут показаны все текущими ограничениями, которые находятся в приложении. При наличии ограничений виртуальной сети в приложении, в таблице отображается, если конечные точки службы включены для Microsoft.Web. При наличии определенных ограничений на приложения, приложения будут доступны из любого места.  

Вы можете щелкнуть **[+] добавить** добавить новое правило ограничения доступа. После добавления правило немедленно вступает в действие. Правила применяются в порядке возрастания приоритета, начиная с наименьшего числа. После добавления даже одного правила действует неявный запрет всего, что было разрешено на текущий момент.

![Добавить правило ограничения IP-адрес доступа](media/app-service-ip-restrictions/access-restrictions-ip-add.png)

При создании правила, необходимо выбрать разрешает или запрещает, а также тип правила. Также необходимо предоставить значение приоритета и что вы ограничите доступ к.  При необходимости можно добавить имя и описание для правила.  

Чтобы задать IP-адрес правила на основе, выберите тип IPv4 или IPv6. В нотации CIDR для IPv4- и IPv6-адресов должна быть указана нотация IP-адреса. Чтобы указать точный адрес, можно использовать формат 1.2.3.4/32, где первые четыре октета представляют IP-адрес, а /32 — маску. Нотацией CIDR IPv4 для всех адресов является 0.0.0.0/0. Чтобы узнать больше о нотации CIDR, можно прочитать раздел [Бесклассовая адресация](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing).

![Добавить правило виртуальной сети для ограничения доступа](media/app-service-ip-restrictions/access-restrictions-vnet-add.png)

Чтобы ограничить доступ к выбранной подсети, выберите тип виртуальной сети. Ниже, можно выбрать подписку, виртуальную сеть и подсеть, которую вы хотите разрешить или запретить доступ с. Если конечные точки службы еще не включены с Microsoft.Web для подсети, в которой вы выбрали, он автоматически включается для вас, если не установить флажок, запрос не для этого. Ситуации, где следует включить его в приложение, но не подсети во многом связан при наличии разрешений для включения конечных точек службы в подсети или нет. Если вам нужно получить третьим лицам включить конечные точки службы в подсети, вы установите флажок и приложения настроены для конечных точек службы в ближайшем будущем его включить позже в подсети. 

Конечные точки службы не может использоваться для ограничения доступа к приложениям, которые выполняются в среде службы приложений. Когда приложение находится в среде службы приложений, можно управлять доступом к приложения с помощью правил доступа для IP-адресов. 

Можно щелкнуть любую строку, чтобы изменить существующее правило ограничения доступа. Изменения вступают в силу немедленно, включая изменения порядка приоритетов.

![изменить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-ip-edit.png)

При редактировании правило, невозможно изменить тип между правило IP-адресов и правила виртуальной сети. 

![изменить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-vnet-edit.png)

Чтобы удалить правило, щелкните **...** для правила и выберите **Удалить**.

![удалить правило ограничения доступа](media/app-service-ip-restrictions/access-restrictions-delete.png)

### <a name="scm-site"></a>Сайт SCM 

Помимо возможности для управления доступом к приложению, можно также ограничить доступ к сайту диспетчера служб, используемых приложением. Сайт scm является веб-развертывания, конечная точка, а также консоли Kudu. Отдельно можно назначить ограничения доступа к сайту диспетчера служб из приложения или использовать тот же как приложение, так и на сайте scm. При установке флажка для имеют те же ограничения, что и приложение, все, что отключается. Если флажок снят, применяются любые параметры, что и ранее на сайт scm. 

![Список ограничений доступа](media/app-service-ip-restrictions/access-restrictions-scm-browse.png)

## <a name="blocking-a-single-ip-address"></a>Блокировка одного IP-адреса ##

При добавлении первое правило ограничения IP-адресов, служба добавляет явно **запретов** правило с приоритетом 2147483647. На практике, явный **запретов** правило будет последнее правило выполняется и заблокирует доступ к любой IP-адрес, что не разрешено явным образом с помощью **Разрешить** правило.

Для сценария, где пользователям нужно явно заблокировать один IP-адрес или блок IP-адресов, но разрешить все еще доступ, бывает необходимо добавить явно **разрешить всем** правило.

![адрес блока один IP-адрес](media/app-service-ip-restrictions/block-single-address.png)

## <a name="programmatic-manipulation-of-access-restriction-rules"></a>Программные манипуляции правила ограничения доступа ##

В настоящее время нет интерфейса командной строки или PowerShell для ограничения доступа к новым возможностям, но значения могут быть установлены вручную с помощью операции PUT о конфигурации приложения в диспетчере ресурсов. Например, можно использовать resources.azure.com и изменить блок ipSecurityRestrictions, чтобы добавить необходимый код JSON.

Эти сведения в Resource Manager находятся здесь:

management.azure.com/subscriptions/**ИД_подписки**/resourceGroups/**группы_ресурсов**/providers/Microsoft.Web/sites/**имя_веб-приложения**/config/web?api-version=2018-02-01

Ниже показан синтаксис JSON для приведенного выше примера.

    "ipSecurityRestrictions": [
      {
        "ipAddress": "131.107.159.0/24",
        "action": "Allow",
        "tag": "Default",
        "priority": 100,
        "name": "allowed access"
      }
    ],

## <a name="function-app-ip-restrictions"></a>Ограничения IP-адрес приложения функции

Ограничения IP-адресов доступны для обоих приложений-функций с ту же функциональность, что планы службы приложений. Включение ограничения IP-адресов приведет к отключению редактор кода портала для всех запрещенных IP-адресов.

Дополнительные сведения см. [здесь](../azure-functions/functions-networking-options.md#inbound-ip-restrictions).


<!--Links-->
[serviceendpoints]: https://docs.microsoft.com/azure/virtual-network/virtual-network-service-endpoints-overview
