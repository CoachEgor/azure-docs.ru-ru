---
title: Передача и привязывание SSL-сертификата в Службе приложений Azure | Документация Майкрософт
description: Узнайте, как привязать настраиваемый SSL-сертификат к веб-приложению, серверной части мобильного приложения или приложению API в Службе приложений Azure.
services: app-service\web
documentationcenter: nodejs
author: cephalin
manager: erikre
editor: ''
ms.assetid: 5d5bf588-b0bb-4c6d-8840-1b609cfb5750
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: nodejs
ms.topic: tutorial
ms.date: 06/06/2019
ms.author: cephalin
ms.custom: seodec18
ms.openlocfilehash: 32e6311a8796e708119f3e1df813b6ebb2ed0673
ms.sourcegitcommit: 7042ec27b18f69db9331b3bf3b9296a9cd0c0402
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/06/2019
ms.locfileid: "66743009"
---
# <a name="tutorial-upload-and-bind-ssl-certificates-to-azure-app-service"></a>Руководство по передаче и привязыванию SSL-сертификата в Службе приложений Azure

[Служба приложений Azure](overview.md) — это служба веб-размещения с самостоятельной установкой исправлений и высоким уровнем масштабируемости. В этом руководстве демонстрируется, как защитить личный домен в Службе приложений с помощью сертификата, приобретенного в доверенном центре сертификации. В нем также описывается, как передавать закрытые и открытые сертификаты для приложений. Завершив работу с этим руководством, вы сможете обращаться к своему приложению через конечную точку HTTPS личного домена DNS.

![Веб-приложение с настраиваемым SSL-сертификатом](./media/app-service-web-tutorial-custom-ssl/app-with-custom-ssl.png)

Из этого руководства вы узнаете, как выполнять следующие задачи:

> [!div class="checklist"]
> * Выбор более высокой ценовой категории.
> * Защита личного домена с помощью сертификата.
> * Передача закрытого сертификата
> * Передача общего сертификата
> * Обновление сертификатов
> * Принудительное использование HTTPS
> * Принудительное применение TLS 1.1/1.2
> * автоматизация управления TLS с помощью скриптов.

## <a name="prerequisites"></a>Предварительные требования

Для работы с этим руководством:

- [Создано приложение службы приложений](/azure/app-service/).
- [Сопоставьте настраиваемое DNS-имя с приложением Службы приложений](app-service-web-tutorial-custom-domain.md) (если обеспечивается защита личного домена).
- Получите сертификат из доверенного центра сертификации.
- Получите закрытый ключ, который использовался для подписи запроса на сертификат (для закрытых сертификатов).

<a name="requirements"></a>

## <a name="prepare-a-private-certificate"></a>Подготовка закрытого сертификата

Чтобы обеспечить защиту домена, сертификат должен отвечать следующим требованиям:

* должен быть настроен для аутентификации на сервере;
* должен быть подписан доверенным центром сертификации;
* должен быть экспортирован в PFX-файл, защищенный паролем;
* должен содержать закрытый ключ длиной не менее 2048 битов;
* должен содержать все промежуточные сертификаты из цепочки сертификатов.

> [!TIP]
> При необходимости вы можете получить SSL-сертификат непосредственно на портале Azure и импортировать его в приложение. Следуйте указаниям в [руководстве по сертификатам службы приложений](web-sites-purchase-ssl-web-site.md).

> [!NOTE]
> **Сертификаты с шифрованием на основе эллиптических кривых (ECC)** можно использовать со службой приложений, но это не описано в этой статье. Чтобы создать сертификаты ECC, обратитесь к своему центру сертификации за конкретными указаниями.

После получения сертификата от поставщика сертификата выполните инструкции из этого раздела, чтобы подготовить сертификат для использования в Службе приложений.

### <a name="merge-intermediate-certificates"></a>Объединение промежуточных сертификатов

Если цепочка сертификатов из центра сертификации содержит несколько сертификатов, их необходимо объединить по порядку.

Чтобы сделать это, откройте каждый полученный сертификат в текстовом редакторе.

Создайте файл для объединенных сертификатов и присвойте ему имя _mergedcertificate.crt_. В текстовом редакторе скопируйте содержимое каждого сертификата в этот файл. Порядок сертификатов должен соответствовать порядку в цепочке сертификатов, начиная вашим сертификатом и заканчивая корневым сертификатом. Это должно выглядеть следующим образом:

```
-----BEGIN CERTIFICATE-----
<your entire Base64 encoded SSL certificate>
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
<The entire Base64 encoded intermediate certificate 1>
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
<The entire Base64 encoded intermediate certificate 2>
-----END CERTIFICATE-----

-----BEGIN CERTIFICATE-----
<The entire Base64 encoded root certificate>
-----END CERTIFICATE-----
```

### <a name="export-certificate-to-pfx"></a>Экспорт сертификата в PFX-файл

Экспортируйте объединенный SSL-сертификат с закрытым ключом, с помощью которого был создан запрос сертификата.

Если запрос сертификата был создан с помощью OpenSSL, то вы создали файл закрытого ключа. Чтобы экспортировать сертификат в PFX-файл, выполните следующую команду. Замените заполнители _&lt;private-key-file>_ и _&lt;merged-certificate-file>_ путями к закрытому ключу и объединенному файлу сертификатов.

```bash
openssl pkcs12 -export -out myserver.pfx -inkey <private-key-file> -in <merged-certificate-file>  
```

При появлении запроса определите пароль для экспорта. Позже этот пароль потребуется при передаче SSL-сертификата в службу приложений.

Если вы создали запрос на сертификат с помощью IIS или _Certreq.exe_, установите сертификат на локальный компьютер, а затем [экспортируйте его в PFX](https://technet.microsoft.com/library/cc754329(v=ws.11).aspx).

Теперь вы можете передать сертификат в Службу приложений.

[!INCLUDE [Prepare your web app](../../includes/app-service-ssl-prepare-app.md)]

<a name="upload"></a>

## <a name="secure-a-custom-domain"></a>Защита личного домена

> [!TIP]
> Если необходимо, вы можете получить SSL-сертификат непосредственно на портале Azure и привязать его к приложению. Следуйте указаниям в [руководстве по сертификатам службы приложений](web-sites-purchase-ssl-web-site.md).

Чтобы защитить [личный домен](app-service-web-tutorial-custom-domain.md) с помощью стороннего сертификата, нужно передать [подготовленный закрытый сертификат](#prepare-a-private-certificate) и привязать его к личному домену. Служба приложений упрощает этот процесс. Сделайте следующее:

Щелкните **Личные домены** в левой области навигации приложения и выберите **Добавить привязку** для домена, который требуется защитить. Если для домена не отображается вариант **Добавить привязку**, значит он уже защищен и должен иметь состояние SSL **Защищено**.

![Добавка привязки к домену](./media/app-service-web-tutorial-custom-ssl/secure-domain-launch.png)

Щелкните **Отправить сертификат**.

В разделе **PFX-файл сертификата** выберите свой PFX-файл. В поле **Пароль сертификата** введите пароль, созданный при экспорте PFX-файла.

Щелкните **Отправить**.

![Передача сертификата в домен](./media/app-service-web-tutorial-custom-ssl/secure-domain-upload.png)

Дождитесь передачи сертификата в Azure и откройте диалоговое окно привязок SSL.

В диалоговом окне привязок SSL выберите переданный сертификат и тип SSL и щелкните **Добавить привязку**.

> [!NOTE]
> Поддерживаются такие типы SSL:
>
> - **[SSL на основе SNI](https://en.wikipedia.org/wiki/Server_Name_Indication)** позволяет добавить несколько привязок SSL на основе SNI. Этот параметр позволяет использовать несколько SSL-сертификатов для защиты нескольких доменов с одним IP-адресом. Большинство современных браузеров (включая Internet Explorer, Chrome, Firefox и Opera) поддерживает SNI (более подробную информацию о поддержки браузеров можно найти в статье [Server Name Indication](https://wikipedia.org/wiki/Server_Name_Indication) (Указание имени сервера)).
> - **SSL на основе IP-адреса** позволяет добавить только одну привязку SSL на основе IP-адреса. Этот параметр позволяет использовать только один SSL-сертификат для защиты выделенного общедоступного IP-адреса. Чтобы защитить несколько доменов, необходимо использовать один и тот же SSL-сертификат. Это традиционный вариант привязки SSL.

![Привязка SSL к домену](./media/app-service-web-tutorial-custom-ssl/secure-domain-bind.png)

Состояние SSL домена теперь должно измениться на **Защищено**.

![Домен защищен](./media/app-service-web-tutorial-custom-ssl/secure-domain-finished.png)

> [!NOTE]
> Состояние **Защищено** **личного домена** означает, что он защищен с помощью сертификата, но Служба приложений не проверяет, например, является ли сертификат самозаверяющим или действительным, что также может привести к отображению ошибки или предупреждения в браузере.

## <a name="remap-a-record-for-ip-ssl"></a>Переназначение записи A для SSL на основе IP-адреса

Если вы не используете SSL на основе IP-адреса в приложении, перейдите к разделу [Тестирование HTTPS](#test).

По умолчанию приложение использует общий общедоступный IP-адрес. После привязки сертификата с помощью SSL на основе IP-адреса Служба приложений создает выделенный IP-адрес для вашего приложения.

Если с приложением сопоставлена запись A, обновите реестр домена, указав этот новый выделенный IP-адрес.

Он появится на странице **Личный домен** вашего приложения. [Скопируйте этот IP-адрес](app-service-web-tutorial-custom-domain.md#info), затем [переназначьте его записи A](app-service-web-tutorial-custom-domain.md#map-an-a-record).

<a name="test"></a>

## <a name="test-https"></a>Тестирование HTTPS

Нам осталось только убедиться, что протокол HTTPS для личного домена функционирует. В разных браузерах перейдите по адресу `https://<your.custom.domain>` , чтобы посмотреть, как он обслуживает ваше приложение.

![Переход к приложению Azure на портале](./media/app-service-web-tutorial-custom-ssl/app-with-custom-ssl.png)

> [!NOTE]
> Если приложение выдает ошибки проверки сертификата, вероятно, вы используете самозаверяющий сертификат.
>
> Если это не так, возможно, вы пропустили промежуточные сертификаты при экспорте сертификата в PFX-файл.

## <a name="renew-certificates"></a>Обновление сертификатов

Входящий IP-адрес может измениться после удаления привязки, даже если привязка сделана по IP-адресу. Это особенно важно при обновлении сертификата, который уже связан с привязкой по IP-адресу. Чтобы избежать изменения IP-адреса приложения, выполните по очереди следующие действия:

1. Передайте новый сертификат.
2. Привяжите новый сертификат к пользовательскому домену, не удаляя старый сертификат. Таким образом вы замените привязку, а не удалите старый сертификат.
3. Удалите старый сертификат. 

<a name="bkmk_enforce"></a>

## <a name="enforce-https"></a>Принудительное использование HTTPS

По умолчанию любой пользователь по-прежнему может получить доступ к вашему приложению с помощью HTTP. Вы можете перенаправить все HTTP-запросы на HTTPS-порт.

На странице приложения в области слева выберите **Параметры SSL**. Затем в окне **Только HTTPS**выберите **ВКЛ**.

![Принудительное использование HTTPS](./media/app-service-web-tutorial-custom-ssl/enforce-https.png)

По завершении операции перейдите по любому из URL-адресов HTTP, которые указывают на ваше приложение. Например:

- `http://<app_name>.azurewebsites.net`
- `http://contoso.com`
- `http://www.contoso.com`

## <a name="enforce-tls-versions"></a>Принудительное применение версий TLS

Приложение по умолчанию разрешает применение [TLS](https://wikipedia.org/wiki/Transport_Layer_Security) версии 1.2, которая является рекомендуемой в соответствии с такими отраслевыми стандартами, как [PCI DSS](https://wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard). Чтобы принудительно применить другую версию TLS сделайте следующее:

На странице приложения в области слева выберите **Параметры SSL**. Затем в разделе **версии TLS** выберите минимальную требуемую версию TLS. Этот параметр определяет только входящие вызовы. 

![Принудительное использование TLS 1.1 или 1.2](./media/app-service-web-tutorial-custom-ssl/enforce-tls1.2.png)

После этой операции приложение отклоняет все подключения с более ранними версиями TLS.

## <a name="automate-with-scripts"></a>Автоматизация с помощью сценариев

Управление привязками SSL для приложения можно автоматизировать с помощью сценариев, воспользовавшись [Azure CLI](/cli/azure/install-azure-cli) или [Azure PowerShell](/powershell/azure/overview).

### <a name="azure-cli"></a>Инфраструктура CLI Azure

Следующая команда передает экспортированный PFX-файл и возвращает отпечаток.

```azurecli-interactive
thumbprint=$(az webapp config ssl upload \
    --name <app-name> \
    --resource-group <resource-group-name> \
    --certificate-file <path-to-PFX-file> \
    --certificate-password <PFX-password> \
    --query thumbprint \
    --output tsv)
```

Следующая команда добавляет привязку SSL на основе SNI с помощью отпечатка из предыдущей команды.

```azurecli-interactive
az webapp config ssl bind \
    --name <app-name> \
    --resource-group <resource-group-name>
    --certificate-thumbprint $thumbprint \
    --ssl-type SNI \
```

С помощью следующей команды устанавливается значение минимальной версии TLS 1.2:

```azurecli-interactive
az webapp config set \
    --name <app-name> \
    --resource-group <resource-group-name>
    --min-tls-version 1.2
```

### <a name="azure-powershell"></a>Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]

Следующая команда передает экспортированный PFX-файл и добавляет привязку SSL на основе SNI.

```powershell
New-AzWebAppSSLBinding `
    -WebAppName <app_name> `
    -ResourceGroupName <resource_group_name> `
    -Name <dns_name> `
    -CertificateFilePath <path_to_PFX_file> `
    -CertificatePassword <PFX_password> `
    -SslState SniEnabled
```

## <a name="use-certificates-in-your-code"></a>Использование сертификатов в коде

Если вашему приложению требуется подключение к удаленным ресурсам, а удаленный ресурс требует аутентификации на основе сертификата, вы можете передать в приложение открытые или закрытые сертификаты. Вам не нужно привязывать такие сертификаты к каким-либо личным доменам в приложении. Дополнительные сведения см. в статье об [использовании SSL-сертификата в коде для приложения службы приложений Azure](app-service-web-ssl-cert-load.md).

## <a name="next-steps"></a>Дополнительная информация

Из этого руководства вы узнали, как выполнить следующие задачи:

> [!div class="checklist"]
> * Выбор более высокой ценовой категории.
> * привязывание пользовательского сертификата к Службе приложений;
> * Обновление сертификатов
> * Принудительное использование HTTPS
> * Принудительное применение TLS 1.1/1.2
> * автоматизация управления TLS с помощью скриптов.

Перейдите к следующему руководству, чтобы научиться использовать сеть доставки содержимого Azure.

> [!div class="nextstepaction"]
> [Добавление сети доставки содержимого (CDN) в службу приложений Azure](../cdn/cdn-add-to-web-app.md)

Дополнительные сведения см. в статье об [использовании SSL-сертификата в коде для приложения службы приложений Azure](app-service-web-ssl-cert-load.md).
