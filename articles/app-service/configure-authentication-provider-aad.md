---
title: Настройка аутентификации Azure Active Directory в Службе приложений Azure
description: Узнайте, как настроить проверку подлинности Azure Active Directory для приложения службы приложений.
author: cephalin
services: app-service
documentationcenter: ''
manager: gwallace
editor: ''
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.service: app-service
ms.workload: web,mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 09/03/2019
ms.author: cephalin
ms.custom: seodec18
ms.openlocfilehash: 8b4b6549f9553773cc44c311f49befbb3eec9dc9
ms.sourcegitcommit: 2aefdf92db8950ff02c94d8b0535bf4096021b11
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2019
ms.locfileid: "70233098"
---
# <a name="configure-your-app-service-app-to-use-azure-active-directory-sign-in"></a>Настройка приложения Службы приложений для использования входа Azure Active Directory

[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

> [!NOTE]
> В настоящее время AAD v2 (включая MSAL) не поддерживается для службы приложений Azure и функций Azure.
>

В этой статье показано, как настроить службу приложений Azure для использования Azure Active Directory в качестве поставщика проверки подлинности.

Рекомендуется настроить каждое приложение службы приложений с собственной регистрацией, чтобы оно получило собственные разрешения и согласие. Кроме того, рассмотрите возможность использования отдельных регистраций приложений для отдельных слотов развертывания. Это позволяет избежать совместного использования разрешений между средами, чтобы проблема в новом тестируемом коде не влияла на рабочую среду.

## <a name="express"> </a>Настройка с помощью стандартных параметров

1. Перейдите к своему приложению службы приложений на [портал Azure]. В левой области навигации выберите **Аутентификация или авторизация**.
2. Если параметр **Аутентификация или авторизация** не включен, выберите **Вкл**.
3. Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Экспресс**.
4. Нажмите кнопку **ОК**, чтобы зарегистрировать приложение службы приложений в Azure Active Directory. При этом новое приложение будет зарегистрировано. Чтобы выбрать имеющуюся регистрацию приложения, щелкните **Выбрать существующее приложение** и найдите имя ранее созданной регистрации приложения в своем клиенте. Щелкните регистрацию приложения, чтобы выбрать ее, и нажмите кнопку **ОК**. Затем нажмите кнопку **ОК** на странице параметров Azure Active Directory.
По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения.
5. Используемых Чтобы ограничить доступ к приложению только для пользователей, прошедших проверку подлинности Azure Active Directory, задайте **действие, которое будет выполняться, если запрос не прошел проверку** подлинности для **входа с помощью Azure Active Directory**. В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.

    > [!NOTE]
    > Таким образом, ограниченный доступ применяется ко всем вызовам приложения, что может быть нежелательно для приложений, которым требуется общедоступная Домашняя страница, как во многих одностраничных приложениях. Для таких приложений рекомендуется **Разрешить анонимные запросы (без действий)** , если приложение вручную запускает вход, как описано [здесь](overview-authentication-authorization.md#authentication-flow).
6. Нажмите кнопку **Сохранить**.

## <a name="advanced"> </a>Настройка с помощью дополнительных параметров

Вы также можете указать параметры конфигурации вручную, если Azure Active Directory клиент, который вы хотите использовать, отличается от клиента, с которым вы входите в Azure. Чтобы выполнить настройку, сначала необходимо создать регистрацию в Azure Active Directory, а затем предоставить некоторые сведения о регистрации службе приложений.

### <a name="register"> </a>Создание регистрации приложения в Azure AD для приложения службы приложений

При создании регистрации приложения вручную Обратите внимание на три фрагмента информации, которые понадобятся позже при настройке приложения службы приложений: идентификатор клиента, идентификатор клиента и, при необходимости, секрет клиента и URI идентификатора приложения.

1. В [портал Azure]перейдите к приложению службы приложений и запишите **URL-адрес**своего приложения. Он будет использоваться для настройки регистрации приложения Azure Active Directory.
1. В [портал Azure]в меню слева выберите **Active Directory** > **Регистрация приложений** > **Новая регистрация**. 
1. На странице **Регистрация приложения** введите **имя** для регистрации приложения.
1. В поле **URI перенаправления**выберите **веб** и введите URL-адрес приложения службы приложений и добавьте путь к `/.auth/login/aad/callback`нему. Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`. Щелкните **Создать**.
1. После создания регистрации приложения скопируйте **идентификатор приложения (клиента)** и **идентификатор каталога (клиента)** для последующего использования.
1. Выберите **фирменную символику**. В поле **URL-адрес домашней страницы**введите URL-адрес приложения службы приложений и нажмите кнопку **сохранить**.
1. Выберите **предоставить** > **набор**API. Вставьте URL-адрес приложения службы приложений и нажмите кнопку **сохранить**.

    > [!NOTE]
    > Это значение представляет собой **URI идентификатора приложения** для регистрации приложения. Например, если вы хотите, чтобы Интерфейсное веб-приложение имело доступ к внутреннему API, и вы хотите, чтобы серверная часть явно предоставляла доступ к интерфейсу, вам потребуется **URI идентификатора приложения** *внешнего* интерфейса при настройке ресурса приложения службы приложений для < C2 Серверная >.
1. Нажмите **Добавить группу**. В списке **имя области**введите *user_impersonation*. В текстовых полях введите имя и описание области разрешения, которые должны видеть пользователи на странице согласие, например *доступ к моему приложению*. По завершении нажмите кнопку **Добавить область**.
1. Используемых Чтобы создать секрет клиента, выберите **Сертификаты & секреты** > **новый секрет** > клиента**Добавить**. Скопируйте значение секрета клиента, показанное на странице. После выхода он не будет показан снова.
1. Используемых Чтобы добавить несколько **URL-адресов ответа**, выберите в меню пункт **Проверка** подлинности.

### <a name="secrets"> </a>Добавление сведений об Azure Active Directory в приложение службы приложений

1. Перейдите к своему приложению службы приложений на [портал Azure]. В меню слева выберите **Проверка подлинности и авторизация**. Если функция проверки подлинности и авторизации не включена, выберите **вкл**. 
1. Используемых По умолчанию проверка подлинности службы приложений разрешает доступ к приложению без проверки подлинности. Чтобы применить проверку подлинности пользователя, задайте **действие, которое будет выполняться, если запрос не прошел проверку** подлинности для **входа с помощью Azure Active Directory**.
1. В разделе Поставщики проверки подлинности выберите **Azure Active Directory**.
1. В **режиме управления**выберите **Дополнительно** и настройте проверку подлинности службы приложений в соответствии со следующей таблицей.

    |Поле|Описание|
    |-|-|
    |Идентификатор клиента| Используйте **идентификатор приложения (клиента)** для регистрации приложения. |
    |Идентификатор издателя| Используйте `https://login.microsoftonline.com/<tenant-id>`и замените  *\<идентификатор клиента >* **идентификатором каталога (клиента)** регистрации приложения. |
    |Секрет клиента (необязательно)| Используйте секрет клиента, созданный при регистрации приложения.|
    |Разрешенные аудитории токенов| Если это серверное приложение и вы хотите разрешить маркеры проверки подлинности из внешнего приложения, добавьте **URI идентификатора приложения** для *внешнего* интерфейса здесь. |
1. Нажмите кнопку **ОК**, а затем выберите **сохранить**.

Теперь вы можете использовать Azure Active Directory для аутентификации в приложении службы приложений.

## <a name="configure-a-native-client-application"></a>Настройка собственного клиентского приложения
Вы можете зарегистрировать собственные клиенты, если вы хотите выполнять вход с помощью клиентской библиотеки, например **Библиотека проверки подлинности Active Directory**.

1. В [портал Azure]в меню слева выберите **Active Directory** > **Регистрация приложений** > **Новая регистрация**. 
1. На странице **Регистрация приложения** введите **имя** для регистрации приложения.
1. В поле **URI перенаправления**выберите общедоступный **клиент (мобильный & Рабочий стол)** и введите URL-адрес приложения службы приложений и `/.auth/login/aad/callback`добавьте путь к нему. Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`. Щелкните **Создать**.

    > [!NOTE]
    > Для приложения Windows используйте [идентификатор безопасности пакета](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) в качестве универсального кода ресурса (URI).
1. После создания регистрации приложения скопируйте значение **идентификатора Application (Client)** .
1. В меню слева выберите **разрешения** > API**Добавить разрешение** > **Мои интерфейсы API**.
1. Выберите регистрацию приложения, созданную ранее для приложения службы приложений. Если регистрация приложения не отображается, проверьте, добавлена ли область **user_impersonation** в разделе [Создание регистрации приложения в Azure AD для приложения службы приложений](#register).
1. Выберите **user_impersonation** и нажмите кнопку **Добавить разрешения**.

Теперь вы настроили собственное клиентское приложение, у которого есть доступ к вашему приложению службы приложений.

## <a name="related-content"> </a>Связанная информация

[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- Images. -->

[0]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-url.png
[1]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app_registration.png
[2]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-create.png
[3]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-appidurl.png
[4]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-replyurl.png
[5]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints.png
[6]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints-fedmetadataxml.png
[7]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth.png
[8]: ./media/configure-authentication-provider-aad/app-service-webapp-auth-config.png



<!-- URLs. -->

[портал Azure]: https://portal.azure.com/
[alternative method]:#advanced
