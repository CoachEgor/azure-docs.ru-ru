---
title: Настройка аутентификации Azure Active Directory в Службе приложений Azure
description: Узнайте, как настроить проверку подлинности Azure Active Directory для приложения служб приложений.
author: mattchenderson
services: app-service
documentationcenter: ''
manager: syntaxc4
editor: ''
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.service: app-service-mobile
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 02/20/2019
ms.author: mahender
ms.custom: seodec18
ms.openlocfilehash: d687e770fae6c32ee351a597e12d1aca6094e5cb
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "60851381"
---
# <a name="configure-your-app-service-app-to-use-azure-active-directory-sign-in"></a>Настройка приложения Службы приложений для использования входа Azure Active Directory

> [!NOTE]
> В настоящее время AAD V2 (включая MSAL) для службы приложений и функций Azure не поддерживается. Проверьте за обновлениями.
>

[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этой стать описывается, как настроить службы приложений Azure для использования Azure Active Directory в качестве поставщика проверки подлинности.

## <a name="express"> </a>Настройка с помощью стандартных параметров

1. Перейдите к своему приложению службы приложений на [портал Azure]. В левой области навигации выберите **Аутентификация или авторизация**.
2. Если параметр **Аутентификация или авторизация** не включен, выберите **Вкл**.
3. Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Экспресс**.
4. Нажмите кнопку **ОК**, чтобы зарегистрировать приложение службы приложений в Azure Active Directory. При этом новое приложение будет зарегистрировано. Чтобы выбрать имеющуюся регистрацию приложения, щелкните **Выбрать существующее приложение** и найдите имя ранее созданной регистрации приложения в своем клиенте.
   Щелкните регистрацию приложения, чтобы выбрать ее, и нажмите кнопку **ОК**. Затем нажмите кнопку **ОК** на странице параметров Azure Active Directory.
   По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения.
5. (Необязательно.) Чтобы предоставить доступ к сайту только пользователям, прошедшим проверку подлинности в Azure Active Directory, установите для параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** значение **Войти с использованием Azure Active Directory**. В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.
6. Выберите команду **Сохранить**.

## <a name="advanced"> </a>Настройка с помощью дополнительных параметров

Вы также можете указать параметры конфигурации вручную. Этот способ рекомендуется, если клиент Azure Active Directory, который вы хотите использовать, отличается от клиента, с которого вы выполняете вход в Azure. Чтобы выполнить настройку, сначала необходимо создать регистрацию в Azure Active Directory, а затем предоставить некоторые сведения о регистрации службе приложений.

### <a name="register"> </a>Регистрация приложения службы приложений в Azure Active Directory

1. Войдите на [портал Azure] и перейдите к своему приложению Службы приложений. Скопируйте **URL-адрес** приложения. Он будет использоваться для настройки регистрации приложения Azure Active Directory.
2. Чтобы зарегистрировать новое приложение, перейдите к **Active Directory**, а затем выберите **Регистрации приложений** и в верхней части нажмите кнопку **Регистрация нового приложения**. 
3. На странице **Создание** введите **имя** регистрации приложения, выберите тип **Веб-приложение или API** и вставьте URL-адрес приложения (из шага 1) в поле **URL-адрес для входа**. Затем щелкните **Создать**.
4. Через несколько секунд отобразится только что созданная регистрация приложения.
5. После добавления регистрации приложения щелкните ее имя, а затем вверху выберите **Параметры** > **Свойства**. 
6. В диалоговом окне **URI кода приложения** вставьте URL-адрес приложения (из шага 1), а также в поле **URL-адрес домашней страницы** вставьте URL-адрес приложения (из шага 1), затем щелкните **Сохранить**.
7. Теперь щелкните **URL-адреса ответа**, изменить **URL-адрес ответа**, вставьте URL-адрес приложения (из шага 1), а затем добавьте его в конец URL-адрес, */.auth/login/aad/callback* (для Пример, `https://contoso.azurewebsites.net/.auth/login/aad/callback`). Выберите команду **Сохранить**.

   > [!NOTE]
   > Можно использовать тот же способ регистрации приложения для нескольких доменов путем добавления дополнительных **URL-адреса ответа**. Убедитесь в том, что модели каждый экземпляр службы приложений с помощью собственной регистрацией, поэтому он имеет свои собственные разрешения и согласие. Также мы советуем использовать отдельные регистрации слотов отдельный узел. Это позволяет избежать разрешения, будет использоваться совместно разными средами, ошибки в новом коде, который вы тестируете не влияет на производство.
    
8. На этом этапе скопируйте **идентификатор** для приложения. Сохраните его для последующего использования. Он понадобится, чтобы настроить приложение службы приложений.
9. Закройте страницу **Зарегистрированное приложение**. В верхней части страницы **Регистрация приложений** нажмите кнопку **Конечные точки** и скопируйте URL-адрес **WS-FEDERATION SIGN-ON ENDPOINT**, но удалите с URL-адреса окончание `/wsfed`. Результат должен выглядеть следующим образом: `https://login.microsoftonline.com/00000000-0000-0000-0000-000000000000`. Доменное имя национального облака может отличаться. Позже, оно будет использоваться в качестве URL-адреса издателя.

### <a name="secrets"> </a>Добавление сведений об Azure Active Directory в приложение службы приложений

1. Вернитесь к своему приложению службы приложений на [портал Azure]. Щелкните **Аутентификация или авторизация**. Если функция аутентификации или авторизации не включена, установите переключатель в положение **Вкл**. Чтобы настроить приложение, щелкните **Azure Active Directory** в списке поставщиков аутентификации.

    (Необязательно.) По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения. В раскрывающемся списке **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** выберите **Войти с использованием Azure Active Directory**. При выборе этого параметра все запросы, не прошедшие аутентификацию, будут направляться для аутентификации в Azure Active Directory.
2. В конфигурации аутентификации Active Directory щелкните **Дополнительно** в разделе **Режим управления**. Вставьте идентификатор приложения в поле идентификатора клиента (из шага 8) и вставьте URL-адрес (из шага 9) для URL-адреса издателя. Нажмите кнопку **ОК**.
3. На странице "Active Directory Authentication configuration" (Конфигурация аутентификации Active Directory) щелкните **Сохранить**.

Теперь вы можете использовать Azure Active Directory для аутентификации в приложении службы приложений.

## <a name="configure-a-native-client-application"></a>Настройка собственного клиентского приложения
Вы можете регистрировать собственных клиентов, что обеспечит больший контроль над сопоставлением разрешений. Это необходимо, если вы хотите выполнять вход с помощью клиентской библиотеки, например **Библиотеки проверки подлинности Active Directory**.

1. Перейдите в раздел **Azure Active Directory** на [портал Azure].
2. В левой области навигации выберите **Регистрация приложений**. Щелкните **New app registration** (Создать регистрацию приложения) вверху.
4. На странице **Создание** введите **имя** регистрации приложения. Для параметра **Тип приложения** выберите значение **Машинный код**.
5. В поле **URI перенаправления** введите конечную точку */.auth/login/done* веб-сайта в формате HTTPS. Это значение должно быть аналогично *https://contoso.azurewebsites.net/.auth/login/done* . При создании приложения Windows в качестве URI используйте [идентификатор безопасности пакета](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) .
5. Нажмите кнопку **Создать**.
6. После добавления регистрации приложения выберите ее, чтобы открыть. Найдите **идентификатор приложения** и запишите его.
7. Последовательно выберите **Все параметры** > **Необходимые разрешения** > **Добавить** > **Выбор API**.
8. Введите имя приложения службы приложений, которое было зарегистрировано ранее, чтобы найти его, а затем выберите его и нажмите кнопку **Выбрать**.
9. Выберите **Доступ к \<имя_приложения>** . Затем щелкните **Выбрать**. Затем нажмите кнопку **Done**(Готово).

Теперь вы настроили собственное клиентское приложение, у которого есть доступ к вашему приложению службы приложений.

## <a name="related-content"> </a>Связанная информация

[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- Images. -->

[0]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-url.png
[1]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app_registration.png
[2]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-create.png
[3]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-appidurl.png
[4]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-replyurl.png
[5]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints.png
[6]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints-fedmetadataxml.png
[7]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth.png
[8]: ./media/configure-authentication-provider-aad/app-service-webapp-auth-config.png



<!-- URLs. -->

[портал Azure]: https://portal.azure.com/
[alternative method]:#advanced
