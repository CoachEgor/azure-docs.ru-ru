---
title: Настройка проверки подлинности Azure AD
description: Узнайте, как настроить активную проверку подлинности каталога Azure как поставщика идентификационных данных для службы приложений или приложения Azure Functions.
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.topic: article
ms.date: 04/14/2020
ms.custom: seodec18, fasttrack-edit
ms.openlocfilehash: f625f5df4f33c6516bd5c50f97c52404d76757a0
ms.sourcegitcommit: 75089113827229663afed75b8364ab5212d67323
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "82024461"
---
# <a name="configure-your-app-service-or-azure-functions-app-to-use-azure-ad-login"></a>Настройте приложение App Service или Azure Functions для использования входа в AD Azure

[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этой статье показано, как настроить службу приложений Azure или функции Azure для использования Active Directory Azure (Azure AD) в качестве поставщика аутентификации.

> [!NOTE]
> Поток экспресс-настроек настраивает регистрацию приложения AAD V1. Если вы хотите использовать [Azure Active Directory v2.0](../active-directory/develop/v2-overview.md) (включая [MSAL),](../active-directory/develop/msal-overview.md)пожалуйста, следуйте [инструкциям по расширенной конфигурации.](#advanced)

Следите за этими рекомендациями при настройке приложения и аутентификации:

- Дайте каждому приложению App Service свои собственные разрешения и согласие.
- Настройте каждое приложение App Service с собственной регистрацией.
- Избегайте совместного использования разрешений между средами, используя отдельные регистрации приложений для отдельных слотов развертывания. При тестировании нового кода эта практика может помочь предотвратить проблемы, влияющие на приложение для производства.

## <a name="configure-with-express-settings"></a><a name="express"> </a>Настройка с помощью стандартных параметров

> [!NOTE]
> Опция **Express** недоступна для правительственных облаков. 

1. На [портале Azure]ищите и выбирайте **службы приложений,** а затем выберите приложение.
2. Из левой навигации выберите **аутентификацию / Авторизация** > **на**.
3. Выберите **Активный каталог** > Azure**Express**.

   Если вы хотите выбрать существующую регистрацию приложения вместо этого:

   1. Выберите **существующее приложение AD,** затем нажмите **azure AD App.**
   2. Выберите существующую регистрацию приложения и **нажмите OK**.

3. Нажмите кнопку **ОК**, чтобы зарегистрировать приложение службы приложений в Azure Active Directory. Создается новая регистрация приложений.
   
    ![Настройки экспресса в active-каталоге Azure](./media/configure-authentication-provider-aad/express-settings.png)
   
4. (Необязательно) По умолчанию Служба App предоставляет аутентификацию, но не ограничивает авторизованный доступ к содержимому вашего сайта и AA. Авторизация пользователей должна быть включена в код приложения. Чтобы ограничить доступ к приложению только для пользователей, удостоверяющих подлинность Active Directory, установите **действие Action, когда запрос не проверен** для входа в журнал с **Azure Active Directory.** При настройке этой функции приложение требует проверки подлинности всех запросов. Он также перенаправляет все непроверенные на Azure Active Directory для проверки подлинности.

    > [!CAUTION]
    > Ограничение доступа таким образом распространяется на все вызовы в ваше приложение, что может оказаться нежелательным для приложений, имеющих общедоступную домашнюю страницу, как во многих одностраничных приложениях. Для таких приложений может быть предпочтительным **разрешить анонимные запросы (без действий),** при этом приложение вручную запускает логин. Для получения дополнительной информации [см.](overview-authentication-authorization.md#authentication-flow)
5. Щелкните **Сохранить**.

## <a name="configure-with-advanced-settings"></a><a name="advanced"> </a>Настройка с помощью дополнительных параметров

Настройки приложений можно настроить вручную, если вы хотите использовать регистрацию приложения от другого арендатора Azure AD. Для завершения этой пользовательской конфигурации:

1. Создайте регистрацию в Azure AD.
2. Предоставьте некоторые регистрационные данные службе App Service.

### <a name="create-an-app-registration-in-azure-ad-for-your-app-service-app"></a><a name="register"> </a>Создание регистрации приложения в Azure AD для приложения Службы app

При настройке приложения Службы приложения вам понадобится следующая информация:

- Идентификатор клиента
- Tenant ID
- Секрет клиента (необязательно)
- Приложение ID URI

Выполните следующие действия:

1. Вопийте на [портале Azure,]ищите и выберите **службы приложений,** а затем выберите приложение. Обратите внимание на **URL-адрес**приложения. Вы будете использовать его для настройки регистрации приложений Azure Active Directory.
1. Выберите **приложение Azure Active Directory** > **App регистрации** > **Новая регистрация**.
1. На странице **регистрации введите** **имя** для регистрации приложения.
1. В **перенаправить URI**, `<app-url>/.auth/login/aad/callback`выберите **веб** и введите . Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`. 
1. Нажмите кнопку **создания**.
1. После создания регистрации приложения скопируйте **идентификатор приложения (клиента)** и **идентификатор каталога (арендатора)** на более поздний срок.
1. Выберите **Проверка подлинности**. В рамках **неявного гранта,** позволяют **токены ID,** чтобы позволить OpenID Подключить пользователей войти в систему App Service.
1. (Необязательно) Выберите **Брендинг**. В **URL-адресе главной страницы**введите URL-адрес приложения App Service и выберите **Сохранить.**
1. Выберите **выставочку набора API.** > **Set** Для приложения с одним арендатором вставьте URL приложения App Service и выберите **Сохранить** и для мультитенантного приложения, вставьте в URL, который основан на одном из проверенных доменов арендатора, а затем выберите **Сохранить**.

   > [!NOTE]
   > Это значение является **URI-идентификатором приложения.** Если вашему веб-приложению требуется доступ к API в облаке, при настройке ресурса облачного сервиса App требуется **URI-URI приложения application.** Вы можете использовать это, например, если вы хотите, чтобы облачный сервис явно предоставил доступ к веб-приложению.

1. Выберите **Добавить область**.
   1. В **названии Scope**введите *user_impersonation*.
   1. В текстовых явках введите имя и описание области согласия, которые пользователи должны видеть на странице согласия. Например, введите *приложение Access my app*. 
   1. Выберите **область добавления.**
1. (Необязательно) Чтобы создать секрет клиента, выберите **Сертификаты & секреты** > **Новый секрет** > клиента**Добавить**. Копирование секретного значения клиента, отображаемого на странице. Он больше не будет отображаться.
1. (Необязательно) Чтобы добавить несколько **URL-адресов ответа,** выберите **аутентификацию.**

### <a name="enable-azure-active-directory-in-your-app-service-app"></a><a name="secrets"> </a>Включить активный каталог Azure в приложении Службы приложений

1. На [портале Azure]ищите и выбирайте **службы приложений,** а затем выберите приложение. 
1. В левой панели, под **настройками,** выберите **аутентификацию / Авторизация** > **на**.
1. (Необязательно) По умолчанию аутентификация Службы app позволяет получить недостоверный доступ к вашему приложению. Чтобы обеспечить аутентификацию пользователя, **установите действие Action, если запрос не проверен** для входа в журнал с **azure Active Directory.**
1. В разделе **Поставщики проверки подлинности** выберите **Azure Active Directory**.
1. В **режиме управления**выберите **Расширенную** и настройте аутентификацию Службы приложений в соответствии со следующей таблицей:

    |Поле|Описание|
    |-|-|
    |Идентификатор клиента| Используйте **идентификатор** регистрации приложения (клиента). |
    |Эмитент Урл| Используйте `<authentication-endpoint>/<tenant-id>/v2.0`и замените * \<конечную точку проверки подлинности>* [конечным пунктом проверки подлинности для облачной среды](../active-directory/develop/authentication-national-cloud.md#azure-ad-authentication-endpoints) (например,https://login.microsoft.com«для глобальной Azure»), а также заменив * \<>-идентификатором* **каталога (арендатора),** в котором была создана регистрация приложения. Это значение используется для перенаправления пользователей к правильному арендатору Azure AD, а также для загрузки соответствующих метаданных для определения соответствующих ключей подписи маркеров и, например, значения претензий эмитента токенов. Раздел `/v2.0` может быть опущен для приложений с использованием AAD v1. |
    |Секрет клиента (необязательно)| Используйте секрет клиента, который вы создали при регистрации приложения.|
    |Разрешено токен аудитории| Если это приложение для облака или сервера, и вы хотите разрешить маркеры аутентификации из веб-приложения, добавьте **URI Application ID** в веб-приложении здесь. Настроенный **идентификатор клиента** *всегда* неявно считается разрешенной аудиторией. |

2. Нажмите кнопку **ОК**, а затем нажмите кнопку **Сохранить**.

Теперь вы готовы использовать Active Directory Azure для проверки подлинности в приложении App Service.

## <a name="configure-a-native-client-application"></a>Настройка собственного клиентского приложения

Вы можете зарегистрировать нативных клиентов, чтобы позволить аутентификации веб-API, размещенным в вашем приложении, с помощью клиентской библиотеки, такой как **Библиотека подлинности Active Directory.**

1. На [портале Azure]выберите**Регистрацию** >  **приложения Active Directory** > **Новая регистрация.**
1. На странице **регистрации введите** **имя** для регистрации приложения.
1. В **Перенаправлении URI**выберите **публичного клиента (мобильный & рабочий стол)** и введите URL. `<app-url>/.auth/login/aad/callback` Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`.

    > [!NOTE]
    > Для приложения Microsoft Store используйте [пакет SID](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) в качестве URI.
1. Нажмите кнопку **создания**.
1. После создания регистрации приложения копируйте значение **идентификатора приложения (клиента).**
1. Выберите **разрешения** > API**Добавление разрешения** > **My API.**
1. Выберите регистрацию приложения, созданную ранее для приложения Службы App. Если вы не видите регистрацию приложения, убедитесь, что вы добавили **user_impersonation** область в [создание регистрации приложения в Azure AD для приложения App Service.](#register)
1. Выберите **user_impersonation,** а затем выберите **Разрешения Добавления.**

Теперь вы настроили приложение для наиболее родных клиентов, которое может получить доступ к приложению Службы app от имени пользователя.

## <a name="next-steps"></a><a name="related-content"> </a>Дальнейшие действия

[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- URLs. -->

[Портал Azure]: https://portal.azure.com/
