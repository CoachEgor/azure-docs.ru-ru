---
title: Настройка аутентификации Azure Active Directory в Службе приложений Azure
description: Узнайте, как настроить проверку подлинности Azure Active Directory для приложения службы приложений.
author: cephalin
services: app-service
documentationcenter: ''
manager: gwallace
editor: ''
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.service: app-service
ms.workload: web,mobile
ms.tgt_pltfrm: na
ms.topic: article
ms.date: 09/03/2019
ms.author: cephalin
ms.custom: fasttrack-edit
ms.openlocfilehash: 6812f99d8433ef318eca37eb2615d43f4749e944
ms.sourcegitcommit: cf36df8406d94c7b7b78a3aabc8c0b163226e1bc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2019
ms.locfileid: "73886189"
---
# <a name="configure-your-app-service-app-to-use-azure-ad-login"></a>Настройка приложения службы приложений для использования имени входа Azure AD

[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этой статье показано, как настроить службу приложений Azure для использования Azure Active Directory (Azure AD) в качестве поставщика проверки подлинности.

> [!NOTE]
> В настоящее время служба приложений Azure и функции Azure поддерживаются только в Azure AD версии 1.0. Они не поддерживаются [платформой Microsoft Identity Platform версии 2.0](https://docs.microsoft.com/azure/active-directory/develop/v2-overview), которая включает библиотеки проверки подлинности Майкрософт (MSAL).

При настройке приложения и проверки подлинности следуйте приведенным ниже рекомендациям.

- Предоставьте каждому приложению службы приложений свои разрешения и согласие.
- Настройте каждое приложение службы приложений с собственной регистрацией.
- Избегайте общего доступа к разрешениям между средами с помощью отдельных регистраций приложений для отдельных слотов развертывания. При тестировании нового кода эта практика может помочь предотвратить влияние проблем в рабочем приложении.

## <a name="express"> </a>Настройка с помощью стандартных параметров

1. В [портал Azure]перейдите к приложению службы приложений.
1. В левой области выберите **параметры** > **Проверка подлинности и авторизация** и убедитесь, что **Проверка подлинности службы приложений** **включена.**
1. Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Экспресс**.
1. Нажмите кнопку **ОК**, чтобы зарегистрировать приложение службы приложений в Azure Active Directory. Будет создана регистрация нового приложения.

   Если вы хотите вместо этого выбрать существующую регистрацию приложения:

   1. Выберите **выбрать существующее приложение** , а затем найдите имя ранее созданной регистрации приложения в клиенте.
   1. Выберите регистрацию приложения и нажмите кнопку **ОК**.
   1. Затем нажмите кнопку **ОК** на странице параметров Azure Active Directory.

   По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает разрешенный доступ к содержимому и API-интерфейсам сайта. Авторизация пользователей должна быть включена в код приложения.
1. Используемых Чтобы ограничить доступ к приложениям только для пользователей, прошедших проверку подлинности Azure Active Directory, задайте **действие, которое будет выполняться, если запрос не прошел проверку подлинности** для **входа с помощью Azure Active Directory**. При установке этой функции приложению требуется проверка подлинности всех запросов. Он также перенаправляет все непроверенные на Azure Active Directory для проверки подлинности.

    > [!CAUTION]
    > Таким образом, ограниченный доступ применяется ко всем вызовам приложения, что может быть нежелательно для приложений, имеющих общедоступную домашнюю страницу, как во многих одностраничных приложениях. Для таких приложений рекомендуется **Разрешить анонимные запросы (без действия)** , при этом приложение вручную запускает вход. Дополнительные сведения см. в разделе [поток проверки подлинности](overview-authentication-authorization.md#authentication-flow).
1. Щелкните **Сохранить**.

## <a name="advanced"> </a>Настройка с помощью дополнительных параметров

Параметры приложения можно настроить вручную, если вы хотите использовать клиент Azure AD, отличный от того, который вы используете для входа в Azure. Для выполнения этой пользовательской конфигурации необходимо выполнить следующие действия.

1. Создайте регистрацию в Azure AD.
1. Укажите некоторые сведения о регистрации в службе приложений.

### <a name="register"> </a>Создание регистрации приложения в Azure AD для приложения службы приложений

При настройке приложения службы приложений вам потребуются следующие сведения:

- идентификатор клиента
- Tenant ID
- Секрет клиента (необязательно)
- URI идентификатора приложения

Выполните следующие действия:

1. Войдите в [портал Azure] и перейдите в приложение службы приложений. Обратите внимание на **URL-адрес**приложения. Вы будете использовать его для настройки регистрации приложения Azure Active Directory.
1. Последовательно выберите элементы **Azure Active Directory** > **Регистрация приложений** > **Новая регистрация**.
1. На странице **Регистрация приложения** введите **имя** для регистрации приложения.
1. В поле **URI перенаправления**выберите **веб** и введите URL-адрес приложения службы приложений и добавьте путь `/.auth/login/aad/callback`. Пример: `https://contoso.azurewebsites.net/.auth/login/aad/callback`. 
1. Нажмите кнопку **Создать**.
1. После создания регистрации приложения скопируйте **идентификатор приложения (клиента)** и **идентификатор каталога (клиента)** для последующего использования.
1. Выберите **фирменную символику**. В поле **URL-адрес домашней страницы**введите URL-адрес приложения службы приложений и нажмите кнопку **сохранить**.
1. Выберите **предоставить** **набор** > API. Вставьте URL-адрес приложения службы приложений и нажмите кнопку **сохранить**.

   > [!NOTE]
   > Это значение представляет собой **URI идентификатора приложения** для регистрации приложения. Если веб-приложению требуется доступ к API в облаке, вам потребуется **URI идентификатора приложения** веб-приложения при настройке ресурса облачной службы приложений. Это можно использовать, например, если вы хотите, чтобы облачная служба явно предоставляла доступ к веб-приложению.

1. Нажмите **Добавить группу**.
   1. В списке **имя области**введите *user_impersonation*.
   1. В текстовых полях введите имя и описание области разрешения, которые пользователи должны видеть на странице согласие. Например, введите *доступ к моему приложению*. 
   1. Выберите **Добавить область**.
1. Используемых Чтобы создать секрет клиента, выберите **сертификаты & секреты** > **новый секрет клиента** > **добавить**. Скопируйте значение секрета клиента, показанное на странице. Он больше не будет отображаться.
1. Используемых Чтобы добавить несколько **URL-адресов ответа**, выберите **Проверка подлинности**.

### <a name="secrets"> </a>Добавление сведений об Azure Active Directory в приложение службы приложений

1. В [портал Azure]перейдите к приложению службы приложений. 
1. В левой области выберите **параметры > проверка подлинности и авторизация** и убедитесь, что **Проверка подлинности службы приложений** **включена.**
1. Используемых По умолчанию проверка подлинности службы приложений разрешает доступ к приложению без проверки подлинности. Чтобы применить проверку подлинности пользователя, задайте **действие, которое будет выполняться, если запрос не прошел проверку подлинности** для **входа с помощью Azure Active Directory**.
1. В разделе Поставщики проверки подлинности выберите **Azure Active Directory**.
1. В **режиме управления**выберите **Дополнительно** и настройте проверку подлинности службы приложений в соответствии со следующей таблицей.

    |Поле|ОПИСАНИЕ|
    |-|-|
    |идентификатор клиента| Используйте **идентификатор приложения (клиента)** для регистрации приложения. |
    |Идентификатор издателя| Используйте `https://login.microsoftonline.com/<tenant-id>`и замените *\<идентификатор клиента >* на **идентификатор каталога (клиента)** регистрации приложения. |
    |Секрет клиента (необязательно)| Используйте секрет клиента, созданный при регистрации приложения.|
    |Разрешенные аудитории маркеров| Если это облачное или серверное приложение, и вы хотите разрешить токены проверки подлинности из веб-приложения, добавьте **URI идентификатора приложения** веб-приложения здесь. |

    > [!NOTE]
    > Настроенный **идентификатор клиента** *всегда* неявно считается разрешенной аудиторией независимо от того, как вы настроили **Разрешенные аудитории маркеров**.
1. Нажмите кнопку **ОК**, а затем нажмите кнопку **Сохранить**.

Теперь вы можете использовать Azure Active Directory для проверки подлинности в приложении службы приложений.

## <a name="configure-a-native-client-application"></a>Настройка собственного клиентского приложения

Можно зарегистрировать собственные клиенты, чтобы разрешить проверку подлинности с помощью клиентской библиотеки, например **Библиотека проверки подлинности Active Directory**.

1. В [портал Azure]выберите **Active Directory** > **Регистрация приложений** > **Новая регистрация**.
1. На странице **Регистрация приложения** введите **имя** для регистрации приложения.
1. В поле **URI перенаправления**выберите **общедоступный клиент (мобильный & Рабочий стол)** и введите URL-адрес приложения службы приложений и добавьте путь `/.auth/login/aad/callback`. Пример: `https://contoso.azurewebsites.net/.auth/login/aad/callback`.
1. Нажмите кнопку **Создать**.

    > [!NOTE]
    > Для приложения Windows используйте [идентификатор безопасности пакета](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) в качестве универсального кода ресурса (URI).
1. После создания регистрации приложения скопируйте значение **идентификатора Application (Client)** .
1. Выберите **разрешения API** > **Добавить разрешение** > **моих API**.
1. Выберите регистрацию приложения, созданную ранее для приложения службы приложений. Если регистрация приложения не отображается, убедитесь, что вы добавили область **user_impersonation** в разделе [Создание регистрации приложения в Azure AD для приложения службы приложений](#register).
1. Выберите **user_impersonation**и нажмите кнопку **Добавить разрешения**.

Теперь вы настроили собственное клиентское приложение, у которого есть доступ к вашему приложению службы приложений.

## <a name="related-content"> </a>Дальнейшие действия

[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- Images. -->

[0]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-url.png
[1]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app_registration.png
[2]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-create.png
[3]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-appidurl.png
[4]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-replyurl.png
[5]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints.png
[6]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints-fedmetadataxml.png
[7]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth.png
[8]: ./media/configure-authentication-provider-aad/app-service-webapp-auth-config.png



<!-- URLs. -->

[портал Azure]: https://portal.azure.com/
[alternative method]:#advanced
