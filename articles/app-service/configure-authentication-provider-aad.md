---
title: Настройка проверки подлинности Azure AD
description: Узнайте, как настроить проверку подлинности Azure Active Directory в качестве поставщика удостоверений для службы приложений или приложения функций Azure.
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.topic: article
ms.date: 04/14/2020
ms.custom: seodec18, fasttrack-edit, has-adal-ref
ms.openlocfilehash: 60a5d50b511fc9db02daa9b7e74eedfe40eeb7a5
ms.sourcegitcommit: 50ef5c2798da04cf746181fbfa3253fca366feaa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2020
ms.locfileid: "82609907"
---
# <a name="configure-your-app-service-or-azure-functions-app-to-use-azure-ad-login"></a>Настройка службы приложений или приложения "функции Azure" для использования имени входа Azure AD

[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этой статье показано, как настроить службу приложений Azure или функцию Azure для использования Azure Active Directory (Azure AD) в качестве поставщика проверки подлинности.

> [!NOTE]
> Последовательность быстрых установок настраивает регистрацию приложения AAD v1. Если вы хотите использовать [Azure Active Directory v 2.0](../active-directory/develop/v2-overview.md) (включая [MSAL](../active-directory/develop/msal-overview.md)), следуйте [инструкциям по расширенной настройке](#advanced).

При настройке приложения и проверки подлинности следуйте приведенным ниже рекомендациям.

- Предоставьте каждому приложению службы приложений свои разрешения и согласие.
- Настройте каждое приложение службы приложений с собственной регистрацией.
- Избегайте общего доступа к разрешениям между средами с помощью отдельных регистраций приложений для отдельных слотов развертывания. При тестировании нового кода эта практика может помочь предотвратить влияние проблем в рабочем приложении.

> [!NOTE]
> В настоящее время эта функция недоступна в плане потребления Linux для функций Azure.

## <a name="configure-with-express-settings"></a><a name="express"> </a>Настройка с помощью стандартных параметров

> [!NOTE]
> Параметр **Express** недоступен для государственных облаков.

1. В [портал Azure]найдите и выберите **службы приложений**, а затем выберите свое приложение.
2. В левой области навигации выберите **Проверка подлинности/авторизация** > **в**.
3. Выберите **Azure Active Directory** > **Express**.

   Если вы хотите вместо этого выбрать существующую регистрацию приложения:

   1. Выберите **выбрать существующее приложение AD**, а затем щелкните **Azure AD App**.
   2. Выберите существующую регистрацию приложения и нажмите кнопку **ОК**.

3. Нажмите кнопку **ОК**, чтобы зарегистрировать приложение службы приложений в Azure Active Directory. Будет создана регистрация нового приложения.

    ![Стандартные параметры в Azure Active Directory](./media/configure-authentication-provider-aad/express-settings.png)

4. Используемых По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает разрешенный доступ к содержимому и API-интерфейсам сайта. Авторизация пользователей должна быть включена в код приложения. Чтобы ограничить доступ к приложениям только для пользователей, прошедших проверку подлинности Azure Active Directory, задайте **действие, которое будет выполняться, если запрос не прошел проверку подлинности** для **входа с помощью Azure Active Directory**. При установке этой функции приложению требуется проверка подлинности всех запросов. Он также перенаправляет все непроверенные на Azure Active Directory для проверки подлинности.

    > [!CAUTION]
    > Таким образом, ограниченный доступ применяется ко всем вызовам приложения, что может быть нежелательно для приложений, имеющих общедоступную домашнюю страницу, как во многих одностраничных приложениях. Для таких приложений рекомендуется **Разрешить анонимные запросы (без действия)** , при этом приложение вручную запускает вход. Дополнительные сведения см. в разделе [поток проверки подлинности](overview-authentication-authorization.md#authentication-flow).
5. Щелкните **Сохранить**.

## <a name="configure-with-advanced-settings"></a><a name="advanced"> </a>Настройка с помощью дополнительных параметров

Вы можете настроить параметры приложения вручную, если хотите использовать регистрацию приложения из другого клиента Azure AD. Для выполнения этой пользовательской конфигурации выполните следующие действия.

1. Создайте регистрацию в Azure AD.
2. Укажите некоторые сведения о регистрации в службе приложений.

### <a name="create-an-app-registration-in-azure-ad-for-your-app-service-app"></a><a name="register"> </a>Создание регистрации приложения в Azure AD для приложения службы приложений

При настройке приложения службы приложений вам потребуются следующие сведения:

- Идентификатор клиента
- Tenant ID
- Секрет клиента (необязательно)
- URI идентификатора приложения

Выполните следующие действия:

1. Войдите в [портал Azure], найдите и выберите **службы приложений**, а затем выберите свое приложение. Обратите внимание на **URL-адрес**приложения. Вы будете использовать его для настройки регистрации приложения Azure Active Directory.
1. Выберите **Azure Active Directory** > **Регистрация приложений** > **новую регистрацию**.
1. На странице **Регистрация приложения** введите **имя** для регистрации приложения.
1. В окне **URI перенаправления**выберите **веб** и `<app-url>/.auth/login/aad/callback`введите. Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`.
1. Щелкните **Создать**.
1. После создания регистрации приложения скопируйте **идентификатор приложения (клиента)** и **идентификатор каталога (клиента)** для последующего использования.
1. Выберите **Проверка подлинности**. В разделе " **неявное предоставление**" Включите **маркеры идентификации** , чтобы разрешить OpenID Connect подключать пользователей из службы приложений.
1. Используемых Выберите **фирменную символику**. В поле **URL-адрес домашней страницы**введите URL-адрес приложения службы приложений и нажмите кнопку **сохранить**.
1. Выберите **предоставить** > **набор**API. В приложении с одним клиентом вставьте URL-адрес приложения службы приложений и выберите **сохранить** и для приложения с несколькими клиентами, вставьте URL-адрес, который основан на одном из проверенных доменов клиента, и нажмите кнопку **сохранить**.

   > [!NOTE]
   > Это значение представляет собой **URI идентификатора приложения** для регистрации приложения. Если веб-приложению требуется доступ к API в облаке, вам потребуется **URI идентификатора приложения** веб-приложения при настройке ресурса облачной службы приложений. Это можно использовать, например, если вы хотите, чтобы облачная служба явно предоставляла доступ к веб-приложению.

1. Выберите **Добавить область**.
   1. В списке **имя области**введите *user_impersonation*.
   1. В текстовых полях введите имя и описание области разрешения, которые пользователи должны видеть на странице согласие. Например, введите *доступ к моему приложению*.
   1. Выберите **Добавить область**.
1. Используемых Чтобы создать секрет клиента, выберите **Сертификаты & секреты** > **новый секрет** > клиента**Добавить**. Скопируйте значение секрета клиента, показанное на странице. Он больше не будет отображаться.
1. Используемых Чтобы добавить несколько **URL-адресов ответа**, выберите **Проверка подлинности**.

### <a name="enable-azure-active-directory-in-your-app-service-app"></a><a name="secrets"> </a>Включение Azure Active Directory в приложении службы приложений

1. В [портал Azure]найдите и выберите **службы приложений**, а затем выберите свое приложение.
1. В левой области в разделе **Параметры**выберите **Проверка подлинности/авторизация** > **вкл**.
1. Используемых По умолчанию проверка подлинности службы приложений разрешает доступ к приложению без проверки подлинности. Чтобы применить проверку подлинности пользователя, задайте **действие, которое будет выполняться, если запрос не прошел проверку подлинности** для **входа с помощью Azure Active Directory**.
1. В разделе **Поставщики проверки подлинности** выберите **Azure Active Directory**.
1. В **режиме управления**выберите **Дополнительно** и настройте проверку подлинности службы приложений в соответствии со следующей таблицей.

    |Поле|Описание|
    |-|-|
    |Идентификатор клиента| Используйте **идентификатор приложения (клиента)** для регистрации приложения. |
    |URL-адрес издателя| Используйте `<authentication-endpoint>/<tenant-id>/v2.0`и замените * \<>проверки подлинности конечной* точкой [конечной точкой проверки подлинности для облачной среды](../active-directory/develop/authentication-national-cloud.md#azure-ad-authentication-endpoints) (https://login.microsoft.comнапример, "" для глобального Azure), а также заменив * \<идентификатор клиента>* идентификатором **каталога (клиента)** , в котором была создана регистрация приложения. Это значение используется для перенаправления пользователей в правильный клиент Azure AD, а также для скачивания соответствующих метаданных, чтобы определить соответствующие ключи подписывания маркера и значение утверждения поставщика маркеров. Например, `/v2.0` Раздел можно опустить для приложений, использующих AAD v1. |
    |Секрет клиента (необязательно)| Используйте секрет клиента, созданный при регистрации приложения.|
    |Разрешенные аудитории маркеров| Если это облачное или серверное приложение, и вы хотите разрешить токены проверки подлинности из веб-приложения, добавьте **URI идентификатора приложения** веб-приложения здесь. Настроенный **идентификатор клиента** *всегда* неявно считается разрешенной аудиторией. |

2. Нажмите кнопку **ОК**, а затем нажмите кнопку **Сохранить**.

Теперь вы можете использовать Azure Active Directory для проверки подлинности в приложении службы приложений.

## <a name="configure-a-native-client-application"></a>Настройка собственного клиентского приложения

Можно зарегистрировать собственные клиенты, чтобы разрешить проверку подлинности в веб-API, размещенном в приложении, с помощью клиентской библиотеки, такой как **Библиотека проверки подлинности Active Directory**.

1. В [портал Azure]выберите **Active Directory** > **Регистрация приложений** > **Новая регистрация**.
1. На странице **Регистрация приложения** введите **имя** для регистрации приложения.
1. В поле **URI перенаправления**выберите **общедоступный клиент (мобильный & Рабочий стол)** и введите URL-адрес `<app-url>/.auth/login/aad/callback`. Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`.

    > [!NOTE]
    > Для Microsoft Store приложения используйте [идентификатор безопасности пакета](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) в качестве универсального кода ресурса (URI).
1. Щелкните **Создать**.
1. После создания регистрации приложения скопируйте значение **идентификатора Application (Client)**.
1. Выбор **разрешений** > **API Добавление разрешения** > **My API**.
1. Выберите регистрацию приложения, созданную ранее для приложения службы приложений. Если регистрация приложения не отображается, убедитесь, что вы добавили область **user_impersonation** в разделе [Создание регистрации приложения в Azure AD для приложения службы приложений](#register).
1. Выберите **user_impersonation**и нажмите кнопку **Добавить разрешения**.

Теперь вы настроили собственное клиентское приложение, которое может получать доступ к приложению службы приложений от имени пользователя.

## <a name="next-steps"></a><a name="related-content"> </a>Дальнейшие действия

[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- URLs. -->

[Портал Azure]: https://portal.azure.com/
