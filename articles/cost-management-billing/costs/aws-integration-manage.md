---
title: Управление затратами и использованием AWS в службе "Управление затратами Azure"
description: Эта статья поможет вам понять, как использовать анализ затрат и бюджеты в "Управлении затратами" для управления затратами и использованием AWS.
author: bandersmsft
ms.author: banders
ms.date: 10/16/2020
ms.topic: how-to
ms.service: cost-management-billing
ms.subservice: cost-management
ms.reviewer: matrive
ms.custom: ''
ms.openlocfilehash: 5fed70ccdbebbd178412c416f37c2e9001a81f38
ms.sourcegitcommit: dbe434f45f9d0f9d298076bf8c08672ceca416c6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2020
ms.locfileid: "92148967"
---
# <a name="manage-aws-costs-and-usage-in-azure"></a>Управление затратами и использованием AWS в Azure

После установки и настройки интеграции отчетов о затратах и использовании AWS для службы "Управление затратами Azure" можно приступить к управлению затратами и использованием AWS. Эта статья поможет вам понять, как использовать анализ затрат и бюджеты в "Управлении затратами" для управления затратами и использованием AWS.

Если вы еще не настроили интеграцию, см. статью [Set up and configure AWS Usage report integration](aws-integration-set-up-configure.md) (Установка и настройка интеграции отчетов об использовании AWS).

_Перед началом_ : если вы не знакомы с анализом затрат, см. [Краткое руководство. Изучение и анализ затрат с помощью функции анализа затрат](quick-acm-cost-analysis.md). Если вы не знакомы с бюджетами в Azure, см. [Tutorial: Create and manage Azure budgets](tutorial-acm-create-budgets.md) (Учебник. Создание бюджетов Azure и управление ими).

## <a name="view-aws-costs-in-cost-analysis"></a>Просмотр затрат AWS в анализе затрат

Затраты на AWS доступны в анализе затрат в следующих областях:

- связанные учетные записи AWS в группе управления;
- затраты на связанную учетную запись AWS;
- затраты на консолидированную учетную запись AWS.

В следующих разделах описывается использование областей для отображения данных о затратах и использовании для каждой из них.

### <a name="view-aws-linked-accounts-under-a-management-group"></a>Просмотр связанных учетных записей AWS в группе управления

Просмотр затрат с помощью области группы управления — это единственный способ просмотреть совокупные затраты, поступающие из разных подписок Azure и связанных учетных записей AWS. Использование группы управления обеспечивает представление в нескольких облаках для совместного просмотра затрат из Azure и AWS.

В окне анализа затрат откройте средство выбора области и выберите группу управления, в которой находятся связанные учетные записи AWS. Ниже приведен пример образа на портале Azure:

:::image type="content" source="./media/aws-integration-manage/select-scope01.png" alt-text="Пример представления &quot;Выбор области&quot; со связанными учетными записями в группе управления" :::

Ниже приведен пример, показывающий затраты группы управления в анализе затрат, сгруппированных по поставщику (Azure и AWS).

:::image type="content" source="./media/aws-integration-manage/cost-analysis-aws-azure.png" alt-text="Пример, демонстрирующий затраты Azure и AWS за квартал в анализе затрат" lightbox="./media/aws-integration-manage/cost-analysis-aws-azure.png" :::

> [!NOTE]
> В настоящее время группы управления не поддерживаются для клиентов с Клиентским соглашением Майкрософт (MCA). Клиенты с MCA могут создать соединитель и просматривать свои данные AWS. Однако они не могут одновременно просматривать свои расходы на Azure и AWS в группе управления.

### <a name="view-aws-linked-account-costs"></a>Просмотр затрат на связанную учетную запись AWS

Чтобы просмотреть затраты на связанную учетную запись AWS, откройте средство выбора области и выберите связанную учетную запись AWS. Обратите внимание, что связанные учетные записи связаны с группой управления, как определено в соединителе AWS.

Ниже приведен пример, в котором показано, как выбрать область связанной учетной записи AWS.

:::image type="content" source="./media/aws-integration-manage/select-scope02.png" alt-text="Пример представления &quot;Выбор области&quot; со связанными учетными записями AWS" :::

### <a name="view-aws-consolidated-account-costs"></a>Просмотр затрат на консолидированную учетную запись AWS

Чтобы просмотреть затраты на консолидированную учетную запись AWS, откройте средство выбора области и выберите консолидированную учетную запись AWS. Ниже приведен пример, в котором показано, как выбрать область консолидированной учетной записи AWS.

:::image type="content" source="./media/aws-integration-manage/select-scope03.png" alt-text="Пример представления &quot;Выбор области&quot; с консолидированными учетными записями" :::

Эта область предоставляет сводное представление всех связанных учетных записей AWS, связанных с консолидированной учетной записью AWS. Ниже приведен пример, в котором показаны затраты на консолидированную учетную запись AWS, сгруппированную по имени службы.

:::image type="content" source="./media/aws-integration-manage/cost-analysis-aws-consolidated.png" alt-text="Пример, демонстрирующий консолидированные затраты AWS в анализе затрат" lightbox="./media/aws-integration-manage/cost-analysis-aws-consolidated.png" :::

### <a name="dimensions-available-for-filtering-and-grouping"></a>Измерения, доступные для фильтрации и группирования

В следующей таблице описаны измерения, доступные для группирования и фильтрации в анализе затрат.

| Измерение | Заголовок Amazon CUR | Области действия | Комментарии |
| --- | --- | --- | --- |
| Зона доступности | lineitem/AvailabilityZone | All |   |
| Расположение | Продукт или регион | Все |   |
| средство измерения. |   | All |   |
| Категория измерения | lineItem/ProductCode | All |   |
| Подкатегория единицы измерения | lineitem/UsageType | All |   |
| Операция | lineItem/Operation | All |   |
| Ресурс | lineItem/ResourceId | All |   |
| Тип ресурса | product/instanceType | Все | Если product/instanceType имеет значение "null", используется lineItem/UsageType. |
| ResourceGuid | Недоступно | Все | Уникальный идентификатор средства измерения Azure. |
| Имя службы | product/ProductName | Все | Если product/ProductName имеет значение "null", используется lineItem/ProductCode. |
| Уровень служб |   |   |   |
| Идентификатор подписки | lineItem/UsageAccountId | Консолидированная учетная запись и группа управления |   |
| имя подписки; | Недоступно | Консолидированная учетная запись и группа управления | Имена учетных записей собираются с помощью API организации AWS. |
| Тег | resourceTags | Все | Префикс _user:_ удаляется из пользовательских тегов, чтобы разрешить теги между облаками. Префикс _aws:_ остается неизменным. |
| Идентификатор учетной записи выставления счетов | bill/PayerAccountId | группа управления; |   |
| Имя учетной записи выставления счетов | Недоступно | группа управления; | Имена учетных записей собираются с помощью API организации AWS. |
| Поставщик | Недоступно | группа управления; | AWS, либо Azure. |

## <a name="set-budgets-on-aws-scopes"></a>Определение размера бюджетов для областей AWS

Используйте бюджеты для упреждающего управления затратами и контроля использования в организации. Бюджеты задаются на консолидированной учетной записи AWS и связанной учетной записи AWS. Ниже приведен пример бюджетов для консолидированной учетной записи AWS, отображаемой в разделе "Управление затратами":

:::image type="content" source="./media/aws-integration-manage/budgets-aws-consolidated-account01.png" alt-text="Пример отображения бюджетов для консолидированной учетной записи AWS" :::

## <a name="aws-data-collection-process"></a>Процесс сбора данных AWS

После настройки соединителя AWS запускаются процессы сбора данных и обнаружения. Получение всех данных об использовании может занять несколько часов. Длительность зависит от следующих факторов:

- Время, необходимое для обработки файлов CUR в контейнере AWS S3.
- Время, необходимое для создания областей консолидированной учетной записи AWS и связанной учетной записи AWS.
- Время и частота записи AWS файлов Отчета о затратах и использовании в контейнер S3.

## <a name="aws-integration-pricing"></a>Цены на интеграцию с AWS

Каждый соединитель AWS получает бесплатную пробную версию на 90 дней.

Цена по прейскуранту составляет 1 % месячной стоимости AWS. За каждый месяц взимается плата на основе затрат за прошлый месяц.

Доступ к API AWS может повлечь дополнительные затраты на AWS.

## <a name="aws-integration-limitations"></a>Ограничения интеграции AWS

- Бюджеты в Управлении затратами не поддерживают группы управления с несколькими валютами. Для групп управления с несколькими валютами оценка бюджета отображаться не будет. Если при создании бюджета вы выбираете группу управления с несколькими валютами, отображается сообщение об ошибке.
- Облачные соединители не поддерживают AWS GovCloud (US), AWS Gov, или AWS China.
- В службе "Управление затратами" отображаются только _затраты на использование_  AWS. Налоги, поддержка, возмещение, RI, кредиты и другие типы оплаты пока не поддерживаются.

## <a name="troubleshooting-aws-integration"></a>Устранение неполадок с интеграцией AWS

Для устранения распространенных проблем используйте следующие сведения об устранении неполадок.

### <a name="no-permission-to-aws-linked-accounts"></a>Нет разрешения для связанных учетных записей AWS

**Код ошибки:** _Не авторизовано_

Есть два способа получить разрешения на доступ к затратам на связанные учетные записи AWS:

- Получите доступ к группе управления, у которой есть связанные учетные записи AWS.
- Предоставьте кому-либо разрешение на доступ к связанной учетной записи AWS.

По умолчанию создателем соединителя AWS является владелец всех объектов, созданных соединителем. Включая консолидированную учетную запись AWS и связанную учетную запись AWS.

Чтобы проверить параметры соединителя, потребуется по крайней мере роль участника, поскольку читатель не имеет прав на проверку параметров соединителя.

### <a name="collection-failed-with-assumerole"></a>Сбой сбора с AssumeRole

**Код ошибки:** _FailedToAssumeRole_

Эта ошибка означает, что служба "Управление затратами" не может вызвать API AWS AssumeRole. Эта проблема может возникать из-за проблемы с определением роли. Убедитесь, что выполнены следующие условия.

- Внешний идентификатор совпадает с именем в определении роли и в определении соединителя.
- Тип роли установлен на **другую учетную запись AWS, принадлежащую вам или сторонним лицам.**
- Флажок с пункта **Требовать MFA** снят.
- Доверенная учетная запись AWS в роли AWS — _432263259397_.

### <a name="collection-failed-with-access-denied---cur-report-definitions"></a>Не удалось выполнить сбор из-за отказа в доступе — Определение отчета CUR

**Код ошибки:** _AccessDeniedReportDefinitions_

Эта ошибка означает, что служба "Управление затратами" не может просматривать определения отчетов о затратах и использовании. Это разрешение используется для проверки того, что значение CUR определено службой "Управление затратами Azure" как ожидаемое. См. раздел [Create a Cost and Usage report in AWS](aws-integration-set-up-configure.md#create-a-cost-and-usage-report-in-aws) (Создание отчета о затратах и использовании в AWS).

### <a name="collection-failed-with-access-denied---list-reports"></a>Не удалось выполнить сбор из-за отказа в доступе — Список отчетов

**Код ошибки:** _AccessDeniedListReports_

Эта ошибка означает, что "Управление затратами" не может перечислить объект в контейнере S3, где находится CUR. Политика IAM AWS требует разрешения на контейнер и на объекты в контейнере. См. [Create a role and policy in AWS](aws-integration-set-up-configure.md#create-a-role-and-policy-in-aws) (Создание роли и политики в AWS).

### <a name="collection-failed-with-access-denied---download-report"></a>Не удалось выполнить сбор из-за отказа в доступе — Скачивание отчета

**Код ошибки:** _AccessDeniedDownloadReport_

Эта ошибка означает, что служба "Управление затратами" не может получить доступ к файлам, хранящимся в контейнере Amazon S3, и загружать их. Убедитесь, что политика AWS JSON, присоединенная к роли, похожа на пример, показанный в нижней части раздела [Create a role and policy in AWS](aws-integration-set-up-configure.md#create-a-role-and-policy-in-aws) (Создание роли и политики в AWS).

### <a name="collection-failed-since-we-did-not-find-the-cost-and-usage-report"></a>Произошел сбой сбора, так как не удалось найти отчет о затратах и использовании

**Код ошибки:** _FailedToFindReport_

Эта ошибка означает, что средство "Управление затратами" не может найти отчет о затратах и использовании, определенный в соединителе. Убедитесь, что он не удален, а политика AWS JSON, прикрепленная к роли, похожа на пример, показанный в нижней части раздела [Create a role and policy in AWS](aws-integration-set-up-configure.md#create-a-role-and-policy-in-aws) (Создание роли и политики в AWS).

### <a name="unable-to-create-or-verify-connector-due-to-cost-and-usage-report-definitions-mismatch"></a>Не удалось создать или проверить соединитель из-за несоответствия определений отчетов о затратах и использовании

**Код ошибки:** _ReportIsNotValid_

Эта ошибка связана с определением отчета о затратах и использовании AWS. Для этого отчета требуются определенные параметры. См. требования в разделе [Создание отчета о затратах и использовании в AWS](aws-integration-set-up-configure.md#create-a-cost-and-usage-report-in-aws).

### <a name="internal-error-when-creating-connector"></a>Внутренняя ошибка при создании соединителя

**Код ошибки:** _Создание соединителя — не удалось создать соединитель &lt;имя_соединителя&gt;. Причина: Внутренняя ошибка. Убедитесь, что свойства AWS указаны правильно._

Эта ошибка может возникнуть, если соединитель AWS и подписка находятся в разных группах управления. Соединитель AWS и подписка должны находиться в одной группе управления.

## <a name="next-steps"></a>Дальнейшие действия

- Если вы еще не настроили в среде Azure группы управления, см. [этот раздел](../../governance/management-groups/overview.md#initial-setup-of-management-groups).
