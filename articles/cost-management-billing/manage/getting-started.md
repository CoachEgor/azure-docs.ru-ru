---
title: Предотвращение и анализ непредвиденных расходов с помощью функции управления затратами и выставления счетов в Azure
description: Узнайте, как избежать непредвиденных расходов по счету Azure и использовать функции отслеживания расходов и управления для учетной записи Azure.
author: bandersmsft
ms.reviewer: amberb
tags: billing
ms.service: cost-management-billing
ms.topic: how-to
ms.date: 07/24/2020
ms.author: banders
ms.openlocfilehash: 1b63b0316b8314e4c5107ddd3f1d22c1d59cbb08
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87281809"
---
# <a name="prevent-unexpected-charges-with-azure-billing-and-cost-management"></a>Предотвращение непредвиденных расходов с помощью функции выставления счетов и управления затратами в Azure

При регистрации в Azure можно сделать несколько вещей, которые помогут вам получить более точное представление о своих расходах:

- Оцените затраты перед добавлением служб, используя [калькулятор цен](https://azure.microsoft.com/pricing/calculator/), прейскурант Azure или информацию, предоставляемую при добавлении служб на портале Azure.
- Отслеживайте расходы с помощью [бюджетов](../costs/tutorial-acm-create-budgets.md), [оповещений](../costs/cost-mgt-alerts-monitor-usage-spending.md) и [анализа затрат](../costs/quick-acm-cost-analysis.md).
- Проверяйте суммы, внесенные в ваш счет, сравнивая их с [файлами подробных сведений о потреблении](download-azure-invoice-daily-usage-date.md).
- Интегрируйте сведения о выставлении счетов и расходах в собственную систему отчетности, используя API [выставления счетов](https://docs.microsoft.com/rest/api/billing/) и [потребления](https://docs.microsoft.com/rest/api/consumption/).
- Применяйте дополнительные ресурсы и средства, доступные для подписок с Соглашением Enterprise (EA), поставщика облачных решений (CSP) или клиентов спонсорских предложений Azure.
- Используйте [бесплатно в течение 12 месяцев некоторые популярные службы Azure](create-free-services.md), которые предоставляются вместе с [бесплатной учетной записью Azure](https://azure.microsoft.com/free/). Помимо приведенных ниже рекомендаций, ознакомьтесь со статьей о [Avoid getting charged for your Azure free account](avoid-charges-free-account.md) (Как избежать выставления счетов для бесплатной учетной записи Azure).

Если вам нужно отменить подписку Azure, см. статью [Отмена подписки Azure](cancel-azure-subscription.md).

## <a name="get-estimated-costs-before-adding-azure-services"></a>Перед добавлением служб Azure узнайте их расчетную стоимость

Примените любой из следующих инструментов для оценки затрат на использование службы Azure.
- Калькулятор цен Azure
- Прейскурант Azure
- Портал Azure

На изображениях в следующих разделах показаны примеры цен в долларах США.

### <a name="estimate-cost-online-using-the-pricing-calculator"></a>Оцените затраты с помощью калькулятора цен

Воспользуйтесь [калькулятором цен](https://azure.microsoft.com/pricing/calculator/), чтобы примерно оценить ежемесячные расходы на службы, которые вы планируете добавить. Вы можете получить оценку в местной валюте, изменив настройки.

![Снимок экрана: меню калькулятора цен](./media/getting-started/pricing-calc.png)

Вы можете просмотреть оценку затрат для любой собственной службы Azure. Например, на следующем снимке экрана стоимость часов вычислений виртуальной машины Windows A1 оценивается в 66,96 долл. США в месяц, если она будет работать постоянно:

![Снимок экрана калькулятора цен, показывающий предполагаемую стоимость виртуальной машины Windows A1 в месяц](./media/getting-started/pricing-calcvm.png)

Дополнительные сведения см. на странице [Вопросы и ответы о ценах на Azure](https://azure.microsoft.com/pricing/faq/). Если вы хотите обратиться к продавцу Azure, позвоните по номеру телефона, указанному в верхней части страницы вопросов и ответов.

### <a name="view-and-download-azure-price-sheet"></a>Просмотр и скачивание прейскуранта Azure

Если вы используете Azure на условиях Соглашения Enterprise (EA) или клиентского соглашения Майкрософт, вам доступен для просмотра и скачивания прейскурант по учетной записи Azure. Этот прейскурант в формате файла Excel содержит цены на все службы Azure. Дополнительные сведения см. в статье [о просмотре и скачивании сведений о ценах на Azure](ea-pricing.md).

### <a name="review-estimated-costs-in-the-azure-portal"></a>Просмотр предполагаемых затрат на портале Azure

Вы можете просмотреть оценку ежемесячных затрат во время добавления службы на портале Azure. Например, если выбрать размер виртуальной машины Windows, то отобразится расчетная месячная стоимость часов вычислений:

![Пример: виртуальная машина Windows A1 с предполагаемыми затратами в месяц](./media/getting-started/vm-size-cost.png)

## <a name="monitor-costs-when-using-azure-services"></a>Отслеживание затрат при использовании служб Azure
Отслеживать затраты можно с помощью следующих средств:

- Оповещения о бюджете и затратах
- Анализ затрат

### <a name="track-costs-with-budgets-and-cost-alerts"></a>Отслеживание расходов с помощью оповещений о бюджете и затратах

Создавайте [бюджеты](../costs/tutorial-acm-create-budgets.md), чтобы управлять затратами, а также [оповещения](../costs/cost-mgt-alerts-monitor-usage-spending.md), которые автоматически уведомляют заинтересованных лиц о нетипичных и (или) чрезмерных затратах.

### <a name="explore-and-analyze-costs-with-cost-analysis"></a><a name="costs"></a> Изучение и анализ затрат с помощью функции анализа затрат

После запуска служб Azure регулярно проверяйте затраты на Azure. Вы можете применить анализ затрат, чтобы разобраться в соотношении затрат и потребления ресурсов Azure.

1. Перейдите к разделу [Управление затратами + выставление счетов](https://portal.azure.com/#blade/Microsoft_Azure_Billing/ModernBillingMenuBlade) на портале Azure.

2. Щелкните **Анализ затрат** в левой части экрана, чтобы просмотреть разбивку текущих затрат по нескольким критериям, например по службам, расположениям и подпискам. Данные отобразятся в течение 24 часов после добавления службы или совершения покупки. По умолчанию в разделе анализа затрат отображаются затраты за текущую область. Например, на следующем снимке экрана отображаются затраты по учетной записи выставления счетов Contoso. Изменять области для анализа затрат можно с помощью меню "Область". Подробнее: [основные сведения об областях и работе с ними](../costs/understand-work-scopes.md#scopes).

    ![Снимок экрана представления "Анализ стоимости" на портале Azure](./media/getting-started/cost-analysis.png)

4. Вы можете применять фильтры по разным свойствам, например по тегам, типу ресурсов и периоду времени. Щелкните **Добавить фильтр** и выберите нужные значения, чтобы создать новый фильтр по свойству. Щелкните **Экспортировать**, чтобы экспортировать текущее представление в файл данных с разделителями-запятыми (CSV).

5. Также вы можете щелкнуть любую метку на диаграмме, чтобы увидеть историю ежедневных затрат по этой метке. Например: На следующем снимке экрана при щелчке по виртуальным машинам отображаются ежедневные затраты на работу виртуальных машин.

    ![Снимок экрана представления истории затрат на портале Azure](./media/getting-started/costhistory.png)

## <a name="optimize-and-reduce-costs"></a>Оптимизация и снижение затрат
Если вы не знакомы с принципами управления затратами, ознакомьтесь со статьей [How to optimize your cloud investment with Azure Cost Management](../costs/cost-mgt-best-practices.md) (Как оптимизировать инвестиции в облако с помощью службы "Управление затратами Azure").

На портале Azure можно также оптимизировать и сократить затраты на Azure с помощью автоматического завершения работы виртуальных машин и рекомендаций Помощника по Azure.

### <a name="consider-cost-cutting-features-like-auto-shutdown-for-vms"></a>Использование функций, сокращающих затраты, таких как автоматическое завершение работы виртуальных машин

В зависимости от выбранного сценария на портале Azure можно настроить автоматическое завершение работы виртуальных машин. Дополнительные сведения см. в записи блога [Announcing auto-shutdown for VMs using Azure Resource Manager](https://azure.microsoft.com/blog/announcing-auto-shutdown-for-vms-using-azure-resource-manager/) (Представляем автоматическое завершение работы виртуальных машин с помощью Azure Resource Manager).

![Снимок экрана включения функции автоматического завершения работы на портале](./media/getting-started/auto-shutdown.png)

Автоматическое завершение работы — это не то же самое, что завершение работы на самой виртуальной машине с помощью функций управления питанием. Автоматическое завершение работы приводит к остановке и прекращению обслуживания виртуальных машин, чтобы за их использование не взималась дополнительная плата. Дополнительные сведения о состояниях виртуальных машин см. в разделе "Часто задаваемые вопросы" статей о ценах на виртуальные машины [Linux](https://azure.microsoft.com/pricing/details/virtual-machines/linux/) и [Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/).

Дополнительные возможности сокращения затрат в среде разработки и тестирования описаны на странице [Azure DevTest Labs](https://azure.microsoft.com/services/devtest-lab/).

### <a name="turn-on-and-review-azure-advisor-recommendations"></a>Включение и просмотр рекомендаций Помощника по Azure

[Помощник по Azure](../../advisor/advisor-overview.md) помогает сократить затраты, определяя ресурсы с низким уровнем использования. Найдите **Помощник** на портале Azure.

![Снимок экрана кнопки Azure Advisor на портале Azure](./media/getting-started/advisor-button.png)

Выберите **Стоимость** в левой части. Вы можете увидеть практические рекомендации на вкладке **Стоимость**:

![Снимок экрана с примером рекомендации Azure Advisor](./media/getting-started/advisor-action.png)

Ознакомьтесь с [руководством по оптимизации затрат](../costs/tutorial-acm-opt-recommendations.md).


## <a name="integrate-with-billing-and-consumption-apis"></a>Интеграция с API выставления счетов и потребления

Примените API [выставления счетов](https://docs.microsoft.com/rest/api/billing/) и [потребления](https://docs.microsoft.com/rest/api/consumption/) Azure, чтобы программным способом получить данные о счетах и затратах. Для получения сведений об использовании, влияющих на сумму счета, воспользуйтесь совместно API RateCard и API использования. Дополнительные сведения см. в статье [Получение ценных сведений о потреблении ресурсов Microsoft Azure](usage-rate-card-overview.md).

## <a name="additional-resources-and-special-cases"></a><a name="other-offers"></a> Дополнительные ресурсы и особые случаи

### <a name="ea-csp-and-sponsorship-customers"></a>Клиенты с соглашением EA, со спонсорским предложением и партнеры по программе CSP
Чтобы начать работу, обратитесь к своему менеджеру по работе с клиентами или партнеру Azure.

| ПРЕДЛОЖЕНИЕ | Ресурсы |
|-------------------------------|-----------------------------------------------------------------------------------|
| Соглашение Enterprise (EA) | [Портал EA](https://ea.azure.com/), [справочные документы](https://ea.azure.com/helpdocs) и [отчет Power BI](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-enterprise/) |
| Поставщик облачных решений (CSP) | Обратитесь к поставщику |
| Спонсорское предложение Azure | [Портал спонсорского предложения Azure](https://www.microsoftazuresponsorships.com/) |

Если вы управляете ИТ-инфраструктурой в крупной организации, то рекомендуем ознакомиться со статьей [Корпоративный каркас Azure: рекомендуемая система управления подписками](/azure/architecture/cloud-adoption-guide/subscription-governance), а также с [техническим документом по корпоративным ИТ-решениям](https://download.microsoft.com/download/F/F/F/FFF60E6C-DBA1-4214-BEFD-3130C340B138/Azure_Onboarding_Guide_for_IT_Organizations_EN_US.pdf) (доступен в формате PDF и только на английском языке).

### <a name="enterprise-agreement-cost-views-in-the-azure-portal"></a><a name="EA"></a> Представления затрат на условиях Соглашения Enterprise на портале Azure

Сейчас представления затрат на условиях соглашения Enterprise доступны в общедоступной предварительной версии. Важные аспекты:

- Затраты по подписке основаны только на использовании. В них не включены предоплаченные суммы, избытки, включенные количества, корректировки и налоги. Фактические затраты вычисляются на уровне регистрации.
- Суммы, отображаемые на портале Azure, могут отличаться от сумм на корпоративном портале. Для появления на портале Azure обновлений корпоративного портала потребуется несколько минут.
- Если затраты не отображаются, это может быть связано с одной из следующих причин:
    - Отсутствие разрешений на уровне подписки. Чтобы просматривать представления расходов предприятия, требуется роль читателя счетов, читателя, участника или владельца на уровне подписки.
    - Вы являетесь владельцем учетной записи, и администратор регистрации отключил возможность просмотра затрат для владельца учетной записи.  Обратитесь к администратору регистрации для получения доступа к затратам.
    - Вы являетесь администратором отдела, и администратор регистрации отключил возможность **просмотра затрат для администратора отдела**.  Обратитесь к администратору регистрации для получения доступа.
    - Вы приобрели Azure через партнера по сбыту, который не предоставил вам сведения о ценах.  
- Если вы обновите параметры, связанные с доступом и затратами, на портале Enterprise Portal, изменения появятся на портале Azure с задержкой в несколько минут.
- Предельная сумма расходов и оповещения о выставлении счетов не применяются к подпискам EA.

### <a name="check-your-subscription-and-access"></a>Проверьте подписку и доступ

Для просмотра затрат необходимы права доступа к данным для выставления счетов на уровне подписки или учетной записи. Этот доступ может быть разным для разных типов учетных записей выставления счетов. Изучить сведения об учетных записях выставления счетов и проверить тип учетной записи для выставления счетов вы можете с помощью руководства по [просмотру учетных записей для выставления счетов на портале Azure](view-all-accounts.md).

Если у вас есть доступ к Azure через учетную запись выставления счетов по программе Microsoft Online Service (MOSP), воспользуйтесь статьей [об управлении доступом к информации о выставлении счетов для Azure](manage-billing-access.md).

Если у вас есть доступ к Azure через учетную запись выставления счетов по Соглашению Enterprise, изучите описание [административных ролей в Azure при использовании Соглашения Azure Enterprise](understand-ea-roles.md).

Если у вас есть доступ к Azure через учетную запись выставления счетов по клиентскому соглашению Майкрософт, изучите описание [административных ролей в Azure при использовании клиентского соглашения Майкрософт](understand-mca-roles.md).

### <a name="request-a-service-level-agreement-credit-for-a-service-incident"></a>Запрос кредита Соглашения об уровне обслуживания при возникновении инцидента обслуживания

В соглашении об уровне обслуживания (SLA) приводится описание обязательств корпорации Майкрософт в отношении доступности и подключения. Об инциденте обслуживания сообщается, когда в службах Azure возникает проблема, влияющая на работоспособность или подключение, которую часто называют *сбой*. Если мы не можем обеспечить работу служб на уровнях обслуживания надлежащим образом для каждой службы, как описано в Соглашении об уровне обслуживания, вы имеете право на получение кредита на часть ежемесячных платных услуг.

Запрос кредита:

1. Войдите на [портал Azure](https://portal.azure.com/). Если у вас несколько учетных записей, используйте именно ту, на которую повлиял простой Azure.
2. Создайте запрос на поддержку.
3. В разделе **Тип проблемы** выберите **Выставление счетов**.
4. В разделе **Тип проблемы** выберите **Refund Request** (Запрос на возврат денег).
5. Добавьте сведения, чтобы указать, что вы запрашиваете кредит в рамках Соглашения об уровне обслуживания, укажите дату, время и часовой пояс, а также затронутые службы (виртуальные машины, веб-сайты и т. д.).
6. Проверьте контактные данные и нажмите кнопку **Создать**, чтобы отправить запрос.

Пороговые значения Соглашения об уровне обслуживания зависят от службы. Например, на уровне SQL Web и "Стандартный" Соглашение об уровне обслуживания гарантирует доступность 99,9 %, а на виртуальных машинах — 99,95 %.

В некоторых службах к Соглашению об уровне обслуживания применяются предварительные требования. Например, на виртуальных машинах должны быть два или более экземпляра, развернутых в одной группе доступности.

Дополнительные сведения см. в документации по [Соглашениях об уровне обслуживания](https://azure.microsoft.com/support/legal/sla/) и [сводке о Соглашениях об уровне обслуживания для служб Azure](https://azure.microsoft.com/support/legal/sla/summary/).

## <a name="analyze-unexpected-charges"></a>Анализ непредвиденных расходов

Скорее всего, вы создали сложную инфраструктуру облачных ресурсов для своей организации. Многие типы ресурсов Azure могут иметь разные типы расходов. Ресурсы Azure могут принадлежать разным командам в организации и иметь разные типы моделей выставления счетов, которые применяются к различным ресурсам. Чтобы получить более полное представление о расходах, начните анализ с помощью одной или нескольких стратегий в разделах ниже.

### <a name="review-your-invoice-and-identify-the-resource-that-is-responsible-for-the-charge"></a>Проверка счета и идентификация ресурса, ответственного за расходы

Способ приобретения услуг Azure помогает определить методологию и средства, которые доступны при определении ресурса, связанного с оплатой. Чтобы определить, какая методология к вам применяется, сначала [определите тип предложения Azure](../costs/understand-cost-mgt-data.md#determine-your-offer-type). Затем укажите категорию клиента в списке [поддерживаемых предложений Azure](../costs/understand-cost-mgt-data.md#supported-microsoft-azure-offers).

В статьях ниже приведены подробные инструкции по проверке счета на основе типа клиента. В каждом приведенном ниже источнике содержатся инструкции по скачиванию CSV-файла со сведениями о потреблении и затратах за данный период выставления счетов:

- [процесс проверки счета с оплатой по мере использования](../understand/review-individual-bill.md#compare-invoiced-charges-with-usage-file);
- [процесс проверки счета Соглашения Enterprise](../understand/review-enterprise-agreement-bill.md);
- [процесс проверки Клиентского соглашения Майкрософт](../understand/review-customer-agreement-bill.md#analyze-your-azure-usage-charges);
- [процесс проверки Соглашения с партнером Майкрософт](../understand/review-partner-agreement-bill.md#analyze-your-azure-usage-charges).

В счетах Azure вычисляются расходы за месяц на основе _единиц измерения_. Единица измерения используется для отслеживания потребления ресурсов на протяжении времени и для составления счета. При создании одного ресурса Azure, например виртуальной машины, вместе с ним создается один или несколько экземпляров счетчиков.

Отфильтруйте CSV-файл с данными об использовании на основе _MeterName_, как показано в счете, который нужно проанализировать, чтобы увидеть все элементы строки, применяющиеся к единице измерений. _InstanceID_ элемента строки соответствует фактическому ресурсу Azure, создавшему расходы.

Определив необходимый ресурс, вы можете воспользоваться анализом затрат в службе "Управление затратами Azure", чтобы проанализировать затраты, связанные с ресурсом. Дополнительные сведения об использовании анализа затрат см. в [этой статье](../costs/quick-acm-cost-analysis.md).

### <a name="review-invoiced-charges-in-cost-analysis"></a>Просмотр выставленных счетов в разделе анализа затрат

Чтобы просмотреть сведения о счете на портале Azure, перейдите в раздел анализа затрат для интересующего вас счета. Выберите представление **Сведения о счете**. Здесь сведения о расходах показаны так же, как в счете.

[![Пример сведений о счете](./media/getting-started/invoice-details.png)](./media/getting-started/invoice-details.png#lightbox)

Просматривая сведения о счете, можно определить, из-за какой службы возникли непредвиденные затраты и какие ресурсы непосредственно связанны с определенным ресурсом в анализе затрат. Например, если вы хотите проанализировать расходы на службу "Виртуальные машины", перейдите к представлению **Накопленные затраты**. Затем установите степень детализации **Ежедневно**, примените фильтр **Название службы: Виртуальные машины** и сгруппируйте расходы по **ресурсам**.

[![Пример накопленных затрат на виртуальные машины](./media/getting-started/virtual-machines.png)](./media/getting-started/virtual-machines.png#lightbox)


### <a name="identify-spikes-in-cost-over-time"></a>Определение максимальных расходов за период времени

Иногда вы можете не знать, какие последние затраты привели к изменениям оплаты счетов. Чтобы понять, что изменилось, можно воспользоваться анализом затрат, [просмотрев ежедневное или ежемесячное распределение затрат за период времени](../costs/cost-analysis-common-uses.md#view-costs-per-day-or-by-month). После создания представления сгруппируйте расходы по **службам** или **ресурсам**, чтобы найти изменения. Вы также можете отобразить данные в виде **графика**, чтобы лучше их визуализировать.

![Пример, демонстрирующий затраты за период времени в анализе затрат](./media/getting-started/costs-over-time.png)

### <a name="determine-resource-pricing-and-understand-its-billing-model"></a>Определение цен на ресурсы и анализ модели выставления счетов

Один ресурс может увеличить плату за несколько продуктов и служб Azure. Дополнительные сведения о ценах на каждый продукт Azure см. на [этой странице](https://azure.microsoft.com/pricing/#product-pricing). Например, одна виртуальная машина, созданная в Azure, может иметь указанные ниже единицы измерения, созданные для отслеживания ее использования. У каждой из них могут быть разные цены.

- Часы вычислений
- Часы использования IP-адресов
- Входящий трафик передачи данных
- Исходящий трафик передачи данных
- Стандартный управляемый диск
- Операции с управляемыми дисками (цен. категория "Стандартный")
- Стандартные операции ввода-вывода на диске
- Стандартные операции ввода-вывода чтения блочных BLOB-объектов
- Стандартные операции ввода-вывода записи блочных BLOB-объектов
- Стандартные операции ввода-вывода удаления блочных BLOB-объектов

После создания виртуальной машины каждый счетчик начинает передавать данные об использовании. Эти данные и соответствующая стоимость отслеживаются в системе учета затрат Azure. В CSV-файле с данными об использовании вы видите те счетчики, которые использовались для составления счета.

### <a name="find-the-people-responsible-for-the-resource-and-engage-them"></a>Поиск ответственных за ресурс и их привлечение

Часто команда, ответственная за данный ресурс, знает о его изменениях. Необходимо привлекать ответственных, когда вы определяете причину возникновения расходов. Например, ответственная рабочая группа могла недавно создать ресурс, обновить его номер SKU (таким образом изменив цену ресурса) или увеличить нагрузку на ресурс в связи с изменениями кода. Чтобы узнать о дополнительных методах определения владельца ресурса, ознакомьтесь со следующими разделами.

#### <a name="analyze-the-audit-logs-for-the-resource"></a>Анализ журналов аудита ресурса

Если у вас есть разрешения на просмотр ресурса, вы сможете получить доступ к его журналам аудита. Проверьте журналы, чтобы найти пользователя, ответственного за последние изменения ресурса. Дополнительные сведения см. в статье [Просмотр и извлечение событий журнала действий Azure](../../azure-monitor/platform/activity-log-view.md).

#### <a name="analyze-user-permissions-to-the-resources-parent-scope"></a>Анализ разрешений пользователя для родительской области ресурса

Пользователи с доступом на запись к подписке или группе ресурсов обычно имеют сведения о созданных ресурсах. Они должны объяснить назначение ресурса или направить вас к специалисту. Чтобы определить пользователей с разрешениями для области подписки, ознакомьтесь с разделом [Просмотр назначений ролей](../../role-based-access-control/check-access.md#view-role-assignments). Для групп ресурсов можно использовать аналогичную процедуру.

### <a name="get-help-to-identify-charges"></a>Получение справки для определения расходов

Если вы использовали предыдущие стратегии и по-прежнему не понимаете, почему у вас возникли расходы, или вам нужна другая помощь по вопросам выставления счетов, [создайте запрос в службу поддержки](https://go.microsoft.com/fwlink/?linkid=2083458).

## <a name="next-steps"></a>Дальнейшие действия
- Узнайте, как установить [предельную сумму расходов](spending-limit.md), чтобы предотвратить чрезмерные расходы.
- Начните [анализировать затраты на Azure](../costs/quick-acm-cost-analysis.md).
