---
title: Выбор резервирования Azure для приобретения
description: Эта статья поможет определить, какое резервирование вам следует приобрести.
author: bandersmsft
ms.reviewer: yashar
ms.service: cost-management-billing
ms.topic: how-to
ms.date: 07/24/2020
ms.author: banders
ms.openlocfilehash: 9e5657211e640c741dbf1bf2b5473a3ea5e10487
ms.sourcegitcommit: dccb85aed33d9251048024faf7ef23c94d695145
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87287293"
---
# <a name="determine-what-reservation-to-purchase"></a>Выбор резервирования для приобретения

Все резервирования, кроме Azure Databricks, применяются на почасовой основе. Вам следует приобретать резервирования, основываясь на базовом стабильном объеме потребления. Есть много разных способов выбрать правильный вариант для покупки, и эта статья поможет вам выбрать резервирование для приобретения.

Приобретая больше емкости, чем вы потребляете в долгосрочной перспективе, вы получите недоиспользуемое резервирование. Старайтесь всегда избегать недостаточного использования, насколько это возможно. Неиспользованная зарезервированная емкость не переносится из одного часа в следующий. Емкость, потребленная сверх зарезервированной, оплачивается по более высоким ставкам с оплатой по мере использования.

## <a name="analyze-usage-data"></a>Анализ данных о потреблении

В следующих разделах описывается, как оценить данные о ежедневном потреблении ресурсов и на их основе определить базовый уровень потребления, а также наиболее подходящее резервирование для приобретения.

### <a name="analyze-usage-for-a-vm-reserved-instance-purchase"></a>Анализ потребления для покупки зарезервированного экземпляра виртуальной машины

Определите правильный размер виртуальной машины для этого приобретения. Например, приобретенные резервирования для виртуальных машин серии ES не применяются к серии E, и наоборот.

На акционные серии виртуальных машин скидка по резервированию не распространяется, поэтому сразу исключите их из анализа.

Чтобы сузить оценку до подходящих виртуальных машин, примените следующие фильтры по данным о потреблении.

- Для параметра фильтра **MeterCategory** укажите **Virtual Machines** (Виртуальные машины).
- Получите значение **ServiceType** из раздела **AdditionalInfo**. Эти сведения позволяют узнать подходящий размер виртуальной машины. Предположим, вы определили размер Standard E32.
- Используйте поле **ResourceLocation** для получения сведений о том, какой центр обработки данных используется.

Игнорируйте любые ресурсы, которые используются менее 24 часов в день.

Если вам требуется анализ на уровне семейства размеров экземпляров, информацию о гибкости размеров экземпляров можно получить из файла [https://isfratio.blob.core.windows.net/isfratio/ISFRatio.csv](https://isfratio.blob.core.windows.net/isfratio/ISFRatio.csv). Выполните анализ этих значений в сочетании с другими данными. Дополнительные сведения о гибкости размера экземпляров см. в статье [Гибкость размеров виртуальных машин при использовании зарезервированных экземпляров виртуальных машин](../../virtual-machines/windows/reserved-vm-instance-size-flexibility.md).

### <a name="analyze-usage-for-an-azure-synapse-analytics-reserved-instance-purchase"></a>Анализ потребления для покупки зарезервированного экземпляра Azure Synapse Analytics

Зарезервированная емкость применяется к стоимости DWU Azure Synapse Analytics. Она не применяется к стоимости лицензий Azure Synapse Analytics и любых других расходов, кроме вычислений.

Чтобы сузить оценку до подходящего потребления ресурсов, примените следующие фильтры по данным о потреблении.


- Для параметра **MeterCategory** установите фильтр **SQL Database** (База данных SQL).
- Для параметра **MeterName** установите фильтр **vCore** (Виртуальное ядро).
- Для параметра **MeterSubCategory** установите фильтр по всем записям, в имени которых есть слово _Compute_ (Вычисления).

В поле **AdditionalInfo** получите значение **vCores** (Виртуальные ядра). Оно позволяет узнать, сколько виртуальных ядер используется. Умножьте значение **vCores** (Виртуальные ядра) на количество часов, в течение которых использовалась база данных.

Эти данные позволят узнать стабильный уровень потребления для следующего.

- Сочетание типов базы данных. Например, управляемый экземпляр или эластичный пул для отдельной базы данных.
- Уровень обслуживания. Например, "Общего назначения" или "Критически важный для бизнеса".
- Поколение. Например, "Поколение 5".
- Расположение ресурса

### <a name="analysis-for-azure-synapse-analytics"></a>Возможности анализа для Azure Synapse Analytics

Зарезервированная емкость применяется к потреблению DWU Azure Synapse Analytics и приобретается с шагом приращения в 100 DWU. Чтобы сузить оценку до подходящего потребления, примените следующие фильтры к данным о потреблении.

- Для параметра **MeterName** установите фильтр **100 DWUs**.
- Для параметра **Meter Sub-Category** (Подкатегория счетчика) установите фильтр **Compute Optimized Gen2** (2-го поколения, оптимизированный для вычислений).

В поле **Расположение ресурса** получите сведения о потреблении для Azure Synapse Analytics в нужном регионе.

Потребление Azure Synapse Analytics может существенно увеличиваться и/или уменьшаться в течение дня. Проанализируйте эти данные со специалистами, отвечающими за обслуживание экземпляра Azure Synapse Analytics, чтобы правильно определить базовое потребление.

Перейдите на портале Azure к разделу "Резервирования" и приобретите зарезервированную емкость для Azure Synapse Analytics с нужным количеством сотен DWU.

## <a name="reservation-purchase-recommendations"></a>Рекомендации по приобретению резервирований

Рекомендации по приобретению резервирований составляются на основе данных о почасовом потреблении за последние 7, 30 и 60 дней. В Azure определяется, какие расходы вы понесли бы при наличии резервирований. Затем эти результаты сравниваются с текущими расходами с оплатой по мере использования за рассматриваемый период. Эти вычисления выполняются по каждому количеству потребленных ресурсов за рассматриваемый интервал времени. В рекомендации включается то количество, которое позволит вам сэкономить больше средств.

Предположим, вы регулярно используете 500 виртуальных машин, но иногда нагрузка вырастает до 700 виртуальных машин. В этом примере в Azure выполняются вычисления для обоих уровней: 500 и 700 виртуальных машин. Поскольку потребление на уровне 700 виртуальных машин происходит нестабильно, расчет в рамках рекомендаций покажет, что максимальная экономия будет достигнута при приобретении резервирования на 500 виртуальных машин, и именно это количество будет предоставлено в качестве рекомендации.

Обратите внимание на следующие моменты.

- Рекомендации по резервированию составляются на основе применимых тарифов на потребление по запросу.
- Рекомендации вычисляются по отдельным размерам, но не по семействам размеров экземпляров.
- Рекомендуемое количество для каждой области снижается в тот же день, когда вы приобретаете резервирование по этой области.
    - Но на обновление рекомендаций по количеству резервирований для других областей может потребоваться до 25 дней. Например, если вы приобрели резервирование на основе рекомендаций по общей области (несколько подписок), рекомендации по одной подписке могут появиться примерно через 25 дней.

## <a name="recommendations-in-the-azure-portal"></a>Рекомендации на портале Azure

Покупки резервирований, определенные подсистемой рекомендаций, отображаются на вкладке **Рекомендуется** на [портале Azure](https://portal.azure.com/#blade/Microsoft_Azure_Reservations/CreateBlade/referrer/docs). Вот изображение с примером.

![Изображение с рекомендациями](./media/determine-reservation-purchase/select-product-ri.png)

## <a name="recommendations-in-the-cost-management-power-bi-app"></a>Рекомендации в приложении Power BI "Управление затратами"

Клиенты, подписавшие Соглашение Enterprise или Клиентское соглашение Майкрософт, могут использовать отчеты о доле зарезервированных экземпляров виртуальных машин и рекомендации по приобретению. В таком отчете отображаются сведения об общем потреблении и той его части, которая покрывается приобретенными зарезервированными экземплярами.

1. Установите [приложение для управления затратами](https://appsource.microsoft.com/product/power-bi/costmanagement.azurecostmanagementapp).
2. Откройте отчет о доле зарезервированных экземпляров виртуальных машин для объединенной или отдельной области, в зависимости от того, для какой области вы намерены приобретать резервирование.
3. Выберите нужный регион и семейство размеров экземпляров, чтобы увидеть долю зарезервированных экземпляров и рекомендации по приобретению для выбранной в фильтре области.

## <a name="recommendations-in-azure-advisor"></a>Рекомендации в Помощнике по Azure

В [Помощнике по Azure](https://portal.azure.com/#blade/Microsoft_Azure_Expert/AdvisorMenuBlade/overview) предоставляются рекомендации по приобретению резервирований.

- Помощник использует только рекомендации в рамках одной подписки.
- Рекомендации в Помощнике по Azure составляются на основе прошедших 30 дней. Прогнозируемая экономия определяется по сроку резервирования 3 года.
- Если вы приобретаете резервирование с общей областью действия, рекомендации по приобретению резервирования в Помощнике могут исчезнуть только через 30 дней.

## <a name="recommendations-using-apis"></a>Получение рекомендаций через API

Чтобы получить рекомендации с помощью программных средств, используйте API [рекомендаций по резервированию](/rest/api/consumption/reservationrecommendations/list).

## <a name="next-steps"></a>Дальнейшие действия

- [Управление Azure Reserved VM Instances](manage-reserved-vm-instance.md)
- [Общие сведения об использовании резервирования Azure для подписки с оплатой по мере использования](understand-reserved-instance-usage.md)
- [Общие сведения об использовании зарезервированных экземпляров Azure с Соглашением о регистрации Enterprise](understand-reserved-instance-usage-ea.md)
- [Затраты на программное обеспечение Windows, которые не включены в стоимость зарезервированных экземпляров Azure](reserved-instance-windows-software-costs.md)