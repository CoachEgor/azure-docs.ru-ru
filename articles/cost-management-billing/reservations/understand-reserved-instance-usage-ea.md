---
title: Общие сведения об использовании резервирования Azure по Соглашениям Enterprise
description: Сведения о том, как оценить данные об использовании, чтобы составить представление о применении резервирования Azure для соглашения о регистрации Enterprise.
author: bandersmsft
ms.reviewer: yashar
tags: billing
ms.service: cost-management-billing
ms.subservice: reservations
ms.topic: conceptual
ms.date: 02/13/2020
ms.author: banders
ms.openlocfilehash: 070d105785ee3ab9811188406bda56dbe6ceb558
ms.sourcegitcommit: 9eda79ea41c60d58a4ceab63d424d6866b38b82d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/30/2020
ms.locfileid: "96350897"
---
# <a name="get-enterprise-agreement-reservation-costs-and-usage"></a>Получение сведений о затратах на резервирование и использовании по Соглашениям Enterprise

Данные о затратах на резервирование и сведения об использовании доступны для клиентов, заключивших Соглашение Enterprise, на портале Azure и через интерфейсы REST API. В этой статье подробно описано, как выполнять следующее:

- получать данные о покупках резервирования;
- определять подписку, группу ресурсов или ресурс, которые используют определенное резервирование;
- возвращать платежи за использование резервирования;
- рассчитывать экономический эффект от резервирования;
- получать данные о недоиспользовании резервирования;
- амортизировать расходы на резервирование.

Сведения о расходах на Marketplace консолидированы в данные об использовании. Вы можете в одном месте просматривать данные о своих расходах за использование, расходах на Marketplace и покупках.

## <a name="reservation-charges-in-azure-usage-data"></a>Расходы на резервирование в данных об использовании Azure

Эти данные разделены на два отдельных набора данных: _Фактическая стоимость_ и _Амортизированная стоимость_. Ниже перечислены отличия этих наборов данных:

**Фактическая стоимость** — это данные для сверки с месячным счетом. Эти данные включают расходы на покупку резервирований и сведения об использовании резервирований. Эти данные позволяют выяснить, какая подписка, группа ресурсов или ресурс пользовались скидкой за резервирование в определенный день. Значение EffectivePrice (Фактическая цена) будет нулевым для того элемента, при использовании которого применялась скидка за резервирование.

**Амортизированная стоимость**. Этот набор данных аналогичен набору данных "Фактическая стоимость", но здесь значение EffectivePrice (Фактическая цена) для того элемента, при использовании которого применялась скидка за резервирование, содержит пропорциональную долю стоимости соответствующего резервирования (а не нулевое значение). Это поможет вам определить стоимость потребленного резервирования для подписки, группы ресурсов или ресурса, и соответственно оформить внутренние возвратные платежи за использование резервирования. Этот набор данных также содержит сведения о неиспользованных часах резервирования. В этом наборе данных нет записей о покупках резервирований.

Сравнение двух наборов данных:

| Данные | Набор данных "Фактическая стоимость" | Набор данных "Амортизированная стоимость" |
| --- | --- | --- |
| Покупки резервирований | Доступно в этом представлении.<br><br>  Чтобы получить эти данные, установите фильтр ChargeType = &quot;Purchase&quot;. <br><br> Значения ReservationID и (или) ReservationName помогут выяснить, за какое резервирование взималась плата.  | Неприменимо в этом представлении. <br><br> Затраты на покупку не предоставляются в амортизированных данных. |
| EffectivePrice | Для использования, которое получает скидку за резервирование, это значение равно нулю. | Это значение содержит пропорциональную почасовую долю стоимости резервирования, скидка за которое была применена к этому использованию. |
| Неиспользованное резервирование (содержит количество часов, в течение которых резервирование за определенный день не использовалось, и потери от этого в денежном выражении). | Неприменимо в этом представлении. | Доступно в этом представлении.<br><br> Чтобы получить эти данные, установите фильтр ChargeType = &quot;UnusedReservation&quot;.<br><br>  Значения ReservationID и (или) ReservationName помогут узнать, какое резервирование использовалось неэффективно. Это данные о том, какая часть резервирования за день была потрачена впустую.  |
| UnitPrice (цена ресурса по применимому прайс-листу) | Доступно | Доступно |

Изменения, которые коснулись других значений в данных об использовании Azure:

- Сведения о продукте и единицах измерения. В Azure теперь не заменяются данные об изначально потребленных единицах измерения на значения ReservationId и ReservationName, как это было ранее.
- ReservationId и ReservationName теперь представлены в отдельных полях в наборе данных. Ранее они были доступны только в поле AdditionalInfo.
- ProductOrderId — идентификатор заказа на резервирование добавлен в отдельном поле.
- ProductOrderName — имя продукта приобретенного резервирования.
- Term (Срок) — 12 или 36 месяцев.
- RINormalizationRatio — значение доступно в поле AdditionalInfo. Это доля резервирования, примененная к записи об использовании. Если для резервирования включена гибкость размера экземпляра, этот параметра может применяться и к другим размерам. Это значение обозначает, какая доля резервирования была применена к записи об использовании.

[См. определение поля](/rest/api/consumption/usagedetails/list#definitions)

## <a name="get-azure-consumption-and-reservation-usage-data-using-api"></a>Получение данных об использовании и резервированиях Azure с помощью API

Вы можете получить эти данные через API-интерфейс или скачать их на портале Azure.

Для получения новых данных используйте [API сведений об использовании](/rest/api/consumption/usagedetails/list). Дополнительные сведения о терминологии вы найдете в [разделе условий использования](../understand/understand-usage.md). Вызывающая сторона должна иметь роль администратора предприятия по Соглашению Enterprise, назначенную на [портале EA](https://ea.azure.com). Администраторы предприятия с доступом только для чтения также могут получать эти данные.

Обратите внимание, что эти данные недоступны через [API-интерфейсы отчетов для корпоративных клиентов (см. сведения об использовании)](/rest/api/billing/enterprise/billing-enterprise-api-usage-detail).

Ниже приведен пример вызова этого API сведений о потреблении.

```
https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{enrollmentId}/providers/Microsoft.Billing/billingPeriods/{billingPeriodId}/providers/Microsoft.Consumption/usagedetails?metric={metric}&amp;api-version=2019-05-01&amp;$filter={filter}
```

Дополнительные сведения о параметрах {enrollmentId} (идентификатор Соглашения о регистрации) и {billingPeriodId} (идентификатор периода выставления счетов) см. в [списке параметров использования](/rest/api/consumption/usagedetails/list) из статьи об этом API.

Сведения о метрике и фильтре, приведенные в следующей таблице, помогут вам решить некоторые распространенные проблемы с резервированием.

| **Тип данных API** | Действие вызова API |
| --- | --- |
| **Все расходы (использование и покупки)** | Замените {metric} значением ActualCost |
| **Использование, которое получило скидку за резервирование** | Замените {metric} значением ActualCost<br><br>Замените {filter} значением properties/reservationId%20ne%20 |
| **Использование, которое не получило скидку за резервирование** | Замените {metric} значением ActualCost<br><br>Замените {filter} значением properties/reservationId%20eq%20 |
| **Амортизированные расходы (использование и покупки)** | Замените {metric} значением AmortizedCost |
| **Отчет о неиспользованном резервировании** | Замените {metric} значением AmortizedCost<br><br>Замените {filter} значением properties/ChargeType%20eq%20'UnusedReservation' |
| **Покупки резервирований** | Замените {metric} значением ActualCost<br><br>Замените {filter} значением properties/ChargeType%20eq%20'Purchase'  |
| **Возвраты платежей** | Замените {metric} значением ActualCost<br><br>Замените {filter} значением properties/ChargeType%20eq%20'Refund' |

## <a name="download-the-usage-csv-file-with-new-data"></a>Скачивание CSV-файла с новыми данными

Если вы являетесь администратором EA, вы можете скачать CSV-файл с новыми данными об использовании на портале Azure. Эти данные недоступны на портале EA (ea.azure.com). Чтобы просмотреть новые данные, необходимо скачать файл использования с портала Azure (portal.azure.com).

Перейдите к разделу [Управление затратами + выставление счетов](https://portal.azure.com/#blade/Microsoft_Azure_Billing/ModernBillingMenuBlade/BillingAccounts) на портале Azure.

1. Выберите учетную запись выставления счетов.
2. Щелкните **Использование+расходы**.
3. Щелкните элемент **Загрузить**.  
![Пример с ссылками на скачивание CSV-файла с данными об использовании на портале Azure](./media/understand-reserved-instance-usage-ea/portal-download-csv.png)
4. В разделе **Скачать сведения об использовании + расходы** в области **Usage Details Version 2** (Данные об использовании, версия 2) щелкните **All Charges (usage and purchases)** (Все расходы (использование и покупки) и выберите действие "Скачать". Повторите эту операцию для элемента **Amortized charges (usage and purchases)** (Амортизированные расходы (использование и покупки).

Скачанные CSV-файлы содержат данные о фактической стоимости и амортизированной стоимости.

## <a name="common-cost-and-usage-tasks"></a>Типичные задачи по анализу затрат и использования

В следующих разделах описаны распространенные задачи по просмотру данных о затратах на резервирования и использовании резервирований.

### <a name="get-reservation-purchase-costs"></a>Получение данных о расходах на покупку резервирований

Расходы на покупку резервирований доступны в наборе данных "Фактические затраты". Установите фильтр _ChargeType = Purchase_. Чтобы определить, покупка какого заказа на резервирование выполнялась, используйте параметр ProductOrderID.

### <a name="get-underutilized-reservation-quantity-and-costs"></a>Получение сведений о количестве и стоимости недоиспользованных резервирований

Перейдите к набору данных "Амортизированная стоимость" и установите фильтр _ChargeType_ _= UnusedReservation_. Вы получите данные о неиспользованном объеме резервирования в день и расходах на него. Можно также отфильтровать данные по отдельному резервированию или заказу на резервирование, используя поля _ReservationId_ и _ProductOrderId_ соответственно. Если резервирование было использовано на 100%, эта запись содержит нулевое значение.

### <a name="amortize-reservation-costs"></a>амортизировать расходы на резервирование.

Перейдите к данным "Амортизированная стоимость" и установите фильтр по заказу на резервирование (поле _ProductOrderID_), чтобы получить данные о ежедневных амортизированных расходах на резервирование.

### <a name="chargeback-for-a-reservation"></a>Возврат платежей за резервирование

Вы можете возвращать платежи за использование резервирований другим организациям по подписке, группам ресурсов или тегам. Данные об амортизированной стоимости отображают денежную стоимость использованной доли резервирования для следующих типов данных:

- Ресурсы (например, виртуальная машина)
- Группа ресурсов
- Теги
- Подписка

### <a name="get-the-blended-rate-for-chargeback"></a>Получение смешанной ставки для возврата платежей

Чтобы определить смешанную ставку, перейдите к данным об амортизированной стоимости и просуммируйте общую стоимость. Для виртуальных машин можно использовать данные MeterName или ServiceType из поля AdditionalInfo в структуре JSON. Разделите общую стоимость на использованное количество, чтобы получить смешанную ставку.

### <a name="audit-optimum-reservation-use-for-instance-size-flexibility"></a>Аудит оптимального использования резервирования для гибкости размера экземпляра

Умножьте количество на значение _RINormalizationRatio_ из поля AdditionalInfo. Полученный результат показывает, сколько часов резервирования было применено к этой записи об использовании.

### <a name="determine-reservation-savings"></a>Расчет экономического эффекта от резервирования

Перейдите к данным "Амортизированная стоимость" и отфильтруйте их по зарезервированному экземпляру. Затем сделайте следующее:

1. Выполните оценку затрат на оплату по мере использования. Умножьте значение _UnitPrice_ (Стоимость единицы) на значение _Quantity_ (Количество), чтобы узнать примерную величину затрат на оплату по мере использования без применения скидки за резервирование.
2. Рассчитайте стоимость резервирования. Суммируйте все значения _Cost_, чтобы получить величину затрат на зарезервированный экземпляр в денежном выражении. Сюда входит стоимость как использованной, так и неиспользованной частей резервирования.
3. Вычтите затраты на резервирование из оценки затрат на оплату по мере использования, чтобы узнать предполагаемую экономию.

## <a name="reservation-purchases-and-amortization-in-cost-analysis"></a>Покупки резервирований и амортизация в анализе затрат

Покупки резервирований включаются в [анализ затрат](https://aka.ms/costanalysis). По умолчанию в анализе затрат отображается **фактическая стоимость**, то есть те расходы, которые включены в счет на оплату. Чтобы просмотреть разбивку затрат на резервирования и их связь с ресурсами, которые использовали приобретенное преимущество, перейдите к данным об **амортизированной стоимости**:

![Пример, демонстрирующий выбор амортизированных затрат в анализе затрат](./media/understand-reserved-instance-usage-ea/portal-cost-analysis-amortized-view.png)

Сгруппируйте расходы по типам, чтобы получить подробные сведения об использовании, покупках и возвратах платежей. Группировка по резервированиям дает разбивку по расходам на резервирования и расходам по запросу. Учитывайте, что при просмотре фактической стоимости покупки из всех затрат на резервирование вы увидите только покупки, тогда как при просмотре амортизированной стоимости эти расходы будут привязаны к отдельным ресурсам, которые использовали преимущество резервирования. Также в представлении амортизированной стоимости вы увидите новый тип расходов **UnusedReservation**.

## <a name="need-help-contact-us"></a>Требуется помощь? Свяжитесь с нами.

Если у вас есть вопросы или вам нужна помощь, [создайте запрос в службу поддержки](https://go.microsoft.com/fwlink/?linkid=2083458).

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о резервировании в Azure см. по следующим ссылкам:

- [Основные сведения о резервировании в Azure](save-compute-costs-reservations.md)
- [Предоплата виртуальных машин с помощью Azure Reserved Virtual Machine Instances](../../virtual-machines/prepay-reserved-vm-instances.md)
- [Предоплата вычислительных ресурсов Базы данных SQL Azure с получением резервной мощности](../../azure-sql/database/reserved-capacity-overview.md)
- [Управление Azure Reserved VM Instances](manage-reserved-vm-instance.md)
- [Сведения о применении скидки на зарезервированный экземпляр виртуальной машины](../manage/understand-vm-reservation-charges.md)
- [Общие сведения об использовании резервирования Azure для подписки с оплатой по мере использования](understand-reserved-instance-usage.md)
- [Затраты на программное обеспечение Windows, которые не включены в стоимость зарезервированных экземпляров Azure](reserved-instance-windows-software-costs.md)