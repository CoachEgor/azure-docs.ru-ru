---
title: Руководство по оптимизации затрат на зарезервированный экземпляр с помощью Cloudyn в Azure
description: В этом руководстве вы узнаете, как оптимизировать затраты на использование зарезервированных экземпляров Azure и Amazon Web Services (AWS).
author: bandersmsft
ms.author: banders
ms.date: 03/12/2020
ms.topic: tutorial
ms.service: cost-management-billing
ms.subservice: cloudyn
ms.custom: seodec18
ms.reviewer: benshy
ROBOTS: NOINDEX
ms.openlocfilehash: 8488b1f511a3b269f36f3dfe7a351765a4e312aa
ms.sourcegitcommit: 56cbd6d97cb52e61ceb6d3894abe1977713354d9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "88687881"
---
<!-- Intent: As a cloud-consuming administrator, I need to ensure that my reserved instances are optimized for cost and usage
-->

# <a name="tutorial-optimize-reserved-instances"></a>Руководство по оптимизации зарезервированных экземпляров

В этом руководстве вы узнаете, как оптимизировать затраты на использование зарезервированных экземпляров, а также использование Azure и Amazon Web Services (AWS) с помощью Cloudyn. Зарезервированный экземпляр любого поставщика облачных служб — это обязательство по долгосрочному контракту, в котором вы заранее обязуетесь использовать виртуальную машину. Кроме того, он потенциально может обеспечить значительную экономию по сравнению со стандартной моделью ценообразования виртуальных машин с оплатой за использование. Экономия достигается только тогда, когда вы полностью используете возможности своих зарезервированных экземпляров.

В этом руководстве описывается, как зарезервированные экземпляры Azure и AWS поддерживаются Cloudyn. В нем также описывается, как можно оптимизировать стоимость зарезервированных экземпляров. Это можно сделать, прежде всего убедившись, что все экземпляры используются. Изучив данный учебник, вы научитесь:

> [!div class="checklist"]
> * Анализ затрат за использование зарезервированных экземпляров Azure
> * Получать преимущества использования зарезервированных экземпляров.
> * Оптимизация затрат на использование зарезервированных экземпляров Azure
> * Просмотр затрат на использование зарезервированных экземпляров
> * Оценка экономичности использования зарезервированных экземпляров Azure
> * Оптимизация затрат на использование зарезервированных экземпляров AWS
> * Покупка рекомендуемых зарезервированных экземпляров
> * Изменение неиспользуемых резервирований

Если у вас еще нет подписки Azure, то прежде чем начинать работу, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

[!INCLUDE [cloudyn-note](../../../includes/cloudyn-note.md)]

## <a name="prerequisites"></a>предварительные требования

- Необходимо иметь учетную запись Azure.
- У вас должна быть пробная регистрация либо платная подписка на службу Cloudyn.
- Необходимо купить зарезервированные экземпляры в Azure или AWS.

## <a name="understand-azure-ri-costs"></a>Анализ затрат за использование зарезервированных экземпляров Azure

При покупке зарезервированных экземпляров виртуальных машин Azure вы предварительно платите за их использование в будущем. Аванс покрывает расходы за будущее использование виртуальных машин:

- определенного типа;
- в определенном регионе;
- за срок действия от одного до трех лет;
- до приобретенного количества виртуальных машин.

Вы можете просмотреть приобретенное резервирование Azure на портале Azure на вкладке [Резервирование](https://portal.azure.com/#blade/Microsoft_Azure_Reservations/ReservationsBrowseBlade).

Понятие _зарезервированный экземпляр виртуальной машины Azure_ применяется только к модели ценообразования. Он не влияет на ваши запущенные виртуальные машины. Этот термин относится к Azure и более известен как _зарезервированный экземпляр_ или _резервирование_. Приобретенные зарезервированные экземпляры не применяются к конкретным виртуальным машинам. Они применяются к любой соответствующей виртуальной машине. Например, резервирование для типа виртуальной машины, работающей в регионе, выбранном для приобретенного резервирования.

Приобретенные зарезервированные экземпляры применяются только к базовому оборудованию. Оно не покрывает лицензию на программное обеспечение виртуальных машин. Например, вы можете зарезервировать экземпляр при наличии соответствующей виртуальной машины под управлением Windows. Зарезервированный экземпляр покрывает только базовую стоимость виртуальной машины. В этом примере вы оплачиваете полную стоимость любых необходимых лицензий Windows. Чтобы получить скидку на использование операционной системы или другого программного обеспечения, запущенного на виртуальных машинах, можно использовать [Преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit). Преимущества гибридного использования предлагают аналогичную скидку на ваши лицензии на программное обеспечение, как и зарезервированные экземпляры для базовых виртуальных машин.

Использование зарезервированных экземпляров напрямую не влияет на стоимость. Другими словами, запуск виртуальной машины при использовании всех или никаких ресурсов ЦП имеет тот же эффект: вы предварительно оплачиваете выделение виртуальной машины, а не ее фактическое использование.

Давайте посмотрим, как стандартное использование виртуальных машин по требованию связано с расходами по отношению к зарезервированным экземплярам, на следующем изображении:

![Стоимость использования по запросу и стоимость использования зарезервированных экземпляров](./media/tutorial-optimize-reserved-instances/azure01.png)



Красные полосы представляют собой суммарные затраты на покупку зарезервированного экземпляра. Вы вносите только разовую плату. Виртуальные машины используются бесплатно. Синие полосы представляют собой совокупную стоимость одной и той же виртуальной машины, которая работает с моделью ценообразования с оплатой за использование или по требованию. Где-то между седьмым и восьмым месяцами использования виртуальной машины возникает *точка безубыточности*. Начиная с восьмого месяца вы начинаете экономить деньги в этом примере.

## <a name="benefits-of-ris"></a>Преимущества зарезервированных экземпляров

Каждая покупка зарезервированного экземпляра применяется к виртуальной машине определенного размера и местоположения. Например, D2s\_v3 в расположении "западная часть США", как показано на следующем рисунке:

![Сведения о зарезервированном экземпляре Azure](./media/tutorial-optimize-reserved-instances/azure02.png)

Покупка зарезервированного экземпляра начинает приносить пользу, когда виртуальная машина работает достаточное количество часов, чтобы достичь точки безубыточности резервирования. Виртуальная машина должна соответствовать размеру и местоположению вашего зарезервированного экземпляра. Например, точка безубыточности достигается примерно на седьмой с половиной месяц на предыдущей диаграмме. Таким образом, покупка выгодна, когда виртуальная машина, соответствующая резервированию, работает не менее 7,5 месяцев \* 30 дней \* 24 часа = 5400 часов. Если соответствующая виртуальная машина работает менее 5400 часов, резервирование будет стоить дороже, чем оплата по мере использования.

Точка безубыточности может отличаться для каждого размера виртуальной машины и для каждого местоположения. Это также зависит от вашей согласованной оплаты по мере использования для виртуальной машины. Прежде чем совершить покупку, следует проверить точку безубыточности применительно к вашему случаю.

Еще один момент, который следует учитывать при покупке резервирования, — это область зарезервированного экземпляра. Область определяет, является ли преимущество резервирования общим или применяется к определенной подписке. Общие зарезервированные экземпляры случайным образом применяются ко всем вашим подпискам для первых найденных совпадающих виртуальных машин.

Общее резервирование — самый гибкий вариант. Его рекомендуется выбирать по возможности. Шансы использовать все зарезервированные экземпляры значительно выше при использовании общей области. Если владелец подписки оплачивает зарезервированный экземпляр, у него может не быть другого выбора, кроме как купить его с областью одной подписки.

## <a name="optimize-azure-ri-costs"></a>Оптимизация затрат на использование зарезервированных экземпляров Azure

Cloudyn поддерживает зарезервированные экземпляры и преимущества гибридного использования:

- Отображение затрат, связанных с ценовыми моделями.
- Отслеживание использования зарезервированных экземпляров.
- Оценка эффективности использования зарезервированных экземпляров.
- Распределение затрат за использование зарезервированных экземпляров в соответствии с вашими политиками.

Первым делом, прежде чем приобретать зарезервированный экземпляр, следует оценить эффективность его приобретения:

- Сколько это будет вам стоить?
- Сколько вы сможете сэкономить?
- Что такое точки безубыточности?

Отчет об эффективности покупки зарезервированного экземпляра поможет ответить на эти вопросы.

## <a name="assess-azure-ri-cost-effectiveness"></a>Оценка экономичности использования зарезервированных экземпляров Azure

На портале Cloudyn перейдите к **Optimizer** > **RI Comparison** (Оптимизатор > Сравнение зарезервированных экземпляров), а затем выберите **Reserved Instance Purchase Impact** (Эффективность покупки зарезервированного экземпляра).

На вкладке Reserved Instance Purchase Impact (Эффективность покупки зарезервированного экземпляра) выберите размер виртуальной машины (тип экземпляра), местоположение (регион), период резервирования, количество и ожидаемое время работы. Затем вы можете оценить, сэкономит ли покупка ваши деньги.

Например, если вы покупаете резервирование для виртуальной машины типа DS1\_v2 в восточной части США и она работает круглосуточно целый год, то вы сможете сэкономить 369,48 долларов США в год. Точка безубыточности составит пять месяцев. См. следующее изображение:

![Точка безубыточности зарезервированного экземпляра Azure](./media/tutorial-optimize-reserved-instances/azure03.png)

Однако, если оно работает только 50 % времени, точка безубыточности будет составлять 10 месяцев, а экономия составит всего 49,74 доллара США в год. В этом примере покупка резервирования этого типа экземпляра будет не выгодной. См. следующее изображение:

![Пример точки безубыточности для виртуальных машин Azure](./media/tutorial-optimize-reserved-instances/azure04.png)

## <a name="view-ri-costs"></a>Просмотр затрат на использование зарезервированных экземпляров

При покупке резервирования можно внести однократный платеж. Существует два способа просмотра платежа в Cloudyn:

- Фактическая стоимость.
- Амортизированная стоимость.

### <a name="actual-reserved-instance-cost"></a>Фактическая стоимость зарезервированных экземпляров

В отчетах "Анализ фактической стоимости" и "Анализа за весь период времени" отображается общая сумма, которую вы заплатили за резервирование, начиная с месяца покупки. В них можно просмотреть ваши фактические расходы в течение определенного периода.

На портале Cloudyn выберите **Costs** (Затраты) > **Cost Analysis** (Анализ затрат), а затем выберите **Actual Cost Analysis** (Анализ фактических затрат) или **Actual Cost Over Time** (Анализ за весь период времени). Затем установите фильтры. Например, можно отфильтровать просто службу виртуальной машины или Azure и группировать по типу ресурсов и ценовой модели. См. следующее изображение:

![Пример фактической стоимости зарезервированного экземпляра](./media/tutorial-optimize-reserved-instances/azure05.png)

Вы можете отфильтровать по службе (**​​Azure/VM** (​​Azure/Виртуальная машина) в этом примере) и группировать по фильтру **Ценовая модель** и **Тип ресурса**, как показано на следующем изображении:

![Пример групп и фильтров отчета фактической стоимости с группировкой по ценовой модели и типу ресурса](./media/tutorial-optimize-reserved-instances/azure06.png)

Вы также можете проанализировать тип осуществленных платежей, например разовые оплаты, плату за использование и лицензии.

### <a name="amortized-reserved-instance-cost"></a>Амортизированная стоимость зарезервированных экземпляров

Вы выплачиваете аванс, который виден в месяце покупки зарезервированного экземпляра. Он не отображается в ваших последующих счетах. Таким образом, данные о ежемесячном использовании могут ввести в заблуждение. Фактическая стоимость за месяц использования составляет ежемесячное использование плюс пропорциональная (амортизированная) часть любых ранее осуществленных разовых оплат. Отчет об амортизированной стоимости может помочь вам получить реальную картину.

Чтобы узнать амортизированную стоимость зарезервированного экземпляра, следует взять одноразовый платеж за резервирование и пропорционально распределить его на весь срок резервирования. В отчетах о фактической стоимости одноразовые платежи видны в месяце покупки резервирования. Ежедневные и ежемесячные платежи не отображаются в фактической стоимости развертывания. В отчетах "Амортизированная стоимость" представлена фактическая стоимость развертывания за период времени.  Отчет об амортизированной стоимости — это единственный способ узнать реальные тенденции затрат, а также единственный способ планирования будущих затрат.

В отчете "Фактическая стоимость" вы увидели пик покупки зарезервированного экземпляра 16 ноября в размере 747 долларов США. В отчете "Амортизированная стоимость" (см. следующее изображение) за 16 ноября выставлена частичная стоимость. Начиная с 17 ноября видно, что амортизированная стоимость составляет 747/365 = 2,05 долларов США. Вы также заметили, что приобретенное резервирование не используется, поэтому вы можете оптимизировать его, изменив размер виртуальной машины.

Чтобы просмотреть его, выберите **Costs** (Затраты) > **Cost Analysis** (Анализ затрат), а затем выберите **Amortized Cost Analysis** (Анализ амортизированной стоимости) или **Amortized Cost Over Time** (Амортизированная стоимость за период времени).

![Пример отчета с амортизированной стоимостью зарезервированных экземпляров](./media/tutorial-optimize-reserved-instances/azure07.png)

## <a name="optimize-aws-ri-costs"></a>Оптимизация затрат на использование зарезервированных экземпляров AWS

Зарезервированные экземпляры являются неисполненными обязательствами. Они полезны, когда вы стабильно используете виртуальные машины, так как зарезервированные экземпляры дешевле, чем экземпляры с использованием по требованию. Тем не менее они должны использоваться постоянно. Обязательство состоит в том, чтобы использовать ресурсы, обычно виртуальные машины, в течении определенного периода (один или три года). Когда вы берете на себя обязательство покупать, вы предварительно оплачиваете ресурсы с резервированием. Однако вы не всегда можете полностью использовать зарезервированные ресурсы.

Например, вы можете оценить свою среду и определить, что в течение прошлого года постоянно использовалось 20 стандартных экземпляров D2. Вы можете приобрести резервирование и потенциально сэкономить значительные средства. В другом примере вы могли бы использовать десять экземпляров MA4 за год, но на сегодняшний день использовали всего пять. В обоих примерах показано неэффективное использование резервирования. Существует два способа оптимизации затрат для зарезервированных экземпляров с отчетами оптимизации Cloudyn:

- Просмотреть рекомендации по покупке, исходя из исторических данных об использовании.
- Изменение неиспользуемых резервирований

Используйте отчеты _Рекомендации по покупке резервирования EC2_ и _Неиспользуемые резервирования EC2_ для оптимизации использования зарезервированного экземпляра и затрат.

## <a name="buy-recommended-ris"></a>Покупка рекомендуемых зарезервированных экземпляров

Cloudyn сравнивает использование экземпляра по требованию с потенциально зарезервированными экземплярами. Там, где обнаруживается возможная экономия, в отчете EC2 приводятся рекомендации по покупке.

В меню Reports (Отчеты) в верхней части портала щелкните **Optimizer** > **Pricing Optimization** > **EC2 RI Buying Recommendations** (Оптимизатор > Оптимизация цены > Рекомендации по покупке резервирования EC2).

На следующем рисунке показаны рекомендации по покупке из отчета.

![Пример, в котором показан отчет с рекомендациями по покупке EC2](./media/tutorial-optimize-reserved-instances/aws01.png)

В этом примере учетная запись Cloudyn\_A имеет 32 рекомендации по покупке резервирования. Если вы будете следовать всем рекомендациям по покупке, вы сможете сэкономить 137 770 долларов США в год. Имейте в виду, что рекомендации по покупке, предоставленные Cloudyn, предполагают, что использование ваших рабочих нагрузок будет оставаться неизменным.

Чтобы просмотреть подробности, объясняющие, почему рекомендуется каждая покупка, щелкните символ "плюс" ( **+** ) в разделе **Justifications** (Обоснования). Ниже приведен пример первой рекомендации в списке.

![Пример сведений об обосновании покупки](./media/tutorial-optimize-reserved-instances/aws02.png)

В предыдущем примере показано, что выполнение рабочей нагрузки по запросу будет стоить 90 456 долларов США ежегодно. Однако, если вы приобретете резервирование заранее, такая же рабочая нагрузка будет стоить 56 592 долларов США и сэкономит вам 33 864 долларов США в год.

Щелкните символ "плюс" рядом с **EC2 RI Purchase** (Эффективность покупки резервирования EC2), чтобы просмотреть точку безубыточности в течение года, чтобы увидеть, когда ваши инвестиции в покупку будут реализованы. Примерно через восемь месяцев после совершения покупки накопленная стоимость по требованию начинает превышать накопленную стоимость резервирования в следующем примере:

![Пример сведений об эффективности покупки](./media/tutorial-optimize-reserved-instances/aws03.png)

С этого момента вы начинаете экономить деньги.

Вы можете просмотреть **Instances over Time** (Экземпляры в течение времени), чтобы проверить точность предлагаемой рекомендации по покупке. В этом примере видно, что шесть экземпляров использовались в среднем для рабочей нагрузки за последний 30-дневный период.

![Пример исторических сведений об использовании экземпляров за определенный период времени](./media/tutorial-optimize-reserved-instances/aws04.png)

## <a name="modify-unused-reservations"></a>Изменение неиспользуемых резервирований

Неиспользуемые резервирования распространены во многих облачных вычислительных средах пользователя. Гарантия того, что неиспользованные резервирования будут полностью использованы, может сэкономить вам деньги при изменении резервирования для удовлетворения своих текущих потребностей. Например, у вас может быть подписка, содержащая стандартные экземпляры D3 под управлением Linux. Если резервирование не будет использовать полностью, тип экземпляра можно изменить. Или вы можете переместить неиспользуемые ресурсы в другое резервирование или в другую учетную запись.

AWS продает зарезервированные экземпляры для определенных зон доступности и регионов. Если вы приобрели зарезервированные экземпляры для определенной зоны доступности, вы не можете переместить резервирование между зонами. Однако вы можете легко перемещать региональные зарезервированные экземпляры между зонами, используя отчет **Неиспользуемые резервирования EC2**. Кроме того, можно изменить их региональную область, а затем соответствующие экземпляры будут применяться во всех зонах доступности.

В меню отчетов в верхней части портала, щелкните **Optimizer** > **Inefficiencies** > **EC2 Currently Unused Reservations** (Оптимизатор >Отчет о неэффективности > Неиспользуемые резервирования EC2).

На следующих изображениях представлен отчет с неиспользуемыми зарезервированными экземплярами.

![Пример сводных сведений о неиспользуемых резервированиях](./media/tutorial-optimize-reserved-instances/unused-ri01.png)

Щелкните символ "плюс" в разделе **Details** (Сведения), чтобы просмотреть сведения о конкретном резервировании.

![Пример сведений о неиспользуемых резервированиях](./media/tutorial-optimize-reserved-instances/unused-ri02.png)

В предыдущем примере имеется 77 неиспользуемых резервирований в различных зонах доступности. Первое резервирование содержит 51 неиспользуемый экземпляр. Если посмотреть ниже в списке, есть возможность изменения зарезервированных экземпляров, которые вы можете сделать, используя тип экземпляра **m3.2xlarge** в зоне доступности **us-east-1c**.

Щелкните **Modify** (Изменить) для первого резервирования в списке, чтобы открыть страницу **Modify RI** (Изменение зарезервированного экземпляра), на которой отображаются данные о резервировании.

![Пример списка резервирований, которые можно изменить](./media/tutorial-optimize-reserved-instances/unused-ri03.png)

Перечислены зарезервированные экземпляры, которые вы можете изменить. На следующем изображении виден 51 неиспользуемый экземпляр, которые вы можете изменить, но в двух группах должно быть 54 экземпляра. Если вы измените резервирования, чтобы использовать их все, четыре экземпляра будут продолжать работать по требованию. В этом примере разделите неиспользуемые резервирования, чтобы в первой группе использовалось 30, а во второй 21 экземпляр.

Щелкните символ "плюс" для первой записи резервирования и установите для параметра **Reservation quantity** (Количество резервирований) значение **30**. Для второй записи установите количество резервирований **21**, а затем нажмите кнопку **Apply** (Применить).

![Пример, в котором показано измененное количество резервирований](./media/tutorial-optimize-reserved-instances/unused-ri04.png)

Все неиспользуемые экземпляры резервирования полностью задействованы, а 51 экземпляр больше не запускается по требованию. В этом примере вы экономите деньги своей организации, значительно сокращая использование по требованию за счет резервирований, которые уже оплачены.

## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы успешно выполнили следующие действия:

> [!div class="checklist"]
> * Узнали сведения о затратах на использование зарезервированных экземпляров Azure.
> * Узнали о преимуществах использования зарезервированных экземпляров.
> * Оптимизировали затраты на использование зарезервированных экземпляров Azure.
> * Просмотрели использование зарезервированных экземпляров.
> * Оценили экономичность использования зарезервированных экземпляров Azure.
> * Оптимизировали затраты на использование зарезервированных экземпляров AWS.
> * Купили рекомендуемые зарезервированные экземпляры.
> * Изменили неиспользуемые резервирования.


Перейдите к следующему руководству, чтобы узнать об управлении доступом к данным.

> [!div class="nextstepaction"]
> [Управление доступом к данным](tutorial-user-access.md)
