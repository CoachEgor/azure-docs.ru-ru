---
title: Руководство. Управление затратами с помощью Cloudyn в Azure
description: В рамках этого руководства вы узнаете, как управлять затратами, используя данные отчетов о распределении затрат, возвратных платежах и виртуальных счетах.
author: bandersmsft
ms.author: banders
ms.date: 03/12/2020
ms.topic: tutorial
ms.service: cost-management-billing
ms.custom: seodec18
ms.reviewer: benshy
ROBOTS: NOINDEX
ms.openlocfilehash: a492f611ed5a785ae148894baf3f24c2df773df2
ms.sourcegitcommit: 0947111b263015136bca0e6ec5a8c570b3f700ff
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "79474583"
---
# <a name="tutorial-manage-costs-by-using-cloudyn"></a>Руководство по Управление затратами с помощью Cloudyn

Управление затратами и создание отчетов о возвратных платежах в службе Cloudyn происходит путем распределения расходов на основе тегов. Процесс распределения затрат назначает стоимость использования облачных ресурсов. Затраты будут полностью распределены, когда все ресурсы будут разделены по тегам. После распределения затрат вы можете предоставить своим пользователям возвратные платежи или виртуальные счета с помощью панелей мониторинга и отчетов. Тем не менее многие ресурсы могут быть немаркированными или немаркируемыми при начале использования Cloudyn.

Например, может потребоваться получить возмещение за расходы на проектирование. Необходимо иметь возможность продемонстрировать команде разработчиков, что вам требуется определенная сумма, исходя из стоимости ресурсов. Можно показать им отчет по всем использованным ресурсам, которые маркированы как *проектирование*.

В этой статье теги и категории иногда являются синонимами. Категории — это широкие коллекции, которые могут охватывать множество понятий. Они могут включать бизнес-единицы, центры затрат, веб-службы или все, что можно отметить тегами. Теги — это пары "имя-значение", которые можно назначать множеству ресурсов и групп ресурсов для их категоризации, а также консолидированного отображения данных для выставления счетов и управления ими. В более ранних версиях портала Azure *имя тега* называлось *ключом*. Теги создаются для одной подписки Azure и сохраняются в ней. Теги в AWS состоят из пар "ключ — значение". Так как Azure и AWS использовали термин *ключ*, Cloudyn использует этот термин. Диспетчер категорий использует ключи (имена тегов) для слияния тегов.

В этом руководстве описано следующее:

> [!div class="checklist"]
> * использование пользовательских тегов для распределения затрат;
> * создание отчетов виртуальных счетов и возвратных платежей.

Если у вас еще нет подписки Azure, то прежде чем начинать работу, создайте [бесплатную учетную запись](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).

[!INCLUDE [cloudyn-note](../../../includes/cloudyn-note.md)]

## <a name="prerequisites"></a>Предварительные требования

- Необходимо иметь учетную запись Azure.
- У вас должна быть пробная регистрация либо платная подписка на службу Cloudyn.
- [Неактивные учетные записи должны быть активированы](activate-subs-accounts.md) на портале Cloudyn.
- [Мониторинг на гостевом уровне](azure-vm-extended-metrics.md) должен быть включен на виртуальных машинах.


## <a name="use-custom-tags-to-allocate-costs"></a>Распределение затрат с помощью пользовательских тегов

Cloudyn получает данные тегов группы ресурсов из Azure и автоматически распространяет сведения о теге на ресурсы. В распределении затрат расходы отображаются по тегам ресурсов.

Используя модель распределения затрат, вы определяете категории (теги), которые применяются к ресурсам без категорий (без тегов) изнутри, чтобы сгруппировать затраты и определить правила для обработки затрат без тегов. Правила распределения затрат — это сохраненные инструкции, в которых расходы на службу распределяются на другую службу. Впоследствии для этих ресурсов отображаются теги или категории в отчетах о *распределении затрат* в соответствии с созданной моделью.

Следует учитывать, что сведения о теге не отображаются для этих ресурсов в отчетах об *анализе затрат*. Кроме того, примененные в Cloudyn теги с использованием распределения затрат не отправляются в Azure, поэтому они не отображаются на портале Azure.

При запуске распределения затрат сначала нужно определить область с помощью использования модели затрат. Модель затрат не меняет затраты, она распределяет их. При создании модели затрат можно сегментировать данные по сущности затрат, учетной записи или подписке и по нескольким тегам. Распространенные примеры тегов могут включать код выставления счета, место возникновения затрат или имя группы. Теги также позволяют выставлять виртуальные счета или выполнять возвратные платежи для других подразделений организации.

Чтобы создать настраиваемую модель распределения затрат, выберите **Стоимость** &gt; **Управление затратами** &gt; **Cost Allocation 360°** (Комплексное распределение затрат) в меню отчета.

![Пример панели мониторинга, на которой можно выбрать комплексное распределение затрат](./media/tutorial-manage-costs/cost-allocation-360.png)

На странице **Cost Allocation 360** (Комплексное распределение затрат) выберите **Добавить**, а затем введите имя и описание модели затрат. Выберите все учетные записи или отдельные учетные записи. Если вы хотите использовать отдельные учетные записи, вы можете выбрать несколько учетных записей из нескольких поставщиков облачных служб. Затем выберите **Категоризация**, чтобы выбрать обнаруженные теги, которые классифицируют ваши сведения о затратах. Выберите теги (категории), которые требуется включить в модель. В следующем примере выбран тег **Единица**.

![Пример классификации модели затрат](./media/tutorial-manage-costs/cost-model01.png)

В примере показано, что 19 680 долл. США не имеют категории (без тегов).

Затем выберите **Uncategorized Resources** (Ресурсы без категории) и выберите службы, у которых есть не распределенные затраты. Затем определите правила для распределения затрат.

Например, вы можете распределить затраты на службу хранилища Azure поровну между всеми виртуальными машинами Azure. Чтобы сделать это, выберите службу **Azure/Storage** (Azure или хранилище), выберите **Proportional to Categorized** (Пропорционально по категориям), а затем — **Azure/VM** (Azure или виртуальная машина). Затем выберите **Создать**.

![Пример правила распределения модели затрат для равного распределения](./media/tutorial-manage-costs/cost-model02.png)



В другом примере может потребоваться выделить все расходы на сеть Azure для подразделения в организации. Чтобы сделать это, выберите службу **Azure/Network** (Azure или сеть), а затем в разделе **Define Allocation Rule** (Определение правила распределение) щелкните **Explicit Distribution** (Явное распределение). Затем задайте процент распределения равный 100 и выберите подразделение — **G&amp;A** на следующем рисунке:

![Пример правила распределения модели затрат для конкретного подразделения](./media/tutorial-manage-costs/cost-model03.png)



Для всех остальных ресурсов без категории создайте дополнительные правила распределения.

При наличии любых нераспределенных зарезервированных экземпляров Amazon Web Services (AWS) их можно назначить категориям с тегами, содержащим **Reserved Instances** (Зарезервированные экземпляры).

Чтобы просмотреть сведения о параметрах, выбранных для распределения затрат, выберите **Сводка**. Чтобы сохранить данные и продолжить работу над дополнительными правилами позднее, выберите **Save As Draft** (Сохранить как черновик). Чтобы сохранить данные и запустить обработку модели распределения затрат в Cloudyn, выберите **Save and Activate** (Сохранить и активировать).

В списке моделей затрат будет показана новая модель и ее **состояние обработки**. Обновление модели затрат в базе данных Cloudyn может занять некоторое время. По завершении обработки состояние будет обновлено до **Завершено**. Вы можете просматривать данные из модели затрат в отчете анализа затрат в разделе **Extended Filters** &gt; **Cost Model** (Расширенные фильтры > Модель затрат).

### <a name="category-manager"></a>Диспетчер категорий

Диспетчер категорий — это средство очистки данных, которое позволяет объединять несколько категорий (теги) для создания новых значений. Это простое средство на основе правил, в котором выбирается категория и создаются правила для объединения имеющихся значений. Например, у вас могут быть категории для **R&amp;D** и **dev**, которые представляют собой группы разработки.

На портале Cloudyn щелкните символ шестеренки справа вверху и выберите **Category Manager** (Диспетчер категорий). Чтобы создать новую категорию, выберите символ "плюс" ( **+** ). Введите имя категории, а затем в разделе **Ключи** введите ключи категории, которые нужно включить в новую категорию.

При определении правила можно добавить несколько значений с условием "ИЛИ". Кроме того, можно выполнить некоторые основные операции над строками. В обоих случаях щелкните символ многоточия ( **...** ) справа от **правила**.

Чтобы определить новое правило, в области **Правила** создайте правило. Например, введите **dev** в разделе **Правила**, а затем **R&amp;D** в разделе **Действия**. Когда вы закончите, сохраните новую категорию.

На следующем рисунке показан пример правил, созданных для новой категории **Work-Load**:

![Пример новой категории рабочей нагрузки](./media/tutorial-manage-costs/category01.png)

### <a name="tag-sources-and-reports"></a>Добавление тегов к источникам и отчетам

Данные тегов, отображаемых в отчетах Cloudyn, поступают из трех расположений:

- интерфейсы API ресурсов поставщика облачных служб;
- интерфейсы API выставления счетов поставщика облачных служб;
- созданные вручную теги из следующих источников:
    - теги сущностей Cloudyn — определяемые пользователем метаданные, применяемые к сущностям Cloudyn;
    - диспетчер категорий — инструмент очистки данных, который создает новые теги на основе правил, применяемых к существующим тегам.

Чтобы отображать теги поставщика облачных служб в отчетах о затратах Cloudyn, необходимо создать пользовательскую модель распределения затрат с помощью Cost Allocation 360. Для этого выберите **Стоимость** > **Управление затратами** > **Cost Allocation 360** (Комплексное распределение затрат), выберите нужные теги, а затем определите правила для обработки затрат без тегов. Затем создайте модель затрат. После этого вы сможете просматривать отчеты об анализе распределения затрат, используя фильтрацию и сортировку по тегам ресурсов Azure.

Теги ресурсов Azure отображаются только в отчетах, к которым можно перейти, щелкнув **Стоимость** > **Анализ распределения затрат**.

Теги выставления счетов поставщика облачных служб отображаются во всех отчетах о затратах.

Теги сущностей Cloudyn и теги, созданные пользователем вручную, отображаются во всех отчетах о затратах.


## <a name="create-showback-and-chargeback-reports"></a>Создание отчетов о возвратных платежах и виртуальных счетах

Методы, с помощью которых организации создают отчеты возвратных платежей и виртуальных счетов, сильно различаются. Тем не менее вы можете использовать любую из панелей мониторинга и отчетов на портале Cloudyn в качестве основы для нужной цели. Можно предоставить доступ любому пользователю в организации, чтобы он мог просматривать панели мониторинга и отчеты по запросу. Все отчеты анализа затрат поддерживают виртуальные счета, так как они показывают пользователям использованные ресурсы. Они также позволяют подробно изучить затраты и данные об использовании конкретно для их группы в организации.

Чтобы просмотреть результаты распределения затрат, откройте отчет анализа затрат и выберите созданную модель затрат. Затем добавьте группировку по одному или нескольким тегам, выбранным в модели затрат.

![Отчет анализа затрат с примером данных для новых затрат](./media/tutorial-manage-costs/cost-analysis.png)

Вы можете легко создавать и сохранять отчеты, которые рассматривают определенные службы, используемые определенными группами. Например, у вас может быть подразделение, которое активно использует виртуальные машины Azure. Вы можете создать отчет, который отфильтрован по виртуальным машинам Azure, чтобы показать потребление и затраты.

Если необходимо предоставить данные моментального снимка другим командам, вы можете экспортировать любой отчет в формате CSV или PDF.


## <a name="next-steps"></a>Дальнейшие действия

В этом руководстве вы узнали, как выполнять следующие задачи:

> [!div class="checklist"]
> * использование пользовательских тегов для распределения затрат;
> * создание отчетов виртуальных счетов и возвратных платежей.



Перейдите к следующему руководству, чтобы узнать об управлении доступом к данным.

> [!div class="nextstepaction"]
> [Управление доступом к данным](tutorial-user-access.md)
