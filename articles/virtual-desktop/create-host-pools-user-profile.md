---
title: Создание контейнера профиля Фслогикс для пула узлов с помощью общей папки на основе виртуальной машины в Azure
description: Как настроить контейнер Фслогикс Profile для пула узлов виртуальных рабочих столов Windows с помощью общей папки на основе виртуальной машины.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: conceptual
ms.date: 08/20/2019
ms.author: helohr
ms.openlocfilehash: 0e7516fc4874e4cbc387f2f494efc6ef745d64f7
ms.sourcegitcommit: 9dec0358e5da3ceb0d0e9e234615456c850550f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/14/2019
ms.locfileid: "72311589"
---
# <a name="create-a-profile-container-for-a-host-pool-using-a-file-share"></a>Создание контейнера профиля для пула узлов с помощью общей папки

Служба виртуальных рабочих столов Windows предлагает контейнеры профилей Фслогикс в качестве рекомендуемого решения для профилей пользователей. Не рекомендуется использовать решение "диск профиля пользователя" (UPD), которое будет считаться устаревшим в будущих версиях виртуальных рабочих столов Windows.

Из этой статьи вы узнаете, как настроить общую папку контейнера профилей Фслогикс для пула узлов с помощью общей папки на основе виртуальной машины. Дополнительную документацию по Фслогикс см. на [сайте фслогикс](https://docs.fslogix.com/).

>[!NOTE]
>Если вы ищете сравнительные материалы о различных вариантах хранения контейнера профиля Фслогикс в Azure, см. статью [Параметры хранилища для контейнеров профилей фслогикс](store-fslogix-profile.md).

## <a name="create-a-new-virtual-machine-that-will-act-as-a-file-share"></a>Создание новой виртуальной машины, которая будет использоваться в качестве файлового ресурса

При создании виртуальной машины убедитесь, что она размещена в той же виртуальной сети, что и виртуальные машины пула узлов, или в виртуальной сети с подключением к виртуальным машинам пула узлов. Создать виртуальную машину можно несколькими способами.

- [Создание виртуальной машины из образа из коллекции Azure](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#create-virtual-machine)
- [Создание виртуальной машины из управляемого образа](https://docs.microsoft.com/azure/virtual-machines/windows/create-vm-generalized-managed)
- [Создание виртуальной машины из неуправляемого образа](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vm-from-user-image)

После создания виртуальной машины присоедините ее к домену, выполнив следующие действия.

1. [Подключитесь к виртуальной машине](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine) с помощью учетных данных, указанных при создании виртуальной машины.
2. На виртуальной машине откройте **Панель управления** и выберите пункт **система**.
3. Выберите **имя компьютера**, щелкните **изменить параметры**, а затем выберите **изменить...**
4. Выберите **домен** , а затем введите домен Active Directory в виртуальной сети.
5. Проверка подлинности с учетной записью домена, имеющей права на присоединение к домену компьютеров.

## <a name="prepare-the-virtual-machine-to-act-as-a-file-share-for-user-profiles"></a>Подготовка виртуальной машины к использованию в качестве файлового ресурса для профилей пользователей

Ниже приведены общие инструкции по подготовке виртуальной машины к использованию в качестве файлового ресурса для профилей пользователей.

1. Добавьте пользователей Windows Virtual Desktop Active Directory в [группу безопасности Active Directory](https://docs.microsoft.com/windows/security/identity-protection/access-control/active-directory-security-groups). Эта группа безопасности будет использоваться для проверки подлинности пользователей виртуальных рабочих столов Windows на только что созданной виртуальной машине с общей папкой.
2. [Подключитесь к виртуальной машине с общей папкой](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine).
3. На виртуальной машине с общей папкой создайте папку на **диске C** , которая будет использоваться в качестве общего ресурса профиля.
4. Щелкните правой кнопкой мыши новую папку, выберите пункт **Свойства**, выберите **Общий**доступ, а затем щелкните **Расширенный общий доступ.** ...
5. Выберите **общий доступ к этой папке**, выберите **разрешения...** , а затем нажмите кнопку **Добавить...** .
6. Найдите группу безопасности, в которую вы добавили пользователей виртуальных рабочих столов Windows, а затем убедитесь, что группа имеет **полный доступ**.
7. После добавления группы безопасности щелкните правой кнопкой мыши папку, выберите пункт **Свойства**, выберите **общий доступ**, а затем скопируйте **сетевой путь** , который будет использоваться для дальнейшего использования.

Дополнительные сведения о разрешениях см. в [документации по фслогикс](https://docs.microsoft.com/fslogix/fslogix-storage-config-ht).

## <a name="configure-the-fslogix-profile-container"></a>Настройка контейнера профиля Фслогикс

Чтобы настроить виртуальные машины с помощью программного обеспечения Фслогикс, выполните следующие действия на каждом компьютере, зарегистрированном в пуле узлов:

1. [Подключитесь к виртуальной машине](https://docs.microsoft.com/azure/virtual-machines/windows/quick-create-portal#connect-to-virtual-machine) с помощью учетных данных, указанных при создании виртуальной машины.
2. Запустите Интернет браузер и перейдите по [этой ссылке](https://go.microsoft.com/fwlink/?linkid=2084562) , чтобы скачать агент фслогикс.
3. Перейдите в файл \\ @ no__t-1Win32 @ no__t-2Release или \\ @ no__t-4X64 @ no__t-5Release в файле zip и запустите **фслогиксаппссетуп** , чтобы установить агент фслогикс.  Дополнительные сведения об установке Фслогикс см. в статье [Загрузка и установка фслогикс](https://docs.microsoft.com/fslogix/install-ht).
4. Перейдите в раздел **Program files** > **фслогикс** **приложения**  > , чтобы подтвердить установку агента.
5. В меню Пуск запустите **программу Regedit** от имени администратора. Перейдите в раздел **Computer @ no__t-1HKEY_LOCAL_MACHINE @ no__t-2software @ no__t-3FSLogix**.
6. Создайте ключ с именем **Profiles**.
7. Создайте следующие значения для ключа Profiles:

| ИМЯ                | Type               | Данные и значение                        |
|---------------------|--------------------|-----------------------------------|
| Enabled             | DWORD              | 1                                 |
| вхдлокатионс        | Многострочное значение | "Сетевой путь к общей папке"     |

>[!IMPORTANT]
>Чтобы усилить защиту среды Виртуального рабочего стола Windows в Azure, мы рекомендуем не открывать входящий порт 3389 для виртуальных машин. Виртуальный рабочий стол Windows не требует открытия входящего порта 3389, чтобы пользователи могли получить доступ к виртуальным машинам пула узла. Если вам все же нужно открыть порт 3389 для устранения неполадок, мы рекомендуем использовать[JIT-доступ к виртуальным машинам](../security-center/security-center-just-in-time.md).
