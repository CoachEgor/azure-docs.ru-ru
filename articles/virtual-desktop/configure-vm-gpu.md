---
title: Настройка графического процессора для виртуального рабочего стола Windows - Azure
description: Как включить gPU-ускоренную визуализацию и кодирование в Windows Virtual Desktop.
services: virtual-desktop
author: gundarev
ms.service: virtual-desktop
ms.topic: conceptual
ms.date: 05/06/2019
ms.author: denisgun
ms.openlocfilehash: 8b675a78041b68210fa7583510582783c506c720
ms.sourcegitcommit: d57d2be09e67d7afed4b7565f9e3effdcc4a55bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "81767043"
---
# <a name="configure-graphics-processing-unit-gpu-acceleration-for-windows-virtual-desktop"></a>Настройка графического процессора (GPU) ускорение для Windows Virtual Desktop

Windows Virtual Desktop поддерживает gPU-ускоренную визуализацию и кодирование для повышения производительности и масштабируемости приложений. Ускорение GPU особенно важно для графических приложений.

Следуйте инструкциям в этой статье, чтобы создать gPU оптимизированной Azure виртуальную машину, добавить его в пул хоста, и настроить его на использование ускорения GPU для рендеринга и кодирования. Эта статья предполагает, что у вас уже есть windows Virtual Desktop арендатора настроен.

## <a name="select-a-gpu-optimized-azure-virtual-machine-size"></a>Выберите графический процессор оптимизированный размер виртуальной машины Azure

Azure предлагает ряд [gPU оптимизированных виртуальных размеров машины.](/azure/virtual-machines/windows/sizes-gpu) Правильный выбор пула хост зависит от ряда факторов, включая рабочие нагрузки приложения, желаемое качество пользовательского интерфейса и стоимость. В целом, более крупные и более способные графические процессоры обеспечивают лучший пользовательский опыт при заданной плотности пользователей.

## <a name="create-a-host-pool-provision-your-virtual-machine-and-configure-an-app-group"></a>Создайте пул хоста, предоставить виртуальную машину и настроить группу приложений

Создайте новый пул хоста, используя выбранный вами VM размера. Для получения инструкций [см.](/azure/virtual-desktop/create-host-pools-azure-marketplace)

Windows Virtual Desktop поддерживает gPU-ускоренную визуализацию и кодирование в следующих операционных системах:

* Windows 10 версия 1511 или новее
* Windows Server 2016 или поздней версии.

Необходимо также настроить группу приложений или использовать группу настольных приложений по умолчанию (названную "Desktop Application Group"), которая автоматически создается при создании нового пула хоста. Для получения инструкций [см.](/azure/virtual-desktop/manage-app-groups)

## <a name="install-supported-graphics-drivers-in-your-virtual-machine"></a>Установка поддерживаемых графических драйверов в виртуальной машине

Чтобы воспользоваться возможностями графического процессора VMs-миков серии Azure N в Windows Virtual Desktop, необходимо установить соответствующие графические драйверы. Следуйте инструкциям в [поддерживаемых операционных системах и драйверах](/azure/virtual-machines/windows/sizes-gpu#supported-operating-systems-and-drivers) для установки драйверов от соответствующего поставщика графики, либо вручную, либо с помощью расширения Azure VM.

Только драйверы, распространяемые Azure, поддерживаются для Windows Virtual Desktop. Кроме того, для Пазур VMs с gUs NVIDIA поддерживаются только [драйверы NVIDIA GRID](/azure/virtual-machines/windows/n-series-driver-setup#nvidia-grid-drivers) для Windows Virtual Desktop.

После установки драйвера требуется перезагрузка VM. Используйте шаги проверки в вышеуказанных инструкциях, чтобы подтвердить, что графические драйверы были успешно установлены.

## <a name="configure-gpu-accelerated-app-rendering"></a>Настройка gPU-ускоренного рендеринга приложений

По умолчанию приложения и настольные компьютеры, работающие в многосессионных конфигурациях, отображаются с помощью процессора и не используют доступные графические процессоры для рендеринга. Настройка групповой политики для хостеа сессии для обеспечения ускоренной визуализации gPU:

1. Подключайтесь к рабочему столу VM с помощью учетной записи с локальными привилегиями администратора.
2. Откройте меню «Пуск» и введите «gpedit.msc», чтобы открыть редактор группы политики.
3. Перейдите по дереву в **Компьютерную конфигурацию** > **Административных шаблонов** > **Windows Компоненты** > **Удаленного настольного обслуживания** > **удаленного рабочего стола Сессия Удаленного** > **сессии среды.**
4. Выберите политику **Используйте графический адаптер аппаратного средства по умолчанию для всех сеансов удаленного рабочего стола** и установите эту политику для **включения** рендеринга графического процессора в удаленном сеансе.

## <a name="configure-gpu-accelerated-frame-encoding"></a>Настройка кодирования процессора GPU-ускоренного каркаса

Удаленный рабочий стол кодирует всю графику, отображаемую приложениями и настольными компьютерами (будь то с помощью графического процессора или с процессором) для передачи клиентам Remote Desktop. По умолчанию Remote Desktop не использует доступные графические процессоры для этого кодирования. Настройте групповую политику для хостеа сессии, чтобы включить кодирование кадра с gPU ускоренным. Продолжение вышеуказанных шагов:

1. Выберите политику **Приоритетности режима Графики H.264/AVC 444 для удаленного соединения на рабочем столе** и установите эту политику, чтобы **заставить** кодек H.264/AVC 444 в удаленном сеансе.
2. Выберите политику **Настройка H.264/AVC аппаратного кодирования для удаленного соединения рабочего стола** и установить эту политику **для включения** аппаратного кодирования для AVC/H.264 в удаленном сеансе.

    >[!NOTE]
    >В Windows Server 2016, набор опции **Предпочитаю AVC оборудование кодирования** **всегда попытка**.

3. Теперь, когда политики группы были отредактированы, принудите обновление групповой политики. Откройте командный запрос и введите:

    ```batch
    gpupdate.exe /force
    ```

4. Выйти из сеанса удаленного рабочего стола.

## <a name="verify-gpu-accelerated-app-rendering"></a>Проверка рендеринга приложений с ускорением gPU

Чтобы убедиться, что приложения используют графический процессор для рендеринга, попробуйте любой из следующих:

* Для Пазуры VMs с графическим процессором NVIDIA используйте `nvidia-smi` утилиту, описанную в [установке драйвера Verify,](/azure/virtual-machines/windows/n-series-driver-setup#verify-driver-installation) для проверки использования графического процессора при запуске приложений.
* В поддерживаемых версиях операционной системы можно использовать диспетчера задач для проверки использования графического процессора. Выберите графический процессор во вкладке "Производительность", чтобы узнать, используют ли приложения графический процессор.

## <a name="verify-gpu-accelerated-frame-encoding"></a>Проверка кодирования процессора GPU-ускоренной рамой

Чтобы убедиться, что удаленный рабочий стол использует кодирование GPU-ускоренного использования:

1. Подключайтесь к рабочему столу VM с помощью клиента Windows Virtual Desktop.
2. Запустите Viewer события и перейдите на следующий узло: **Приложения и службы Журналы** > **Microsoft** > **Windows** > **RemoteDesktopServices-RdpCoreCDV** > **Операционный**
3. Чтобы определить, используется ли кодирование GPU, ищите идентификатор событий 170. Если вы видите "AVC аппаратного кодера включен: 1", то кодирование gPU используется.
4. Чтобы определить, используется ли режим AVC 444, ищите идентификатор событий 162. Если вы видите "AVC Доступно: 1 Первоначальный профиль: 2048", то AVC 444 используется.

## <a name="next-steps"></a>Следующие шаги

Эти инструкции должны иметь вас и работает с ускорением GPU на одном хосте сессии (один VM). Некоторые дополнительные соображения для обеспечения ускорения графического процессора в большом пуле хостов:

* Рассмотрите возможность использования [расширения VM](/azure/virtual-machines/extensions/overview) для упрощения установки драйверов и обновлений в нескольких вдыхать их. Используйте [расширение драйвера NVIDIA GPU](/azure/virtual-machines/extensions/hpccompute-gpu-windows) для VMs с графическими процессорами NVIDIA и используйте расширение драйвера GPU AMD (скоро) для ВМ с графическими процессорами AMD.
* Рассмотрите возможность использования политики группы Active Directory для упрощения конфигурации групповой политики в ряде внештатных внешёв. Для получения информации о развертывании групповой политики в домене Active Directory [см.](https://go.microsoft.com/fwlink/p/?LinkId=620889)
