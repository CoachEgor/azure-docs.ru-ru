---
title: Настройка GPU для Windows виртуального рабочего стола предварительной версии — Azure
description: Как включить GPU-ускоренная отрисовка и кодировании в Апробация виртуального рабочего стола Windows.
services: virtual-desktop
author: gundarev
ms.service: virtual-desktop
ms.topic: how-to
ms.date: 05/06/2019
ms.author: denisgun
ms.openlocfilehash: a6a67c89253a1b16f9266d7917655d1b1104022e
ms.sourcegitcommit: f6ba5c5a4b1ec4e35c41a4e799fb669ad5099522
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2019
ms.locfileid: "65159575"
---
# <a name="configure-graphics-processing-unit-gpu-acceleration-for-windows-virtual-desktop-preview"></a>Настройка графических процессоров ускорение графического процессора для Апробация виртуального рабочего стола Windows

Обзор виртуального рабочего стола Windows поддерживает GPU-ускоренная отрисовка и кодировку для Повышенная производительность приложения и масштабируемость. Ускорение GPU особенно важно для насыщенных графикой приложений.

Следуйте инструкциям в этой статье, чтобы создать виртуальную машину Azure оптимизированные для GPU, добавьте его в пул узла и настройте его для использования ускорение GPU, кодирование и отрисовка. В этой статье предполагается, что у вас уже есть настроенный клиент виртуального рабочего стола Windows.

## <a name="select-a-gpu-optimized-azure-virtual-machine-size"></a>Выберите размер виртуальной машины Azure, оптимизированные для GPU

Azure предлагает ряд [размеры виртуальных машин, оптимизированных для GPU](/azure/virtual-machines/windows/sizes-gpu). Правильный выбор для узла пула зависит от ряда факторов, включая ваши рабочие нагрузки конкретного приложения, желаемое качество взаимодействия с пользователем и затрат. Как правило крупных и более производительные процессоры предлагают удобства работы пользователя с плотностью данному пользователю.

## <a name="create-a-host-pool-provision-your-virtual-machine-and-configure-an-app-group"></a>Создание пула узла, виртуальной машины и настроить группу приложений

Создание пула узла с помощью виртуальной Машины выбранного размера. Инструкции см. в разделе [руководства: Создание пула узла с помощью Azure Marketplace](/azure/virtual-desktop/create-host-pools-azure-marketplace).

Обзор виртуального рабочего стола Windows поддерживает GPU-ускоренная отрисовка и кодировании в следующих операционных систем:

* Windows 10 версии 1511 или более поздней версии
* Windows Server 2016 или поздней версии.

Также необходимо настроить группу приложений или использовать группу по умолчанию классического приложения (с именем» Группа приложений рабочего стола «), создается автоматически при создании нового пула узлов. Инструкции см. в разделе [руководства: Управление группами приложений для Апробация виртуального рабочего стола Windows](/azure/virtual-desktop/manage-app-groups).

>[!NOTE]
>Обзор виртуального рабочего стола Windows поддерживает только тип группы приложения «Рабочий стол» для пулов узлов с поддержкой GPU. Группы приложений типа «RemoteApp» не поддерживаются для пулов узлов с поддержкой GPU.

## <a name="install-supported-graphics-drivers-in-your-virtual-machine"></a>Установить поддерживаемые графические драйверы на виртуальной машине

Чтобы воспользоваться преимуществами возможностей GPU виртуальных машин Azure серии N в Апробация виртуального рабочего стола Windows, необходимо установить графические драйверы NVIDIA. Следуйте инструкциям в [драйверы NVIDIA GPU, установить на виртуальных машинах серии N под управлением Windows](/azure/virtual-machines/windows/n-series-driver-setup) для установки драйверов, либо вручную или с помощью [расширение драйвер GPU NVIDIA](/azure/virtual-machines/extensions/hpccompute-gpu-windows).

Обратите внимание, что только [драйверы NVIDIA GRID](/azure/virtual-machines/windows/n-series-driver-setup#nvidia-grid-drivers) распространяются компанией Azure поддерживаются для Апробация виртуального рабочего стола Windows.

После установки драйвера требуется перезагрузка виртуальной Машины. Следуйте инструкциям проверки в инструкциях выше, чтобы подтвердить, что графические драйверы были успешно установлены.

## <a name="configure-gpu-accelerated-app-rendering"></a>Настройка ускорением GPU в приложении

По умолчанию приложений и настольных компьютеров в нескольких сеансов конфигурациях подготавливаются к просмотру с ЦП и не требуется использование доступных процессоров для подготовки к просмотру. Настройте групповую политику для узла сеансов включить отрисовку с аппаратным ускорением GPU:

1. Подключение к рабочему столу виртуальной машины, используя учетную запись с правами локального администратора.
2. Откройте Пуск меню и введите «gpedit.msc» чтобы открыть редактор групповой политики.
3. Дерево для **Конфигурация компьютера** > **административные шаблоны** > **компоненты Windows**  >   **Службы удаленных рабочих столов** > **узла сеансов удаленных рабочих столов** > **среде удаленного сеанса**.
4. Выберите политику **использовать графический адаптер оборудования по умолчанию для всех сеансов служб удаленных рабочих столов** и указать для этой политики **включено** для включения отрисовки GPU в удаленном сеансе.

## <a name="configure-gpu-accelerated-frame-encoding"></a>Настройка кодирования для кадра с ускорением GPU

Удаленный рабочий стол кодирует все графики, преобразовываемый для просмотра приложений и настольных компьютеров (ли к просмотру с помощью GPU или ЦП) для передачи на клиентах удаленного рабочего стола. По умолчанию удаленного рабочего стола не используют GPU, доступных для данной кодировки. Настройте групповую политику для узла сеансов для включения кодирования кадр с ускорением GPU. Продолжить описанные выше действия:

1. Выберите политику **режим определения приоритетов H.264/AVC 444 графики для подключений удаленного рабочего стола** и указать для этой политики **включено** для принудительного кодек H.264/AVC 444 в удаленном сеансе.
2. Выберите политику **H.264/AVC, Настройка оборудования, кодировку для подключений удаленного рабочего стола** и указать для этой политики **включено** Включение оборудования кодирования для кодеков AVC/H.264 в удаленном сеансе.

    >[!NOTE]
    >В Windows Server 2016, задайте параметр **предпочитать кодирование оборудования AVC** для **попытки всегда**.

3. Теперь, когда групповые политики были изменены, принудительное обновление групповой политики. Откройте командную строку и введите:

    ```batch
    gpupdate.exe /force
    ```

4. Выйдите из сеанса удаленного рабочего стола.

## <a name="verify-gpu-accelerated-app-rendering"></a>Проверьте ускорением GPU в приложении

Чтобы убедиться, что приложения, используют GPU для подготовки к просмотру, попробовать выполните одно из следующих:

* Используйте `nvidia-smi` служебной программы, как описано в разделе [проверка установки драйвера](/azure/virtual-machines/windows/n-series-driver-setup#verify-driver-installation) для проверки использования GPU при запуске приложения.
* В поддерживаемых версиях операционных систем можно использовать диспетчер задач, проверяемый на возможность использования GPU. Выберите вкладку «Производительность», чтобы увидеть, ли приложения, которые используют GPU GPU.

## <a name="verify-gpu-accelerated-frame-encoding"></a>Проверить кодировку кадр с ускорением GPU

Чтобы убедиться, что удаленный рабочий стол использует ускорением GPU кодирования:

1. Подключение к рабочему столу виртуальной машины с помощью клиента виртуального рабочего стола Windows.
2. Запустить программу просмотра событий и перейдите к следующему узлу: **Журналы приложений и служб** > **Microsoft** > **Windows** > **RemoteDesktopServices-RdpCoreTS**  >  **Operational**
3. Чтобы определить, если используется кодировка ускорением GPU, найдите событие с Идентификатором 170. Если вы видите «кодировщик оборудования AVC включен: используется 1", а затем кодирование GPU.
4. Чтобы определить, если используется режим AVC 444, найдите событие с Идентификатором 162. Если вы видите «AVC доступно: 1 начальной профиль: 2048" AVC 444 используется.

## <a name="next-steps"></a>Дальнейшие действия

Эти инструкции должно быть вам приступить к работе с ускорение графического Процессора на узле один сеанс виртуальной Машины. Некоторые дополнительные соображения по включению ускорение графического Процессора в пуле большего размера узла:

* Рассмотрите возможность использования [расширение драйвер GPU NVIDIA](/azure/virtual-machines/extensions/hpccompute-gpu-windows) для упрощения установки драйверов и обновлений на нескольких виртуальных машин.
* Рассмотрите возможность использования групповой политики Active Directory для упрощения настройки групповых политик на нескольких виртуальных машин. Сведения о развертывании групповой политики в домене Active Directory, см. в разделе [работа с объектами групповой политики](https://go.microsoft.com/fwlink/p/?LinkId=620889).
