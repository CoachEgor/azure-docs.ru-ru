---
title: Диагностика проблем с производительностью графики Remote Desktop - Azure
description: В этой статье описывается, как использовать графические счетчики RemoteFX в удаленных сеансах протоколов рабочего стола для диагностики проблем с производительностью с помощью графики в Windows Virtual Desktop.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: troubleshooting
ms.date: 05/23/2019
ms.author: helohr
manager: lizross
ms.openlocfilehash: 84cee86dbddff77f6142925eec01889cf793a466
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "79127554"
---
# <a name="diagnose-graphics-performance-issues-in-remote-desktop"></a>Диагностика проблем с производительностью графики в удаленном рабочем столе

Для диагностики проблем качества с помощью удаленных сеансов счетчики предоставляются в разделе RemoteFX Graphics монитора производительности. Эта статья поможет вам определить и исправить связанные с графикой узкие места производительности во время сеансов удаленного протокола рабочего стола (RDP) с помощью этих счетчиков.

## <a name="find-your-remote-session-name"></a>Найдите имя сеанса удаленного

Для определения счетчиков производительности графики вам понадобится удаленное имя сеанса. Следуйте инструкциям в этом разделе, чтобы определить ваш экземпляр каждого счетчика.

1. Откройте запрос команды Windows из удаленного сеанса.
2. Запустите команду **qwinsta** и найдите имя сеанса.
    - Если сеанс размещается в многосессионном виртуальном компьютере (VM): Ваш экземпляр каждого счетчика суффиксируется тем же номером, который суффиксирует ваше имя сеанса, например "rdp-tcp 37".
    - Если сеанс размещается в VM, который поддерживает виртуальные единицы обработки графики (vGPU): Ваш экземпляр каждого счетчика хранится на сервере, а не в вашем VM. В контрэкземпляры входят имя VM вместо номера в названии сеанса, например "Win8 Enterprise VM".

>[!NOTE]
> Хотя счетчики имеют RemoteFX в их именах, они включают удаленную графику рабочего стола в сценариях vGPU также.

## <a name="access-performance-counters"></a>Счетчики производительности доступа

После того, как вы определили имя удаленной сессии, следуйте этим инструкциям, чтобы собрать счетчики производительности RemoteFX Graphics для удаленной сессии.

1. Выберите монитор**производительности****административных инструментов** >  **Start.** > 
2. В диалоговом окне **монитора производительности** расширьте **инструменты мониторинга,** выберите **монитор производительности,** а затем выберите **Добавить.**
3. В диалоговом окне **Add Counters** из списка **доступных счетчиков** расширьте раздел для RemoteFX Graphics.
4. Выберите счетчики для мониторинга.
5. В **списках выбранных объектов** выберите конкретные экземпляры, которые будут контролироваться для выбранных счетчиков, а затем выберите **Добавить**. Чтобы выбрать все доступные контратемеры, выберите **все экземпляры.**
6. После добавления счетчиков выберите **OK**.

Выбранные счетчики производительности будут отображаться на экране монитора производительности.

>[!NOTE]
>Каждый активный сеанс на хосте имеет свой собственный экземпляр каждого счетчика производительности.

## <a name="diagnose-issues"></a>Диагностика проблем

Проблемы производительности, связанные с графикой, как правило, делятся на четыре категории:

- Низкая частота кадров
- Случайные киоски
- Высокая задержка ввода
- Плохое качество кадра

### <a name="addressing-low-frame-rate-random-stalls-and-high-input-latency"></a>Решение проблемы низкой частоты кадров, случайных киосков и высокой задержки ввода

Сначала проверьте выводные кадры/второй счетчик. Он измеряет количество кадров, доступных клиенту. Если это значение меньше счетчика входных кадров/второй счетчик, кадры пропускаются. Чтобы определить узкое место, используйте счетчики Frames Skipped/Second.

Существует три типа счетчиков Frames Skipped/Second:

- Кадры пропущенные/второй (недостаточноресурсы сервера)
- Кадры пропущенные/Второй (недостаточно сетевые ресурсы)
- Кадры пропущенные/Второй (недостаточно клиентские ресурсы)

Высокое значение для любого из счетчиков Frames Skipped/Second означает, что проблема связана с ресурсом, который отслеживает счетчик. Например, если клиент не расшифровывает и не представляет кадры с той же скоростью, что и сервер, счетчик Frames Skipped/Second (недостаточные ресурсы клиента) будет высоким.

Если выводные кадры/второй счетчик совпадает с входной рамой/вторым счетчиком, но вы все еще заметите необычное отставание или срыв, среднее время кодирования может быть виновником. Кодирование — это синхронный процесс, который происходит на сервере в сценарии с одним сеансом (vGPU) и на VM в многосессионном сценарии. Среднее время кодирования должно быть менее 33 мс. Если среднее время кодирования составляет менее 33 мс, но у вас все еще есть проблемы с производительностью, могут возникнуть проблемы с приложением или операционной системой, которые вы используете.

Для получения дополнительной информации о диагностике проблем, связанных с приложением, [см.](/windows-server/remote/remote-desktop-services/rds-rdsh-performance-counters/)

Поскольку RDP поддерживает среднее время кодирования 33 мс, он поддерживает частоту ввода кадров до 30 кадров в секунду. Обратите внимание, что 33 мс является максимальной поддерживаемой частотой кадров. Во многих случаях частота кадров, с которыми пользователь столкнулся, будет ниже, в зависимости от того, как часто кадр предоставляется RDP источником. Например, такие задачи, как просмотр видео, требуют полной частоты ввода кадров 30 кадров в секунду, но менее вычислительно интенсивные задачи, такие как нечастое редактирование документа, приводят к значительно более низкому значению для вхотливых кадров/второго без ухудшения качества работы пользователя.

### <a name="addressing-poor-frame-quality"></a>Решение проблемы низкого качества кадра

Используйте счетчик качества кадров для диагностики проблем качества кадра. Этот счетчик выражает качество выходного кадра в процентах от качества исходной рамы. Потеря качества может быть вызвана RemoteFX, или она может быть присуща источнику графики. Если RemoteFX привел к потере качества, проблема может быть связана с нехваткой сетевых или серверных ресурсов для отправки контента с более высокой точностью.

## <a name="mitigation"></a>Меры по снижению риска

Если ресурсы сервера вызывают узкое место, попробуйте один из следующих подходов для повышения производительности:

- Сократите количество сеансов на узла.
- Увеличьте память и вычислите ресурсы на сервере.
- Отбросьте разрешение соединения.

Если сетевые ресурсы являются причиной узкого места, попробуйте один из следующих подходов для повышения доступности сети за сеанс:

- Сократите количество сеансов на узла.
- Используйте сеть с высокой пропускной способностью.
- Отбросьте разрешение соединения.

Если ресурсы клиента являются причиной узкого места, попробуйте один из следующих подходов для повышения производительности:

- Установите самый последний клиент удаленного рабочего стола.
- Увеличьте память и вычислите ресурсы на клиентской машине.

> [!NOTE]
> В настоящее время мы не поддерживаем Исходные кадры / Второй счетчик. На данный момент, Исходные кадры / Второй счетчик всегда будет отображать 0.

## <a name="next-steps"></a>Дальнейшие действия

- Для создания gPU оптимизированной виртуальной машины Azure [см.](configure-vm-gpu.md)
- Для обзора устранения неполадок [Troubleshooting overview, feedback, and support](troubleshoot-set-up-overview.md)и эскалации треков см.
- Чтобы узнать больше об [Windows Desktop environment](environment-setup.md)службе, см.
