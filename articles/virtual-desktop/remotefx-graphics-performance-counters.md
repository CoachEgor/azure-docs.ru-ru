---
title: Диагностика проблем с производительностью графики в удаленном рабочем столе - Azure
description: В этой статье описывается использование счетчиков графики RemoteFX в сеансы протокола удаленного рабочего стола для диагностики проблем производительности с графикой в виртуальный рабочий стол Windows.
services: virtual-desktop
author: ChJenk
ms.service: virtual-desktop
ms.topic: troubleshoot
ms.date: 05/23/2019
ms.author: v-chjenk
ms.openlocfilehash: 0b4113f1e0024415135aa99d1fb4e881efe448a3
ms.sourcegitcommit: 600d5b140dae979f029c43c033757652cddc2029
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66499269"
---
# <a name="diagnose-graphics-performance-issues-in-remote-desktop"></a>Диагностика проблем производительности графики в удаленном рабочем столе

Когда система не выполняет должным образом, важно определить источник проблемы. Эта статья поможет вам выявлять и устранять узкие места производительности, связанных с графикой во время сеансов удаленного рабочего стола (RDP).

## <a name="find-your-remote-session-name"></a>Имя удаленного сеанса

Вам потребуется имя удаленного сеанса для идентификации счетчики производительности графики. Следуйте инструкциям в этом разделе для определения имени удаленного сеанса на обзор виртуального рабочего стола Windows.

1. Откройте командную строку Windows в режиме удаленного сеанса.
2. Запустите **qwinsta** команды.
    - Если сеанс находится в нескольких сеансов виртуальной машины (VM): Суффикс для каждого имени счетчика является один и тот же суффикс имя сеанса, например «rdp-tcp 37.»
    - Если сеанс находится в виртуальной Машине, которая поддерживает виртуальные графики Processing Unit — Apu (vGPU): Счетчики, хранятся на сервере, а не на виртуальной Машине. Экземпляры счетчиков включают имя виртуальной Машины вместо его номера имя сеанса, такие как «Win8 Enterprise виртуальной Машины.»

>[!NOTE]
> Хотя счетчики RemoteFX в именах, они включают графики удаленного рабочего стола в сценариях vGPU, а также.

## <a name="access-performance-counters"></a>Доступ к счетчикам производительности

Счетчики производительности в графики RemoteFX помогает определить узкие места, помогая отслеживать такие кодирование время кадра и Пропущено кадров.

После определения имя удаленного сеанса, выполните эти инструкции для сбора данных счетчиков производительности графики RemoteFX для удаленного сеанса.

1. Выберите **запустить** > **Администрирование** > **монитор производительности**.
2. В **системный монитор** диалогового окна последовательно раскройте элементы **средства наблюдения**выберите **системный монитор**и выберите **добавить**.
3. В **добавить счетчики** диалоговом окне из **доступные счетчики** , раскройте узел объекта счетчика производительности в графики RemoteFX.
4. Выберите счетчики для отслеживания.
5. В **экземпляры выбранного объекта** выберите конкретные экземпляры для выбранных счетчиков и выберите **добавить**. Чтобы выбрать все экземпляры доступных счетчиков, выберите **все экземпляры**.
6. После добавления счетчиков, выберите **ОК**.

Выбранные счетчики производительности будут отображаться на экране монитора производительности.

>[!NOTE]
>Каждый активный сеанс на узле имеется собственный экземпляр каждого счетчика производительности.

## <a name="diagnosis"></a>Диагностика

Проблемы с производительностью, связанных с графикой обычно делятся на четыре категории:

- Низкая частота кадров
- Случайные ожиданий
- Высокая задержка ввода
- Качество низкой кадра

Начните с адресации низкая частота кадров, случайных ожиданий и высокой задержкой ввода. Следующий раздел поможет определить, какие счетчики производительности измеряют каждой категории.

### <a name="performance-counters"></a>Счетчики производительности

Этот раздел поможет вам выявить узкие места.

Сначала проверьте значение счетчика Frames/Second выходных данных. Он измеряет количество кадров, становятся доступными для клиента. Если это значение меньше, чем счетчика Frames/Second входных данных, кадры пропускаются. Выявить узкое место, используйте кадры счетчики пропущено в секунду.

Существует три типа кадров секунду пропущено счетчики:

- Кадры пропущено в секунду (нехватки сетевых ресурсов)
- Кадры пропущено в секунду (ресурсы клиента недостаточно)
- Кадры пропущено в секунду (недостаточных ресурсов сервера)

Высокое значение для любого из кадров секунду пропущено счетчики подразумевает, что проблема связана с ресурс счетчик отслеживает. Например если клиент не удастся, присутствует кадры с той же скоростью, сервер предоставляет кадры счетчика кадры пропускаются в секунду (недостаточно ресурсов клиента) будет высокого уровня.

Если счетчика Frames/Second выходных данных соответствует счетчику Frames/Second входных данных, еще по-прежнему имеется запаздывания необычные или замедляющих работу, то проблема может быть среднее время кодирования. Кодирование — это синхронный процесс, который происходит на сервере в сценарии одного сеанса (vGPU) и на виртуальной Машине в случае нескольких сеансов. Среднее время кодирования должно быть менее 33 мс. Если среднее время кодирования является менее 33 мс, но у вас по-прежнему есть проблемы с производительностью, возможно, проблема в приложении или операционной системы, которую вы используете.

Дополнительные сведения о диагностике проблем, связанных с приложениями, см. в разделе [счетчики производительности для задержки ввода пользователя](https://docs.microsoft.com/windows-server/remote/remote-desktop-services/rds-rdsh-performance-counters).

Так как RDP поддерживает среднее время с кодирование 33 мс, поддерживает ставкой входного кадра до 30 кадров в секунду. Обратите внимание, что 33 ms Максимальная поддерживаемых частота кадров. Во многих случаях опытным пользователем частота кадров будет ниже, в зависимости от того, как часто предоставляется кадр протоколу удаленного рабочего стола в источнике. Например задачи, например, просмотр видео требуют полного входного кадра тарифу 30 кадров в секунду, но меньше задач большим количеством ресурсов, например редко редактирование документа word не требуют таких высокая доля входные кадры в секунду для удобства работы пользователей.

С помощью счетчика качество кадра для диагностики проблем, связанных с качеством кадра. Значение этого счетчика выражает качество кадра выходного в процентах от качества исходного кадра. Потери качества может быть вызвано RemoteFX, или может быть самой источник графики. Если RemoteFX причиной потери качества, то проблема может быть нехватки ресурсов сети или сервера для отправки содержимого более высокая точность.

## <a name="mitigation"></a>Устранение

Если ресурсы сервера причина проблемы, попробуйте один из следующих действий для повышения производительности:

- Уменьшите количество сеансов для каждого узла.
- Увеличьте объем памяти и вычислительные ресурсы на сервере.
- Удалите разрешение соединения.

Если узкое место приводят к сетевым ресурсам, попробуйте один из следующих действий для повышения уровня доступности сети за сеанс.

- Уменьшите количество сеансов для каждого узла.
- Удалите разрешение соединения.
- Используйте сеть более высокой пропускной способностью.

Если ресурсы для клиента причина проблемы, выполните одно или оба из следующих действий для повышения производительности:

- Установите последние клиент удаленного рабочего стола.
- Увеличьте объем памяти и вычислительных ресурсов на клиентском компьютере.

> [!NOTE]
> В настоящее время мы не поддерживаем счетчика Frames/Second источника. Пока счетчик Frames/Second источника всегда иметь значение 0.

## <a name="next-steps"></a>Дальнейшие действия

- Чтобы создать виртуальную машину Azure оптимизированные для GPU, см. в разделе [Настройка графических процессоров ускорение графического процессора для среды Апробация виртуального рабочего стола Windows](https://docs.microsoft.com/azure/virtual-desktop/configure-vm-gpu).
- Обзор устранения неполадок и эскалации дорожек, см. в разделе [Устранение неполадок, Обзор, отзывы и поддержка](https://docs.microsoft.com/azure/virtual-desktop/troubleshoot-set-up-overview).
- Дополнительные сведения о предварительной версии службы, см. в разделе [Windows Desktop предварительной среде](https://docs.microsoft.com/azure/virtual-desktop/environment-setup).
