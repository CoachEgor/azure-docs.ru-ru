---
title: Создание пула узлов виртуальных рабочих столов Windows с помощью шаблона Azure Resource Manager — Azure
description: Создание пула узлов в виртуальном рабочем столе Windows с помощью шаблона Azure Resource Manager.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: conceptual
ms.date: 08/29/2019
ms.author: helohr
ms.openlocfilehash: b96ecad93c481a762b81a7888940850ed3a73e5f
ms.sourcegitcommit: 5f0f1accf4b03629fcb5a371d9355a99d54c5a7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/30/2019
ms.locfileid: "71679612"
---
# <a name="create-a-host-pool-with-an-azure-resource-manager-template"></a>Создание пула узлов с помощью шаблона Azure Resource Manager

Пулы узлов представляют собой коллекцию из одной или нескольких идентичных виртуальных машин в среде клиента виртуальных рабочих столов Windows. Каждый пул узлов может содержать группы приложений, с которыми пользователи могут взаимодействовать, как с физическим рабочим столом.

Следуйте инструкциям этого раздела, чтобы создать пул узлов для клиента виртуальных рабочих столов Windows с помощью шаблона Azure Resource Manager, предоставляемого корпорацией Майкрософт. В этой статье вы узнаете, как создать пул узлов в виртуальном рабочем столе Windows, создать группу ресурсов с виртуальными машинами в подписке Azure, присоединить эти виртуальные машины к домену AD и зарегистрировать виртуальные машины с помощью виртуального рабочего стола Windows.

## <a name="what-you-need-to-run-the-azure-resource-manager-template"></a>Предварительные требования для запуска шаблона Azure Resource Manager

Перед запуском шаблона Azure Resource Manager убедитесь, что вы знакомы со следующими действиями:

- Источник изображения, который вы хотите использовать. Он находится в коллекции Azure или является настраиваемым?
- Учетные данные присоединение к домену.
- Учетные данные виртуального рабочего стола Windows.

При создании пула узлов виртуальных рабочих столов Windows с помощью шаблона Azure Resource Manager можно создать виртуальную машину из коллекции Azure, управляемого образа или неуправляемого образа. Дополнительные сведения о создании образов виртуальных машин см. в статьях [Подготовка VHD или VHDX Windows к отправке в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/prepare-for-upload-vhd-image) и [Создание управляемого образа универсальной виртуальной машины в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/capture-image-resource).

## <a name="run-the-azure-resource-manager-template-for-provisioning-a-new-host-pool"></a>Запуск шаблона Azure Resource Manager для подготовки нового пула узлов

Чтобы начать, перейдите по [этому URL-адресу GitHub](https://github.com/Azure/RDS-Templates/tree/master/wvd-templates/Create%20and%20provision%20WVD%20host%20pool).

### <a name="deploy-the-template-to-azure"></a>Развертывание шаблона в Azure

Если вы развертываете в корпоративной подписке, прокрутите вниз и выберите **развернуть в Azure**, а затем пропустите все параметры, исходя из источника образа.

Если вы развертываете в подписке поставщика облачных решений, выполните следующие действия для развертывания в Azure.

1. Прокрутите страницу вниз и щелкните правой кнопкой мыши **Развертывание в Azure**, а затем выберите **Copy Link Location** (Скопировать ссылку).
2. Откройте текстовый редактор, например Блокнот, и вставьте в него ссылку.
3. Сразу после "https://portal.azure.com/" и перед хэш-подписыванием (#) введите символ @, за которым следует имя домена клиента. Ниже приведен пример формата, который следует использовать: https://portal.azure.com/@Contoso.onmicrosoft.com#create/.
4. Войдите на портал Azure как пользователь с правами администратора или участника подписки поставщика облачных решений.
5. Вставьте скопированную в текстовый редактор ссылку в адресную строку.

Инструкции по выбору параметров, которые следует ввести в сценарии, см. в [файле сведений](https://github.com/Azure/RDS-Templates/blob/master/wvd-templates/Create%20and%20provision%20WVD%20host%20pool/README.md)о виртуальном рабочем столе Windows. Файл сведений всегда обновляется последними изменениями.

## <a name="assign-users-to-the-desktop-application-group"></a>Назначение пользователей группе приложений для настольных компьютеров

После завершения работы с шаблоном Azure Resource Manager GitHub назначьте пользователю доступ, прежде чем начать тестирование всех рабочих столов на виртуальных машинах.

Сначала [скачайте и импортируйте модуль PowerShell для Виртуального рабочего стола Windows](https://docs.microsoft.com/powershell/windows-virtual-desktop/overview) для использования в сеансе PowerShell (если вы еще это не сделали).

Чтобы назначить пользователей группе приложений для настольных систем, откройте окно PowerShell и запустите этот командлет, чтобы войти в среду виртуальных рабочих столов Windows:

```powershell
Add-RdsAccount -DeploymentUrl "https://rdbroker.wvd.microsoft.com"
```

После этого добавьте пользователей в группу приложений для настольных систем с помощью этого командлета:

```powershell
Add-RdsAppGroupUser <tenantname> <hostpoolname> "Desktop Application Group" -UserPrincipalName <userupn>
```

Имя участника-пользователя должно соответствовать удостоверению пользователя в Azure Active Directory (например, user1@contoso.com). Если вы хотите назначить группу нескольким пользователям, запустите этот командлет для каждого из них.

Когда вы выполните эти действия, пользователи, которым назначена группа классических приложений, смогут войти в Виртуальный рабочий стол Windows с помощью поддерживаемых клиентов удаленного рабочего стола, чтобы просматривать ресурсы для рабочего стола сеанса.

>[!IMPORTANT]
>Чтобы усилить защиту среды Виртуального рабочего стола Windows в Azure, мы рекомендуем не открывать входящий порт 3389 для виртуальных машин. Виртуальный рабочий стол Windows не требует открытия входящего порта 3389, чтобы пользователи могли получить доступ к виртуальным машинам пула узла. Если вам все же нужно открыть порт 3389 для устранения неполадок, мы рекомендуем использовать[JIT-доступ к виртуальным машинам](https://docs.microsoft.com/azure/security-center/security-center-just-in-time).