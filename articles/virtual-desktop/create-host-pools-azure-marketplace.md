---
title: Пул узлов Виртуального рабочего стола Windows в Azure Marketplace — Azure
description: Сведения о том, как создать пул узлов Виртуального рабочего стола Windows с помощью Azure Marketplace.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: tutorial
ms.date: 08/30/2019
ms.author: helohr
ms.openlocfilehash: 40659414848adb9be86b6163cf456809e9cb750f
ms.sourcegitcommit: f718b98dfe37fc6599d3a2de3d70c168e29d5156
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2020
ms.locfileid: "77134597"
---
# <a name="tutorial-create-a-host-pool-by-using-the-azure-marketplace"></a>Руководство. Создание пула узлов с использованием Azure Marketplace

Пулы узлов — это коллекция, состоящая из одной или нескольких идентичных виртуальных машин в средах клиента Виртуального рабочего стола Windows. Каждый пул узлов может содержать группы приложений, с которыми пользователи могут взаимодействовать, как с физическим рабочим столом.

В этой статье описывается процесс создания пула узлов в клиенте Виртуального рабочего стола Windows с помощью предложения Microsoft Azure Marketplace. Сюда входят следующие задачи:

> [!div class="checklist"]
> * Создание пула узла на Виртуальном рабочем столе Windows.
> * Создание группы ресурсов с виртуальными машинами в подписке Azure.
> * Присоединение виртуальных машин к домену Active Directory.
> * Регистрация виртуальных машин с помощью Виртуального рабочего стола Windows.

Перед началом работы при необходимости [скачайте и импортируйте модуль PowerShell для Виртуального рабочего стола Windows](https://docs.microsoft.com/powershell/windows-virtual-desktop/overview) для использования в сеансе PowerShell. После этого выполните следующий командлет, чтобы войти в учетную запись:

```powershell
Add-RdsAccount -DeploymentUrl "https://rdbroker.wvd.microsoft.com"
```

## <a name="sign-in-to-azure"></a>Вход в Azure

Войдите на [портал Azure](https://portal.azure.com).

## <a name="run-the-azure-marketplace-offering-to-provision-a-new-host-pool"></a>Запустите предложение Azure Marketplace для подготовки пула узлов.

Запустите предложение Azure Marketplace для подготовки пула узлов:

1. На **домашней странице** или в меню портала Azure выберите **Создать ресурс**.
2. В окне поиска Marketplace введите **Виртуальный рабочий стол Windows**.
3. Выберите **Windows Virtual Desktop — Provision a host pool** (Виртуальный рабочий стол Windows — подготовка пула узлов) и щелкните **Создать**.

Затем следуйте инструкциям из следующего раздела, чтобы ввести сведения в соответствующих колонках.

### <a name="basics"></a>Основы

В колонке **Базовые** сделайте следующее:

1. Введите имя пула узлов, уникальное в пределах клиента Виртуального рабочего стола Windows.
2. Выберите соответствующий вариант для персонального рабочего стола. Если вы выберете **Да**, каждый пользователь, который подключится к этому пулу узлов, будет постоянно связан с виртуальной машиной.
3. Введите разделенный запятыми список пользователей, которые могут войти в клиентскую зону Виртуального рабочего стола Windows и получить доступ к рабочему столу после завершения использования предложения Azure Marketplace. Например, если вы хотите назначить доступ к user1@contoso.com и user2@contoso.com, введите user1@contoso.com,user2@contoso.com.
4. Выберите **Создать** и укажите имя новой группы ресурсов
5. В качестве **расположения** выберите то же расположение, что и для виртуальной сети с подключением к серверу Active Directory.
6. Выберите **Далее: настройка виртуальных машин >** .

>[!IMPORTANT]
>Если вы используете только доменные службы Azure AD A и решение Azure Active Directory, разверните пул узлов в том же регионе, в котором находятся доменные службы Azure Active Directory, чтобы избежать ошибок, связанных с подключением к домену и учетными данными.

### <a name="configure-virtual-machines"></a>Настройка виртуальных машин

В колонке **Configure virtual machines** (Настройка виртуальных машин) сделайте следующее:

1. Примите значения по умолчанию или укажите количество и размер виртуальных машин.
    
    >[!NOTE]
    >Если конкретный размер виртуальной машины не отображается в селекторе размеров виртуальных машин, это связано с тем, что мы еще не подключили этот размер к средству Azure Marketplace. Чтобы запросить размер виртуальной машины, создайте новый запрос или проголосуйте за существующий на [форуме UserVoice по Виртуальному рабочему столу Windows](https://windowsvirtualdesktop.uservoice.com/forums/921118-general).
    
2. Введите префикс для имен виртуальных машин. Например, если вы введете имя prefix, имена виртуальных машин будут prefix-0, prefix-1 и т. д.
3. Выберите **Далее: параметры виртуальной машины**.

### <a name="virtual-machine-settings"></a>Параметры виртуальной машины

В колонке **Параметры виртуальной машины** сделайте следующее:

>[!NOTE]
> Если вы присоединяете виртуальные машины к среде доменных служб Active Directory (Azure AD DS), убедитесь, что пользователь, присоединяющийся к домену, является участником [группы администраторов AAD DC](../active-directory-domain-services/tutorial-create-instance-advanced.md#configure-an-administrative-group).
>
> Учетная запись также должна относиться к управляемому домену Azure AD DS или клиенту Azure AD. Учетные записи из внешних каталогов, связанных с клиентом Azure AD, не смогут пройти проверку подлинности в процессе присоединения к домену. 

1. Выберите **Источник образа** и введите соответствующую информацию о том, как его искать и хранить. Если вы решили не использовать управляемые диски, выберите учетную запись хранения, содержащую VHD-файл.
2. Введите имя участника-пользователя и пароль для учетной записи домена, с использованием которой виртуальные машины будут присоединены к домену Active Directory. Эти же имя пользователя и пароль будут созданы на виртуальных машинах в качестве локальной учетной записи. Позже вы сможете сбросить эти локальные учетные записи.
3. Выберите виртуальную сеть с подключением к серверу Active Directory, а затем подсеть для размещения виртуальных машин.
4. По завершении выберите **Next: Windows Virtual Desktop information** (Далее: сведения о Виртуальном рабочем столе Windows).

### <a name="windows-virtual-desktop-tenant-information"></a>Сведения о клиенте Виртуального рабочего стола Windows

В колонке **Windows Virtual Desktop tenant information** (Сведения о клиенте Виртуального рабочего стола Windows) сделайте следующее:

1. Введите **имя группы клиента Виртуального рабочего стола Windows** в группе вашего клиента. Оставьте значение по умолчанию, если вам не было предоставлено определенное имя группы клиента.
2. В поле **Windows Virtual Desktop tenant name** (Имя клиента Виртуального рабочего стола Windows) введите имя клиента, в котором будет создан этот пул узлов.
3. Укажите тип учетных данных, которые вы хотите использовать для аутентификации в качестве владельца служб удаленных рабочих столов клиента Виртуального рабочего стола Windows. Если вы завершили учебник [Создание субъектов-служб и назначений ролей с помощью PowerShell](./create-service-principal-role-powershell.md), выберите **Субъект-служба**. Когда появится **идентификатор клиента Azure AD**, введите идентификатор для экземпляра Azure Active Directory, который содержит субъект-службу.
4. Введите данные учетной записи администратора клиента. Поддерживаются только субъекты-службы с использованием пароля.
5. Выберите **Далее: Отзыв и создание**.

## <a name="complete-setup-and-create-the-virtual-machine"></a>Завершение настройки и создание виртуальной машины

В последних двух колонках сделайте следующее:

1. В колонке **Просмотреть и создать** просмотрите сведения о настройке. Если вам нужно что-то изменить, вернитесь в соответствующую колонку и внесите изменения, прежде чем продолжить работу. Если все правильно, нажмите кнопку **ОК**.
2. Выберите **Создать**, чтобы развернуть пул узлов.

В зависимости от количества создаваемых виртуальных машин этот процесс может занять более 30 минут.

## <a name="optional-assign-additional-users-to-the-desktop-application-group"></a>(Необязательно.) Назначение дополнительным пользователям группы классических приложений

После завершения использования предложения Azure Marketplace вы сможете назначить больше пользователей в группу классических приложений перед началом тестирования рабочих столов с полным сеансом на виртуальных машинах. Если вы уже назначили необходимому количеству пользователей по умолчанию предложение Azure Marketplace, этот раздел можно пропустить.

Чтобы назначить пользователям группу классических приложений, сначала откройте окно PowerShell. После этого необходимо ввести следующие два командлета.

Выполните следующий командлет, чтобы войти в среду Виртуального рабочего стола Windows:

```powershell
Add-RdsAccount -DeploymentUrl "https://rdbroker.wvd.microsoft.com"
```

Добавьте пользователей в группу классических приложений с помощью этого командлета:

```powershell
Add-RdsAppGroupUser <tenantname> <hostpoolname> "Desktop Application Group" -UserPrincipalName <userupn>
```

Имя участника-пользователя должно соответствовать удостоверению пользователя в Azure Active Directory (например, user1@contoso.com). Если вы хотите назначить группу нескольким пользователям, запустите этот командлет для каждого из них.

Когда вы выполните эти действия, пользователи, которым назначена группа классических приложений, смогут войти в Виртуальный рабочий стол Windows с помощью поддерживаемых клиентов удаленного рабочего стола, чтобы просматривать ресурсы для рабочего стола сеанса.

Поддерживаемые клиенты:

- [клиент удаленного рабочего стола для Windows 7 и Windows 10](connect-windows-7-and-10.md);
- [веб-клиент Виртуального рабочего стола Windows](connect-web.md).

>[!IMPORTANT]
>Чтобы усилить защиту среды Виртуального рабочего стола Windows в Azure, мы рекомендуем не открывать входящий порт 3389 для виртуальных машин. Виртуальный рабочий стол Windows не требует открытия входящего порта 3389, чтобы пользователи могли получить доступ к виртуальным машинам пула узла. Если вам все же нужно открыть порт 3389 для устранения неполадок, мы рекомендуем использовать[JIT-доступ к виртуальным машинам](https://docs.microsoft.com/azure/security-center/security-center-just-in-time).

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы создали пул узлов и предоставили пользователям возможность доступа к соответствующему рабочему столу, можно также добавить удаленные приложения RemoteApp в данный пул узлов. Дополнительные сведения о том, как управлять приложениями в Виртуальном рабочем столе Windows, см. в данном учебнике:

> [!div class="nextstepaction"]
> [Управление группами приложений](./manage-app-groups.md)
