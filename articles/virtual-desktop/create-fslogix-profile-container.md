---
title: FsLogix профиль контейнеров NetApp Windows Виртуальный рабочий стол - Azure
description: Как создать контейнер профиля FSLogix с помощью файлов Azure NetApp в виртуальном рабочем столе Windows.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: conceptual
ms.date: 04/13/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: 149fb5818ee360c7333997655ea9eb8d7ded346c
ms.sourcegitcommit: 530e2d56fc3b91c520d3714a7fe4e8e0b75480c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2020
ms.locfileid: "81270899"
---
# <a name="create-an-fslogix-profile-container-for-a-host-pool-using-azure-netapp-files"></a>Создание контейнера профиля FSLogix для пула хоста с помощью файлов Azure NetApp

Мы рекомендуем использовать контейнеры профиля FSLogix в качестве решения для профиля пользователя для [службы Windows Virtual Desktop.](overview.md) Контейнеры профиля FSLogix хранят полный профиль пользователя в одном контейнере и предназначены для роуминга профилей в непостоянных удаленных вычислительных средах, таких как Windows Virtual Desktop. При входе в систему контейнер динамически прикрепляется к вычислительной среде с помощью локально поддерживаемого виртуального жесткого диска (VHD) и виртуального жесткого диска Hyper-V (VHDX). Эти передовые технологии драйвера фильтра позволяют профилю пользователя быть немедленно доступным и отображаться в системе точно так же, как локальный профиль пользователя. Чтобы узнать больше о контейнерах профиля FSLogix, смотрите [контейнеры для файлов профиля FSLogix и файлы Azure.](fslogix-containers-azure-files.md)

Контейнеры профиля FSLogix можно создавать с помощью [Azure NetApp Files,](https://azure.microsoft.com/services/netapp/)простого в использовании нативной платформы Azure, который помогает клиентам быстро и надежно предоставлять объемы sMB корпоративного класса для своих сред Windows Virtual Desktop. Подробнее о файлах NetApp Azure читайте в материале [«Что такое файлы NetApp Azure?»](../azure-netapp-files/azure-netapp-files-introduction.md)

Это руководство покажет вам, как настроить учетную запись Azure NetApp Files и создать контейнеры для профилей FSLogix в Виртуальном рабочем столе Windows.

Эта статья предполагает, что у вас уже есть [пулы хоста, настроенные](create-host-pools-azure-marketplace.md) и сгруппированные в одного или нескольких арендаторов в среде Windows Virtual Desktop. Чтобы узнать, как настроить арендаторов, [см. Создать арендатора в Windows Virtual Desktop](tenant-setup-azure-active-directory.md) и наш Tech Сообщества [блоге](https://techcommunity.microsoft.com/t5/Windows-IT-Pro-Blog/Getting-started-with-Windows-Virtual-Desktop/ba-p/391054).

Инструкции в этом руководстве специально для пользователей Windows Virtual Desktop. Если вы ищете более общие рекомендации по настройке файлов Azure NetApp и созданию контейнеров для профилей FSLogix за пределами виртуального рабочего стола Windows, просмотрите [настройку файлов Azure NetApp и создайте быстрый запуск громкости NFS.](../azure-netapp-files/azure-netapp-files-quickstart-set-up-account-create-volumes.md)

>[!NOTE]
>В этой статье не говорится о рекомендациях по обеспечению доступа к файлам NetApp Azure.

>[!NOTE]
>Если вы ищете материал сравнения о различных вариантах хранения контейнеров [Storage options for FSLogix profile containers](store-fslogix-profile.md)FSLogix Profile Container в Azure, см.

## <a name="prerequisites"></a>Предварительные требования

Прежде чем создать контейнер профиля FSLogix для пула хоста, необходимо:

- Настройка и настройка виртуального рабочего стола Windows
- Предоставление пула хостов виртуального рабочего стола Windows
- [Включить подписку на файлы NetApp Azure](../azure-netapp-files/azure-netapp-files-register.md)

## <a name="set-up-your-azure-netapp-files-account"></a>Настройка учетной записи файлов NetApp Azure

Для начала необходимо настроить учетную запись Файлов NetApp Azure.

1. Войдите на [портал Azure](https://portal.azure.com). Убедитесь, что в вашей учетной записи есть разрешения на авторилистера или администратора.

2. Выберите **значок Azure Cloud Shell** справа от панели поиска, чтобы открыть панель Azure Cloud Shell.

3. После открытия облачной оболочки Azure выберите **PowerShell.**

4. Если вы впервые используете облачную оболочку Azure, создайте учетную запись хранилища в той же подписке, вы храните файлы Azure NetApp и виртуальный рабочий стол Windows.

   ![Окно учетной записи хранилища с кнопкой создания хранилища в нижней части окна выделено красным цветом.](media/create-storage-button.png)

5. После загрузки оболочки облака Azure запустите следующие два cmdlets.

   ```azurecli
   az account set --subscription <subscriptionID>
   ```

   ```azurecli
   az provider register --namespace Microsoft.NetApp --wait
   ```

6. В левой части окна выберите **все службы.** Введите **файлы Сети Azure** в поле поиска, которое отображается в верхней части меню.

   ![Скриншот пользователя, входящего в "Файлы Нетта-приложений Azure" в поле поиска всех служб. Результаты поиска показывают ресурс Azure NetApp Files.](media/azure-netapp-files-search-box.png)


7. Выберите **файлы Сети Azure** в результатах поиска, а затем выберите **«Создать».**

8. Выберите кнопку **Добавить.**
9. При открытии вкладки **учетной записи New NetApp** введите следующие значения:

    - Для **имени**введите имя учетной записи NetApp.
    - Для **подписки**выберите подписку на учетную запись хранения, настроенную в шаге 4 из меню выпадения.
    - Для **группы ресурсов**выберите существующую группу ресурсов из выпадающего меню или создайте новую, выбрав **Создать новый.**
    - Для **определения местоположения**выберите регион для учетной записи NetApp из меню выпадающих. Этот регион должен быть таким же регионом, как и VMs-м вхозом хоста сеанса.

   >[!NOTE]
   >В настоящее время файлы Azure NetApp не поддерживают монтаж объема в разных регионах.

10. Когда вы закончите, выберите **Создать** для создания учетной записи NetApp.

## <a name="create-a-capacity-pool"></a>Создание пула емкости

Далее создайте новый пул емкости: 

1. Перейдите в меню Файлов NetApp Azure и выберите новую учетную запись.
2. В меню учетной записи выберите **пулы емкости** в рамках службы хранения.
3. Выберите **Пул добавления.**
4. При открытии вкладки **«Новый пул емкости»** введите следующие значения:

    - Для **name**введите имя для нового пула емкости.
    - Для **уровня обслуживания**выберите желаемое значение из выпадающего меню. Мы рекомендуем **Premium** для большинства сред.
       >[!NOTE]
       >Настройка Premium обеспечивает минимальную пропускную плату, доступную для уровня Premium Service, который составляет 256 Мбит/с. Возможно, потребуется настроить эту пропускную стоимость для производственной среды. Окончательная пропускная связь основана на взаимосвязи, описанной в [пределах пропускной связи.](../azure-netapp-files/azure-netapp-files-service-levels.md)
    - Для **размера (TiB)** введите размер пула емкости, который наилучшим образом соответствует вашим потребностям. Минимальный размер составляет 4 TiB.

5. Завершив настройку, нажмите кнопку **ОК**.

## <a name="join-an-active-directory-connection"></a>Присоединиться к подключению Active Directory

После этого необходимо присоединиться к подключению Active Directory.

1. Выберите **соединения Active Directory** в меню на левой стороне страницы, а затем выберите кнопку **Join,** чтобы открыть страницу **Join Active Directory.**

   ![Скриншот меню соединений Join Active Directory.](media/active-directory-connections-menu.png)

2. Введите следующие значения на странице **«Присоединиться к активному каталогу»,** чтобы присоединиться к подключению:

    - Для **Primary DNS**введите IP-адрес DNS-сервера в среде, который может решить доменное имя.
    - Для **домена**введите свое полностью квалифицированное доменное имя (ФЗДН).
    - Для **префикса SMB Server (Компьютерный счет)** введите строку, которая требуется придатка к названию учетной записи компьютера.
    - Для **username**введите имя учетной записи с разрешениями на выполнение соединения домена.
    - Для **того, чтобы пароль,** введите пароль учетной записи.

## <a name="create-a-new-volume"></a>Создание нового тома

Далее необходимо создать новый том.

1. Выберите **тома,** затем выберите **Добавить том.**

2. При открытии **вкладки «Создание тома»** введите следующие значения:

    - Для **названия тома**введите имя для нового тома.
    - Для **пула емкости**выберите только что созданный пул емкости из только что созданного меню выпадения.
    - Для **квоты (GiB)** введите размер объема, подходящий для вашей среды.
    - Для **виртуальной сети**выберите существующую виртуальную сеть, которая имеет подключение к контроллеру домена из выпадающего меню.
    - Под **Subnet**выберите **Создать новый**. Имейте в виду, что эта подсеть будет делегирована файлам NetApp Azure.

3.  Выберите **Далее: \> Протокол,** чтобы открыть вкладку Протокола и настроить параметры доступа к громкости.

## <a name="configure-volume-access-parameters"></a>Настройка параметров доступа к громкости

После создания тома настройте параметры доступа к объему.

1.  Выберите **SMB** в качестве типа протокола.
2.  В соответствии с конфигурацией в меню **Active Directory** выберите тот же каталог, который вы изначально подключили в [присоединении к подключению к активному каталогу.](create-fslogix-profile-container.md#join-an-active-directory-connection) Имейте в виду, что есть ограничение одного Active Directory на подписку.
3.  В текстовом поле **имя Share** введите имя доли, используемой пулом хостов сеансов и пользователями.

4.  Выберите **Обзор и создайте** в нижней части страницы. Это открывает страницу проверки. После успешной проверки громкости выберите **Create.**

5.  На этом этапе начнется развертывание нового тома. После завершения развертывания можно использовать общий общий обмен файлами NetApp Azure.

6.  Чтобы увидеть траекторию крепления, выберите **Перейдите к ресурсу** и ищите его во вкладке «Обзор».

    ![Скриншот экрана Обзор с красной стрелкой, указывающей на траекторию крепления.](media/overview-mount-path.png)

## <a name="configure-fslogix-on-session-host-virtual-machines-vms"></a>Настройка FSLogix на виртуальных машинах-хостах сеансов (VMs)

Этот раздел основан на [создании контейнера профиля для пула хоста с помощью общего файла.](create-host-pools-user-profile.md)

1. [Загрузите файл агента FSLogix .zip,](https://go.microsoft.com/fwlink/?linkid=2084562&clcid=0x409) пока вы все еще удалены в vM-узле сеанса.

2. Распаковать загруженный файл.

3. В файле перейдите на **x64** > **релизы** и запустите **FSLogixAppsSetup.exe**. Откроется меню установки.

4.  Если у вас есть ключ продукта, введите его в текстовое окно Key продукта.

5. Выберите флажок рядом с **Я согласен с условиями лицензии**.

6. Выберите пункт **Установить**.

7. Перейдите к **C:\\Программа Файлы\\FSLogix\\Apps** для подтверждения агента установлен.

8. Из меню «Пуск» запустите **RegEdit** в качестве администратора.

9. Перейдите на **\\\\программное обеспечение\\HKEY_LOCAL_MACHINE компьютером FSLogix**.

10. Создайте ключ под названием **Профили**.

11.  Создайте **значение,** названное Enabled с **набором REG_DWORD** типа к значению данных **1.**

12. Создайте значение под названием **VHDLocations** с типом **Multi-String** и установите его значение данных в URI для общего использования файлов NetApp Azure.

13. Создайте значение под названием **DeleteLocalProfileWhenVHDShouldApply** со значением DWORD 1, чтобы избежать проблем с существующими локальными профилями перед вводом.

     >[!WARNING]
     >Будьте осторожны при создании Значения DeleteLocalProfileWhenVHDShouldApply. Когда система профилей FSLogix определяет, что у пользователя должен быть профиль FSLogix, но локальный профиль уже существует, контейнер профиля будет постоянно удалять локальный профиль. Затем пользователь будет подписан с новым профилем FSLogix.

## <a name="assign-users-to-session-host"></a>Назначить пользователей хостам сеанса

1. Open **PowerShell ISE** в качестве администратора и войти на Windows Virtual Desktop.

2. Выполните следующие командлеты.

   ```powershell
   Import-Module Microsoft.RdInfra.RdPowershell
   # (Optional) Install-Module Microsoft.RdInfra.RdPowershell
   $brokerurl = "https://rdbroker.wvd.microsoft.com"
   Add-RdsAccount -DeploymentUrl $brokerurl
   ```

3. При запросе для учетных данных введите учетные данные для пользователя с помощью ролей Арендатора Creator или RDS Owner/RDS Contributor в наемщике Windows Virtual Desktop.

4. Выполнить следующие cmdlets, чтобы назначить пользователя в группу удаленного рабочего стола:

   ```powershell
   $wvdTenant = "<your-wvd-tenant>"
   $hostPool = "<wvd-pool>"
   $appGroup = "Desktop Application Group"
   $user = "<user-principal>"
   Add-RdsAppGroupUser $wvdTenant $hostPool $appGroup $user
   ```

## <a name="make-sure-users-can-access-the-azure-netapp-file-share"></a>Убедитесь, что пользователи могут получить доступ к совместной акции файлов Azure NetApp

1. Откройте свой интернет-браузер и перейдите к <https://rdweb.wvd.microsoft.com/webclient/index.html>.

2. Войти в систему с учетными данными пользователя, назначенного в группу удаленного рабочего стола.

3. После того как вы создали сеанс пользователя, вопием на портал Azure с административной учетной записью.

4. Откройте **файлы NetApp Azure,** выберите учетную запись Azure NetApp Files, а затем выберите **тома.** Как только меню томов откроется, выберите соответствующий том.

   ![Скриншот учетной записи NetApp, созданной ранее на портале Azure с выбранной кнопкой Volumes.](media/netapp-account.png)

5. Перейдите на вкладку **«Обзор»** и подтвердите, что контейнер профиля FSLogix использует пространство.

6. Подключитесь непосредственно к любой vM-части пула хоста с помощью удаленного рабочего стола и откройте **File Explorer.** Затем перейдите к **траектории горы** (в следующем \\ \\\\примере путь крепления anf-SMB-3863.gt1107.onmicrosoft.com anf-VOL).

   В этой папке должен быть профиль VHD (или VHDX), как в следующем примере.

   ![Скриншот содержимого папки в траектории крепления. Внутри находится один файл VHD под названием "Profile_ssbb".](media/mount-path-folder.png)

## <a name="next-steps"></a>Дальнейшие действия

Для настройки общего профиля пользователя можно использовать контейнеры профиля FSLogix. Чтобы узнать, как создавать общие данные профиля пользователя с помощью новых контейнеров, [см. Создать контейнер профиля для пула хоста с помощью общего файла.](create-host-pools-user-profile.md)
