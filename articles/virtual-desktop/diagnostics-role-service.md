---
title: Проблемы с диагностикой виртуальных рабочих столов Windows — Azure
description: Использование функции диагностики виртуальных рабочих столов Windows для диагностики проблем.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: conceptual
ms.date: 04/30/2020
ms.author: helohr
manager: lizross
ms.openlocfilehash: cffc6393ef6f5c1a33be615d9d5d4b8729ab711f
ms.sourcegitcommit: 50ef5c2798da04cf746181fbfa3253fca366feaa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2020
ms.locfileid: "82611863"
---
# <a name="identify-and-diagnose-issues"></a>Выявление и диагностика неполадок

>[!IMPORTANT]
>Это содержимое относится к обновлению пружины 2020 с Azure Resource Manager объектов виртуальных рабочих столов Windows. Если вы используете виртуальный рабочий стол Windows в выпуске 2019 без Azure Resource Manager объектов, см. [эту статью](./virtual-desktop-fall-2019/diagnostics-role-service-2019.md).
>
> Обновление 2020 виртуального рабочего стола Windows в настоящее время находится в общедоступной предварительной версии. Эта предварительная версия предоставляется без соглашения об уровне обслуживания, и мы не рекомендуем использовать ее для рабочих нагрузок. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. 
> Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Виртуальный рабочий стол Windows предлагает функцию диагностики, которая позволяет администратору определять проблемы с помощью одного интерфейса. Дополнительные сведения о возможностях диагностики виртуальных рабочих столов Windows см. в разделе [использование log Analytics для компонента диагностики](diagnostics-log-analytics.md).
  
Подключения, которые не достигают виртуальных рабочих столов Windows, не отображаются в результатах диагностики, так как сама служба роли диагностики является частью виртуального рабочего стола Windows. Проблемы с подключением к виртуальным рабочим столам Windows могут возникнуть, когда пользователь испытывает проблемы с сетевым подключением.

## <a name="common-error-scenarios"></a>Распространенные сценарии ошибок

Сценарии ошибок классифицируются по внутренним компонентам службы и являются внешними для виртуальных рабочих столов Windows.

* Внутренняя проблема: указывает сценарии, которые не могут быть устранены клиентом и должны быть решены как проблемы с поддержкой. Когда вы предоставляете отзыв в рамках [технического сообщества Windows Virtual Desktop](https://techcommunity.microsoft.com/t5/Windows-Virtual-Desktop/bd-p/WindowsVirtualDesktop), включите идентификатор корреляции и приблизительный период времени возникновения проблемы.
* Внешняя ошибка: связь с сценариями, которые могут быть устранены клиентом. Они являются внешними для виртуальных рабочих столов Windows.

В следующей таблице перечислены распространенные ошибки, с которыми могут столкнуться администраторы.

>[!NOTE]
>В этом списке содержатся наиболее распространенные ошибки, которые обновляются с учетом постоянной ритмичности. Чтобы получить актуальные сведения, обязательно ознакомьтесь с этой статьей по крайней мере раз в месяц.

## <a name="management-errors"></a>Ошибки управления

|Сообщение об ошибке|Предлагаемое решение|
|---|---|
|Не удалось создать ключ регистрации |Не удалось создать токен регистрации. Попробуйте создать его еще раз с более коротким временем окончания срока действия (от 1 часа до 1 месяца). |
|Не удалось удалить ключ регистрации|Не удалось удалить токен регистрации. Попробуйте удалить его еще раз. Если он по-прежнему не работает, используйте PowerShell для проверки наличия маркера. Если это так, удалите его с помощью PowerShell.|
|Не удалось изменить режим стока узла сеанса |Не удалось изменить режим стока на виртуальной машине. Проверьте состояние виртуальной машины. Если виртуальная машина недоступна, режим стока не может быть изменен.|
|Не удалось отключить пользовательские сеансы |Не удалось отключить пользователя от виртуальной машины. Проверьте состояние виртуальной машины. Если виртуальная машина недоступна, сеанс пользователя не может быть отключен. Если виртуальная машина доступна, проверьте состояние сеанса пользователя, чтобы узнать, отключен ли он. |
|Не удалось завершить сеансы всех пользователей на узле сеансов |Не удалось подписать пользователей виртуальной машины. Проверьте состояние виртуальной машины. Если он недоступен, пользователи не могут выйти из нее. Проверьте состояние сеанса пользователя, чтобы убедиться, что они уже вышли. Вы можете принудительно выполнить выход с помощью PowerShell. |
|Не удалось отменить назначение пользователя из группы приложений|Не удалось отменить публикацию группы приложений для пользователя. Проверьте, доступен ли пользователь в Azure AD. Проверьте, является ли пользователь частью группы пользователей, в которой опубликована группа приложений. |
|Произошла ошибка при получении доступных расположений |Проверьте расположение виртуальной машины, используемой в мастере создания пула узлов. Если образ недоступен в этом расположении, добавьте образ в это расположение или выберите другое расположение виртуальной машины. |

### <a name="external-connection-error-codes"></a>Коды ошибок внешних подключений

|Числовой код|Код ошибки|Предлагаемое решение|
|---|---|---|
|— 2147467259|коннектионфаиледадтрустедрелатионшипфаилуре|Узел сеансов неправильно присоединен к Active Directory.|
|— 2146233088|коннектионфаиледусерхасвалидсессионбутрдшисунхеалси|Не удалось выполнить соединения, так как узел сеансов недоступен. Проверьте работоспособность узла сеанса.|
|— 2146233088|коннектионфаиледклиентдисконнект|Если эта ошибка возникает часто, убедитесь, что компьютер пользователя подключен к сети.|
|— 2146233088|коннектионфаиледнохеалсирдшаваилабле|Сеанс, к которому пытался подключиться пользователь узла, неисправен. Отладить виртуальную машину.|
|— 2146233088|коннектионфаиледусернотаусоризед|У пользователя нет разрешения на доступ к опубликованному приложению или рабочему столу. Эта ошибка может появиться после удаления администратором опубликованных ресурсов. Попросите пользователя обновить веб-канал в удаленный рабочий стол приложении.|
|2|FileNotFound|Приложение, к которому пользователь пытался получить доступ, либо неправильно установлено, либо имеет неверный путь.<br><br>При публикации новых приложений во время работы пользователя с активным сеансом он не сможет получить доступ к этому приложению. Чтобы пользователь мог получить доступ к приложению, необходимо завершить работу и перезапустить сеанс. |
|3|InvalidCredentials|Имя пользователя или пароль, введенные пользователем, не совпадают с существующими именами пользователей или паролями. Проверьте учетные данные для опечаток и повторите попытку.|
|8|коннектионброкен|Соединение между клиентом и шлюзом или сервером отброшено. Никаких действий не требуется, если это не происходит неожиданно.|
|14|унекспектеднетворкдисконнект|Подключение к сети разорвано. Попросите пользователя подключиться снова.|
|24|реверсеконнектфаилед|Виртуальная машина узла не имеет прямой информации о шлюзе удаленных рабочих столов. Убедитесь, что IP-адрес шлюза может быть разрешен.|

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о ролях в виртуальном рабочем столе Windows см. в разделе [Среда виртуальных рабочих столов Windows](environment-setup.md).

Список доступных командлетов PowerShell для виртуальных рабочих столов Windows см. в [справочнике по PowerShell](/powershell/windows-virtual-desktop/overview).
