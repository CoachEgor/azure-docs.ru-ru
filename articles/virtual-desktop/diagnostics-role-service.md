---
title: Выявить проблемы с функцией диагностики Апробация виртуального рабочего стола Windows - Azure
description: Описание средства диагностики Апробация виртуального рабочего стола Windows и способы ее использования.
services: virtual-desktop
author: Heidilohr
ms.service: virtual-desktop
ms.topic: conceptual
ms.date: 03/21/2019
ms.author: helohr
ms.openlocfilehash: 6b79a26d63c02dd06b62ea6ad09941f947704dc0
ms.sourcegitcommit: 3102f886aa962842303c8753fe8fa5324a52834a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2019
ms.locfileid: "60870495"
---
# <a name="identify-issues-with-the-diagnostics-feature"></a>Выявление проблем с функцией диагностики

Обзор виртуального рабочего стола Windows предлагает функцию диагностики, которую администратор может выявить проблемы через единый интерфейс. В роли виртуального рабочего стола Windows журнала действий диагностики всякий раз, когда пользователь взаимодействует с системой. Каждый журнал содержит важные сведения, такие как роли виртуального рабочего стола Windows, участвующих в транзакции, сообщения об ошибках, сведения о клиенте и сведения о пользователе. Диагностические действия создаются путем конечных пользователей и административных действий и можно разделить на три основные категории:

* Веб-канала действия подписки: конечный пользователь активирует эти действия, каждый раз, когда они пытаются подключиться к их веб-канал, через удаленный рабочий стол Майкрософт приложений.
* Соединение действий: конечный пользователь активирует эти действия, каждый раз, когда они пытаются подключиться к рабочему столу или RemoteApp через удаленный рабочий стол Майкрософт приложений.
* Действия по управлению: администратор запускает эти действия при каждом выполнении операций управления в системе, таких как создание пулов узлов, назначения пользователей группам приложений и Создание назначения ролей.
  
Подключения, которые не достигают виртуальный рабочий стол Windows не влияют на результаты диагностики, так как самой службе диагностики роли является частью виртуального рабочего стола Windows. Проблемы подключения виртуальный рабочий стол Windows может произойти, если конечный пользователь испытывает проблемы с сетевым подключением.

Чтобы начать работу, [Загрузите и импортируйте модуль PowerShell для виртуальных рабочих столов Windows](https://docs.microsoft.com/powershell/windows-virtual-desktop/overview) для использования в сеансе PowerShell, если у вас еще нет.

## <a name="diagnose-issues-with-powershell"></a>Диагностика проблем с помощью PowerShell

Виртуальный рабочий стол диагностики Windows использует только один командлет PowerShell, но содержит множество необязательных параметров, чтобы ограничить работу и изолировать проблемы. В следующих разделах перечислены командлеты, можно запустить для диагностики проблем. Большинство фильтры могут применяться друг с другом. Значения, перечисленные в квадратных скобках, например `<tenantName>`, следует заменить на значения, которые применяются к вашей ситуации.

### <a name="retrieve-diagnostic-activities-in-your-tenant"></a>Получение диагностических действий в клиенте

Диагностических действий можно получить, введя **Get RdsDiagnosticActivities** командлета. Приведенный ниже командлет вернет список диагностических действий, отсортированные по убыванию старым.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName>
```

Как и другие командлеты PowerShell виртуального рабочего стола для Windows, необходимо использовать **- TenantName** параметр, чтобы указать имя клиента, который вы хотите использовать для запроса. Имя клиента применяется для почти всех запросов действий диагностики.

### <a name="retrieve-detailed-diagnostic-activities"></a>Получить подробные диагностические действия

**-Подробные** параметр предоставляет дополнительные сведения о каждом из них диагностики возвращается. Формат для каждого действия зависит от его типа действия. **-Подробные** параметр можно добавить к любому **Get RdsDiagnosticActivities** запрос, как показано в следующем примере.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -Detailed
```

### <a name="retrieve-a-specific-diagnostic-activity-by-activity-id"></a>Получение конкретного диагностики деятельности по Идентификатору

**– ActivityId** параметр Возвращает конкретный действий диагностики, если он существует, как показано в следующем примере командлета.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -ActivityId <ActivityIdGuid>
```

### <a name="filter-diagnostic-activities-by-user"></a>Отфильтровать диагностические действия пользователем

**- UserName** параметр Возвращает список диагностических действий, инициированных указанного пользователя, как показано в следующем примере командлета.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -UserName <UserUPN>
```

**- UserName** параметр также может использоваться совместно с другие необязательные параметры фильтрации.

### <a name="filter-diagnostic-activities-by-time"></a>Диагностические действия фильтра по времени

Можно отфильтровать список возвращаемых действий диагностики с помощью **- StartTime** и **- EndTime** параметров. **- StartTime** параметр возвратит список действий диагностики, начиная с определенной даты, как показано в следующем примере.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -StartTime "08/01/2018"
```

**- EndTime** параметр можно добавить в командлет с **- StartTime** параметр, чтобы указать конкретный период времени, вы хотите получать результаты. Приведенный ниже командлет вернет список диагностических действий в диапазоне от 1 августа и 10 августа.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -StartTime "08/01/2018" -EndTime "08/10/2018"
```

**- StartTime** и **- EndTime** параметры также могут сочетаться с другими параметрами фильтрации.

### <a name="filter-diagnostic-activities-by-activity-type"></a>Фильтр диагностические действия по их типу

Вы также можете фильтровать диагностические действия по их типу с **- ActivityType** параметра. Следующий командлет возвращает список подключений пользователей:

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -ActivityType Connection
```

Следующий командлет возвращает список задач управления администратора:

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -ActivityType Management
```

**Get RdsDiagnosticActivities** командлет сейчас не поддерживает указание веб-канал в качестве значения свойства ActivityType.

### <a name="filter-diagnostic-activities-by-outcome"></a>Диагностические действия фильтра по результату

Список возвращаемых действий диагностики можно отфильтровать по результату с **-результат** параметра. Приведенный ниже командлет вернет список успешных действий диагностики.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -Outcome Success
```

Приведенный ниже командлет вернет список неудачных диагностических действий.

```powershell
Get-RdsDiagnosticActivities -TenantName <tenantName> -Outcome Failure
```

**-Результат** параметр также может использоваться совместно с другие необязательные параметры фильтрации.

## <a name="common-error-scenarios"></a>Распространенные ошибки

Сценарии ошибок разделены на внутри службы и внешним по отношению к виртуальному рабочему столу Windows.

* Внутренняя ошибка: указывает сценариев, в которых нельзя устранить администратором клиента и должны быть разрешены как проблему в службе поддержки. Когда вызов билет содержат идентификатор действия, имя клиента и приблизительных временных рамок проблему произошла.
* Внешние проблема: относятся сценарии, которые могут быть уменьшены системным администратором. Они являются внешними для виртуального рабочего стола Windows.

Ниже перечислены распространенные ошибки, с которыми могут столкнуться Администраторы.

>[!NOTE]
>Эта предварительная версия не включает в себя полный классификации ошибок и обновляются на регулярной основе. Чтобы убедиться, что у вас есть актуальная информация, не забудьте установить флажок в этой статье по крайней мере один раз в месяц.

### <a name="external-management-error-codes"></a>Коды ошибок внешнего управления

|Числовой код|Код ошибки|Предлагаемое решение|
|---|---|---|
|3|UnauthorizedAccess|Пользователь попытался выполнить командлет PowerShell администратора не имеет разрешений для этого или неправильно ввел свое имя пользователя.|
|1000|TenantNotFound|Введенное имя клиента не соответствует любых существующих клиентов. Имя клиента, наличие опечаток и повторите попытку.|
|1006|TenantCannotBeRemovedHasSessionHostPools|Невозможно удалить клиента, так как долго она содержит объекты. Сначала удалите пулы узлов сеанса, а затем повторите попытку.|
|2000|HostPoolNotFound|Введенное имя пула узлов не соответствует любой существующих пулов узлов. Проверьте имя узла пула опечаток и повторите попытку.|
|2005|HostPoolCannotBeRemovedHasApplicationGroups|Невозможно удалить пул узла до тех пор, пока она содержит объекты. Сначала удалите все группы приложений в пуле узлов.|
|2004|HostPoolCannotBeRemovedHasSessionHosts|Удалите все узлы сеансов, которые потом удалить пул узлов сеанса.|
|5001|SessionHostNotFound|Узел сеансов, которые можно запросить может быть отключен. Проверьте состояние пула узлов.|
|5008|SessionHostUserSessionsExist |Перед выполнением действия предполагаемого управления необходимо подписать всех пользователей на узле сеанса.|
|6000|AppGroupNotFound|Введенное имя группы приложений не соответствует любой существующей группы приложений. Проверьте имя группы приложений для опечаток и повторите попытку.|
|6022|RemoteAppNotFound|Введенное имя RemoteApp не соответствует любой RemoteApps. Просмотрите имя RemoteApp опечаток и повторите попытку.|
|6010|PublishedItemsExist|Ресурс, который вы пытаетесь опубликовать называется так же, как ресурс, который уже существует. Измените имя ресурса и повторите попытку.|
|7002|NameNotValidWhiteSpace|Не используйте пробелы в имени.|
|8000|InvalidAuthorizationRoleScope|Введенное имя роли не соответствует любые существующие имена ролей. Имя роли для опечаток и повторите попытку. |
|8001|UserNotFound |Введенное имя пользователя не соответствует любые существующие имена пользователей. Проверьте наличие опечаток имя и повторите попытку.|
|8005|UserNotFoundInAAD |Введенное имя пользователя не соответствует любые существующие имена пользователей. Проверьте наличие опечаток имя и повторите попытку.|
|8008|TenantConsentRequired|Следуйте инструкциям [здесь](tenant-setup-azure-active-directory.md#grant-azure-active-directory-permissions-to-the-windows-virtual-desktop-preview-service) для предоставления согласия для вашего клиента.|

### <a name="external-connection-error-codes"></a>Коды ошибок внешнее соединение

|Числовой код|Код ошибки|Предлагаемое решение|
|---|---|---|
|-2147467259|ConnectionFailedAdTrustedRelationshipFailure|Узел сеансов правильно не присоединен к Active Directory.|
|-2146233088|ConnectionFailedUserHasValidSessionButRdshIsUnhealthy|Соединения не удалось, так как узел сеансов недоступен. Проверьте работоспособность узла сеансов.|
|-2146233088|ConnectionFailedClientDisconnect|Если эта ошибка появляется часто, убедитесь, что компьютер пользователя подключен к сети.|
|-2146233088|ConnectionFailedNoHealthyRdshAvailable|Сеанс пользователя узла пытался выполнить подключение к неисправна. Отладка виртуальной машины.|
|-2146233088|ConnectionFailedUserNotAuthorized|У пользователя нет разрешения на доступ к опубликованного приложения или рабочего стола. Ошибка может возникать после администратор удаления опубликованных ресурсов. Попросите пользователя обновить веб-канала в приложение удаленного рабочего стола.|
|2|FileNotFound|Приложение, которое пользователь попытался получить доступ к либо неправильно установлена или присвоено неправильный путь.|
|3|InvalidCredentials|Имя пользователя или пароль, введенные пользователем, не соответствует любые существующие имена пользователей и пароли. Проверьте учетные данные для опечаток и повторите попытку.|
|8|ConnectionBroken|Сброс подключения между клиентом и шлюза или сервера. Действий не требуется, если это происходит непредвиденное.|
|14|UnexpectedNetworkDisconnect|Сброс подключения к сети. Попросите пользователя попытку подключения.|
|24|ReverseConnectFailed|Узла виртуальной машины имеет нет прямой видимости для шлюза удаленных рабочих Столов. Убедитесь, что адрес IP-адрес шлюза можно разрешить.|

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о ролях в пределах виртуального рабочего стола Windows, см. в разделе [среды Апробация виртуального рабочего стола Windows](environment-setup.md).

Чтобы просмотреть список доступных командлетов PowerShell для виртуального рабочего стола Windows, см. в разделе [Справочник по PowerShell](/powershell/windows-virtual-desktop/overview).
