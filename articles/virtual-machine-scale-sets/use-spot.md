---
title: Создание набора масштабов, использующем vMs Azure Spot
description: Узнайте, как создать наборы виртуальных машин Azure, которые используют Spot VMs для экономии затрат.
author: cynthn
ms.service: virtual-machine-scale-sets
ms.workload: infrastructure-services
ms.topic: article
ms.date: 03/25/2020
ms.author: cynthn
ms.openlocfilehash: a7bd22032a554c83a2ea2323ffdb3ae52dfe4faf
ms.sourcegitcommit: 980c3d827cc0f25b94b1eb93fd3d9041f3593036
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2020
ms.locfileid: "80545939"
---
# <a name="azure-spot-vms-for-virtual-machine-scale-sets"></a>Виртуальные наборы смазанопок azure Spot для виртуальных машинных мац 

Использование Azure Spot в наборах масштабов позволяет использовать наши неиспользованные мощности при значительной экономии средств. В любой момент времени, когда Azure требуется обратное емкость, инфраструктура Azure выселяет экземпляры Spot. Таким образом, экземпляры Spot отлично подходят для рабочих нагрузок, которые могут обрабатывать перерывы, такие как задания по обработке пакетов, среды для разработки разработчиков/тестов, большие вычислительные нагрузки и многое другое.

Количество доступных мощностей может варьироваться в зависимости от размера, региона, времени суток и более. При развертывании экземпляров Spot в наборах масштабов Azure распределяет экземпляр только при наличии емкости, но для этих экземпляров нет SLA. Набор спотового масштаба развертывается в одном домене неисправности и не гарантирует высокую доступность.


## <a name="pricing"></a>Цены

Цены для экземпляров Spot переменны, в зависимости от региона и SKU. Для получения дополнительной информации оценивайте [цены](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/) на Linux и [Windows.](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/windows/) 


При переменных ценах, у вас есть возможность установить максимальную цену, в долларах США (USD), используя до 5 десятичных мест. Например, значение `0.98765`будет максимальной ценой $0.98765 USD в час. Если вы установите максимальную `-1`цену, которая будет, экземпляр не будет выселен в зависимости от цены. Цена для экземпляра будет текущая цена для Spot или цена для стандартного экземпляра, который всегда меньше, до тех пор, пока есть емкость и квота.

## <a name="eviction-policy"></a>Политика выселения

При создании наборов шкалы Spot можно настроить политику выселения на *Deallocate* (по умолчанию) или *удалить.* 

Политика *Deallocate* перемещает высеченные экземпляры в состояние остановленных стойло, что позволяет передислоцировать высеченные экземпляры. Однако нет гарантии, что распределение будет выполнено успешно. Виртуальные машины, распределение которых отменено, будут учитываться в квоте экземпляра масштабируемого набора, и вам будет выставлен счет за базовые диски. 

Если вы хотите, чтобы ваши экземпляры в шкале Spot были удалены при выселении, вы можете *удалить*политику выселения. Если установлена политика вытеснения с действием удаления, то можно создавать новые виртуальные машины, увеличивая свойство количества экземпляров масштабируемого набора. Вытесненные виртуальные машины удаляются вместе с их базовыми дисками, и поэтому вы не будете платить за хранение. Также можно использовать функцию автомасштабирования масштабируемых наборов, чтобы автоматически попытаться компенсировать вытесненные виртуальные машины, однако нет гарантии, что распределение будет успешным. Рекомендуется использовать функцию автоматического масштаба в наборах spot scale только при установке политики выселения для удаления, чтобы избежать стоимости дисков и ограничения квот. 

Пользователи могут зарегистрироваться для получения уведомлений в VM через [Azure Scheduled Events.](../virtual-machines/linux/scheduled-events.md) Это уведомит вас, если ваши ВМ выселяются, и у вас будет 30 секунд, чтобы закончить любые задания и выполнить задачи выключения до выселения. 


## <a name="deploying-spot-vms-in-scale-sets"></a>Развертывание Spot VMs в наборах масштабов

Для развертывания Spot VMs в наборах масштабов можно настроить новый флаг *Priority* для *spot.* Все вмвм в наборе масштабов будут установлены на Spot. Чтобы создать набор масштабов с помощью Spot VMs, используйте один из следующих методов:
- [Портал Azure](#portal)
- [Azure CLI](#azure-cli)
- [Azure PowerShell](#powershell)
- [Шаблоны Azure Resource Manager](#resource-manager-templates)

## <a name="portal"></a>Портал

Процесс создания набора масштабов, используюго Spot VMs, так же, как и подробно описано в [начинаюй статье.](quick-create-portal.md) При развертывании набора масштабов можно установить флаг Spot и политику выселения: ![Создать набор шкалы с помощью Spot VMs](media/virtual-machine-scale-sets-use-spot/vmss-spot-portal-max-price.png)


## <a name="azure-cli"></a>Azure CLI

Процесс создания набора масштабов с Spot VMs такой же, как и подробный в [начинаюй статье.](quick-create-cli.md) Просто добавьте '--Приоритетное `--max-price`пятно', и добавьте . В этом примере `-1` `--max-price` мы используем для этого экземпляр не будет выселен в зависимости от цены.

```azurecli
az vmss create \
    --resource-group myResourceGroup \
    --name myScaleSet \
    --image UbuntuLTS \
    --upgrade-policy-mode automatic \
    --admin-username azureuser \
    --generate-ssh-keys \
    --priority Spot \
    --max-price -1 
```

## <a name="powershell"></a>PowerShell

Процесс создания набора масштабов с Spot VMs такой же, как и подробный в [начинаюй статье.](quick-create-powershell.md)
Просто добавьте '-Приоритетное `-max-price` пятно', и поставить на [New-AzVmssConfig](/powershell/module/az.compute/new-azvmssconfig).

```powershell
$vmssConfig = New-AzVmssConfig `
    -Location "East US 2" `
    -SkuCapacity 2 `
    -SkuName "Standard_DS2" `
    -UpgradePolicyMode Automatic `
    -Priority "Spot" `
    --max-price -1
```

## <a name="resource-manager-templates"></a>Шаблоны Resource Manager

Процесс создания набора масштабов, использующем Spot VMs, так же, как и подробно описано в начинающемся статье для [Linux](quick-create-template-linux.md) или [Windows.](quick-create-template-windows.md) 

Для развертывания шаблонов`"apiVersion": "2019-03-01"` Spot используйте или позже. Добавьте `priority` `evictionPolicy` в `billingProfile` `"virtualMachineProfile":` раздел раздел и свойства: 

```json
                "priority": "Spot",
                "evictionPolicy": "Deallocate",
                "billingProfile": {
                    "maxPrice": -1
                }
```

Чтобы удалить экземпляр после его выселения, `evictionPolicy` `Delete`измените параметр на .

## <a name="faq"></a>ВОПРОСЫ И ОТВЕТЫ

**В.** После создания экземпляр Spot совпадает со стандартным экземпляром?

**A:** Да, за исключением нет SLA для Spot VMs, и они могут быть выселены в любое время.


**В.** Что делать, когда вас выселят, но все равно нужна емкость?

**A:** Мы рекомендуем вам использовать стандартные VMs вместо Spot VMs, если вам нужна емкость сразу.


**В.** Как управляется квота для Spot?

**A:** Точечные экземпляры и стандартные экземпляры будут иметь отдельные пулы квот. Точечная квота будет распределена между ВМ и увеличенными экземплярами. Дополнительные сведения см. в статье [Подписка Azure, границы, квоты и ограничения службы](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits).


**В.** Могу ли я запросить дополнительную квоту для Spot?

**A:** Да, вы сможете отправить запрос на увеличение квоты для Spot VMs через [стандартный процесс запроса квоты.](https://docs.microsoft.com/azure/azure-portal/supportability/per-vm-quota-requests)


**В.** Могу ли я преобразовать существующие наборы масштабов в наборы масштабов Spot?

**A:** Нет, установка `Spot` флага поддерживается только во время создания.


**В.** Если я `low` использовал для низкоприоритетных мачеховых `Spot` наборов, нужно ли начинать использовать вместо этого?

**A:** На данный `low` `Spot` момент, как и будет работать, `Spot`но вы должны начать переход к использованию .


**В.** Могу ли я создать набор масштабов как с обычными VM, так и с Spot VM?

**A:** Нет, набор масштабов не может поддерживать более одного типа приоритетов.


**В.**  Могу ли я использовать автомасштаб с наборами spot scale?

**A:** Да, вы можете установить правила автоматического масштабирования в наборе масштабов Spot. Если ваши ВМ выселяются, автомасштаб может попытаться создать новые Spot VMs. Однако помните, что получение этой емкости не гарантируется. 


**В.**  Работает ли автомасштабная система с обеими политиками выселения (дераспределение милитировать и удалять)?

**A:** Рекомендуется удалять политику выселения при использовании автомасштабирования. Причина этого состоит в том, что экземпляры, распределение которых отменено, учитываются в емкости масштабируемого набора. При использовании автомасштабирования, скорее всего, вы быстро достигнете целевого количества из-за вытесненных экземпляров, распределение которых отменено. 


**В.** Какие каналы поддерживают Spot VMs?

**A:** Ниже приведена таблица доступности Spot VM.

<a name="channel"></a>

| Лазурные каналы               | Доступность VMs-м высочесала azure Spot       |
|------------------------------|-----------------------------------|
| Соглашение Enterprise         | Да                               |
| Оплата по мере использования                | Да                               |
| Поставщик облачных служб (CSP) | [Свяжитесь со своим партнером](https://docs.microsoft.com/partner-center/azure-plan-get-started) |
| Преимущества                     | Недоступно                     |
| Спонсированные                    | Недоступно                     |
| "Бесплатная пробная версия"                   | Недоступно                     |


**В.** Где я могу опубликовать вопросы?

**A:** Вы можете разместить и `azure-spot` пометить свой вопрос на [&А](https://docs.microsoft.com/answers/topics/azure-spot.html). 

## <a name="next-steps"></a>Дальнейшие действия

Ознакомьтесь со сведениями о ценах на [странице для определения тарифа масштабируемых наборов виртуальных машин](https://azure.microsoft.com/pricing/details/virtual-machine-scale-sets/linux/).
