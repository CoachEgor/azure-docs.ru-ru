---
title: Основные сведения о репозитории моделей Интернета вещей Azure | Документация Майкрософт
description: Как разработчику решения или ИТ-специалисту вы узнаете об основных понятиях репозитория модели Интернета вещей Azure.
author: JimacoMS3
ms.author: v-jambra
ms.date: 07/24/2020
ms.topic: conceptual
ms.service: iot-pnp
services: iot-pnp
ms.openlocfilehash: 53ae5bf15c303f26d48550734f46e69ef1fcdd75
ms.sourcegitcommit: 46f8457ccb224eb000799ec81ed5b3ea93a6f06f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/28/2020
ms.locfileid: "87352486"
---
# <a name="azure-iot-model-repository"></a>Репозиторий моделей Интернета вещей Azure

Репозиторий моделей Интернета вещей Azure позволяет построителям устройств управлять моделями устройств IoT Plug and Play и предоставлять к ним общий доступ. Модели устройств — это документы JSON LD, определенные с помощью [языка двойников моделирования Digital (дтдл)](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md). Модели, хранящиеся в службе репозитория модели, можно совместно использовать с разработчиками решений в частном порядке благодаря контролю доступа или открытым без проверки подлинности для интеграции и разработки облачного решения IoT Plug and Play.

Доступ к репозиторию модели можно получить с помощью:

- Портал [репозитория для модели Интернета вещей Azure](https://aka.ms/iotmodelrepo)
- [REST API репозитория модели Интернета вещей Azure](https://docs.microsoft.com/rest/api/iothub/digitaltwinmodelrepositoryservice/getmodelasync/getmodelasync)
- [Команды репозитория моделей IoT Azure CLI](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/pnp?view=azure-cli-latest)

## <a name="public-models"></a>Открытые модели

Общедоступные модели Digital двойника, хранящиеся в репозитории модели, доступны всем пользователям для использования и интеграции в своем приложении без какой бы то ни было проверки подлинности. Кроме того, общедоступные модели позволяют разработчикам устройств и сборщикам решений совместно использовать и повторно использовать свои модели устройств IoT Plug and Play.

Инструкции по публикации модели в репозитории моделей, чтобы сделать ее общедоступной, см. в разделе [Публикация модели](#publish-a-model) в **моделях компании** .

Для просмотра общей модели с помощью портала репозитория моделей выполните следующие действия.

1. Перейдите на [портал репозитория для модели Интернета вещей Azure](https://aka.ms/iotmodelrepo).

1. Выберите на **Просмотр открытых моделей**.

    ![Просмотр открытых моделей](./media/concepts-model-repository/public-models.png)

Чтобы просмотреть открытую модель программным способом с помощью REST API, см. статью [Получение модели](https://docs.microsoft.com/rest/api/iothub/digitaltwinmodelrepositoryservice/getmodelasync/getmodelasync) REST API документации.

```csharp
var httpClient = new HttpClient();
httpClient.BaseAddress = new Uri("<url>");

var modelId = "dtmi:com:mxchip:model;1";
var response = await httpClient.GetAsync($"/models/{modelId}?api-version=2020-05-01-preview").ConfigureAwait(false);
```

Чтобы просмотреть открытую модель с помощью интерфейса командной строки, см. команду Azure CLI [получить модель](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/pnp/model?view=azure-cli-latest#ext-azure-iot-az-iot-pnp-model-show) .

## <a name="company-models"></a>Модели компании

Репозиторий модели компании — это клиент в репозитории модели Интернета вещей Azure для создания и управления моделями Digital двойника, созданными пользователями в вашей компании или организации. Модели компании доступны только для пользователей, прошедших проверку подлинности вашей компании или организации. Администратор клиента в репозитории модели может назначать разрешения и управлять доступом других пользователей в компании или организации к моделям в репозитории модели компании.

### <a name="set-up-your-company-model-repository"></a>Настройка репозитория модели компании

Используйте *учетную запись рабочей или учебной Azure Active Directory (Azure AD)* для доступа к хранилищу моделей. Если в вашей организации уже есть клиент Azure AD, вы можете использовать учетные записи пользователей и субъекты-службы из этого клиента Azure AD.

Сведения о настройке клиента Azure AD и о создании пользователя или субъекта-службы в клиенте Azure AD см. в разделе [Дополнительные сведения](#additional-information) .

- Если вы являетесь первым пользователем вашей организации для доступа к хранилищу моделей или для входа на портал, вам предоставляется роль **Администратор клиента** . Эта роль позволяет назначать роли другим пользователям в клиенте репозитория вашей организации.

- Другим ролям можно назначать другие роли **Администратор клиента** например **Чтение моделей** или **Создание моделей**.

### <a name="understand-access-management"></a>Общие сведения об управлении доступом

В следующей таблице перечислены поддерживаемые возможности репозитория модели компании и связанные с ними разрешения.

| Функция  | Разрешение| Описание:|
|-------------|-----------|------------|
|Чтение моделей|Чтение моделей|По умолчанию все пользователи в клиенте компании могут просматривать свои корпоративные модели. Кроме того, пользователь также может просматривать закрытые модели, совместно используемые другими компаниями.|
|Управление доступом|Управление доступом|Управление назначением ролей пользователей (Добавление или удаление) для других пользователей в Организации.|
|Создание моделей|Создание моделей|Создание моделей в репозитории модели компании.|
|Опубликовать модели|Опубликовать модели|Опубликуйте модели, чтобы сделать их общедоступными для просмотра модели.|

В следующей таблице перечислены поддерживаемые роли и их возможности в репозитории модели, который можно использовать для управления доступом.

|Роль|Функция|
|----|----------|
|тенантадминистратор|Управление доступом, чтение моделей|
|Автор|Создание моделей, чтение моделей|
|Publisher|Публикация моделей, чтение моделей|

#### <a name="passing-a-security-token-when-accessing-company-models-with-a-rest-api"></a>Передача маркера безопасности при доступе к моделям компании с помощью REST API

При вызове интерфейсов API RESTFUL для управления закрытыми или общими моделями компаний необходимо предоставить маркер авторизации для пользователя или субъекта-службы в формате JWT. Сведения о получении маркера JWT для пользователя или субъекта-службы см. в разделе [Дополнительные сведения](#additional-information) .

Маркер JWT необходимо передать в заголовке HTTP авторизации в API при нацеливании на модели компании или общие модели. Маркер JWT не требуется при нацеливании на общедоступные модели.

```csharp
// sample token
var authorizationToken = "eyJhbGciOiJIUzI1NiIsInR5cCTI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c";
httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", authorizationToken);
```

### <a name="view-company-or-shared-models"></a>Просмотр модели компании или общих моделей

Для чтения модели необходимо быть членом роли *читатель* клиента репозитория или иметь доступ к модели. Вы можете просмотреть список неопубликованных моделей, к которым вам предоставлен доступ, и список опубликованных моделей, к которым вам предоставлен доступ. По умолчанию пользователи могут читать модели компании, модели, к которым они предоставили доступ другим компаниям, и всем открытым моделям.

Чтобы просмотреть организацию или общую модель с помощью портала, выполните следующие действия.

1. Войдите на [портал репозитория модели Интернета вещей Azure](https://aka.ms/iotmodelrepo).

1. Развертывание **моделей компании** — **Публикация не опубликована** на левой панели

    ![Просмотр моделей компании](./media/concepts-model-repository/view-company-models.png)

1. Развернуть **Общие модели — отменить публикацию** на левой панели

    ![Просмотр общих моделей](./media/concepts-model-repository/view-shared-models.png)

Сведения о просмотре компании или общей модели с помощью REST API см. в документации по [получению модели](https://docs.microsoft.com/rest/api/iothub/digitaltwinmodelrepositoryservice/getmodelasync/getmodelasync) REST API. Сведения о передаче в заголовке авторизации JWT в HTTP-запросе см. [в разделе Передача маркера безопасности при доступе к моделям компании с помощью REST API](#passing-a-security-token-when-accessing-company-models-with-a-rest-api) .

```csharp
var modelId = "dtmi:com:mxchip:model;1";
var response = await httpClient.GetAsync($"/models/{modelId}?api-version=2020-05-01-preview").ConfigureAwait(false);
```

Чтобы просмотреть модель компании или общую модель с помощью интерфейса командной строки, см. команду Azure CLI [получить модель](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/pnp/model?view=azure-cli-latest#ext-azure-iot-az-iot-pnp-model-show) .

### <a name="manage-roles"></a>Управление ролями

Администратор клиента может назначить роли пользователям в клиенте репозитория, чтобы они могли создавать собственные модели для компании или организации, публиковать модели или управлять ролями для других пользователей.

Чтобы добавить пользователя в роль клиента репозитория модели с помощью портала, выполните следующие действия.

1. Войдите на [портал репозитория модели Интернета вещей Azure](https://aka.ms/iotmodelrepo).

1. На левой панели выберите **Управление доступом** , а затем щелкните **+ Добавить**. В области **Добавить разрешение** введите рабочий адрес пользователя, которого нужно добавить к роли:

    ![Добавить рабочий адрес](./media/concepts-model-repository/add-user.png)

1. Выберите роль, к которой необходимо добавить пользователя, из раскрывающегося списка **ролей** . Затем выберите **сохранить**:

    ![Выбор роли](./media/concepts-model-repository/choose-role.png)

### <a name="upload-a-model"></a>Отправка модели

Чтобы передать модель в репозиторий модели компании, необходимо быть членом роли **создателя** клиента репозитория.

Эти модели не публикуются и доступны только пользователям в Организации по умолчанию. Можно также совместно использовать одну или несколько неопубликованных моделей с внешними пользователями.

Передаваемые модели являются неизменяемыми.

Идентификаторы моделей для этих моделей должны быть глобально уникальными во всех клиентах репозитория для всех передаваемых моделей.

Чтобы передать модель с помощью портала, выполните следующие действия.

1. Войдите на [портал репозитория модели Интернета вещей Azure](https://aka.ms/iotmodelrepo).

1. Разверните узел **модели компании** в левой области и выберите **создать модель**. Затем выберите **Импорт JSON**.

    ![Создание модели](./media/concepts-model-repository/create-model.png)

1. Выберите файл, который нужно передать. Если портал успешно проверяет модель, нажмите кнопку **сохранить**.

Чтобы передать модель с помощью REST API, см. раздел [Создание API модели](https://docs.microsoft.com/rest/api/iothub/digitaltwinmodelrepositoryservice/createorupdateasync/createorupdateasync) . Сведения о передаче в заголовке авторизации JWT в HTTP-запросе см. [в разделе Передача маркера безопасности при доступе к моделям компании с помощью REST API](#passing-a-security-token-when-accessing-company-models-with-a-rest-api) .

```csharp
var httpContent = new StringContent(jsonLdModel, Encoding.UTF8, "application/json");
var modelId = "dtmi:com:mxchip:model;1";
var response = await httpClient.PutAsync($"/models/{modelId}?api-version=2020-05-01-preview", httpContent).ConfigureAwait(false);
```

Сведения о передаче модели с помощью интерфейса командной строки см. в разделе Azure CLI [Создание модели](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/pnp/model?view=azure-cli-latest#ext-azure-iot-az-iot-pnp-model-create) .

### <a name="publish-a-model"></a>Публикация модели

Для публикации модели необходимо соблюдение следующих требований.

1. Для публикации модели ваша организация должна быть членом [Microsoft Partner Network](https://docs.microsoft.com/partner-center/) . Сведения о создании учетной записи центра партнеров см. в статье [Создание учетной записи центра партнеров](https://docs.microsoft.com/partner-center/mpn-create-a-partner-center-account). После утверждения учетной записи можно опубликовать модели. Дополнительные сведения см. в разделе [часто задаваемые вопросы центра партнеров](https://support.microsoft.com/help/4340639/partner-center-account-faqs).

2. Пользователь должен быть членом роли *издателя* клиента репозитория.

Модели, создаваемые и опубликованные пользователями в вашей организации, отображаются как *опубликованные модели*. Эти модели являются общедоступными и могут быть найдены любым пользователем в рамках **общих моделей**.

Чтобы опубликовать модель с помощью портала, выполните следующие действия.

1. Войдите на [портал репозитория модели Интернета вещей Azure](https://aka.ms/iotmodelrepo).

2. Разверните узел **модели компании** в левой области и выберите модель, которую необходимо опубликовать. Затем выберите **опубликовать**.

    ![Публикация модели](./media/concepts-model-repository/publish-model.png)

> [!NOTE]
> Если вы получили уведомление о том, что у вас нет идентификатора партнера Майкрософт (MPN), выполните действия по регистрации в уведомлении. Дополнительные сведения см. в разделе требования в начале этого раздела.

Сведения о публикации модели с помощью REST API см. в документации [Публикация модели](https://docs.microsoft.com/rest/api/iothub/digitaltwinmodelrepositoryservice/createorupdateasync/createorupdateasync) REST API. Укажите параметр строки запроса `update-metadata=true` для публикации модели с помощью REST API. Сведения о передаче в заголовке авторизации JWT в HTTP-запросе см. [в разделе Передача маркера безопасности при доступе к моделям компании с помощью REST API](#passing-a-security-token-when-accessing-company-models-with-a-rest-api) .

Сведения о публикации модели с помощью интерфейса командной строки см. в разделе Azure CLI [Публикация модели](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/pnp/model?view=azure-cli-latest#ext-azure-iot-az-iot-pnp-model-publish) .

### <a name="share-a-model"></a>Предоставление общего доступа к модели

Вы можете предоставлять общий доступ к моделям компании, созданным для пользователей внешних организаций. Таким образом, вы можете разрешить совместным работам просматривать и разрабатывать решения с помощью частных моделей компании.

Например, изготовителю устройства может потребоваться обеспечить конфиденциальность моделей в компании или организации. У них могут быть клиенты, которым требуется, чтобы их возможности устройств оставались конфиденциальными.

Совместное использование моделей в разных компаниях и организациях обеспечивает безопасный доступ к моделям, которые не являются общедоступными.

Для совместного использования модели компании с помощью портала:

- Если вы являетесь создателем модели, кнопки **общий доступ** и **совместное использование с** кнопками активны при просмотре модели в разделе **модели компании** .

    ![Общий доступ к модели](./media/concepts-model-repository/share-model.png)

- Чтобы предоставить общий доступ к модели внешнему пользователю, выберите **общий доступ**. В области **Общая модель** введите адрес электронной почты внешнего пользователя и нажмите кнопку **сохранить**.

- Чтобы просмотреть пользователей, которым предоставлен общий доступ к модели, выберите **общий доступ с**.

- Чтобы отменить общий доступ к модели для конкретного пользователя, выберите пользователя в списке пользователей на панели **общий доступ** . Затем выберите **Удалить** и подтвердите выбор при появлении запроса.

    ![Прекращение общего доступа](./media/concepts-model-repository/stop-sharing.png)

## <a name="additional-information"></a>Дополнительные сведения

При работе с Azure AD могут оказаться полезными следующие разделы:

- Сведения о создании нового клиента Azure AD см. [в статье Создание нового клиента в Azure AD](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-access-create-new-tenant). У большинства организаций уже будут клиенты Azure AD.

- Сведения о добавлении пользователей или гостевых пользователей в клиент Azure AD см. в статье [Добавление и удаление пользователей с помощью Azure AD](https://docs.microsoft.com/azure/active-directory/fundamentals/add-users-azure-active-directory).

- Чтобы добавить субъект-службу в клиент Azure AD, см. статью [Использование портала для создания приложения Azure AD и субъекта-службы, который имеет доступ к ресурсам](https://docs.microsoft.com/azure/active-directory/develop/howto-create-service-principal-portal).

- Сведения о том, как получить токен JWT из Azure AD для использования при вызове интерфейсов API RESTFUL, см. в статье [Получение маркера из Azure AD для авторизации запросов из клиентского приложения](https://docs.microsoft.com/azure/storage/common/storage-auth-aad-app).

## <a name="next-steps"></a>Дальнейшие действия

Следующим шагом является проверка [архитектуры Plug and Play IOT](concepts-architecture.md).