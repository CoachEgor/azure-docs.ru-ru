---
title: Руководство для разработчиков - IoT Plug и Play Preview (ru) Документы Майкрософт
description: Описание моделирования устройств для разработчиков IoT Plug и Play
author: dominicbetts
ms.author: dobett
ms.date: 12/26/2019
ms.topic: conceptual
ms.service: iot-pnp
services: iot-pnp
ms.openlocfilehash: 5fda51e6d2f62b9cbef0fcac22d5bb2ea0df905b
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "77605221"
---
# <a name="iot-plug-and-play-preview-modeling-developer-guide"></a>IoT Plug и Play Предварительный разработчик руководство разработчика

IoT Plug and Play Preview позволяет создавать устройства, рекламизующие их возможности для приложений Azure IoT. Устройства IoT Plug and Play не требуют ручной настройки, когда клиент подключает их к приложениям С поддержкой IoT Plug и Play. IoT Central является примером приложения с поддержкой IoT Plug и Play.

Чтобы создать устройство IoT Plug and Play, необходимо создать описание устройства. Описание выполнено с помощью простого языка определения под названием Digital Twins Definition Language (DTDL).

## <a name="device-capability-model"></a>Модель возможностей устройства

С помощью DTDL создается _модель возможностей устройства_ для описания частей устройства. Типичное IoT-устройство состоит из:

- Пользовательские части, которые являются вещи, которые делают ваше устройство уникальным.
- Стандартные детали, которые являются общими для всех устройств.

Эти части называются _интерфейсами_ в модели возможностей устройства. Интерфейсы определяют детали каждой детали, реализуемые устройством.

Следующий пример показывает модель возможностей устройства для устройства термостата:

```json
{
  "@id": "urn:example:Thermostat_T_1000:1",
  "@type": "CapabilityModel",
  "implements": [
    {
      "name": "thermostat",
      "schema": "urn:example:Thermostat:1"
    },
    {
      "name": "urn_azureiot_deviceManagement_DeviceInformation",
      "schema": "urn:azureiot:deviceManagement:DeviceInformation:1"
    }
  ],
  "@context": "http://azureiot.com/v1/contexts/IoTModel.json"
}
```

Модель возможностей имеет несколько необходимых полей:

- `@id`: уникальный идентификатор в виде простого единообразного названия ресурсов.
- `@type`: заявляет, что этот объект является моделью возможностей.
- `@context`: определяет версию DTDL, используемую для модели возможностей.
- `implements`: перечисляет интерфейсы, которые реализует устройство.

Каждая запись в списке интерфейсов в разделе реалий имеет:

- `name`: название программирования интерфейса.
- `schema`: интерфейс, реализованный моделью возможностей.

Существуют дополнительные дополнительные поля, которые можно использовать для добавления более подробной информации к модели возможностей, такие как имя дисплея и описание. Интерфейсы, заявленные в модели возможностей, можно рассматривать как компоненты устройства. Для публичного предварительного просмотра список интерфейсов может иметь только одну запись в схеме.

## <a name="interface"></a>Интерфейс

С помощью DTDL вы описываете возможности вашего устройства с помощью интерфейсов. Интерфейсы описывают _свойства,_ _телеметрию_и _команды_ части реализации устройства:

- `Properties`. Свойства являются полями данных, которые представляют состояние вашего устройства. Используйте свойства для представления прочного состояния устройства, например, выключенное состояние насоса охлаждающей жидкости. Свойства также могут представлять основные свойства устройства, такие как прошивка версии устройства. Вы можете объявить свойства как только для чтения или writable.
- `Telemetry`. Телеметрические поля представляют собой измерения с датчиков. Всякий раз, когда устройство принимает датчик измерения, он должен отправить телеметрии событие, содержащее данные датчика.
- `Commands`. Команды представляют методы, которые пользователи устройства могут выполнять на устройстве. Например, команда сбросить или команду для включения или выключения вентилятора.

Следующий пример показывает интерфейс для устройства термостата:

```json
{
  "@id": "urn:example:Thermostat:1",
  "@type": "Interface",
  "contents": [
    {
      "@type": "Telemetry",
      "name": "temperature",
      "schema": "double"
    }
  ],
  "@context": "http://azureiot.com/v1/contexts/IoTModel.json"
}
```

Интерфейс имеет несколько необходимых полей:

- `@id`: уникальный идентификатор в виде простого единообразного названия ресурсов.
- `@type`: заявляет, что этот объект является интерфейсом.
- `@context`: определяет версию DTDL, используемую для интерфейса.
- `contents`: перечисляет свойства, телеметрию и команды, которые составляют устройство.

В этом простом примере есть только одно поле телеметрии. Минимальное описание поля имеет:

- `@type`: определяет тип возможностей: `Telemetry`, `Property`или `Command`.
- `name`: дает название значения телеметрии.
- `schema`: определяет тип данных для телеметрии. Это значение может быть примитивным типом, таким как двойной, целый ряд, булейн или строка. Также поддерживаются сложные типы объектов, массивы и карты.

Другие дополнительные поля, такие как имя дисплея и описание, позволяют добавить более подробную информацию в интерфейс и возможности.

### <a name="properties"></a>Свойства

По умолчанию свойства только читаются. Свойства только для чтения означают, что устройство сообщает об обновлениях значений свойств в вашем концентраторе IoT. Ваш концентратор IoT не может установить значение свойства только для чтения.

Вы также можете пометить свойство как записываемое на интерфейсе. Устройство может получать обновление для свойств, подающихся записью, из вашего концентратора IoT, а также сообщать об обновлениях стоимости свойства в вашем концентраторе.

Устройства не должны быть подключены к установленным значениям свойств. Обновленные значения передаются при подключении следующего устройства к концентратору. Такое поведение относится как к читаемым свойствам, так и к свойствам, которые можно сделать.

Не используйте свойства для отправки телеметрии с устройства. Например, только для чтения `temperatureSetting=80` свойство должно означать, что температура устройства была установлена до 80, и устройство пытается добраться до этой температуры или остаться на ней.

Для записываемых свойств приложение устройства возвращает желаемый код состояния состояния, версию и описание, чтобы указать, получало ли оно и применяло значение свойства.

### <a name="telemetry"></a>Телеметрия

По умолчанию IoT Hub направляет все телеметрические сообщения с устройств [на встроенную конечную точку обслуживания **(сообщения/события),**](../iot-hub/iot-hub-devguide-messages-read-builtin.md) которая совместима с [концентраторами событий.](https://azure.microsoft.com/documentation/services/event-hubs/)

Пользовательские [конечные точки IoT Hub и правила радиосвязи](../iot-hub/iot-hub-devguide-messages-d2c.md) можно использовать для отправки телеметрии в другие пункты назначения, такие как хранение кабелей или другие концентраторы событий. Правила реуктора используют свойства сообщений для выбора сообщений.

### <a name="commands"></a>Команды

Команды синхронны или асинхронны. Синхронная команда должна выполняться в течение 30 секунд по умолчанию, и устройство должно быть подключено при поступления команды. Если устройство реагирует вовремя или устройство не подключено, то команда выходит из строя.

Используйте асинхронные команды для длительных операций. Устройство отправляет информацию о ходе работы с помощью телеметрических сообщений. Эти сообщения прогресса имеют следующие свойства заголовка:

- `iothub-command-name`: название команды, `UpdateFirmware`например .
- `iothub-command-request-id`: идентификатор запроса, генерируемый на стороне сервера и отправленный на устройство в первом вызове.
- `iothub-interface-id`Идентификатор интерфейса, например, `urn:example:AssetTracker:1`определяется.
 `iothub-interface-name`: экземпляр название этого интерфейса, например `myAssetTracker`.
- `iothub-command-statuscode`: код статуса, возвращенный `202`с устройства, например.

## <a name="register-a-device"></a>Регистрация устройства

IoT Plug and Play позволяет легко рекламировать возможности вашего устройства. С IoT Plug и Play, после того, как устройство подключается к IoT Концентратор, вы должны зарегистрировать модель возможностей устройства. Регистрация позволяет клиентам использовать возможности IoT Plug и Play вашего устройства.

В этом руководстве показано, как зарегистрировать устройство с помощью SDK Для C.

Для каждого интерфейса, который реализует устройство, необходимо создать интерфейс и подключить его к его реализации.

Для интерфейса термостата, показанного ранее, с помощью C SDK, вы создаете и подключаете интерфейс термостата к его реализации:

```c
DIGITALTWIN_INTERFACE_HANDLE thermostatInterfaceHandle;

DIGITALTWIN_CLIENT_RESULT result = DigitalTwin_InterfaceClient_Create(
    "thermostat",
    "urn:example:Thermostat:1",
    null, null,
    &thermostatInterfaceHandle);

result = DigitalTwin_Interface_SetCommandsCallbacks(
    thermostatInterfaceHandle,
    commandsCallbackTable);

result = DigitalTwin_Interface_SetPropertiesUpdatedCallbacks(
    thermostatInterfaceHandle,
    propertiesCallbackTable);

```

Повторите этот код для каждого интерфейса, который реализует устройство.

После создания интерфейса зарегистрируйте модель возможностей и интерфейсы устройства в концентраторе IoT:

```c
DIGITALTWIN_INTERFACE_CLIENT_HANDLE interfaces[2];
interfaces[0] = thermostatInterfaceHandle;
interfaces[1] = deviceInfoInterfaceHandle;

result = DigitalTwin_DeviceClient_RegisterInterfacesAsync(
    digitalTwinClientHandle, // The handle for the connection to Azure IoT
    "urn:example:Thermostat_T_1000:1",
    interfaces, 2,
    null, null);
```

## <a name="use-a-device"></a>Использование устройства

IoT Plug and Play позволяет использовать устройства, которые зарегистрировали свои возможности в вашем концентраторе IoT. Например, можно получить доступ к свойствам и командам устройства напрямую.

Чтобы использовать устройство IoT Plug and Play, подключенное к концентратору IoT, используйте либо IoT Hub REST API, либо один из SDK-языка IoT. В следующих примерах используется API IoT Hub REST. Текущая версия API `2019-07-01-preview`. Придатитесь `?api-version=2019-07-01-preview` к вашим вызовам REST PI.

Чтобы получить значение свойства устройства, например, версии прошивки ()`fwVersion`в `DeviceInformation` интерфейсе в термостате, вы используете цифровой близнецы REST API.

Если устройство термостата `t-123`называется, вы получаете все свойства на всех интерфейсах, реализованных устройством с помощью вызова REST API GET:

```REST
GET /digitalTwins/t-123/interfaces
```

В более общем плане все свойства на всех интерфейсах `{device-id}` доступны с помощью этого шаблона REST API, где находится идентификатор устройства:

```REST
GET /digitalTwins/{device-id}/interfaces
```

Если вы знаете название интерфейса, `deviceInformation`например, и хотите получить свойства для этого конкретного интерфейса, присваивайте запрос к определенному интерфейсу по имени:

```REST
GET /digitalTwins/t-123/interfaces/deviceInformation
```

В более общем плане, свойства для определенного интерфейса `device-id` могут быть доступны через `{interface-name}` этот шаблон REST API, где является идентификатором для устройства и является названием интерфейса:

```REST
GET /digitalTwins/{device-id}/interfaces/{interface-name}
```

Вы можете вызвать команды IoT Plug и Play напрямую. Если `Thermostat` интерфейс в `t-123` устройстве `restart` имеет команду, вы можете вызвать его с помощью вызова REST API POST:

```REST
POST /digitalTwins/t-123/interfaces/thermostat/commands/restart
```

В более общем плане команды можно вызывать через этот шаблон REST API:

- `device-id`: идентификатор устройства.
- `interface-name`: название интерфейса из раздела реализаций в модели возможностей устройства.
- `command-name`: название команды.

```REST
/digitalTwins/{device-id}/interfaces/{interface-name}/commands/{command-name}
```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали о моделировании устройств, вот некоторые дополнительные ресурсы:

- [Цифровой язык определения близнецов (DTDL)](https://aka.ms/DTDL)
- [Пакет SDK для устройств для C](https://docs.microsoft.com/azure/iot-hub/iot-c-sdk-ref/)
- [IoT REST API](https://docs.microsoft.com/rest/api/iothub/device)
