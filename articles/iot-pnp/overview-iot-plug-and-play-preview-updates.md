---
title: Новые возможности Обновление предварительной версии IoT Plug and Play | Документация Майкрософт
description: Узнайте о новых возможностях обновления предварительной версии IoT Plug and Play.
author: rido-min
ms.author: rmpablos
ms.date: 07/06/2020
ms.topic: overview
ms.custom: mvc
ms.service: iot-pnp
services: iot-pnp
manager: eliotgra
ms.openlocfilehash: c415ffdaa2eb3ad6a76cd48c3a895b6618dd3986
ms.sourcegitcommit: 4913da04fd0f3cf7710ec08d0c1867b62c2effe7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/14/2020
ms.locfileid: "88208061"
---
# <a name="iot-plug-and-play-preview-refresh"></a>Обновление предварительной версии IoT Plug and Play

В этой статье описываются основные изменения в пакетах SDK, библиотеках, средствах и службах в обновлении предварительной версии IoT Plug and Play за июль 2020 года. Предыдущий выпуск предварительной версии IoT Plug and Play был выпущен в августе 2019 года.

## <a name="digital-twins-definition-language-dtdl"></a>Язык определения цифровых двойников (DTDL)

В этом выпуске добавлена поддержка [DTDL версии 2](https://github.com/Azure/opendigitaltwins-dtdl), а [версия 1 DTDL](https://github.com/Azure/opendigitaltwins-dtdl/tree/master/DTDL/v1-preview) объявлена нерекомендуемой.

В следующем списке приведены основные различия между DTDL версии 1 и 2. В DTDL версии 2:

- Идентификаторы моделей имеют префикс `dtmi` вместо `urn`. Вместо идентификаторов цифровых двойников с префиксом `urn`, используемых в DTDL версии 1, применяются идентификаторы моделей цифровых двойников (DTMI). Перед версией теперь стоит `;`. Например, там, где ранее использовалось `urn:CompanyName:Model:1`, теперь используется `dtmi:CompanyName:Model;1`.
- Для `@context` необходимо задать значение `dtmi:dtdl:context;2` вместо `http://azureiot.com/v1/contexts/IoTModel.json`.
- Для моделирования устройства вместо типов **CapabilityModel** используется тип **Interface**.
- **Компоненты** используются вместо экземпляров **интерфейса**. В составе содержимого **интерфейса** можно определить **связи** и **компоненты**.
- **Интерфейс** может наследовать только другой **интерфейс**.
- DTDL можно расширить с помощью _расширяемых семантических типов_. Эта расширяемая система типов обеспечивает большую гибкость, чем жестко запрограммированные семантические типы, такие как температура и влажность в DTDL версии 1.
- Свойство **displayUnit** удалено.
- Имя не может начинаться знаками подчеркивания или заканчиваться ими. Начальные подчеркивания в имени зарезервированы для использования системой.

Для работы с DTDL версии 1 необходимо использовать предыдущую версию пакета SDK и обозреватель интернета вещей Azure версии 0.10.x. Для работы с DTDL версии 2 необходима новейшая версия пакета SDK и обозреватель интернета вещей Azure версии 0.11.x.

## <a name="no-component-and-multiple-component-implementations"></a>Варианты реализации без компонентов и с несколькими компонентами

Простые устройства, использующие несколько данных телеметрии, команд или свойств, можно описать в одном интерфейсе без использования компонентов. Путем объявления **идентификатора модели** любое существующее устройство можно превратить в IoT Plug and Play без каких бы то ни было изменений в его существующей реализации.

Более сложные устройства могут группировать данные телеметрии, команды и свойства в разных интерфейсах для управления сложностью и обеспечения повторного использования на разных устройствах. Эти устройства должны быть обновлены для соблюдения набора простых правил, определенных в [соглашениях о сообщениях предварительной версии IoT Plug and Play](concepts-convention.md).

## <a name="registration-and-discovery"></a>Регистрация и обнаружение

В этом выпуске устройства объявляют **идентификатор модели** в Центре Интернета вещей при каждом подключении. Центр Интернета вещей кэширует **идентификатор модели**, что позволяет серверным решениям извлекать этот **идентификатор модели** с помощью свойства `modelId` двойника устройства. **Идентификатор модели** можно также получить из `$metadata.$model` в цифровом двойнике.

## <a name="microsoft-defined-interfaces"></a>Определенные корпорацией Майкрософт интерфейсы

Следующие определенные корпорацией Майкрософт интерфейсы являются нерекомендуемыми и не публикуются в новом репозитории моделей:

- **urn:azureiot:ModelDiscovery:DigitalTwin:1**
- **urn:azureiot:ModelDiscovery:ModelInformation:1**

Следующий интерфейс опубликован в новом репозитории модели: `dtmi:azure:DeviceManagement:DeviceInformation;1`, доступном по URL-адресу [https://repo.azureiotrepository.com/Models/dtmi:azure:DeviceManagement:DeviceInformation;1?api-version=2020-05-01-preview](https://repo.azureiotrepository.com/Models/dtmi:azure:DeviceManagement:DeviceInformation;1?api-version=2020-05-01-preview).

## <a name="digitaltwinchangeevents"></a>DigitalTwinChangeEvents.

Структура событий [источника события](../iot-hub/iot-hub-devguide-messages-d2c.md#non-telemetry-events) **DigitalTwinChangeEvents** изменена, и теперь для нее используется формат **JSON-Patch**. Это критическое изменение, не предполагающее поддержку обратной совместимости.

## <a name="message-routing"></a>Маршрутизация сообщений

В сообщения телеметрии в коллекции [SystemProperties](../iot-hub/iot-hub-devguide-messages-construct.md) внесены приведенные ниже изменения.

Теперь она включает свойство **dt-dataschema**, которое является зарегистрированным устройством **идентификатором модели**.

Свойство **dt-subject** представляет собой компонент, отправляющий сообщение телеметрии.

Свойство **iothub-interface-name** является нерекомендуемым.

## <a name="device-and-service-sdks"></a>Пакеты SDK для устройств и служб

Обратная совместимость с предыдущими предварительными версиями пакетов SDK отсутствует. Если вы перейдете на последнюю предварительную версию пакета SDK, вам потребуется изменить код.

При подходе, основанном на соглашениях, нет необходимости в отдельных клиентских пакетах SDK для устройств. В этом предварительном выпуске существующие библиотеки **DigitalTwinClient** не рекомендуются для всех языков. Вместо этого были обновлены клиентские пакеты SDK для устройств Центра Интернета вещей, и теперь они обеспечивают возможность объявления **идентификатора модели**.

Устройствам, которые не используют компоненты, требуются минимальные изменения в коде — достаточно просто объявить **идентификатор модели**. Более сложным устройствам, использующим несколько компонентов, для реализации [соглашений](concepts-convention.md) могут потребоваться определенные функции с возможностью повторного использования. Примеры устройств содержат набор функций, которые можно использовать повторно в реализации устройства.

### <a name="service-sdks"></a>Пакеты SDK службы

Пакет SDK службы доступен на [Node.js](https://github.com/Azure/azure-iot-sdk-node/blob/digitaltwins-preview/digitaltwins/service/readme.md) и [Python](https://github.com/Azure/azure-iot-sdk-python/blob/master/azure-iot-hub/README.md).

## <a name="vs-code-extension"></a>Расширения VS Code

Расширение [Azure IoT Device Workbench](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.vscode-iot-workbench) обеспечивает поддержку разработки для DTDL версии 1, интеграцию с предыдущей версией репозитория моделей и возможности создания кода.

Если требуется поддержка разработки для DTDL версии 2 в VS Code, установите новое [расширение DTDL](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.vscode-dtdl) в VS Code. Расширение не обеспечивает интеграцию с репозиторием моделей или функциями создания кода. Управление моделями в репозитории теперь осуществляется с помощью [веб-интерфейса](https://aka.ms/iotmodelrepo) или [интерфейса командной строки](https://docs.microsoft.com/cli/azure/ext/azure-iot/iot/pnp?view=azure-cli-latest).

## <a name="digital-twin-service-side-rest-apis"></a>Интерфейсы REST API на стороне службы цифровых двойников

Изменились [интерфейсы REST API и полезные данные на стороне службы цифровых двойников](https://docs.microsoft.com/rest/api/iothub/service/digitaltwin). Поддерживаются интерфейсы API для:

- получения цифрового двойника;
- вызова команды;
- обновления цифрового двойника с использованием полезных данных **JSON-Patch**.

В этом выпуске сохранена поддержка имеющихся интерфейсов REST API.

## <a name="model-repository"></a>Репозиторий моделей

Теперь существует единый репозиторий моделей, который содержит как общедоступные опубликованные модели, так и частные модели компаний с защитой RBAC. У всех моделей имеется уникальный идентификатор, и все они неизменяемы после создания.

Существующие репозитории моделей компаний из предыдущего выпуска в этом выпуске не поддерживаются. Вы можете по-прежнему использовать веб-сайт [Azure Certified for IoT](https://preview.catalog.azureiotsolutions.com/products) для управления старыми моделями DTDL версии 1. Однако вы больше не сможете использовать этот веб-сайт для регистрации, тестирования и сертификации устройств.

## <a name="azure-iot-central"></a>Azure IoT Central

В настоящее время Azure IoT Central обновляется для обеспечения поддержки обновления предварительной версии IoT Plug and Play.
