---
title: включение файла
description: включение файла
services: virtual-machines
author: axayjo
ms.service: virtual-machines
ms.topic: include
ms.date: 05/06/2019
ms.author: akjosh; cynthn
ms.custom: include file
ms.openlocfilehash: 3ea41a16f79f903b5ff7d2b93f74f7d3d2a0dd83
ms.sourcegitcommit: 41ca82b5f95d2e07b0c7f9025b912daf0ab21909
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/13/2019
ms.locfileid: "67133604"
---
Общие коллекции образов — это служба, который позволяет создавать структуру и организацию вокруг управляемые образы. Укажите общий галерей изображений:

- Управлять глобальной репликацией образов.
- Управление версиями и группирования образов для упрощенного управления.
- Высокой доступности образов с учетными записями хранения избыточных зоны (ZRS), в регионах с поддержкой зон доступности. ZRS обеспечивает высокий уровень устойчивости против сбоев зон.
- Совместное использование между подписками и даже между клиентами Active Directory (AD), с помощью RBAC.
- Масштабирование свои развертывания с помощью образа реплик в каждом регионе.

Используя коллекцию общих образов, вы можете делиться своими образами с другими пользователями, участниками службы или группами конструктора приложений в вашей организации. Общие образы можно реплицировать в несколько регионов для более быстрого масштабирования развертываний.

Управляемый образ представляет собой либо полную копию виртуальной машины (вместе со всеми подключенными дисками данных), либо просто копию диска операционной системы, в зависимости от того, как создается образ. При создании виртуальной машины из образа копии виртуальных жестких дисков в образе используются для создания дисков для новой виртуальной машины. Управляемый образ остается в хранилище и может использоваться для создания виртуальных машин снова и снова.

Если у вас есть большое количество управляемые образы, которые нужно хранить и хотите сделать их доступными во всей организации, можно использовать общие коллекции образов как репозиторий, который позволяет легко совместно использовать свои образы. 

Функция коллекции общих образов имеет несколько типов ресурсов.

| Ресурс | Описание|
|----------|------------|
| **Управляемый образ** | Базовый образ, который может использоваться отдельно или для создания **версию образа** в коллекции образов. Управляемые образы создаются на основе обобщенных виртуальных машин. Управляемый образ — это специальный тип виртуального жесткого диска, который может применяться для создания нескольких виртуальных машин. Теперь его можно использовать для создания версий общих образов. |
| **Коллекция образов** | Как и Azure Marketplace, **коллекция образов** — это репозиторий для управления и совместного использования образов, но в отличие от Azure Marketplace доступ к коллекции образов контролируете вы. |
| **Определение образа** | Образы определяются в пределах коллекции и содержат сведения о изображения и требования для его использования в вашей организации. Можно включить сведения, такие как изображения, является ли Windows или Linux, требования к памяти, минимальное и максимальное и заметки о выпуске. Это определение типа образа. |
| **Версия образа** | **Версия образа** используется для создания виртуальной машины с помощью коллекции. В зависимости от требований для вашей среды, у вас может быть несколько версий образа. Так же как и управляемый образ при использовании **версии образа** для создания виртуальной машины, версия образа используется для создания новых дисков для виртуальной машины. Версии образов можно использовать несколько раз. |

<br>


![Рисунок, показывающий, как использовать несколько версий образа в коллекции](./media/shared-image-galleries/shared-image-gallery.png)

## <a name="image-definitions"></a>Определения образа

Определения образа — это логические группы для версий изображения. В определении образа содержит сведения о причины создания образа, какие для операционной системы и сведения об использовании изображения. Определение изображения является как план все подробности создания определенного образа. Не развертывайте виртуальную Машину, определение изображения, но в версию образа, который создан из определения.


Существуют три параметра для каждого определения изображения, которые используются в сочетании - **издателя**, **предлагают** и **SKU**. Они используются, чтобы найти определение конкретного образа. У вас могут быть версии образов, которые совместно используют одно или два, но не все три значения.  В качестве примера ниже приведены три определения образа и их значения.

|Определение образа|Издатель|ПРЕДЛОЖЕНИЕ|Sku|
|---|---|---|---|
|myImage1|Contoso|Finance.|Серверная часть|
|myImage2|Contoso|Finance.|Внешний интерфейс|
|myImage3|Тестирование|Finance.|Внешний интерфейс|

Все три определения образа имеют уникальные наборы значений. Формат аналогичен как можно в настоящее время указать издателя, предложение и SKU для [образы Azure Marketplace](../articles/virtual-machines/windows/cli-ps-findimage.md) в Azure PowerShell, чтобы получить последнюю версию образа Marketplace. Каждое определение образ должен иметь уникальный набор из следующих значений.

Ниже приведены другие параметры, которые могут устанавливаться в определении образа, так что можно легко отслеживать ресурсы.

* Состояние операционной системы - можно присвоить состояние ОС обобщенные или специализированные, но только обобщенные в настоящее время поддерживается. Изображения должны быть созданы из виртуальных машин, которые были выведены с помощью средства Sysprep для Windows или `waagent -deprovision` для Linux.
* Операционная система — может быть Windows или Linux.
* Описание — Описание использования, чтобы предоставить более подробные сведения об Почему существует в определении образа. Например возможно определение изображения сервер переднего плана с предварительно установленным приложением.
* Лицензионное соглашение - используется для указания с лицензионным соглашением для в определении образа.
* Заметки о выпуске и заявление о конфиденциальности — хранить заметки о выпуске и заявлениями о конфиденциальности в службе хранилища Azure и предоставления URI для доступа к ним в определении образа.
* End-of-life Дата: присоединить дату end-of-life в определение образа, чтобы иметь возможность удалять старые определения образа с помощью службы автоматизации.
* Тег — можно добавить теги, при создании определения образа. Дополнительные сведения о тегах см. в разделе [использование тегов для организации ресурсов](../articles/azure-resource-manager/resource-group-using-tags.md)
* Минимальное и максимальное виртуальный ЦП и рекомендации по объему памяти - если изображение содержит рекомендации по виртуальным ЦП и памяти, можно прикрепить эту информацию в определении образа.
* Запрещенные типы дисков - можно предоставить сведения о потребностях хранилища для виртуальной Машины. Например если изображение не подходит для стандартных дисков HDD, добавлении их в список запретить.


## <a name="regional-support"></a>Поддержка в регионах

В следующей таблице перечислены исходных регионов. Всех общедоступных регионах может быть Целевые регионы, но для репликации в Центральная Австралия и 2, Центральная Австралия необходимо иметь список разрешенных вашей подписки. Чтобы запросить список разрешений, перейдите к: https://www.microsoft.com/en-au/central-regions-eligibility/


| Исходных регионов |
|---------------------|-----------------|------------------|-----------------|
| Центральная Австралия   | Центральная часть США (EUAP) | Центральная Корея    | Западно-центральная часть США |
| Центральная Австралия 2 | Восточная Азия       | Корея, юг      | Западная Европа     |
| Восточная часть Австралии      | Восточная часть США         | Центрально-северная часть США | Западная Индия      |
| Юго-Восточная часть Австралии | Восток США 2       | Северная Европа     | Запад США         |
| Южная часть Бразилии        | Восточная часть США 2 (euap)  | Центрально-южная часть США | Западный регион США 2       |
| Центральная Канада      | Центральная Франция  | Южная Индия      |                 |
| Восточная Канада         | Южная Франция    | Юго-Восточная Азия   |                 |
| Центральная Индия       | Восточная часть Японии      | Южная часть Великобритании         |                 |
| Центральный регион США          | Западная часть Японии      | Западная часть Великобритании          |                 |



## <a name="limits"></a>Ограничения 

Существуют ограничения на одну подписку, для развертывания ресурсов с помощью Shared галерей изображений:
- 100 общего образа разделом «галереи» на подписку в регионе
- 1000 определения изображения, на подписку в регионе
- 10 000 версии образов, на подписку в регионе

Дополнительные сведения см. в разделе [Проверка использования ресурсов относительно установленных ограничений](https://docs.microsoft.com/azure/networking/check-usage-against-limits) примеры о том, как проверить текущее использование.
 

## <a name="scaling"></a>Масштабирование
Коллекция общих образов позволяет указать число реплик, которые вы хотите, чтобы Azure сохранил для образов. Это помогает в сценариях развертывания нескольких виртуальных машин, поскольку их развертывания могут быть распространены на разные реплики, уменьшая вероятность того, что процесс создания экземпляра будет регулироваться из-за перегрузки отдельной реплики.


С помощью коллекции образов Shared, теперь вы можете развернуть до 1000 экземпляров виртуальных Машин в масштабируемом наборе виртуальных машин (вверх от 600 с управляемые образы). Изображение реплик обеспечивают более высокую производительность развертывания, надежность и согласованность.  Можно задать число другую реплику в каждом целевом регионе, в зависимости от потребностей масштабирования для региона. Поскольку каждая реплика глубокую копию образа, благодаря этому масштабирование развертываний линейно с каждой дополнительной реплики. Хотя мы понимаем не два изображения или областей совпадают, вот наши Общие рекомендации по использованию реплик в регионе:

- Каждые 20 виртуальных машин, создаваемых одновременно мы рекомендуем поддерживать одну реплику. Например при создании 120 виртуальных машин, одновременно с помощью одного образа в регионе, мы рекомендуем поддерживать по крайней мере 6 реплик изображения. 
- Для каждого развертывание масштабируемого набора до 600 экземплярами мы рекомендуем поддерживать по крайней мере одна реплика. Например при создании 5 масштабируемых наборах одновременно, каждый из которых 600 экземпляров виртуальных Машин с помощью одного образа в одном регионе, мы рекомендуем поддерживать по крайней мере 5 реплик изображения. 

Мы рекомендуем всегда используют избыточную подготовку число реплик из-за факторов, таких как размер изображения, содержимое и тип ОС.


![Рисунок, показывающий, как можно масштабировать образы](./media/shared-image-galleries/scaling.png)



## <a name="make-your-images-highly-available"></a>Обеспечить высокую доступность ваших образов

[Azure избыточного хранилища зоны (ZRS)](https://azure.microsoft.com/blog/azure-zone-redundant-storage-in-public-preview/) обеспечивает устойчивость к сбоям зоны доступности в регионе. С выходом общедоступной коллекции образов Shared вы можете хранить образы в учетные записи ZRS в регионах с зонами доступности. 

Можно также выбрать тип учетной записи для каждого из целевых регионов. Тип учетной записи хранения по умолчанию является Standard_LRS, но вы можете Standard_ZRS для регионов с зонами доступности. Проверьте региональную доступность ZRS [здесь](https://docs.microsoft.com/azure/storage/common/storage-redundancy-zrs).

![График, отображающий ZRS](./media/shared-image-galleries/zrs.png)


## <a name="replication"></a>Репликация
Коллекция общих образов также позволяет автоматически реплицировать свои образы в других регионах Azure. Каждую версию общего образа можно реплицировать в разных регионах в зависимости от того, что лучше всего подходит для вашей организации. Примером может служить репликация последних образов в нескольких регионах, хотя все старые версии доступны только в одном регионе. Это позволяет экономить на стоимости хранения для версий общих образов. 

Области, в которых реплицирована версия общего образа, можно обновить после создания. Время, необходимое для репликации в разных регионах, зависит от объема копируемых данных и количества регионов, в которые реплицируется версия. В некоторых случаях это может занять несколько часов. В процессе репликации можно просмотреть ее состояние для каждого региона. По завершении репликации образа в регионе, можно развернуть виртуальной Машины или масштабируемого набора с помощью этой версии образа в регионе.

![Рисунок, показывающий, как можно реплицировать образы](./media/shared-image-galleries/replication.png)


## <a name="access"></a>Доступ

Общие коллекции образов, определении образа и версия образа находятся все ресурсы, они могут совместно использовать встроенные элементы управления собственного RBAC Azure. С помощью RBAC вы можете поделиться этими материалами, чтобы другие пользователи, субъектов-служб и группы. Можно даже поделиться доступ пользователям за пределами клиенту, к которому они были созданы в течение. Когда пользователь имеет доступ к версии общего образа, они могут развернуть виртуальную Машину или масштабируемый набор виртуальных машин.  Ниже приведена матрица общего доступа, которая помогает понять, к чему пользователь получает доступ.

| Доступ предоставлен пользователю     | Общая коллекция образов | Определение образа | Версия образа |
|----------------------|----------------------|--------------|----------------------|
| Общая коллекция образов | Да                  | Да          | Да                  |
| Определение образа     | Нет                   | Да          | Да                  |

Мы рекомендуем, управления доступом на уровне коллекции для получения наилучших результатов. Не рекомендуется совместное использование отдельных версий. Дополнительные сведения о RBAC см. в разделе [управление доступом к ресурсам Azure с помощью RBAC](../articles/role-based-access-control/role-assignments-portal.md).

Изображения также могут совместно, в масштабе, даже по клиентам, с помощью регистрации мультитенантного приложения. Дополнительные сведения о совместном использовании образов клиентов см. в разделе [совместно использовать коллекции образов виртуальных Машин в Azure клиенты](../articles/virtual-machines/linux/share-images-across-tenants.md).

## <a name="billing"></a>Выставление счетов
За использование службы "Коллекция общих образов" дополнительная оплата не взимается. Плата взимается за следующие ресурсы.
- Расходы хранилища для хранения версий общих образов. Стоимость зависит от числа реплик версии образа и версии реплицируется на количество регионов. Например если у вас есть 2 образов и оба, реплицируются в трех регионах, затем вы изменится для 6 управляемых дисков в зависимости от их размера. Дополнительные сведения см. в статье [Цены на управляемые диски](https://azure.microsoft.com/pricing/details/managed-disks/).
- Плата за исходящий трафик сети для репликации первой версии образа из исходного региона в реплицируемых регионах. Последующие реплик обрабатываются внутри области, поэтому никакая дополнительная плата. 

## <a name="updating-resources"></a>Обновление ресурсов

После создания можно внести некоторые изменения для ресурсов коллекции изображений. Они ограничены:
 
Коллекция общих образов
- Описание

Определение образа
- Рекомендуемое число виртуальных ЦП
- Рекомендуемый объем памяти
- Описание
- Дата окончания жизненного цикла

Версия образа
- Количество региональных реплик
- Целевые регионы
- Исключить из последнюю версию
- Дата окончания жизненного цикла


## <a name="sdk-support"></a>Поддержка пакетов SDK

Следующие пакеты SDK поддерживают создание коллекций общих образов.

- [.NET](https://docs.microsoft.com/dotnet/api/overview/azure/virtualmachines/management?view=azure-dotnet)
- [Java](https://docs.microsoft.com/java/azure/?view=azure-java-stable)
- [Node.js](https://docs.microsoft.com/javascript/api/azure-arm-compute/?view=azure-node-latest)
- [Python](https://docs.microsoft.com/python/api/overview/azure/virtualmachines?view=azure-python)
- [Go](https://docs.microsoft.com/go/azure/)

## <a name="templates"></a>Шаблоны

Вы можете создать ресурс коллекции общих образов с помощью шаблонов. Существует несколько шаблонов быстрого запуска Azure: 

- [Создание коллекции общих образов](https://azure.microsoft.com/resources/templates/101-sig-create/)
- [Создание определения образа в коллекции общих образов](https://azure.microsoft.com/resources/templates/101-sig-image-definition-create/)
- [Создание версии образа в коллекции общих образов](https://azure.microsoft.com/resources/templates/101-sig-image-version-create/)
- [Создание виртуальной машины из версии образа](https://azure.microsoft.com/resources/templates/101-vm-from-sig/)

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы 

**Вопрос.** Как создать список всех ресурсов коллекции общих образов в разных подписках? 
 
 О. Чтобы получить список всех ресурсов коллекции общих образов в разных подписках, к которым вы имеете доступ на портале Azure, выполните следующие действия:

1. Откройте [портал Azure](https://portal.azure.com).
1. Перейдите в раздел **Все ресурсы**.
1. Выберите все подписки, из которых вы хотите включить в список все ресурсы.
1. Найдите ресурсы типа **Закрытая коллекция**.
 
   Для просмотра определений и версий образов следует также выбрать **Показать скрытые типы**.
 
   Чтобы получить список всех ресурсов коллекции общих образов в разных подписках, к которым у вас есть доступ, выполните следующую команду в Azure CLI.

   ```bash
   az account list -otsv --query "[].id" | xargs -n 1 az sig list --subscription
   ```


**Вопрос.** Можно ли перенести существующий образ в коллекцию общих образов?
 
 О. Да. Существует 3 сценария, в зависимости от типов образов, которые у вас могут быть.

 Сценарий 1. Если у вас есть управляемый образ, из него можно создать определение образа и версию образа.

 Сценарий 2. Если у вас есть неуправляемый универсальный образ, из него можно создать управляемый образ, из которого впоследствии можно создать определение образа и версию образа. 

 Сценарий 3. Если у вас есть виртуальный жесткий диск в локальной файловой системе, необходимо его отправить, создать управляемый образ, из которого впоследствии можно создать определение образа и версию образа.
- Если это виртуальный жесткий диск виртуальной машины Windows, см. раздел [Отправка универсального диска VHD и создание виртуальных машин с его помощью в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/upload-generalized-managed).
- Если это виртуальный жесткий диск виртуальной машины Linux, см. раздел [Создание виртуальной машины Linux на основе пользовательского диска с помощью Azure CLI](https://docs.microsoft.com/azure/virtual-machines/linux/upload-vhd#option-1-upload-a-vhd).


**Вопрос.** Можно ли создать версию образа из специализированного диска?

 О. Нет, в настоящее время мы не поддерживаем специализированные диски в качестве образов. Если у вас есть специализированный диск, необходимо [создать виртуальную машину из виртуального жесткого диска](https://docs.microsoft.com/azure/virtual-machines/windows/create-vm-specialized-portal#create-a-vm-from-a-disk), присоединив специализированный диск к новой виртуальной машине. Запустив виртуальную машину, необходимо следовать инструкциям, чтобы создать управляемый образ из [виртуальной машины Windows](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-custom-images) или [виртуальной машины Linux](https://docs.microsoft.com/azure/virtual-machines/linux/tutorial-custom-images). При наличии универсального управляемого образа можно начать процесс создания описания общего образа и версии образа.

 
**Вопрос.** Можно ли после создания переместить ресурс коллекции общих образов в другую подписку?

 О. Нет, ресурс коллекции общих образов невозможно переместить в другую подписку. Тем не менее при необходимости можно реплицировать версии образов в коллекции в другие регионы.

**Вопрос.** Можно ли реплицировать версии образов между облаками — 21Vianet Azure для Китая, Azure для Германии и облако Azure для государственных организаций? 

 О. Нет, реплицировать версии образов между облаками невозможно.

**Вопрос.** Можно ли реплицировать версии образов между подписками? 

 О. Нет, можно реплицировать версии образов между регионами в рамках подписки и использовать их в других подписках с помощью RBAC.

**Вопрос.** Возможно ли предоставить общий доступ к версиям образов между клиентами Azure Active Directory? 

 О. Да, можно использовать RBAC для совместного использования для частных лиц по клиентам. Но для совместного использования в масштабе, см. в разделе «общий ресурс образы из коллекции по клиентам Azure» с помощью [PowerShell](../articles/virtual-machines/windows/share-images-across-tenants.md) или [CLI](../articles/virtual-machines/linux/share-images-across-tenants.md).


**Вопрос.** Сколько времени занимает репликация версии образа между целевыми регионами?

 О. Время репликации версии образа полностью зависит от размера образа и числа регионов, в которые он реплицируется. Однако для достижения наилучших результатов рекомендуется, чтобы размер образа был маленьким, а исходный и целевые регионы находились близко друг к другу. Можно проверить состояние репликации, используя флажок ReplicationStatus.


**Вопрос.** В чем разница между исходным и целевым регионом?

 О. Исходный регион — это регион, в котором будет создана версия образа. А целевые регионы — это регионы, в которых будет храниться копия вашей версии образа. Для каждой версии образа может быть только один исходный регион. Кроме того, убедитесь, что при создании версии образа вы передали расположение исходного региона как одно из целевых регионов.  


**Вопрос.** Как указать исходный регион при создании версии образа?

 О. При создании версии образа, чтобы указать исходный регион, можно использовать теги **--location** в интерфейсе командной строки и **-Location** в PowerShell. Убедитесь, что управляемый образ, который используется в качестве базового для создания версии образа, находится в том же расположении, в котором вы хотите создать версию образа. Кроме того, убедитесь, что при создании версии образа вы передали расположение исходного региона как одно из целевых регионов.  


**Вопрос.** Как задать число реплик версии образа, создаваемых в каждом регионе?

 О. Задать число реплик версии образа, создаваемых в каждом регионе, можно двумя способами:
 
1. Количество региональных реплик, которое указывает на число реплик, создаваемых на регион. 
2. Общее количество реплик, которое является значением по умолчанию для регионов в случае, если не указано количество региональных реплик. 

Чтобы указать количество региональных реплик, передайте расположение, а также число реплик, которые вы хотите создать в этом регионе: "Центрально-южная часть США = 2". 

Если количество региональных реплик указано не для всех расположений, то количеством по умолчанию будет общее количество реплик, которое вы указали. 

Чтобы указать общее количество реплик в интерфейсе командной строки, используйте аргумент **--replica-count** в команде `az sig image-version create`.


**Вопрос.** Можно ли создать коллекцию общих образов в расположении, отличном от того, где планируется создание определения образа и версии образа?

 О. Да, это возможно. Но рекомендуется, мы рекомендуем вам сохранить группу ресурсов, общего образа коллекции, определении образа и версию образа в одном расположении.


**Вопрос.** Какова стоимость использования коллекции общих образов?

 О. За использование службы "Коллекция общих образов" плата не взимается, за исключением расходов на хранение версий образов и на исходящий трафик для репликации версий образов из исходного региона в целевые регионы.

**Вопрос.** Какую версию API следует использовать для создания коллекции общих образов, определения образа, версии образа и виртуальной машины или масштабируемого набора виртуальных машин из версии образа?

 О. Для развертываний виртуальной машины и масштабируемого набора виртуальных машин с помощью версии образа рекомендуется использовать API версии 2018-04-01 или более поздней. Для работы с коллекцией общих образов, определениями образов и версиями образов рекомендуется использовать API версии 2018-06-01. Избыточные хранилища зоны (ZRS) требуется версия 2019-03-01 или более поздней версии.
