---
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 09/30/2019
ms.author: cynthn
ms.openlocfilehash: fbc6889507e58c4721597a1108337fcb1f8756a2
ms.sourcegitcommit: 380e3c893dfeed631b4d8f5983c02f978f3188bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2020
ms.locfileid: "75752137"
---
При значительном увеличении количества виртуальных машин, размещенных в Azure, важно вычислить проблемы производительности и работоспособности, которые влияют на приложения и службы инфраструктуры, которые они поддерживают. Базовый мониторинг по умолчанию доставляется в Azure по типам метрик загрузка ЦП, использование диска, использование памяти и сетевой трафик, собранный гипервизором узла. Дополнительные данные метрик и журналов можно собирать с помощью [расширений](../articles/virtual-machines/windows/extensions-features.md) для настройки диагностики на виртуальных машинах из гостевой операционной системы.

Для обнаружения и диагностики проблем производительности и работоспособности при работе с гостевой операционной системой, компонентами веб-приложения на платформе .NET или Java, работающими на виртуальной машине, Azure Monitor обеспечивает централизованный мониторинг с помощью комплексных функций, таких как Azure Monitor для виртуальных машин и Application Insights.

## <a name="diagnostics-and-metrics"></a>Диагностика и метрики 

Можно выполнять настройку и мониторинг сбора [данных диагностики](https://docs.microsoft.com/cli/azure/vm/diagnostics) с помощью [метрик](../articles/monitoring-and-diagnostics/monitoring-overview-metrics.md) на портале Azure, а также при помощи Azure CLI, Azure PowerShell и программных интерфейсов (API). Например, вы можете:

- **Отслеживать основные метрики для виртуальной машины.** Основные метрики, представленные на экране обзора на портале Azure, включают показатели использования ЦП и сети, общую емкость диска в байтах и число операций с диском в секунду.

- **Включить сбор диагностических сведений о загрузке и просматривать их с помощью портала Azure.** При передаче собственного образа в Azure или даже при загрузке одного из образов платформ могут возникать проблемы с загрузкой виртуальной машины. Это может происходить по разным причинам. Чтобы включить диагностику загрузки при создании виртуальной машины, нажмите кнопку **Включено** рядом с параметром "Диагностика загрузки" в разделе "Мониторинг" на экране параметров.

    Когда виртуальные машины загружаются, агент системы диагностики записывает выходные данные загрузки и сохраняет их в хранилище Azure. Эти данные можно использовать для устранения неполадок загрузки виртуальной машины. Если вы создаете виртуальную машину с помощью программ командной строки, диагностика загрузки не включается автоматически. Перед включением диагностики загрузки необходимо создать учетную запись хранения для хранения журналов загрузки. Если включить диагностику загрузки на портале Azure, учетная запись хранения создается автоматически.

    Если при создании виртуальной машины вы не включили диагностику загрузки, вы сможете включить ее позже с помощью [Azure CLI](https://docs.microsoft.com/cli/azure/vm/boot-diagnostics), [Azure PowerShell](https://docs.microsoft.com/powershell/module/az.compute/set-azvmbootdiagnostic) или [шаблона Azure Resource Manager](../articles/virtual-machines/windows/extensions-diagnostics-template.md).

- **Включить сбор данных диагностики гостевой ОС.** Когда вы создаете виртуальную машину, можно включить диагностику гостевой ОС на экране параметров. Если включить сбор данных диагностики, в виртуальную машину добавляется [расширение IaaSDiagnostics для Linux](../articles/virtual-machines/linux/diagnostic-extension.md) или [расширение IaaSDiagnostics для Windows](../articles/virtual-machines/windows/ps-extensions-diagnostics.md). Это позволяет собирать дополнительные данные диска, ЦП и памяти.

    При помощи собранных данных диагностики вы можете настроить для виртуальных машин автоматическое масштабирование. Можно также настроить [журналы Azure Monitor](../articles/azure-monitor/platform/data-platform-logs.md) для хранения данных и настройки оповещений, чтобы сообщить о неправильной производительности.

## <a name="alerts"></a>Оповещения

На основе метрик производительности можно создавать [оповещения](../articles/azure-monitor/platform/alerts-overview.md). Например, вы можете использовать оповещения для уведомления о том, что средняя загрузка ЦП превышает пороговое значение или показатель свободного места на диске ниже определенного значения. Оповещения можно настроить в [портал Azure](../articles/azure-monitor/platform/alerts-metric.md#create-with-azure-portal), с помощью [шаблонов Azure Resource Manager](../articles/azure-monitor/platform/alerts-metric-create-templates.md)или [Azure CLI](../articles/azure-monitor/platform/alerts-metric.md#with-azure-cli).

## <a name="azure-service-health"></a>Служба работоспособности служб Azure

[Служба работоспособности служб Azure](../articles/service-health/service-health-overview.md) предоставляет персонализированные инструкции и поддержку при возникновении проблем в работе служб Azure, а также помогает подготовиться к предстоящему плановому обслуживанию. Служба работоспособности служб Azure отправляет пользователям и рабочим группам настраиваемые целевые уведомления.

## <a name="azure-resource-health"></a>Служба работоспособности ресурса Azure

Служба [Работоспособность ресурсов Azure](../articles/service-health/resource-health-overview.md) поможет выполнить диагностику и получить необходимую поддержку, если неполадки Azure влияют на ресурсы. Вы будете осведомлены о текущих и прошлых проблемах работоспособности ресурсов и сможете устранить их. Эта служба обеспечивает техническую поддержку при проблемах со службой Azure.

## <a name="azure-activity-log"></a>Журнал действий Azure

[Журнал действий Azure](../articles/azure-monitor/platform/platform-logs-overview.md) — это журнал подписки с подробными сведениями о событиях на уровне подписки, которые произошли в Azure. В этот журнал входят различные данные: от операционных данных Azure Resource Manager до обновлений в событиях работоспособности службы. Чтобы просмотреть журнал виртуальной машины, щелкните "Журнал действий" на портале Azure.

Ниже описано несколько доступных операций с журналом действий:

- Создание [оповещения о событии журнала действий Azure](../articles/azure-monitor/platform/platform-logs-overview.md).
- [Потоковая передача в концентратор событий](../articles/azure-monitor/platform/activity-logs-stream-event-hubs.md) для приема от сторонней службы или решения пользовательской аналитики, например Power BI.
- Проанализируйте его в Power BI с помощью [пакета содержимого Power BI](https://powerbi.microsoft.com/documentation/powerbi-content-pack-azure-audit-logs/).
- [Сохранение журнала в учетную запись хранения](../articles/azure-monitor/platform/archive-activity-log.md) для архивации или проверки вручную. В профиле журнала можно задать время хранения (в днях).

Кроме того, вы можете ознакомиться с данными журнала действий, воспользовавшись [Azure PowerShell](https://docs.microsoft.com/powershell/module/azurerm.insights/), [Azure CLI](https://docs.microsoft.com/cli/azure/monitor) или [интерфейсами Monitor REST API](https://docs.microsoft.com/rest/api/monitor/).

[Журналы ресурсов Azure](../articles/azure-monitor/platform/platform-logs-overview.md) — это журналы, СОЗДАВАЕМЫЕ виртуальной машиной, которые предоставляют широкие и часто встречающиеся данные о работе. Журналы ресурсов отличаются от журнала действий путем предоставления сведений об операциях, выполненных на виртуальной машине.

Ниже описано несколько доступных операций с журналами диагностики:

- Сохранение журналов в [учетную запись хранения](../articles/azure-monitor/platform/archive-diagnostic-logs.md) для аудита или проверки вручную. В параметрах диагностики ресурсов можно задать время хранения (в днях).
- [Потоковая передача потоков в концентраторы событий](../articles/azure-monitor/platform/resource-logs-stream-event-hubs.md) для приема сторонними службами или решениями пользовательской аналитики, например Power BI.
- Анализ журналов с помощью [Log Analytics](../articles/log-analytics/log-analytics-azure-storage.md).

## <a name="advanced-monitoring"></a>Расширенный мониторинг

Для отображения приложения или службы, поддерживаемых виртуальными МАШИНАми Azure и масштабируемыми наборами виртуальных машин, выявление проблем с гостевой ОС или рабочей нагрузкой, работающей на ВИРТУАЛЬНОЙ машине, чтобы понять, влияет ли это на доступность или производительность приложения, или на наличие проблем с приложением, включите как [Azure Monitor для виртуальных машин](../articles/azure-monitor/insights/vminsights-overview.md) , так [Application Insights](../articles/azure-monitor/app/app-insights-overview.md).

Azure Monitor для виртуальных машин отслеживает виртуальные машины Azure в масштабе, анализируя производительность и работоспособность виртуальных машин Windows и Linux, включая различные процессы и взаимосвязи между другими ресурсами и внешними процессами. обнаруживает. Он включает несколько диаграмм производительности тенденций, которые помогают в исследовании проблем и оценке емкости виртуальных машин. На карте зависимостей отображаются отслеживаемые и Неотслеживаемые компьютеры, сбойные и активные сетевые подключения между процессами и этими компьютерами, а также показаны диаграммы трендов со стандартными метриками сетевого подключения. В сочетании с Application Insights вы отслеживаете приложение и собираете данные телеметрии, такие как HTTP-запросы, исключения и т. д., что позволяет сопоставлять проблемы между виртуальными машинами и приложением. Настройте [Azure Monitor оповещения](../articles/azure-monitor/platform/alerts-overview.md) для оповещения о важных условиях, обнаруженных в данных мониторинга, собираемых Azure Monitor для виртуальных машин.

## <a name="next-steps"></a>Дальнейшие действия

- Выполните инструкции в статьях [Мониторинг виртуальных машин Windows с помощью Azure PowerShell](../articles/virtual-machines/windows/tutorial-monitoring.md) или [Мониторинг виртуальных машин Linux в Azure](../articles/virtual-machines/linux/tutorial-monitoring.md).

- Ознакомьтесь с рекомендациями по [мониторингу и диагностике](https://docs.microsoft.com/azure/architecture/best-practices/monitoring).
