---
title: включение файла
description: включение файла
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 07/08/2019
ms.author: cynthn
ms.custom: include file
ms.openlocfilehash: a57335eccfce1e81fe0cc85ae6fa7b12aa27e1c3
ms.sourcegitcommit: 47ce9ac1eb1561810b8e4242c45127f7b4a4aa1a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67805856"
---
Временные диски ОС создаются в хранилище локальной виртуальной машины (VM) и не сохраняются во внешнее хранилище Azure. Временные диски операционной системы работает также для рабочих нагрузок без отслеживания состояния, где приложения устойчивы к большому ошибок для отдельных виртуальных Машин, но более влияют на время развертывания виртуальной Машины или повторное создание образа отдельными экземплярами виртуальных Машин. С диском ОС временные вы получаете более низкую задержку чтения и записи на диск операционной системы и быстрее пересоздания образа виртуальной Машины. 
 
Перечислены ключевые возможности временные диски. 
- Идеально подходит для приложений без отслеживания состояния.
- Они могут использоваться с Marketplace и пользовательских образов.
- Возможность быстрого сброса или повторного создания образа виртуальных машин и масштабирование экземпляров набора в исходное состояние загрузки.  
- Более низкую задержку, аналогичную временный диск. 
- Временные диски ОС обслуживаются бесплатно, плата не расходы на хранилище для диска операционной системы.
- Они доступны во всех регионах Azure. 
- Временный диск ОС поддерживается [коллекции образов Shared](/azure/virtual-machines/linux/shared-image-galleries). 
 

 
Основные различия между постоянные и временные диски ОС:

|                             | Постоянный диск операционной системы                          | Временный диск ОС                              |    |
|-----------------------------|---------------------------------------------|------------------------------------------------|
| Предельный размер для диска операционной системы      | 2 Тиб                                                                                        | Кэшировать размер для размера виртуальной Машины или 2TiB, какое значение меньше. Для **размер указан в Гиб кэша**, см. в разделе [доменных служб Active Directory](../articles/virtual-machines/linux/sizes-general.md), [ES](../articles/virtual-machines/linux/sizes-memory.md), [M](../articles/virtual-machines/linux/sizes-memory.md), [FS](../articles/virtual-machines/linux/sizes-compute.md), и [GS](/azure/virtual-machines/linux/sizes-previous-gen#gs-series)              |
| Поддерживаемые размеры виртуальных машин          | Все                                                                                          | DSv1, DSv2, DSv3, Esv3, Fs, FsV2, GS, M                                               |
| Поддержка типов диска           | Управляемых и неуправляемых дисков операционной системы                                                                | Только управляемого диска ОС                                                               |
| Поддержка регионов              | все регионы.                                                                                  | все регионы.                              |
| Сохраняемость данных            | Данных диска ОС, записанных на диск ОС, хранятся в службе хранилища Azure                                  | Данные, записанные на диск операционной системы хранится в локальном хранилище виртуальной Машины и не сохраняется в хранилище Azure. |
| Состояние остановлена (освобождена)      | Виртуальные машины и экземпляры масштабируемого набора может быть остановлена (освобождена) и перезапустить из состояния остановлена (освобождена) | Виртуальные машины и экземпляры масштабируемого набора не может быть остановлена (освобождена)                                  |
| Специальной поддержки диска операционной системы | Да                                                                                          | Нет                                                                                 |
| Изменения размера диска операционной системы              | Поддерживаемые во время создания виртуальной Машины, и после виртуальная машина будет остановлена (освобождена)                                | Поддерживается при создании виртуальной Машины только                                                  |
| Изменение размера для нового размера виртуальной Машины   | Сохраняются данные диска операционной системы                                                                    | Данные на диске операционной системы, ОС значение перенастроены                                      |

## <a name="size-requirements"></a>Требования к размеру

Вы можете развернуть виртуальную Машину и экземпляр изображения до размера кэша виртуальной Машины. Например стандартную версию Windows Server образы из marketplace — приблизительно 127 ГБ, это означает, что требуется размер виртуальной Машины, кэш, размер которых превышает 127 ГБ. В этом случае [Standard_DS2_v2](/azure/virtual-machines/windows/sizes-general#dsv2-series) имеет размер кэша 86 Гиб, который недостаточно велик. Standard_DS2_v2 имеет размер кэша 172 Гиб – этого достаточно. В этом случае Standard_DS3_v2 — минимальный размер в серии DSv2, который можно использовать с этим изображением. Базовые образы Linux в образах Marketplace и Windows Server, которые обозначаются `[smallsize]` как правило, около 30 ГБ и могут использовать большую часть доступных размеров виртуальных Машин.

Временные диски также требуют, что размер виртуальной Машины поддерживает хранилище класса Premium. Размеры обычно (но не всегда) имеют `s` в имени, например DSv2 и EsV3. Дополнительные сведения см. в разделе [размеры виртуальных Машин Azure](../articles/virtual-machines/linux/sizes.md) подробности, вокруг которых размеры поддерживают хранилище класса Premium.

## <a name="powershell"></a>PowerShell

Чтобы использовать временный диск для развертывания виртуальной Машины PowerShell, используйте [AzVMOSDisk набора](/powershell/module/az.compute/set-azvmosdisk) в конфигурацию виртуальной Машины. Задайте `-DiffDiskSetting` для `Local` и `-Caching` для `ReadOnly`.     

```powershell
Set-AzVMOSDisk -DiffDiskSetting Local -Caching ReadOnly
```

Для развертываний в масштабируемом наборе, используйте [AzVmssStorageProfile набора](/powershell/module/az.compute/set-azvmssstorageprofile) командлета в конфигурации. Задайте `-DiffDiskSetting` для `Local` и `-Caching` для `ReadOnly`.


```powershell
Set-AzVmssStorageProfile -DiffDiskSetting Local -OsDiskCaching ReadOnly
```

## <a name="cli"></a>CLI

Чтобы использовать временный диск для развертывания виртуальной Машины интерфейса командной строки, задайте `--ephemeral-os-disk` параметр в [Создание виртуальной машины az](/cli/azure/vm#az-vm-create) для `true` и `--os-disk-caching` параметр `ReadOnly`.

```azurecli-interactive
az vm create \
  --resource-group myResourceGroup \
  --name myVM \
  --image UbuntuLTS \
  --ephemeral-os-disk true \
  --os-disk-caching ReadOnly \
  --admin-username azureuser \
  --generate-ssh-keys
```

Для масштабируемых наборов, используется тот же `--ephemeral-os-disk true` параметр для [az vmss create](/cli/azure/vmss#az-vmss-create) и задайте `--os-disk-caching` параметр `ReadOnly`.

## <a name="portal"></a>Портал   

На портале Azure, вы можете использовать временные диски, при развертывании виртуальной Машины, открыв **Дополнительно** раздел **дисков** вкладки. Для **используйте временный диск ОС** выберите **Да**.

![Снимок экрана, показывающий переключатель по выбору использовать временный диск ОС](./media/virtual-machines-common-ephemeral/ephemeral-portal.png)

Если вариант использования временный диск неактивна, вы выбрали размер виртуальной Машины, не имеющим размер кэша, размер которых превышает образа ОС или, не поддерживает хранилище уровня "премиум". Вернитесь к **основы** странице и попробуйте выбрать другой размер виртуальной Машины.

Можно также создать масштабируемые наборы с временные диски операционной системы, с помощью портала. Просто убедитесь, что при выборе размера виртуальной Машины с достаточно большом размере кэша, а затем в **используйте временный диск ОС** выберите **Да**.

![Снимок экрана, показывающий переключатель по выбору использовать временный диск ОС для масштабируемого набора](./media/virtual-machines-common-ephemeral/scale-set.png)

## <a name="scale-set-template-deployment"></a>Развертывание шаблона масштабируемого набора  
Процесс создания масштабируемого набора, который использует временный диск ОС является добавление `diffDiskSettings` свойства `Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile` тип ресурса в шаблоне. Кроме того, политики кэширования должно быть присвоено `ReadOnly` для временный диск ОС. 


```json
{ 
  "type": "Microsoft.Compute/virtualMachineScaleSets", 
  "name": "myScaleSet", 
  "location": "East US 2", 
  "apiVersion": "2018-06-01", 
  "sku": { 
    "name": "Standard_DS2_v2", 
    "capacity": "2" 
  }, 
  "properties": { 
    "upgradePolicy": { 
      "mode": "Automatic" 
    }, 
    "virtualMachineProfile": { 
       "storageProfile": { 
        "osDisk": { 
          "diffDiskSettings": { 
                "option": "Local" 
          }, 
          "caching": "ReadOnly", 
          "createOption": "FromImage" 
        }, 
        "imageReference":  { 
          "publisher": "Canonical", 
          "offer": "UbuntuServer", 
          "sku": "16.04-LTS", 
          "version": "latest" 
        } 
      }, 
      "osProfile": { 
        "computerNamePrefix": "myvmss", 
        "adminUsername": "azureuser", 
        "adminPassword": "P@ssw0rd!" 
      } 
    } 
  } 
}  
```

## <a name="vm-template-deployment"></a>Развертывание шаблона виртуальной Машины 
Вы можете развернуть виртуальную Машину с временный диск ОС с помощью шаблона. Процесс создания виртуальной Машины, использующей временные диски операционной системы является добавление `diffDiskSettings` свойство в тип ресурса Microsoft.Compute/virtualMachines в шаблоне. Кроме того, политики кэширования должно быть присвоено `ReadOnly` для временный диск ОС. 

```json
{ 
  "type": "Microsoft.Compute/virtualMachines", 
  "name": "myVirtualMachine", 
  "location": "East US 2", 
  "apiVersion": "2018-06-01", 
  "properties": { 
       "storageProfile": { 
            "osDisk": { 
              "diffDiskSettings": { 
                "option": "Local" 
              }, 
              "caching": "ReadOnly", 
              "createOption": "FromImage" 
            }, 
            "imageReference": { 
                "publisher": "MicrosoftWindowsServer", 
                "offer": "WindowsServer", 
                "sku": "2016-Datacenter-smalldisk", 
                "version": "latest" 
            }, 
            "hardwareProfile": { 
                 "vmSize": "Standard_DS2_v2" 
             } 
      }, 
      "osProfile": { 
        "computerNamePrefix": "myvirtualmachine", 
        "adminUsername": "azureuser", 
        "adminPassword": "P@ssw0rd!" 
      } 
    } 
 } 
```


## <a name="reimage-a-vm-using-rest"></a>Пересоздать образ виртуальной Машины с помощью REST
В настоящее время единственным способом пересоздать образ экземпляра виртуальной машины с временный диск ОС — с помощью REST API. Для масштабируемых наборов повторное создание образа уже доступны через Powershell, CLI и портала.

```
POST https://management.azure.com/subscriptions/{sub-
id}/resourceGroups/{rgName}/providers/Microsoft.Compute/VirtualMachines/{vmName}/reimage?a pi-version=2018-06-01" 
```
 
## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Вопрос. Что такое размер локальных дисков операционной системы?**

Ответ. Мы поддерживаем платформы и пользовательских образов, вплоть до размера кэша виртуальной Машины, где всех операций чтения и записи на диск операционной системы будут осуществляться на том же узле, что и виртуальная машина. 

**Вопрос. Может быть изменен временный диск ОС?**

Ответ. Нет, подготовив временный диск ОС, диск ОС невозможно изменить размер. 

**Вопрос. Можно ли подключить к виртуальной Машине временные управляемые диски?**

Ответ. Да, можно подключить управляемый диск данных к виртуальной Машине, использует временный диск ОС. 

**Вопрос. Все размеры виртуальных Машин будут поддерживаться для временных дисков операционной системы?**

Ответ. Нет, все размеры виртуальных Машин хранилища класса Premium являются поддерживаемыми (доменных служб Active Directory, ES, FS, GS и M), кроме серии B размеры серии H и серии N.  
 
**Вопрос. Временный диск ОС применим к существующих виртуальных машин и масштабируемых наборов?**

Ответ. Нет, при кратковременном диск операционной системы может использоваться только во время виртуальной Машины и создать набор масштабирования. 

**Вопрос. Можно комбинировать временные и обычных дисков ОС в масштабируемом наборе?**

Ответ. Нет, не может иметь сочетание временные и постоянные экземпляров диска ОС в один и тот же набор масштабирования. 

**Вопрос. Временный диск ОС создаются с помощью Powershell или интерфейса командной строки?**

Ответ. Да, вы можете создать виртуальные машины с помощью REST, шаблонов, PowerShell или интерфейса командной строки временный диск ОС.

**Вопрос. Какие функции не поддерживаются временный диск ОС?**

Ответ. Временные диски не поддерживают:
- Запись образов виртуальных Машин
- моментальными снимками дисков. 
- Шифрование дисков Azure 
- Azure Backup
- Azure Site Recovery  
- Переключения дисков ОС 
