---
title: включение файла
description: включение файла
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 07/08/2019
ms.author: cynthn
ms.custom: include file
ms.openlocfilehash: 0e59a28ce1fb3c562bf76420a5e62e347230e964
ms.sourcegitcommit: e3b0fb00b27e6d2696acf0b73c6ba05b74efcd85
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/30/2019
ms.locfileid: "68669813"
---
Временные диски ОС создаются в хранилище локальной виртуальной машины и не сохраняются в удаленном хранилище Azure. Диски с временными ОС хорошо подходят для рабочих нагрузок без отслеживания состояния, где приложения являются устойчивыми к сбоям отдельных виртуальных машин, но больше зависят от времени развертывания виртуальной машины или повторное создание образа отдельные экземпляры виртуальных машин. При использовании временного диска ОС вы получаете меньшую задержку при чтении и записи на диск ОС и ускоряете повторное создание образа виртуальной машины. 
 
Основные возможности временных дисков: 
- Идеально подходит для приложений без отслеживания состояния.
- Их можно использовать как в Marketplace, так и в пользовательских образах.
- Возможность быстрого сброса или повторного создания образов виртуальных машин и экземпляров масштабируемых наборов до исходного состояния загрузки.  
- Низкая задержка, аналогичная временному диску. 
- Временные диски ОС свободны, не взимается плата за диск операционной системы.
- Они доступны во всех регионах Azure. 
- Диск с временными ОС поддерживается [коллекцией общих образов](/azure/virtual-machines/linux/shared-image-galleries). 
 

 
Основные различия между постоянными и временными дисками ОС:

|                             | Диск постоянного ОС                          | Временный диск ОС                              |    |
|-----------------------------|---------------------------------------------|------------------------------------------------|
| Ограничение размера для диска ОС      | 2 тиб                                                                                        | Размер кэша для размера виртуальной машины или 2TiB, в зависимости от того, что меньше. **Размер кэша в гиб**см. в разделе [DS](../articles/virtual-machines/linux/sizes-general.md), [ES](../articles/virtual-machines/linux/sizes-memory.md), [M](../articles/virtual-machines/linux/sizes-memory.md), [FS](../articles/virtual-machines/linux/sizes-compute.md)и [GS](/azure/virtual-machines/linux/sizes-previous-gen#gs-series) .              |
| Поддерживаемые размеры виртуальных машин          | Все                                                                                          | DSv1, DSv2, DSv3, Esv3, FS, серия fsv2, GS, M                                               |
| Поддержка типов дисков           | Управляемый и неуправляемый диск ОС                                                                | Только управляемый диск ОС                                                               |
| Поддержка регионов              | все регионы.                                                                                  | все регионы.                              |
| Сохраняемость данных            | Данные диска ОС, записанные на диск ОС, хранятся в службе хранилища Azure.                                  | Данные, записанные на диск ОС, хранятся в локальном хранилище виртуальных машин и не сохраняются в службе хранилища Azure. |
| Состояние отмены выделения      | Виртуальные машины и экземпляры масштабируемых наборов могут быть остановлены и перезапущены из состояния "остановлено-освобождено". | Не удается освободить виртуальные машины и экземпляры масштабируемых наборов                                  |
| Специальная поддержка диска ОС | Да                                                                                          | Нет                                                                                 |
| Изменение размера диска ОС              | Поддерживается во время создания виртуальной машины и после отмены выделения виртуальной машины                                | Поддерживается только при создании виртуальной машины                                                  |
| Изменение размера до нового размера виртуальной машины   | Данные диска ОС сохранены                                                                    | Данные на диске ОС удалены, ОС повторно подготовлена                                      |

## <a name="size-requirements"></a>Требования к размеру

Образы виртуальных машин и экземпляров можно развернуть вплоть до размера кэша виртуальной машины. Например, к стандартным образам Windows Server из Marketplace соответствует 127 гиб. Это означает, что вам потребуется размер виртуальной машины с кэшем, превышающим 127 гиб. В этом случае [Standard_DS2_v2](/azure/virtual-machines/windows/sizes-general#dsv2-series) имеет размер кэша 86 гиб, который недостаточно велик. Standard_DS3_v2 имеет размер кэша 172 гиб, который достаточно большой. В этом случае Standard_DS3_v2 является наименьшим размером в серии DSv2, который можно использовать с этим изображением. Основные образы Linux в Marketplace и образах Windows Server, обозначенные `[smallsize]` с помощью, имеют около 30 гиб и могут использовать большинство доступных размеров виртуальных машин.

Для временных дисков также требуется, чтобы размер виртуальной машины поддерживал хранилище класса Premium. Обычно размеры (но не всегда) имеют `s` имя, например DSv2 и EsV3. Дополнительные сведения см. в статье [размеры виртуальных машин Azure](../articles/virtual-machines/linux/sizes.md) . Дополнительные сведения о том, какие размеры поддерживают хранилище класса Premium.

## <a name="powershell"></a>PowerShell

Чтобы использовать временный диск для развертывания виртуальной машины PowerShell, используйте [Set-азвмосдиск](/powershell/module/az.compute/set-azvmosdisk) в конфигурации виртуальной машины. `-DiffDiskSetting` Задайте для `Local` значение и`-Caching` равным `ReadOnly`.     

```powershell
Set-AzVMOSDisk -DiffDiskSetting Local -Caching ReadOnly
```

Для развертываний масштабируемых наборов используйте командлет [Set-азвмсссторажепрофиле](/powershell/module/az.compute/set-azvmssstorageprofile) в конфигурации. `-DiffDiskSetting` Задайте для `Local` значение и`-Caching` равным `ReadOnly`.


```powershell
Set-AzVmssStorageProfile -DiffDiskSetting Local -OsDiskCaching ReadOnly
```

## <a name="cli"></a>CLI

Чтобы использовать `--ephemeral-os-disk` временный диск для развертывания виртуальной машины CLI, присвойте параметру команды [AZ VM Create](/cli/azure/vm#az-vm-create) значение `true` , а `--os-disk-caching` параметр `ReadOnly`— значение.

```azurecli-interactive
az vm create \
  --resource-group myResourceGroup \
  --name myVM \
  --image UbuntuLTS \
  --ephemeral-os-disk true \
  --os-disk-caching ReadOnly \
  --admin-username azureuser \
  --generate-ssh-keys
```

Для масштабируемых наборов используйте один и тот `--ephemeral-os-disk true` же параметр для команды [AZ-vmss-Create](/cli/azure/vmss#az-vmss-create) и `--os-disk-caching` задайте для `ReadOnly`параметра значение.

## <a name="portal"></a>Портал   

В портал Azure можно выбрать использование временных дисков при развертывании виртуальной машины, открыв раздел **Дополнительно** на вкладке **диски** . Для **использования временного диска ОС** выберите **Да**.

![Снимок экрана, показывающий переключатель для выбора использования временного диска ОС](./media/virtual-machines-common-ephemeral/ephemeral-portal.png)

Если параметр для использования временного диска неактивен, возможно, вы выбрали размер виртуальной машины, размер кэша которого не превышает образ ОС или не поддерживает хранилище класса Premium. Вернитесь на страницу " **основные** " и выберите другой размер виртуальной машины.

Вы также можете создавать масштабируемые наборы с временными дисками ОС с помощью портала. Просто убедитесь, что выбран размер виртуальной машины с достаточным размером кэша, а затем в списке **использовать временный диск ОС** выберите **Да**.

![Снимок экрана, показывающий переключатель для выбора использования временного диска ОС для масштабируемого набора](./media/virtual-machines-common-ephemeral/scale-set.png)

## <a name="scale-set-template-deployment"></a>Развертывание шаблона масштабируемого набора  
Процесс создания масштабируемого набора, использующего временный диск ОС, заключается в добавлении `diffDiskSettings` свойства `Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile` в тип ресурса в шаблоне. Кроме того, `ReadOnly` для политики кэширования необходимо задать значение для временного диска ОС. 


```json
{ 
  "type": "Microsoft.Compute/virtualMachineScaleSets", 
  "name": "myScaleSet", 
  "location": "East US 2", 
  "apiVersion": "2018-06-01", 
  "sku": { 
    "name": "Standard_DS2_v2", 
    "capacity": "2" 
  }, 
  "properties": { 
    "upgradePolicy": { 
      "mode": "Automatic" 
    }, 
    "virtualMachineProfile": { 
       "storageProfile": { 
        "osDisk": { 
          "diffDiskSettings": { 
                "option": "Local" 
          }, 
          "caching": "ReadOnly", 
          "createOption": "FromImage" 
        }, 
        "imageReference":  { 
          "publisher": "Canonical", 
          "offer": "UbuntuServer", 
          "sku": "16.04-LTS", 
          "version": "latest" 
        } 
      }, 
      "osProfile": { 
        "computerNamePrefix": "myvmss", 
        "adminUsername": "azureuser", 
        "adminPassword": "P@ssw0rd!" 
      } 
    } 
  } 
}  
```

## <a name="vm-template-deployment"></a>Развертывание шаблона виртуальной машины 
Вы можете развернуть виртуальную машину с временным диском ОС, используя шаблон. Процесс создания виртуальной машины, использующей временные диски ОС, заключается в добавлении `diffDiskSettings` свойства в тип ресурса Microsoft. COMPUTE/virtualMachines в шаблоне. Кроме того, `ReadOnly` для политики кэширования необходимо задать значение для временного диска ОС. 

```json
{ 
  "type": "Microsoft.Compute/virtualMachines", 
  "name": "myVirtualMachine", 
  "location": "East US 2", 
  "apiVersion": "2018-06-01", 
  "properties": { 
       "storageProfile": { 
            "osDisk": { 
              "diffDiskSettings": { 
                "option": "Local" 
              }, 
              "caching": "ReadOnly", 
              "createOption": "FromImage" 
            }, 
            "imageReference": { 
                "publisher": "MicrosoftWindowsServer", 
                "offer": "WindowsServer", 
                "sku": "2016-Datacenter-smalldisk", 
                "version": "latest" 
            }, 
            "hardwareProfile": { 
                 "vmSize": "Standard_DS2_v2" 
             } 
      }, 
      "osProfile": { 
        "computerNamePrefix": "myvirtualmachine", 
        "adminUsername": "azureuser", 
        "adminPassword": "P@ssw0rd!" 
      } 
    } 
 } 
```


## <a name="reimage-a-vm-using-rest"></a>Пересоздание образа виртуальной машины с помощью функции "ОСТАВШАЯся"
В настоящее время единственный способ переобразировать экземпляр виртуальной машины с эфемерным диском ОС заключается в использовании REST API. Для масштабируемых наборов повторное создание образа уже доступно через PowerShell, CLI и портал.

```
POST https://management.azure.com/subscriptions/{sub-
id}/resourceGroups/{rgName}/providers/Microsoft.Compute/VirtualMachines/{vmName}/reimage?a pi-version=2018-06-01" 
```
 
## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы

**Вопрос. Каков размер локальных дисков ОС?**

Ответ. Мы поддерживаем платформу и пользовательские образы, вплоть до размера кэша виртуальной машины, где все операции чтения и записи на диск ОС будут локальными на том же узле, что и виртуальная машина. 

**Вопрос. Можно ли изменить размер временного диска ОС?**

Ответ. Нет, после подготовки диска с эфемерной ОС размер диска ОС изменить нельзя. 

**Вопрос. Можно ли подключить управляемые диски к эфемерной виртуальной машине?**

Ответ. Да, вы можете подключить управляемый диск данных к виртуальной машине, которая использует временный диск ОС. 

**Вопрос. Будут ли поддерживаться все размеры виртуальных машин для временных дисков ОС?**

Ответ. Нет, поддерживаются все размеры виртуальных машин хранилища класса Premium (DS, ES, FS, GS и M), за исключением размеров серии B, N и серии H.  
 
**Вопрос. Можно ли применить временный диск ОС к существующим виртуальным машинам и масштабируемым наборам?**

Ответ. Нет, диск временного ОС можно использовать только во время создания виртуальной машины и масштабируемого набора. 

**Вопрос. Можно ли смешивать временные и обычные диски ОС в масштабируемом наборе?**

Ответ. Нет, в одном масштабируемом наборе нельзя сочетать временные и постоянные экземпляры дисков ОС. 

**Вопрос. Можно ли создать временный диск ОС с помощью PowerShell или CLI?**

Ответ. Да, вы можете создавать виртуальные машины с временным диском ОС, используя функции RESTFUL, шаблоны, PowerShell и CLI.

**Вопрос. Какие функции не поддерживаются с временным диском ОС?**

Ответ. Временные диски не поддерживают:
- Запись образов виртуальных машин
- моментальными снимками дисков. 
- Шифрование диска Azure 
- Azure Backup
- Служба Azure Site Recovery  
- Переключение диска ОС 
