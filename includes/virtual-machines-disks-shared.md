---
title: Включить имя файла
description: включить файл
services: virtual-machines
author: roygara
ms.service: virtual-machines
ms.topic: include
ms.date: 04/08/2020
ms.author: rogarana
ms.custom: include file
ms.openlocfilehash: c3e5beaef7fcc9d407103834e2040957ff32984c
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81008572"
---
Общие диски Azure (Предварительная версия) — это новая функция для управляемых дисков Azure, которая позволяет подключать управляемые диски одновременно к нескольким виртуальным машинам. Присоединение управляемого диска к нескольким виртуальным машинам позволяет либо развернуть новые или перенести существующие кластерные приложения в Azure.

## <a name="how-it-works"></a>Принцип работы

Виртуальные машины в кластере могут выполнять чтение или запись на подключенный диск в соответствии с резервированием, выбранным кластеризованным приложением, с использованием [постоянных резервирований SCSI](https://www.t10.org/members/w_spc3.htm) (по протоколу SCSI). Использование объединительной системы SCSI — это промышленный стандарт, используемый приложениями, работающими в локальной сети хранения данных (SAN). Включение параметра SCSI PR на управляемом диске позволяет перенести эти приложения в Azure "как есть".

Общий доступ к управляемым дискам — это общее блочное хранилище, доступ к которому можно получить из нескольких виртуальных машин. они предоставляются в виде логических номеров устройств (LUN). Затем LUN представляются инициатору (виртуальной машине) из целевого объекта (диска). Эти LUN похожи на виртуальную машину с прямым подключением (DAS) или локальным диском.

Общие управляемые диски изначально не предлагают полностью управляемую файловую систему, доступ к которой можно получить с помощью SMB/NFS. Необходимо использовать диспетчер кластеров, например отказоустойчивый кластер Windows Server (WSFC) или Pacemaker, который управляет связью с узлом кластера, а также блокировкой записи.

## <a name="limitations"></a>Ограничения

[!INCLUDE [virtual-machines-disks-shared-limitations](virtual-machines-disks-shared-limitations.md)]

## <a name="disk-sizes"></a>Размеры диска

[!INCLUDE [virtual-machines-disks-shared-sizes](virtual-machines-disks-shared-sizes.md)]

## <a name="sample-workloads"></a>Примеры рабочих нагрузок

### <a name="windows"></a>Windows

Большинство построений кластеризации на основе Windows в WSFC, которые обрабатывают всю основную инфраструктуру для обмена данными с узлом кластера, позволяя приложениям использовать шаблоны параллельного доступа. WSFC включает параметры CSV и не на основе CSV в зависимости от используемой версии Windows Server. Дополнительные сведения см. в статье [Создание отказоустойчивого кластера](https://docs.microsoft.com/windows-server/failover-clustering/create-failover-cluster).

Ниже перечислены некоторые популярные приложения, работающие в кластере WSFC.

- Экземпляры отказоустойчивого кластера SQL Server (FCI)
- Масштабируемый файловый сервер (SoFS)
- Файловый сервер для общего использования (Рабочая нагрузка IW)
- Диск профиля пользователя удаленный рабочий стол Server (RDS UPD)
- SAP ASCS/SCS

### <a name="linux"></a>Linux

Кластеры Linux могут использовать диспетчеры кластеров, например [Pacemaker](https://wiki.clusterlabs.org/wiki/Pacemaker). Pacemaker строится на [Corosync](http://corosync.github.io/corosync/), обеспечивая связь с кластером для приложений, развернутых в средах с высокой доступностью. Некоторые распространенные кластерные файловой системы включают [OCFS2](https://oss.oracle.com/projects/ocfs2/) и [GFS2](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/global_file_system_2/ch-overview-gfs2). Вы можете управлять резервированием и регистрацией с помощью таких служебных программ, как [fence_scsi](http://manpages.ubuntu.com/manpages/eoan/man8/fence_scsi.8.html) и [sg_persist](https://linux.die.net/man/8/sg_persist).

## <a name="persistent-reservation-flow"></a>Поток постоянного резервирования

На следующей схеме показан пример приложения кластеризованной базы данных с двумя узлами, которое использует параметр SCSI PR для включения отработки отказа с одного узла на другой.

![Кластер с двумя узлами. Приложение, работающее в кластере, обрабатывает доступ к диску](media/virtual-machines-disks-shared-disks/shared-disk-updated-two-node-cluster-diagram.png)

Процесс выглядит следующим образом:

1. Кластерное приложение, работающее в Azure VM1 и VM2, регистрирует цель чтения или записи на диск.
1. Затем экземпляр приложения в VM1 принимает монопольное резервирование для записи на диск.
1. Это резервирование применяется на диске Azure, и база данных теперь может выполнять запись только на диск. Любые операции записи из экземпляра приложения в VM2 не будут выполнены.
1. Если экземпляр приложения в VM1 выходит из строя, экземпляр в VM2 может инициировать отработку отказа базы данных и перехватить диск.
1. Теперь это резервирование применяется на диске Azure, и диск больше не будет принимать записи от VM1. Он будет принимать только операции записи из VM2.
1. Кластеризованное приложение может выполнить отработку отказа базы данных и обслуживать запросы от VM2.

На следующей схеме показана еще одна общая кластеризованная Рабочая нагрузка, состоящая из нескольких узлов, считывающих данные с диска для выполнения параллельных процессов, таких как обучение моделей машинного обучения.

![Кластер виртуальных машин с четырьмя узлами. Каждый узел регистрирует намерение для записи, приложение принимает монопольное резервирование для правильной работы записи результатов.](media/virtual-machines-disks-shared-disks/shared-disk-updated-machine-learning-trainer-model.png)

Процесс выглядит следующим образом:

1. Кластерное приложение, работающее на всех виртуальных машинах, регистрирует намерение чтения или записи на диск.
1. Экземпляр приложения в VM1 принимает монопольное резервирование для записи на диск при открытии операций чтения с диска с других виртуальных машин.
1. Это резервирование принудительно применяется на диске Azure.
1. Теперь все узлы в кластере можно считывать с диска. Только один узел записывает результаты обратно на диск от имени всех узлов в кластере.

### <a name="ultra-disks-reservation-flow"></a>Поток резервирования Ultra Disks

Ultra Disks предлагает дополнительное регулирование для всего двух интервалов. Из-за этого поток резервирования Ultra Disks может работать, как описано в предыдущем разделе, или более детально регулировать и распределять производительность.

:::image type="content" source="media/virtual-machines-disks-shared-disks/ultra-reservation-table.png" alt-text=" ":::

## <a name="ultra-disk-performance-throttles"></a>Высокопроизводительные регулировки производительности дисков

Функции Ultra Disks позволяют настроить производительность, предоставляя изменяемые атрибуты и позволяя изменять их. По умолчанию существует только два изменяемых атрибута, но общие диски Ultra имеют два дополнительных атрибута.


|Атрибут  |Описание  |
|---------|---------|
|дискиопсреадврите     |Общее количество операций ввода-вывода в секунду на всех виртуальных машинах, подключенных к общему диску с доступом на запись.         |
|дискмбпсреадврите     |Общая пропускная способность (МБ/с), разрешенная на всех виртуальных машинах, применяющих общий диск с доступом на запись.         |
|Дискиопсреадонли *     |Общее количество операций ввода-вывода в секунду на всех виртуальных машинах, подключенных к общему диску только для чтения.         |
|Дискмбпсреадонли *     |Общая пропускная способность (МБ/с), разрешенная на всех виртуальных машинах, подключенных к общему диску только для чтения.         |

\*Применяется только к общим Ultra диски

В следующих формулах объясняется, как можно задать атрибуты производительности, так как они являются изменяемыми пользователями:

- Дискиопсреадврите/Дискиопсреадонли: 
    - Ограничения операций ввода-вывода в секунду в 300 операций ввода/вывода в секунду на диск (не более 160K) в секунду
    - Минимум 100 операций ввода-вывода
    - Дискиопсреадврите + Дискиопсреадонли — не менее 2 операций ввода-вывода в секунду/гиб
- Дискмбпсреад запись и Дискмбпсреадонли:
    - Ограничение пропускной способности одного диска составляет 256 КИБ/с для каждой подготовленной операции ввода-вывода, максимум 2000 Мбит/с на диск
    - Минимальная гарантированная пропускная способность на диск — 4KiB/с для каждой подготовленной операции ввода-вывода с общим базовым планом не менее 1 Мбит/с

### <a name="examples"></a>Примеры

В следующих примерах показано несколько сценариев, демонстрирующих, как регулирование может работать с общими Ultra дисками, а именно.

#### <a name="two-nodes-cluster-using-cluster-shared-volumes"></a>Кластер с двумя узлами, использующий общие тома кластера

Ниже приведен пример кластеров WSFC с двумя узлами, использующих кластеризованные общие тома. В такой конфигурации обе виртуальные машины имеют одновременный доступ на запись к диску, что приводит к разбиению регулирования ReadWrite на две виртуальные машины, и не используется регулирование только для чтения.

:::image type="complex" source="media/virtual-machines-disks-shared-disks/ultra-two-node-example.png" alt-text="Пример 2-CSV-узла":::

:::image-end:::

#### <a name="two-node-cluster-without-cluster-share-volumes"></a>Кластер с двумя узлами без общих томов кластера

Ниже приведен пример кластеров WSFC с двумя узлами, которые не используют кластеризованные общие тома. В такой конфигурации только одна виртуальная машина имеет доступ на запись к диску. В результате регулирования ReadWrite будет использоваться исключительно для основной виртуальной машины и регулирование только для чтения используется вторичным.

:::image type="complex" source="media/virtual-machines-disks-shared-disks/ultra-two-node-no-csv.png" alt-text="CSV-два узла пример "Ultra Disk" для CSV-файлов отсутствует":::

:::image-end:::

#### <a name="four-node-linux-cluster"></a>Кластер с четырьмя узлами Linux

Ниже приведен пример кластера Linux с 4 узлами с одним модулем записи и тремя читателями с горизонтальным масштабированием. В такой конфигурации только одна виртуальная машина имеет доступ на запись к диску. В результате регулирования ReadWrite будет использоваться исключительно для основной виртуальной машины, а для вторичных виртуальных машин будет разделяться регулирование только для чтения.

:::image type="complex" source="media/virtual-machines-disks-shared-disks/ultra-four-node-example.png" alt-text="Пример Ultra регулирования на четырех узлах":::

:::image-end:::