---
author: cynthn
ms.author: cynthn
ms.date: 01/23/2020
ms.topic: include
ms.service: virtual-machines-linux
manager: gwallace
ms.openlocfilehash: 658910dc4291375c7b2ab22e88c599b970b885af
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "80419229"
---
Стандартизированные образы виртуальных машин позволяют организациям выполнять миграцию в облако и обеспечивать согласованность в развертываниях. Образы обычно включают стандартные параметры безопасности и конфигурации, а значит необходимое программное обеспечение. Для настройки собственного конвейера создания образов требуется время, инфраструктура и настройка, но с помощью построителя образов виртуальных машин Azure вы просто предоставляете простую конфигурацию, описывающую образ, отправляете его в службу, а также строится и распространяется образ.
 
Построитель образов виртуальных машин Azure (Azure Image Builder) позволяет начать работу с образом Azure Marketplace на основе Windows или Linux, существующих пользовательских образов или Red Hat Enterprise Linux (RHEL) ISO и начать добавлять собственные настройки. Поскольку построитель образов создан на основе [пакета HashiCorp](https://packer.io/), можно также импортировать существующие скрипты подготовки оболочки упаковки. Вы также можете указать, где должны размещаться образы, в [коллекции общих образов Azure](https://docs.microsoft.com/azure/virtual-machines/windows/shared-image-galleries)в качестве управляемого образа или виртуального жесткого диска.

> [!IMPORTANT]
> Azure Image Builder сейчас находится в общедоступной предварительной версии.
> Эта предварительная версия предоставляется без соглашения об уровне обслуживания и не рекомендована для использования рабочей среде. Некоторые функции могут не поддерживаться или их возможности могут быть ограничены. Дополнительные сведения см. в статье [Дополнительные условия использования предварительных выпусков Microsoft Azure](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

## <a name="preview-features"></a>Функции предварительной версии

Для предварительной версии поддерживаются следующие функции:

- Создание эталонных базовых образов, включая минимальные конфигурации безопасности и организации, а также позволяет подразделениям настраивать ее в соответствии с потребностями.
- Исправление существующих образов. построитель образов позволит постоянно обновлять существующие пользовательские образы.
- Подключите построитель образов к существующим виртуальным сетям, чтобы можно было подключиться к существующим серверам конфигурации (DSC, Chef, Puppet и т. д.), общим файловым ресурсам или любым другим направляемым серверам и службам.
- Интеграция с коллекцией образов Azure Shared позволяет вам глобально распространять и масштабировать образы, а также предоставляет систему управления образами.
- Интеграция с существующими конвейерами сборки образов, просто вызовите построитель изображений из конвейера или используйте простую задачу Azure DevOps для предварительной версии построителя образов.
- Перенос существующего конвейера настройки образа в Azure. Используйте существующие сценарии, команды и процессы для настройки образов.
- Создание образов в формате VHD.
 

## <a name="regions"></a>Регионы
Служба Azure Image Builder будет доступна для предварительной версии в этих регионах. Изображения могут распространяться за пределами этих регионов.
- Восточная часть США
- восточная часть США 2
- центрально-западная часть США
- западная часть США
- западная часть США 2
- Северная Европа
- Западная Европа

## <a name="os-support"></a>Поддержка ОС
AIB будет поддерживать базовые образы ОС Azure Marketplace:
- Ubuntu 18.04
- Ubuntu 16.04
- RHEL 7,6, 7,7
- CentOS 7,6, 7,7
- SLES 12 SP4
- SLES 15, SLES 15 С ПАКЕТОМ ОБНОВЛЕНИЯ 1
- Windows 10 RS5 Enterprise или Enterprise с несколькими сеансами/Professional
- Windows 2016
- Windows 2019

Поддержка RHEL ISO не рекомендована. Дополнительные сведения см. в документации по шаблонам.

## <a name="how-it-works"></a>Принцип работы


![Концептуальный рисунок построителя образов Azure](./media/virtual-machines-image-builder-overview/image-builder.png)

Azure Image Builder — это полностью управляемая служба Azure, доступная поставщику ресурсов Azure. Процесс построителя образов Azure состоит из трех основных частей: источник, Настройка и распространение, которые представлены в шаблоне. На схеме ниже показаны компоненты, а также некоторые их свойства. 
 


**Процесс построителя изображений** 

![Концептуальный рисунок процесса построителя образов Azure](./media/virtual-machines-image-builder-overview/image-builder-process.png)

1. Создайте шаблон образа в виде JSON-файла. Этот JSON файл содержит сведения об источнике изображения, его настройках и распространении. Существует несколько примеров в [репозитории Azure Image Builder для GitHub](https://github.com/danielsollondon/azvmimagebuilder/tree/master/quickquickstarts).
1. Отправьте его в службу, при этом будет создан артефакт шаблона образа в указанной группе ресурсов. В фоновом режиме построитель образов загрузит исходный образ или ISO-файл и скрипты по мере необходимости. Они хранятся в отдельной группе ресурсов, которая автоматически создается в подписке в формате: IT_\<дестинатионресаурцеграуп>_\<TemplateName>. 
1. После создания шаблона образа можно создать образ. В построителе фоновых изображений использует шаблон и исходные файлы для создания виртуальной машины (размер по умолчанию: Standard_D1_v2), сети, общедоступного IP-адреса,\<NSG и\<хранилища в группе ресурсов IT_ дестинатионресаурцеграуп>_ TemplateName>.
1. В ходе создания образа построитель образов распространяет изображение в соответствии с шаблоном, а затем удаляет дополнительные ресурсы в IT_\<дестинатионресаурцеграуп>_\<TemplateName> группы ресурсов, которая была создана для процесса.


## <a name="permissions"></a>Разрешения

Чтобы разрешить сборщику образов виртуальных машин Azure распространять образы в управляемые образы или в общую коллекцию образов, необходимо предоставить разрешения "участник" для службы "Построитель образов виртуальных машин Azure" (ИД приложения: cf32a0cc-373c-47c9-9156-0db11f6a6dfc) в группах ресурсов. 

Если вы используете существующий пользовательский управляемый образ или версию образа, то построителю образов Azure потребуется не менее "читатель" доступа к этим группам ресурсов.

Вы можете назначить доступ с помощью Azure CLI:

```azurecli-interactive
az role assignment create \
    --assignee cf32a0cc-373c-47c9-9156-0db11f6a6dfc \
    --role Contributor \
    --scope /subscriptions/$subscriptionID/resourceGroups/<distributeResoureGroupName>
```

Вы можете назначить доступ с помощью PowerShell:

```azurePowerShell-interactive
New-AzRoleAssignment -ObjectId ef511139-6170-438e-a6e1-763dc31bdf74 -Scope /subscriptions/$subscriptionID/resourceGroups/<distributeResoureGroupName> -RoleDefinitionName Contributor
```


Если учетная запись службы не найдена, это может означать, что подписка, в которую добавляется назначение ролей, еще не зарегистрирована для поставщика ресурсов.


## <a name="costs"></a>Затраты
При создании, создании и хранении образов с помощью Azure Image Builder потребуются некоторые затраты на ресурсы вычислений, сети и хранения. Эти затраты похожи на затраты, возникающие при создании пользовательских образов вручную. Для ресурсов вы будете взимать плату по тарифам Azure. 

В процессе создания образа файлы загружаются и сохраняются в группе `IT_<DestinationResourceGroup>_<TemplateName>` ресурсов, что приведет к небольшим затратам на хранение. Если вы не хотите их учитывать, удалите **шаблон образа** после сборки образа.
 
Построитель образов создает виртуальную машину, используя размер виртуальной машины D1v2, хранилище и сетевые подключения, необходимые для виртуальной машины. Эти ресурсы будут в последний раз соответствовать продолжительности процесса сборки и будут удалены после того, как построитель образов завершит создание образа. 
 
Построитель образов Azure будет распространять образ в выбранные регионы, что может повлечь за собой оплату сетевых исходящих платежей.
 
## <a name="next-steps"></a>Дальнейшие действия 
 
Чтобы испытать построитель образов Azure, ознакомьтесь со статьей о создании образов [Linux](../articles/virtual-machines/linux/image-builder.md) или [Windows](../articles/virtual-machines/windows/image-builder.md) .
 
 
