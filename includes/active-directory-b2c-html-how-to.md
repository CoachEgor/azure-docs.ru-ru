---
author: msmimart
ms.service: active-directory-b2c
ms.subservice: B2C
ms.topic: include
ms.date: 03/19/2020
ms.author: mimart
ms.openlocfilehash: 4cb4cdef227c786b12790903037fdc02649592e3
ms.sourcegitcommit: c95e2d89a5a3cf5e2983ffcc206f056a7992df7d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/24/2020
ms.locfileid: "95990890"
---
## <a name="use-custom-page-content"></a>Использование пользовательского содержимого страницы

С помощью функции настройки пользовательского интерфейса страницы можно настроить оформление любой настраиваемой политики. Кроме того, можно обеспечить согласованность фирменной символики и визуализации в приложении и службе Azure AD B2C.

### <a name="how-it-works"></a>Принципы работы

Azure AD B2C выполняет код в браузере клиента, используя [общий доступ к ресурсам между источниками (CORS)](https://www.w3.org/TR/cors/). Во время выполнения содержимое загружается по URL-адресу, указанному в пользовательском потоке или настраиваемой политике. Каждая страница в интерфейсе пользователя загружает свое содержимое из URL-адреса, указанного для этой страницы. После загрузки содержимого из URL-адреса оно объединяется с фрагментом HTML, вставленным Azure AD B2C, а затем страница отображается для клиента.

![Поле содержимого настраиваемой страницы](./media/active-directory-b2c-html-templates/html-content-merging.png)

## <a name="custom-html-page-content"></a>Содержимое настраиваемой страницы HTML

Создайте HTML-страницу с собственной фирменной символикой для обслуживания содержимого настраиваемой страницы. Эта страница может быть статической `*.html` страницей или динамической страницей, такой как .NET, Node.js или PHP.

Содержимое настраиваемой страницы может содержать любые элементы HTML, включая CSS и JavaScript, но не может включать небезопасные элементы, такие как iframes. Единственный обязательный элемент — это элемент div со `id` значением `api` , таким как `<div id="api"></div>` в HTML-странице.

```html
<!DOCTYPE html>
<html>
<head>
    <title>My Product Brand Name</title>
</head>
<body>
    <div id="api"></div>
</body>
</html>
```

### <a name="customize-the-default-azure-ad-b2c-pages"></a>Настройка страниц Azure AD B2C по умолчанию

Вместо создания пользовательского содержимого страницы с нуля можно настроить содержимое страницы по умолчанию для Azure AD B2c.

В следующей таблице приведено содержимое страницы по умолчанию, предоставляемое Azure AD B2C. Скачайте файлы и используйте их в качестве отправной точки для создания собственных настраиваемых страниц.

| Страница по умолчанию | Описание | Идентификатор для определения содержимого<br/>(только для настраиваемой политики) |
|:-----------------------|:--------|-------------|
| [exception.html](https://login.microsoftonline.com/static/tenant/default/exception.cshtml) | **Страница ошибки**. Эта страница отображается при обнаружении исключения или ошибки. | *api.error* |
| [selfasserted.html](https://login.microsoftonline.com/static/tenant/default/selfAsserted.cshtml) |  **Страница с автоматическим подтверждением**. Используйте этот файл как пользовательское содержимое страницы для регистрации учетной записи социальных сетей, страницу регистрации локальной учетной записи, страницу входа в локальную учетную запись, сброс пароля и многое другое. Форма может содержать разные элементы управления для ввода текста, например: текстовое поле, поле ввода пароля, переключатель, раскрывающийся список с единственным выбором или флажки множественного выбора. | *API. локалаккаунтсигнин*, *API. локалаккаунтсигнуп*, *API. локалаккаунтпассвордресет*, *API. selfasserted* |
| [multifactor-1.0.0.html](https://login.microsoftonline.com/static/tenant/default/multifactor-1.0.0.cshtml) | **Страница Многофакторной идентификации.** Эта страница позволяет пользователю подтвердить свой номер телефона (с помощью SMS-сообщения или голосового вызова) во время регистрации или входа. | *api.phonefactor* |
| [updateprofile.html](https://login.microsoftonline.com/static/tenant/default/updateProfile.cshtml) | **Страница обновления профиля.** Эта страница содержит форму для обновления профиля пользователя. Эта страница аналогична странице регистрации локальных учетных записей, за исключением полей для ввода пароля. | *api.selfasserted.profileupdate* |
| [unified.html](https://login.microsoftonline.com/static/tenant/default/unified.cshtml) | **Единая страница регистрации или входа.** Эта страница обрабатывает регистрацию и вход пользователей. Пользователи могут использовать поставщики удостоверений организаций, социальных сетей, включая Facebook и Google+, или локальные учетные записи. | *api.signuporsignin* |

## <a name="hosting-the-page-content"></a>Размещение содержимого страницы

При использовании собственных файлов HTML и CSS для настройки пользовательского интерфейса разместите содержимое пользовательского интерфейса на любой общедоступной конечной точке HTTPS, которая поддерживает CORS. Например, [хранилище больших двоичных объектов Azure](../articles/storage/blobs/storage-blobs-introduction.md), [службы приложений Azure](../articles/app-service/index.yml), веб-серверы, CDN, AWS S3 или системы общего доступа к файлам.

## <a name="guidelines-for-using-custom-page-content"></a>Рекомендации по использованию пользовательского содержимого страницы

- Используйте абсолютный URL-адрес при включении внешних ресурсов, таких как файлы мультимедиа, CSS и JavaScript, в HTML-файл.
- С помощью [макета страницы](../articles/active-directory-b2c/page-layout.md) 1.2.0 и более поздних версий можно добавить `data-preload="true"` атрибут в теги HTML для управления порядком загрузки CSS и JavaScript. В `data-preload=true` Эта страница создается перед отображением пользователю. Этот атрибут помогает предотвратить мерцание страницы путем предварительной загрузки CSS-файла без отображения пользователем невидимого HTML. В следующем фрагменте кода HTML показано использование `data-preload` тега.
  ```HTML
  <link href="https://path-to-your-file/sample.css" rel="stylesheet" type="text/css" data-preload="true"/>
  ```
- Рекомендуется начинать с содержимого страницы по умолчанию и строить его поверх.
- Можно включить JavaScript в пользовательское содержимое как для пользовательских [потоков](../articles/active-directory-b2c/user-flow-javascript-overview.md) , так и для [пользовательских политик](../articles/active-directory-b2c/javascript-samples.md).
- Поддерживаемые версии браузеров:
  - Internet Explorer 11, 10 и Microsoft ребро
  - ограниченная поддержка Internet Explorer 9 и Internet Explorer 8;
  - Google Chrome 42.0 и выше
  - Mozilla Firefox 38.0 и выше
  - Safari для iOS и macOS, версия 12 и более поздние версии
- Из-за ограничений безопасности Azure AD B2C не поддерживает `frame` `iframe` `form` элементы HTML, или.

## <a name="custom-page-content-walkthrough"></a>Пошаговое руководство по содержимому настраиваемой страницы

Ниже приведен обзор этого процесса.

1. Подготовьте расположение для размещения пользовательского содержимого страницы (общедоступная конечная точка HTTPS с поддержкой CORS).
1. Скачайте и настройте файл содержимого страницы по умолчанию, например `unified.html` .
1. Опубликуйте содержимое настраиваемой страницы в общедоступной конечной точке HTTPS.
1. настройка общего доступа к ресурсам независимо от источника (CORS) для своего веб-приложения;
1. Наведите политику на универсальный код ресурса (URI) содержимого настраиваемой политики.

### <a name="1-create-your-html-content"></a>1. Создание HTML-содержимого

Создание пользовательского содержимого страницы с фирменным названием продукта в заголовке.

1. Скопируйте следующий фрагмент кода HTML. Это правильно сформированное HTML5 с пустым элементом, который называется *\<div id="api"\>\</div\>* , расположенным внутри *\<body\>* тегов. Этот элемент определяет расположение, в которое будет вставлено содержимое Azure AD B2C.

   ```html
   <!DOCTYPE html>
   <html>
   <head>
       <title>My Product Brand Name</title>
   </head>
   <body>
       <div id="api"></div>
   </body>
   </html>
   ```

1. Вставьте скопированный фрагмент кода в текстовый редактор и сохраните файл как *customize-ui.html*.

> [!NOTE]
> Элементы формы HTML будут удалены из-за ограничений безопасности при использовании login.microsoftonline.com. Если вы хотите использовать элементы HTML-форм в пользовательском HTML-содержимом, [используйте b2clogin.com](../articles/active-directory-b2c/b2clogin.md).

### <a name="2-create-an-azure-blob-storage-account"></a>2. Создание учетной записи хранилища BLOB-объектов Azure

В этой статье мы используем хранилище BLOB-объектов Azure для размещения содержимого. Можно выбрать для этого веб-сервер, но тогда нужно [включить для веб-сервера поддержку CORS](https://enable-cors.org/server.html).

Чтобы разместить содержимое HTML в хранилище BLOB-объектов, выполните следующие действия.

1. Войдите на [портал Azure](https://portal.azure.com).
1. В меню **Концентратор** выберите **Создать** > **Хранилище** > **Учетная запись хранения**.
1. Выберите **подписку** для своей учетной записи хранения.
1. Создайте **группу ресурсов** или выберите существующую.
1. Введите уникальное **имя** учетной записи хранения.
1. Выберите **географическое расположение** для учетной записи хранения.
1. Для параметра **Модель развертывания** можно оставить значение **Диспетчер ресурсов**.
1. Для параметра **Производительность** можно оставить значение **Стандартная**.
1. Измените **тип учетной записи** на **хранилище BLOB-объектов**.
1. Для параметра **Репликация** можно оставить значение **RA-GRS**.
1. Для параметра **Уровень доступа** можно оставить значение **Горячий**.
1. Выберите **проверить и создать** , чтобы создать учетную запись хранения.
    После завершения развертывания страница **учетная запись хранения** откроется автоматически.

#### <a name="21-create-a-container"></a>2,1. Создание контейнера

Чтобы создать общедоступный контейнер в хранилище BLOB-объектов, выполните следующие действия.

1. В разделе **Служба BLOB-объектов** в меню слева выберите **большие двоичные объекты**.
1. Выберите **+ контейнер**.
1. В качестве **имени** введите *root*. В качестве имени можно выбрать имя, например *contoso*, но для простоты мы используем *корень* в этом примере.
1. Для общедоступного **уровня доступа** выберите **BLOB-объект**, а затем нажмите **кнопку ОК**.
1. Выберите **корень** , чтобы открыть новый контейнер.

#### <a name="22-upload-your-custom-page-content-files"></a>2,2. Отправка файлов пользовательского содержимого страницы

1. Щелкните **Отправить**.
1. Щелкните значок папки рядом с полем **выберите файл**.
1. Перейдите к и выберите **customize-ui.html**, созданный ранее в разделе Настройка пользовательского интерфейса страницы.
1. Если вы хотите отправить во вложенную папку, разверните узел **Дополнительно** и введите имя папки в списке **отправить в папку**.
1. Щелкните **Отправить**.
1. Выберите отправленный BLOB-объект **customize-ui.html** .
1. Справа от текстового поля **URL-адрес** выберите значок **Копировать в буфер обмена** , чтобы скопировать URL-адрес в буфер обмена.
1. В веб-браузере перейдите по URL-адресу, который вы скопировали, чтобы убедиться, что переданный BLOB-объект доступен. Если она недоступна, например, если возникла `ResourceNotFound` ошибка, убедитесь, что для параметра Тип доступа к контейнеру выбрано значение **BLOB**.

### <a name="3-configure-cors"></a>3. Настройка CORS

Настройте хранилище BLOB-объектов для совместного использования ресурсов в разных источниках, выполнив следующие действия.

1. В меню выберите **CORS**.
1. В поле **Допустимые источники** введите `https://your-tenant-name.b2clogin.com`. Замените `your-tenant-name` именем вашего клиента Azure AD B2C. Например, `https://fabrikam.b2clogin.com`. При вводе имени клиента используйте все строчные буквы.
1. В поле **Допустимые методы** выберите `GET` и `OPTIONS`.
1. В поле **Допустимые заголовки** введите звездочку (*).
1. В поле **Доступные заголовки** введите звездочку (*).
1. В поле **Максимальный возраст** введите 200.
1. Нажмите кнопку **Сохранить**.

#### <a name="31-test-cors"></a>3,1. Тестирование CORS

Убедитесь, что вы готовы, выполнив следующие действия.

1. Повторите шаг configure CORS. Для **разрешенных источников** введите `https://www.test-cors.org`
1. Перейдите по адресу [www.Test-CORS.org](https://www.test-cors.org/) 
1. В поле **удаленный URL-адрес** вставьте URL-адрес HTML-файла. Например, `https://your-account.blob.core.windows.net/root/azure-ad-b2c/unified.html`
1. Выберите **Отправить запрос**.
    Результат должен быть `XHR status: 200` . 
    Если произошла ошибка, проверьте правильность параметров CORS. Кроме того, вам может потребоваться очистить кэш браузера или открыть закрытый сеанс, нажав CTRL+SHIFT+P.