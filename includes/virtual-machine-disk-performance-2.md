---
title: включить файл
description: включить файл
services: virtual-machines
author: albecker1
ms.service: virtual-machines
ms.topic: include
ms.date: 09/25/2020
ms.author: albecker1
ms.custom: include file
ms.openlocfilehash: e5a6dae98e786bf55dc17d8fabe42f84e9927442
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2020
ms.locfileid: "91606074"
---
![Документация по Dsv3](media/vm-disk-performance/dsv3-documentation.jpg)

Максимальная пропускная способность **некэшированного** диска по умолчанию является максимальным предельным числом, которое может быть обработано виртуальной машиной. Максимальный объем **кэшированной** пропускной способности хранилища — это отдельный предел при включении кэширования узла. Кэширование узла работает, добавляя хранилище ближе к виртуальной машине, которую можно быстро записать или прочитать. Объем хранилища, доступный виртуальной машине для кэширования узла, приведен в документации. Например, можно увидеть, Standard_D8s_v3 поставляется с 200 гиб хранилища кэша.

Включение кэширования узла может выполняться при создании виртуальной машины и присоединении дисков. Вы также можете настроить для включения и выключения кэширования узлов дисков на существующей виртуальной машине.

![Кэширование узла](media/vm-disk-performance/host-caching.jpg)

Кэширование узла можно настроить в соответствии с требованиями к рабочей нагрузке для каждого диска. Можно настроить кэширование узла так, чтобы оно было доступно только для чтения для рабочих нагрузок, которые выполняют только чтение операций и чтение и запись для рабочих нагрузок, которые выполняют баланс операций чтения и записи. Если ваша рабочая нагрузка не соответствует ни одному из этих шаблонов, мы не рекомендуем использовать кэширование узла. 

Давайте рассмотрим несколько примеров различных параметров кэша узла и посмотрим, как это влияет на поток данных и производительность. В этом первом примере мы рассмотрим, что происходит с запросами ввода-вывода, если параметр кэширования узла имеет значение только для **чтения**.

Настройка.
- Standard_D8s_v3 
    - Кэшированные операции ввода-вывода: 16 000
    - Некэшированные операции ввода-вывода: 12 800
- Диск данных P30 
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - **Кэширование узла: только для чтения** 

Когда выполняется чтение и нужные данные доступны в кэше, кэш возвращает запрошенные данные и нет необходимости выполнять чтение с диска. Это чтение учитывается в кэшированных ограничениях виртуальной машины.

![Чтение при чтении кэширования узла](media/vm-disk-performance/host-caching-read-hit.jpg)

Когда выполняется чтение и требуемые **данные недоступны в** кэше, запрос на чтение передается на диск, который затем отображает его как в кэш, так и на виртуальную машину. Это чтение подсчитывается для некэшированного ограничения виртуальной машины и кэшированного ограничения виртуальной машины.

![Чтение при чтении кэширования узла — промахи](media/vm-disk-performance/host-caching-read-miss.jpg)

При выполнении записи запись должна быть записана как в кэш, так и на диск, прежде чем она считается завершенной. Эта запись учитывает некэшированный предел ВИРТУАЛЬНОЙ машины и кэшированный предел виртуальной машины.

![Чтение кэширования узла (запись)](media/vm-disk-performance/host-caching-write.jpg)

В следующем примере мы рассмотрим, что происходит с запросами ввода-вывода, если для параметра кэширования узла задано значение **чтение/запись**.

Настройка.
- Standard_D8s_v3 
    - Кэшированные операции ввода-вывода: 16 000
    - Некэшированные операции ввода-вывода: 12 800
- Диск данных P30 
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - **Кэширование узла: чтение и запись** 

Операции чтения обрабатываются точно так же, как и доступные только для чтения. запись — это единственная вещь, отличающаяся от кэширования чтения и записи. При записи с помощью кэширования узла, настроенного на чтение и запись, запись должна быть записана в кэш узла, чтобы считаться завершенной. Затем запись отложенно записывается на диск в качестве фонового процесса. Это означает, что операции записи будут учитываться в кэшированных операциях ввода-вывода при записи в кэш, а при отложенной записи на диск он будет считаться некэшированным.

![Запись кэширования узла для чтения и записи](media/vm-disk-performance/host-caching-read-write.jpg)

Давайте продолжим пример с помощью нашей Standard_D8s_v3 виртуальной машины. За исключением этого времени, на дисках будет включено кэширование узлов, а теперь ограничение числа операций ввода-вывода для виртуальной машины составляет 16 000 операций ввода/вывода. К виртуальной машине подключены три базовых диска P30, которые могут обслуживать 5 000 операций ввода-вывода.

Настройка.
- Standard_D8s_v3 
    - Кэшированные операции ввода-вывода: 16 000
    - Некэшированные операции ввода-вывода: 12 800
- Диск ОС P30 
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - Кэширование узла: чтение и запись 
- 2 P30 диски данных
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - Кэширование узла: чтение и запись

![Пример кэширования узла](media/vm-disk-performance/host-caching-example-without-remote.jpg)

Теперь приложение, использующее эту Standard_D8s_v3 виртуальную машину с включенным кэшированием, делает запрос на 15 000 операций ввода-вывода в секунду. Эти запросы разбиваются на все подключенные диски как 5 000 операций ввода-вывода и не выполняются ограничения производительности.

## <a name="combined-uncached-and-cached-limits"></a>Объединенные некэшированные и кэшированные ограничения

Ограничения кэширования виртуальной машины отделены от некэшированных ограничений. Это означает, что можно включить кэширование узлов на дисках, подключенных к виртуальной машине, а также не включать кэширование узлов на других дисках, чтобы разрешить виртуальным машинам получать общий объем операций ввода-вывода хранилища для кэшированного ограничения и некэшированного ограничения. Давайте рассмотрим пример этого, чтобы помочь упрочнить, как эти ограничения работают вместе, и мы продолжим Standard_D8s_v3 виртуальной машины и подключенной конфигурации дисков уровня "Премиум".

Настройка.
- Standard_D8s_v3 
    - Кэшированные операции ввода-вывода: 16 000
    - Некэшированные операции ввода-вывода: 12 800
- Диск ОС P30 
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - Кэширование узла: чтение и запись
- 2 P30 дисков с данными X 2
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - Кэширование узла: чтение и запись
- 2 P30 дисков с данными X 2
    - ОПЕРАЦИЙ ВВОДА-ВЫВОДА: 5 000
    - Кэширование узла: отключено

![Пример кэширования узла с удаленным хранилищем](media/vm-disk-performance/host-caching-example-with-remote.jpg)

Теперь приложение, работающее на Standard_D8s_v3 виртуальной машине, выполняет запрос на 25 000 операций ввода-вывода в секунду. Этот запрос разделяется как 5 000 операций ввода-вывода на каждый базовый диск, где 3 из этих дисков используют кэширование узлов, а 2 дисков — нет. Так как 3 с кэшированием узлов находятся в пределах кэшированных пределов 16 000, эти запросы успешно завершаются, и не происходит ограничение производительности хранилища. Кроме того, поскольку 2 диска, не использующие кэширование узлов, находятся в некэшированных пределах 12 800, эти запросы также успешно завершены и не будут ограничены.

## <a name="metrics-for-disk-performance"></a>Метрики для производительности диска
В Azure есть метрики, которые позволяют получить представление о том, как работают виртуальные машины и диски. Эти метрики можно просматривать визуально с помощью портал Azure или их можно получить с помощью вызова API. Метрики рассчитываются с интервалом в одну минуту. Ниже приведены метрики, позволяющие получить представление о виртуальной машине и скорости ввода-вывода на диск и пропускной способности.
- **Длина очереди диска ОС** — количество текущих необработанных запросов ввода-вывода, ожидающих чтения или запись на диск ОС.
- **Скорость чтения с диска ОС (байт/с** ) — количество байтов, считываемых с диска ОС в секунду.
- **Операций чтения с диска ОС/с** — количество операций ввода, считываемых в секунду с диска операционной системы.
- **Скорость записи на диск ОС (байт/с** ) — число байтов, записанных в секунду с диска операционной системы.
- **Операций записи на диск ОС/с** — количество операций вывода, записанных в секунду с диска операционной системы.
- **Глубина очереди диска данных** — количество текущих необработанных запросов ввода-вывода, ожидающих чтения или запись на диск данных.
- **Скорость чтения с диска данных (байт/с** ) — количество байтов, считываемых с дисков данных в секунду.
- **Операций чтения с диска данных/с** — количество операций ввода, считываемых в секунду с дисков данных.
- **Скорость записи на диск данных (байт/с** ) — количество байтов, записываемых в секунду с дисков данных.
- **Операций записи на диск данных/с** — количество операций вывода, записанных в секунду с диска данных.
- **Скорость чтения с диска (байт/с** ) — общее количество байтов, считываемых в секунду со всех дисков, подключенных к виртуальной машине.
- **Операций чтения с диска/с** — количество операций ввода, считываемых в секунду со всех дисков, подключенных к виртуальной машине.
- **Скорость записи на диск (байт/с** ) — число байтов, записанных в секунду со всех дисков, подключенных к виртуальной машине.
- **Операций записи на диск/с** — количество операций вывода, записанных в секунду со всех дисков, подключенных к виртуальной машине.

## <a name="storage-io-utilization-metrics"></a>Метрики использования операций ввода-вывода хранилища
Метрики, помогающие диагностировать ограничения дискового ввода-вывода:
- **Процент использования дискового пространства операций ввода** -вывода — процент, вычисленный диском данных, выполненных в операциях ввода-вывода в секунду для диска с подготовленными данными. Если это значение равно 100%, то выполняемое приложение будет иметь фиксированный объем ввода-вывода с ограничением в операциях ввода/вывода на диске данных.
- **Процент использования пропускной способности диска данных** — процентное значение, вычисленное пропускной способностью диска данных по пропускной способности подготовленного диска данных. Если это значение равно 100%, то выполняемое приложение будет иметь фиксированный объем ввода-вывода с ограничением пропускной способности диска данных.
- Количество **использованных операций ввода-вывода диска ОС** в процентах — процент, вычисленный на диске операционной системы, выполненный через подготовленные дисковые операции ввода-вывода. Если это значение равно 100%, вы будете, чтобы ваше приложение выполнялось с ограничением ввода-вывода на диск в ОС.
- **Процент использования пропускной способности диска ОС** — процентная доля, вычисленная пропускной СПОСОБНОСТЬЮ диска ОС, выполненная на основе подготовленной пропускной способности диска ОС. Если это значение равно 100%, то ваше приложение будет иметь неограниченный объем операций ввода-вывода с ограничением пропускной способности диска ОС.

Метрики, помогающие выполнить диагностику операций ввода-вывода виртуальной машины:
- Количество **кэшированных операций ввода-вывода в кэше виртуальной машины в процентах** . Если это значение равно 100%, ваше приложение будет иметь фиксированный объем операций ввода-вывода из кэшированной виртуальной машины.
- Объем **использованной пропускной способности кэшированной виртуальной машины** — процентная доля, вычисленная по общей пропускной способности диска, выполненная по максимальной пропускной способности виртуальной машины Если это значение равно 100%, то ваше приложение будет иметь неограниченный объем операций ввода-вывода из кэшированной пропускной способности виртуальной машины.
- **Процент использования некэшированных операций ввода-вывода виртуальной машины** — процентное значение, вычисленное на виртуальном компьютере с максимальным числом операций ввода-вывода в секунду для виртуальной машины. Если это значение равно 100%, то выполняемое приложение будет иметь неограниченный объем операций ввода-вывода для виртуальной машины.
- **Некэшированная пропускная способность виртуальной машины** . процентное значение, вычисленное по общей пропускной способности диска на виртуальной машине, завершилось по максимальной пропускной способности подготовленной виртуальной машины. Если это значение равно 100%, ваше приложение будет иметь неограниченный объем операций ввода-вывода из-за некэшированной пропускной способности виртуальной машины.

