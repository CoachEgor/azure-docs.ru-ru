---
title: включение файла
description: включение файла
services: virtual-machines
author: cynthn
ms.service: virtual-machines
ms.topic: include
ms.date: 06/04/2019
ms.author: cynthn;kareni
ms.custom: include file
ms.openlocfilehash: 169e25aeb8503a11f768a2a3062022eef51a76b8
ms.sourcegitcommit: c0419208061b2b5579f6e16f78d9d45513bb7bbc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2019
ms.locfileid: "67659888"
---
**Последнее обновление документа**: 4 июня 2019 3:00 по тихоокеанскому времени.

В результате обнаружения [нового класса уязвимостей ЦП](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002), известного как атаки спекулятивного выполнения команд с предсказанием ветвлений, у пользователей возникли вопросы, требующие разъяснения.  

Корпорация Майкрософт развернула по всем облачным службам средства устранения уязвимостей. Инфраструктура с изолированными друг от друга нагрузками, которая работает в Azure, является защищенной. Это означает, что потенциальному злоумышленнику с помощью той же инфраструктуры, используя эти уязвимости, не удастся осуществить атаку на ваше приложение.

Чтобы свести к минимуму последствия для пользователей и устранить необходимость перезагрузки, Azure всякий раз при возможности использует [обслуживание с сохранением памяти](https://docs.microsoft.com/azure/virtual-machines/windows/maintenance-and-updates#maintenance-that-doesnt-require-a-reboot). Azure продолжит использовать эти методы при выполнении системных обновлений на узле и для защиты своих клиентов.

Дополнительные сведения о том, как вопросы безопасности учитываются в каждом аспекте создания Azure, доступны на веб-сайте [Документация по системе безопасности Azure](https://docs.microsoft.com/azure/security/). 

> [!NOTE] 
> С тех пор как этот документ был впервые опубликован, было обнаружено несколько вариантов этого класса уязвимостей. Корпорация Майкрософт продолжает активно вкладывать средства в защиту своих клиентов и предоставлять поддержку. Эта страница будет обновляться по мере выпуска дальнейших исправлений. 
> 
> На 14 мая 2019 г. [Intel раскрытых](https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00233.html) новый набор упреждающего исполнения на стороне канала уязвимость, известный как выборка данных микроархитектуры (MDS см. руководство по безопасности Microsoft [ADV190013](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV190013)), который было назначено несколько CVE: 
> - CVE-2019-11091 - микроархитектуры данные выборки памяти Uncacheable (MDSUM)
> - CVE-2018-12126 - Store микроархитектуры буфера данных выборки (MSBDS) 
> - CVE-2018-12127 - порт нагрузки микроархитектуры данных выборки (MLPDS)
> - CVE-2018-12130 - микроархитектуры заполнения буфера данных выборки (MFBDS)
>
> Эта уязвимость затрагивает процессоры Intel® Core® и Intel® Xeon®.  Microsoft Azure выпустила обновления операционной системы и развертывание новых микрокода, как он станет доступен с Intel, на протяжении всего наш парк по защите пользователей от этих новых уязвимостей.   Azure тесно сотрудничает с Intel, для тестирования и проверки новых микрокода до ее официального выпуска на платформе. 
>
> **Клиентов, работающих под управлением ненадежного кода в своей виртуальной Машине** необходимо принять меры для защиты от этих уязвимостей путем чтения ниже дополнительные рекомендации по всех уязвимостей упреждающего исполнения на стороне канала (ADV рекомендации, Microsoft [180002](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002), [180018](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/adv180018), и [190013](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV190013)).
>
> Другим клиентам следует оценить эти уязвимости из защиты в глубину перспективы и рассматривать последствия своих выбранной конфигурации безопасности и производительности.



## <a name="keeping-your-operating-systems-up-to-date"></a>Обновление операционной системы

Хотя обновление ОС не является обязательным требованием для изоляции приложений, запускаемых в Azure, от других клиентов Azure, настоятельно рекомендуется поддерживать актуальное состояние системы. Последние накопительные пакеты обновлений безопасности для Windows оснащены средствами устранения рисков, связанных с несколькими уязвимостями спекулятивного выполнения команд с предсказанием ветвлений. Аналогичным образом дистрибутивы Linux выпустили несколько обновлений для устранения этих уязвимостей. Ниже приведены рекомендуем выполнить обновление операционной системы.

| Предложение | Рекомендуемое действие  |
|----------|---------------------|
| Облачные службы Azure  | Включите [автоматическое обновление](https://docs.microsoft.com/azure/cloud-services/cloud-services-how-to-configure-portal) или убедитесь, что используется последняя версия гостевой ОС. |
| Виртуальные машины Linux в Azure | Устанавливайте обновления, предоставляемые поставщиками операционной системы. Дополнительные сведения см. в пункте [Linux](#linux) далее в этом документе. |
| Виртуальные машины Windows в Azure  | Установка последнего накопительного пакета обновлений безопасности.
| Прочие службы Azure PaaS | Для клиентов, использующих эти службы, дополнительные действия не требуются. Azure автоматически выполняет обновление версий операционной системы. |

## <a name="additional-guidance-if-you-are-running-untrusted-code"></a>Дополнительные рекомендации при выполнении кода без доверия 

Клиентам, позволяющим ненадежным пользователям выполнение произвольного кода, может потребоваться использование дополнительных компонентов безопасности внутри своих виртуальных машин Azure или облачных служб. Эти компоненты защищают от внутрипроцессных векторов обнаружения, описываемых несколькими уязвимостями спекулятивного выполнения команд.

Примеры сценариев, где рекомендуется использовать дополнительные компоненты безопасности.

- Вы допускаете запуск кода, которому не доверяете, на своей виртуальной машине.  
    - *Например, вы разрешаете одному из клиентов загрузить двоичный файл или сценарий, который затем будет выполнен в приложении*. 
- Вы разрешаете пользователям, которым не доверяете, входить в виртуальную машину через учетные записи с низкими разрешениями.   
    - *Например, вы разрешаете низкопривилегированному пользователю войти в одну из виртуальных машин с помощью удаленного рабочего стола или SSH*.  
- Вы разрешаете ненадежным пользователям доступ к виртуальным машинам с помощью встроенной виртуализации.  
    - *Например, вы управляете узлом Hyper-V, но выделяете виртуальные машины для ненадежных пользователей*. 

Клиентам, которые не используют сценарии с ненадежным кодом, не обязательно включать эти дополнительные компоненты безопасности. 

## <a name="enabling-additional-security"></a>Включение дополнительной защиты 

Вы можете включить дополнительные функции безопасности в вашей виртуальной Машины или облачной службы, если вы используете ненадежного кода. В параллельном режиме убедитесь, что операционной системе актуальна, чтобы включить функции безопасности в вашей виртуальной Машины или облачной службы

### <a name="windows"></a>Windows 

Чтобы включить эти дополнительные компоненты безопасности, нужно использовать последнюю версию целевой операционной системы. Несмотря на то что по умолчанию задействованы многочисленные предупреждения о спекулятивном выполнении команд с предсказанием ветвлений, дополнительные функции, описанные здесь, должны быть активированы вручную и могут отрицательно сказаться на производительности. 


**Шаг 1. Отключение hyper-threading на виртуальной Машине** -клиентам, работающим на виртуальной Машине с поддержкой технологии hyper threading ненадежный код потребуется отключить hyper-threading или переместите размер виртуальной Машины не-поддержкой технологии hyper threading. Справочник по [документа](https://docs.microsoft.com/azure/virtual-machines/windows/acu) список размеров виртуальных Машин hyper threading (где отношение виртуальных ЦП в Core равно 2:1). Установите флажок, если ваша виртуальная машина hyper-threading включена, см. в статье ниже скрипт, с помощью командной строки Windows из виртуальной Машины.

Тип `wmic` ввести интерактивный интерфейс. Введите ниже, чтобы просмотреть сведения об объеме физических и логических процессоров на виртуальной Машине.

```console
CPU Get NumberOfCores,NumberOfLogicalProcessors /Format:List
```

Если число логических процессоров больше физических процессоров (ядер), затем hyper-threading включена.  Если вы используете виртуальную Машину с поддержкой технологии hyper threading, [обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) для получения hyper-threading отключена.  После отключения hyper-threading **поддержки требуется полной перезагрузки виртуальной Машины**. Обратитесь к [Core count](#core-count) чтобы понять, почему уменьшается количество ядер виртуальной Машины.


**Шаг 2**. В параллельном режиме в шаге 1, следуйте инструкциям в [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) для проверки защиту можно включить с помощью [SpeculationControl](https://aka.ms/SpeculationControlPS) модуля PowerShell.

> [!NOTE]
> Если этот модуль ранее уже был загружен, необходимо установить его последнюю версию.
>


Выходные данные сценария PowerShell должен иметь ниже значений для проверки включить защиту от этих уязвимостей:

```
Windows OS support for branch target injection mitigation is enabled: True
Windows OS support for kernel VA shadow is enabled: True
Windows OS support for speculative store bypass disable is enabled system-wide: False
Windows OS support for L1 terminal fault mitigation is enabled: True
Windows OS support for MDS mitigation is enabled: True
```

Если выходные данные показывают, `MDS mitigation is enabled: False`, пожалуйста [обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) для доступных способов их решения.



**Шаг 3**. Чтобы включить ядра виртуальный адрес затенение (KVAS) и поддержка внедрения целевой ветви (BTI) операционной системы, следуйте инструкциям в [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) для включения защиты с помощью `Session Manager` разделов реестра. Потребуется перезагрузка.


**Шаг 4**. Для развертываний, использующих [вложенной виртуализации](https://docs.microsoft.com/azure/virtual-machines/windows/nested-virtualization) (D3 и только E3): Эти инструкции распространяются на виртуальную машину при использовании в качестве узла Hyper-V.

1.  Следуйте инструкциям в [KB4072698](https://support.microsoft.com/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution) для включения защиты с помощью `MinVmVersionForCpuBasedMitigations` разделов реестра.
2.  Задайте тип планировщика низкоуровневой оболочки `Core` , следуя инструкциям [здесь](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types).


### <a name="linux"></a>Linux

<a name="linux"></a>Для включения внутреннего набора дополнительных компонентов безопасности требуется, чтобы целевая операционная система была обновлена до последней версии. Некоторые методы устранения рисков будут включены по умолчанию. В приведенном ниже разделе описаны компоненты, которые по умолчанию отключены и/или зависят от аппаратной поддержки (микрокод). Включение этих компонентов может отрицательно сказаться на производительности. Дополнительные сведения см. в справочной документации поставщика операционной системы.


**Шаг 1. Отключение hyper-threading на виртуальной Машине** -клиентам, работающим на виртуальной Машине с поддержкой технологии hyper threading ненадежный код потребуется отключить hyper-threading или перемещение в виртуальную Машину не-поддержкой технологии hyper threading.  Справочник по [документа](https://docs.microsoft.com/azure/virtual-machines/linux/acu) список размеров виртуальных Машин hyper threading (где отношение виртуальных ЦП в Core равно 2:1). Чтобы проверить, если вы используете виртуальную Машину с поддержкой технологии hyper threading, выполните `lscpu` команду на виртуальной машине Linux. 

Если `Thread(s) per core = 2`, затем hyper-threading включена. 

Если `Thread(s) per core = 1`, затем hyper-threading отключена. 

 
Пример выходных данных для виртуальной Машины с помощью hyper-threading включена: 

```console
CPU Architecture:      x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                8
On-line CPU(s) list:   0-7
Thread(s) per core:    2
Core(s) per socket:    4
Socket(s):             1
NUMA node(s):          1

```

Если вы используете виртуальную Машину с поддержкой технологии hyper threading, [обратитесь в службу поддержки Azure](https://aka.ms/MicrocodeEnablementRequest-SupportTechnical) для получения hyper-threading отключена.  После отключения hyper-threading **поддержки требуется полной перезагрузки виртуальной Машины**. Обратитесь к [Core count](#core-count) чтобы понять, почему уменьшается количество ядер виртуальной Машины.



**Шаг 2**. Для снижения риска активизации любой из ниже уязвимостях упреждающего исполнения по сторонним каналам, к документации поставщика операционной системы:   
 
- [RedHat и CentOS](https://access.redhat.com/security/vulnerabilities) 
- [SUSE](https://www.suse.com/support/kb/?doctype%5B%5D=DT_SUSESDB_PSDB_1_1&startIndex=1&maxIndex=0) 
- [Ubuntu](https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/) 


### <a name="core-count"></a>Число ядер

При создании виртуальной Машины с поддержкой технологии hyper threading, Azure выделяет 2 потока на ядро, — они называются виртуальных ЦП. Если hyper-threading отключена, Azure удаляет поток и поверхности копии одного однопотоковое ядер (физических ядер). Отношение виртуальных процессоров для ЦП 2:1, как только hyper-threading отключена, число ЦП виртуальной Машины будет отображаться для уменьшили уменьшиться наполовину. Например виртуальная машина D8_v3 находится виртуальная машина, поддержкой технологии hyper threading, работающая на 8 виртуальных ЦП (2 потока на одну core x 4 ядер).  При отключении hyper-threading ЦП будет уменьшиться до 4 физических ядер с 1 потока на ядро. 

## <a name="next-steps"></a>Следующие шаги

Эта статья содержит рекомендации, которые ниже атаки упреждающего исполнения на стороне канала, которые влияют на многих современных процессоров:

[Spectre Meltdown](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/ADV180002):
- CVE-2017-5715 - внедрение ветви (BTI)  
- CVE-2017-5754 - изоляции таблицы страниц ядра (KPTI)
- CVE-2018-3639 — обход наблюдающей Store (KPTI) 
 
[L1 Службы терминалов сбоя (L1TF)](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/ADV180018):
- CVE-2018-3615 - расширения Guard программного обеспечения Intel (Intel SGX)
- CVE-2018-3620 - операционной системы (ОС) и режим управления системой (SMM)
- CVE-2018-3646 — влияет на Virtual Machine Manager (VMM)

[Выборка данных микроархитектуры](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/ADV190013): 
- CVE-2019-11091 - микроархитектуры данные выборки памяти Uncacheable (MDSUM)
- CVE-2018-12126 - Store микроархитектуры буфера данных выборки (MSBDS)
- CVE-2018-12127 - порт нагрузки микроархитектуры данных выборки (MLPDS)
- CVE-2018-12130 - микроархитектуры заполнения буфера данных выборки (MFBDS)








