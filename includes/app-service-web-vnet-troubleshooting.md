---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: 2d2a82552a846cedfa5da3bb6ec6df8a40b67732
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78671485"
---
Простота настройки этой функции не гарантирует отсутствия проблем при ее использовании. При проблемах с доступом к нужной конечной точке можно воспользоваться некоторыми служебными программами для проверки подключения из консоли приложения. Вы можете использовать две консоли: консоль Kudu и консоль на портале Azure. Чтобы открыть консоль Kudu из приложения, выберите пункты "Сервис" -> "Kudu". Вы также можете связаться с консолью Kudo по адресу «sitename.scm.azurewebsites.net. Как только веб-сайт загружается, перейдите на вкладку консоли Debug. Чтобы попасть на развстанную консоль портала Azure, затем из приложения перейдите на Tools -> Console. 

#### <a name="tools"></a>Инструменты
Инструменты **пинг,** **nslookup**, и **tracert** не будет работать через консоль из-за ограничений безопасности. Чтобы заполнить пустоту, добавлены два отдельных инструмента. Для проверки работоспособности DNS мы добавили средство nameresolver.exe. Синтаксис:

    nameresolver.exe hostname [optional: DNS Server]

Для проверки имен узлов, которые использует ваше приложение, можно использовать команду **nameresolver**. Так вы сможете обнаружить ошибки в настройке DNS-сервера или проблемы с доступом к DNS-серверу. Вы можете увидеть DNS-сервер, который ваше приложение будет использовать в консоли, глядя на экологические переменные, WEBSITE_DNS_SERVER и WEBSITE_DNS_ALT_SERVER.

Следующее средство позволяет проверить подключение к комбинации «узел:порт» по протоколу TCP. Этот инструмент называется **tcpping.exe** и использует следующий синтаксис.

    tcpping.exe hostname [optional: port]

**Утилита tcpping** говорит вам, если вы можете достичь конкретного хозяина и порта. Сообщение об успешном выполнении отображается только с том случае, когда приложение ожидает передачи данных от комбинации "узел:порт", а также есть доступ по сети из приложения к указанным узлу и порту.

#### <a name="debugging-access-to-vnet-hosted-resources"></a>Доступ к ресурсам виртуальной сети для отладки
У приложения могут возникнуть проблемы с доступом к определенной комбинации «узел:порт». Это происходит по многим причинам. Вот три наиболее распространенные причины:

* **Брандмауэр блокирует доступ.** Если вы используете брандмауэр, может быть превышено время ожидания TCP. В нашем случае это 21 секунда. Проверьте подключение с помощью средства **tcpping**. Время ожидания TCP может превышаться и по многим другим причинам, но начать стоит именно с этой. 
* **Служба DNS недоступна.** Время ожидания для DNS составляет три секунды на каждый DNS-сервер. Если у вас два DNS-сервера, то время ожидания составляет 6 секунд. Используйте средство nameresolver для проверки работы DNS. Помните, что средство nslookup не подходит для проверки, так как оно игнорирует настройки DNS для виртуальной сети. Если вы недоступны, вы можете иметь брандмауэр или NSG блокирование доступа к DNS или он может быть вниз.

Если эти элементы не отвечают на ваши проблемы, ищите сначала такие вещи, как: 

**региональная интеграция VNet**
* ваш пункт назначения не-RFC1918 адрес, и у вас нет WEBSITE_VNET_ROUTE_ALL установлен на 1?
* есть ли NSG блокируя выход из вашей интеграционной подсети?
* если вы проходите через ExpressRoute или VPN, настроен ли ваш предприимченный шлюз для маршрутного движения обратно в Azure? Если вы можете достичь конечных точек в VNet, но не на месте, проверьте свои маршруты.
* У вас достаточно разрешений, чтобы установить делегацию в подсети интеграции? Во время региональной конфигурации интеграции VNet ваша интеграционная подсеть будет делегирована Microsoft.Web. UI-uI VNet Integration будет делегировать подсеть Microsoft.Web автоматически. Если ваша учетная запись не имеет достаточного разрешения на настройку делегации, вам понадобится кто-то, кто может установить атрибуты в вашей подсети интеграции, чтобы делегировать подсеть. Чтобы вручную делегировать интеграционную подсеть, перейдите в uI-пользовательного доступа виртуальной сети Azure и установите делегацию для Microsoft.Web. 

**шлюз требует интеграции VNet**
* диапазон адреса точки к месту в диапазонах RFC 1918 (10.0.0.0-10.255.255/172.16.0.0-172.31.255.255 / 192.168.0-192.168.255??
* Отображается ли на портале шлюз в рабочем состоянии? Если шлюз не работает, восстановите его работоспособность.
* Отображены ли сертификаты как синхронизированные или вы подозреваете, что конфигурация сети была изменена?  Если сертификаты не синхронизированы или вы подозреваете, что в конфигурацию VNet внесено изменение, которое не было синхронизировано с ASP, нажмите "Sync Network".
* Если вы проходите через VPN, настроен ли находящийся шлюз для маршрутизации трафика обратно в Azure? Если вы можете достичь конечных точек в VNet, но не на месте, проверьте свои маршруты.
* Вы пытаетесь использовать шлюз сосуществования, который поддерживает как точку на сайт и ExpressRoute? Шлюзы сосуществования не поддерживаются интеграцией VNet.

Отладить проблемы сетей является сложной задачей, потому что там вы не можете увидеть, что блокирует доступ к определенной комбинации host:port. Ниже представлено несколько возможных причин этой проблемы.

* У вас есть брандмауэр на вашем хосте, препятствующий доступу к порту приложения от вашей точки к диапазону IP-адресов сайта. Для подключения между подсетями часто требуется разрешить общий доступ.
* Ваш целевой хост не работает.
* Ваша заявка не работает.
* У вас был неправильный IP или hostname.
* Ваше приложение слушает сяочащее приложение в другом порту, чем вы ожидали. Вы можете сопоставить ИД процесса с портом прослушивания при помощи команды "netstat -aon" в узле конечной точки. 
* Группы сетевой безопасности настроены таким образом, что они препятствуют доступу к хосту и порту приложения от вашей точки до диапазона IP-адресов сайта.

Помните, что вы не знаете, какой адрес будет использоваться вашим приложением. Это может быть любой адрес в подсетевой интеграции или диапазон адресов от точки к сайту, поэтому необходимо разрешить доступ со всего диапазона адресов. 

Можно выполнить дополнительные действия по отладке.

* Подключитесь к VM в VNet и попытайтесь связаться с вашим ресурсом хост: порт оттуда. Чтобы проверить доступ TCP, используйте команду PowerShell **test-netconnection**. Синтаксис:

      test-netconnection hostname [optional: -Port]

* Принесите приложение на VM и протестируйте доступ к этому хосту и порту из консоли из приложения с помощью **tcpping**

#### <a name="on-premises-resources"></a>Локальные ресурсы ####

Если приложение не может перейти к ресурсу локально, проверьте, можно ли перейти к ней через виртуальную сеть. Чтобы проверить доступ по протоколу TCP, используйте команду PowerShell **test-netconnection**. Если ваш VM не может достичь вашего ресурса, ваше соединение VPN или ExpressRoute может быть не настроено должным образом.

Если размещенная в виртуальной сети виртуальная машина может взаимодействовать с локальной системой, а приложение — нет, это может быть вызвано одной из следующих причин:

* Ваши маршруты не настроены с вашей подсетью или указывают на диапазонадресадресов сайтов в вашем предварительном шлюзе.
* Группы сетевой безопасности блокируют доступ к IP-диапазону от точки к сайту.
* Ваши брандмауэры блокируют трафик из диапазона IP-адресов от точки к месту.
* Вы пытаетесь достичь адреса, не связанного с RFC 1918, используя региональную функцию интеграции VNet.