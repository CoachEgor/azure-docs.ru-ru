---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: 652d42d6e2d9e909c3a03bd82a3a36f91bc73807
ms.sourcegitcommit: 7581df526837b1484de136cf6ae1560c21bf7e73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80419551"
---
Функция проста в настройке, но это не означает, что ваш опыт будет без проблем. Если вы столкнулись с проблемами доступа к желаемой конечной точке, есть некоторые утилиты, которые можно использовать для тестирования подключения с консоли приложения. Вы можете использовать две консоли: Одним из них является консоль Kudu, а другой — консоль на портале Azure. Чтобы добраться до консоли Kudu из вашего приложения, перейдите на **Инструменты** > **Kudu**. Вы также можете связаться с консолью Kudo по адресу «sitename.scm.azurewebsites.net. После загрузки веб-сайта перейдите на **вкладку консоли Debug.** Чтобы попасть на консоль, размещенную на портале Azure из приложения, перейдите на **консоль Tools** > **Console.**

#### <a name="tools"></a>Инструменты
Инструменты **пинг,** **nslookup**, и **tracert** не будет работать через консоль из-за ограничений безопасности. Чтобы заполнить пустоту, добавляются два отдельных инструмента. Чтобы проверить функциональность DNS, мы добавили инструмент под названием **nameresolver.exe.** Синтаксис:

    nameresolver.exe hostname [optional: DNS Server]

Nameresolver можно использовать для проверки имен узлов, которые использует ваше приложение. Таким образом, вы можете проверить, если у вас есть что-то неправильно настроены с DNS или, возможно, не имеют доступа к вашему DNS-серверу. Вы можете увидеть DNS-сервер, который приложение использует в консоли, глядя на экологические переменные, WEBSITE_DNS_SERVER и WEBSITE_DNS_ALT_SERVER.

Вы можете использовать следующий инструмент для тестирования подключения TCP к комбинации узла и порта. Этот инструмент называется **tcpping.exe** и использует следующий синтаксис.

    tcpping.exe hostname [optional: port]

**Утилита tcpping** говорит вам, если вы можете достичь конкретного хозяина и порта. Он может показать успех только в том случае, если в комбинации хоста и порта есть прослушивание приложения, а также доступ к сети из приложения в указанный хост и порт.

#### <a name="debug-access-to-virtual-network-hosted-resources"></a>Отек доступа к виртуальным сетевым ресурсам
Некоторые вещи могут помешать вашему приложению достичь определенного узла и порта. Большую часть времени это одна из этих вещей:

* **Брандмауэр блокирует доступ.** Если у вас есть брандмауэр на пути, вы нажмете тайм-аут TCP. В нашем случае это 21 секунда. Проверьте подключение с помощью средства **tcpping**. Тайм-ауты TCP могут быть вызваны многими вещами за пределами брандмауэров, но начать там.
* **Служба DNS недоступна.** Время DNS составляет 3 секунды на DNS-сервер. Если у вас два DNS-сервера, то время ожидания составляет 6 секунд. Используйте средство nameresolver для проверки работы DNS. Вы не можете использовать nslookup, потому что это не использует DNS ваша виртуальная сеть настроена с. Если вы недоступны, вы можете иметь брандмауэр или NSG блокирование доступа к DNS или он может быть вниз.

Если эти элементы не отвечают на ваши проблемы, ищите сначала такие вещи, как:

**Региональная интеграция VNet**
* Является ли ваш пункт назначения не-RFC1918 адрес, и у вас нет WEBSITE_VNET_ROUTE_ALL установлен на 1?
* Есть ли NSG, блокирующий выход из вашей интеграционной подсети?
* Если вы проходите через Azure ExpressRoute или VPN, настроен ли ваш предприимчезный шлюз для маршрутизации обратно в Azure? Если вы можете достичь конечных точек в виртуальной сети, но не на месте, проверьте свои маршруты.
* Достаточно ли у вас разрешений, чтобы установить делегацию в подсеть интеграции? Во время региональной конфигурации интеграции VNet ваша интеграционная подсеть делегируется Microsoft.Web. UI-uI VNet Integration автоматически делегирует подсеть Microsoft.Web. Если у вашей учетной записи нет достаточного разрешения на установку делегации, вам понадобится кто-то, кто может установить атрибуты в подсетевой интеграции, чтобы делегировать подсеть. Чтобы вручную делегировать интеграционную подсеть, перейдите на uI-пользовательного доступа виртуальной сети Azure и установите делегацию для Microsoft.Web.

**Интеграция VNet, необходимая для шлюза**
* Является ли диапазон адресов точки к месту в диапазонах RFC 1918 (10.0.0.0-10.255.255/172.16.0.0-172.31.255.255 / 192.168.0-192.168.255??
* Показывает ли шлюз как напавшую на портале? Если шлюз не работает, восстановите его работоспособность.
* Отображаются ли сертификаты как синхронизированные, или вы подозреваете, что конфигурация сети была изменена?  Если сертификаты не синхронизированы или вы подозреваете, что в конфигурацию виртуальной сети было внесено изменение, которое не было синхронизировано с ASP, выберите **Sync Network.**
* Если вы работаете через VPN, настроен ли находящийся шлюз для маршрутизации трафика обратно в Azure? Если вы можете достичь конечных точек в виртуальной сети, но не на месте, проверьте свои маршруты.
* Вы пытаетесь использовать шлюз сосуществования, который поддерживает как точку на сайт и ExpressRoute? Шлюзы сосуществования не поддерживаются интеграцией VNet.

Отладить проблемы сетей — это проблема, поскольку вы не видите, что блокирует доступ к определенному комбинации host:port. Некоторые причины включают в себя:

* У вас есть брандмауэр на вашем хосте, который препятствует доступу к порту приложения из вашего IP-диапазона от точки к месту. Пересечение подсетей часто требует публичного доступа.
* Ваш целевой хост не работает.
* Ваша заявка не работает.
* У вас был неправильный IP или hostname.
* Ваше приложение слушает сяочащее приложение в другом порту, чем вы ожидали. Вы можете сопоставить ИД процесса с портом прослушивания при помощи команды "netstat -aon" в узле конечной точки.
* Группы сетевой безопасности настроены таким образом, что они препятствуют доступу к хосту и порту приложения из диапазона IP-адресов от точки к месту.

Вы не знаете, какой адрес на самом деле использует ваше приложение. Это может быть любой адрес в подсетевой интеграции или диапазон адресов от точки к сайту, поэтому необходимо разрешить доступ со всего диапазона адресов.

Можно выполнить дополнительные действия по отладке.

* Подключитесь к VM в виртуальной сети и попытайтесь добраться до вашего ресурса хост: порт оттуда. Чтобы проверить доступ TCP, используйте команду PowerShell **test-netconnection**. Синтаксис:

      test-netconnection hostname [optional: -Port]

* Принесите приложение на VM и протестируйте доступ к этому хосту и порту из консоли из приложения с помощью **tcpping.**

#### <a name="on-premises-resources"></a>Локальные ресурсы ####

Если ваше приложение не может достичь ресурса на месте, проверьте, если вы можете достичь ресурса из вашей виртуальной сети. Чтобы проверить доступ по протоколу TCP, используйте команду PowerShell **test-netconnection**. Если ваш VM не может достичь вашего ресурса, ваше соединение VPN или ExpressRoute может быть не настроено должным образом.

Если ваш виртуальный сетевой VM может достичь вашей преднациональной системы, но ваше приложение не может, причина, вероятно, одна из следующих причин:

* Маршруты не настроены с помощью подсети или адресов от точки к месту в вашем предварительном шлюзе.
* Ваши группы сетевой безопасности блокируют доступ к диапазону IP-адресов от точки к сайту.
* Ваши брандмауэры блокируют трафик с диапазона IP-адресов от точки к месту.
* Вы пытаетесь достичь адреса, не связанного с RFC 1918, используя региональную функцию интеграции VNet.