---
author: rothja
ms.service: virtual-machines-sql
ms.topic: include
ms.date: 10/26/2018
ms.author: jroth
ms.openlocfilehash: d679767f1a4be3ecdcf1811662c72dbbe2df33a0
ms.sourcegitcommit: 877491bd46921c11dd478bd25fc718ceee2dcc08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "84014794"
---
### <a name="open-tcp-ports-in-the-windows-firewall-for-the-default-instance-of-the-database-engine"></a>Откройте TCP-порты в брандмауэре Windows для экземпляра ядра СУБД по умолчанию
1. Подключитесь к виртуальной машине через удаленный рабочий стол. Подробные инструкции по подключению к виртуальной машине см. в разделе [Открывать виртуальные машины с помощью удаленного рабочего стола](../articles/azure-sql/virtual-machines/windows/create-sql-vm-portal.md#remotedesktop).
2. После входа на начальном экране введите **WF.msc** и нажмите клавишу ВВОД.
   
    ![Запустите программу брандмауэра](./media/virtual-machines-sql-server-connection-steps/12Open-WF.png)
3. На левой панели **Брандмауэр Windows в режиме повышенной безопасности** щелкните правой кнопкой мыши раздел **Правила для входящих подключений** и выберите на панели действий пункт **Создать правило**.
   
    ![Создать правило](./media/virtual-machines-sql-server-connection-steps/13New-FW-Rule.png)
4. В диалоговом окне **Мастер создания правила для нового входящего подключения** в области **Тип правила** выберите **Порт** и нажмите кнопку **Далее**.
5. В диалоговом окне **Протокол и порты** используйте значение по умолчанию **TCP**. Установите переключатель **Определенные локальные порты**, а затем введите номер порта экземпляра ядра СУБД (**1433** для экземпляра по умолчанию или номер для частного порта, указанный при настройке конечной точки).
   
    ![TCP-порт 1433](./media/virtual-machines-sql-server-connection-steps/14Port-1433.png)
6. Нажмите кнопку **Далее**.
7. В диалоговом окне **Действие** выберите **Разрешить соединение** и нажмите кнопку **Далее**.
   
    **Примечание по безопасности.** Выбрав вариант **Разрешить безопасное подключение**, можно обеспечить дополнительную защиту. Выберите этот вариант, если требуется настроить дополнительные параметры безопасности в вашей среде.
   
    ![Разрешить подключения](./media/virtual-machines-sql-server-connection-steps/15Allow-Connection.png)
8. В диалоговом окне **Профиль** выберите **Открытый**, **Частный** и **Доменный**. Нажмите кнопку **Далее**.
   
    **Примечание по безопасности.** Выбрав вариант **Открытый**, вы получите доступ через Интернет. Во всех возможных случаях выбирайте более строгий профиль.
   
    ![Открытый профиль](./media/virtual-machines-sql-server-connection-steps/16Public-Private-Domain-Profile.png)
9. В диалоговом окне **Имя** введите имя и описание правила и нажмите кнопку **Готово**.
   
    ![Имя правила](./media/virtual-machines-sql-server-connection-steps/17Rule-Name.png)

При необходимости откройте дополнительные порты для других компонентов. Дополнительные сведения содержатся в разделе [Настройка брандмауэра Windows для разрешения доступа к SQL Server](https://msdn.microsoft.com/library/cc646023.aspx).

### <a name="configure-sql-server-to-listen-on-the-tcp-protocol"></a>Настройка SQL Server для прослушивания через протокол TCP

[!INCLUDE [Enable TCP](virtual-machines-sql-server-connection-tcp-protocol.md)]

### <a name="configure-sql-server-for-mixed-mode-authentication"></a>Настройка SQL Server на проверку подлинности в смешанном режиме
Компонент SQL Server Database Engine не может использовать проверку подлинности Windows без среды домена. Чтобы подключиться к компоненту Database Engine с другого компьютера, необходимо настроить для SQL Server смешанный режим проверки подлинности. Смешанный режим позволяет выполнять проверку подлинности SQL Server и проверку подлинности Windows.

> [!NOTE]
> Настройка аутентификации в смешанном режиме может быть необязательна, если вы настроили виртуальную сеть Azure с помощью настроенной доменной среды.
> 
> 

1. При установленном подключении к виртуальной машине на начальной странице введите **SQL Server Management Studio** и щелкните выбранный значок.
   
    При первом открытии Management Studio необходимо создать среду пользователей Management Studio. Это может занять несколько минут.
2. Management Studio отображает диалоговое окно **Подключение к серверу** . В поле **Имя сервера** введите имя виртуальной машины для подключения к ядру СУБД с помощью обозревателя объектов (вместо имени виртуальной машины можно также использовать **(local)**, а вместо **имени сервера** — одну точку). Выберите **Проверка подлинности Windows**и оставьте ***your_VM_name \ your_local_administrator*** в поле **имя пользователя** . Нажмите кнопку **Соединить**.
   
    ![Подключение к серверу](./media/virtual-machines-sql-server-connection-steps/19Connect-to-Server.png)
3. В обозревателе объектов SQL Server Management Studio щелкните правой кнопкой мыши имя экземпляра SQL Server (имя виртуальной машины) и выберите пункт **Свойства**.
   
    ![свойства сервера](./media/virtual-machines-sql-server-connection-steps/20Server-Properties.png)
4. На странице **Безопасность** в разделе **Проверка подлинности сервера** выберите **Проверка подлинности SQL Server и Windows** и нажмите кнопку **ОК**.
   
    ![Выберите режим проверки подлинности](./media/virtual-machines-sql-server-connection-steps/21Mixed-Mode.png)
5. В диалоговом окне SQL Server Management Studio щелкните **ОК** для подтверждения необходимости перезапуска SQL Server.
6. В обозревателе объектов щелкните правой кнопкой мыши сервер и выберите пункт **Перезапустить**. (Если выполняется агент SQL Server, его также нужно перезапустить).
   
    ![Перезагрузить](./media/virtual-machines-sql-server-connection-steps/22Restart2.png)
7. В диалоговом окне SQL Server Management Studio щелкните **Да** для подтверждения перезапуска SQL Server.

### <a name="create-sql-server-authentication-logins"></a>Создание учетных записей проверки подлинности SQL Server
Чтобы подключиться к компоненту Database Engine с другого компьютера, необходимо создать как минимум одну учетную запись проверки подлинности SQL Server.

1. В обозревателе объектов SQL Server Management Studio разверните папку экземпляра сервера, на котором требуется создать новую учетную запись.
2. Щелкните правой кнопкой мыши папку **Безопасность** , наведите указатель на пункт **создать**и выберите **имя входа...**.
   
    ![Новая учетная запись](./media/virtual-machines-sql-server-connection-steps/23New-Login.png)
3. В диалоговом окне **Создание имени входа** на странице **Общие** введите имя нового пользователя в поле **Имя входа**.
4. Выберите параметр **Проверка подлинности SQL Server**.
5. В поле **Пароль** введите пароль для нового пользователя. Повторно введите пароль в поле **Подтверждение пароля**.
6. Выберите необходимые параметры принудительного применения паролей (**Требовать использование политики паролей**, **Задать срок окончания действия пароля** и **Пользователь должен сменить пароль при следующем входе**). Если вы сами используете это имя пользователя, то запрашивать смену пароля при следующем входе не нужно.
7. В списке **База данных по умолчанию** выберите базу данных по умолчанию для нужного имени входа. **Основная** . Если пользовательская база данных еще не создана, оставьте значение **Основная**.
   
    ![Свойства учетной записи](./media/virtual-machines-sql-server-connection-steps/24Test-Login.png)
8. При первом создании учетной записи может потребоваться ее назначение в качестве администратора SQL Server. В таком случае на странице **Роли сервера** выберите **sysadmin**.
   
   > [!NOTE]
   > Участники фиксированной серверной роли sysadmin получают все права для управления ядром СУБД. Количество представителей этой роли нужно ограничить.
   > 
   > 
   
   ![sysadmin](./media/virtual-machines-sql-server-connection-steps/25sysadmin.png)
9. Щелкните ОК.

Более подробные сведения об учетных записях SQL Server см. в статье [Создание имени входа](https://msdn.microsoft.com/library/aa337562.aspx).

