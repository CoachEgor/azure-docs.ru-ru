---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: c731e2a7d4da1a66aabb50b335d526fbb6a0a302
ms.sourcegitcommit: bc792d0525d83f00d2329bea054ac45b2495315d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78671521"
---
Использование региональной интеграции виртуальной сети позволяет приложению получить доступ к следующим данным:

* ресурсы в виртуальной сети в том же регионе, который интегрируется с 
* ресурсы в виртуальных сетей, подключенные к виртуальной сети в одном регионе
* защищенные службы конечной точки службы
* ресурсы для подключений ExpressRoute
* ресурсы в виртуальной сети, к которым вы подключены
* ресурсы по одноранговым соединениям, включая подключения ExpressRoute
* Частные конечные точки 

При использовании интеграции с виртуальной сетью с виртуальных сетей в том же регионе можно использовать следующие сетевые функции Azure:

* Группы безопасности сети (группы безопасности сети) — можно блокировать исходящий трафик с помощью группы безопасности сети, размещенной в подсети интеграции. Правила для входящих подключений не применяются, так как вы не можете использовать интеграцию с виртуальной сетью для предоставления входящего доступа к приложению.
* Таблицы маршрутов (определяемые пользователем маршруты) — можно поместить таблицу маршрутов в подсеть интеграции для отправки исходящего трафика. 

По умолчанию приложение будет маршрутизировать трафик АДРЕСНЫЕ пространства RFC1918 в виртуальную сеть. Если вы хотите направить весь исходящий трафик в виртуальную сеть, примените параметр приложения WEBSITE_VNET_ROUTE_ALL к приложению. Чтобы настроить параметр приложения, выполните следующие действия.

1. Перейдите в пользовательский интерфейс настройки на портале приложения. Выбор **параметра "создать приложение** "
1. Введите **WEBSITE_VNET_ROUTE_ALL** в поле имя и **1** в поле значение.

   ![Укажите параметр приложения][4]

1. Нажмите кнопку **ОК**.
1. Нажмите кнопку **Сохранить**.

Если вы направите весь исходящий трафик в виртуальную сеть, он будет подвергаться группы безопасности сети и определяемые пользователем маршруты, которые применяются к подсети интеграции. При маршрутизации всего исходящего трафика в виртуальную сеть исходящие адреса будут по-прежнему являться исходящими адресами, перечисленными в свойствах вашего приложения, если только вы не укажите маршруты для отправки трафика в другое место. 

Существуют некоторые ограничения при использовании интеграции с виртуальной сетью с виртуальных сетей в одном регионе:

* Не удается получить доступ к ресурсам по глобальным одноранговым соединениям
* Эта функция доступна только в новых единицах масштабирования службы приложений, поддерживающих планы службы приложений категории премиум v2.
* Подсеть интеграции может использоваться только одним планом службы приложений.
* Эта функция не может использоваться приложениями изолированного плана, которые находятся в Среда службы приложений
* Для этой функции требуется неиспользуемая подсеть a/27 с 32 адресами или большим размером в диспетчер ресурсов виртуальной сети.
* Приложения и виртуальная сеть должны находиться в одном регионе.
* Удалить виртуальную сеть с интегрированным приложением невозможно. Удалите интеграцию перед удалением виртуальной сети. 
* Интегрировать с виртуальных сетей можно только в той же подписке, что и приложение
* Можно использовать только одну региональную интеграцию с виртуальной сетью на один план службы приложений. Несколько приложений в одном плане службы приложений могут использовать одну и ту же виртуальную сеть. 
* Вы не можете изменить подписку приложения или плана, пока есть приложение, использующее интеграцию с региональной виртуальной сетью.

Для каждого экземпляра плана используется один адрес. При масштабировании приложения до пяти экземпляров используется пять адресов. Так как размер подсети нельзя изменить после назначения, необходимо использовать подсеть, которая достаточно велика для размещения любого масштаба, к которому может получить доступ приложение. Рекомендуемый размер — A/26 с 64 адресами. A/26 с 64 адресами будет соответствовать план "Премиум" с 30 экземплярами. При масштабировании плана вверх или вниз вам потребуется вдвое больше адресов в течение короткого периода времени. 

Если вы хотите, чтобы приложения в другом плане достигли виртуальной сети, к которой уже подключены приложения в другом плане, необходимо выбрать подсеть, отличную от той, которая используется в существующей интеграции с виртуальной сетью.  

Эта функция доступна в предварительной версии для Linux. Форма Linux функции поддерживает вызовы только для адресов RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16).

### <a name="web--function-app-for-containers"></a>Веб-приложение-функция для контейнеров

Если вы размещаете приложение на платформе Linux со встроенными образами, интеграция региональной виртуальной сети будет работать без дополнительных изменений. При использовании веб-приложение-функция для контейнеров необходимо изменить образ DOCKER, чтобы использовать интеграцию с виртуальной сетью. В образе DOCKER используйте переменную среды порта в качестве порта прослушивания основного веб-сервера вместо использования жестко зафиксированного номера порта. Переменная среды порта автоматически задается платформой во время запуска контейнера. При использовании SSH управляющая программа SSH должна прослушивать номер порта, указанный в переменной среды SSH_PORT, при использовании интеграции с региональной виртуальной сетью.  Отсутствует поддержка интеграции виртуальной сети, требуемой для шлюза, в Linux. 

### <a name="service-endpoints"></a>Конечные точки службы

Интеграция региональной виртуальной сети позволяет использовать конечные точки службы.  Чтобы использовать конечные точки службы в приложении, используйте интеграцию с региональной виртуальной сетью, чтобы подключиться к выбранной виртуальной сети, а затем настройте конечные точки службы в используемой для интеграции подсеть. 

### <a name="network-security-groups"></a>группы сетевой безопасности;

Группы безопасности сети позволяют блокировать входящий и исходящий трафик для ресурсов в виртуальной сети. Приложение, использующее интеграцию региональной виртуальной сети, может использовать [группу безопасности сети][VNETnsg] для блокирования исходящего трафика к ресурсам в виртуальной сети или Интернете. Для блокировки трафика на общедоступные адреса необходимо, чтобы параметр приложения WEBSITE_VNET_ROUTE_ALL установлен в значение 1. Правила для входящих подключений в NSG не применяются к вашему приложению, так как интеграция с виртуальной сетью влияет только на исходящий трафик из приложения. Чтобы управлять входящим трафиком к приложению, используйте функцию ограничения доступа. NSG, применяемый к подсети интеграции, будет действовать независимо от всех маршрутов, примененных к подсети интеграции. Если параметру WEBSITE_VNET_ROUTE_ALL было присвоено значение 1, а у вас нет маршрутов, затрагивающих трафик общедоступного адреса в подсети интеграции, весь исходящий трафик по-прежнему будет подвергаться группы безопасности сети, назначенному вашей подсети интеграции. Если параметр WEBSITE_VNET_ROUTE_ALL не был задан, группы безопасности сети будет применяться только к трафику АДРЕСНЫЕ пространства RFC1918.

### <a name="routes"></a>Маршруты

Таблицы маршрутов позволяют направлять исходящий трафик из приложения в нужное место. По умолчанию таблицы маршрутов будут влиять только на трафик назначения АДРЕСНЫЕ пространства RFC1918.  Если для WEBSITE_VNET_ROUTE_ALL задано значение 1, будут затронуты все исходящие вызовы. Маршруты, настроенные в подсети интеграции, не влияют на ответы на входящие запросы приложений. Общие назначения могут включать устройства брандмауэра или шлюзы. Если требуется маршрутизировать весь исходящий трафик локально, можно использовать таблицу маршрутов для отправки всего исходящего трафика на шлюз ExpressRoute. Если вы направите трафик в шлюз, не забудьте установить маршруты во внешней сети для отправки ответов обратно.

Маршруты протокол BGP (BGP) также влияют на трафик приложения. Если у вас есть маршруты BGP, например шлюз ExpressRoute, будет затронуто исходящий трафик приложения. По умолчанию маршруты BGP будут влиять только на трафик назначения АДРЕСНЫЕ пространства RFC1918. Если параметр WEBSITE_VNET_ROUTE_ALL имеет значение 1, маршруты BGP могут повлиять на весь исходящий трафик. 


<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: https://docs.microsoft.com/azure/virtual-network/security-overview/