---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 04/15/2020
ms.author: ccompy
ms.openlocfilehash: f7208307df51ecefb76f9adaedea59b327cdc19e
ms.sourcegitcommit: 5e49f45571aeb1232a3e0bd44725cc17c06d1452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2020
ms.locfileid: "81604875"
---
С помощью региональной интеграции VNet позволяет вашему приложению получить доступ:

* Ресурсы в VNet в том же регионе, что и ваше приложение.
* Ресурсы в VNets включены в VNet, с помощью этого приложения интегрировано.
* Службы конечных служб обеспеченных услуг.
* Ресурсы через соединения Azure ExpressRoute.
* Ресурсы в VNet, с которые вы интегрированы.
* Ресурсы между всещенными соединениями, включающий соединения Azure ExpressRoute.
* Частные конечные точки 

При использовании интеграции VNet с VNets в одном регионе можно использовать следующие сетевые функции Azure:

* **Группы сетевой безопасности (НСУ):** Вы можете блокировать исходящий трафик с помощью NSG, размещаемого в вашей интеграционной подсети. Правила входящего не применяются, потому что вы не можете использовать интеграцию VNet для обеспечения входящего доступа к вашему приложению.
* **Таблицы маршрутов (UDRs):** Вы можете разместить таблицу маршрутов в подсетевой интеграции, чтобы отправить исходящий трафик туда, где вы хотите.

По умолчанию ваше приложение направляет в ваш VNet только трафик RFC1918. Если вы хотите направить весь исходящий трафик в VNet, примените настройку приложения WEBSITE_VNET_ROUTE_ALL к приложению. Для настройки настройки приложения:

1. Перейдите на uI **Configuration** uI в приложении портала. Выберите **новую настройку приложения.**
1. Введите **WEBSITE_VNET_ROUTE_ALL** в поле **Имя,** и введите **1** в поле **Значение.**

   ![Обеспечить настройку приложения][4]

1. Щелкните **ОК**.
1. Щелкните **Сохранить**.

Если вы направляете весь исходящий трафик в VNet, то они подлежат ВОЗДЕЙСТВИю НСУ и СУР, которые применяются к вашей интеграционной подсети. Когда вы направляете весь исходящий трафик в Ваш VNet, исходящие адреса по-прежнему являются исходящими адресами, которые перечислены в свойствах приложения, если только вы не предоставляете маршруты для отправки трафика в другое место.

Есть некоторые ограничения с использованием Интеграции VNet с VNets в том же регионе:

* Вы не можете достичь ресурсов через глобальные соединения пиринга.
* Функция доступна только из новых единиц Azure App Service, которые поддерживают планы PremiumV2 App Service.
* Подсеть интеграции может использоваться только одним планом Службы Приложений.
* Функция не может быть использована приложениями изолированных планов, которые находятся в среде службы приложений.
* Функция требует неиспользованной подсети,которая является /27 с 32 адресами или больше в Менеджере ресурсов Azure VNet.
* Приложение и VNet должны находиться в одном регионе.
* Вы не можете удалить VNet с помощью интегрированного приложения. Удалите интеграцию перед удалением VNet.
* Вы можете интегрироваться с VNets только в той же подписке, что и приложение.
* Вы можете иметь только один региональный VNet Интеграция в план службы приложений. Несколько приложений в одном и том же плане Службы Приложений могут использовать один и тот же VNet.
* Вы не можете изменить подписку на приложение или план, пока есть приложение, использующего региональную интеграцию VNet.
* Приложение не может устраяйтесь в частных зонах Azure DNS без изменений конфигурации

Для каждого экземпляра плана используется один адрес. Если масштабировать приложение до пяти экземпляров, то используются пять адресов. Поскольку размер подсети не может быть изменен после назначения, необходимо использовать подсеть, достаточно большую для размещения любого масштаба, к которым может достичь приложение. A /26 с 64 адресами является рекомендуемый размер. A /26 с 64 адресами вмещает план Premium с 30 экземплярами. При масштабе плана вверх или вниз, вам нужно в два раза больше адресов в течение короткого периода времени.

Если вы хотите, чтобы ваши приложения в другом плане достигли VNet, который уже подключен к приложениям в другом плане, выберите другую подсеть, чем та, которая используется уже существующей интеграцией VNet.

Функция находится в предварительном просмотре для Linux. Форма Linux функции поддерживает только звонки по адресам RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16).

### <a name="web-or-function-app-for-containers"></a>Веб или функциональное приложение для контейнеров

Если вы размещаете приложение на Linux со встроенными изображениями, региональная интеграция VNet работает без дополнительных изменений. Если вы используете Web или Функцию App для контейнеров, необходимо изменить изображение докера, чтобы использовать интеграцию VNet. На изображении докера используйте переменную среды PORT в качестве основного порта прослушивания веб-сервера, вместо того, чтобы использовать жесткий номер порта. Переменная среды PORT автоматически устанавливается платформой во время запуска контейнера. Если вы используете SSH, daemon SSH должен быть настроен для прослушивания номера порта, указанного переменной среды SSH_PORT при использовании региональной интеграции VNet. Там нет поддержки для шлюза требуется VNet интеграции на Linux.

### <a name="service-endpoints"></a>Конечные точки служб

Региональная интеграция VNet позволяет использовать конечные точки обслуживания. Чтобы использовать конечные точки обслуживания с вашим приложением, используйте региональную интеграцию VNet для подключения к выбранной VNet, а затем настраивайте конечные точки службы с помощью службы назначения в подсети, используемой для интеграции. Если вы хотите получить доступ к службе через конечные точки службы:

1. настроить региональную интеграцию VNet с помощью веб-приложения
1. перейти в службу назначения и настроить конечные точки службы в отношении подсети, используемой для интеграции

### <a name="network-security-groups"></a>Группы безопасности сети

Группы сетевой безопасности могут блокировать входящий и исходящий трафик к ресурсам в VNet. Приложение, используюваеее региональную интеграцию VNet, может использовать [группу сетевой безопасности][VNETnsg] для блокирования исходящего трафика на ресурсы в vNet или в Интернете. Чтобы заблокировать трафик на общедоступные адреса, необходимо иметь настройку приложения WEBSITE_VNET_ROUTE_ALL установлена до 1. Правила входящего В NSG не применяются к вашему приложению, поскольку интеграция VNet влияет только на исходящий трафик из приложения.

Для управления входящим трафиком в приложение используйте функцию Ограничения доступа. NSG, применяемый к вашей интеграционной подсети, действует независимо от маршрутов, применяемых к вашей интеграционной подсети. Если WEBSITE_VNET_ROUTE_ALL установлен на 1 и у вас нет маршрутов, которые влияют на трафик адреса в вашей интеграционной подсети, весь исходящий трафик по-прежнему подлежит NSGs, назначенным вашей интеграционной подсети. Если WEBSITE_VNET_ROUTE_ALL не установлена, НСГ применяются только к трафику RFC1918.

### <a name="routes"></a>Маршруты

Вы можете использовать таблицы маршрутов для маршрутов исходящего трафика из приложения туда, где вы хотите. По умолчанию таблицы маршрутов влияют только на трафик назначения RFC1918. Если вы установите WEBSITE_VNET_ROUTE_ALL до 1, все исходящие вызовы будут затронуты. Маршруты, установленные в подсетевой интеграции, не влияют на ответы на запросы входящих приложений. Общие назначения могут включать брандмауэры или шлюзы.

Если вы хотите направить весь исходящий трафик на предпосылки, вы можете использовать таблицу маршрутов, чтобы отправить весь исходящий трафик на ваш шлюз ExpressRoute. Если вы направляете трафик к шлюзу, обязательно установите маршруты во внешней сети, чтобы отправить любые ответы обратно.

Маршруты протокола пограничного шлюза (BGP) также влияют на трафик вашего приложения. Если у вас есть bgP маршруты из чего-то вроде шлюза ExpressRoute, исходящий трафик приложения будет затронут. По умолчанию маршруты BGP влияют только на ваш трафик назначения RFC1918. Если WEBSITE_VNET_ROUTE_ALL настроена до 1, весь исходящий трафик может быть затронут вашими маршрутами BGP.

### <a name="azure-dns-private-zones"></a>Частные зоны Azure DNS 

После интеграции приложения с VNet используется тот же DNS-сервер, с которым настроен ваш VNet. По умолчанию приложение не будет работать с частными зонами Azure DNS. Для работы с частными зонами Azure DNS необходимо добавить следующие настройки приложения:

1. WEBSITE_DNS_SERVER со значением 168.63.129.16 
1. WEBSITE_VNET_ROUTE_ALL со значением 1

Эти настройки будут отправлять все исходящие звонки из вашего приложения в VNet в дополнение к тому, чтобы позволить приложению использовать частные зоны Azure DNS.

### <a name="private-endpoints"></a>Частные конечные точки

Если вы хотите совершать звонки в [частные конечные точки,][privateendpoints]то вам нужно либо интегрироваться с частными зонами Azure DNS, либо управлять частной конечной точкой на сервере DNS, используемом вашим приложением. 

<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: https://docs.microsoft.com/azure/virtual-network/security-overview/
[privateendpoints]: https://docs.microsoft.com/azure/app-service/networking/private-endpoint
