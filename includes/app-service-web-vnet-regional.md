---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: c731e2a7d4da1a66aabb50b335d526fbb6a0a302
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2020
ms.locfileid: "78671521"
---
С помощью региональной интеграции VNet позволяет вашему приложению получить доступ:

* ресурсов в VNet в том же регионе, с которым вы интегрируетесь 
* ресурсы в VNets заглянули в ваш VNet, которые находятся в том же регионе
* службы конечных служб обеспеченных услуг
* ресурсов через соединения ExpressRoute
* ресурсов в VNet, к которые вы подключены,
* ресурсов в разных соединениях, включая подключения ExpressRoute
* частные конечные точки 

При использовании Интеграции VNet с VNets в одном регионе можно использовать следующие функции Сети Azure:

* Группы сетевой безопасности (NSGs) - Вы можете блокировать исходящий трафик с помощью группы сетевой безопасности, которая размещается в вашей интеграционной подсети. Входящие правила не применяются, так как вы не можете использовать VNet Integration для обеспечения входящего доступа к вашему приложению.
* Таблицы маршрутов (UDRs) - Вы можете разместить таблицу маршрутов в подсетевой интеграции, чтобы отправить исходящий трафик туда, где вы хотите. 

По умолчанию ваше приложение будет направлять трафик RFC1918 только в ваш VNet. Если вы хотите направить весь исходящий трафик в VNet, примените настройку приложения WEBSITE_VNET_ROUTE_ALL к приложению. Для настройки настройки приложения:

1. Перейдите на uI Configuration uI в приложении портала. Выберите **новую настройку приложения**
1. Введите **WEBSITE_VNET_ROUTE_ALL** в поле имени и **1** в поле значения

   ![Обеспечить настройку приложения][4]

1. Нажмите кнопку **ОК**.
1. Выберите **Сохранить**

Если вы направите весь исходящий трафик в Ваш VNet, то он будет подчиняться NSGs и UD, которые применяются к вашей интеграционной подсети. Когда вы направляете весь исходящий трафик в Ваш VNet, исходящие адреса по-прежнему будут исходящими адресами, перечисленными в свойствах приложения, если только вы не предоставите маршруты для отправки трафика в другое место. 

Есть некоторые ограничения с использованием Интеграции VNet с VNets в том же регионе:

* Вы не можете достичь ресурсов через глобальные соединения пиринга
* Функция доступна только из новых единиц App Service масштаба, которые поддерживают PremiumV2 App Service планов.
* Подсеть интеграции может использоваться только одним планом Службы App
* Функция не может быть использована приложениями изолированных планов, которые находятся в среде службы приложений
* Функция требует неиспользованной подсети, которая является /27 с 32 адресами или больше в менеджере ресурсов VNet
* Приложения и виртуальная сеть должны находиться в одном регионе.
* Удалить виртуальную сеть с интегрированным приложением невозможно. Удалите интеграцию перед удалением VNet. 
* Вы можете интегрироваться с VNets только в той же подписке, что и приложение
* Вы можете иметь только один региональный VNet Интеграция в план службы приложений. Несколько приложений в одном и том же плане Службы Приложений могут использовать один и тот же VNet. 
* Вы не можете изменить подписку на приложение или план, пока есть приложение, использующего региональную интеграцию VNet

Для каждого экземпляра плана используется один адрес. Если масштабировать приложение до пяти экземпляров, то используются пять адресов. Поскольку размер подсети не может быть изменен после назначения, необходимо использовать подсеть, которая достаточно велика, чтобы вместить любой масштаб, к которым может достичь приложение. A /26 с 64 адресами является рекомендуемый размер. A /26 с 64 адресами будет вмещать премиум-план с 30 экземплярами. При масштабе плана вверх или вниз, вам нужно в два раза больше адресов в течение короткого периода времени. 

Если вы хотите, чтобы ваши приложения в другом плане достигли VNet, который уже подключен к приложениям в другом плане, вам нужно выбрать другую подсеть, чем та, которая используется уже существующей интеграцией VNet.  

Функция находится в предварительном просмотре для Linux. Форма Linux функции поддерживает только звонки по адресам RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16).

### <a name="web--function-app-for-containers"></a>Веб / Функция App для контейнеров

Если вы размещаете приложение на Linux со встроенными изображениями, региональная интеграция VNet работает без дополнительных изменений. Если вы используете Web / Функции App для контейнеров, вам нужно изменить изображение докера, чтобы использовать интеграцию VNet. На изображении докера используйте переменную среды PORT в качестве основного порта прослушивания веб-сервера, вместо того, чтобы использовать жесткий номер порта. Переменная среды PORT автоматически устанавливается платформой во время запуска контейнера. Если вы используете SSH, то Daemon SSH должен быть настроен для прослушивания номера порта, указанного переменной среды SSH_PORT при использовании региональной интеграции VNet.  Существует никакой поддержки шлюза требуется VNet Интеграция на Linux. 

### <a name="service-endpoints"></a>Конечные точки службы

Региональная интеграция VNet позволяет использовать конечные точки обслуживания.  Чтобы использовать конечные точки обслуживания с вашим приложением, используйте региональную интеграцию VNet для подключения к выбранной VNet, а затем настроить конечные точки службы в поднете, используемой для интеграции. 

### <a name="network-security-groups"></a>группы сетевой безопасности;

Группы сетевой безопасности позволяют блокировать входящий и исходящий трафик к ресурсам в VNet. Приложение, используюеееееео региональную интеграцию VNet, может использовать [группу сетевой безопасности][VNETnsg] для блокирования исходящего трафика на ресурсы в вашем VNet или в Интернете. Чтобы заблокировать трафик на общедоступные адреса, необходимо иметь настройку приложения WEBSITE_VNET_ROUTE_ALL установлена до 1. Правила входящего NSG не применяются к вашему приложению, так как интеграция VNet влияет только на исходящий трафик из вашего приложения. Для управления входящим трафиком в приложение используйте функцию Ограничения доступа. NSG, применяемый к вашей интеграционной подсети, будет действовать независимо от маршрутов, применяемых к вашей интеграционной подсети. Если WEBSITE_VNET_ROUTE_ALL был установлен до 1 и у вас не было маршрутов, влияющих на трафик общественного адреса в вашей интеграционной подсети, все исходящие трафики по-прежнему будут подлежать NSGs, назначенным вашей интеграционной подсети. Если WEBSITE_VNET_ROUTE_ALL не будет установлен, НСГ будут применяться только к RFC1918 трафика.

### <a name="routes"></a>Маршруты

Таблицы маршрутов позволяют маршрутизать исходящий трафик из приложения туда, где вы хотите. По умолчанию таблицы маршрутов будут влиять только на трафик назначения RFC1918.  Если вы установите WEBSITE_VNET_ROUTE_ALL до 1, то все исходящие вызовы будут затронуты. Маршруты, установленные в подсетевой интеграции, не повлияют на ответы на запросы входящих приложений. Общие назначения могут включать брандмауэры или шлюзы. Если вы хотите направить весь исходящий трафик на предпосылки, вы можете использовать таблицу маршрутов, чтобы отправить весь исходящий трафик на ваш шлюз ExpressRoute. Если вы направляете трафик к шлюзу, обязательно установите маршруты во внешней сети, чтобы отправить любые ответы обратно.

Маршруты Протокола пограничного шлюза (BGP) также повлияют на трафик вашего приложения. Если у вас есть bgP маршруты из чего-то вроде шлюза ExpressRoute, исходящий трафик приложения будет затронут. По умолчанию маршруты BGP будут влиять только на трафик назначения RFC1918. Если WEBSITE_VNET_ROUTE_ALL настроенна до 1, то весь исходящий трафик может быть затронут вашими маршрутами BGP. 


<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: https://docs.microsoft.com/azure/virtual-network/security-overview/