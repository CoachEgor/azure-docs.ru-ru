---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 04/15/2020
ms.author: ccompy
ms.openlocfilehash: f7208307df51ecefb76f9adaedea59b327cdc19e
ms.sourcegitcommit: 849bb1729b89d075eed579aa36395bf4d29f3bd9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2020
ms.locfileid: "81604875"
---
Использование региональной интеграции виртуальной сети позволяет приложению получить доступ к следующим данным:

* Ресурсы в виртуальной сети в том же регионе, что и ваше приложение.
* Ресурсы в виртуальных сетей, подключенные к виртуальной сети, с которой интегрировано приложение.
* Службы, защищенные конечной точкой службы.
* Ресурсы для подключений Azure ExpressRoute.
* Ресурсы в виртуальной сети, с которыми вы интегрируетесь.
* Ресурсы через одноранговые соединения, в том числе подключения Azure ExpressRoute.
* Частные конечные точки 

При использовании интеграции с виртуальной сетью с виртуальных сетей в том же регионе можно использовать следующие сетевые функции Azure:

* **Группы безопасности сети (группы безопасности сети)**. исходящий трафик можно блокировать с помощью NSG, размещенного в подсети интеграции. Правила для входящих подключений не применяются, так как вы не можете использовать интеграцию с виртуальной сетью для предоставления входящего доступа к приложению.
* **Таблицы маршрутов (определяемые пользователем маршруты)**. таблицу маршрутов можно поместить в подсеть интеграции для отправки исходящего трафика.

По умолчанию приложение перенаправляет только АДРЕСНЫЕ пространства RFC1918 трафик в виртуальную сеть. Если вы хотите направить весь исходящий трафик в виртуальную сеть, примените параметр приложения WEBSITE_VNET_ROUTE_ALL к приложению. Чтобы настроить параметр приложения, выполните следующие действия.

1. Перейдите в пользовательский интерфейс **настройки** на портале приложения. Выберите **параметр создать приложение**.
1. Введите **WEBSITE_VNET_ROUTE_ALL** в поле **имя** и введите **1** в поле **значение** .

   ![Укажите параметр приложения][4]

1. Щелкните **ОК**.
1. Щелкните **Сохранить**.

Если вы направите весь исходящий трафик в виртуальную сеть, он подлежит группы безопасности сети и определяемые пользователем маршруты, которые применяются к подсети интеграции. При маршрутизации всего исходящего трафика в виртуальную сеть исходящие адреса по-прежнему будут исходящими в свойствах вашего приложения, если только не указаны маршруты для отправки трафика в другое место.

Существуют некоторые ограничения при использовании интеграции с виртуальной сетью с виртуальных сетей в одном регионе:

* Не удается получить доступ к ресурсам по глобальным одноранговым соединениям.
* Эта функция доступна только в более новых единицах масштабирования службы приложений Azure, поддерживающих планы службы приложений категории премиум v2.
* Подсеть интеграции может использоваться только одним планом службы приложений.
* Эта функция не может использоваться приложениями изолированного плана, которые находятся в Среда службы приложений.
* Для этой функции требуется неиспользуемая подсеть a/27 с 32 адресами или больше в Azure Resource Manager виртуальной сети.
* Приложение и виртуальная сеть должны находиться в одном регионе.
* Невозможно удалить виртуальную сеть с интегрированным приложением. Удалите интеграцию перед удалением виртуальной сети.
* Интегрировать с виртуальных сетей можно только в той же подписке, что и приложение.
* Можно использовать только одну региональную интеграцию с виртуальной сетью на один план службы приложений. Несколько приложений в одном плане службы приложений могут использовать одну и ту же виртуальную сеть.
* Вы не можете изменить подписку приложения или плана, пока есть приложение, использующее интеграцию с региональной виртуальной сетью.
* Приложению не удается разрешить адреса в Частные зоны Azure DNS без изменений конфигурации

Для каждого экземпляра плана используется один адрес. При масштабировании приложения до пяти экземпляров используется пять адресов. Так как размер подсети нельзя изменить после назначения, необходимо использовать подсеть, которая достаточно велика для размещения любого масштаба, к которому может получить доступ приложение. Рекомендуемый размер — A/26 с 64 адресами. A/26 с 64 адресами соответствует план "Премиум" с 30 экземплярами. При масштабировании плана вверх или вниз вам потребуется вдвое больше адресов в течение короткого периода времени.

Если вы хотите, чтобы ваши приложения в другом плане достигли виртуальной сети, которая уже подключена к приложениям в другом плане, выберите подсеть, отличную от используемой уже существующей интеграцией виртуальной сети.

Эта функция доступна в предварительной версии для Linux. Форма Linux функции поддерживает вызовы только для адресов RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16).

### <a name="web-or-function-app-for-containers"></a>Веб-или приложение-функция для контейнеров

Если вы размещаете приложение на платформе Linux со встроенными образами, интеграция региональной виртуальной сети будет работать без дополнительных изменений. При использовании веб-или приложение-функция для контейнеров необходимо изменить образ DOCKER для использования интеграции с виртуальной сетью. В образе DOCKER используйте переменную среды порта в качестве порта прослушивания основного веб-сервера вместо использования жестко зафиксированного номера порта. Переменная среды порта автоматически задается платформой во время запуска контейнера. При использовании SSH управляющая программа SSH должна прослушивать номер порта, указанный в переменной среды SSH_PORT, при использовании интеграции с региональной виртуальной сетью. Отсутствует поддержка интеграции виртуальной сети, необходимой для шлюза, в Linux.

### <a name="service-endpoints"></a>Конечные точки служб

Интеграция региональной виртуальной сети позволяет использовать конечные точки службы. Чтобы использовать конечные точки службы в приложении, используйте интеграцию с региональной виртуальной сетью для подключения к выбранной виртуальной сети, а затем настройте конечные точки службы, указав целевую службу в подсети, используемой для интеграции. Если вы хотите получить доступ к службе через конечные точки службы, сделайте следующее:

1. Настройка интеграции региональной виртуальной сети с веб-приложением
1. Перейдите в целевую службу и настройте конечные точки службы для подсети, используемой для интеграции.

### <a name="network-security-groups"></a>Группы безопасности сети

Группы безопасности сети можно использовать для блокировки входящего и исходящего трафика для ресурсов в виртуальной сети. Приложение, использующее интеграцию региональной виртуальной сети, может использовать [группу безопасности сети][VNETnsg] для блокировки исходящего трафика к ресурсам в виртуальной сети или Интернете. Для блокировки трафика на общедоступные адреса необходимо, чтобы параметр приложения WEBSITE_VNET_ROUTE_ALL установлен в значение 1. Правила для входящих подключений в NSG не применяются к вашему приложению, так как интеграция с виртуальной сетью влияет только на исходящий трафик из приложения.

Чтобы управлять входящим трафиком к приложению, используйте функцию ограничения доступа. NSG, применяемый к подсети интеграции, действует независимо от всех маршрутов, примененных к подсети интеграции. Если для параметра WEBSITE_VNET_ROUTE_ALL задано значение 1, а у вас нет маршрутов, влияющих на трафик общедоступного адреса в подсети интеграции, весь исходящий трафик по-прежнему подпадает под группы безопасности сети, назначенный вашей подсети интеграции. Если WEBSITE_VNET_ROUTE_ALL не задано, группы безопасности сети применяются только к трафику АДРЕСНЫЕ пространства RFC1918.

### <a name="routes"></a>Маршруты

Таблицы маршрутов можно использовать для маршрутизации исходящего трафика из приложения в нужное место. По умолчанию таблицы маршрутов влияют только на трафик назначения АДРЕСНЫЕ пространства RFC1918. Если присвоить WEBSITE_VNET_ROUTE_ALL значение 1, будут затронуты все исходящие вызовы. Маршруты, настроенные в подсети интеграции, не влияют на ответы на входящие запросы приложений. Общие назначения могут включать устройства брандмауэра или шлюзы.

Если требуется маршрутизировать весь исходящий трафик локально, можно использовать таблицу маршрутов для отправки всего исходящего трафика на шлюз ExpressRoute. Если вы направите трафик в шлюз, не забудьте установить маршруты во внешней сети для отправки ответов обратно.

Маршруты протокол BGP (BGP) также влияют на трафик приложения. Если у вас есть маршруты BGP, например шлюз ExpressRoute, будет затронуто исходящий трафик приложения. По умолчанию маршруты BGP влияют только на трафик назначения АДРЕСНЫЕ пространства RFC1918. Если WEBSITE_VNET_ROUTE_ALL имеет значение 1, маршруты BGP могут повлиять на весь исходящий трафик.

### <a name="azure-dns-private-zones"></a>Частные зоны Azure DNS 

После интеграции приложения с виртуальной сетью используется тот же DNS-сервер, с которым настроена виртуальная сеть. По умолчанию приложение не будет работать с Частные зоны Azure DNS. Для работы с Частные зоны Azure DNS необходимо добавить следующие параметры приложения:

1. WEBSITE_DNS_SERVER со значением 168.63.129.16 
1. WEBSITE_VNET_ROUTE_ALL со значением 1

Эти параметры отправляют все исходящие вызовы из приложения в виртуальную сеть, а также позволяют приложению использовать частные зоны Azure DNS.

### <a name="private-endpoints"></a>Частные конечные точки

Если вы хотите выполнять вызовы к [частным конечным точкам][privateendpoints], необходимо либо интегрировать их с частные зоны Azure DNS, либо управлять частной конечной точкой на DNS-сервере, используемом приложением. 

<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: https://docs.microsoft.com/azure/virtual-network/security-overview/
[privateendpoints]: https://docs.microsoft.com/azure/app-service/networking/private-endpoint
