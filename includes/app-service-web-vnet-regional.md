---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: e0db3ce7d31b838ca6f7d566083a33ee215d3399
ms.sourcegitcommit: 7581df526837b1484de136cf6ae1560c21bf7e73
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/31/2020
ms.locfileid: "80419520"
---
С помощью региональной интеграции VNet позволяет вашему приложению получить доступ:

* Ресурсы в виртуальной сети в том же регионе, с которым вы интегрируетесь.
* Ресурсы в виртуальных сетях заглянули в виртуальную сеть, которая находятся в одном регионе.
* Службы конечных служб обеспеченных услуг.
* Ресурсы через соединения Azure ExpressRoute.
* Ресурсы в виртуальной сети, к ней подключены.
* Ресурсы между всещенными соединениями, включающий соединения Azure ExpressRoute.
* Частные конечные точки.

При использовании Интеграции VNet с виртуальными сетями в одном регионе можно использовать следующие сетевые функции Azure:

* **Группы сетевой безопасности (НСУ):** Вы можете блокировать исходящий трафик с помощью NSG, размещаемого в вашей интеграционной подсети. Правила входящего не применяются, потому что вы не можете использовать интеграцию VNet для обеспечения входящего доступа к вашему приложению.
* **Таблицы маршрутов (UDRs):** Вы можете разместить таблицу маршрутов в подсетевой интеграции, чтобы отправить исходящий трафик туда, где вы хотите.

По умолчанию ваше приложение направляет в виртуальную сеть только трафик RFC1918. Если вы хотите направить весь исходящий трафик в виртуальную сеть, примените настройку приложения WEBSITE_VNET_ROUTE_ALL к приложению. Для настройки настройки приложения:

1. Перейдите на uI **Configuration** uI в приложении портала. Выберите **новую настройку приложения.**
1. Введите **WEBSITE_VNET_ROUTE_ALL** в поле **Имя,** и введите **1** в поле **Значение.**

   ![Обеспечить настройку приложения][4]

1. Щелкните **ОК**.
1. Щелкните **Сохранить**.

Если вы направляете весь исходящий трафик в виртуальную сеть, то они подлежат воздействию НСУ и СУР, которые применяются к вашей интеграционной подсети. Когда вы направляете весь исходящий трафик в виртуальную сеть, исходящие адреса по-прежнему являются исходящими адресами, которые перечислены в свойствах приложения, если только вы не предоставляете маршруты для отправки трафика в другое место.

Есть некоторые ограничения с использованием Интеграции VNet с виртуальными сетями в том же регионе:

* Вы не можете достичь ресурсов через глобальные соединения пиринга.
* Функция доступна только из новых единиц Azure App Service, которые поддерживают планы PremiumV2 App Service.
* Подсеть интеграции может использоваться только одним планом Службы Приложений.
* Функция не может быть использована приложениями изолированных планов, которые находятся в среде службы приложений.
* Функция требует неиспользованной подсети, которая является /27 с 32 адресами или больше в виртуальной сети Azure Resource Manager.
* Приложение и виртуальная сеть должны находиться в одном регионе.
* Вы не можете удалить виртуальную сеть с помощью интегрированного приложения. Удалите интеграцию перед удалением виртуальной сети.
* Вы можете интегрироваться с виртуальными сетями только в той же подписке, что и приложение.
* Вы можете иметь только один региональный VNet Интеграция в план службы приложений. Несколько приложений в одном и том же плане Службы Приложений могут использовать одну и ту же виртуальную сеть.
* Вы не можете изменить подписку на приложение или план, пока есть приложение, использующего региональную интеграцию VNet.

Для каждого экземпляра плана используется один адрес. Если масштабировать приложение до пяти экземпляров, то используются пять адресов. Поскольку размер подсети не может быть изменен после назначения, необходимо использовать подсеть, достаточно большую для размещения любого масштаба, к которым может достичь приложение. A /26 с 64 адресами является рекомендуемый размер. A /26 с 64 адресами вмещает план Premium с 30 экземплярами. При масштабе плана вверх или вниз, вам нужно в два раза больше адресов в течение короткого периода времени.

Если вы хотите, чтобы ваши приложения в другом плане достигли виртуальной сети, которая уже подключена к приложениям в другом плане, выберите другую подсеть, чем та, которая используется уже существующей интеграцией VNet.

Функция находится в предварительном просмотре для Linux. Форма Linux функции поддерживает только звонки по адресам RFC 1918 (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16).

### <a name="web-or-function-app-for-containers"></a>Веб или функциональное приложение для контейнеров

Если вы размещаете приложение на Linux со встроенными изображениями, региональная интеграция VNet работает без дополнительных изменений. Если вы используете Web или Функцию App для контейнеров, необходимо изменить изображение докера, чтобы использовать интеграцию VNet. На изображении докера используйте переменную среды PORT в качестве основного порта прослушивания веб-сервера, вместо того, чтобы использовать жесткий номер порта. Переменная среды PORT автоматически устанавливается платформой во время запуска контейнера. Если вы используете SSH, daemon SSH должен быть настроен для прослушивания номера порта, указанного переменной среды SSH_PORT при использовании региональной интеграции VNet. Там нет поддержки для шлюза требуется VNet интеграции на Linux.

### <a name="service-endpoints"></a>Конечные точки служб

С помощью региональной интеграции VNet можно использовать конечные точки обслуживания. Чтобы использовать конечные точки обслуживания с вашим приложением, используйте региональную интеграцию VNet для подключения к выбранной виртуальной сети. Затем настройте конечные точки службы в подсеть, используемую для интеграции.

### <a name="network-security-groups"></a>Группы безопасности сети

Группы сетевой безопасности могут блокировать входящий и исходящий трафик к ресурсам в виртуальной сети. Приложение, используюваеее региональную интеграцию VNet, может использовать [группу сетевой безопасности][VNETnsg] для блокирования исходящего трафика на ресурсы виртуальной сети или Интернета. Чтобы заблокировать трафик на общедоступные адреса, необходимо иметь настройку приложения WEBSITE_VNET_ROUTE_ALL установлена до 1. Правила входящего В NSG не применяются к вашему приложению, поскольку интеграция VNet влияет только на исходящий трафик из приложения.

Для управления входящим трафиком в приложение используйте функцию Ограничения доступа. NSG, применяемый к вашей интеграционной подсети, действует независимо от маршрутов, применяемых к вашей интеграционной подсети. Если WEBSITE_VNET_ROUTE_ALL установлен на 1 и у вас нет маршрутов, которые влияют на трафик адреса в вашей интеграционной подсети, весь исходящий трафик по-прежнему подлежит NSGs, назначенным вашей интеграционной подсети. Если WEBSITE_VNET_ROUTE_ALL не установлена, НСГ применяются только к трафику RFC1918.

### <a name="routes"></a>Маршруты

Вы можете использовать таблицы маршрутов для маршрутов исходящего трафика из приложения туда, где вы хотите. По умолчанию таблицы маршрутов влияют только на трафик назначения RFC1918. Если вы установите WEBSITE_VNET_ROUTE_ALL до 1, все исходящие вызовы будут затронуты. Маршруты, установленные в подсетевой интеграции, не влияют на ответы на запросы входящих приложений. Общие назначения могут включать брандмауэры или шлюзы.

Если вы хотите направить весь исходящий трафик на предпосылки, вы можете использовать таблицу маршрутов, чтобы отправить весь исходящий трафик на ваш шлюз ExpressRoute. Если вы направляете трафик к шлюзу, обязательно установите маршруты во внешней сети, чтобы отправить любые ответы обратно.

Маршруты протокола пограничного шлюза (BGP) также влияют на трафик вашего приложения. Если у вас есть bgP маршруты из чего-то вроде шлюза ExpressRoute, исходящий трафик приложения будет затронут. По умолчанию маршруты BGP влияют только на ваш трафик назначения RFC1918. Если WEBSITE_VNET_ROUTE_ALL настроена до 1, весь исходящий трафик может быть затронут вашими маршрутами BGP.


<!--Image references-->
[4]: ../includes/media/web-sites-integrate-with-vnet/vnetint-appsetting.png

<!--Links-->
[VNETnsg]: https://docs.microsoft.com/azure/virtual-network/security-overview/