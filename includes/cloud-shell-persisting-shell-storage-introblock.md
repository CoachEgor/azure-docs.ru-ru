---
author: jluk
ms.service: cloud-shell
ms.topic: persist-storage
ms.date: 9/7/2018
ms.author: juluk
ms.openlocfilehash: c28441b6fe25b3480a55b79682d5067b19e3023a
ms.sourcegitcommit: 778e7376853b69bbd5455ad260d2dc17109d05c1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/23/2019
ms.locfileid: "66125198"
---
# <a name="persist-files-in-azure-cloud-shell"></a>Сохранение файлов в Azure Cloud Shell
Azure Cloud Shell использует хранилище файлов Azure, чтобы хранить файлы между сеансами. При первом запуске Azure Cloud Shell предлагает привязать новый или существующий файловый ресурс, чтобы сохранять файлы между сеансами.

> [!NOTE]
> PowerShell и Bash совместно используют одну и ту же сетевую папку. С функцией автоматического подключения в Cloud Shell можно связать только одну общую папку.

## <a name="create-new-storage"></a>Создание хранилища

Если вы используете базовые параметры и выбрали только подписку, Cloud Shell создаст три ресурса от вашего имени в поддерживаемом регионе, находящемся ближе всего к вам:
* группу ресурсов `cloud-shell-storage-<region>`;
* учетную запись хранения `cs<uniqueGuid>`;
* файловый ресурс `cs-<user>-<domain>-com-<uniqueGuid>`.

![Настройка подписки](../articles/cloud-shell/media/persisting-shell-storage/basic-storage.png)

Файловый ресурс подключается как `clouddrive` в вашем каталоге `$Home`. Подключение выполняется один раз, и для последующих сеансов файловый ресурс подключается автоматически. 

> [!NOTE]
> Для обеспечения безопасности каждому пользователю следует подготовить собственную учетную запись хранения.  Чтобы реализовать управление доступом на основе ролей (RBAC), пользователи должны иметь права доступа участника или выше на уровне учетной записи хранения.

Общая папка также содержит создаваемый образ размером 5 ГБ для автоматического хранения данных в каталоге `$Home`. Это относится и к Bash, и к PowerShell.

## <a name="use-existing-resources"></a>Использование существующих ресурсов

С помощью расширенных параметров можно привязать существующие ресурсы. При выборе региона Cloud Shell необходимо выбрать резервную учетную запись хранения, расположенную в этом же регионе. Например, если вы выбрали регион "Западная часть США", с ним необходимо связать файловый ресурс, который также находится в западной части США.

Когда появится запрос на настройку хранилища, щелкните **Показать дополнительные настройки**, чтобы просмотреть дополнительные параметры. Заданные параметры хранилища будут отфильтрованы по локально избыточному хранилищу (LRS), геоизбыточному хранилищу (GRS) и хранилищу, избыточному между зонами (ZRS). 

> [!NOTE]
> Учетные записи хранения GRS или ZRS рекомендуется использовать для повышения устойчивости резервного файлового ресурса. Выбор типа избыточности зависит от ваших целей и ценовых предпочтений. [Дополнительные сведения о вариантах репликации для учетных записей хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy).

![Настройка группы ресурсов](../articles/cloud-shell/media/persisting-shell-storage/advanced-storage.png)

### <a name="supported-storage-regions"></a>Поддерживаемые регионы хранилища
Связанные учетные записи хранения Azure должны находиться в том же регионе, что и компьютер с Cloud Shell, к которому вы их подключаете. Чтобы узнать текущий регион вы можете выполнить `env` в Bash и найти переменную `ACC_LOCATION`. Файловые ресурсы получают образ размером 5 ГБ, создаваемый для хранения каталога `$Home`.

Компьютеры Cloud Shell находятся в следующих регионах:

|Область|Регион|
|---|---|
|Северная и Южная Америка|Восточная часть США, центрально-южная часть США, западная часть США|
|Европа|Северная Европа, Западная Европа|
|Азиатско-Тихоокеанский регион|Центральная Индия, Юго-Восточная Азия|

## <a name="restrict-resource-creation-with-an-azure-resource-policy"></a>Ограничение создания ресурсов с помощью политик ресурсов Azure
Учетные записи хранения, создаваемые в Cloud Shell, помечаются тегом `ms-resource-usage:azure-cloud-shell`. Если вы хотите запретить пользователям создавать учетные записи хранения в Cloud Shell, создайте [политику ресурсов Azure на основе тегов](../articles/azure-policy/json-samples.md) для этого конкретного тега.
